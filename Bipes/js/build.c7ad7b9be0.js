"use strict";(self.webpackChunkui=self.webpackChunkui||[]).push([[826],{827:(t,e,i)=>{class s{constructor(t){this.initEvent&&this.initEvent()}initEvent(){}}class n extends s{constructor(){super(),this.watch_timer=null,this.state=!1,this.code=CodeMirror.fromTextArea(document.getElementById("code-preview"),{mode:"python",lineNumbers:!0,readOnly:!0})}initEvent(){$("#codePreviewButton").on("click",()=>{this.changeCode(!this.state)})}changeCode(t){let e=t?"on":"off";$(".code-preview").css("visibility",t?"visible":"hidden"),$("#codePreviewButton").css("background",`url(https://maxuecan.github.io/Bipes/media/new-icon/code-${e}.png) center / cover`),t?($(".CodeMirror").eq(0).css("height","calc(100vh - 3.5rem)"),this.code.setValue(Code.generateCode()),this.watchCodeChange()):(clearTimeout(this.watch_timer),this.code.setValue("")),this.state=t}watchCodeChange(){this.watch_timer=setTimeout(()=>{let t=Code.generateCode();t!==this.code.getValue()&&this.code.setValue(t),this.watchCodeChange()},500)}}const h=i(187);const a=new class extends h{constructor(){super(),this.on("open-control-preview",()=>{this.emit("control-preview-change",!0)}),this.on("open-draw-preview",()=>{this.emit("draw-preview-change",!0)})}};class r{constructor(t,e={},i="",s=null){this.element=t,this.options={minWidth:e.minWidth||300,minHeight:e.minHeight||300,maxWidth:e.maxWidth||800,maxHeight:e.maxHeight||800,onResize:e.onResize||null,handles:e.handles||"all"},this.type=i,this.callback=s,this.isResizing=!1,this.isDragging=!1,this.currentHandle=null,this.startX=0,this.startY=0,this.startWidth=0,this.startHeight=0,this.startLeft=0,this.startTop=0,this.boundary={width:window.innerWidth,height:window.innerHeight},this.initEvent(),window.addEventListener("resize",t=>{this.boundary={width:t.currentTarget.innerWidth,height:t.currentTarget.innerHeight}})}initEvent(){this.createHandles(),this.bindEvents()}createHandles(){[{class:"resize-handle-n",cursor:"n-resize"},{class:"resize-handle-s",cursor:"s-resize"},{class:"resize-handle-w",cursor:"w-resize"},{class:"resize-handle-e",cursor:"e-resize"},{class:"resize-handle-nw",cursor:"nw-resize"},{class:"resize-handle-ne",cursor:"ne-resize"},{class:"resize-handle-sw",cursor:"sw-resize"},{class:"resize-handle-se",cursor:"se-resize"}].forEach(t=>{const e=document.createElement("div");e.className=`resize-handle ${t.class}`,this.element.appendChild(e)})}bindEvents(){this.element.querySelectorAll(".resize-handle").forEach(t=>{t.addEventListener("mousedown",this.startResize.bind(this)),t.addEventListener("mouseup",this.stopResize.bind(this))});const t=this.element.querySelector(`.${this.type}-header`);t&&t.addEventListener("mousedown",this.startDrag.bind(this)),document.addEventListener("mousemove",this.handleResize.bind(this)),document.addEventListener("mouseup",this.stopResize.bind(this))}startResize(t){if(this.isDragging)return;t.preventDefault(),this.isResizing=!0,this.currentHandle=t.target,this.startX=t.clientX,this.startY=t.clientY;const e=window.getComputedStyle(this.element);this.startWidth=parseInt(e.width,10),this.startHeight=parseInt(e.height,10),this.startLeft=parseInt(e.left,10)||0,this.startTop=parseInt(e.top,10)||0,document.body.style.userSelect="none"}startDrag(t){if(this.isResizing)return;t.preventDefault(),this.isDragging=!0,this.startX=t.clientX,this.startY=t.clientY;const e=window.getComputedStyle(this.element);this.startLeft=parseInt(e.left,10)||0,this.startTop=parseInt(e.top,10)||0,document.body.style.userSelect="none"}handleResize(t){(this.isResizing||this.isDragging)&&(this.isResizing?this.doResize(t):this.isDragging&&this.doDrag(t))}doResize(t){const e=t.clientX-this.startX,i=t.clientY-this.startY;let s=this.startWidth,n=this.startHeight,h=this.startLeft,a=this.startTop,r=0,o=0;if(this.currentHandle.classList.contains("resize-handle-e")){if(s=this.getSize("max-width",this.startWidth+e),s===this.options.minWidth||this.boundary.width-(s+this.startLeft)<10||Number.isFinite(this.options.maxWidth)&&this.boundary.width-(s+this.startLeft)<=10)return}else if(this.currentHandle.classList.contains("resize-handle-w")){if(h=this.startLeft+e,h<=2)return;if(s=Math.max(this.options.minWidth,e<0?this.startWidth-e:Math.max(this.options.minWidth,this.startWidth-e)),s===this.options.minWidth||Number.isFinite(this.options.maxWidth)&&s>this.options.maxWidth)return}else if(this.currentHandle.classList.contains("resize-handle-s")){if(n=this.getSize("max-height",this.startHeight+i),this.boundary.height-(n+a)<=10||Number.isFinite(this.options.maxHeight)&&n>this.options.maxHeight)return}else if(this.currentHandle.classList.contains("resize-handle-n")){if(a=this.startTop+i,a<=2)return;if(n=Math.max(this.options.minHeight,i<0?this.startHeight-i:Math.max(this.options.minHeight,this.startHeight-i)),n===this.options.minHeight||Number.isFinite(this.options.maxHeight)&&n>this.options.maxHeight)return}else this.currentHandle.classList.contains("resize-handle-se")?(s=this.getSize("max-width",this.startWidth+e),n=this.getSize("max-height",this.startHeight+i),this.boundary.width-(s+this.startLeft)<10&&(s=this.boundary.width-this.startLeft-10),this.boundary.height-(n+this.startTop)<10&&(n=this.boundary.height-this.startTop-10)):this.currentHandle.classList.contains("resize-handle-sw")?(s=this.getSize("max-width",this.startWidth-e),n=this.getSize("max-height",this.startHeight+i),h=this.startLeft+e,h<=2&&(h=2,r=h-this.startLeft,s=Math.min(this.options.maxWidth,this.startWidth-r)),s===this.options.minWidth?(r=this.startWidth-this.options.minWidth,h=this.startLeft+r):s===this.options.maxWidth&&(r=this.options.maxWidth-this.startWidth,h=this.startLeft-r),this.boundary.height-(n+this.startTop)<10&&(n=this.boundary.height-this.startTop-10)):this.currentHandle.classList.contains("resize-handle-ne")?(s=this.getSize("max-width",this.startWidth+e),n=this.getSize("max-height",this.startHeight-i),a=this.startTop+i,a<=2&&(a=2,o=a-this.startTop,n=Math.min(this.options.maxHeight,this.startHeight-o)),n===this.options.minHeight?(o=this.startHeight-this.options.minHeight,a=this.startTop+o):n===this.options.maxHeight&&(o=this.options.maxHeight-this.startHeight,a=this.startTop-o),this.boundary.width-(s+this.startLeft)<10&&(s=this.boundary.width-this.startLeft-10)):this.currentHandle.classList.contains("resize-handle-nw")&&(s=this.getSize("max-width",this.startWidth-e),n=this.getSize("max-height",this.startHeight-i),h=this.startLeft+e,h<=2&&(h=2,r=h-this.startLeft,s=Math.min(this.options.maxWidth,this.startWidth-r)),s===this.options.minWidth?(r=this.startWidth-this.options.minWidth,h=this.startLeft+r):s===this.options.maxWidth&&(r=this.options.maxWidth-this.startWidth,h=this.startLeft-r),a=this.startTop+i,a<=2&&(a=2,o=a-this.startTop,n=Math.min(this.options.maxHeight,this.startHeight-o)),n===this.options.minHeight?(o=this.startHeight-this.options.minHeight,a=this.startTop+o):n===this.options.maxHeight&&(o=this.options.maxHeight-this.startHeight,a=this.startTop-o));if(this.element.style.width=`${s}px`,this.element.style.height=`${n}px`,this.element.style.left=`${h}px`,this.element.style.top=`${a}px`,this.options.onResize&&this.options.onResize({width:s,height:n,left:h,top:a}),this.callback){let t=null;if("draw"===this.type)t={newWidth:s,newHeight:n};this.callback(t)}}doDrag(t){const e=t.clientX-this.startX,i=t.clientY-this.startY,s=this.startLeft+e,n=this.startTop+i;let h=+getComputedStyle(this.element).width.replace("px",""),a=+getComputedStyle(this.element).height.replace("px",""),r=+document.body.offsetWidth,o=+document.body.offsetHeight;s>0&&h+s<r&&(this.element.style.left=`${s}px`),n>0&&a+n<o&&(this.element.style.top=`${n}px`)}stopResize(){this.isResizing=!1,this.isDragging=!1,this.currentHandle=null,document.body.style.userSelect=""}getSize(t,e){switch(t){case"max-width":return Math.max(this.options.minWidth,Math.min(this.options.maxWidth,e));case"max-height":return Math.max(this.options.minHeight,Math.min(this.options.maxHeight,e));default:return!1}}}class o{constructor(){this.element=new r(document.getElementsByClassName("control-preview")[0],{minWidth:560,minHeight:400,maxWidth:800,maxHeight:607},"control",()=>{term.resize()}),this.state=!1,this.initEvent(),a.on("control-preview-change",t=>{this.changeConsole(t)})}initEvent(){$("#consolePreviewButton").on("click",()=>{this.changeConsole(!this.state)}),$(".control-clear").on("click",()=>{term.write("c")}),$(".control-close").on("click",()=>{this.changeConsole(!1)})}changeConsole(t){let e=t?"on":"off";$(".control-preview").css("visibility",t?"visible":"hidden"),$("#consolePreviewButton").css("background",`url(https://maxuecan.github.io/Bipes/media/new-icon/console-${e}.png) center / cover`),this.state=t}}class c extends s{constructor(){super(),this.state=!1}initEvent(){$("#settingsButton").on("click",()=>{this.changeSetting(!this.state)}),$("#cancel-settings").on("click",()=>{this.changeSetting(!1)}),$("#save-settings").on("click",this.saveSettings.bind(this))}changeSetting(t){let e=$(".control-preview").css("visibility"),i=$(".draw-preview").css("visibility");if("visible"===e||"visible"===i)return UI.notify.send("ËØ∑ÂÖ≥Èó≠È¢ÑËßàÁ™óÂè£"),!1;let s=t?"on":"off";$(".settings-preview").css("visibility",t?"visible":"hidden"),$("#settingsButton").css("background",`url(https://maxuecan.github.io/Bipes/media/new-icon/setting-${s}.png) center / cover`),t&&this.loadSettings(),this.state=t}saveSettings(){let t="hardware";const e=$('input[name="programMode"]:checked');e.length>0&&(t=e.val());const i={mode:t};try{localStorage.setItem("settings",JSON.stringify(i)),this.updateView(i.mode)}catch(t){console.error("‰øùÂ≠òËÆæÁΩÆÂ§±Ë¥•:",t)}this.changeSetting(!1)}loadSettings(){try{const t=localStorage.getItem("settings");if(t){const e=JSON.parse(t);e.mode&&$(`input[name="programMode"][value="${e.mode}"]`).prop("checked",!0)}}catch(t){console.error("Âä†ËΩΩËÆæÁΩÆÂ§±Ë¥•:",t)}}updateView(t){$("#channel_connect").css("display","hardware"===t?"flex":"none"),$("#consolePreviewButton").css("display","turtle"===t?"none":"block"),$("#skulptPreviewButton").css("display","turtle"===t?"block":"none")}}class d extends s{constructor(){super(),this.element=new r(document.getElementsByClassName("draw-preview")[0],{minWidth:400,minHeight:400,maxWidth:600,maxHeight:600},"draw",t=>{let{newWidth:e,newHeight:i}=t;$("#draw-canvas").css({width:e+"px",height:i-52+"px"}),window.Sk.TurtleGraphics.width=e,window.Sk.TurtleGraphics.height=i-52}),this.state=!1,a.on("draw-preview-change",t=>{this.changeCode(t)})}initEvent(){$(".draw-close").on("click",()=>{this.changeCode(!1)}),$("#skulptPreviewButton").on("click",()=>{this.changeCode(!this.state)})}changeCode(t){$(".draw-preview").css("visibility",t?"visible":"hidden"),this.state=t}}class l{constructor(){this.search_list=[],this.search_act=-1}initEvent(){$(".search-device-close").on("click",this.close.bind(this)),$(".search-btn").on("click",this.scan.bind(this)),$(".search-device-list").on("click",this.selectDevice.bind(this)),$(".search-device-confirm").on("click",this.confirm.bind(this))}removeEvent(){$(".search-device-close").off("click",this.close.bind(this)),$(".search-btn").off("click",this.scan.bind(this)),$(".search-device-list").off("click",this.selectDevice.bind(this)),$(".search-device-confirm").off("click",this.confirm.bind(this))}close(){this.resetConfig(),this.removeEvent(),$(".com-mask").remove()}scan(){$(".search-device-list").empty(),this.resetConfig();let t=0,e=0,i=$("#network").val(),s=$("#port").val(),n=this;if(this.ValidateIPaddress(i)){$(".search-device-load").css("display","block");for(let h=1;h<=155;h++){let a=new WebSocket("wss://"+i+"."+h+":"+s);a.start=performance.now(),a.port=s,a.onerror=function(){e++,155===e&&setTimeout(n.secondScan(e,t,i,s),200)};let r=a;a.onopen=function(){n.search_list.push(this.url),t++,cound++;let h=$("<li>").attr("key",t),a=$("<div>").text(this.url).attr("key",t);$(".search-device-list").append(h.append(a)),r.close(),155==e&&setTimeout(n.secondScan(e,t,i,s),200)}}}}secondScan(t,e,i,s){let n=e,h=t+1,a=this;for(let t=h;t<=255;t++){let e=new WebSocket("wss://"+i+"."+t+":"+s);e.start=performance.now(),e.port=s,e.onerror=function(){h++,255===h&&($(".search-device-load").css("display","none"),$(".device-num").text($(".search-device-list").children().length))};let r=e;e.onopen=function(){a.search_list.push(this.url),n++,h++;let t=$("<li>").attr("key",n),e=$("<div>").text(this.url).attr("key",n);$(".search-device-list").append(t.append(e)),r.close(),255==h&&($(".search-device-load").css("display","none"),$(".device-num").text($(".search-device-list").children().length))}}}ValidateIPaddress(t){return!!/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(t)||(alert("You have entered an invalid network prefix!"),!1)}selectDevice(t){let e=$(t.target).attr("key");if(null==e)return!1;e=+e-1,-1!==this.search_act&&($(".search-device-list").children()[this.search_act].className=""),$(".search-device-list").children()[e].className=e===this.search_act?"":"search-device-list-act",this.search_act=e===this.search_act?-1:e,$(".search-device-footer").css("display",-1!==this.search_act?"block":"none")}resetConfig(){this.search_list=[],this.search_act=-1}confirm(){UI.workspace.websocket.ws=this.search_list[this.search_act],UI.workspace.connectClick(),this.close()}render(){return'\n        <div class="com-mask">\n            <div class="search-device-dialog">\n                <div class="com-header search-device-header">\n                    <h4 class="search-device-name">ËÆæÂ§áÊêúÁ¥¢</h4>\n                    <img \n                        class="com-close search-device-close" \n                        src="https://maxuecan.github.io/Bipes/media/new-icon/com-close.png" \n                        alt=""\n                    >\n                </div>\n                <div class="search-device-content">\n                    <div class="search-device-search">\n                        <span>ËÆæÂ§áÂú∞ÂùÄ:</span>\n                        <input id="network" type="text" placeholder="192.168.137.200" value="192.168.130">:\n                        <input id="port" type="text" placeholder="8266" value="9001">\n                        <button class="search-btn">ÊêúÁ¥¢</button>\n                    </div>\n                    <div class="search-device-num">\n                        ÊêúÁ¥¢ÁªìÊûúÔºà <span class="device-num">0</span> ‰∏™Ôºâ\n                    </div>\n                    <ul class="search-device-list"></ul>\n                    <div class="search-device-load">\n                        <div class="ws-circle" style="margin: 160px auto 0 auto;">\n                            <div class="circle-bor">\n                                <div></div>\n                            </div>\n                            <div class="circle-mask">\n                                <div class="part bg-blue pos01"></div>\n                                <div class="part bg-red pos02"></div>\n                                <div class="part bg-green pos03"></div>\n                            </div>\n                        </div>\n                        <p>Êâ´ÊèèËÆæÂ§á‰∏≠...</p>\n                    </div>\n                </div>\n                <div class="com-footer search-device-footer">\n                    <button class="search-device-confirm">Á°ÆÂÆö</button>\n                </div>\n            </div>\n        </div>\n        '}}var p=i(734);class u extends s{constructor(){super(),p.pre="output",p.configure({output:this.outF,read:this.buildinRead,__future__:p.python3}),(p.TurtleGraphics||(p.TurtleGraphics={})).target="draw-canvas",window.Sk.TurtleGraphics.width=600,window.Sk.TurtleGraphics.height=600,this.sk=p}outF(t){term.write(t+"\r")}buildinRead(t){if(void 0===p.builtinFiles||void 0===p.builtinFiles.files[t])throw"File not found: '"+t+"'";return p.builtinFiles.files[t]}runPythonCode(){let t=Code.generateCode();this.sk.misceval.asyncToPromise(()=>this.sk.importMainWithBody("<stdin>",!1,t,!0)).then(t=>{}).catch(t=>{})}runSkulptCode(){let t=Code.generateCode();this.sk.misceval.asyncToPromise(()=>this.sk.importMainWithBody("<stdin>",!1,t,!0)).then(t=>{}).catch(t=>{})}}new class extends s{constructor(){super(),this.SKULPT_CONSTROLER=new u,this.CODE_PREVIEW=new n,this.CONTROL_PREVIEW=new o,this.SETTING_PREVIEW=new c,this.DRAW_PREVIEW=new d,this.SEARCH_DEVICE=null,this._settings=this.getLocalSettings()}initEvent(){$("#bipes-run").on("click",this.bipesRun.bind(this)),$("#scanButton").on("click",this.openSearchDevice.bind(this))}bipesRun(){let{mode:t}=this.getLocalSettings();switch(t){case"hardware":UI.workspace.run();break;case"offline":a.emit("open-control-preview"),this.SKULPT_CONSTROLER.runPythonCode();break;case"turtle":a.emit("open-draw-preview"),setTimeout(()=>{this.SKULPT_CONSTROLER.runSkulptCode()})}}getLocalSettings(){let t=null;try{const e=localStorage.getItem("settings");return e?(t=JSON.parse(e),this.SETTING_PREVIEW.updateView(t.mode)):(t={mode:"hardware"},localStorage.setItem("settings",JSON.stringify(t)),this.SETTING_PREVIEW.updateView("hardware")),t}catch(e){return console.error("Ëé∑ÂèñÊú¨Âú∞ÁºìÂ≠òËÆæÁΩÆÂ§±Ë¥•:",e),t={mode:"hardware"},t}}getSettings(){return this._settings}openSearchDevice(){this.SEARCH_DEVICE||(this.SEARCH_DEVICE=new l),$("body").append(this.SEARCH_DEVICE.render()),this.SEARCH_DEVICE.initEvent()}}}},t=>{t.O(0,[41],()=>{return e=827,t(t.s=e);var e});t.O()}]);