"use strict";(self.webpackChunkui=self.webpackChunkui||[]).push([[826],{531:(t,e,i)=>{class s{constructor(t){this.initEvent&&this.initEvent()}initEvent(){}}class h extends s{constructor(){super(),this.watch_timer=null,this.state=!1,this.code=CodeMirror.fromTextArea(document.getElementById("code-preview"),{mode:"python",lineNumbers:!0,readOnly:!0})}initEvent(){$("#codePreviewButton").on("click",()=>{this.changeCode(!this.state)})}changeCode(t){let e=t?"on":"off";$(".code-preview").css("visibility",t?"visible":"hidden"),$("#codePreviewButton").css("background",`url(https://maxuecan.github.io/Bipes/media/new-icon/code-${e}.png) center / cover`),t?($(".CodeMirror").eq(0).css("height","calc(100vh - 3.5rem)"),this.code.setValue(Code.generateCode()),this.watchCodeChange()):(clearTimeout(this.watch_timer),this.code.setValue("")),this.state=t}watchCodeChange(){this.watch_timer=setTimeout(()=>{let t=Code.generateCode();t!==this.code.getValue()&&this.code.setValue(t),this.watchCodeChange()},500)}}const n=i(187);const r=new class extends n{constructor(){super(),this.on("open-control-preview",()=>{this.emit("control-preview-change",!0)}),this.on("open-draw-preview",()=>{this.emit("draw-preview-change",!0)})}};class a{constructor(t,e={},i="",s=null){this.element=t,this.options={minWidth:e.minWidth||300,minHeight:e.minHeight||300,maxWidth:e.maxWidth||800,maxHeight:e.maxHeight||800,onResize:e.onResize||null,handles:e.handles||"all"},this.type=i,this.callback=s,this.isResizing=!1,this.isDragging=!1,this.currentHandle=null,this.startX=0,this.startY=0,this.startWidth=0,this.startHeight=0,this.startLeft=0,this.startTop=0,this.boundary={width:window.innerWidth,height:window.innerHeight},this.initEvent(),window.addEventListener("resize",t=>{this.boundary={width:t.currentTarget.innerWidth,height:t.currentTarget.innerHeight}})}initEvent(){this.createHandles(),this.bindEvents()}createHandles(){[{class:"resize-handle-n",cursor:"n-resize"},{class:"resize-handle-s",cursor:"s-resize"},{class:"resize-handle-w",cursor:"w-resize"},{class:"resize-handle-e",cursor:"e-resize"},{class:"resize-handle-nw",cursor:"nw-resize"},{class:"resize-handle-ne",cursor:"ne-resize"},{class:"resize-handle-sw",cursor:"sw-resize"},{class:"resize-handle-se",cursor:"se-resize"}].forEach(t=>{const e=document.createElement("div");e.className=`resize-handle ${t.class}`,this.element.appendChild(e)})}bindEvents(){this.element.querySelectorAll(".resize-handle").forEach(t=>{t.addEventListener("mousedown",this.startResize.bind(this)),t.addEventListener("mouseup",this.stopResize.bind(this))});const t=this.element.querySelector(`.${this.type}-header`);t&&t.addEventListener("mousedown",this.startDrag.bind(this)),document.addEventListener("mousemove",this.handleResize.bind(this)),document.addEventListener("mouseup",this.stopResize.bind(this))}startResize(t){if(this.isDragging)return;t.preventDefault(),this.isResizing=!0,this.currentHandle=t.target,this.startX=t.clientX,this.startY=t.clientY;const e=window.getComputedStyle(this.element);this.startWidth=parseInt(e.width,10),this.startHeight=parseInt(e.height,10),this.startLeft=parseInt(e.left,10)||0,this.startTop=parseInt(e.top,10)||0,document.body.style.userSelect="none"}startDrag(t){if(this.isResizing)return;t.preventDefault(),this.isDragging=!0,this.startX=t.clientX,this.startY=t.clientY;const e=window.getComputedStyle(this.element);this.startLeft=parseInt(e.left,10)||0,this.startTop=parseInt(e.top,10)||0,document.body.style.userSelect="none"}handleResize(t){(this.isResizing||this.isDragging)&&(this.isResizing?this.doResize(t):this.isDragging&&this.doDrag(t))}doResize(t){const e=t.clientX-this.startX,i=t.clientY-this.startY;let s=this.startWidth,h=this.startHeight,n=this.startLeft,r=this.startTop,a=0,o=0;if(this.currentHandle.classList.contains("resize-handle-e")){if(s=this.getSize("max-width",this.startWidth+e),s===this.options.minWidth||this.boundary.width-(s+this.startLeft)<10||Number.isFinite(this.options.maxWidth)&&this.boundary.width-(s+this.startLeft)<=10)return}else if(this.currentHandle.classList.contains("resize-handle-w")){if(n=this.startLeft+e,n<=2)return;if(s=Math.max(this.options.minWidth,e<0?this.startWidth-e:Math.max(this.options.minWidth,this.startWidth-e)),s===this.options.minWidth||Number.isFinite(this.options.maxWidth)&&s>this.options.maxWidth)return}else if(this.currentHandle.classList.contains("resize-handle-s")){if(h=this.getSize("max-height",this.startHeight+i),this.boundary.height-(h+r)<=10||Number.isFinite(this.options.maxHeight)&&h>this.options.maxHeight)return}else if(this.currentHandle.classList.contains("resize-handle-n")){if(r=this.startTop+i,r<=2)return;if(h=Math.max(this.options.minHeight,i<0?this.startHeight-i:Math.max(this.options.minHeight,this.startHeight-i)),h===this.options.minHeight||Number.isFinite(this.options.maxHeight)&&h>this.options.maxHeight)return}else this.currentHandle.classList.contains("resize-handle-se")?(s=this.getSize("max-width",this.startWidth+e),h=this.getSize("max-height",this.startHeight+i),this.boundary.width-(s+this.startLeft)<10&&(s=this.boundary.width-this.startLeft-10),this.boundary.height-(h+this.startTop)<10&&(h=this.boundary.height-this.startTop-10)):this.currentHandle.classList.contains("resize-handle-sw")?(s=this.getSize("max-width",this.startWidth-e),h=this.getSize("max-height",this.startHeight+i),n=this.startLeft+e,n<=2&&(n=2,a=n-this.startLeft,s=Math.min(this.options.maxWidth,this.startWidth-a)),s===this.options.minWidth?(a=this.startWidth-this.options.minWidth,n=this.startLeft+a):s===this.options.maxWidth&&(a=this.options.maxWidth-this.startWidth,n=this.startLeft-a),this.boundary.height-(h+this.startTop)<10&&(h=this.boundary.height-this.startTop-10)):this.currentHandle.classList.contains("resize-handle-ne")?(s=this.getSize("max-width",this.startWidth+e),h=this.getSize("max-height",this.startHeight-i),r=this.startTop+i,r<=2&&(r=2,o=r-this.startTop,h=Math.min(this.options.maxHeight,this.startHeight-o)),h===this.options.minHeight?(o=this.startHeight-this.options.minHeight,r=this.startTop+o):h===this.options.maxHeight&&(o=this.options.maxHeight-this.startHeight,r=this.startTop-o),this.boundary.width-(s+this.startLeft)<10&&(s=this.boundary.width-this.startLeft-10)):this.currentHandle.classList.contains("resize-handle-nw")&&(s=this.getSize("max-width",this.startWidth-e),h=this.getSize("max-height",this.startHeight-i),n=this.startLeft+e,n<=2&&(n=2,a=n-this.startLeft,s=Math.min(this.options.maxWidth,this.startWidth-a)),s===this.options.minWidth?(a=this.startWidth-this.options.minWidth,n=this.startLeft+a):s===this.options.maxWidth&&(a=this.options.maxWidth-this.startWidth,n=this.startLeft-a),r=this.startTop+i,r<=2&&(r=2,o=r-this.startTop,h=Math.min(this.options.maxHeight,this.startHeight-o)),h===this.options.minHeight?(o=this.startHeight-this.options.minHeight,r=this.startTop+o):h===this.options.maxHeight&&(o=this.options.maxHeight-this.startHeight,r=this.startTop-o));if(this.element.style.width=`${s}px`,this.element.style.height=`${h}px`,this.element.style.left=`${n}px`,this.element.style.top=`${r}px`,this.options.onResize&&this.options.onResize({width:s,height:h,left:n,top:r}),this.callback){let t=null;if("draw"===this.type)t={newWidth:s,newHeight:h};this.callback(t)}}doDrag(t){const e=t.clientX-this.startX,i=t.clientY-this.startY,s=this.startLeft+e,h=this.startTop+i;let n=+getComputedStyle(this.element).width.replace("px",""),r=+getComputedStyle(this.element).height.replace("px",""),a=+document.body.offsetWidth,o=+document.body.offsetHeight;s>0&&n+s<a&&(this.element.style.left=`${s}px`),h>0&&r+h<o&&(this.element.style.top=`${h}px`)}stopResize(){this.isResizing=!1,this.isDragging=!1,this.currentHandle=null,document.body.style.userSelect=""}getSize(t,e){switch(t){case"max-width":return Math.max(this.options.minWidth,Math.min(this.options.maxWidth,e));case"max-height":return Math.max(this.options.minHeight,Math.min(this.options.maxHeight,e));default:return!1}}}class o{constructor(){this.element=new a(document.getElementsByClassName("control-preview")[0],{minWidth:560,minHeight:400,maxWidth:800,maxHeight:607},"control",()=>{term.resize()}),this.state=!1,this.initEvent(),r.on("control-preview-change",t=>{this.changeConsole(t)})}initEvent(){$("#consolePreviewButton").on("click",()=>{this.changeConsole(!this.state)}),$(".control-clear").on("click",()=>{term.write("c")}),$(".control-close").on("click",()=>{this.changeConsole(!1)})}changeConsole(t){let e=t?"on":"off";$(".control-preview").css("visibility",t?"visible":"hidden"),$("#consolePreviewButton").css("background",`url(https://maxuecan.github.io/Bipes/media/new-icon/console-${e}.png) center / cover`),this.state=t}}class d extends s{constructor(){super(),this.state=!1}initEvent(){$("#settingsButton").on("click",()=>{this.changeSetting(!this.state)}),$("#cancel-settings").on("click",()=>{this.changeSetting(!1)}),$("#save-settings").on("click",this.saveSettings.bind(this))}changeSetting(t){let e=$(".control-preview").css("visibility"),i=$(".draw-preview").css("visibility");if("visible"===e||"visible"===i)return UI.notify.send("è¯·å…³é—­é¢„è§ˆçª—å£"),!1;let s=t?"on":"off";$(".settings-preview").css("visibility",t?"visible":"hidden"),$("#settingsButton").css("background",`url(https://maxuecan.github.io/Bipes/media/new-icon/setting-${s}.png) center / cover`),t&&this.loadSettings(),this.state=t}saveSettings(){let t="hardware";const e=$('input[name="programMode"]:checked');e.length>0&&(t=e.val());const i={mode:t};try{localStorage.setItem("settings",JSON.stringify(i)),this.updateView(i.mode)}catch(t){console.error("ä¿å­˜è®¾ç½®å¤±è´¥:",t)}this.changeSetting(!1)}loadSettings(){try{const t=localStorage.getItem("settings");if(t){const e=JSON.parse(t);e.mode&&$(`input[name="programMode"][value="${e.mode}"]`).prop("checked",!0)}}catch(t){console.error("åŠ è½½è®¾ç½®å¤±è´¥:",t)}}updateView(t){$("#channel_connect").css("display","hardware"===t?"flex":"none"),$("#consolePreviewButton").css("display","turtle"===t?"none":"block"),$("#skulptPreviewButton").css("display","turtle"===t?"block":"none")}}class c extends s{constructor(){super(),this.element=new a(document.getElementsByClassName("draw-preview")[0],{minWidth:400,minHeight:400,maxWidth:600,maxHeight:600},"draw",t=>{let{newWidth:e,newHeight:i}=t;$("#draw-canvas").css({width:e+"px",height:i-52+"px"}),window.Sk.TurtleGraphics.width=e,window.Sk.TurtleGraphics.height=i-52}),this.state=!1,r.on("draw-preview-change",t=>{this.changeCode(t)})}initEvent(){$(".draw-close").on("click",()=>{this.changeCode(!1)}),$("#skulptPreviewButton").on("click",()=>{this.changeCode(!this.state)})}changeCode(t){$(".draw-preview").css("visibility",t?"visible":"hidden"),this.state=t}}var l=i(734);class g extends s{constructor(){super(),l.pre="output",l.configure({output:this.outF,read:this.buildinRead,__future__:l.python3}),(l.TurtleGraphics||(l.TurtleGraphics={})).target="draw-canvas",window.Sk.TurtleGraphics.width=600,window.Sk.TurtleGraphics.height=600,this.sk=l}outF(t){term.write(t+"\r")}buildinRead(t){if(void 0===l.builtinFiles||void 0===l.builtinFiles.files[t])throw"File not found: '"+t+"'";return l.builtinFiles.files[t]}runPythonCode(){let t=Code.generateCode();this.sk.misceval.asyncToPromise(()=>this.sk.importMainWithBody("<stdin>",!1,t,!0)).then(t=>{}).catch(t=>{})}runSkulptCode(){let t=Code.generateCode();this.sk.misceval.asyncToPromise(()=>this.sk.importMainWithBody("<stdin>",!1,t,!0)).then(t=>{}).catch(t=>{})}}new class extends s{constructor(){super(),this.SKULPT_CONSTROLER=new g,this.CODE_PREVIEW=new h,this.CONTROL_PREVIEW=new o,this.SETTING_PREVIEW=new d,this.DRAW_PREVIEW=new c,this._settings=this.getLocalSettings()}initEvent(){$("#bipes-run").on("click",this.bipesRun.bind(this))}bipesRun(){let{mode:t}=this.getLocalSettings();switch(t){case"hardware":UI.workspace.run();break;case"offline":r.emit("open-control-preview"),this.SKULPT_CONSTROLER.runPythonCode();break;case"turtle":r.emit("open-draw-preview"),setTimeout(()=>{this.SKULPT_CONSTROLER.runSkulptCode()})}}getLocalSettings(){let t=null;try{const e=localStorage.getItem("settings");return e?(t=JSON.parse(e),this.SETTING_PREVIEW.updateView(t.mode)):(t={mode:"hardware"},localStorage.setItem("settings",JSON.stringify(t)),this.SETTING_PREVIEW.updateView("hardware")),t}catch(e){return console.error("èŽ·å–æœ¬åœ°ç¼“å­˜è®¾ç½®å¤±è´¥:",e),t={mode:"hardware"},t}}getSettings(){return this._settings}}}},t=>{t.O(0,[41],()=>{return e=531,t(t.s=e);var e});t.O()}]);