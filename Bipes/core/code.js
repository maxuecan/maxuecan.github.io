"use strict";var Code={},libToInstall="";function loadExampleFromURL(e){var o=new XMLHttpRequest;o.open("GET","/beta2/ui/examples/hardware"+e+".xml",!0),o.send(null),o.onreadystatechange=function(){if(4===o.readyState&&200===o.status&&1!==o.getResponseHeader("Content-Type").indexOf("text")){var e=o.responseText,t=Blockly.Xml.textToDom(e);return Blockly.Xml.domToWorkspace(t,Code.workspace),o.responseText}}}function loadDoc(){var e="";"pt-br"==Code.getLang()&&(e="https://docs.google.com/document/d/e/2PACX-1vT7dc6hP4sKyMJupklbGK4adIf3qCkt4r-HrEWO8jTRMx9uUOUSfboKG749IF3DZr8k6zUPSLXkrDGY/pub"),"en"==Code.getLang()&&(e="https://docs.google.com/document/d/e/2PACX-1vSk-9T56hP9K9EOhkF5SoNzsYl4TzDk-GEDnMssaFP_m-LEfI6IU-uRkkLP_HoONK0QmMrZVo_f27Fw/pub"),window.open(e,"_blank").focus()}Code.LANGUAGE_NAME={en:"English","pt-br":"Português Brasileiro",es:"Español",it:"Italiano",fr:"Français",de:"Deutsch","zh-hans":"Chinese (simplified)","zh-hant":"Chinese (traditional)"},Code.LANGUAGE_RTL=["ar","fa","he","lki"],Code.workspace=null,Code.getStringParamFromUrl=function(e,o){var t=location.search.match(new RegExp("[?&]"+e+"=([^&]+)"));return t?decodeURIComponent(t[1].replace(/\+/g,"%20")):o},Code.getLang=function(){var e=Code.getStringParamFromUrl("lang","");return void 0===Code.LANGUAGE_NAME[e]&&(e="zh-hans"),e},Code.isRtl=function(){return-1!=Code.LANGUAGE_RTL.indexOf(Code.LANG)},Code.loadBlocks=function(e){try{window.sessionStorage.loadOnceBlocks}catch(e){}},Code.changeLanguage=function(){if(window.sessionStorage){var e=Blockly.Xml.workspaceToDom(Code.workspace),o=Blockly.Xml.domToText(e);window.sessionStorage.loadOnceBlocks=o}var t=document.getElementById("languageMenu"),n=encodeURIComponent(t.options[t.selectedIndex].value),r=window.location.search;r=r.length<=1?"?lang="+n:r.match(/[?&]lang=[^&]*/)?r.replace(/([?&]lang=)[^&]*/,"$1"+n):r.replace(/\?/,"?lang="+n+"&"),window.location=window.location.protocol+"//"+window.location.host+window.location.pathname+r},Code.bindClick=function(e,o){"string"==typeof e&&(e=document.getElementById(e)),e.addEventListener("click",o,!0)},Code.importPrettify=function(){var e=document.createElement("script");e.setAttribute("src","plugins/code-prettify/run_prettify.js"),document.head.appendChild(e)},Code.LANG=Code.getLang(),Code.TABS_=["blocks","files"],Code.current=["blocks","",""],Code.handleLink=(e,o)=>{let t=2==o?1:2,n=Code.current,r=(e,o)=>{let t=get(`#content_${e}`),n=get(`#tab_${e}`);Code.deinitContent(e),n.classList.remove("on"),1==o&&t.classList.add("_pos1"),2==o&&t.classList.add("_pos2"),t.classList.remove(`pos${o}`),Animate.off(t)},l=(e,o)=>{let t=get(`#content_${e}`),n=get(`#tab_${e}`);Code.renderContent(e),n.classList.add("on"),Animate.on(t),t.classList.remove("_pos1","_pos2"),0!=o&&t.classList.add(`pos${o}`)};if(0==o)return l(e,0),void(Code.current=[e,"",""]);if(n[t]==e){let e=get(`#content_${n[o]}`),r=get(`#content_${n[t]}`);return e.classList.remove(`pos${o}`),e.classList.add(`pos${t}`),r.classList.remove(`pos${t}`),r.classList.add(`pos${o}`),void(Code.current=["",n[2],n[1]])}if(n[0]!=e||""!=n[1]||""!=n[2]){if(1==o&&""!=n[0])return r(n[0],0),n[0]=e,l(n[0],0),void Code.resizeContent();if(1==o&&n[o]==e&&""!=n[t]){return r(n[t],t),get(`#content_${n[o]}`).classList.remove(`pos${o}`),Code.current=[e,"",""],void Code.resizeContent()}if(2==o&&n[o]==e&&""!=n[t]){return r(n[o],o),get(`#content_${n[t]}`).classList.remove(`pos${t}`),Code.current=[n[t],"",""],void Code.resizeContent()}if(n[o]!=e&&""==n[0])return""!=n[o]&&r(n[o],o),l(e,o),Code.current[o]=e,void Code.resizeContent();if(2==o&&n[o]!=e&&""!=n[0]){return get(`#content_${n[0]}`).classList.add("pos1"),l(e,2),Code.current=["",n[0],e],void Code.resizeContent()}}},Code.renderContent=e=>{if(void 0===e)return;let o=get(`#content_${e}`);switch(e){case"blocks":Code.workspace.setVisible(!0),Code.auto_mode=!0,Blockly.svgResize(Code.workspace);break;case"files":null==Files.editor.init&&(Files.editor.setValue(new Array(9).fill("\r\n").join("")),setTimeout(()=>{Files.editor.setValue(""),Files.editor.init=!0},10)),Files.handleCurrentProject()}o.focus()},Code.resizeContent=e=>{Code.current.forEach(e=>{switch(e){case"blocks":setTimeout(()=>{Blockly.svgResize(Code.workspace)},250);break;case"files":Files.resize()}})},Code.deinitContent=e=>{if("blocks"===e)Code.workspace.setVisible(!1),Code.auto_mode=!1},Code.toDOM=function(e,o,t){var n=document.getElementById(t);n.textContent="",n.textContent=e,"function"==typeof PR.prettyPrintOne&&(e=n.textContent,e=PR.prettyPrintOne(e,o),n.innerHTML=e)},Code.checkAllGeneratorFunctionsDefined=function(e){for(var o=Code.workspace.getAllBlocks(!1),t=[],n=0;n<o.length;n++){var r=o[n].type;e.forBlock[r]||-1===t.indexOf(r)&&t.push(r)}var l=0==t.length;if(!l){var a="The generator code for the following blocks not specified for "+e.name_+":\n - "+t.join("\n - ");Blockly.alert(a)}return l},Code.reloadToolbox=function(e){let o=(new XMLSerializer).serializeToString(e).replace(/(^|[^%]){(\w+)}/g,function(e,o,t){return o+MSG[t]}),t=Blockly.Xml.textToDom(o);Code.workspace.updateToolbox(t),Code.workspace.scrollCenter()},Code.auto_mode=!1,Code.generateCode=function(e=Blockly.Python){if(Code.auto_mode||"Window"!=this.constructor.name)if(Code.checkAllGeneratorFunctionsDefined(e)){if("Python"==e.name_)return e.workspaceToCode(Code.workspace);if("Javascript"==e.name_)return e.workspaceToCode(Code.workspace)}else Code.auto_mode=!1},Code.generateXML=function(e=Code.workspace){let o=Blockly.Xml.workspaceToDom(e),t=Blockly.Xml.domToPrettyText(o);return UI.workspace.writeWorkspace(t,!0)},Code.init=function(){Code.initLanguage();var e=Code.isRtl();for(var o in setInterval(Code.generateCode,250),Code.auto_mode=!0,MSG)0==o.indexOf("cat")&&(Blockly.Msg[o.toUpperCase()]=MSG[o]);let t=Blockly.Xml.textToDom("<xml><category name='...'></category></xml>");Code.workspace=Blockly.inject("content_blocks",{grid:{spacing:50,length:3,colour:"#ccc",snap:!0},move:{scrollbars:{horizontal:!0,vertical:!0},wheel:!0},media:"media/",scrollbars:!1,rtl:e,toolbox:t,oneBasedIndex:!1,zoom:{controls:!0,wheel:!0,startScale:.6,maxScale:3,minScale:.3},trashcan:!0,renderer:"zelos"}),Code.loadBlocks(""),"BlocklyStorage"in window&&BlocklyStorage.backupOnUnload(Code.workspace),Code.handleLink(Code.current[0],0),"BlocklyStorage"in window&&(BlocklyStorage.HTTPREQUEST_ERROR=MSG.httpRequestError,BlocklyStorage.LINK_ALERT=MSG.linkAlert,BlocklyStorage.HASH_ERROR=MSG.hashError,BlocklyStorage.XML_ERROR=MSG.xmlError);for(var n=0;n<Code.TABS_.length;n++){let e=Code.TABS_[n],o=get(`#tab_${e}`);o.addEventListener("click",o=>{o.preventDefault(),Code.handleLink(e,1)}),o.addEventListener("contextmenu",o=>{o.preventDefault(),Code.handleLink(e,2)})}Blockly.svgResize(Code.workspace),Code.workspace.registerButtonCallback("installPyLib",function(e){var o=e.text_.split(" ")[1];console.log(e.text_),console.log(o),alert("This will automatic download and install the library on the connected board: "+o+". Internet is required for this operation. Install results will be shown on console tab."),UI.notify.send("Installing library, check console");var t="\ndef bipesInstall(url, lib):\n    import socket\n    _, _, host, path = url.split('/', 3)\n    addr = socket.getaddrinfo(host, 80)[0][-1]\n    s = socket.socket()\n    s.connect(addr)\n    print('Downloading from ' + url)\n    s.send(bytes('GET /%s HTTP/1.0\\r\\nHost: %s\\r\\n\\r\\n' % (path, host), 'utf8'))\n\n    f = open('tmplib.py', 'w')\n    #f = open(lib, 'w')\n\n    while True:\n        data = s.recv(100)\n        if data:\n            #print(str(data, 'utf8'), end='')\n            f.write(data)\n            #print('.')\n        else:\n            break\n    s.close()\n    f.close()\n    print('Download done')\n\n";t=t+"lib = '"+o+".py'\r",t+="bipesInstall('http://bipes.net.br/beta2/ui/pylibs/' + lib, lib)",Tool.runPython(t);var n='\nf=open("tmplib.py", "r")\nc=open("';n+=o+".py\", \"w\")\nlineC=0\nfor line in f:\n\tlineC=lineC+1\n\t#Jump 10 lines to skip HTTP header\n\tif lineC >= 10:\n\t\tr=c.write(line)\n\t\tprint('.', end='')\nf.close()\nc.close()\nprint('Install done.')\n\n",Tool.runPython(n)}),Code.workspace.registerButtonCallback("loadExample",function(e){var o=e.text_.split(":")[1].replace(/\s/g,"");confirm("This will load Example: "+o+". Internet is required for this operation. Important: all blocks on workspace will be lost and replaced by the example blocks. Do you want to continue?")?(Code.workspace.clear(),Code.renderContent(),loadExampleFromURL(o),Code.renderContent()):console.log("Example load canceled.")}),Code.workspace.registerButtonCallback("loadDoc",function(e){var o=e.text_.split(":")[1].replace(/\s/g,""),t="https://docs.google.com/document/d/e/2PACX-1vSk-9T56hP9K9EOhkF5SoNzsYl4TzDk-GEDnMssaFP_m-LEfI6IU-uRkkLP_HoONK0QmMrZVo_f27Fw/pub";"pt-br"==Code.getLang()&&(t="https://docs.google.com/document/d/e/2PACX-1vT7dc6hP4sKyMJupklbGK4adIf3qCkt4r-HrEWO8jTRMx9uUOUSfboKG749IF3DZr8k6zUPSLXkrDGY/pub"),"en"==Code.getLang()&&(t="https://docs.google.com/document/d/e/2PACX-1vSk-9T56hP9K9EOhkF5SoNzsYl4TzDk-GEDnMssaFP_m-LEfI6IU-uRkkLP_HoONK0QmMrZVo_f27Fw/pub"),"mpu6050"==o&&(t+="#h.79fbsr8dha21"),"tm1640"==o&&(t+="#h.iw35vui9vzi1"),"ds1820"==o&&(t+="#h.w84555jgod5j"),"mfrc522"==o&&(t+="#h.owhbali4ayaj"),window.open(t,"_blank").focus()}),window.setTimeout(Code.importPrettify,1)},Code.initLanguage=function(){var e=Code.isRtl();document.dir=e?"rtl":"ltr",document.head.parentElement.setAttribute("lang",Code.LANG);var o=[];for(var t in Code.LANGUAGE_NAME)o.push([Code.LANGUAGE_NAME[t],t]);o.sort(function(e,o){return e[0]>o[0]?1:e[0]<o[0]?-1:0}),document.getElementById("tab_blocks").textContent=MSG.blocks,document.getElementById("saveButton").title=MSG.saveTooltip,document.getElementById("loadButton").title=MSG.loadTooltip,document.getElementById("notificationButton").title=MSG.notificationTooltip,document.getElementById("toolbarButton").title=MSG.toolbarTooltip},Code.discard=function(){var e=Code.workspace.getAllBlocks().length;(e<2||window.confirm(Blockly.Msg.DELETE_ALL_BLOCKS.replace("%1",e)))&&(Code.workspace.clear(),window.location.hash&&(window.location.hash=""))},document.write('<script src="msg/'+Code.LANG+'.js"><\/script>\n'),document.write('<script src="b/js/'+Code.LANG+'.js"><\/script>\n');