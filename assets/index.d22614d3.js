var Gt=Object.defineProperty;var et=Object.getOwnPropertySymbols;var Qt=Object.prototype.hasOwnProperty,es=Object.prototype.propertyIsEnumerable;var st=Math.pow,tt=(l,e,t)=>e in l?Gt(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t,it=(l,e)=>{for(var t in e||(e={}))Qt.call(e,t)&&tt(l,t,e[t]);if(et)for(var t of et(e))es.call(e,t)&&tt(l,t,e[t]);return l};import{i as ts}from"./index.d7611033.js";import{r as lt,k as ss,P as is,b as ls,e as De,o as ns}from"./platForm.b6da2c16.js";class K{constructor(e,t=""){typeof e=="string"?(this.el=document.createElement(e),this.el.className=t):this.el=e,this.data={}}data(e,t){return t!==void 0?(this.data[e]=t,this):this.data[e]}on(e,t){const[s,...i]=e.split(".");let n=s;return n==="mousewheel"&&/Firefox/i.test(window.navigator.userAgent)&&(n="DOMMouseScroll"),this.el.addEventListener(n,r=>{t(r);for(let o=0;o<i.length;o+=1){const c=i[o];if(c==="left"&&r.button!==0||c==="right"&&r.button!==2)return;c==="stop"&&r.stopPropagation()}}),this}offset(e){if(e!==void 0)return Object.keys(e).forEach(r=>{this.css(r,`${e[r]}px`)}),this;const{offsetTop:t,offsetLeft:s,offsetHeight:i,offsetWidth:n}=this.el;return{top:t,left:s,height:i,width:n}}scroll(e){const{el:t}=this;return e!==void 0&&(e.left!==void 0&&(t.scrollLeft=e.left),e.top!==void 0&&(t.scrollTop=e.top)),{left:t.scrollLeft,top:t.scrollTop}}box(){return this.el.getBoundingClientRect()}parent(){return new K(this.el.parentNode)}children(...e){return arguments.length===0?this.el.childNodes:(e.forEach(t=>this.child(t)),this)}removeChild(e){this.el.removeChild(e)}child(e){let t=e;return typeof e=="string"?t=document.createTextNode(e):e instanceof K&&(t=e.el),this.el.appendChild(t),this}contains(e){return this.el.contains(e)}className(e){return e!==void 0?(this.el.className=e,this):this.el.className}addClass(e){return this.el.classList.add(e),this}hasClass(e){return this.el.classList.contains(e)}removeClass(e){return this.el.classList.remove(e),this}toggle(e="active"){return this.toggleClass(e)}toggleClass(e){return this.el.classList.toggle(e)}active(e=!0,t="active"){return e?this.addClass(t):this.removeClass(t),this}checked(e=!0){return this.active(e,"checked"),this}disabled(e=!0){return e?this.addClass("disabled"):this.removeClass("disabled"),this}attr(e,t){if(t!==void 0)this.el.setAttribute(e,t);else{if(typeof e=="string")return this.el.getAttribute(e);Object.keys(e).forEach(s=>{this.el.setAttribute(s,e[s])})}return this}removeAttr(e){return this.el.removeAttribute(e),this}html(e){return e!==void 0?(this.el.innerHTML=e,this):this.el.innerHTML}val(e){return e!==void 0?(this.el.value=e,this):this.el.value}focus(){this.el.focus()}cssRemoveKeys(...e){return e.forEach(t=>this.el.style.removeProperty(t)),this}css(e,t){return t===void 0&&typeof e!="string"?(Object.keys(e).forEach(s=>{this.el.style[s]=e[s]}),this):t!==void 0?(this.el.style[e]=t,this):this.el.style[e]}computedStyle(){return window.getComputedStyle(this.el,null)}show(){return this.css("display","block"),this}hide(){return this.css("display","none"),this}}const u=(l,e="")=>new K(l,e),q=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"];function It(l){let e="",t=l;for(;t>=q.length;)t/=q.length,t-=1,e+=q[parseInt(t,10)%q.length];const s=l%q.length;return e+=q[s],e}function rs(l){let e=0;for(let t=0;t<l.length-1;t+=1){const s=l.charCodeAt(t)-65,i=l.length-1-t;e+=st(q.length,i)+q.length*s}return e+=l.charCodeAt(l.length-1)-65,e}function L(l){let e="",t="";for(let s=0;s<l.length;s+=1)l.charAt(s)>="0"&&l.charAt(s)<="9"?t+=l.charAt(s):e+=l.charAt(s);return[rs(e),parseInt(t,10)-1]}function P(l,e){return`${It(l)}${e+1}`}function se(l,e,t,s=()=>!0){if(e===0&&t===0)return l;const[i,n]=L(l);return s(i,n)?P(i+e,n+t):l}class ${constructor(e,t,s,i,n=0,r=0){this.sri=e,this.sci=t,this.eri=s,this.eci=i,this.w=n,this.h=r}set(e,t,s,i){this.sri=e,this.sci=t,this.eri=s,this.eci=i}multiple(){return this.eri-this.sri>0||this.eci-this.sci>0}includes(...e){let[t,s]=[0,0];e.length===1?[s,t]=L(e[0]):e.length===2&&([t,s]=e);const{sri:i,sci:n,eri:r,eci:o}=this;return i<=t&&t<=r&&n<=s&&s<=o}each(e,t=()=>!0){const{sri:s,sci:i,eri:n,eci:r}=this;for(let o=s;o<=n;o+=1)if(t(o))for(let c=i;c<=r;c+=1)e(o,c)}contains(e){return this.sri<=e.sri&&this.sci<=e.sci&&this.eri>=e.eri&&this.eci>=e.eci}within(e){return this.sri>=e.sri&&this.sci>=e.sci&&this.eri<=e.eri&&this.eci<=e.eci}disjoint(e){return this.sri>e.eri||this.sci>e.eci||e.sri>this.eri||e.sci>this.eci}intersects(e){return this.sri<=e.eri&&this.sci<=e.eci&&e.sri<=this.eri&&e.sci<=this.eci}union(e){const{sri:t,sci:s,eri:i,eci:n}=this;return new $(e.sri<t?e.sri:t,e.sci<s?e.sci:s,e.eri>i?e.eri:i,e.eci>n?e.eci:n)}difference(e){const t=[],s=(f,g,p,w)=>{t.push(new $(f,g,p,w))},{sri:i,sci:n,eri:r,eci:o}=this,c=e.sri-i,h=e.sci-n,d=r-e.eri,a=o-e.eci;return c>0?(s(i,n,e.sri-1,o),d>0?(s(e.eri+1,n,r,o),h>0&&s(e.sri,n,e.eri,e.sci-1),a>0&&s(e.sri,e.eci+1,e.eri,o)):(h>0&&s(e.sri,n,r,e.sci-1),a>0&&s(e.sri,e.eci+1,r,o))):d>0&&(s(e.eri+1,n,r,o),h>0&&s(i,n,e.eri,e.sci-1),a>0&&s(i,e.eci+1,e.eri,o)),h>0?(s(i,n,r,e.sci-1),a>0?(s(i,e.eri+1,r,o),c>0&&s(i,e.sci,e.sri-1,e.eci),d>0&&s(e.sri+1,e.sci,r,e.eci)):(c>0&&s(i,e.sci,e.sri-1,o),d>0&&s(e.sri+1,e.sci,r,o))):a>0&&(s(r,e.eci+1,r,o),c>0&&s(i,n,e.sri-1,e.eci),d>0&&s(e.eri+1,n,r,e.eci)),t}size(){return[this.eri-this.sri+1,this.eci-this.sci+1]}toString(){const{sri:e,sci:t,eri:s,eci:i}=this;let n=P(t,e);return this.multiple()&&(n=`${n}:${P(i,s)}`),n}clone(){const{sri:e,sci:t,eri:s,eci:i,w:n,h:r}=this;return new $(e,t,s,i,n,r)}equals(e){return this.eri===e.eri&&this.eci===e.eci&&this.sri===e.sri&&this.sci===e.sci}static valueOf(e){const t=e.split(":"),[s,i]=L(t[0]);let[n,r]=[i,s];return t.length>1&&([r,n]=L(t[1])),new $(i,s,n,r)}}class os{constructor(){this.range=new $(0,0,0,0),this.ri=0,this.ci=0}multiple(){return this.range.multiple()}setIndexes(e,t){this.ri=e,this.ci=t}size(){return this.range.size()}}class cs{constructor(){this.x=0,this.y=0,this.ri=0,this.ci=0}}class hs{constructor(){this.undoItems=[],this.redoItems=[]}add(e){this.undoItems.push(JSON.stringify(e)),this.redoItems=[]}canUndo(){return this.undoItems.length>0}canRedo(){return this.redoItems.length>0}undo(e,t){const{undoItems:s,redoItems:i}=this;this.canUndo()&&(i.push(JSON.stringify(e)),t(JSON.parse(s.pop())))}redo(e,t){const{undoItems:s,redoItems:i}=this;this.canRedo()&&(s.push(JSON.stringify(e)),t(JSON.parse(i.pop())))}}class as{constructor(){this.range=null,this.state="clear"}copy(e){return this.range=e,this.state="copy",this}cut(e){return this.range=e,this.state="cut",this}isCopy(){return this.state==="copy"}isCut(){return this.state==="cut"}isClear(){return this.state==="clear"}clear(){this.range=null,this.state="clear"}}class nt{constructor(e,t,s){this.ci=e,this.operator=t,this.value=s}set(e,t){this.operator=e,this.value=t}includes(e){const{operator:t,value:s}=this;return t==="all"?!0:t==="in"?s.includes(e):!1}vlength(){const{operator:e,value:t}=this;return e==="in"?t.length:0}getData(){const{ci:e,operator:t,value:s}=this;return{ci:e,operator:t,value:s}}}class rt{constructor(e,t){this.ci=e,this.order=t}asc(){return this.order==="asc"}desc(){return this.order==="desc"}}class ds{constructor(){this.ref=null,this.filters=[],this.sort=null}setData({ref:e,filters:t,sort:s}){e!=null&&(this.ref=e,this.filters=t.map(i=>new nt(i.ci,i.operator,i.value)),s&&(this.sort=new rt(s.ci,s.order)))}getData(){if(this.active()){const{ref:e,filters:t,sort:s}=this;return{ref:e,filters:t.map(i=>i.getData()),sort:s}}return{}}addFilter(e,t,s){const i=this.getFilter(e);i==null?this.filters.push(new nt(e,t,s)):i.set(t,s)}setSort(e,t){this.sort=t?new rt(e,t):null}includes(e,t){return this.active()?this.hrange().includes(e,t):!1}getSort(e){const{sort:t}=this;return t&&t.ci===e?t:null}getFilter(e){const{filters:t}=this;for(let s=0;s<t.length;s+=1)if(t[s].ci===e)return t[s];return null}filteredRows(e){const t=new Set,s=new Set;if(this.active()){const{sri:i,eri:n}=this.range(),{filters:r}=this;for(let o=i+1;o<=n;o+=1)for(let c=0;c<r.length;c+=1){const h=r[c],d=e(o,h.ci),a=d?d.text:"";if(h.includes(a))s.add(o);else{t.add(o);break}}}return{rset:t,fset:s}}items(e,t){const s={};if(this.active()){const{sri:i,eri:n}=this.range();for(let r=i+1;r<=n;r+=1){const o=t(r,e);if(o!==null&&!/^\s*$/.test(o.text)){const c=o.text,h=(s[c]||0)+1;s[c]=h}else s[""]=(s[""]||0)+1}}return s}range(){return $.valueOf(this.ref)}hrange(){const e=this.range();return e.eri=e.sri,e}clear(){this.ref=null,this.filters=[],this.sort=null}active(){return this.ref!==null}}class qe{constructor(e=[]){this._=e}forEach(e){this._.forEach(e)}deleteWithin(e){this._=this._.filter(t=>!t.within(e))}getFirstIncludes(e,t){for(let s=0;s<this._.length;s+=1){const i=this._[s];if(i.includes(e,t))return i}return null}filterIntersects(e){return new qe(this._.filter(t=>t.intersects(e)))}intersects(e){for(let t=0;t<this._.length;t+=1)if(this._[t].intersects(e))return!0;return!1}union(e){let t=e;return this._.forEach(s=>{s.intersects(t)&&(t=s.union(t))}),t}add(e){this.deleteWithin(e),this._.push(e)}shift(e,t,s,i){this._.forEach(n=>{const{sri:r,sci:o,eri:c,eci:h}=n,d=n;e==="row"?r>=t?(d.sri+=s,d.eri+=s):r<t&&t<=c&&(d.eri+=s,i(r,o,s,0)):e==="column"&&(o>=t?(d.sci+=s,d.eci+=s):o<t&&t<=h&&(d.eci+=s,i(r,o,0,s)))})}move(e,t,s){this._.forEach(i=>{const n=i;n.within(e)&&(n.eri+=t,n.sri+=t,n.sci+=s,n.eci+=s)})}setData(e){return this._=e.map(t=>$.valueOf(t)),this}getData(){return this._.map(e=>e.toString())}}function fs(l){return JSON.parse(JSON.stringify(l))}const Rt=(l={},...e)=>(e.forEach(t=>{Object.keys(t).forEach(s=>{const i=t[s];typeof i=="string"||typeof i=="number"||typeof i=="boolean"?l[s]=i:typeof i!="function"&&!Array.isArray(i)&&i instanceof Object?(l[s]=l[s]||{},Rt(l[s],i)):l[s]=i})}),l);function Fe(l,e){const t=Object.keys(l);if(t.length!==Object.keys(e).length)return!1;for(let s=0;s<t.length;s+=1){const i=t[s],n=l[i],r=e[i];if(r===void 0)return!1;if(typeof n=="string"||typeof n=="number"||typeof n=="boolean"){if(n!==r)return!1}else if(Array.isArray(n)){if(n.length!==r.length)return!1;for(let o=0;o<n.length;o+=1)if(!Fe(n[o],r[o]))return!1}else if(typeof n!="function"&&!Array.isArray(n)&&n instanceof Object&&!Fe(n,r))return!1}return!0}const us=(l,e=t=>t)=>{let t=0,s=0;return Object.keys(l).forEach(i=>{t+=e(l[i],i),s+=1}),[t,s]};function gs(l,e){const t=l[`${e}`];return delete l[`${e}`],t}function ps(l,e,t,s,i,n){let r=t,o=s,c=l;for(;c<e&&!(r>i);c+=1)o=n(c),r+=o;return[c,r-o,o]}function ms(l,e,t){let s=0;for(let i=l;i<e;i+=1)s+=t(i);return s}function ws(l,e,t){for(let s=l;s<e;s+=1)t(s)}function bs(l,e){if(l.length===e.length){for(let t=0;t<l.length;t+=1)if(l[t]!==e[t])return!1}else return!1;return!0}function Oe(l){const e=`${l}`;let t=0,s=!1;for(let i=0;i<e.length;i+=1)s===!0&&(t+=1),e.charAt(i)==="."&&(s=!0);return t}function U(l,e,t){if(Number.isNaN(e)||Number.isNaN(t))return e+l+t;const s=Oe(e),i=Oe(t),n=Number(e),r=Number(t);let o=0;if(l==="-")o=n-r;else if(l==="+")o=n+r;else if(l==="*")o=n*r;else if(l==="/")return o=n/r,Oe(o)>5?o.toFixed(2):o;return o.toFixed(Math.max(s,i))}var z={cloneDeep:fs,merge:(...l)=>Rt({},...l),equals:Fe,arrayEquals:bs,sum:us,rangeEach:ws,rangeSum:ms,rangeReduceIf:ps,deleteProperty:gs,numberCalc:U};class xs{constructor({len:e,height:t}){this._={},this.len=e,this.height=t}getHeight(e){if(this.isHide(e))return 0;const t=this.get(e);return t&&t.height?t.height:this.height}setHeight(e,t){const s=this.getOrNew(e);s.height=t}unhide(e){let t=e;for(;t>0&&(t-=1,this.isHide(t));)this.setHide(t,!1)}isHide(e){const t=this.get(e);return t&&t.hide}setHide(e,t){const s=this.getOrNew(e);t===!0?s.hide=!0:delete s.hide}setStyle(e,t){const s=this.getOrNew(e);s.style=t}sumHeight(e,t,s){return z.rangeSum(e,t,i=>s&&s.has(i)?0:this.getHeight(i))}totalHeight(){return this.sumHeight(0,this.len)}get(e){return this._[e]}getOrNew(e){return this._[e]=this._[e]||{cells:{}},this._[e]}getCell(e,t){const s=this.get(e);return s!==void 0&&s.cells!==void 0&&s.cells[t]!==void 0?s.cells[t]:null}getCellMerge(e,t){const s=this.getCell(e,t);return s&&s.merge?s.merge:[0,0]}getCellOrNew(e,t){const s=this.getOrNew(e);return s.cells[t]=s.cells[t]||{},s.cells[t]}setCell(e,t,s,i="all"){const n=this.getOrNew(e);i==="all"?n.cells[t]=s:i==="text"?(n.cells[t]=n.cells[t]||{},n.cells[t].text=s.text):i==="format"&&(n.cells[t]=n.cells[t]||{},n.cells[t].style=s.style,s.merge&&(n.cells[t].merge=s.merge))}setCellText(e,t,s){const i=this.getCellOrNew(e,t);i.editable!==!1&&(i.text=s)}copyPaste(e,t,s,i=!1,n=()=>{}){const{sri:r,sci:o,eri:c,eci:h}=e,d=t.sri,a=t.sci,f=t.eri,g=t.eci,[p,w]=e.size(),[x,b]=t.size();let k=!0,v=0;(f<r||g<o)&&(k=!1,f<r?v=x:v=b);for(let y=r;y<=c;y+=1)if(this._[y]){for(let S=o;S<=h;S+=1)if(this._[y].cells&&this._[y].cells[S])for(let R=d;R<=f;R+=p)for(let O=a;O<=g;O+=w){const F=R+(y-r),he=O+(S-o),V=z.cloneDeep(this._[y].cells[S]);if(i&&V&&V.text&&V.text.length>0){const{text:ae}=V;let de=O-a+(R-d)+2;if(k||(de-=v+1),ae[0]==="=")V.text=ae.replace(/[a-zA-Z]{1,3}\d+/g,j=>{let[fe,Qe]=[0,0];return r===d?fe=de-1:Qe=de-1,/^\d+$/.test(j)?j:se(j,fe,Qe)});else if(p<=1&&w>1&&(d>c||f<r)||w<=1&&p>1&&(a>h||g<o)||p<=1&&w<=1){const j=/[\\.\d]+$/.exec(ae);if(j!==null){const fe=Number(j[0])+de-1;V.text=ae.substring(0,j.index)+fe}}}this.setCell(F,he,V,s),n(F,he,V)}}}cutPaste(e,t){const s={};this.each(i=>{this.eachCells(i,n=>{let r=parseInt(i,10),o=parseInt(n,10);e.includes(i,n)&&(r=t.sri+(r-e.sri),o=t.sci+(o-e.sci)),s[r]=s[r]||{cells:{}},s[r].cells[o]=this._[i].cells[n]})}),this._=s}paste(e,t){if(e.length<=0)return;const{sri:s,sci:i}=t;e.forEach((n,r)=>{const o=s+r;n.forEach((c,h)=>{const d=i+h;this.setCellText(o,d,c)})})}insert(e,t=1){const s={};this.each((i,n)=>{let r=parseInt(i,10);r>=e&&(r+=t,this.eachCells(i,(o,c)=>{c.text&&c.text[0]==="="&&(c.text=c.text.replace(/[a-zA-Z]{1,3}\d+/g,h=>se(h,0,t,(d,a)=>a>=e)))})),s[r]=n}),this._=s,this.len+=t}delete(e,t){const s=t-e+1,i={};this.each((n,r)=>{const o=parseInt(n,10);o<e?i[o]=r:n>t&&(i[o-s]=r,this.eachCells(n,(c,h)=>{h.text&&h.text[0]==="="&&(h.text=h.text.replace(/[a-zA-Z]{1,3}\d+/g,d=>se(d,0,-s,(a,f)=>f>t)))}))}),this._=i,this.len-=s}insertColumn(e,t=1){this.each((s,i)=>{const n={};this.eachCells(s,(r,o)=>{let c=parseInt(r,10);c>=e&&(c+=t,o.text&&o.text[0]==="="&&(o.text=o.text.replace(/[a-zA-Z]{1,3}\d+/g,h=>se(h,t,0,d=>d>=e)))),n[c]=o}),i.cells=n})}deleteColumn(e,t){const s=t-e+1;this.each((i,n)=>{const r={};this.eachCells(i,(o,c)=>{const h=parseInt(o,10);h<e?r[h]=c:h>t&&(r[h-s]=c,c.text&&c.text[0]==="="&&(c.text=c.text.replace(/[a-zA-Z]{1,3}\d+/g,d=>se(d,-s,0,a=>a>t))))}),n.cells=r})}deleteCells(e,t="all"){e.each((s,i)=>{this.deleteCell(s,i,t)})}deleteCell(e,t,s="all"){const i=this.get(e);if(i!==null){const n=this.getCell(e,t);n!==null&&n.editable!==!1&&(s==="all"?delete i.cells[t]:s==="text"?(n.text&&delete n.text,n.value&&delete n.value):s==="format"?(n.style!==void 0&&delete n.style,n.merge&&delete n.merge):s==="merge"&&n.merge&&delete n.merge)}}maxCell(){const e=Object.keys(this._),t=e[e.length-1],s=this._[t];if(s){const{cells:i}=s,n=Object.keys(i),r=n[n.length-1];return[parseInt(t,10),parseInt(r,10)]}return[0,0]}each(e){Object.entries(this._).forEach(([t,s])=>{e(t,s)})}eachCells(e,t){this._[e]&&this._[e].cells&&Object.entries(this._[e].cells).forEach(([s,i])=>{t(s,i)})}setData(e){e.len&&(this.len=e.len,delete e.len),this._=e}getData(){const{len:e}=this;return Object.assign({len:e},this._)}}class vs{constructor({len:e,width:t,indexWidth:s,minWidth:i}){this._={},this.len=e,this.width=t,this.indexWidth=s,this.minWidth=i}setData(e){e.len&&(this.len=e.len,delete e.len),this._=e}getData(){const{len:e}=this;return Object.assign({len:e},this._)}getWidth(e){if(this.isHide(e))return 0;const t=this._[e];return t&&t.width?t.width:this.width}getOrNew(e){return this._[e]=this._[e]||{},this._[e]}setWidth(e,t){const s=this.getOrNew(e);s.width=t}unhide(e){let t=e;for(;t>0&&(t-=1,this.isHide(t));)this.setHide(t,!1)}isHide(e){const t=this._[e];return t&&t.hide}setHide(e,t){const s=this.getOrNew(e);t===!0?s.hide=!0:delete s.hide}setStyle(e,t){const s=this.getOrNew(e);s.style=t}sumWidth(e,t){return z.rangeSum(e,t,s=>this.getWidth(s))}totalWidth(){return this.sumWidth(0,this.len)}}var ys={toolbar:{undo:"Undo",redo:"Redo",print:"Print",paintformat:"Paint format",clearformat:"Clear format",format:"Format",fontName:"Font",fontSize:"Font size",fontBold:"Font bold",fontItalic:"Font italic",underline:"Underline",strike:"Strike",color:"Text color",bgcolor:"Fill color",border:"Borders",merge:"Merge cells",align:"Horizontal align",valign:"Vertical align",textwrap:"Text wrapping",freeze:"Freeze cell",autofilter:"Filter",formula:"Functions",more:"More"},contextmenu:{copy:"Copy",cut:"Cut",paste:"Paste",pasteValue:"Paste values only",pasteFormat:"Paste format only",hide:"Hide",insertRow:"Insert row",insertColumn:"Insert column",deleteSheet:"Delete",deleteRow:"Delete row",deleteColumn:"Delete column",deleteCell:"Delete cell",deleteCellText:"Delete cell text",validation:"Data validations",cellprintable:"Enable export",cellnonprintable:"Disable export",celleditable:"Enable editing",cellnoneditable:"Disable editing"},print:{size:"Paper size",orientation:"Page orientation",orientations:["Landscape","Portrait"]},format:{normal:"Normal",text:"Plain Text",number:"Number",percent:"Percent",rmb:"RMB",usd:"USD",eur:"EUR",date:"Date",time:"Time",datetime:"Date time",duration:"Duration"},formula:{sum:"Sum",average:"Average",max:"Max",min:"Min",_if:"IF",and:"AND",or:"OR",concat:"Concat"},validation:{required:"it must be required",notMatch:"it not match its validation rule",between:"it is between {} and {}",notBetween:"it is not between {} and {}",notIn:"it is not in list",equal:"it equal to {}",notEqual:"it not equal to {}",lessThan:"it less than {}",lessThanEqual:"it less than or equal to {}",greaterThan:"it greater than {}",greaterThanEqual:"it greater than or equal to {}"},error:{pasteForMergedCell:"Unable to do this for merged cells"},calendar:{weeks:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"]},button:{next:"Next",cancel:"Cancel",remove:"Remove",save:"Save",ok:"OK"},sort:{desc:"Sort Z -> A",asc:"Sort A -> Z"},filter:{empty:"empty"},dataValidation:{mode:"Mode",range:"Cell Range",criteria:"Criteria",modeType:{cell:"Cell",column:"Colun",row:"Row"},type:{list:"List",number:"Number",date:"Date",phone:"Phone",email:"Email"},operator:{be:"between",nbe:"not betwwen",lt:"less than",lte:"less than or equal to",gt:"greater than",gte:"greater than or equal to",eq:"equal to",neq:"not equal to"}}};let Me=["en"];const Ft={en:ys};function ot(l,e){if(e)for(const t of Me){if(!e[t])break;let s=e[t];const i=l.match(/(?:\\.|[^.])+/g);for(let n=0;n<i.length;n+=1){const r=i[n],o=s[r];if(!o)break;if(n===i.length-1)return o;s=o}}}function T(l){let e=ot(l,Ft);return!e&&window&&window.x_spreadsheet&&window.x_spreadsheet.$messages&&(e=ot(l,window.x_spreadsheet.$messages)),e||""}function E(l){return()=>T(l)}function Mt(l,e,t=!1){t?Me=[l]:Me.unshift(l),e&&(Ft[l]=e)}const ct={phone:/^[1-9]\d{10}$/,email:/w+([-+.]w+)*@w+([-.]w+)*.w+([-.]w+)*/};function M(l,e,...t){let s="";return l||(s=T(`validation.${e}`,...t)),[l,s]}class Ht{constructor(e,t,s,i){this.required=t,this.value=s,this.type=e,this.operator=i,this.message=""}parseValue(e){const{type:t}=this;return t==="date"?new Date(e):t==="number"?Number(e):e}equals(e){let t=this.type===e.type&&this.required===e.required&&this.operator===e.operator;return t&&(Array.isArray(this.value)?t=z.arrayEquals(this.value,e.value):t=this.value===e.value),t}values(){return this.value.split(",")}validate(e){const{required:t,operator:s,value:i,type:n}=this;if(t&&/^\s*$/.test(e))return M(!1,"required");if(/^\s*$/.test(e))return[!0];if(ct[n]&&!ct[n].test(e))return M(!1,"notMatch");if(n==="list")return M(this.values().includes(e),"notIn");if(s){const r=this.parseValue(e);if(s==="be"){const[o,c]=i;return M(r>=this.parseValue(o)&&r<=this.parseValue(c),"between",o,c)}if(s==="nbe"){const[o,c]=i;return M(r<this.parseValue(o)||r>this.parseValue(c),"notBetween",o,c)}if(s==="eq")return M(r===this.parseValue(i),"equal",i);if(s==="neq")return M(r!==this.parseValue(i),"notEqual",i);if(s==="lt")return M(r<this.parseValue(i),"lessThan",i);if(s==="lte")return M(r<=this.parseValue(i),"lessThanEqual",i);if(s==="gt")return M(r>this.parseValue(i),"greaterThan",i);if(s==="gte")return M(r>=this.parseValue(i),"greaterThanEqual",i)}return[!0]}}class ye{constructor(e,t,s){this.refs=t,this.mode=e,this.validator=s}includes(e,t){const{refs:s}=this;for(let i=0;i<s.length;i+=1)if($.valueOf(s[i]).includes(e,t))return!0;return!1}addRef(e){this.remove($.valueOf(e)),this.refs.push(e)}remove(e){const t=[];this.refs.forEach(s=>{const i=$.valueOf(s);i.intersects(e)?i.difference(e).forEach(r=>t.push(r.toString())):t.push(s)}),this.refs=t}getData(){const{refs:e,mode:t,validator:s}=this,{type:i,required:n,operator:r,value:o}=s;return{refs:e,mode:t,type:i,required:n,operator:r,value:o}}static valueOf({refs:e,mode:t,type:s,required:i,operator:n,value:r}){return new ye(t,e,new Ht(s,i,r,n))}}class ks{constructor(){this._=[],this.errors=new Map}getError(e,t){return this.errors.get(`${e}_${t}`)}validate(e,t,s){const i=this.get(e,t),n=`${e}_${t}`,{errors:r}=this;if(i!==null){const[o,c]=i.validator.validate(s);o?r.delete(n):r.set(n,c)}else r.delete(n);return!0}add(e,t,{type:s,required:i,value:n,operator:r}){const o=new Ht(s,i,n,r),c=this.getByValidator(o);c!==null?c.addRef(t):this._.push(new ye(e,[t],o))}getByValidator(e){for(let t=0;t<this._.length;t+=1){const s=this._[t];if(s.validator.equals(e))return s}return null}get(e,t){for(let s=0;s<this._.length;s+=1){const i=this._[s];if(i.includes(e,t))return i}return null}remove(e){this.each(t=>{t.remove(e)})}each(e){this._.forEach(t=>e(t))}getData(){return this._.filter(e=>e.refs.length>0).map(e=>e.getData())}setData(e){this._=e.map(t=>ye.valueOf(t))}}const Cs={mode:"edit",view:{height:()=>document.documentElement.clientHeight,width:()=>document.documentElement.clientWidth},showGrid:!0,showToolbar:!0,showContextmenu:!0,showBottomBar:!0,row:{len:100,height:25},col:{len:26,width:100,indexWidth:60,minWidth:60},style:{bgcolor:"#ffffff",align:"left",valign:"middle",textwrap:!1,strike:!1,underline:!1,color:"#0a0a0a",font:{name:"Arial",size:10,bold:!1,italic:!1},format:"normal"}},Es=41,Ss=41,ht=(l,e)=>Object.prototype.hasOwnProperty.call(l,e);function at(l,e,t=()=>{}){const{merges:s}=this,i=e.clone(),[n,r]=l.size(),[o,c]=e.size();return n>o&&(i.eri=e.sri+n-1),r>c&&(i.eci=e.sci+r-1),s.intersects(i)?(t(T("error.pasteForMergedCell")),!1):!0}function dt(l,e,t,s=!1){const{rows:i,merges:n}=this;(t==="all"||t==="format")&&(i.deleteCells(e,t),n.deleteWithin(e)),i.copyPaste(l,e,t,s,(r,o,c)=>{if(c&&c.merge){const[h,d]=c.merge;if(h<=0&&d<=0)return;n.add(new $(r,o,r+h,o+d))}})}function $s(l,e){const{clipboard:t,rows:s,merges:i}=this;s.cutPaste(l,e),i.move(l,e.sri-l.sri,e.sci-l.sci),t.clear()}function Z(l,e,t){const{styles:s,rows:i}=this,n=i.getCellOrNew(l,e);let r={};n.style!==void 0&&(r=z.cloneDeep(s[n.style])),r=z.merge(r,{border:t}),n.style=this.addStyle(r)}function Ts({mode:l,style:e,color:t}){const{styles:s,selector:i,rows:n}=this,{sri:r,sci:o,eri:c,eci:h}=i.range,d=!this.isSignleSelected();if(!(!d&&(l==="inside"||l==="horizontal"||l==="vertical"))){if(l==="outside"&&!d)Z.call(this,r,o,{top:[e,t],bottom:[e,t],left:[e,t],right:[e,t]});else if(l==="none")i.range.each((a,f)=>{const g=n.getCell(a,f);if(g&&g.style!==void 0){const p=z.cloneDeep(s[g.style]);delete p.border,g.style=this.addStyle(p)}});else if(l==="all"||l==="inside"||l==="outside"||l==="horizontal"||l==="vertical"){const a=[];for(let f=r;f<=c;f+=1)for(let g=o;g<=h;g+=1){const p=[];for(let S=0;S<a.length;S+=1){const[R,O,F,he]=a[S];if(f===R+F+1&&p.push(S),R<=f&&f<=R+F&&g===O){g+=he+1;break}}if(p.forEach(S=>a.splice(S,1)),g>h)break;const w=n.getCell(f,g);let[x,b]=[0,0];w&&w.merge&&([x,b]=w.merge,a.push([f,g,x,b]));const k=x>0&&f+x===c,v=b>0&&g+b===h;let y={};l==="all"?y={bottom:[e,t],top:[e,t],left:[e,t],right:[e,t]}:l==="inside"?(!v&&g<h&&(y.right=[e,t]),!k&&f<c&&(y.bottom=[e,t])):l==="horizontal"?!k&&f<c&&(y.bottom=[e,t]):l==="vertical"?!v&&g<h&&(y.right=[e,t]):l==="outside"&&d&&(r===f&&(y.top=[e,t]),(k||c===f)&&(y.bottom=[e,t]),o===g&&(y.left=[e,t]),(v||h===g)&&(y.right=[e,t])),Object.keys(y).length>0&&Z.call(this,f,g,y),g+=b}}else if(l==="top"||l==="bottom")for(let a=o;a<=h;a+=1)l==="top"&&(Z.call(this,r,a,{top:[e,t]}),a+=n.getCellMerge(r,a)[1]),l==="bottom"&&(Z.call(this,c,a,{bottom:[e,t]}),a+=n.getCellMerge(c,a)[1]);else if(l==="left"||l==="right")for(let a=r;a<=c;a+=1)l==="left"&&(Z.call(this,a,o,{left:[e,t]}),a+=n.getCellMerge(a,o)[0]),l==="right"&&(Z.call(this,a,h,{right:[e,t]}),a+=n.getCellMerge(a,h)[0])}}function Ds(l,e){const{rows:t}=this,s=this.freezeTotalHeight();let i=t.height;s+t.height<l&&(i-=e);const n=this.exceptRowSet;let r=0,o=i,{height:c}=t;for(;r<t.len&&!(o>l);r+=1)n.has(r)||(c=t.getHeight(r),o+=c);return o-=c,o<=0?{ri:-1,top:0,height:c}:{ri:r-1,top:o,height:c}}function Os(l,e){const{cols:t}=this,s=this.freezeTotalWidth();let i=t.indexWidth;s+t.indexWidth<l&&(i-=e);const[n,r,o]=z.rangeReduceIf(0,t.len,i,t.indexWidth,l,c=>t.getWidth(c));return r<=0?{ci:-1,left:0,width:t.indexWidth}:{ci:n-1,left:r,width:o}}class zs{constructor(e,t){this.settings=z.merge(Cs,t||{}),this.name=e||"sheet",this.freeze=[0,0],this.styles=[],this.merges=new qe,this.rows=new xs(this.settings.row),this.cols=new vs(this.settings.col),this.validations=new ks,this.hyperlinks={},this.comments={},this.selector=new os,this.scroll=new cs,this.history=new hs,this.clipboard=new as,this.autoFilter=new ds,this.change=()=>{},this.exceptRowSet=new Set,this.sortedRowMap=new Map,this.unsortedRowMap=new Map}addValidation(e,t,s){this.changeData(()=>{this.validations.add(e,t,s)})}removeValidation(){const{range:e}=this.selector;this.changeData(()=>{this.validations.remove(e)})}getSelectedValidator(){const{ri:e,ci:t}=this.selector,s=this.validations.get(e,t);return s?s.validator:null}getSelectedValidation(){const{ri:e,ci:t,range:s}=this.selector,i=this.validations.get(e,t),n={ref:s.toString()};return i!==null&&(n.mode=i.mode,n.validator=i.validator),n}canUndo(){return this.history.canUndo()}canRedo(){return this.history.canRedo()}undo(){this.history.undo(this.getData(),e=>{this.setData(e)})}redo(){this.history.redo(this.getData(),e=>{this.setData(e)})}copy(){this.clipboard.copy(this.selector.range)}copyToSystemClipboard(){if(navigator.clipboard===void 0)return;let e="";const t=this.rows.getData();for(let s=this.selector.range.sri;s<=this.selector.range.eri;s+=1){if(ht(t,s)){for(let i=this.selector.range.sci;i<=this.selector.range.eci;i+=1)if(i>this.selector.range.sci&&(e+="	"),ht(t[s].cells,i)){const n=String(t[s].cells[i].text);n.indexOf(`
`)===-1&&n.indexOf("	")===-1&&n.indexOf('"')===-1?e+=n:e+=`"${n}"`}}else for(let i=this.selector.range.sci;i<=this.selector.range.eci;i+=1)e+="	";e+=`
`}navigator.clipboard.writeText(e).then(()=>{},s=>{console.log("text copy to the system clipboard error  ",e,s)})}cut(){this.clipboard.cut(this.selector.range)}paste(e="all",t=()=>{}){const{clipboard:s,selector:i}=this;return s.isClear()||!at.call(this,s.range,i.range,t)?!1:(this.changeData(()=>{s.isCopy()?dt.call(this,s.range,i.range,e):s.isCut()&&$s.call(this,s.range,i.range)}),!0)}pasteFromText(e){const t=e.split(`\r
`).map(n=>n.replace(/"/g,"").split("	"));t.length>0&&(t.length-=1);const{rows:s,selector:i}=this;this.changeData(()=>{s.paste(t,i.range)})}autofill(e,t,s=()=>{}){const i=this.selector.range;return at.call(this,i,e,s)?(this.changeData(()=>{dt.call(this,i,e,t,!0)}),!0):!1}clearClipboard(){this.clipboard.clear()}calSelectedRangeByEnd(e,t){const{selector:s,rows:i,cols:n,merges:r}=this;let{sri:o,sci:c,eri:h,eci:d}=s.range;const a=s.ri,f=s.ci;let[g,p]=[e,t];return e<0&&(g=i.len-1),t<0&&(p=n.len-1),g>a?[o,h]=[a,g]:[o,h]=[g,a],p>f?[c,d]=[f,p]:[c,d]=[p,f],s.range=r.union(new $(o,c,h,d)),s.range=r.union(s.range),s.range}calSelectedRangeByStart(e,t){const{selector:s,rows:i,cols:n,merges:r}=this;let o=r.getFirstIncludes(e,t);return o===null&&(o=new $(e,t,e,t),e===-1&&(o.sri=0,o.eri=i.len-1),t===-1&&(o.sci=0,o.eci=n.len-1)),s.range=o,o}setSelectedCellAttr(e,t){this.changeData(()=>{const{selector:s,styles:i,rows:n}=this;if(e==="merge")t?this.merge():this.unmerge();else if(e==="border")Ts.call(this,t);else if(e==="formula"){const{ri:r,ci:o,range:c}=s;if(s.multiple()){const[h,d]=s.size(),{sri:a,sci:f,eri:g,eci:p}=c;if(h>1)for(let w=f;w<=p;w+=1){const x=n.getCellOrNew(g+1,w);x.text=`=${t}(${P(w,a)}:${P(w,g)})`}else if(d>1){const w=n.getCellOrNew(r,p+1);w.text=`=${t}(${P(f,r)}:${P(p,r)})`}}else{const h=n.getCellOrNew(r,o);h.text=`=${t}()`}}else s.range.each((r,o)=>{const c=n.getCellOrNew(r,o);let h={};if(c.style!==void 0&&(h=z.cloneDeep(i[c.style])),e==="format")h.format=t,c.style=this.addStyle(h);else if(e==="font-bold"||e==="font-italic"||e==="font-name"||e==="font-size"){const d={};d[e.split("-")[1]]=t,h.font=Object.assign(h.font||{},d),c.style=this.addStyle(h)}else e==="strike"||e==="textwrap"||e==="underline"||e==="align"||e==="valign"||e==="color"||e==="bgcolor"?(h[e]=t,c.style=this.addStyle(h)):c[e]=t})})}setSelectedCellText(e,t="input"){const{autoFilter:s,selector:i,rows:n}=this,{ri:r,ci:o}=i;let c=r;this.unsortedRowMap.has(r)&&(c=this.unsortedRowMap.get(r));const h=n.getCell(c,o),d=h?h.text:"";if(this.setCellText(c,o,e,t),s.active()){const a=s.getFilter(o);if(a){const f=a.value.findIndex(g=>g===d);f>=0&&a.value.splice(f,1,e)}}}getSelectedCell(){const{ri:e,ci:t}=this.selector;let s=e;return this.unsortedRowMap.has(e)&&(s=this.unsortedRowMap.get(e)),this.rows.getCell(s,t)}xyInSelectedRect(e,t){const{left:s,top:i,width:n,height:r}=this.getSelectedRect(),o=e-this.cols.indexWidth,c=t-this.rows.height;return o>s&&o<s+n&&c>i&&c<i+r}getSelectedRect(){return this.getRect(this.selector.range)}getClipboardRect(){const{clipboard:e}=this;return e.isClear()?{left:-100,top:-100}:this.getRect(e.range)}getRect(e){const{scroll:t,rows:s,cols:i,exceptRowSet:n}=this,{sri:r,sci:o,eri:c,eci:h}=e;if(r<0&&o<0)return{left:0,l:0,top:0,t:0,scroll:t};const d=i.sumWidth(0,o),a=s.sumHeight(0,r,n),f=s.sumHeight(r,c+1,n),g=i.sumWidth(o,h+1);let p=d-t.x,w=a-t.y;const x=this.freezeTotalHeight(),b=this.freezeTotalWidth();return b>0&&b>d&&(p=d),x>0&&x>a&&(w=a),{l:d,t:a,left:p,top:w,height:f,width:g,scroll:t}}getCellRectByXY(e,t){const{scroll:s,merges:i,rows:n,cols:r}=this;let{ri:o,top:c,height:h}=Ds.call(this,t,s.y),{ci:d,left:a,width:f}=Os.call(this,e,s.x);if(d===-1&&(f=r.totalWidth()),o===-1&&(h=n.totalHeight()),o>=0||d>=0){const g=i.getFirstIncludes(o,d);g&&(o=g.sri,d=g.sci,{left:a,top:c,width:f,height:h}=this.cellRect(o,d))}return{ri:o,ci:d,left:a,top:c,width:f,height:h}}isSignleSelected(){const{sri:e,sci:t,eri:s,eci:i}=this.selector.range,n=this.getCell(e,t);if(n&&n.merge){const[r,o]=n.merge;if(e+r===s&&t+o===i)return!0}return!this.selector.multiple()}canUnmerge(){const{sri:e,sci:t,eri:s,eci:i}=this.selector.range,n=this.getCell(e,t);if(n&&n.merge){const[r,o]=n.merge;if(e+r===s&&t+o===i)return!0}return!1}merge(){const{selector:e,rows:t}=this;if(this.isSignleSelected())return;const[s,i]=e.size();if(s>1||i>1){const{sri:n,sci:r}=e.range;this.changeData(()=>{const o=t.getCellOrNew(n,r);o.merge=[s-1,i-1],this.merges.add(e.range),this.rows.deleteCells(e.range),this.rows.setCell(n,r,o)})}}unmerge(){const{selector:e}=this;if(!this.isSignleSelected())return;const{sri:t,sci:s}=e.range;this.changeData(()=>{this.rows.deleteCell(t,s,"merge"),this.merges.deleteWithin(e.range)})}canAutofilter(){return!this.autoFilter.active()}autofilter(){const{autoFilter:e,selector:t}=this;this.changeData(()=>{e.active()?(e.clear(),this.exceptRowSet=new Set,this.sortedRowMap=new Map,this.unsortedRowMap=new Map):e.ref=t.range.toString()})}setAutoFilter(e,t,s,i){const{autoFilter:n}=this;n.addFilter(e,s,i),n.setSort(e,t),this.resetAutoFilter()}resetAutoFilter(){const{autoFilter:e,rows:t}=this;if(!e.active())return;const{sort:s}=e,{rset:i,fset:n}=e.filteredRows((c,h)=>t.getCell(c,h)),r=Array.from(n),o=Array.from(n);s&&r.sort((c,h)=>s.order==="asc"?c-h:s.order==="desc"?h-c:0),this.exceptRowSet=i,this.sortedRowMap=new Map,this.unsortedRowMap=new Map,r.forEach((c,h)=>{this.sortedRowMap.set(o[h],c),this.unsortedRowMap.set(c,o[h])})}deleteCell(e="all"){const{selector:t}=this;this.changeData(()=>{this.rows.deleteCells(t.range,e),(e==="all"||e==="format")&&this.merges.deleteWithin(t.range)})}insert(e,t=1){this.changeData(()=>{const{sri:s,sci:i}=this.selector.range,{rows:n,merges:r,cols:o}=this;let c=s;e==="row"?n.insert(s,t):e==="column"&&(n.insertColumn(i,t),c=i,o.len+=1),r.shift(e,c,t,(h,d,a,f)=>{const g=n.getCell(h,d);g.merge[0]+=a,g.merge[1]+=f})})}delete(e){this.changeData(()=>{const{rows:t,merges:s,selector:i,cols:n}=this,{range:r}=i,{sri:o,sci:c,eri:h,eci:d}=i.range,[a,f]=i.range.size();let g=o,p=a;e==="row"?t.delete(o,h):e==="column"&&(t.deleteColumn(c,d),g=r.sci,p=f,n.len-=1),s.shift(e,g,-p,(w,x,b,k)=>{const v=t.getCell(w,x);v.merge[0]+=b,v.merge[1]+=k,v.merge[0]===0&&v.merge[1]===0&&delete v.merge})})}scrollx(e,t){const{scroll:s,freeze:i,cols:n}=this,[,r]=i,[o,c,h]=z.rangeReduceIf(r,n.len,0,0,e,a=>n.getWidth(a));let d=c;e>0&&(d+=h),s.x!==d&&(s.ci=e>0?o:0,s.x=d,t())}scrolly(e,t){const{scroll:s,freeze:i,rows:n}=this,[r]=i,[o,c,h]=z.rangeReduceIf(r,n.len,0,0,e,a=>n.getHeight(a));let d=c;e>0&&(d+=h),s.y!==d&&(s.ri=e>0?o:0,s.y=d,t())}cellRect(e,t){const{rows:s,cols:i}=this,n=i.sumWidth(0,t),r=s.sumHeight(0,e),o=s.getCell(e,t);let c=i.getWidth(t),h=s.getHeight(e);if(o!==null&&o.merge){const[d,a]=o.merge;if(d>0)for(let f=1;f<=d;f+=1)h+=s.getHeight(e+f);if(a>0)for(let f=1;f<=a;f+=1)c+=i.getWidth(t+f)}return{left:n,top:r,width:c,height:h,cell:o}}getCell(e,t){return this.rows.getCell(e,t)}getCellTextOrDefault(e,t){const s=this.getCell(e,t);return s&&s.text?s.text:""}getCellStyle(e,t){const s=this.getCell(e,t);return s&&s.style!==void 0?this.styles[s.style]:null}getCellStyleOrDefault(e,t){const{styles:s,rows:i}=this,n=i.getCell(e,t),r=n&&n.style!==void 0?s[n.style]:{};return z.merge(this.defaultStyle(),r)}getSelectedCellStyle(){const{ri:e,ci:t}=this.selector;return this.getCellStyleOrDefault(e,t)}setCellText(e,t,s,i){const{rows:n,history:r,validations:o}=this;i==="finished"?(n.setCellText(e,t,""),r.add(this.getData()),n.setCellText(e,t,s)):(n.setCellText(e,t,s),this.change(this.getData())),o.validate(e,t,s)}freezeIsActive(){const[e,t]=this.freeze;return e>0||t>0}setFreeze(e,t){this.changeData(()=>{this.freeze=[e,t]})}freezeTotalWidth(){return this.cols.sumWidth(0,this.freeze[1])}freezeTotalHeight(){return this.rows.sumHeight(0,this.freeze[0])}setRowHeight(e,t){this.changeData(()=>{this.rows.setHeight(e,t)})}setColWidth(e,t){this.changeData(()=>{this.cols.setWidth(e,t)})}viewHeight(){const{view:e,showToolbar:t,showBottomBar:s}=this.settings;let i=e.height();return s&&(i-=Ss),t&&(i-=Es),i}viewWidth(){return this.settings.view.width()}freezeViewRange(){const[e,t]=this.freeze;return new $(0,0,e-1,t-1,this.freezeTotalWidth(),this.freezeTotalHeight())}contentRange(){const{rows:e,cols:t}=this,[s,i]=e.maxCell(),n=e.sumHeight(0,s+1),r=t.sumWidth(0,i+1);return new $(0,0,s,i,r,n)}exceptRowTotalHeight(e,t){const{exceptRowSet:s,rows:i}=this,n=Array.from(s);let r=0;return n.forEach(o=>{(o<e||o>t)&&(r+=i.getHeight(o))}),r}viewRange(){const{scroll:e,rows:t,cols:s,freeze:i,exceptRowSet:n}=this;let{ri:r,ci:o}=e;r<=0&&([r]=i),o<=0&&([,o]=i);let[c,h]=[0,0],[d,a]=[t.len,s.len];for(let f=r;f<t.len&&(n.has(f)||(h+=t.getHeight(f),d=f),!(h>this.viewHeight()));f+=1);for(let f=o;f<s.len&&(c+=s.getWidth(f),a=f,!(c>this.viewWidth()));f+=1);return new $(r,o,d,a,c,h)}eachMergesInView(e,t){this.merges.filterIntersects(e).forEach(s=>t(s))}hideRowsOrCols(){const{rows:e,cols:t,selector:s}=this,[i,n]=s.size(),{sri:r,sci:o,eri:c,eci:h}=s.range;if(i===e.len)for(let d=o;d<=h;d+=1)t.setHide(d,!0);else if(n===t.len)for(let d=r;d<=c;d+=1)e.setHide(d,!0)}unhideRowsOrCols(e,t){this[`${e}s`].unhide(t)}rowEach(e,t,s){let i=0;const{rows:n}=this,r=this.exceptRowSet,o=[...r];let c=0;for(let h=0;h<o.length;h+=1)o[h]<e&&(c+=1);for(let h=e+c;h<=t+c;h+=1)if(r.has(h))c+=1;else{const d=n.getHeight(h);if(d>0&&(s(h,i,d),i+=d,i>this.viewHeight()))break}}colEach(e,t,s){let i=0;const{cols:n}=this;for(let r=e;r<=t;r+=1){const o=n.getWidth(r);if(o>0&&(s(r,i,o),i+=o,i>this.viewWidth()))break}}defaultStyle(){return this.settings.style}addStyle(e){const{styles:t}=this;for(let s=0;s<t.length;s+=1){const i=t[s];if(z.equals(i,e))return s}return t.push(e),t.length-1}changeData(e){this.history.add(this.getData()),e(),this.change(this.getData())}setData(e){return Object.keys(e).forEach(t=>{if(t==="merges"||t==="rows"||t==="cols"||t==="validations")this[t].setData(e[t]);else if(t==="freeze"){const[s,i]=L(e[t]);this.freeze=[i,s]}else t==="autofilter"?this.autoFilter.setData(e[t]):e[t]!==void 0&&(this[t]=e[t])}),this}getData(){const{name:e,freeze:t,styles:s,merges:i,rows:n,cols:r,validations:o,autoFilter:c}=this;return{name:e,freeze:P(t[1],t[0]),styles:s,merges:i.getData(),rows:n.getData(),cols:r.getData(),validations:o.getData(),autofilter:c.getData()}}}function I(l,e,t){l.addEventListener(e,t)}function ke(l,e,t){l.removeEventListener(e,t)}function te(l){l.xclickoutside&&(ke(window.document.body,"click",l.xclickoutside),delete l.xclickoutside)}function re(l,e){l.xclickoutside=t=>{t.detail===2||l.contains(t.target)||(e?e(l):(l.hide(),te(l)))},I(window.document.body,"click",l.xclickoutside)}function Wt(l,e,t){I(l,"mousemove",e);const s=l;s.xEvtUp=i=>{ke(l,"mousemove",e),ke(l,"mouseup",l.xEvtUp),t(i)},I(l,"mouseup",l.xEvtUp)}function ft(l,e,t,s){let i="";Math.abs(l)>Math.abs(e)?(i=l>0?"right":"left",s(i,l,t)):(i=e>0?"down":"up",s(i,e,t))}function As(l,{move:e,end:t}){let s=0,i=0;I(l,"touchstart",n=>{const{pageX:r,pageY:o}=n.touches[0];s=r,i=o}),I(l,"touchmove",n=>{if(!e)return;const{pageX:r,pageY:o}=n.changedTouches[0],c=r-s,h=o-i;(Math.abs(c)>10||Math.abs(h)>10)&&(ft(c,h,n,e),s=r,i=o),n.preventDefault()}),I(l,"touchend",n=>{if(!t)return;const{pageX:r,pageY:o}=n.changedTouches[0],c=r-s,h=o-i;ft(c,h,n,t)})}function Is(){const l=new Map;function e(r,o){const c=()=>{const d=l.get(r);return Array.isArray(d)&&d.push(o)||!1},h=()=>l.set(r,[].concat(o));return l.has(r)&&c()||h()}function t(r,o){const c=()=>{const h=l.get(r);for(const d of h)d.call(null,...o)};return l.has(r)&&c()}function s(r,o){const c=()=>{const h=l.get(r),d=h.indexOf(o);return d>=0&&h.splice(d,1)&&l.get(r).length===0&&l.delete(r)};return l.has(r)&&c()}function i(r,o){const c=(...h)=>{o.call(null,...h),s(r,c)};return e(r,c)}function n(){l.clear()}return{get current(){return l},on:e,once:i,fire:t,removeListener:s,removeAllListeners:n}}const m="x-spreadsheet";class ut{constructor(e=!1,t){this.moving=!1,this.vertical=e,this.el=u("div",`${m}-resizer ${e?"vertical":"horizontal"}`).children(this.unhideHoverEl=u("div",`${m}-resizer-hover`).on("dblclick.stop",s=>this.mousedblclickHandler(s)).css("position","absolute").hide(),this.hoverEl=u("div",`${m}-resizer-hover`).on("mousedown.stop",s=>this.mousedownHandler(s)),this.lineEl=u("div",`${m}-resizer-line`).hide()).hide(),this.cRect=null,this.finishedFn=null,this.minDistance=t,this.unhideFn=()=>{}}showUnhide(e){this.unhideIndex=e,this.unhideHoverEl.show()}hideUnhide(){this.unhideHoverEl.hide()}show(e,t){const{moving:s,vertical:i,hoverEl:n,lineEl:r,el:o,unhideHoverEl:c}=this;if(s)return;this.cRect=e;const{left:h,top:d,width:a,height:f}=e;o.offset({left:i?h+a-5:h,top:i?d:d+f-5}).show(),n.offset({width:i?5:a,height:i?f:5}),r.offset({width:i?0:t.width,height:i?t.height:0}),c.offset({left:i?5-a:h,top:i?d:5-f,width:i?5:a,height:i?f:5})}hide(){this.el.offset({left:0,top:0}).hide(),this.hideUnhide()}mousedblclickHandler(){this.unhideIndex&&this.unhideFn(this.unhideIndex)}mousedownHandler(e){let t=e;const{el:s,lineEl:i,cRect:n,vertical:r,minDistance:o}=this;let c=r?n.width:n.height;i.show(),Wt(window,h=>{this.moving=!0,t!==null&&h.buttons===1&&(r?(c+=h.movementX,c>o&&s.css("left",`${n.left+c}px`)):(c+=h.movementY,c>o&&s.css("top",`${n.top+c}px`)),t=h)},()=>{t=null,i.hide(),this.moving=!1,this.hide(),this.finishedFn&&(c<o&&(c=o),this.finishedFn(n,c))})}}class gt{constructor(e){this.vertical=e,this.moveFn=null,this.el=u("div",`${m}-scrollbar ${e?"vertical":"horizontal"}`).child(this.contentEl=u("div","")).on("mousemove.stop",()=>{}).on("scroll.stop",t=>{const{scrollTop:s,scrollLeft:i}=t.target;this.moveFn&&this.moveFn(this.vertical?s:i,t)})}move(e){return this.el.scroll(e),this}scroll(){return this.el.scroll()}set(e,t){const s=e-1;if(t>s){const i=this.vertical?"height":"width";this.el.css(i,`${s-15}px`).show(),this.contentEl.css(this.vertical?"width":"height","1px").css(i,`${t}px`)}else this.el.hide();return this}}const ue=2*2-1;let He=10;class ge{constructor(e=!1){this.useHideInput=e,this.inputChange=()=>{},this.cornerEl=u("div",`${m}-selector-corner`),this.areaEl=u("div",`${m}-selector-area`).child(this.cornerEl).hide(),this.clipboardEl=u("div",`${m}-selector-clipboard`).hide(),this.autofillEl=u("div",`${m}-selector-autofill`).hide(),this.el=u("div",`${m}-selector`).css("z-index",`${He}`).children(this.areaEl,this.clipboardEl,this.autofillEl).hide(),e&&(this.hideInput=u("input","").on("compositionend",t=>{this.inputChange(t.target.value)}),this.el.child(this.hideInputDiv=u("div","hide-input").child(this.hideInput)),this.el.child(this.hideInputDiv=u("div","hide-input").child(this.hideInput))),He+=1}setOffset(e){return this.el.offset(e).show(),this}hide(){return this.el.hide(),this}setAreaOffset(e){const{left:t,top:s,width:i,height:n}=e,r={width:i-ue+.8,height:n-ue+.8,left:t-.8,top:s-.8};this.areaEl.offset(r).show(),this.useHideInput&&(this.hideInputDiv.offset(r),this.hideInput.val("").focus())}setClipboardOffset(e){const{left:t,top:s,width:i,height:n}=e;this.clipboardEl.offset({left:t,top:s,width:i-5,height:n-5})}showAutofill(e){const{left:t,top:s,width:i,height:n}=e;this.autofillEl.offset({width:i-ue,height:n-ue,left:t,top:s}).show()}hideAutofill(){this.autofillEl.hide()}showClipboard(){this.clipboardEl.show()}hideClipboard(){this.clipboardEl.hide()}}function Le(l){const{data:e}=this,{left:t,top:s,width:i,height:n,scroll:r,l:o,t:c}=l,h=e.freezeTotalWidth(),d=e.freezeTotalHeight();let a=t-h;h>o&&(a-=r.x);let f=s-d;return d>c&&(f-=r.y),{left:a,top:f,width:i,height:n}}function je(l){const{data:e}=this,{left:t,width:s,height:i,l:n,t:r,scroll:o}=l,c=e.freezeTotalWidth();let h=t-c;return c>n&&(h-=o.x),{left:h,top:r,width:s,height:i}}function Ue(l){const{data:e}=this,{top:t,width:s,height:i,l:n,t:r,scroll:o}=l,c=e.freezeTotalHeight();let h=t-c;return c>r&&(h-=o.y),{left:n,top:h,width:s,height:i}}function We(l){const{br:e}=this;e.setAreaOffset(Le.call(this,l))}function Rs(l){const{tl:e}=this;e.setAreaOffset(l)}function Nt(l){const{t:e}=this;e.setAreaOffset(je.call(this,l))}function Pt(l){const{l:e}=this;e.setAreaOffset(Ue.call(this,l))}function _t(l){const{l:e}=this;e.setClipboardOffset(Ue.call(this,l))}function Ne(l){const{br:e}=this;e.setClipboardOffset(Le.call(this,l))}function Fs(l){const{tl:e}=this;e.setClipboardOffset(l)}function Vt(l){const{t:e}=this;e.setClipboardOffset(je.call(this,l))}function pt(l){We.call(this,l),Rs.call(this,l),Nt.call(this,l),Pt.call(this,l)}function mt(l){Ne.call(this,l),Fs.call(this,l),Vt.call(this,l),_t.call(this,l)}class Ms{constructor(e){this.inputChange=()=>{},this.data=e,this.br=new ge(!0),this.t=new ge,this.l=new ge,this.tl=new ge,this.br.inputChange=t=>{this.inputChange(t)},this.br.el.show(),this.offset=null,this.areaOffset=null,this.indexes=null,this.range=null,this.arange=null,this.el=u("div",`${m}-selectors`).children(this.tl.el,this.t.el,this.l.el,this.br.el).hide(),this.lastri=-1,this.lastci=-1,He+=1}resetData(e){this.data=e,this.range=e.selector.range,this.resetAreaOffset()}hide(){this.el.hide()}resetOffset(){const{data:e,tl:t,t:s,l:i,br:n}=this,r=e.freezeTotalHeight(),o=e.freezeTotalWidth();r>0||o>0?(t.setOffset({width:o,height:r}),s.setOffset({left:o,height:r}),i.setOffset({top:r,width:o}),n.setOffset({left:o,top:r})):(t.hide(),s.hide(),i.hide(),n.setOffset({left:0,top:0}))}resetAreaOffset(){const e=this.data.getSelectedRect(),t=this.data.getClipboardRect();pt.call(this,e),mt.call(this,t),this.resetOffset()}resetBRTAreaOffset(){const e=this.data.getSelectedRect(),t=this.data.getClipboardRect();We.call(this,e),Nt.call(this,e),Ne.call(this,t),Vt.call(this,t),this.resetOffset()}resetBRLAreaOffset(){const e=this.data.getSelectedRect(),t=this.data.getClipboardRect();We.call(this,e),Pt.call(this,e),Ne.call(this,t),_t.call(this,t),this.resetOffset()}set(e,t,s=!0){const{data:i}=this,n=i.calSelectedRangeByStart(e,t),{sri:r,sci:o}=n;if(s){let[c,h]=[e,t];e<0&&(c=0),t<0&&(h=0),i.selector.setIndexes(c,h),this.indexes=[c,h]}this.moveIndexes=[r,o],this.range=n,this.resetAreaOffset(),this.el.show()}setEnd(e,t,s=!0){const{data:i,lastri:n,lastci:r}=this;if(s){if(e===n&&t===r)return;this.lastri=e,this.lastci=t}this.range=i.calSelectedRangeByEnd(e,t),pt.call(this,this.data.getSelectedRect())}reset(){const{eri:e,eci:t}=this.data.selector.range;this.setEnd(e,t)}showAutofill(e,t){if(e===-1&&t===-1)return;const{sri:s,sci:i,eri:n,eci:r}=this.range,[o,c]=[e,t],h=s-e,d=i-t,a=n-e,f=r-t;if(d>0)this.arange=new $(s,c,n,i-1);else if(h>0)this.arange=new $(o,i,s-1,r);else if(f<0)this.arange=new $(s,r+1,n,c);else if(a<0)this.arange=new $(n+1,i,o,r);else{this.arange=null;return}if(this.arange!==null){const g=this.data.getRect(this.arange);g.width+=2,g.height+=2;const{br:p,l:w,t:x,tl:b}=this;p.showAutofill(Le.call(this,g)),w.showAutofill(Ue.call(this,g)),x.showAutofill(je.call(this,g)),b.showAutofill(g)}}hideAutofill(){["br","l","t","tl"].forEach(e=>{this[e].hideAutofill()})}showClipboard(){const e=this.data.getClipboardRect();mt.call(this,e),["br","l","t","tl"].forEach(t=>{this[t].showClipboard()})}hideClipboard(){["br","l","t","tl"].forEach(e=>{this[e].hideClipboard()})}}function Hs(l){l.preventDefault(),l.stopPropagation();const{filterItems:e}=this;e.length<=0||(this.itemIndex>=0&&e[this.itemIndex].toggle(),this.itemIndex-=1,this.itemIndex<0&&(this.itemIndex=e.length-1),e[this.itemIndex].toggle())}function Ws(l){l.stopPropagation();const{filterItems:e}=this;e.length<=0||(this.itemIndex>=0&&e[this.itemIndex].toggle(),this.itemIndex+=1,this.itemIndex>e.length-1&&(this.itemIndex=0),e[this.itemIndex].toggle())}function wt(l){l.preventDefault();const{filterItems:e}=this;e.length<=0||(l.stopPropagation(),this.itemIndex<0&&(this.itemIndex=0),e[this.itemIndex].el.click(),this.hide())}function Ns(l){const{keyCode:e}=l;switch(l.ctrlKey&&l.stopPropagation(),e){case 37:l.stopPropagation();break;case 38:Hs.call(this,l);break;case 39:l.stopPropagation();break;case 40:Ws.call(this,l);break;case 13:wt.call(this,l);break;case 9:wt.call(this,l);break;default:l.stopPropagation();break}}class Bt{constructor(e,t,s="200px"){this.filterItems=[],this.items=e,this.el=u("div",`${m}-suggest`).css("width",s).hide(),this.itemClick=t,this.itemIndex=-1}setOffset(e){this.el.cssRemoveKeys("top","bottom").offset(e)}hide(){const{el:e}=this;this.filterItems=[],this.itemIndex=-1,e.hide(),te(this.el.parent())}setItems(e){this.items=e}search(e){let{items:t}=this;if(/^\s*$/.test(e)||(t=t.filter(i=>(i.key||i).startsWith(e.toUpperCase()))),t=t.map(i=>{let{title:n}=i;n?typeof n=="function"&&(n=n()):n=i;const r=u("div",`${m}-item`).child(n).on("click.stop",()=>{this.itemClick(i),this.hide()});return i.label&&r.child(u("div","label").html(i.label)),r}),this.filterItems=t,t.length<=0)return;const{el:s}=this;s.html("").children(...t).show(),re(s.parent(),()=>{this.hide()})}bindInputEvents(e){e.on("keydown",t=>Ns.call(this,t))}}class D extends K{constructor(e){super("div",`${m}-icon`),this.iconNameEl=u("div",`${m}-icon-img ${e}`),this.child(this.iconNameEl)}setName(e){this.iconNameEl.className(`${m}-icon-img ${e}`)}}function bt(l,e){l.setMonth(l.getMonth()+e)}function Ps(l,e){const t=new Date(l);return t.setDate(e-l.getDay()+1),t}function _s(l,e,t){const s=new Date(l,e,1,23,59,59),i=[[],[],[],[],[],[]];for(let n=0;n<6;n+=1)for(let r=0;r<7;r+=1){const o=n*7+r,c=Ps(s,o),h=c.getMonth()!==e,d=c.getMonth()===t.getMonth()&&c.getDate()===t.getDate();i[n][r]={d:c,disabled:h,active:d}}return i}class Vs{constructor(e){this.value=e,this.cvalue=new Date(e),this.headerLeftEl=u("div","calendar-header-left"),this.bodyEl=u("tbody",""),this.buildAll(),this.el=u("div","x-spreadsheet-calendar").children(u("div","calendar-header").children(this.headerLeftEl,u("div","calendar-header-right").children(u("a","calendar-prev").on("click.stop",()=>this.prev()).child(new D("chevron-left")),u("a","calendar-next").on("click.stop",()=>this.next()).child(new D("chevron-right")))),u("table","calendar-body").children(u("thead","").child(u("tr","").children(...T("calendar.weeks").map(t=>u("th","cell").child(t)))),this.bodyEl)),this.selectChange=()=>{}}setValue(e){this.value=e,this.cvalue=new Date(e),this.buildAll()}prev(){const{value:e}=this;bt(e,-1),this.buildAll()}next(){const{value:e}=this;bt(e,1),this.buildAll()}buildAll(){this.buildHeaderLeft(),this.buildBody()}buildHeaderLeft(){const{value:e}=this;this.headerLeftEl.html(`${T("calendar.months")[e.getMonth()]} ${e.getFullYear()}`)}buildBody(){const{value:e,cvalue:t,bodyEl:s}=this,n=_s(e.getFullYear(),e.getMonth(),t).map(r=>{const o=r.map(c=>{let h="cell";return c.disabled&&(h+=" disabled"),c.active&&(h+=" active"),u("td","").child(u("div",h).on("click.stop",()=>{this.selectChange(c.d)}).child(c.d.getDate().toString()))});return u("tr","").children(...o)});s.html("").children(...n)}}class Bs{constructor(){this.calendar=new Vs(new Date),this.el=u("div",`${m}-datepicker`).child(this.calendar.el).hide()}setValue(e){const{calendar:t}=this;return typeof e=="string"?/^\d{4}-\d{1,2}-\d{1,2}$/.test(e)&&t.setValue(new Date(e.replace(new RegExp("-","g"),"/"))):e instanceof Date&&t.setValue(e),this}change(e){this.calendar.selectChange=t=>{e(t),this.hide()}}show(){this.el.show()}hide(){this.el.hide()}}function Ce(){const{inputText:l}=this;if(!/^\s*$/.test(l)){const{textlineEl:e,textEl:t,areaOffset:s}=this,i=l.split(`
`),n=Math.max(...i.map(a=>a.length)),o=e.offset().width/l.length,c=(n+1)*o+5,h=this.viewFn().width-s.left-o;let d=i.length;if(c>s.width){let a=c;c>h&&(a=h,d+=parseInt(c/h,10),d+=c%h>0?1:0),t.css("width",`${a}px`)}d*=this.rowHeight,d>s.height&&t.css("height",`${d}px`)}}function qs({target:l},e){const{value:t,selectionEnd:s}=l,i=`${t.slice(0,s)}${e}${t.slice(s)}`;l.value=i,l.setSelectionRange(s+1,s+1),this.inputText=i,this.textlineEl.html(i),Ce.call(this)}function Ls(l){const{keyCode:e,altKey:t}=l;e!==13&&e!==9&&l.stopPropagation(),e===13&&t&&(qs.call(this,l,`
`),l.stopPropagation()),e===13&&!t&&l.preventDefault()}function js(l){const e=l.target.value,{suggest:t,textlineEl:s,validator:i}=this,{cell:n}=this;if(n!==null)if("editable"in n&&n.editable===!0||n.editable===void 0){if(this.inputText=e,i)i.type==="list"?t.search(e):t.hide();else{const r=e.lastIndexOf("=");r!==-1?t.search(e.substring(r+1)):t.hide()}s.html(e),Ce.call(this),this.change("input",e)}else l.target.value=n.text;else{if(this.inputText=e,i)i.type==="list"?t.search(e):t.hide();else{const r=e.lastIndexOf("=");r!==-1?t.search(e.substring(r+1)):t.hide()}s.html(e),Ce.call(this),this.change("input",e)}}function Us(l){const{el:e}=this.textEl;setTimeout(()=>{e.focus(),e.setSelectionRange(l,l)},0)}function qt(l,e){const{textEl:t,textlineEl:s}=this;t.el.blur(),t.val(l),s.html(l),Us.call(this,e)}function Ys(l){const{inputText:e,validator:t}=this;let s=0;if(t&&t.type==="list")this.inputText=l,s=this.inputText.length;else{const i=e.lastIndexOf("="),n=e.substring(0,i+1);let r=e.substring(i+1);r.indexOf(")")!==-1?r=r.substring(r.indexOf(")")):r="",this.inputText=`${n+l.key}(`,s=this.inputText.length,this.inputText+=`)${r}`}qt.call(this,this.inputText,s)}function Xs(){this.suggest.setItems(this.formulas)}function Ks(l){let e=l.getMonth()+1,t=l.getDate();return e<10&&(e=`0${e}`),t<10&&(t=`0${t}`),`${l.getFullYear()}-${e}-${t}`}class Zs{constructor(e,t,s){this.viewFn=t,this.rowHeight=s,this.formulas=e,this.suggest=new Bt(e,i=>{Ys.call(this,i)}),this.datepicker=new Bs,this.datepicker.change(i=>{this.setText(Ks(i)),this.clear()}),this.areaEl=u("div",`${m}-editor-area`).children(this.textEl=u("textarea","").on("input",i=>js.call(this,i)).on("paste.stop",()=>{}).on("keydown",i=>Ls.call(this,i)),this.textlineEl=u("div","textline"),this.suggest.el,this.datepicker.el).on("mousemove.stop",()=>{}).on("mousedown.stop",()=>{}),this.el=u("div",`${m}-editor`).child(this.areaEl).hide(),this.suggest.bindInputEvents(this.textEl),this.areaOffset=null,this.freeze={w:0,h:0},this.cell=null,this.inputText="",this.change=()=>{}}setFreezeLengths(e,t){this.freeze.w=e,this.freeze.h=t}clear(){this.inputText!==""&&this.change("finished",this.inputText),this.cell=null,this.areaOffset=null,this.inputText="",this.el.hide(),this.textEl.val(""),this.textlineEl.html(""),Xs.call(this),this.datepicker.hide()}setOffset(e,t="top"){const{textEl:s,areaEl:i,suggest:n,freeze:r,el:o}=this;if(e){this.areaOffset=e;const{left:c,top:h,width:d,height:a,l:f,t:g}=e,p={left:0,top:0};r.w>f&&r.h>g||(r.w<f&&r.h<g?(p.left=r.w,p.top=r.h):r.w>f?p.top=r.h:r.h>g&&(p.left=r.w)),o.offset(p),i.offset({left:c-p.left-.8,top:h-p.top-.8}),s.offset({width:d-9+.8,height:a-3+.8});const w={left:0};w[t]=a,n.setOffset(w),n.hide()}}setCell(e,t){const{el:s,datepicker:i,suggest:n}=this;s.show(),this.cell=e;const r=e&&e.text||"";if(this.setText(r),this.validator=t,t){const{type:o}=t;o==="date"&&(i.show(),/^\s*$/.test(r)||i.setValue(r)),o==="list"&&(n.setItems(t.values()),n.search(""))}}setText(e){this.inputText=e,qt.call(this,e,e.length),Ce.call(this)}}class Y extends K{constructor(e,t=""){super("div",`${m}-button ${t}`),this.child(T(`button.${e}`))}}function Ee(){return window.devicePixelRatio||1}function Ye(){return Ee()-.5}function C(l){return parseInt(l*Ee(),10)}function J(l){const e=C(l);return e>0?e-.5:.5}class Js{constructor(e,t,s,i,n=0){this.x=e,this.y=t,this.width=s,this.height=i,this.padding=n,this.bgcolor="#ffffff",this.borderTop=null,this.borderRight=null,this.borderBottom=null,this.borderLeft=null}setBorders({top:e,bottom:t,left:s,right:i}){e&&(this.borderTop=e),i&&(this.borderRight=i),t&&(this.borderBottom=t),s&&(this.borderLeft=s)}innerWidth(){return this.width-this.padding*2-2}innerHeight(){return this.height-this.padding*2-2}textx(e){const{width:t,padding:s}=this;let{x:i}=this;return e==="left"?i+=s:e==="center"?i+=t/2:e==="right"&&(i+=t-s),i}texty(e,t){const{height:s,padding:i}=this;let{y:n}=this;return e==="top"?n+=i:e==="middle"?n+=s/2-t/2:e==="bottom"&&(n+=s-i-t),n}topxys(){const{x:e,y:t,width:s}=this;return[[e,t],[e+s,t]]}rightxys(){const{x:e,y:t,width:s,height:i}=this;return[[e+s,t],[e+s,t+i]]}bottomxys(){const{x:e,y:t,width:s,height:i}=this;return[[e,t+i],[e+s,t+i]]}leftxys(){const{x:e,y:t,height:s}=this;return[[e,t],[e,t+s]]}}function xt(l,e,t,s,i,n,r){const o={x:0,y:0};l==="underline"?i==="bottom"?o.y=0:i==="top"?o.y=-(n+2):o.y=-n/2:l==="strike"&&(i==="bottom"?o.y=n/2:i==="top"&&(o.y=-(n/2+2))),s==="center"?o.x=r/2:s==="right"&&(o.x=r),this.line([e-o.x,t-o.y],[e-o.x+r,t-o.y])}class Lt{constructor(e,t,s){this.el=e,this.ctx=e.getContext("2d"),this.resize(t,s),this.ctx.scale(Ee(),Ee())}resize(e,t){this.el.style.width=`${e}px`,this.el.style.height=`${t}px`,this.el.width=C(e),this.el.height=C(t)}clear(){const{width:e,height:t}=this.el;return this.ctx.clearRect(0,0,e,t),this}attr(e){return Object.assign(this.ctx,e),this}save(){return this.ctx.save(),this.ctx.beginPath(),this}restore(){return this.ctx.restore(),this}beginPath(){return this.ctx.beginPath(),this}translate(e,t){return this.ctx.translate(C(e),C(t)),this}scale(e,t){return this.ctx.scale(e,t),this}clearRect(e,t,s,i){return this.ctx.clearRect(e,t,s,i),this}fillRect(e,t,s,i){return this.ctx.fillRect(C(e)-.5,C(t)-.5,C(s),C(i)),this}fillText(e,t,s){return this.ctx.fillText(e,C(t),C(s)),this}text(e,t,s={},i=!0){const{ctx:n}=this,{align:r,valign:o,font:c,color:h,strike:d,underline:a}=s,f=t.textx(r);n.save(),n.beginPath(),this.attr({textAlign:r,textBaseline:o,font:`${c.italic?"italic":""} ${c.bold?"bold":""} ${C(c.size)}px ${c.name}`,fillStyle:h,strokeStyle:h});const g=`${e}`.split(`
`),p=t.innerWidth(),w=[];g.forEach(k=>{const v=n.measureText(k).width;if(i&&v>C(p)){let y={w:0,len:0,start:0};for(let S=0;S<k.length;S+=1)y.w>=C(p)&&(w.push(k.substr(y.start,y.len)),y={w:0,len:0,start:S}),y.len+=1,y.w+=n.measureText(k[S]).width+1;y.len>0&&w.push(k.substr(y.start,y.len))}else w.push(k)});const x=(w.length-1)*(c.size+2);let b=t.texty(o,x);return w.forEach(k=>{const v=n.measureText(k).width;this.fillText(k,f,b),d&&xt.call(this,"strike",f,b,r,o,c.size,v),a&&xt.call(this,"underline",f,b,r,o,c.size,v),b+=c.size+2}),n.restore(),this}border(e,t){const{ctx:s}=this;return s.lineWidth=Ye,s.strokeStyle=t,e==="medium"?s.lineWidth=C(2)-.5:e==="thick"?s.lineWidth=C(3):e==="dashed"?s.setLineDash([C(3),C(2)]):e==="dotted"?s.setLineDash([C(1),C(1)]):e==="double"&&s.setLineDash([C(2),0]),this}line(...e){const{ctx:t}=this;if(e.length>1){t.beginPath();const[s,i]=e[0];t.moveTo(J(s),J(i));for(let n=1;n<e.length;n+=1){const[r,o]=e[n];t.lineTo(J(r),J(o))}t.stroke()}return this}strokeBorders(e){const{ctx:t}=this;t.save();const{borderTop:s,borderRight:i,borderBottom:n,borderLeft:r}=e;s&&(this.border(...s),this.line(...e.topxys())),i&&(this.border(...i),this.line(...e.rightxys())),n&&(this.border(...n),this.line(...e.bottomxys())),r&&(this.border(...r),this.line(...e.leftxys())),t.restore()}dropdown(e){const{ctx:t}=this,{x:s,y:i,width:n,height:r}=e,o=s+n-15,c=i+r-15;t.save(),t.beginPath(),t.moveTo(C(o),C(c)),t.lineTo(C(o+8),C(c)),t.lineTo(C(o+4),C(c+6)),t.closePath(),t.fillStyle="rgba(0, 0, 0, .45)",t.fill(),t.restore()}error(e){const{ctx:t}=this,{x:s,y:i,width:n}=e,r=s+n-1;t.save(),t.beginPath(),t.moveTo(C(r-8),C(i-1)),t.lineTo(C(r),C(i-1)),t.lineTo(C(r),C(i+8)),t.closePath(),t.fillStyle="rgba(255, 0, 0, .65)",t.fill(),t.restore()}frozen(e){const{ctx:t}=this,{x:s,y:i,width:n}=e,r=s+n-1;t.save(),t.beginPath(),t.moveTo(C(r-8),C(i-1)),t.lineTo(C(r),C(i-1)),t.lineTo(C(r),C(i+8)),t.closePath(),t.fillStyle="rgba(0, 255, 0, .85)",t.fill(),t.restore()}rect(e,t){const{ctx:s}=this,{x:i,y:n,width:r,height:o,bgcolor:c}=e;s.save(),s.beginPath(),s.fillStyle=c||"#fff",s.rect(J(i+1),J(n+1),C(r-2),C(o-2)),s.clip(),s.fill(),t(),s.restore()}}const vt=[{key:"Arial",title:"Arial"},{key:"Helvetica",title:"Helvetica"},{key:"Source Sans Pro",title:"Source Sans Pro"},{key:"Comic Sans MS",title:"Comic Sans MS"},{key:"Courier New",title:"Courier New"},{key:"Verdana",title:"Verdana"},{key:"Lato",title:"Lato"}],Pe=[{pt:7.5,px:10},{pt:8,px:11},{pt:9,px:12},{pt:10,px:13},{pt:10.5,px:14},{pt:11,px:15},{pt:12,px:16},{pt:14,px:18.7},{pt:15,px:20},{pt:16,px:21.3},{pt:18,px:24},{pt:22,px:29.3},{pt:24,px:32},{pt:26,px:34.7},{pt:36,px:48},{pt:42,px:56}];function Gs(l){for(let e=0;e<Pe.length;e+=1){const t=Pe[e];if(t.pt===l)return t.px}return l}const Qs=l=>{const e=[],t=[];let s=[],i=0,n="",r=1,o="";for(let c=0;c<l.length;c+=1){const h=l.charAt(c);if(h!==" "){if(h>="a"&&h<="z")s.push(h.toUpperCase());else if(h>="0"&&h<="9"||h>="A"&&h<="Z"||h===".")s.push(h);else if(h==='"'){for(c+=1;l.charAt(c)!=='"';)s.push(l.charAt(c)),c+=1;t.push(`"${s.join("")}`),s=[]}else if(h==="-"&&/[+\-*/,(]/.test(o))s.push(h);else{if(h!=="("&&s.length>0&&t.push(s.join("")),h===")"){let d=e.pop();if(i===2)try{const[a,f]=L(t.pop()),[g,p]=L(t.pop());let w=0;for(let x=g;x<=a;x+=1)for(let b=p;b<=f;b+=1)t.push(P(x,b)),w+=1;t.push([d,w])}catch(a){}else if(i===1||i===3)i===3&&t.push(n),t.push([d,r]),r=1;else for(;d!=="("&&(t.push(d),!(e.length<=0));)d=e.pop();i=0}else if(h==="="||h===">"||h==="<"){const d=l.charAt(c+1);n=h,(d==="="||d==="-")&&(n+=d,c+=1),i=3}else if(h===":")i=2;else if(h===",")i===3&&t.push(n),i=1,r+=1;else if(h==="("&&s.length>0)e.push(s.join(""));else{if(e.length>0&&(h==="+"||h==="-")){let d=e[e.length-1];if(d!=="("&&t.push(e.pop()),d==="*"||d==="/")for(;e.length>0&&(d=e[e.length-1],d!=="(");)t.push(e.pop())}else if(e.length>0){const d=e[e.length-1];(d==="*"||d==="/")&&t.push(e.pop())}e.push(h)}s=[]}o=h}}for(s.length>0&&t.push(s.join(""));e.length>0;)t.push(e.pop());return t},ei=(l,e)=>{const[t]=l;let s=l;if(t==='"')return l.substring(1);let i=1;if(t==="-"&&(s=l.substring(1),i=-1),s[0]>="0"&&s[0]<="9")return i*Number(s);const[n,r]=L(s);return i*e(n,r)},ti=(l,e,t,s)=>{const i=[];for(let n=0;n<l.length;n+=1){const r=l[n],o=r[0];if(r==="+"){const c=i.pop();i.push(U("+",i.pop(),c))}else if(r==="-")if(i.length===1){const c=i.pop();i.push(U("*",c,-1))}else{const c=i.pop();i.push(U("-",i.pop(),c))}else if(r==="*")i.push(U("*",i.pop(),i.pop()));else if(r==="/"){const c=i.pop();i.push(U("/",i.pop(),c))}else if(o==="="||o===">"||o==="<"){let c=i.pop();Number.isNaN(c)||(c=Number(c));let h=i.pop();Number.isNaN(h)||(h=Number(h));let d=!1;o==="="?d=h===c:r===">"?d=h>c:r===">="?d=h>=c:r==="<"?d=h<c:r==="<="&&(d=h<=c),i.push(d)}else if(Array.isArray(r)){const[c,h]=r,d=[];for(let a=0;a<h;a+=1)d.push(i.pop());i.push(e[c].render(d.reverse()))}else{if(s.includes(r))return 0;(o>="a"&&o<="z"||o>="A"&&o<="Z")&&s.push(r),i.push(ei(r,t)),s.pop()}}return i[0]},jt=(l,e,t,s=[])=>{if(l[0]==="="){const i=Qs(l.substring(1));return i.length<=0?l:ti(i,e,(n,r)=>jt(t(n,r),e,t,s),s)}return l};var si={render:jt};const Xe=[{key:"SUM",title:E("formula.sum"),render:l=>l.reduce((e,t)=>U("+",e,t),0)},{key:"AVERAGE",title:E("formula.average"),render:l=>l.reduce((e,t)=>Number(e)+Number(t),0)/l.length},{key:"MAX",title:E("formula.max"),render:l=>Math.max(...l.map(e=>Number(e)))},{key:"MIN",title:E("formula.min"),render:l=>Math.min(...l.map(e=>Number(e)))},{key:"IF",title:E("formula._if"),render:([l,e,t])=>l?e:t},{key:"AND",title:E("formula.and"),render:l=>l.every(e=>e)},{key:"OR",title:E("formula.or"),render:l=>l.some(e=>e)},{key:"CONCAT",title:E("formula.concat"),render:l=>l.join("")}],ii=Xe,Ut={};Xe.forEach(l=>{Ut[l.key]=l});const G=l=>l,pe=l=>{if(/^(-?\d*.?\d*)$/.test(l)){const e=Number(l).toFixed(2).toString(),[t,...s]=e.split("\\.");return[t.replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,"),...s]}return l},ie=[{key:"normal",title:E("format.normal"),type:"string",render:G},{key:"text",title:E("format.text"),type:"string",render:G},{key:"number",title:E("format.number"),type:"number",label:"1,000.12",render:pe},{key:"percent",title:E("format.percent"),type:"number",label:"10.12%",render:l=>`${l}%`},{key:"rmb",title:E("format.rmb"),type:"number",label:"\uFFE510.00",render:l=>`\uFFE5${pe(l)}`},{key:"usd",title:E("format.usd"),type:"number",label:"$10.00",render:l=>`$${pe(l)}`},{key:"eur",title:E("format.eur"),type:"number",label:"\u20AC10.00",render:l=>`\u20AC${pe(l)}`},{key:"date",title:E("format.date"),type:"date",label:"26/09/2008",render:G},{key:"time",title:E("format.time"),type:"date",label:"15:59:00",render:G},{key:"datetime",title:E("format.datetime"),type:"date",label:"26/09/2008 15:59:00",render:G},{key:"duration",title:E("format.duration"),type:"date",label:"24:01:00",render:G}],Yt={};ie.forEach(l=>{Yt[l.key]=l});const li=5,ni={fillStyle:"#f4f5f8"},ri={fillStyle:"#fff",lineWidth:Ye,strokeStyle:"#e6e6e6"};function oi(){return{textAlign:"center",textBaseline:"middle",font:`500 ${C(12)}px Source Sans Pro`,fillStyle:"#585757",lineWidth:Ye(),strokeStyle:"#e6e6e6"}}function Xt(l,e,t,s=0){const{left:i,top:n,width:r,height:o}=l.cellRect(e,t);return new Js(i,n+s,r,o,li)}function Se(l,e,t,s,i=0){const{sortedRowMap:n,rows:r,cols:o}=e;if(r.isHide(t)||o.isHide(s))return;let c=t;n.has(t)&&(c=n.get(t));const h=e.getCell(c,s);if(h===null)return;let d=!1;"editable"in h&&h.editable===!1&&(d=!0);const a=e.getCellStyleOrDefault(c,s),f=Xt(e,t,s,i);f.bgcolor=a.bgcolor,a.border!==void 0&&(f.setBorders(a.border),l.strokeBorders(f)),l.rect(f,()=>{let g="";e.settings.evalPaused?g=h.text||"":g=si.render(h.text||"",Ut,(x,b)=>e.getCellTextOrDefault(b,x)),a.format&&(g=Yt[a.format].render(g));const p=Object.assign({},a.font);p.size=Gs(p.size),l.text(g,f,{align:a.align,valign:a.valign,font:p,color:a.color,strike:a.strike,underline:a.underline},a.textwrap),e.validations.getError(t,s)&&l.error(f),d&&l.frozen(f)})}function ci(l){const{data:e,draw:t}=this;if(l){const{autoFilter:s}=e;if(!s.active())return;const i=s.hrange();l.intersects(i)&&i.each((n,r)=>{const o=Xt(e,n,r);t.dropdown(o)})}}function me(l,e,t,s,i){const{draw:n,data:r}=this;n.save(),n.translate(e,t).translate(s,i);const{exceptRowSet:o}=r,c=a=>{const f=o.has(a);if(f){const g=r.rows.getHeight(a);n.translate(0,-g)}return!f},h=r.exceptRowTotalHeight(l.sri,l.eri);n.save(),n.translate(0,-h),l.each((a,f)=>{Se(n,r,a,f)},a=>c(a)),n.restore();const d=new Set;n.save(),n.translate(0,-h),r.eachMergesInView(l,({sri:a,sci:f,eri:g})=>{if(!o.has(a))Se(n,r,a,f);else if(!d.has(a)){d.add(a);const p=r.rows.sumHeight(a,g+1);n.translate(0,-p)}}),n.restore(),ci.call(this,l),n.restore()}function yt(l,e,t,s){const{draw:i}=this;i.save(),i.attr({fillStyle:"rgba(75, 137, 255, 0.08)"}).fillRect(l,e,t,s),i.restore()}function we(l,e,t,s,i,n){const{draw:r,data:o}=this,c=e.h,h=e.w,d=n+s,a=i+t;r.save(),r.attr(ni),(l==="all"||l==="left")&&r.fillRect(0,d,t,c),(l==="all"||l==="top")&&r.fillRect(a,0,h,s);const{sri:f,sci:g,eri:p,eci:w}=o.selector.range;r.attr(oi()),(l==="all"||l==="left")&&(o.rowEach(e.sri,e.eri,(x,b,k)=>{const v=d+b,y=x;r.line([0,v],[t,v]),f<=y&&y<p+1&&yt.call(this,0,v,t,k),r.fillText(y+1,t/2,v+k/2),x>0&&o.rows.isHide(x-1)&&(r.save(),r.attr({strokeStyle:"#c6c6c6"}),r.line([5,v+5],[t-5,v+5]),r.restore())}),r.line([0,c+d],[t,c+d]),r.line([t,d],[t,c+d])),(l==="all"||l==="top")&&(o.colEach(e.sci,e.eci,(x,b,k)=>{const v=a+b,y=x;r.line([v,0],[v,s]),g<=y&&y<w+1&&yt.call(this,v,0,k,s),r.fillText(It(y),v+k/2,s/2),x>0&&o.cols.isHide(x-1)&&(r.save(),r.attr({strokeStyle:"#c6c6c6"}),r.line([v+5,5],[v+5,s-5]),r.restore())}),r.line([h+a,0],[h+a,s]),r.line([0,s],[h+a,s])),r.restore()}function hi(l,e){const{draw:t}=this;t.save(),t.attr({fillStyle:"#f4f5f8"}).fillRect(0,0,l,e),t.restore()}function be({sri:l,sci:e,eri:t,eci:s,w:i,h:n},r,o,c,h){const{draw:d,data:a}=this,{settings:f}=a;if(d.save(),d.attr(ri).translate(r+c,o+h),!f.showGrid){d.restore();return}a.rowEach(l,t,(g,p,w)=>{g!==l&&d.line([0,p],[i,p]),g===t&&d.line([0,p+w],[i,p+w])}),a.colEach(e,s,(g,p,w)=>{g!==e&&d.line([p,0],[p,n]),g===s&&d.line([p+w,0],[p+w,n])}),d.restore()}function ai(l,e,t,s){const{draw:i,data:n}=this,r=n.viewWidth()-l,o=n.viewHeight()-e;i.save().translate(l,e).attr({strokeStyle:"rgba(75, 137, 255, .6)"}),i.line([0,s],[r,s]),i.line([t,0],[t,o]),i.restore()}class di{constructor(e,t){this.el=e,this.draw=new Lt(e,t.viewWidth(),t.viewHeight()),this.data=t}resetData(e){this.data=e,this.render()}render(){const{data:e}=this,{rows:t,cols:s}=e,i=s.indexWidth,n=t.height;this.draw.resize(e.viewWidth(),e.viewHeight()),this.clear();const r=e.viewRange(),o=e.freezeTotalWidth(),c=e.freezeTotalHeight(),{x:h,y:d}=e.scroll;be.call(this,r,i,n,o,c),me.call(this,r,i,n,-h,-d),we.call(this,"all",r,i,n,o,c),hi.call(this,i,n);const[a,f]=e.freeze;if(a>0||f>0){if(a>0){const p=r.clone();p.sri=0,p.eri=a-1,p.h=c,be.call(this,p,i,n,o,0),me.call(this,p,i,n,-h,0),we.call(this,"top",p,i,n,o,0)}if(f>0){const p=r.clone();p.sci=0,p.eci=f-1,p.w=o,be.call(this,p,i,n,0,c),we.call(this,"left",p,i,n,0,c),me.call(this,p,i,n,0,-d)}const g=e.freezeViewRange();be.call(this,g,i,n,0,0),we.call(this,"all",g,i,n,0,0),me.call(this,g,i,n,0,0),ai.call(this,i,n,o,c)}}clear(){this.draw.clear()}}const xe=[["A3",11.69,16.54],["A4",8.27,11.69],["A5",5.83,8.27],["B4",9.84,13.9],["B5",6.93,9.84]],_e=["landscape","portrait"];function $e(l){return parseInt(96*l,10)}function kt(l){l==="cancel"?this.el.hide():this.toPrint()}function fi(l){const{paper:e}=this,{value:t}=l.target,s=xe[t];e.w=$e(s[1]),e.h=$e(s[2]),this.preview()}function ui(l){const{paper:e}=this,{value:t}=l.target,s=_e[t];e.orientation=s,this.preview()}class gi{constructor(e){this.paper={w:$e(xe[0][1]),h:$e(xe[0][2]),padding:50,orientation:_e[0],get width(){return this.orientation==="landscape"?this.h:this.w},get height(){return this.orientation==="landscape"?this.w:this.h}},this.data=e,this.el=u("div",`${m}-print`).children(u("div",`${m}-print-bar`).children(u("div","-title").child("Print settings"),u("div","-right").children(u("div",`${m}-buttons`).children(new Y("cancel").on("click",kt.bind(this,"cancel")),new Y("next","primary").on("click",kt.bind(this,"next"))))),u("div",`${m}-print-content`).children(this.contentEl=u("div","-content"),u("div","-sider").child(u("form","").children(u("fieldset","").children(u("label","").child(`${T("print.size")}`),u("select","").children(...xe.map((t,s)=>u("option","").attr("value",s).child(`${t[0]} ( ${t[1]}''x${t[2]}'' )`))).on("change",fi.bind(this))),u("fieldset","").children(u("label","").child(`${T("print.orientation")}`),u("select","").children(..._e.map((t,s)=>u("option","").attr("value",s).child(`${T("print.orientations")[s]}`))).on("change",ui.bind(this))))))).hide()}resetData(e){this.data=e}preview(){const{data:e,paper:t}=this,{width:s,height:i,padding:n}=t,r=s-n*2,o=i-n*2,c=e.contentRange(),h=parseInt(c.h/o,10)+1,d=r/c.w;let a=n;const f=n;d>1&&(a+=(r-c.w)/2);let g=0,p=0;this.contentEl.html(""),this.canvases=[];const w={sri:0,sci:0,eri:0,eci:0};for(let x=0;x<h;x+=1){let b=0,k=0;const v=u("div",`${m}-canvas-card`),y=u("canvas",`${m}-canvas`);this.canvases.push(y.el);const S=new Lt(y.el,s,i);for(S.save(),S.translate(a,f),d<1&&S.scale(d,d);g<=c.eri;g+=1){const O=e.rows.getHeight(g);if(b+=O,b<o)for(let F=0;F<=c.eci;F+=1)Se(S,e,g,F,p),w.eci=F;else{k=-(b-O);break}}w.eri=g,S.restore(),S.save(),S.translate(a,f),d<1&&S.scale(d,d);const R=p;e.eachMergesInView(w,({sri:O,sci:F})=>{Se(S,e,O,F,R)}),S.restore(),w.sri=w.eri,w.sci=w.eci,p+=k,this.contentEl.child(u("div",`${m}-canvas-card-wraper`).child(v.child(y)))}this.el.show()}toPrint(){this.el.hide();const{paper:e}=this,t=u("iframe","").hide(),{el:s}=t;window.document.body.appendChild(s);const{contentWindow:i}=s,n=i.document,r=document.createElement("style");r.innerHTML=`
      @page { size: ${e.width}px ${e.height}px; };
      canvas {
        page-break-before: auto;        
        page-break-after: always;
        image-rendering: pixelated;
      };
    `,n.head.appendChild(r),this.canvases.forEach(o=>{const c=o.cloneNode(!1);c.getContext("2d").drawImage(o,0,0),n.body.appendChild(c)}),i.print()}}const pi=[{key:"copy",title:E("contextmenu.copy"),label:"Ctrl+C"},{key:"cut",title:E("contextmenu.cut"),label:"Ctrl+X"},{key:"paste",title:E("contextmenu.paste"),label:"Ctrl+V"},{key:"paste-value",title:E("contextmenu.pasteValue"),label:"Ctrl+Shift+V"},{key:"paste-format",title:E("contextmenu.pasteFormat"),label:"Ctrl+Alt+V"},{key:"divider"},{key:"insert-row",title:E("contextmenu.insertRow")},{key:"insert-column",title:E("contextmenu.insertColumn")},{key:"divider"},{key:"delete-row",title:E("contextmenu.deleteRow")},{key:"delete-column",title:E("contextmenu.deleteColumn")},{key:"delete-cell-text",title:E("contextmenu.deleteCellText")},{key:"hide",title:E("contextmenu.hide")},{key:"divider"},{key:"validation",title:E("contextmenu.validation")},{key:"divider"},{key:"cell-printable",title:E("contextmenu.cellprintable")},{key:"cell-non-printable",title:E("contextmenu.cellnonprintable")},{key:"divider"},{key:"cell-editable",title:E("contextmenu.celleditable")},{key:"cell-non-editable",title:E("contextmenu.cellnoneditable")}];function mi(l){return l.key==="divider"?u("div",`${m}-item divider`):u("div",`${m}-item`).on("click",()=>{this.itemClick(l.key),this.hide()}).children(l.title(),u("div","label").child(l.label||""))}function wi(){return pi.map(l=>mi.call(this,l))}class bi{constructor(e,t=!1){this.menuItems=wi.call(this),this.el=u("div",`${m}-contextmenu`).children(...this.menuItems).hide(),this.viewFn=e,this.itemClick=()=>{},this.isHide=t,this.setMode("range")}setMode(e){const t=this.menuItems[12];e==="row-col"?t.show():t.hide()}hide(){const{el:e}=this;e.hide(),te(e)}setPosition(e,t){if(this.isHide)return;const{el:s}=this,{width:i}=s.show().offset(),n=this.viewFn(),r=n.height/2;let o=e;n.width-e<=i&&(o-=i),s.css("left",`${o}px`),t>r?s.css("bottom",`${n.height-t}px`).css("max-height",`${t}px`).css("top","auto"):s.css("top",`${t}px`).css("max-height",`${n.height-t}px`).css("bottom","auto"),re(s)}}function xi(l,e){if(e.classList.contains("active"))return;const{left:t,top:s,width:i,height:n}=e.getBoundingClientRect(),r=u("div",`${m}-tooltip`).html(l).show();document.body.appendChild(r.el);const o=r.box();r.css("left",`${t+i/2-o.width/2}px`).css("top",`${s+n+2}px`),I(e,"mouseleave",()=>{document.body.contains(r.el)&&document.body.removeChild(r.el)}),I(e,"click",()=>{document.body.contains(r.el)&&document.body.removeChild(r.el)})}class Ke{constructor(e,t,s){this.tip=T(`toolbar.${e.replace(/-[a-z]/g,i=>i[1].toUpperCase())}`),t&&(this.tip+=` (${t})`),this.tag=e,this.shortcut=t,this.value=s,this.el=this.element(),this.change=()=>{}}element(){const{tip:e}=this;return u("div",`${m}-toolbar-btn`).on("mouseenter",t=>{xi(e,t.target)}).attr("data-tooltip",e)}setState(){}}class W extends Ke{dropdown(){}getValue(e){return e}element(){const{tag:e}=this;return this.dd=this.dropdown(),this.dd.change=t=>this.change(e,this.getValue(t)),super.element().child(this.dd)}setState(e){e&&(this.value=e,this.dd.setTitle(e))}}class N extends K{constructor(e,t,s,i,...n){super("div",`${m}-dropdown ${i}`),this.title=e,this.change=()=>{},this.headerClick=()=>{},typeof e=="string"?this.title=u("div",`${m}-dropdown-title`).child(e):s&&this.title.addClass("arrow-left"),this.contentEl=u("div",`${m}-dropdown-content`).css("width",t).hide(),this.setContentChildren(...n),this.headerEl=u("div",`${m}-dropdown-header`),this.headerEl.on("click",()=>{this.contentEl.css("display")!=="block"?this.show():this.hide()}).children(this.title,s?u("div",`${m}-icon arrow-right`).child(u("div",`${m}-icon-img arrow-down`)):""),this.children(this.headerEl,this.contentEl)}setContentChildren(...e){this.contentEl.html(""),e.length>0&&this.contentEl.children(...e)}setTitle(e){this.title.html(e),this.hide()}show(){const{contentEl:e}=this;e.show(),this.parent().active(),re(this.parent(),()=>{this.hide()})}hide(){this.parent().active(!1),this.contentEl.hide(),te(this.parent())}}function vi(l){return u("div",`${m}-item`).child(new D(l))}class Kt extends N{constructor(e,t){const s=new D(`align-${t}`),i=e.map(n=>vi(`align-${n}`).on("click",()=>{this.setTitle(n),this.change(n)}));super(s,"auto",!0,"bottom-left",...i)}setTitle(e){this.title.setName(`align-${e}`),this.hide()}}class yi extends W{constructor(e){super("align","",e)}dropdown(){const{value:e}=this;return new Kt(["left","center","right"],e)}}class ki extends W{constructor(e){super("valign","",e)}dropdown(){const{value:e}=this;return new Kt(["top","middle","bottom"],e)}}class _ extends Ke{element(){const{tag:e}=this;return super.element().child(new D(e)).on("click",()=>this.click())}click(){this.change(this.tag,this.toggle())}setState(e){this.el.active(e)}toggle(){return this.el.toggle()}active(){return this.el.hasClass("active")}}class Ci extends _{constructor(){super("autofilter")}setState(){}}class Ei extends _{constructor(){super("font-bold","Ctrl+B")}}class Si extends _{constructor(){super("font-italic","Ctrl+I")}}class $i extends _{constructor(){super("strike","Ctrl+U")}}class Ti extends _{constructor(){super("underline","Ctrl+U")}}const Di=["#ffffff","#000100","#e7e5e6","#445569","#5b9cd6","#ed7d31","#a5a5a5","#ffc001","#4371c6","#71ae47"],Oi=[["#f2f2f2","#7f7f7f","#d0cecf","#d5dce4","#deeaf6","#fce5d5","#ededed","#fff2cd","#d9e2f3","#e3efd9"],["#d8d8d8","#595959","#afabac","#adb8ca","#bdd7ee","#f7ccac","#dbdbdb","#ffe59a","#b3c6e7","#c5e0b3"],["#bfbfbf","#3f3f3f","#756f6f","#8596b0","#9cc2e6","#f4b184","#c9c9c9","#fed964","#8eaada","#a7d08c"],["#a5a5a5","#262626","#3a3839","#333f4f","#2e75b5","#c45a10","#7b7b7b","#bf8e01","#2f5596","#538136"],["#7f7f7f","#0c0c0c","#171516","#222a35","#1f4e7a","#843c0a","#525252","#7e6000","#203864","#365624"]],zi=["#c00000","#fe0000","#fdc101","#ffff01","#93d051","#00b04e","#01b0f1","#0170c1","#012060","#7030a0"];function ze(l){return u("td","").child(u("div",`${m}-color-palette-cell`).on("click.stop",()=>this.change(l)).css("background-color",l))}class Ai{constructor(){this.el=u("div",`${m}-color-palette`),this.change=()=>{};const e=u("table","").children(u("tbody","").children(u("tr",`${m}-theme-color-placeholders`).children(...Di.map(t=>ze.call(this,t))),...Oi.map(t=>u("tr",`${m}-theme-colors`).children(...t.map(s=>ze.call(this,s)))),u("tr",`${m}-standard-colors`).children(...zi.map(t=>ze.call(this,t)))));this.el.child(e)}}class Ze extends N{constructor(e,t){const s=new D(e).css("height","16px").css("border-bottom",`3px solid ${t}`),i=new Ai;i.change=n=>{this.setTitle(n),this.change(n)},super(s,"auto",!1,"bottom-left",i.el)}setTitle(e){this.title.css("border-color",e),this.hide()}}const Ii=[["thin",'<svg xmlns="http://www.w3.org/2000/svg" width="50" height="1" style="user-select: none;"><line x1="0" y1="0.5" x2="50" y2="0.5" stroke-width="1" stroke="black" style="user-select: none;"></line></svg>'],["medium",'<svg xmlns="http://www.w3.org/2000/svg" width="50" height="2" style="user-select: none;"><line x1="0" y1="1.0" x2="50" y2="1.0" stroke-width="2" stroke="black" style="user-select: none;"></line></svg>'],["thick",'<svg xmlns="http://www.w3.org/2000/svg" width="50" height="3" style="user-select: none;"><line x1="0" y1="1.5" x2="50" y2="1.5" stroke-width="3" stroke="black" style="user-select: none;"></line></svg>'],["dashed",'<svg xmlns="http://www.w3.org/2000/svg" width="50" height="1" style="user-select: none;"><line x1="0" y1="0.5" x2="50" y2="0.5" stroke-width="1" stroke="black" stroke-dasharray="2" style="user-select: none;"></line></svg>'],["dotted",'<svg xmlns="http://www.w3.org/2000/svg" width="50" height="1" style="user-select: none;"><line x1="0" y1="0.5" x2="50" y2="0.5" stroke-width="1" stroke="black" stroke-dasharray="1" style="user-select: none;"></line></svg>']];class Ri extends N{constructor(e){const t=new D("line-type");let s=0;const i=Ii.map((n,r)=>u("div",`${m}-item state ${e===n[0]?"checked":""}`).on("click",()=>{i[s].toggle("checked"),i[r].toggle("checked"),s=r,this.hide(),this.change(n)}).child(u("div",`${m}-line-type`).html(n[1])));super(t,"auto",!1,"bottom-left",...i)}}function Ct(...l){return u("table","").child(u("tbody","").children(...l))}function Et(l){return u("td","").child(u("div",`${m}-border-palette-cell`).child(new D(`border-${l}`)).on("click",()=>{this.mode=l;const{mode:e,style:t,color:s}=this;this.change({mode:e,style:t,color:s})}))}class Fi{constructor(){this.color="#000",this.style="thin",this.mode="all",this.change=()=>{},this.ddColor=new Ze("line-color",this.color),this.ddColor.change=t=>{this.color=t},this.ddType=new Ri(this.style),this.ddType.change=([t])=>{this.style=t},this.el=u("div",`${m}-border-palette`);const e=Ct(u("tr","").children(u("td",`${m}-border-palette-left`).child(Ct(u("tr","").children(...["all","inside","horizontal","vertical","outside"].map(t=>Et.call(this,t))),u("tr","").children(...["left","top","right","bottom","none"].map(t=>Et.call(this,t))))),u("td",`${m}-border-palette-right`).children(u("div",`${m}-toolbar-btn`).child(this.ddColor.el),u("div",`${m}-toolbar-btn`).child(this.ddType.el))));this.el.child(e)}}class Mi extends N{constructor(){const e=new D("border-all"),t=new Fi;t.change=s=>{this.change(s),this.hide()},super(e,"auto",!1,"bottom-left",t.el)}}class Hi extends W{constructor(){super("border")}dropdown(){return new Mi}}class Te extends Ke{element(){return super.element().child(new D(this.tag)).on("click",()=>this.change(this.tag))}setState(e){this.el.disabled(e)}}class Wi extends Te{constructor(){super("clearformat")}}class Ni extends _{constructor(){super("paintformat")}setState(){}}class Pi extends W{constructor(e){super("color",void 0,e)}dropdown(){const{tag:e,value:t}=this;return new Ze(e,t)}}class _i extends W{constructor(e){super("bgcolor",void 0,e)}dropdown(){const{tag:e,value:t}=this;return new Ze(e,t)}}class Vi extends N{constructor(){const e=Pe.map(t=>u("div",`${m}-item`).on("click",()=>{this.setTitle(`${t.pt}`),this.change(t)}).child(`${t.pt}`));super("10","60px",!0,"bottom-left",...e)}}class Bi extends W{constructor(){super("font-size")}getValue(e){return e.pt}dropdown(){return new Vi}}class qi extends N{constructor(){const e=vt.map(t=>u("div",`${m}-item`).on("click",()=>{this.setTitle(t.title),this.change(t)}).child(t.title));super(vt[0].title,"160px",!0,"bottom-left",...e)}}class Li extends W{constructor(){super("font-name")}getValue(e){return e.key}dropdown(){return new qi}}class ji extends N{constructor(){let e=ie.slice(0);e.splice(2,0,{key:"divider"}),e.splice(8,0,{key:"divider"}),e=e.map(t=>{const s=u("div",`${m}-item`);return t.key==="divider"?s.addClass("divider"):(s.child(t.title()).on("click",()=>{this.setTitle(t.title()),this.change(t)}),t.label&&s.child(u("div","label").html(t.label))),s}),super("Normal","220px",!0,"bottom-left",...e)}setTitle(e){for(let t=0;t<ie.length;t+=1)ie[t].key===e&&this.title.html(ie[t].title());this.hide()}}class Ui extends W{constructor(){super("format")}getValue(e){return e.key}dropdown(){return new ji}}class Yi extends N{constructor(){const e=Xe.map(t=>u("div",`${m}-item`).on("click",()=>{this.hide(),this.change(t)}).child(t.key));super(new D("formula"),"180px",!0,"bottom-left",...e)}}class Xi extends W{constructor(){super("formula")}getValue(e){return e.key}dropdown(){return new Yi}}class Ki extends _{constructor(){super("freeze")}}class Zi extends _{constructor(){super("merge")}setState(e,t){this.el.active(e).disabled(t)}}class Ji extends Te{constructor(){super("redo","Ctrl+Y")}}class Gi extends Te{constructor(){super("undo","Ctrl+Z")}}class Qi extends Te{constructor(){super("print","Ctrl+P")}}class el extends _{constructor(){super("textwrap")}}class tl extends N{constructor(){const e=new D("ellipsis"),t=u("div",`${m}-toolbar-more`);super(e,"auto",!1,"bottom-right",t),this.moreBtns=t,this.contentEl.css("max-width","420px")}}class sl extends W{constructor(){super("more"),this.el.hide()}dropdown(){return new tl}show(){this.el.show()}hide(){this.el.hide()}}function Q(){return u("div",`${m}-toolbar-divider`)}function il(){this.btns2=[],this.items.forEach(l=>{if(Array.isArray(l))l.forEach(({el:e})=>{const t=e.box(),{marginLeft:s,marginRight:i}=e.computedStyle();this.btns2.push([e,t.width+parseInt(s,10)+parseInt(i,10)])});else{const e=l.box(),{marginLeft:t,marginRight:s}=l.computedStyle();this.btns2.push([l,e.width+parseInt(t,10)+parseInt(s,10)])}})}function St(){const{el:l,btns:e,moreEl:t,btns2:s}=this,{moreBtns:i,contentEl:n}=t.dd;l.css("width",`${this.widthFn()-60}px`);const r=l.box();let o=160,c=12;const h=[],d=[];s.forEach(([a,f],g)=>{o+=f,g===s.length-1||o<r.width?h.push(a):(c+=f,d.push(a))}),e.html("").children(...h),i.html("").children(...d),n.css("width",`${c}px`),d.length>0?t.show():t.hide()}class ll{constructor(e,t,s=!1){this.data=e,this.change=()=>{},this.widthFn=t,this.isHide=s;const i=e.defaultStyle();this.items=[[this.undoEl=new Gi,this.redoEl=new Ji,new Qi,this.paintformatEl=new Ni,this.clearformatEl=new Wi],Q(),[this.formatEl=new Ui],Q(),[this.fontEl=new Li,this.fontSizeEl=new Bi],Q(),[this.boldEl=new Ei,this.italicEl=new Si,this.underlineEl=new Ti,this.strikeEl=new $i,this.textColorEl=new Pi(i.color)],Q(),[this.fillColorEl=new _i(i.bgcolor),this.borderEl=new Hi,this.mergeEl=new Zi],Q(),[this.alignEl=new yi(i.align),this.valignEl=new ki(i.valign),this.textwrapEl=new el],Q(),[this.freezeEl=new Ki,this.autofilterEl=new Ci,this.formulaEl=new Xi,this.moreEl=new sl]],this.el=u("div",`${m}-toolbar`),this.btns=u("div",`${m}-toolbar-btns`),this.items.forEach(n=>{Array.isArray(n)?n.forEach(r=>{this.btns.child(r.el),r.change=(...o)=>{this.change(...o)}}):this.btns.child(n.el)}),this.el.child(this.btns),s?this.el.hide():(this.reset(),setTimeout(()=>{il.call(this),St.call(this)},0),I(window,"resize",()=>{St.call(this)}))}paintformatActive(){return this.paintformatEl.active()}paintformatToggle(){this.paintformatEl.toggle()}trigger(e){this[`${e}El`].click()}resetData(e){this.data=e,this.reset()}reset(){if(this.isHide)return;const{data:e}=this,t=e.getSelectedCellStyle();this.undoEl.setState(!e.canUndo()),this.redoEl.setState(!e.canRedo()),this.mergeEl.setState(e.canUnmerge(),!e.selector.multiple()),this.autofilterEl.setState(!e.canAutofilter());const{font:s,format:i}=t;this.formatEl.setState(i),this.fontEl.setState(s.name),this.fontSizeEl.setState(s.size),this.boldEl.setState(s.bold),this.italicEl.setState(s.italic),this.underlineEl.setState(t.underline),this.strikeEl.setState(t.strike),this.textColorEl.setState(t.color),this.fillColorEl.setState(t.bgcolor),this.alignEl.setState(t.align),this.valignEl.setState(t.valign),this.textwrapEl.setState(t.textwrap),this.freezeEl.setState(e.freezeIsActive())}}class nl{constructor(e,t,s="600px"){this.title=e,this.el=u("div",`${m}-modal`).css("width",s).children(u("div",`${m}-modal-header`).children(new D("close").on("click.stop",()=>this.hide()),this.title),u("div",`${m}-modal-content`).children(...t)).hide()}show(){this.dimmer=u("div",`${m}-dimmer active`),document.body.appendChild(this.dimmer.el);const{width:e,height:t}=this.el.show().box(),{clientHeight:s,clientWidth:i}=document.documentElement;this.el.offset({left:(i-e)/2,top:(s-t)/3}),window.xkeydownEsc=n=>{n.keyCode===27&&this.hide()},I(window,"keydown",window.xkeydownEsc)}hide(){this.el.hide(),document.body.removeChild(this.dimmer.el),ke(window,"keydown",window.xkeydownEsc),delete window.xkeydownEsc}}class ee{constructor(e,t){this.vchange=()=>{},this.el=u("div",`${m}-form-input`),this.input=u("input","").css("width",e).on("input",s=>this.vchange(s)).attr("placeholder",t),this.el.child(this.input)}focus(){setTimeout(()=>{this.input.el.focus()},10)}hint(e){this.input.attr("placeholder",e)}val(e){return this.input.val(e)}}class Ae{constructor(e,t,s,i=r=>r,n=()=>{}){this.key=e,this.getTitle=i,this.vchange=()=>{},this.el=u("div",`${m}-form-select`),this.suggest=new Bt(t.map(r=>({key:r,title:this.getTitle(r)})),r=>{this.itemClick(r.key),n(r.key),this.vchange(r.key)},s,this.el),this.el.children(this.itemEl=u("div","input-text").html(this.getTitle(e)),this.suggest.el).on("click",()=>this.show())}show(){this.suggest.search("")}itemClick(e){this.key=e,this.itemEl.html(this.getTitle(e))}val(e){return e!==void 0?(this.key=e,this.itemEl.html(this.getTitle(e)),this):this.key}}const rl={number:/(^\d+$)|(^\d+(\.\d{0,4})?$)/,date:/^\d{4}-\d{1,2}-\d{1,2}$/};class B{constructor(e,t,s,i){this.label="",this.rule=t,s&&(this.label=u("label","label").css("width",`${i}px`).html(s)),this.tip=u("div","tip").child("tip").hide(),this.input=e,this.input.vchange=()=>this.validate(),this.el=u("div",`${m}-form-field`).children(this.label,e.el,this.tip)}isShow(){return this.el.css("display")!=="none"}show(){this.el.show()}hide(){return this.el.hide(),this}val(e){return this.input.val(e)}hint(e){this.input.hint(e)}validate(){const{input:e,rule:t,tip:s,el:i}=this,n=e.val();return t.required&&/^\s*$/.test(n)?(s.html(T("validation.required")),i.addClass("error"),!1):(t.type||t.pattern)&&!(t.pattern||rl[t.type]).test(n)?(s.html(T("validation.notMatch")),i.addClass("error"),!1):(i.removeClass("error"),!0)}}const $t=100;class ol extends nl{constructor(){const e=new B(new Ae("cell",["cell"],"100%",h=>T(`dataValidation.modeType.${h}`)),{required:!0},`${T("dataValidation.range")}:`,$t),t=new B(new ee("120px","E3 or E3:F12"),{required:!0,pattern:/^([A-Z]{1,2}[1-9]\d*)(:[A-Z]{1,2}[1-9]\d*)?$/}),s=new B(new Ae("list",["list","number","date","phone","email"],"100%",h=>T(`dataValidation.type.${h}`),h=>this.criteriaSelected(h)),{required:!0},`${T("dataValidation.criteria")}:`,$t),i=new B(new Ae("be",["be","nbe","eq","neq","lt","lte","gt","gte"],"160px",h=>T(`dataValidation.operator.${h}`),h=>this.criteriaOperatorSelected(h)),{required:!0}).hide(),n=new B(new ee("70px","10"),{required:!0}).hide(),r=new B(new ee("70px","100"),{required:!0,type:"number"}).hide(),o=new B(new ee("120px","a,b,c"),{required:!0}),c=new B(new ee("70px","10"),{required:!0,type:"number"}).hide();super(T("contextmenu.validation"),[u("div",`${m}-form-fields`).children(e.el,t.el),u("div",`${m}-form-fields`).children(s.el,i.el,n.el,r.el,c.el,o.el),u("div",`${m}-buttons`).children(new Y("cancel").on("click",()=>this.btnClick("cancel")),new Y("remove").on("click",()=>this.btnClick("remove")),new Y("save","primary").on("click",()=>this.btnClick("save")))]),this.mf=e,this.rf=t,this.cf=s,this.of=i,this.minvf=n,this.maxvf=r,this.vf=c,this.svf=o,this.change=()=>{}}showVf(e){const t=e==="date"?"2018-11-12":"10",{vf:s}=this;s.input.hint(t),s.show()}criteriaSelected(e){const{of:t,minvf:s,maxvf:i,vf:n,svf:r}=this;e==="date"||e==="number"?(t.show(),s.rule.type=e,i.rule.type=e,e==="date"?(s.hint("2018-11-12"),i.hint("2019-11-12")):(s.hint("10"),i.hint("100")),s.show(),i.show(),n.hide(),r.hide()):(e==="list"?r.show():r.hide(),n.hide(),t.hide(),s.hide(),i.hide())}criteriaOperatorSelected(e){if(!e)return;const{minvf:t,maxvf:s,vf:i}=this;if(e==="be"||e==="nbe")t.show(),s.show(),i.hide();else{const n=this.cf.val();i.rule.type=n,n==="date"?i.hint("2018-11-12"):i.hint("10"),i.show(),t.hide(),s.hide()}}btnClick(e){if(e==="cancel")this.hide();else if(e==="remove")this.change("remove"),this.hide();else if(e==="save"){const t=["mf","rf","cf","of","svf","vf","minvf","maxvf"];for(let c=0;c<t.length;c+=1){const h=this[t[c]];if(h.isShow()&&!h.validate())return}const s=this.mf.val(),i=this.rf.val(),n=this.cf.val(),r=this.of.val();let o=this.svf.val();(n==="number"||n==="date")&&(r==="be"||r==="nbe"?o=[this.minvf.val(),this.maxvf.val()]:o=this.vf.val()),this.change("save",s,i,{type:n,operator:r,required:!1,value:o}),this.hide()}}setValue(e){if(e){const{mf:t,rf:s,cf:i,of:n,svf:r,vf:o,minvf:c,maxvf:h}=this,{mode:d,ref:a,validator:f}=e,{type:g,operator:p,value:w}=f||{type:"list"};t.val(d||"cell"),s.val(a),i.val(g),n.val(p),Array.isArray(w)?(c.val(w[0]),h.val(w[1])):(r.val(w||""),o.val(w||"")),this.criteriaSelected(g),this.criteriaOperatorSelected(p)}this.show()}}function Zt(l){return u("div",`${m}-item ${l}`)}function Tt(l){return Zt("state").child(T(`sort.${l}`)).on("click.stop",()=>this.itemClick(l))}function cl(l){const{filterbEl:e,filterValues:t}=this;e.html(""),Object.keys(l).forEach((i,n)=>{const r=l[i],o=t.includes(i)?"checked":"";e.child(u("div",`${m}-item state ${o}`).on("click.stop",()=>this.filterClick(n,i)).children(i===""?T("filter.empty"):i,u("div","label").html(`(${r})`)))})}function Dt(){const{filterhEl:l,filterValues:e,values:t}=this;l.html(`${e.length} / ${t.length}`),l.checked(e.length===t.length)}class hl{constructor(){this.filterbEl=u("div",`${m}-body`),this.filterhEl=u("div",`${m}-header state`).on("click.stop",()=>this.filterClick(0,"all")),this.el=u("div",`${m}-sort-filter`).children(this.sortAscEl=Tt.call(this,"asc"),this.sortDescEl=Tt.call(this,"desc"),Zt("divider"),u("div",`${m}-filter`).children(this.filterhEl,this.filterbEl),u("div",`${m}-buttons`).children(new Y("cancel").on("click",()=>this.btnClick("cancel")),new Y("ok","primary").on("click",()=>this.btnClick("ok")))).hide(),this.ci=null,this.sortDesc=null,this.values=null,this.filterValues=[]}btnClick(e){if(e==="ok"){const{ci:t,sort:s,filterValues:i}=this;this.ok&&this.ok(t,s,"in",i)}this.hide()}itemClick(e){this.sort=e;const{sortAscEl:t,sortDescEl:s}=this;t.checked(e==="asc"),s.checked(e==="desc")}filterClick(e,t){const{filterbEl:s,filterValues:i,values:n}=this,r=s.children();t==="all"?r.length===i.length?(this.filterValues=[],r.forEach(o=>u(o).checked(!1))):(this.filterValues=Array.from(n),r.forEach(o=>u(o).checked(!0))):u(r[e]).toggle("checked")?i.push(t):i.splice(i.findIndex(c=>c===t),1),Dt.call(this)}set(e,t,s,i){this.ci=e;const{sortAscEl:n,sortDescEl:r}=this;i!==null?(this.sort=i.order,n.checked(i.asc()),r.checked(i.desc())):(this.sortDesc=null,n.checked(!1),r.checked(!1)),this.values=Object.keys(t),this.filterValues=s?Array.from(s.value):Object.keys(t),cl.call(this,t,s),Dt.call(this)}setOffset(e){this.el.offset(e).show();let t=1;re(this.el,()=>{t<=0&&this.hide(),t-=1})}show(){this.el.show()}hide(){this.el.hide(),te(this.el)}}function Jt(l,e){const t=u("div",`${m}-toast`),s=u("div",`${m}-dimmer active`),i=()=>{document.body.removeChild(t.el),document.body.removeChild(s.el)};t.children(u("div",`${m}-toast-header`).children(new D("close").on("click.stop",()=>i()),l),u("div",`${m}-toast-content`).html(e)),document.body.appendChild(t.el),document.body.appendChild(s.el);const{width:n,height:r}=t.box(),{clientHeight:o,clientWidth:c}=document.documentElement;t.offset({left:(c-n)/2,top:(o-r)/3})}function Ie(l,e){let t;return(...s)=>{const i=this,n=s;t||(t=setTimeout(()=>{t=null,l.apply(i,n)},e))}}function al(){const{data:l,verticalScrollbar:e,horizontalScrollbar:t}=this,{l:s,t:i,left:n,top:r,width:o,height:c}=l.getSelectedRect(),h=this.getTableOffset();if(Math.abs(n)+o>h.width)t.move({left:s+o-h.width});else{const d=l.freezeTotalWidth();n<d&&t.move({left:s-1-d})}if(Math.abs(r)+c>h.height)e.move({top:i+c-h.height-1});else{const d=l.freezeTotalHeight();r<d&&e.move({top:i-1-d})}}function X(l,e,t,s=!0,i=!1){if(e===-1&&t===-1)return;const{table:n,selector:r,toolbar:o,data:c,contextMenu:h}=this;h.setMode(e===-1||t===-1?"row-col":"range");const d=c.getCell(e,t);l?(r.setEnd(e,t,i),this.trigger("cells-selected",d,r.range)):(r.set(e,t,s),this.trigger("cell-selected",d,e,t)),o.reset(),n.render()}function H(l,e){const{selector:t,data:s}=this,{rows:i,cols:n}=s;let[r,o]=t.indexes;const{eri:c,eci:h}=t.range;l&&([r,o]=t.moveIndexes),e==="left"?o>0&&(o-=1):e==="right"?(h!==o&&(o=h),o<n.len-1&&(o+=1)):e==="up"?r>0&&(r-=1):e==="down"?(c!==r&&(r=c),r<i.len-1&&(r+=1)):e==="row-first"?o=0:e==="row-last"?o=n.len-1:e==="col-first"?r=0:e==="col-last"&&(r=i.len-1),l&&(t.moveIndexes=[r,o]),X.call(this,l,r,o),al.call(this)}function dl(l){if(l.buttons!==0||l.target.className===`${m}-resizer-hover`)return;const{offsetX:e,offsetY:t}=l,{rowResizer:s,colResizer:i,tableEl:n,data:r}=this,{rows:o,cols:c}=r;if(e>c.indexWidth&&t>o.height){s.hide(),i.hide();return}const h=n.box(),d=r.getCellRectByXY(l.offsetX,l.offsetY);d.ri>=0&&d.ci===-1?(d.width=c.indexWidth,s.show(d,{width:h.width}),o.isHide(d.ri-1)?s.showUnhide(d.ri):s.hideUnhide()):s.hide(),d.ri===-1&&d.ci>=0?(d.height=o.height,i.show(d,{height:h.height}),c.isHide(d.ci-1)?i.showUnhide(d.ci):i.hideUnhide()):i.hide()}function fl(l){const{verticalScrollbar:e,horizontalScrollbar:t,data:s}=this,{top:i}=e.scroll(),{left:n}=t.scroll(),{rows:r,cols:o}=s,{deltaY:c,deltaX:h}=l,d=(x,b)=>{let k=x,v=0;do v=b(k),k+=1;while(v<=0);return v},a=x=>{if(x>0){const b=s.scroll.ri+1;if(b<r.len){const k=d(b,v=>r.getHeight(v));e.move({top:i+k-1})}}else{const b=s.scroll.ri-1;if(b>=0){const k=d(b,v=>r.getHeight(v));e.move({top:b===0?0:i-k})}}},f=x=>{if(x>0){const b=s.scroll.ci+1;if(b<o.len){const k=d(b,v=>o.getWidth(v));t.move({left:n+k-1})}}else{const b=s.scroll.ci-1;if(b>=0){const k=d(b,v=>o.getWidth(v));t.move({left:b===0?0:n-k})}}},g=Math.abs(c),p=Math.abs(h),w=Math.max(g,p);/Firefox/i.test(window.navigator.userAgent)&&Ie(a(l.detail),50),w===p&&Ie(f(h),50),w===g&&Ie(a(c),50)}function ul(l,e){const{verticalScrollbar:t,horizontalScrollbar:s}=this,{top:i}=t.scroll(),{left:n}=s.scroll();l==="left"||l==="right"?s.move({left:n-e}):(l==="up"||l==="down")&&t.move({top:i-e})}function Je(){const{data:l,verticalScrollbar:e}=this,{height:t}=this.getTableOffset(),s=l.exceptRowTotalHeight(0,-1);e.set(t,l.rows.totalHeight()-s)}function Ge(){const{data:l,horizontalScrollbar:e}=this,{width:t}=this.getTableOffset();l&&e.set(t,l.cols.totalWidth())}function gl(){const{selector:l,data:e,editor:t}=this,[s,i]=e.freeze;if(s>0||i>0){const n=e.freezeTotalWidth(),r=e.freezeTotalHeight();t.setFreezeLengths(n,r)}l.resetAreaOffset()}function A(){const{tableEl:l,overlayerEl:e,overlayerCEl:t,table:s,toolbar:i,selector:n,el:r}=this,o=this.getTableOffset(),c=this.getRect();l.attr(c),e.offset(c),t.offset(o),r.css("width",`${c.width}px`),Je.call(this),Ge.call(this),gl.call(this),s.render(),i.reset(),n.reset()}function oe(){const{data:l,selector:e}=this;l.clearClipboard(),e.hideClipboard()}function Ve(){const{data:l,selector:e}=this;l.copy(),l.copyToSystemClipboard(),e.showClipboard()}function Ot(){const{data:l,selector:e}=this;l.cut(),e.showClipboard()}function le(l,e){const{data:t}=this;if(t.settings.mode!=="read"){if(t.paste(l,s=>Jt("Tip",s)))A.call(this);else if(e){const s=e.clipboardData.getData("text/plain");this.data.pasteFromText(s),A.call(this)}}}function pl(){this.data.hideRowsOrCols(),A.call(this)}function zt(l,e){this.data.unhideRowsOrCols(l,e),A.call(this)}function ml(){const{data:l}=this;l.autofilter(),A.call(this)}function wl(){const{toolbar:l}=this;l.paintformatActive()&&(le.call(this,"format"),oe.call(this),l.paintformatToggle())}function At(l){const{selector:e,data:t,table:s,sortFilter:i}=this,{offsetX:n,offsetY:r}=l,o=l.target.className===`${m}-selector-corner`,c=t.getCellRectByXY(n,r),{left:h,top:d,width:a,height:f}=c;let{ri:g,ci:p}=c;const{autoFilter:w}=t;if(w.includes(g,p)&&h+a-20<n&&d+f-20<r){const x=w.items(p,(b,k)=>t.rows.getCell(b,k));i.hide(),i.set(p,x,w.getFilter(p),w.getSort(p)),i.setOffset({left:h,top:d+f+2});return}l.shiftKey||(o?e.showAutofill(g,p):X.call(this,!1,g,p),Wt(window,x=>{({ri:g,ci:p}=t.getCellRectByXY(x.offsetX,x.offsetY)),o?e.showAutofill(g,p):x.buttons===1&&!x.shiftKey&&X.call(this,!0,g,p,!0,!0)},()=>{o&&e.arange&&t.settings.mode!=="read"&&t.autofill(e.arange,"all",x=>Jt("Tip",x))&&s.render(),e.hideAutofill(),wl.call(this)})),!o&&l.buttons===1&&l.shiftKey&&X.call(this,!0,g,p)}function ce(){const{editor:l,data:e}=this,t=e.getSelectedRect(),s=this.getTableOffset();let i="top";t.top>s.height/2&&(i="bottom"),l.setOffset(t,i)}function ne(){const{editor:l,data:e}=this;e.settings.mode!=="read"&&(ce.call(this),l.setCell(e.getSelectedCell(),e.getSelectedValidator()),oe.call(this))}function bl(l){const{data:e,table:t,selector:s}=this;e.scrolly(l,()=>{s.resetBRLAreaOffset(),ce.call(this),t.render()})}function xl(l){const{data:e,table:t,selector:s}=this;e.scrollx(l,()=>{s.resetBRTAreaOffset(),ce.call(this),t.render()})}function vl(l,e){const{ri:t}=l,{table:s,selector:i,data:n}=this;n.rows.setHeight(t,e),s.render(),i.resetAreaOffset(),Je.call(this),ce.call(this)}function yl(l,e){const{ci:t}=l,{table:s,selector:i,data:n}=this;n.cols.setWidth(t,e),s.render(),i.resetAreaOffset(),Ge.call(this),ce.call(this)}function Re(l,e="finished"){const{data:t,table:s}=this;if(t.settings.mode==="read")return;t.setSelectedCellText(l,e);const{ri:i,ci:n}=t.selector;e==="finished"?s.render():this.trigger("cell-edited",l,i,n)}function ve(l){const{data:e}=this;e.settings.mode!=="read"&&(l==="insert-row"?e.insert("row"):l==="delete-row"?e.delete("row"):l==="insert-column"?e.insert("column"):l==="delete-column"?e.delete("column"):l==="delete-cell"?e.deleteCell():l==="delete-cell-format"?e.deleteCell("format"):l==="delete-cell-text"?e.deleteCell("text"):l==="cell-printable"?e.setSelectedCellAttr("printable",!0):l==="cell-non-printable"?e.setSelectedCellAttr("printable",!1):l==="cell-editable"?e.setSelectedCellAttr("editable",!0):l==="cell-non-editable"&&e.setSelectedCellAttr("editable",!1),oe.call(this),A.call(this))}function kl(l,e){const{data:t}=this;if(l==="undo")this.undo();else if(l==="redo")this.redo();else if(l==="print")this.print.preview();else if(l==="paintformat")e===!0?Ve.call(this):oe.call(this);else if(l==="clearformat")ve.call(this,"delete-cell-format");else if(l!=="link"){if(l!=="chart")if(l==="autofilter")ml.call(this);else if(l==="freeze")if(e){const{ri:s,ci:i}=t.selector;this.freeze(s,i)}else this.freeze(0,0);else t.setSelectedCellAttr(l,e),l==="formula"&&!t.selector.multiple()&&ne.call(this),A.call(this)}}function Cl(l,e,t,s){this.data.setAutoFilter(l,e,t,s),A.call(this)}function El(){const{selector:l,overlayerEl:e,rowResizer:t,colResizer:s,verticalScrollbar:i,horizontalScrollbar:n,editor:r,contextMenu:o,toolbar:c,modalValidation:h,sortFilter:d}=this;e.on("mousemove",a=>{dl.call(this,a)}).on("mousedown",a=>{r.clear(),o.hide(),a.buttons===2?(this.data.xyInSelectedRect(a.offsetX,a.offsetY)||At.call(this,a),o.setPosition(a.offsetX,a.offsetY),a.stopPropagation()):a.detail===2?ne.call(this):At.call(this,a)}).on("mousewheel.stop",a=>{fl.call(this,a)}).on("mouseout",a=>{const{offsetX:f,offsetY:g}=a;g<=0&&s.hide(),f<=0&&t.hide()}),l.inputChange=a=>{Re.call(this,a,"input"),ne.call(this)},As(e.el,{move:(a,f)=>{ul.call(this,a,f)}}),c.change=(a,f)=>kl.call(this,a,f),d.ok=(a,f,g,p)=>Cl.call(this,a,f,g,p),t.finishedFn=(a,f)=>{vl.call(this,a,f)},s.finishedFn=(a,f)=>{yl.call(this,a,f)},t.unhideFn=a=>{zt.call(this,"row",a)},s.unhideFn=a=>{zt.call(this,"col",a)},i.moveFn=(a,f)=>{bl.call(this,a,f)},n.moveFn=(a,f)=>{xl.call(this,a,f)},r.change=(a,f)=>{Re.call(this,f,a)},h.change=(a,...f)=>{a==="save"?this.data.addValidation(...f):this.data.removeValidation()},o.itemClick=a=>{a==="validation"?h.setValue(this.data.getSelectedValidation()):a==="copy"?Ve.call(this):a==="cut"?Ot.call(this):a==="paste"?le.call(this,"all"):a==="paste-value"?le.call(this,"text"):a==="paste-format"?le.call(this,"format"):a==="hide"?pl.call(this):ve.call(this,a)},I(window,"resize",()=>{this.reload()}),I(window,"click",a=>{this.focusing=e.contains(a.target)}),I(window,"paste",a=>{!this.focusing||(le.call(this,"all",a),a.preventDefault())}),I(window,"keydown",a=>{if(!this.focusing)return;const f=a.keyCode||a.which,{key:g,ctrlKey:p,shiftKey:w,metaKey:x}=a;if(p||x)switch(f){case 90:this.undo(),a.preventDefault();break;case 89:this.redo(),a.preventDefault();break;case 67:Ve.call(this),a.preventDefault();break;case 88:Ot.call(this),a.preventDefault();break;case 85:c.trigger("underline"),a.preventDefault();break;case 86:break;case 37:H.call(this,w,"row-first"),a.preventDefault();break;case 38:H.call(this,w,"col-first"),a.preventDefault();break;case 39:H.call(this,w,"row-last"),a.preventDefault();break;case 40:H.call(this,w,"col-last"),a.preventDefault();break;case 32:X.call(this,!1,-1,this.data.selector.ci,!1),a.preventDefault();break;case 66:c.trigger("bold");break;case 73:c.trigger("italic");break}else{switch(f){case 32:w&&X.call(this,!1,this.data.selector.ri,-1,!1);break;case 27:o.hide(),oe.call(this);break;case 37:H.call(this,w,"left"),a.preventDefault();break;case 38:H.call(this,w,"up"),a.preventDefault();break;case 39:H.call(this,w,"right"),a.preventDefault();break;case 40:H.call(this,w,"down"),a.preventDefault();break;case 9:r.clear(),H.call(this,!1,w?"left":"right"),a.preventDefault();break;case 13:r.clear(),H.call(this,!1,w?"up":"down"),a.preventDefault();break;case 8:ve.call(this,"delete-cell-text"),a.preventDefault();break}g==="Delete"?(ve.call(this,"delete-cell-text"),a.preventDefault()):f>=65&&f<=90||f>=48&&f<=57||f>=96&&f<=105||a.key==="="?(Re.call(this,a.key,"input"),ne.call(this)):f===113&&ne.call(this)}})}class Sl{constructor(e,t){this.eventMap=Is();const{view:s,showToolbar:i,showContextmenu:n}=t.settings;this.el=u("div",`${m}-sheet`),this.toolbar=new ll(t,s.width,!i),this.print=new gi(t),e.children(this.toolbar.el,this.el,this.print.el),this.data=t,this.tableEl=u("canvas",`${m}-table`),this.rowResizer=new ut(!1,t.rows.height),this.colResizer=new ut(!0,t.cols.minWidth),this.verticalScrollbar=new gt(!0),this.horizontalScrollbar=new gt(!1),this.editor=new Zs(ii,()=>this.getTableOffset(),t.rows.height),this.modalValidation=new ol,this.contextMenu=new bi(()=>this.getRect(),!n),this.selector=new Ms(t),this.overlayerCEl=u("div",`${m}-overlayer-content`).children(this.editor.el,this.selector.el),this.overlayerEl=u("div",`${m}-overlayer`).child(this.overlayerCEl),this.sortFilter=new hl,this.el.children(this.tableEl,this.overlayerEl.el,this.rowResizer.el,this.colResizer.el,this.verticalScrollbar.el,this.horizontalScrollbar.el,this.contextMenu.el,this.modalValidation.el,this.sortFilter.el),this.table=new di(this.tableEl.el,t),El.call(this),A.call(this),X.call(this,!1,0,0)}on(e,t){return this.eventMap.on(e,t),this}trigger(e,...t){const{eventMap:s}=this;s.fire(e,t)}resetData(e){this.editor.clear(),this.data=e,Je.call(this),Ge.call(this),this.toolbar.resetData(e),this.print.resetData(e),this.selector.resetData(e),this.table.resetData(e)}loadData(e){return this.data.setData(e),A.call(this),this}freeze(e,t){const{data:s}=this;return s.setFreeze(e,t),A.call(this),this}undo(){this.data.undo(),A.call(this)}redo(){this.data.redo(),A.call(this)}reload(){return A.call(this),this}getRect(){const{data:e}=this;return{width:e.viewWidth(),height:e.viewHeight()}}getTableOffset(){const{rows:e,cols:t}=this.data,{width:s,height:i}=this.getRect();return{width:s-t.indexWidth,height:i-e.height,left:t.indexWidth,top:e.height}}}class $l extends N{constructor(e){const t=new D("ellipsis");super(t,"auto",!1,"top-left"),this.contentClick=e}reset(e){const t=e.map((s,i)=>u("div",`${m}-item`).css("width","150px").css("font-weight","normal").on("click",()=>{this.contentClick(i),this.hide()}).child(s));this.setContentChildren(...t)}setTitle(){}}const Tl=[{key:"delete",title:E("contextmenu.deleteSheet")}];function Dl(l){return u("div",`${m}-item`).child(l.title()).on("click",()=>{this.itemClick(l.key),this.hide()})}function Ol(){return Tl.map(l=>Dl.call(this,l))}class zl{constructor(){this.el=u("div",`${m}-contextmenu`).css("width","160px").children(...Ol.call(this)).hide(),this.itemClick=()=>{}}hide(){const{el:e}=this;e.hide(),te(e)}setOffset(e){const{el:t}=this;t.offset(e),t.show(),re(t)}}class Al{constructor(e=()=>{},t=()=>{},s=()=>{},i=()=>{}){this.swapFunc=t,this.updateFunc=i,this.dataNames=[],this.activeEl=null,this.deleteEl=null,this.items=[],this.moreEl=new $l(n=>{this.clickSwap2(this.items[n])}),this.contextMenu=new zl,this.contextMenu.itemClick=s,this.el=u("div",`${m}-bottombar`).children(this.contextMenu.el,this.menuEl=u("ul",`${m}-menu`).child(u("li","").children(new D("add").on("click",()=>{e()}),u("span","").child(this.moreEl))))}addItem(e,t){this.dataNames.push(e);const s=u("li",t?"active":"").child(e);s.on("click",()=>{this.clickSwap2(s)}).on("contextmenu",i=>{const{offsetLeft:n,offsetHeight:r}=i.target;this.contextMenu.setOffset({left:n,bottom:r+1}),this.deleteEl=s}).on("dblclick",()=>{const i=s.html(),n=new ee("auto","");n.val(i),n.input.on("blur",({target:r})=>{const{value:o}=r,c=this.dataNames.findIndex(h=>h===i);this.renameItem(c,o)}),s.html("").child(n.el),n.focus()}),t&&this.clickSwap(s),this.items.push(s),this.menuEl.child(s),this.moreEl.reset(this.dataNames)}renameItem(e,t){this.dataNames.splice(e,1,t),this.moreEl.reset(this.dataNames),this.items[e].html("").child(t),this.updateFunc(e,t)}clear(){this.items.forEach(e=>{this.menuEl.removeChild(e.el)}),this.items=[],this.dataNames=[],this.moreEl.reset(this.dataNames)}deleteItem(){const{activeEl:e,deleteEl:t}=this;if(this.items.length>1){const s=this.items.findIndex(i=>i===t);if(this.items.splice(s,1),this.dataNames.splice(s,1),this.menuEl.removeChild(t.el),this.moreEl.reset(this.dataNames),e===t){const[i]=this.items;return this.activeEl=i,this.activeEl.toggle(),[s,0]}return[s,-1]}return[-1]}clickSwap2(e){const t=this.items.findIndex(s=>s===e);this.clickSwap(e),this.activeEl.toggle(),this.swapFunc(t)}clickSwap(e){this.activeEl!==null&&this.activeEl.toggle(),this.activeEl=e}}class Be{constructor(e,t={}){let s=e;this.options=it({showBottomBar:!0},t),this.sheetIndex=1,this.datas=[],typeof e=="string"&&(s=document.querySelector(e)),this.bottombar=this.options.showBottomBar?new Al(()=>{const n=this.addSheet();this.sheet.resetData(n)},n=>{const r=this.datas[n];this.sheet.resetData(r)},()=>{this.deleteSheet()},(n,r)=>{this.datas[n].name=r}):null,this.data=this.addSheet();const i=u("div",`${m}`).on("contextmenu",n=>n.preventDefault());s.appendChild(i.el),this.sheet=new Sl(i,this.data),this.bottombar!==null&&i.child(this.bottombar.el)}addSheet(e,t=!0){const s=e||`sheet${this.sheetIndex}`,i=new zs(s,this.options);return i.change=(...n)=>{this.sheet.trigger("change",...n)},this.datas.push(i),this.bottombar!==null&&this.bottombar.addItem(s,t),this.sheetIndex+=1,i}deleteSheet(){if(this.bottombar===null)return;const[e,t]=this.bottombar.deleteItem();e>=0&&(this.datas.splice(e,1),t>=0&&this.sheet.resetData(this.datas[t]))}loadData(e){const t=Array.isArray(e)?e:[e];if(this.bottombar!==null&&this.bottombar.clear(),this.datas=[],t.length>0)for(let s=0;s<t.length;s+=1){const i=t[s],n=this.addSheet(i.name,s===0);n.setData(i),s===0&&this.sheet.resetData(n)}return this}getData(){return this.datas.map(e=>e.getData())}cellText(e,t,s,i=0){return this.datas[i].setCellText(e,t,s,"finished"),this}cell(e,t,s=0){return this.datas[s].getCell(e,t)}cellStyle(e,t,s=0){return this.datas[s].getCellStyle(e,t)}reRender(){return this.sheet.table.render(),this}on(e,t){return this.sheet.on(e,t),this}validate(){const{validations:e}=this.data;return e.errors.size<=0}change(e){return this.sheet.on("change",e),this}static locale(e,t){Mt(e,t)}}const Il=(l,e={})=>new Be(l,e);window&&(window.x_spreadsheet=Il,window.x_spreadsheet.locale=(l,e)=>Mt(l,e));(function(l){var e={};function t(s){if(e[s])return e[s].exports;var i=e[s]={i:s,l:!1,exports:{}};return l[s].call(i.exports,i,i.exports,t),i.l=!0,i.exports}t.m=l,t.c=e,t.d=function(s,i,n){t.o(s,i)||Object.defineProperty(s,i,{enumerable:!0,get:n})},t.r=function(s){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(s,"__esModule",{value:!0})},t.t=function(s,i){if(1&i&&(s=t(s)),8&i||4&i&&typeof s=="object"&&s&&s.__esModule)return s;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:s}),2&i&&typeof s!="string")for(var r in s)t.d(n,r,function(o){return s[o]}.bind(null,r));return n},t.n=function(s){var i=s&&s.__esModule?function(){return s.default}:function(){return s};return t.d(i,"a",i),i},t.o=function(s,i){return Object.prototype.hasOwnProperty.call(s,i)},t.p="",t(t.s=3)})({3:function(l,e,t){t.r(e);const s={toolbar:{undo:"\u64A4\u9500",redo:"\u6062\u590D",print:"\u6253\u5370",paintformat:"\u683C\u5F0F\u5237",clearformat:"\u6E05\u9664\u683C\u5F0F",format:"\u6570\u636E\u683C\u5F0F",fontName:"\u5B57\u4F53",fontSize:"\u5B57\u53F7",fontBold:"\u52A0\u7C97",fontItalic:"\u503E\u659C",underline:"\u4E0B\u5212\u7EBF",strike:"\u5220\u9664\u7EBF",color:"\u5B57\u4F53\u989C\u8272",bgcolor:"\u586B\u5145\u989C\u8272",border:"\u8FB9\u6846",merge:"\u5408\u5E76\u5355\u5143\u683C",align:"\u6C34\u5E73\u5BF9\u9F50",valign:"\u5782\u76F4\u5BF9\u9F50",textwrap:"\u81EA\u52A8\u6362\u884C",freeze:"\u51BB\u7ED3",autofilter:"\u81EA\u52A8\u7B5B\u9009",formula:"\u51FD\u6570",more:"\u66F4\u591A"},contextmenu:{copy:"\u590D\u5236",cut:"\u526A\u5207",paste:"\u7C98\u8D34",pasteValue:"\u7C98\u8D34\u6570\u636E",pasteFormat:"\u7C98\u8D34\u683C\u5F0F",hide:"\u9690\u85CF",insertRow:"\u63D2\u5165\u884C",insertColumn:"\u63D2\u5165\u5217",deleteSheet:"\u5220\u9664",deleteRow:"\u5220\u9664\u884C",deleteColumn:"\u5220\u9664\u5217",deleteCell:"\u5220\u9664",deleteCellText:"\u5220\u9664\u6570\u636E",validation:"\u6570\u636E\u9A8C\u8BC1",cellprintable:"\u53EF\u6253\u5370",cellnonprintable:"\u4E0D\u53EF\u6253\u5370",celleditable:"\u53EF\u7F16\u8F91",cellnoneditable:"\u4E0D\u53EF\u7F16\u8F91"},print:{size:"\u7EB8\u5F20\u5927\u5C0F",orientation:"\u65B9\u5411",orientations:["\u6A2A\u5411","\u7EB5\u5411"]},format:{normal:"\u6B63\u5E38",text:"\u6587\u672C",number:"\u6570\u503C",percent:"\u767E\u5206\u6BD4",rmb:"\u4EBA\u6C11\u5E01",usd:"\u7F8E\u5143",eur:"\u6B27\u5143",date:"\u77ED\u65E5\u671F",time:"\u65F6\u95F4",datetime:"\u957F\u65E5\u671F",duration:"\u6301\u7EED\u65F6\u95F4"},formula:{sum:"\u6C42\u548C",average:"\u6C42\u5E73\u5747\u503C",max:"\u6C42\u6700\u5927\u503C",min:"\u6C42\u6700\u5C0F\u503C",concat:"\u5B57\u7B26\u62FC\u63A5",_if:"\u6761\u4EF6\u5224\u65AD",and:"\u548C",or:"\u6216"},validation:{required:"\u6B64\u503C\u5FC5\u586B",notMatch:"\u6B64\u503C\u4E0D\u5339\u914D\u9A8C\u8BC1\u89C4\u5219",between:"\u6B64\u503C\u5E94\u5728 {} \u548C {} \u4E4B\u95F4",notBetween:"\u6B64\u503C\u4E0D\u5E94\u5728 {} \u548C {} \u4E4B\u95F4",notIn:"\u6B64\u503C\u4E0D\u5728\u5217\u8868\u4E2D",equal:"\u6B64\u503C\u5E94\u8BE5\u7B49\u4E8E {}",notEqual:"\u6B64\u503C\u4E0D\u5E94\u8BE5\u7B49\u4E8E {}",lessThan:"\u6B64\u503C\u5E94\u8BE5\u5C0F\u4E8E {}",lessThanEqual:"\u6B64\u503C\u5E94\u8BE5\u5C0F\u4E8E\u7B49\u4E8E {}",greaterThan:"\u6B64\u503C\u5E94\u8BE5\u5927\u4E8E {}",greaterThanEqual:"\u6B64\u503C\u5E94\u8BE5\u5927\u4E8E\u7B49\u4E8E {}"},error:{pasteForMergedCell:"\u65E0\u6CD5\u5BF9\u5408\u5E76\u7684\u5355\u5143\u683C\u6267\u884C\u6B64\u64CD\u4F5C"},calendar:{weeks:["\u65E5","\u4E00","\u4E8C","\u4E09","\u56DB","\u4E94","\u516D"],months:["\u4E00\u6708","\u4E8C\u6708","\u4E09\u6708","\u56DB\u6708","\u4E94\u6708","\u516D\u6708","\u4E03\u6708","\u516B\u6708","\u4E5D\u6708","\u5341\u6708","\u5341\u4E00\u6708","\u5341\u4E8C\u6708"]},button:{next:"\u4E0B\u4E00\u6B65",cancel:"\u53D6\u6D88",remove:"\u5220\u9664",save:"\u4FDD\u5B58",ok:"\u786E\u8BA4"},sort:{desc:"\u964D\u5E8F",asc:"\u5347\u5E8F"},filter:{empty:"\u7A7A\u767D"},dataValidation:{mode:"\u6A21\u5F0F",range:"\u5355\u5143\u533A\u95F4",criteria:"\u6761\u4EF6",modeType:{cell:"\u5355\u5143\u683C",column:"\u5217\u6A21\u5F0F",row:"\u884C\u6A21\u5F0F"},type:{list:"\u5217\u8868",number:"\u6570\u5B57",date:"\u65E5\u671F",phone:"\u624B\u673A\u53F7",email:"\u7535\u5B50\u90AE\u4EF6"},operator:{be:"\u5728\u533A\u95F4",nbe:"\u4E0D\u5728\u533A\u95F4",lt:"\u5C0F\u4E8E",lte:"\u5C0F\u4E8E\u7B49\u4E8E",gt:"\u5927\u4E8E",gte:"\u5927\u4E8E\u7B49\u4E8E",eq:"\u7B49\u4E8E",neq:"\u4E0D\u7B49\u4E8E"}}};window&&window.x_spreadsheet&&(window.x_spreadsheet.$messages=window.x_spreadsheet.$messages||{},window.x_spreadsheet.$messages["zh-cn"]=s),e.default=s}});const Hl={setup(l){Be.locale("zh-cn");const e=lt(null);let t=null,s=-1,i=-1;const n=lt(null);let r=null;ss(()=>{if(t=new Be(e.value,{showToolbar:!1,showBottomBar:!1,view:{height:()=>375,width:()=>400},row:{len:10,height:30},col:{len:3,width:100}}),t.loadData({rows:{0:{cells:{0:{text:"Mon"},1:{text:"100"},2:{text:"80"}}},1:{cells:{0:{text:"Tue"},1:{text:"200"},2:{text:"160"}}},2:{cells:{0:{text:"Wed"},1:{text:"300"},2:{text:"240"}}},3:{cells:{0:{text:"Thu"},1:{text:"400"},2:{text:"320"}}},4:{cells:{0:{text:"Fri"},1:{text:"500"},2:{text:"400"}}},5:{cells:{0:{text:"Sat"},1:{text:"600"},2:{text:"480"}}},6:{cells:{0:{text:"Sun"},1:{text:"700"},2:{text:"560"}}}}}),t.on("cell-selected",(h,d,a)=>{s=a,i=d,console.log(`\u9009\u4E2D: \u884C ${d}, \u5217 ${a}`)}),t.on("cell-edited",(h,d,a)=>{let f=t.getData()[0].rows.len;d==f-1&&o("row",s,i,1)}),n.value){r=ts(n.value);const h={tooltip:{},xAxis:{},yAxis:{type:"value"},series:[]};r.setOption(h)}document.addEventListener("keydown",h=>{if(h.key==="Tab"){let d=t.getData()[0].cols.len;s===d-1&&(h.preventDefault(),o("column",s,i,1))}})}),is(()=>{t.value=null,r!=null&&r.dispose()});function o(h,d,a,f=1){let{datas:g}=t;g[0].changeData(()=>{const{rows:w,merges:x,cols:b}=g[0];let k=a;h==="row"?w.insert(a+1,f):h==="column"&&(w.insertColumn(d+1,f),k=d,b.len+=f,Object.keys(b._).reverse().forEach(v=>{const y=parseInt(v,10);y>=sci&&(b._[y+f]=b._[y],delete b._[y])})),x.shift(h,k,f,(v,y,S,R)=>{const O=w.getCell(v,y);O.merge[0]+=S,O.merge[1]+=R})});const p=t.getData();t.sheet.loadData(p)}function c(){let h=t.getData(),d=[],a=[];for(let g in h[0].rows)if(g!=="len"){let p=h[0].rows[g].cells;for(let w in p)w==="0"?d.push(p[w].text):a[+w-1]?a[+w-1].data.push(p[+w].text):a.push({data:[p[+w].text],type:"line"})}console.log(d),console.log(a);let f={xAxis:{type:"category",data:d},series:a};r.setOption(f)}return(h,d)=>(ns(),ls("div",null,[De("button",{onClick:d[0]||(d[0]=a=>c())},"\u66F4\u65B0\u8868\u683C"),De("div",{ref_key:"spreadsheetContainer",ref:e,style:{width:"400px",height:"375px"}},null,512),De("div",{ref_key:"chartRef",ref:n,style:{width:"600px",height:"400px"}},null,512)]))}};export{Hl as default};
//# sourceMappingURL=index.d22614d3.js.map
