import{h as r,f as H,c as u,a as n,j as f,u as D,m as I,v as M,F as O,d as Z,p as k,t as g,o as d}from"../index-C51a6HNj.js";import{S as $,C as J,M as K,F as Q,D as W,s as X,r as Y,g as _,c as h,t as tt,d as nt,a as et,b as lt,f as st}from"./register_all_kernels-BcsGZHQr.js";import{_ as at}from"./plugin-vue_export-helper-DlAUqK2U.js";import"./commonjsHelpers-CE1G-McA.js";/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function ot(a){return new $(a)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function rt(a){return new J(a)}function R(a){return new W(a)}function it(a){return new Q(a)}function ut(a){return new K(a)}const dt={class:"tensorflow"},pt=["href"],mt={class:"demo1"},ft={class:"upload-container"},gt=["src"],vt={key:0},ct={key:1},yt={key:0},p=64,wt={__name:"tensorflow-categorize",setup(a){const T=new URL("/assets/zip/%E5%9B%BE%E5%83%8F%E8%B5%84%E6%BA%90-fw9v4dpT.zip",import.meta.url).href,w=["cat","dog","pig","bird","aaa"];let S=null,i=null,b=null,m={images:[],labels:[]};const v=r(50),x=r(16),c=r(null),C=r(null),E=r(null),y=r(null),z=r([]);H(async()=>{await X("cpu"),await Y(),console.log("TF.js backend:",_())});async function V(e){const t=e.target.files;let l=[];for(const s of t){const o=s.name.split("_")[0],N=w.indexOf(o),{img:j,result:q}=await F(s);l.push({img:q,name:s.name});const G=B(j);m.images.push(G),m.labels.push(N)}z.value=l}async function F(e){return new Promise(t=>{const l=new FileReader;l.onload=s=>{const o=new Image;o.src=s.target.result,o.onload=()=>{t({img:o,result:s.target.result})}},l.readAsDataURL(e)})}function B(e){return et(()=>{const t=document.createElement("canvas");return t.width=p,t.height=p,t.getContext("2d").drawImage(e,0,0,p,p),st(t).toFloat().div(255).expandDims()})}async function A(){if(m.images.length===0){alert("请先上传图片！");return}i&&i.dispose(),i=L();const e=h(m.images),t=tt(m.labels,"float32");await i.fit(e,t,{epochs:+v.value,batchSize:+x.value,callbacks:{onEpochEnd:(l,s)=>{c.value=l,C.value=s}}}),nt([e,t])}function L(){const e=ot();return e.add(rt({inputShape:[p,p,3],filters:8,kernelSize:3,activation:"relu"})),e.add(ut({poolSize:2})),e.add(it()),e.add(R({units:16,activation:"relu"})),e.add(R({units:w.length+1,activation:"softmax"})),S=lt.adam(.001),e.compile({optimizer:S,loss:"sparseCategoricalCrossentropy",metrics:["accuracy"]}),e}function P(e){E.value.click()}async function U(e){const t=e.target.files[0];if(!i){alert("请先训练模型");return}if(!t){alert("请先上传测试图片");return}const{img:l,result:s}=await F(t);let o=B(l);b=i.predict(o),y.value=await b.argMax(1).data(),o.dispose()}return(e,t)=>(d(),u("div",dt,[t[21]||(t[21]=n("h1",null,"自定义图像分类器",-1)),n("div",null,[t[4]||(t[4]=n("span",{style:{color:"red"}},"注意：本案例仅供参考，因为图像资源对应的标签是写死的(标签是指图像名称，例如：bird_，cat_，...这些)，所以请下载本案例提供的图像资源",-1)),t[5]||(t[5]=n("br",null,null,-1)),n("span",null,[t[3]||(t[3]=f("这里提供图像资源 ")),n("a",{type:"download",href:D(T)},"图像资源",8,pt)])]),n("div",mt,[t[9]||(t[9]=n("span",null,"第一步：上传图像资源 ",-1)),n("input",{type:"file",id:"upload",multiple:"",accept:"image/*",onChange:V},null,32),t[10]||(t[10]=n("br",null,null,-1)),t[11]||(t[11]=n("span",null,"第二步：训练",-1)),n("button",{onClick:A},"开始训练"),t[12]||(t[12]=n("span",null,"轮次:",-1)),t[13]||(t[13]=f()),I(n("input",{type:"number","onUpdate:modelValue":t[0]||(t[0]=l=>v.value=l)},null,512),[[M,v.value]]),t[14]||(t[14]=n("span",null,"批次:",-1)),t[15]||(t[15]=f()),I(n("input",{type:"nmuber","onUpdate:modelValue":t[1]||(t[1]=l=>x.value=l)},null,512),[[M,x.value]]),t[16]||(t[16]=n("br",null,null,-1)),t[17]||(t[17]=n("span",null,"第三步：推理",-1)),n("button",{onClick:t[2]||(t[2]=l=>P())},"上传图像推理"),n("input",{ref_key:"testReason1",ref:E,type:"file",id:"test-reason1",accept:"image/*",style:{display:"none"},onChange:U},null,544),t[18]||(t[18]=n("br",null,null,-1)),n("ul",ft,[t[6]||(t[6]=n("span",null,"数据集：",-1)),(d(!0),u(O,null,Z(z.value,(l,s)=>(d(),u("li",{key:s,class:"upload-item"},[n("img",{src:l.img,alt:""},null,8,gt),n("span",null,g(l.name),1)]))),128))]),t[19]||(t[19]=n("br",null,null,-1)),n("div",null,[t[7]||(t[7]=f("训练状态： ")),c.value?(d(),u("span",vt,"训练中... 轮次 "+g(c.value+1)+", 准确率: "+g(C.value?.acc.toFixed(2)||"")+", ",1)):k("",!0),c.value+1===+v.value?(d(),u("span",ct,"训练成功")):k("",!0)]),t[20]||(t[20]=n("br",null,null,-1)),n("div",null,[t[8]||(t[8]=f("推理结果： ")),y.value?(d(),u("span",yt,g(w[y.value[0]])+" (置信度: "+g(D(b).dataSync()[y.value[0]].toFixed(2))+")",1)):k("",!0)])])]))}},Ct=at(wt,[["__scopeId","data-v-902aa519"]]);export{Ct as default};
