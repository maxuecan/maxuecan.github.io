import{g as sV}from"./_commonjsHelpers-CE1G-McA.js";import{_ as uV}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{h as s5,f as cV,n as lV,c as fV,a as $b,o as hV}from"./index-Bi08AWc0.js";const dV="/assets/bird-DL_WLVaH.png";var LA={exports:{}},u5;function pV(){return u5||(u5=1,function(zA,UA){(function(Oe,A){zA.exports=A()})(window,function(){return function(Oe){var A={};function o(b){if(A[b])return A[b].exports;var H=A[b]={i:b,l:!1,exports:{}};return Oe[b].call(H.exports,H,H.exports,o),H.l=!0,H.exports}return o.m=Oe,o.c=A,o.d=function(b,H,U){o.o(b,H)||Object.defineProperty(b,H,{configurable:!1,enumerable:!0,get:U})},o.r=function(b){Object.defineProperty(b,"__esModule",{value:!0})},o.n=function(b){var H=b&&b.__esModule?function(){return b.default}:function(){return b};return o.d(H,"a",H),H},o.o=function(b,H){return Object.prototype.hasOwnProperty.call(b,H)},o.p="/",o(o.s=581)}([function(Oe,A,o){o.r(A),(function(b,H,U,B){o.d(A,"AdadeltaOptimizer",function(){return Qe}),o.d(A,"AdagradOptimizer",function(){return ot}),o.d(A,"AdamOptimizer",function(){return vt}),o.d(A,"AdamaxOptimizer",function(){return bt}),o.d(A,"Add",function(){return Sl}),o.d(A,"AddN",function(){return jh}),o.d(A,"BroadcastTo",function(){return Ec}),o.d(A,"DataStorage",function(){return Nt}),o.d(A,"Div",function(){return Pa}),o.d(A,"ENV",function(){return ee}),o.d(A,"Environment",function(){return $}),o.d(A,"FromPixels",function(){return km}),o.d(A,"FusedBatchNorm",function(){return Bh}),o.d(A,"Identity",function(){return Sf}),o.d(A,"KernelBackend",function(){return Ut}),o.d(A,"MaxPoolWithArgmax",function(){return Il}),o.d(A,"MomentumOptimizer",function(){return Ft}),o.d(A,"NonMaxSuppressionV5",function(){return Kc}),o.d(A,"OneHot",function(){return Lh}),o.d(A,"Optimizer",function(){return Je}),o.d(A,"PadV2",function(){return Cc}),o.d(A,"RMSPropOptimizer",function(){return Yt}),o.d(A,"Rank",function(){return ge}),o.d(A,"Reduction",function(){return qo}),o.d(A,"SGDOptimizer",function(){return wt}),o.d(A,"Square",function(){return Ph}),o.d(A,"SquaredDifference",function(){return Dl}),o.d(A,"Tensor",function(){return jt}),o.d(A,"TensorBuffer",function(){return Wi}),o.d(A,"Tile",function(){return Nl}),o.d(A,"Transpose",function(){return Tl}),o.d(A,"Variable",function(){return mt}),o.d(A,"abs",function(){return Es}),o.d(A,"acos",function(){return Oc}),o.d(A,"acosh",function(){return Ro}),o.d(A,"add",function(){return eo}),o.d(A,"addN",function(){return Wf}),o.d(A,"addStrict",function(){return Bl}),o.d(A,"all",function(){return fp}),o.d(A,"any",function(){return ll}),o.d(A,"argMax",function(){return Yg}),o.d(A,"argMin",function(){return em}),o.d(A,"asin",function(){return Ac}),o.d(A,"asinh",function(){return Uu}),o.d(A,"atan",function(){return Df}),o.d(A,"atan2",function(){return Rf}),o.d(A,"atanh",function(){return Tf}),o.d(A,"avgPool",function(){return nd}),o.d(A,"avgPool3d",function(){return Hm}),o.d(A,"backend",function(){return xm}),o.d(A,"backend_util",function(){return $r}),o.d(A,"basicLSTMCell",function(){return Qg}),o.d(A,"batchNorm",function(){return ql}),o.d(A,"batchNorm2d",function(){return Rv}),o.d(A,"batchNorm3d",function(){return al}),o.d(A,"batchNorm4d",function(){return Hf}),o.d(A,"batchNormalization",function(){return ta}),o.d(A,"batchNormalization2d",function(){return Fv}),o.d(A,"batchNormalization3d",function(){return Hl}),o.d(A,"batchNormalization4d",function(){return Yh}),o.d(A,"batchToSpaceND",function(){return Ld}),o.d(A,"booleanMaskAsync",function(){return Lg}),o.d(A,"broadcastTo",function(){return $l}),o.d(A,"browser",function(){return ae}),o.d(A,"buffer",function(){return bi}),o.d(A,"cast",function(){return zd}),o.d(A,"ceil",function(){return Xc}),o.d(A,"clipByValue",function(){return Vd}),o.d(A,"clone",function(){return Gl}),o.d(A,"complex",function(){return fa}),o.d(A,"concat",function(){return Ba}),o.d(A,"concat1d",function(){return Fh}),o.d(A,"concat2d",function(){return Pd}),o.d(A,"concat3d",function(){return Al}),o.d(A,"concat4d",function(){return Rh}),o.d(A,"conv1d",function(){return Wg}),o.d(A,"conv2d",function(){return Jf}),o.d(A,"conv2dTranspose",function(){return Jp}),o.d(A,"conv3d",function(){return jv}),o.d(A,"conv3dTranspose",function(){return Vm}),o.d(A,"cos",function(){return Wu}),o.d(A,"cosh",function(){return Em}),o.d(A,"cumsum",function(){return Ud}),o.d(A,"customGrad",function(){return N}),o.d(A,"deprecationWarn",function(){return Cf}),o.d(A,"depthToSpace",function(){return Rp}),o.d(A,"depthwiseConv2d",function(){return Wm}),o.d(A,"diag",function(){return Zl}),o.d(A,"disableDeprecationWarnings",function(){return Np}),o.d(A,"dispose",function(){return Na}),o.d(A,"disposeVariables",function(){return Ol}),o.d(A,"div",function(){return Xa}),o.d(A,"divNoNan",function(){return Up}),o.d(A,"divStrict",function(){return nr}),o.d(A,"dot",function(){return qm}),o.d(A,"dropout",function(){return E0}),o.d(A,"elu",function(){return eh}),o.d(A,"enableDebugMode",function(){return Tp}),o.d(A,"enableProdMode",function(){return xu}),o.d(A,"engine",function(){return Id}),o.d(A,"env",function(){return L}),o.d(A,"equal",function(){return Kp}),o.d(A,"equalStrict",function(){return Pm}),o.d(A,"erf",function(){return qd}),o.d(A,"exp",function(){return Fl}),o.d(A,"expandDims",function(){return zu}),o.d(A,"expm1",function(){return jp}),o.d(A,"eye",function(){return Ic}),o.d(A,"fft",function(){return Mc}),o.d(A,"fill",function(){return ws}),o.d(A,"findBackend",function(){return Rd}),o.d(A,"findBackendFactory",function(){return Ip}),o.d(A,"floor",function(){return Nf}),o.d(A,"floorDiv",function(){return Go}),o.d(A,"frame",function(){return sm}),o.d(A,"fused",function(){return Tn}),o.d(A,"gather",function(){return cp}),o.d(A,"gatherND",function(){return am}),o.d(A,"gather_util",function(){return Eu}),o.d(A,"getBackend",function(){return bs}),o.d(A,"getGradient",function(){return K}),o.d(A,"getKernel",function(){return ie}),o.d(A,"getKernelsForBackend",function(){return he}),o.d(A,"grad",function(){return Pl}),o.d(A,"grads",function(){return Bf}),o.d(A,"greater",function(){return Lm}),o.d(A,"greaterEqual",function(){return sp}),o.d(A,"greaterEqualStrict",function(){return zm}),o.d(A,"greaterStrict",function(){return Xp}),o.d(A,"hammingWindow",function(){return nh}),o.d(A,"hannWindow",function(){return vp}),o.d(A,"ifft",function(){return Xo}),o.d(A,"imag",function(){return Uo}),o.d(A,"image",function(){return Xe}),o.d(A,"inTopKAsync",function(){return Ym}),o.d(A,"io",function(){return y}),o.d(A,"irfft",function(){return gp}),o.d(A,"isFinite",function(){return jl}),o.d(A,"isInf",function(){return Ff}),o.d(A,"isNaN",function(){return $d}),o.d(A,"keep",function(){return Dh}),o.d(A,"leakyRelu",function(){return dp}),o.d(A,"less",function(){return Mg}),o.d(A,"lessEqual",function(){return sl}),o.d(A,"lessEqualStrict",function(){return Mv}),o.d(A,"lessStrict",function(){return jg}),o.d(A,"linalg",function(){return S}),o.d(A,"linspace",function(){return Ih}),o.d(A,"localResponseNormalization",function(){return mp}),o.d(A,"log",function(){return Yc}),o.d(A,"log1p",function(){return Hd}),o.d(A,"logSigmoid",function(){return zh}),o.d(A,"logSoftmax",function(){return Ge}),o.d(A,"logSumExp",function(){return tm}),o.d(A,"logicalAnd",function(){return Tu}),o.d(A,"logicalNot",function(){return Jh}),o.d(A,"logicalOr",function(){return $f}),o.d(A,"logicalXor",function(){return ol}),o.d(A,"losses",function(){return Ir}),o.d(A,"matMul",function(){return dc}),o.d(A,"math",function(){return W}),o.d(A,"max",function(){return $m}),o.d(A,"maxPool",function(){return pc}),o.d(A,"maxPool3d",function(){return Qp}),o.d(A,"maxPoolWithArgmax",function(){return Gg}),o.d(A,"maximum",function(){return bo}),o.d(A,"maximumStrict",function(){return Hi}),o.d(A,"mean",function(){return Fc}),o.d(A,"memory",function(){return _h}),o.d(A,"min",function(){return nm}),o.d(A,"minimum",function(){return ku}),o.d(A,"minimumStrict",function(){return oc}),o.d(A,"mod",function(){return Vs}),o.d(A,"modStrict",function(){return sc}),o.d(A,"moments",function(){return Jg}),o.d(A,"movingAverage",function(){return Rc}),o.d(A,"mul",function(){return Ka}),o.d(A,"mulStrict",function(){return Vu}),o.d(A,"multiRNNCell",function(){return Pv}),o.d(A,"multinomial",function(){return ts}),o.d(A,"neg",function(){return yo}),o.d(A,"nextFrame",function(){return gn}),o.d(A,"norm",function(){return Km}),o.d(A,"notEqual",function(){return up}),o.d(A,"notEqualStrict",function(){return Bg}),o.d(A,"oneHot",function(){return fc}),o.d(A,"ones",function(){return uu}),o.d(A,"onesLike",function(){return us}),o.d(A,"op",function(){return xt}),o.d(A,"outerProduct",function(){return Hg}),o.d(A,"pad",function(){return Nu}),o.d(A,"pad1d",function(){return hu}),o.d(A,"pad2d",function(){return Qh}),o.d(A,"pad3d",function(){return Wp}),o.d(A,"pad4d",function(){return jm}),o.d(A,"pool",function(){return lp}),o.d(A,"pow",function(){return qs}),o.d(A,"powStrict",function(){return oa}),o.d(A,"prelu",function(){return rs}),o.d(A,"print",function(){return ro}),o.d(A,"prod",function(){return hp}),o.d(A,"profile",function(){return Sh}),o.d(A,"rand",function(){return Bm}),o.d(A,"randomGamma",function(){return Hp}),o.d(A,"randomNormal",function(){return Rg}),o.d(A,"randomUniform",function(){return $p}),o.d(A,"range",function(){return ac}),o.d(A,"ready",function(){return Fd}),o.d(A,"real",function(){return uo}),o.d(A,"reciprocal",function(){return Rl}),o.d(A,"registerBackend",function(){return Fp}),o.d(A,"registerGradient",function(){return Ae}),o.d(A,"registerKernel",function(){return pe}),o.d(A,"relu",function(){return rm}),o.d(A,"relu6",function(){return Gm}),o.d(A,"removeBackend",function(){return ic}),o.d(A,"reshape",function(){return ks}),o.d(A,"reverse",function(){return Yl}),o.d(A,"reverse1d",function(){return Bv}),o.d(A,"reverse2d",function(){return ed}),o.d(A,"reverse3d",function(){return td}),o.d(A,"reverse4d",function(){return Jl}),o.d(A,"rfft",function(){return id}),o.d(A,"round",function(){return Cs}),o.d(A,"rsqrt",function(){return Ml}),o.d(A,"scalar",function(){return fr}),o.d(A,"scatterND",function(){return Zg}),o.d(A,"scatter_util",function(){return Wh}),o.d(A,"selu",function(){return pp}),o.d(A,"separableConv2d",function(){return cl}),o.d(A,"serialization",function(){return Re}),o.d(A,"setBackend",function(){return Of}),o.d(A,"setPlatform",function(){return wm}),o.d(A,"setdiff1dAsync",function(){return Ni}),o.d(A,"sigmoid",function(){return If}),o.d(A,"sign",function(){return Uh}),o.d(A,"signal",function(){return Xm}),o.d(A,"sin",function(){return Gd}),o.d(A,"sinh",function(){return Kd}),o.d(A,"slice",function(){return ns}),o.d(A,"slice1d",function(){return Kg}),o.d(A,"slice2d",function(){return rd}),o.d(A,"slice3d",function(){return Xg}),o.d(A,"slice4d",function(){return Zp}),o.d(A,"slice_util",function(){return jf}),o.d(A,"softmax",function(){return Be}),o.d(A,"softplus",function(){return en}),o.d(A,"spaceToBatchND",function(){return $c}),o.d(A,"sparseToDense",function(){return ev}),o.d(A,"spectral",function(){return im}),o.d(A,"split",function(){return Ri}),o.d(A,"sqrt",function(){return Ws}),o.d(A,"square",function(){return Kl}),o.d(A,"squaredDifference",function(){return Gp}),o.d(A,"squaredDifferenceStrict",function(){return cs}),o.d(A,"squeeze",function(){return Rs}),o.d(A,"stack",function(){return tu}),o.d(A,"step",function(){return Un}),o.d(A,"stft",function(){return yp}),o.d(A,"stridedSlice",function(){return th}),o.d(A,"sub",function(){return _o}),o.d(A,"subStrict",function(){return ls}),o.d(A,"sum",function(){return fl}),o.d(A,"sumOutType",function(){return Jn}),o.d(A,"tan",function(){return Os}),o.d(A,"tanh",function(){return na}),o.d(A,"tensor",function(){return wa}),o.d(A,"tensor1d",function(){return zs}),o.d(A,"tensor2d",function(){return eu}),o.d(A,"tensor3d",function(){return Hc}),o.d(A,"tensor4d",function(){return Us}),o.d(A,"tensor5d",function(){return Nh}),o.d(A,"tensor6d",function(){return jd}),o.d(A,"tensor_util",function(){return Ot}),o.d(A,"test_util",function(){return Yf}),o.d(A,"tidy",function(){return Fi}),o.d(A,"tile",function(){return Kf}),o.d(A,"time",function(){return bm}),o.d(A,"topk",function(){return Lv}),o.d(A,"train",function(){return Jt}),o.d(A,"transpose",function(){return ft}),o.d(A,"truncatedNormal",function(){return Zh}),o.d(A,"unregisterGradient",function(){return je}),o.d(A,"unregisterKernel",function(){return Te}),o.d(A,"unsortedSegmentSum",function(){return Yp}),o.d(A,"unstack",function(){return Mh}),o.d(A,"util",function(){return Qr}),o.d(A,"valueAndGrad",function(){return Z}),o.d(A,"valueAndGrads",function(){return G}),o.d(A,"variable",function(){return Bd}),o.d(A,"variableGrads",function(){return C}),o.d(A,"version_core",function(){return Me}),o.d(A,"webgl",function(){return qe}),o.d(A,"where",function(){return Nc}),o.d(A,"whereAsync",function(){return Gf}),o.d(A,"zeros",function(){return Ki}),o.d(A,"zerosLike",function(){return ii});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var re=function(p,c){return(re=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var g in l)l.hasOwnProperty(g)&&(a[g]=l[g])})(p,c)};function J(p,c){function a(){this.constructor=p}re(p,c),p.prototype=c===null?Object.create(c):(a.prototype=c.prototype,new a)}function R(p,c,a,l){return new(a||(a=Promise))(function(g,_){function j(oe){try{ne(l.next(oe))}catch(me){_(me)}}function V(oe){try{ne(l.throw(oe))}catch(me){_(me)}}function ne(oe){oe.done?g(oe.value):new a(function(me){me(oe.value)}).then(j,V)}ne((l=l.apply(p,[])).next())})}function P(p,c){var a,l,g,_,j={label:0,sent:function(){if(1&g[0])throw g[1];return g[1]},trys:[],ops:[]};return _={next:V(0),throw:V(1),return:V(2)},typeof Symbol=="function"&&(_[Symbol.iterator]=function(){return this}),_;function V(ne){return function(oe){return function(me){if(a)throw new TypeError("Generator is already executing.");for(;j;)try{if(a=1,l&&(g=2&me[0]?l.return:me[0]?l.throw||((g=l.return)&&g.call(l),0):l.next)&&!(g=g.call(l,me[1])).done)return g;switch(l=0,g&&(me=[2&me[0],g.value]),me[0]){case 0:case 1:g=me;break;case 4:return j.label++,{value:me[1],done:!1};case 5:j.label++,l=me[1],me=[0];continue;case 7:me=j.ops.pop(),j.trys.pop();continue;default:if(!(g=(g=j.trys).length>0&&g[g.length-1])&&(me[0]===6||me[0]===2)){j=0;continue}if(me[0]===3&&(!g||me[1]>g[0]&&me[1]<g[3])){j.label=me[1];break}if(me[0]===6&&j.label<g[1]){j.label=g[1],g=me;break}if(g&&j.label<g[2]){j.label=g[2],j.ops.push(me);break}g[2]&&j.ops.pop(),j.trys.pop();continue}me=c.call(p,j)}catch(Ee){me=[6,Ee],l=0}finally{a=g=0}if(5&me[0])throw me[1];return{value:me[0]?me[1]:void 0,done:!0}}([ne,oe])}}}var $=function(){function p(c){this.global=c,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return p.prototype.setPlatform=function(c,a){this.platform!=null&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+a+"."),this.platformName=c,this.platform=a},p.prototype.registerFlag=function(c,a,l){if(this.flagRegistry[c]={evaluationFn:a,setHook:l},this.urlFlags[c]!=null){var g=this.urlFlags[c];console.warn("Setting feature override from URL "+c+": "+g+"."),this.set(c,g)}},p.prototype.get=function(c){return c in this.flags?this.flags[c]:(this.flags[c]=this.evaluateFlag(c),this.flags[c])},p.prototype.getNumber=function(c){return this.get(c)},p.prototype.getBool=function(c){return this.get(c)},p.prototype.getFlags=function(){return this.flags},Object.defineProperty(p.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),p.prototype.set=function(c,a){if(this.flagRegistry[c]==null)throw new Error("Cannot set flag "+c+" as it has not been registered.");this.flags[c]=a,this.flagRegistry[c].setHook!=null&&this.flagRegistry[c].setHook(a)},p.prototype.evaluateFlag=function(c){if(this.flagRegistry[c]==null)throw new Error("Cannot evaluate flag '"+c+"': no evaluation function found.");return this.flagRegistry[c].evaluationFn()},p.prototype.setFlags=function(c){this.flags=Object.assign({},c)},p.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},p.prototype.populateURLFlags=function(){var c=this;if(this.global!==void 0&&this.global.location!==void 0&&this.global.location.search!==void 0){var a,l,g=(a=this.global.location.search,l={},a.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(_){for(var j=[],V=1;V<arguments.length;V++)j[V-1]=arguments[V];return function(ne,oe,me){ne[decodeURIComponent(oe)]=decodeURIComponent(me||"")}(l,j[0],j[1]),j.join("=")}),l);"tfjsflags"in g&&g.tfjsflags.split(",").forEach(function(_){var j=_.split(":"),V=j[0],ne=j[1];c.urlFlags[V]=function(oe,me){if((me=me.toLowerCase())==="true"||me==="false")return me==="true";if(""+ +me===me)return+me;throw new Error("Could not parse value flag value "+me+" for flag "+oe+".")}(V,ne)})}},p}();function L(){return ee}var ee=null,F=new Map,ue=new Map;function ie(p,c){var a=ke(p,c);return F.get(a)}function K(p){return ue.get(p)}function he(p){for(var c=F.entries(),a=[];;){var l=c.next(),g=l.done,_=l.value;if(g)break;var j=_[0],V=_[1];j.split("_")[0]===p&&a.push(V)}return a}function pe(p){var c=p.kernelName,a=p.backendName,l=ke(c,a);if(F.has(l))throw new Error("The kernel '"+c+"' for backend '"+a+"' is already registered");F.set(l,p)}function Ae(p){var c=p.kernelName;ue.has(c)&&console.warn("Overriding the gradient for '"+c+"'"),ue.set(c,p)}function Te(p,c){var a=ke(p,c);if(!F.has(a))throw new Error("The kernel '"+p+"' for backend '"+c+"' is not registered");F.delete(a)}function je(p){if(!ue.has(p))throw new Error("The gradient '"+p+"' for backend is not registered");ue.delete(p)}function ke(p,c){return c+"_"+p}function at(p){for(var c=p.length,a=0,l=0;c>0;)l=Math.random()*c|0,a=p[--c],p[c]=p[l],p[l]=a}function St(p,c,a){return Math.max(p,Math.min(c,a))}function zt(p){return p%2==0?p:p+1}function $t(p){for(var c=0,a=0;a<p.length;a++)c+=p[a];return c}function we(p,c){if(!p)throw new Error(typeof c=="string"?c:c())}function Tt(p,c,a){a===void 0&&(a=""),we(ln(p,c),function(){return a+" Shapes "+p+" and "+c+" must match"})}function Gt(p){we(p!=null,function(){return"The input to the tensor constructor must be a non-null value."})}function Pt(p,c,a){if(c===void 0&&(c=[]),a===void 0&&(a=!1),c==null&&(c=[]),Array.isArray(p)||Et(p)&&!a)for(var l=0;l<p.length;++l)Pt(p[l],c,a);else c.push(p);return c}function Ye(p){if(p.length===0)return 1;for(var c=p[0],a=1;a<p.length;a++)c*=p[a];return c}function ln(p,c){if(p===c)return!0;if(p==null||c==null||p.length!==c.length)return!1;for(var a=0;a<p.length;a++)if(p[a]!==c[a])return!1;return!0}function Zt(p){return p%1==0}function Bt(p){if(Math.tanh!=null)return Math.tanh(p);if(p===1/0)return 1;if(p===-1/0)return-1;var c=Math.exp(2*p);return(c-1)/(c+1)}function Mt(p){var c=Math.ceil(Math.sqrt(p));return[c,Math.ceil(p/c)]}function bn(p,c){return c<=p.length?p:p+" ".repeat(c-p.length)}function Dt(p,c,a){return c===void 0&&(c=function(l){return 0}),new Promise(function(l,g){var _=0,j=function(){if(p())l();else{var V=c(++_);a!=null&&_>=a?g():setTimeout(j,V)}};j()})}function _t(p,c){for(var a=1,l=-1,g=0;g<p.length;++g)if(p[g]>=0)a*=p[g];else if(p[g]===-1){if(l!==-1)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+l+" and dim "+g);l=g}else if(p[g]<0)throw Error("Shapes can not be < 0. Found "+p[g]+" at dim "+g);if(l===-1){if(c>0&&c!==a)throw Error("Size("+c+") must match the product of shape "+p);return p}if(a===0)throw Error("Cannot infer the missing size in ["+p+"] when there are 0 elements");if(c%a!=0)throw Error("The implicit shape can't be a fractional number. Got "+c+" / "+a);var _=p.slice();return _[l]=c/a,_}function xn(p,c){var a=c.length;return we((p=p==null?c.map(function(l,g){return g}):[].concat(p)).every(function(l){return l>=-a&&l<a}),function(){return"All values in axis param must be in range [-"+a+", "+a+") but got axis "+p}),we(p.every(function(l){return Zt(l)}),function(){return"All values in axis param must be integers but got axis "+p}),p.map(function(l){return l<0?a+l:l})}function In(p,c){for(var a=[],l=[],g=c!=null&&Array.isArray(c)&&c.length===0,_=c==null||g?null:xn(c,p).sort(),j=0,V=0;V<p.length;++V){if(_!=null){if(_[j]===V&&p[V]!==1)throw new Error("Can't squeeze axis "+V+" since its dim '"+p[V]+"' is not 1");(_[j]==null||_[j]>V)&&p[V]===1&&(a.push(p[V]),l.push(V)),_[j]<=V&&j++}p[V]!==1&&(a.push(p[V]),l.push(V))}return{newShape:a,keptDims:l}}function Yn(p,c){var a=null;if(p==null||p==="float32")a=new Float32Array(c);else if(p==="int32")a=new Int32Array(c);else{if(p!=="bool")throw new Error("Unknown data type "+p);a=new Uint8Array(c)}return a}function fn(p,c){var a=null;if(p==null||p==="float32")a=new Float32Array(c);else if(p==="int32")a=new Int32Array(c);else if(p==="bool")a=new Uint8Array(c);else{if(p!=="string")throw new Error("Unknown data type "+p);a=new Array(c)}return a}function We(p,c){for(var a=0;a<p.length;a++){var l=p[a];if(isNaN(l)||!isFinite(l))throw Error("A tensor of type "+c+" being uploaded contains "+l+".")}}function Pe(p){return p==="bool"||p==="complex64"||p==="float32"||p==="int32"||p==="string"}function rt(p,c){return!(c==="complex64"||c==="float32"&&p!=="complex64"||c==="int32"&&p!=="float32"&&p!=="complex64"||c==="bool"&&p==="bool")}function Et(p){return p instanceof Float32Array||p instanceof Int32Array||p instanceof Uint8Array}function Lt(p){if(p==="float32"||p==="int32")return 4;if(p==="complex64")return 8;if(p==="bool")return 1;throw new Error("Unknown dtype "+p)}function rn(p){if(p==null)return 0;var c=0;return p.forEach(function(a){return c+=a.length}),c}function Sn(p){return typeof p=="string"||p instanceof String}function kn(p){return typeof p=="boolean"}function qn(p){return typeof p=="number"}function xe(p){return Array.isArray(p)?xe(p[0]):p instanceof Float32Array?"float32":p instanceof Int32Array||p instanceof Uint8Array?"int32":qn(p)?"float32":Sn(p)?"string":kn(p)?"bool":"float32"}function Xn(p){return!!(p&&p.constructor&&p.call&&p.apply)}function br(p,c){for(var a=c;a<p;++a)if(p%a==0)return a;return p}function Cr(p){var c=p.length;if(c<2)return[];var a=new Array(c-1);a[c-2]=p[c-1];for(var l=c-3;l>=0;--l)a[l]=a[l+1]*p[l+1];return a}function dr(p,c,a){if(c==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(p)&&(p=Pt(p)),a&&We(p,c),function(_,j){return _ instanceof Float32Array&&j==="float32"||_ instanceof Int32Array&&j==="int32"||_ instanceof Uint8Array&&j==="bool"}(p,c))return p;if(c==null||c==="float32"||c==="complex64")return new Float32Array(p);if(c==="int32")return new Int32Array(p);if(c==="bool"){for(var l=new Uint8Array(p.length),g=0;g<l.length;++g)Math.round(p[g])!==0&&(l[g]=1);return l}throw new Error("Unknown data type "+c)}function Rr(p,c){if(p.length===0)return c[0];var a=p.reduce(function(l,g){return l*g});if(a===0)return[];if(a!==c.length)throw new Error("["+p+"] does not match the input size.");return function l(g,_,j){var V=new Array;if(_.length===1)for(var ne=_[0],oe=0;oe<ne;oe++)V[oe]=j[g+oe];else{ne=_[0];var me=_.slice(1),Ee=me.reduce(function(_e,Ne){return _e*Ne});for(oe=0;oe<ne;oe++)V[oe]=l(g+oe*Ee,me,j)}return V}(0,p,c)}function hn(p,c){for(var a=Xt(p,c),l=0;l<a.length;l++)a[l]=1;return a}function Xt(p,c){if(c==null||c==="float32"||c==="complex64")return new Float32Array(p);if(c==="int32")return new Int32Array(p);if(c==="bool")return new Uint8Array(p);throw new Error("Unknown data type "+c)}function nn(){return L().platform.now()}function Gn(p){p.forEach(function(c){we(Number.isInteger(c)&&c>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+p+"]."})})}function Dn(p,c){return c===void 0&&(c="utf-8"),c=c||"utf-8",L().platform.encode(p,c)}function mr(p,c){return c===void 0&&(c="utf-8"),c=c||"utf-8",L().platform.decode(p,c)}function xr(p,c,a){if(c===0)return 0;if(c===1)return p[0];for(var l=p[p.length-1],g=0;g<p.length-1;++g)l+=a[g]*p[g];return l}function gr(p,c,a){if(c===0)return[];if(c===1)return[p];for(var l=new Array(c),g=0;g<l.length-1;++g)l[g]=Math.floor(p/a[g]),p-=l[g]*a[g];return l[l.length-1]=p,l}var Qr=Object.freeze({shuffle:at,clamp:St,nearestLargerEven:zt,sum:$t,randUniform:function(p,c){var a=Math.random();return c*a+(1-a)*p},distSquared:function(p,c){for(var a=0,l=0;l<p.length;l++){var g=Number(p[l])-Number(c[l]);a+=g*g}return a},assert:we,assertShapesMatch:Tt,assertNonNull:Gt,flatten:Pt,sizeFromShape:Ye,isScalarShape:function(p){return p.length===0},arraysEqual:ln,isInt:Zt,tanh:Bt,sizeToSquarishShape:Mt,createShuffledIndices:function(p){for(var c=new Uint32Array(p),a=0;a<p;++a)c[a]=a;return at(c),c},rightPad:bn,repeatedTry:Dt,inferFromImplicitShape:_t,parseAxisParam:xn,squeezeShape:In,getTypedArrayFromDType:Yn,getArrayFromDType:fn,checkConversionForErrors:We,isValidDtype:Pe,hasEncodingLoss:rt,isTypedArray:Et,bytesPerElement:Lt,bytesFromStringArray:rn,isString:Sn,isBoolean:kn,isNumber:qn,inferDtype:xe,isFunction:Xn,nearestDivisor:br,computeStrides:Cr,toTypedArray:dr,toNestedArray:Rr,makeOnesTypedArray:hn,makeZerosTypedArray:Xt,now:nn,assertNonNegativeIntegerDimensions:Gn,fetch:function(p,c){return L().platform.fetch(p,c)},encodeString:Dn,decodeString:mr,locToIndex:xr,indexToLoc:gr}),ni=function(){function p(c,a){this.backendTimer=c,this.logger=a,a==null&&(this.logger=new Mr)}return p.prototype.profileKernel=function(c,a,l){var g,_=this,j=this.backendTimer.time(function(){g=l()});return g.forEach(function(V){V.data().then(function(ne){(function(oe,me,Ee){if(me!=="float32")return!1;for(var _e=0;_e<oe.length;_e++){var Ne=oe[_e];if(isNaN(Ne)||!isFinite(Ne))return console.warn("Found "+Ne+" in the result of '"+Ee+"'"),!0}})(ne,V.dtype,c),j.then(function(oe){var me="";oe.getExtraProfileInfo!=null&&(me=oe.getExtraProfileInfo()),_.logger.logKernelProfile(c,V,ne,oe.kernelMs,a,me)})})}),g},p}(),Mr=function(){function p(){}return p.prototype.logKernelProfile=function(c,a,l,g,_,j){var V=typeof g=="number"?bn(g+"ms",9):g.error,ne=bn(c,25),oe=a.rank,me=a.size,Ee=bn(a.shape.toString(),14),_e="";for(var Ne in _){var Ue=_[Ne].shape||a.shape,$e=Ue.length;_e+=Ne+": "+$e+"D "+($e>0?Ue:"")+" "}console.log("%c"+ne+"	%c"+V+"	%c"+oe+"D "+Ee+"	%c"+me+"	%c"+_e+"	%c"+j,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},p}(),di=20,Yr=3,Xr=7;function fi(p,c,a){return bn(Array.isArray(p)?parseFloat(p[0].toFixed(Xr))+" + "+parseFloat(p[1].toFixed(Xr))+"j":Sn(p)?"'"+p+"'":a==="bool"?ai(p):parseFloat(p.toFixed(Xr)).toString(),c)}function ai(p){return p===0?"false":"true"}function Oa(p){for(var c=[],a=0;a<p.length;a+=2)c.push([p[a],p[a+1]]);return c}var Wi=function(){function p(c,a,l){var g=this;if(this.dtype=a,this.shape=c.slice(),this.size=Ye(c),l!=null){var _=l.length;we(_===this.size,function(){return"Length of values '"+_+"' does not match the size inferred by the shape '"+g.size+"'."})}if(a==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=l||fn(a,this.size),this.strides=Cr(c)}return p.prototype.set=function(c){for(var a=this,l=[],g=1;g<arguments.length;g++)l[g-1]=arguments[g];l.length===0&&(l=[0]),we(l.length===this.rank,function(){return"The number of provided coordinates ("+l.length+") must match the rank ("+a.rank+")"});var _=this.locToIndex(l);this.values[_]=c},p.prototype.get=function(){for(var c=[],a=0;a<arguments.length;a++)c[a]=arguments[a];c.length===0&&(c=[0]);for(var l=0,g=0,_=c;g<_.length;g++){var j=_[g];if(j<0||j>=this.shape[l]){var V="Requested out of range element at "+c+".   Buffer shape="+this.shape;throw new Error(V)}l++}for(var ne=c[c.length-1],oe=0;oe<c.length-1;++oe)ne+=this.strides[oe]*c[oe];return this.values[ne]},p.prototype.locToIndex=function(c){if(this.rank===0)return 0;if(this.rank===1)return c[0];for(var a=c[c.length-1],l=0;l<c.length-1;++l)a+=this.strides[l]*c[l];return a},p.prototype.indexToLoc=function(c){if(this.rank===0)return[];if(this.rank===1)return[c];for(var a=new Array(this.shape.length),l=0;l<a.length-1;++l)a[l]=Math.floor(c/this.strides[l]),c-=a[l]*this.strides[l];return a[a.length-1]=c,a},Object.defineProperty(p.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),p.prototype.toTensor=function(){return Ci().makeTensor(this.values,this.shape,this.dtype)},p}(),Ci=null,yt=null,Lr=null,jt=function(){function p(c,a,l,g){this.kept=!1,this.isDisposedInternal=!1,this.shape=c.slice(),this.dtype=a||"float32",this.size=Ye(c),this.strides=Cr(c),this.dataId=l,this.id=g,this.rankType=this.rank<5?this.rank.toString():"higher"}return p.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},p.prototype.asScalar=function(){return this.throwIfDisposed(),we(this.size===1,function(){return"The array must have only 1 element."}),this.reshape([])},p.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},p.prototype.as2D=function(c,a){return this.throwIfDisposed(),this.reshape([c,a])},p.prototype.as3D=function(c,a,l){return this.throwIfDisposed(),this.reshape([c,a,l])},p.prototype.as4D=function(c,a,l,g){return this.throwIfDisposed(),this.reshape([c,a,l,g])},p.prototype.as5D=function(c,a,l,g,_){return this.throwIfDisposed(),this.reshape([c,a,l,g,_])},p.prototype.asType=function(c){return this.throwIfDisposed(),yt.cast(this,c)},Object.defineProperty(p.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),p.prototype.buffer=function(){return R(this,void 0,void 0,function(){var c;return P(this,function(a){switch(a.label){case 0:return[4,this.data()];case 1:return c=a.sent(),[2,yt.buffer(this.shape,this.dtype,c)]}})})},p.prototype.bufferSync=function(){return yt.buffer(this.shape,this.dtype,this.dataSync())},p.prototype.array=function(){return R(this,void 0,void 0,function(){var c;return P(this,function(a){switch(a.label){case 0:return[4,this.data()];case 1:return c=a.sent(),[2,Rr(this.shape,c)]}})})},p.prototype.arraySync=function(){return Rr(this.shape,this.dataSync())},p.prototype.data=function(){return R(this,void 0,void 0,function(){var c,a;return P(this,function(l){switch(l.label){case 0:return this.throwIfDisposed(),c=Ci().read(this.dataId),this.dtype!=="string"?[3,2]:[4,c];case 1:a=l.sent();try{return[2,a.map(function(g){return mr(g)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}l.label=2;case 2:return[2,c]}})})},p.prototype.dataSync=function(){this.throwIfDisposed();var c=Ci().readSync(this.dataId);if(this.dtype==="string")try{return c.map(function(a){return mr(a)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return c},p.prototype.bytes=function(){return R(this,void 0,void 0,function(){var c;return P(this,function(a){switch(a.label){case 0:return this.throwIfDisposed(),[4,Ci().read(this.dataId)];case 1:return c=a.sent(),this.dtype==="string"?[2,c]:[2,new Uint8Array(c.buffer)]}})})},p.prototype.dispose=function(){this.isDisposed||(Ci().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(p.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),p.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},p.prototype.toFloat=function(){return this.asType("float32")},p.prototype.toInt=function(){return this.asType("int32")},p.prototype.toBool=function(){return this.asType("bool")},p.prototype.print=function(c){return c===void 0&&(c=!1),yt.print(this,c)},p.prototype.reshape=function(c){return this.throwIfDisposed(),yt.reshape(this,c)},p.prototype.reshapeAs=function(c){return this.throwIfDisposed(),this.reshape(c.shape)},p.prototype.expandDims=function(c){return c===void 0&&(c=0),yt.expandDims(this,c)},p.prototype.cumsum=function(c,a,l){return c===void 0&&(c=0),a===void 0&&(a=!1),l===void 0&&(l=!1),yt.cumsum(this,c,a,l)},p.prototype.squeeze=function(c){return this.throwIfDisposed(),yt.squeeze(this,c)},p.prototype.clone=function(){return this.throwIfDisposed(),yt.clone(this)},p.prototype.toString=function(c){return c===void 0&&(c=!1),function(a,l,g,_){var j=Cr(l),V=function(Ee,_e,Ne,Ue){var $e=Ye(_e),He=Ue[Ue.length-1],et=new Array(He).fill(0),lt=_e.length,ht=Ne==="complex64"?Oa(Ee):Ee;if(lt>1)for(var gt=0;gt<$e/He;gt++)for(var Ct=gt*He,Wt=0;Wt<He;Wt++)et[Wt]=Math.max(et[Wt],fi(ht[Ct+Wt],0,Ne).length);return et}(a,l,g,j),ne=l.length,oe=function Ee(_e,Ne,Ue,$e,He,et){et===void 0&&(et=!0);var lt=Ue==="complex64"?2:1,ht=Ne[0],gt=Ne.length;if(gt===0)return Ue==="complex64"?[fi(Oa(_e)[0],0,Ue)]:Ue==="bool"?[ai(_e[0])]:[_e[0].toString()];if(gt===1){if(ht>di){var Ct=Yr*lt,Wt=Array.from(_e.slice(0,Ct)),Kt=Array.from(_e.slice((ht-Yr)*lt,ht*lt));return Ue==="complex64"&&(Wt=Oa(Wt),Kt=Oa(Kt)),["["+Wt.map(function(ur,ar){return fi(ur,He[ar],Ue)}).join(", ")+", ..., "+Kt.map(function(ur,ar){return fi(ur,He[ht-Yr+ar],Ue)}).join(", ")+"]"]}return["["+(Ue==="complex64"?Oa(_e):Array.from(_e)).map(function(ur,ar){return fi(ur,He[ar],Ue)}).join(", ")+"]"]}var Vt=Ne.slice(1),Ht=$e.slice(1),vn=$e[0]*lt,On=[];if(ht>di){for(var Cn=0;Cn<Yr;Cn++){var Kn=(er=Cn*vn)+vn;On.push.apply(On,Ee(_e.slice(er,Kn),Vt,Ue,Ht,He,!1))}for(On.push("..."),Cn=ht-Yr;Cn<ht;Cn++)Kn=(er=Cn*vn)+vn,On.push.apply(On,Ee(_e.slice(er,Kn),Vt,Ue,Ht,He,Cn===ht-1))}else for(Cn=0;Cn<ht;Cn++){var er;Kn=(er=Cn*vn)+vn,On.push.apply(On,Ee(_e.slice(er,Kn),Vt,Ue,Ht,He,Cn===ht-1))}var sr=gt===2?",":"";for(On[0]="["+On[0]+sr,Cn=1;Cn<On.length-1;Cn++)On[Cn]=" "+On[Cn]+sr;var lr=`,
`;for(Cn=2;Cn<gt;Cn++)lr+=`
`;return On[On.length-1]=" "+On[On.length-1]+"]"+(et?"":lr),On}(a,l,g,j,V),me=["Tensor"];return _&&(me.push("  dtype: "+g),me.push("  rank: "+ne),me.push("  shape: ["+l+"]"),me.push("  values:")),me.push(oe.map(function(Ee){return"    "+Ee}).join(`
`)),me.join(`
`)}(this.dataSync(),this.shape,this.dtype,c)},p.prototype.gather=function(c,a){return a===void 0&&(a=0),this.throwIfDisposed(),yt.gather(this,c,a)},p.prototype.matMul=function(c,a,l){return a===void 0&&(a=!1),l===void 0&&(l=!1),this.throwIfDisposed(),yt.matMul(this,c,a,l)},p.prototype.dot=function(c){return this.throwIfDisposed(),yt.dot(this,c)},p.prototype.norm=function(c,a,l){return c===void 0&&(c="euclidean"),a===void 0&&(a=null),l===void 0&&(l=!1),this.throwIfDisposed(),yt.norm(this,c,a,l)},p.prototype.slice=function(c,a){return this.throwIfDisposed(),yt.slice(this,c,a)},p.prototype.reverse=function(c){return this.throwIfDisposed(),yt.reverse(this,c)},p.prototype.concat=function(c,a){return a===void 0&&(a=0),this.throwIfDisposed(),c instanceof p&&(c=[c]),yt.concat([this].concat(c),a)},p.prototype.split=function(c,a){return a===void 0&&(a=0),this.throwIfDisposed(),yt.split(this,c,a)},p.prototype.stack=function(c,a){return a===void 0&&(a=0),yt.stack([this,c],a)},p.prototype.unstack=function(c){return c===void 0&&(c=0),yt.unstack(this,c)},p.prototype.batchNormalization=function(c,a,l,g,_){return l===void 0&&(l=.001),Lr("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(c,a,_,g,l)},p.prototype.all=function(c,a){return c===void 0&&(c=null),a===void 0&&(a=!1),this.throwIfDisposed(),yt.all(this,c,a)},p.prototype.any=function(c,a){return c===void 0&&(c=null),a===void 0&&(a=!1),this.throwIfDisposed(),yt.any(this,c,a)},p.prototype.logSumExp=function(c,a){return c===void 0&&(c=null),a===void 0&&(a=!1),this.throwIfDisposed(),yt.logSumExp(this,c,a)},p.prototype.sum=function(c,a){return c===void 0&&(c=null),a===void 0&&(a=!1),this.throwIfDisposed(),yt.sum(this,c,a)},p.prototype.prod=function(c,a){return c===void 0&&(c=null),a===void 0&&(a=!1),this.throwIfDisposed(),yt.prod(this,c,a)},p.prototype.mean=function(c,a){return c===void 0&&(c=null),a===void 0&&(a=!1),this.throwIfDisposed(),yt.mean(this,c,a)},p.prototype.min=function(c,a){return c===void 0&&(c=null),a===void 0&&(a=!1),this.throwIfDisposed(),yt.min(this,c,a)},p.prototype.max=function(c,a){return c===void 0&&(c=null),a===void 0&&(a=!1),this.throwIfDisposed(),yt.max(this,c,a)},p.prototype.argMin=function(c){return c===void 0&&(c=null),this.throwIfDisposed(),yt.argMin(this,c)},p.prototype.argMax=function(c){return c===void 0&&(c=null),this.throwIfDisposed(),yt.argMax(this,c)},p.prototype.cast=function(c){return this.throwIfDisposed(),yt.cast(this,c)},p.prototype.addStrict=function(c){return this.throwIfDisposed(),yt.addStrict(this,c)},p.prototype.atan2=function(c){return this.throwIfDisposed(),yt.atan2(this,c)},p.prototype.sub=function(c){return this.throwIfDisposed(),yt.sub(this,c)},p.prototype.subStrict=function(c){return this.throwIfDisposed(),yt.subStrict(this,c)},p.prototype.pow=function(c){return this.throwIfDisposed(),yt.pow(this,c)},p.prototype.powStrict=function(c){return this.throwIfDisposed(),yt.powStrict(this,c)},p.prototype.mul=function(c){return this.throwIfDisposed(),yt.mul(this,c)},p.prototype.mulStrict=function(c){return this.throwIfDisposed(),yt.mulStrict(this,c)},p.prototype.floorDiv=function(c){return this.throwIfDisposed(),yt.floorDiv(this,c)},p.prototype.divStrict=function(c){return this.throwIfDisposed(),yt.divStrict(this,c)},p.prototype.minimum=function(c){return this.throwIfDisposed(),yt.minimum(this,c)},p.prototype.minimumStrict=function(c){return this.throwIfDisposed(),yt.minimumStrict(this,c)},p.prototype.maximum=function(c){return this.throwIfDisposed(),yt.maximum(this,c)},p.prototype.maximumStrict=function(c){return this.throwIfDisposed(),yt.maximumStrict(this,c)},p.prototype.mod=function(c){return this.throwIfDisposed(),yt.mod(this,c)},p.prototype.modStrict=function(c){return this.throwIfDisposed(),yt.modStrict(this,c)},p.prototype.squaredDifferenceStrict=function(c){return this.throwIfDisposed(),yt.squaredDifferenceStrict(this,c)},p.prototype.notEqual=function(c){return this.throwIfDisposed(),yt.notEqual(this,c)},p.prototype.notEqualStrict=function(c){return this.throwIfDisposed(),yt.notEqualStrict(this,c)},p.prototype.less=function(c){return this.throwIfDisposed(),yt.less(this,c)},p.prototype.lessStrict=function(c){return this.throwIfDisposed(),yt.lessStrict(this,c)},p.prototype.equal=function(c){return this.throwIfDisposed(),yt.equal(this,c)},p.prototype.equalStrict=function(c){return this.throwIfDisposed(),yt.equalStrict(this,c)},p.prototype.lessEqual=function(c){return this.throwIfDisposed(),yt.lessEqual(this,c)},p.prototype.lessEqualStrict=function(c){return this.throwIfDisposed(),yt.lessEqualStrict(this,c)},p.prototype.greater=function(c){return this.throwIfDisposed(),yt.greater(this,c)},p.prototype.greaterStrict=function(c){return this.throwIfDisposed(),yt.greaterStrict(this,c)},p.prototype.greaterEqual=function(c){return this.throwIfDisposed(),yt.greaterEqual(this,c)},p.prototype.greaterEqualStrict=function(c){return this.throwIfDisposed(),yt.greaterEqualStrict(this,c)},p.prototype.logicalAnd=function(c){return this.throwIfDisposed(),yt.logicalAnd(this,c)},p.prototype.logicalOr=function(c){return this.throwIfDisposed(),yt.logicalOr(this,c)},p.prototype.logicalNot=function(){return this.throwIfDisposed(),yt.logicalNot(this)},p.prototype.logicalXor=function(c){return this.throwIfDisposed(),yt.logicalXor(this,c)},p.prototype.where=function(c,a){return this.throwIfDisposed(),yt.where(c,this,a)},p.prototype.neg=function(){return this.throwIfDisposed(),yt.neg(this)},p.prototype.ceil=function(){return this.throwIfDisposed(),yt.ceil(this)},p.prototype.floor=function(){return this.throwIfDisposed(),yt.floor(this)},p.prototype.sign=function(){return this.throwIfDisposed(),yt.sign(this)},p.prototype.isNaN=function(){return this.throwIfDisposed(),yt.isNaN(this)},p.prototype.isInf=function(){return this.throwIfDisposed(),yt.isInf(this)},p.prototype.isFinite=function(){return this.throwIfDisposed(),yt.isFinite(this)},p.prototype.exp=function(){return this.throwIfDisposed(),yt.exp(this)},p.prototype.expm1=function(){return this.throwIfDisposed(),yt.expm1(this)},p.prototype.log=function(){return this.throwIfDisposed(),yt.log(this)},p.prototype.log1p=function(){return this.throwIfDisposed(),yt.log1p(this)},p.prototype.sqrt=function(){return this.throwIfDisposed(),yt.sqrt(this)},p.prototype.rsqrt=function(){return this.throwIfDisposed(),yt.rsqrt(this)},p.prototype.square=function(){return this.throwIfDisposed(),yt.square(this)},p.prototype.reciprocal=function(){return this.throwIfDisposed(),yt.reciprocal(this)},p.prototype.abs=function(){return this.throwIfDisposed(),yt.abs(this)},p.prototype.clipByValue=function(c,a){return this.throwIfDisposed(),yt.clipByValue(this,c,a)},p.prototype.relu=function(){return this.throwIfDisposed(),yt.relu(this)},p.prototype.relu6=function(){return this.throwIfDisposed(),yt.relu6(this)},p.prototype.elu=function(){return this.throwIfDisposed(),yt.elu(this)},p.prototype.selu=function(){return this.throwIfDisposed(),yt.selu(this)},p.prototype.leakyRelu=function(c){return c===void 0&&(c=.2),this.throwIfDisposed(),yt.leakyRelu(this,c)},p.prototype.prelu=function(c){return this.throwIfDisposed(),yt.prelu(this,c)},p.prototype.sigmoid=function(){return this.throwIfDisposed(),yt.sigmoid(this)},p.prototype.logSigmoid=function(){return this.throwIfDisposed(),yt.logSigmoid(this)},p.prototype.softplus=function(){return this.throwIfDisposed(),yt.softplus(this)},p.prototype.zerosLike=function(){return this.throwIfDisposed(),yt.zerosLike(this)},p.prototype.onesLike=function(){return this.throwIfDisposed(),yt.onesLike(this)},p.prototype.sin=function(){return this.throwIfDisposed(),yt.sin(this)},p.prototype.cos=function(){return this.throwIfDisposed(),yt.cos(this)},p.prototype.tan=function(){return this.throwIfDisposed(),yt.tan(this)},p.prototype.asin=function(){return this.throwIfDisposed(),yt.asin(this)},p.prototype.acos=function(){return this.throwIfDisposed(),yt.acos(this)},p.prototype.atan=function(){return this.throwIfDisposed(),yt.atan(this)},p.prototype.sinh=function(){return this.throwIfDisposed(),yt.sinh(this)},p.prototype.cosh=function(){return this.throwIfDisposed(),yt.cosh(this)},p.prototype.tanh=function(){return this.throwIfDisposed(),yt.tanh(this)},p.prototype.asinh=function(){return this.throwIfDisposed(),yt.asinh(this)},p.prototype.acosh=function(){return this.throwIfDisposed(),yt.acosh(this)},p.prototype.atanh=function(){return this.throwIfDisposed(),yt.atanh(this)},p.prototype.erf=function(){return this.throwIfDisposed(),yt.erf(this)},p.prototype.round=function(){return this.throwIfDisposed(),yt.round(this)},p.prototype.step=function(c){return c===void 0&&(c=0),this.throwIfDisposed(),yt.step(this,c)},p.prototype.softmax=function(c){return c===void 0&&(c=-1),this.throwIfDisposed(),yt.softmax(this,c)},p.prototype.logSoftmax=function(c){return c===void 0&&(c=-1),this.throwIfDisposed(),yt.logSoftmax(this,c)},p.prototype.resizeBilinear=function(c,a){return a===void 0&&(a=!1),this.throwIfDisposed(),yt.image.resizeBilinear(this,c,a)},p.prototype.resizeNearestNeighbor=function(c,a){return a===void 0&&(a=!1),this.throwIfDisposed(),yt.image.resizeNearestNeighbor(this,c,a)},p.prototype.conv1d=function(c,a,l,g,_,j){return g===void 0&&(g="NWC"),_===void 0&&(_=1),this.throwIfDisposed(),yt.conv1d(this,c,a,l,g,_,j)},p.prototype.conv2d=function(c,a,l,g,_,j){return g===void 0&&(g="NHWC"),_===void 0&&(_=[1,1]),this.throwIfDisposed(),yt.conv2d(this,c,a,l,g,_,j)},p.prototype.conv2dTranspose=function(c,a,l,g,_){return this.throwIfDisposed(),yt.conv2dTranspose(this,c,a,l,g,_)},p.prototype.depthwiseConv2D=function(c,a,l,g,_,j){return g===void 0&&(g="NHWC"),_===void 0&&(_=[1,1]),this.throwIfDisposed(),yt.depthwiseConv2d(this,c,a,l,g,_,j)},p.prototype.separableConv2d=function(c,a,l,g,_,j){return _===void 0&&(_=[1,1]),j===void 0&&(j="NHWC"),this.throwIfDisposed(),yt.separableConv2d(this,c,a,l,g,_,j)},p.prototype.avgPool=function(c,a,l,g){return this.throwIfDisposed(),yt.avgPool(this,c,a,l,g)},p.prototype.maxPool=function(c,a,l,g){return this.throwIfDisposed(),yt.maxPool(this,c,a,l,g)},p.prototype.localResponseNormalization=function(c,a,l,g){return c===void 0&&(c=5),a===void 0&&(a=1),l===void 0&&(l=1),g===void 0&&(g=.5),yt.localResponseNormalization(this,c,a,l,g)},p.prototype.pool=function(c,a,l,g,_){return this.throwIfDisposed(),yt.pool(this,c,a,l,g,_)},p.prototype.variable=function(c,a,l){return c===void 0&&(c=!0),this.throwIfDisposed(),Ci().makeVariable(this,c,a,l)},p.prototype.unsortedSegmentSum=function(c,a){return this.throwIfDisposed(),yt.unsortedSegmentSum(this,c,a)},p.prototype.batchToSpaceND=function(c,a){return this.throwIfDisposed(),yt.batchToSpaceND(this,c,a)},p.prototype.spaceToBatchND=function(c,a){return this.throwIfDisposed(),yt.spaceToBatchND(this,c,a)},p.prototype.topk=function(c,a){return c===void 0&&(c=1),a===void 0&&(a=!0),this.throwIfDisposed(),yt.topk(this,c,a)},p.prototype.stridedSlice=function(c,a,l,g,_,j,V,ne){return g===void 0&&(g=0),_===void 0&&(_=0),j===void 0&&(j=0),V===void 0&&(V=0),ne===void 0&&(ne=0),this.throwIfDisposed(),yt.stridedSlice(this,c,a,l,g,_,j,V,ne)},p.prototype.depthToSpace=function(c,a){return this.throwIfDisposed(),yt.depthToSpace(this,c,a)},p.prototype.fft=function(){return this.throwIfDisposed(),yt.spectral.fft(this)},p.prototype.ifft=function(){return this.throwIfDisposed(),yt.spectral.ifft(this)},p.prototype.rfft=function(){return this.throwIfDisposed(),yt.spectral.rfft(this)},p.prototype.irfft=function(){return this.throwIfDisposed(),yt.spectral.irfft(this)},p}();Object.defineProperty(jt,Symbol.hasInstance,{value:function(p){return!!p&&p.dataId!=null&&p.shape!=null&&p.dtype!=null}});var ge,fe,ye,Se,Ze,mt=function(p){function c(a,l,g,_){var j=p.call(this,a.shape,a.dtype,a.dataId,_)||this;return j.trainable=l,j.name=g,j}return J(c,p),c.prototype.assign=function(a){if(a.dtype!==this.dtype)throw new Error("dtype of the new value ("+a.dtype+") and previous value ("+this.dtype+") must match");if(!ln(a.shape,this.shape))throw new Error("shape of the new value ("+a.shape+") and previous value ("+this.shape+") must match");Ci().disposeTensor(this),this.dataId=a.dataId,Ci().incRef(this,null)},c.prototype.dispose=function(){Ci().disposeVariable(this),this.isDisposedInternal=!0},c}(jt);Object.defineProperty(mt,Symbol.hasInstance,{value:function(p){return p instanceof jt&&p.assign!=null&&p.assign instanceof Function}}),function(p){p.R0="R0",p.R1="R1",p.R2="R2",p.R3="R3",p.R4="R4",p.R5="R5",p.R6="R6"}(ge||(ge={})),function(p){p.float32="float32",p.int32="int32",p.bool="int32",p.complex64="complex64"}(fe||(fe={})),function(p){p.float32="float32",p.int32="int32",p.bool="bool",p.complex64="complex64"}(ye||(ye={})),function(p){p.float32="float32",p.int32="float32",p.bool="float32",p.complex64="complex64"}(Se||(Se={})),function(p){p.float32="complex64",p.int32="complex64",p.bool="complex64",p.complex64="complex64"}(Ze||(Ze={}));var Rt={float32:Se,int32:fe,bool:ye,complex64:Ze};function cn(p,c){if(p==="string"||c==="string"){if(p==="string"&&c==="string")return"string";throw new Error("Can not upcast "+p+" with "+c)}return Rt[p][c]}function Jn(p){return cn(p,"int32")}function An(p,c){if(p.dtype===c.dtype)return[p,c];var a=cn(p.dtype,c.dtype);return[p.cast(a),c.cast(a)]}function Ln(p,c){we(p.dtype===c.dtype,function(){return"The dtypes of the first("+p.dtype+") and second("+c.dtype+") input must match"})}function Hn(p){var c=[];return function a(l,g,_){if(l!=null){if(l instanceof jt)g.push(l);else if(j=l,Array.isArray(j)||typeof j=="object"){var j,V=l;for(var ne in V){var oe=V[ne];_.has(oe)||(_.add(oe),a(oe,g,_))}}}}(p,c,new Set),c}var It,Ot=Object.freeze({makeTypesMatch:An,assertTypesMatch:Ln,isTensorInList:function(p,c){return c.some(function(a){return a.id===p.id})},getTensorsInContainer:Hn}),pn=function(){function p(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return p.prototype.dispose=function(){for(var c in this.registeredVariables)this.registeredVariables[c].dispose()},p}(),qt=function(){function p(c){this.ENV=c,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new pn}return p.prototype.ready=function(){return R(this,void 0,void 0,function(){var c,a,l;return P(this,function(g){switch(g.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];c=this.getSortedBackends(),a=0,g.label=1;case 1:return a<c.length?(l=c[a],[4,this.initializeBackend(l).success]):[3,5];case 2:return g.sent()?[4,this.setBackend(l)]:[3,4];case 3:return g.sent(),[2];case 4:return a++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(p.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var c=this.initializeBackendsAndReturnBest(),a=c.name;if(c.asyncInit)throw new Error("The highest priority backend '"+a+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(a)}return this.backendInstance},enumerable:!0,configurable:!0}),p.prototype.backendNames=function(){return Object.keys(this.registryFactory)},p.prototype.findBackend=function(c){return!(c in this.registry)&&(!(c in this.registryFactory)||this.initializeBackend(c).asyncInit)?null:this.registry[c]},p.prototype.findBackendFactory=function(c){return c in this.registryFactory?this.registryFactory[c].factory:null},p.prototype.registerBackend=function(c,a,l){return l===void 0&&(l=1),c in this.registryFactory?(console.warn(c+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[c]={factory:a,priority:l},!0)},p.prototype.setBackend=function(c){return R(this,void 0,void 0,function(){var a,l,g;return P(this,function(_){switch(_.label){case 0:if(this.registryFactory[c]==null)throw new Error("Backend name '"+c+"' not found in registry");return this.backendName=c,this.registry[c]!=null?[3,4]:(this.backendInstance=null,a=this.initializeBackend(c),l=a.success,a.asyncInit?[4,l]:[3,2]);case 1:return g=_.sent(),[3,3];case 2:g=l,_.label=3;case 3:if(!g)return[2,!1];_.label=4;case 4:return this.backendInstance=this.registry[c],this.setupRegisteredKernels(),this.profiler=new ni(this.backendInstance),[2,!0]}})})},p.prototype.setupRegisteredKernels=function(){var c=this;he(this.backendName).forEach(function(a){a.setupFunc!=null&&a.setupFunc(c.backendInstance)})},p.prototype.disposeRegisteredKernels=function(c){var a=this;he(c).forEach(function(l){l.disposeFunc!=null&&l.disposeFunc(a.registry[c])})},p.prototype.initializeBackend=function(c){var a=this,l=this.registryFactory[c];if(l==null)throw new Error("Cannot initialize backend "+c+", no registration found.");try{var g=l.factory();if(Promise.resolve(g)===g){var _=++this.pendingBackendInitId,j=g.then(function(V){return!(_<a.pendingBackendInitId||(a.registry[c]=V,a.pendingBackendInit=null,0))}).catch(function(V){return!(_<a.pendingBackendInitId||(a.pendingBackendInit=null,console.warn("Initialization of backend "+c+" failed"),console.warn(V.stack||V.message),1))});return this.pendingBackendInit=j,{success:j,asyncInit:!0}}return this.registry[c]=g,{success:!0,asyncInit:!1}}catch(V){return console.warn("Initialization of backend "+c+" failed"),console.warn(V.stack||V.message),{success:!1,asyncInit:!1}}},p.prototype.removeBackend=function(c){if(!(c in this.registryFactory))throw new Error(c+" backend not found in registry");this.backendName===c&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,c in this.registry&&(this.disposeRegisteredKernels(c),this.registry[c].dispose(),delete this.registry[c]),delete this.registryFactory[c],this.backendName===c&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},p.prototype.getSortedBackends=function(){var c=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(a,l){return c.registryFactory[l].priority-c.registryFactory[a].priority})},p.prototype.initializeBackendsAndReturnBest=function(){for(var c=this.getSortedBackends(),a=0;a<c.length;a++){var l=c[a],g=this.initializeBackend(l),_=g.success,j=g.asyncInit;if(j||_)return{name:l,asyncInit:j}}throw new Error("Could not initialize any backends, all backend initializations failed.")},p.prototype.moveData=function(c,a){var l=this.state.tensorInfo.get(a),g=l.backend,_=this.readSync(a);g.disposeData(a),l.backend=c,c.move(a,_,l.shape,l.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},p.prototype.tidy=function(c,a){var l,g=this,_=null;if(a==null){if(typeof c!="function")throw new Error("Please provide a function to tidy()");a=c}else{if(typeof c!="string"&&!(c instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof a!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");_=c}return this.scopedRun(function(){return g.startScope(_)},function(){return g.endScope(l)},function(){return(l=a())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),l})},p.prototype.scopedRun=function(c,a,l){c();try{var g=l();return a(),g}catch(_){throw a(),_}},p.prototype.nextTensorId=function(){return p.nextTensorId++},p.prototype.nextVariableId=function(){return p.nextVariableId++},p.prototype.clone=function(c){var a=this.makeTensorFromDataId(c.dataId,c.shape,c.dtype),l={x:c};return this.addTapeNode(this.state.activeScope.name,l,[a],function(g){return{x:function(){return g.toFloat()}}},[],{}),a},p.prototype.runKernel=function(c,a,l,g,_){return this.runKernelFunc(null,a,null,c,l,g,_)},p.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},p.prototype.checkKernelForMemLeak=function(c,a,l){var g=this.backend.numDataIds(),_=0;l.forEach(function(ne){_+=ne.dtype==="complex64"?3:1});var j=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],V=g-a-_-j;if(V>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+V+" data ids) after running '"+c+"'")},p.prototype.runKernelFunc=function(c,a,l,g,_,j,V){var ne,oe=this,me=[],Ee=this.isTapeOn();g==null&&(g=this.state.activeScope!=null?this.state.activeScope.name:"");var _e,Ne=this.state.numBytes,Ue=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var $e,He=ie(g,this.backendName);if(He!=null)_e=function(){var lt=oe.backend.numDataIds();$e=He.kernelFunc({inputs:a,attrs:_,backend:oe.backend});var ht=Array.isArray($e)?$e:[$e];oe.shouldCheckForMemLeaks()&&oe.checkKernelForMemLeak(g,lt,ht);var gt=ht.map(function(Kt){var Vt=Kt.dataId,Ht=Kt.shape,vn=Kt.dtype;return oe.makeTensorFromDataId(Vt,Ht,vn)});if(Ee){var Ct=oe.getTensorsForGradient(g,a,gt);if(Ct==null){V==null&&(V=[]);var Wt=gt.filter(function(Kt,Vt){return V[Vt]});Ct=(j||[]).slice().concat(Wt)}me=oe.saveTensorsForBackwardMode(Ct)}return gt};else{var et=function(lt){Ee&&(me=lt.map(function(ht){return oe.keep(oe.clone(ht))}))};_e=function(){var lt=oe.backend.numDataIds();$e=oe.tidy(function(){return c(oe.backend,et)});var ht=Array.isArray($e)?$e:[$e];return oe.shouldCheckForMemLeaks()&&oe.checkKernelForMemLeak(g,lt,ht),ht}}return this.scopedRun(function(){return oe.state.kernelDepth++},function(){return oe.state.kernelDepth--},function(){ne=oe.ENV.getBool("DEBUG")?oe.profiler.profileKernel(g,a,function(){return _e()}):_e()}),Ee&&this.addTapeNode(g,a,ne,l,me,_),this.state.profiling&&this.state.activeProfile.kernels.push({name:g,bytesAdded:this.state.numBytes-Ne,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-Ue,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(a).map(function(lt){return a[lt].shape}),outputShapes:ne.map(function(lt){return lt.shape})}),Array.isArray($e)?ne:ne[0]},p.prototype.saveTensorsForBackwardMode=function(c){var a=this;return c.map(function(l){return a.keep(a.clone(l))})},p.prototype.getTensorsForGradient=function(c,a,l){var g=K(c);if(g!=null){var _=g.inputsToSave||[],j=g.outputsToSave||[],V=void 0;g.saveAllInputs?(we(Array.isArray(a),function(){return"saveAllInputs is true, expected inputs to be an array."}),V=Object.keys(a).map(function(oe){return a[oe]})):V=_.map(function(oe){return a[oe]});var ne=l.filter(function(oe,me){return j[me]});return V.concat(ne)}return null},p.prototype.makeTensor=function(c,a,l,g){if(c==null)throw new Error("Values passed to engine.makeTensor() are null");l=l||"float32",g=g||this.backend;var _=c;l==="string"&&Sn(c[0])&&(_=c.map(function(me){return Dn(me)}));var j=g.write(_,a,l),V=new jt(a,l,j,this.nextTensorId());if(this.incRef(V,g),l==="string"){var ne=this.state.tensorInfo.get(j),oe=rn(_);this.state.numBytes+=oe-ne.bytes,ne.bytes=oe}return V},p.prototype.makeTensorFromDataId=function(c,a,l,g){var _=new jt(a,l=l||"float32",c,this.nextTensorId());return this.incRef(_,g),_},p.prototype.makeVariable=function(c,a,l,g){a===void 0&&(a=!0),l=l||this.nextVariableId().toString(),g!=null&&g!==c.dtype&&(c=c.asType(g));var _=new mt(c,a,l,this.nextTensorId());if(this.state.registeredVariables[_.name]!=null)throw new Error("Variable with name "+_.name+" was already registered");return this.state.registeredVariables[_.name]=_,this.incRef(_,this.backend),_},p.prototype.incRef=function(c,a){var l=this.state.tensorInfo.has(c.dataId)?this.state.tensorInfo.get(c.dataId).refCount:0;if(this.state.numTensors++,c.dtype==="string"&&this.state.numStringTensors++,l===0){this.state.numDataBuffers++;var g=0;c.dtype!=="complex64"&&c.dtype!=="string"&&(g=c.size*Lt(c.dtype)),this.state.tensorInfo.set(c.dataId,{backend:a||this.backend,dtype:c.dtype,shape:c.shape,bytes:g,refCount:0}),this.state.numBytes+=g}this.state.tensorInfo.get(c.dataId).refCount++,c instanceof mt||this.track(c)},p.prototype.disposeTensor=function(c){if(this.state.tensorInfo.has(c.dataId)){this.state.numTensors--,c.dtype==="string"&&this.state.numStringTensors--;var a=this.state.tensorInfo.get(c.dataId);a.refCount<=1?(c.dtype!=="complex64"&&(this.state.numBytes-=a.bytes),this.state.numDataBuffers--,a.backend.disposeData(c.dataId),this.state.tensorInfo.delete(c.dataId)):this.state.tensorInfo.get(c.dataId).refCount--}},p.prototype.disposeVariables=function(){for(var c in this.state.registeredVariables){var a=this.state.registeredVariables[c];this.disposeVariable(a)}},p.prototype.disposeVariable=function(c){this.disposeTensor(c),this.state.registeredVariables[c.name]!=null&&delete this.state.registeredVariables[c.name]},p.prototype.memory=function(){var c=this.backend.memory();return c.numTensors=this.state.numTensors,c.numDataBuffers=this.state.numDataBuffers,c.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(c.unreliable=!0,c.reasons==null&&(c.reasons=[]),c.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),c},p.prototype.profile=function(c){return R(this,void 0,void 0,function(){var a,l;return P(this,function(g){return this.state.profiling=!0,a=this.state.numBytes,l=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=c(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(_){return _.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-a,this.state.activeProfile.newTensors=this.state.numTensors-l,[2,this.state.activeProfile]})})},p.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},p.prototype.addTapeNode=function(c,a,l,g,_,j){var V=this,ne={id:this.state.nextTapeNodeId++,kernelName:c,inputs:a,outputs:l,saved:_},oe=K(c);oe!=null&&(g=oe.gradFunc),g!=null&&(ne.gradient=function(me){return me=me.map(function(Ee,_e){if(Ee==null){var Ne=l[_e],Ue=Xt(Ne.size,Ne.dtype);return V.makeTensor(Ue,Ne.shape,Ne.dtype)}return Ee}),g(me.length>1?me:me[0],_,j)}),this.state.activeTape.push(ne)},p.prototype.keep=function(c){return c.kept=!0,c},p.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},p.prototype.endTape=function(){this.state.gradientDepth--},p.prototype.startScope=function(c){var a={track:[],name:"unnamed scope",id:this.state.nextScopeId++};c&&(a.name=c),this.state.scopeStack.push(a),this.state.activeScope=a},p.prototype.endScope=function(c){for(var a=this,l=Hn(c),g=new Set(l.map(function(ne){return ne.id})),_=0;_<this.state.activeScope.track.length;_++){var j=this.state.activeScope.track[_];j.kept||g.has(j.id)||j.dispose()}var V=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],l.forEach(function(ne){ne.kept||ne.scopeId!==V.id||a.track(ne)})},p.prototype.gradients=function(c,a,l,g){var _=this;if(g===void 0&&(g=!1),we(a.length>0,function(){return"gradients() received an empty list of xs."}),l!=null&&l.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '"+l.dtype+"'");var j=this.scopedRun(function(){return _.startTape()},function(){return _.endTape()},function(){return _.tidy("forward",c)});we(j instanceof jt,function(){return"The result y returned by f() must be a tensor."});var V=function(ne,oe,me){for(var Ee={},_e={},Ne=0;Ne<oe.length;Ne++)Ee[oe[Ne].id]=!0;for(Ne=0;Ne<ne.length;Ne++){var Ue=(Wt=ne[Ne]).inputs;for(var $e in Ue){for(var He=Ue[$e],et=!1,lt=0;lt<oe.length;lt++)if(Ee[He.id]){Wt.outputs.forEach(function(vn){return Ee[vn.id]=!0}),et=!0,_e[Wt.id]=!0;break}if(et)break}}var ht={};ht[me.id]=!0;var gt={};for(Ne=ne.length-1;Ne>=0;Ne--)for(Ue=(Wt=ne[Ne]).inputs,lt=0;lt<Wt.outputs.length;lt++)if(ht[Wt.outputs[lt].id]){for(var $e in Ue)ht[Ue[$e].id]=!0,gt[Wt.id]=!0;break}var Ct=[];for(Ne=0;Ne<ne.length;Ne++){var Wt;if(_e[(Wt=ne[Ne]).id]&&gt[Wt.id]){var Kt={};for(var $e in Wt.inputs){var Vt=Wt.inputs[$e];Ee[Vt.id]&&(Kt[$e]=Vt)}var Ht=Object.assign({},Wt);Ht.inputs=Kt,Ht.outputs=Wt.outputs,Ct.push(Ht)}}return Ct}(this.state.activeTape,a,j);if(!g&&V.length===0&&a.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var ne,oe,me={};me[j.id]=l??(oe=hn(Ye(ne=j.shape),"float32"),Ve.makeTensor(oe,ne,"float32")),function(_e,Ne,Ue){for(var $e=function(et){var lt=Ne[et],ht=[];if(lt.outputs.forEach(function(Kt){var Vt=_e[Kt.id];Vt!=null?ht.push(Vt):ht.push(null)}),lt.gradient==null)throw new Error("Cannot compute gradient: gradient function not found for "+lt.kernelName+".");var gt=lt.gradient(ht),Ct=function(Kt){if(!(Kt in gt))throw new Error("Cannot backprop through input "+Kt+". Available gradients found: "+Object.keys(gt)+".");var Vt=Ue(function(){return gt[Kt]()});if(Vt.dtype!=="float32")throw new Error("Error in gradient for op "+lt.kernelName+". The gradient of input "+Kt+" must have 'float32' dtype, but has '"+Vt.dtype+"'");var Ht=lt.inputs[Kt];if(!ln(Vt.shape,Ht.shape))throw new Error("Error in gradient for op "+lt.kernelName+". The gradient of input '"+Kt+"' has shape '"+Vt.shape+"', which does not match the shape of the input '"+Ht.shape+"'");if(_e[Ht.id]==null)_e[Ht.id]=Vt;else{var vn=_e[Ht.id];_e[Ht.id]=vn.add(Vt),vn.dispose()}};for(var Wt in lt.inputs)Ct(Wt)},He=Ne.length-1;He>=0;He--)$e(He)}(me,V,function(_e){return _.tidy(_e)});var Ee=a.map(function(_e){return me[_e.id]});return _.state.gradientDepth===0&&(_.state.activeTape.forEach(function(_e){for(var Ne=0,Ue=_e.saved;Ne<Ue.length;Ne++)Ue[Ne].dispose()}),_.state.activeTape=null),{value:j,grads:Ee}})},p.prototype.customGrad=function(c){var a=this;return we(Xn(c),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var l,g=[],_=0;_<arguments.length;_++)g[_]=arguments[_];we(g.every(function(V){return V instanceof jt}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var j={};return g.forEach(function(V,ne){j[ne]=V}),a.runKernelFunc(function(V,ne){return we((l=c.apply(void 0,g.concat([ne]))).value instanceof jt,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),we(Xn(l.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),l.value},j,function(V,ne){var oe=l.gradFunc(V,ne),me=Array.isArray(oe)?oe:[oe];we(me.length===g.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),we(me.every(function(_e){return _e instanceof jt}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var Ee={};return me.forEach(function(_e,Ne){Ee[Ne]=function(){return _e}}),Ee})}},p.prototype.readSync=function(c){return this.state.tensorInfo.get(c).backend.readSync(c)},p.prototype.read=function(c){return this.state.tensorInfo.get(c).backend.read(c)},p.prototype.time=function(c){return R(this,void 0,void 0,function(){var a,l;return P(this,function(g){switch(g.label){case 0:return a=nn(),[4,this.backend.time(c)];case 1:return(l=g.sent()).wallMs=nn()-a,[2,l]}})})},p.prototype.track=function(c){return this.state.activeScope!=null&&(c.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(c)),c},Object.defineProperty(p.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),p.prototype.reset=function(){for(var c in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new pn,this.registry)this.disposeRegisteredKernels(c),this.registry[c].dispose(),delete this.registry[c];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},p.nextTensorId=0,p.nextVariableId=0,p}(),Ve=function(){var p=function(){if(It==null){var a=void 0;if(typeof window<"u")a=window;else if(b!==void 0)a=b;else if(H!==void 0)a=H;else{if(typeof self>"u")throw new Error("Could not find a global object");a=self}It=a}return It}();if(p._tfengine==null){var c=new $(p);p._tfengine=new qt(c)}return function(a){ee=a}(p._tfengine.ENV),Ci=function(){return p._tfengine},p._tfengine}();function jn(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var $n=L();$n.registerFlag("DEBUG",function(){return!1},function(p){p&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),$n.registerFlag("IS_BROWSER",function(){return jn()}),$n.registerFlag("IS_NODE",function(){return H!==void 0&&H.versions!==void 0&&H.versions.node!==void 0}),$n.registerFlag("IS_CHROME",function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}),$n.registerFlag("PROD",function(){return!1}),$n.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return $n.getBool("DEBUG")}),$n.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0}),$n.registerFlag("IS_TEST",function(){return!1});var Zn,ir,zr,vr={},pi={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function la(p,c){vr[p]=c}function ui(p){p in vr||(vr[p]=function(a){if(a!==1&&a!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var l=function(g){if(typeof OffscreenCanvas<"u"&&g===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(a);return l.addEventListener("webglcontextlost",function(g){g.preventDefault(),delete vr[a]},!1),a===1?l.getContext("webgl",pi)||l.getContext("experimental-webgl",pi):l.getContext("webgl2",pi)}(p));var c=vr[p];return c.isContextLost()?(delete vr[p],ui(p)):(c.disable(c.DEPTH_TEST),c.disable(c.STENCIL_TEST),c.disable(c.BLEND),c.disable(c.DITHER),c.disable(c.POLYGON_OFFSET_FILL),c.disable(c.SAMPLE_COVERAGE),c.enable(c.SCISSOR_TEST),c.enable(c.CULL_FACE),c.cullFace(c.BACK),vr[p])}function Qi(p,c){return[c,p]}function Di(p){var c=Ye(p);return Mt(Math.ceil(c/4))}function qr(p,c){return[Math.max(1,Math.ceil(c/2)),Math.max(1,Math.ceil(p/2))]}function jr(p,c){var a,l,g,_,j,V,ne,oe,me,Ee=p;return L().getNumber("WEBGL_VERSION")===2?(a=Ee.R32F,l=Ee.R16F,g=Ee.RGBA16F,_=Ee.RGBA32F,j=Ee.RED,V=4,ne=1,oe=Ee.HALF_FLOAT,me=Ee.FLOAT):(a=p.RGBA,l=p.RGBA,g=p.RGBA,_=Ee.RGBA,j=p.RGBA,V=4,ne=4,oe=c!=null?c.HALF_FLOAT_OES:null,me=p.FLOAT),{internalFormatFloat:a,internalFormatHalfFloat:l,internalFormatPackedHalfFloat:g,internalFormatPackedFloat:_,textureFormatFloat:j,downloadTextureFormat:p.RGBA,downloadUnpackNumChannels:V,defaultNumChannels:ne,textureTypeHalfFloat:oe,textureTypeFloat:me}}function Bn(p,c,a){var l=a();return c&&function(g){var _=g.getError();if(_!==g.NO_ERROR)throw new Error("WebGL Error: "+aa(g,_))}(p),l}(function(p){p[p.DENSE=0]="DENSE",p[p.SHARED_BATCH=1]="SHARED_BATCH"})(Zn||(Zn={})),function(p){p[p.RENDER=0]="RENDER",p[p.UPLOAD=1]="UPLOAD",p[p.PIXELS=2]="PIXELS",p[p.DOWNLOAD=3]="DOWNLOAD"}(ir||(ir={})),function(p){p[p.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",p[p.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",p[p.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",p[p.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",p[p.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(zr||(zr={}));var ri=596e-10,Vi=65504;function Fr(p){return!!(L().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||p===0||ri<Math.abs(p)&&Math.abs(p)<Vi)}function aa(p,c){switch(c){case p.NO_ERROR:return"NO_ERROR";case p.INVALID_ENUM:return"INVALID_ENUM";case p.INVALID_VALUE:return"INVALID_VALUE";case p.INVALID_OPERATION:return"INVALID_OPERATION";case p.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case p.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case p.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+c}}function ma(p,c,a){return so(p,c,function(){return p.getExtension(a)},'Extension "'+a+'" not supported on this browser.')}function Zi(p,c,a){var l=so(p,c,function(){return p.createShader(p.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(Bn(p,c,function(){return p.shaderSource(l,a)}),Bn(p,c,function(){return p.compileShader(l)}),p.getShaderParameter(l,p.COMPILE_STATUS)===!1)throw console.log(p.getShaderInfoLog(l)),new Error("Failed to compile vertex shader.");return l}function ga(p,c,a){var l=so(p,c,function(){return p.createShader(p.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(Bn(p,c,function(){return p.shaderSource(l,a)}),Bn(p,c,function(){return p.compileShader(l)}),p.getShaderParameter(l,p.COMPILE_STATUS)===!1)throw function(g,_){var j=Eh.exec(_);if(j==null)return console.log("Couldn't parse line number in error: "+_),void console.log(g);for(var V=+j[1],ne=g.split(`
`),oe=ne.length.toString().length+2,me=ne.map(function(He,et){return bn((et+1).toString(),oe)+He}),Ee=0,_e=0;_e<me.length;_e++)Ee=Math.max(me[_e].length,Ee);var Ne=me.slice(0,V-1),Ue=me.slice(V-1,V),$e=me.slice(V);console.log(Ne.join(`
`)),console.log(_.split(`
`)[0]),console.log("%c "+bn(Ue[0],Ee),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log($e.join(`
`))}(a,p.getShaderInfoLog(l)),new Error("Failed to compile fragment shader.");return l}var No,vs,Eh=/ERROR: [0-9]+:([0-9]+):/g;function qi(p,c){return so(p,c,function(){return p.createProgram()},"Unable to create WebGLProgram.")}function ec(p,c,a){if(Bn(p,c,function(){return p.linkProgram(a)}),p.getProgramParameter(a,p.LINK_STATUS)===!1)throw console.log(p.getProgramInfoLog(a)),new Error("Failed to link vertex and fragment shaders.")}function bu(p,c,a){if(Bn(p,c,function(){return p.validateProgram(a)}),p.getProgramParameter(a,p.VALIDATE_STATUS)===!1)throw console.log(p.getProgramInfoLog(a)),new Error("Shader program validation failed.")}function bc(p,c,a){var l=so(p,c,function(){return p.createBuffer()},"Unable to create WebGLBuffer");return Bn(p,c,function(){return p.bindBuffer(p.ARRAY_BUFFER,l)}),Bn(p,c,function(){return p.bufferData(p.ARRAY_BUFFER,a,p.STATIC_DRAW)}),l}function Bu(p,c,a){var l=so(p,c,function(){return p.createBuffer()},"Unable to create WebGLBuffer");return Bn(p,c,function(){return p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,l)}),Bn(p,c,function(){return p.bufferData(p.ELEMENT_ARRAY_BUFFER,a,p.STATIC_DRAW)}),l}function xc(p,c){return so(p,c,function(){return p.createTexture()},"Unable to create WebGLTexture.")}function Dd(p,c){var a=L().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(p<=0||c<=0){var l="["+p+"x"+c+"]";throw new Error("Requested texture size "+l+" is invalid.")}if(p>a||c>a)throw l="["+p+"x"+c+"]",new Error("Requested texture size "+l+" greater than WebGL maximum on this browser / GPU ["+a+"x"+a+"].")}function os(p,c){return so(p,c,function(){return p.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function vf(p,c,a,l,g,_,j,V){var ne=p.getAttribLocation(a,l);return ne!==-1&&(Bn(p,c,function(){return p.bindBuffer(p.ARRAY_BUFFER,g)}),Bn(p,c,function(){return p.vertexAttribPointer(ne,_,p.FLOAT,!1,j,V)}),Bn(p,c,function(){return p.enableVertexAttribArray(ne)}),!0)}function Td(p,c,a,l){tc(p,l),Bn(p,c,function(){return p.activeTexture(p.TEXTURE0+l)}),Bn(p,c,function(){return p.bindTexture(p.TEXTURE_2D,a)})}function Pu(p,c,a,l){return so(p,c,function(){return p.getUniformLocation(a,l)},'uniform "'+l+'" not present in program.')}function yf(p,c,a){return p.getUniformLocation(c,a)}function Ch(p,c,a,l,g,_){Bn(p,c,function(){return Td(p,c,l,_)}),Bn(p,c,function(){return p.uniform1i(g,_)})}function wc(p,c,a,l){Bn(p,c,function(){return p.bindFramebuffer(p.FRAMEBUFFER,l)}),Bn(p,c,function(){return p.framebufferTexture2D(p.FRAMEBUFFER,p.COLOR_ATTACHMENT0,p.TEXTURE_2D,a,0)})}function El(p,c,a){Bn(p,c,function(){return p.bindFramebuffer(p.FRAMEBUFFER,a)}),Bn(p,c,function(){return p.framebufferTexture2D(p.FRAMEBUFFER,p.COLOR_ATTACHMENT0,p.TEXTURE_2D,null,0)})}function Io(p){var c=p.checkFramebufferStatus(p.FRAMEBUFFER);if(c!==p.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+Vc(p,c))}function Vc(p,c){switch(c){case p.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case p.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case p.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case p.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+c}}function so(p,c,a,l){var g=Bn(p,c,function(){return a()});if(g==null)throw new Error(l);return g}function tc(p,c){var a=p.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,l=c+p.TEXTURE0;if(l<p.TEXTURE0||l>a)throw new Error("textureUnit must be in [gl.TEXTURE0, gl.TEXTURE"+a+"].")}function ss(p,c){return c===void 0&&(c=2),Ye(p.slice(0,p.length-c))}function Eo(p){if(p.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[p.length>1?p[p.length-2]:1,p[p.length-1]]}function nc(p){var c=[1,1,1];return p.length===0||p.length===1&&p[0]===1||(c=[ss(p)].concat(Eo(p))),c}function Cl(p,c){var a;c===void 0&&(c=!1);var l=L().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(c&&(l*=2,(p=p.map(function(oe,me){return me>=p.length-2?zt(p[me]):p[me]})).length===1&&(p=[2,p[0]])),p.length!==2){var g=In(p);p=g.newShape}var _=Ye(p);if(p.length<=1&&_<=l)return[1,_];if(p.length===2&&p[0]<=l&&p[1]<=l)return p;if(p.length===3&&p[0]*p[1]<=l&&p[2]<=l)return[p[0]*p[1],p[2]];if(p.length===3&&p[0]<=l&&p[1]*p[2]<=l)return[p[0],p[1]*p[2]];if(p.length===4&&p[0]*p[1]*p[2]<=l&&p[3]<=l)return[p[0]*p[1]*p[2],p[3]];if(p.length===4&&p[0]<=l&&p[1]*p[2]*p[3]<=l)return[p[0],p[1]*p[2]*p[3]];if(c){var j=ss(p),V=2,ne=2;return p.length&&(V=(a=Eo(p))[0],ne=a[1]),Mt(_=j*(V/2)*(ne/2)).map(function(oe){return 2*oe})}return Mt(_)}function rc(p){return p%2==0}function su(p,c){if(ln(p=p.slice(-2),c=c.slice(-2))||!p.length||!c.length||p[0]===0||p[1]===0||c[0]===0||c[1]===0)return!0;if(p.length!==c.length){var a=p.slice(-1)[0],l=c.slice(-1)[0];if(a===l||rc(a)&&rc(l)&&(p[0]===1||c[0]===1))return!0}return p[1]===c[1]&&rc(p[0])&&rc(c[0])}function Oh(p){if(No==null){var c=ui(p);No=c.getParameter(c.MAX_TEXTURE_SIZE)}return No}function bf(p){if(vs==null){var c=ui(p);vs=c.getParameter(c.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,vs)}function xf(p){if(p===0)return 0;var c=ui(p);return lo(c,"EXT_disjoint_timer_query_webgl2")&&p===2?2:lo(c,"EXT_disjoint_timer_query")?1:0}function lo(p,c){return p.getExtension(c)!=null}function Ah(p){try{if(ui(p)!=null)return!0}catch{return!1}return!1}function Nd(p){if(p===0)return!1;var c=ui(p);if(p===1){if(!lo(c,"OES_texture_float"))return!1}else if(!lo(c,"EXT_color_buffer_float"))return!1;return kf(c)}function wf(p){if(p===0)return!1;var c=ui(p);return p!==1?lo(c,"EXT_color_buffer_float")?kf(c):!!lo(c,"EXT_color_buffer_half_float")&&function(a,l){var g=jr(a,l),_=a.createTexture();a.bindTexture(a.TEXTURE_2D,_),a.texImage2D(a.TEXTURE_2D,0,g.internalFormatHalfFloat,1,1,0,g.textureFormatFloat,g.textureTypeHalfFloat,null);var j=a.createFramebuffer();a.bindFramebuffer(a.FRAMEBUFFER,j),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,_,0);var V=a.checkFramebufferStatus(a.FRAMEBUFFER)===a.FRAMEBUFFER_COMPLETE;return a.bindTexture(a.TEXTURE_2D,null),a.bindFramebuffer(a.FRAMEBUFFER,null),a.deleteTexture(_),a.deleteFramebuffer(j),V}(c,c.getExtension("EXT_color_buffer_half_float")):!!lo(c,"OES_texture_float")&&!!lo(c,"WEBGL_color_buffer_float")&&kf(c)}function kf(p){var c=jr(p),a=p.createTexture();p.bindTexture(p.TEXTURE_2D,a),p.texImage2D(p.TEXTURE_2D,0,c.internalFormatFloat,1,1,0,c.textureFormatFloat,c.textureTypeFloat,null);var l=p.createFramebuffer();p.bindFramebuffer(p.FRAMEBUFFER,l),p.framebufferTexture2D(p.FRAMEBUFFER,p.COLOR_ATTACHMENT0,p.TEXTURE_2D,a,0);var g=p.checkFramebufferStatus(p.FRAMEBUFFER)===p.FRAMEBUFFER_COMPLETE;return p.bindTexture(p.TEXTURE_2D,null),p.bindFramebuffer(p.FRAMEBUFFER,null),p.deleteTexture(a),p.deleteFramebuffer(l),g}function ys(p){return p===2&&ui(p).fenceSync!=null}var Ef=Object.freeze({callAndCheck:Bn,canBeRepresented:Fr,getWebGLErrorMessage:aa,getExtensionOrThrow:ma,createVertexShader:Zi,createFragmentShader:ga,createProgram:qi,linkProgram:ec,validateProgram:bu,createStaticVertexBuffer:bc,createStaticIndexBuffer:Bu,getNumChannels:function(){return L().getNumber("WEBGL_VERSION")===2?1:4},createTexture:xc,validateTextureSize:Dd,createFramebuffer:os,bindVertexBufferToProgramAttribute:vf,bindTextureUnit:Td,unbindTextureUnit:function(p,c,a){tc(p,a),Bn(p,c,function(){return p.activeTexture(p.TEXTURE0+a)}),Bn(p,c,function(){return p.bindTexture(p.TEXTURE_2D,null)})},getProgramUniformLocationOrThrow:Pu,getProgramUniformLocation:yf,bindTextureToProgramUniformSampler:Ch,bindCanvasToFramebuffer:function(p,c){Bn(p,c,function(){return p.bindFramebuffer(p.FRAMEBUFFER,null)}),Bn(p,c,function(){return p.viewport(0,0,p.canvas.width,p.canvas.height)}),Bn(p,c,function(){return p.scissor(0,0,p.canvas.width,p.canvas.height)})},bindColorTextureToFramebuffer:wc,unbindColorTextureFromFramebuffer:El,validateFramebuffer:Io,getFramebufferErrorMessage:Vc,getBatchDim:ss,getRowsCols:Eo,getShapeAs3D:nc,getTextureShapeFromLogicalShape:Cl,isReshapeFree:su,getWebGLMaxTextureSize:Oh,resetMaxTextureSize:function(){No=null},resetMaxTexturesInShader:function(){vs=null},getMaxTexturesInShader:bf,getWebGLDisjointQueryTimerVersion:xf,hasExtension:lo,isWebGLVersionEnabled:Ah,isCapableOfRenderingToFloatTexture:Nd,isDownloadFloatTextureEnabled:wf,isWebGLFenceEnabled:ys}),or=L();function xu(){L().set("PROD",!0)}function Tp(){L().set("DEBUG",!0)}function Np(){L().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")}function Cf(p){L().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(p+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function Ol(){Ve.disposeVariables()}function Id(){return Ve}function _h(){return Ve.memory()}function Sh(p){return Ve.profile(p)}function Fi(p,c){return Ve.tidy(p,c)}function Na(p){Hn(p).forEach(function(c){return c.dispose()})}function Dh(p){return Ve.keep(p)}function bm(p){return Ve.time(p)}function Of(p){return Ve.setBackend(p)}function Fd(){return Ve.ready()}function bs(){return Ve.backendName}function ic(p){Ve.removeBackend(p)}function Rd(p){return Ve.findBackend(p)}function Ip(p){return Ve.findBackendFactory(p)}function Fp(p,c,a){return a===void 0&&(a=1),Ve.registerBackend(p,c,a)}function xm(){return Ve.backend}function wm(p,c){L().setPlatform(p,c)}function qc(){for(var p=[],c=0;c<arguments.length;c++)p[c]=arguments[c];L().getBool("IS_TEST")||console.warn.apply(console,p)}function zo(p,c){var a=p;if(Et(p))return c==="string"?[]:[p.length];if(!Array.isArray(p))return[];for(var l=[];Array.isArray(a)||Et(a)&&c!=="string";)l.push(a.length),a=a[0];return Array.isArray(p)&&L().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function g(_,j,V){if(V=V||[],Array.isArray(_)||Et(_)){we(j.length>0,function(){return"Element arr["+V.join("][")+"] should be a primitive, but is an array of "+_.length+" elements"}),we(_.length===j[0],function(){return"Element arr["+V.join("][")+"] should have "+j[0]+" elements, but has "+_.length+" elements"});for(var ne=j.slice(1),oe=0;oe<_.length;++oe)g(_[oe],ne,V.concat(oe))}else we(j.length===0,function(){return"Element arr["+V.join("][")+"] is a primitive, but should be an array/TypedArray of "+j[0]+" elements"})}(p,l,[]),l}function Th(p,c,a,l){if(p!=null&&(p!=="numeric"&&p!==c||p==="numeric"&&c==="string"))throw new Error("Argument '"+a+"' passed to '"+l+"' must be "+p+" tensor, but got "+c+" tensor")}function Ke(p,c,a,l){if(l===void 0&&(l="numeric"),p instanceof jt)return Th(l,p.dtype,c,a),p;var g=xe(p);if(g!=="string"&&["bool","int32","float32"].indexOf(l)>=0&&(g=l),Th(l,g,c,a),p==null||!Et(p)&&!Array.isArray(p)&&typeof p!="number"&&typeof p!="boolean"&&typeof p!="string"){var _=p==null?"null":p.constructor.name;throw new Error("Argument '"+c+"' passed to '"+a+"' must be a Tensor or TensorLike, but got '"+_+"'")}var j=zo(p,g);Et(p)||Array.isArray(p)||(p=[p]);var V=g!=="string"?dr(p,g,L().getBool("DEBUG")):Pt(p,[],!0);return Ve.makeTensor(V,j,g)}function Lu(p,c,a,l){if(l===void 0&&(l="numeric"),!Array.isArray(p))throw new Error("Argument "+c+" passed to "+a+" must be a `Tensor[]` or `TensorLike[]`");return p.map(function(g,_){return Ke(g,c+"["+_+"]",a)},l)}function Af(p,c){for(var a=0;a<p.length;++a)if(p[p.length-a-1]!==c-1-a)return!1;return!0}function Md(p,c,a){for(var l=p.length+c.length,g=[],_=0,j=0,V=0;V<l;V++)a.indexOf(V)===-1?g.push(p[_++]):g.push(c[j++]);return g}function Aa(p,c){for(var a=[],l=p.length,g=0;g<l;g++)c.indexOf(g)===-1&&a.push(p[g]);return[a,c.map(function(_){return p[_]})]}function _a(p,c){return Md(p,c.map(function(a){return 1}),c)}function Ga(p,c,a){we(Af(c,a),function(){return p+" supports only inner-most axes for now. Got axes "+c+" and rank-"+a+" input."})}function Co(p,c){if(Af(p,c))return null;for(var a=[],l=0;l<c;++l)p.indexOf(l)===-1&&a.push(l);return p.forEach(function(g){return a.push(g)}),a}function wu(p){return p.map(function(c,a){return[a,c]}).sort(function(c,a){return c[1]-a[1]}).map(function(c){return c[0]})}function Oo(p,c){for(var a=[],l=c-p;l<c;++l)a.push(l);return a}function kc(p,c){var a=p[0].length;p.forEach(function(g,_){we(g.length===a,function(){return"Error in concat"+a+"D: rank of tensors["+_+"] must be the same as the rank of the rest ("+a+")"})}),we(c>=0&&c<a,function(){return"Error in concat"+a+"D: axis must be between 0 and "+(a-1)+"."});var l=p[0];p.forEach(function(g,_){for(var j=0;j<a;j++)we(j===c||g[j]===l[j],function(){return"Error in concat"+a+"D: Shape of tensors["+_+"] ("+g+") does not match the shape of the rest ("+l+") along the non-concatenated axis "+_+"."})})}function Zs(p,c){for(var a=p[0].slice(),l=1;l<p.length;l++)a[c]+=p[l][c];return a}function xt(p){var c=Object.keys(p);if(c.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+c.length+" keys.");var a=c[0],l=p[a];a.endsWith("_")&&(a=a.substring(0,a.length-1));var g=function(){for(var _=[],j=0;j<arguments.length;j++)_[j]=arguments[j];Ve.startScope(a);try{var V=l.apply(void 0,_);return V instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),Ve.endScope(V),V}catch(ne){throw Ve.endScope(null),ne}};return Object.defineProperty(g,"name",{value:a,configurable:!0}),g}or.registerFlag("HAS_WEBGL",function(){return or.getNumber("WEBGL_VERSION")>0}),or.registerFlag("WEBGL_VERSION",function(){return Ah(2)?2:Ah(1)?1:0}),or.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return or.get("WEBGL_VERSION")===2}),or.registerFlag("WEBGL_CPU_FORWARD",function(){return!0}),or.registerFlag("WEBGL_FORCE_F16_TEXTURES",function(){return!1}),or.registerFlag("WEBGL_PACK",function(){return or.getBool("HAS_WEBGL")}),or.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return or.getBool("WEBGL_PACK")}),or.registerFlag("WEBGL_PACK_CLIP",function(){return or.getBool("WEBGL_PACK")}),or.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return!1}),or.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return or.getBool("WEBGL_PACK")}),or.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",function(){return or.getBool("WEBGL_PACK")}),or.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return or.getBool("WEBGL_PACK")}),or.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return or.getBool("WEBGL_PACK")}),or.registerFlag("WEBGL_PACK_REDUCE",function(){return or.getBool("WEBGL_PACK")}),or.registerFlag("WEBGL_LAZILY_UNPACK",function(){return or.getBool("WEBGL_PACK")}),or.registerFlag("WEBGL_CONV_IM2COL",function(){return or.getBool("WEBGL_PACK")}),or.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return Oh(or.getNumber("WEBGL_VERSION"))}),or.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return bf(or.getNumber("WEBGL_VERSION"))}),or.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var p=or.getNumber("WEBGL_VERSION");return p===0?0:xf(p)}),or.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return or.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(p=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(p)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(p.substr(0,4))));var p}),or.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",function(){return Nd(or.getNumber("WEBGL_VERSION"))}),or.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return!or.getBool("WEBGL_FORCE_F16_TEXTURES")&&or.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")}),or.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return wf(or.getNumber("WEBGL_VERSION"))}),or.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return ys(or.getNumber("WEBGL_VERSION"))}),or.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){return or.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0}),Lr=Cf;var fa=xt({complex_:function(p,c){var a=Ke(p,"real","complex"),l=Ke(c,"imag","complex");return Tt(a.shape,l.shape,"real and imag shapes, "+a.shape+" and "+l.shape+", must match in call to tf.complex()."),Ve.runKernelFunc(function(g){return g.complex(a,l)},{$real:a,$imag:l})}}),uo=xt({real_:function(p){var c=Ke(p,"input","real");return Ve.runKernelFunc(function(a){return a.real(c)},{$input:c})}}),Uo=xt({imag_:function(p){var c=Ke(p,"input","imag");return Ve.runKernelFunc(function(a){return a.imag(c)},{$input:c})}});function wa(p,c,a){return xs(p,c,zo(p,a),a)}function xs(p,c,a,l){if(l==null&&(l=xe(p)),l==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!Et(p)&&!Array.isArray(p)&&typeof p!="number"&&typeof p!="boolean"&&typeof p!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(c!=null){Gn(c);var g=Ye(c),_=Ye(a);we(g===_,function(){return"Based on the provided shape, ["+c+"], the tensor should have "+g+" values but has "+_});for(var j=0;j<a.length;++j){var V=a[j],ne=j!==a.length-1||V!==Ye(c.slice(j));we(a[j]===c[j]||!ne,function(){return"Error creating a new Tensor. Inferred shape ("+a+") does not match the provided shape ("+c+"). "})}}return Et(p)||Array.isArray(p)||(p=[p]),c=c||a,p=l!=="string"?dr(p,l,L().getBool("DEBUG")):Pt(p,[],!0),Ve.makeTensor(p,c,l)}function fr(p,c){if((Et(p)&&c!=="string"||Array.isArray(p))&&c!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(c==="string"&&Et(p)&&!(p instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return xs(p,[],[],c)}function zs(p,c){Gt(p);var a=zo(p,c);if(a.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return xs(p,null,a,c)}function eu(p,c,a){if(Gt(p),c!=null&&c.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var l=zo(p,a);if(l.length!==2&&l.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(l.length===1&&c==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return xs(p,c,l,a)}function Hc(p,c,a){if(Gt(p),c!=null&&c.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var l=zo(p,a);if(l.length!==3&&l.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(l.length===1&&c==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return xs(p,c,l,a)}function Us(p,c,a){if(Gt(p),c!=null&&c.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var l=zo(p,a);if(l.length!==4&&l.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(l.length===1&&c==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return xs(p,c,l,a)}function Nh(p,c,a){if(Gt(p),c!=null&&c.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var l=zo(p,a);if(l.length!==5&&l.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(l.length===1&&c==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return xs(p,c,l,a)}function jd(p,c,a){if(Gt(p),c!=null&&c.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var l=zo(p,a);if(l.length!==6&&l.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(l.length===1&&c==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return xs(p,c=c||l,l,a)}function Bd(p,c,a,l){return c===void 0&&(c=!0),Ve.makeVariable(p,c,a,l)}function uu(p,c){if(c===void 0&&(c="float32"),c==="complex64"){var a=uu(p,"float32"),l=Ki(p,"float32");return fa(a,l)}var g=hn(Ye(p),c);return Ve.makeTensor(g,p,c)}function Ki(p,c){if(c===void 0&&(c="float32"),c==="complex64"){var a=Ki(p,"float32"),l=Ki(p,"float32");return fa(a,l)}var g=Xt(Ye(p),c);return Ve.makeTensor(g,p,c)}function ws(p,c,a){return Ve.runKernelFunc(function(l){return l.fill(p,c,a)},{})}function Ih(p,c,a){if(a<=0)throw new Error("The number of values should be positive.");return Ve.runKernelFunc(function(l){return l.linspace(p,c,a)},{})}function ac(p,c,a,l){if(a===void 0&&(a=1),l===void 0&&(l="float32"),a===0)throw new Error("Cannot have a step of zero");if(p===c||p<c&&a<0||c<p&&a>1)return Ki([0],l);var g=Xt(Math.abs(Math.ceil((c-p)/a)),l);c<p&&a===1&&(a=-1),g[0]=p;for(var _=1;_<g.length;_++)g[_]=g[_-1]+a;return zs(g,l)}var us=xt({onesLike_:function(p){var c=Ke(p,"x","onesLike");if(c.dtype==="complex64"){var a=us(uo(c)),l=ii(Uo(c));return fa(a,l)}return Ve.runKernelFunc(function(g){return g.onesLike(c)},{x:c},function(g,_){return{x:function(){return ii(g)}}},"OnesLike")}}),ii=xt({zerosLike_:function(p){var c=Ke(p,"x","zerosLike");return Ve.runKernelFunc(function(a){return a.zerosLike(c)},{x:c},function(a,l){return{x:function(){return ii(a)}}},"ZerosLike")}}),Ba=xt({concat_:function(p,c){c===void 0&&(c=0),we(p.length>=1,function(){return"Pass at least one tensor to concat"});var a=Lu(p,"tensors","concat");a[0].dtype==="complex64"&&a.forEach(function(V){if(V.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `+V.dtype+". ")}),c=xn(c,a[0].shape)[0];var l=Zs(a.map(function(V){return V.shape}),c);if(Ye(l)===0)return wa([],l);if((a=a.filter(function(V){return V.size>0})).length===1)return a[0];var g=a.map(function(V){return V.shape});kc(g,c);var _=a,j={axis:c};return Ve.runKernelFunc(function(V){return V.concat(a,c)},_,function(V){var ne=g.map(function(oe){return oe[c]});return Ri(V,ne,c).map(function(oe){return function(){return oe}})},"Concat",j)}}),Fh=xt({concat1d_:function(p){return Ba(p,0)}}),Pd=xt({concat2d_:function(p,c){return Ba(p,c)}}),Al=xt({concat3d_:function(p,c){return Ba(p,c)}}),Rh=xt({concat4d_:function(p,c){return Ba(p,c)}}),Ri=xt({split_:function(p,c,a){a===void 0&&(a=0);var l,g=Ke(p,"x","split");return a=xn(a,g.shape)[0],typeof c=="number"?(we(g.shape[a]%c==0,function(){return"Number of splits must evenly divide the axis."}),l=new Array(c).fill(g.shape[a]/c)):(we(g.shape[a]===c.reduce(function(_,j){return _+j}),function(){return"The sum of sizes must match the size of the axis dimension."}),l=c),Ve.runKernelFunc(function(_){return _.split(g,l,a)},{$x:g},function(_){return{$x:function(){return Ba(_,a)}}})}});function bi(p,c,a){return c===void 0&&(c="float32"),c=c||"float32",Gn(p),new Wi(p,c,a)}function ro(p,c){c===void 0&&(c=!1),console.log(p.toString(c))}var Ld=xt({batchToSpaceND_:function(p,c,a){var l=Ke(p,"x","batchToSpaceND"),g=c.reduce(function(_,j){return _*j});return we(l.rank>=1+c.length,function(){return"input rank is "+l.rank+" but should be > than blockShape.length "+c.length}),we(a.length===c.length,function(){return"crops.length is "+a.length+" but should be equal to blockShape.length  "+c.length}),we(l.shape[0]%g==0,function(){return"input tensor batch is "+l.shape[0]+" but is not divisible by the product of the elements of blockShape "+c.join(" * ")+" === "+g}),Ve.runKernelFunc(function(_){return _.batchToSpaceND(l,c,a)},{$x:l},function(_){return{$x:function(){return _.spaceToBatchND(c,a)}}})}}),zd=xt({cast_:function(p,c){var a=Ke(p,"x","cast");if(!Pe(c))throw new Error("Failed to cast to unknown dtype "+c);if(c==="string"&&a.dtype!=="string"||c!=="string"&&a.dtype==="string")throw new Error("Only strings can be casted to strings");var l={dtype:c};return Ve.runKernelFunc(function(g){return g.cast(a,c)},{x:a},function(g){return{x:function(){return g.clone()}}},"Cast",l)}}),Ud=xt({cumsum_:function(p,c,a,l){c===void 0&&(c=0),a===void 0&&(a=!1),l===void 0&&(l=!1);var g=Ke(p,"x","cumsum"),_=Co([c|=0],g.rank),j=g;_!=null&&(j=g.transpose(_));var V=Oo(1,g.rank)[0],ne=Ve.runKernelFunc(function(oe){return oe.cumsum(j,V,a,l)},{permutedX:j},function(oe){return{permutedX:function(){return oe.cumsum(c,a,!l)}}});return _!=null&&(ne=ne.transpose(_)),ne}}),Rp=xt({depthToSpace_:function(p,c,a){a===void 0&&(a="NHWC");var l=Ke(p,"x","depthToSpace"),g=a==="NHWC"?l.shape[1]:l.shape[2],_=a==="NHWC"?l.shape[2]:l.shape[3],j=a==="NHWC"?l.shape[3]:l.shape[1];return we(g*c>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+g+" and "+c+`  for depthToSpace with input shape
      `+l.shape}),we(_*c>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+_+" and "+c+` for depthToSpace with input shape
          `+l.shape}),we(j%(c*c)==0,function(){return"Dimension size must be evenly divisible by "+c*c+" but is "+j+" for depthToSpace with input shape "+l.shape}),Ve.runKernelFunc(function(V){return V.depthToSpace(l,c,a)},{$x:l})}}),zu=xt({expandDims_:function(p,c){c===void 0&&(c=0);var a=Ke(p,"x","expandDims",null);we(c<=a.rank,function(){return"Axis must be <= rank of the tensor"});var l=a.shape.slice();return c<0&&(we(-(a.rank+1)<=c,function(){return"Axis must be in the interval ["+-(a.rank+1)+", "+a.rank+"]"}),c=a.rank+c+1),l.splice(c,0,1),ks(a,l)}}),ks=xt({reshape_:function(p,c){var a=Ke(p,"x","reshape",null);c=_t(c,a.size),we(a.size===Ye(c),function(){return"new shape and old shape must have the same number of elements."});var l={shape:c};return Ve.runKernelFunc(function(g){return g.reshape(a,c)},{x:a},function(g){return{x:function(){return g.reshape(a.shape)}}},"Reshape",l)}}),$c=xt({spaceToBatchND_:function(p,c,a){var l=Ke(p,"x","spaceToBatchND");return we(l.rank>=1+c.length,function(){return"input rank "+l.rank+" should be > than [blockShape] "+c.length}),we(a.length===c.length,function(){return"paddings.shape[0] "+a.length+" must be equal to [blockShape] "+c.length}),we(l.shape.reduce(function(g,_,j){return j>0&&j<=c.length?g&&(_+a[j-1][0]+a[j-1][1])%c[j-1]==0:g},!0),function(){return"input spatial dimensions "+l.shape.slice(1)+" with paddings "+a.toString()+" must be divisible by blockShapes "+c.toString()}),Ve.runKernelFunc(function(g){return g.spaceToBatchND(l,c,a)},{$x:l},function(g){return{$x:function(){return g.batchToSpaceND(c,a)}}})}}),Rs=xt({squeeze_:function(p,c){var a=Ke(p,"x","squeeze");return ks(a,In(a.shape,c).newShape)}}),tu=xt({stack_:function(p,c){c===void 0&&(c=0);var a=Lu(p,"tensors","stack");if(we(a.length>=1,function(){return"Pass at least one tensor to tf.stack"}),a.length===1)return a[0].expandDims(c);var l=a[0].rank,g=a[0].shape,_=a[0].dtype;we(c<=l,function(){return"Axis must be <= rank of the tensor"}),a.forEach(function(V){Tt(g,V.shape,"All tensors passed to stack must have matching shapes")}),a.forEach(function(V){we(_===V.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var j=a.map(function(V){return V.expandDims(c)});return Ba(j,c)}}),Mh=xt({unstack_:function(p,c){c===void 0&&(c=0),c=c||0;var a=Ke(p,"x","unstack");we(c>=-a.shape.length&&c<a.shape.length,function(){return"Axis = "+c+" is not in [-"+a.shape.length+", "+a.shape.length+")"}),c<0&&(c+=a.shape.length);var l={axis:c};return Ve.runKernelFunc(function(g){return g.unstack(a,c)},{x:a},function(g){return{x:function(){return tu(g,c)}}},"Unpack",l)}}),Ni=function(p,c){return R(this,void 0,void 0,function(){var a,l,g,_,j,V,ne,oe,me,Ee;return P(this,function(_e){switch(_e.label){case 0:return a=Ke(p,"x","setdiff1d"),l=Ke(c,"y","setdiff1d"),we(a.dtype===l.dtype,function(){return"x and y should have the same dtype, but got x ("+a.dtype+") and y ("+l.dtype+")."}),we(a.rank===1,function(){return"x should be 1D tensor, but got x ("+a.shape+")."}),we(l.rank===1,function(){return"y should be 1D tensor, but got y ("+l.shape+")."}),[4,a.data()];case 1:return g=_e.sent(),[4,l.data()];case 2:for(_=_e.sent(),j=new Set(_),V=0,me=0;me<g.length;me++)j.has(g[me])||V++;for(ne=new Wi([V],a.dtype),oe=new Wi([V],"int32"),me=0,Ee=0;me<g.length;me++)j.has(g[me])||(ne.values[Ee]=g[me],oe.values[Ee]=me,Ee++);return[2,[ne.toTensor(),oe.toTensor()]]}})})};function _f(p,c,a,l){l===void 0&&(l=!0);var g=[];if(l)(g=g.concat(c.slice(0))).push(p[0]/a),g=g.concat(p.slice(1));else{g=g.concat(p[0]);for(var _=c.length,j=0;j<_;++j)g=g.concat([p[j+1]/c[j],c[j]]);g=g.concat(p.slice(_+1))}return g}function Gc(p,c,a){a===void 0&&(a=!0);var l=[];if(a){l.push(c);for(var g=c+1;g<p;++g)g<=2*c?(l.push(g),l.push(g-(c+1))):l.push(g)}else{var _=[],j=[];for(g=1;g<p;++g)g>=2*c+1||g%2==1?j.push(g):_.push(g);l.push.apply(l,_),l.push(0),l.push.apply(l,j)}return l}function _l(p,c,a,l){l===void 0&&(l=!0);var g=[];l?g.push(p[0]/a):g.push(p[0]*a);for(var _=1;_<p.length;++_)_<=c.length?l?g.push(c[_-1]*p[_]):g.push(p[_]/c[_-1]):g.push(p[_]);return g}function Wd(p,c){for(var a=[0],l=0;l<c;++l)a.push(p[l][0]);return a}function Mp(p,c,a){for(var l=p.slice(0,1),g=0;g<a;++g)l.push(p[g+1]-c[g][0]-c[g][1]);return l}var Sl="Add",jh="AddN",Pa="Div",Bh="FusedBatchNorm",Dl="SquaredDifference",Ph="Square",Tl="Transpose",Kc="NonMaxSuppressionV5",Ec="BroadcastTo",Lh="OneHot",Sf="Identity",Nl="Tile",Cc="PadV2",km="FromPixels",Il="MaxPoolWithArgmax",eo=xt({add_:function(p,c){var a,l=Ke(p,"a","add"),g=Ke(c,"b","add");a=An(l,g),l=a[0],g=a[1];var _={a:l,b:g};return Ve.runKernelFunc(function(j,V){var ne=j.add(l,g);return V([l,g]),ne},_,null,Sl)}});function Ao(p,c){for(var a=p.length,l=[],g=0;g<a;g++){var _=a-1-g,j=p[_]||1;(c[c.length-1-g]||1)>1&&j===1&&l.unshift(_)}return l}function Fo(p,c){for(var a=[],l=0;l<c.length;l++){var g=p[p.length-l-1],_=c.length-l-1,j=c[_];(g==null||g===1&&j>1)&&a.unshift(_)}return a}function Mi(p,c){for(var a=[],l=Math.max(p.length,c.length),g=0;g<l;g++){var _=p[p.length-g-1];_==null&&(_=1);var j=c[c.length-g-1];if(j==null&&(j=1),_===1)a.unshift(j);else if(j===1)a.unshift(_);else{if(_!==j)throw Error("Operands could not be broadcast together with shapes "+p+" and "+c+".");a.unshift(_)}}return a}var Es=xt({abs_:function(p){var c=Ke(p,"x","abs");return c.dtype==="complex64"?Ve.runKernelFunc(function(a){return a.complexAbs(c)},{$x:c}):Ve.runKernelFunc(function(a,l){var g=a.abs(c);return l([c]),g},{x:c},function(a,l){var g=l[0];return{x:function(){return a.mul(g.toFloat().step(-1))}}},"Abs")}}),Oc=xt({acos_:function(p){var c=Ke(p,"x","acos");return Ve.runKernelFunc(function(a,l){var g=a.acos(c);return l([c]),g},{$x:c},function(a,l){var g=l[0];return{$x:function(){return a.divStrict(fr(1).sub(g.toFloat().square()).sqrt()).neg()}}})}}),Ro=xt({acosh_:function(p){var c=Ke(p,"x","acosh");return Ve.runKernelFunc(function(a,l){var g=a.acosh(c);return l([c]),g},{$x:c},function(a,l){var g=l[0];return{$x:function(){return a.divStrict(g.toFloat().square().sub(1).sqrt())}}})}}),Ac=xt({asin_:function(p){var c=Ke(p,"x","asin");return Ve.runKernelFunc(function(a,l){var g=a.asin(c);return l([c]),g},{$x:c},function(a,l){var g=l[0];return{$x:function(){return a.divStrict(fr(1).sub(g.toFloat().square()).sqrt())}}})}}),Uu=xt({asinh_:function(p){var c=Ke(p,"x","asinh");return Ve.runKernelFunc(function(a,l){var g=a.asinh(c);return l([c]),g},{$x:c},function(a,l){var g=l[0];return{$x:function(){return a.divStrict(fr(1).add(g.toFloat().square()).sqrt())}}})}}),Df=xt({atan_:function(p){var c=Ke(p,"x","atan");return Ve.runKernelFunc(function(a,l){var g=a.atan(c);return l([c]),g},{$x:c},function(a,l){var g=l[0];return{$x:function(){return a.div(g.toFloat().square().add(1))}}})}}),Tf=xt({atanh_:function(p){var c=Ke(p,"x","atanh");return Ve.runKernelFunc(function(a,l){var g=a.atanh(c);return l([c]),g},{$x:c},function(a,l){var g=l[0];return{$x:function(){return a.div(fr(1).sub(g.toFloat().square()))}}})}}),Xc=xt({ceil_:function(p){var c=Ke(p,"x","ceil");return Ve.runKernelFunc(function(a){return a.ceil(c)},{$x:c},function(a){return{$x:function(){return ii(a)}}})}}),Vd=xt({clipByValue_:function(p,c,a){var l=Ke(p,"x","clipByValue");we(c<=a,function(){return"Error in clip: min ("+c+") must be less than or equal to max ("+a+")."});var g=[l],_={min:c,max:a};return Ve.runKernelFunc(function(j,V){var ne=j.clip(l,c,a);return V([l]),ne},{x:l},function(j,V){var ne=V[0];return{x:function(){return j.where(ne.greaterEqual(c).logicalAnd(ne.lessEqual(a)),ii(j))}}},"ClipByValue",_,g)}}),Wu=xt({cos_:function(p){var c=Ke(p,"x","cos"),a=[c];return Ve.runKernelFunc(function(l,g){var _=l.cos(c);return g([c]),_},{x:c},function(l,g){var _=g[0];return{x:function(){return _.toFloat().sin().neg().mul(l)}}},"Cos",{},a)}}),Em=xt({cosh_:function(p){var c=Ke(p,"x","cosh");return Ve.runKernelFunc(function(a,l){var g=a.cosh(c);return l([c]),g},{$x:c},function(a,l){var g=l[0];return{$x:function(){return g.toFloat().sinh().mulStrict(a)}}})}}),qd=xt({erf_:function(p){var c=Ke(p,"x","erf");return we(c.dtype==="int32"||c.dtype==="float32",function(){return"Input dtype must be `int32` or `float32`."}),c.dtype==="int32"&&(c=c.toFloat()),Ve.runKernelFunc(function(a,l){var g=a.erf(c);return l([c]),g},{$x:c},function(a,l){var g=l[0];return{$x:function(){return a.mul(g.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),Fl=xt({exp_:function(p){var c=Ke(p,"x","exp");return Ve.runKernelFunc(function(a,l){var g=a.exp(c);return l([g]),g},{x:c},function(a,l){return{x:function(){return a.mulStrict(l[0])}}},"Exp",{},[],[!0])}}),jp=xt({expm1_:function(p){var c=Ke(p,"x","expm1");return Ve.runKernelFunc(function(a,l){var g=a.expm1(c);return l([c]),g},{$x:c},function(a,l){var g=l[0];return{$x:function(){return a.mul(g.exp())}}})}}),Nf=xt({floor_:function(p){var c=Ke(p,"x","floor");return Ve.runKernelFunc(function(a){return a.floor(c)},{$x:c},function(a){return{$x:function(){return ii(a)}}})}}),Yc=xt({log_:function(p){var c=Ke(p,"x","log"),a=[c];return Ve.runKernelFunc(function(l,g){var _=l.log(c);return g([c]),_},{x:c},function(l,g){var _=g[0];return{x:function(){return l.div(_.toFloat())}}},"Log",{},a)}}),Hd=xt({log1p_:function(p){var c=Ke(p,"x","log1p");return Ve.runKernelFunc(function(a,l){var g=a.log1p(c);return l([c]),g},{$x:c},function(a,l){var g=l[0];return{$x:function(){return a.div(g.add(1))}}})}}),zh=xt({logSigmoid_:function(p){var c=Ke(p,"x","logSigmoid");return Ve.runKernelFunc(function(a,l){var g=a.softplus(c.neg()).neg();return l([c]),g},{$x:c},function(a,l){var g=l[0];return{$x:function(){return a.mul(g.neg().sigmoid())}}})}}),yo=xt({neg_:function(p){var c=Ke(p,"x","neg"),a=[c];return Ve.runKernelFunc(function(l){return l.neg(c)},{x:c},function(l){return{x:function(){return l.neg()}}},"Neg",{},a)}}),Rl=xt({reciprocal_:function(p){var c=Ke(p,"x","reciprocal");return Ve.runKernelFunc(function(a,l){var g=a.reciprocal(c);return l([c]),g},{$x:c},function(a,l){var g=l[0];return{$x:function(){return a.div(g.square().neg())}}})}}),Cs=xt({round_:function(p){var c=Ke(p,"x","round");return Ve.runKernelFunc(function(a){return a.round(c)},{$x:c},function(a){return{$x:function(){return ii(a)}}})}}),Ml=xt({rsqrt_:function(p){var c=Ke(p,"x","rsqrt"),a=[c];return Ve.runKernelFunc(function(l,g){var _=l.rsqrt(c);return g([c]),_},{x:c},function(l,g){var _=g[0];return{x:function(){return l.div(_.pow(1.5).mul(2)).neg()}}},"Rsqrt",{},a)}}),If=xt({sigmoid_:function(p){var c=Ke(p,"x","sigmoid");return Ve.runKernelFunc(function(a,l){var g=a.sigmoid(c);return l([g]),g},{x:c},function(a,l){var g=l[0];return{x:function(){return a.mul(g.mul(fr(1).sub(g)))}}},"Sigmoid")}}),Uh=xt({sign_:function(p){var c=Ke(p,"x","sign");return Ve.runKernelFunc(function(a){return a.sign(c)},{$x:c},function(a){return{$x:function(){return ii(a)}}})}}),$d=xt({isNaN_:function(p){var c=Ke(p,"x","isNaN");return Ve.runKernelFunc(function(a){return a.isNaN(c)},{$x:c},function(a){return{$x:function(){return ii(a)}}})}}),Ff=xt({isInf_:function(p){var c=Ke(p,"x","isInf");return Ve.runKernelFunc(function(a){return a.isInf(c)},{$x:c},function(a){return{$x:function(){return ii(a)}}})}}),jl=xt({isFinite_:function(p){var c=Ke(p,"x","isFinite");return Ve.runKernelFunc(function(a){return a.isFinite(c)},{$x:c},function(a){return{$x:function(){return ii(a)}}})}}),Gd=xt({sin_:function(p){var c=Ke(p,"x","sin"),a=[c];return Ve.runKernelFunc(function(l,g){var _=l.sin(c);return g([c]),_},{x:c},function(l,g){var _=g[0];return{x:function(){return _.toFloat().cos().mul(l)}}},"Sin",{},a)}}),Kd=xt({sinh_:function(p){var c=Ke(p,"x","sinh");return Ve.runKernelFunc(function(a,l){var g=a.sinh(c);return l([c]),g},{$x:c},function(a,l){var g=l[0];return{$x:function(){return g.toFloat().cosh().mulStrict(a)}}})}}),en=xt({softplus_:function(p){var c=Ke(p,"x","softplus");return Ve.runKernelFunc(function(a,l){var g=a.softplus(c);return l([c]),g},{$x:c},function(a,l){var g=l[0];return{$x:function(){return a.mul(g.sigmoid())}}})}}),Ws=xt({sqrt_:function(p){var c=Ke(p,"x","sqrt");return Ve.runKernelFunc(function(a,l){var g=a.sqrt(c);return l([c]),g},{$x:c},function(a,l){var g=l[0];return{$x:function(){return a.div(g.toFloat().sqrt().mul(2))}}})}}),Un=xt({step_:function(p,c){c===void 0&&(c=0);var a=Ke(p,"x","step");return Ve.runKernelFunc(function(l){return l.step(a,c)},{$x:a},function(l){return{$x:function(){return ii(l)}}})}}),Os=xt({tan_:function(p){var c=Ke(p,"x","tan");return Ve.runKernelFunc(function(a,l){var g=a.tan(c);return l([c]),g},{$x:c},function(a,l){var g=l[0];return{$x:function(){return a.div(g.cos().square())}}})}}),na=xt({tanh_:function(p){var c=Ke(p,"x","tanh");return Ve.runKernelFunc(function(a,l){var g=a.tanh(c);return l([g]),g},{x:c},function(a,l){var g=l[0];return{x:function(){return fr(1).sub(g.square()).mulStrict(a)}}},"Tanh",{},null,[!0])}}),Bl=xt({addStrict_:function(p,c){var a=Ke(p,"a","addStrict"),l=Ke(c,"b","addStrict");return Tt(a.shape,l.shape,"Error in addStrict: "),a.add(l)}}),Rf=xt({atan2_:function(p,c){var a,l=Ke(p,"a","atan2"),g=Ke(c,"b","atan2");a=An(l,g),l=a[0],g=a[1];var _=Mi(l.shape,g.shape);return Ve.runKernelFunc(function(j,V){var ne=j.atan2(l,g);return V([l,g]),ne},{$a:l,$b:g},function(j,V){var ne=V[0],oe=V[1];return{$a:function(){var me=eo(ne.square(),oe.square()),Ee=j.mul(oe.div(me)),_e=Fo(ne.shape,_);return _e.length>0&&(Ee=Ee.sum(_e)),Ee.reshape(ne.shape)},$b:function(){var me=eo(ne.square(),oe.square()),Ee=yo(j.mul(ne.div(me))),_e=Fo(oe.shape,_);return _e.length>0&&(Ee=Ee.sum(_e)),Ee.reshape(oe.shape)}}})}}),nr=xt({divStrict_:function(p,c){var a=Ke(p,"a","div"),l=Ke(c,"b","div");return Tt(a.shape,l.shape,"Error in divideStrict: "),a.div(l)}}),Go=xt({floorDiv_:function(p,c){var a,l=Ke(p,"a","floorDiv"),g=Ke(c,"b","floorDiv");a=An(l,g),l=a[0],g=a[1];var _=Mi(l.shape,g.shape);return Ve.runKernelFunc(function(j,V){var ne=j.floorDiv(l,g);return V([l,g]),ne},{a:l,b:g},function(j,V){var ne=V[0],oe=V[1];return{a:function(){var me=j.div(oe.toFloat()),Ee=Fo(ne.shape,_);return Ee.length>0?me.sum(Ee).reshape(ne.shape):me},b:function(){var me=j.mul(ne.toFloat()),Ee=Fo(oe.shape,_);Ee.length>0&&(me=me.sum(Ee).reshape(oe.shape));var _e=oe.square();return me.div(_e.toFloat()).neg()}}},"FloorDiv")}}),bo=xt({maximum_:function(p,c){var a,l=Ke(p,"a","maximum"),g=Ke(c,"b","maximum");return a=An(l,g),l=a[0],g=a[1],l.dtype==="bool"&&(l=l.toInt(),g=g.toInt()),Mi(l.shape,g.shape),Ve.runKernelFunc(function(_,j){var V=_.maximum(l,g);return j([l,g]),V},{a:l,b:g},function(_,j){var V=j[0],ne=j[1];return{a:function(){return _.mul(V.greaterEqual(ne).toFloat())},b:function(){return _.mul(V.less(ne).toFloat())}}},"Maximum")}}),Hi=xt({maximumStrict_:function(p,c){var a=Ke(p,"a","maximumStrict"),l=Ke(c,"b","maximumStrict");return Tt(a.shape,l.shape,"Error in maximumStrict: "),a.maximum(l)}}),ku=xt({minimum_:function(p,c){var a,l=Ke(p,"a","minimum"),g=Ke(c,"b","minimum");return a=An(l,g),l=a[0],g=a[1],l.dtype==="bool"&&(l=l.toInt(),g=g.toInt()),Mi(l.shape,g.shape),Ve.runKernelFunc(function(_,j){var V=_.minimum(l,g);return j([l,g]),V},{a:l,b:g},function(_,j){var V=j[0],ne=j[1];return{a:function(){return _.mul(V.lessEqual(ne).toFloat())},b:function(){return _.mul(V.greater(ne).toFloat())}}},"Minimum")}}),oc=xt({minimumStrict_:function(p,c){var a=Ke(p,"a","minimumStrict"),l=Ke(c,"b","minimumStrict");return Tt(a.shape,l.shape,"Error in minimumStrict: "),a.minimum(l)}}),Vs=xt({mod_:function(p,c){var a,l=Ke(p,"a","mod"),g=Ke(c,"b","mod");a=An(l,g),l=a[0],g=a[1];var _=Mi(l.shape,g.shape);return Ve.runKernelFunc(function(j,V){var ne=j.mod(l,g);return V([l,g]),ne},{$a:l,$b:g},function(j,V){var ne=V[0],oe=V[1];return{$a:function(){var me=Fo(ne.shape,_);return me.length>0?j.sum(me).reshape(ne.shape):j},$b:function(){var me=j.mul(ne.div(oe).floor().neg()),Ee=Fo(oe.shape,_);return Ee.length>0?me.sum(Ee).reshape(oe.shape):me}}})}}),sc=xt({modStrict_:function(p,c){var a=Ke(p,"a","modStrict"),l=Ke(c,"b","modStrict");return Tt(a.shape,l.shape,"Error in modStrict: "),a.mod(l)}}),Ka=xt({mul_:function(p,c){var a,l=Ke(p,"a","mul"),g=Ke(c,"b","mul");a=An(l,g),l=a[0],g=a[1];var _=Mi(l.shape,g.shape);return Ve.runKernelFunc(function(j,V){var ne=j.multiply(l,g);return V([l,g]),ne},{a:l,b:g},function(j,V){var ne=V[0],oe=V[1];return{a:function(){var me=j.mul(oe.toFloat()),Ee=Fo(ne.shape,_);return Ee.length>0?me.sum(Ee).reshape(ne.shape):me},b:function(){var me=j.mul(ne.toFloat()),Ee=Fo(oe.shape,_);return Ee.length>0?me.sum(Ee).reshape(oe.shape):me}}},"Mul")}}),Vu=xt({mulStrict_:function(p,c){var a=Ke(p,"a","mul"),l=Ke(c,"b","mul");return Tt(a.shape,l.shape,"Error in multiplyStrict: "),a.mul(l)}}),qs=xt({pow_:function(p,c){var a,l=Ke(p,"base","pow"),g=Ke(c,"exp","pow");a=An(l,g),l=a[0],g=a[1];var _=Mi(l.shape,g.shape),j=[l,g];return Ve.runKernelFunc(function(V,ne){var oe=V.pow(l,g);return ne([l,g,oe]),oe},{a:l,b:g},function(V,ne){var oe=ne[0],me=ne[1],Ee=ne[2];return{a:function(){var _e=me.toFloat(),Ne=V.mul(_e.mul(oe.pow(_e.sub(fr(1))))),Ue=Fo(oe.shape,_);return Ue.length>0&&(Ne=Ne.sum(Ue)),Ne.reshape(oe.shape)},b:function(){var _e=oe.greater(0),Ne=oe.log().where(_e,ii(oe)),Ue=V.mul(Ee.mul(Ne)),$e=Fo(me.shape,_);return $e.length>0&&(Ue=Ue.sum($e)),Ue.reshape(me.shape)}}},"Pow",{},j,[!0])}}),oa=xt({powStrict_:function(p,c){return Tt(p.shape,c.shape,"Error in powStrict: "),p.pow(c)}}),cs=xt({squaredDifferenceStrict_:function(p,c){var a=Ke(p,"a","squaredDifferenceStrict"),l=Ke(c,"b","squaredDifferenceStrict");return Tt(a.shape,l.shape,"Error in squaredDifferenceStrict: "),a.squaredDifference(l)}}),_o=xt({sub_:function(p,c){var a,l=Ke(p,"a","sub"),g=Ke(c,"b","sub");a=An(l,g),l=a[0],g=a[1];var _=Mi(l.shape,g.shape);return Ve.runKernelFunc(function(j){return j.subtract(l,g)},{a:l,b:g},function(j){return{a:function(){var V=j,ne=Fo(l.shape,_);return ne.length>0&&(V=V.sum(ne)),V.reshape(l.shape)},b:function(){var V=j,ne=Fo(g.shape,_);return ne.length>0&&(V=V.sum(ne)),V.neg().reshape(g.shape)}}},"Sub")}}),ls=xt({subStrict_:function(p,c){var a=Ke(p,"a","subStrict"),l=Ke(c,"b","subStrict");return Tt(a.shape,l.shape,"Error in subStrict: "),a.sub(l)}}),Xa=xt({div_:function(p,c){var a,l=Ke(p,"a","div"),g=Ke(c,"b","div");if(a=An(l,g),l=a[0],g=a[1],l.dtype==="int32"&&g.dtype==="int32")return Go(l,g);var _={a:l,b:g};return Ve.runKernelFunc(function(j,V){var ne=j.realDivide(l,g);return V([l,g]),ne},_,null,Pa,{})}});function Hs(p,c){if(p.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+p.rank+".");if(c.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+c.rank+".");if(c.dtype!=="int32")throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+c.dtype+".");if(c.shape[c.rank-1]>p.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+c.shape[c.rank-1]+" vs. "+p.rank);if(p.size===0)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+p.shape+".");for(var a=c.shape,l=a[a.length-1],g=1,_=0;_<a.length-1;++_)g*=a[_];var j=p.shape,V=a.slice();V.pop();var ne=1;for(_=l;_<p.rank;++_)ne*=j[_],V.push(j[_]);var oe=Cr(p.shape).map(function(me){return me/ne}).concat([1]).slice(0,l);return[V,g,ne,oe]}var Eu=Object.freeze({prepareAndValidate:Hs}),qu=30;function uc(p){return p<=qu?p:br(p,Math.floor(Math.sqrt(p)))}function Cu(p,c,a){var l=c.rank>1?c.shape[c.rank-1]:1,g=c.rank>1?c.rank-1:1,_="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+a.shape+", indices.shape: "+c.shape+", shape: "+p+", sliceDim: "+l+", and batchDim: "+g+".";if(a.rank<g)throw new Error(_+" update.rank < "+g+". ");if(p.length<l+(a.rank-g))throw new Error(_+" Output shape length < "+(l+(a.rank-g)));if(a.rank!==g+p.length-l)throw new Error(_+" update.rank != "+(g+p.length-l));for(var j=0;j<g;++j)if(a.shape[j]!==c.shape[j])throw new Error(_+" updates.shape["+j+"] ("+a.shape[j]+") != indices.shape["+j+"] ("+c.shape[j]+").");for(j=0;j<a.rank-g;++j)if(a.shape[j+g]!==p[j+l])throw new Error(_+" updates.shape["+(j+g)+"] ("+a.shape[j+g]+") != shape["+(j+g)+"] ("+p[j+g]+")")}function Jc(p,c,a){if(c.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+c.rank+".");if(p.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+p.rank+".");if(c.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: "+c.dtype);if(a.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+a);if(a.length===0){if(c.size===0)throw new Error("Indices specified for empty output. indices shape: "+c.shape);if(p.size===0)throw new Error("Updates specified for empty output. updates shape: "+p.shape)}Cu(a,c,p)}function Qc(p,c,a){for(var l=c.shape.length,g=l>1?c.shape[l-1]:1,_=a.length,j=1,V=g;V<_;++V)j*=a[V];var ne=g<1?1:g;return{sliceRank:g,numUpdates:Ye(c.shape)/ne,sliceSize:j,strides:Cr(a.slice(0,g)).concat([1]),outputSize:Ye(a)}}var Wh=Object.freeze({validateUpdateShape:Cu,validateInput:Jc,calculateShapes:Qc});function Zc(p,c,a){we(p.rank===c.length,function(){return"Error in slice"+p.rank+"D: Length of begin "+c+" must match the rank of the array ("+p.rank+")."}),we(p.rank===a.length,function(){return"Error in slice"+p.rank+"D: Length of size "+a+" must match the rank of the array ("+p.rank+")."});for(var l=function(_){we(c[_]+a[_]<=p.shape[_],function(){return"Error in slice"+p.rank+"D: begin["+_+"] + size["+_+"] ("+(c[_]+a[_])+") would overflow input.shape["+_+"] ("+p.shape[_]+")"})},g=0;g<p.rank;++g)l(g)}function $s(p){for(var c=[],a=0;p>0;)1&p&&c.push(a),p/=2,a++;return c}function Ou(p,c,a){for(var l=[],g=0;g<p.length;g++)l[g]=Math.ceil((c[g]-p[g])/a[g]);return l}function Au(p,c,a,l,g){var _=c[g],j=a[g]||1;(p&1<<g||_==null)&&(_=j>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var V=l[g];return _<0&&(_+=V),St(0,_,V-1)}function nu(p,c,a,l,g){var _=c[g],j=a[g]||1;(p&1<<g||_==null)&&(_=j>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var V=l[g];return _<0&&(_+=V),j>0?St(0,_,V):St(-1,_,V-1)}function Vh(p,c,a){for(var l=a.length,g=0;g<a.length;g++)if(a[g]>1){l=g;break}for(g=l+1;g<a.length;g++)if(c[g]>0||a[g]!==p[g])return!1;return!0}function Mf(p,c){for(var a=p.length>0?p[p.length-1]:1,l=0;l<p.length-1;l++)a+=p[l]*c[l];return a}var jf=Object.freeze({assertParamsValid:Zc,maskToAxes:$s,computeOutShape:Ou,startForAxis:Au,stopForAxis:nu,isSliceContinous:Vh,computeFlatOffset:Mf});function Pl(p){return we(Xn(p),function(){return"The f passed in grad(f) must be a function"}),function(c,a){var l=Ke(c,"x","tf.grad",null),g=a!=null?Ke(a,"dy","tf.grad"):null;return Ve.tidy(function(){var _=Ve.gradients(function(){return p(l)},[l],g),j=_.value,V=_.grads;return g!=null&&Tt(j.shape,g.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),te(V),V[0]})}}function Bf(p){return we(Xn(p),function(){return"The f passed in grads(f) must be a function"}),function(c,a){we(Array.isArray(c),function(){return"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s"});var l=Lu(c,"args","tf.grads",null),g=a!=null?Ke(a,"dy","tf.grads"):null;return Ve.tidy(function(){var _=Ve.gradients(function(){return p.apply(void 0,l)},l,g),j=_.value,V=_.grads;return g!=null&&Tt(j.shape,g.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),te(V),V})}}function Z(p){return we(Xn(p),function(){return"The f passed in valueAndGrad(f) must be a function"}),function(c,a){we(c instanceof jt,function(){return"The x passed in valueAndGrad(f)(x) must be a tensor"}),we(a==null||a instanceof jt,function(){return"The dy passed in valueAndGrad(f)(x, dy) must be a tensor"});var l=Ve.gradients(function(){return p(c)},[c],a),g=l.grads,_=l.value;return te(g),{grad:g[0],value:_}}}function G(p){return we(Xn(p),function(){return"The f passed in valueAndGrads(f) must be a function"}),function(c,a){we(Array.isArray(c)&&c.every(function(g){return g instanceof jt}),function(){return"The args passed in valueAndGrads(f)(args) must be array of tensors"}),we(a==null||a instanceof jt,function(){return"The dy passed in valueAndGrads(f)(args, dy) must be a tensor"});var l=Ve.gradients(function(){return p.apply(void 0,c)},c,a);return a!=null&&Tt(l.value.shape,a.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),te(l.grads),l}}function C(p,c){we(Xn(p),function(){return"The f passed in variableGrads(f) must be a function"}),we(c==null||Array.isArray(c)&&c.every(function(me){return me instanceof mt}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var a=c!=null;if(!a)for(var l in c=[],Ve.registeredVariables)c.push(Ve.registeredVariables[l]);var g=a?c.filter(function(me){return!me.trainable}):null,_=c.length;we((c=c.filter(function(me){return me.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+_+" variables is trainable."});var j=Ve.gradients(p,c,null,!0),V=j.value,ne=j.grads;we(ne.some(function(me){return me!=null}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),we(V.rank===0,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+V.rank+" tensor"});var oe={};return c.forEach(function(me,Ee){ne[Ee]!=null&&(oe[me.name]=ne[Ee])}),g?.forEach(function(me){return oe[me.name]=null}),{value:V,grads:oe}}function N(p){return Ve.customGrad(p)}function te(p){if(p.filter(function(c){return c==null}).length>0)throw new Error(`Cannot compute gradient of y=f(x) with respect to x. Make sure that
    the f you passed encloses all operations that lead from x to y.`)}var Be=xt({softmax_:function(p,c){c===void 0&&(c=-1);var a=Ke(p,"logits","softmax","float32");if(c===-1&&(c=a.rank-1),c!==a.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+a.rank+" and dim was "+c);return Ve.runKernelFunc(function(l,g){var _=l.softmax(a,c);return g([_]),_},{logits:a},function(l,g){var _=g[0],j=l.mul(_);return{logits:function(){return j.sub(j.sum([c],!0).mul(_))}}},"Softmax",{dim:c},[],[!0])}}),Ge=xt({logSoftmax_:function(p,c){c===void 0&&(c=-1);var a=Ke(p,"logits","logSoftmax");if(c===-1&&(c=a.rank-1),c!==a.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+a.rank+" and axis was "+c);return N(function(l,g){var _=l.max(c,!0),j=l.sub(_),V=j.toFloat().sub(j.exp().sum(c,!0).log());return g([V]),{value:V,gradFunc:function(ne,oe){var me=oe[0].exp();return ne.sub(ne.sum(c,!0).mul(me))}}})(a)}}),ft=xt({transpose_:function(p,c){var a=Ke(p,"x","transpose");if(c==null&&(c=a.shape.map(function(g,_){return _}).reverse()),we(a.rank===c.length,function(){return"Error in transpose: rank of input "+a.rank+" must match length of perm "+c+"."}),c.forEach(function(g){we(g>=0&&g<a.rank,function(){return"All entries in 'perm' must be between 0 and "+(a.rank-1)+" but got "+c})}),a.rank<=1)return a.clone();var l={perm:c};return Ve.runKernelFunc(function(g){return g.transpose(a,c)},{x:a},null,"Transpose",l)}}),Nt=function(){function p(c,a){this.backend=c,this.dataMover=a,this.data=new WeakMap,this.dataIdsCount=0}return p.prototype.get=function(c){return this.data.has(c)||this.dataMover.moveData(this.backend,c),this.data.get(c)},p.prototype.set=function(c,a){this.dataIdsCount++,this.data.set(c,a)},p.prototype.has=function(c){return this.data.has(c)},p.prototype.delete=function(c){return this.dataIdsCount--,this.data.delete(c)},p.prototype.numDataIds=function(){return this.dataIdsCount},p}(),Ut=function(){function p(){}return p.prototype.time=function(c){return ct("time")},p.prototype.read=function(c){return ct("read")},p.prototype.readSync=function(c){return ct("readSync")},p.prototype.numDataIds=function(){return ct("numDataIds")},p.prototype.disposeData=function(c){return ct("disposeData")},p.prototype.write=function(c,a,l){return ct("write")},p.prototype.move=function(c,a,l,g){return ct("move")},p.prototype.memory=function(){return ct("memory")},p.prototype.floatPrecision=function(){return ct("floatPrecision")},p.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},p.prototype.batchMatMul=function(c,a,l,g){return ct("batchMatMul")},p.prototype.fusedBatchMatMul=function(c){return c.a,c.b,c.transposeA,c.transposeB,c.bias,c.activation,c.preluActivationWeights,ct("fusedBatchMatMul")},p.prototype.slice=function(c,a,l){return ct("slice")},p.prototype.stridedSlice=function(c,a,l,g){return ct("stridedSlice")},p.prototype.unstack=function(c,a){return ct("unstack")},p.prototype.reverse=function(c,a){return ct("reverse")},p.prototype.concat=function(c,a){return ct("concat")},p.prototype.neg=function(c){return ct("neg")},p.prototype.add=function(c,a){return ct("add")},p.prototype.addN=function(c){return ct("addN")},p.prototype.subtract=function(c,a){return ct("subtract")},p.prototype.multiply=function(c,a){return ct("multiply")},p.prototype.realDivide=function(c,a){return ct("realDivide")},p.prototype.floorDiv=function(c,a){return ct("floorDiv")},p.prototype.sum=function(c,a){return ct("sum")},p.prototype.prod=function(c,a){return ct("prod")},p.prototype.unsortedSegmentSum=function(c,a,l){return ct("unsortedSegmentSum")},p.prototype.argMin=function(c,a){return ct("argMin")},p.prototype.argMax=function(c,a){return ct("argMax")},p.prototype.equal=function(c,a){return ct("equal")},p.prototype.notEqual=function(c,a){return ct("notEqual")},p.prototype.less=function(c,a){return ct("less")},p.prototype.lessEqual=function(c,a){return ct("lessEqual")},p.prototype.greater=function(c,a){return ct("greater")},p.prototype.greaterEqual=function(c,a){return ct("greaterEqual")},p.prototype.logicalNot=function(c){return ct("logicalNot")},p.prototype.logicalAnd=function(c,a){return ct("logicalAnd")},p.prototype.logicalOr=function(c,a){return ct("logicalOr")},p.prototype.where=function(c){return ct("where")},p.prototype.select=function(c,a,l){return ct("select")},p.prototype.topk=function(c,a,l){return ct("topk")},p.prototype.min=function(c,a){return ct("min")},p.prototype.minimum=function(c,a){return ct("minimum")},p.prototype.mod=function(c,a){return ct("mod")},p.prototype.max=function(c,a){return ct("max")},p.prototype.maximum=function(c,a){return ct("maximum")},p.prototype.all=function(c,a){return ct("all")},p.prototype.any=function(c,a){return ct("any")},p.prototype.squaredDifference=function(c,a){return ct("squaredDifference")},p.prototype.ceil=function(c){return ct("ceil")},p.prototype.floor=function(c){return ct("floor")},p.prototype.round=function(c){return ct("round")},p.prototype.sign=function(c){return ct("sign")},p.prototype.isNaN=function(c){return ct("isNaN")},p.prototype.isInf=function(c){return ct("isInf")},p.prototype.isFinite=function(c){return ct("isFinite")},p.prototype.pow=function(c,a){return ct("pow")},p.prototype.exp=function(c){return ct("exp")},p.prototype.expm1=function(c){return ct("expm1")},p.prototype.softmax=function(c,a){return ct("softmax")},p.prototype.log=function(c){return ct("log")},p.prototype.log1p=function(c){return ct("log1p")},p.prototype.sqrt=function(c){return ct("sqrt")},p.prototype.rsqrt=function(c){return ct("rsqrt")},p.prototype.square=function(c){return ct("square")},p.prototype.reciprocal=function(c){return ct("reciprocal")},p.prototype.relu=function(c){return ct("relu")},p.prototype.relu6=function(c){return ct("relu6")},p.prototype.prelu=function(c,a){return ct("prelu")},p.prototype.elu=function(c){return ct("elu")},p.prototype.eluDer=function(c,a){return ct("eluDer")},p.prototype.selu=function(c){return ct("selu")},p.prototype.int=function(c){return ct("int")},p.prototype.clip=function(c,a,l){return ct("clip")},p.prototype.abs=function(c){return ct("abs")},p.prototype.complexAbs=function(c){return ct("complexAbs")},p.prototype.sigmoid=function(c){return ct("sigmoid")},p.prototype.softplus=function(c){return ct("softplus")},p.prototype.sin=function(c){return ct("sin")},p.prototype.cos=function(c){return ct("cos")},p.prototype.tan=function(c){return ct("tan")},p.prototype.asin=function(c){return ct("asin")},p.prototype.acos=function(c){return ct("acos")},p.prototype.atan=function(c){return ct("atan")},p.prototype.atan2=function(c,a){return ct("atan2")},p.prototype.sinh=function(c){return ct("sinh")},p.prototype.cosh=function(c){return ct("cosh")},p.prototype.tanh=function(c){return ct("tanh")},p.prototype.asinh=function(c){return ct("asinh")},p.prototype.acosh=function(c){return ct("acosh")},p.prototype.atanh=function(c){return ct("atanh")},p.prototype.erf=function(c){return ct("erf")},p.prototype.step=function(c,a){return ct("step")},p.prototype.fusedConv2d=function(c){return c.input,c.filter,c.convInfo,c.bias,c.activation,c.preluActivationWeights,ct("fusedConv2d")},p.prototype.conv2d=function(c,a,l){return ct("conv2d")},p.prototype.conv2dDerInput=function(c,a,l){return ct("conv2dDerInput")},p.prototype.conv2dDerFilter=function(c,a,l){return ct("conv2dDerFilter")},p.prototype.fusedDepthwiseConv2D=function(c){return c.input,c.filter,c.convInfo,c.bias,c.activation,c.preluActivationWeights,ct("fusedDepthwiseConv2D")},p.prototype.depthwiseConv2D=function(c,a,l){return ct("depthwiseConv2D")},p.prototype.depthwiseConv2DDerInput=function(c,a,l){return ct("depthwiseConv2DDerInput")},p.prototype.depthwiseConv2DDerFilter=function(c,a,l){return ct("depthwiseConv2DDerFilter")},p.prototype.conv3d=function(c,a,l){return ct("conv3d")},p.prototype.conv3dDerInput=function(c,a,l){return ct("conv3dDerInput")},p.prototype.conv3dDerFilter=function(c,a,l){return ct("conv3dDerFilter")},p.prototype.maxPool=function(c,a){return ct("maxPool")},p.prototype.maxPoolBackprop=function(c,a,l,g){return ct("maxPoolBackprop")},p.prototype.avgPool=function(c,a){return ct("avgPool")},p.prototype.avgPoolBackprop=function(c,a,l){return ct("avgPoolBackprop")},p.prototype.avgPool3d=function(c,a){return ct("avgPool3d")},p.prototype.avgPool3dBackprop=function(c,a,l){return ct("avgPool3dBackprop")},p.prototype.maxPool3d=function(c,a){return ct("maxPool3d")},p.prototype.maxPool3dBackprop=function(c,a,l,g){return ct("maxPool3dBackprop")},p.prototype.reshape=function(c,a){return ct("reshape")},p.prototype.cast=function(c,a){return ct("cast")},p.prototype.tile=function(c,a){return ct("tile")},p.prototype.pad=function(c,a,l){return ct("pad")},p.prototype.transpose=function(c,a){return ct("transpose")},p.prototype.gather=function(c,a,l){return ct("gather")},p.prototype.gatherND=function(c,a){return ct("gatherND")},p.prototype.scatterND=function(c,a,l){return ct("scatterND")},p.prototype.batchToSpaceND=function(c,a,l){return ct("batchToSpaceND")},p.prototype.spaceToBatchND=function(c,a,l){return ct("spaceToBatchND")},p.prototype.resizeBilinear=function(c,a,l,g){return ct("resizeBilinear")},p.prototype.resizeBilinearBackprop=function(c,a,l){return ct("resizeBilinearBackprop")},p.prototype.resizeNearestNeighbor=function(c,a,l,g){return ct("resizeNearestNeighbor")},p.prototype.resizeNearestNeighborBackprop=function(c,a,l){return ct("resizeNearestNeighborBackprop")},p.prototype.batchNormalization=function(c,a,l,g,_,j){return ct("batchNormalization")},p.prototype.localResponseNormalization4D=function(c,a,l,g,_){return ct("localResponseNormalization4D")},p.prototype.LRNGrad=function(c,a,l,g,_,j,V){return ct("LRNGrad")},p.prototype.multinomial=function(c,a,l,g){return ct("multinomial")},p.prototype.oneHot=function(c,a,l,g){return ct("oneHot")},p.prototype.cumsum=function(c,a,l,g){return ct("cumsum")},p.prototype.nonMaxSuppression=function(c,a,l,g,_){return ct("nonMaxSuppression")},p.prototype.fft=function(c){return ct("fft")},p.prototype.ifft=function(c){return ct("ifft")},p.prototype.complex=function(c,a){return ct("complex")},p.prototype.real=function(c){return ct("real")},p.prototype.imag=function(c){return ct("imag")},p.prototype.cropAndResize=function(c,a,l,g,_,j){return ct("cropAndResize")},p.prototype.depthToSpace=function(c,a,l){return ct("depthToSpace")},p.prototype.split=function(c,a,l){return ct("split")},p.prototype.sparseToDense=function(c,a,l,g){return ct("sparseToDense")},p.prototype.diag=function(c){return ct("diag")},p.prototype.fill=function(c,a,l){return ct("fill")},p.prototype.onesLike=function(c){return ct("onesLike")},p.prototype.zerosLike=function(c){return ct("zerosLike")},p.prototype.linspace=function(c,a,l){return ct("linspace")},p.prototype.dispose=function(){return ct("dispose")},p}();function ct(p){throw new Error("'"+p+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function yn(p,c,a,l,g,_,j){j===void 0&&(j="channelsLast");var V,ne=tr(c),oe=ne[0],me=ne[1];if(j==="channelsLast")V=[oe,me,p[3],p[3]];else{if(j!=="channelsFirst")throw new Error("Unknown dataFormat "+j);V=[oe,me,p[1],p[1]]}return Nn(p,V,a,l,g,_,!1,j)}function _n(p,c,a,l,g,_,j){j===void 0&&(j="NDHWC");var V,ne,oe=rr(c),me=oe[0],Ee=oe[1],_e=oe[2];if(j==="NDHWC")ne="channelsLast",V=[me,Ee,_e,p[4],p[4]];else{if(j!=="NCDHW")throw new Error("Unknown dataFormat "+j);ne="channelsFirst",V=[me,Ee,_e,p[1],p[1]]}return Wn(p,V,a,l,g,!1,ne,_)}function Nn(p,c,a,l,g,_,j,V){j===void 0&&(j=!1),V===void 0&&(V="channelsLast");var ne=[-1,-1,-1,-1],oe=ne[0],me=ne[1],Ee=ne[2],_e=ne[3];if(V==="channelsLast")oe=p[0],me=p[1],Ee=p[2],_e=p[3];else{if(V!=="channelsFirst")throw new Error("Unknown dataFormat "+V);oe=p[0],_e=p[1],me=p[2],Ee=p[3]}var Ne,Ue=c[0],$e=c[1],He=c[3],et=tr(a),lt=et[0],ht=et[1],gt=tr(l),Ct=gt[0],Wt=gt[1],Kt=hr(Ue,Ct),Vt=hr($e,Wt),Ht=function(er,sr,lr,ur,ar,Or,Er,Ur){var ei,mi,ua;if(typeof er=="number"){ei={top:er,bottom:er,left:er,right:er,type:er===0?"VALID":"NUMBER"};var ca=function(Xi,Ea,Wa,iu,Ms){iu==null&&(iu=Mn(Xi,Ea,Wa));var js=Xi[1],hd=Nr((Xi[0]-Ea+2*iu)/Wa+1,Ms);we(Zt(hd),function(){return"The output # of rows ("+hd+") must be an integer. Change the stride and/or zero pad parameters"});var dd=Nr((js-Ea+2*iu)/Wa+1,Ms);return we(Zt(dd),function(){return"The output # of columns ("+dd+") must be an integer. Change the stride and/or zero pad parameters"}),[hd,dd]}([sr,lr],Or,ur,er,Ur);mi=ca[0],ua=ca[1]}else if(er==="same"){mi=Math.ceil(sr/ur),ua=Math.ceil(lr/ar);var ka=Math.max(0,(mi-1)*ur+Or-sr),ba=Math.max(0,(ua-1)*ar+Er-lr),ja=Math.floor(ka/2),Za=ka-ja,Bo=Math.floor(ba/2);ei={top:ja,bottom:Za,left:Bo,right:ba-Bo,type:"SAME"}}else{if(er!=="valid")throw Error("Unknown padding parameter: "+er);ei={top:0,bottom:0,left:0,right:0,type:"VALID"},mi=Math.ceil((sr-Or+1)/ur),ua=Math.ceil((lr-Er+1)/ar)}return{padInfo:ei,outHeight:mi,outWidth:ua}}(g,me,Ee,lt,ht,Kt,Vt,_),vn=Ht.padInfo,On=Ht.outHeight,Cn=Ht.outWidth,Kn=j?He*_e:He;return V==="channelsFirst"?Ne=[oe,Kn,On,Cn]:V==="channelsLast"&&(Ne=[oe,On,Cn,Kn]),{batchSize:oe,dataFormat:V,inHeight:me,inWidth:Ee,inChannels:_e,outHeight:On,outWidth:Cn,outChannels:Kn,padInfo:vn,strideHeight:lt,strideWidth:ht,filterHeight:Ue,filterWidth:$e,effectiveFilterHeight:Kt,effectiveFilterWidth:Vt,dilationHeight:Ct,dilationWidth:Wt,inShape:p,outShape:Ne,filterShape:c}}function Wn(p,c,a,l,g,_,j,V){_===void 0&&(_=!1),j===void 0&&(j="channelsLast");var ne=[-1,-1,-1,-1,-1],oe=ne[0],me=ne[1],Ee=ne[2],_e=ne[3],Ne=ne[4];if(j==="channelsLast")oe=p[0],me=p[1],Ee=p[2],_e=p[3],Ne=p[4];else{if(j!=="channelsFirst")throw new Error("Unknown dataFormat "+j);oe=p[0],Ne=p[1],me=p[2],Ee=p[3],_e=p[4]}var Ue,$e=c[0],He=c[1],et=c[2],lt=c[4],ht=rr(a),gt=ht[0],Ct=ht[1],Wt=ht[2],Kt=rr(l),Vt=Kt[0],Ht=Kt[1],vn=Kt[2],On=hr($e,Vt),Cn=hr(He,Ht),Kn=hr(et,vn),er=function(Er,Ur,ei,mi,ua,ca,ka,ba,ja,Za,Bo){var Xi,Ea,Wa,iu;if(typeof Er=="number"){Xi={top:Er,bottom:Er,left:Er,right:Er,front:Er,back:Er,type:Er===0?"VALID":"NUMBER"};var Ms=function(ov,Ep,Rx,D0,md,Zy){md==null&&(md=Mn(ov,Ep,D0));var Mx=ov[1],jx=ov[2],eb=Nr((ov[0]-Ep+2*md)/D0+1,Zy);we(Zt(eb),function(){return"The output # of depths ("+eb+") must be an integer. Change the stride and/or zero pad parameters"});var tb=Nr((Mx-Ep+2*md)/D0+1,Zy);we(Zt(tb),function(){return"The output # of rows ("+tb+") must be an integer. Change the stride and/or zero pad parameters"});var nb=Nr((jx-Ep+2*md)/D0+1,Zy);return we(Zt(nb),function(){return"The output # of columns ("+nb+") must be an integer. Change the stride and/or zero pad parameters"}),[eb,tb,nb,1]}([Ur,ei,mi,1],ba,0,ua,Er,Bo);Ea=Ms[0],Wa=Ms[1],iu=Ms[2]}else if(Er==="same"){var js=((Ea=Math.ceil(Ur/ua))-1)*ua+ba-Ur,hd=((Wa=Math.ceil(ei/ca))-1)*ca+ja-ei,dd=((iu=Math.ceil(mi/ka))-1)*ka+Za-mi,kp=Math.floor(js/2),mu=js-kp,Qm=Math.floor(hd/2),av=hd-Qm,pd=Math.floor(dd/2);Xi={top:Qm,bottom:av,left:pd,right:dd-pd,front:kp,back:mu,type:"SAME"}}else{if(Er!=="valid")throw Error("Unknown padding parameter: "+Er);Xi={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},Ea=Math.ceil((Ur-ba+1)/ua),Wa=Math.ceil((ei-ja+1)/ca),iu=Math.ceil((mi-Za+1)/ka)}return{padInfo:Xi,outDepth:Ea,outHeight:Wa,outWidth:iu}}(g,me,Ee,_e,gt,Ct,Wt,On,Cn,Kn,V),sr=er.padInfo,lr=er.outDepth,ur=er.outHeight,ar=er.outWidth,Or=_?lt*Ne:lt;return j==="channelsFirst"?Ue=[oe,Or,lr,ur,ar]:j==="channelsLast"&&(Ue=[oe,lr,ur,ar,Or]),{batchSize:oe,dataFormat:j,inDepth:me,inHeight:Ee,inWidth:_e,inChannels:Ne,outDepth:lr,outHeight:ur,outWidth:ar,outChannels:Or,padInfo:sr,strideDepth:gt,strideHeight:Ct,strideWidth:Wt,filterDepth:$e,filterHeight:He,filterWidth:et,effectiveFilterDepth:On,effectiveFilterHeight:Cn,effectiveFilterWidth:Kn,dilationDepth:Vt,dilationHeight:Ht,dilationWidth:vn,inShape:p,outShape:Ue,filterShape:c}}function Mn(p,c,a,l){l===void 0&&(l=1);var g=hr(c,l);return Math.floor((p[0]*(a-1)-a+g)/2)}function tr(p){return typeof p=="number"?[p,p,p]:p.length===2?[p[0],p[1],1]:p}function rr(p){return typeof p=="number"?[p,p,p]:p}function hr(p,c){return c<=1?p:p+(p-1)*(c-1)}function Nr(p,c){if(!c)return p;switch(c){case"round":return Math.round(p);case"ceil":return Math.ceil(p);case"floor":return Math.floor(p);default:throw new Error("Unknown roundingMode "+c)}}function Vr(p){var c=tr(p),a=c[0],l=c[1],g=c[2];return a===1&&l===1&&g===1}function wr(p,c){return Vr(p)||Vr(c)}function Hr(p){if(p==="NHWC")return"channelsLast";if(p==="NCHW")return"channelsFirst";throw new Error("Unknown dataFormat "+p)}function Wr(p,c,a){if(c==="complex64"){if(p.dtype==="complex64")return p.clone();var l=Ki(p.shape),g=p.toFloat(),_=a.complex(g,l);return l.dispose(),g.dispose(),_}if(!rt(p.dtype,c))return Ve.makeTensorFromDataId(p.dataId,p.shape,c);if(p.dtype==="complex64"){var j=a.real(p);return _=j.cast(c),j.dispose(),_}if(c==="int32")return a.int(p);if(c==="bool"){var V=fr(0,p.dtype);return _=a.notEqual(p,V),V.dispose(),_}throw new Error("Error in Cast: failed to cast "+p.dtype+" to "+c)}function oi(p,c){return Ve.makeTensorFromDataId(p.dataId,c,p.dtype)}function li(p,c,a){var l=(c-p)/(a-1),g=Xt(a,"float32");g[0]=p;for(var _=1;_<g.length;_++)g[_]=g[_-1]+l;return zs(g,"float32")}var $r=Object.freeze({castTensor:Wr,reshapeTensor:oi,linspaceImpl:li,upcastType:cn,axesAreInnerMostDims:Af,combineLocations:Md,computeOutAndReduceShapes:Aa,expandShapeToKeepDim:_a,assertAxesAreInnerMostDims:Ga,getAxesPermutation:Co,getUndoAxesPermutation:wu,getInnerMostAxes:Oo,getBroadcastDims:Ao,getReductionAxes:Fo,assertAndGetBroadcastShape:Mi,assertParamsConsistent:kc,computeOutShape:Zs,computePool2DInfo:yn,computePool3DInfo:_n,computeConv2DInfo:Nn,computeConv3DInfo:Wn,computeDefaultPad:Mn,tupleValuesAreOne:Vr,eitherStridesOrDilationsAreOne:wr,convertConv2DDataFormat:Hr,PARALLELIZE_THRESHOLD:qu,computeOptimalWindowSize:uc});function Zr(p,c){if(p.length!==c.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+p.length+", imag: "+c.length+".");for(var a=new Float32Array(2*p.length),l=0;l<a.length;l+=2)a[l]=p[l/2],a[l+1]=c[l/2];return a}function pa(p,c){return{real:p[2*c],imag:p[2*c+1]}}function ea(p,c,a,l){p[2*l]=c,p[2*l+1]=a}function La(p,c,a){var l=(a?2:-2)*Math.PI*(p/c);return{real:Math.cos(l),imag:Math.sin(l)}}function Ii(p,c,a){var l=function(_,j,V){return function(ne,oe,me){for(var Ee=0,_e=ne.length,Ne=0,Ue=!1;Ee<_e;){var $e=me(oe,ne[Ne=Ee+(_e-Ee>>>1)]);$e>0?Ee=Ne+1:(_e=Ne,Ue=!$e)}return Ue?Ee:-Ee-1}(_,j,V||ra)}(p,c,a),g=l<0?-(l+1):l;p.splice(g,0,c)}function ra(p,c){return p>c?1:p<c?-1:0}function Ya(p,c,a,l,g){return xo(p,c,a,l,g,0).selectedIndices}function Sa(p,c,a,l,g,_){var j=xo(p,c,a,l,g,_);return j.numValidOutputs.dispose(),{selectedIndices:j.selectedIndices,selectedScores:j.selectedScores}}function xo(p,c,a,l,g,_,j,V){V===void 0&&(V=!1);for(var ne=Array.from(c).map(function(gt,Ct){return{score:gt,boxIndex:Ct,suppressBeginIndex:0}}).filter(function(gt){return gt.score>g}).sort(ha),oe=_>0?-.5/_:0,me=[],Ee=[];me.length<a&&ne.length>0;){var _e=ne.pop(),Ne=_e.score,Ue=_e.boxIndex,$e=_e.suppressBeginIndex;if(Ne<g)break;for(var He=!1,et=me.length-1;et>=$e;--et){var lt=ki(p,Ue,me[et]);if(lt>=l){He=!0;break}if(_e.score=_e.score*Ui(l,oe,lt),_e.score<=g)break}_e.suppressBeginIndex=me.length,He||(_e.score===Ne?(me.push(Ue),Ee.push(_e.score)):_e.score>g&&Ii(ne,_e,ha))}var ht=me.length;return V&&(me.fill(0,ht),Ee.fill(0,ht)),{selectedIndices:zs(me,"int32"),selectedScores:zs(Ee,"float32"),numValidOutputs:fr(ht,"int32")}}function ki(p,c,a){var l=p.subarray(4*c,4*c+4),g=p.subarray(4*a,4*a+4),_=Math.min(l[0],l[2]),j=Math.min(l[1],l[3]),V=Math.max(l[0],l[2]),ne=Math.max(l[1],l[3]),oe=Math.min(g[0],g[2]),me=Math.min(g[1],g[3]),Ee=Math.max(g[0],g[2]),_e=Math.max(g[1],g[3]),Ne=(V-_)*(ne-j),Ue=(Ee-oe)*(_e-me);if(Ne<=0||Ue<=0)return 0;var $e=Math.max(_,oe),He=Math.max(j,me),et=Math.min(V,Ee),lt=Math.min(ne,_e),ht=Math.max(et-$e,0)*Math.max(lt-He,0);return ht/(Ne+Ue-ht)}function Ui(p,c,a){var l=Math.exp(c*a*a);return a<=p?l:0}function ha(p,c){return p.score-c.score||p.score===c.score&&c.boxIndex-p.boxIndex}function to(p,c,a){var l=new Array(p.rank).fill(0),g=p.shape.slice();return c.map(function(_){g[a]=_;var j=p.slice(l,g);return l[a]+=_,j})}function Wo(p,c){for(var a=new Array(p.rank),l=0;l<a.length;l++)a[l]=p.shape[l]*c[l];var g=bi(a,p.dtype);for(l=0;l<g.values.length;++l){for(var _=g.indexToLoc(l),j=new Array(p.rank),V=0;V<j.length;V++)j[V]=_[V]%p.shape[V];var ne=p.locToIndex(j);g.values[l]=p.values[ne]}return g.toTensor()}function io(p,c,a,l,g){for(var _=c[c.length-1],j=[p.length/_,_],V=j[0],ne=j[1],oe=Yn(a,V*l),me=Yn("int32",V*l),Ee=0;Ee<V;Ee++){for(var _e=Ee*ne,Ne=p.subarray(_e,_e+ne),Ue=[],$e=0;$e<Ne.length;$e++)Ue.push({value:Ne[$e],index:$e});Ue.sort(function(gt,Ct){return Ct.value-gt.value});var He=Ee*l,et=oe.subarray(He,He+l),lt=me.subarray(He,He+l);for($e=0;$e<l;$e++)et[$e]=Ue[$e].value,lt[$e]=Ue[$e].index}var ht=c.slice();return ht[ht.length-1]=l,[wa(oe,ht,a),wa(me,ht,"int32")]}function Ja(p,c){for(var a=[],l=0;l<c.length;l++)c[l]&&a.push(l);var g=bi(p,"int32"),_=bi([a.length,p.length],"int32");for(l=0;l<a.length;l++){var j=g.indexToLoc(a[l]),V=l*p.length;_.values.set(j,V)}return _.toTensor()}function fs(p,c){return["x","y","z","w","u","v"].slice(0,c).map(function(a){return p+"."+a})}function fo(p,c){return c===1?[p]:fs(p,c)}function va(){var p,c,a,l,g,_,j,V,ne,oe;return L().getNumber("WEBGL_VERSION")===2?(p="#version 300 es",c="in",a="out",l="in",g="texture",_="outputColor",j="out vec4 outputColor;",V=`
      bool isnan_custom(float val) {
        return (val > 0.0 || val < 0.0) ? false : val != 0.0;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `,ne="",oe=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(p="",c="attribute",a="varying",l="varying",g="texture2D",_="gl_FragColor",j="",V=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,ne=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,oe=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:p,attribute:c,varyingVs:a,varyingFs:l,texture2D:g,output:_,defineOutput:j,defineSpecialNaN:V,defineSpecialInf:ne,defineRound:oe}}function ho(p,c,a){a===void 0&&(a="index");var l=Cr(c);return l.map(function(g,_){return"int "+p[_]+" = "+a+" / "+g+"; "+(_===l.length-1?"int "+p[_+1]+" = "+a+" - "+p[_]+" * "+g:"index -= "+p[_]+" * "+g)+";"}).join("")}function cu(p){var c=Cr(p).map(function(a){return a.toString()});return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * `+c[0]+" + coords.y * "+c[1]+` + coords.z;
  }
`}var As=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;function So(p,c,a,l){var g=[];p.forEach(function(Ne){var Ue=Ye(Ne.shapeInfo.logicalShape);Ne.shapeInfo.isUniform?g.push("uniform float "+Ne.name+(Ue>1?"["+Ue+"]":"")+";"):(g.push("uniform sampler2D "+Ne.name+";"),g.push("uniform int offset"+Ne.name+";"))});var _,j,V=g.join(`
`),ne=p.map(function(Ne){return function(Ue,$e,He){He===void 0&&(He=!1);var et="";et+=He?function gt(Ct){var Wt,Kt,Vt;switch(Ct.shapeInfo.logicalShape.length){case 0:return Wt=Ct.name,Kt="get"+Wt.charAt(0).toUpperCase()+Wt.slice(1),Vt=va(),`
    vec4 `+Kt+`() {
      return `+Vt.texture2D+"("+Wt+`, halfCR);
    }
  `;case 1:return function(Ht){var vn=Ht.name,On="get"+vn.charAt(0).toUpperCase()+vn.slice(1),Cn=Ht.shapeInfo.texShape,Kn=[Math.ceil(Cn[0]/2),Math.ceil(Cn[1]/2)],er=va();return`
    vec4 `+On+`(int index) {
      vec2 uv = packedUVfrom1D(
        `+Kn[0]+", "+Kn[1]+`, index);
      return `+er.texture2D+"("+vn+`, uv);
    }
  `}(Ct);case 2:return function(Ht){var vn=Ht.shapeInfo.logicalShape,On=Ht.name,Cn="get"+On.charAt(0).toUpperCase()+On.slice(1),Kn=Ht.shapeInfo.texShape,er=Kn[0],sr=Kn[1],lr=va();if(Kn!=null&&ln(vn,Kn))return`
      vec4 `+Cn+`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`+sr+".0, "+er+`.0);

        return `+lr.texture2D+"("+On+`, uv);
      }
    `;var ur=[Math.ceil(Kn[0]/2),Math.ceil(Kn[1]/2)],ar=Math.ceil(vn[1]/2);return`
    vec4 `+Cn+`(int row, int col) {
      vec2 uv = packedUVfrom2D(`+ar+", "+ur[0]+", "+ur[1]+`, row, col);
      return `+lr.texture2D+"("+On+`, uv);
    }
  `}(Ct);case 3:return function(Ht){var vn=Ht.shapeInfo.logicalShape,On=Ht.name,Cn="get"+On.charAt(0).toUpperCase()+On.slice(1),Kn=Ht.shapeInfo.texShape,er=[Math.ceil(Kn[0]/2),Math.ceil(Kn[1]/2)];if(vn[0]===1){var sr=vn.slice(1),lr=_s(Ht,sr);return`
        `+gt(lr)+`
        vec4 `+Cn+`(int b, int row, int col) {
          return `+Cn+"("+hs(["b","row","col"],[1,2])+`);
        }
      `}var ur=er[0],ar=er[1],Or=Math.ceil(vn[2]/2),Er=Or*Math.ceil(vn[1]/2),Ur=va();return`
    vec4 `+Cn+`(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        `+ur+", "+ar+", "+Er+", "+Or+`, b, row, col);
      return `+Ur.texture2D+"("+On+`, uv);
    }
  `}(Ct);default:return function(Ht){for(var vn=Ht.shapeInfo.logicalShape,On=vn.length,Cn=Ht.name,Kn="get"+Cn.charAt(0).toUpperCase()+Cn.slice(1),er=Ht.shapeInfo.texShape,sr=[Math.ceil(er[0]/2),Math.ceil(er[1]/2)],lr=sr[0],ur=sr[1],ar=Math.ceil(vn[On-1]/2),Or=ar*Math.ceil(vn[On-2]/2),Er="int b, int row, int col",Ur="b * "+Or+" + (row / 2) * "+ar+" + (col / 2)",ei=2;ei<On-1;ei++)Er="int b"+ei+", "+Er,Or*=vn[On-ei-1],Ur="b"+ei+" * "+Or+" + "+Ur;var mi=va();return`
    vec4 `+Kn+"("+Er+`) {
      int index = `+Ur+`;
      int texR = index / `+ur+`;
      int texC = index - texR * `+ur+`;
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+ur+", "+lr+`);
      return `+mi.texture2D+"("+Cn+`, uv);
    }
  `}(Ct)}}(Ue):function gt(Ct){var Wt=Ct.shapeInfo.logicalShape;switch(Wt.length){case 0:return function(Kt){var Vt=Kt.name,Ht="get"+Vt.charAt(0).toUpperCase()+Vt.slice(1);if(Kt.shapeInfo.isUniform)return"float "+Ht+"() {return "+Vt+";}";var vn=Kt.shapeInfo.texShape,On=vn[0],Cn=vn[1];if(On===1&&Cn===1)return`
      float `+Ht+`() {
        return sampleTexture(`+Vt+`, halfCR);
      }
    `;var Kn=Kt.shapeInfo.texShape,er=Kn[0],sr=Kn[1],lr=ao(Vt);return`
    float `+Ht+`() {
      vec2 uv = uvFromFlat(`+er+", "+sr+", "+lr+`);
      return sampleTexture(`+Vt+`, uv);
    }
  `}(Ct);case 1:return function(Kt){var Vt=Kt.name,Ht="get"+Vt.charAt(0).toUpperCase()+Vt.slice(1);if(Kt.shapeInfo.isUniform)return`
      float `+Ht+`(int index) {
        `+fu(Kt)+`
      }
    `;var vn=Kt.shapeInfo.texShape,On=vn[0],Cn=vn[1];if(Cn===1&&On===1)return`
      float `+Ht+`(int index) {
        return sampleTexture(`+Vt+`, halfCR);
      }
    `;var Kn=ao(Vt);return Cn===1?`
      float `+Ht+`(int index) {
        vec2 uv = vec2(0.5, (float(index + `+Kn+") + 0.5) / "+On+`.0);
        return sampleTexture(`+Vt+`, uv);
      }
    `:On===1?`
      float `+Ht+`(int index) {
        vec2 uv = vec2((float(index + `+Kn+") + 0.5) / "+Cn+`.0, 0.5);
        return sampleTexture(`+Vt+`, uv);
      }
    `:`
    float `+Ht+`(int index) {
      vec2 uv = uvFromFlat(`+On+", "+Cn+", index + "+Kn+`);
      return sampleTexture(`+Vt+`, uv);
    }
  `}(Ct);case 2:return function(Kt){var Vt=Kt.shapeInfo.logicalShape,Ht=Kt.name,vn="get"+Ht.charAt(0).toUpperCase()+Ht.slice(1),On=Kt.shapeInfo.texShape;if(On!=null&&ln(Vt,On)){var Cn=On[0],Kn=On[1];return`
    float `+vn+`(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(`+Kn+".0, "+Cn+`.0);
      return sampleTexture(`+Ht+`, uv);
    }
  `}var er=In(Vt),sr=er.newShape,lr=er.keptDims,ur=sr;if(ur.length<Vt.length){var ar=_s(Kt,ur);return`
      `+gt(ar)+`
      float `+vn+`(int row, int col) {
        return `+vn+"("+hs(["row","col"],lr)+`);
      }
    `}if(Kt.shapeInfo.isUniform)return`
      float `+vn+`(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(`+Vt[1]+`, 1)));
        `+fu(Kt)+`
      }
    `;var Or=On[0],Er=On[1],Ur=ao(Ht);return Er===1?`
    float `+vn+`(int row, int col) {
      float index = dot(vec3(row, col, `+Ur+"), vec3("+Vt[1]+`, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / `+Or+`.0);
      return sampleTexture(`+Ht+`, uv);
    }
  `:Or===1?`
    float `+vn+`(int row, int col) {
      float index = dot(vec3(row, col, `+Ur+"), vec3("+Vt[1]+`, 1, 1));
      vec2 uv = vec2((index + 0.5) / `+Er+`.0, 0.5);
      return sampleTexture(`+Ht+`, uv);
    }
  `:`
  float `+vn+`(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * `+Vt[1]+" + col + "+Ur+`;
    vec2 uv = uvFromFlat(`+Or+", "+Er+`, index);
    return sampleTexture(`+Ht+`, uv);
  }
`}(Ct);case 3:return function(Kt){var Vt=Kt.shapeInfo.logicalShape,Ht=Kt.name,vn="get"+Ht.charAt(0).toUpperCase()+Ht.slice(1),On=Vt[1]*Vt[2],Cn=Vt[2],Kn=In(Vt),er=Kn.newShape,sr=Kn.keptDims,lr=er;if(lr.length<Vt.length){var ur=_s(Kt,lr);return`
        `+gt(ur)+`
        float `+vn+`(int row, int col, int depth) {
          return `+vn+"("+hs(["row","col","depth"],sr)+`);
        }
      `}if(Kt.shapeInfo.isUniform)return`
      float `+vn+`(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(`+On+", "+Cn+`, 1)));
        `+fu(Kt)+`
      }
    `;var ar=Kt.shapeInfo.texShape,Or=ar[0],Er=ar[1],Ur=Kt.shapeInfo.flatOffset;if(Er===On&&Ur==null)return`
        float `+vn+`(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(`+Cn+`, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(`+Er+".0, "+Or+`.0);
          return sampleTexture(`+Ht+`, uv);
        }
      `;if(Er===Cn&&Ur==null)return`
    float `+vn+`(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(`+Vt[1]+`, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+Er+".0, "+Or+`.0);
      return sampleTexture(`+Ht+`, uv);
    }
  `;var ei=ao(Ht);return`
      float `+vn+`(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `+On+" + col * "+Cn+" + depth + "+ei+`;
        vec2 uv = uvFromFlat(`+Or+", "+Er+`, index);
        return sampleTexture(`+Ht+`, uv);
      }
  `}(Ct);case 4:return function(Kt){var Vt=Kt.shapeInfo.logicalShape,Ht=Kt.name,vn="get"+Ht.charAt(0).toUpperCase()+Ht.slice(1),On=Vt[3],Cn=Vt[2]*On,Kn=Vt[1]*Cn,er=In(Vt),sr=er.newShape,lr=er.keptDims;if(sr.length<Vt.length){var ur=_s(Kt,sr);return`
      `+gt(ur)+`
      float `+vn+`(int row, int col, int depth, int depth2) {
        return `+vn+"("+hs(["row","col","depth","depth2"],lr)+`);
      }
    `}if(Kt.shapeInfo.isUniform)return`
      float `+vn+`(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(`+Kn+", "+Cn+", "+On+`, 1)));
        `+fu(Kt)+`
      }
    `;var ar=Kt.shapeInfo.flatOffset,Or=Kt.shapeInfo.texShape,Er=Or[0],Ur=Or[1];if(Ur===Kn&&ar==null)return`
      float `+vn+`(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(`+Cn+", "+On+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+Ur+".0, "+Er+`.0);
        return sampleTexture(`+Ht+`, uv);
      }
    `;if(Ur===On&&ar==null)return`
      float `+vn+`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`+Vt[1]*Vt[2]+", "+Vt[2]+`, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+Ur+".0, "+Er+`.0);
        return sampleTexture(`+Ht+`, uv);
      }
    `;var ei=ao(Ht);return`
    float `+vn+`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+Kn+" + col * "+Cn+` +
          depth * `+On+` + depth2;
      vec2 uv = uvFromFlat(`+Er+", "+Ur+", index + "+ei+`);
      return sampleTexture(`+Ht+`, uv);
    }
  `}(Ct);case 5:return function(Kt){var Vt=Kt.shapeInfo.logicalShape,Ht=Kt.name,vn="get"+Ht.charAt(0).toUpperCase()+Ht.slice(1),On=Vt[4],Cn=Vt[3]*On,Kn=Vt[2]*Cn,er=Vt[1]*Kn,sr=In(Vt),lr=sr.newShape,ur=sr.keptDims;if(lr.length<Vt.length){var ar=_s(Kt,lr);return`
      `+gt(ar)+`
      float `+vn+`(int row, int col, int depth, int depth2, int depth3) {
        return `+vn+"("+hs(["row","col","depth","depth2","depth3"],ur)+`);
      }
    `}if(Kt.shapeInfo.isUniform)return`
      float `+vn+`(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(`+er+", "+Kn+", "+Cn+", "+On+`)) +
          depth3;
        `+fu(Kt)+`
      }
    `;var Or=Kt.shapeInfo.flatOffset,Er=Kt.shapeInfo.texShape,Ur=Er[0],ei=Er[1];if(ei===er&&Or==null)return`
      float `+vn+`(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(`+Kn+", "+Cn+", "+On+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+ei+".0, "+Ur+`.0);
        return sampleTexture(`+Ht+`, uv);
      }
    `;if(ei===On&&Or==null)return`
      float `+vn+`(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(`+Vt[1]*Vt[2]*Vt[3]+`,
               `+Vt[2]*Vt[3]+", "+Vt[3]+`, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+ei+".0, "+Ur+`.0);
        return sampleTexture(`+Ht+`, uv);
      }
    `;var mi=ao(Ht);return`
    float `+vn+`(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+er+" + col * "+Kn+" + depth * "+Cn+` +
          depth2 * `+On+" + depth3 + "+mi+`;
      vec2 uv = uvFromFlat(`+Ur+", "+ei+`, index);
      return sampleTexture(`+Ht+`, uv);
    }
  `}(Ct);case 6:return function(Kt){var Vt=Kt.shapeInfo.logicalShape,Ht=Kt.name,vn="get"+Ht.charAt(0).toUpperCase()+Ht.slice(1),On=In(Vt),Cn=On.newShape,Kn=On.keptDims;if(Cn.length<Vt.length){var er=_s(Kt,Cn);return`
      `+gt(er)+`
      float `+vn+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return `+vn+"("+hs(["row","col","depth","depth2","depth3","depth4"],Kn)+`);
      }
    `}var sr=Vt[5],lr=Vt[4]*sr,ur=Vt[3]*lr,ar=Vt[2]*ur,Or=Vt[1]*ar;if(Kt.shapeInfo.isUniform)return`
      float `+vn+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(`+Or+", "+ar+", "+ur+", "+lr+`)) +
          dot(
            vec2(depth3, depth4),
            vec2(`+sr+`, 1)));
        `+fu(Kt)+`
      }
    `;var Er=Kt.shapeInfo.flatOffset,Ur=Kt.shapeInfo.texShape,ei=Ur[0],mi=Ur[1];if(mi===Or&&Er==null)return`
      float `+vn+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(`+ar+", "+ur+", "+lr+", "+sr+`)) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+mi+".0, "+ei+`.0);
        return sampleTexture(`+Ht+`, uv);
      }
    `;if(mi===sr&&Er==null)return`
      float `+vn+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(`+Vt[1]*Vt[2]*Vt[3]*Vt[4]+`,
               `+Vt[2]*Vt[3]*Vt[4]+`,
               `+Vt[3]*Vt[4]+`,
               `+Vt[4]+`)) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+mi+".0, "+ei+`.0);
        return sampleTexture(`+Ht+`, uv);
      }
    `;var ua=ao(Ht);return`
    float `+vn+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+Or+" + col * "+ar+" + depth * "+ur+` +
          depth2 * `+lr+" + depth3 * "+sr+" + depth4 + "+ua+`;
      vec2 uv = uvFromFlat(`+ei+", "+mi+`, index);
      return sampleTexture(`+Ht+`, uv);
    }
  `}(Ct);default:throw new Error(Wt.length+"-D input sampling is not yet supported")}}(Ue);var lt=Ue.shapeInfo.logicalShape,ht=$e.logicalShape;return lt.length<=ht.length&&(et+=He?function(gt,Ct){var Wt,Kt=gt.name,Vt=Kt.charAt(0).toUpperCase()+Kt.slice(1),Ht="get"+Vt+"AtOutCoords",vn=gt.shapeInfo.logicalShape.length,On=Ct.logicalShape.length,Cn=Ao(gt.shapeInfo.logicalShape,Ct.logicalShape),Kn=Ia(On),er=On-vn,sr=["x","y","z","w","u","v"];Wt=vn===0?"":On<2&&Cn.length>=1?"coords = 0;":Cn.map(function(ei){return"coords."+sr[ei+er]+" = 0;"}).join(`
`);var lr;lr=On<2&&vn>0?"coords":gt.shapeInfo.logicalShape.map(function(ei,mi){return"coords."+sr[mi+er]}).join(", ");var ur="return outputValue;",ar=Ye(gt.shapeInfo.logicalShape)===1,Or=Ye(Ct.logicalShape)===1;if(vn!==1||ar||Or){if(ar&&!Or)ur=On===1?`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:`
        return vec4(outputValue.x);
      `;else if(Cn.length){var Er=vn-2,Ur=vn-1;Cn.indexOf(Er)>-1&&Cn.indexOf(Ur)>-1?ur="return vec4(outputValue.x);":Cn.indexOf(Er)>-1?ur="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":Cn.indexOf(Ur)>-1&&(ur="return vec4(outputValue.xx, outputValue.zz);")}}else ur=`
      return vec4(outputValue.xy, outputValue.xy);
    `;return`
    vec4 `+Ht+`() {
      `+Kn+` coords = getOutputCoords();
      `+Wt+`
      vec4 outputValue = get`+Vt+"("+lr+`);
      `+ur+`
    }
  `}(Ue,$e):function(gt,Ct){var Wt=gt.name,Kt=Wt.charAt(0).toUpperCase()+Wt.slice(1),Vt="get"+Kt+"AtOutCoords",Ht=Ct.texShape,vn=gt.shapeInfo.texShape,On=gt.shapeInfo.logicalShape.length,Cn=Ct.logicalShape.length;if(!gt.shapeInfo.isUniform&&On===Cn&&gt.shapeInfo.flatOffset==null&&ln(vn,Ht))return`
      float `+Vt+`() {
        return sampleTexture(`+Wt+`, resultUV);
      }
    `;var Kn=Ia(Cn),er=Ao(gt.shapeInfo.logicalShape,Ct.logicalShape),sr=Cn-On,lr=["x","y","z","w","u","v"];return`
    float `+Vt+`() {
      `+Kn+` coords = getOutputCoords();
      `+(On===0?"":Cn<2&&er.length>=1?"coords = 0;":er.map(function(ur){return"coords."+lr[ur+sr]+" = 0;"}).join(`
`))+`
      return get`+Kt+"("+(Cn<2&&On>0?"coords":gt.shapeInfo.logicalShape.map(function(ur,ar){return"coords."+lr[ar+sr]}).join(", "))+`);
    }
  `}(Ue,$e)),et}(Ne,c,l)}).join(`
`),oe=c.texShape,me=va(),Ee=`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return `+me.texture2D+`(textureSampler, uv).r;
    }
  `,_e=function(Ne){return Ne.version+`
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    `+Ne.varyingFs+` vec2 resultUV;
    `+Ne.defineOutput+`
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    `+Ne.defineSpecialNaN+`
    `+Ne.defineSpecialInf+`
    `+Ne.defineRound+`

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    `+Ma+`
    `+cc+`
    `+Vo+`
  `}(me);return c.isPacked?(_=function(Ne,Ue){switch(Ne.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(gt,Ct){var Wt=[Math.ceil(Ct[0]/2),Math.ceil(Ct[1]/2)];return Wt[0]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * `+Wt[1]+`.0);
      }
    `:Wt[1]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * `+Wt[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+Wt[0]+", "+Wt[1]+`));
      return 2 * (resTexRC.x * `+Wt[1]+` + resTexRC.y);
    }
  `}(0,Ue);case 2:return function(gt,Ct){var Wt=[Math.ceil(Ct[0]/2),Math.ceil(Ct[1]/2)];if(ln(gt,Ct))return`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(`+Wt[0]+", "+Wt[1]+`));
      }
    `;var Kt=Math.ceil(gt[1]/2);return`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+Wt[0]+", "+Wt[1]+`));

      int index = resTexRC.x * `+Wt[1]+` + resTexRC.y;
      int r = 2 * (index / `+Kt+`);
      int c = imod(index, `+Kt+`) * 2;

      return ivec2(r, c);
    }
  `}(Ne,Ue);case 3:return $e=Ne,He=Ue,et=[Math.ceil(He[0]/2),Math.ceil(He[1]/2)],ht=(lt=Math.ceil($e[2]/2))*Math.ceil($e[1]/2),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+et[0]+", "+et[1]+`));
      int index = resTexRC.x * `+et[1]+` + resTexRC.y;

      int b = index / `+ht+`;
      index -= b * `+ht+`;

      int r = 2 * (index / `+lt+`);
      int c = imod(index, `+lt+`) * 2;

      return ivec3(b, r, c);
    }
  `;default:return function(gt,Ct){for(var Wt=[Math.ceil(Ct[0]/2),Math.ceil(Ct[1]/2)],Kt=Math.ceil(gt[gt.length-1]/2),Vt=Kt*Math.ceil(gt[gt.length-2]/2),Ht=Vt,vn="",On="b, r, c",Cn=2;Cn<gt.length-1;Cn++)vn=`
      int b`+Cn+" = index / "+(Ht*=gt[gt.length-Cn-1])+`;
      index -= b`+Cn+" * "+Ht+`;
    `+vn,On="b"+Cn+", "+On;return`
    ivec`+gt.length+` getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+Wt[0]+", "+Wt[1]+`));
      int index = resTexRC.x * `+Wt[1]+` + resTexRC.y;

      `+vn+`

      int b = index / `+Vt+`;
      index -= b * `+Vt+`;

      int r = 2 * (index / `+Kt+`);
      int c = imod(index, `+Kt+`) * 2;

      return ivec`+gt.length+"("+On+`);
    }
  `}(Ne,Ue)}var $e,He,et,lt,ht}(c.logicalShape,oe),j=`
    void setOutput(vec4 val) {
      `+me.output+` = val;
    }
  `):(_=function(Ne,Ue){switch(Ne.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(et,lt){return lt[0]===1?`
      int getOutputCoords() {
        return int(resultUV.x * `+lt[1]+`.0);
      }
    `:lt[1]===1?`
      int getOutputCoords() {
        return int(resultUV.y * `+lt[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+lt[0]+", "+lt[1]+`));
      return resTexRC.x * `+lt[1]+` + resTexRC.y;
    }
  `}(0,Ue);case 2:return function(et,lt){return ln(et,lt)?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(`+lt[0]+", "+lt[1]+`));
      }
    `:et[1]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+lt[0]+", "+lt[1]+`));
        int index = resTexRC.x * `+lt[1]+` + resTexRC.y;
        return ivec2(index, 0);
      }
    `:et[0]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+lt[0]+", "+lt[1]+`));
        int index = resTexRC.x * `+lt[1]+` + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+lt[0]+", "+lt[1]+`));
      int index = resTexRC.x * `+lt[1]+` + resTexRC.y;
      int r = index / `+et[1]+`;
      int c = index - r * `+et[1]+`;
      return ivec2(r, c);
    }
  `}(Ne,Ue);case 3:return $e=Ue,He=ho(["r","c","d"],Ne),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+$e[0]+", "+$e[1]+`));
      int index = resTexRC.x * `+$e[1]+` + resTexRC.y;
      `+He+`
      return ivec3(r, c, d);
    }
  `;case 4:return function(et,lt){var ht=ho(["r","c","d","d2"],et);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+lt[0]+", "+lt[1]+`));
      int index = resTexRC.x * `+lt[1]+` + resTexRC.y;
      `+ht+`
      return ivec4(r, c, d, d2);
    }
  `}(Ne,Ue);case 5:return function(et,lt){var ht=ho(["r","c","d","d2","d3"],et);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(`+lt[0]+`,
                             `+lt[1]+`));

      int index = resTexRC.x * `+lt[1]+` + resTexRC.y;

      `+ht+`

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}(Ne,Ue);case 6:return function(et,lt){var ht=ho(["r","c","d","d2","d3","d4"],et);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+lt[0]+", "+lt[1]+`));
      int index = resTexRC.x * `+lt[1]+` + resTexRC.y;

      `+ht+`

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}(Ne,Ue);default:throw new Error(Ne.length+"-D output sampling is not yet supported")}var $e,He}(c.logicalShape,oe),j=`
    void setOutput(float val) {
      `+me.output+` = vec4(val, 0, 0, 0);
    }
  `),l&&(_e+=lu),[_e,Ee,j,V,_,ne,a].join(`
`)}var Ma=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,cc=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Vo=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,lu=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function ao(p){return"offset"+p}function fu(p){var c=p.name,a=Ye(p.shapeInfo.logicalShape);return a<2?"return "+c+";":`
    for (int i = 0; i < `+a+`; i++) {
      if (i == index) {
        return `+c+`[i];
      }
    }
  `}function Ia(p){if(p<=1)return"int";if(p===2)return"ivec2";if(p===3)return"ivec3";if(p===4)return"ivec4";if(p===5)return"ivec5";if(p===6)return"ivec6";throw Error("GPU for rank "+p+" is not yet supported")}function _s(p,c){var a=JSON.parse(JSON.stringify(p));return a.shapeInfo.logicalShape=c,a}function hs(p,c){return c.map(function(a){return p[a]}).join(", ")}var ia=function(p,c,a){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Mi(c,a),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        `+p+`
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `},Ss="return a + b;",Ko="return a - b;",Gs="return a * b;",_c="return (a < 0.) ? b * a : a;",za=function(p,c,a){this.variableNames=["A","B"],this.outputShape=Mi(c,a),this.userCode=`
      float binaryOperation(float a, float b) {
        `+p+`
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `},es=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`,Mo=function(p,c,a,l){l===void 0&&(l=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Mi(c,a);var g=this.outputShape.length,_="";if(l)if(g===0||Ye(this.outputShape)===1)_=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(_=`
          `+Ia(g)+` coords = getOutputCoords();
        `,g===1)_+=`
            result.y = (coords + 1) >= `+this.outputShape[0]+` ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{var j=fo("coords",g);_+=`
            bool nextRowOutOfBounds =
              (`+j[g-2]+" + 1) >= "+this.outputShape[g-2]+`;
            bool nextColOutOfBounds =
              (`+j[g-1]+" + 1) >= "+this.outputShape[g-1]+`;
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        `+p+`
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        `+_+`

        setOutput(result);
      }
    `},lc=function(){function p(c){this.variableNames=["A"],this.outputShape=c,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}return p.prototype.getCustomSetupFunc=function(c,a){var l=this;return function(g,_){l.minLoc==null&&(l.minLoc=g.getUniformLocationNoThrow(_,"minVal"),l.maxLoc=g.getUniformLocationNoThrow(_,"maxVal")),g.gl.uniform1f(l.minLoc,c),g.gl.uniform1f(l.maxLoc,a)}},p}(),el=function(){function p(c){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=c,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}return p.prototype.getCustomSetupFunc=function(c,a){var l=this;return function(g,_){l.minLoc==null&&(l.minLoc=g.getUniformLocationNoThrow(_,"minVal"),l.maxLoc=g.getUniformLocationNoThrow(_,"maxVal")),g.gl.uniform1f(l.minLoc,c),g.gl.uniform1f(l.maxLoc,a)}},p}();function ci(p,c,a){var l=p.indexOf(c);return p.map(function(g,_){return _===l?g+" - "+a:g}).join()}var Xd=function(p,c,a,l){c===void 0&&(c=!1),a===void 0&&(a=null),l===void 0&&(l=!1),this.variableNames=["x","W"],this.outputShape=p.outShape;var g=p.padInfo.top,_=p.padInfo.left,j=p.strideHeight,V=p.strideWidth,ne=p.dilationHeight,oe=p.dilationWidth,me=p.filterHeight,Ee=p.filterWidth,_e=4*Math.floor(p.inChannels/4),Ne=p.inChannels%4,Ue=p.dataFormat==="channelsLast",$e=Ue?1:2,He=Ue?2:3,et=Ue?3:1,lt="",ht="";a&&(lt=l?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+a+`
        }`:`
          float activation(float x) {
            `+a+`
          }
        `,ht="result = activation(result);");var gt=c?"result += getBiasAtOutCoords();":"";c&&this.variableNames.push("bias"),l&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+lt+`

      const ivec2 strides = ivec2(`+j+", "+V+`);
      const ivec2 pads = ivec2(`+g+", "+_+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[`+et+`];

        ivec2 xRCCorner =
            ivec2(coords[`+$e+"], coords["+He+`]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+me+`; wR++) {
          int xR = xRCorner + wR * `+ne+`;

          if (xR < 0 || xR >= `+p.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+Ee+`; wC++) {
            int xC = xCCorner + wC * `+oe+`;

            if (xC < 0 || xC >= `+p.inWidth+`) {
              continue;
            }

            for (int d1 = 0; d1 < `+_e+`; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (`+Ue+`) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (`+(Ne===1)+`) {

              if (`+Ue+`) {
                dotProd +=
                    getX(batch, xR, xC, `+_e+`) *
                    getW(wR, wC, `+_e+`, d2);
              } else {
                dotProd +=
                    getX(batch, `+_e+`, xR, xC) *
                    getW(wR, wC, `+_e+`, d2);
              }

            } else if (`+(Ne===2)+`) {
              vec2 wValues = vec2(
                getW(wR, wC, `+_e+`, d2),
                getW(wR, wC, `+_e+` + 1, d2)
              );

              if (`+Ue+`) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, `+_e+`),
                  getX(batch, xR, xC, `+_e+` + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, `+_e+`, xR, xC),
                  getX(batch, `+_e+` + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (`+(Ne===3)+`) {
              vec3 wValues = vec3(
                getW(wR, wC, `+_e+`, d2),
                getW(wR, wC, `+_e+` + 1, d2),
                getW(wR, wC, `+_e+` + 2, d2)
              );

              if (`+Ue+`) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, `+_e+`),
                  getX(batch, xR, xC, `+_e+` + 1),
                  getX(batch, xR, xC, `+_e+` + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, `+_e+`, xR, xC),
                  getX(batch, `+_e+` + 1, xR, xC),
                  getX(batch, `+_e+` + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        `+gt+`
        `+ht+`
        setOutput(result);
      }
    `},tl=function(p,c,a,l){c===void 0&&(c=!1),a===void 0&&(a=null),l===void 0&&(l=!1),this.variableNames=["x","W"],this.outputShape=p.outShape;var g=p.inHeight,_=p.inWidth,j=p.padInfo.top,V=p.padInfo.left,ne=p.strideHeight,oe=p.strideWidth,me=p.dilationHeight,Ee=p.dilationWidth,_e=p.filterHeight,Ne=p.filterWidth,Ue=p.outChannels/p.inChannels,$e="",He="";a&&($e=l?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+a+`
        }`:`
          float activation(float x) {
            `+a+`
          }
        `,He="result = activation(result);");var et=c?"result += getBiasAtOutCoords();":"";c&&this.variableNames.push("bias"),l&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+$e+`

      const ivec2 strides = ivec2(`+ne+", "+oe+`);
      const ivec2 pads = ivec2(`+j+", "+V+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `+Ue+`;
        int q = d2 - d1 * `+Ue+`;

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < `+_e+`; wR++) {
          int xR = xRCorner + wR * `+me+`;

          if (xR < 0 || xR >= `+g+`) {
            continue;
          }

          for (int wC = 0; wC < `+Ne+`; wC++) {
            int xC = xCCorner + wC * `+Ee+`;

            if (xC < 0 || xC >= `+_+`) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        `+et+`
        `+He+`
        setOutput(result);
      }
    `},Ll=function(p,c,a,l){c===void 0&&(c=!1),a===void 0&&(a=null),l===void 0&&(l=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=p.outShape;for(var g=p.inHeight,_=p.inWidth,j=p.padInfo.top,V=p.padInfo.left,ne=p.strideHeight,oe=p.strideWidth,me=p.dilationHeight,Ee=p.dilationWidth,_e=p.filterHeight,Ne=p.filterWidth,Ue=Ne,$e="int xR; int xC; int xCOffset;",He=0;He<_e;He++)for(var et=0;et<Ne;et++)$e+=`
          vec4 xTexelR`+He+"C"+2*et+` = vec4(0.);
          vec4 wR`+He+"C"+et+` = vec4(0.);
          vec4 xR`+He+"C"+et+" = vec4(0.);";for(He=0;He<_e;He++)for(var lt=0;lt<Ue;lt++){if($e+=`
          xR = xRCorner + `+He*me+`;
          xC = xCCorner + `+(et=2*lt)*Ee+`;
        `,oe===1){if(et<Ne&&($e+=V%2==1?`
                xCOffset = xC + 1;
                if(xR >= 0 && xR < `+g+" && xCOffset >= 0 && xCOffset < "+_+`) {
                  xTexelR`+He+"C"+et+` = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+_+`) {
                    xTexelR`+He+"C"+et+`.zw = vec2(0.);
                  }
                } else {
                  xTexelR`+He+"C"+et+` = vec4(0.);
                }

                xCOffset = xC + 1 - 2;
                if(xR >= 0 && xR < `+g+" && xCOffset >= 0 && xCOffset < "+_+`) {
                  vec4 previous = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+_+`) {
                    previous.zw = vec2(0.);
                  }

                  xR`+He+"C"+et+" = vec4(previous.zw, xTexelR"+He+"C"+et+`.xy);
                } else {
                  xR`+He+"C"+et+" = vec4(0, 0, xTexelR"+He+"C"+et+`.xy);
                }
              `:`
                if(xR >= 0 && xR < `+g+" && xC >= 0 && xC < "+_+`) {
                  xTexelR`+He+"C"+et+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+He+"C"+et+` = vec4(0.);
                }

                xR`+He+"C"+et+" = xTexelR"+He+"C"+et+`;
              `,et+1<Ne)){var ht=V%2==0?zt(Ee):Ee;Ee%2==0&&V%2==1||Ee%2!=0&&V%2!=1?($e+=`
                  xCOffset = xC + `+V%2+" + "+ht+`;

                  if(xR >= 0 && xR < `+g+` &&
                    xCOffset >= 0 && xCOffset < `+_+`) {
                    xTexelR`+He+"C"+(et+2)+` = getX(batch, xR, xCOffset, d1);
                  }
                `,Ee>1&&($e+=`
                    xCOffset -= 2;
                    if(xR >= 0 && xR < `+g+` &&
                      xCOffset >= 0 && xCOffset < `+_+`) {
                      xTexelR`+He+"C"+et+` = getX(batch, xR, xCOffset, d1);
                    } else {
                      xTexelR`+He+"C"+et+` = vec4(0.);
                    }
                  `),$e+=`
                  xR`+He+"C"+(et+1)+` = vec4(
                    xTexelR`+He+"C"+et+".zw, xTexelR"+He+"C"+(et+2)+`.xy);
                `):$e+=`
                  xCOffset = xC + `+ht+`;

                  if(xR >= 0 && xR < `+g+` &&
                    xCOffset >= 0 && xCOffset < `+_+`) {
                    xTexelR`+He+"C"+(et+2)+` = getX(batch, xR, xCOffset, d1);
                  }

                  xR`+He+"C"+(et+1)+" = xTexelR"+He+"C"+(et+2)+`;
                `}}else et<Ne&&($e+=`
              if(xR >= 0 && xR < `+g+`) {
            `,V%2==1?($e+=`
                xCOffset = xC + 1 - `+oe+`;
                if(xCOffset >= 0 && xCOffset < `+_+`) {
                  xTexelR`+He+"C"+et+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+He+"C"+et+` = vec4(0.);
                }

                if(xC + 1 >= 0 && xC + 1 < `+_+`) {
                  xTexelR`+He+"C"+(et+2)+` = getX(batch, xR, xC + 1, d1);
                } else {
                  xTexelR`+He+"C"+(et+2)+` = vec4(0.);
                }

                xR`+He+"C"+et+` = vec4(
                  xTexelR`+He+"C"+et+".zw, xTexelR"+He+"C"+(et+2)+`.zw);
              `,et+1<Ne&&($e+=`
                  vec4 final = vec4(0.);
                  xCOffset = xC + 1 + `+oe+`;
                  if(xCOffset >= 0 && xCOffset < `+_+`) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xR`+He+"C"+(et+1)+" = vec4(xTexelR"+He+"C"+(et+2)+`.xy, final.xy);
                `)):($e+=`
                if(xC >= 0 && xC < `+_+`) {
                  xTexelR`+He+"C"+et+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+He+"C"+et+` = vec4(0.);
                }

                xCOffset = xC + `+oe+`;
                if(xCOffset >= 0 && xCOffset < `+_+`) {
                  xTexelR`+He+"C"+(et+2)+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+He+"C"+(et+2)+` = vec4(0.);
                }

                xR`+He+"C"+et+` = vec4(
                  xTexelR`+He+"C"+et+".xy, xTexelR"+He+"C"+(et+2)+`.xy);
              `,et+1<Ne&&($e+=`
                  xR`+He+"C"+(et+1)+` = vec4(
                    xTexelR`+He+"C"+et+".zw, xTexelR"+He+"C"+(et+2)+`.zw);
                `)),$e+="}");et<Ne&&($e+=`
            vec4 wTexelR`+He+"C"+et+" = getW("+He+", "+et+`, d1, q);
            wR`+He+"C"+et+" = vec4(wTexelR"+He+"C"+et+".xz, wTexelR"+He+"C"+et+`.xz);
          `,et+1<Ne&&($e+=`
              vec4 wTexelR`+He+"C"+(et+1)+" = getW("+He+", "+(et+1)+`, d1, q);
              wR`+He+"C"+(et+1)+` =
                vec4(wTexelR`+He+"C"+(et+1)+".xz, wTexelR"+He+"C"+(et+1)+".xz);"))}for(He=0;He<_e;He++)for(et=0;et<Ne;et++)$e+="dotProd += xR"+He+"C"+et+" * wR"+He+"C"+et+";";var gt="",Ct="";a&&(gt=l?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+a+`
        }`:`vec4 activation(vec4 x) {
          `+a+`
        }`,Ct="result = activation(result);");var Wt=c?"result += getBiasAtOutCoords();":"";c&&this.variableNames.push("bias"),l&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+gt+`

      const ivec2 strides = ivec2(`+ne+", "+oe+`);
      const ivec2 pads = ivec2(`+j+", "+V+`);

      void main() {

        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2;
        int q = 0;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        vec4 dotProd = vec4(0.);

        `+$e+`

        vec4 result = dotProd;
        `+Wt+`
        `+Ct+`
        setOutput(result);
      }
    `};function vg(p,c){if(p===1)return""+c;if(p===2)return c+".y";if(p===3)return c+".z";if(p===4)return c+".w";throw Error("Cumulative sum for rank "+p+" is not yet supported")}var yg=function(){function p(c,a,l){this.variableNames=["x"],this.outputShape=[],this.outputShape=c,this.blockSize=a,this.dataFormat=l,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = `+this.getHeightCoordString()+`;
      int w = `+this.getWidthCoordString()+`;
      int d = `+this.getDepthCoordString()+`;

      int in_h = h / `+a+`;
      int offset_h = imod(h, `+a+`);
      int in_w = w / `+a+`;
      int offset_w = imod(w, `+a+`);
      int offset_d = (offset_h * `+a+` + offset_w) *
        `+this.getOutputDepthSize()+`;
      int in_d = d + offset_d;

      float result = `+this.getInputSamplingString()+`;
      setOutput(result);
    }
  `}return p.prototype.getHeightCoordString=function(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"},p.prototype.getWidthCoordString=function(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"},p.prototype.getDepthCoordString=function(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"},p.prototype.getOutputDepthSize=function(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]},p.prototype.getInputSamplingString=function(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},p}(),Cm=function(p,c,a){this.variableNames=["real","imag"];var l=c[1];this.outputShape=c;var g=a?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,_=a?l+".0":"1.0";this.userCode=`
      const float exponentMultiplier = `+g+`;

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        `+p+`
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(`+l+`);
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < `+l+`; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / `+_+`;
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `},Om=function(){function p(c,a){this.outputShape=[],this.variableNames=["x"],this.outputShape=c,this.userCode=`
      uniform float value;
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}return p.prototype.getCustomSetupFunc=function(c){var a=this;return function(l,g){a.valueLoc==null&&(a.valueLoc=l.getUniformLocationNoThrow(g,"value")),l.gl.uniform1f(a.valueLoc,c)}},p}();function bg(p,c){var a=va();return Zi(p,c,a.version+`
    precision highp float;
    `+a.attribute+` vec3 clipSpacePos;
    `+a.attribute+` vec2 uv;
    `+a.varyingVs+` vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`)}function Am(p,c){return bc(p,c,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function xg(p,c){return Bu(p,c,new Uint16Array([0,1,2,2,1,3]))}function Pf(p,c,a,l,g,_,j){Dd(a,l);var V=xc(p,c),ne=p.TEXTURE_2D;return Bn(p,c,function(){return p.bindTexture(ne,V)}),Bn(p,c,function(){return p.texParameteri(ne,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE)}),Bn(p,c,function(){return p.texParameteri(ne,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE)}),Bn(p,c,function(){return p.texParameteri(ne,p.TEXTURE_MIN_FILTER,p.NEAREST)}),Bn(p,c,function(){return p.texParameteri(ne,p.TEXTURE_MAG_FILTER,p.NEAREST)}),Bn(p,c,function(){return p.texImage2D(ne,0,g,a,l,0,_,j,null)}),Bn(p,c,function(){return p.bindTexture(p.TEXTURE_2D,null)}),V}function Yd(p,c,a,l,g){var _=Qi(a,l);return Pf(p,c,_[0],_[1],g.internalFormatFloat,g.textureFormatFloat,p.FLOAT)}function wg(p,c,a,l,g){var _=Qi(a,l);return Pf(p,c,_[0],_[1],g.internalFormatHalfFloat,g.textureFormatFloat,g.textureTypeHalfFloat)}function kg(p,c,a,l,g){var _=Qi(a,l);return Pf(p,c,_[0],_[1],p.RGBA,p.RGBA,p.UNSIGNED_BYTE)}function Eg(p,c,a,l,g){var _=qr(a,l);return Pf(p,c,_[0],_[1],g.internalFormatPackedFloat,p.RGBA,p.FLOAT)}function Sc(p,c,a,l,g){var _=qr(a,l);return Pf(p,c,_[0],_[1],g.internalFormatPackedHalfFloat,p.RGBA,g.textureTypeHalfFloat)}function Lf(p,c,a,l){return Bn(p,c,function(){return p.bindBuffer(p.ARRAY_BUFFER,l)}),vf(p,c,a,"clipSpacePos",l,3,20,0)&&vf(p,c,a,"uv",l,2,20,12)}function Jd(p,c,a,l,g,_,j){var V,ne,oe;Bn(p,c,function(){return p.bindTexture(p.TEXTURE_2D,a)}),_ instanceof Uint8Array?(V=new Uint8Array(l*g*4),ne=p.UNSIGNED_BYTE,oe=p.RGBA):(V=new Float32Array(l*g*4),ne=p.FLOAT,oe=j.internalFormatPackedFloat),V.set(_),Bn(p,c,function(){return p.texImage2D(p.TEXTURE_2D,0,oe,l,g,0,p.RGBA,ne,V)}),Bn(p,c,function(){return p.bindTexture(p.TEXTURE_2D,null)})}function _m(p,c,a,l){Bn(p,c,function(){return p.bindTexture(p.TEXTURE_2D,a)}),l.data instanceof Uint8Array?Bn(p,c,function(){return p.texImage2D(p.TEXTURE_2D,0,p.RGBA,l.width,l.height,0,p.RGBA,p.UNSIGNED_BYTE,l.data)}):Bn(p,c,function(){return p.texImage2D(p.TEXTURE_2D,0,p.RGBA,p.RGBA,p.UNSIGNED_BYTE,l)}),Bn(p,c,function(){return p.bindTexture(p.TEXTURE_2D,null)})}function Sm(p,c,a,l,g){var _=p.createBuffer();Bn(p,c,function(){return p.bindBuffer(p.PIXEL_PACK_BUFFER,_)});var j=16*a*l;return Bn(p,c,function(){return p.bufferData(p.PIXEL_PACK_BUFFER,j,p.STREAM_READ)}),Bn(p,c,function(){return p.readPixels(0,0,l,a,p.RGBA,p.FLOAT,0)}),Bn(p,c,function(){return p.bindBuffer(p.PIXEL_PACK_BUFFER,null)}),_}function Tv(p,c,a){var l=p,g=new Float32Array(a);return l.bindBuffer(l.PIXEL_PACK_BUFFER,c),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,g),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),g}function Dm(p,c,a,l,g){var _=Qi(a,l),j=_[0],V=_[1],ne=new Uint8Array(a*l*4);return Bn(p,c,function(){return p.readPixels(0,0,j,V,g.downloadTextureFormat,p.UNSIGNED_BYTE,ne)}),new Float32Array(ne.buffer)}function qh(p,c,a,l,g,_,j,V){var ne=p,oe=new Float32Array(function(me,Ee){var _e=qr(_,j);return _e[0]*_e[1]*4}());return ne.bindBuffer(ne.PIXEL_PACK_BUFFER,c),ne.getBufferSubData(ne.PIXEL_PACK_BUFFER,0,oe),ne.bindBuffer(ne.PIXEL_PACK_BUFFER,null),oe}function zf(p,c,a,l){var g=new Float32Array(a*l*4);return Bn(p,c,function(){return p.readPixels(0,0,l,a,p.RGBA,p.FLOAT,g)}),g}var Dc=Object.freeze({createVertexShader:bg,createVertexBuffer:Am,createIndexBuffer:xg,createFloat32MatrixTexture:Yd,createFloat16MatrixTexture:wg,createUnsignedBytesMatrixTexture:kg,createPackedMatrixTexture:Eg,createFloat16PackedMatrixTexture:Sc,bindVertexProgramAttributeStreams:Lf,uploadDenseMatrixToTexture:Jd,uploadPixelDataToTexture:_m,createBufferFromOutputTexture:Sm,downloadFloat32MatrixFromBuffer:Tv,downloadByteEncodedFloatMatrixFromOutputTexture:Dm,downloadPackedMatrixFromBuffer:qh,downloadMatrixFromPackedOutputTexture:zf}),Tm=function(){function p(c){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var a=L().getNumber("WEBGL_VERSION");c!=null?(this.gl=c,la(a,c)):this.gl=ui(a);var l="WEBGL_color_buffer_float";if(L().getNumber("WEBGL_VERSION")===1){if(this.textureFloatExtension=ma(this.gl,this.debug,"OES_texture_float"),lo(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=ma(this.gl,this.debug,"OES_texture_half_float");else if(L().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(l),lo(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=ma(this.gl,this.debug,"EXT_color_buffer_half_float");else if(L().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(l="EXT_color_buffer_float",lo(this.gl,l))this.colorBufferFloatExtension=this.gl.getExtension(l);else{if(!lo(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=Am(this.gl,this.debug),this.indexBuffer=xg(this.gl,this.debug),this.framebuffer=os(this.gl,this.debug),this.textureConfig=jr(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(p.prototype,"debug",{get:function(){return L().getBool("DEBUG")},enumerable:!0,configurable:!0}),p.prototype.dispose=function(){var c=this;if(!this.disposed){this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var a=this.gl;Bn(a,this.debug,function(){return a.finish()}),Bn(a,this.debug,function(){return a.bindFramebuffer(a.FRAMEBUFFER,null)}),Bn(a,this.debug,function(){return a.deleteFramebuffer(c.framebuffer)}),Bn(a,this.debug,function(){return a.bindBuffer(a.ARRAY_BUFFER,null)}),Bn(a,this.debug,function(){return a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,null)}),Bn(a,this.debug,function(){return a.deleteBuffer(c.indexBuffer)}),this.disposed=!0}},p.prototype.createFloat32MatrixTexture=function(c,a){return this.throwIfDisposed(),Yd(this.gl,this.debug,c,a,this.textureConfig)},p.prototype.createFloat16MatrixTexture=function(c,a){return this.throwIfDisposed(),wg(this.gl,this.debug,c,a,this.textureConfig)},p.prototype.createUnsignedBytesMatrixTexture=function(c,a){return this.throwIfDisposed(),kg(this.gl,this.debug,c,a,this.textureConfig)},p.prototype.uploadPixelDataToTexture=function(c,a){this.throwIfDisposed(),_m(this.gl,this.debug,c,a)},p.prototype.uploadDenseMatrixToTexture=function(c,a,l,g){this.throwIfDisposed(),Jd(this.gl,this.debug,c,a,l,g,this.textureConfig)},p.prototype.createFloat16PackedMatrixTexture=function(c,a){return this.throwIfDisposed(),Sc(this.gl,this.debug,c,a,this.textureConfig)},p.prototype.createPackedMatrixTexture=function(c,a){return this.throwIfDisposed(),Eg(this.gl,this.debug,c,a,this.textureConfig)},p.prototype.deleteMatrixTexture=function(c){var a=this;this.throwIfDisposed(),this.outputTexture===c&&(El(this.gl,this.debug,this.framebuffer),this.outputTexture=null),Bn(this.gl,this.debug,function(){return a.gl.deleteTexture(c)})},p.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(c,a,l){var g=this;return this.downloadMatrixDriver(c,function(){return Dm(g.gl,g.debug,a,l,g.textureConfig)})},p.prototype.downloadPackedMatrixFromBuffer=function(c,a,l,g,_,j){return qh(this.gl,c,0,0,0,_,j,this.textureConfig)},p.prototype.downloadFloat32MatrixFromBuffer=function(c,a){return Tv(this.gl,c,a)},p.prototype.createBufferFromTexture=function(c,a,l){this.bindTextureToFrameBuffer(c);var g=Sm(this.gl,this.debug,a,l,this.textureConfig);return this.unbindTextureToFrameBuffer(),g},p.prototype.createAndWaitForFence=function(){var c=this.createFence(this.gl);return this.pollFence(c)},p.prototype.createFence=function(c){var a,l,g=this;if(L().getBool("WEBGL_FENCE_API_ENABLED")){var _=c,j=_.fenceSync(_.SYNC_GPU_COMMANDS_COMPLETE,0);c.flush(),l=function(){var V=_.clientWaitSync(j,0,0);return V===_.ALREADY_SIGNALED||V===_.CONDITION_SATISFIED},a=j}else L().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(a=this.beginQuery(),this.endQuery(),l=function(){return g.isQueryAvailable(a,L().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):l=function(){return!0};return{query:a,isFencePassed:l}},p.prototype.downloadMatrixFromPackedTexture=function(c,a,l){var g=this;return this.downloadMatrixDriver(c,function(){return zf(g.gl,g.debug,a,l)})},p.prototype.createProgram=function(c){this.throwIfDisposed();var a=this.gl,l=ga(a,this.debug,c),g=bg(a,this.debug),_=qi(a,this.debug);return Bn(a,this.debug,function(){return a.attachShader(_,g)}),Bn(a,this.debug,function(){return a.attachShader(_,l)}),ec(a,this.debug,_),this.debug&&bu(a,this.debug,_),this.vertexAttrsAreBound||(this.setProgram(_),this.vertexAttrsAreBound=Lf(a,this.debug,this.program,this.vertexBuffer)),_},p.prototype.deleteProgram=function(c){var a=this;this.throwIfDisposed(),c===this.program&&(this.program=null),c!=null&&Bn(this.gl,this.debug,function(){return a.gl.deleteProgram(c)})},p.prototype.setProgram=function(c){var a=this;this.throwIfDisposed(),this.program=c,this.program!=null&&this.debug&&bu(this.gl,this.debug,this.program),Bn(this.gl,this.debug,function(){return a.gl.useProgram(c)})},p.prototype.getUniformLocation=function(c,a,l){return l===void 0&&(l=!0),this.throwIfDisposed(),l?Pu(this.gl,this.debug,c,a):yf(this.gl,c,a)},p.prototype.getAttributeLocation=function(c,a){var l=this;return this.throwIfDisposed(),Bn(this.gl,this.debug,function(){return l.gl.getAttribLocation(c,a)})},p.prototype.getUniformLocationNoThrow=function(c,a){return this.throwIfDisposed(),this.gl.getUniformLocation(c,a)},p.prototype.setInputMatrixTexture=function(c,a,l){this.throwIfDisposed(),this.throwIfNoProgram(),Ch(this.gl,this.debug,this.program,c,a,l)},p.prototype.setOutputMatrixTexture=function(c,a,l){this.setOutputMatrixTextureDriver(c,l,a)},p.prototype.setOutputPackedMatrixTexture=function(c,a,l){this.throwIfDisposed();var g=qr(a,l),_=g[0],j=g[1];this.setOutputMatrixTextureDriver(c,_,j)},p.prototype.setOutputMatrixWriteRegion=function(c,a,l,g){this.setOutputMatrixWriteRegionDriver(l,c,g,a)},p.prototype.setOutputPackedMatrixWriteRegion=function(c,a,l,g){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},p.prototype.debugValidate=function(){this.program!=null&&bu(this.gl,this.debug,this.program),Io(this.gl)},p.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var c=this.gl;this.debug&&this.debugValidate(),Bn(c,this.debug,function(){return c.drawElements(c.TRIANGLES,6,c.UNSIGNED_SHORT,0)})},p.prototype.blockUntilAllProgramsCompleted=function(){var c=this;this.throwIfDisposed(),Bn(this.gl,this.debug,function(){return c.gl.finish()})},p.prototype.getQueryTimerExtension=function(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=ma(this.gl,this.debug,L().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},p.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},p.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},p.prototype.beginQuery=function(){if(L().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var c=this.gl,a=this.getQueryTimerExtensionWebGL2(),l=c.createQuery();return c.beginQuery(a.TIME_ELAPSED_EXT,l),l}var g=this.getQueryTimerExtensionWebGL1(),_=g.createQueryEXT();return g.beginQueryEXT(g.TIME_ELAPSED_EXT,_),_},p.prototype.endQuery=function(){if(L().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")!==2){var c=this.getQueryTimerExtensionWebGL1();c.endQueryEXT(c.TIME_ELAPSED_EXT)}else{var a=this.gl,l=this.getQueryTimerExtensionWebGL2();a.endQuery(l.TIME_ELAPSED_EXT)}},p.prototype.waitForQueryAndGetTime=function(c){return R(this,void 0,void 0,function(){var a=this;return P(this,function(l){switch(l.label){case 0:return[4,Dt(function(){return a.disposed||a.isQueryAvailable(c,L().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return l.sent(),[2,this.getQueryTime(c,L().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},p.prototype.getQueryTime=function(c,a){if(a===0)return null;if(a===2){var l=this.gl;return l.getQueryParameter(c,l.QUERY_RESULT)/1e6}var g=this.getQueryTimerExtensionWebGL1();return g.getQueryObjectEXT(c,g.QUERY_RESULT_EXT)/1e6},p.prototype.isQueryAvailable=function(c,a){if(a===0)return!0;if(a===2){var l=this.gl,g=this.getQueryTimerExtensionWebGL2(),_=l.getQueryParameter(c,l.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(g.GPU_DISJOINT_EXT)),_&&!this.disjoint}return _=(g=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(c,g.QUERY_RESULT_AVAILABLE_EXT),this.disjoint==null&&(this.disjoint=this.gl.getParameter(g.GPU_DISJOINT_EXT)),_&&!this.disjoint},p.prototype.pollFence=function(c){var a=this;return new Promise(function(l){a.addItemToPoll(function(){return c.isFencePassed()},function(){return l()})})},p.prototype.pollItems=function(){for(var c=function(l){for(var g=0;g<l.length&&l[g]();++g);return g-1}(this.itemsToPoll.map(function(l){return l.isDoneFn})),a=0;a<=c;++a)(0,this.itemsToPoll[a].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(c+1)},p.prototype.addItemToPoll=function(c,a){var l=this;this.itemsToPoll.push({isDoneFn:c,resolveFn:a}),this.itemsToPoll.length>1||Dt(function(){return l.pollItems(),l.itemsToPoll.length===0})},p.prototype.bindTextureToFrameBuffer=function(c){this.throwIfDisposed(),wc(this.gl,this.debug,c,this.framebuffer),this.debug&&Io(this.gl)},p.prototype.unbindTextureToFrameBuffer=function(){this.outputTexture!=null?(wc(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&Io(this.gl)):El(this.gl,this.debug,this.framebuffer)},p.prototype.downloadMatrixDriver=function(c,a){this.bindTextureToFrameBuffer(c);var l=a();return this.unbindTextureToFrameBuffer(),l},p.prototype.setOutputMatrixTextureDriver=function(c,a,l){this.throwIfDisposed();var g=this.gl;wc(g,this.debug,c,this.framebuffer),this.debug&&Io(g),this.outputTexture=c,Bn(g,this.debug,function(){return g.viewport(0,0,a,l)}),Bn(g,this.debug,function(){return g.scissor(0,0,a,l)})},p.prototype.setOutputMatrixWriteRegionDriver=function(c,a,l,g){var _=this;this.throwIfDisposed(),Bn(this.gl,this.debug,function(){return _.gl.scissor(c,a,l,g)})},p.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},p.prototype.throwIfNoProgram=function(){if(this.program==null)throw new Error("No GPU program is currently set.")},p}();function Nm(p,c){if(p.length!==c.length)throw Error("Binary was compiled with "+p.length+" inputs, but was executed with "+c.length+" inputs");p.forEach(function(a,l){var g=a.logicalShape,_=c[l],j=_.shape;if(!ln(g,j))throw Error("Binary was compiled with different shapes than the current args. Shapes "+g+" and "+j+" must match");if(!a.isUniform||!_.isUniform){var V=a.texShape,ne=_.isUniform?null:_.texData.texShape;if(!ln(V,ne))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+V+" and "+ne+" must match")}})}var _u=function(p,c,a,l,g,_,j){a===void 0&&(a=!1),l===void 0&&(l=!1),g===void 0&&(g=!1),_===void 0&&(_=null),j===void 0&&(j=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=c;var V=a?p[1]:p[2],ne=Math.ceil(V/2),oe=a?"i * 2, rc.y":"rc.y, i * 2",me=l?"rc.z, i * 2":"i * 2, rc.z",Ee=a?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],_e=l?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],Ne="",Ue="";_&&(Ne=j?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+_+`
        }`:`vec4 activation(vec4 x) {
          `+_+`
        }`,Ue="result = activation(result);");var $e=g?"result += getBiasAtOutCoords();":"";g&&this.variableNames.push("bias"),j&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+Ne+`

      const float sharedDimension = `+ne+`.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < `+ne+`; i++) {
          vec4 a = getMatrixA(rc.x, `+oe+`);
          vec4 b = getMatrixB(rc.x, `+me+`);

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (`+Ee[0]+" * "+_e[0]+`);
          result += (`+Ee[1]+" * "+_e[1]+`);
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        `+$e+`

        `+Ue+`

        setOutput(result);
      }
    `},Im=function(){function p(c,a,l){this.variableNames=["probs"],this.outputShape=[c,l],this.userCode=`
      uniform float seed;

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < `+(a-1)+`; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(`+(a-1)+`));
      }
    `}return p.prototype.getCustomSetupFunc=function(c){var a=this;return function(l,g){a.seedLoc==null&&(a.seedLoc=l.getUniformLocation(g,"seed")),l.gl.uniform1f(a.seedLoc,c)}},p}(),Hh=function(p,c,a,l,g){if(l===void 0&&(l=!1),g===void 0&&(g=!1),this.variableNames=["x"],c==="avg"&&a)throw new Error("Cannot compute positions for average pool.");var _=p.filterWidth,j=p.strideHeight,V=p.strideWidth,ne=p.dilationHeight,oe=p.dilationWidth,me=p.effectiveFilterHeight,Ee=p.effectiveFilterWidth,_e=p.padInfo.top,Ne=p.padInfo.left;this.outputShape=p.outShape;var Ue=c==="avg",$e="((batch  * "+p.inHeight+" + xR) * "+p.inWidth+" + xC) * "+p.inChannels+" + d",He="(xR * "+p.inWidth+" + xC) * "+p.inChannels+" + d",et="0.0";if(Ue||(et="-1.0 / 1e-20"),a)this.userCode=`
        const ivec2 strides = ivec2(`+j+", "+V+`);
        const ivec2 pads = ivec2(`+_e+", "+Ne+`);

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < `+me+`;
              wR += `+ne+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+p.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+Ee+`;
                wC += `+oe+`) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= `+p.inWidth+`) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value >= currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = `+(l?g?$e:He:"wR * "+Ee+" + wC")+`;
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var lt=c+"("+c+"("+c+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";c==="avg"&&(lt="avgValue / count");var ht=4*Math.floor(_/4),gt=_%4,Ct=`
      if (`+Ue+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(`+j+", "+V+`);
      const ivec2 pads = ivec2(`+_e+", "+Ne+`);
      const float initializationValue = `+et+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= `+p.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+et+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < `+me+`;
            wR += `+ne+`) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= `+p.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+ht+`; wC += 4) {
            int xC = xCCorner + wC * `+oe+`;

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+oe+`, d),
              getValue(batch, xR, xC + 2 * `+oe+`, d),
              getValue(batch, xR, xC + 3 * `+oe+`, d)
            );

            `+Ct+`
          }

          int xC = xCCorner + `+ht+`;
          if (`+(gt===1)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            `+Ct+`
          } else if (`+(gt===2)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+oe+`, d),
              initializationValue,
              initializationValue
            );

            `+Ct+`
          } else if (`+(gt===3)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+oe+`, d),
              getValue(batch, xR, xC + 2 * `+oe+`, d),
              initializationValue
            );

            `+Ct+`
          }
        }
        setOutput(`+lt+`);
      }
    `}},Qd=function(p,c,a,l,g){if(l===void 0&&(l=!1),g===void 0&&(g=!1),this.variableNames=["x"],c==="avg"&&a)throw new Error("Cannot compute positions for average pool.");var _=p.filterWidth,j=p.strideDepth,V=p.strideHeight,ne=p.strideWidth,oe=p.dilationDepth,me=p.dilationHeight,Ee=p.dilationWidth,_e=p.effectiveFilterDepth,Ne=p.effectiveFilterHeight,Ue=p.effectiveFilterWidth,$e=p.padInfo.front,He=p.padInfo.top,et=p.padInfo.left;this.outputShape=p.outShape;var lt=c==="avg",ht="0.0";if(lt||(ht="-1.0 / 1e-20"),a)this.userCode=`
        const ivec3 strides =
            ivec3(`+j+", "+V+", "+ne+`);
        const ivec3 pads = ivec3(`+$e+", "+He+", "+et+`);

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < `+_e+`;
              wD += `+oe+`) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= `+p.inDepth+`) {
              continue;
            }

            for (int wR = 0; wR < `+Ne+`;
                wR += `+me+`) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= `+p.inHeight+`) {
                continue;
              }

              for (int wC = 0; wC < `+Ue+`;
                  wC += `+Ee+`) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= `+p.inWidth+`) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value >= currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = `+(l?g?"(((batch * "+p.inDepth+" + xD) * "+p.inHeight+" + xR) * "+p.inWidth+" + xC) * "+p.inChannels+" + ch":"((xD * "+p.inHeight+" + xR) * "+p.inWidth+" + xC) * "+p.inChannels+" + ch":"wD * "+Ne+" * "+Ue+` +
                      wR * `+Ue+" + wC")+`;
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var gt=c+"("+c+"("+c+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";c==="avg"&&(gt="avgValue / count");var Ct=4*Math.floor(_/4),Wt=_%4,Kt=`
      if (`+lt+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(`+j+", "+V+", "+ne+`);
      const ivec3 pads = ivec3(`+$e+", "+He+", "+et+`);
      const float initializationValue = `+ht+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= `+p.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+ht+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < `+_e+`;
            wD += `+oe+`) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= `+p.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+Ne+`;
            wR += `+me+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+p.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+Ct+`; wC += 4) {
              int xC = xCCorner + wC * `+Ee+`;

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+Ee+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+Ee+`, ch),
                getValue(batch, xD, xR, xC + 3 * `+Ee+`, ch)
              );

              `+Kt+`
            }

            int xC = xCCorner + `+Ct+`;
            if (`+(Wt===1)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              `+Kt+`
            } else if (`+(Wt===2)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+Ee+`, ch),
                initializationValue,
                initializationValue
              );

              `+Kt+`
            } else if (`+(Wt===3)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+Ee+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+Ee+`, ch),
                initializationValue
              );

              `+Kt+`
            }
          }
          setOutput(`+gt+`);
        }
      }
    `}},Nv=function(p,c,a,l,g,_,j){this.variableNames=["updates","indices","defaultValue"],this.outputShape=_;var V=Ia(g.length),ne=Ia(_.length),oe="";a===1?oe="i":a===2&&(oe="i, j");var me="getIndices("+oe+")",Ee="";l===1?Ee="i":l===2&&(Ee="i, coords[1]");var _e="getUpdates("+Ee+")",Ne=c>1?"strides[j]":"strides";this.userCode=`
        `+V+" strides = "+V+"("+g+`);

        void main() {
          `+ne+` coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < `+p+`; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < `+c+`; j++) {
              int index = round(`+me+`);
              flattenedIndex += index * `+Ne+`;
            }
            if (flattenedIndex == coords[0]) {
              sum += `+_e+`;
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `},Zd=function(){function p(c){this.variableNames=["source"],this.outputShape=c,this.rank=c.length;var a,l=Ia(this.rank),g="uniform int start["+this.rank+"];",_=function(j){if(j===1)return"sourceLoc";if(j<=6)return Tc.slice(0,j).map(function(V){return"sourceLoc."+V}).join(",");throw Error("Slicing for rank "+j+" is not yet supported")}(this.rank);a=`
        `+l+` sourceLoc;
        `+l+` coords = getOutputCoords();
        `+c.map(function(j,V){return"sourceLoc."+Tc[V]+" = start["+V+"] + coords."+Tc[V]+";"}).join(`
`)+`
      `,this.userCode=`
      `+g+`
      void main() {
        `+a+`
        setOutput(getSource(`+_+`));
      }
    `}return p.prototype.getCustomSetupFunc=function(c){var a=this;if(c.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+c.length+")");return function(l,g){a.startLoc==null&&(a.startLoc=l.getUniformLocationNoThrow(g,"start"),a.startLoc==null)||l.gl.uniform1iv(a.startLoc,c)}},p}(),Tc=["x","y","z","w","u","v"],ep=function(){function p(c){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=c,this.rank=c.length;var a=Ia(this.rank),l=fo("coords",this.rank),g=fo("sourceLoc",this.rank),_=this.rank===1?"sourceLoc":"vec2("+g.slice(-2).join()+")",j="getChannel(getSource("+g.join()+"), "+_+")",V=`
      result.x = `+j+`;
      if (++`+l[this.rank-1]+" < "+c[this.rank-1]+`) {
        ++`+g[this.rank-1]+`;
        result.y = `+j+`;
        --`+g[this.rank-1]+`;
      }
    `,ne=this.rank===1?"":`
      --`+l[this.rank-1]+`;
      if (++`+l[this.rank-2]+" < "+c[this.rank-2]+`) {
        ++`+g[this.rank-2]+`;
        result.z = `+j+`;
        if (++`+l[this.rank-1]+" < "+c[this.rank-1]+`) {
          ++`+g[this.rank-1]+`;
          result.w = `+j+`;
        }
      }
    `,oe=this.rank<=4?`sourceLoc = coords +
            `+a+"("+c.map(function(me,Ee){return"start["+Ee+"]"}).join()+");":c.map(function(me,Ee){return g[Ee]+" = "+l[Ee]+" + start["+Ee+"];"}).join(`
`);this.userCode=`
      uniform int start[`+this.rank+`];
      void main() {
        `+a+` coords = getOutputCoords();
        `+a+` sourceLoc;
        `+oe+`
        vec4 result = vec4(0.);
        `+V+`
        `+ne+`
        setOutput(result);
      }
    `}return p.prototype.getCustomSetupFunc=function(c){var a=this;if(c.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+c.length+")");return function(l,g){a.startLoc==null&&(a.startLoc=l.getUniformLocationNoThrow(g,"start"),a.startLoc==null)||l.gl.uniform1iv(a.startLoc,c)}},p}(),Cg=function(){function p(c){this.gpgpu=c,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return p.prototype.acquireTexture=function(c,a,l){var g,_=Og(a,l),j=Fm(c,_,l);if(j in this.freeTextures||(this.freeTextures[j]=[]),j in this.usedTextures||(this.usedTextures[j]=[]),this.freeTextures[j].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var V=this.freeTextures[j].shift();return this.usedTextures[j].push(V),V}return this.numUsedTextures++,this.log(),_===zr.PACKED_2X2_FLOAT32?g=this.gpgpu.createPackedMatrixTexture(c[0],c[1]):_===zr.PACKED_2X2_FLOAT16?g=this.gpgpu.createFloat16PackedMatrixTexture(c[0],c[1]):_===zr.UNPACKED_FLOAT32?g=this.gpgpu.createFloat32MatrixTexture(c[0],c[1]):_===zr.UNPACKED_FLOAT16?g=this.gpgpu.createFloat16MatrixTexture(c[0],c[1]):_===zr.PACKED_4X1_UNSIGNED_BYTE&&(g=this.gpgpu.createUnsignedBytesMatrixTexture(c[0],c[1])),this.usedTextures[j].push(g),g},p.prototype.releaseTexture=function(c,a,l,g){if(this.freeTextures!=null){var _=Fm(a,Og(l,g),g);_ in this.freeTextures||(this.freeTextures[_]=[]),this.freeTextures[_].push(c),this.numFreeTextures++,this.numUsedTextures--;var j=this.usedTextures[_],V=j.indexOf(c);if(V<0)throw new Error("Cannot release a texture that was never provided by this texture manager");j.splice(V,1),this.log()}},p.prototype.log=function(){if(this.logEnabled){var c=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+c+")")}},p.prototype.getNumUsedTextures=function(){return this.numUsedTextures},p.prototype.getNumFreeTextures=function(){return this.numFreeTextures},p.prototype.dispose=function(){var c=this;if(this.freeTextures!=null){for(var a in this.freeTextures)this.freeTextures[a].forEach(function(l){c.gpgpu.deleteMatrixTexture(l)});for(var a in this.usedTextures)this.usedTextures[a].forEach(function(g){c.gpgpu.deleteMatrixTexture(g)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},p}();function Og(p,c){if(p===ir.UPLOAD)return zr.PACKED_2X2_FLOAT32;if(p===ir.RENDER||p==null)return function(a){return L().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?a?zr.PACKED_2X2_FLOAT32:zr.UNPACKED_FLOAT32:a?zr.PACKED_2X2_FLOAT16:zr.UNPACKED_FLOAT16}(c);if(p===ir.DOWNLOAD||p===ir.PIXELS)return zr.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+p)}function Fm(p,c,a){return p[0]+"_"+p[1]+"_"+c+"_"+a}var b0=1.7580993408473768,x0=1.0507009873554805,sa=function(p,c){this.variableNames=["A"],this.outputShape=p,this.userCode=`
      float unaryOperation(float x) {
        `+c+`
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `},Ag="if (isnan(x)) return x;",_g="return x;",Bp="return abs(x);",Sg=Ag+`
  return (x < 0.0) ? 0.0 : x;
`,tp=Ag+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,nl="return (x >= 0.0) ? x : (exp(x) - 1.0);",rl="return -x;",Dg="return ceil(x);",Tg="return floor(x);",$h="return exp(x);",Uf="return exp(x) - 1.0;",Gh="return x;",w0="return x;",Pp=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,il=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Su=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,zl=function(p,c){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=p,this.userCode=`
      vec4 unaryOperation(vec4 x) {
        `+c+`
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `},Ul={};function Wl(p,c){if(c===void 0&&(c=!1),p==="linear")return c?w0:_g;if(p==="relu")return c?Pp:Sg;if(p==="elu")return c?Su:nl;if(p==="relu6")return c?il:tp;if(p==="prelu")return c?es:_c;throw new Error("Activation "+p+" has not been implemented for the WebGL backend.")}var Ng=600,Lp=function(p){function c(a){var l,g=p.call(this)||this;if(g.pendingRead=new WeakMap,g.pendingDisposal=new WeakSet,g.dataRefCount=new WeakMap,g.numBytesInGPU=0,g.uploadWaitMs=0,g.downloadWaitMs=0,g.warnedAboutMemory=!1,g.pendingDeletes=0,g.disposed=!1,!L().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(a==null){var _=ui(L().getNumber("WEBGL_VERSION"));g.binaryCache=((l=L().getNumber("WEBGL_VERSION"))in Ul||(Ul[l]={}),Ul[l]),g.gpgpu=new Tm(_),g.canvas=_.canvas,g.gpgpuCreatedLocally=!0}else g.gpgpu=a,g.binaryCache={},g.gpgpuCreatedLocally=!1,g.canvas=a.gl.canvas;return g.textureManager=new Cg(g.gpgpu),g.numMBBeforeWarning=L().global.screen==null?1024:L().global.screen.height*L().global.screen.width*window.devicePixelRatio*Ng/1024/1024,g.texData=new Nt(g,Ve),g}return J(c,p),c.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},c.prototype.write=function(a,l,g){if(L().getBool("DEBUG")&&this.checkNumericalProblems(a),g==="complex64"&&a!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var _={};return this.texData.set(_,{shape:l,dtype:g,values:a,usage:ir.UPLOAD}),_},c.prototype.move=function(a,l,g,_){if(L().getBool("DEBUG")&&this.checkNumericalProblems(l),_==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(a,{shape:g,dtype:_,values:l,usage:ir.UPLOAD})},c.prototype.readSync=function(a){var l=this.texData.get(a),g=l.values,_=l.dtype,j=l.complexTensors,V=l.slice,ne=l.shape,oe=l.isPacked;if(V!=null){var me;me=oe?new zl(ne,Gh):new sa(ne,Gh);var Ee=this.runWebGLProgram(me,[{dataId:a,shape:ne,dtype:_}],_),_e=this.readSync(Ee.dataId);return this.disposeData(Ee.dataId),_e}if(g!=null)return this.convertAndCacheOnCPU(a);if(_==="string")return g;var Ne,Ue,$e=this.activeTimers!=null;return $e&&(Ne=nn()),Ue=_==="complex64"?Zr(j.real.dataSync(),j.imag.dataSync()):this.getValuesFromTexture(a),$e&&(this.downloadWaitMs+=nn()-Ne),this.convertAndCacheOnCPU(a,Ue)},c.prototype.read=function(a){return R(this,void 0,void 0,function(){var l,g,_,j,V,ne,oe,me,Ee,_e,Ne,Ue,$e,He,et,lt,ht,gt,Ct,Wt,Kt,Vt;return P(this,function(Ht){switch(Ht.label){case 0:if(this.pendingRead.has(a))return l=this.pendingRead.get(a),[2,new Promise(function(vn){return l.push(vn)})];if(g=this.texData.get(a),_=g.values,j=g.shape,V=g.slice,ne=g.dtype,oe=g.complexTensors,me=g.isPacked,V!=null)return Ee=void 0,Ee=me?new zl(j,Gh):new sa(j,Gh),_e=this.runWebGLProgram(Ee,[{dataId:a,shape:j,dtype:ne}],ne),Ne=this.read(_e.dataId),this.disposeData(_e.dataId),[2,Ne];if(_!=null)return[2,this.convertAndCacheOnCPU(a)];if(!L().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&L().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return Ue=null,ne!=="complex64"&&L().get("WEBGL_BUFFER_SUPPORTED")&&($e=this.decode(a),He=this.texData.get($e.dataId),Ue=(Vt=this.gpgpu).createBufferFromTexture.apply(Vt,[He.texture].concat(Di(j)))),this.pendingRead.set(a,[]),ne==="complex64"?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:Ht.sent(),Ht.label=2;case 2:return ne!=="complex64"?[3,4]:[4,Promise.all([oe.real.data(),oe.imag.data()])];case 3:return lt=Ht.sent(),ht=lt[0],gt=lt[1],et=Zr(ht,gt),[3,5];case 4:Ue==null?et=this.getValuesFromTexture(a):(Ct=Ye(j),et=this.gpgpu.downloadFloat32MatrixFromBuffer(Ue,Ct)),Ht.label=5;case 5:return $e!=null&&this.disposeData($e.dataId),Wt=this.convertAndCacheOnCPU(a,et),Kt=this.pendingRead.get(a),this.pendingRead.delete(a),Kt.forEach(function(vn){return vn(Wt)}),this.pendingDisposal.has(a)&&(this.pendingDisposal.delete(a),this.disposeData(a),this.pendingDeletes--),[2,Wt]}})})},c.prototype.checkNumericalProblems=function(a){if(a!=null)for(var l=0;l<a.length;l++){var g=a[l];if(!Fr(g))throw L().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value "+g+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"):Error("The value "+g+" cannot be represented on this device.")}},c.prototype.getValuesFromTexture=function(a){var l,g=this.texData.get(a),_=g.shape,j=g.dtype,V=g.isPacked,ne=Ye(_);if(L().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var oe=this.decode(a),me=this.texData.get(oe.dataId),Ee=(l=this.gpgpu).downloadMatrixFromPackedTexture.apply(l,[me.texture].concat(Di(_))).subarray(0,ne);return this.disposeData(oe.dataId),Ee}var _e=L().getBool("WEBGL_PACK")&&V===!0,Ne=_e?nc(_):_,Ue=_e?new function(lt){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=ir.DOWNLOAD;var ht=va();this.outputShape=lt,this.userCode=`
      `+As+`

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        `+ht.output+` = encode_float(x);
      }
    `}(Ne):new function(lt){this.variableNames=["A"],this.outTexUsage=ir.DOWNLOAD;var ht=va();this.outputShape=lt,this.userCode=`
      `+As+`

      void main() {
        float x = getAAtOutCoords();
        `+ht.output+` = encode_float(x);
      }
    `}(Ne),$e=this.runWebGLProgram(Ue,[{shape:Ne,dtype:j,dataId:a}],"float32"),He=this.texData.get($e.dataId),et=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(He.texture,He.texShape[0],He.texShape[1]).subarray(0,ne);return this.disposeData($e.dataId),et},c.prototype.time=function(a){return R(this,void 0,void 0,function(){var l,g,_,j,V,ne,oe;return P(this,function(me){switch(me.label){case 0:return l=this.activeTimers,g=[],_=!1,this.programTimersStack==null?(this.programTimersStack=g,_=!0):this.activeTimers.push(g),this.activeTimers=g,a(),j=Pt(this.activeTimers.map(function(Ee){return Ee.query})).filter(function(Ee){return Ee!=null}),V=Pt(this.activeTimers.map(function(Ee){return Ee.name})).filter(function(Ee){return Ee!=null}),this.activeTimers=l,_&&(this.programTimersStack=null),ne={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},L().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(j)]:[3,2];case 1:return oe=me.sent(),ne.kernelMs=$t(oe),ne.getExtraProfileInfo=function(){return oe.map(function(Ee,_e){return{name:V[_e],ms:Ee}}).map(function(Ee){return Ee.name+": "+Ee.ms}).join(", ")},[3,3];case 2:ne.kernelMs={error:"WebGL query timers are not supported in this environment."},me.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,ne]}})})},c.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},c.prototype.startTimer=function(){return L().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:nn(),endMs:null}},c.prototype.endTimer=function(a){return L().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),a):(a.endMs=nn(),a)},c.prototype.getQueryTime=function(a){return R(this,void 0,void 0,function(){var l;return P(this,function(g){return L().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(a)]:[2,(l=a).endMs-l.startMs]})})},c.prototype.disposeData=function(a){if(!this.pendingDisposal.has(a)){if(this.pendingRead.has(a))return this.pendingDisposal.add(a),void this.pendingDeletes++;if(this.texData.has(a)){this.releaseGPUData(a);var l=this.texData.get(a).complexTensors;l!=null&&(l.real.dispose(),l.imag.dispose()),this.texData.delete(a)}}},c.prototype.releaseGPUData=function(a){var l=this.texData.get(a),g=l.texture,_=l.dtype,j=l.texShape,V=l.usage,ne=l.isPacked,oe=l.slice,me=oe&&oe.origDataId||a,Ee=this.dataRefCount.get(me);Ee>1?this.dataRefCount.set(me,Ee-1):(this.dataRefCount.delete(me),g!=null&&(this.numBytesInGPU-=this.computeBytes(j,_),this.textureManager.releaseTexture(g,j,V,ne)));var _e=this.texData.get(a);_e.texture=null,_e.texShape=null,_e.isPacked=!1,_e.slice=null},c.prototype.getTexture=function(a){return this.uploadToGPU(a),this.texData.get(a).texture},c.prototype.getDataInfo=function(a){return this.texData.get(a)},c.prototype.getCPUBackend=function(){return L().getBool("WEBGL_CPU_FORWARD")?(this.cpuBackend==null&&(this.cpuBackend=Ve.findBackend("cpu")),this.cpuBackend):null},c.prototype.shouldExecuteOnCPU=function(a,l){var g=this;return l===void 0&&(l=128),this.getCPUBackend()!=null&&a.every(function(_){return g.texData.get(_.dataId).texture==null&&Ye(_.shape)<l})},c.prototype.getGPGPUContext=function(){return this.gpgpu},c.prototype.complex=function(a,l){var g=this.makeOutput(a.shape,"complex64");return this.texData.get(g.dataId).complexTensors={real:Ve.keep(a.clone()),imag:Ve.keep(l.clone())},g},c.prototype.real=function(a){return this.texData.get(a.dataId).complexTensors.real.clone()},c.prototype.imag=function(a){return this.texData.get(a.dataId).complexTensors.imag.clone()},c.prototype.slice=function(a,l,g){if(this.shouldExecuteOnCPU([a]))return this.cpuBackend.slice(a,l,g);if(Ye(g)===0)return wa([],g,a.dtype);var _=this.texData.get(a.dataId).isPacked,j=Vh(a.shape,l,g);if(_||!j){var V=L().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new ep(g):new Zd(g),ne=V.getCustomSetupFunc(l);return this.compileAndRun(V,[a],null,ne)}return this.uploadToGPU(a.dataId),this.shallowSlice(a,l,g)},c.prototype.shallowSlice=function(a,l,g){var _=this.texData.get(a.dataId),j=this.makeOutput(g,a.dtype),V=this.texData.get(j.dataId);Object.assign(V,_),V.shape=g,V.dtype=a.dtype;var ne=Mf(l,a.strides);_.slice&&(ne+=_.slice.flatOffset),V.slice={flatOffset:ne,origDataId:_.slice&&_.slice.origDataId||a.dataId};var oe=this.dataRefCount.get(V.slice.origDataId)||1;return this.dataRefCount.set(V.slice.origDataId,oe+1),j},c.prototype.stridedSlice=function(a,l,g,_){if(this.shouldExecuteOnCPU([a]))return this.cpuBackend.stridedSlice(a,l,g,_);var j=Ou(l,g,_);if(j.some(function(ne){return ne===0}))return wa([],j);var V=new function(ne,oe,me){this.variableNames=["x"],this.outputShape=me;var Ee=me.length,_e=Ia(me.length),Ne=Ia(me.length),Ue="";if(Ee===1)Ue="coords * strides + begin";else{var $e=0;Ue=me.map(function(He,et){return $e++,me.length===1?"coords * strides["+et+"] + begin["+et+"]":"coords["+($e-1)+"] * strides["+et+"] + begin["+et+"]"}).join(",")}this.userCode=`
      `+_e+" begin = "+_e+"("+ne+`);
      `+_e+" strides = "+_e+"("+oe+`);

      void main() {
        `+Ne+` coords = getOutputCoords();
        setOutput(getX(`+Ue+`));
      }
    `}(l,_,j);return this.compileAndRun(V,[a])},c.prototype.reverse=function(a,l){var g=L().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new function(_,j){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var V=_.length;if(V>4)throw new Error("WebGL backend: Reverse of rank-"+V+" tensor is not yet supported");this.outputShape=_;var ne=fo("rc",V),oe=ne[V-1]+" + 1 < "+this.outputShape[V-1],me=ne[V-2]+" + 1 < "+this.outputShape[V-2],Ee=Ia(V);function _e(Ne){var Ue=_.map(function($e,He){return function(et,lt){return j.indexOf(et)!==-1&&_[et]!==1?_[et]+" - "+lt[et]+" - 1":""+lt[et]}(He,Ne)});return"getChannel(getX("+Ue.join(",")+"), vec2("+Ue.slice(-2).join(",")+"))"}this.userCode=V===1?`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(`+_[0]+` - rc - 1),
            `+_[0]+` - rc - 1);
          if(`+oe+`){
              result.g = getChannel(getX(`+_[0]+` - (rc  + 1) - 1),
                `+_[0]+` - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:`
        void main() {
          `+Ee+` rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = `+_e(ne.slice())+`;
          if(`+oe+`){
            result.g = `+function(Ne){return Ne[V-1]="("+Ne[V-1]+" + 1)",_e(Ne)}(ne.slice())+`;
          }
          if(`+me+`) {
            result.b = `+function(Ne){return Ne[V-2]="("+Ne[V-2]+" + 1)",_e(Ne)}(ne.slice())+`;
            if(`+oe+`) {
              result.a = `+function(Ne){return Ne[V-1]="("+Ne[V-1]+" + 1)",Ne[V-2]="("+Ne[V-2]+" + 1)",_e(Ne)}(ne.slice())+`;
            }
          }
          setOutput(result);
        }
    `}(a.shape,l):new function(_,j){this.variableNames=["x"];var V=_.length;if(V>4)throw new Error("WebGL backend: Reverse of rank-"+V+" tensor is not yet supported");if(this.outputShape=_,V!==1){var ne=_.map(function(me,Ee){return function(_e){return j.indexOf(_e)!==-1&&_[_e]!==1?_[_e]+" - coords["+_e+"] - 1":"coords["+_e+"]"}(Ee)}).join(","),oe=Ia(V);this.userCode=`
      void main() {
        `+oe+` coords = getOutputCoords();
        setOutput(getX(`+ne+`));
      }
    `}else this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(`+_[0]+` - coord - 1));
        }
      `}(a.shape,l);return this.compileAndRun(g,[a])},c.prototype.concat=function(a,l){if(a[0].dtype==="complex64"){var g=a.map(function(Ne){return uo(Ne)}),_=a.map(function(Ne){return Uo(Ne)});return fa(this.concat(g,l),this.concat(_,l))}if(this.shouldExecuteOnCPU(a))return this.cpuBackend.concat(a,l);if(a.length===1)return a[0];if(a.length>L().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var j=Math.floor(a.length/2),V=this.concat(a.slice(0,j),l),ne=this.concat(a.slice(j),l);return this.concat([V,ne],l)}if(L().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&a[0].rank>1){var oe=new function(Ne,Ue){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Zs(Ne,Ue);var $e=this.outputShape,He=$e.length,et=Ia(He),lt=fo("coords",He),ht=["x","y","z","w","u","v"].slice(0,He);this.variableNames=Ne.map(function(Kn,er){return"T"+er});var gt=new Array(Ne.length-1);gt[0]=Ne[0][Ue];for(var Ct=1;Ct<gt.length;Ct++)gt[Ct]=gt[Ct-1]+Ne[Ct][Ue];var Wt=ht[Ue],Kt=ht.slice(-2),Vt=ht.join(),Ht="if ("+Wt+" < "+gt[0]+`) {
        return getChannel(
            getT0(`+Vt+"), vec2("+Kt.join()+`));
        }`;for(Ct=1;Ct<gt.length;Ct++){var vn=gt[Ct-1];Ht+=`
        if (`+Wt+" < "+gt[Ct]+"  && "+Wt+" >= "+gt[Ct-1]+`) {
          return getChannel(
            getT`+Ct+"("+ci(ht,Wt,vn)+`),
            vec2(`+ci(Kt,Wt,vn)+`));
        }`}var On=gt.length,Cn=gt[gt.length-1];Ht+=`
        return getChannel(
          getT`+On+"("+ci(ht,Wt,Cn)+`),
          vec2(`+ci(Kt,Wt,Cn)+"));",this.userCode=`
      float getValue(`+ht.map(function(Kn){return"int "+Kn})+`) {
        `+Ht+`
      }

      void main() {
        `+et+` coords = getOutputCoords();
        vec4 result = vec4(getValue(`+lt+`), 0., 0., 0.);

        `+lt[He-1]+" = "+lt[He-1]+` + 1;
        if (`+lt[He-1]+" < "+$e[He-1]+`) {
          result.g = getValue(`+lt+`);
        }

        `+lt[He-2]+" = "+lt[He-2]+` + 1;
        if (`+lt[He-2]+" < "+$e[He-2]+`) {
          result.a = getValue(`+lt+`);
        }

        `+lt[He-1]+" = "+lt[He-1]+` - 1;
        if (`+lt[He-2]+" < "+$e[He-2]+` &&
            `+lt[He-1]+" < "+$e[He-1]+`) {
          result.b = getValue(`+lt+`);
        }
        setOutput(result);
      }
    `}(a.map(function(Ne){return Ne.shape}),l);return this.compileAndRun(oe,a)}var me=Zs(a.map(function(Ne){return Ne.shape}),l),Ee=a.map(function(Ne){return Ne.as2D(-1,Ye(Ne.shape.slice(l)))}),_e=new function(Ne){this.outputShape=[],this.outputShape=Zs(Ne,1),this.variableNames=Ne.map(function(gt,Ct){return"T"+Ct});var Ue=new Array(Ne.length-1);Ue[0]=Ne[0][1];for(var $e=1;$e<Ue.length;$e++)Ue[$e]=Ue[$e-1]+Ne[$e][1];var He=["if (yC < "+Ue[0]+") setOutput(getT0(yR, yC));"];for($e=1;$e<Ue.length;$e++){var et=Ue[$e-1];He.push("else if (yC < "+Ue[$e]+") setOutput(getT"+$e+"(yR, yC-"+et+"));")}var lt=Ue.length,ht=Ue[Ue.length-1];He.push("else setOutput(getT"+lt+"(yR, yC-"+ht+"));"),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        `+He.join(`
        `)+`
      }
    `}(Ee.map(function(Ne){return Ne.shape}));return this.compileAndRun(_e,Ee).reshape(me)},c.prototype.neg=function(a){if(this.shouldExecuteOnCPU([a]))return this.cpuBackend.neg(a);if(L().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(a,rl,a.dtype);var l=new sa(a.shape,rl);return this.compileAndRun(l,[a])},c.prototype.batchMatMul=function(a,l,g,_){var j=g?a.shape[2]:a.shape[1],V=_?l.shape[1]:l.shape[2],ne=g?a.shape[1]:a.shape[2],oe=a.shape[0];if((j===1||V===1)&&ne>1e3){g&&(a=ft(a,[0,2,1])),_&&(l=ft(l,[0,2,1]));var me=V===1?a:a.as3D(oe,ne,1),Ee=V===1?2:1,_e=V===1?l.as3D(oe,1,ne):l;return this.multiply(me,_e).sum(Ee,!0)}var Ne=cn(a.dtype,l.dtype),Ue=new _u(a.shape,[oe,j,V],g,_);return this.compileAndRun(Ue,[a,l],Ne)},c.prototype.fusedBatchMatMul=function(a){var l=a.a,g=a.b,_=a.transposeA,j=a.transposeB,V=a.bias,ne=a.activation,oe=a.preluActivationWeights,me=_?l.shape[2]:l.shape[1],Ee=j?g.shape[1]:g.shape[2],_e=l.shape[0],Ne=cn(l.dtype,g.dtype),Ue=V!=null,$e=oe!=null,He=ne?Wl(ne,!0):null,et=new _u(l.shape,[_e,me,Ee],_,j,Ue,He,$e),lt=[l,g];return V&&lt.push(V),oe&&lt.push(oe),this.compileAndRun(et,lt,Ne)},c.prototype.multiply=function(a,l){if(a.dtype==="complex64"){var g=this.texData.get(a.dataId),_=this.texData.get(l.dataId),j=new ia("return areal * breal - aimag * bimag;",a.shape,l.shape),V=new ia("return areal * bimag + aimag * breal;",a.shape,l.shape),ne=[this.makeComplexComponentTensorInfo(a,g.complexTensors.real),this.makeComplexComponentTensorInfo(a,g.complexTensors.imag),this.makeComplexComponentTensorInfo(l,_.complexTensors.real),this.makeComplexComponentTensorInfo(l,_.complexTensors.imag)],oe=this.compileAndRun(j,ne),me=this.compileAndRun(V,ne),Ee=this.complex(oe,me);return oe.dispose(),me.dispose(),Ee}if(this.shouldExecuteOnCPU([a,l]))return this.cpuBackend.multiply(a,l);if(L().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(a,l,Gs,a.dtype);var _e=new za(Gs,a.shape,l.shape);return this.compileAndRun(_e,[a,l],a.dtype)},c.prototype.batchNormalization=function(a,l,g,_,j,V){var ne=[a,l,g],oe=null;V!=null&&(oe=V.shape,ne.push(V));var me=null;if(j!=null&&(me=j.shape,ne.push(j)),L().getBool("WEBGL_PACK_NORMALIZATION")){var Ee=new function(Ne,Ue,$e,He,et,lt){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Mi(Ne,Ue),Mi(Ne,$e);var ht="vec4(0.0)";He!=null&&(Mi(Ne,He),this.variableNames.push("offset"),ht="getOffsetAtOutCoords()");var gt="vec4(1.0)";et!=null&&(Mi(Ne,et),this.variableNames.push("scale"),gt="getScaleAtOutCoords()"),this.outputShape=Ne,this.userCode=`
      void main() {
        vec4 offset = `+ht+`;
        vec4 scale = `+gt+`;

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(`+lt+`));

        setOutput((x - mean) * inv + offset);
      }
    `}(a.shape,l.shape,g.shape,oe,me,_);return this.compileAndRun(Ee,ne)}var _e=new function(Ne,Ue,$e,He,et,lt){this.outputShape=[],this.variableNames=["x","mean","variance"],Mi(Ne,Ue),Mi(Ne,$e);var ht="0.0";He!=null&&(Mi(Ne,He),this.variableNames.push("offset"),ht="getOffsetAtOutCoords()");var gt="1.0";et!=null&&(Mi(Ne,et),this.variableNames.push("scale"),gt="getScaleAtOutCoords()"),this.outputShape=Ne,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = `+ht+`;
        float scale = `+gt+`;
        float inv = scale * inversesqrt(variance + float(`+lt+`));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}(a.shape,l.shape,g.shape,oe,me,_);return this.compileAndRun(_e,ne)},c.prototype.localResponseNormalization4D=function(a,l,g,_,j){var V=L().getBool("WEBGL_PACK_NORMALIZATION")?new function(ne,oe,me,Ee,_e){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var Ne,Ue=oe,$e=ne[3]-1;this.outputShape=ne;var He="float("+me+") + float("+Ee+") * sum";Ne=_e===.5?"inversesqrt("+He+")":_e===1?"1.0/("+He+")":"exp(log("+He+") * float(-"+_e+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < `+this.outputShape[3]+`;
        bool hasNextRow = c < `+this.outputShape[2]+`;

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - `+Ue+`;
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - `+Ue+"; j <= "+Ue+`; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(`+$e+`));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * `+Ne+`;
        setOutput(result);
      }
    `}(a.shape,l,g,_,j):new function(ne,oe,me,Ee,_e){this.variableNames=["x"],this.outputShape=[];var Ne,Ue=oe,$e=ne[3]-1;this.outputShape=ne;var He="float("+me+") + float("+Ee+") * sum";Ne=_e===.5?"inversesqrt("+He+")":_e===1?"1.0/("+He+")":"exp(log("+He+") * float(-"+_e+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -`+Ue+"; j <= "+Ue+`; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  `+$e+`) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * `+Ne+`;
        setOutput(val);
      }
    `}(a.shape,l,g,_,j);return this.compileAndRun(V,[a])},c.prototype.LRNGrad=function(a,l,g,_,j,V,ne){var oe=new function(me,Ee,_e,Ne,Ue){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=me,this.depth=me[3],this.depthRadius=Ee,this.bias=_e,this.alpha=Ne,this.beta=Ue,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < `+this.depth+`; ++d) {
          int depthBegin = int(max(0.0, float(d - `+Ee+`)));
          int depthEnd = int(min(float(`+this.depth+`),
              float(d + `+Ee+` + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = `+this.depth+`;

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(`+Ne+") * norm + float("+_e+`);

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(`+Ne+`)
                * float(`+Ue+`)
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * `+Ue+`);
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}(l.shape,_,j,V,ne);return this.compileAndRun(oe,[l,g,a])},c.prototype.tile=function(a,l){if(a.dtype==="string"){var g=this.readSync(a.dataId).map(function(j){return mr(j)});return Wo(bi(a.shape,a.dtype,g),l)}var _=new function(j,V){this.variableNames=["A"];for(var ne=new Array(j.length),oe=0;oe<ne.length;oe++)ne[oe]=j[oe]*V[oe];this.outputShape=ne,this.rank=ne.length;var me=Ia(this.rank),Ee=function(_e){var Ne=_e.length;if(Ne>5)throw Error("Tile for rank "+Ne+" is not yet supported");if(Ne===1)return"imod(resRC, "+_e[0]+")";for(var Ue=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],$e=[],He=0;He<_e.length;He++)$e.push("imod("+Ue[He]+", "+_e[He]+")");return $e.join()}(j);this.userCode=`
      void main() {
        `+me+` resRC = getOutputCoords();
        setOutput(getA(`+Ee+`));
      }
    `}(a.shape,l);return this.compileAndRun(_,[a])},c.prototype.pad=function(a,l,g){var _=L().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new function(j,V,ne){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=V.map(function(Wt,Kt){return Wt[0]+j[Kt]+Wt[1]});for(var oe=j.length,me=Ia(oe),Ee=V.map(function(Wt){return Wt[0]}).join(","),_e=V.map(function(Wt,Kt){return Wt[0]+j[Kt]}).join(","),Ne=fo("rc",oe),Ue=fo("source",oe),$e=Ne[oe-1]+" < "+this.outputShape[oe-1],He=oe===1?"source":"vec2("+Ue.slice(-2).join()+")",et=[me+" rc = outputLoc;",Ne[oe-1]+` += 1;
       if(`+$e+`) {
      `,oe===1?"":`}
       rc = outputLoc;
       `+Ne[oe-2]+` += 1;
       if(`+Ne[oe-2]+" < "+this.outputShape[oe-2]+") {",oe===1?"":"  "+Ne[oe-1]+` += 1;
         if(`+$e+") {"],lt=oe===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",ht="",gt=0,Ct=oe===1?2:4;gt<Ct;gt++)ht+=`
        `+et[gt]+`
        if (`+lt+`) {
          result[`+gt+"] = float("+ne+`);
        } else {
          `+me+` source = rc - start;
          result[`+gt+"] = getChannel(getX("+Ue.join()+"), "+He+`);
        }
      `;ht+=oe===1?"} ":"}}",this.userCode=`
      const `+me+" start = "+me+"("+Ee+`);
      const `+me+" end = "+me+"("+_e+`);

      void main() {
        `+me+` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `+ht+`
        setOutput(result);
      }
    `}(a.shape,l,g):new function(j,V,ne){this.variableNames=["x"],this.outputShape=V.map(function(Ue,$e){return Ue[0]+j[$e]+Ue[1]});var oe=j.length,me=Ia(oe),Ee=V.map(function(Ue){return Ue[0]}).join(","),_e=V.map(function(Ue,$e){return Ue[0]+j[$e]}).join(","),Ne=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,oe);this.userCode=oe!==1?`
      `+me+" start = "+me+"("+Ee+`);
      `+me+" end = "+me+"("+_e+`);

      void main() {
        `+me+` outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(float(`+ne+`));
        } else {
          `+me+` coords = outC - start;
          setOutput(getX(`+Ne+`));
        }
      }
    `:`
        int start = `+Ee+`;
        int end = `+_e+`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(float(`+ne+`));
          } else {
            setOutput(getX(outC - start));
          }
        }
      `}(a.shape,l,g);return this.compileAndRun(_,[a])},c.prototype.gather=function(a,l,g){if(this.shouldExecuteOnCPU([a,l]))return this.cpuBackend.gather(a,l,g);var _=new function(j,V,ne){this.variableNames=["A","indices"];var oe=j.slice();oe[ne]=V,this.outputShape=oe,this.rank=oe.length;var me=Ia(this.rank),Ee=function(_e,Ne){var Ue=_e.length;if(Ue>4)throw Error("Gather for rank "+Ue+" is not yet supported");if(Ue===1)return"int(getIndices(resRC))";for(var $e=["resRC.x","resRC.y","resRC.z","resRC.w"],He=[],et=0;et<_e.length;et++)et===Ne?He.push("int(getIndices("+$e[et]+"))"):He.push(""+$e[et]);return He.join()}(j,ne);this.userCode=`
      void main() {
        `+me+` resRC = getOutputCoords();
        setOutput(getA(`+Ee+`));
      }
    `}(a.shape,l.size,g);return this.compileAndRun(_,[a,l])},c.prototype.batchToSpaceND=function(a,l,g){we(a.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var _=l.reduce(function(Ee,_e){return Ee*_e}),j=_f(a.shape,l,_),V=Gc(j.length,l.length),ne=_l(a.shape,l,_),oe=Wd(g,l.length),me=Mp(ne,g,l.length);return ft(a.reshape(j),V).reshape(ne).slice(oe,me)},c.prototype.spaceToBatchND=function(a,l,g){we(a.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var _=l.reduce(function(_e,Ne){return _e*Ne}),j=[[0,0]];j.push.apply(j,g);for(var V=1+l.length;V<a.shape.length;++V)j.push([0,0]);var ne=a.pad(j),oe=_f(ne.shape,l,_,!1),me=Gc(oe.length,l.length,!1),Ee=_l(ne.shape,l,_,!1);return ft(ne.reshape(oe),me).reshape(Ee)},c.prototype.reduce=function(a,l,g){var _=a.shape[0],j=a.shape[1],V=new function(oe,me){this.variableNames=["x"];var Ee=oe.windowSize,_e=oe.batchSize,Ne=oe.inSize,Ue=Math.ceil(Ne/Ee);this.outputShape=[_e,Ue];var $e="0.0",He="";me==="prod"?$e="1.0":me==="min"?($e="1.0 / 1e-20",He="min"):me==="max"&&($e="-1.0 / 1e-20",He="max");var et=me+"("+me+"("+me+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";me==="sum"?et="sumValue":me==="prod"?et="prodValue":me==="all"?et="allValue":me==="any"&&(et="anyValue");var lt=4*Math.floor(Ee/4),ht=Ee%4,gt=`
      if (`+(me==="sum")+`) {
        sumValue += dot(values, ones);
      } else if (`+(me==="prod")+`) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = `+He+`(values, minMaxValue);
      }
    `,Ct="vec4";me==="all"?($e="1.0",gt=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,Ct="bvec4"):me==="any"&&($e="0.0",gt=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,Ct="bvec4");var Wt="";Ne%Ee>0&&(Wt=`
        if (inIdx < 0 || inIdx >= `+Ne+`) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = `+$e+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `+Wt+`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+Ee+`;

        vec4 minMaxValue = vec4(`+$e+`);
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < `+lt+`; i += 4) {
          int inIdx = inOffset + i;
          `+Ct+" values = "+Ct+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `+gt+`
        }

        int inIdx = inOffset + `+lt+`;
        if (`+(ht===1)+`) {
          `+Ct+" values = "+Ct+`(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          `+gt+`
        } else if (`+(ht===2)+`) {
          `+Ct+" values = "+Ct+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          `+gt+`
        } else if (`+(ht===3)+`) {
          `+Ct+" values = "+Ct+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          `+gt+`
        }
        setOutput(`+et+`);
      }
    `}({windowSize:uc(j),inSize:j,batchSize:_},l),ne=this.compileAndRun(V,[a],g);return ne.shape[1]===1?ne:this.reduce(ne,l,g)},c.prototype.argReduce=function(a,l,g){g===void 0&&(g=null);var _=a.shape[0],j=a.shape[1];g!=null&&(_=g.shape[0],j=g.shape[1]);var V=new function(me,Ee,_e){this.variableNames=["A"];var Ne=me.windowSize,Ue=me.batchSize,$e=me.inSize,He=Math.ceil($e/Ne);_e||this.variableNames.push("bestIndicesA"),this.outputShape=[Ue,He];var et=Ee==="max"?">":"<",lt=_e?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+Ne+`;

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < `+Ne+`; i++) {
          int inIdx = `+lt+`;
          float candidate = getA(batch, inIdx);
          if (candidate `+et+` bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}({windowSize:uc(j),inSize:j,batchSize:_},l,g==null),ne=[a];g!=null&&ne.push(g);var oe=this.compileAndRun(V,ne,"int32");return oe.shape[1]===1?oe:this.argReduce(a,l,oe)},c.prototype.argReducePacked=function(a,l,g){g===void 0&&(g=null);var _=g!=null?g.shape:a.shape,j=new function(oe,me,Ee,_e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,we(oe.length>2,function(){return"Packed arg"+(Ee.charAt(0).toUpperCase()+Ee.slice(1))+" supports only inputs with rank above 2."});var Ne=oe[oe.length-1],Ue=Math.ceil(Ne/me);this.outputShape=oe.slice(0,-1),Ue>1&&this.outputShape.push(Ue),_e||this.variableNames.push("bestIndicesA");var $e,He,et=this.outputShape,lt=et.length,ht=Ia(lt),gt=fo("coords",lt);if(Ue===1){var Ct=Ia(He=lt+1);$e=`
        `+Ct+" sourceLocR = "+Ct+"("+gt.join()+`, 0);
        ++`+gt[lt-1]+`;
        `+Ct+" sourceLocG = "+Ct+"("+gt.join()+`, 0);
        ++`+gt[lt-2]+`;
        `+Ct+" sourceLocA = "+Ct+"("+gt.join()+`, 0);
        --`+gt[lt-1]+`;
        `+Ct+" sourceLocB = "+Ct+"("+gt.join()+`, 0);
        --`+gt[lt-2]+";"}else He=lt,$e=`
        `+ht+` sourceLocR = coords;
        ++`+gt[lt-1]+`;
        `+ht+` sourceLocG = coords;
        ++`+gt[lt-2]+`;
        `+ht+` sourceLocA = coords;
        --`+gt[lt-1]+`;
        `+ht+` sourceLocB = coords;
        --`+gt[lt-2]+";";var Wt=["x","y","z","w","u","v"].slice(0,He),Kt="."+Wt[He-1],Vt=Wt.map(function(ur){return"int "+ur}),Ht=fo("sourceLocR",He-1).concat("inIdx.r"),vn=fo("sourceLocG",He-1).concat("inIdx.g"),On=fo("sourceLocB",He-1).concat("inIdx.b"),Cn=fo("sourceLocA",He-1).concat("inIdx.a"),Kn=Ee==="max"?"greaterThan":"lessThan",er=_e?"":`
          inIdx = round(vec4(getBestIndicesAChannel(`+Ht.join()+`),
                             getBestIndicesAChannel(`+vn.join()+`),
                             getBestIndicesAChannel(`+On.join()+`),
                             getBestIndicesAChannel(`+Cn.join()+")));",sr=`vec4(
            getAChannel(`+Ht.join()+`),
            hasNextCol ? getAChannel(`+vn.join()+`) : 0.,
            hasNextRow ? getAChannel(`+On.join()+`) : 0.,
            hasNextRow && hasNextCol ? getAChannel(`+Cn.join()+") : 0.)",lr=_e?"":`
      float getBestIndicesAChannel(`+Vt.join()+`) {
        return getChannel(getBestIndicesA(`+Wt.join()+`),
                                          vec2(`+Wt.slice(-2).join()+`));
      }`;this.userCode=`
      float getAChannel(`+Vt.join()+`) {
        return getChannel(getA(`+Wt.join()+`),
                               vec2(`+Wt.slice(-2).join()+`));
      }
      `+lr+`
      void main() {
        `+ht+` coords = getOutputCoords();
        bool hasNextCol = `+gt[lt-1]+" < "+(et[lt-1]-1)+`;
        bool hasNextRow = `+gt[lt-2]+" < "+(et[lt-2]-1)+`;
        `+$e+`
        ivec4 srcIdx = ivec4(sourceLocR`+Kt+", sourceLocG"+Kt+`,
          sourceLocB`+Kt+", sourceLocA"+Kt+") * "+me+`;
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = `+sr+`;

        for (int i = 0; i < `+me+`; i++) {
          inIdx = srcIdx;
          `+er+`
          vec4 candidate = `+sr+`;
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(`+Kn+`(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}(_,uc(_[_.length-1]),l,g==null),V=g==null?[a]:[a,g],ne=this.compileAndRun(j,V,"int32");return ne.rank===a.rank?this.argReducePacked(a,l,ne):ne},c.prototype.sum=function(a,l){Ga("sum",l,a.rank);var g=Aa(a.shape,l),_=g[0],j=Ye(g[1]),V=a.as2D(-1,j),ne=Jn(a.dtype);return this.reduce(V,"sum",ne).reshape(_)},c.prototype.prod=function(a,l){if(this.shouldExecuteOnCPU([a]))return this.cpuBackend.prod(a,l);var g=Aa(a.shape,l),_=g[0],j=Ye(g[1]),V=a.as2D(-1,j),ne=Jn(a.dtype);return this.reduce(V,"prod",ne).reshape(_)},c.prototype.unsortedSegmentSum=function(a,l,g){var _=0,j=Co([_],a.rank),V=a;j!=null&&(V=ft(a,j),_=Oo(1,a.rank)[0]);var ne=function(Ne,Ue,$e){for(var He=[],et=Ne.length,lt=0;lt<et;lt++)lt!==Ue?He.push(Ne[lt]):He.push($e);return He}(V.shape,_,g),oe=Ye([V.shape[_]]),me=V.as2D(-1,oe),Ee=Jn(a.dtype),_e=this.segOpCompute(me,"unsortedSegmentSum",l,Ee,g).reshape(ne);return j!=null&&(_e=ft(_e,wu(j))),_e},c.prototype.segOpCompute=function(a,l,g,_,j){var V=a.shape[0],ne=a.shape[1],oe=function(_e,Ne){var Ue,$e=!1;for(_e<=qu?(Ue=_e,$e=!0):Ue=br(_e,Math.floor(Math.sqrt(_e)));!$e;)Ue>Ne||Ue===_e?$e=!0:Ue=br(_e,Ue+1);return Ue}(ne,j),me=new function(_e,Ne){this.variableNames=["x","segmentIds"];var Ue=_e.windowSize,$e=_e.batchSize,He=_e.inSize,et=_e.numSegments,lt=et*Math.ceil(He/Ue);this.outputShape=[$e,lt];var ht=4*Math.floor(Ue/4),gt=Ue%4,Ct=`
        sumValue += dot(values, segFilter);
    `,Wt="";He%Ue>0&&(Wt=`
        if (inIdx < 0 || inIdx >= `+He+`) {
          return initializationValue;
        }
      `);var Kt="";He%Ue>0&&(Kt=`
        if (inIdx < 0 || inIdx >= `+He+`) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = 0.0;

      float getValue(int batch, int inIdx) {
        `+Wt+`
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        `+Kt+`
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          `+et+")) * float("+Ue+`));
        int currentSeg = int(mod(float(outIdx), float(`+et+`)));

        float sumValue = 0.0;

        for (int i = 0; i < `+ht+`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          `+Ct+`
        }

        int inIdx = inOffset + `+ht+`;
        if (`+(gt===1)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          `+Ct+`
        } else if (`+(gt===2)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          `+Ct+`
        } else if (`+(gt===3)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          `+Ct+`
        }
        setOutput(sumValue);
      }
    `}({windowSize:oe,inSize:ne,batchSize:V,numSegments:j}),Ee=this.compileAndRun(me,[a,g],_);return Ee.shape[1]===j?Ee:(g=ac(0,j).tile([ne/oe]),this.segOpCompute(Ee,l,g,_,j))},c.prototype.argMinMaxReduce=function(a,l,g){var _=[l];if(Ga("arg"+g.charAt(0).toUpperCase()+g.slice(1),_,a.rank),!L().getBool("WEBGL_PACK_REDUCE")||a.rank<=2){var j=Aa(a.shape,_),V=j[0],ne=Ye(j[1]),oe=a.as2D(-1,ne);return this.argReduce(oe,g).reshape(V)}return this.argReducePacked(a,g)},c.prototype.argMin=function(a,l){return this.argMinMaxReduce(a,l,"min")},c.prototype.argMax=function(a,l){return this.argMinMaxReduce(a,l,"max")},c.prototype.cumsum=function(a,l,g,_){if(l!==a.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(a.rank-1)+" but got axis="+l);var j=new function(V,ne,oe){this.variableNames=["x"],this.outputShape=V;var me=V.length,Ee=V[V.length-1],_e=oe?"<":">";this.userCode=`
      int getIndex(int i) {
        `+(oe?"return "+Ee+" -i - 1;":"return i;")+`
      }

      void main() {
        `+Ia(me)+` coords = getOutputCoords();
        int end = `+vg(me,"coords")+`;
        float val = 0.0;
        for (int i = `+Ee+` - 1; i >= 0; i -= 1) {
          int idx = getIndex(i);
          if (idx `+_e+` end) {
            continue;
          }
          if (idx == end && `+ne+`) {
            continue;
          }
          `+vg(me,"coords")+` = idx;
          val += getX(`+function(Ne,Ue){if(Ne===1)return""+Ue;if(Ne===2)return Ue+".x, "+Ue+".y";if(Ne===3)return Ue+".x, "+Ue+".y, "+Ue+".z";if(Ne===4)return Ue+".x, "+Ue+".y, "+Ue+".z, "+Ue+".w";throw Error("Cumulative sum for rank "+Ne+" is not yet supported")}(me,"coords")+`);
        }
        setOutput(val);
      }
    `}(a.shape,g,_);return this.compileAndRun(j,[a])},c.prototype.equal=function(a,l){if(L().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(a,l,`
  return vec4(equal(a, b));
`,"bool");var g=new za("return float(a == b);",a.shape,l.shape);return this.compileAndRun(g,[a,l],"bool")},c.prototype.notEqual=function(a,l){if(L().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(a,l,`
  return vec4(notEqual(a, b));
`,"bool");var g=new za("return float(a != b);",a.shape,l.shape);return this.compileAndRun(g,[a,l],"bool")},c.prototype.less=function(a,l){if(this.shouldExecuteOnCPU([a,l]))return this.cpuBackend.less(a,l);if(L().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(a,l,`
  return vec4(lessThan(a, b));
`,"bool");var g=new za("return float(a < b);",a.shape,l.shape);return this.compileAndRun(g,[a,l],"bool")},c.prototype.lessEqual=function(a,l){if(L().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(a,l,`
  return vec4(lessThanEqual(a, b));
`,"bool");var g=new za("return float(a <= b);",a.shape,l.shape);return this.compileAndRun(g,[a,l],"bool")},c.prototype.greater=function(a,l){if(this.shouldExecuteOnCPU([a,l]))return this.cpuBackend.greater(a,l);if(L().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(a,l,`
  return vec4(greaterThan(a, b));
`,"bool");var g=new za("return float(a > b);",a.shape,l.shape);return this.compileAndRun(g,[a,l],"bool")},c.prototype.greaterEqual=function(a,l){if(L().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(a,l,`
  return vec4(greaterThanEqual(a, b));
`,"bool");var g=new za("return float(a >= b);",a.shape,l.shape);return this.compileAndRun(g,[a,l],"bool")},c.prototype.logicalNot=function(a){var l=new sa(a.shape,"return float(!(x >= 1.0));");return this.compileAndRun(l,[a])},c.prototype.logicalAnd=function(a,l){if(L().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(a,l,`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,"bool");var g=new za("return float(a >= 1.0 && b >= 1.0);",a.shape,l.shape);return this.compileAndRun(g,[a,l],"bool")},c.prototype.logicalOr=function(a,l){if(L().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(a,l,`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,"bool");var g=new za("return float(a >= 1.0 || b >= 1.0);",a.shape,l.shape);return this.compileAndRun(g,[a,l],"bool")},c.prototype.select=function(a,l,g){var _=new function(j,V,ne){var oe,me;if(this.variableNames=["c","a","b"],this.outputShape=V,ne>4)throw Error("Where for rank "+ne+" is not yet supported");if(ne===1)me="resRC",oe="resRC";else{for(var Ee=["resRC.x","resRC.y","resRC.z","resRC.w"],_e=[],Ne=[],Ue=0;Ue<V.length;Ue++)Ne.push(""+Ee[Ue]),Ue<j&&_e.push(""+Ee[Ue]);oe=_e.join(),me=Ne.join()}var $e=Ia(ne);this.userCode=`
      void main() {
        `+$e+` resRC = getOutputCoords();
        float cVal = getC(`+oe+`);
        if (cVal >= 1.0) {
          setOutput(getA(`+me+`));
        } else {
          setOutput(getB(`+me+`));
        }
      }
    `}(a.rank,l.shape,l.rank);return this.compileAndRun(_,[a,l,g],cn(l.dtype,g.dtype))},c.prototype.where=function(a){qc("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var l=a.dataSync();return Ja(a.shape,l)},c.prototype.topk=function(a,l,g){return io(a.dataSync(),a.shape,a.dtype,l)},c.prototype.min=function(a,l){Ga("min",l,a.rank);var g=Aa(a.shape,l),_=g[0],j=Ye(g[1]),V=a.as2D(-1,j);return this.reduce(V,"min",V.dtype).reshape(_)},c.prototype.minimum=function(a,l){if(this.shouldExecuteOnCPU([a,l]))return this.cpuBackend.minimum(a,l);var g=L().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Mo(`
  vec4 result = vec4(min(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,a.shape,l.shape):new za(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return min(a, b);
`,a.shape,l.shape);return this.compileAndRun(g,[a,l])},c.prototype.mod=function(a,l){var g=L().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Mo(`
  vec4 result = mod(a, b);
  vec4 isNaN = vec4(equal(b, vec4(0.0)));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,a.shape,l.shape):new za(`if (b == 0.0) return NAN;
  return mod(a, b);`,a.shape,l.shape);return this.compileAndRun(g,[a,l])},c.prototype.max=function(a,l){if(this.shouldExecuteOnCPU([a]))return this.cpuBackend.max(a,l);Ga("max",l,a.rank);var g=Aa(a.shape,l),_=g[0],j=Ye(g[1]),V=a.as2D(-1,j);return this.reduce(V,"max",V.dtype).reshape(_)},c.prototype.maximum=function(a,l){if(this.shouldExecuteOnCPU([a,l]))return this.cpuBackend.maximum(a,l);var g=L().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Mo(`
  vec4 result = vec4(max(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,a.shape,l.shape):new za(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return max(a, b);
`,a.shape,l.shape);return this.compileAndRun(g,[a,l])},c.prototype.all=function(a,l){Ga("all",l,a.rank);var g=Aa(a.shape,l),_=g[0],j=Ye(g[1]),V=a.as2D(-1,j);return this.reduce(V,"all",V.dtype).reshape(_)},c.prototype.any=function(a,l){Ga("any",l,a.rank);var g=Aa(a.shape,l),_=g[0],j=Ye(g[1]),V=a.as2D(-1,j);return this.reduce(V,"any",V.dtype).reshape(_)},c.prototype.floorDiv=function(a,l){if(L().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(a,l,`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,"int32");var g=new za(`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,a.shape,l.shape);return this.compileAndRun(g,[a,l],"int32")},c.prototype.add=function(a,l){if(a.dtype==="complex64"&&l.dtype==="complex64")return this.complexSeparableBinaryOp(a,l,Ss);if(this.shouldExecuteOnCPU([a,l]))return this.cpuBackend.add(a,l);var g=cn(a.dtype,l.dtype);if(L().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(a,l,Ss,g);var _=new za(Ss,a.shape,l.shape);return this.compileAndRun(_,[a,l],g)},c.prototype.packedUnaryOp=function(a,l,g){var _=new zl(a.shape,l);return this.compileAndRun(_,[a],g)},c.prototype.packedBinaryOp=function(a,l,g,_,j){j===void 0&&(j=!1);var V=new Mo(g,a.shape,l.shape,j);return this.compileAndRun(V,[a,l],_)},c.prototype.complexSeparableBinaryOp=function(a,l,g){var _=this,j=this.texData.get(a.dataId),V=this.texData.get(l.dataId),ne=[[j.complexTensors.real,V.complexTensors.real],[j.complexTensors.imag,V.complexTensors.imag]].map(function(_e){var Ne=_e[0],Ue=_e[1],$e=_.makeComplexComponentTensorInfo(a,Ne),He=_.makeComplexComponentTensorInfo(l,Ue),et=new za(g,a.shape,l.shape);return _.compileAndRun(et,[$e,He],cn(Ne.dtype,Ue.dtype))}),oe=ne[0],me=ne[1],Ee=this.complex(oe,me);return oe.dispose(),me.dispose(),Ee},c.prototype.makeComplexComponentTensorInfo=function(a,l){return{dataId:l.dataId,dtype:l.dtype,shape:a.shape}},c.prototype.addN=function(a){if(a.length===1)return a[0];if(a.length>L().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var l=Math.floor(a.length/2),g=this.addN(a.slice(0,l)),_=this.addN(a.slice(l));return this.addN([g,_])}var j=a.map(function(oe){return oe.dtype}).reduce(function(oe,me){return cn(oe,me)}),V=a.map(function(oe){return oe.shape}),ne=L().getBool("WEBGL_PACK")?new function(oe,me){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=oe,this.variableNames=me.map(function(Ne,Ue){return"T"+Ue});var Ee=[];this.variableNames.forEach(function(Ne){Ee.push("vec4 v"+Ne+" = get"+Ne+"AtOutCoords();")});var _e=this.variableNames.map(function(Ne){return"v"+Ne}).join(" + ");this.userCode=`
      void main() {
        `+Ee.join(`
        `)+`

        vec4 result = `+_e+`;
        setOutput(result);
      }
    `}(a[0].shape,V):new function(oe,me){this.outputShape=[],this.outputShape=oe,this.variableNames=me.map(function(Ne,Ue){return"T"+Ue});var Ee=[];this.variableNames.forEach(function(Ne){Ee.push("float v"+Ne+" = get"+Ne+"AtOutCoords();")});var _e=this.variableNames.map(function(Ne){return"v"+Ne}).join(" + ");this.userCode=`
      void main() {
        `+Ee.join(`
        `)+`

        float result = `+_e+`;
        setOutput(result);
      }
    `}(a[0].shape,V);return this.compileAndRun(ne,a,j)},c.prototype.subtract=function(a,l){if(a.dtype==="complex64"&&l.dtype==="complex64")return this.complexSeparableBinaryOp(a,l,Ko);if(this.shouldExecuteOnCPU([a,l]))return this.cpuBackend.subtract(a,l);var g=cn(a.dtype,l.dtype);if(L().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(a,l,Ko,a.dtype);var _=new za(Ko,a.shape,l.shape);return this.compileAndRun(_,[a,l],g)},c.prototype.pow=function(a,l){var g=L().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Mo(`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,a.shape,l.shape):new za(`
if(a < 0.0 && floor(b) < b){
  return NAN;
}
if (b == 0.0) {
  return 1.0;
}
return (round(mod(b, 2.0)) != 1) ?
    pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,a.shape,l.shape),_=cn(a.dtype,l.dtype);return this.compileAndRun(g,[a,l],_)},c.prototype.ceil=function(a){if(this.shouldExecuteOnCPU([a]))return this.cpuBackend.ceil(a);if(L().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(a,Dg,a.dtype);var l=new sa(a.shape,Dg);return this.compileAndRun(l,[a])},c.prototype.floor=function(a){if(this.shouldExecuteOnCPU([a]))return this.cpuBackend.floor(a);if(L().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(a,Tg,a.dtype);var l=new sa(a.shape,Tg);return this.compileAndRun(l,[a])},c.prototype.sign=function(a){var l=new sa(a.shape,`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`);return this.compileAndRun(l,[a])},c.prototype.isNaN=function(a){var l=new sa(a.shape,"return float(isnan(x));");return this.compileAndRun(l,[a],"bool")},c.prototype.isInf=function(a){var l=new sa(a.shape,"return float(isinf(x));");return this.compileAndRun(l,[a],"bool")},c.prototype.isFinite=function(a){var l=new sa(a.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(l,[a],"bool")},c.prototype.round=function(a){var l=new sa(a.shape,`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`);return this.compileAndRun(l,[a])},c.prototype.exp=function(a){if(this.shouldExecuteOnCPU([a]))return this.cpuBackend.exp(a);if(L().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(a,$h,a.dtype);var l=new sa(a.shape,$h);return this.compileAndRun(l,[a])},c.prototype.expm1=function(a){if(this.shouldExecuteOnCPU([a]))return this.cpuBackend.expm1(a);if(L().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(a,Uf,a.dtype);var l=new sa(a.shape,Uf);return this.compileAndRun(l,[a])},c.prototype.softmax=function(a,l){var g=xn([l],a.shape),_=this.max(a,g),j=_a(_.shape,g),V=this.subtract(a,_.reshape(j)),ne=this.exp(V),oe=this.sum(ne,g).reshape(j);return Xa(ne,oe)},c.prototype.log=function(a){if(this.shouldExecuteOnCPU([a]))return this.cpuBackend.log(a);if(L().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(a,`
  vec4 result = log(x);
  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));
  result.r = isNaN.r == 1.0 ? NAN : result.r;
  result.g = isNaN.g == 1.0 ? NAN : result.g;
  result.b = isNaN.b == 1.0 ? NAN : result.b;
  result.a = isNaN.a == 1.0 ? NAN : result.a;

  return result;
`,a.dtype);var l=new sa(a.shape,`if (x < 0.0) return NAN;
  return log(x);`);return this.compileAndRun(l,[a])},c.prototype.log1p=function(a){var l=new sa(a.shape,"return log(1.0 + x);");return this.compileAndRun(l,[a])},c.prototype.sqrt=function(a){var l=new sa(a.shape,"return sqrt(x);");return this.compileAndRun(l,[a])},c.prototype.rsqrt=function(a){if(this.shouldExecuteOnCPU([a]))return this.cpuBackend.rsqrt(a);var l=new sa(a.shape,"return inversesqrt(x);");return this.compileAndRun(l,[a])},c.prototype.reciprocal=function(a){var l=new sa(a.shape,"return 1.0 / x;");return this.compileAndRun(l,[a])},c.prototype.relu=function(a){var l;return l=L().getBool("WEBGL_PACK")?new zl(a.shape,Pp):new sa(a.shape,Sg),this.compileAndRun(l,[a])},c.prototype.relu6=function(a){var l;return l=L().getBool("WEBGL_PACK")?new zl(a.shape,il):new sa(a.shape,tp),this.compileAndRun(l,[a])},c.prototype.prelu=function(a,l){var g=L().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Mo(es,a.shape,l.shape):new za(_c,a.shape,l.shape);return this.compileAndRun(g,[a,l])},c.prototype.elu=function(a){if(L().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(a,Su,a.dtype);var l=new sa(a.shape,nl);return this.compileAndRun(l,[a])},c.prototype.eluDer=function(a,l){var g=L().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Mo(`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,a.shape,l.shape):new za("return (b >= 1.0) ? a : a * (b + 1.0);",a.shape,l.shape);return this.compileAndRun(g,[a,l])},c.prototype.selu=function(a){var l=new sa(a.shape,`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = 1.7580993408473768;
  float scale = 1.0507009873554805;
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`);return this.compileAndRun(l,[a])},c.prototype.int=function(a){var l=new sa(a.shape,"return float(int(x));");return this.compileAndRun(l,[a],"int32")},c.prototype.clip=function(a,l,g){var _,j=(_=L().getBool("WEBGL_PACK_CLIP")?new el(a.shape):new lc(a.shape)).getCustomSetupFunc(l,g);return this.compileAndRun(_,[a],null,j)},c.prototype.abs=function(a){if(this.shouldExecuteOnCPU([a]))return this.cpuBackend.abs(a);if(L().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(a,Bp,a.dtype);var l=new sa(a.shape,Bp);return this.compileAndRun(l,[a])},c.prototype.complexAbs=function(a){var l=this.texData.get(a.dataId),g=new function(j){this.variableNames=["real","imag"],this.outputShape=j,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}(a.shape),_=[this.makeComplexComponentTensorInfo(a,l.complexTensors.real),this.makeComplexComponentTensorInfo(a,l.complexTensors.imag)];return this.compileAndRun(g,_)},c.prototype.sigmoid=function(a){var l=new sa(a.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(l,[a])},c.prototype.softplus=function(a){var l=new sa(a.shape,`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`);return this.compileAndRun(l,[a])},c.prototype.sin=function(a){var l=new sa(a.shape,`if (isnan(x)) return x;
  return sin(x);
`);return this.compileAndRun(l,[a])},c.prototype.cos=function(a){var l=new sa(a.shape,`if (isnan(x)) return x;
  return cos(x);
`);return this.compileAndRun(l,[a])},c.prototype.tan=function(a){var l=new sa(a.shape,"return tan(x);");return this.compileAndRun(l,[a])},c.prototype.asin=function(a){var l=new sa(a.shape,`if (isnan(x)) return x;
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`);return this.compileAndRun(l,[a])},c.prototype.acos=function(a){var l=new sa(a.shape,`if (isnan(x)) return x;
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`);return this.compileAndRun(l,[a])},c.prototype.atan=function(a){var l=new sa(a.shape,`if (isnan(x)) return x;
  return atan(x);
`);return this.compileAndRun(l,[a])},c.prototype.atan2=function(a,l){var g=L().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Mo(`
  vec4 result = atan(a, b);
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,a.shape,l.shape):new za(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return atan(a, b);
`,a.shape,l.shape);return this.compileAndRun(g,[a,l])},c.prototype.sinh=function(a){var l=new sa(a.shape,`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`);return this.compileAndRun(l,[a])},c.prototype.cosh=function(a){var l=new sa(a.shape,`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`);return this.compileAndRun(l,[a])},c.prototype.tanh=function(a){var l=new sa(a.shape,`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`);return this.compileAndRun(l,[a])},c.prototype.asinh=function(a){var l=new sa(a.shape,"if (isnan(x)) return x;return log(x + sqrt(x * x + 1.0));");return this.compileAndRun(l,[a])},c.prototype.acosh=function(a){var l=new sa(a.shape,`if (isnan(x)) return x;
  if (x < 1.0) return NAN;
  return log(x + sqrt(x * x - 1.0));`);return this.compileAndRun(l,[a])},c.prototype.atanh=function(a){var l=new sa(a.shape,`if (isnan(x)) return x;
  if ((x < -1.0) || (x > 1.0)) return NAN;
  return (log(1.0 + x) - log(1.0 - x)) / 2.0;`);return this.compileAndRun(l,[a])},c.prototype.erf=function(a){var l=new sa(a.shape,`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = 0.3275911;
  float a1 = 0.254829592;
  float a2 = -0.284496736;
  float a3 = 1.421413741;
  float a4 = -1.453152027;
  float a5 = 1.061405429;

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`);return this.compileAndRun(l,[a])},c.prototype.step=function(a,l){var g=new sa(a.shape,function(_){return _===void 0&&(_=0),Ag+`
    return x > 0.0 ? 1.0 : float(`+_+`);
  `}(l));return this.compileAndRun(g,[a])},c.prototype.conv2dByMatMul=function(a,l,g,_,j,V){var ne=a.shape,oe=this.texData.get(a.dataId),me=g.inChannels,Ee=ne[0]*ne[1]*ne[2],_e=g.outChannels,Ne=g.dataFormat==="channelsLast",Ue=(Ee===1||_e===1)&&me>1e3,$e=ne[2]%2!=0&&!!oe.isPacked;if(Ue||!L().getBool("WEBGL_LAZILY_UNPACK")||!L().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!$e){var He=Ne?ne[0]*ne[1]*ne[2]:ne[0]*ne[2]*ne[3],et=this.reshape(a,[1,He,g.inChannels]),lt=this.reshape(l,[1,g.inChannels,g.outChannels]);return this.reshape(this.fusedBatchMatMul({a:et,b:lt,transposeA:!1,transposeB:!1,bias:_,activation:j,preluActivationWeights:V}),g.outShape)}var ht=Ne?ne[0]*ne[1]*(ne[2]+1):ne[0]*ne[2]*(ne[3]+1),gt={dataId:a.dataId,shape:[1,ht,g.inChannels],dtype:a.dtype},Ct=oe.shape;oe.shape=oe.shape.slice(),oe.shape[oe.shape.length-2]++,we(su(oe.shape,gt.shape),function(){return"packed reshape "+oe.shape+" to "+gt.shape+" isn't free"});var Wt=this.reshape(l,[1,g.inChannels,g.outChannels]),Kt=this.fusedBatchMatMul({a:gt,b:Wt,transposeA:!1,transposeB:!1,bias:_,activation:j,preluActivationWeights:V}),Vt=this.texData.get(Kt.dataId);return we(Vt.isPacked,function(){return"batchMatMul result is expected to be packed"}),oe.shape=Ct,Vt.shape=g.outShape,Ve.makeTensorFromDataId(Kt.dataId,g.outShape,Kt.dtype)},c.prototype.conv2dWithIm2Row=function(a,l,g,_,j,V){var ne=g.filterWidth,oe=g.filterHeight,me=g.inChannels,Ee=g.outWidth,_e=g.outHeight,Ne=g.dataFormat==="channelsLast",Ue=ne*oe*me,$e=_e*Ee,He=[Ue,$e],et=a.squeeze([0]),lt=l.reshape([1,Ue,-1]),ht=new function(On,Cn,Kn){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=On;for(var er=Kn.filterWidth,sr=Kn.inChannels,lr=Kn.strideWidth,ur=Kn.strideHeight,ar=Kn.padInfo,Or=Kn.outWidth,Er=Kn.dilationWidth,Ur=Kn.dilationHeight,ei=Kn.dataFormat,mi=ar.left,ua=ar.top,ca=sr*er,ka=va(),ba=ei==="channelsLast",ja=ba?0:1,Za=ba?1:2,Bo="",Xi=0;Xi<=1;Xi++)for(var Ea=0;Ea<=1;Ea++)Bo+=`
          blockIndex = rc.y + `+Ea+`;
          pos = rc.x + `+Xi+`;

          if(blockIndex < `+On[1]+" && pos < "+On[0]+`) {
            offsetY = int(blockIndex / (`+Or+")) * "+ur+" - "+ua+`;
            d0 = offsetY + `+Ur+" * (pos / "+ca+`);

            if(d0 < `+Cn[ja]+` && d0 >= 0) {

              offsetX = int(mod(float(blockIndex), `+Or+".) * "+lr+". - "+mi+`.);
              d1 = offsetX + `+Er+" * (int(mod(float(pos), "+ca+".) / "+sr+`.));

              if(d1 < `+Cn[Za]+` && d1 >= 0) {

                ch = int(mod(float(pos), `+sr+`.));

                if (`+ba+`) {
                  innerDims = vec2(d1, ch);
                  result[`+(2*Xi+Ea)+`] = getChannel(
                    getA(d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[`+(2*Xi+Ea)+`] = getChannel(
                    getA(ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec2 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        `+Bo+`

        `+ka.output+` = result;
      }
    `}(He,et.shape,g),gt=this.compileAndRun(ht,[et]).reshape([1,He[0],He[1]]),Ct=_!=null,Wt=V!=null,Kt=j?Wl(j,!0):null,Vt=new _u(gt.shape,[1,$e,g.outChannels],!0,!1,Ct,Kt,Wt),Ht=[gt,lt];_&&Ht.push(_),Wt&&Ht.push(V);var vn=this.compileAndRun(Vt,Ht);return Ne?vn.reshape([1,_e,Ee,g.outChannels]):vn.reshape([1,g.outChannels,_e,Ee])},c.prototype.fusedConv2d=function(a){var l=a.input,g=a.filter,_=a.convInfo,j=a.bias,V=a.activation,ne=a.preluActivationWeights;if(_.filterHeight===1&&_.filterWidth===1&&_.dilationHeight===1&&_.dilationWidth===1&&_.strideHeight===1&&_.strideWidth===1&&(_.padInfo.type==="SAME"||_.padInfo.type==="VALID"))return this.conv2dByMatMul(l,g,_,j,V,ne);if(L().getBool("WEBGL_CONV_IM2COL")&&l.shape[0]===1)return this.conv2dWithIm2Row(l,g,_,j,V,ne);var oe=j!=null,me=ne!=null,Ee=V?Wl(V,!1):null,_e=new Xd(_,oe,Ee,me),Ne=[l,g];return j&&Ne.push(j),ne&&Ne.push(ne),this.compileAndRun(_e,Ne)},c.prototype.conv2d=function(a,l,g){if(g.filterHeight===1&&g.filterWidth===1&&g.dilationHeight===1&&g.dilationWidth===1&&g.strideHeight===1&&g.strideWidth===1&&(g.padInfo.type==="SAME"||g.padInfo.type==="VALID"))return this.conv2dByMatMul(a,l,g);if(L().getBool("WEBGL_CONV_IM2COL")&&a.shape[0]===1)return this.conv2dWithIm2Row(a,l,g);var _=new Xd(g);return this.compileAndRun(_,[a,l])},c.prototype.conv2dDerInput=function(a,l,g){var _=new function(j){this.variableNames=["dy","W"],this.outputShape=j.inShape;var V=j.filterHeight,ne=j.filterWidth,oe=j.strideHeight,me=j.strideWidth,Ee=j.dataFormat==="channelsLast",_e=V-1-j.padInfo.top,Ne=ne-1-j.padInfo.left,Ue=Ee?1:2,$e=Ee?2:3,He=Ee?3:1;this.userCode=`
      const ivec2 pads = ivec2(`+_e+", "+Ne+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[`+He+`];

        ivec2 dyCorner = ivec2(coords[`+Ue+"], coords["+$e+`]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+V+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+oe+`.0;

          if (dyR < 0.0 || dyR >= `+j.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+V+` - 1 - wR;

          for (int wC = 0; wC < `+ne+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+me+`.0;

            if (dyC < 0.0 || dyC >= `+j.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+ne+` - 1 - wC;

            for (int d2 = 0; d2 < `+j.outChannels+`; d2++) {

              if (`+Ee+`) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}(g);return this.compileAndRun(_,[a,l])},c.prototype.conv2dDerFilter=function(a,l,g){var _=new function(j){this.variableNames=["x","dy"],this.outputShape=j.filterShape;var V=j.strideHeight,ne=j.strideWidth,oe=j.padInfo.top,me=j.padInfo.left,Ee=j.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < `+j.batchSize+`; b++) {
          for (int yR = 0; yR < `+j.outHeight+`; yR++) {
            int xR = wR + yR * `+V+" - "+oe+`;

            if (xR < 0 || xR >= `+j.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+j.outWidth+`; yC++) {
              int xC = wC + yC * `+ne+" - "+me+`;

              if (xC < 0 || xC >= `+j.inWidth+`) {
                continue;
              }

              if (`+Ee+`) {
                float dyValue = getDy(b, yR, yC, d2);
                float xValue = getX(b, xR, xC, d1);
                dotProd += (xValue * dyValue);
              } else {
                float dyValue = getDy(b, d2, yR, yC);
                float xValue = getX(b, d1, xR, xC);
                dotProd += (xValue * dyValue);
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}(g);return this.compileAndRun(_,[a,l])},c.prototype.fusedDepthwiseConv2D=function(a){var l,g=a.input,_=a.filter,j=a.convInfo,V=a.bias,ne=a.activation,oe=a.preluActivationWeights,me=L().getBool("WEBGL_PACK_DEPTHWISECONV")&&j.strideWidth<=2&&j.outChannels/j.inChannels==1,Ee=ne?Wl(ne,me):null,_e=[g,_],Ne=V!=null,Ue=oe!=null;return Ne&&_e.push(V),Ue&&_e.push(oe),me?(l=new Ll(j,Ne,Ee,Ue),this.compileAndRun(l,_e)):(l=new tl(j,Ne,Ee,Ue),this.compileAndRun(l,_e))},c.prototype.depthwiseConv2D=function(a,l,g){var _;return L().getBool("WEBGL_PACK_DEPTHWISECONV")&&g.strideWidth<=2&&g.outChannels/g.inChannels==1?(_=new Ll(g),this.compileAndRun(_,[a,l])):(_=new tl(g),this.compileAndRun(_,[a,l]))},c.prototype.depthwiseConv2DDerInput=function(a,l,g){var _=new function(j){this.variableNames=["dy","W"],this.outputShape=j.inShape;var V=j.filterHeight,ne=j.filterWidth,oe=j.strideHeight,me=j.strideWidth,Ee=V-1-j.padInfo.top,_e=ne-1-j.padInfo.left,Ne=j.outChannels/j.inChannels;this.userCode=`
      const ivec2 pads = ivec2(`+Ee+", "+_e+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < `+V+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+oe+`.0;

          if (dyR < 0.0 || dyR >= `+j.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+V+` - 1 - wR;

          for (int wC = 0; wC < `+ne+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+me+`.0;

            if (dyC < 0.0 || dyC >= `+j.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+ne+` - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < `+Ne+`; dm++) {
              int d2 = d1 * `+Ne+` + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}(g);return this.compileAndRun(_,[a,l])},c.prototype.depthwiseConv2DDerFilter=function(a,l,g){var _=new function(j){this.variableNames=["x","dy"],this.outputShape=j.filterShape;var V=j.strideHeight,ne=j.strideWidth,oe=j.padInfo.top,me=j.padInfo.left,Ee=j.outChannels/j.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * `+Ee+` + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < `+j.batchSize+`; b++) {
          for (int yR = 0; yR < `+j.outHeight+`; yR++) {
            int xR = wR + yR * `+V+" - "+oe+`;

            if (xR < 0 || xR >= `+j.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+j.outWidth+`; yC++) {
              int xC = wC + yC * `+ne+" - "+me+`;

              if (xC < 0 || xC >= `+j.inWidth+`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}(g);return this.compileAndRun(_,[a,l])},c.prototype.conv3d=function(a,l,g){var _=new function(j){this.variableNames=["x","W"],this.outputShape=j.outShape;var V=j.padInfo.front,ne=j.padInfo.top,oe=j.padInfo.left,me=j.strideDepth,Ee=j.strideHeight,_e=j.strideWidth,Ne=j.dilationDepth,Ue=j.dilationHeight,$e=j.dilationWidth,He=j.filterDepth,et=j.filterHeight,lt=j.filterWidth,ht=4*Math.floor(j.inChannels/4),gt=j.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(`+me+", "+Ee+", "+_e+`);
      const ivec3 pads = ivec3(`+V+", "+ne+", "+oe+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < `+He+`; wF++) {
          int xF = xFCorner + wF * `+Ne+`;

          if (xF < 0 || xF >= `+j.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+et+`; wR++) {
            int xR = xRCorner + wR * `+Ue+`;

            if (xR < 0 || xR >= `+j.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+lt+`; wC++) {
              int xC = xCCorner + wC * `+$e+`;

              if (xC < 0 || xC >= `+j.inWidth+`) {
                continue;
              }

              for (int d1 = 0; d1 < `+ht+`; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (`+(gt===1)+`) {
                dotProd +=
                  getX(batch, xF, xR, xC, `+ht+`) *
                  getW(wF, wR, wC, `+ht+`, d2);
              } else if (`+(gt===2)+`) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, `+ht+`),
                  getX(batch, xF, xR, xC, `+ht+` + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, `+ht+`, d2),
                  getW(wF, wR, wC, `+ht+` + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (`+(gt===3)+`) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, `+ht+`),
                  getX(batch, xF, xR, xC, `+ht+` + 1),
                  getX(batch, xF, xR, xC, `+ht+` + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, `+ht+`, d2),
                  getW(wF, wR, wC, `+ht+` + 1, d2),
                  getW(wF, wR, wC, `+ht+` + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}(g);return this.compileAndRun(_,[a,l])},c.prototype.conv3dDerInput=function(a,l,g){var _=new function(j){this.variableNames=["dy","W"],this.outputShape=j.inShape;var V=j.filterDepth,ne=j.filterHeight,oe=j.filterWidth,me=j.strideDepth,Ee=j.strideHeight,_e=j.strideWidth,Ne=V-1-j.padInfo.front,Ue=ne-1-j.padInfo.top,$e=oe-1-j.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(`+Ne+", "+Ue+", "+$e+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < `+V+`; wF++) {
          float dyF = float(dyFCorner + wF) / `+me+`.0;

          if (dyF < 0.0 || dyF >= `+j.outDepth+`.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = `+V+` - 1 - wF;

          for (int wR = 0; wR < `+ne+`; wR++) {
            float dyR = float(dyRCorner + wR) / `+Ee+`.0;

            if (dyR < 0.0 || dyR >= `+j.outHeight+`.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = `+ne+` - 1 - wR;

            for (int wC = 0; wC < `+oe+`; wC++) {
              float dyC = float(dyCCorner + wC) / `+_e+`.0;

              if (dyC < 0.0 || dyC >= `+j.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = `+oe+` - 1 - wC;

              for (int d2 = 0; d2 < `+j.outChannels+`; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}(g);return this.compileAndRun(_,[a,l])},c.prototype.conv3dDerFilter=function(a,l,g){var _=new function(j){this.variableNames=["x","dy"],this.outputShape=j.filterShape;var V=j.strideDepth,ne=j.strideHeight,oe=j.strideWidth,me=j.padInfo.front,Ee=j.padInfo.top,_e=j.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < `+j.batchSize+`; b++) {
          for (int yF = 0; yF < `+j.outDepth+`; yF++) {
            int xF = wF + yF * `+V+" - "+me+`;

            if (xF < 0 || xF >= `+j.inDepth+`) {
              continue;
            }

            for (int yR = 0; yR < `+j.outHeight+`; yR++) {
              int xR = wR + yR * `+ne+" - "+Ee+`;

              if (xR < 0 || xR >= `+j.inHeight+`) {
                continue;
              }

              for (int yC = 0; yC < `+j.outWidth+`; yC++) {
                int xC = wC + yC * `+oe+" - "+_e+`;

                if (xC < 0 || xC >= `+j.inWidth+`) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}(g);return this.compileAndRun(_,[a,l])},c.prototype.maxPool=function(a,l){var g=new Hh(l,"max",!1);return this.compileAndRun(g,[a])},c.prototype.avgPool=function(a,l){var g=new Hh(l,"avg",!1);return this.compileAndRun(g,[a],"float32")},c.prototype.maxPoolBackprop=function(a,l,g,_){var j=new Hh(_,"max",!0),V=this.compileAndRun(j,[l]),ne=new function(me){this.variableNames=["dy","maxPos"],this.outputShape=me.inShape;var Ee=me.strideHeight,_e=me.strideWidth,Ne=me.dilationHeight,Ue=me.effectiveFilterHeight,$e=me.effectiveFilterWidth,He=Ue-1-me.padInfo.top,et=$e-1-me.padInfo.left,lt=Ue*$e-1;this.userCode=`
      const ivec2 pads = ivec2(`+He+", "+et+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+Ue+`;
          wR += `+Ne+`) {
          float dyR = float(dyRCorner + wR) / `+Ee+`.0;

          if (dyR < 0.0 || dyR >= `+me.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+$e+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+_e+`.0;

            if (dyC < 0.0 || dyC >= `+me.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = `+lt+` - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * `+$e+` + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}(_),oe=this.compileAndRun(ne,[a,V],l.dtype);return V.dispose(),oe},c.prototype.avgPoolBackprop=function(a,l,g){var _=new function(j){this.variableNames=["dy"],this.outputShape=j.inShape;var V=j.filterHeight,ne=j.filterWidth,oe=j.strideHeight,me=j.strideWidth,Ee=j.dilationHeight,_e=j.dilationWidth,Ne=j.effectiveFilterHeight,Ue=j.effectiveFilterWidth,$e=Ne-1-j.padInfo.top,He=Ue-1-j.padInfo.left,et=1/(V*ne);this.userCode=`
      const ivec2 pads = ivec2(`+$e+", "+He+`);
      const float avgMultiplier = float(`+et+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+Ne+`;
            wR += `+Ee+`) {
          float dyR = float(dyRCorner + wR) / `+oe+`.0;

          if (dyR < 0.0 || dyR >= `+j.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+Ue+`;
            wC+= `+_e+`) {
            float dyC = float(dyCCorner + wC) / `+me+`.0;

            if (dyC < 0.0 || dyC >= `+j.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}(g);return this.compileAndRun(_,[a],l.dtype)},c.prototype.cast=function(a,l){return Wr(a,l,this)},c.prototype.unstack=function(a,l){for(var g=a.shape[l],_=new Array(a.rank-1),j=0,V=0;V<a.rank;V++)V!==l&&(_[j++]=a.shape[V]);var ne=new Array(a.rank).fill(0),oe=a.shape.slice();oe[l]=1;var me=new Array(g);for(V=0;V<me.length;V++)ne[l]=V,me[V]=this.slice(a,ne,oe).reshape(_);return me},c.prototype.avgPool3d=function(a,l){var g=new Qd(l,"avg",!1);return this.compileAndRun(g,[a],"float32")},c.prototype.avgPool3dBackprop=function(a,l,g){var _=new function(j){this.variableNames=["dy"],this.outputShape=j.inShape;var V=j.filterDepth,ne=j.filterHeight,oe=j.filterWidth,me=j.strideDepth,Ee=j.strideHeight,_e=j.strideWidth,Ne=j.dilationDepth,Ue=j.dilationHeight,$e=j.dilationWidth,He=j.effectiveFilterDepth,et=j.effectiveFilterHeight,lt=j.effectiveFilterWidth,ht=He-1-j.padInfo.front,gt=et-1-j.padInfo.top,Ct=lt-1-j.padInfo.left,Wt=1/(V*ne*oe);this.userCode=`
      const ivec3 pads = ivec3(`+ht+", "+gt+", "+Ct+`);
      const float avgMultiplier = float(`+Wt+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+He+`;
            wD += `+Ne+`) {
          float dyD = float(dyDCorner + wD) / `+me+`.0;

          if (dyD < 0.0 || dyD >= `+j.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+et+`;
              wR += `+Ue+`) {
            float dyR = float(dyRCorner + wR) / `+Ee+`.0;

            if (dyR < 0.0 || dyR >= `+j.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+lt+`;
                wC += `+$e+`) {
              float dyC = float(dyCCorner + wC) / `+_e+`.0;

              if (dyC < 0.0 || dyC >= `+j.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}(g);return this.compileAndRun(_,[a],l.dtype)},c.prototype.maxPool3d=function(a,l){var g=new Qd(l,"max",!1);return this.compileAndRun(g,[a],"float32")},c.prototype.maxPool3dBackprop=function(a,l,g,_){var j=new Qd(_,"max",!0),V=this.compileAndRun(j,[l]),ne=new function(me){this.variableNames=["dy","maxPos"],this.outputShape=me.inShape;var Ee=me.strideDepth,_e=me.strideHeight,Ne=me.strideWidth,Ue=me.dilationDepth,$e=me.dilationHeight,He=me.dilationWidth,et=me.effectiveFilterDepth,lt=me.effectiveFilterHeight,ht=me.effectiveFilterWidth,gt=et-1-me.padInfo.front,Ct=lt-1-me.padInfo.top,Wt=ht-1-me.padInfo.left,Kt=et*lt*ht-1;this.userCode=`
      const ivec3 pads = ivec3(`+gt+", "+Ct+", "+Wt+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+et+`;
           wD += `+Ue+`) {
          float dyD = float(dyDCorner + wD) / `+Ee+`.0;

          if (dyD < 0.0 || dyD >= `+me.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+lt+`;
              wR += `+$e+`) {
            float dyR = float(dyRCorner + wR) / `+_e+`.0;

            if (dyR < 0.0 || dyR >= `+me.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+ht+`;
                wC += `+He+`) {
              float dyC = float(dyCCorner + wC) / `+Ne+`.0;

              if (dyC < 0.0 || dyC >= `+me.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = `+Kt+` -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * `+lt+" * "+ht+` +
                  wR * `+ht+` + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}(_),oe=this.compileAndRun(ne,[a,V],l.dtype);return V.dispose(),oe},c.prototype.reshape=function(a,l){var g=this.texData.get(a.dataId);if(g.isPacked&&!su(a.shape,l)&&(g.texture===null||!su(g.shape,l))){var _=this.packedReshape(a,l);return Ve.makeTensorFromDataId(_.dataId,_.shape,_.dtype)}return oi(a,l)},c.prototype.resizeBilinear=function(a,l,g,_){var j=L().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new function(V,ne,oe,me){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var Ee=V[0],_e=V[1],Ne=V[2],Ue=V[3];this.outputShape=[Ee,ne,oe,Ue];var $e=[me&&ne>1?_e-1:_e,me&&oe>1?Ne-1:Ne],He=[me&&ne>1?ne-1:ne,me&&oe>1?oe-1:oe];this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `+$e[0]/He[0]+`,
          `+$e[1]/He[1]+`,
          `+$e[1]/He[1]+`);
      const vec3 inputShapeRC = vec3(`+_e+".0, "+Ne+`.0,
                                     `+Ne+`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `+(Ue-1)+`;
        bool hasNextRow = coords.z < `+(oe-1)+`;

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}(a.shape,l,g,_):new function(V,ne,oe,me){this.variableNames=["A"],this.outputShape=[];var Ee=V[0],_e=V[1],Ne=V[2],Ue=V[3];this.outputShape=[Ee,ne,oe,Ue];var $e=[me&&ne>1?_e-1:_e,me&&oe>1?Ne-1:Ne],He=[me&&ne>1?ne-1:ne,me&&oe>1?oe-1:oe];this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+$e[0]/He[0]+`,
          `+$e[1]/He[1]+`);
      const vec2 inputShapeRC = vec2(`+_e+".0, "+Ne+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}(a.shape,l,g,_);return this.compileAndRun(j,[a],"float32")},c.prototype.resizeBilinearBackprop=function(a,l,g){var _=new function(j,V,ne){this.variableNames=["dy"],this.outputShape=[],this.outputShape=V.shape;var oe=V.shape,me=oe[1],Ee=oe[2],_e=j.shape,Ne=_e[1],Ue=_e[2],$e=[ne&&Ne>1?me-1:me,ne&&Ue>1?Ee-1:Ee],He=[ne&&Ne>1?Ne-1:Ne,ne&&Ue>1?Ue-1:Ue],et=$e[0]/He[0],lt=$e[1]/He[1],ht=1/et,gt=1/lt,Ct=2*Math.ceil(ht)+2,Wt=2*Math.ceil(gt)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+et+`);
        const float widthScale = float(`+lt+`);

        const float invHeightScale = float(`+ht+`);
        const float invWidthScale = float(`+gt+`);

        const int winHeight = int(`+Ct+`);
        const int winWidth = int(`+Wt+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+Ne+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+Ue+`) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), `+(me-1)+`.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), `+(Ee-1)+`.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}(a,l,g);return this.compileAndRun(_,[a])},c.prototype.resizeNearestNeighbor=function(a,l,g,_){var j=new function(V,ne,oe,me){this.variableNames=["A"],this.outputShape=[];var Ee=V[0],_e=V[1],Ne=V[2],Ue=V[3];this.outputShape=[Ee,ne,oe,Ue];var $e=[me&&ne>1?_e-1:_e,me&&oe>1?Ne-1:Ne],He=[me&&ne>1?ne-1:ne,me&&oe>1?oe-1:oe],et=me?"0.5":"0.0";this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+$e[0]/He[0]+`,
          `+$e[1]/He[1]+`);
      const vec2 inputShapeRC = vec2(`+_e+".0, "+Ne+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `+et+`)));

        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}(a.shape,l,g,_);return this.compileAndRun(j,[a])},c.prototype.resizeNearestNeighborBackprop=function(a,l,g){var _=new function(j,V,ne){this.variableNames=["dy"],this.outputShape=[],this.outputShape=V.shape;var oe=V.shape,me=oe[1],Ee=oe[2],_e=j.shape,Ne=_e[1],Ue=_e[2],$e=[ne&&Ne>1?me-1:me,ne&&Ue>1?Ee-1:Ee],He=[ne&&Ne>1?Ne-1:Ne,ne&&Ue>1?Ue-1:Ue],et=$e[0]/He[0],lt=$e[1]/He[1],ht=1/et,gt=1/lt,Ct=2*Math.ceil(ht)+2,Wt=2*Math.ceil(gt)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+et+`);
        const float widthScale = float(`+lt+`);

        const float invHeightScale = float(`+ht+`);
        const float invWidthScale = float(`+gt+`);

        const int winHeight = int(`+Ct+`);
        const int winWidth = int(`+Wt+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+Ne+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+Ue+`) {
              continue;
            }

            float sourceFracRow =
              float(`+$e[0]+`) *
                (float(dyR) / float(`+He[0]+`));

            float sourceFracCol =
                float(`+$e[1]+`) *
                  (float(dyC) / float(`+He[1]+`));

            int sourceNearestRow = int(min(
                float(int(`+me+`) - 1),
                `+ne+` ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(`+Ee+`) - 1),
                `+ne+` ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}(a,l,g);return this.compileAndRun(_,[a])},c.prototype.multinomial=function(a,l,g,_){var j=l?a:Be(a),V=j.shape[0],ne=j.shape[1],oe=new Im(V,ne,g),me=oe.getCustomSetupFunc(_);return this.compileAndRun(oe,[j],"int32",me)},c.prototype.oneHot=function(a,l,g,_){var j=new function(V,ne,oe,me){this.variableNames=["indices"],this.outputShape=[V,ne],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(`+me+"), float("+oe+`),
                      float(index == coords.y)));
      }
    `}(a.size,l,g,_);return this.compileAndRun(j,[a])},c.prototype.diag=function(a){var l=new function(g){this.variableNames=["X"],this.outputShape=[g,g],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}(a.size);return this.compileAndRun(l,[a])},c.prototype.nonMaxSuppression=function(a,l,g,_,j){return qc("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),Ya(a.dataSync(),l.dataSync(),g,_,j)},c.prototype.cropAndResize=function(a,l,g,_,j,V){var ne=new function(oe,me,Ee,_e,Ne){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var Ue=oe[0],$e=oe[1],He=oe[2],et=oe[3],lt=me[0],ht=Ee[0],gt=Ee[1];this.outputShape=[lt,ht,gt,et];var Ct=_e==="bilinear"?1:0,Wt=[$e-1+".0",He-1+".0"],Kt=Wt[0],Vt=Wt[1],Ht=ht>1?[""+($e-1)/(ht-1),"(y2-y1) * height_ratio","y1*"+Kt+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+Kt],vn=Ht[0],On=Ht[1],Cn=Ht[2],Kn=gt>1?[""+(He-1)/(gt-1),"(x2-x1) * width_ratio","x1*"+Vt+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+Vt],er=Kn[0],sr=Kn[1],lr=Kn[2];this.userCode=`
      const float height_ratio = float(`+vn+`);
      const float width_ratio = float(`+er+`);
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= `+Ue+`) {
          return;
        }

        float height_scale = `+On+`;
        float width_scale = `+sr+`;

        float in_y = `+Cn+`;
        if( in_y < 0.0 || in_y > `+Kt+` ) {
          setOutput(float(`+Ne+`));
          return;
        }
        float in_x = `+lr+`;
        if( in_x < 0.0 || in_x > `+Vt+` ) {
          setOutput(float(`+Ne+`));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(`+Ct+` == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}(a.shape,l.shape,_,j,V);return this.compileAndRun(ne,[a,l,g],"float32")},c.prototype.depthToSpace=function(a,l,g){we(l>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+l});var _=a.shape[0],j=g==="NHWC"?a.shape[1]:a.shape[2],V=g==="NHWC"?a.shape[2]:a.shape[3],ne=g==="NHWC"?a.shape[3]:a.shape[1],oe=j*l,me=V*l,Ee=ne/(l*l),_e=new yg(g==="NHWC"?[_,oe,me,Ee]:[_,Ee,oe,me],l,g);return this.compileAndRun(_e,[a])},c.prototype.split=function(a,l,g){return to(a,l,g)},c.prototype.scatterND=function(a,l,g){var _=Qc(0,a,g),j=_.sliceRank,V=_.numUpdates,ne=_.sliceSize,oe=_.strides,me=_.outputSize,Ee=[me/ne,ne],_e=a.reshape([V,j]),Ne=l.reshape([V,ne]);if(me===0)return oi(wa([]),g);var Ue=fr(0),$e=new Nv(V,j,_e.rank,Ne.rank,oe,Ee);return this.compileAndRun($e,[Ne,_e,Ue]).reshape(g)},c.prototype.sparseToDense=function(a,l,g,_){var j=Qc(0,a,g),V=j.sliceRank,ne=j.numUpdates,oe=j.strides,me=j.outputSize,Ee=new Nv(ne,V,a.rank,l.rank,oe,[me,1]);return this.compileAndRun(Ee,[l,a,_]).reshape(g)},c.prototype.fft=function(a){return this.fftImpl(a,!1)},c.prototype.ifft=function(a){return this.fftImpl(a,!0)},c.prototype.fftImpl=function(a,l){var g=this.texData.get(a.dataId),_=new Cm("return real * expR - imag * expI;",a.shape,l),j=new Cm("return real * expI + imag * expR;",a.shape,l),V=[this.makeComplexComponentTensorInfo(a,g.complexTensors.real),this.makeComplexComponentTensorInfo(a,g.complexTensors.imag)],ne=this.compileAndRun(_,V),oe=this.compileAndRun(j,V),me=this.complex(ne,oe).as2D(a.shape[0],a.shape[1]);return ne.dispose(),oe.dispose(),me},c.prototype.gatherND=function(a,l){var g=l.shape,_=g[g.length-1],j=Hs(a,l),V=j[0],ne=j[1],oe=j[2],me=j[3],Ee=l.reshape([ne,_]),_e=a.reshape([a.size/oe,oe]),Ne=new function(Ue,$e,He){this.sliceDim=Ue,this.strides=$e,this.variableNames=["x","indices"],this.outputShape=He;var et=Ia($e.length),lt=Ia(He.length),ht=this.sliceDim>1?"strides[j]":"strides";this.userCode=`
        `+et+" strides = "+et+"("+this.strides+`);
         void main() {
          `+lt+` coords = getOutputCoords();
          int flattenIndex = 0;
          for (int j = 0; j < `+this.sliceDim+`; j++) {
            int index = round(getIndices(coords[0], j));
            flattenIndex += index * `+ht+`;
          }
          setOutput(getX(flattenIndex, coords[1]));
        }
      `}(_,me,[ne,oe]);return this.compileAndRun(Ne,[_e,Ee]).reshape(V)},c.prototype.fill=function(a,l,g){if((g=g||xe(l))==="string"){var _=fn(g,Ye(a));return _.fill(l),Ve.makeTensor(_,a,g,this)}var j=new Om(a,l),V=j.getCustomSetupFunc(l);return this.compileAndRun(j,[],g,V)},c.prototype.onesLike=function(a){if(a.dtype==="string")throw new Error("onesLike is not supported under string dtype");return this.fill(a.shape,1,a.dtype)},c.prototype.zerosLike=function(a){return this.fill(a.shape,a.dtype==="string"?"":0,a.dtype)},c.prototype.linspace=function(a,l,g){return li(a,l,g)},c.prototype.makeTensorInfo=function(a,l){var g=this.write(null,a,l);return this.texData.get(g).usage=null,{dataId:g,shape:a,dtype:l}},c.prototype.makeOutput=function(a,l){var g=this.makeTensorInfo(a,l).dataId;return Ve.makeTensorFromDataId(g,a,l,this)},c.prototype.unpackTensor=function(a){var l=new function(g){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=g;var _=g.length,j=fo("rc",_),V=Ia(_),ne=function(Ee,_e){if(Ee===1)return"rc";for(var Ne="",Ue=0;Ue<Ee;Ue++)Ne+=_e[Ue],Ue<Ee-1&&(Ne+=",");return Ne}(_,j),oe=j.slice(-2),me=_<=1?"rc":"vec2("+oe.join(",")+")";this.userCode=`
      void main() {
        `+V+` rc = getOutputCoords();
        vec4 packedInput = getA(`+ne+`);

        setOutput(getChannel(packedInput, `+me+`));
      }
    `}(a.shape);return this.runWebGLProgram(l,[a],a.dtype)},c.prototype.packTensor=function(a){var l=new function(g){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=g;var _=g.length;if(_===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{var j=fo("rc",_),V=Ia(_),ne=function(Ee,_e,Ne){if(Ee===1)return"rc > "+_e[0];for(var Ue="",$e=Ee-2;$e<Ee;$e++)Ue+=Ne[$e]+" >= "+_e[$e],$e<Ee-1&&(Ue+="||");return Ue}(_,g,j),oe=function(Ee,_e,Ne,Ue){if(Ee===1)return"";var $e=Ue.slice(-2);return`
    int r = `+$e[0]+`;
    int c = `+$e[1]+`;
    int rp1 = r + 1;
    int cp1 = c + 1;

    bool cEdge = cp1 >= `+_e+`;
    bool rEdge = rp1 >= `+Ne+`;
  `}(_,g[g.length-1],g[g.length-2],j),me=function(Ee,_e){var Ne=Ee.length,Ue=function($e,He){for(var et=[],lt=0;lt<=1;lt++)for(var ht=0;ht<=1;ht++){for(var gt=(lt===0?"r":"rp1")+", "+(ht===0?"c":"cp1"),Ct=2;Ct<$e;Ct++)gt=He[He.length-1-Ct]+","+gt;et.push(gt)}return et}(Ne,_e);return Ne===1?`getA(rc),
            rc + 1 >= `+Ee[0]+` ? 0. : getA(rc + 1),
            0, 0`:"getA("+Ue[0]+`),
          cEdge ? 0. : getA(`+Ue[1]+`),
          rEdge ? 0. : getA(`+Ue[2]+`),
          rEdge || cEdge ? 0. : getA(`+Ue[3]+")"}(g,j);this.userCode=`
        void main() {
          `+V+` rc = getOutputCoords();

          if(`+ne+`) {
            setOutput(vec4(0));
          } else {
            `+oe+`

            setOutput(vec4(`+me+`));
          }
        }
      `}}(a.shape);return this.runWebGLProgram(l,[a],a.dtype,null,!0)},c.prototype.packedReshape=function(a,l){var g=[ss(a.shape)].concat(Eo(a.shape)),_={dtype:a.dtype,shape:g,dataId:a.dataId},j=new function(ne,oe){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=ne;for(var me="",Ee=0;Ee<4;Ee++){var _e="thisRC = rc;";Ee%2==1&&(_e+="thisRC.z += 1;"),Ee>1&&(_e+="thisRC.y += 1;"),me+=`
        `+_e+`
        `+(Ee>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+`
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[`+Ee+`] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        `+(Ee>0?"}":"")+`
      `}this.userCode=`
      
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      `+ho(["r","c","d"],oe)+`
      return ivec3(r, c, d);
    }
  
      `+cu(ne)+`

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = `+ne[1]+`;
        int cols = `+ne[2]+`;

        `+me+`

        setOutput(result);
      }
    `}([ss(l)].concat(Eo(l)),g),V=this.runWebGLProgram(j,[_],a.dtype,null,!0);return{dataId:V.dataId,shape:l,dtype:V.dtype}},c.prototype.decode=function(a){var l,g=this.texData.get(a),_=g.isPacked,j=g.shape,V=g.dtype,ne=nc(j);return l=_?new function(oe){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Zn.DENSE;var me=Di(oe),Ee=va();this.outputShape=oe,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+ho(["r","c","d"],oe)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+me[0]+", "+me[1]+`));
        int index = 4 * (resTexRC.x * `+me[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        `+Ee.output+` = result;
      }
    `}(ne):new function(oe){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Zn.DENSE;var me=Di(oe),Ee=va();this.outputShape=oe,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+ho(["r","c","d"],oe)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+me[0]+", "+me[1]+`));
        int index = 4 * (resTexRC.x * `+me[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        `+Ee.output+` = result;
      }
    `}(ne),{dtype:V,shape:j,dataId:this.runWebGLProgram(l,[{shape:ne,dtype:V,dataId:a}],V,null,!0).dataId}},c.prototype.runWebGLProgram=function(a,l,g,_,j){var V=this;j===void 0&&(j=!1);var ne=this.makeTensorInfo(a.outputShape,g),oe=this.texData.get(ne.dataId);if(a.packedOutput&&(oe.isPacked=!0),a.outPackingScheme===Zn.DENSE){var me=Di(a.outputShape);oe.texShape=me.map(function(ht){return 2*ht})}if(a.outTexUsage!=null&&(oe.usage=a.outTexUsage),Ye(ne.shape)===0)return oe.values=Yn(ne.dtype,0),ne;var Ee=[],_e=l.map(function(ht){if(ht.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var gt=V.texData.get(ht.dataId);if(gt.texture==null){if(!a.packedInputs&&Ye(ht.shape)<=L().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:ht.shape,texData:null,isUniform:!0,uniformValues:gt.values};a.packedInputs&&(gt.isPacked=!0,gt.shape=ht.shape)}else if(!!gt.isPacked!=!!a.packedInputs)ht=gt.isPacked?V.unpackTensor(ht):V.packTensor(ht),Ee.push(ht),gt=V.texData.get(ht.dataId);else if(gt.isPacked&&!su(gt.shape,ht.shape)){var Ct=ht,Wt=ht.shape;ht.shape=gt.shape,ht=V.packedReshape(ht,Wt),Ee.push(ht),gt=V.texData.get(ht.dataId),Ct.shape=Wt}return V.uploadToGPU(ht.dataId),{shape:ht.shape,texData:gt,isUniform:!1}});this.uploadToGPU(ne.dataId);var Ne,Ue={shape:ne.shape,texData:oe,isUniform:!1},$e=function(ht,gt,Ct){var Wt="";_e.concat(Ct).forEach(function(Vt){var Ht=Vt.texData!=null&&Vt.texData.slice!=null&&Vt.texData.slice.flatOffset>0,vn=Vt.isUniform?"uniform":Vt.texData.texShape;Wt+=Vt.shape+"_"+vn+"_"+Ht});var Kt=ht.userCode;return ht.constructor.name+"_"+Wt+"_"+Kt}(a,0,Ue),He=this.getAndSaveBinary($e,function(){return function(ht,gt,Ct,Wt){var Kt=gt.userCode,Vt=Ct.map(function(ar,Or){var Er={logicalShape:ar.shape,texShape:ar.isUniform?null:ar.texData.texShape,isUniform:ar.isUniform,isPacked:!ar.isUniform&&ar.texData.isPacked,flatOffset:null};return ar.texData!=null&&ar.texData.slice!=null&&ar.texData.slice.flatOffset>0&&(Er.flatOffset=ar.texData.slice.flatOffset),{name:gt.variableNames[Or],shapeInfo:Er}}),Ht=Vt.map(function(ar){return ar.shapeInfo}),vn={logicalShape:Wt.shape,texShape:Wt.texData.texShape,isUniform:!1,isPacked:Wt.texData.isPacked,flatOffset:null},On=So(Vt,vn,Kt,gt.packedInputs),Cn=ht.createProgram(On),Kn=null,er=ht.getUniformLocation(Cn,"NAN",!1);L().getNumber("WEBGL_VERSION")===1&&(Kn=ht.getUniformLocation(Cn,"INFINITY",!1));for(var sr={},lr=0;lr<gt.variableNames.length;lr++){var ur=gt.variableNames[lr];sr[ur]=ht.getUniformLocation(Cn,ur,!1),sr["offset"+ur]=ht.getUniformLocation(Cn,"offset"+ur,!1)}return{program:gt,source:On,webGLProgram:Cn,uniformLocations:sr,inShapeInfos:Ht,outShapeInfo:vn,infLoc:Kn,nanLoc:er}}(V.gpgpu,a,_e,Ue)}),et=this.activeTimers!=null;if(et&&(Ne=this.startTimer()),function(ht,gt,Ct,Wt,Kt){Nm(gt.inShapeInfos,Ct),Nm([gt.outShapeInfo],[Wt]);var Vt=Wt.texData.texture,Ht=Wt.texData.texShape;Wt.texData.isPacked?ht.setOutputPackedMatrixTexture(Vt,Ht[0],Ht[1]):ht.setOutputMatrixTexture(Vt,Ht[0],Ht[1]),ht.setProgram(gt.webGLProgram),L().getNumber("WEBGL_VERSION")===1&&gt.infLoc!==null&&ht.gl.uniform1f(gt.infLoc,1/0),gt.nanLoc!==null&&ht.gl.uniform1f(gt.nanLoc,NaN),Ct.forEach(function(vn,On){var Cn=gt.program.variableNames[On],Kn=gt.uniformLocations[Cn],er=gt.uniformLocations["offset"+Cn];if(Kn!=null)if(vn.isUniform)if(Ye(vn.shape)<2)ht.gl.uniform1f(Kn,vn.uniformValues[0]);else{var sr=vn.uniformValues;sr instanceof Float32Array||(sr=new Float32Array(sr)),ht.gl.uniform1fv(Kn,sr)}else vn.texData.slice!=null&&er!=null&&ht.gl.uniform1i(er,vn.texData.slice.flatOffset),ht.setInputMatrixTexture(vn.texData.texture,Kn,On)}),Kt?.(ht,gt.webGLProgram),ht.executeProgram()}(this.gpgpu,He,_e,Ue,_),Ee.forEach(function(ht){return V.disposeData(ht.dataId)}),et&&(Ne=this.endTimer(Ne),this.activeTimers.push({name:a.constructor.name,query:this.getQueryTime(Ne)})),!L().getBool("WEBGL_LAZILY_UNPACK")&&oe.isPacked&&j===!1){var lt=this.unpackTensor(ne);return this.disposeData(ne.dataId),lt}return ne},c.prototype.compileAndRun=function(a,l,g,_,j){j===void 0&&(j=!1),g=g||l[0].dtype;var V=this.runWebGLProgram(a,l,g,_,j);return Ve.makeTensorFromDataId(V.dataId,V.shape,V.dtype)},c.prototype.getAndSaveBinary=function(a,l){return a in this.binaryCache||(this.binaryCache[a]=l()),this.binaryCache[a]},c.prototype.getTextureManager=function(){return this.textureManager},c.prototype.dispose=function(){var a=this;this.disposed||(L().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(function(l){a.gpgpu.deleteProgram(a.binaryCache[l].webGLProgram),delete a.binaryCache[l]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},c.prototype.floatPrecision=function(){var a=this;return this.floatPrecisionValue==null&&(this.floatPrecisionValue=Fi(function(){if(!L().get("WEBGL_RENDER_FLOAT32_ENABLED")){var l=L().getBool("DEBUG");L().set("DEBUG",!1);var g=a.abs(fr(1e-8)).dataSync()[0];if(L().set("DEBUG",l),g>0)return 32}return 16})),this.floatPrecisionValue},c.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},c.prototype.uploadToGPU=function(a){var l,g=this.texData.get(a),_=g.shape,j=g.dtype,V=g.values,ne=g.texture,oe=g.usage,me=g.isPacked;if(ne==null){var Ee,_e=this.activeTimers!=null;_e&&(Ee=nn());var Ne=g.texShape;if(Ne==null&&(Ne=Cl(_,me),g.texShape=Ne),V!=null){var Ue=nc(_),$e=void 0,He=Ne[1],et=Ne[0],lt=V instanceof Uint8Array;me?(He=(l=qr(Ne[0],Ne[1]))[0],$e=new function(Kt,Vt,Ht){Ht===void 0&&(Ht=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var vn=va(),On=Vt[0],Cn=Vt[1];this.outputShape=Kt;var Kn="",er="result";Ht&&(er="floor(result * 255. + 0.5)");for(var sr=0;sr<=1;sr++)for(var lr=0;lr<=1;lr++){var ur=2*sr+lr;Kn+=`
          localCoords = coords;
          if(localCoords[2] + `+lr+" < "+Kt[2]+`) {
            localCoords[2] += `+lr+`;
            if(localCoords[1] + `+sr+" < "+Kt[1]+`) {
              localCoords[1] += `+sr+`;

              flatIndex = getFlatIndex(localCoords);
              offset = imod(flatIndex, 4);

              flatIndex = idiv(flatIndex, 4, 1.);

              r = flatIndex / `+Cn+`;
              c = imod(flatIndex, `+Cn+`);
              uv = (vec2(c, r) + halfCR) / vec2(`+Cn+".0, "+On+`.0);
              values = `+vn.texture2D+`(A, uv);

              if(offset == 0) {
                result[`+ur+`] = values[0];
              } else if(offset == 1) {
                result[`+ur+`] = values[1];
              } else if(offset == 2) {
                result[`+ur+`] = values[2];
              } else {
                result[`+ur+`] = values[3];
              }
            }
          }
        `}this.userCode=`
      `+cu(Kt)+`

      void main() {
        ivec3 coords = getOutputCoords();

        vec4 result = vec4(0.);
        int flatIndex, r, c, offset;
        ivec3 localCoords;
        vec2 uv;
        vec4 values;

        `+Kn+`

        `+vn.output+" = "+er+`;
      }
    `}(Ue,[et=l[1],He],lt)):$e=new function(Kt,Vt,Ht){Ht===void 0&&(Ht=!1),this.variableNames=["A"];var vn=va(),On=Vt[0],Cn=Vt[1];this.outputShape=Kt;var Kn="result";Ht&&(Kn="floor(result * 255. + 0.5)"),this.userCode=`
      `+cu(Kt)+`

      void main() {
        ivec3 coords = getOutputCoords();

        int flatIndex = getFlatIndex(coords);
        int offset = imod(flatIndex, 4);

        flatIndex = idiv(flatIndex, 4, 1.);
        
        int r = flatIndex / `+Cn+`;
        int c = imod(flatIndex, `+Cn+`);
        vec2 uv = (vec2(c, r) + halfCR) / vec2(`+Cn+".0, "+On+`.0);
        vec4 values = `+vn.texture2D+`(A, uv);

        float result;

        if(offset == 0) {
          result = values[0];
        } else if(offset == 1) {
          result = values[1];
        } else if(offset == 2) {
          result = values[2];
        } else {
          result = values[3];
        }

        `+vn.output+" = vec4("+Kn+`, 0., 0., 0.);
      }
    `}(Ue,[et,He],lt);var ht=this.makeTensorInfo([et,He],j);this.texData.get(ht.dataId).usage=lt?ir.PIXELS:ir.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(ht.dataId),He,et,V);var gt=this.runWebGLProgram($e,[ht],j,null,!0),Ct=this.texData.get(gt.dataId);g.texture=Ct.texture,g.texShape=Ct.texShape,g.isPacked=Ct.isPacked,g.usage=Ct.usage,this.disposeData(ht.dataId),this.texData.delete(gt.dataId),g.values=null,_e&&(this.uploadWaitMs+=nn()-Ee)}else{var Wt=this.acquireTexture(Ne,oe,j,me);g.texture=Wt}}},c.prototype.convertAndCacheOnCPU=function(a,l){var g=this.texData.get(a),_=g.dtype;return this.releaseGPUData(a),l!=null&&(g.values=function(j,V){if(V==="float32"||V==="complex64")return j;if(V==="int32"||V==="bool"){for(var ne=V==="int32"?new Int32Array(j.length):new Uint8Array(j.length),oe=0;oe<ne.length;++oe)ne[oe]=Math.round(j[oe]);return ne}throw new Error("Unknown dtype "+V)}(l,_)),g.values},c.prototype.acquireTexture=function(a,l,g,_){if(this.numBytesInGPU+=this.computeBytes(a,g),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var j=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+j+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(a,l,_)},c.prototype.computeBytes=function(a,l){return a[0]*a[1]*Lt(l)},c}(Ut);function Du(p,c){return p(c={exports:{}},c.exports),c.exports}jn()&&Ve.registerBackend("webgl",function(){return new Lp},2);var Hu=Du(function(p){(function(c,a,l){function g(j,V){return V.c=j.c,V.s0=j.s0,V.s1=j.s1,V.s2=j.s2,V}function _(j,V){var ne=new function(Ee){var _e,Ne=this,Ue=(_e=4022871197,function($e){$e=$e.toString();for(var He=0;He<$e.length;He++){var et=.02519603282416938*(_e+=$e.charCodeAt(He));et-=_e=et>>>0,_e=(et*=_e)>>>0,_e+=4294967296*(et-=_e)}return 23283064365386963e-26*(_e>>>0)});Ne.next=function(){var $e=2091639*Ne.s0+23283064365386963e-26*Ne.c;return Ne.s0=Ne.s1,Ne.s1=Ne.s2,Ne.s2=$e-(Ne.c=0|$e)},Ne.c=1,Ne.s0=Ue(" "),Ne.s1=Ue(" "),Ne.s2=Ue(" "),Ne.s0-=Ue(Ee),Ne.s0<0&&(Ne.s0+=1),Ne.s1-=Ue(Ee),Ne.s1<0&&(Ne.s1+=1),Ne.s2-=Ue(Ee),Ne.s2<0&&(Ne.s2+=1),Ue=null}(j),oe=V&&V.state,me=ne.next;return me.int32=function(){return 4294967296*ne.next()|0},me.double=function(){return me()+11102230246251565e-32*(2097152*me()|0)},me.quick=me,oe&&(typeof oe=="object"&&g(oe,ne),me.state=function(){return g(ne,{})}),me}a&&a.exports?a.exports=_:this.alea=_})(0,p)}),Ig=Du(function(p){(function(c,a,l){function g(j,V){return V.x=j.x,V.y=j.y,V.z=j.z,V.w=j.w,V}function _(j,V){var ne=new function(Ee){var _e=this,Ne="";_e.x=0,_e.y=0,_e.z=0,_e.w=0,_e.next=function(){var $e=_e.x^_e.x<<11;return _e.x=_e.y,_e.y=_e.z,_e.z=_e.w,_e.w^=_e.w>>>19^$e^$e>>>8},Ee===(0|Ee)?_e.x=Ee:Ne+=Ee;for(var Ue=0;Ue<Ne.length+64;Ue++)_e.x^=0|Ne.charCodeAt(Ue),_e.next()}(j),oe=V&&V.state,me=function(){return(ne.next()>>>0)/4294967296};return me.double=function(){do var Ee=((ne.next()>>>11)+(ne.next()>>>0)/4294967296)/2097152;while(Ee===0);return Ee},me.int32=ne.next,me.quick=me,oe&&(typeof oe=="object"&&g(oe,ne),me.state=function(){return g(ne,{})}),me}a&&a.exports?a.exports=_:this.xor128=_})(0,p)}),np=Du(function(p){(function(c,a,l){function g(j,V){return V.x=j.x,V.y=j.y,V.z=j.z,V.w=j.w,V.v=j.v,V.d=j.d,V}function _(j,V){var ne=new function(Ee){var _e=this,Ne="";_e.next=function(){var $e=_e.x^_e.x>>>2;return _e.x=_e.y,_e.y=_e.z,_e.z=_e.w,_e.w=_e.v,(_e.d=_e.d+362437|0)+(_e.v=_e.v^_e.v<<4^$e^$e<<1)|0},_e.x=0,_e.y=0,_e.z=0,_e.w=0,_e.v=0,Ee===(0|Ee)?_e.x=Ee:Ne+=Ee;for(var Ue=0;Ue<Ne.length+64;Ue++)_e.x^=0|Ne.charCodeAt(Ue),Ue==Ne.length&&(_e.d=_e.x<<10^_e.x>>>4),_e.next()}(j),oe=V&&V.state,me=function(){return(ne.next()>>>0)/4294967296};return me.double=function(){do var Ee=((ne.next()>>>11)+(ne.next()>>>0)/4294967296)/2097152;while(Ee===0);return Ee},me.int32=ne.next,me.quick=me,oe&&(typeof oe=="object"&&g(oe,ne),me.state=function(){return g(ne,{})}),me}a&&a.exports?a.exports=_:this.xorwow=_})(0,p)}),Rm=Du(function(p){(function(c,a,l){function g(j,V){return V.x=j.x.slice(),V.i=j.i,V}function _(j,V){j==null&&(j=+new Date);var ne=new function(Ee){var _e=this;_e.next=function(){var Ne,Ue,$e=_e.x,He=_e.i;return Ne=$e[He],Ue=(Ne^=Ne>>>7)^Ne<<24,Ue^=(Ne=$e[He+1&7])^Ne>>>10,Ue^=(Ne=$e[He+3&7])^Ne>>>3,Ue^=(Ne=$e[He+4&7])^Ne<<7,Ne=$e[He+7&7],Ue^=(Ne^=Ne<<13)^Ne<<9,$e[He]=Ue,_e.i=He+1&7,Ue},function(Ne,Ue){var $e,He=[];if(Ue===(0|Ue))He[0]=Ue;else for(Ue=""+Ue,$e=0;$e<Ue.length;++$e)He[7&$e]=He[7&$e]<<15^Ue.charCodeAt($e)+He[$e+1&7]<<13;for(;He.length<8;)He.push(0);for($e=0;$e<8&&He[$e]===0;++$e);for($e==8?He[7]=-1:He[$e],Ne.x=He,Ne.i=0,$e=256;$e>0;--$e)Ne.next()}(_e,Ee)}(j),oe=V&&V.state,me=function(){return(ne.next()>>>0)/4294967296};return me.double=function(){do var Ee=((ne.next()>>>11)+(ne.next()>>>0)/4294967296)/2097152;while(Ee===0);return Ee},me.int32=ne.next,me.quick=me,oe&&(oe.x&&g(oe,ne),me.state=function(){return g(ne,{})}),me}a&&a.exports?a.exports=_:this.xorshift7=_})(0,p)}),k0=Du(function(p){(function(c,a,l){function g(j,V){return V.i=j.i,V.w=j.w,V.X=j.X.slice(),V}function _(j,V){j==null&&(j=+new Date);var ne=new function(Ee){var _e=this;_e.next=function(){var Ne,Ue,$e=_e.w,He=_e.X,et=_e.i;return _e.w=$e=$e+1640531527|0,Ue=He[et+34&127],Ne=He[et=et+1&127],Ue^=Ue<<13,Ne^=Ne<<17,Ue^=Ue>>>15,Ne^=Ne>>>12,Ue=He[et]=Ue^Ne,_e.i=et,Ue+($e^$e>>>16)|0},function(Ne,Ue){var $e,He,et,lt,ht,gt=[],Ct=128;for(Ue===(0|Ue)?(He=Ue,Ue=null):(Ue+="\0",He=0,Ct=Math.max(Ct,Ue.length)),et=0,lt=-32;lt<Ct;++lt)Ue&&(He^=Ue.charCodeAt((lt+32)%Ue.length)),lt===0&&(ht=He),He^=He<<10,He^=He>>>15,He^=He<<4,He^=He>>>13,lt>=0&&(ht=ht+1640531527|0,et=($e=gt[127&lt]^=He+ht)==0?et+1:0);for(et>=128&&(gt[127&(Ue&&Ue.length||0)]=-1),et=127,lt=512;lt>0;--lt)He=gt[et+34&127],$e=gt[et=et+1&127],He^=He<<13,$e^=$e<<17,He^=He>>>15,$e^=$e>>>12,gt[et]=He^$e;Ne.w=ht,Ne.X=gt,Ne.i=et}(_e,Ee)}(j),oe=V&&V.state,me=function(){return(ne.next()>>>0)/4294967296};return me.double=function(){do var Ee=((ne.next()>>>11)+(ne.next()>>>0)/4294967296)/2097152;while(Ee===0);return Ee},me.int32=ne.next,me.quick=me,oe&&(oe.X&&g(oe,ne),me.state=function(){return g(ne,{})}),me}a&&a.exports?a.exports=_:this.xor4096=_})(0,p)}),Iv=Du(function(p){(function(c,a,l){function g(j,V){return V.a=j.a,V.b=j.b,V.c=j.c,V.d=j.d,V}function _(j,V){var ne=new function(Ee){var _e=this,Ne="";_e.next=function(){var $e=_e.b,He=_e.c,et=_e.d,lt=_e.a;return $e=$e<<25^$e>>>7^He,He=He-et|0,et=et<<24^et>>>8^lt,lt=lt-$e|0,_e.b=$e=$e<<20^$e>>>12^He,_e.c=He=He-et|0,_e.d=et<<16^He>>>16^lt,_e.a=lt-$e|0},_e.a=0,_e.b=0,_e.c=-1640531527,_e.d=1367130551,Ee===Math.floor(Ee)?(_e.a=Ee/4294967296|0,_e.b=0|Ee):Ne+=Ee;for(var Ue=0;Ue<Ne.length+20;Ue++)_e.b^=0|Ne.charCodeAt(Ue),_e.next()}(j),oe=V&&V.state,me=function(){return(ne.next()>>>0)/4294967296};return me.double=function(){do var Ee=((ne.next()>>>11)+(ne.next()>>>0)/4294967296)/2097152;while(Ee===0);return Ee},me.int32=ne.next,me.quick=me,oe&&(typeof oe=="object"&&g(oe,ne),me.state=function(){return g(ne,{})}),me}a&&a.exports?a.exports=_:this.tychei=_})(0,p)}),Vl=Du(function(p){(function(c,a){var l,g=this,_=256,j=6,V="random",ne=a.pow(_,j),oe=a.pow(2,52),me=2*oe,Ee=_-1;function _e(et,lt,ht){var gt=[],Ct=$e(function Vt(Ht,vn){var On,Cn=[],Kn=typeof Ht;if(vn&&Kn=="object")for(On in Ht)try{Cn.push(Vt(Ht[On],vn-1))}catch{}return Cn.length?Cn:Kn=="string"?Ht:Ht+"\0"}((lt=lt==1?{entropy:!0}:lt||{}).entropy?[et,He(c)]:et??function(){try{var Vt;return l&&(Vt=l.randomBytes)?Vt=Vt(_):(Vt=new Uint8Array(_),(g.crypto||g.msCrypto).getRandomValues(Vt)),He(Vt)}catch{var Ht=g.navigator,vn=Ht&&Ht.plugins;return[+new Date,g,vn,g.screen,He(c)]}}(),3),gt),Wt=new Ne(gt),Kt=function(){for(var Vt=Wt.g(j),Ht=ne,vn=0;Vt<oe;)Vt=(Vt+vn)*_,Ht*=_,vn=Wt.g(1);for(;Vt>=me;)Vt/=2,Ht/=2,vn>>>=1;return(Vt+vn)/Ht};return Kt.int32=function(){return 0|Wt.g(4)},Kt.quick=function(){return Wt.g(4)/4294967296},Kt.double=Kt,$e(He(Wt.S),c),(lt.pass||ht||function(Vt,Ht,vn,On){return On&&(On.S&&Ue(On,Wt),Vt.state=function(){return Ue(Wt,{})}),vn?(a[V]=Vt,Ht):Vt})(Kt,Ct,"global"in lt?lt.global:this==a,lt.state)}function Ne(et){var lt,ht=et.length,gt=this,Ct=0,Wt=gt.i=gt.j=0,Kt=gt.S=[];for(ht||(et=[ht++]);Ct<_;)Kt[Ct]=Ct++;for(Ct=0;Ct<_;Ct++)Kt[Ct]=Kt[Wt=Ee&Wt+et[Ct%ht]+(lt=Kt[Ct])],Kt[Wt]=lt;(gt.g=function(Vt){for(var Ht,vn=0,On=gt.i,Cn=gt.j,Kn=gt.S;Vt--;)Ht=Kn[On=Ee&On+1],vn=vn*_+Kn[Ee&(Kn[On]=Kn[Cn=Ee&Cn+Ht])+(Kn[Cn]=Ht)];return gt.i=On,gt.j=Cn,vn})(_)}function Ue(et,lt){return lt.i=et.i,lt.j=et.j,lt.S=et.S.slice(),lt}function $e(et,lt){for(var ht,gt=et+"",Ct=0;Ct<gt.length;)lt[Ee&Ct]=Ee&(ht^=19*lt[Ee&Ct])+gt.charCodeAt(Ct++);return He(lt)}function He(et){return String.fromCharCode.apply(0,et)}if(a["seed"+V]=_e,$e(a.random(),c),p.exports){p.exports=_e;try{l=o(390)}catch{}}})([],Math)});Vl.alea=Hu,Vl.xor128=Ig,Vl.xorwow=np,Vl.xorshift7=Rm,Vl.xor4096=k0,Vl.tychei=Iv;var Kh=Vl.alea,Wf=xt({addN_:function(p){we(Array.isArray(p),function(){return"The argument passed to tf.addN() must be a list of tensors"}),we(p.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+p.length});var c=p.map(function(g,_){return Ke(g,"tensors"+_,"addN")}),a=c[0];c.forEach(function(g){if(g.dtype!==a.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),c.forEach(function(g){if(!ln(g.shape,a.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var l=c;return Ve.runKernelFunc(function(g,_){return g.addN(c)},l,null,"AddN")}});function Vf(){Cf("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}function Fg(p){return p.rank===0||p.rank===1?p.as4D(1,1,1,p.size):p.rank===2?p.as4D(1,1,p.shape[0],p.shape[1]):p.rank===3?p.as4D(1,p.shape[0],p.shape[1],p.shape[2]):p}function Mm(p,c,a,l,g,_){_==null&&(_=.001);var j,V,ne=Ke(p,"x","batchNorm"),oe=Ke(c,"mean","batchNorm"),me=Ke(a,"variance","batchNorm");g!=null&&(j=Ke(g,"scale","batchNorm")),l!=null&&(V=Ke(l,"offset","batchNorm")),we(oe.rank===me.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),we(V==null||oe.rank===V.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),we(j==null||oe.rank===j.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."});var Ee={x:ne,scale:j,offset:V,mean:oe,variance:me},_e={varianceEpsilon:_};return Ve.runKernelFunc(function(Ne,Ue){var $e=Fg(ne),He=Ne.batchNormalization($e,qf(oe),qf(me),_,qf(j),qf(V));return Ue([ne,oe,me,j]),He},Ee,null,"FusedBatchNorm",_e).reshape(ne.shape)}function qf(p){return p==null?null:p.rank===0?p.as1D():p.rank===1?p:p.rank===2?p.as4D(1,1,p.shape[0],p.shape[1]):p.rank===3?p.as4D(1,p.shape[0],p.shape[1],p.shape[2]):p}var ta=xt({batchNormalization_:function(p,c,a,l,g,_){return l===void 0&&(l=.001),Vf(),Mm(p,c,a,_,g,l)}}),ql=xt({batchNorm_:Mm});function Xh(p,c,a,l,g,_){var j,V,ne=Ke(p,"x","batchNorm"),oe=Ke(c,"mean","batchNorm"),me=Ke(a,"variance","batchNorm");return g!=null&&(j=Ke(g,"scale","batchNorm")),l!=null&&(V=Ke(l,"offset","batchNorm")),we(ne.rank===2,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+ne.rank+"."}),we(oe.rank===2||oe.rank===1,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+oe.rank+"."}),we(me.rank===2||me.rank===1,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+me.rank+"."}),j!=null&&we(j.rank===2||j.rank===1,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+j.rank+"."}),V!=null&&we(V.rank===2||V.rank===1,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+V.rank+"."}),ql(ne,oe,me,V,j,_)}var Fv=xt({batchNormalization2d_:function(p,c,a,l,g,_){return l===void 0&&(l=.001),Vf(),Xh(p,c,a,_,g,l)}}),Rv=xt({batchNorm2d_:Xh});function zp(p,c,a,l,g,_){var j,V,ne=Ke(p,"x","batchNorm"),oe=Ke(c,"mean","batchNorm"),me=Ke(a,"variance","batchNorm");return g!=null&&(j=Ke(g,"scale","batchNorm")),l!=null&&(V=Ke(l,"offset","batchNorm")),we(ne.rank===3,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+ne.rank+"."}),we(oe.rank===3||oe.rank===1,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+oe.rank+"."}),we(me.rank===3||me.rank===1,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+me.rank+"."}),j!=null&&we(j.rank===3||j.rank===1,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+j.rank+"."}),V!=null&&we(V.rank===3||V.rank===1,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+V.rank+"."}),ql(ne,oe,me,V,j,_)}var Hl=xt({batchNormalization3d_:function(p,c,a,l,g,_){return l===void 0&&(l=.001),Vf(),zp(p,c,a,_,g,l)}}),al=xt({batchNorm3d_:zp});function rp(p,c,a,l,g,_){var j,V,ne=Ke(p,"x","batchNorm"),oe=Ke(c,"mean","batchNorm"),me=Ke(a,"variance","batchNorm");return g!=null&&(j=Ke(g,"scale","batchNorm")),l!=null&&(V=Ke(l,"offset","batchNorm")),we(ne.rank===4,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+ne.rank+"."}),we(oe.rank===4||oe.rank===1,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+oe.rank+"."}),we(me.rank===4||me.rank===1,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+me.rank+"."}),j!=null&&we(j.rank===4||j.rank===1,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+j.rank+"."}),V!=null&&we(V.rank===4||V.rank===1,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+V.rank+"."}),ql(ne,oe,me,V,j,_)}var Yh=xt({batchNormalization4d_:function(p,c,a,l,g,_){return l===void 0&&(l=.001),Vf(),rp(p,c,a,_,g,l)}}),Hf=xt({batchNorm4d_:rp}),$l=xt({broadcastTo_:function(p,c){var a=Ke(p,"broadcastTo","x"),l=a.shape;if(c.some(function(Ee){return!(Ee>0)||Ee%1!=0}))throw new Error("broadcastTo(): Invalid broadcast shape ["+c+"].");if(c.length<a.rank)throw new Error("broadcastTo(): shape.length="+c.length+" < input.rank="+a.rank+".");if(c.length>a.rank){for(var g=a.shape.slice();g.length<c.length;)g.unshift(1);a=a.reshape(g)}for(var _=a.shape,j=Array.from(c),V=c.length-1;V>=0;V--)if(_[V]===c[V])j[V]=1;else if(a.shape[V]!==1)throw new Error("broadcastTo(): ["+l+"] cannot be broadcast to ["+c+"].");var ne=j.map(function(Ee,_e){return Ee>1?_e:-1}).filter(function(Ee){return Ee>=0});if(ne.length===0)return a.clone();var oe={x:a},me={shape:c,inputShape:_};return Ve.runKernelFunc(function(Ee){return Ee.tile(a,j)},oe,function(Ee){return{x:function(){return Ee.sum(ne,!0)}}},Ec,me)}}),Gl=xt({clone_:function(p){var c=Ke(p,"x","clone",null);return Ve.runKernelFunc(function(){return Ve.makeTensorFromDataId(c.dataId,c.shape,c.dtype)},{x:c},null,Sf)}}),Tu=xt({logicalAnd_:function(p,c){var a=Ke(p,"a","logicalAnd","bool"),l=Ke(c,"b","logicalAnd","bool");return Mi(a.shape,l.shape),Ve.runKernelFunc(function(g){return g.logicalAnd(a,l)},{a,b:l},null,"LogicalAnd")}}),Jh=xt({logicalNot_:function(p){var c=Ke(p,"x","logicalNot","bool");return Ve.runKernelFunc(function(a){return a.logicalNot(c)},{$x:c})}}),$f=xt({logicalOr_:function(p,c){var a=Ke(p,"a","logicalOr","bool"),l=Ke(c,"b","logicalOr","bool");return Mi(a.shape,l.shape),Ve.runKernelFunc(function(g){return g.logicalOr(a,l)},{$a:a,$b:l})}}),ol=xt({logicalXor_:function(p,c){var a=Ke(p,"a","logicalXor","bool"),l=Ke(c,"b","logicalXor","bool");return Mi(a.shape,l.shape),$f(p,c).logicalAnd(Tu(p,c).logicalNot())}}),Nc=xt({where_:function(p,c,a){var l=Ke(c,"a","where"),g=Ke(a,"b","where"),_=Ke(p,"condition","where","bool");return Tt(l.shape,g.shape,"Error in where: "),_.rank===1?we(_.shape[0]===l.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):Tt(_.shape,g.shape,"Error in where: "),Ve.runKernelFunc(function(j,V){var ne=j.select(_,l,g);return V([_]),ne},{$condition:_,$a:l,$b:g},function(j,V){var ne=V[0];return{$condition:function(){return ii(ne).toFloat()},$a:function(){return j.mul(ne.cast(j.dtype))},$b:function(){return j.mul(ne.logicalNot().cast(j.dtype))}}})}}),Gf=function(p){return R(this,void 0,void 0,function(){var c,a,l;return P(this,function(g){switch(g.label){case 0:return[4,(c=Ke(p,"condition","whereAsync","bool")).data()];case 1:return a=g.sent(),l=Ja(c.shape,a),p!==c&&c.dispose(),[2,l]}})})},Up=xt({divNoNan_:function(p,c){var a,l=Ke(p,"a","div"),g=Ke(c,"b","div");l=(a=An(l,g))[0],g=a[1];var _=Xa(l,g),j=ii(_),V=g.equal(j);return Nc(V,j,_)}}),Kf=xt({tile_:function(p,c){var a=Ke(p,"x","tile",null);we(a.rank===c.length,function(){return"Error in transpose: rank of input "+a.rank+" must match length of reps "+c+"."});var l=[a],g={x:a},_={reps:c};return Ve.runKernelFunc(function(j,V){var ne=j.tile(a,c);return V([a]),ne},g,null,Nl,_,l)}}),Ic=xt({eye_:function(p,c,a,l){l===void 0&&(l="float32"),c==null&&(c=p);for(var g=bi([p,c],l),_=p<=c?p:c,j=0;j<_;++j)g.set(1,j,j);var V=g.toTensor().as2D(p,c);if(a==null)return V;if(a.length===1)return Kf(zu(V,0),[a[0],1,1]);if(a.length===2)return Kf(zu(zu(V,0),0),[a[0],a[1],1,1]);if(a.length===3)return Kf(zu(zu(zu(V,0),0),0),[a[0],a[1],a[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+a.length+"D.")}}),ts=xt({multinomial_:function(p,c,a,l){l===void 0&&(l=!1);var g=Ke(p,"logits","multinomial"),_=g.size,j=g.rank;if(_<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+_+".");if(j>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+j);a=a||Math.random();var V=j===1?g.as2D(1,-1):g,ne=Ve.runKernelFunc(function(oe){return oe.multinomial(V,l,c,a)},{logits2D:V});return j===1?ne.as1D():ne}}),fc=xt({oneHot_:function(p,c,a,l){if(a===void 0&&(a=1),l===void 0&&(l=0),c<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+c);var g=Ke(p,"indices","oneHot","int32"),_=g.shape.concat([c]),j={indices:g=g.flatten()},V={depth:c,onValue:a,offValue:l};return Ve.runKernelFunc(function(ne,oe){return oe([g]),ne.oneHot(g,c,a,l)},j,null,Lh,V).reshape(_)}}),Nu=xt({pad_:function(p,c,a){a===void 0&&(a=0);var l=Ke(p,"x","pad");if(l.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var g={paddings:c,constantValue:a},_={x:l};return Ve.runKernelFunc(function(j,V){return V([l]),j.pad(l,c,a)},_,null,Cc,g)}}),hu=xt({pad1d_:function(p,c,a){return a===void 0&&(a=0),we(c.length===2,function(){return"Invalid number of paddings. Must be length of 2."}),Nu(p,[c],a)}}),Qh=xt({pad2d_:function(p,c,a){return a===void 0&&(a=0),we(c.length===2&&c[0].length===2&&c[1].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Nu(p,c,a)}}),Wp=xt({pad3d_:function(p,c,a){return a===void 0&&(a=0),we(c.length===3&&c[0].length===2&&c[1].length===2&&c[2].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Nu(p,c,a)}}),jm=xt({pad4d_:function(p,c,a){return a===void 0&&(a=0),we(c.length===4&&c[0].length===2&&c[1].length===2&&c[2].length===2&&c[3].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Nu(p,c,a)}}),Bm=xt({rand_:function(p,c,a){var l=Ye(p),g=null;if(a==null||a==="float32")g=new Float32Array(l);else if(a==="int32")g=new Int32Array(l);else{if(a!=="bool")throw new Error("Unknown data type "+a);g=new Uint8Array(l)}for(var _=0;_<l;_++)g[_]=c();return Ve.makeTensor(g,p,a)}}),ip=.001,Fa=.1;function ap(){return Ve.backend.floatPrecision()===32?ip:Fa}function hc(p,c,a){var l=!0;if((Et(p)||Et(c))&&(l=!1),Et(p)&&Et(c)&&(l=!0),l){var g=p.constructor.name,_=c.constructor.name;if(g!==_)throw new Error("Arrays are of different type. Actual: "+g+". Expected: "+_)}if(Array.isArray(p)&&Array.isArray(c)){var j=zo(p),V=zo(c);if(!ln(j,V))throw new Error("Arrays have different shapes. Actual: ["+j+"]. Expected: ["+V+"]")}var ne=Et(p)?p:Pt(p),oe=Et(c)?c:Pt(c);if(ne.length!==oe.length)throw new Error("Arrays have different lengths actual: "+ne.length+" vs expected: "+oe.length+`.
Actual:   `+ne+`.
Expected: `+oe+".");for(var me=0;me<oe.length;++me){var Ee=ne[me],_e=oe[me];if(!a(Ee,_e))throw new Error("Arrays differ: actual["+me+"] = "+Ee+", expected["+me+"] = "+_e+`.
Actual:   `+ne+`.
Expected: `+oe+".")}}function Xf(p,c,a){return!isFinite(p)&&!isFinite(c)||!(isNaN(p)||isNaN(c)||Math.abs(p-c)>a)}var Yf=Object.freeze({TEST_EPSILON_FLOAT16:Fa,expectArraysClose:function(p,c,a){return a==null&&(a=ap()),hc(p,c,function(l,g){return Xf(l,g,a)})},testEpsilon:ap,expectPromiseToFail:function(p,c){p().then(function(){return c.fail()},function(){return c()})},expectArraysEqual:function(p,c){var a=typeof c=="string"||typeof c=="number"||typeof c=="boolean"?[c]:c;return Sn(p)||Sn(p[0])||Sn(c)||Sn(c[0])?hc(p,a,function(l,g){return l==g}):hc(p,c,function(l,g){return Xf(l,g,0)})},expectNumbersClose:function(p,c,a){if(a==null&&(a=ap()),!Xf(p,c,a))throw new Error("Numbers differ: actual === "+p+", expected === "+c)},expectValuesInRange:function(p,c,a){for(var l=0;l<p.length;l++)if(p[l]<c||p[l]>a)throw new Error("Value out of range:"+p[l]+" low: "+c+", high: "+a)},expectArrayBuffersEqual:function(p,c){expect(new Float32Array(p)).toEqual(new Float32Array(c))}}),op=function(){function p(c,a,l,g,_){this.mean=c,this.stdDev=a,this.dtype=l,this.nextVal=NaN,this.truncated=g,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var j=_||Math.random();this.random=Kh(j.toString())}return p.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var c=this.nextVal;return this.nextVal=NaN,c}for(var a,l,g=!1;!g;){var _=void 0,j=void 0,V=void 0;do V=(_=2*this.random()-1)*_+(j=2*this.random()-1)*j;while(V>=1||V===0);var ne=Math.sqrt(-2*Math.log(V)/V);a=this.mean+this.stdDev*_*ne,l=this.mean+this.stdDev*j*ne,this.truncated&&!this.isValidTruncated(a)||(g=!0)}return this.truncated&&!this.isValidTruncated(l)||(this.nextVal=this.convertValue(l)),this.convertValue(a)},p.prototype.convertValue=function(c){return this.dtype==null||this.dtype==="float32"?c:Math.round(c)},p.prototype.isValidTruncated=function(c){return c<=this.upper&&c>=this.lower},p}(),Vp=function(){function p(c,a,l,g){this.alpha=c,this.beta=1/a,this.dtype=l;var _=g||Math.random();this.randu=Kh(_.toString()),this.randn=new op(0,1,l,!1,this.randu()),this.d=c<1?c+2/3:c-1/3,this.c=1/Math.sqrt(9*this.d)}return p.prototype.nextValue=function(){for(var c,a,l,g,_,j;;){do g=this.randn.nextValue(),j=1+this.c*g;while(j<=0);if(j*=j*j,a=1-.331*(c=g*g)*c,l=.5*c+this.d*(1-j+Math.log(j)),(_=this.randu())<a||Math.log(_)<l)break}return j=1/this.beta*this.d*j,this.alpha<1&&(j*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(j)},p.prototype.convertValue=function(c){return this.dtype==="float32"?c:Math.round(c)},p}(),qp=function(){function p(c,a,l,g){var _=this;if(c===void 0&&(c=0),a===void 0&&(a=1),this.canReturnFloat=function(){return _.dtype==null||_.dtype==="float32"},this.min=c,this.range=a-c,this.dtype=l,g==null&&(g=Math.random()),typeof g=="number"&&(g=g.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+c+" - "+a+" <= 1 and dtype is not float");this.random=Kh(g)}return p.prototype.convertValue=function(c){return this.canReturnFloat()?c:Math.round(c)},p.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},p}(),Hp=xt({randomGamma_:function(p,c,a,l,g){if(a===void 0&&(a=1),l===void 0&&(l="float32"),a==null&&(a=1),l==null&&(l="float32"),l!=="float32"&&l!=="int32")throw new Error("Unsupported data type "+l);for(var _=new Vp(c,a,l,g),j=bi(p,l),V=0;V<j.values.length;V++)j.values[V]=_.nextValue();return j.toTensor()}}),Rg=xt({randomNormal_:function(p,c,a,l,g){if(c===void 0&&(c=0),a===void 0&&(a=1),l!=null&&l==="bool")throw new Error("Unsupported data type "+l);for(var _=new op(c,a,l,!1,g),j=bi(p,l),V=0;V<j.values.length;V++)j.values[V]=_.nextValue();return j.toTensor()}}),$p=xt({randomUniform_:function(p,c,a,l,g){c===void 0&&(c=0),a===void 0&&(a=1),l===void 0&&(l="float32");for(var _=bi(p,l),j=new qp(c,a,null,g),V=0;V<_.values.length;V++)_.values[V]=j.nextValue();return _.toTensor()}}),Kl=xt({square_:function(p){var c=Ke(p,"x","square"),a=[c];return Ve.runKernelFunc(function(l,g){return g([c]),l.square(c)},{x:c},null,"Square",{},a,[])}}),Gp=xt({squaredDifference_:function(p,c){var a,l=Ke(p,"a","squaredDifference"),g=Ke(c,"b","squaredDifference");a=An(l,g),l=a[0],g=a[1],Mi(l.shape,g.shape);var _={a:l,b:g},j=[l,g];return Ve.runKernelFunc(function(V,ne){var oe=V.squaredDifference(l,g);return ne([l,g]),oe},_,function(V,ne){var oe=ne[0],me=ne[1],Ee=fr(2);return{a:function(){return V.mul(oe.sub(me).mul(Ee))},b:function(){return V.mul(me.sub(oe).mul(Ee))}}},Dl,{},j,[])}}),Zh=xt({truncatedNormal_:function(p,c,a,l,g){if(c===void 0&&(c=0),a===void 0&&(a=1),l!=null&&l==="bool")throw new Error("Unsupported data type $ { dtype }");for(var _=new op(c,a,l,!0,g),j=bi(p,l),V=0;V<j.values.length;V++)j.values[V]=_.nextValue();return j.toTensor()}}),Kp=xt({equal_:function(p,c){var a,l=Ke(p,"a","equal"),g=Ke(c,"b","equal");return a=An(l,g),l=a[0],g=a[1],Mi(l.shape,g.shape),Ve.runKernelFunc(function(_){return _.equal(l,g)},{$a:l,$b:g})}}),Pm=xt({equalStrict_:function(p,c){var a=Ke(p,"a","equalStrict"),l=Ke(c,"b","equalStrict");return Tt(a.shape,l.shape,"Error in equalStrict: "),a.equal(l)}}),Lm=xt({greater_:function(p,c){var a,l=Ke(p,"a","greater"),g=Ke(c,"b","greater");return a=An(l,g),l=a[0],g=a[1],Mi(l.shape,g.shape),Ve.runKernelFunc(function(_){return _.greater(l,g)},{a:l,b:g},null,"Greater")}}),sp=xt({greaterEqual_:function(p,c){var a,l=Ke(p,"a","greaterEqual"),g=Ke(c,"b","greaterEqual");return a=An(l,g),l=a[0],g=a[1],Mi(l.shape,g.shape),Ve.runKernelFunc(function(_,j){var V=_.greaterEqual(l,g);return j([l,g]),V},{a:l,b:g},function(_,j){var V=j[0],ne=j[1];return{a:function(){return ii(V)},b:function(){return ii(ne)}}},"GreaterEqual")}}),zm=xt({greaterEqualStrict_:function(p,c){var a=Ke(p,"a","greaterEqualStrict"),l=Ke(c,"b","greaterEqualStrict");return Tt(a.shape,l.shape,"Error in greaterEqualStrict: "),a.greaterEqual(l)}}),Xp=xt({greaterStrict_:function(p,c){var a=Ke(p,"a","greaterStrict"),l=Ke(c,"b","greaterStrict");return Tt(a.shape,l.shape,"Error in greaterStrict: "),a.greater(l)}}),Mg=xt({less_:function(p,c){var a,l=Ke(p,"a","less"),g=Ke(c,"b","less");return a=An(l,g),l=a[0],g=a[1],Mi(l.shape,g.shape),Ve.runKernelFunc(function(_){return _.less(l,g)},{a:l,b:g},null,"Less")}}),sl=xt({lessEqual_:function(p,c){var a,l=Ke(p,"a","lessEqual"),g=Ke(c,"b","lessEqual");return a=An(l,g),l=a[0],g=a[1],Mi(l.shape,g.shape),Ve.runKernelFunc(function(_,j){var V=_.lessEqual(l,g);return j([l,g]),V},{a:l,b:g},null,"LessEqual")}}),Mv=xt({lessEqualStrict_:function(p,c){var a=Ke(p,"a","lessEqualStrict"),l=Ke(c,"b","lessEqualStrict");return Tt(a.shape,l.shape,"Error in lessEqualStrict: "),a.lessEqual(l)}}),jg=xt({lessStrict_:function(p,c){var a=Ke(p,"a","lessStrict"),l=Ke(c,"b","lessStrict");return Tt(a.shape,l.shape,"Error in lessStrict: "),a.less(l)}}),up=xt({notEqual_:function(p,c){var a,l=Ke(p,"a","notEqual"),g=Ke(c,"b","notEqual");return a=An(l,g),l=a[0],g=a[1],Mi(l.shape,g.shape),Ve.runKernelFunc(function(_){return _.notEqual(l,g)},{a:l,b:g},null,"NotEqual")}}),Bg=xt({notEqualStrict_:function(p,c){var a=Ke(p,"a","notEqualStrict"),l=Ke(c,"b","notEqualStrict");return Tt(a.shape,l.shape,"Error in notEqualStrict: "),a.notEqual(l)}});function Xl(p,c){for(var a=[],l=p;l<c;++l)a.push(l);return a}function Pg(p){for(var c=[],a=0;a<p.length;++a)for(var l=0;l<p[a].length;++l)c.push(p[a][l]);return c}var cp=xt({gather_:function(p,c,a){a===void 0&&(a=0);var l=Ke(p,"x","gather"),g=Ke(c,"indices","gather","int32");a=xn(a,l.shape)[0];var _=function(j,V,ne){for(var oe=j.shape[ne],me=[],Ee=1,_e=1,Ne=0;Ne<ne;Ne++)me.push(j.shape[Ne]),Ee*=j.shape[Ne];for(Ne=0;Ne<V.rank;Ne++)me.push(V.shape[Ne]);for(Ne=ne+1;Ne<j.rank;Ne++)me.push(j.shape[Ne]),_e*=j.shape[Ne];return{batchSize:Ee,sliceSize:_e,dimSize:oe,outputShape:me}}(l,g,a);return Ve.runKernelFunc(function(j,V){var ne=j.gather(l,g.flatten(),a);return V([g]),ne},{x:l,indices:g},function(j,V){var ne=V[0];return{x:function(){var oe=l.shape,me=ne.size,Ee=oe.slice(0,a),_e=Ee.length,Ne=oe.slice(a,oe.length).slice(1),Ue=Ne.length,$e=Xl(0,_e),He=Xl(_e+1,_e+1+Ue),et=Pg([Ee,[me],Ne]),lt=j.reshape(et),ht=ne.reshape([me]),gt=Pg([[_e],$e,He]),Ct=lt.transpose(gt),Wt=Yp(Ct,ht,l.shape[a]),Kt=wu(gt);return Wt.transpose(Kt)},indices:function(){return ne}}},"Gather",{axis:a}).reshape(_.outputShape)}}),Yp=xt({unsortedSegmentSum_:function(p,c,a){var l=Ke(p,"x","unsortedSegmentSum"),g=Ke(c,"segmentIds","unsortedSegmentSum","int32");return we(Zt(a),function(){return"numSegments must be of dtype int"}),Ve.runKernelFunc(function(_,j){var V=_.unsortedSegmentSum(l,g,a);return j([g]),V},{$x:l},function(_,j){var V=j[0];return{$x:function(){return function(ne,oe){for(var me=bo(oe,ii(oe)),Ee=cp(ne,me),_e=sp(oe,fr(0,"int32")),Ne=Ee.rank-_e.rank,Ue=0;Ue<Ne;++Ue)_e=zu(_e,Ue+1);_e=Tu(_e,uu(Ee.shape,"bool"));var $e=ii(Ee);return Nc(_e,Ee,$e)}(_,V)}}})}}),Lg=function(p,c,a){return R(this,void 0,void 0,function(){var l,g,_,j,V,ne,oe,me,Ee,_e,Ne,Ue,$e;return P(this,function(He){switch(He.label){case 0:for(l=Ke(p,"tensor","boolMask"),g=Ke(c,"mask","boolMask","bool"),_=a??0,j=g.rank,V=l.shape,we(j>0,function(){return"mask cannot be scalar"}),Tt(V.slice(_,_+j),g.shape,"mask's shape must match the first K dimensions of tensor's shape,"),ne=1,oe=_;oe<_+j;oe++)ne*=V[oe];return me=V.slice(0,_).concat([ne],V.slice(_+j)),Ee=l.reshape(me),_e=g.reshape([-1]),[4,Gf(_e)];case 1:return Ne=He.sent(),Ue=Ne.squeeze([1]),$e=cp(Ee,Ue,_),p!==l&&l.dispose(),c!==g&&g.dispose(),Ue.dispose(),Ee.dispose(),_e.dispose(),Ne.dispose(),[2,$e]}})})};function zg(p,c,a,l,g,_,j){_===void 0&&(_="NHWC"),we(p.length===c.rank,function(){return"Length of inShape ("+p.length+") and rank of dy ("+c.rank+") must match"});var V=p,ne=c,oe=!1;c.rank===3&&(oe=!0,ne=c.as4D(1,c.shape[0],c.shape[1],c.shape[2]),V=[1,p[0],p[1],p[2]]),we(V.length===4,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+V.length+"."}),we(ne.rank===4,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+ne.rank}),we(a.rank===4,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+a.rank});var me=_==="NHWC"?V[3]:V[1],Ee=_==="NHWC"?ne.shape[3]:ne.shape[1];we(me===a.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+me+") must match input depth for filter "+a.shape[2]+"."}),we(Ee===a.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+Ee+") must match output depth for filter "+a.shape[3]+"."}),j!=null&&we(Zt(g),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+j+" but got pad "+g+"."});var _e=Hr(_),Ne=Nn(V,a.shape,l,1,g,j,!1,_e),Ue=Ve.runKernelFunc(function($e,He){var et=$e.conv2dDerInput(ne,a,Ne);return He([a,ne]),et},{dy4D:ne,filter:a},function($e,He){var et=He[0],lt=He[1];return{dy4D:function(){return Jf($e,et,l,g,_,1,j)},filter:function(){return Vg($e,lt,et.shape,l,g,_,j)}}});return oe?Ue.as3D(Ue.shape[1],Ue.shape[2],Ue.shape[3]):Ue}function Um(p){var c=function(_){return typeof _=="number"?[_,_,_]:_.length===2?[_[0],_[1],1]:_}(p),a=c[0],l=c[1],g=c[2];return a===1&&l===1&&g===1}function Ug(p,c,a,l,g){we(p.length===c.rank,function(){return"Length of inShape ("+p.length+") and rank of dy ("+c.rank+") must match"});var _=p,j=c,V=!1;c.rank===4&&(V=!0,j=c.as5D(1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]),_=[1,p[0],p[1],p[2],p[3]]);var ne=_[4],oe=j.shape[4];we(_.length===5,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+_.length+"."}),we(j.rank===5,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+j.rank}),we(a.rank===5,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+a.rank}),we(ne===a.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+ne+") must match input depth for filter "+a.shape[3]+"."}),we(oe===a.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+oe+") must match output depth for filter "+a.shape[4]+"."});var me=Wn(_,a.shape,l,1,g),Ee=Ve.runKernelFunc(function(_e){return _e.conv3dDerInput(j,a,me)},{dy5D:j});return V?Ee.as4D(Ee.shape[1],Ee.shape[2],Ee.shape[3],Ee.shape[4]):Ee}var Wg=xt({conv1d_:function(p,c,a,l,g,_,j){g===void 0&&(g="NWC"),_===void 0&&(_=1);var V=Ke(p,"x","conv1d"),ne=Ke(c,"filter","conv1d"),oe=V,me=!1;V.rank===2&&(me=!0,oe=V.as3D(1,V.shape[0],V.shape[1])),we(oe.rank===3,function(){return"Error in conv1d: input must be rank 3, but got rank "+oe.rank+"."}),we(ne.rank===3,function(){return"Error in conv1d: filter must be rank 3, but got rank "+ne.rank+"."}),j!=null&&we(Zt(l),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+j+" but got pad "+l+"."}),we(oe.shape[2]===ne.shape[1],function(){return"Error in conv1d: depth of input ("+oe.shape[2]+") must match input depth for filter "+ne.shape[1]+"."}),we(wr(a,_),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+a+" and dilation '"+_+"'"}),we(g==="NWC",function(){return"Error in conv1d: got dataFormat of "+g+" but only NWC is currently supported."});var Ee=ne.as4D(1,ne.shape[0],ne.shape[1],ne.shape[2]),_e=oe.as4D(oe.shape[0],1,oe.shape[1],oe.shape[2]),Ne=Jf(_e,Ee,[1,a],l,"NHWC",[1,_],j);return me?Ne.as2D(Ne.shape[2],Ne.shape[3]):Ne.as3D(Ne.shape[0],Ne.shape[2],Ne.shape[3])}}),Jf=xt({conv2d_:function(p,c,a,l,g,_,j){g===void 0&&(g="NHWC"),_===void 0&&(_=[1,1]);var V=Ke(p,"x","conv2d"),ne=Ke(c,"filter","conv2d"),oe=V,me=!1;V.rank===3&&(me=!0,oe=V.as4D(1,V.shape[0],V.shape[1],V.shape[2])),we(oe.rank===4,function(){return"Error in conv2d: input must be rank 4, but got rank "+oe.rank+"."}),we(ne.rank===4,function(){return"Error in conv2d: filter must be rank 4, but got rank "+ne.rank+"."}),j!=null&&we(Zt(l),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+j+" but got pad "+l+"."});var Ee=g==="NHWC"?oe.shape[3]:oe.shape[1];we(Ee===ne.shape[2],function(){return"Error in conv2d: depth of input ("+Ee+") must match input depth for filter "+ne.shape[2]+"."}),we(wr(a,_),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+a+" and dilations '"+_+"'"});var _e=Hr(g),Ne=Nn(oe.shape,ne.shape,a,_,l,j,!1,_e),Ue=[ne,oe],$e=Ve.runKernelFunc(function(He,et){var lt=He.conv2d(oe,ne,Ne);return et([ne,oe]),lt},{x:oe,filter:ne},function(He,et){var lt=et,ht=lt[0],gt=lt[1];return we(Vr(_),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+_+"'"}),{x:function(){return ul(gt.shape,He,ht,a,l,g)},filter:function(){return Vg(gt,He,ht.shape,a,l,g)}}},"Conv2D",Ne,Ue);return me?$e.as3D($e.shape[1],$e.shape[2],$e.shape[3]):$e}}),jv=xt({conv3d_:function(p,c,a,l,g,_){g===void 0&&(g="NDHWC"),_===void 0&&(_=[1,1,1]);var j=Ke(p,"x","conv3d"),V=Ke(c,"filter","conv3d"),ne=j,oe=!1;j.rank===4&&(oe=!0,ne=j.as5D(1,j.shape[0],j.shape[1],j.shape[2],j.shape[3])),we(ne.rank===5,function(){return"Error in conv3d: input must be rank 5, but got rank "+ne.rank+"."}),we(V.rank===5,function(){return"Error in conv3d: filter must be rank 5, but got rank "+V.rank+"."}),we(ne.shape[4]===V.shape[3],function(){return"Error in conv3d: depth of input ("+ne.shape[4]+") must match input depth for filter "+V.shape[3]+"."}),we(function(_e,Ne){return Um(a)||Um(Ne)}(0,_),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+a+" and dilations '"+_+"'"}),we(g==="NDHWC",function(){return"Error in conv3d: got dataFormat of "+g+" but only NDHWC is currently supported."});var me=Wn(ne.shape,V.shape,a,_,l),Ee=Ve.runKernelFunc(function(_e,Ne){var Ue=_e.conv3d(ne,V,me);return Ne([ne,V]),Ue},{x:ne,$filter:V},function(_e,Ne){we(Um(_),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+_+"'"});var Ue=Ne[0],$e=Ne[1];return{x:function(){return Ug(Ue.shape,_e,$e,a,l)},$filter:function(){return function(He,et,lt,ht,gt){var Ct=He;He.rank===4&&(Ct=He.as5D(1,He.shape[0],He.shape[1],He.shape[2],He.shape[3]));var Wt=et;Wt.rank===4&&(Wt=et.as5D(1,et.shape[0],et.shape[1],et.shape[2],et.shape[3])),we(Ct.rank===5,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+Ct.shape+"."}),we(Wt.rank===5,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+Wt.shape+"."}),we(lt.length===5,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+lt+"."}),we(Ct.shape[4]===lt[3],function(){return"Error in conv3dDerFilter: depth of input "+Ct.shape[4]+") must match input depth in filter ("+lt[3]+"."}),we(Wt.shape[4]===lt[4],function(){return"Error in conv3dDerFilter: depth of dy ("+Wt.shape[4]+") must match output depth for filter ("+lt[4]+")."});var Kt=Wn(Ct.shape,lt,ht,1,gt);return Ve.runKernelFunc(function(Vt){return Vt.conv3dDerFilter(Ct,Wt,Kt)},{x5D:Ct,dy5D:Wt})}(Ue,_e,$e.shape,a,l)}}});return oe?Ee.as4D(Ee.shape[1],Ee.shape[2],Ee.shape[3],Ee.shape[4]):Ee}}),Vg=xt({conv2dDerFilter_:function(p,c,a,l,g,_,j){_===void 0&&(_="NHWC");var V=p;p.rank===3&&(V=p.as4D(1,p.shape[0],p.shape[1],p.shape[2]));var ne=c;ne.rank===3&&(ne=c.as4D(1,c.shape[0],c.shape[1],c.shape[2])),we(V.rank===4,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+V.shape+"."}),we(ne.rank===4,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+ne.shape+"."}),we(a.length===4,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+a+"."});var oe=_==="NHWC"?V.shape[3]:V.shape[1],me=_==="NHWC"?ne.shape[3]:ne.shape[1];we(oe===a[2],function(){return"Error in conv2dDerFilter: depth of input "+oe+") must match input depth in filter ("+a[2]+"."}),we(me===a[3],function(){return"Error in conv2dDerFilter: depth of dy ("+me+") must match output depth for filter ("+a[3]+")."}),j!=null&&we(Zt(g),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+j+" but got pad "+g+"."});var Ee=Hr(_),_e=Nn(V.shape,a,l,1,g,j,!1,Ee);return Ve.runKernelFunc(function(Ne){return Ne.conv2dDerFilter(V,ne,_e)},{x4D:V,dy4D:ne})}}),ul=xt({conv2dDerInput_:zg}),Wm=xt({depthwiseConv2d_:function(p,c,a,l,g,_,j){_===void 0&&(_=[1,1]);var V=Ke(p,"x","depthwiseConv2d"),ne=Ke(c,"filter","depthwiseConv2d"),oe=V,me=!1;V.rank===3&&(me=!0,oe=V.as4D(1,V.shape[0],V.shape[1],V.shape[2])),we(oe.rank===4,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+oe.rank+"."}),we(ne.rank===4,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+ne.rank+"."}),we(oe.shape[3]===ne.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+oe.shape[3]+") must match the inChannels dimension in filter "+ne.shape[2]+"."}),_==null&&(_=[1,1]),we(wr(a,_),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+a+" and dilations '"+_+"'"}),j!=null&&we(Zt(l),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+j+" but got pad "+l+"."});var Ee=Nn(oe.shape,ne.shape,a,_,l,j,!0),_e=[oe,ne],Ne=Ve.runKernelFunc(function(Ue,$e){var He=Ue.depthwiseConv2D(oe,ne,Ee);return $e([oe,ne]),He},{x:oe,filter:ne},function(Ue,$e){we(Vr(_),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+_+"'"});var He=$e[0],et=$e[1];return{x:function(){return qg(He.shape,Ue,et,Ee)},filter:function(){return Qf(He,Ue,et.shape,Ee)}}},"DepthwiseConv2dNative",Ee,_e);return me?Ne.as3D(Ne.shape[1],Ne.shape[2],Ne.shape[3]):Ne}}),qg=xt({depthwiseConv2dDerInput_:function(p,c,a,l){var g=c,_=!1;c.rank===3&&(_=!0,g=c.as4D(1,c.shape[0],c.shape[1],c.shape[2]));var j=Ve.runKernelFunc(function(V){return V.depthwiseConv2DDerInput(g,a,l)},{dy4D:g});return _?j.as3D(j.shape[1],j.shape[2],j.shape[3]):j}}),Qf=xt({depthwiseConv2dDerFilter_:function(p,c,a,l){var g=p;p.rank===3&&(g=p.as4D(1,p.shape[0],p.shape[1],p.shape[2]));var _=c;return _.rank===3&&(_=c.as4D(1,c.shape[0],c.shape[1],c.shape[2])),Ve.runKernelFunc(function(j){return j.depthwiseConv2DDerFilter(g,_,l)},{x4D:g,dy4D:_})}}),cl=xt({separableConv2d_:function(p,c,a,l,g,_,j){_===void 0&&(_=[1,1]),j===void 0&&(j="NHWC");var V=Ke(p,"x","separableConv2d"),ne=Ke(c,"depthwiseFilter","separableConv2d"),oe=Ke(a,"pointwiseFilter","separableConv2d"),me=V,Ee=!1;if(V.rank===3&&(Ee=!0,me=V.as4D(1,V.shape[0],V.shape[1],V.shape[2])),j==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");we(me.rank===4,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+me.rank+"."}),we(ne.rank===4,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+ne.rank+"."}),we(oe.rank===4,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+ne.rank+"."}),we(oe.shape[0]===1,function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+oe.shape[0]+"."}),we(oe.shape[1]===1,function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+oe.shape[1]+"."});var _e=ne.shape[2],Ne=ne.shape[3];we(oe.shape[2]===_e*Ne,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+_e*Ne+", but got "+oe.shape[2]+"."});var Ue=Wm(me,ne,l,g,j,_),$e=Jf(Ue,oe,1,"valid",j);return Ee?$e.as3D($e.shape[1],$e.shape[2],$e.shape[3]):$e}}),Jp=xt({conv2dTranspose_:function(p,c,a,l,g,_){return zg(a,Ke(p,"x","conv2dTranspose"),Ke(c,"filter","conv2dTranspose"),l,g,"NHWC",_)}}),Vm=xt({conv3dTranspose_:function(p,c,a,l,g){return Ug(a,Ke(p,"x","conv3dTranspose"),Ke(c,"filter","conv3dTranspose"),l,g)}}),dc=xt({matMul_:function(p,c,a,l){var g;a===void 0&&(a=!1),l===void 0&&(l=!1);var _=Ke(p,"a","matMul"),j=Ke(c,"b","matMul");g=An(_,j),_=g[0],j=g[1];var V=a?_.shape[_.rank-2]:_.shape[_.rank-1],ne=l?j.shape[j.rank-1]:j.shape[j.rank-2],oe=a?_.shape[_.rank-1]:_.shape[_.rank-2],me=l?j.shape[j.rank-2]:j.shape[j.rank-1],Ee=_.shape.slice(0,-2),_e=j.shape.slice(0,-2),Ne=Ye(Ee),Ue=Ye(_e);we(_.rank>=2&&j.rank>=2&&_.rank===j.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+_.rank+" and "+j.rank+"."}),we(ln(Ee,_e),function(){return"Error in matMul: outer dimensions ("+Ee+") and ("+_e+") of Tensors with shapes "+_.shape+" and "+j.shape+" must match."}),we(V===ne,function(){return"Error in matMul: inner shapes ("+V+") and ("+ne+") of Tensors with shapes "+_.shape+" and "+j.shape+" and transposeA="+a+" and transposeB="+l+" must match."});var $e=_.shape.slice(0,-2).concat([oe,me]),He=a?_.as3D(Ne,V,oe):_.as3D(Ne,oe,V),et=l?j.as3D(Ue,me,ne):j.as3D(Ue,ne,me),lt={transposeA:a,transposeB:l};return Ve.runKernelFunc(function(ht,gt){var Ct=ht.batchMatMul(He,et,a,l);return gt([He,et]),Ct},{a:He,b:et},function(ht,gt){var Ct=gt,Wt=Ct[0],Kt=Ct[1];return a||l?!a&&l?{a:function(){return ht.matMul(Kt,!1,!1)},b:function(){return ht.matMul(Wt,!0,!1)}}:a&&!l?{a:function(){return Kt.matMul(ht,!1,!0)},b:function(){return Wt.matMul(ht,!1,!1)}}:{a:function(){return Kt.matMul(ht,!0,!0)},b:function(){return ht.matMul(Wt,!0,!0)}}:{a:function(){return ht.matMul(Kt,!1,!0)},b:function(){return Wt.matMul(ht,!0,!1)}}},"BatchMatMul",lt).reshape($e)}}),qm=xt({dot_:function(p,c){var a=Ke(p,"t1","dot"),l=Ke(c,"t2","dot");we(!(a.rank!==1&&a.rank!==2||l.rank!==1&&l.rank!==2),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+a.rank+" and "+l.rank+"."});var g=a.rank===1?a.size:a.shape[1],_=l.rank===1?l.size:l.shape[0];return we(g===_,function(){return"Error in dot: inner dimensions of inputs must match, but got "+g+" and "+_+"."}),a.rank===1&&l.rank===1?a.as2D(1,-1).matMul(l.as2D(-1,1)).asScalar():a.rank===1&&l.rank===2?a.as2D(1,-1).matMul(l.as2D(l.shape[0],l.shape[1])).as1D():a.rank===2&&l.rank===1?a.matMul(l.as2D(-1,1)).as1D():a.matMul(l.as2D(l.shape[0],l.shape[1]))}}),Hg=xt({outerProduct_:function(p,c){var a=Ke(p,"v1","outerProduct"),l=Ke(c,"v2","outerProduct");return we(a.rank===1&&l.rank===1,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+a.rank+" and "+l.rank+"."}),a.as2D(-1,1).matMul(l.as2D(1,-1))}}),Yl=xt({reverse_:function(p,c){var a=Ke(p,"x","reverse");if(a.rank===0)return a.clone();var l=xn(c,a.shape);return Ve.runKernelFunc(function(g){return g.reverse(a,l)},{$x:a},function(g){return{$x:function(){return g.reverse(l)}}}).reshapeAs(a)}}),Bv=xt({reverse1d_:function(p){var c=Ke(p,"x","reverse");return we(c.rank===1,function(){return"Error in reverse1D: x must be rank 1 but got rank "+c.rank+"."}),Yl(c,0)}}),ed=xt({reverse2d_:function(p,c){var a=Ke(p,"x","reverse");return we(a.rank===2,function(){return"Error in reverse2D: x must be rank 2 but got rank "+a.rank+"."}),Yl(a,c)}}),td=xt({reverse3d_:function(p,c){var a=Ke(p,"x","reverse");return we(a.rank===3,function(){return"Error in reverse3D: x must be rank 3 but got rank "+a.rank+"."}),Yl(a,c)}}),Jl=xt({reverse4d_:function(p,c){var a=Ke(p,"x","reverse");return we(a.rank===4,function(){return"Error in reverse4D: x must be rank 4 but got rank "+a.rank+"."}),Yl(a,c)}});function $g(p,c,a,l,g,_){var j=Ke(p,"x","maxPool"),V=j,ne=!1;j.rank===3&&(ne=!0,V=j.as4D(1,j.shape[0],j.shape[1],j.shape[2])),we(V.rank===4,function(){return"Error in maxPool: input must be rank 4 but got rank "+V.rank+"."}),we(wr(a,l),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+a+" and dilations '"+l+"'"}),_!=null&&we(Zt(g),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+_+" but got pad "+g+"."});var oe=yn(V.shape,c,a,l,g,_);if(oe.filterWidth===1&&oe.filterHeight===1&&ln(oe.inShape,oe.outShape))return j.clone();var me=[V],Ee=Ve.runKernelFunc(function(_e,Ne){var Ue=_e.maxPool(V,oe);return Ne([V,Ue]),Ue},{x:V},function(_e,Ne){var Ue=Ne[0],$e=Ne[1];return{x:function(){return function(He,et,lt,ht,gt,Ct,Wt,Kt){var Vt=Ke(He,"dy","maxPoolBackprop"),Ht=Ke(et,"input","maxPoolBackprop"),vn=Ke(lt,"output","maxPoolBackprop");we(Ht.rank===Vt.rank,function(){return"Rank of input ("+Ht.rank+") does not match rank of dy ("+Vt.rank+")"}),we(wr(gt,Ct),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+gt+" and dilations '"+Ct+"'"}),we(Vt.rank===4,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+Vt.rank+"."}),we(Ht.rank===4,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+Ht.rank+"."});var On=yn(Ht.shape,ht,gt,Ct,Wt,Kt);return Ve.runKernelFunc(function(Cn){return Cn.maxPoolBackprop(Vt,Ht,vn,On)},{$dy:Vt,$input:Ht})}(_e,Ue,$e,c,a,l,g)}}},"MaxPool",oe,me);return ne?Ee.as3D(Ee.shape[1],Ee.shape[2],Ee.shape[3]):Ee}function Zf(p,c,a,l,g,_){var j=Ke(p,"x","avgPool","float32");we(wr(a,l),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+a+" and dilations '"+l+"'"});var V=j,ne=!1;j.rank===3&&(ne=!0,V=j.as4D(1,j.shape[0],j.shape[1],j.shape[2])),we(V.rank===4,function(){return"Error in avgPool: x must be rank 4 but got rank "+V.rank+"."}),_!=null&&we(Zt(g),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+_+" but got pad "+g+"."});var oe=yn(V.shape,c,a,l,g,_);if(oe.filterWidth===1&&oe.filterHeight===1&&ln(oe.inShape,oe.outShape))return j.clone();var me=Ve.runKernelFunc(function(Ee){return Ee.avgPool(V,oe)},{x:V},function(Ee){return{x:function(){return function(_e,Ne,Ue,$e,He,et){var lt=Ke(_e,"dy","avgPoolBackprop"),ht=Ke(Ne,"input","avgPoolBackprop");we(ht.rank===lt.rank,function(){return"Rank of input ("+ht.rank+") does not match rank of dy ("+lt.rank+")"}),we(wr($e,He),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+$e+" and dilations '"+He+"'"});var gt=ht,Ct=lt,Wt=!1;ht.rank===3&&(Wt=!0,gt=ht.as4D(1,ht.shape[0],ht.shape[1],ht.shape[2]),Ct=lt.as4D(1,lt.shape[0],lt.shape[1],lt.shape[2])),we(Ct.rank===4,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+Ct.rank+"."}),we(gt.rank===4,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+gt.rank+"."});var Kt=yn(gt.shape,Ue,$e,He,et),Vt=Ve.runKernelFunc(function(Ht){return Ht.avgPoolBackprop(Ct,gt,Kt)},{dy4D:Ct,input4D:gt});return Wt?Vt.as3D(Vt.shape[1],Vt.shape[2],Vt.shape[3]):Vt}(Ee,V,c,a,l,g)}}},"AvgPool",oe);return me=me.cast(j.dtype),ne?me.as3D(me.shape[1],me.shape[2],me.shape[3]):me}var pc=xt({maxPool_:function(p,c,a,l,g){return $g(p,c,a,1,l,g)}}),nd=xt({avgPool_:function(p,c,a,l,g){return Zf(p,c,a,1,l,g)}}),lp=xt({pool_:function(p,c,a,l,g,_){g==null&&(g=[1,1]),_==null&&(_=1),l===0&&(l="valid");var j=Ke(p,"x","maxPool"),V=j,ne=!1;j.rank===3&&(ne=!0,V=j.as4D(1,j.shape[0],j.shape[1],j.shape[2])),we(wr(_,g),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+_+" and dilations '"+g+"'"});var oe,me=yn(V.shape,c,_,g,l),Ee=[me.dilationHeight,me.dilationWidth];oe=l==="same"?function(gt,Ct){var Wt=gt.map(function(Ht,vn){return Ht+(Ht-1)*(Ct[vn]-1)}).map(function(Ht){return Ht-1}),Kt=Wt.map(function(Ht){return Math.floor(Ht/2)}),Vt=Wt.map(function(Ht,vn){return Ht-Kt[vn]});return Wt.map(function(Ht,vn){return[Kt[vn],Vt[vn]]})}([me.filterHeight,me.filterWidth],Ee):[[0,0],[0,0]];var _e=Ee[0]===1&&Ee[1]===1,Ne=function(gt,Ct,Wt){var Kt=Wt.map(function(Cn){return Cn[0]}),Vt=Wt.map(function(Cn){return Cn[1]}),Ht=gt.concat(Kt,Vt),vn=Ct.map(function(Cn,Kn){return(Cn-Ht[Kn]%Cn)%Cn}),On=Vt.map(function(Cn,Kn){return Cn+vn[Kn]});return[Ct.map(function(Cn,Kn){return[Kt[Kn],On[Kn]]}),Ct.map(function(Cn,Kn){return[0,vn[Kn]]})]}([me.inHeight,me.inWidth],Ee,oe),Ue=Ne[0],$e=Ne[1],He=_e?l:"valid",et=_e?V:$c(V,Ee,Ue),lt=(a==="avg"?function(){return Zf(et,c,_,1,He)}:function(){return $g(et,c,_,1,He)})(),ht=_e?lt:Ld(lt,Ee,$e);return ne?ht.as3D(ht.shape[1],ht.shape[2],ht.shape[3]):ht}}),Qp=xt({maxPool3d_:function(p,c,a,l,g,_,j){_===void 0&&(_="NDHWC");var V=Ke(p,"x","maxPool3d"),ne=V,oe=!1;V.rank===4&&(oe=!0,ne=V.as5D(1,V.shape[0],V.shape[1],V.shape[2],V.shape[3])),j==null&&(j=[1,1,1]),we(ne.rank===5,function(){return"Error in maxPool3d: x must be rank 5 but got rank "+ne.rank+"."}),we(_==="NDHWC",function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+_}),we(wr(a,j),function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+a+" and dilations '"+j+"'"}),g!=null&&we(Zt(l),function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+g+" but got pad "+l+"."});var me=_n(ne.shape,c,a,j,l,g,_),Ee=Ve.runKernelFunc(function(_e,Ne){var Ue=_e.maxPool3d(ne,me);return Ne([ne,Ue]),Ue},{x:ne},function(_e,Ne){var Ue=Ne[0],$e=Ne[1];return{x:function(){return function(He,et,lt,ht,gt,Ct,Wt,Kt){var Vt=Ke(He,"dy","maxPool3dBackprop"),Ht=Ke(et,"input","maxPool3dBackprop"),vn=Ke(lt,"output","maxPool3dBackprop"),On=Vt,Cn=Ht,Kn=vn,er=!1;Ht.rank===4&&(er=!0,On=Vt.as5D(1,Vt.shape[0],Vt.shape[1],Vt.shape[2],Vt.shape[3]),Cn=Ht.as5D(1,Ht.shape[0],Ht.shape[1],Ht.shape[2],Ht.shape[3]),Kn=vn.as5D(1,vn.shape[0],vn.shape[1],vn.shape[2],vn.shape[3])),we(On.rank===5,function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+On.rank+"."}),we(Cn.rank===5,function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+Cn.rank+"."}),we(Kn.rank===5,function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+Kn.rank+"."}),Ct==null&&(Ct=[1,1,1]),we(wr(gt,Ct),function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+gt+" and dilations '"+Ct+"'"}),Kt!=null&&we(Zt(Wt),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+Kt+" but got pad "+Wt+"."});var sr=_n(Cn.shape,ht,gt,Ct,Wt,Kt),lr=Ve.runKernelFunc(function(ur){return ur.maxPool3dBackprop(On,Cn,Kn,sr)},{dy5D:On,input5D:Cn});return er?lr.as4D(lr.shape[1],lr.shape[2],lr.shape[3],lr.shape[4]):lr}(_e,Ue,$e,c,a,j,l,g)}}});return oe?Ee.as4D(Ee.shape[1],Ee.shape[2],Ee.shape[3],Ee.shape[4]):Ee}}),Hm=xt({avgPool3d_:function(p,c,a,l,g,_,j){_===void 0&&(_="NDHWC");var V=Ke(p,"x","avgPool3d","float32"),ne=V,oe=!1;V.rank===4&&(oe=!0,ne=V.as5D(1,V.shape[0],V.shape[1],V.shape[2],V.shape[3])),j==null&&(j=[1,1,1]),we(ne.rank===5,function(){return"Error in avgPool3d: x must be rank 5 but got rank "+ne.rank+"."}),we(_==="NDHWC",function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+_}),we(wr(a,j),function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+a+" and dilations '"+j+"'"}),g!=null&&we(Zt(l),function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+g+" but got pad "+l+"."});var me=_n(ne.shape,c,a,j,l,g,_),Ee=Ve.runKernelFunc(function(_e){return _e.avgPool3d(ne,me)},{x:ne},function(_e){return{x:function(){return function(Ne,Ue,$e,He,et,lt,ht){var gt=Ke(Ne,"dy","avgPool3dBackprop"),Ct=Ke(Ue,"input","avgPool3dBackprop"),Wt=gt,Kt=Ct,Vt=!1;Ct.rank===4&&(Vt=!0,Wt=gt.as5D(1,gt.shape[0],gt.shape[1],gt.shape[2],gt.shape[3]),Kt=Ct.as5D(1,Ct.shape[0],Ct.shape[1],Ct.shape[2],Ct.shape[3])),we(Wt.rank===5,function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+Wt.rank+"."}),we(Kt.rank===5,function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+Kt.rank+"."}),et==null&&(et=[1,1,1]),we(wr(He,et),function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+He+" and dilations '"+et+"'"}),ht!=null&&we(Zt(lt),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+ht+" but got pad "+lt+"."});var Ht=_n(Kt.shape,$e,He,et,lt,ht),vn=Ve.runKernelFunc(function(On){return On.avgPool3dBackprop(Wt,Kt,Ht)},{dy5D:Wt,input5D:Kt});return Vt?vn.as4D(vn.shape[1],vn.shape[2],vn.shape[3],vn.shape[4]):vn}(_e,ne,c,a,j,l,g)}}});return Ee=Ee.cast(ne.dtype),oe?Ee.as4D(Ee.shape[1],Ee.shape[2],Ee.shape[3],Ee.shape[4]):Ee}}),Gg=xt({maxPoolWithArgmax_:function(p,c,a,l,g){g===void 0&&(g=!1);var _=Ke(p,"x","maxPoolWithArgmax"),j={filterSize:c,strides:a,pad:l,includeBatchInIndex:g},V=Ve.runKernel("MaxPoolWithArgmax",{x:_},j);return{result:V[0],indexes:V[1]}}}),ns=xt({slice_:function(p,c,a){var l,g,_=Ke(p,"x","slice");if(_.rank===0)throw new Error("Slicing scalar is not possible");(l=typeof c=="number"?[c].concat(new Array(_.rank-1).fill(0)):c.length<_.rank?c.concat(new Array(_.rank-c.length).fill(0)):c.slice()).forEach(function(ne){we(ne!==-1,function(){return"slice() does not support negative begin indexing."})}),g=(g=a==null?new Array(_.rank).fill(-1):typeof a=="number"?[a].concat(new Array(_.rank-1).fill(-1)):a.length<_.rank?a.concat(new Array(_.rank-a.length).fill(-1)):a).map(function(ne,oe){return ne>=0?ne:(we(ne===-1,function(){return"Negative size values should be exactly -1 but got "+ne+" for the slice() size at index "+oe+"."}),_.shape[oe]-l[oe])}),Zc(_,l,g);var j=_.shape,V={begin:l,size:g};return Ve.runKernelFunc(function(ne){return ne.slice(_,l,g)},{x:_},function(ne){for(var oe=[],me=0;me<ne.rank;me++)oe.push([l[me],j[me]-l[me]-g[me]]);return{x:function(){return Nu(ne,oe)}}},"Slice",V)}}),Kg=xt({slice1d_:function(p,c,a){var l=Ke(p,"x","slice1d");return we(l.rank===1,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+l.rank+" tensor"}),ns(l,[c],[a])}}),rd=xt({slice2d_:function(p,c,a){var l=Ke(p,"x","slice2d");return we(l.rank===2,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+l.rank+" tensor"}),ns(l,c,a)}}),Xg=xt({slice3d_:function(p,c,a){var l=Ke(p,"x","slice3d");return we(l.rank===3,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+l.rank+" tensor"}),ns(l,c,a)}}),Zp=xt({slice4d_:function(p,c,a){var l=Ke(p,"x","slice4d");return we(l.rank===4,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+l.rank+" tensor"}),ns(l,c,a)}});function Ql(p,c,a,l,g){return c.rank<a.rank&&(c=c.reshape(_a(c.shape,l))),p.rank<a.rank&&(p=p.reshape(_a(p.shape,l))),{x:function(){var _=p.mul(a.equal(c).cast(p.dtype));return g==null?_:_.transpose(g)}}}var fp=xt({all_:function(p,c,a){c===void 0&&(c=null),a===void 0&&(a=!1);var l=Ke(p,"x","all","bool"),g=xn(c,l.shape),_=g,j=Co(_,l.rank);j!=null&&(l=l.transpose(j),_=Oo(_.length,l.rank));var V=Ve.runKernelFunc(function(oe){return oe.all(l,_)},{$x:l});if(a){var ne=_a(V.shape,g);return V.reshape(ne)}return V}}),ll=xt({any_:function(p,c,a){c===void 0&&(c=null),a===void 0&&(a=!1);var l=Ke(p,"x","any","bool"),g=xn(c,l.shape),_=g,j=Co(_,l.rank);j!=null&&(l=l.transpose(j),_=Oo(_.length,l.rank));var V=Ve.runKernelFunc(function(oe){return oe.any(l,_)},{$x:l});if(a){var ne=_a(V.shape,g);return V.reshape(ne)}return V}}),Yg=xt({argMax_:function(p,c){c===void 0&&(c=0);var a=Ke(p,"x","argMax");c==null&&(c=0);var l=xn(c,a.shape),g=Co(l,a.rank);g!=null&&(a=a.transpose(g),l=Oo(l.length,a.rank));var _={axis:l[0]},j=[a];return Ve.runKernelFunc(function(V,ne){var oe=V.argMax(a,l[0]);return ne([a]),oe},{x:a},function(V,ne){var oe=ne[0];return{x:function(){return ii(oe)}}},"ArgMax",_,j)}}),em=xt({argMin_:function(p,c){c===void 0&&(c=0);var a=Ke(p,"x","argMin");c==null&&(c=0);var l=xn(c,a.shape),g=Co(l,a.rank);return g!=null&&(a=a.transpose(g),l=Oo(l.length,a.rank)),Ve.runKernelFunc(function(_,j){var V=_.argMin(a,l[0]);return j([a]),V},{$x:a},function(_,j){var V=j[0];return{$x:function(){return ii(V)}}})}}),tm=xt({logSumExp_:function(p,c,a){c===void 0&&(c=null),a===void 0&&(a=!1);var l=Ke(p,"x","logSumExp"),g=xn(c,l.shape),_=l.max(g,!0),j=l.sub(_).exp().sum(g).log(),V=_.reshape(j.shape).add(j);if(a){var ne=_a(V.shape,g);return V.reshape(ne)}return V}}),$m=xt({max_:function(p,c,a){c===void 0&&(c=null),a===void 0&&(a=!1);var l=Ke(p,"x","max"),g=l,_=xn(c,l.shape),j=_,V=Co(j,l.rank);V!=null&&(l=l.transpose(V),j=Oo(j.length,l.rank));var ne=[l],oe=Ve.runKernelFunc(function(Ee,_e){var Ne=Ee.max(l,j);return _e([g,Ne]),Ne},{x:l},function(Ee,_e){return Ql(Ee,_e[1],_e[0],_,V)},"Max",{axes:j},ne,[!0]);if(a){var me=_a(oe.shape,_);oe=oe.reshape(me)}return oe}}),Fc=xt({mean_:function(p,c,a){c===void 0&&(c=null),a===void 0&&(a=!1);var l=Ke(p,"x","mean"),g=xn(c,l.shape),_=Ye(Aa(l.shape,g)[1]);return N(function(j){var V=fr(_);return{value:(V.dtype===j.dtype?j:j.cast(V.dtype)).div(V).sum(c,a),gradFunc:function(ne){var oe=j.shape.slice();return g.forEach(function(me){oe[me]=1}),ne.reshape(oe).mul(uu(j.shape,"float32")).div(_)}}})(l)}}),nm=xt({min_:function(p,c,a){c===void 0&&(c=null),a===void 0&&(a=!1);var l=Ke(p,"x","min"),g=l,_=xn(c,l.shape),j=_,V=Co(j,l.rank);V!=null&&(l=l.transpose(V),j=Oo(j.length,l.rank));var ne=[l],oe=Ve.runKernelFunc(function(Ee,_e){var Ne=Ee.min(l,j);return _e([g,Ne]),Ne},{x:l},function(Ee,_e){return Ql(Ee,_e[1],_e[0],_,V)},"Min",{axes:j},ne,[!0]);if(a){var me=_a(oe.shape,_);oe=oe.reshape(me)}return oe}}),Jg=xt({moments_:function(p,c,a){c===void 0&&(c=null),a===void 0&&(a=!1);var l=xn(c,(p=Ke(p,"x","moments")).shape),g=p.mean(l,a),_=g.shape;return a||(_=_a(g.shape,l)),{mean:g,variance:p.toFloat().sub(g.reshape(_)).square().mean(l,a)}}}),fl=xt({sum_:function(p,c,a){c===void 0&&(c=null),a===void 0&&(a=!1);var l=Ke(p,"x","sum");l.dtype==="bool"&&(l=l.toInt());var g=xn(c,l.shape);return N(function(_){var j=Co(g,_.rank),V=g,ne=_;j!=null&&(ne=_.transpose(j),V=Oo(V.length,_.rank));var oe=function(Ne){var Ue=_.shape.slice();return g.forEach(function($e){Ue[$e]=1}),Ne.reshape(Ue).mul(uu(_.shape,"float32"))},me={axes:V},Ee=Ve.runKernelFunc(function(Ne){return Ne.sum(ne,V)},{x:ne},function(Ne){return{x:function(){return oe(Ne)}}},"Sum",me);if(a){var _e=_a(Ee.shape,g);Ee=Ee.reshape(_e)}return{value:Ee,gradFunc:oe}})(l)}}),hp=xt({prod_:function(p,c,a){c===void 0&&(c=null),a===void 0&&(a=!1);var l=Ke(p,"x","prod");l.dtype==="bool"&&(l=l.toInt());var g=xn(c,l.shape),_=Co(g,l.rank),j=g,V=l;_!=null&&(V=l.transpose(_),j=Oo(j.length,l.rank));var ne=Ve.runKernelFunc(function(me){return me.prod(V,j)},{permutedX:V});if(a){var oe=_a(ne.shape,g);ne=ne.reshape(oe)}return ne}}),eh=xt({elu_:function(p){var c=Ke(p,"x","elu");return Ve.runKernelFunc(function(a,l){var g=a.elu(c);return l([g]),g},{$x:c},function(a,l){var g=l[0];return{$x:function(){return Ve.runKernelFunc(function(_){return _.eluDer(a,g)},{dy:a,y:g})}}})}}),dp=xt({leakyRelu_:function(p,c){c===void 0&&(c=.2);var a=Ke(p,"x","leakyRelu");return bo(fr(c).mul(a),a)}}),rs=xt({prelu_:function(p,c){var a=Ke(p,"x","prelu"),l=Ke(c,"alpha","prelu");return Ve.runKernelFunc(function(g,_){var j=g.prelu(a,l);return _([a,l]),j},{x:a,alpha:l},function(g,_){var j=_[0],V=_[1],ne=j.greater(0);return{x:function(){return Nc(ne,g,g.mul(V))},alpha:function(){var oe=Nc(ne,ii(g),g.mul(j)),me=Fo(V.shape,g.shape);return me.length>0&&(oe=oe.sum(me)),oe.reshape(V.shape)}}},"Prelu")}}),rm=xt({relu_:function(p){var c=Ke(p,"x","relu");return c.dtype==="bool"?c.toInt():Ve.runKernelFunc(function(a,l){var g=a.relu(c);return l([c]),g},{x:c},function(a,l){var g=l[0];return{x:function(){return a.mulStrict(g.step().toFloat())}}},"Relu")}}),Gm=xt({relu6_:function(p){var c=Ke(p,"x","relu6");return c.dtype==="bool"?c.toInt():Ve.runKernelFunc(function(a,l){var g=a.relu6(c);return l([c]),g},{x:c},function(a,l){var g=l[0],_=g.lessEqual(6).mul(g.step());return{x:function(){return a.mulStrict(_.toFloat())}}},"Relu6")}}),pp=xt({selu_:function(p){var c=Ke(p,"x","selu");return Ve.runKernelFunc(function(a,l){var g=a.selu(c);return l([c]),g},{$x:c},function(a,l){var g=l[0];return{$x:function(){var _=g.greater(fr(0)),j=fr(b0),V=fr(x0),ne=a.mul(V),oe=a.mul(j).mul(g.toFloat().exp());return Nc(_,ne,oe)}}})}}),mp=xt({localResponseNormalization_:function(p,c,a,l,g){c===void 0&&(c=5),a===void 0&&(a=1),l===void 0&&(l=1),g===void 0&&(g=.5);var _=Ke(p,"x","localResponseNormalization");we(_.rank===4||_.rank===3,function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `+_.rank+"."}),we(Zt(c),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+c+"."});var j=_,V=!1;_.rank===3&&(V=!0,j=_.as4D(1,_.shape[0],_.shape[1],_.shape[2]));var ne=Ve.runKernelFunc(function(oe,me){var Ee=oe.localResponseNormalization4D(j,c,a,l,g);return me([j,Ee]),Ee},{x4D:j},function(oe,me){var Ee=me[0],_e=me[1];return{x4D:function(){return Ve.runKernelFunc(function(Ne){return Ne.LRNGrad(oe,Ee,_e,c,a,l,g)},{})}}});return V?ne.as3D(ne.shape[1],ne.shape[2],ne.shape[3]):ne}}),Km=xt({norm_:function(p,c,a,l){c===void 0&&(c="euclidean"),a===void 0&&(a=null),l===void 0&&(l=!1);var g=function V(ne,oe,me){if(me===void 0&&(me=null),ne.rank===0)return ne.abs();if(ne.rank!==1&&me===null)return V(ne.reshape([-1]),oe,me);if(ne.rank===1||typeof me=="number"||Array.isArray(me)&&me.length===1){if(oe===1)return ne.abs().sum(me);if(oe===1/0)return ne.abs().max(me);if(oe===-1/0)return ne.abs().min(me);if(oe==="euclidean"||oe===2)return ne.abs().pow(fr(2,"int32")).sum(me).sqrt();throw new Error("Error in norm: invalid ord value: "+oe)}if(Array.isArray(me)&&me.length===2){if(oe===1)return ne.abs().sum(me[0]).max(me[1]-1);if(oe===1/0)return ne.abs().sum(me[1]).max(me[0]);if(oe===-1/0)return ne.abs().sum(me[1]).min(me[0]);if(oe==="fro"||oe==="euclidean")return ne.square().sum(me).sqrt();throw new Error("Error in norm: invalid ord value: "+oe)}throw new Error("Error in norm: invalid axis: "+me)}(p=Ke(p,"x","norm"),c,a),_=g.shape;if(l){var j=xn(a,p.shape);_=_a(g.shape,j)}return g.reshape(_)}}),Qg=xt({basicLSTMCell_:function(p,c,a,l,g,_){var j=Ke(p,"forgetBias","basicLSTMCell"),V=Ke(c,"lstmKernel","basicLSTMCell"),ne=Ke(a,"lstmBias","basicLSTMCell"),oe=Ke(l,"data","basicLSTMCell"),me=Ke(g,"c","basicLSTMCell"),Ee=Ke(_,"h","basicLSTMCell"),_e=oe.concat(Ee,1).matMul(V).add(ne),Ne=_e.shape[0],Ue=_e.shape[1]/4,$e=[Ne,Ue],He=_e.slice([0,0],$e),et=_e.slice([0,Ue],$e),lt=_e.slice([0,2*Ue],$e),ht=_e.slice([0,3*Ue],$e),gt=He.sigmoid().mulStrict(et.tanh()).addStrict(me.mulStrict(j.add(lt).sigmoid()));return[gt,gt.tanh().mulStrict(ht.sigmoid())]}}),Pv=xt({multiRNNCell_:function(p,c,a,l){for(var g=Ke(c,"data","multiRNNCell"),_=Lu(a,"c","multiRNNCell"),j=Lu(l,"h","multiRNNCell"),V=g,ne=[],oe=0;oe<p.length;oe++){var me=p[oe](V,_[oe],j[oe]);ne.push(me[0]),ne.push(me[1]),V=me[1]}var Ee=[],_e=[];for(oe=0;oe<ne.length;oe+=2)Ee.push(ne[oe]),_e.push(ne[oe+1]);return[Ee,_e]}}),Rc=xt({movingAverage_:function(p,c,a,l,g){g===void 0&&(g=!0);var _=Ke(p,"v","movingAverage"),j=Ke(c,"x","movingAverage"),V=Ke(a,"decay","movingAverage");Ln(_,j),we(ln(_.shape,j.shape),function(){return"Shape mismatch in v and x"});var ne=fr(1),oe=ne.sub(V),me=j.sub(_).mul(oe);if(g){we(l!=null,function(){return"When using zeroDebias: true, step is required."});var Ee=Ke(l,"step","movingAverage");me=me.div(ne.sub(qs(V,Ee)))}return _.add(me)}}),th=xt({stridedSlice_:function(p,c,a,l,g,_,j,V,ne){if(g===void 0&&(g=0),_===void 0&&(_=0),j===void 0&&(j=0),V===void 0&&(V=0),ne===void 0&&(ne=0),l==null&&(l=new Array(c.length)),j!==0)throw new Error("ellipsis mask is not yet supported");var oe=Ke(p,"x","stridedSlice"),me=$s(V),Ee=oe.shape.slice();me.forEach(function(He){c[He]=0,a[He]=1,Ee.splice(He,0,1)}),oe=oe.reshape(Ee);for(var _e=0;_e<oe.rank;_e++)c[_e]=Au(g,c,l,oe.shape,_e),a[_e]=nu(_,a,l,oe.shape,_e),l[_e]=l[_e]||1;var Ne=$s(ne);Ne.forEach(function(He){a[He]=c[He]+1,l[He]=1});var Ue=Ou(c,a,l),$e=Ue.filter(function(He,et){return Ne.indexOf(et)===-1});return l.every(function(He){return He===1})?ns(oe,c,Ue).reshape($e):Ve.runKernelFunc(function(He){return He.stridedSlice(oe,c,a,l)},{$x:oe}).reshape($e)}}),Lv=xt({topk_:function(p,c,a){c===void 0&&(c=1),a===void 0&&(a=!0);var l=Ke(p,"x","topk");if(l.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var g=l.shape[l.shape.length-1];if(c>g)throw new Error("'k' passed to topk() must be <= the last dimension ("+g+") but got "+c);var _=Ve.runKernelFunc(function(j){return j.topk(l,c,a)},{$x:l});return{values:_[0],indices:_[1]}}}),Zg=xt({scatterND_:function(p,c,a){var l=Ke(p,"indices","scatterND","int32"),g=Ke(c,"updates","scatterND");return Jc(g,l,a),Ve.runKernelFunc(function(_){return _.scatterND(l,g,a)},{indices:l,updates:g},null,"ScatterNd",{shape:a})}}),Mc=xt({fft_:function(p){we(p.dtype==="complex64",function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+p.dtype+"."});var c=p.shape[p.shape.length-1],a=p.size/c,l=p.as2D(a,c);return Ve.runKernelFunc(function(g){return g.fft(l)},{input:p}).reshape(p.shape)}}),Xo=xt({ifft_:function(p){we(p.dtype==="complex64",function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+p.dtype+"."});var c=p.shape[p.shape.length-1],a=p.size/c,l=p.as2D(a,c);return Ve.runKernelFunc(function(g){return g.ifft(l)},{input:p}).reshape(p.shape)}}),id=xt({rfft_:function(p,c){we(p.dtype==="float32",function(){return"The dtype for rfft() must be real value but got "+p.dtype});var a,l=p.shape[p.shape.length-1],g=p.size/l;if(c!=null&&c<l){var _=p.shape.map(function(et){return 0}),j=p.shape.map(function(et){return et});j[p.shape.length-1]=c,a=p.slice(_,j),l=c}else if(c!=null&&c>l){var V=p.shape.map(function(et){return et});V[p.shape.length-1]=c-l,a=p.concat(Ki(V),p.shape.length-1),l=c}else a=p;var ne=a.zerosLike(),oe=fa(a,ne).as2D(g,l),me=Mc(oe),Ee=Math.floor(l/2)+1,_e=uo(me),Ne=Uo(me),Ue=_e.split([Ee,l-Ee],_e.shape.length-1),$e=Ne.split([Ee,l-Ee],Ne.shape.length-1),He=a.shape.slice();return He[a.shape.length-1]=Ee,fa(Ue[0],$e[0]).reshape(He)}}),gp=xt({irfft_:function(p){var c=p.shape[p.shape.length-1],a=p.size/c;if(c<=2){var l=p.as2D(a,c),g=Xo(l);return uo(g)}var _=[a,2*(c-1)],j=uo(p).as2D(a,c),V=Uo(p).as2D(a,c),ne=j.slice([0,1],[a,c-2]).reverse(1),oe=V.slice([0,1],[a,c-2]).reverse(1).mul(fr(-1)),me=j.concat(ne,1),Ee=V.concat(oe,1);return l=fa(me,Ee).as2D(_[0],_[1]),g=Xo(l),uo(g)}}),im=Object.freeze({fft:Mc,ifft:Xo,rfft:id,irfft:gp}),ev=xt({sparseToDense_:function(p,c,a,l){l===void 0&&(l=0);var g=Ke(p,"sparseIndices","sparseToDense","int32"),_=Ke(c,"sparseValues","sparseToDense"),j=Ke(l,"defaultValue","sparseToDense",_.dtype);return function(V,ne,oe,me){if(V.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+V.dtype+".");if(V.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+V.shape+".");var Ee=V.rank>0?V.shape[0]:1,_e=V.rank>1?V.shape[1]:1;if(oe.length!==_e)throw new Error("outputShape has incorrect number of elements:, "+oe.length+", should be: "+_e+".");var Ne=ne.size;if(ne.rank!==0&&(ne.rank!==1||Ne!==Ee))throw new Error("sparseValues has incorrect shape "+ne.shape+", should be [] or ["+Ee+"]");if(ne.dtype!==me.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(g,_,a,j),Ve.runKernelFunc(function(V){return V.sparseToDense(g,_,a,j)},{$sparseIndices:g,$sparseValues:_,$defaultValue:j})}}),am=xt({gatherND_:function(p,c){var a=Ke(c,"indices","gatherND","int32"),l=Ke(p,"x","gatherND");return Ve.runKernelFunc(function(g){return g.gatherND(l,a)},{x:l,indices:a},null,"GatherNd")}}),Zl=xt({diag_:function(p){var c=Ke(p,"x","diag").flatten(),a=p.shape.concat(p.shape);return Ve.runKernelFunc(function(l){return l.diag(c)},{$x:c}).reshape(a)}}),E0=xt({dropout_:function(p,c,a,l){var g=Ke(p,"x","dropout");if(we(g.dtype==="float32",function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+g.dtype+" tensor instead."}),we(c>=0&&c<1,function(){return"rate must be a float in the range [0, 1), but got "+c+"."}),c===0)return p instanceof jt?g.clone():g;var _=function(ne,oe){if(oe==null)return ne.shape.slice();if(ln(ne.shape,oe))return oe;if(ne.shape.length===oe.length){for(var me=[],Ee=0;Ee<ne.shape.length;Ee++)oe[Ee]==null&&ne.shape[Ee]!=null?me.push(ne.shape[Ee]):me.push(oe[Ee]);return me}return oe}(g,a),j=1-c,V=$p(_,0,1,"float32",l).add(j).floor().div(j);return g.mul(V)}});function om(p,c,a){for(var l=1-p%2,g=new Float32Array(p),_=0;_<p;++_){var j=2*Math.PI*_/(p+l-1);g[_]=c-a*Math.cos(j)}return zs(g,"float32")}var qo,vp=xt({hannWindow_:function(p){return om(p,.5,.5)}}),nh=xt({hammingWindow_:function(p){return om(p,.54,.46)}}),sm=xt({frame_:function(p,c,a,l,g){l===void 0&&(l=!1),g===void 0&&(g=0);for(var _=0,j=[];_+c<=p.size;)j.push(ns(p,_,c)),_+=a;if(l)for(;_<p.size;){var V=_+c-p.size,ne=Ba([ns(p,_,c-V),ws([V],g)]);j.push(ne),_+=a}return j.length===0?eu([],[0,c]):Ba(j).as2D(j.length,c)}}),yp=xt({stft_:function(p,c,a,l,g){var _;g===void 0&&(g=vp),l==null&&(_=c,l=Math.floor(Math.pow(2,Math.ceil(Math.log(_)/Math.log(2)))));for(var j=sm(p,c,a),V=Ka(j,g(c)),ne=[],oe=0;oe<j.shape[0];oe++)ne.push(id(V.slice([oe,0],[1,c]),l));return Ba(ne)}}),Xm=Object.freeze({hannWindow:vp,hammingWindow:nh,frame:sm,stft:yp}),Ym=function(p,c,a){return a===void 0&&(a=1),R(this,void 0,void 0,function(){var l,g,_,j,V,ne,oe,me,Ee,_e,Ne,Ue,$e,He;return P(this,function(et){switch(et.label){case 0:return l=Ke(p,"predictions","inTopK"),g=Ke(c,"targets","inTopK"),we(l.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+l.rank}),we(l.rank-1===g.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+l.rank+" and targets rank "+g.rank}),Tt(l.shape.slice(0,l.shape.length-1),g.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),_=l.shape[l.shape.length-1],we(a>0&&a<=_,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+_+"), but got "+a}),[4,l.data()];case 1:return j=et.sent(),[4,g.data()];case 2:for(V=et.sent(),ne=[j.length/_,_],me=ne[1],Ee=Yn("bool",oe=ne[0]),_e=0;_e<oe;_e++){for(Ne=_e*me,Ue=j.subarray(Ne,Ne+me),$e=[],He=0;He<Ue.length;He++)$e.push({value:Ue[He],index:He});for($e.sort(function(lt,ht){return ht.value-lt.value}),Ee[_e]=0,He=0;He<a;He++)if($e[He].index===V[_e]){Ee[_e]=1;break}}return p!==l&&l.dispose(),c!==g&&g.dispose(),[2,wa(Ee,g.shape,"bool")]}})})};(function(p){p[p.NONE=0]="NONE",p[p.MEAN=1]="MEAN",p[p.SUM=2]="SUM",p[p.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(qo||(qo={}));var ef=xt({absoluteDifference_:function(p,c,a,l){l===void 0&&(l=qo.SUM_BY_NONZERO_WEIGHTS);var g=Ke(p,"labels","absoluteDifference"),_=Ke(c,"predictions","absoluteDifference"),j=null;a!=null&&(j=Ke(a,"weights","absoluteDifference")),Tt(g.shape,_.shape,"Error in absoluteDifference: ");var V=g.sub(_).abs();return $u(V,j,l)}}),$u=xt({computeWeightedLoss_:function(p,c,a){a===void 0&&(a=qo.SUM_BY_NONZERO_WEIGHTS);var l=Ke(p,"losses","computeWeightedLoss"),g=null;c!=null&&(g=Ke(c,"weights","computeWeightedLoss"));var _=g==null?l:l.mul(g);if(a===qo.NONE)return _;if(a===qo.SUM)return _.sum();if(a===qo.MEAN){if(g==null)return _.mean();var j=l.size/g.size,V=_.sum().div(g.sum());return j>1?V.div(fr(j)):V}if(a===qo.SUM_BY_NONZERO_WEIGHTS){if(g==null)return _.sum().div(fr(l.size));var ne=g.mul(uu(l.shape)).notEqual(fr(0)).sum().toFloat();return _.sum().div(ne)}throw Error("Unknown reduction: "+a)}}),tv=xt({cosineDistance_:function(p,c,a,l,g){g===void 0&&(g=qo.SUM_BY_NONZERO_WEIGHTS);var _=Ke(p,"labels","cosineDistance"),j=Ke(c,"predictions","cosineDistance"),V=null;l!=null&&(V=Ke(l,"weights","cosineDistance")),Tt(_.shape,j.shape,"Error in cosineDistance: ");var ne=fr(1).sub(_.mul(j).sum(a,!0));return $u(ne,V,g)}}),nv=xt({hingeLoss_:function(p,c,a,l){l===void 0&&(l=qo.SUM_BY_NONZERO_WEIGHTS);var g=Ke(p,"labels","hingeLoss"),_=Ke(c,"predictions","hingeLoss"),j=null;a!=null&&(j=Ke(a,"weights","hingeLoss")),Tt(g.shape,_.shape,"Error in hingeLoss: ");var V=fr(1);g=fr(2).mul(g).sub(V);var ne=V.sub(g.mul(_)).relu();return $u(ne,j,l)}}),ad=xt({huberLoss_:function(p,c,a,l,g){l===void 0&&(l=1),g===void 0&&(g=qo.SUM_BY_NONZERO_WEIGHTS);var _=Ke(p,"labels","huberLoss"),j=Ke(c,"predictions","huberLoss"),V=null;a!=null&&(V=Ke(a,"weights","huberLoss")),Tt(_.shape,j.shape,"Error in huberLoss: ");var ne=fr(l),oe=j.sub(_).abs(),me=ku(oe,ne),Ee=oe.sub(me),_e=fr(.5).mul(me.square()).add(ne.mul(Ee));return $u(_e,V,g)}}),bp=xt({logLoss_:function(p,c,a,l,g){l===void 0&&(l=1e-7),g===void 0&&(g=qo.SUM_BY_NONZERO_WEIGHTS);var _=Ke(p,"labels","logLoss"),j=Ke(c,"predictions","logLoss"),V=null;a!=null&&(V=Ke(a,"weights","logLoss")),Tt(_.shape,j.shape,"Error in logLoss: ");var ne=fr(1),oe=fr(l),me=_.mul(j.add(oe).log()).neg().sub(ne.sub(_).mul(ne.sub(j).add(oe).log()));return $u(me,V,g)}}),zv=xt({meanSquaredError_:function(p,c,a,l){l===void 0&&(l=qo.SUM_BY_NONZERO_WEIGHTS);var g=Ke(p,"labels","meanSquaredError"),_=Ke(c,"predictions","meanSquaredError"),j=null;a!=null&&(j=Ke(a,"weights","meanSquaredError")),Tt(g.shape,_.shape,"Error in meanSquaredError: ");var V=g.squaredDifference(_);return $u(V,j,l)}}),Jm=xt({sigmoidCrossEntropy_:function(p,c,a,l,g){l===void 0&&(l=0),g===void 0&&(g=qo.SUM_BY_NONZERO_WEIGHTS);var _=Ke(p,"multiClassLabels","sigmoidCrossEntropy"),j=Ke(c,"logits","sigmoidCrossEntropy"),V=null;if(a!=null&&(V=Ke(a,"weights","sigmoidCrossEntropy")),Tt(_.shape,j.shape,"Error in sigmoidCrossEntropy: "),l>0){var ne=fr(l),oe=fr(1),me=fr(.5);_=_.mul(oe.sub(ne)).add(me.mul(ne))}var Ee=function(_e,Ne){var Ue=Ke(_e,"labels","sigmoidCrossEntropyWithLogits"),$e=Ke(Ne,"logits","sigmoidCrossEntropyWithLogits");Tt(Ue.shape,$e.shape,"Error in sigmoidCrossEntropyWithLogits: ");var He=$e.relu(),et=$e.mul(Ue),lt=$e.abs().neg().exp().log1p();return He.sub(et).add(lt)}(_,j);return $u(Ee,V,g)}}),um=xt({softmaxCrossEntropy_:function(p,c,a,l,g){l===void 0&&(l=0),g===void 0&&(g=qo.SUM_BY_NONZERO_WEIGHTS);var _=Ke(p,"onehotLabels","softmaxCrossEntropy"),j=Ke(c,"logits","softmaxCrossEntropy"),V=null;if(a!=null&&(V=Ke(a,"weights","softmaxCrossEntropy")),Tt(_.shape,j.shape,"Error in softmaxCrossEntropy: "),l>0){var ne=fr(l),oe=fr(1),me=fr(_.shape[1]);_=_.mul(oe.sub(ne)).add(ne.div(me))}var Ee=function(_e,Ne,Ue){if(Ue===void 0&&(Ue=-1),Ue===-1&&(Ue=Ne.rank-1),Ue!==Ne.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+Ne.rank+" and dim was "+Ue);return N(function($e,He,et){var lt=He.logSumExp([Ue],!0),ht=He.toFloat().sub(lt);return et([$e,ht]),{value:ht.mul($e).neg().sum([Ue]),gradFunc:function(gt,Ct){var Wt=Ct[0],Kt=Ct[1],Vt=_a(gt.shape,[Ue]);return[gt.reshape(Vt).mul(Wt.toFloat().sub(Kt.exp())),gt.reshape(Vt).mul(Kt.exp().sub(Wt.toFloat()))]}}})(_e,Ne)}(_,j);return $u(Ee,V,g)}}),Ir=Object.freeze({get Reduction(){return qo},absoluteDifference:ef,computeWeightedLoss:$u,cosineDistance:tv,hingeLoss:nv,huberLoss:ad,logLoss:bp,meanSquaredError:zv,sigmoidCrossEntropy:Jm,softmaxCrossEntropy:um});function I(p,c){return c===void 0&&(c=!1),Ve.tidy(function(){if(p.shape.length!==2)throw new Error("qr2d() requires a 2D Tensor, but got a "+p.shape.length+"D Tensor.");for(var a=p.shape[0],l=p.shape[1],g=Ic(a),_=p.clone(),j=eu([[1]],[1,1]),V=j.clone(),ne=a>=l?l:a,oe=function(Ee){var _e,Ne=_,Ue=V,$e=g;_e=Ve.tidy(function(){var He=_.slice([Ee,Ee],[a-Ee,1]),et=He.norm(),lt=_.slice([Ee,Ee],[1,1]),ht=eu([[-1]]).where(lt.greater(0),eu([[1]])),gt=lt.sub(ht.mul(et)),Ct=He.div(gt);V=Ct.shape[0]===1?j.clone():j.concat(Ct.slice([1,0],[Ct.shape[0]-1,Ct.shape[1]]),0);var Wt=ht.matMul(gt).div(et).neg(),Kt=_.slice([Ee,0],[a-Ee,l]),Vt=Wt.mul(V),Ht=V.transpose();if(Ee===0)_=Kt.sub(Vt.matMul(Ht.matMul(Kt)));else{var vn=Kt.sub(Vt.matMul(Ht.matMul(Kt)));_=_.slice([0,0],[Ee,l]).concat(vn,0)}var On=Vt.transpose(),Cn=g.slice([0,Ee],[a,g.shape[1]-Ee]);if(Ee===0)g=Cn.sub(Cn.matMul(V).matMul(On));else{var Kn=Cn.sub(Cn.matMul(V).matMul(On));g=g.slice([0,0],[a,Ee]).concat(Kn,1)}return[V,_,g]}),V=_e[0],_=_e[1],g=_e[2],Na([Ne,Ue,$e])},me=0;me<ne;++me)oe(me);return!c&&a>l&&(g=g.slice([0,0],[a,l]),_=_.slice([0,0],[l,l])),[g,_]})}var E=xt({bandPart_:function(p,c,a){if(c%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+c+".");if(a%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+a+".");var l=Ke(p,"a","bandPart");if(l.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+l.rank+".");var g=l.shape,_=l.shape.slice(-2),j=_[0],V=_[1];if(!(c<=j))throw new Error("bandPart(): numLower ("+c+") must not be greater than the number of rows ("+j+").");if(!(a<=V))throw new Error("bandPart(): numUpper ("+a+") must not be greater than the number of columns ("+V+").");c<0&&(c=j),a<0&&(a=V);var ne=ac(0,j,1,"int32").reshape([-1,1]),oe=ac(0,V,1,"int32"),me=_o(ne,oe),Ee=Tu(me.lessEqual(fr(+c,"int32")),me.greaterEqual(fr(-a,"int32"))),_e=Ki([j,V],l.dtype);return tu(Mh(l.reshape([-1,j,V])).map(function(Ne){return Nc(Ee,Ne,_e)})).reshape(g)}}),k=xt({gramSchmidt_:function(p){var c;if(Array.isArray(p)){c=!1,we(p!=null&&p.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var a=p[0].shape[0],l=function(ne){we(p[ne].shape[0]===a,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+p[ne].shape[0]+" vs. "+a+")"})},g=1;g<p.length;++g)l(g)}else c=!0,p=Ri(p,p.shape[0],0).map(function(ne){return Rs(ne,[0])});we(p.length<=p[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+p.length+") exceeds number of dimensions ("+p[0].shape[0]+")."});var _=[],j=p,V=function(ne){_.push(Ve.tidy(function(){var oe=j[ne];if(ne>0)for(var me=0;me<ne;++me){var Ee=fl(_[me].mulStrict(oe)).mul(_[me]);oe=oe.sub(Ee)}return oe.div(Km(oe,"euclidean"))}))};for(g=0;g<p.length;++g)V(g);return c?tu(_,0):_}}),w=xt({qr_:function(p,c){if(c===void 0&&(c=!1),p.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+p.rank);if(p.rank===2)return I(p,c);var a=p.shape.slice(0,p.shape.length-2).reduce(function(_,j){return _*j}),l=[],g=[];return Mh(p.reshape([a,p.shape[p.shape.length-2],p.shape[p.shape.length-1]]),0).forEach(function(_){var j=I(_,c),V=j[0],ne=j[1];l.push(V),g.push(ne)}),[tu(l,0).reshape(p.shape),tu(g,0).reshape(p.shape)]}}),S=Object.freeze({bandPart:E,gramSchmidt:k,qr:w});function z(p,c,a,l,g,_){l==null&&(l=.5),g==null&&(g=Number.NEGATIVE_INFINITY),_==null&&(_=0);var j=p.shape[0];return a=Math.min(a,j),we(0<=l&&l<=1,function(){return"iouThreshold must be in [0, 1], but was '"+l+"'"}),we(p.rank===2,function(){return"boxes must be a 2D tensor, but was of rank '"+p.rank+"'"}),we(p.shape[1]===4,function(){return"boxes must have 4 columns, but 2nd dimension was "+p.shape[1]}),we(c.rank===1,function(){return"scores must be a 1D tensor"}),we(c.shape[0]===j,function(){return"scores has incompatible shape with boxes. Expected "+j+", but was "+c.shape[0]}),we(0<=_&&_<=1,function(){return"softNmsSigma must be in [0, 1], but was '"+_+"'"}),{maxOutputSize:a,iouThreshold:l,scoreThreshold:g,softNmsSigma:_}}var Y=xt({resizeBilinear_:function(p,c,a){a===void 0&&(a=!1);var l=Ke(p,"images","resizeBilinear");we(l.rank===3||l.rank===4,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+l.rank+"."}),we(c.length===2,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+c+"."});var g=l,_=!1;l.rank===3&&(_=!0,g=l.as4D(1,l.shape[0],l.shape[1],l.shape[2]));var j=c[0],V=c[1],ne=Ve.runKernelFunc(function(oe,me){return me([g]),oe.resizeBilinear(g,j,V,a)},{x:g},function(oe,me){return{x:function(){return Ve.runKernelFunc(function(Ee){return Ee.resizeBilinearBackprop(oe,me[0],a)},{})}}},"ResizeBilinear",{alignCorners:a,newHeight:j,newWidth:V});return _?ne.as3D(ne.shape[1],ne.shape[2],ne.shape[3]):ne}}),ce=xt({resizeNearestNeighbor_:function(p,c,a){a===void 0&&(a=!1);var l=Ke(p,"images","resizeNearestNeighbor");we(l.rank===3||l.rank===4,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+l.rank+"."}),we(c.length===2,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+c+"."}),we(l.dtype==="float32"||l.dtype==="int32",function(){return"`images` must have `int32` or `float32` as dtype"});var g=l,_=!1;l.rank===3&&(_=!0,g=l.as4D(1,l.shape[0],l.shape[1],l.shape[2]));var j=c[0],V=c[1],ne=Ve.runKernelFunc(function(oe,me){return me([g]),oe.resizeNearestNeighbor(g,j,V,a)},{batchImages:g},function(oe,me){return{batchImages:function(){return Ve.runKernelFunc(function(Ee){return Ee.resizeNearestNeighborBackprop(oe,me[0],a)},{})}}});return _?ne.as3D(ne.shape[1],ne.shape[2],ne.shape[3]):ne}}),ve=xt({nonMaxSuppression_:function(p,c,a,l,g){l===void 0&&(l=.5),g===void 0&&(g=Number.NEGATIVE_INFINITY);var _=Ke(p,"boxes","nonMaxSuppression"),j=Ke(c,"scores","nonMaxSuppression"),V=z(_,j,a,l,g);a=V.maxOutputSize,l=V.iouThreshold,g=V.scoreThreshold;var ne={maxOutputSize:a,iouThreshold:l,scoreThreshold:g};return Ve.runKernelFunc(function(oe){return oe.nonMaxSuppression(_,j,a,l,g)},{boxes:_,scores:j},null,"NonMaxSuppressionV3",ne)}}),De=xt({nonMaxSuppressionWithScore_:function(p,c,a,l,g,_){l===void 0&&(l=.5),g===void 0&&(g=Number.NEGATIVE_INFINITY),_===void 0&&(_=0);var j=Ke(p,"boxes","nonMaxSuppression"),V=Ke(c,"scores","nonMaxSuppression"),ne=z(j,V,a,l,g,_),oe={maxOutputSize:a=ne.maxOutputSize,iouThreshold:l=ne.iouThreshold,scoreThreshold:g=ne.scoreThreshold,softNmsSigma:_=ne.softNmsSigma},me=Ve.runKernel("NonMaxSuppressionV5",{boxes:j,scores:V},oe);return{selectedIndices:me[0],selectedScores:me[1]}}}),Ce=xt({cropAndResize_:function(p,c,a,l,g,_){var j=Ke(p,"image","cropAndResize"),V=Ke(c,"boxes","cropAndResize","float32"),ne=Ke(a,"boxInd","cropAndResize","int32");g=g||"bilinear",_=_||0;var oe=V.shape[0];return we(j.rank===4,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+j.rank+"."}),we(V.rank===2&&V.shape[1]===4,function(){return"Error in cropAndResize: boxes must be have size ["+oe+",4] but had shape "+V.shape+"."}),we(ne.rank===1&&ne.shape[0]===oe,function(){return"Error in cropAndResize: boxInd must be have size ["+oe+"] but had shape "+V.shape+"."}),we(l.length===2,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+l.length+"."}),we(l[0]>=1&&l[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+l}),we(g==="bilinear"||g==="nearest",function(){return"method must be bilinear or nearest, but was "+g}),Ve.runKernelFunc(function(me,Ee){return me.cropAndResize(j,V,ne,l,g,_)},{images:j,boxes:V,boxInd:ne},null,"CropAndResize",{method:g,extrapolationValue:_,cropSize:l})}}),Xe=Object.freeze({resizeBilinear:Y,resizeNearestNeighbor:ce,nonMaxSuppression:ve,nonMaxSuppressionAsync:function(p,c,a,l,g){return l===void 0&&(l=.5),g===void 0&&(g=Number.NEGATIVE_INFINITY),R(this,void 0,void 0,function(){var _,j,V,ne,oe,me,Ee;return P(this,function(_e){switch(_e.label){case 0:return _=Ke(p,"boxes","nonMaxSuppressionAsync"),j=Ke(c,"scores","nonMaxSuppressionAsync"),V=z(_,j,a,l,g),a=V.maxOutputSize,l=V.iouThreshold,g=V.scoreThreshold,[4,Promise.all([_.data(),j.data()])];case 1:return ne=_e.sent(),oe=ne[0],me=ne[1],Ee=Ya(oe,me,a,l,g),_!==p&&_.dispose(),j!==c&&j.dispose(),[2,Ee]}})})},nonMaxSuppressionWithScore:De,nonMaxSuppressionWithScoreAsync:function(p,c,a,l,g,_){return l===void 0&&(l=.5),g===void 0&&(g=Number.NEGATIVE_INFINITY),_===void 0&&(_=0),R(this,void 0,void 0,function(){var j,V,ne,oe,me,Ee,_e;return P(this,function(Ne){switch(Ne.label){case 0:return j=Ke(p,"boxes","nonMaxSuppressionAsync"),V=Ke(c,"scores","nonMaxSuppressionAsync"),ne=z(j,V,a,l,g,_),a=ne.maxOutputSize,l=ne.iouThreshold,g=ne.scoreThreshold,_=ne.softNmsSigma,[4,Promise.all([j.data(),V.data()])];case 1:return oe=Ne.sent(),me=oe[0],Ee=oe[1],_e=Sa(me,Ee,a,l,g,_),j!==p&&j.dispose(),V!==c&&V.dispose(),[2,_e]}})})},cropAndResize:Ce}),tt=function(p,c){return!(p>0)||c==="linear"},kt=function(p,c,a){if(a==null||a==="linear")return p;if(a==="relu")return p.mul(c.step());throw new Error("Gradient for activation "+a+" has not been implemented yet.")},At=function(p,c){var a=c,l=Fo(p.shape,c.shape);return l.length>0&&(a=a.sum(l)),a.reshape(p.shape)},tn=function(p,c,a){if(c==="linear")return p;if(c==="relu")return rm(p);if(c==="elu")return eh(p);if(c==="relu6")return Gm(p);if(c==="prelu")return rs(p,a);throw new Error("Unknown fused activation "+c+".")},sn=xt({fusedMatMul_:function(p){var c,a=p.a,l=p.b,g=p.transposeA,_=g!==void 0&&g,j=p.transposeB,V=j!==void 0&&j,ne=p.bias,oe=p.activation,me=oe===void 0?"linear":oe,Ee=p.preluActivationWeights;if(tt(Ve.state.gradientDepth,me)===!1){var _e=dc(a,l,_,V);return ne!=null&&(_e=eo(_e,ne)),tn(_e,me,Ee)}var Ne=Ke(a,"a","fused matMul"),Ue=Ke(l,"b","fused matMul");c=An(Ne,Ue),Ne=c[0],Ue=c[1];var $e=_?Ne.shape[Ne.rank-2]:Ne.shape[Ne.rank-1],He=V?Ue.shape[Ue.rank-1]:Ue.shape[Ue.rank-2],et=_?Ne.shape[Ne.rank-1]:Ne.shape[Ne.rank-2],lt=V?Ue.shape[Ue.rank-2]:Ue.shape[Ue.rank-1],ht=Ne.shape.slice(0,-2),gt=Ue.shape.slice(0,-2),Ct=Ye(ht),Wt=Ye(gt);we(Ne.rank>=2&&Ue.rank>=2&&Ne.rank===Ue.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+Ne.rank+" and "+Ue.rank+"."}),we(ln(ht,gt),function(){return"Error in fused matMul: outer dimensions ("+ht+") and ("+gt+") of Tensors with shapes "+Ne.shape+" and "+Ue.shape+" must match."}),we($e===He,function(){return"Error in fused matMul: inner shapes ("+$e+") and ("+He+") of Tensors with shapes "+Ne.shape+" and "+Ue.shape+" and transposeA="+_+" and transposeB="+V+" must match."});var Kt,Vt,Ht=Ne.shape.slice(0,-2).concat([et,lt]),vn=_?Ne.as3D(Ct,$e,et):Ne.as3D(Ct,et,$e),On=V?Ue.as3D(Wt,lt,He):Ue.as3D(Wt,He,lt);ne!=null&&Mi(Ht,(Kt=An(Kt=Ke(ne,"bias","fused matMul"),Ne)[0]).shape),Ee!=null&&(Vt=Ke(Ee,"prelu weights","fused matMul"));var Cn={a:vn,b:On};ne!=null&&(Cn.bias=Kt),Ee!=null&&(Cn.preluActivationWeights=Vt);var Kn=[vn,On];return Ve.runKernelFunc(function(er,sr){var lr=er.fusedBatchMatMul({a:vn,b:On,transposeA:_,transposeB:V,bias:Kt,activation:me,preluActivationWeights:Vt});return sr([vn,On,lr]),lr},Cn,function(er,sr){var lr=sr[0],ur=sr[1],ar=sr[2],Or=kt(er,ar,me),Er={};return ne!=null&&(Er={bias:function(){return At(Kt,Or)}}),Object.assign(_||V?!_&&V?{a:function(){return Or.matMul(ur,!1,!1)},b:function(){return Or.matMul(lr,!0,!1)}}:_&&!V?{a:function(){return ur.matMul(Or,!1,!0)},b:function(){return lr.matMul(Or,!1,!1)}}:{a:function(){return ur.matMul(Or,!0,!0)},b:function(){return Or.matMul(lr,!0,!0)}}:{a:function(){return Or.matMul(ur,!1,!0)},b:function(){return lr.matMul(Or,!0,!1)}},Er)},"_FusedMatMul",{transposeA:_,transposeB:V,activation:me},Kn,[!0]).reshape(Ht)}}),wn=xt({fusedConv2d_:function(p){var c=p.x,a=p.filter,l=p.strides,g=p.pad,_=p.dataFormat,j=_===void 0?"NHWC":_,V=p.dilations,ne=V===void 0?[1,1]:V,oe=p.dimRoundingMode,me=p.bias,Ee=p.activation,_e=Ee===void 0?"linear":Ee,Ne=p.preluActivationWeights;if(_e=_e||"linear",tt(Ve.state.gradientDepth,_e)===!1){var Ue=Jf(c,a,l,g,j,ne,oe);return me!=null&&(Ue=eo(Ue,me)),tn(Ue,_e,Ne)}var $e=Ke(c,"x","conv2d"),He=Ke(a,"filter","conv2d"),et=$e,lt=!1;$e.rank===3&&(lt=!0,et=$e.as4D(1,$e.shape[0],$e.shape[1],$e.shape[2])),we(et.rank===4,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+et.rank+"."}),we(He.rank===4,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+He.rank+"."}),oe!=null&&we(Zt(g),function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+oe+" but got pad "+g+"."}),we(et.shape[3]===He.shape[2],function(){return"Error in conv2d: depth of input ("+et.shape[3]+") must match input depth for filter "+He.shape[2]+"."}),we(wr(l,ne),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+l+" and dilations '"+ne+"'"}),we(j==="NHWC",function(){return"Error in conv2d: got dataFormat of "+j+" but only NHWC is currently supported."});var ht,gt,Ct=Nn(et.shape,He.shape,l,ne,g,oe);me!=null&&(ht=An(ht=Ke(me,"bias","fused conv2d"),$e)[0],Mi(Ct.outShape,ht.shape)),Ne!=null&&(gt=Ke(Ne,"prelu weights","fused conv2d"));var Wt={x:et,filter:He};me!=null&&(Wt.bias=ht),Ne!=null&&(Wt.preluActivationWeights=gt);var Kt=[He,et],Vt=Ve.runKernelFunc(function(Ht,vn){var On=Ht.fusedConv2d({input:et,filter:He,convInfo:Ct,bias:ht,activation:_e,preluActivationWeights:gt});return vn([He,et,On]),On},Wt,function(Ht,vn){var On=vn,Cn=On[0],Kn=On[1],er=On[2],sr=kt(Ht,er,_e);we(Vr(ne),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+ne+"'"});var lr={};return me!=null&&(lr={bias:function(){return At(ht,sr)}}),Object.assign({x:function(){return ul(Kn.shape,sr,Cn,l,g)},filter:function(){return Vg(Kn,sr,Cn.shape,l,g)}},lr)},"FusedConv2D",{convInfo:Ct,activation:_e},Kt,[!0]);return lt?Vt.as3D(Vt.shape[1],Vt.shape[2],Vt.shape[3]):Vt}}),En=xt({fusedDepthwiseConv2d_:function(p){var c=p.x,a=p.filter,l=p.strides,g=p.pad,_=p.dataFormat,j=_===void 0?"NHWC":_,V=p.dilations,ne=V===void 0?[1,1]:V,oe=p.dimRoundingMode,me=p.bias,Ee=p.activation,_e=Ee===void 0?"linear":Ee,Ne=p.preluActivationWeights;if(tt(Ve.state.gradientDepth,_e)===!1){var Ue=Wm(c,a,l,g,j,ne,oe);return me!=null&&(Ue=eo(Ue,me)),tn(Ue,_e,Ne)}var $e=Ke(c,"x","depthwiseConv2d"),He=Ke(a,"filter","depthwiseConv2d"),et=$e,lt=!1;$e.rank===3&&(lt=!0,et=$e.as4D(1,$e.shape[0],$e.shape[1],$e.shape[2])),we(et.rank===4,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+et.rank+"."}),we(He.rank===4,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+He.rank+"."}),we(et.shape[3]===He.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels ("+et.shape[3]+") must match the inChannels dimension in filter "+He.shape[2]+"."}),ne==null&&(ne=[1,1]),we(wr(l,ne),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+l+" and dilations '"+ne+"'"}),oe!=null&&we(Zt(g),function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+oe+" but got pad "+g+"."});var ht,gt,Ct=Nn(et.shape,He.shape,l,ne,g,oe,!0);me!=null&&(ht=An(ht=Ke(me,"bias","fused conv2d"),$e)[0],Mi(Ct.outShape,ht.shape)),Ne!=null&&(gt=Ke(Ne,"prelu weights","fused depthwiseConv2d"));var Wt={x:et,filter:He};me!=null&&(Wt.bias=ht),Ne!=null&&(Wt.preluActivationWeights=gt);var Kt=[He,et],Vt=Ve.runKernelFunc(function(Ht,vn){var On=Ht.fusedDepthwiseConv2D({input:et,filter:He,convInfo:Ct,bias:ht,activation:_e,preluActivationWeights:gt});return vn([He,et,On]),On},Wt,function(Ht,vn){we(Vr(ne),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+ne+"'"});var On=vn[0],Cn=vn[1],Kn=vn[2],er=kt(Ht,Kn,_e),sr={};return me!=null&&(sr={bias:function(){return At(ht,er)}}),Object.assign({x:function(){return qg(Cn.shape,er,On,Ct)},filter:function(){return Qf(Cn,er,On.shape,Ct)}},sr)},"FusedDepthwiseConv2D",{convInfo:Ct,activation:_e},Kt,[!0]);return lt?Vt.as3D(Vt.shape[1],Vt.shape[2],Vt.shape[3]):Vt}}),Tn=Object.freeze({matMul:sn,conv2d:wn,depthwiseConv2d:En}),Pn=Object.freeze({image:Xe,linalg:S,losses:Ir,spectral:im,fused:Tn,signal:Xm,add:eo,addN:Wf,batchNorm:ql,batchNormalization:ta,batchNorm2d:Rv,batchNormalization2d:Fv,batchNorm3d:al,batchNormalization3d:Hl,batchNorm4d:Hf,batchNormalization4d:Yh,broadcastTo:$l,clone:Gl,div:Xa,divNoNan:Up,eye:Ic,multinomial:ts,oneHot:fc,pad:Nu,pad1d:hu,pad2d:Qh,pad3d:Wp,pad4d:jm,rand:Bm,randomGamma:Hp,randomNormal:Rg,randomUniform:$p,square:Kl,squaredDifference:Gp,tile:Kf,truncatedNormal:Zh,conv1d:Wg,conv2d:Jf,conv3d:jv,depthwiseConv2d:Wm,separableConv2d:cl,conv2dTranspose:Jp,conv3dTranspose:Vm,op:xt,booleanMaskAsync:Lg,complex:fa,real:uo,imag:Uo,concat:Ba,concat1d:Fh,concat2d:Pd,concat3d:Al,concat4d:Rh,split:Ri,matMul:dc,dot:qm,outerProduct:Hg,reverse:Yl,reverse1d:Bv,reverse2d:ed,reverse3d:td,reverse4d:Jl,maxPool:pc,avgPool:nd,pool:lp,maxPool3d:Qp,avgPool3d:Hm,maxPoolWithArgmax:Gg,slice:ns,slice1d:Kg,slice2d:rd,slice3d:Xg,slice4d:Zp,abs:Es,acos:Oc,acosh:Ro,asin:Ac,asinh:Uu,atan:Df,atanh:Tf,ceil:Xc,clipByValue:Vd,cos:Wu,cosh:Em,erf:qd,exp:Fl,expm1:jp,floor:Nf,log:Yc,log1p:Hd,logSigmoid:zh,neg:yo,reciprocal:Rl,round:Cs,rsqrt:Ml,sigmoid:If,sign:Uh,isNaN:$d,isInf:Ff,isFinite:jl,sin:Gd,sinh:Kd,softplus:en,sqrt:Ws,step:Un,tan:Os,tanh:na,all:fp,any:ll,argMax:Yg,argMin:em,logSumExp:tm,max:$m,mean:Fc,min:nm,moments:Jg,sum:fl,prod:hp,equal:Kp,equalStrict:Pm,greater:Lm,greaterEqual:sp,greaterEqualStrict:zm,greaterStrict:Xp,less:Mg,lessEqual:sl,lessEqualStrict:Mv,lessStrict:jg,notEqual:up,notEqualStrict:Bg,addStrict:Bl,atan2:Rf,divStrict:nr,floorDiv:Go,maximum:bo,maximumStrict:Hi,minimum:ku,minimumStrict:oc,mod:Vs,modStrict:sc,mul:Ka,mulStrict:Vu,pow:qs,powStrict:oa,squaredDifferenceStrict:cs,sub:_o,subStrict:ls,elu:eh,leakyRelu:dp,prelu:rs,relu:rm,relu6:Gm,selu:pp,logicalAnd:Tu,logicalNot:Jh,logicalOr:$f,logicalXor:ol,where:Nc,whereAsync:Gf,buffer:bi,print:ro,batchToSpaceND:Ld,cast:zd,cumsum:Ud,depthToSpace:Rp,expandDims:zu,reshape:ks,spaceToBatchND:$c,squeeze:Rs,stack:tu,unstack:Mh,setdiff1dAsync:Ni,fill:ws,linspace:Ih,ones:uu,range:ac,scalar:fr,tensor:wa,tensor1d:zs,tensor2d:eu,tensor3d:Hc,tensor4d:Us,tensor5d:Nh,tensor6d:jd,variable:Bd,zeros:Ki,onesLike:us,zerosLike:ii,transpose:ft,softmax:Be,logSoftmax:Ge,localResponseNormalization:mp,norm:Km,gather:cp,unsortedSegmentSum:Yp,basicLSTMCell:Qg,multiRNNCell:Pv,movingAverage:Rc,stridedSlice:th,topk:Lv,scatterND:Zg,fft:Mc,ifft:Xo,rfft:id,irfft:gp,sparseToDense:ev,gatherND:am,diag:Zl,dropout:E0,hannWindow:vp,hammingWindow:nh,frame:sm,stft:yp,inTopKAsync:Ym});function dn(p,c){Array.isArray(p)||(p=[p]),p.forEach(function(a){a!=null&&we(a.dtype!=="complex64",function(){return c+" does not support complex64 tensors."})})}function cr(p,c,a,l,g,_){for(var j=g.strideHeight,V=g.strideWidth,ne=g.dilationHeight,oe=g.dilationWidth,me=g.effectiveFilterHeight,Ee=g.effectiveFilterWidth,_e=g.padInfo.top,Ne=g.padInfo.left,Ue=_==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,$e=bi(g.outShape,a),He=$e.values,et=g.outShape[1]*g.outShape[2]*g.outShape[3],lt=g.outShape[2]*g.outShape[3],ht=g.outShape[3],gt=0;gt<g.batchSize;++gt)for(var Ct=gt*et,Wt=gt*l[0],Kt=0;Kt<g.inChannels;++Kt)for(var Vt=0;Vt<g.outHeight;++Vt)for(var Ht=Vt*j-_e,vn=Math.max(0,Ht),On=Math.min(g.inHeight,me+Ht),Cn=Ct+Vt*lt,Kn=0;Kn<g.outWidth;++Kn){for(var er=Kn*V-Ne,sr=Math.max(0,er),lr=Math.min(g.inWidth,Ee+er),ur=Ue,ar=0,Or=0,Er=vn;Er<On;Er+=ne){for(var Ur=Wt+Er*l[1],ei=sr;ei<lr;ei+=oe){var mi=p[Ur+ei*l[2]+Kt];_==="max"&&mi>ur?ur=mi:_==="avg"&&(ar+=mi,Or++)}if(isNaN(ur))break}He[Cn+Kn*ht+Kt]=_==="avg"?ar/Or:ur}return $e}function kr(p,c,a,l,g,_){g===void 0&&(g=!1),_===void 0&&(_=!1);for(var j=bi(l.outShape,"int32"),V=l.strideHeight,ne=l.strideWidth,oe=l.dilationHeight,me=l.dilationWidth,Ee=l.effectiveFilterHeight,_e=l.effectiveFilterWidth,Ne=l.padInfo.top,Ue=l.padInfo.left,$e=bi(c,a,p),He=0;He<l.batchSize;++He)for(var et=0;et<l.inChannels;++et)for(var lt=0;lt<l.outHeight;++lt){for(var ht=lt*V-Ne,gt=ht;gt<0;)gt+=oe;for(var Ct=Math.min(l.inHeight,Ee+ht),Wt=0;Wt<l.outWidth;++Wt){for(var Kt=Wt*ne-Ue,Vt=Kt;Vt<0;)Vt+=me;for(var Ht=Math.min(l.inWidth,_e+Kt),vn=Number.NEGATIVE_INFINITY,On=-1,Cn=gt;Cn<Ct;Cn+=oe)for(var Kn=Cn-ht,er=Vt;er<Ht;er+=me){var sr=er-Kt,lr=$e.get(He,Cn,er,et);lr>vn&&(vn=lr,On=g?_?((He*l.inHeight+Cn)*l.inWidth+er)*l.inChannels+et:(Cn*l.inWidth+er)*l.inChannels+et:Kn*_e+sr)}j.set(On,He,lt,Wt,et)}}return j}function yr(p,c,a,l){if(a==="linear")return p.linear(c);if(a==="relu")return p.relu(c);if(a==="elu")return p.elu(c);if(a==="relu6")return p.relu6(c);if(a==="prelu")return p.prelu(c,l);throw new Error("Activation "+a+" has not been implemented for the CPU backend.")}var Br=function(p){function c(){var a=p.call(this)||this;return a.blockSize=48,a.firstUse=!0,a.data=new Nt(a,Ve),a}return J(c,p),c.prototype.write=function(a,l,g){this.firstUse&&(this.firstUse=!1,L().get("IS_NODE")&&qc(`
============================
Hi there . Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.
============================`));var _={};return this.data.set(_,{values:a,dtype:g}),_},c.prototype.move=function(a,l,g,_){this.data.set(a,{values:l,dtype:_})},c.prototype.numDataIds=function(){return this.data.numDataIds()},c.prototype.read=function(a){return R(this,void 0,void 0,function(){return P(this,function(l){return[2,this.readSync(a)]})})},c.prototype.readSync=function(a){var l=this.data.get(a),g=l.dtype,_=l.complexTensors;return g==="complex64"?Zr(this.readSync(_.real.dataId),this.readSync(_.imag.dataId)):this.data.get(a).values},c.prototype.bufferSync=function(a){var l=this.readSync(a.dataId),g=l;if(a.dtype==="string")try{g=l.map(function(_){return mr(_)})}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return bi(a.shape,a.dtype,g)},c.prototype.makeOutput=function(a,l,g){var _=this.write(a,l,g);return Ve.makeTensorFromDataId(_,l,g,this)},c.prototype.disposeData=function(a){if(this.data.has(a)){var l=this.data.get(a).complexTensors;l!=null&&(l.real.dispose(),l.imag.dispose()),this.data.delete(a)}},c.prototype.time=function(a){return R(this,void 0,void 0,function(){var l;return P(this,function(g){return l=nn(),a(),[2,{kernelMs:nn()-l}]})})},c.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},c.prototype.complex=function(a,l){var g=this.makeOutput(null,a.shape,"complex64");return this.data.get(g.dataId).complexTensors={real:Ve.keep(a.clone()),imag:Ve.keep(l.clone())},g},c.prototype.real=function(a){return this.data.get(a.dataId).complexTensors.real.clone()},c.prototype.imag=function(a){return this.data.get(a.dataId).complexTensors.imag.clone()},c.prototype.slice=function(a,l,g){if(dn(a,"slice"),Vh(a.shape,l,g)){var _=Mf(l,a.strides),j=Ye(g);return wa(this.readSync(a.dataId).subarray(_,_+j),g,a.dtype)}for(var V=bi(g,a.dtype),ne=this.bufferSync(a),oe=0;oe<V.size;++oe){var me=V.indexToLoc(oe).map(function(Ee,_e){return Ee+l[_e]});V.values[oe]=ne.get.apply(ne,me)}return V.toTensor()},c.prototype.stridedSlice=function(a,l,g,_){dn(a,"stridedSlice");var j=Ou(l,g,_);if(j.some(function(Ne){return Ne===0}))return wa([],j);for(var V=bi(j,a.dtype),ne=this.bufferSync(a),oe=0;oe<V.size;oe++){for(var me=V.indexToLoc(oe),Ee=new Array(me.length),_e=0;_e<Ee.length;_e++)Ee[_e]=me[_e]*_[_e]+l[_e];V.set.apply(V,[ne.get.apply(ne,Ee)].concat(me))}return V.toTensor()},c.prototype.diag=function(a){for(var l=this.readSync(a.dataId),g=bi([a.size,a.size],a.dtype),_=g.values,j=0;j<l.length;j++)_[j*a.size+j]=l[j];return g.toTensor()},c.prototype.unstack=function(a,l){for(var g=a.shape[l],_=new Array(a.rank-1),j=0,V=0;V<a.rank;V++)V!==l&&(_[j++]=a.shape[V]);var ne=new Array(a.rank).fill(0),oe=a.shape.slice();oe[l]=1;var me=new Array(g);for(V=0;V<me.length;V++)ne[l]=V,me[V]=this.slice(a,ne,oe).reshape(_);return me},c.prototype.reverse=function(a,l){dn(a,"reverse");for(var g=bi(a.shape,a.dtype),_=this.bufferSync(a),j=function(ne){var oe=g.indexToLoc(ne),me=oe.slice();l.forEach(function(Ee){return me[Ee]=a.shape[Ee]-1-me[Ee]}),g.set.apply(g,[_.get.apply(_,me)].concat(oe))},V=0;V<g.size;V++)j(V);return g.toTensor()},c.prototype.concat=function(a,l){var g=this;if(a[0].dtype==="complex64"){var _=a.map(function(Ne){return uo(Ne)}),j=a.map(function(Ne){return Uo(Ne)});return fa(this.concat(_,l),this.concat(j,l))}var V=a.map(function(Ne){var Ue=Ye(Ne.shape.slice(l));return Ne.as2D(-1,Ue)}),ne=Zs(V.map(function(Ne){return Ne.shape}),1),oe=bi(ne,a[0].dtype).values;if(V[0].shape[0]===1){var me=0;V.forEach(function(Ne){oe.set(g.readSync(Ne.dataId),me),me+=Ne.size})}else{var Ee=0;V.forEach(function(Ne){for(var Ue=g.readSync(Ne.dataId),$e=0,He=0;He<Ne.shape[0];++He)for(var et=He*ne[1]+Ee,lt=0;lt<Ne.shape[1];++lt)oe[et+lt]=Ue[$e++];Ee+=Ne.shape[1]})}var _e=Zs(a.map(function(Ne){return Ne.shape}),l);return wa(oe,_e,a[0].dtype)},c.prototype.neg=function(a){return dn(a,"neg"),this.multiply(fr(-1),a)},c.prototype.add=function(a,l){return a.dtype==="complex64"||l.dtype==="complex64"?this.broadcastedBinaryComplexOp(a.cast("complex64"),l.cast("complex64"),function(g,_,j,V){return{real:g+j,imag:_+V}}):this.broadcastedBinaryOp(a,l,cn(a.dtype,l.dtype),function(g,_){return g+_})},c.prototype.addN=function(a){var l=this;dn(a,"addN");for(var g=a.map(function(me){return l.readSync(me.dataId)}),_=bi(a[0].shape,a[0].dtype),j=_.values,V=0;V<a.length;V++)for(var ne=g[V],oe=0;oe<j.length;oe++)j[oe]+=ne[oe];return _.toTensor()},c.prototype.softmax=function(a,l){var g=xn([l],a.shape),_=this.max(a,g),j=_a(_.shape,g),V=this.subtract(a,_.reshape(j)),ne=this.exp(V),oe=this.sum(ne,g).reshape(j);return Xa(ne,oe)},c.prototype.subtract=function(a,l){return a.dtype==="complex64"||l.dtype==="complex64"?this.broadcastedBinaryComplexOp(a.cast("complex64"),l.cast("complex64"),function(g,_,j,V){return{real:g-j,imag:_-V}}):this.broadcastedBinaryOp(a,l,cn(a.dtype,l.dtype),function(g,_){return g-_})},c.prototype.pow=function(a,l){return dn([a,l],"pow"),this.broadcastedBinaryOp(a,l,a.dtype,function(g,_){return Math.pow(g,_)})},c.prototype.batchMatMul=function(a,l,g,_){dn([a,l],"matMul");for(var j=g?a.shape[1]:a.shape[2],V=g?a.shape[2]:a.shape[1],ne=_?l.shape[1]:l.shape[2],oe=a.shape[0],me=this.readSync(a.dataId),Ee=this.readSync(l.dataId),_e=g?[a.strides[0],1,a.strides[1]]:[a.strides[0],a.strides[1],1],Ne=_e[0],Ue=_e[1],$e=_e[2],He=_?[1,l.strides[1],l.strides[0]]:[l.strides[1],1,l.strides[0]],et=He[0],lt=He[1],ht=He[2],gt=V*ne,Ct=bi([oe,V,ne],a.dtype),Wt=Ct.values,Kt=this.blockSize,Vt=0;Vt<oe;Vt++)for(var Ht=0;Ht<V;Ht+=Kt)for(var vn=0;vn<ne;vn+=Kt)for(var On=0;On<j;On+=Kt)for(var Cn=Math.min(Ht+Kt,V),Kn=Math.min(vn+Kt,ne),er=Math.min(On+Kt,j),sr=Ht;sr<Cn;sr++)for(var lr=vn;lr<Kn;lr++){for(var ur=0,ar=On;ar<er;ar++)ur+=me[Vt*Ne+sr*Ue+ar*$e]*Ee[ar*et+lr*lt+Vt*ht];Wt[Vt*gt+(sr*ne+lr)]+=ur}return Ct.toTensor()},c.prototype.fusedBatchMatMul=function(a){var l=a.a,g=a.b,_=a.transposeA,j=a.transposeB,V=a.bias,ne=a.activation,oe=a.preluActivationWeights,me=this.batchMatMul(l,g,_,j);return V&&(me=this.add(me,V)),ne&&(me=yr(this,me,ne,oe)),me},c.prototype.multiply=function(a,l){return a.dtype==="complex64"||l.dtype==="complex64"?this.broadcastedBinaryComplexOp(a.cast("complex64"),l.cast("complex64"),function(g,_,j,V){return{real:g*j-_*V,imag:g*V+_*j}}):this.broadcastedBinaryOp(a,l,cn(a.dtype,l.dtype),function(g,_){return g*_})},c.prototype.floorDiv=function(a,l){return dn([a,l],"floorDiv"),this.broadcastedBinaryOp(a,l,"int32",function(g,_){return Math.floor(g/_)})},c.prototype.sum=function(a,l){dn(a,"sum"),Ga("sum",l,a.rank);for(var g=Aa(a.shape,l),_=g[0],j=g[1],V=Ki(_,cn(a.dtype,"int32")),ne=Ye(j),oe=this.readSync(V.dataId),me=this.readSync(a.dataId),Ee=0;Ee<oe.length;++Ee){for(var _e=Ee*ne,Ne=0,Ue=0;Ue<ne;++Ue)Ne+=me[_e+Ue];oe[Ee]=Ne}return V},c.prototype.prod=function(a,l){dn(a,"sum");for(var g=Aa(a.shape,l),_=g[0],j=g[1],V=Ki(_,cn(a.dtype,"int32")),ne=Ye(j),oe=this.readSync(V.dataId),me=this.readSync(a.dataId),Ee=0;Ee<oe.length;++Ee){for(var _e=Ee*ne,Ne=1,Ue=0;Ue<ne;++Ue)Ne*=me[_e+Ue];oe[Ee]=Ne}return V},c.prototype.unsortedSegmentSum=function(a,l,g){dn(a,"unsortedSegmentSum");for(var _=[],j=a.rank-l.rank,V=0;V<j;++V)l=l.expandDims(V+1);for(V=0;V<g;++V){var ne=fr(V,"int32"),oe=Kp(ne,l).asType("float32").mul(a).sum(0);_.push(oe)}return tu(_)},c.prototype.argMin=function(a,l){dn(a,"argMin");var g=[l];Ga("argMin",g,a.rank);for(var _=Aa(a.shape,g),j=_[0],V=_[1],ne=Ki(j,"int32"),oe=Ye(V),me=this.readSync(ne.dataId),Ee=this.readSync(a.dataId),_e=0;_e<me.length;++_e){for(var Ne=_e*oe,Ue=Ee[Ne],$e=0,He=0;He<oe;++He){var et=Ee[Ne+He];et<Ue&&(Ue=et,$e=He)}me[_e]=$e}return ne},c.prototype.argMax=function(a,l){dn(a,"argMax");var g=[l];Ga("argMax",g,a.rank);for(var _=Aa(a.shape,g),j=_[0],V=_[1],ne=Ki(j,"int32"),oe=Ye(V),me=this.readSync(ne.dataId),Ee=this.readSync(a.dataId),_e=0;_e<me.length;++_e){for(var Ne=_e*oe,Ue=Ee[Ne],$e=0,He=0;He<oe;++He){var et=Ee[Ne+He];et>Ue&&(Ue=et,$e=He)}me[_e]=$e}return ne},c.prototype.cumsum=function(a,l,g,_){if(dn(a,"cumsum"),l!==a.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(a.rank-1)+" but got axis="+l);for(var j=cn(a.dtype,"int32"),V=Ki(a.shape,j),ne=this.readSync(V.dataId),oe=this.readSync(a.dataId),me=a.shape[a.rank-1],Ee=_?function(He,et){return He+me-et-1}:function(He,et){return He+et},_e=0;_e<oe.length;_e+=me)for(var Ne=0;Ne<me;Ne++){var Ue=Ee(_e,Ne);if(Ne===0)ne[Ue]=g?0:oe[Ue];else{var $e=Ee(_e,Ne-1);ne[Ue]=g?oe[$e]+ne[$e]:oe[Ue]+ne[$e]}}return V},c.prototype.equal=function(a,l){return dn([a,l],"equal"),this.broadcastedBinaryOp(a,l,"bool",function(g,_){return g===_?1:0})},c.prototype.notEqual=function(a,l){return dn([a,l],"notEqual"),this.broadcastedBinaryOp(a,l,"bool",function(g,_){return g!==_?1:0})},c.prototype.less=function(a,l){return dn([a,l],"less"),this.broadcastedBinaryOp(a,l,"bool",function(g,_){return g<_?1:0})},c.prototype.lessEqual=function(a,l){return dn([a,l],"lessEqual"),this.broadcastedBinaryOp(a,l,"bool",function(g,_){return g<=_?1:0})},c.prototype.greater=function(a,l){return dn([a,l],"greater"),this.broadcastedBinaryOp(a,l,"bool",function(g,_){return g>_?1:0})},c.prototype.greaterEqual=function(a,l){return dn([a,l],"greaterEqual"),this.broadcastedBinaryOp(a,l,"bool",function(g,_){return g>=_?1:0})},c.prototype.logicalNot=function(a){dn(a,"logicalNot");for(var l=this.readSync(a.dataId),g=new Uint8Array(l.length),_=0;_<l.length;++_)g[_]=l[_]?0:1;return this.makeOutput(g,a.shape,"bool")},c.prototype.logicalAnd=function(a,l){return dn([a,l],"logicalAnd"),this.broadcastedBinaryOp(a,l,"bool",function(g,_){return g&&_})},c.prototype.logicalOr=function(a,l){return dn([a,l],"logicalOr"),this.broadcastedBinaryOp(a,l,"bool",function(g,_){return g||_})},c.prototype.select=function(a,l,g){dn([a,l,g],"select");for(var _=this.readSync(a.dataId),j=this.readSync(l.dataId),V=this.readSync(g.dataId),ne=Ki(l.shape,cn(l.dtype,g.dtype)),oe=this.readSync(ne.dataId),me=0,Ee=a.rank===0||a.rank>1||l.rank===1?1:Ye(l.shape.slice(1)),_e=0;_e<_.length;_e++)for(var Ne=0;Ne<Ee;Ne++)_[_e]===1?oe[me++]=j[_e]:oe[me++]=V[_e];return ne},c.prototype.where=function(a){dn([a],"where");var l=this.readSync(a.dataId);return Ja(a.shape,l)},c.prototype.topk=function(a,l,g){return dn(a,"topk"),io(this.readSync(a.dataId),a.shape,a.dtype,l)},c.prototype.min=function(a,l){dn(a,"min"),Ga("min",l,a.rank);for(var g=Aa(a.shape,l),_=g[0],j=g[1],V=Ki(_,a.dtype),ne=Ye(j),oe=this.readSync(V.dataId),me=this.readSync(a.dataId),Ee=0;Ee<oe.length;++Ee){for(var _e=Ee*ne,Ne=me[_e],Ue=0;Ue<ne;++Ue){var $e=me[_e+Ue];$e<Ne&&(Ne=$e)}oe[Ee]=Ne}return V},c.prototype.minimum=function(a,l){return dn([a,l],"minimum"),this.broadcastedBinaryOp(a,l,a.dtype,function(g,_){return Math.min(g,_)})},c.prototype.mod=function(a,l){return dn([a,l],"mod"),this.broadcastedBinaryOp(a,l,a.dtype,function(g,_){var j=g%_;return g<0&&_<0||g>=0&&_>=0?j:(j+_)%_})},c.prototype.max=function(a,l){dn(a,"max"),Ga("max",l,a.rank);for(var g=Aa(a.shape,l),_=g[0],j=g[1],V=Ki(_,a.dtype),ne=Ye(j),oe=this.readSync(V.dataId),me=this.readSync(a.dataId),Ee=0;Ee<oe.length;++Ee){for(var _e=Ee*ne,Ne=me[_e],Ue=0;Ue<ne;++Ue){var $e=me[_e+Ue];$e>Ne&&(Ne=$e)}oe[Ee]=Ne}return V},c.prototype.maximum=function(a,l){return dn([a,l],"maximum"),this.broadcastedBinaryOp(a,l,a.dtype,function(g,_){return Math.max(g,_)})},c.prototype.all=function(a,l){dn(a,"all"),Ga("all",l,a.rank);for(var g=Aa(a.shape,l),_=g[0],j=g[1],V=Ki(_,a.dtype),ne=Ye(j),oe=this.readSync(V.dataId),me=this.readSync(a.dataId),Ee=0;Ee<oe.length;++Ee){for(var _e=Ee*ne,Ne=me[_e],Ue=0;Ue<ne;++Ue){var $e=me[_e+Ue];Ne=Ne&&$e}oe[Ee]=Ne}return V},c.prototype.any=function(a,l){dn(a,"any"),Ga("any",l,a.rank);for(var g=Aa(a.shape,l),_=g[0],j=g[1],V=Ki(_,a.dtype),ne=Ye(j),oe=this.readSync(V.dataId),me=this.readSync(a.dataId),Ee=0;Ee<oe.length;++Ee){for(var _e=Ee*ne,Ne=me[_e],Ue=0;Ue<ne;++Ue){var $e=me[_e+Ue];Ne=Ne||$e}oe[Ee]=Ne}return V},c.prototype.squaredDifference=function(a,l){return dn([a,l],"squaredDifference"),this.broadcastedBinaryOp(a,l,a.dtype,function(g,_){var j=g-_;return j*j})},c.prototype.ceil=function(a){dn(a,"ceil");for(var l=this.readSync(a.dataId),g=new Float32Array(l.length),_=0;_<l.length;++_)g[_]=Math.ceil(l[_]);return this.makeOutput(g,a.shape,"float32")},c.prototype.floor=function(a){dn(a,"floor");for(var l=this.readSync(a.dataId),g=new Float32Array(l.length),_=0;_<l.length;++_)g[_]=Math.floor(l[_]);return this.makeOutput(g,a.shape,"float32")},c.prototype.sign=function(a){dn(a,"x");for(var l=this.readSync(a.dataId),g=new Float32Array(l.length),_=0;_<l.length;++_)l[_]<0?g[_]=-1:l[_]>0?g[_]=1:g[_]=0;return this.makeOutput(g,a.shape,"float32")},c.prototype.isNaN=function(a){dn(a,"x");for(var l=this.readSync(a.dataId),g=new Uint8Array(l.length),_=0;_<l.length;++_)Number.isNaN(l[_])&&(g[_]=1);return this.makeOutput(g,a.shape,"bool")},c.prototype.isInf=function(a){dn(a,"x");for(var l=this.readSync(a.dataId),g=new Uint8Array(l.length),_=0;_<l.length;++_)Math.abs(l[_])===1/0&&(g[_]=1);return this.makeOutput(g,a.shape,"bool")},c.prototype.isFinite=function(a){dn(a,"x");for(var l=this.readSync(a.dataId),g=new Uint8Array(l.length),_=0;_<l.length;++_)Number.isFinite(l[_])&&(g[_]=1);return this.makeOutput(g,a.shape,"bool")},c.prototype.round=function(a){dn(a,"round");for(var l=this.readSync(a.dataId),g=new Float32Array(l.length),_=0;_<l.length;++_){var j=Math.floor(l[_]);l[_]-j<.5?g[_]=Math.floor(l[_]):l[_]-j>.5?g[_]=Math.ceil(l[_]):g[_]=j%2==0?j:j+1}return this.makeOutput(g,a.shape,"float32")},c.prototype.exp=function(a){dn(a,"exp");for(var l=this.readSync(a.dataId),g=new Float32Array(l.length),_=0;_<l.length;++_)g[_]=Math.exp(l[_]);return this.makeOutput(g,a.shape,"float32")},c.prototype.expm1=function(a){dn(a,"expm1");for(var l=this.readSync(a.dataId),g=new Float32Array(l.length),_=0;_<l.length;++_)g[_]=Math.expm1(l[_]);return this.makeOutput(g,a.shape,"float32")},c.prototype.log=function(a){dn(a,"log");for(var l=this.readSync(a.dataId),g=new Float32Array(l.length),_=0;_<l.length;++_){var j=l[_];g[_]=Math.log(j)}return this.makeOutput(g,a.shape,"float32")},c.prototype.log1p=function(a){dn(a,"log1p");for(var l=this.readSync(a.dataId),g=new Float32Array(l.length),_=0;_<l.length;++_){var j=l[_];g[_]=Math.log1p(j)}return this.makeOutput(g,a.shape,"float32")},c.prototype.sqrt=function(a){dn(a,"sqrt");for(var l=this.readSync(a.dataId),g=new Float32Array(l.length),_=0;_<l.length;++_){var j=l[_];g[_]=Math.sqrt(j)}return this.makeOutput(g,a.shape,"float32")},c.prototype.rsqrt=function(a){dn(a,"rsqrt");for(var l=this.readSync(a.dataId),g=new Float32Array(l.length),_=0;_<l.length;++_){var j=l[_];g[_]=1/Math.sqrt(j)}return this.makeOutput(g,a.shape,"float32")},c.prototype.reciprocal=function(a){dn(a,"reciprocal");for(var l=this.readSync(a.dataId),g=new Float32Array(l.length),_=0;_<l.length;++_)g[_]=1/l[_];return this.makeOutput(g,a.shape,"float32")},c.prototype.linear=function(a){return a},c.prototype.relu=function(a){dn(a,"relu");for(var l=Ki(a.shape,a.dtype),g=this.readSync(l.dataId),_=this.readSync(a.dataId),j=0;j<_.length;++j)g[j]=Math.max(0,_[j]);return l},c.prototype.relu6=function(a){dn(a,"relu");for(var l=Ki(a.shape,a.dtype),g=this.readSync(l.dataId),_=this.readSync(a.dataId),j=0;j<_.length;++j)g[j]=Math.min(Math.max(0,_[j]),6);return l},c.prototype.prelu=function(a,l){return dn([a,l],"prelu"),this.broadcastedBinaryOp(a,l,a.dtype,function(g,_){return g<0?_*g:g})},c.prototype.elu=function(a){dn(a,"elu");for(var l=new Float32Array(a.size),g=this.readSync(a.dataId),_=0;_<g.length;++_){var j=g[_];l[_]=j>=0?j:Math.exp(j)-1}return this.makeOutput(l,a.shape,"float32")},c.prototype.eluDer=function(a,l){dn([a,l],"eluDer");for(var g=new Float32Array(l.size),_=this.readSync(l.dataId),j=this.readSync(a.dataId),V=0;V<_.length;++V){var ne=_[V];g[V]=ne>=1?j[V]:j[V]*(ne+1)}return this.makeOutput(g,l.shape,"float32")},c.prototype.selu=function(a){dn(a,"selu");for(var l=new Float32Array(a.size),g=this.readSync(a.dataId),_=0;_<g.length;++_){var j=g[_];l[_]=j>=0?1.0507009873554805*j:1.7580993408473768*(Math.exp(j)-1)}return this.makeOutput(l,a.shape,"float32")},c.prototype.clip=function(a,l,g){dn(a,"clip");for(var _=new Float32Array(a.size),j=this.readSync(a.dataId),V=0;V<j.length;++V){var ne=j[V];_[V]=ne>g?g:ne<l?l:ne}return this.makeOutput(_,a.shape,"float32")},c.prototype.abs=function(a){for(var l=new Float32Array(a.size),g=this.readSync(a.dataId),_=0;_<g.length;++_)l[_]=Math.abs(g[_]);return this.makeOutput(l,a.shape,"float32")},c.prototype.complexAbs=function(a){for(var l=new Float32Array(a.size),g=this.readSync(a.dataId),_=0;_<a.size;++_){var j=g[2*_],V=g[2*_+1];l[_]=Math.hypot(j,V)}return this.makeOutput(l,a.shape,"float32")},c.prototype.int=function(a){dn(a,"int");for(var l=new Int32Array(a.size),g=this.readSync(a.dataId),_=0;_<g.length;++_)l[_]=g[_];return this.makeOutput(l,a.shape,"int32")},c.prototype.sigmoid=function(a){dn(a,"sigmoid");for(var l=new Float32Array(a.size),g=this.readSync(a.dataId),_=0;_<g.length;++_)l[_]=1/(1+Math.exp(-g[_]));return this.makeOutput(l,a.shape,"float32")},c.prototype.softplus=function(a){dn(a,"softplus");for(var l=Math.log(11920928955078125e-23)+2,g=new Float32Array(a.size),_=this.readSync(a.dataId),j=0;j<_.length;++j){var V,ne=_[j]>-l,oe=_[j]<l,me=Math.exp(_[j]);V=oe?me:ne?_[j]:Math.log(1+me),g[j]=V}return this.makeOutput(g,a.shape,"float32")},c.prototype.sin=function(a){dn(a,"sin");for(var l=new Float32Array(a.size),g=this.readSync(a.dataId),_=0;_<g.length;++_)l[_]=Math.sin(g[_]);return this.makeOutput(l,a.shape,"float32")},c.prototype.cos=function(a){dn(a,"cos");for(var l=new Float32Array(a.size),g=this.readSync(a.dataId),_=0;_<g.length;++_)l[_]=Math.cos(g[_]);return this.makeOutput(l,a.shape,"float32")},c.prototype.tan=function(a){dn(a,"tan");for(var l=new Float32Array(a.size),g=this.readSync(a.dataId),_=0;_<g.length;++_)l[_]=Math.tan(g[_]);return this.makeOutput(l,a.shape,"float32")},c.prototype.asin=function(a){dn(a,"asin");for(var l=new Float32Array(a.size),g=this.readSync(a.dataId),_=0;_<g.length;++_)l[_]=Math.asin(g[_]);return this.makeOutput(l,a.shape,"float32")},c.prototype.acos=function(a){dn(a,"acos");for(var l=new Float32Array(a.size),g=this.readSync(a.dataId),_=0;_<g.length;++_)l[_]=Math.acos(g[_]);return this.makeOutput(l,a.shape,"float32")},c.prototype.atan=function(a){dn(a,"atan");for(var l=new Float32Array(a.size),g=this.readSync(a.dataId),_=0;_<g.length;++_)l[_]=Math.atan(g[_]);return this.makeOutput(l,a.shape,"float32")},c.prototype.atan2=function(a,l){return dn([a,l],"atan2"),this.broadcastedBinaryOp(a,l,a.dtype,function(g,_){return Math.atan2(g,_)})},c.prototype.sinh=function(a){dn(a,"sinh");for(var l=new Float32Array(a.size),g=this.readSync(a.dataId),_=0;_<g.length;++_)l[_]=Math.sinh(g[_]);return this.makeOutput(l,a.shape,"float32")},c.prototype.cosh=function(a){dn(a,"cosh");for(var l=new Float32Array(a.size),g=this.readSync(a.dataId),_=0;_<g.length;++_)l[_]=Math.cosh(g[_]);return this.makeOutput(l,a.shape,"float32")},c.prototype.tanh=function(a){dn(a,"tanh");for(var l=new Float32Array(a.size),g=this.readSync(a.dataId),_=0;_<g.length;++_)l[_]=Bt(g[_]);return this.makeOutput(l,a.shape,"float32")},c.prototype.asinh=function(a){dn(a,"asinh");for(var l=new Float32Array(a.size),g=this.readSync(a.dataId),_=0;_<g.length;++_)l[_]=Math.asinh(g[_]);return this.makeOutput(l,a.shape,"float32")},c.prototype.acosh=function(a){dn(a,"acosh");for(var l=new Float32Array(a.size),g=this.readSync(a.dataId),_=0;_<g.length;++_)l[_]=Math.acosh(g[_]);return this.makeOutput(l,a.shape,"float32")},c.prototype.atanh=function(a){dn(a,"atanh");for(var l=new Float32Array(a.size),g=this.readSync(a.dataId),_=0;_<g.length;++_)l[_]=Math.atanh(g[_]);return this.makeOutput(l,a.shape,"float32")},c.prototype.erf=function(a){dn(a,"erf");for(var l=new Float32Array(a.size),g=this.readSync(a.dataId),_=0;_<g.length;++_){var j=Math.sign(g[_]),V=Math.abs(g[_]),ne=1/(1+.3275911*V);l[_]=j*(1-((((1.061405429*ne-1.453152027)*ne+1.421413741)*ne-.284496736)*ne+.254829592)*ne*Math.exp(-V*V))}return this.makeOutput(l,a.shape,"float32")},c.prototype.step=function(a,l){l===void 0&&(l=0),dn(a,"step");for(var g=new Float32Array(a.size),_=this.readSync(a.dataId),j=0;j<_.length;++j){var V=_[j];isNaN(V)?g[j]=NaN:g[j]=V>0?1:l}return this.makeOutput(g,a.shape,"float32")},c.prototype.fusedConv2d=function(a){var l=a.input,g=a.filter,_=a.convInfo,j=a.bias,V=a.activation,ne=a.preluActivationWeights,oe=this.conv2d(l,g,_);return j&&(oe=this.add(oe,j)),V&&(oe=yr(this,oe,V,ne)),oe},c.prototype.conv2d=function(a,l,g){dn([a,l],"conv2d");for(var _=g.filterHeight,j=g.filterWidth,V=g.dilationHeight,ne=g.dilationWidth,oe=g.padInfo.left,me=g.padInfo.top,Ee=g.dataFormat==="channelsLast",_e=bi(g.outShape,a.dtype),Ne=a.strides[0],Ue=Ee?a.strides[1]:a.strides[2],$e=Ee?a.strides[2]:1,He=Ee?1:a.strides[1],et=_e.strides[0],lt=Ee?_e.strides[1]:_e.strides[2],ht=Ee?_e.strides[2]:1,gt=Ee?1:_e.strides[1],Ct=this.readSync(a.dataId),Wt=this.readSync(l.dataId),Kt=_e.values,Vt=0;Vt<g.batchSize;++Vt)for(var Ht=Vt*Ne,vn=Vt*et,On=0;On<g.outHeight;++On)for(var Cn=vn+On*lt,Kn=On*g.strideHeight-me,er=0;er<_;er++){var sr=Kn+er*V;if(!(sr<0||sr>=g.inHeight))for(var lr=er*l.strides[0],ur=Ht+sr*Ue,ar=0;ar<g.outWidth;++ar)for(var Or=Cn+ar*ht,Er=ar*g.strideWidth-oe,Ur=0;Ur<j;Ur++){var ei=Er+Ur*ne;if(!(ei<0||ei>=g.inWidth))for(var mi=ur+ei*$e,ua=lr+Ur*l.strides[1],ca=0;ca<g.inChannels;++ca){for(var ka=Ct[mi+ca*He],ba=0;ba<g.outChannels;++ba)Kt[Or+ba*gt]+=ka*Wt[ua+ba];ua+=g.outChannels}}}return _e.toTensor()},c.prototype.conv3d=function(a,l,g){for(var _=g.filterDepth,j=g.filterHeight,V=g.filterWidth,ne=g.dilationDepth,oe=g.dilationHeight,me=g.dilationWidth,Ee=g.padInfo.front,_e=g.padInfo.left,Ne=g.padInfo.top,Ue=bi(g.outShape,a.dtype),$e=this.readSync(a.dataId),He=this.readSync(l.dataId),et=Ue.values,lt=0;lt<g.batchSize;++lt)for(var ht=lt*a.strides[0],gt=lt*Ue.strides[0],Ct=0;Ct<g.outDepth;++Ct)for(var Wt=gt+Ct*Ue.strides[1],Kt=Ct*g.strideDepth-Ee,Vt=0;Vt<_;Vt++){var Ht=Kt+Vt*ne;if(!(Ht<0||Ht>=g.inDepth))for(var vn=Vt*l.strides[0],On=ht+Ht*a.strides[1],Cn=0;Cn<g.outHeight;++Cn)for(var Kn=Wt+Cn*Ue.strides[2],er=Cn*g.strideHeight-Ne,sr=0;sr<j;sr++){var lr=er+sr*oe;if(!(lr<0||lr>=g.inHeight))for(var ur=vn+sr*l.strides[1],ar=On+lr*a.strides[2],Or=0;Or<g.outWidth;++Or)for(var Er=Kn+Or*g.outChannels,Ur=Or*g.strideWidth-_e,ei=0;ei<V;ei++){var mi=Ur+ei*me;if(!(mi<0||mi>=g.inWidth))for(var ua=ur+ei*l.strides[2],ca=ar+mi*g.inChannels,ka=ua,ba=0;ba<g.inChannels;++ba){for(var ja=$e[ca+ba],Za=0;Za<g.outChannels;++Za)et[Er+Za]+=ja*He[ka+Za];ka+=g.outChannels}}}}return Ue.toTensor()},c.prototype.conv2dDerInput=function(a,l,g){dn([a,l],"conv2dDerInput");for(var _=bi(g.inShape,"float32"),j=_.values,V=this.readSync(a.dataId),ne=this.readSync(l.dataId),oe=l.strides,me=oe[0],Ee=oe[1],_e=oe[2],Ne=g.batchSize,Ue=g.filterHeight,$e=g.filterWidth,He=g.inChannels,et=g.inHeight,lt=g.inWidth,ht=g.outChannels,gt=g.outHeight,Ct=g.outWidth,Wt=g.strideHeight,Kt=g.strideWidth,Vt=g.dataFormat,Ht=Ue-1-g.padInfo.top,vn=$e-1-g.padInfo.left,On=Vt==="channelsLast",Cn=_.strides[0],Kn=On?_.strides[1]:_.strides[2],er=On?_.strides[2]:1,sr=On?1:_.strides[1],lr=a.strides[0],ur=On?a.strides[1]:a.strides[2],ar=On?a.strides[2]:1,Or=On?1:a.strides[1],Er=0;Er<Ne;++Er)for(var Ur=0;Ur<He;++Ur)for(var ei=0;ei<et;++ei)for(var mi=ei-Ht,ua=Math.max(0,Math.ceil(mi/Wt)),ca=Math.min(gt,(Ue+mi)/Wt),ka=0;ka<lt;++ka){for(var ba=ka-vn,ja=Math.max(0,Math.ceil(ba/Kt)),Za=Math.min(Ct,($e+ba)/Kt),Bo=0,Xi=ua;Xi<ca;++Xi)for(var Ea=Xi*Wt-mi,Wa=ja;Wa<Za;++Wa)for(var iu=lr*Er+ur*Xi+ar*Wa,Ms=me*(Ue-1-Ea)+Ee*($e-1-(Wa*Kt-ba))+_e*Ur,js=0;js<ht;++js)Bo+=V[iu+Or*js]*ne[Ms+js];j[Cn*Er+Kn*ei+er*ka+sr*Ur]=Bo}return _.toTensor()},c.prototype.conv3dDerInput=function(a,l,g){for(var _=bi(g.inShape,"float32"),j=_.values,V=_.strides,ne=V[0],oe=V[1],me=V[2],Ee=V[3],_e=this.readSync(a.dataId),Ne=a.strides,Ue=Ne[0],$e=Ne[1],He=Ne[2],et=Ne[3],lt=this.readSync(l.dataId),ht=l.strides,gt=ht[0],Ct=ht[1],Wt=ht[2],Kt=ht[3],Vt=g.batchSize,Ht=g.filterDepth,vn=g.filterHeight,On=g.filterWidth,Cn=g.inChannels,Kn=g.inDepth,er=g.inHeight,sr=g.inWidth,lr=g.outChannels,ur=g.outDepth,ar=g.outHeight,Or=g.outWidth,Er=g.strideDepth,Ur=g.strideHeight,ei=g.strideWidth,mi=Ht-1-g.padInfo.front,ua=vn-1-g.padInfo.top,ca=On-1-g.padInfo.left,ka=0;ka<Vt;++ka)for(var ba=0;ba<Cn;++ba)for(var ja=0;ja<Kn;++ja)for(var Za=ja-mi,Bo=Math.max(0,Math.ceil(Za/Er)),Xi=Math.min(ur,(Ht+Za)/Er),Ea=0;Ea<er;++Ea)for(var Wa=Ea-ua,iu=Math.max(0,Math.ceil(Wa/Ur)),Ms=Math.min(ar,(vn+Wa)/Ur),js=0;js<sr;++js){for(var hd=js-ca,dd=Math.max(0,Math.ceil(hd/ei)),kp=Math.min(Or,(On+hd)/ei),mu=0,Qm=Bo;Qm<Xi;++Qm)for(var av=Qm*Er-Za,pd=iu;pd<Ms;++pd)for(var ov=pd*Ur-Wa,Ep=dd;Ep<kp;++Ep)for(var Rx=Ue*ka+$e*Qm+He*pd+et*Ep,D0=gt*(Ht-1-av)+Ct*(vn-1-ov)+Wt*(On-1-(Ep*ei-hd))+Kt*ba,md=0;md<lr;++md)mu+=_e[Rx+md]*lt[D0+md];j[ne*ka+oe*ja+me*Ea+Ee*js+ba]=mu}return _.toTensor()},c.prototype.conv2dDerFilter=function(a,l,g){dn([a,l],"conv2dDerFilter");for(var _=g.strideHeight,j=g.strideWidth,V=g.filterHeight,ne=g.filterWidth,oe=g.dataFormat==="channelsLast",me=bi(g.filterShape,"float32"),Ee=g.padInfo.left,_e=g.padInfo.top,Ne=this.bufferSync(a),Ue=this.bufferSync(l),$e=0;$e<V;++$e)for(var He=Math.max(0,Math.ceil((_e-$e)/_)),et=Math.min(g.outHeight,(g.inHeight+_e-$e)/_),lt=0;lt<ne;++lt)for(var ht=Math.max(0,Math.ceil((Ee-lt)/j)),gt=Math.min(g.outWidth,(g.inWidth+Ee-lt)/j),Ct=0;Ct<g.inChannels;++Ct)for(var Wt=0;Wt<g.outChannels;++Wt){for(var Kt=0,Vt=0;Vt<g.batchSize;++Vt)for(var Ht=He;Ht<et;++Ht)for(var vn=$e+Ht*_-_e,On=ht;On<gt;++On){var Cn=lt+On*j-Ee;Kt+=oe?Ne.get(Vt,vn,Cn,Ct)*Ue.get(Vt,Ht,On,Wt):Ne.get(Vt,Ct,vn,Cn)*Ue.get(Vt,Wt,Ht,On)}me.set(Kt,$e,lt,Ct,Wt)}return me.toTensor()},c.prototype.conv3dDerFilter=function(a,l,g){for(var _=g.strideDepth,j=g.strideHeight,V=g.strideWidth,ne=g.filterDepth,oe=g.filterHeight,me=g.filterWidth,Ee=bi(g.filterShape,"float32"),_e=Ee.values,Ne=Ee.strides,Ue=Ne[0],$e=Ne[1],He=Ne[2],et=Ne[3],lt=this.readSync(l.dataId),ht=l.strides,gt=ht[0],Ct=ht[1],Wt=ht[2],Kt=ht[3],Vt=this.readSync(a.dataId),Ht=a.strides,vn=Ht[0],On=Ht[1],Cn=Ht[2],Kn=Ht[3],er=g.padInfo.front,sr=g.padInfo.left,lr=g.padInfo.top,ur=0;ur<ne;++ur)for(var ar=Math.max(0,Math.ceil((er-ur)/_)),Or=Math.min(g.outDepth,(g.inDepth+er-ur)/_),Er=ur*Ue,Ur=0;Ur<oe;++Ur)for(var ei=Math.max(0,Math.ceil((lr-Ur)/j)),mi=Math.min(g.outHeight,(g.inHeight+lr-Ur)/j),ua=Ur*$e+Er,ca=0;ca<me;++ca)for(var ka=Math.max(0,Math.ceil((sr-ca)/V)),ba=Math.min(g.outWidth,(g.inWidth+sr-ca)/V),ja=ca*He+ua,Za=0;Za<g.inChannels;++Za)for(var Bo=Za*et+ja,Xi=0;Xi<g.outChannels;++Xi){for(var Ea=0,Wa=0;Wa<g.batchSize;++Wa)for(var iu=Wa*vn,Ms=Wa*gt,js=ar;js<Or;++js)for(var hd=(ur+js*_-er)*On+iu,dd=js*Ct+Ms,kp=ei;kp<mi;++kp)for(var mu=(Ur+kp*j-lr)*Cn+hd,Qm=kp*Wt+dd,av=ka;av<ba;++av){var pd=av*Kt+Qm;Ea+=Vt[(ca+av*V-sr)*Kn+mu+Za]*lt[pd+Xi]}_e[Bo+Xi]=Ea}return Ee.toTensor()},c.prototype.fusedDepthwiseConv2D=function(a){var l=a.input,g=a.filter,_=a.convInfo,j=a.bias,V=a.activation,ne=a.preluActivationWeights,oe=this.depthwiseConv2D(l,g,_);return j&&(oe=this.add(oe,j)),V&&(oe=yr(this,oe,V,ne)),oe},c.prototype.depthwiseConv2D=function(a,l,g){dn([a,l],"depthwiseConv2D");for(var _=g.filterHeight,j=g.filterWidth,V=g.dilationHeight,ne=g.dilationWidth,oe=g.padInfo.left,me=g.padInfo.top,Ee=g.outChannels/g.inChannels,_e=bi(g.outShape,a.dtype),Ne=this.readSync(a.dataId),Ue=this.readSync(l.dataId),$e=_e.values,He=0;He<g.batchSize;++He)for(var et=He*a.strides[0],lt=He*_e.strides[0],ht=0;ht<g.outHeight;++ht)for(var gt=lt+ht*_e.strides[1],Ct=ht*g.strideHeight-oe,Wt=0;Wt<_;++Wt){var Kt=Ct+Wt*V;if(!(Kt<0||Kt>=g.inHeight))for(var Vt=Wt*l.strides[0],Ht=et+Kt*a.strides[1],vn=0;vn<g.outWidth;++vn)for(var On=gt+vn*_e.strides[2],Cn=vn*g.strideWidth-me,Kn=0;Kn<j;++Kn){var er=Cn+Kn*ne;if(!(er<0||er>=g.inWidth))for(var sr=Vt+Kn*l.strides[1],lr=Ht+er*g.inChannels,ur=On,ar=sr,Or=0;Or<g.inChannels;++Or){for(var Er=Ne[lr+Or],Ur=0;Ur<Ee;++Ur)$e[ur+Ur]+=Er*Ue[ar+Ur];ur+=Ee,ar+=Ee}}}return _e.toTensor()},c.prototype.depthwiseConv2DDerInput=function(a,l,g){dn([a,l],"depthwiseConv2DDerInput");for(var _=bi(g.inShape,"float32"),j=_.values,V=_.strides,ne=V[0],oe=V[1],me=V[2],Ee=this.readSync(a.dataId),_e=a.strides,Ne=_e[0],Ue=_e[1],$e=_e[2],He=this.readSync(l.dataId),et=l.strides,lt=et[0],ht=et[1],gt=et[2],Ct=g.batchSize,Wt=g.filterHeight,Kt=g.filterWidth,Vt=g.inChannels,Ht=g.inHeight,vn=g.inWidth,On=g.outChannels,Cn=g.outHeight,Kn=g.outWidth,er=g.strideHeight,sr=g.strideWidth,lr=Wt-1-g.padInfo.top,ur=Kt-1-g.padInfo.left,ar=On/Vt,Or=0;Or<Ct;++Or)for(var Er=0;Er<Vt;++Er)for(var Ur=0;Ur<Ht;++Ur)for(var ei=Ur-lr,mi=Math.max(0,Math.ceil(ei/er)),ua=Math.min(Cn,(Wt+ei)/er),ca=0;ca<vn;++ca){for(var ka=ca-ur,ba=Math.max(0,Math.ceil(ka/sr)),ja=Math.min(Kn,(Kt+ka)/sr),Za=0,Bo=mi;Bo<ua;++Bo)for(var Xi=Bo*er-ei,Ea=ba;Ea<ja;++Ea)for(var Wa=Ne*Or+Ue*Bo+$e*Ea,iu=lt*(Wt-1-Xi)+ht*(Kt-1-(Ea*sr-ka))+gt*Er,Ms=0;Ms<ar;++Ms)Za+=Ee[Wa+(Er*ar+Ms)]*He[iu+Ms];j[ne*Or+oe*Ur+me*ca+Er]=Za}return _.toTensor()},c.prototype.depthwiseConv2DDerFilter=function(a,l,g){dn([a,l],"depthwiseConv2DDerFilter");for(var _=g.strideHeight,j=g.strideWidth,V=g.filterHeight,ne=g.filterWidth,oe=bi(g.filterShape,"float32"),me=g.padInfo.left,Ee=g.padInfo.top,_e=g.outChannels/g.inChannels,Ne=this.bufferSync(a),Ue=this.bufferSync(l),$e=0;$e<V;++$e)for(var He=Math.max(0,Math.ceil((Ee-$e)/_)),et=Math.min(g.outHeight,(g.inHeight+Ee-$e)/_),lt=0;lt<ne;++lt)for(var ht=Math.max(0,Math.ceil((me-lt)/j)),gt=Math.min(g.outWidth,(g.inWidth+me-lt)/j),Ct=0;Ct<g.outChannels;++Ct){for(var Wt=Math.trunc(Ct/_e),Kt=Ct%_e,Vt=0,Ht=0;Ht<g.batchSize;++Ht)for(var vn=He;vn<et;++vn)for(var On=$e+vn*_-Ee,Cn=ht;Cn<gt;++Cn){var Kn=lt+Cn*j-me;Vt+=Ne.get(Ht,On,Kn,Wt)*Ue.get(Ht,vn,Cn,Ct)}oe.set(Vt,$e,lt,Wt,Kt)}return oe.toTensor()},c.prototype.tile=function(a,l){return dn(a,"tile"),Wo(this.bufferSync(a),l)},c.prototype.pad=function(a,l,g){dn(a,"pad");var _=l.map(function(_e,Ne){return _e[0]+a.shape[Ne]+_e[1]}),j=l.map(function(_e){return _e[0]}),V=this.bufferSync(a),ne=bi(_,a.dtype);g!==0&&ne.values.fill(g);for(var oe=0;oe<a.size;oe++){var me=V.indexToLoc(oe),Ee=me.map(function(_e,Ne){return _e+j[Ne]});ne.set.apply(ne,[V.get.apply(V,me)].concat(Ee))}return ne.toTensor()},c.prototype.gather=function(a,l,g){dn([a,l],"gather");var _=a.shape.slice(),j=this.readSync(l.dataId);_[g]=j.length;for(var V=bi(_,a.dtype),ne=this.bufferSync(a),oe=0;oe<V.size;++oe){var me=V.indexToLoc(oe),Ee=me.slice();Ee[g]=j[me[g]];var _e=ne.locToIndex(Ee);V.values[oe]=ne.values[_e]}return V.toTensor()},c.prototype.batchToSpaceND=function(a,l,g){dn([a],"batchToSpaceND");var _=l.reduce(function(Ee,_e){return Ee*_e}),j=_f(a.shape,l,_),V=Gc(j.length,l.length),ne=_l(a.shape,l,_),oe=Wd(g,l.length),me=Mp(ne,g,l.length);return ft(a.reshape(j),V).reshape(ne).slice(oe,me)},c.prototype.spaceToBatchND=function(a,l,g){dn([a],"spaceToBatchND");var _=l.reduce(function(_e,Ne){return _e*Ne}),j=[[0,0]];j.push.apply(j,g);for(var V=1+l.length;V<a.shape.length;++V)j.push([0,0]);var ne=a.pad(j),oe=_f(ne.shape,l,_,!1),me=Gc(oe.length,l.length,!1),Ee=_l(ne.shape,l,_,!1);return ft(ne.reshape(oe),me).reshape(Ee)},c.prototype.maxPool=function(a,l){return dn(a,"maxPool"),cr(this.readSync(a.dataId),a.shape,a.dtype,a.strides,l,"max").toTensor()},c.prototype.maxPoolBackprop=function(a,l,g,_){dn([l,g],"maxPoolBackprop");for(var j=this.readSync(l.dataId),V=bi(_.outShape,l.dtype,kr(j,l.shape,l.dtype,_).values),ne=_.strideHeight,oe=_.strideWidth,me=_.dilationHeight,Ee=_.dilationWidth,_e=_.effectiveFilterHeight,Ne=_.effectiveFilterWidth,Ue=Ne-1-_.padInfo.left,$e=_e-1-_.padInfo.top,He=bi(l.shape,"float32"),et=this.bufferSync(a),lt=0;lt<_.batchSize;++lt)for(var ht=0;ht<_.inChannels;++ht)for(var gt=0;gt<_.inHeight;++gt)for(var Ct=0;Ct<_.inWidth;++Ct){for(var Wt=gt-$e,Kt=Ct-Ue,Vt=0,Ht=0;Ht<_e;Ht+=me){var vn=(Wt+Ht)/ne;if(!(vn<0||vn>=_.outHeight||Math.floor(vn)!==vn))for(var On=0;On<Ne;On+=Ee){var Cn=(Kt+On)/oe;if(!(Cn<0||Cn>=_.outWidth||Math.floor(Cn)!==Cn)){var Kn=_e*Ne-1-V.get(lt,vn,Cn,ht)===Ht*Ne+On?1:0;Kn!==0&&(Vt+=et.get(lt,vn,Cn,ht)*Kn)}}}He.set(Vt,lt,gt,Ct,ht)}return He.toTensor()},c.prototype.avgPoolBackprop=function(a,l,g){dn([a,l],"avgPoolBackprop");for(var _=g.strideHeight,j=g.strideWidth,V=g.filterHeight,ne=g.filterWidth,oe=g.dilationHeight,me=g.dilationWidth,Ee=g.effectiveFilterHeight,_e=g.effectiveFilterWidth,Ne=_e-1-g.padInfo.left,Ue=Ee-1-g.padInfo.top,$e=bi(l.shape,"float32"),He=1/(V*ne),et=this.bufferSync(a),lt=0;lt<g.batchSize;++lt)for(var ht=0;ht<g.inChannels;++ht)for(var gt=0;gt<g.inHeight;++gt)for(var Ct=0;Ct<g.inWidth;++Ct){for(var Wt=gt-Ue,Kt=Ct-Ne,Vt=0,Ht=0;Ht<Ee;Ht+=oe){var vn=(Wt+Ht)/_;if(!(vn<0||vn>=g.outHeight||Math.floor(vn)!==vn))for(var On=0;On<_e;On+=me){var Cn=(Kt+On)/j;Cn<0||Cn>=g.outWidth||Math.floor(Cn)!==Cn||(Vt+=et.get(lt,vn,Cn,ht))}}$e.set(Vt*He,lt,gt,Ct,ht)}return $e.toTensor()},c.prototype.pool3d=function(a,l,g){dn(a,"pool3d");for(var _=l.strideDepth,j=l.strideHeight,V=l.strideWidth,ne=l.dilationDepth,oe=l.dilationHeight,me=l.dilationWidth,Ee=l.effectiveFilterDepth,_e=l.effectiveFilterHeight,Ne=l.effectiveFilterWidth,Ue=l.padInfo.front,$e=l.padInfo.top,He=l.padInfo.left,et=g==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,lt=this.readSync(a.dataId),ht=bi(l.outShape,a.dtype),gt=ht.values,Ct=l.outShape[1]*l.outShape[2]*l.outShape[3]*l.outShape[4],Wt=l.outShape[2]*l.outShape[3]*l.outShape[4],Kt=l.outShape[3]*l.outShape[4],Vt=l.outShape[4],Ht=0;Ht<l.batchSize;++Ht)for(var vn=Ht*Ct,On=Ht*a.strides[0],Cn=0;Cn<l.inChannels;++Cn)for(var Kn=0;Kn<l.outDepth;++Kn){for(var er=Kn*_-Ue,sr=er;sr<0;)sr+=ne;for(var lr=Math.min(l.inDepth,Ee+er),ur=vn+Kn*Wt,ar=0;ar<l.outHeight;++ar){for(var Or=ar*j-$e,Er=Or;Er<0;)Er+=oe;for(var Ur=Math.min(l.inHeight,_e+Or),ei=ur+ar*Kt,mi=0;mi<l.outWidth;++mi){for(var ua=mi*V-He,ca=ua;ca<0;)ca+=me;for(var ka=Math.min(l.inWidth,Ne+ua),ba=ei+mi*Vt,ja=et,Za=0,Bo=0,Xi=sr;Xi<lr;Xi+=ne){for(var Ea=On+Xi*a.strides[1],Wa=Er;Wa<Ur;Wa+=oe){for(var iu=Ea+Wa*a.strides[2],Ms=ca;Ms<ka;Ms+=me){var js=lt[iu+Ms*a.strides[3]+Cn];if(g==="max"&&js>ja?ja=js:g==="avg"&&(Za+=js,Bo++),isNaN(ja))break}if(isNaN(ja))break}if(isNaN(ja))break}gt[ba+Cn]=g==="avg"?Za/Bo:ja}}}return ht.toTensor()},c.prototype.avgPool3d=function(a,l){return dn(a,"avgPool3d"),this.pool3d(a,l,"avg").toFloat()},c.prototype.avgPool3dBackprop=function(a,l,g){dn([a,l],"avgPool3dBackprop");for(var _=g.strideDepth,j=g.strideHeight,V=g.strideWidth,ne=g.filterDepth,oe=g.filterHeight,me=g.filterWidth,Ee=g.dilationDepth,_e=g.dilationHeight,Ne=g.dilationWidth,Ue=g.effectiveFilterDepth,$e=g.effectiveFilterHeight,He=g.effectiveFilterWidth,et=Ue-1-g.padInfo.front,lt=He-1-g.padInfo.left,ht=$e-1-g.padInfo.top,gt=bi(l.shape,"float32"),Ct=1/(ne*oe*me),Wt=this.bufferSync(a),Kt=0;Kt<g.batchSize;++Kt)for(var Vt=0;Vt<g.inChannels;++Vt)for(var Ht=0;Ht<g.inDepth;++Ht)for(var vn=0;vn<g.inHeight;++vn)for(var On=0;On<g.inWidth;++On){for(var Cn=Ht-et,Kn=vn-ht,er=On-lt,sr=0,lr=0;lr<Ue;lr+=Ee){var ur=(Cn+lr)/_;if(!(ur<0||ur>=g.outDepth||Math.floor(ur)!==ur))for(var ar=0;ar<$e;ar+=_e){var Or=(Kn+ar)/j;if(!(Or<0||Or>=g.outHeight||Math.floor(Or)!==Or))for(var Er=0;Er<He;Er+=Ne){var Ur=(er+Er)/V;Ur<0||Ur>=g.outWidth||Math.floor(Ur)!==Ur||(sr+=Wt.get(Kt,ur,Or,Ur,Vt))}}}gt.set(sr*Ct,Kt,Ht,vn,On,Vt)}return gt.toTensor()},c.prototype.maxPool3d=function(a,l){return dn(a,"maxPool3d"),this.pool3d(a,l,"max").toFloat()},c.prototype.maxPool3dPositions=function(a,l){for(var g=bi(l.outShape,"int32"),_=l.strideDepth,j=l.strideHeight,V=l.strideWidth,ne=l.dilationDepth,oe=l.dilationHeight,me=l.dilationWidth,Ee=l.effectiveFilterDepth,_e=l.effectiveFilterHeight,Ne=l.effectiveFilterWidth,Ue=l.padInfo.front,$e=l.padInfo.top,He=l.padInfo.left,et=this.bufferSync(a),lt=0;lt<l.batchSize;++lt)for(var ht=0;ht<l.inChannels;++ht)for(var gt=0;gt<l.outDepth;++gt){for(var Ct=gt*_-Ue,Wt=Ct;Wt<0;)Wt+=ne;for(var Kt=Math.min(l.inDepth,Ee+Ct),Vt=0;Vt<l.outHeight;++Vt){for(var Ht=Vt*j-$e,vn=Ht;vn<0;)vn+=oe;for(var On=Math.min(l.inHeight,_e+Ht),Cn=0;Cn<l.outWidth;++Cn){for(var Kn=Cn*V-He,er=Kn;er<0;)er+=me;for(var sr=Math.min(l.inWidth,Ne+Kn),lr=Number.NEGATIVE_INFINITY,ur=-1,ar=Wt;ar<Kt;ar+=ne)for(var Or=ar-Ct,Er=vn;Er<On;Er+=oe)for(var Ur=Er-Ht,ei=er;ei<sr;ei+=me){var mi=ei-Kn,ua=et.get(lt,ar,Er,ei,ht);ua>=lr&&(lr=ua,ur=Or*_e*Ne+Ur*_e+mi)}g.set(ur,lt,gt,Vt,Cn,ht)}}}return g.toTensor()},c.prototype.maxPool3dBackprop=function(a,l,g,_){dn([l,g],"maxPool3dBackprop");for(var j=this.maxPool3dPositions(l,_),V=_.strideDepth,ne=_.strideHeight,oe=_.strideWidth,me=_.dilationDepth,Ee=_.dilationHeight,_e=_.dilationWidth,Ne=_.effectiveFilterDepth,Ue=_.effectiveFilterHeight,$e=_.effectiveFilterWidth,He=Ne-1-_.padInfo.front,et=$e-1-_.padInfo.left,lt=Ue-1-_.padInfo.top,ht=bi(l.shape,"float32"),gt=this.bufferSync(j),Ct=this.bufferSync(a),Wt=0;Wt<_.batchSize;++Wt)for(var Kt=0;Kt<_.inChannels;++Kt)for(var Vt=0;Vt<_.inDepth;++Vt)for(var Ht=0;Ht<_.inHeight;++Ht)for(var vn=0;vn<_.inWidth;++vn){for(var On=Vt-He,Cn=Ht-lt,Kn=vn-et,er=0,sr=0;sr<Ne;sr+=me){var lr=(On+sr)/V;if(!(lr<0||lr>=_.outDepth||Math.floor(lr)!==lr))for(var ur=0;ur<Ue;ur+=Ee){var ar=(Cn+ur)/ne;if(!(ar<0||ar>=_.outHeight||Math.floor(ar)!==ar))for(var Or=0;Or<$e;Or+=_e){var Er=(Kn+Or)/oe;if(!(Er<0||Er>=_.outWidth||Math.floor(Er)!==Er)){var Ur=Ne*Ue*$e-1-gt.get(Wt,lr,ar,Er,Kt)===sr*Ue*$e+ur*$e+Or?1:0;Ur!==0&&(er+=Ct.get(Wt,lr,ar,Er,Kt)*Ur)}}}}ht.set(er,Wt,Vt,Ht,vn,Kt)}return ht.toTensor()},c.prototype.cast=function(a,l){return Wr(a,l,this)},c.prototype.reshape=function(a,l){return oi(a,l)},c.prototype.avgPool=function(a,l){return dn(a,"avgPool"),dn(a,"maxPool"),cr(this.readSync(a.dataId),a.shape,a.dtype,a.strides,l,"avg").toTensor().toFloat()},c.prototype.resizeBilinear=function(a,l,g,_){dn(a,"resizeBilinear");for(var j=a.shape,V=j[0],ne=j[1],oe=j[2],me=j[3],Ee=this.readSync(a.dataId),_e=new Float32Array(Ye([V,l,g,me])),Ne=[_&&l>1?ne-1:ne,_&&g>1?oe-1:oe],Ue=[_&&l>1?l-1:l,_&&g>1?g-1:g],$e=0,He=Ne[0]/Ue[0],et=Ne[1]/Ue[1],lt=0;lt<V;lt++)for(var ht=0;ht<l;ht++)for(var gt=He*ht,Ct=Math.floor(gt),Wt=gt-Ct,Kt=Math.min(ne-1,Math.ceil(gt)),Vt=lt*a.strides[0]+Ct*a.strides[1],Ht=lt*a.strides[0]+Kt*a.strides[1],vn=0;vn<g;vn++)for(var On=et*vn,Cn=Math.floor(On),Kn=On-Cn,er=Math.min(oe-1,Math.ceil(On)),sr=Vt+Cn*a.strides[2],lr=Ht+Cn*a.strides[2],ur=Vt+er*a.strides[2],ar=Ht+er*a.strides[2],Or=0;Or<me;Or++){var Er=Ee[sr+Or],Ur=Ee[lr+Or],ei=Er+(Ee[ur+Or]-Er)*Kn,mi=ei+(Ur+(Ee[ar+Or]-Ur)*Kn-ei)*Wt;_e[$e++]=mi}return wa(_e,[V,l,g,me])},c.prototype.resizeBilinearBackprop=function(a,l,g){dn([a,l],"resizeBilinearBackprop");for(var _=l.shape,j=_[0],V=_[1],ne=_[2],oe=_[3],me=a.shape,Ee=me[1],_e=me[2],Ne=new Float32Array(j*V*ne*oe),Ue=[g&&Ee>1?V-1:V,g&&_e>1?ne-1:ne],$e=[g&&Ee>1?Ee-1:Ee,g&&_e>1?_e-1:_e],He=Ue[0]/$e[0],et=Ue[1]/$e[1],lt=this.readSync(a.dataId),ht=0,gt=0;gt<j;gt++)for(var Ct=gt*l.strides[0],Wt=0;Wt<Ee;Wt++)for(var Kt=Wt*He,Vt=Math.floor(Kt),Ht=Math.min(Math.ceil(Kt),V-1),vn=Ct+Vt*l.strides[1],On=Ct+Ht*l.strides[1],Cn=Kt-Vt,Kn=1-Cn,er=0;er<_e;er++)for(var sr=er*et,lr=Math.floor(sr),ur=Math.min(Math.ceil(sr),ne-1),ar=sr-lr,Or=1-ar,Er=vn+lr*l.strides[2],Ur=vn+ur*l.strides[2],ei=On+lr*l.strides[2],mi=On+ur*l.strides[2],ua=Kn*Or,ca=Kn*ar,ka=Cn*Or,ba=Cn*ar,ja=0;ja<oe;ja++){var Za=lt[ht++];Ne[Er+ja]+=Za*ua,Ne[Ur+ja]+=Za*ca,Ne[ei+ja]+=Za*ka,Ne[mi+ja]+=Za*ba}return Us(Ne,[j,ne,V,oe],l.dtype)},c.prototype.resizeNearestNeighbor=function(a,l,g,_){dn(a,"resizeNearestNeighbor");for(var j=a.shape,V=j[0],ne=j[1],oe=j[2],me=j[3],Ee=this.readSync(a.dataId),_e=new Float32Array(V*l*g*me),Ne=[_&&l>1?ne-1:ne,_&&g>1?oe-1:oe],Ue=[_&&l>1?l-1:l,_&&g>1?g-1:g],$e=Ne[0]/Ue[0],He=Ne[1]/Ue[1],et=0,lt=0;lt<V;lt++)for(var ht=lt*a.strides[0],gt=0;gt<l;gt++)for(var Ct=$e*gt,Wt=ht+Math.min(ne-1,_?Math.round(Ct):Math.floor(Ct))*a.strides[1],Kt=0;Kt<g;Kt++)for(var Vt=He*Kt,Ht=Wt+Math.min(oe-1,_?Math.round(Vt):Math.floor(Vt))*a.strides[2],vn=0;vn<me;vn++){var On=Ee[Ht+vn];_e[et++]=On}return wa(_e,[V,l,g,me],a.dtype)},c.prototype.resizeNearestNeighborBackprop=function(a,l,g){dn([a,l],"resizeNearestNeighborBackprop");for(var _=l.shape,j=_[0],V=_[1],ne=_[2],oe=_[3],me=a.shape,Ee=me[1],_e=me[2],Ne=new Float32Array(j*V*ne*oe),Ue=this.readSync(a.dataId),$e=[g&&Ee>1?V-1:V,g&&_e>1?ne-1:ne],He=[g&&Ee>1?Ee-1:Ee,g&&_e>1?_e-1:_e],et=$e[0]/He[0],lt=$e[1]/He[1],ht=1/et,gt=1/lt,Ct=2*Math.ceil(ht)+2,Wt=2*Math.ceil(gt)+2,Kt=0;Kt<j;Kt++)for(var Vt=Kt*l.strides[0],Ht=0;Ht<V;Ht++)for(var vn=Vt+Ht*l.strides[1],On=Math.floor(Ht*ht),Cn=Math.floor(On-Ct/2),Kn=0;Kn<ne;Kn++)for(var er=vn+Kn*l.strides[2],sr=Math.floor(Kn*gt),lr=Math.floor(sr-Wt/2),ur=0;ur<oe;ur++){for(var ar=0,Or=0;Or<Ct;Or++){var Er=Or+Cn;if(!(Er<0||Er>=Ee)){var Ur=Vt+Er*a.strides[1],ei=Er*et;if(Ht===Math.min(V-1,g?Math.round(ei):Math.floor(ei)))for(var mi=0;mi<Wt;mi++){var ua=mi+lr;if(!(ua<0||ua>=_e)){var ca=Ur+ua*a.strides[2],ka=ua*lt;Kn===Math.min(ne-1,g?Math.round(ka):Math.floor(ka))&&(ar+=Ue[ca+ur])}}}}Ne[er+ur]=ar}return Us(Ne,l.shape,l.dtype)},c.prototype.batchNormalization=function(a,l,g,_,j,V){dn([a,l,g,j,V],"batchNorm");for(var ne=this.readSync(a.dataId),oe=this.readSync(l.dataId),me=this.readSync(g.dataId),Ee=j?this.readSync(j.dataId):new Float32Array([1]),_e=V?this.readSync(V.dataId):new Float32Array([0]),Ne=new Float32Array(ne.length),Ue=_e.length,$e=Ee.length,He=me.length,et=oe.length,lt=0,ht=0,gt=0,Ct=0,Wt=0;Wt<ne.length;++Wt)Ne[Wt]=_e[lt++]+(ne[Wt]-oe[ht++])*Ee[gt++]/Math.sqrt(me[Ct++]+_),lt>=Ue&&(lt=0),ht>=et&&(ht=0),gt>=$e&&(gt=0),Ct>=He&&(Ct=0);return Us(Ne,a.shape)},c.prototype.localResponseNormalization4D=function(a,l,g,_,j){dn(a,"localResponseNormalization4D");var V=a.shape[3],ne=V-1,oe=this.readSync(a.dataId),me=a.size,Ee=new Float32Array(me);function _e(He){for(var et=He%V,lt=He-et+Math.max(0,et-l),ht=He-et+Math.min(et+l,ne),gt=0;lt<=ht;lt++){var Ct=oe[lt];gt+=Ct*Ct}return gt}for(var Ne=0;Ne<me;Ne++){var Ue=_e(Ne),$e=oe[Ne]*Math.pow(g+_*Ue,-j);Ee[Ne]=$e}return Us(Ee,a.shape)},c.prototype.LRNGrad=function(a,l,g,_,j,V,ne){dn(a,"LRNGrad");for(var oe=a.shape[3],me=this.readSync(a.dataId),Ee=this.readSync(l.dataId),_e=this.readSync(g.dataId),Ne=new Float32Array(a.size),Ue=a.size,$e=0;$e<Ue;$e++){for(var He=$e%oe,et=$e-He+Math.max(0,He-_),lt=$e-He+Math.min(oe,He+_+1),ht=0,gt=et;gt<lt;gt++)ht+=Math.pow(Ee[gt],2);for(ht=V*ht+j,gt=et;gt<lt;gt++){var Ct=-2*V*ne*Ee[gt]*_e[$e]/ht;$e===gt&&(Ct+=Math.pow(ht,-ne)),Ct*=me[$e],Ne[gt]+=Ct}}return Us(Ne,a.shape)},c.prototype.multinomial=function(a,l,g,_){dn(a,"multinomial");for(var j=l?a:Be(a),V=j.shape[0],ne=j.shape[1],oe=Ki([V,g],"int32"),me=this.readSync(oe.dataId),Ee=this.readSync(j.dataId),_e=0;_e<V;++_e){var Ne=_e*ne,Ue=new Float32Array(ne-1);Ue[0]=Ee[Ne];for(var $e=1;$e<Ue.length;++$e)Ue[$e]=Ue[$e-1]+Ee[Ne+$e];for(var He=Kh(_.toString()),et=_e*g,lt=0;lt<g;++lt){var ht=He();me[et+lt]=Ue.length;for(var gt=0;gt<Ue.length;gt++)if(ht<Ue[gt]){me[et+lt]=gt;break}}}return oe},c.prototype.oneHot=function(a,l,g,_){dn(a,"oneHot");var j=new Float32Array(a.size*l);j.fill(_);for(var V=this.readSync(a.dataId),ne=0;ne<a.size;++ne)V[ne]>=0&&V[ne]<l&&(j[ne*l+V[ne]]=g);return eu(j,[a.size,l],"int32")},c.prototype.nonMaxSuppression=function(a,l,g,_,j){return dn(a,"nonMaxSuppression"),Ya(this.readSync(a.dataId),this.readSync(l.dataId),g,_,j)},c.prototype.fft=function(a){return this.fftBatch(a,!1)},c.prototype.ifft=function(a){return this.fftBatch(a,!0)},c.prototype.fftBatch=function(a,l){for(var g=a.shape[0],_=a.shape[1],j=bi(a.shape,"float32"),V=bi(a.shape,"float32"),ne=uo(a).as2D(g,_),oe=Uo(a).as2D(g,_),me=0;me<g;me++)for(var Ee=ne.slice([me,0],[1,_]),_e=oe.slice([me,0],[1,_]),Ne=fa(Ee,_e),Ue=this.readSync(this.fftImpl(Ne,l).dataId),$e=0;$e<_;$e++){var He=pa(Ue,$e);j.values[me*_+$e]=He.real,V.values[me*_+$e]=He.imag}return fa(j.toTensor(),V.toTensor()).as2D(g,_)},c.prototype.fftImpl=function(a,l){var g=a.as1D(),_=g.size;if(this.isExponentOf2(_)){var j=this.fftRadix2(g,_,l).as2D(a.shape[0],a.shape[1]);return l&&(j=fa(uo(j).div(fr(_)),Uo(j).div(fr(_)))),j}var V=this.readSync(a.dataId),ne=function(oe){for(var me=new Float32Array(oe.length/2),Ee=new Float32Array(oe.length/2),_e=0;_e<oe.length;_e+=2)me[_e/2]=oe[_e],Ee[_e/2]=oe[_e+1];return{real:me,imag:Ee}}(this.fourierTransformByMatmul(V,_,l));return fa(ne.real,ne.imag).as2D(a.shape[0],a.shape[1])},c.prototype.isExponentOf2=function(a){return(a&a-1)==0},c.prototype.fftRadix2=function(a,l,g){if(l===1)return a;var _=this.readSync(a.dataId),j=l/2,V=function(et){for(var lt=Math.ceil(et.length/4),ht=new Float32Array(lt),gt=new Float32Array(lt),Ct=0;Ct<et.length;Ct+=4)ht[Math.floor(Ct/4)]=et[Ct],gt[Math.floor(Ct/4)]=et[Ct+1];return{real:ht,imag:gt}}(_),ne=fa(V.real,V.imag).as1D(),oe=function(et){for(var lt=Math.floor(et.length/4),ht=new Float32Array(lt),gt=new Float32Array(lt),Ct=2;Ct<et.length;Ct+=4)ht[Math.floor(Ct/4)]=et[Ct],gt[Math.floor(Ct/4)]=et[Ct+1];return{real:ht,imag:gt}}(_),me=fa(oe.real,oe.imag).as1D();ne=this.fftRadix2(ne,j,g),me=this.fftRadix2(me,j,g);var Ee=function(et,lt){for(var ht=new Float32Array(et/2),gt=new Float32Array(et/2),Ct=0;Ct<Math.ceil(et/2);Ct++){var Wt=(lt?2:-2)*Math.PI*(Ct/et);ht[Ct]=Math.cos(Wt),gt[Ct]=Math.sin(Wt)}return{real:ht,imag:gt}}(l,g),_e=fa(Ee.real,Ee.imag).mul(me),Ne=ne.add(_e),Ue=ne.sub(_e),$e=uo(Ne).concat(uo(Ue)),He=Uo(Ne).concat(Uo(Ue));return fa($e,He).as1D()},c.prototype.fourierTransformByMatmul=function(a,l,g){for(var _=new Float32Array(2*l),j=0;j<l;j++){for(var V=0,ne=0,oe=0;oe<l;oe++){var me=La(j*oe,l,g),Ee=pa(a,oe);V+=Ee.real*me.real-Ee.imag*me.imag,ne+=Ee.real*me.imag+Ee.imag*me.real}g&&(V/=l,ne/=l),ea(_,V,ne,j)}return _},c.prototype.depthToSpace=function(a,l,g){we(g==="NHWC",function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+g}),we(l>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+l});for(var _=a.shape[0],j=a.shape[1],V=a.shape[2],ne=a.shape[3],oe=j*l,me=V*l,Ee=ne/(l*l),_e=this.readSync(a.dataId),Ne=new Float32Array(_*oe*me*Ee),Ue=0,$e=0;$e<_;++$e)for(var He=0;He<oe;++He)for(var et=Math.floor(He/l),lt=He%l,ht=0;ht<me;++ht)for(var gt=Math.floor(ht/l),Ct=(lt*l+ht%l)*Ee,Wt=0;Wt<Ee;++Wt){var Kt=Wt+Ct+ne*(gt+V*(et+j*$e));Ne[Ue++]=_e[Kt]}return Us(Ne,[_,oe,me,Ee])},c.prototype.broadcastedBinaryOp=function(a,l,g,_){var j=Mi(a.shape,l.shape),V=bi(j,g),ne=this.readSync(a.dataId),oe=this.readSync(l.dataId),me=Ao(a.shape,j),Ee=Ao(l.shape,j),_e=V.values;if(me.length+Ee.length===0)for(var Ne=0;Ne<_e.length;++Ne)_e[Ne]=_(ne[Ne%ne.length],oe[Ne%oe.length]);else{var Ue=this.bufferSync(a),$e=this.bufferSync(l),He=function(et){var lt=V.indexToLoc(et),ht=lt.slice(-a.rank);me.forEach(function(Kt){return ht[Kt]=0});var gt=Ue.locToIndex(ht),Ct=lt.slice(-l.rank);Ee.forEach(function(Kt){return Ct[Kt]=0});var Wt=$e.locToIndex(Ct);_e[et]=_(ne[gt],oe[Wt])};for(Ne=0;Ne<_e.length;++Ne)He(Ne)}return V.toTensor()},c.prototype.broadcastedBinaryComplexOp=function(a,l,g){var _=Mi(a.shape,l.shape),j=bi(_,"float32"),V=bi(_,"float32"),ne=this.readSync(a.dataId),oe=this.readSync(l.dataId),me=Ao(a.shape,_),Ee=Ao(l.shape,_),_e=j.values,Ne=V.values;if(me.length+Ee.length===0)for(var Ue=0;Ue<_e.length;Ue++){var $e=Ue%ne.length,He=Ue%oe.length,et=g(ne[2*$e],ne[2*$e+1],oe[2*He],oe[2*He+1]);_e[Ue]=et.real,Ne[Ue]=et.imag}else{var lt=this.bufferSync(this.data.get(a.dataId).complexTensors.real),ht=this.bufferSync(this.data.get(l.dataId).complexTensors.real),gt=function(Ct){var Wt=j.indexToLoc(Ct),Kt=Wt.slice(-a.rank);me.forEach(function(Cn){return Kt[Cn]=0});var Vt=lt.locToIndex(Kt),Ht=Wt.slice(-l.rank);Ee.forEach(function(Cn){return Ht[Cn]=0});var vn=ht.locToIndex(Ht),On=g(ne[2*Vt],ne[2*Vt+1],oe[2*vn],oe[2*vn+1]);_e[Ct]=On.real,Ne[Ct]=On.imag};for(Ue=0;Ue<_e.length;Ue++)gt(Ue)}return this.complex(j.toTensor(),V.toTensor())},c.prototype.split=function(a,l,g){return to(a,l,g)},c.prototype.dispose=function(){},c.prototype.floatPrecision=function(){return 32},c.prototype.epsilon=function(){return 1e-7},c.prototype.cropAndResize=function(a,l,g,_,j,V){for(var ne=a.shape,oe=ne[0],me=ne[1],Ee=ne[2],_e=ne[3],Ne=l.shape[0],Ue=_[0],$e=_[1],He=bi([Ne,Ue,$e,_e],"float32"),et=this.readSync(l.dataId),lt=this.readSync(g.dataId),ht=this.readSync(a.dataId),gt=a.strides,Ct=He.strides,Wt=0;Wt<Ne;Wt++){var Kt=4*Wt,Vt=et[Kt],Ht=et[Kt+1],vn=et[Kt+2],On=et[Kt+3],Cn=lt[Wt];if(!(Cn>=oe))for(var Kn=Ue>1?(vn-Vt)*(me-1)/(Ue-1):0,er=$e>1?(On-Ht)*(Ee-1)/($e-1):0,sr=0;sr<Ue;sr++){var lr=Ue>1?Vt*(me-1)+sr*Kn:.5*(Vt+vn)*(me-1);if(lr<0||lr>me-1)for(var ur=0;ur<$e;ur++)for(var ar=0;ar<_e;ar++){var Or=ar+ur*Ct[2]+sr*Ct[1]+Wt*Ct[0];He.values[Or]=V}else if(j==="bilinear"){var Er=Math.floor(lr),Ur=Math.ceil(lr),ei=lr-Er;for(ur=0;ur<$e;ur++)if((Xi=$e>1?Ht*(Ee-1)+ur*er:.5*(Ht+On)*(Ee-1))<0||Xi>Ee-1)for(ar=0;ar<_e;ar++)Or=ar+ur*Ct[2]+sr*Ct[1]+Wt*Ct[0],He.values[Or]=V;else{var mi=Math.floor(Xi),ua=Math.ceil(Xi),ca=Xi-mi;for(ar=0;ar<_e;ar++){var ka=ht[Or=ar+mi*gt[2]+Er*gt[1]+Cn*gt[0]],ba=ht[Or=ar+ua*gt[2]+Er*gt[1]+Cn*gt[0]],ja=ht[Or=ar+mi*gt[2]+Ur*gt[1]+Cn*gt[0]],Za=ka+(ba-ka)*ca,Bo=ja+(ht[Or=ar+ua*gt[2]+Ur*gt[1]+Cn*gt[0]]-ja)*ca;Or=ar+ur*Ct[2]+sr*Ct[1]+Wt*Ct[0],He.values[Or]=Za+(Bo-Za)*ei}}}else for(ur=0;ur<$e;++ur){var Xi;if((Xi=$e>1?Ht*(Ee-1)+ur*er:.5*(Ht+On)*(Ee-1))<0||Xi>Ee-1)for(ar=0;ar<_e;ar++)Or=ar+ur*Ct[2]+sr*Ct[1]+Wt*Ct[0],He.values[Or]=V;else{var Ea=Math.round(Xi),Wa=Math.round(lr);for(ar=0;ar<_e;ar++){var iu=ar+Ea*gt[2]+Wa*gt[1]+Cn*gt[0],Ms=ar+ur*Ct[2]+sr*Ct[1]+Wt*Ct[0];He.values[Ms]=ht[iu]}}}}}return He.toTensor()},c.prototype.sparseToDense=function(a,l,g,_){var j=Qc(0,a,g),V=j.sliceRank,ne=j.numUpdates,oe=j.sliceSize,me=j.strides,Ee=j.outputSize;return this.scatter(a,l,g,Ee,oe,ne,V,me,_,!1)},c.prototype.gatherND=function(a,l){var g=l.shape,_=g[g.length-1],j=Hs(a,l),V=j[0],ne=j[1],oe=j[2],me=j[3];if(ne===0)return wa([],V,a.dtype);for(var Ee=new Wi([ne,oe],a.dtype),_e=this.readSync(l.dataId),Ne=this.readSync(a.dataId),Ue=0;Ue<ne;Ue++){for(var $e=[],He=0,et=0;et<_;et++){var lt=_e[Ue*_+et];He+=lt*me[et],$e.push(lt)}if(He<0||He>=a.size/oe)throw new Error("Invalid indices: "+$e+" does not index into "+a.shape);for(var ht=0;ht<oe;ht++)Ee.values[Ue*oe+ht]=Ne[He*oe+ht]}return Ee.toTensor().reshape(V)},c.prototype.scatterND=function(a,l,g){var _=Qc(0,a,g),j=_.sliceRank,V=_.numUpdates,ne=_.sliceSize,oe=_.strides,me=_.outputSize,Ee=fr(0);return this.scatter(a,l,g,me,ne,V,j,oe,Ee,!0)},c.prototype.fill=function(a,l,g){var _=fn(g=g||xe(l),Ye(a));return _.fill(l),Ve.makeTensor(_,a,g,this)},c.prototype.onesLike=function(a){if(a.dtype==="string")throw new Error("onesLike is not supported for string tensors");return this.fill(a.shape,1,a.dtype)},c.prototype.zerosLike=function(a){var l=fn(a.dtype,Ye(a.shape));return this.makeOutput(l,a.shape,a.dtype)},c.prototype.linspace=function(a,l,g){return li(a,l,g)},c.prototype.scatter=function(a,l,g,_,j,V,ne,oe,me,Ee){var _e=[_/j,j],Ne=this.readSync(a.dataId),Ue=this.readSync(l.dataId);if(_===0)return wa([],g,l.dtype);var $e=new Wi(_e,l.dtype);$e.values.fill(this.readSync(me.dataId)[0]);for(var He=0;He<V;He++){for(var et=[],lt=0,ht=0;ht<ne;ht++){var gt=Ne[He*ne+ht];et.push(gt),lt+=gt*oe[ht]}if(lt<0||lt>=_/j)throw new Error("Invalid indices: "+et+" does not index into "+g);for(var Ct=0;Ct<j;Ct++)Ee?$e.values[lt*j+Ct]+=Ue[He*j+Ct]:$e.values[lt*j+Ct]=l.rank===0?Ue[0]:Ue[He*j+Ct]}return $e.toTensor().reshape(g)},c}(Ut);function _r(p,c){return{kernelName:p,backendName:"cpu",kernelFunc:function(a){var l=a.inputs,g=a.backend,_=l,j=_.a,V=_.b,ne=g;dn([j,V],p);var oe=ne.data.get(j.dataId).values,me=ne.data.get(V.dataId).values,Ee=c(j.shape,V.shape,oe,me,j.dtype),_e=Ee[0],Ne=Ee[1];return{dataId:ne.write(_e,Ne,j.dtype),shape:Ne,dtype:j.dtype}}}}function hi(p){return function(c,a,l,g,_){var j=Mi(c,a),V=j.length,ne=Cr(j),oe=Yn(_,Ye(j)),me=c.length,Ee=a.length,_e=Cr(c),Ne=Cr(a),Ue=Ao(c,j),$e=Ao(a,j);if(Ue.length+$e.length===0)for(var He=0;He<oe.length;++He)oe[He]=p(l[He%l.length],g[He%g.length]);else{var et=function(lt){var ht=gr(lt,V,ne),gt=ht.slice(-me);Ue.forEach(function(Vt){return gt[Vt]=0});var Ct=xr(gt,me,_e),Wt=ht.slice(-Ee);$e.forEach(function(Vt){return Wt[Vt]=0});var Kt=xr(Wt,Ee,Ne);oe[lt]=p(l[Ct],g[Kt])};for(He=0;He<oe.length;++He)et(He)}return[oe,j]}}Ve.registerBackend("cpu",function(){return new Br},1);var Ei=hi(function(p,c){return p/c}),xi=_r(Pa,Ei),ya={kernelName:"MaxPoolWithArgmax",backendName:"cpu",kernelFunc:function(p){var c=p.inputs,a=p.attrs,l=p.backend,g=c.x,_=a,j=_.filterSize,V=_.strides,ne=_.pad,oe=_.includeBatchInIndex,me=l;dn(g,"MaxPoolWithArgmax");var Ee=me.data.get(g.dataId).values,_e=yn(g.shape,j,V,[1,1],ne),Ne=function(lt,ht,gt,Ct,Wt){var Kt=cr(lt,0,gt,Cr(ht),Wt,"max"),Vt=kr(lt,ht,gt,Wt,!0,Ct);return[Kt.values,Vt.values]}(Ee,g.shape,g.dtype,oe,_e),Ue=Ne[0],$e=Ne[1],He=me.write(Ue,_e.outShape,g.dtype),et=me.write($e,_e.outShape,g.dtype);return[{dataId:He,shape:_e.outShape,dtype:g.dtype},{dataId:et,shape:_e.outShape,dtype:"int32"}]}},Ua={kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(p){var c=p.inputs,a=p.backend,l=p.attrs,g=c,_=g.boxes,j=g.scores,V=l,ne=V.maxOutputSize,oe=V.iouThreshold,me=V.scoreThreshold,Ee=V.softNmsSigma,_e=a;dn(_,"NonMaxSuppressionWithScore");var Ne=Sa(_e.data.get(_.dataId).values,_e.data.get(j.dataId).values,ne,oe,me,Ee);return[Ne.selectedIndices,Ne.selectedScores]}},Ta={kernelName:"Square",backendName:"cpu",kernelFunc:function(p){var c=p.inputs,a=p.backend,l=c.x,g=a;dn(l,"square");for(var _=g.data.get(l.dataId).values,j=new Float32Array(_.length),V=0;V<_.length;++V){var ne=_[V];j[V]=ne*ne}return{dataId:g.write(j,l.shape,l.dtype),shape:l.shape,dtype:l.dtype}}},Da=hi(function(p,c){var a=p-c;return a*a});function Ra(p,c,a,l,g){for(var _=Ye(c),j=c.length,V=Cr(c),ne=Cr(g),oe=Yn(a,Ye(g)),me=0;me<_;++me){for(var Ee=gr(me,j,V),_e=new Array(Ee.length),Ne=0;Ne<_e.length;Ne++)_e[Ne]=Ee[l[Ne]];oe[xr(_e,j,ne)]=p[me]}return oe}for(var Qa=0,oo=[Ua,Ta,_r(Dl,Da),xi,{kernelName:"Transpose",backendName:"cpu",kernelFunc:function(p){var c=p.inputs,a=p.attrs,l=p.backend,g=c.x,_=a.perm,j=l;dn(g,"transpose");for(var V=g.shape.length,ne=new Array(V),oe=0;oe<ne.length;oe++)ne[oe]=g.shape[_[oe]];var me=Ra(j.data.get(g.dataId).values,g.shape,g.dtype,_,ne);return{dataId:j.write(me,ne,g.dtype),shape:ne,dtype:g.dtype}}},ya];Qa<oo.length;Qa++)pe(oo[Qa]);for(var wo,Ks=0,Ti=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(p){var c=p.inputs,a=p.backend,l=p.attrs,g=c.pixels,_=l.numChannels,j=typeof HTMLVideoElement<"u"&&g instanceof HTMLVideoElement,V=typeof HTMLImageElement<"u"&&g instanceof HTMLImageElement,ne=j?[g.videoWidth,g.videoHeight]:[g.width,g.height],oe=ne[0],me=ne[1],Ee=[me,oe],_e=[me,oe,_];(V||j)&&(wo==null&&(wo=document.createElement("canvas").getContext("2d")),wo.canvas.width=oe,wo.canvas.height=me,wo.drawImage(g,0,0,oe,me),g=wo.canvas);var Ne=a.makeTensorInfo(Ee,"int32");a.texData.get(Ne.dataId).usage=ir.PIXELS,a.gpgpu.uploadPixelDataToTexture(a.getTexture(Ne.dataId),g);var Ue=L().getBool("WEBGL_PACK")?new function(He){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var et=va(),lt=He[0],ht=He[1];this.outputShape=He,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(`+ht+".0, "+lt+`.0);
            vec4 values = `+et.texture2D+`(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        `+et.output+` = result;
      }
    `}(_e):new function(He){this.variableNames=["A"];var et=va(),lt=He[0],ht=He[1];this.outputShape=He,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+ht+".0, "+lt+`.0);

        vec4 values = `+et.texture2D+`(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}(_e),$e=a.runWebGLProgram(Ue,[Ne],"int32");return a.disposeData(Ne.dataId),$e}},{kernelName:Pa,backendName:"webgl",kernelFunc:function(p){var c=p.inputs,a=p.backend,l=c;return function(g,_,j){var V=new za(`
if (a == b) {
  return 1.0;
};
return a / b;`,g.shape,_.shape);return L().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&(V=new Mo(`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,g.shape,_.shape,!0)),j.runWebGLProgram(V,[g,_],"float32")}(l.a,l.b,a)}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(p){var c=p.inputs,a=p.backend,l=p.attrs;qc("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var g=c,_=g.boxes,j=g.scores,V=l,ne=V.maxOutputSize,oe=V.iouThreshold,me=V.scoreThreshold,Ee=V.softNmsSigma,_e=a,Ne=Sa(_e.readSync(_.dataId),_e.readSync(j.dataId),ne,oe,me,Ee);return[Ne.selectedIndices,Ne.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(p){var c=p.inputs,a=p.backend,l=c.x,g=a,_=new sa(l.shape,"return x * x;");return g.runWebGLProgram(_,[l],l.dtype)}},{kernelName:Dl,backendName:"webgl",kernelFunc:function(p){var c=p.inputs,a=p.backend,l=c,g=l.a,_=l.b,j=a,V=L().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Mo("return (a - b) * (a - b);",g.shape,_.shape):new za("return (a - b) * (a - b);",g.shape,_.shape);return j.compileAndRun(V,[g,_])}},{kernelName:"Transpose",backendName:"webgl",kernelFunc:function(p){for(var c,a=p.inputs,l=p.attrs,g=p.backend,_=a.x,j=l.perm,V=g,ne=_.shape.length,oe=new Array(ne),me=0;me<oe.length;me++)oe[me]=_.shape[j[me]];if(V.shouldExecuteOnCPU([_])){var Ee=Ra(V.texData.get(_.dataId).values,_.shape,_.dtype,j,oe);c=V.makeTensorInfo(oe,_.dtype),V.texData.get(c.dataId).values=Ee}else c=function(_e,Ne,Ue){var $e=L().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new function(He,et){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var lt=new Array(He.length),ht=0;ht<lt.length;ht++)lt[ht]=He[et[ht]];if(this.outputShape=lt,this.rank=lt.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var gt=Ia(this.rank),Ct=fs("rc",this.rank),Wt=new Array(this.rank);for(ht=0;ht<et.length;ht++)Wt[et[ht]]=Ct[ht];var Kt="vec2("+Wt.slice(-2).join()+")",Vt="++"+Ct[this.rank-1]+" < "+lt[this.rank-1],Ht="getChannel(getA("+Wt.join()+"), "+Kt+")";this.userCode=`
    void main() {
      `+gt+` rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = `+Ht+`;
      if(`+Vt+`) {
        result[1] = `+Ht+`;
      }
      --`+Ct[this.rank-1]+`;
      if(++`+Ct[this.rank-2]+" < "+lt[this.rank-2]+`) {
        result[2] = `+Ht+`;
        if(`+Vt+`) {
          result[3] = `+Ht+`;
        }
      }
      setOutput(result);
    }
    `}(_e.shape,Ne):new function(He,et){this.variableNames=["A"];for(var lt=new Array(He.length),ht=0;ht<lt.length;ht++)lt[ht]=He[et[ht]];this.outputShape=lt,this.rank=lt.length;var gt=Ia(this.rank),Ct=function(Wt){var Kt=Wt.length;if(Kt>6)throw Error("Transpose for rank "+Kt+" is not yet supported");for(var Vt=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],Ht=new Array(Kt),vn=0;vn<Wt.length;vn++)Ht[Wt[vn]]=Vt[vn];return Ht.join()}(et);this.userCode=`
    void main() {
      `+gt+` resRC = getOutputCoords();
      setOutput(getA(`+Ct+`));
    }
    `}(_e.shape,Ne);return Ue.runWebGLProgram($e,[_e],_e.dtype)}(_,j,V);return c}},{kernelName:"MaxPoolWithArgmax",backendName:"webgl",kernelFunc:function(p){var c=p.inputs,a=p.attrs,l=p.backend,g=c.x,_=a,j=_.filterSize,V=_.strides,ne=_.pad,oe=_.includeBatchInIndex,me=l;we(g.shape.length===4,function(){return"Error in maxPool: input must be rank 4 but got rank "+g.shape.length+"."});var Ee=[1,1];we(wr(V,Ee),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+V+" and dilations '"+Ee+"'"});var _e=yn(g.shape,j,V,Ee,ne),Ne=function(Ue,$e,He,et){var lt=new Hh(He,"max",!1),ht=et.runWebGLProgram(lt,[Ue],"float32");return lt=new Hh(He,"max",!0,!0,$e),[ht,et.runWebGLProgram(lt,[Ue],"float32")]}(g,oe,_e,me);return[Ne[0],Ne[1]]}}];Ks<Ti.length;Ks++)pe(Ti[Ks]);for(var Ho=0,Yo=[{kernelName:Sl,inputsToSave:["a","b"],gradFunc:function(p,c){var a=c[0],l=c[1],g=Mi(a.shape,l.shape);return{a:function(){var _=p,j=Fo(a.shape,g);return j.length>0&&(_=_.sum(j)),_.reshape(a.shape)},b:function(){var _=p,j=Fo(l.shape,g);return j.length>0&&(_=_.sum(j)),_.reshape(l.shape)}}}},{kernelName:"AddN",saveAllInputs:!0,gradFunc:function(p,c){var a={};return c.forEach(function(l,g){a[g]=function(){return p.clone()}}),a}},{kernelName:Ec,gradFunc:function(p,c,a){for(var l=a,g=l.inputShape,_=l.shape,j=Array.from(_),V=g.length-1;V>=0;V--)if(g[V]===_[V])j[V]=1;else if(g[V]!==1)throw new Error("broadcastTo(): ["+g+"] cannot be broadcast to ["+_+"].");var ne=[];for(V=0;V<j.length;V++)j[V]>1&&ne.push(V);return{x:function(){return p.sum(ne,!0)}}}},{kernelName:Pa,inputsToSave:["a","b"],gradFunc:function(p,c){var a=c[0],l=c[1],g=Mi(a.shape,l.shape);return{a:function(){var _=Xa(p,l.toFloat()),j=Fo(a.shape,g);return j.length>0?fl(_,j).reshape(a.shape):_},b:function(){var _=p.mul(a.toFloat()),j=Fo(l.shape,g);j.length>0&&(_=fl(_,j).reshape(l.shape));var V=Kl(l);return yo(Xa(_,V.toFloat()))}}}},{kernelName:"FusedBatchNorm",inputsToSave:["x","mean","variance","scale"],gradFunc:function(p,c,a){var l=a.varianceEpsilon,g=c[0],_=c[1],j=c[2],V=c[3],ne=Fg(g),oe=V??fr(1),me=Fo(_.shape,ne.shape),Ee=[];if(_.rank===1){for(var _e=0;_e<ne.shape.length-1;++_e)Ee.push(ne.shape[_e]);Ee.push(1)}var Ne=_o(g,_),Ue=Ka(p,oe),$e=Ml(eo(j,fr(l))),He=Ka(Ka(Ka($e,$e),$e),fr(-.5));return{x:function(){return _.rank===1?ks(Ka(Ka(p,Kf($e.as4D(1,1,1,_.shape[0]),Ee)),oe),g.shape):ks(Ka(Ka(p,$e),oe),g.shape)},mean:function(){var et=Ka(Ka($e,fr(-1)),Ue);return _.rank===1&&(et=fl(et,me)),ks(et,_.shape)},variance:function(){var et=Ka(Ka(He,Ne),Ue);return _.rank===1&&(et=fl(et,me)),ks(et,_.shape)},scale:function(){var et=Ka(Ne,$e),lt=Ka(p,et);return _.rank===1&&(lt=fl(lt,me)),ks(lt,_.shape)},offset:function(){var et=p;return _.rank===1&&(et=fl(et,me)),ks(et,_.shape)}}}},{kernelName:Sf,gradFunc:function(p){return{x:function(){return p.toFloat()}}}},{kernelName:Lh,inputsToSave:["indices"],gradFunc:function(p,c){var a=c[0];return{indices:function(){return Ki(a.shape,"float32")}}}},{kernelName:Cc,inputsToSave:["x"],gradFunc:function(p,c,a){var l=c[0],g=a.paddings.map(function(_){return _[0]});return{x:function(){return p.slice(g,l.shape)}}}},{kernelName:"Square",inputsToSave:["x"],gradFunc:function(p,c){var a=c[0];return{x:function(){return p.mul(a.toFloat().mul(2))}}}},{kernelName:Dl,inputsToSave:["a","b"],gradFunc:function(p,c){var a=c[0],l=c[1],g=fr(2);return{a:function(){return Ka(p,Ka(g,_o(a,l)))},b:function(){return Ka(p,Ka(g,_o(l,a)))}}}},{kernelName:Nl,inputsToSave:["x"],gradFunc:function(p,c,a){var l=c[0],g=a.reps;return{x:function(){var _=ii(l);if(l.rank===1)for(var j=0;j<g[0];++j)_=_.add(p.slice([j*l.shape[0]],[l.shape[0]]));else if(l.rank===2)for(j=0;j<g[0];++j)for(var V=0;V<g[1];++V)_=_.add(p.slice([j*l.shape[0],V*l.shape[1]],[l.shape[0],l.shape[1]]));else if(l.rank===3)for(j=0;j<g[0];++j)for(V=0;V<g[1];++V)for(var ne=0;ne<g[2];++ne)_=_.add(p.slice([j*l.shape[0],V*l.shape[1],ne*l.shape[2]],[l.shape[0],l.shape[1],l.shape[2]]));else{if(l.rank!==4)throw new Error("Gradient for tile operation is not implemented for rank-"+l.rank+" tensors yet.");for(j=0;j<g[0];++j)for(V=0;V<g[1];++V)for(ne=0;ne<g[2];++ne)for(var oe=0;oe<g[3];++oe)_=_.add(p.slice([j*l.shape[0],V*l.shape[1],ne*l.shape[2],oe*l.shape[3]],[l.shape[0],l.shape[1],l.shape[2],l.shape[3]]))}return _}}}},{kernelName:"Transpose",gradFunc:function(p,c,a){var l=wu(a.perm);return{x:function(){return ft(p,l)}}}}];Ho<Yo.length;Ho++)Ae(Yo[Ho]);var Xs=function(){function p(){}return p.prototype.fetch=function(c,a){return fetch(c,a)},p.prototype.now=function(){return performance.now()},p.prototype.encode=function(c,a){if(a!=="utf-8"&&a!=="utf8")throw new Error("Browser's encoder only supports utf-8, but got "+a);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(c)},p.prototype.decode=function(c,a){return new TextDecoder(a).decode(c)},p}();L().get("IS_BROWSER")&&L().setPlatform("browser",new Xs);var Ds,du=function(){function p(){this.util=o(388),this.textEncoder=new this.util.TextEncoder}return p.prototype.fetch=function(c,a){return L().global.fetch!=null?L().global.fetch(c,a):(Ds==null&&(Ds=o(389)),Ds(c,a))},p.prototype.now=function(){var c=H.hrtime();return 1e3*c[0]+c[1]/1e6},p.prototype.encode=function(c,a){if(a!=="utf-8"&&a!=="utf8")throw new Error("Node built-in encoder only supports utf-8, but got "+a);return this.textEncoder.encode(c)},p.prototype.decode=function(c,a){return c.length===0?"":new this.util.TextDecoder(a).decode(c)},p}();L().get("IS_NODE")&&L().setPlatform("node",new du);var Iu={float32:4,int32:4,uint16:2,uint8:1,bool:1},pu=4;function od(p,c){for(var a={},l=0,g=function(V){var ne=V.name,oe=V.dtype,me=V.shape,Ee=Ye(me),_e=void 0;if("quantization"in V){var Ne=V.quantization;if(Ne.dtype!=="uint8"&&Ne.dtype!=="uint16")throw new Error("Weight "+V.name+" has unknown quantization dtype "+Ne.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var Ue=Iu[Ne.dtype],$e=p.slice(l,l+Ee*Ue),He=Ne.dtype==="uint8"?new Uint8Array($e):new Uint16Array($e);if(oe==="float32")_e=Float32Array.from(He,function(Wt){return Wt*Ne.scale+Ne.min});else{if(oe!=="int32")throw new Error("Unsupported dtype in weight '"+ne+"': "+oe);_e=Int32Array.from(He,function(Wt){return Math.round(Wt*Ne.scale+Ne.min)})}l+=Ee*Ue}else if(oe==="string"){var et=Ye(V.shape);_e=[];for(var lt=0;lt<et;lt++){var ht=new Uint32Array(p.slice(l,l+pu))[0];l+=pu;var gt=new Uint8Array(p.slice(l,l+ht));_e.push(gt),l+=ht}}else{var Ct=Iu[oe];if($e=p.slice(l,l+Ee*Ct),oe==="float32")_e=new Float32Array($e);else if(oe==="int32")_e=new Int32Array($e);else{if(oe!=="bool")throw new Error("Unsupported dtype in weight '"+ne+"': "+oe);_e=new Uint8Array($e)}l+=Ee*Ct}a[ne]=wa(_e,me,oe)},_=0,j=c;_<j.length;_++)g(j[_]);return a}var rh=U!==void 0&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function hl(p){return rh?U.byteLength(p):new Blob([p]).size}function tf(p){var c=0;p.forEach(function(g){c+=g.byteLength});var a=new Uint8Array(c),l=0;return p.forEach(function(g){a.set(new Uint8Array(g),l),l+=g.byteLength}),a.buffer}function dl(p){for(p=p.trim();p.endsWith("/");)p=p.slice(0,p.length-1);var c=p.split("/");return c[c.length-1]}function Gu(p){if(p.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:p.modelTopology==null?0:hl(JSON.stringify(p.modelTopology)),weightSpecsBytes:p.weightSpecs==null?0:hl(JSON.stringify(p.weightSpecs)),weightDataBytes:p.weightData==null?0:p.weightData.byteLength}}var jo=function(){function p(){this.saveRouters=[],this.loadRouters=[]}return p.getInstance=function(){return p.instance==null&&(p.instance=new p),p.instance},p.registerSaveRouter=function(c){p.getInstance().saveRouters.push(c)},p.registerLoadRouter=function(c){p.getInstance().loadRouters.push(c)},p.getSaveHandlers=function(c){return p.getHandlers(c,"save")},p.getLoadHandlers=function(c,a){return p.getHandlers(c,"load",a)},p.getHandlers=function(c,a,l){var g=[];return(a==="load"?p.getInstance().loadRouters:p.getInstance().saveRouters).forEach(function(_){var j=_(c,l);j!==null&&g.push(j)}),g},p}(),nf="://",ih=function(){function p(){this.managers={}}return p.getInstance=function(){return p.instance==null&&(p.instance=new p),p.instance},p.registerManager=function(c,a){we(c!=null,function(){return"scheme must not be undefined or null."}),c.endsWith(nf)&&(c=c.slice(0,c.indexOf(nf))),we(c.length>0,function(){return"scheme must not be an empty string."});var l=p.getInstance();we(l.managers[c]==null,function(){return"A model store manager is already registered for scheme '"+c+"'."}),l.managers[c]=a},p.getManager=function(c){var a=this.getInstance().managers[c];if(a==null)throw new Error("Cannot find model manager for scheme '"+c+"'");return a},p.getSchemes=function(){return Object.keys(this.getInstance().managers)},p}();function sd(p){if(p.indexOf(nf)===-1)throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+ih.getSchemes().join(","));return{scheme:p.split(nf)[0],path:p.split(nf)[1]}}function rf(p,c,a){return a===void 0&&(a=!1),R(this,void 0,void 0,function(){var l,g,_,j,V,ne,oe,me,Ee;return P(this,function(_e){switch(_e.label){case 0:return we(p!==c,function(){return"Old path and new path are the same: '"+p+"'"}),we((l=jo.getLoadHandlers(p)).length>0,function(){return"Copying failed because no load handler is found for source URL "+p+"."}),we(l.length<2,function(){return"Copying failed because more than one ("+l.length+") load handlers for source URL "+p+"."}),g=l[0],we((_=jo.getSaveHandlers(c)).length>0,function(){return"Copying failed because no save handler is found for destination URL "+c+"."}),we(_.length<2,function(){return"Copying failed because more than one ("+l.length+") save handlers for destination URL "+c+"."}),j=_[0],V=sd(p).scheme,ne=sd(p).path,oe=V===sd(p).scheme,[4,g.load()];case 1:return me=_e.sent(),a&&oe?[4,ih.getManager(V).removeModel(ne)]:[3,3];case 2:_e.sent(),_e.label=3;case 3:return[4,j.save(me)];case 4:return Ee=_e.sent(),!a||oe?[3,6]:[4,ih.getManager(V).removeModel(ne)];case 5:_e.sent(),_e.label=6;case 6:return[2,Ee.modelArtifactsInfo]}})})}var ds="models_store",ah="model_info_store";function ud(){if(!L().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var p=window||self,c=p.indexedDB||p.mozIndexedDB||p.webkitIndexedDB||p.msIndexedDB||p.shimIndexedDB;if(c==null)throw new Error("The current browser does not appear to support IndexedDB.");return c}function cd(p){var c=p.result;c.createObjectStore(ds,{keyPath:"modelPath"}),c.createObjectStore(ah,{keyPath:"modelPath"})}var jc=function(){function p(c){if(this.indexedDB=ud(),c==null||!c)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=c}return p.prototype.save=function(c){return R(this,void 0,void 0,function(){return P(this,function(a){if(c.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,c)]})})},p.prototype.load=function(){return R(this,void 0,void 0,function(){return P(this,function(c){return[2,this.databaseAction(this.modelPath)]})})},p.prototype.databaseAction=function(c,a){var l=this;return new Promise(function(g,_){var j=l.indexedDB.open("tensorflowjs",1);j.onupgradeneeded=function(){return cd(j)},j.onsuccess=function(){var V=j.result;if(a==null){var ne=V.transaction(ds,"readonly"),oe=ne.objectStore(ds).get(l.modelPath);oe.onsuccess=function(){if(oe.result==null)return V.close(),_(new Error("Cannot find model with path '"+l.modelPath+"' in IndexedDB."));g(oe.result.modelArtifacts)},oe.onerror=function($e){return V.close(),_(oe.error)},ne.oncomplete=function(){return V.close()}}else{var me,Ee=Gu(a),_e=V.transaction(ah,"readwrite"),Ne=_e.objectStore(ah),Ue=Ne.put({modelPath:l.modelPath,modelArtifactsInfo:Ee});Ue.onsuccess=function(){var $e=(me=V.transaction(ds,"readwrite")).objectStore(ds).put({modelPath:l.modelPath,modelArtifacts:a,modelArtifactsInfo:Ee});$e.onsuccess=function(){return g({modelArtifactsInfo:Ee})},$e.onerror=function(He){var et=(Ne=_e.objectStore(ah)).delete(l.modelPath);et.onsuccess=function(){return V.close(),_($e.error)},et.onerror=function(lt){return V.close(),_($e.error)}}},Ue.onerror=function($e){return V.close(),_(Ue.error)},_e.oncomplete=function(){me==null?V.close():me.oncomplete=function(){return V.close()}}}},j.onerror=function(V){return _(j.error)}})},p.URL_SCHEME="indexeddb://",p}(),xp=function(p){return L().getBool("IS_BROWSER")&&!Array.isArray(p)&&p.startsWith(jc.URL_SCHEME)?(c=p.slice(jc.URL_SCHEME.length),new jc(c)):null;var c};jo.registerSaveRouter(xp),jo.registerLoadRouter(xp);var Ku=function(){function p(){this.indexedDB=ud()}return p.prototype.listModels=function(){return R(this,void 0,void 0,function(){var c=this;return P(this,function(a){return[2,new Promise(function(l,g){var _=c.indexedDB.open("tensorflowjs",1);_.onupgradeneeded=function(){return cd(_)},_.onsuccess=function(){var j=_.result,V=j.transaction(ah,"readonly"),ne=V.objectStore(ah).getAll();ne.onsuccess=function(){for(var oe={},me=0,Ee=ne.result;me<Ee.length;me++){var _e=Ee[me];oe[_e.modelPath]=_e.modelArtifactsInfo}l(oe)},ne.onerror=function(oe){return j.close(),g(ne.error)},V.oncomplete=function(){return j.close()}},_.onerror=function(j){return g(_.error)}})]})})},p.prototype.removeModel=function(c){return R(this,void 0,void 0,function(){var a=this;return P(this,function(l){var g;return c=(g=c).startsWith(jc.URL_SCHEME)?g.slice(jc.URL_SCHEME.length):g,[2,new Promise(function(_,j){var V=a.indexedDB.open("tensorflowjs",1);V.onupgradeneeded=function(){return cd(V)},V.onsuccess=function(){var ne,oe=V.result,me=oe.transaction(ah,"readwrite"),Ee=me.objectStore(ah),_e=Ee.get(c);_e.onsuccess=function(){if(_e.result==null)return oe.close(),j(new Error("Cannot find model with path '"+c+"' in IndexedDB."));var Ne=Ee.delete(c),Ue=function(){var $e=(ne=oe.transaction(ds,"readwrite")).objectStore(ds).delete(c);$e.onsuccess=function(){return _(_e.result.modelArtifactsInfo)},$e.onerror=function(He){return j(_e.error)}};Ne.onsuccess=Ue,Ne.onerror=function($e){return Ue(),oe.close(),j(_e.error)}},_e.onerror=function(Ne){return oe.close(),j(_e.error)},me.oncomplete=function(){ne==null?oe.close():ne.oncomplete=function(){return oe.close()}}},V.onerror=function(ne){return j(V.error)}})]})})},p}();if(L().getBool("IS_BROWSER"))try{ih.registerManager(jc.URL_SCHEME,new Ku)}catch{}var Ts="/",Fu="tensorflowjs_models",ps="info",pl="model_topology",oh="weight_specs",ld="weight_data",sh="model_metadata";function wp(p){return{info:[Fu,p,ps].join(Ts),topology:[Fu,p,pl].join(Ts),weightSpecs:[Fu,p,oh].join(Ts),weightData:[Fu,p,ld].join(Ts),modelMetadata:[Fu,p,sh].join(Ts)}}function ml(p){var c=p.split(Ts);if(c.length<3)throw new Error("Invalid key format: "+p);return c.slice(1,c.length-1).join(Ts)}var ru=function(){function p(c){if(!L().getBool("IS_BROWSER")||typeof window>"u"||window.localStorage===void 0)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,c==null||!c)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=c,this.keys=wp(this.modelPath)}return p.prototype.save=function(c){return R(this,void 0,void 0,function(){var a,l,g;return P(this,function(_){if(c.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");a=JSON.stringify(c.modelTopology),l=JSON.stringify(c.weightSpecs),g=Gu(c);try{return this.LS.setItem(this.keys.info,JSON.stringify(g)),this.LS.setItem(this.keys.topology,a),this.LS.setItem(this.keys.weightSpecs,l),this.LS.setItem(this.keys.weightData,function(j){if(rh)return U.from(j).toString("base64");for(var V=new Uint8Array(j),ne="",oe=0,me=V.length;oe<me;oe++)ne+=String.fromCharCode(V[oe]);return btoa(ne)}(c.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:c.format,generatedBy:c.generatedBy,convertedBy:c.convertedBy,userDefinedMetadata:c.userDefinedMetadata})),[2,{modelArtifactsInfo:g}]}catch{throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+g.modelTopologyBytes+", weightSpecsBytes="+g.weightSpecsBytes+", weightDataBytes="+g.weightDataBytes+".")}return[2]})})},p.prototype.load=function(){return R(this,void 0,void 0,function(){var c,a,l,g,_,j,V;return P(this,function(ne){if((c=JSON.parse(this.LS.getItem(this.keys.info)))==null)throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if(c.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(a={},(l=JSON.parse(this.LS.getItem(this.keys.topology)))==null)throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(a.modelTopology=l,(g=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))==null)throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(a.weightSpecs=g,(_=this.LS.getItem(this.keys.modelMetadata))!=null&&(j=JSON.parse(_),a.format=j.format,a.generatedBy=j.generatedBy,a.convertedBy=j.convertedBy,a.userDefinedMetadata=j.userDefinedMetadata),(V=this.LS.getItem(this.keys.weightData))==null)throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return a.weightData=function(oe){if(rh){var me=U.from(oe,"base64");return me.buffer.slice(me.byteOffset,me.byteOffset+me.byteLength)}for(var Ee=atob(oe),_e=new Uint8Array(Ee.length),Ne=0;Ne<Ee.length;++Ne)_e.set([Ee.charCodeAt(Ne)],Ne);return _e.buffer}(V),[2,a]})})},p.URL_SCHEME="localstorage://",p}(),C0=function(p){return L().getBool("IS_BROWSER")&&!Array.isArray(p)&&p.startsWith(ru.URL_SCHEME)?(c=p.slice(ru.URL_SCHEME.length),new ru(c)):null;var c};jo.registerSaveRouter(C0),jo.registerLoadRouter(C0);var gl=function(){function p(){we(L().getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),we(typeof window>"u"||window.localStorage!==void 0,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return p.prototype.listModels=function(){return R(this,void 0,void 0,function(){var c,a,l,g,_,j;return P(this,function(V){for(c={},a=Fu+Ts,l=Ts+ps,g=0;g<this.LS.length;++g)(_=this.LS.key(g)).startsWith(a)&&_.endsWith(l)&&(j=ml(_),c[j]=JSON.parse(this.LS.getItem(_)));return[2,c]})})},p.prototype.removeModel=function(c){return R(this,void 0,void 0,function(){var a,l;return P(this,function(g){var _;if(c=(_=c).startsWith(ru.URL_SCHEME)?_.slice(ru.URL_SCHEME.length):_,a=wp(c),this.LS.getItem(a.info)==null)throw new Error("Cannot find model at path '"+c+"'");return l=JSON.parse(this.LS.getItem(a.info)),this.LS.removeItem(a.info),this.LS.removeItem(a.topology),this.LS.removeItem(a.weightSpecs),this.LS.removeItem(a.weightData),[2,l]})})},p}();if(L().getBool("IS_BROWSER"))try{ih.registerManager(ru.URL_SCHEME,new gl)}catch{}var fd="model",O0=".json",A0=".weights.bin";function _0(p){return new Promise(function(c){return setTimeout(c)}).then(p)}var rv=function(){function p(c){if(!L().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");c.startsWith(p.URL_SCHEME)&&(c=c.slice(p.URL_SCHEME.length)),c!=null&&c.length!==0||(c=fd),this.modelTopologyFileName=c+O0,this.weightDataFileName=c+A0}return p.prototype.save=function(c){return R(this,void 0,void 0,function(){var a,l,g,_,j,V;return P(this,function(ne){switch(ne.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(a=window.URL.createObjectURL(new Blob([c.weightData],{type:"application/octet-stream"})),!(c.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return l=[{paths:["./"+this.weightDataFileName],weights:c.weightSpecs}],g={modelTopology:c.modelTopology,format:c.format,generatedBy:c.generatedBy,convertedBy:c.convertedBy,weightsManifest:l},_=window.URL.createObjectURL(new Blob([JSON.stringify(g)],{type:"application/json"})),(j=this.jsonAnchor==null?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,j.href=_,[4,_0(function(){return j.dispatchEvent(new MouseEvent("click"))})];case 2:return ne.sent(),c.weightData==null?[3,4]:((V=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,V.href=a,[4,_0(function(){return V.dispatchEvent(new MouseEvent("click"))})]);case 3:ne.sent(),ne.label=4;case 4:return[2,{modelArtifactsInfo:Gu(c)}]}})})},p.URL_SCHEME="downloads://",p}(),Uv=function(){function p(c){if(c==null||c.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+c);this.files=c}return p.prototype.load=function(){return R(this,void 0,void 0,function(){var c,a,l=this;return P(this,function(g){return c=this.files[0],a=this.files.slice(1),[2,new Promise(function(_,j){var V=new FileReader;V.onload=function(ne){var oe=JSON.parse(ne.target.result),me=oe.modelTopology;if(me!=null){a.length===0&&_({modelTopology:me});var Ee=oe.weightsManifest;if(Ee!=null){var _e;try{_e=l.checkManifestAndWeightFiles(Ee,a)}catch(He){return void j(He)}var Ne=[],Ue=[],$e=[];Ee.forEach(function(He){He.paths.forEach(function(et){Ue.push(et),$e.push(null)}),Ne.push.apply(Ne,He.weights)}),Ee.forEach(function(He){He.paths.forEach(function(et){var lt=new FileReader;lt.onload=function(ht){var gt=ht.target.result,Ct=Ue.indexOf(et);$e[Ct]=gt,$e.indexOf(null)===-1&&_({modelTopology:me,weightSpecs:Ne,weightData:tf($e),format:oe.format,generatedBy:oe.generatedBy,convertedBy:oe.convertedBy,userDefinedMetadata:oe.userDefinedMetadata})},lt.onerror=function(ht){return j("Failed to weights data from file of path '"+et+"'.")},lt.readAsArrayBuffer(_e[et])})})}else j(new Error("weightManifest field is missing from file "+c.name))}else j(new Error("modelTopology field is missing from file "+c.name))},V.onerror=function(ne){return j("Failed to read model topology and weights manifest JSON from file '"+c.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},V.readAsText(c)})]})})},p.prototype.checkManifestAndWeightFiles=function(c,a){for(var l=[],g=a.map(function(ne){return dl(ne.name)}),_={},j=0,V=c;j<V.length;j++)V[j].paths.forEach(function(ne){var oe=dl(ne);if(l.indexOf(oe)!==-1)throw new Error("Duplicate file basename found in weights manifest: '"+oe+"'");if(l.push(oe),g.indexOf(oe)===-1)throw new Error("Weight file with basename '"+oe+"' is not provided.");_[ne]=a[g.indexOf(oe)]});if(l.length!==a.length)throw new Error("Mismatch in the number of files in weights manifest ("+l.length+") and the number of weight files provided ("+a.length+").");return _},p}();function iv(p,c,a,l){(function(_){we(_!=null&&Array.isArray(_)&&_.length>0,function(){return"promises must be a none empty array"})})(p),function(_,j){we(_>=0&&_<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+_}),we(j>=0&&j<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+j}),we(j>=_,function(){return"startFraction must be no more than endFraction, but got startFraction "+_+" and endFraction "+j})}(a=a??0,l=l??1);var g=0;return Promise.all(p.map(function(_){return _.then(function(j){var V=a+ ++g/p.length*(l-a);return c(V),j}),_}))}function Wv(p,c){return R(this,void 0,void 0,function(){var a,l,g,_,j,V,ne,oe,me;return P(this,function(Ee){switch(Ee.label){case 0:return c==null&&(c={}),a=c.fetchFunc==null?L().platform.fetch:c.fetchFunc,l=p.map(function(_e){return a(_e,c.requestInit,{isBinary:!0})}),g=0,_=.5,c.onProgress!=null?[3,2]:[4,Promise.all(l)];case 1:return j=Ee.sent(),[3,4];case 2:return[4,iv(l,c.onProgress,g,_)];case 3:j=Ee.sent(),Ee.label=4;case 4:return V=j.map(function(_e){return _e.arrayBuffer()}),ne=.5,oe=1,c.onProgress!=null?[3,6]:[4,Promise.all(V)];case 5:return me=Ee.sent(),[3,8];case 6:return[4,iv(V,c.onProgress,ne,oe)];case 7:me=Ee.sent(),Ee.label=8;case 8:return[2,me]}})})}function mc(p){var c=this;return function(a,l,g){return l===void 0&&(l=""),R(c,void 0,void 0,function(){var _,j,V,ne,oe,me,Ee,_e,Ne,Ue;return P(this,function($e){switch($e.label){case 0:if(_=a.map(function(){return!1}),j={},V=g!=null?g.map(function(){return!1}):[],ne=[],a.forEach(function(He,et){var lt=0;He.weights.forEach(function(ht){var gt="quantization"in ht?ht.quantization.dtype:ht.dtype,Ct=Iu[gt]*Ye(ht.shape),Wt=function(){_[et]=!0,j[et]==null&&(j[et]=[]),j[et].push({manifestEntry:ht,groupOffset:lt,sizeBytes:Ct})};g!=null?g.forEach(function(Kt,Vt){Kt===ht.name&&(Wt(),V[Vt]=!0)}):Wt(),ne.push(ht.name),lt+=Ct})}),!V.every(function(He){return He}))throw oe=g.filter(function(He,et){return!V[et]}),new Error("Could not find weights in manifest with names: "+oe.join(", ")+`. 
Manifest JSON has weights with names: `+ne.join(", ")+".");return me=_.reduce(function(He,et,lt){return et&&He.push(lt),He},[]),Ee=[],me.forEach(function(He){a[He].paths.forEach(function(et){var lt=l+(l.endsWith("/")?"":"/")+et;Ee.push(lt)})}),[4,p(Ee)];case 1:return _e=$e.sent(),Ne={},Ue=0,me.forEach(function(He){for(var et=a[He].paths.length,lt=0,ht=0;ht<et;ht++)lt+=_e[Ue+ht].byteLength;for(var gt=new ArrayBuffer(lt),Ct=new Uint8Array(gt),Wt=0,Kt=0;Kt<et;Kt++){var Vt=new Uint8Array(_e[Ue+Kt]);Ct.set(Vt,Wt),Wt+=Vt.byteLength}j[He].forEach(function(Ht){var vn=od(gt.slice(Ht.groupOffset,Ht.groupOffset+Ht.sizeBytes),[Ht.manifestEntry]);for(var On in vn)Ne[On]=vn[On]}),Ue+=et}),[2,Ne]}})})}}jo.registerSaveRouter(function(p){return L().getBool("IS_BROWSER")&&!Array.isArray(p)&&p.startsWith(rv.URL_SCHEME)?function(c){return c===void 0&&(c="model"),new rv(c)}(p.slice(rv.URL_SCHEME.length)):null});var S0=function(){function p(c,a){if(this.DEFAULT_METHOD="POST",a==null&&(a={}),this.weightPathPrefix=a.weightPathPrefix,this.onProgress=a.onProgress,a.fetchFunc!=null?(we(typeof a.fetchFunc=="function",function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=a.fetchFunc):this.fetch=L().platform.fetch,we(c!=null&&c.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(c)&&we(c.length===2,function(){return"URL paths for http must have a length of 2, (actual length is "+c.length+")."}),this.path=c,a.requestInit!=null&&a.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=a.requestInit||{}}return p.prototype.save=function(c){return R(this,void 0,void 0,function(){var a,l,g,_;return P(this,function(j){switch(j.label){case 0:if(c.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(a=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,l=[{paths:["./model.weights.bin"],weights:c.weightSpecs}],g={modelTopology:c.modelTopology,format:c.format,generatedBy:c.generatedBy,convertedBy:c.convertedBy,userDefinedMetadata:c.userDefinedMetadata,weightsManifest:l},a.body.append("model.json",new Blob([JSON.stringify(g)],{type:"application/json"}),"model.json"),c.weightData!=null&&a.body.append("model.weights.bin",new Blob([c.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,a)];case 1:if((_=j.sent()).ok)return[2,{modelArtifactsInfo:Gu(c),responses:[_]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+_.status+".")}})})},p.prototype.load=function(){return R(this,void 0,void 0,function(){var c,a,l,g,_,j,V,ne,oe,me,Ee,_e;return P(this,function(Ne){switch(Ne.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(c=Ne.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+c.status+". Please verify this URL points to the model JSON of the model to load.");Ne.label=2;case 2:return Ne.trys.push([2,4,,5]),[4,c.json()];case 3:return a=Ne.sent(),[3,5];case 4:throw Ne.sent(),l="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?l+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":l+=" Please make sure the server is serving valid JSON for this request.",new Error(l);case 5:if(g=a.modelTopology,_=a.weightsManifest,j=a.generatedBy,V=a.convertedBy,ne=a.format,oe=a.userDefinedMetadata,g==null&&_==null)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return _==null?[3,7]:[4,this.loadWeights(_)];case 6:_e=Ne.sent(),me=_e[0],Ee=_e[1],Ne.label=7;case 7:return[2,{modelTopology:g,weightSpecs:me,weightData:Ee,userDefinedMetadata:oe,generatedBy:j,convertedBy:V,format:ne}]}})})},p.prototype.loadWeights=function(c){return R(this,void 0,void 0,function(){var a,l,g,_,j,V,ne,oe,me,Ee,_e;return P(this,function(Ne){switch(Ne.label){case 0:for(a=Array.isArray(this.path)?this.path[1]:this.path,l=function(Ue){var $e=Ue.lastIndexOf("/"),He=Ue.lastIndexOf("?");return[Ue.substring(0,$e)+"/",He>$e?Ue.substring(He):""]}(a),g=l[0],_=l[1],j=this.weightPathPrefix||g,V=[],ne=0,oe=c;ne<oe.length;ne++)me=oe[ne],V.push.apply(V,me.weights);return Ee=[],c.forEach(function(Ue){Ue.paths.forEach(function($e){Ee.push(j+$e+_)})}),[4,Wv(Ee,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return _e=Ne.sent(),[2,[V,tf(_e)]]}})})},p.URL_SCHEME_REGEX=/^https?:\/\//,p}();function Xu(p){return p.match(S0.URL_SCHEME_REGEX)!=null}var af=function(p,c){return typeof fetch>"u"?null:(Array.isArray(p)?p.every(function(a){return Xu(a)}):Xu(p))?v(p,{onProgress:c}):null};function v(p,c){return new S0(p,c)}jo.registerSaveRouter(af),jo.registerLoadRouter(af);var h,u=function(){function p(c){this.modelArtifacts=c}return p.prototype.load=function(){return R(this,void 0,void 0,function(){return P(this,function(c){return[2,this.modelArtifacts]})})},p}(),d=function(){function p(c){this.saveHandler=c}return p.prototype.save=function(c){return R(this,void 0,void 0,function(){return P(this,function(a){return[2,this.saveHandler(c)]})})},p}(),y=Object.freeze({browserFiles:function(p){return new Uv(p)},browserHTTPRequest:function(p,c){return v(p,c)},concatenateArrayBuffers:tf,decodeWeights:od,encodeWeights:function(p,c){return R(this,void 0,void 0,function(){var a,l,g,_,j,V=this;return P(this,function(ne){switch(ne.label){case 0:for(a=[],l=[],g=Array.isArray(p)?p.map(function(oe){return oe.name}):Object.keys(p),_=function(oe){var me=g[oe],Ee=Array.isArray(p)?p[oe].tensor:p[me];if(Ee.dtype!=="float32"&&Ee.dtype!=="int32"&&Ee.dtype!=="bool"&&Ee.dtype!=="string")throw new Error("Unsupported dtype in weight '"+me+"': "+Ee.dtype);var _e={name:me,shape:Ee.shape,dtype:Ee.dtype};if(Ee.dtype==="string"){var Ne=new Promise(function(Ue){return R(V,void 0,void 0,function(){var $e,He,et,lt,ht,gt,Ct;return P(this,function(Wt){switch(Wt.label){case 0:return[4,Ee.bytes()];case 1:for($e=Wt.sent(),He=$e.reduce(function(Kt,Vt){return Kt+Vt.length},0)+pu*$e.length,et=new Uint8Array(He),lt=0,ht=0;ht<$e.length;ht++)gt=$e[ht],Ct=new Uint8Array(new Uint32Array([gt.length]).buffer),et.set(Ct,lt),lt+=pu,et.set(gt,lt),lt+=gt.length;return Ue(et),[2]}})})});l.push(Ne)}else l.push(Ee.data());c!=null&&(_e.group=c),a.push(_e)},j=0;j<g.length;++j)_(j);return[4,Promise.all(l)];case 1:return[2,{data:function(oe){if(oe===null)throw new Error("Invalid input value: "+JSON.stringify(oe));var me=0,Ee=[];oe.forEach(function(Ue){if(me+=Ue.byteLength,Ee.push(Ue.byteLength===Ue.buffer.byteLength?Ue:new Ue.constructor(Ue)),!(Ue instanceof Float32Array||Ue instanceof Int32Array||Ue instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+Ue.constructor.name)});var _e=new Uint8Array(me),Ne=0;return Ee.forEach(function(Ue){_e.set(new Uint8Array(Ue.buffer),Ne),Ne+=Ue.byteLength}),_e.buffer}(ne.sent()),specs:a}]}})})},fromMemory:function(p,c,a,l){return arguments.length===1?p.modelTopology!=null||p.weightSpecs!=null?new u(p):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new u({modelTopology:p})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new u({modelTopology:p,weightSpecs:c,weightData:a,trainingConfig:l}))},getLoadHandlers:function(p,c){return jo.getLoadHandlers(p,c)},getModelArtifactsInfoForJSON:Gu,getSaveHandlers:function(p){return jo.getSaveHandlers(p)},http:v,isHTTPScheme:Xu,loadWeights:function(p,c,a,l){return c===void 0&&(c=""),R(this,void 0,void 0,function(){return P(this,function(g){return[2,mc(function(_){return Wv(_,{requestInit:l})})(p,c,a)]})})},registerLoadRouter:function(p){return jo.registerLoadRouter(p)},registerSaveRouter:function(p){return jo.registerSaveRouter(p)},weightsLoaderFactory:mc,withSaveHandler:function(p){return new d(p)},copyModel:function(p,c){return R(this,void 0,void 0,function(){return P(this,function(a){return[2,rf(p,c,!1)]})})},listModels:function(){return R(this,void 0,void 0,function(){var p,c,a,l,g,_,j;return P(this,function(V){switch(V.label){case 0:p=ih.getSchemes(),c={},a=0,l=p,V.label=1;case 1:return a<l.length?(g=l[a],[4,ih.getManager(g).listModels()]):[3,4];case 2:for(j in _=V.sent())c[g+nf+j]=_[j];V.label=3;case 3:return a++,[3,1];case 4:return[2,c]}})})},moveModel:function(p,c){return R(this,void 0,void 0,function(){return P(this,function(a){return[2,rf(p,c,!0)]})})},removeModel:function(p){return R(this,void 0,void 0,function(){var c;return P(this,function(a){return c=sd(p),[2,ih.getManager(c.scheme).removeModel(c.path)]})})}}),D=xt({confusionMatrix_:function(p,c,a){var l=Ke(p,"labels","confusionMatrix"),g=Ke(c,"predictions","confusionMatrix");we(a==null||a>0&&Number.isInteger(a),function(){return"If provided, numClasses must be a positive integer, but got "+a}),we(l.rank===1,function(){return"Expected the rank of labels to be 1, but got "+l.rank}),we(g.rank===1,function(){return"Expected the rank of predictions to be 1, but got "+g.rank}),we(l.shape[0]===g.shape[0],function(){return"Mismatch in the number of examples: "+l.shape[0]+" vs. "+g.shape[0]+". Labels and predictions should have the same number of elements."}),we(a>0&&Number.isInteger(a),function(){return"numClasses is required to be a positive integer, but got "+a});var _=fc(l.asType("int32"),a),j=fc(g.asType("int32"),a);return _.transpose().matMul(j).asType("int32")}}),W=Object.freeze({confusionMatrix:D}),X=xt({fromPixels_:function(p,c){if(c===void 0&&(c=3),c>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(p==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var a=!1,l=!1,g=!1,_=!1,j=!1;if(p.data instanceof Uint8Array)a=!0;else if(typeof ImageData<"u"&&p instanceof ImageData)l=!0;else if(typeof HTMLVideoElement<"u"&&p instanceof HTMLVideoElement)g=!0;else if(typeof HTMLImageElement<"u"&&p instanceof HTMLImageElement)_=!0;else{if(p.getContext==null)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+p.constructor.name);j=!0}if(g&&g&&p.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(ie("FromPixels",Ve.backendName)!=null)return Ve.runKernel("FromPixels",{pixels:p},{numChannels:c});var V,ne,oe=g?[p.videoWidth,p.videoHeight]:[p.width,p.height],me=oe[0],Ee=oe[1];if(j?V=p.getContext("2d").getImageData(0,0,me,Ee).data:l||a?V=p.data:(_||g)&&(h==null&&(h=document.createElement("canvas").getContext("2d")),h.canvas.width=me,h.canvas.height=Ee,h.drawImage(p,0,0,me,Ee),V=h.getImageData(0,0,me,Ee).data),c===4)ne=new Int32Array(V);else{var _e=me*Ee;ne=new Int32Array(_e*c);for(var Ne=0;Ne<_e;Ne++)for(var Ue=0;Ue<c;++Ue)ne[Ne*c+Ue]=V[4*Ne+Ue]}return Hc(ne,[Ee,me,c],"int32")}}),ae=Object.freeze({toPixels:function(p,c){return R(this,void 0,void 0,function(){var a,l,g,_,j,V,ne,oe,me,Ee,_e,Ne,Ue,$e,He,et,lt,ht,gt,Ct,Wt,Kt,Vt;return P(this,function(Ht){switch(Ht.label){case 0:if(a=Ke(p,"img","toPixels"),p instanceof jt||(a=a.toInt()),a.rank!==2&&a.rank!==3)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+a.rank+".");if(l=a.shape.slice(0,2),g=l[0],_=l[1],(j=a.rank===2?1:a.shape[2])>4||j===2)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+j);return[4,a.data()];case 1:return V=Ht.sent(),ne=a.min(),oe=a.max(),[4,Promise.all([ne.data(),oe.data()])];case 2:if(me=Ht.sent(),Ee=me[0],_e=me[1],Ne=Ee[0],Ue=_e[0],ne.dispose(),oe.dispose(),a.dtype==="float32"){if(Ne<0||Ue>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+Ne+" - "+Ue+"].")}else{if(a.dtype!=="int32")throw new Error("Unsupported type for toPixels: "+a.dtype+". Please use float32 or int32 tensors.");if(Ne<0||Ue>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+Ne+" - "+Ue+"].")}for($e=a.dtype==="float32"?255:1,He=new Uint8ClampedArray(_*g*4),et=0;et<g*_;++et)lt=void 0,ht=void 0,gt=void 0,Ct=void 0,j===1?(lt=V[et]*$e,ht=V[et]*$e,gt=V[et]*$e,Ct=255):j===3?(lt=V[3*et]*$e,ht=V[3*et+1]*$e,gt=V[3*et+2]*$e,Ct=255):j===4&&(lt=V[4*et]*$e,ht=V[4*et+1]*$e,gt=V[4*et+2]*$e,Ct=V[4*et+3]*$e),He[0+(Wt=4*et)]=Math.round(lt),He[Wt+1]=Math.round(ht),He[Wt+2]=Math.round(gt),He[Wt+3]=Math.round(Ct);return c!=null&&(c.width=_,c.height=g,Kt=c.getContext("2d"),Vt=new ImageData(He,_,g),Kt.putImageData(Vt,0,0)),a!==p&&a.dispose(),[2,He]}})})},fromPixels:X}),de=function(){function p(){}return p.prototype.getClassName=function(){return this.constructor.className},p.fromConfig=function(c,a){return new c(a)},p}(),be=function(){function p(){this.classNameMap={}}return p.getMap=function(){return p.instance==null&&(p.instance=new p),p.instance},p.register=function(c){p.getMap().classNameMap[c.className]=[c,c.fromConfig]},p}();function Ie(p){we(p.className!=null,function(){return"Class being registered does not have the static className property defined."}),we(typeof p.className=="string",function(){return"className is required to be a string, but got type "+typeof p.className}),we(p.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),be.register(p)}var Re=Object.freeze({Serializable:de,SerializationMap:be,registerClass:Ie}),Me="1.7.4",qe=Object.freeze({gpgpu_util:Dc,webgl_util:Ef,forceHalfFloat:function(){L().set("WEBGL_FORCE_F16_TEXTURES",!0)},MathBackendWebGL:Lp,setWebGLContext:la,GPGPUContext:Tm}),Je=function(p){function c(){return p!==null&&p.apply(this,arguments)||this}return J(c,p),c.prototype.minimize=function(a,l,g){l===void 0&&(l=!1);var _=this.computeGradients(a,g),j=_.value,V=_.grads;if(g!=null){var ne=g.map(function(oe){return{name:oe.name,tensor:V[oe.name]}});this.applyGradients(ne)}else this.applyGradients(V);return Na(V),l?j:(j.dispose(),null)},Object.defineProperty(c.prototype,"iterations",{get:function(){return this.iterations_==null&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),c.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},c.prototype.computeGradients=function(a,l){return C(a,l)},c.prototype.dispose=function(){this.iterations_!=null&&Na(this.iterations_)},c.prototype.saveIterations=function(){return R(this,void 0,void 0,function(){return P(this,function(a){return this.iterations_==null&&(this.iterations_=0),[2,{name:"iter",tensor:fr(this.iterations_,"int32")}]})})},c.prototype.getWeights=function(){return R(this,void 0,void 0,function(){return P(this,function(a){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},c.prototype.setWeights=function(a){return R(this,void 0,void 0,function(){return P(this,function(l){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())})})},c.prototype.extractIterations=function(a){return R(this,void 0,void 0,function(){var l;return P(this,function(g){switch(g.label){case 0:return l=this,[4,a[0].tensor.data()];case 1:return l.iterations_=g.sent()[0],[2,a.slice(1)]}})})},c}(de);Object.defineProperty(Je,Symbol.hasInstance,{value:function(p){return p.minimize!=null&&p.computeGradients!=null&&p.applyGradients!=null}});var Qe=function(p){function c(a,l,g){g===void 0&&(g=null);var _=p.call(this)||this;return _.learningRate=a,_.rho=l,_.epsilon=g,_.accumulatedGrads=[],_.accumulatedUpdates=[],g==null&&(_.epsilon=Ve.backend.epsilon()),_}return J(c,p),c.prototype.applyGradients=function(a){var l=this;(Array.isArray(a)?a.map(function(g){return g.name}):Object.keys(a)).forEach(function(g,_){var j=Ve.registeredVariables[g];l.accumulatedGrads[_]==null&&(l.accumulatedGrads[_]={originalName:g+"/accum_grad",variable:Fi(function(){return ii(j).variable(!1)})}),l.accumulatedUpdates[_]==null&&(l.accumulatedUpdates[_]={originalName:g+"/accum_var",variable:Fi(function(){return ii(j).variable(!1)})});var V=Array.isArray(a)?a[_].tensor:a[g];if(V!=null){var ne=l.accumulatedGrads[_].variable,oe=l.accumulatedUpdates[_].variable;Fi(function(){var me=ne.mul(l.rho).add(V.square().mul(1-l.rho)),Ee=oe.add(l.epsilon).sqrt().div(ne.add(l.epsilon).sqrt()).mul(V),_e=oe.mul(l.rho).add(Ee.square().mul(1-l.rho));ne.assign(me),oe.assign(_e);var Ne=Ee.mul(-l.learningRate).add(j);j.assign(Ne)})}}),this.incrementIterations()},c.prototype.dispose=function(){this.accumulatedUpdates!=null&&(Na(this.accumulatedGrads.map(function(a){return a.variable})),Na(this.accumulatedUpdates.map(function(a){return a.variable})))},c.prototype.getWeights=function(){return R(this,void 0,void 0,function(){var a;return P(this,function(l){switch(l.label){case 0:return a=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[l.sent()].concat(a.map(function(g){return{name:g.originalName,tensor:g.variable}}))]}})})},c.prototype.setWeights=function(a){return R(this,void 0,void 0,function(){var l;return P(this,function(g){switch(g.label){case 0:return[4,this.extractIterations(a)];case 1:return a=g.sent(),l=a.length/2,this.accumulatedGrads=a.slice(0,l).map(function(_){return{originalName:_.name,variable:_.tensor.variable(!1)}}),this.accumulatedUpdates=a.slice(l,2*l).map(function(_){return{originalName:_.name,variable:_.tensor.variable(!1)}}),[2]}})})},c.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},c.fromConfig=function(a,l){return new a(l.learningRate,l.rho,l.epsilon)},c.className="Adadelta",c}(Je);Ie(Qe);var ot=function(p){function c(a,l){l===void 0&&(l=.1);var g=p.call(this)||this;return g.learningRate=a,g.initialAccumulatorValue=l,g.accumulatedGrads=[],g}return J(c,p),c.prototype.applyGradients=function(a){var l=this;(Array.isArray(a)?a.map(function(g){return g.name}):Object.keys(a)).forEach(function(g,_){var j=Ve.registeredVariables[g];l.accumulatedGrads[_]==null&&(l.accumulatedGrads[_]={originalName:g+"/accumulator",variable:Fi(function(){return ws(j.shape,l.initialAccumulatorValue).variable(!1)})});var V=Array.isArray(a)?a[_].tensor:a[g];if(V!=null){var ne=l.accumulatedGrads[_].variable;Fi(function(){var oe=ne.add(V.square());ne.assign(oe);var me=V.div(oe.add(Ve.backend.epsilon()).sqrt()).mul(-l.learningRate).add(j);j.assign(me)})}}),this.incrementIterations()},c.prototype.dispose=function(){this.accumulatedGrads!=null&&Na(this.accumulatedGrads.map(function(a){return a.variable}))},c.prototype.getWeights=function(){return R(this,void 0,void 0,function(){return P(this,function(a){switch(a.label){case 0:return[4,this.saveIterations()];case 1:return[2,[a.sent()].concat(this.accumulatedGrads.map(function(l){return{name:l.originalName,tensor:l.variable}}))]}})})},c.prototype.setWeights=function(a){return R(this,void 0,void 0,function(){return P(this,function(l){switch(l.label){case 0:return[4,this.extractIterations(a)];case 1:return a=l.sent(),this.accumulatedGrads=a.map(function(g){return{originalName:g.name,variable:g.tensor.variable(!1)}}),[2]}})})},c.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},c.fromConfig=function(a,l){return new a(l.learningRate,l.initialAccumulatorValue)},c.className="Adagrad",c}(Je);Ie(ot);var vt=function(p){function c(a,l,g,_){_===void 0&&(_=null);var j=p.call(this)||this;return j.learningRate=a,j.beta1=l,j.beta2=g,j.epsilon=_,j.accumulatedFirstMoment=[],j.accumulatedSecondMoment=[],Fi(function(){j.accBeta1=fr(l).variable(),j.accBeta2=fr(g).variable()}),_==null&&(j.epsilon=Ve.backend.epsilon()),j}return J(c,p),c.prototype.applyGradients=function(a){var l=this,g=Array.isArray(a)?a.map(function(_){return _.name}):Object.keys(a);Fi(function(){var _=_o(1,l.accBeta1),j=_o(1,l.accBeta2);g.forEach(function(V,ne){var oe=Ve.registeredVariables[V];l.accumulatedFirstMoment[ne]==null&&(l.accumulatedFirstMoment[ne]={originalName:V+"/m",variable:Fi(function(){return ii(oe).variable(!1)})}),l.accumulatedSecondMoment[ne]==null&&(l.accumulatedSecondMoment[ne]={originalName:V+"/v",variable:Fi(function(){return ii(oe).variable(!1)})});var me=Array.isArray(a)?a[ne].tensor:a[V];if(me!=null){var Ee=l.accumulatedFirstMoment[ne].variable,_e=l.accumulatedSecondMoment[ne].variable,Ne=Ee.mul(l.beta1).add(me.mul(1-l.beta1)),Ue=_e.mul(l.beta2).add(me.square().mul(1-l.beta2)),$e=Ne.div(_),He=Ue.div(j);Ee.assign(Ne),_e.assign(Ue);var et=$e.div(He.sqrt().add(l.epsilon)).mul(-l.learningRate).add(oe);oe.assign(et)}}),l.accBeta1.assign(l.accBeta1.mul(l.beta1)),l.accBeta2.assign(l.accBeta2.mul(l.beta2))}),this.incrementIterations()},c.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&Na(this.accumulatedFirstMoment.map(function(a){return a.variable})),this.accumulatedSecondMoment!=null&&Na(this.accumulatedSecondMoment.map(function(a){return a.variable}))},c.prototype.getWeights=function(){return R(this,void 0,void 0,function(){var a;return P(this,function(l){switch(l.label){case 0:return a=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[l.sent()].concat(a.map(function(g){return{name:g.originalName,tensor:g.variable}}))]}})})},c.prototype.setWeights=function(a){return R(this,void 0,void 0,function(){var l,g=this;return P(this,function(_){switch(_.label){case 0:return[4,this.extractIterations(a)];case 1:return a=_.sent(),Fi(function(){g.accBeta1.assign(qs(g.beta1,g.iterations_+1)),g.accBeta2.assign(qs(g.beta2,g.iterations_+1))}),l=a.length/2,this.accumulatedFirstMoment=a.slice(0,l).map(function(j){return{originalName:j.name,variable:j.tensor.variable(!1)}}),this.accumulatedSecondMoment=a.slice(l,2*l).map(function(j){return{originalName:j.name,variable:j.tensor.variable(!1)}}),[2]}})})},c.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},c.fromConfig=function(a,l){return new a(l.learningRate,l.beta1,l.beta2,l.epsilon)},c.className="Adam",c}(Je);Ie(vt);var bt=function(p){function c(a,l,g,_,j){_===void 0&&(_=null),j===void 0&&(j=0);var V=p.call(this)||this;return V.learningRate=a,V.beta1=l,V.beta2=g,V.epsilon=_,V.decay=j,V.accumulatedFirstMoment=[],V.accumulatedWeightedInfNorm=[],Fi(function(){V.iteration=fr(0).variable(),V.accBeta1=fr(l).variable()}),_==null&&(V.epsilon=Ve.backend.epsilon()),V}return J(c,p),c.prototype.applyGradients=function(a){var l=this,g=Array.isArray(a)?a.map(function(_){return _.name}):Object.keys(a);Fi(function(){var _=_o(1,l.accBeta1),j=Xa(-l.learningRate,l.iteration.mul(l.decay).add(1));g.forEach(function(V,ne){var oe=Ve.registeredVariables[V];l.accumulatedFirstMoment[ne]==null&&(l.accumulatedFirstMoment[ne]={originalName:V+"/m",variable:ii(oe).variable(!1)}),l.accumulatedWeightedInfNorm[ne]==null&&(l.accumulatedWeightedInfNorm[ne]={originalName:V+"/v",variable:ii(oe).variable(!1)});var me=Array.isArray(a)?a[ne].tensor:a[V];if(me!=null){var Ee=l.accumulatedFirstMoment[ne].variable,_e=l.accumulatedWeightedInfNorm[ne].variable,Ne=Ee.mul(l.beta1).add(me.mul(1-l.beta1)),Ue=_e.mul(l.beta2),$e=me.abs(),He=Ue.maximum($e);Ee.assign(Ne),_e.assign(He);var et=j.div(_).mul(Ne.div(He.add(l.epsilon))).add(oe);oe.assign(et)}}),l.iteration.assign(l.iteration.add(1)),l.accBeta1.assign(l.accBeta1.mul(l.beta1))}),this.incrementIterations()},c.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&Na(this.accumulatedFirstMoment.map(function(a){return a.variable})),this.accumulatedWeightedInfNorm!=null&&Na(this.accumulatedWeightedInfNorm.map(function(a){return a.variable}))},c.prototype.getWeights=function(){return R(this,void 0,void 0,function(){return P(this,function(a){throw new Error("getWeights() is not implemented for Adamax yet.")})})},c.prototype.setWeights=function(a){return R(this,void 0,void 0,function(){return P(this,function(l){throw new Error("setWeights() is not implemented for Adamax yet.")})})},c.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},c.fromConfig=function(a,l){return new a(l.learningRate,l.beta1,l.beta2,l.epsilon,l.decay)},c.className="Adamax",c}(Je);Ie(bt);var wt=function(p){function c(a){var l=p.call(this)||this;return l.learningRate=a,l.setLearningRate(a),l}return J(c,p),c.prototype.applyGradients=function(a){var l=this;(Array.isArray(a)?a.map(function(g){return g.name}):Object.keys(a)).forEach(function(g,_){var j=Array.isArray(a)?a[_].tensor:a[g];if(j!=null){var V=Ve.registeredVariables[g];Fi(function(){var ne=l.c.mul(j).add(V);V.assign(ne)})}}),this.incrementIterations()},c.prototype.setLearningRate=function(a){this.learningRate=a,this.c!=null&&this.c.dispose(),this.c=Dh(fr(-a))},c.prototype.dispose=function(){this.c.dispose()},c.prototype.getWeights=function(){return R(this,void 0,void 0,function(){return P(this,function(a){switch(a.label){case 0:return[4,this.saveIterations()];case 1:return[2,[a.sent()]]}})})},c.prototype.setWeights=function(a){return R(this,void 0,void 0,function(){return P(this,function(l){switch(l.label){case 0:return[4,this.extractIterations(a)];case 1:if((a=l.sent()).length!==0)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},c.prototype.getConfig=function(){return{learningRate:this.learningRate}},c.fromConfig=function(a,l){return new a(l.learningRate)},c.className="SGD",c}(Je);Ie(wt);var Ft=function(p){function c(a,l,g){g===void 0&&(g=!1);var _=p.call(this,a)||this;return _.learningRate=a,_.momentum=l,_.useNesterov=g,_.accumulations=[],_.m=fr(_.momentum),_}return J(c,p),c.prototype.applyGradients=function(a){var l=this;(Array.isArray(a)?a.map(function(g){return g.name}):Object.keys(a)).forEach(function(g,_){var j=Ve.registeredVariables[g];l.accumulations[_]==null&&(l.accumulations[_]={originalName:g+"/momentum",variable:Fi(function(){return ii(j).variable(!1)})});var V=l.accumulations[_].variable,ne=Array.isArray(a)?a[_].tensor:a[g];ne!=null&&Fi(function(){var oe,me=l.m.mul(V).add(ne);oe=l.useNesterov?l.c.mul(ne.add(me.mul(l.m))).add(j):l.c.mul(me).add(j),V.assign(me),j.assign(oe)})}),this.incrementIterations()},c.prototype.dispose=function(){this.m.dispose(),this.accumulations!=null&&Na(this.accumulations.map(function(a){return a.variable}))},c.prototype.setMomentum=function(a){this.momentum=a},c.prototype.getWeights=function(){return R(this,void 0,void 0,function(){return P(this,function(a){switch(a.label){case 0:return[4,this.saveIterations()];case 1:return[2,[a.sent()].concat(this.accumulations.map(function(l){return{name:l.originalName,tensor:l.variable}}))]}})})},c.prototype.setWeights=function(a){return R(this,void 0,void 0,function(){return P(this,function(l){switch(l.label){case 0:return[4,this.extractIterations(a)];case 1:return a=l.sent(),this.accumulations=a.map(function(g){return{originalName:g.name,variable:g.tensor.variable(!1)}}),[2]}})})},c.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},c.fromConfig=function(a,l){return new a(l.learningRate,l.momentum,l.useNesterov)},c.className="Momentum",c}(wt);Ie(Ft);var Yt=function(p){function c(a,l,g,_,j){l===void 0&&(l=.9),g===void 0&&(g=0),_===void 0&&(_=null),j===void 0&&(j=!1);var V=p.call(this)||this;if(V.learningRate=a,V.decay=l,V.momentum=g,V.epsilon=_,V.accumulatedMeanSquares=[],V.accumulatedMoments=[],V.accumulatedMeanGrads=[],V.centered=j,_==null&&(V.epsilon=Ve.backend.epsilon()),a==null)throw new Error("learningRate for RMSPropOptimizer must be defined.");return V}return J(c,p),c.prototype.applyGradients=function(a){var l=this;(Array.isArray(a)?a.map(function(g){return g.name}):Object.keys(a)).forEach(function(g,_){var j=Ve.registeredVariables[g];l.accumulatedMeanSquares[_]==null&&(l.accumulatedMeanSquares[_]={originalName:g+"/rms",variable:Fi(function(){return ii(j).variable(!1)})}),l.accumulatedMoments[_]==null&&(l.accumulatedMoments[_]={originalName:g+"/momentum",variable:Fi(function(){return ii(j).variable(!1)})}),l.accumulatedMeanGrads[_]==null&&l.centered&&(l.accumulatedMeanGrads[_]={originalName:g+"/mg",variable:Fi(function(){return ii(j).variable(!1)})});var V=Array.isArray(a)?a[_].tensor:a[g];if(V!=null){var ne=l.accumulatedMeanSquares[_].variable,oe=l.accumulatedMoments[_].variable;Fi(function(){var me=ne.mul(l.decay).add(V.square().mul(1-l.decay));if(l.centered){var Ee=l.accumulatedMeanGrads[_].variable,_e=Ee.mul(l.decay).add(V.mul(1-l.decay)),Ne=oe.mul(l.momentum).add(V.mul(l.learningRate).div(me.sub(_e.square().add(l.epsilon)).sqrt()));ne.assign(me),Ee.assign(_e),oe.assign(Ne);var Ue=j.sub(Ne);j.assign(Ue)}else{var $e=ne.mul(l.decay).add(V.square().mul(1-l.decay));Ne=oe.mul(l.momentum).add(V.mul(l.learningRate).div($e.add(l.epsilon).sqrt())),ne.assign($e),oe.assign(Ne),Ue=j.sub(Ne),j.assign(Ue)}})}}),this.incrementIterations()},c.prototype.dispose=function(){this.accumulatedMeanSquares!=null&&Na(this.accumulatedMeanSquares.map(function(a){return a.variable})),this.accumulatedMeanGrads!=null&&this.centered&&Na(this.accumulatedMeanGrads.map(function(a){return a.variable})),this.accumulatedMoments!=null&&Na(this.accumulatedMoments.map(function(a){return a.variable}))},c.prototype.getWeights=function(){return R(this,void 0,void 0,function(){var a;return P(this,function(l){switch(l.label){case 0:return a=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&a.push.apply(a,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[l.sent()].concat(a.map(function(g){return{name:g.originalName,tensor:g.variable}}))]}})})},c.prototype.setWeights=function(a){return R(this,void 0,void 0,function(){var l;return P(this,function(g){switch(g.label){case 0:return[4,this.extractIterations(a)];case 1:return a=g.sent(),l=this.centered?a.length/3:a.length/2,this.accumulatedMeanSquares=a.slice(0,l).map(function(_){return{originalName:_.name,variable:_.tensor.variable(!1)}}),this.accumulatedMoments=a.slice(l,2*l).map(function(_){return{originalName:_.name,variable:_.tensor.variable(!1)}}),this.centered&&(this.accumulatedMeanGrads=a.slice(2*l,3*l).map(function(_){return{originalName:_.name,variable:_.tensor.variable(!1)}})),[2]}})})},c.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},c.fromConfig=function(a,l){return new a(l.learningRate,l.decay,l.momentum,l.epsilon,l.centered)},c.className="RMSProp",c}(Je);Ie(Yt);var an=function(){function p(){}return p.sgd=function(c){return new wt(c)},p.momentum=function(c,a,l){return l===void 0&&(l=!1),new Ft(c,a,l)},p.rmsprop=function(c,a,l,g,_){return a===void 0&&(a=.9),l===void 0&&(l=0),g===void 0&&(g=null),_===void 0&&(_=!1),new Yt(c,a,l,g,_)},p.adam=function(c,a,l,g){return c===void 0&&(c=.001),a===void 0&&(a=.9),l===void 0&&(l=.999),g===void 0&&(g=null),new vt(c,a,l,g)},p.adadelta=function(c,a,l){return c===void 0&&(c=.001),a===void 0&&(a=.95),l===void 0&&(l=null),new Qe(c,a,l)},p.adamax=function(c,a,l,g,_){return c===void 0&&(c=.002),a===void 0&&(a=.9),l===void 0&&(l=.999),g===void 0&&(g=null),_===void 0&&(_=0),new bt(c,a,l,g,_)},p.adagrad=function(c,a){return a===void 0&&(a=.1),new ot(c,a)},p}(),Jt={sgd:an.sgd,momentum:an.momentum,adadelta:an.adadelta,adagrad:an.adagrad,rmsprop:an.rmsprop,adamax:an.adamax,adam:an.adam},un=typeof requestAnimationFrame<"u"?requestAnimationFrame:B!==void 0?B:function(p){return p()};function gn(){return new Promise(function(p){return un(function(){return p()})})}jt.prototype.add=function(p){return eo(this,p)},jt.prototype.broadcastTo=function(p){return $l(this,p)},jt.prototype.div=function(p){return Xa(this,p)},jt.prototype.divNoNan=function(p){return Up(this,p)},jt.prototype.squaredDifference=function(p){return Gp(this,p)},jt.prototype.tile=function(p){return Kf(this,p)},jt.prototype.oneHot=function(p,c,a){return c===void 0&&(c=1),a===void 0&&(a=0),fc(this,p,c,a)},jt.prototype.transpose=function(p){return ft(this,p)},jt.prototype.pad=function(p,c){return Nu(this,p,c)},jt.prototype.batchNorm=function(p,c,a,l,g){return ql(this,p,c,a,l,g)},yt=Pn}).call(this,o(59),o(75),o(92).Buffer,o(207).setImmediate)},function(Oe,A,o){function b(It,Ot,pn){return It.fields=Ot||[],It.fname=pn,It}function H(It){return It==null?null:It.fname}function U(It){return It==null?null:It.fields}function B(It){return It.length===1?re(It[0]):J(It)}o.d(A,"a",function(){return ke}),o.d(A,"b",function(){return Ae}),o.d(A,"c",function(){return je}),o.d(A,"d",function(){return pe}),o.d(A,"e",function(){return Te}),o.d(A,"f",function(){return b}),o.d(A,"g",function(){return U}),o.d(A,"h",function(){return H}),o.d(A,"i",function(){return Sn}),o.d(A,"j",function(){return br}),o.d(A,"k",function(){return kn}),o.d(A,"l",function(){return Xn}),o.d(A,"m",function(){return hn}),o.d(A,"n",function(){return Xt}),o.d(A,"o",function(){return R}),o.d(A,"p",function(){return nn}),o.d(A,"q",function(){return Gn}),o.d(A,"r",function(){return Dn}),o.d(A,"s",function(){return K}),o.d(A,"t",function(){return Qr}),o.d(A,"u",function(){return $}),o.d(A,"v",function(){return ni}),o.d(A,"w",function(){return xr}),o.d(A,"x",function(){return L}),o.d(A,"y",function(){return ee}),o.d(A,"z",function(){return Mr}),o.d(A,"A",function(){return di}),o.d(A,"B",function(){return St}),o.d(A,"C",function(){return Yr}),o.d(A,"D",function(){return Xr}),o.d(A,"E",function(){return qn}),o.d(A,"F",function(){return fi}),o.d(A,"G",function(){return ai}),o.d(A,"H",function(){return zt}),o.d(A,"I",function(){return Oa}),o.d(A,"J",function(){return Wi}),o.d(A,"K",function(){return Ci}),o.d(A,"L",function(){return yt}),o.d(A,"M",function(){return at}),o.d(A,"N",function(){return jt}),o.d(A,"O",function(){return ge}),o.d(A,"P",function(){return we}),o.d(A,"Q",function(){return ue}),o.d(A,"R",function(){return ye}),o.d(A,"S",function(){return _t}),o.d(A,"T",function(){return xn}),o.d(A,"U",function(){return In}),o.d(A,"V",function(){return Yn}),o.d(A,"W",function(){return Pt}),o.d(A,"X",function(){return Lt}),o.d(A,"Y",function(){return fe}),o.d(A,"Z",function(){return Se}),o.d(A,"Aa",function(){return P}),o.d(A,"Ba",function(){return Ze}),o.d(A,"Ca",function(){return mt}),o.d(A,"Da",function(){return cn}),o.d(A,"Ea",function(){return Ye}),o.d(A,"Fa",function(){return An}),o.d(A,"Ga",function(){return Jn}),o.d(A,"Ha",function(){return Ln}),o.d(A,"Ia",function(){return ie}),o.d(A,"Ja",function(){return rn}),o.d(A,"Ka",function(){return Hn}),o.d(A,"La",function(){return Tt}),o.d(A,"Ma",function(){return F}),o.d(A,"Na",function(){return We}),o.d(A,"Oa",function(){return Pe}),o.d(A,"Pa",function(){return rt}),o.d(A,"Qa",function(){return Et});const re=It=>function(Ot){return Ot[It]},J=It=>{const Ot=It.length;return function(pn){for(let qt=0;qt<Ot;++qt)pn=pn[It[qt]];return pn}};function R(It){throw Error(It)}function P(It){const Ot=[],pn=It.length;let qt,Ve,jn,$n=null,Zn=0,ir="";function zr(){Ot.push(ir+It.substring(qt,Ve)),ir="",qt=Ve+1}for(It+="",qt=Ve=0;Ve<pn;++Ve)if((jn=It[Ve])==="\\")ir+=It.substring(qt,Ve),ir+=It.substring(++Ve,++Ve),qt=Ve;else if(jn===$n)zr(),$n=null,Zn=-1;else{if($n)continue;qt===Zn&&jn==='"'||qt===Zn&&jn==="'"?(qt=Ve+1,$n=jn):jn!=="."||Zn?jn==="["?(Ve>qt&&zr(),Zn=qt=Ve+1):jn==="]"&&(Zn||R("Access path missing open bracket: "+It),Zn>0&&zr(),Zn=0,qt=Ve+1):Ve>qt?zr():qt=Ve+1}return Zn&&R("Access path missing closing bracket: "+It),$n&&R("Access path missing closing quote: "+It),Ve>qt&&(Ve++,zr()),Ot}function $(It,Ot,pn){const qt=P(It);return It=qt.length===1?qt[0]:It,b((pn&&pn.get||B)(qt),[It],Ot||It)}const L=$("id"),ee=b(It=>It,[],"identity"),F=b(()=>0,[],"zero"),ue=b(()=>1,[],"one"),ie=b(()=>!0,[],"true"),K=b(()=>!1,[],"false");function he(It,Ot,pn){const qt=[Ot].concat([].slice.call(pn));console[It].apply(console,qt)}const pe=0,Ae=1,Te=2,je=3,ke=4;function at(It,Ot){let pn=It||pe;return{level(qt){return arguments.length?(pn=+qt,this):pn},error(){return pn>=Ae&&he(Ot||"error","ERROR",arguments),this},warn(){return pn>=Te&&he(Ot||"warn","WARN",arguments),this},info(){return pn>=je&&he(Ot||"log","INFO",arguments),this},debug(){return pn>=ke&&he(Ot||"log","DEBUG",arguments),this}}}var St=Array.isArray;function zt(It){return It===Object(It)}const $t=It=>It!=="__proto__";function we(...It){return It.reduce((Ot,pn)=>{for(const qt in pn)if(qt==="signals")Ot.signals=Gt(Ot.signals,pn.signals);else{const Ve=qt==="legend"?{layout:1}:qt==="style"||null;Tt(Ot,qt,pn[qt],Ve)}return Ot},{})}function Tt(It,Ot,pn,qt){if(!$t(Ot))return;let Ve,jn;if(zt(pn)&&!St(pn))for(Ve in jn=zt(It[Ot])?It[Ot]:It[Ot]={},pn)qt&&(qt===!0||qt[Ve])?Tt(jn,Ve,pn[Ve]):$t(Ve)&&(jn[Ve]=pn[Ve]);else It[Ot]=pn}function Gt(It,Ot){if(It==null)return Ot;const pn={},qt=[];function Ve(jn){pn[jn.name]||(pn[jn.name]=1,qt.push(jn))}return Ot.forEach(Ve),It.forEach(Ve),qt}function Pt(It){return It[It.length-1]}function Ye(It){return It==null||It===""?null:+It}const ln=It=>Ot=>It*Math.exp(Ot),Zt=It=>Ot=>Math.log(It*Ot),Bt=It=>Ot=>Math.sign(Ot)*Math.log1p(Math.abs(Ot/It)),Mt=It=>Ot=>Math.sign(Ot)*Math.expm1(Math.abs(Ot))*It,bn=It=>Ot=>Ot<0?-Math.pow(-Ot,It):Math.pow(Ot,It);function Dt(It,Ot,pn,qt){const Ve=pn(It[0]),jn=pn(Pt(It)),$n=(jn-Ve)*Ot;return[qt(Ve-$n),qt(jn-$n)]}function _t(It,Ot){return Dt(It,Ot,Ye,ee)}function xn(It,Ot){var pn=Math.sign(It[0]);return Dt(It,Ot,Zt(pn),ln(pn))}function In(It,Ot,pn){return Dt(It,Ot,bn(pn),bn(1/pn))}function Yn(It,Ot,pn){return Dt(It,Ot,Bt(pn),Mt(pn))}function fn(It,Ot,pn,qt,Ve){const jn=qt(It[0]),$n=qt(Pt(It)),Zn=Ot!=null?qt(Ot):(jn+$n)/2;return[Ve(Zn+(jn-Zn)*pn),Ve(Zn+($n-Zn)*pn)]}function We(It,Ot,pn){return fn(It,Ot,pn,Ye,ee)}function Pe(It,Ot,pn){const qt=Math.sign(It[0]);return fn(It,Ot,pn,Zt(qt),ln(qt))}function rt(It,Ot,pn,qt){return fn(It,Ot,pn,bn(qt),bn(1/qt))}function Et(It,Ot,pn,qt){return fn(It,Ot,pn,Bt(qt),Mt(qt))}function Lt(It){return 1+~~(new Date(It).getMonth()/3)}function rn(It){return 1+~~(new Date(It).getUTCMonth()/3)}function Sn(It){return It!=null?St(It)?It:[It]:[]}function kn(It,Ot,pn){let qt,Ve=It[0],jn=It[1];return jn<Ve&&(qt=jn,jn=Ve,Ve=qt),(qt=jn-Ve)>=pn-Ot?[Ot,pn]:[Ve=Math.min(Math.max(Ve,Ot),pn-qt),Ve+qt]}function qn(It){return typeof It=="function"}const xe="descending";function Xn(It,Ot,pn){pn=pn||{},Ot=Sn(Ot)||[];const qt=[],Ve=[],jn={},$n=pn.comparator||Cr;return Sn(It).forEach((Zn,ir)=>{Zn!=null&&(qt.push(Ot[ir]===xe?-1:1),Ve.push(Zn=qn(Zn)?Zn:$(Zn,null,pn)),(U(Zn)||[]).forEach(zr=>jn[zr]=1))}),Ve.length===0?null:b($n(Ve,qt),Object.keys(jn))}const br=(It,Ot)=>(It<Ot||It==null)&&Ot!=null?-1:(It>Ot||Ot==null)&&It!=null?1:(Ot=Ot instanceof Date?+Ot:Ot,(It=It instanceof Date?+It:It)!==It&&Ot==Ot?-1:Ot!=Ot&&It==It?1:0),Cr=(It,Ot)=>It.length===1?dr(It[0],Ot[0]):Rr(It,Ot,It.length),dr=(It,Ot)=>function(pn,qt){return br(It(pn),It(qt))*Ot},Rr=(It,Ot,pn)=>(Ot.push(0),function(qt,Ve){let jn,$n=0,Zn=-1;for(;$n===0&&++Zn<pn;)jn=It[Zn],$n=br(jn(qt),jn(Ve));return $n*Ot[Zn]});function hn(It){return qn(It)?It:()=>It}function Xt(It,Ot){let pn;return qt=>{pn&&clearTimeout(pn),pn=setTimeout(()=>(Ot(qt),pn=null),It)}}function nn(It){for(let Ot,pn,qt=1,Ve=arguments.length;qt<Ve;++qt)for(pn in Ot=arguments[qt])It[pn]=Ot[pn];return It}function Gn(It,Ot){let pn,qt,Ve,jn,$n=0;if(It&&(pn=It.length))if(Ot==null){for(qt=It[$n];$n<pn&&(qt==null||qt!=qt);qt=It[++$n]);for(Ve=jn=qt;$n<pn;++$n)(qt=It[$n])!=null&&(qt<Ve&&(Ve=qt),qt>jn&&(jn=qt))}else{for(qt=Ot(It[$n]);$n<pn&&(qt==null||qt!=qt);qt=Ot(It[++$n]));for(Ve=jn=qt;$n<pn;++$n)(qt=Ot(It[$n]))!=null&&(qt<Ve&&(Ve=qt),qt>jn&&(jn=qt))}return[Ve,jn]}function Dn(It,Ot){const pn=It.length;let qt,Ve,jn,$n,Zn,ir=-1;if(Ot==null){for(;++ir<pn;)if((Ve=It[ir])!=null&&Ve>=Ve){qt=jn=Ve;break}if(ir===pn)return[-1,-1];for($n=Zn=ir;++ir<pn;)(Ve=It[ir])!=null&&(qt>Ve&&(qt=Ve,$n=ir),jn<Ve&&(jn=Ve,Zn=ir))}else{for(;++ir<pn;)if((Ve=Ot(It[ir],ir,It))!=null&&Ve>=Ve){qt=jn=Ve;break}if(ir===pn)return[-1,-1];for($n=Zn=ir;++ir<pn;)(Ve=Ot(It[ir],ir,It))!=null&&(qt>Ve&&(qt=Ve,$n=ir),jn<Ve&&(jn=Ve,Zn=ir))}return[$n,Zn]}const mr=Object.prototype.hasOwnProperty;function xr(It,Ot){return mr.call(It,Ot)}const gr={};function Qr(It){let Ot,pn={};function qt(jn){return xr(pn,jn)&&pn[jn]!==gr}const Ve={size:0,empty:0,object:pn,has:qt,get:jn=>qt(jn)?pn[jn]:void 0,set(jn,$n){return qt(jn)||(++Ve.size,pn[jn]===gr&&--Ve.empty),pn[jn]=$n,this},delete(jn){return qt(jn)&&(--Ve.size,++Ve.empty,pn[jn]=gr),this},clear(){Ve.size=Ve.empty=0,Ve.object=pn={}},test(jn){return arguments.length?(Ot=jn,Ve):Ot},clean(){const jn={};let $n=0;for(const Zn in pn){const ir=pn[Zn];ir===gr||Ot&&Ot(ir)||(jn[Zn]=ir,++$n)}Ve.size=$n,Ve.empty=0,Ve.object=pn=jn}};return It&&Object.keys(It).forEach(jn=>{Ve.set(jn,It[jn])}),Ve}function ni(It,Ot,pn,qt,Ve,jn){if(!pn&&pn!==0)return jn;const $n=+pn;let Zn,ir=It[0],zr=Pt(It);zr<ir&&(Zn=ir,ir=zr,zr=Zn),Zn=Math.abs(Ot-ir);const vr=Math.abs(zr-Ot);return Zn<vr&&Zn<=$n?qt:vr<=$n?Ve:jn}function Mr(It,Ot,pn){const qt=It.prototype=Object.create(Ot.prototype);return Object.defineProperty(qt,"constructor",{value:It,writable:!0,enumerable:!0,configurable:!0}),nn(qt,pn)}function di(It,Ot,pn,qt){let Ve,jn=Ot[0],$n=Ot[Ot.length-1];return jn>$n&&(Ve=jn,jn=$n,$n=Ve),pn=pn===void 0||pn,qt=qt===void 0||qt,(pn?jn<=It:jn<It)&&(qt?It<=$n:It<$n)}function Yr(It){return typeof It=="boolean"}function Xr(It){return Object.prototype.toString.call(It)==="[object Date]"}function fi(It){return It&&qn(It[Symbol.iterator])}function ai(It){return typeof It=="number"}function Oa(It){return Object.prototype.toString.call(It)==="[object RegExp]"}function Wi(It){return typeof It=="string"}function Ci(It,Ot,pn){It&&(It=Ot?Sn(It).map(Zn=>Zn.replace(/\\(.)/g,"$1")):Sn(It));const qt=It&&It.length,Ve=pn&&pn.get||B,jn=Zn=>Ve(Ot?[Zn]:P(Zn));let $n;if(qt)if(qt===1){const Zn=jn(It[0]);$n=function(ir){return""+Zn(ir)}}else{const Zn=It.map(jn);$n=function(ir){let zr=""+Zn[0](ir),vr=0;for(;++vr<qt;)zr+="|"+Zn[vr](ir);return zr}}else $n=function(){return""};return b($n,It,"key")}function yt(It,Ot){const pn=It[0],qt=Pt(It),Ve=+Ot;return Ve?Ve===1?qt:pn+Ve*(qt-pn):pn}const Lr=1e4;function jt(It){let Ot,pn,qt;It=+It||Lr;const Ve=()=>{Ot={},pn={},qt=0},jn=($n,Zn)=>(++qt>It&&(pn=Ot,Ot={},qt=1),Ot[$n]=Zn);return Ve(),{clear:Ve,has:$n=>xr(Ot,$n)||xr(pn,$n),get:$n=>xr(Ot,$n)?Ot[$n]:xr(pn,$n)?jn($n,pn[$n]):void 0,set:($n,Zn)=>xr(Ot,$n)?Ot[$n]=Zn:jn($n,Zn)}}function ge(It,Ot,pn,qt){const Ve=Ot.length,jn=pn.length;if(!jn)return Ot;if(!Ve)return pn;const $n=qt||new Ot.constructor(Ve+jn);let Zn=0,ir=0,zr=0;for(;Zn<Ve&&ir<jn;++zr)$n[zr]=It(Ot[Zn],pn[ir])>0?pn[ir++]:Ot[Zn++];for(;Zn<Ve;++Zn,++zr)$n[zr]=Ot[Zn];for(;ir<jn;++ir,++zr)$n[zr]=pn[ir];return $n}function fe(It,Ot){let pn="";for(;--Ot>=0;)pn+=It;return pn}function ye(It,Ot,pn,qt){const Ve=pn||" ",jn=It+"",$n=Ot-jn.length;return $n<=0?jn:qt==="left"?fe(Ve,$n)+jn:qt==="center"?fe(Ve,~~($n/2))+jn+fe(Ve,Math.ceil($n/2)):jn+fe(Ve,$n)}function Se(It){return It&&Pt(It)-It[0]||0}function Ze(It){return St(It)?"["+It.map(Ze)+"]":zt(It)||Wi(It)?JSON.stringify(It).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):It}function mt(It){return It==null||It===""?null:!(!It||It==="false"||It==="0")&&!!It}const Rt=It=>ai(It)||Xr(It)?It:Date.parse(It);function cn(It,Ot){return Ot=Ot||Rt,It==null||It===""?null:Ot(It)}function Jn(It){return It==null||It===""?null:It+""}function An(It){const Ot={},pn=It.length;for(let qt=0;qt<pn;++qt)Ot[It[qt]]=!0;return Ot}function Ln(It,Ot,pn,qt){const Ve=qt??"",jn=It+"",$n=jn.length,Zn=Math.max(0,Ot-Ve.length);return $n<=Ot?jn:pn==="left"?Ve+jn.slice($n-Zn):pn==="center"?jn.slice(0,Math.ceil(Zn/2))+Ve+jn.slice($n-~~(Zn/2)):jn.slice(0,Zn)+Ve}function Hn(It,Ot,pn){if(It)if(Ot){const qt=It.length;for(let Ve=0;Ve<qt;++Ve){const jn=Ot(It[Ve]);jn&&pn(jn,Ve,It)}}else It.forEach(pn)}},function(Oe,A,o){o.r(A);var b=o(0),H=function(Z,G){return(H=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(C,N){C.__proto__=N}||function(C,N){for(var te in N)N.hasOwnProperty(te)&&(C[te]=N[te])})(Z,G)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U(Z,G){function C(){this.constructor=Z}H(Z,G),Z.prototype=G===null?Object.create(G):(C.prototype=G.prototype,new C)}var B,re=function(){return(re=Object.assign||function(Z){for(var G,C=1,N=arguments.length;C<N;C++)for(var te in G=arguments[C])Object.prototype.hasOwnProperty.call(G,te)&&(Z[te]=G[te]);return Z}).apply(this,arguments)};function J(Z,G,C,N){return new(C||(C=Promise))(function(te,Be){function Ge(Ut){try{Nt(N.next(Ut))}catch(ct){Be(ct)}}function ft(Ut){try{Nt(N.throw(Ut))}catch(ct){Be(ct)}}function Nt(Ut){Ut.done?te(Ut.value):new C(function(ct){ct(Ut.value)}).then(Ge,ft)}Nt((N=N.apply(Z,[])).next())})}function R(Z,G){var C,N,te,Be,Ge={label:0,sent:function(){if(1&te[0])throw te[1];return te[1]},trys:[],ops:[]};return Be={next:ft(0),throw:ft(1),return:ft(2)},typeof Symbol=="function"&&(Be[Symbol.iterator]=function(){return this}),Be;function ft(Nt){return function(Ut){return function(ct){if(C)throw new TypeError("Generator is already executing.");for(;Ge;)try{if(C=1,N&&(te=2&ct[0]?N.return:ct[0]?N.throw||((te=N.return)&&te.call(N),0):N.next)&&!(te=te.call(N,ct[1])).done)return te;switch(N=0,te&&(ct=[2&ct[0],te.value]),ct[0]){case 0:case 1:te=ct;break;case 4:return Ge.label++,{value:ct[1],done:!1};case 5:Ge.label++,N=ct[1],ct=[0];continue;case 7:ct=Ge.ops.pop(),Ge.trys.pop();continue;default:if(!(te=(te=Ge.trys).length>0&&te[te.length-1])&&(ct[0]===6||ct[0]===2)){Ge=0;continue}if(ct[0]===3&&(!te||ct[1]>te[0]&&ct[1]<te[3])){Ge.label=ct[1];break}if(ct[0]===6&&Ge.label<te[1]){Ge.label=te[1],te=ct;break}if(te&&Ge.label<te[2]){Ge.label=te[2],Ge.ops.push(ct);break}te[2]&&Ge.ops.pop(),Ge.trys.pop();continue}ct=G.call(Z,Ge)}catch(yn){ct=[6,yn],N=0}finally{C=te=0}if(5&ct[0])throw ct[1];return{value:ct[0]?ct[1]:void 0,done:!0}}([Nt,Ut])}}}function P(){return B==null&&(B=Object(b.backend)().epsilon()),B}var $=function(Z){function G(C){var N=Z.call(this,C)||this;return Object.setPrototypeOf(N,G.prototype),N}return U(G,Z),G}(Error),L=function(Z){function G(C){var N=Z.call(this,C)||this;return Object.setPrototypeOf(N,G.prototype),N}return U(G,Z),G}(Error),ee=function(Z){function G(C){var N=Z.call(this,C)||this;return Object.setPrototypeOf(N,G.prototype),N}return U(G,Z),G}(Error),F=function(Z){function G(C){var N=Z.call(this,C)||this;return Object.setPrototypeOf(N,G.prototype),N}return U(G,Z),G}(Error),ue=function(Z){function G(C){var N=Z.call(this,C)||this;return Object.setPrototypeOf(N,G.prototype),N}return U(G,Z),G}(Error);(function(Z){function G(C){var N=Z.call(this,C)||this;return Object.setPrototypeOf(N,G.prototype),N}U(G,Z)})(Error);function ie(Z,G){if(Array.isArray(Z)){for(var C=[],N=0;N<G;N++)C=C.concat(Z);return C}return(C=new Array(G)).fill(Z),C}function K(Z,G){if(!Z)throw new ue(G)}function he(Z,G){for(var C=0,N=0,te=Z;N<te.length;N++)te[N]===G&&C++;return C}function pe(Z){return Z.length===1?Z[0]:Z}function Ae(Z){return Array.isArray(Z)?Z:[Z]}function Te(Z){var G=Z.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return G[0]!=="_"?G:"private"+G}function je(Z){return Z.length<=1||Z.indexOf("_")===-1?Z:Z.replace(/[_]+(\w|$)/g,function(G,C){return C.toUpperCase()})}var ke={};function at(Z){if(Z==null)return null;var G={};return G.className=Z.getClassName(),G.config=Z.getConfig(),G}function St(Z,G,C,N,te){var Be,Ge,ft;if(G===void 0&&(G={}),C===void 0&&(C={}),N===void 0&&(N="object"),te===void 0&&(te=!1),typeof Z=="string"){var Nt=Z,Ut=void 0;if(Nt in C)Ut=C[Nt];else if(Nt in ke)Ut=ke[Nt];else if((Ut=G[Nt])==null)throw new ee("Unknown "+N+": "+Z+`. This may be due to one of the following reasons:
1. The `+N+` is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom `+N+" is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().");return Ut}var ct=Z;if(ct.className==null||ct.config==null)throw new ee(N+": Improper config format: "+JSON.stringify(ct)+`.
'className' and 'config' must set.`);var yn=ct.className,_n=void 0,Nn=void 0;if(yn in C?(_n=(Be=C[yn])[0],Nn=Be[1]):yn in ke?(_n=(Ge=ke.className)[0],Nn=Ge[1]):yn in G&&(_n=(ft=G[yn])[0],Nn=ft[1]),_n==null)throw new ee("Unknown "+N+": "+yn+`. This may be due to one of the following reasons:
1. The `+N+` is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom `+N+" is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().");if(Nn!=null){for(var Wn={},Mn=0,tr=Object.keys(ke);Mn<tr.length;Mn++)Wn[Hr=tr[Mn]]=ke[Hr];for(var rr=0,hr=Object.keys(C);rr<hr.length;rr++)Wn[Hr=hr[rr]]=C[Hr];ct.config.customObjects=Wn;for(var Nr=re({},ke),Vr=0,wr=Object.keys(C);Vr<wr.length;Vr++){var Hr=wr[Vr];ke[Hr]=C[Hr]}(function $r(Zr){if(Zr!=null&&typeof Zr=="object")if(Array.isArray(Zr))Zr.forEach(function(ra){return $r(ra)});else for(var pa=0,ea=Object.keys(Zr);pa<ea.length;pa++){var La=ea[pa],Ii=Zr[La];Ii!=null&&typeof Ii=="object"&&(Array.isArray(Ii)||Ii.type!=="ndarray"||typeof Ii.value!="number"?$r(Ii):Zr[La]=Ii.value)}})(ct.config);var Wr=Nn(_n,ct.config,C,te);return ke=re({},Nr),Wr}Nr=re({},ke);for(var oi=0,li=Object.keys(C);oi<li.length;oi++)Hr=li[oi],ke[Hr]=C[Hr];return Wr=new _n(ct.config),ke=re({},Nr),Wr}function zt(Z,G){return-1*function(C,N){return C<N?-1:C>N?1:0}(Z,G)}function $t(Z){if(Z==null)return Z;for(var G=[],C=0,N=Z;C<N.length;C++){var te=N[C];G.indexOf(te)===-1&&G.push(te)}return G}function we(Z){if(Z==null)throw new ee("Invalid value in obj: "+JSON.stringify(Z));for(var G in Z)if(Z.hasOwnProperty(G))return!1;return!0}function Tt(Z,G,C){if(C!=null&&Z.indexOf(C)<0)throw new ee(C+" is not a valid "+G+".  Valid values are "+Z+" or null/undefined.")}function Gt(Z,G,C,N){return N===void 0&&(N=1/0),K(C>=0),K(N>=C),Array.isArray(Z)&&Z.length>=C&&Z.length<=N&&Z.every(function(te){return typeof te===G})}function Pt(Z,G){Array.isArray(Z)?(b.util.assert(Z.length>0,function(){return G+" is unexpectedly an empty array."}),Z.forEach(function(C,N){return Pt(C,"element "+(N+1)+" of "+G)})):b.util.assert(Number.isInteger(Z)&&Z>0,function(){return"Expected "+G+" to be a positive integer, but got "+function C(N){return N===null?"null":Array.isArray(N)?"["+N.map(function(te){return C(te)}).join(",")+"]":typeof N=="string"?'"'+N+'"':""+N}(Z)+"."})}function Ye(Z){return Z==="relu"?"relu":Z==="linear"?"linear":Z==="elu"?"elu":null}function ln(Z,G){return Object(b.tidy)(function(){return Object(b.sqrt)(Object(b.sum)(Object(b.mulStrict)(Z,Z),G,!0))})}var Zt=function(Z){function G(){return Z!==null&&Z.apply(this,arguments)||this}return U(G,Z),G.prototype.getConfig=function(){return{}},G}(b.serialization.Serializable),Bt=function(Z){function G(C){var N=Z.call(this)||this;return N.defaultMaxValue=2,N.defaultAxis=0,N.maxValue=C.maxValue!=null?C.maxValue:N.defaultMaxValue,N.axis=C.axis!=null?C.axis:N.defaultAxis,N}return U(G,Z),G.prototype.apply=function(C){var N=this;return Object(b.tidy)(function(){var te=ln(C,N.axis),Be=Object(b.clipByValue)(te,0,N.maxValue);return Object(b.mul)(C,Object(b.div)(Be,Object(b.add)(P(),te)))})},G.prototype.getConfig=function(){return{maxValue:this.maxValue,axis:this.axis}},G.className="MaxNorm",G}(Zt);b.serialization.registerClass(Bt);var Mt=function(Z){function G(C){var N=Z.call(this)||this;return N.defaultAxis=0,N.axis=C.axis!=null?C.axis:N.defaultAxis,N}return U(G,Z),G.prototype.apply=function(C){var N=this;return Object(b.tidy)(function(){return Object(b.div)(C,Object(b.add)(P(),ln(C,N.axis)))})},G.prototype.getConfig=function(){return{axis:this.axis}},G.className="UnitNorm",G}(Zt);b.serialization.registerClass(Mt);var bn=function(Z){function G(){return Z!==null&&Z.apply(this,arguments)||this}return U(G,Z),G.prototype.apply=function(C){return Object(b.relu)(C)},G.className="NonNeg",G}(Zt);b.serialization.registerClass(bn);var Dt=function(Z){function G(C){var N=Z.call(this)||this;return N.defaultMinValue=0,N.defaultMaxValue=1,N.defaultRate=1,N.defaultAxis=0,N.minValue=C.minValue!=null?C.minValue:N.defaultMinValue,N.maxValue=C.maxValue!=null?C.maxValue:N.defaultMaxValue,N.rate=C.rate!=null?C.rate:N.defaultRate,N.axis=C.axis!=null?C.axis:N.defaultAxis,N}return U(G,Z),G.prototype.apply=function(C){var N=this;return Object(b.tidy)(function(){var te=ln(C,N.axis),Be=Object(b.add)(Object(b.mul)(N.rate,Object(b.clipByValue)(te,N.minValue,N.maxValue)),Object(b.mul)(1-N.rate,te));return Object(b.mul)(C,Object(b.div)(Be,Object(b.add)(P(),te)))})},G.prototype.getConfig=function(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}},G.className="MinMaxNorm",G}(Zt);b.serialization.registerClass(Dt);var _t={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function xn(Z){return at(Z)}function In(Z,G){return G===void 0&&(G={}),St(Z,b.serialization.SerializationMap.getMap().classNameMap,G,"constraint")}function Yn(Z){return Z==null?null:typeof Z=="string"?In({className:Z in _t?_t[Z]:Z,config:{}}):Z instanceof Zt?Z:In(Z)}var fn=Object.freeze({maxNorm:function(Z){return new Bt(Z)},unitNorm:function(Z){return new Mt(Z)},nonNeg:function(){return new bn},minMaxNorm:function(Z){return new Dt(Z)}}),We=["channelsFirst","channelsLast"],Pe=["valid","same","causal"],rt=["max","avg"],Et=["sum","mul","concat","ave"],Lt=new Map;function rn(Z){Tt(We,"DataFormat",Z)}function Sn(Z){Tt(Pe,"PaddingMode",Z)}function kn(Z){Tt(rt,"PoolMode",Z)}var qn=[],xe="/";function Xn(Z,G){qn.push(Z);try{var C=G();return qn.pop(),C}catch(N){throw qn.pop(),N}}function br(Z){if(!Rr(Z))throw new Error("Not a valid tensor name: '"+Z+"'");return(qn.length===0?"":qn.join(xe)+xe)+Z}function Cr(Z){if(!Rr(Z))throw new Error("Not a valid tensor name: '"+Z+"'");Lt.has(Z)||Lt.set(Z,0);var G=Lt.get(Z);if(Lt.set(Z,Lt.get(Z)+1),G>0){var C=Z+"_"+G;return Lt.set(C,1),C}return Z}var dr=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function Rr(Z){return!!Z.match(dr)}function hn(Z){return Z===parseInt(Z.toString(),10)}function Xt(Z,G,C){G==null&&(G=0),C==null&&(C=Z.length);for(var N=1,te=G;te<C;++te)N*=Z[te];return N}function nn(Z){return Z=Array.isArray(Z)?new Float32Array(Z):Z,Object(b.tensor1d)(Z)}function Gn(Z){return Object(b.min)(nn(Z)).dataSync()[0]}function Dn(Z){return Object(b.max)(nn(Z)).dataSync()[0]}function mr(Z,G){if(G<Z)throw new ee("end ("+G+") < begin ("+Z+") is forbidden.");for(var C=[],N=Z;N<G;++N)C.push(N);return C}function xr(Z,G){return Z.asType(G)}function gr(Z,G){G===void 0&&(G=-1);var C=Z.shape.slice();return G<0&&(G=C.length+G+1),C.splice(G,0,1),Z.reshape(C)}function Qr(Z,G,C){return Object(b.tidy)(function(){switch(Z.rank){case 1:return Object(b.slice1d)(Z,G,C);case 2:return Object(b.slice2d)(Z,[G,0],[C,Z.shape[1]]);case 3:return Object(b.slice3d)(Z,[G,0,0],[C,Z.shape[1],Z.shape[2]]);case 4:return Object(b.slice4d)(Z,[G,0,0,0],[C,Z.shape[1],Z.shape[2],Z.shape[3]]);case 5:return Object(b.slice)(Z,[G,0,0,0,0],[C,Z.shape[1],Z.shape[2],Z.shape[3],Z.shape[4]]);case 6:return Object(b.slice)(Z,[G,0,0,0,0,0],[C,Z.shape[1],Z.shape[2],Z.shape[3],Z.shape[4],Z.shape[5]]);default:throw new ee("sliceAlongFirstAxis() received an unsupported tensor rank: "+Z.rank)}})}function ni(Z,G,C){return Object(b.tidy)(function(){switch(Z.rank){case 1:return Object(b.slice1d)(Z,G,C);case 2:return Object(b.slice2d)(Z,[0,G],[Z.shape[0],C]);case 3:return Object(b.slice3d)(Z,[0,0,G],[Z.shape[0],Z.shape[1],C]);case 4:return Object(b.slice4d)(Z,[0,0,0,G],[Z.shape[0],Z.shape[1],Z.shape[2],C]);default:throw new ee("sliceAlongLastAxis() received an unsupported tensor rank: "+Z.rank)}})}function Mr(Z,G,C,N){return Object(b.tidy)(function(){switch(Z.rank){case 1:return Object(b.slice1d)(Z,G,C);case 2:switch(N){case 1:return Qr(Z,G,C);case 2:return ni(Z,G,C);default:throw new ee("The axis is not within the rank of the tensor "+N)}case 3:switch(N){case 1:return Qr(Z,G,C);case 2:return Object(b.slice3d)(Z,[0,G,0],[Z.shape[0],C,Z.shape[2]]);case 3:return ni(Z,G,C);default:throw new ee("The axis is not within the rank of the tensor "+N)}case 4:switch(N){case 1:return Qr(Z,G,C);case 2:return Object(b.slice4d)(Z,[0,G,0,0],[Z.shape[0],C,Z.shape[2],Z.shape[3]]);case 3:return Object(b.slice4d)(Z,[0,0,G,0],[Z.shape[0],Z.shape[1],C,Z.shape[3]]);case 4:return ni(Z,G,C);default:throw new ee("The axis is not within the rank of the tensor "+N)}default:throw new ee("sliceAlongLastAxis() received an unsupported tensor rank: "+Z.rank)}})}function di(Z,G){var C;return G===void 0&&(G=-1),G<0&&(G=(C=Z[0].rank)!==0?C:0),G===Z[0].rank&&(G=-1),Object(b.concat)(Z,G)}function Yr(Z,G){switch(Z.rank){case 1:return Object(b.concat1d)([Z,G]);case 2:return Object(b.concat2d)([Z,G],0);case 3:return Object(b.concat3d)([Z,G],0);case 4:return Object(b.concat4d)([Z,G],0);default:throw new ee("concatAlongFirstAxis() received an unsupported tensor rank: "+Z.rank)}}function Xr(Z,G){if(Array.isArray(G)||(G=[G]),Z.rank!==G.length)throw new ee("The length of input n ("+G.length+") does not match the number of dimensions in input x ("+Z.rank+")");return Object(b.tile)(Z,G)}function fi(Z,G,C,N,te){return G===void 0&&(G=0),C===void 0&&(C=1),Object(b.randomNormal)(Z,G,C,N,te)}function ai(Z,G,C,N){if(Z.rank<2||G.rank<2)throw new F("dot requires both inputs to be rank >= 2 but got x shape = "+Z.shape+" and y shape = "+G.shape);if(G.rank>=3&&Z.shape.slice(-1)[0]!==(ct=G.shape.slice(-2)[0]))throw new F("If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = "+Z.shape+" and  y shape = "+G.shape);if(Z.rank===2&&G.rank===2){var te=!1,Be=!1;return b.fused.matMul({a:Z,b:G,transposeA:te,transposeB:Be,bias:N?Ci(Z.rank,N,"channelsLast"):null,activation:C})}var Ge=Z.shape.slice(),ft=Ge.pop();Z=Z.reshape([-1,ft]);var Nt=G.shape.slice(),Ut=Nt.pop(),ct=Nt.pop(),yn=Nt.concat([Ut]),_n=Array.from({length:G.rank},function(Wn,Mn){return Mn===0?G.rank-2:Mn<=G.rank-2?Mn-1:Mn});G=G.transpose(_n).reshape([ct,-1]);var Nn=Ge.concat(yn);return te=!1,Be=!1,b.fused.matMul({a:Z,b:G,transposeA:te,transposeB:Be,bias:N?Ci(Z.rank,N,"channelsLast"):null,activation:C}).reshape(Nn)}function Oa(Z,G,C){return Object(b.tidy)(function(){return G=Array.isArray(G)?Object(b.tensor1d)(G,"int32"):G.toInt(),Object(b.gather)(Z,G,C)})}function Wi(Z){return Object(b.mulStrict)(Z,Z)}function Ci(Z,G,C){var N=G.shape;if(G.rank!==1&&G.rank!==Z)throw new ee("Unexpected bias dimensions: "+G.rank+"; expected it to be 1 or "+Z);if(Z===5){if(C==="channelsFirst")return N.length===1?G.reshape([1,N[0],1,1,1]):G.reshape([1,N[3],N[0],N[1],N[2]]);if(C==="channelsLast")return N.length===1?G.reshape([1,1,1,1,N[0]]):G.reshape([1].concat(N))}else if(Z===4){if(C==="channelsFirst")return N.length===1?G.reshape([1,N[0],1,1]):G.reshape([1,N[2],N[0],N[1]]);if(C==="channelsLast")return N.length===1?G.reshape([1,1,1,N[0]]):G.reshape([1].concat(N))}else if(Z===3){if(C==="channelsFirst")return N.length===1?G.reshape([1,N[0],1]):G.reshape([1,N[1],N[0]]);if(C==="channelsLast")return N.length===1?G.reshape([1,1,N[0]]):G.reshape([1].concat(N))}else if(Z<3)return G;throw new ee("Unsupported input rank by biasAdd: "+G.rank)}function yt(Z,G,C){return Object(b.tidy)(function(){return C==null&&(C="channelsLast"),rn(C),Z.add(Ci(Z.rank,G,C))})}function Lr(Z,G,C,N){return Object(b.tidy)(function(){return Object(b.dropout)(Z,G,C,N)})}function jt(Z,G,C){return C===void 0&&(C=!1),C?Z():G()}var ge=["fanIn","fanOut","fanAvg"],fe=["normal","uniform","truncatedNormal"],ye=function(Z){function G(){return Z!==null&&Z.apply(this,arguments)||this}return U(G,Z),G.prototype.fromConfigUsesCustomObjects=function(){return!1},G.prototype.getConfig=function(){return{}},G}(b.serialization.Serializable),Se=function(Z){function G(){return Z!==null&&Z.apply(this,arguments)||this}return U(G,Z),G.prototype.apply=function(C,N){return Object(b.zeros)(C,N)},G.className="Zeros",G}(ye);b.serialization.registerClass(Se);var Ze=function(Z){function G(){return Z!==null&&Z.apply(this,arguments)||this}return U(G,Z),G.prototype.apply=function(C,N){return Object(b.ones)(C,N)},G.className="Ones",G}(ye);b.serialization.registerClass(Ze);var mt=function(Z){function G(C){var N=Z.call(this)||this;if(typeof C!="object")throw new ee("Expected argument of type ConstantConfig but got "+C);if(C.value===void 0)throw new ee("config must have value set but got "+C);return N.value=C.value,N}return U(G,Z),G.prototype.apply=function(C,N){var te=this;return Object(b.tidy)(function(){return Object(b.mul)(Object(b.scalar)(te.value),Object(b.ones)(C,N))})},G.prototype.getConfig=function(){return{value:this.value}},G.className="Constant",G}(ye);b.serialization.registerClass(mt);var Rt=function(Z){function G(C){var N=Z.call(this)||this;return N.DEFAULT_MINVAL=-.05,N.DEFAULT_MAXVAL=.05,N.minval=C.minval||N.DEFAULT_MINVAL,N.maxval=C.maxval||N.DEFAULT_MAXVAL,N.seed=C.seed,N}return U(G,Z),G.prototype.apply=function(C,N){return Object(b.randomUniform)(C,this.minval,this.maxval,N)},G.prototype.getConfig=function(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}},G.className="RandomUniform",G}(ye);b.serialization.registerClass(Rt);var cn=function(Z){function G(C){var N=Z.call(this)||this;return N.DEFAULT_MEAN=0,N.DEFAULT_STDDEV=.05,N.mean=C.mean||N.DEFAULT_MEAN,N.stddev=C.stddev||N.DEFAULT_STDDEV,N.seed=C.seed,N}return U(G,Z),G.prototype.apply=function(C,N){if((N=N||"float32")!=="float32"&&N!=="int32")throw new F("randomNormal does not support dType "+N+".");return fi(C,this.mean,this.stddev,N,this.seed)},G.prototype.getConfig=function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}},G.className="RandomNormal",G}(ye);b.serialization.registerClass(cn);var Jn=function(Z){function G(C){var N=Z.call(this)||this;return N.DEFAULT_MEAN=0,N.DEFAULT_STDDEV=.05,N.mean=C.mean||N.DEFAULT_MEAN,N.stddev=C.stddev||N.DEFAULT_STDDEV,N.seed=C.seed,N}return U(G,Z),G.prototype.apply=function(C,N){if((N=N||"float32")!=="float32"&&N!=="int32")throw new F("truncatedNormal does not support dType "+N+".");return Object(b.truncatedNormal)(C,this.mean,this.stddev,N,this.seed)},G.prototype.getConfig=function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}},G.className="TruncatedNormal",G}(ye);b.serialization.registerClass(Jn);var An=function(Z){function G(C){var N=Z.call(this)||this;return N.gain=C.gain!=null?C.gain:1,N}return U(G,Z),G.prototype.apply=function(C,N){var te=this;return Object(b.tidy)(function(){if(C.length!==2||C[0]!==C[1])throw new ee("Identity matrix initializer can only be used for 2D square matrices.");return Object(b.mul)(te.gain,Object(b.eye)(C[0]))})},G.prototype.getConfig=function(){return{gain:this.gain}},G.className="Identity",G}(ye);b.serialization.registerClass(An);var Ln=function(Z){function G(C){var N=Z.call(this)||this;if(C.scale<0)throw new ee("scale must be a positive float. Got: "+C.scale);return N.scale=C.scale==null?1:C.scale,N.mode=C.mode==null?"fanIn":C.mode,function(te){Tt(ge,"FanMode",te)}(N.mode),N.distribution=C.distribution==null?"normal":C.distribution,function(te){Tt(fe,"Distribution",te)}(N.distribution),N.seed=C.seed,N}return U(G,Z),G.prototype.apply=function(C,N){var te=function(ct,yn){var _n,Nn;if(yn===void 0&&(yn="channelsLast"),rn(yn),ct.length===2)_n=ct[0],Nn=ct[1];else if([3,4,5].indexOf(ct.length)!==-1)if(yn==="channelsFirst"){var Wn=Xt(ct,2);_n=ct[1]*Wn,Nn=ct[0]*Wn}else yn==="channelsLast"&&(Wn=Xt(ct,0,ct.length-2),_n=ct[ct.length-2]*Wn,Nn=ct[ct.length-1]*Wn);else{var Mn=Xt(ct);_n=Math.sqrt(Mn),Nn=Math.sqrt(Mn)}return[_n,Nn]}(C),Be=te[0],Ge=te[1],ft=this.scale;if(this.mode==="fanIn"?ft/=Math.max(1,Be):this.mode==="fanOut"?ft/=Math.max(1,Ge):ft/=Math.max(1,(Be+Ge)/2),this.distribution==="normal"){var Nt=Math.sqrt(ft);if((N=N||"float32")!=="float32"&&N!=="int32")throw new F(this.getClassName()+" does not support dType "+N+".");return Object(b.truncatedNormal)(C,0,Nt,N,this.seed)}var Ut=Math.sqrt(3*ft);return Object(b.randomUniform)(C,-Ut,Ut,N)},G.prototype.getConfig=function(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}},G.className="VarianceScaling",G}(ye);b.serialization.registerClass(Ln);var Hn=function(Z){function G(C){return Z.call(this,{scale:1,mode:"fanAvg",distribution:"uniform",seed:C==null?null:C.seed})||this}return U(G,Z),G.prototype.getClassName=function(){return Ln.className},G.className="GlorotUniform",G}(Ln);b.serialization.registerClass(Hn);var It=function(Z){function G(C){return Z.call(this,{scale:1,mode:"fanAvg",distribution:"normal",seed:C==null?null:C.seed})||this}return U(G,Z),G.prototype.getClassName=function(){return Ln.className},G.className="GlorotNormal",G}(Ln);b.serialization.registerClass(It);var Ot=function(Z){function G(C){return Z.call(this,{scale:2,mode:"fanIn",distribution:"normal",seed:C==null?null:C.seed})||this}return U(G,Z),G.prototype.getClassName=function(){return Ln.className},G.className="HeNormal",G}(Ln);b.serialization.registerClass(Ot);var pn=function(Z){function G(C){return Z.call(this,{scale:2,mode:"fanIn",distribution:"uniform",seed:C==null?null:C.seed})||this}return U(G,Z),G.prototype.getClassName=function(){return Ln.className},G.className="HeUniform",G}(Ln);b.serialization.registerClass(pn);var qt=function(Z){function G(C){return Z.call(this,{scale:1,mode:"fanIn",distribution:"normal",seed:C==null?null:C.seed})||this}return U(G,Z),G.prototype.getClassName=function(){return Ln.className},G.className="LeCunNormal",G}(Ln);b.serialization.registerClass(qt);var Ve=function(Z){function G(C){return Z.call(this,{scale:1,mode:"fanIn",distribution:"uniform",seed:C==null?null:C.seed})||this}return U(G,Z),G.prototype.getClassName=function(){return Ln.className},G.className="LeCunNormal",G}(Ln);b.serialization.registerClass(Ve);var jn=function(Z){function G(C){var N=Z.call(this)||this;if(N.DEFAULT_GAIN=1,N.gain=C.gain==null?N.DEFAULT_GAIN:C.gain,N.seed=C.seed,N.seed!=null)throw new F("Random seed is not implemented for Orthogonal Initializer yet.");return N}return U(G,Z),G.prototype.apply=function(C,N){var te=this;return Object(b.tidy)(function(){if(C.length!==2)throw new F("The Orthogonal Initializer does not support non-2D shapes yet.");C[0]*C[1]>2e3&&console.warn("Orthogonal initializer is being called on a matrix with more than 2000 ("+C[0]*C[1]+") elements: Slowness may result.");var Be=fi(C[0]>C[1]?[C[1],C[0]]:C,0,1,"float32"),Ge=b.linalg.gramSchmidt(Be);return C[0]>C[1]&&(Ge=Ge.transpose()),Object(b.mul)(te.gain,Ge)})},G.prototype.getConfig=function(){return{gain:this.gain,seed:this.seed}},G.className="Orthogonal",G}(ye);b.serialization.registerClass(jn);var $n={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function Zn(Z,G){return G===void 0&&(G={}),St(Z,b.serialization.SerializationMap.getMap().classNameMap,G,"initializer")}function ir(Z){return at(Z)}function zr(Z){if(typeof Z=="string"){var G=Z in $n?$n[Z]:Z;if(G==="GlorotNormal")return new It;if(G==="GlorotUniform")return new Hn;if(G==="HeNormal")return new Ot;if(G==="HeUniform")return new pn;if(G==="LeCunNormal")return new qt;if(G==="LeCunUniform")return new Ve;var C={};return C.className=G,C.config={},Zn(C)}return Z instanceof ye?Z:Zn(Z)}var vr=Object.freeze({zeros:function(){return new Se},ones:function(){return new Ze},constant:function(Z){return new mt(Z)},randomUniform:function(Z){return new Rt(Z)},randomNormal:function(Z){return new cn(Z)},truncatedNormal:function(Z){return new Jn(Z)},identity:function(Z){return new An(Z)},varianceScaling:function(Z){return new Ln(Z)},glorotUniform:function(Z){return new Hn(Z)},glorotNormal:function(Z){return new It(Z)},heNormal:function(Z){return new Ot(Z)},heUniform:function(Z){return new pn(Z)},leCunNormal:function(Z){return new qt(Z)},leCunUniform:function(Z){return new Ve(Z)},orthogonal:function(Z){return new jn(Z)}}),pi=0;function la(){return pi++}var ui={};function Qi(Z){return Z===void 0&&(Z=""),Z in ui||(ui[Z]=0),ui[Z]+=1,Z+ui[Z].toString()}function Di(Z){return Array.isArray(Z)&&Array.isArray(Z[0])}function qr(Z){return Z.length===0?[]:Array.isArray(Z[0])?Z:[Z]}function jr(Z){var G;if(Array.isArray(Z)){if(Z.length!==1)throw new ee("Expected Tensor length to be 1; got "+Z.length);G=Z[0]}else G=Z;return G}function Bn(Z){if(Array.isArray(Z)&&Array.isArray(Z[0])){if(Z.length===1)return(Z=Z)[0];throw new ee("Expected exactly 1 Shape; got "+Z.length)}return Z}function ri(Z){for(var G=0,C=0,N=Z;C<N.length;C++){var te=N[C];te.shape.length===0?G+=1:G+=te.shape.reduce(function(Be,Ge){return Be*Ge})}return G}var Vi="Variable",Fr=function(){function Z(G,C,N,te,Be){C===void 0&&(C="float32"),N===void 0&&(N=Vi),te===void 0&&(te=!0),Be===void 0&&(Be=null),this.dtype=C??"float32",this.shape=G.shape,this.id=la(),N=N??Vi,this.originalName=br(N),this.name=Cr(this.originalName),this.trainable_=te,this.constraint=Be,this.val=Object(b.variable)(G,this.trainable_,this.name,this.dtype)}return Z.prototype.read=function(){return this.assertNotDisposed(),this.val},Z.prototype.write=function(G){return this.assertNotDisposed(),function(C,N){if(C.shape.toString()!==N.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(C.shape)+" vs. "+JSON.stringify(N.shape))}(this.val,G),this.val.id!==G.id&&(this.val.assign(G),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this},Z.prototype.dispose=function(){this.assertNotDisposed(),this.val.dispose()},Z.prototype.assertNotDisposed=function(){if(this.val.isDisposed)throw new Error("LayersVariable "+this.name+" is already disposed.")},Object.defineProperty(Z.prototype,"trainable",{get:function(){return this.trainable_},set:function(G){this.trainable_=G,this.val.trainable=G},enumerable:!0,configurable:!0}),Z}();function aa(Z){return Z.map(function(G){return G.read()})}function ma(Z){Z.forEach(function(G){G[0].write(G[1])})}var Zi=function(Z){this.dtype=Z.dtype,this.shape=Z.shape,Z.shape!=null?this.ndim=Z.shape.length:this.ndim=Z.ndim,this.maxNDim=Z.maxNDim,this.minNDim=Z.minNDim,this.axes=Z.axes||{}},ga=function(Z,G,C,N,te,Be,Ge){this.dtype=Z,this.shape=G,this.sourceLayer=C,this.inputs=N,this.callArgs=te,this.outputTensorIndex=Ge,this.id=la(),Be!=null&&(this.originalName=br(Be),this.name=Cr(this.originalName)),this.rank=G.length},No=0,vs=function(){function Z(G,C){this.callArgs=C,this.id=No++,this.outboundLayer=G.outboundLayer,this.inboundLayers=G.inboundLayers,this.nodeIndices=G.nodeIndices,this.tensorIndices=G.tensorIndices,this.inputTensors=G.inputTensors,this.outputTensors=G.outputTensors,this.inputMasks=G.inputMasks,this.outputMasks=G.outputMasks,this.inputShapes=G.inputShapes,this.outputShapes=G.outputShapes;for(var N=0,te=G.inboundLayers;N<te.length;N++){var Be=te[N];Be?.outboundNodes.push(this)}G.outboundLayer.inboundNodes.push(this)}return Z.prototype.getConfig=function(){for(var G=[],C=0,N=this.inboundLayers;C<N.length;C++){var te=N[C];te!=null?G.push(te.name):G.push(null)}return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:G,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}},Z}(),Eh=0,qi=function(Z){function G(C){var N=Z.call(this)||this;N._callHook=null,N._addedWeightNames=[],N._stateful=!1,N.id=Eh++,N.activityRegularizer=null,N.inputSpec=null,N.supportsMasking=!1,N._trainableWeights=[],N._nonTrainableWeights=[],N._losses=[],N._updates=[],N._built=!1,N.inboundNodes=[],N.outboundNodes=[];var te=C.name;if(!te){var Be=N.getClassName();te=Te(Be)+"_"+Qi(Be)}if(N.name=te,N.trainable_=C.trainable==null||C.trainable,C.inputShape!=null||C.batchInputShape!=null){var Ge=void 0;if(C.batchInputShape!=null)Ge=C.batchInputShape;else if(C.inputShape!=null){var ft=null;C.batchSize!=null&&(ft=C.batchSize),Ge=[ft].concat(C.inputShape)}N.batchInputShape=Ge;var Nt=C.dtype;Nt==null&&(Nt=C.inputDType),Nt==null&&(Nt="float32"),N.dtype=Nt}return C.weights!=null?N.initialWeights=C.weights:N.initialWeights=null,N._refCount=null,N.fastWeightInitDuringBuild=!1,N}return U(G,Z),G.nodeKey=function(C,N){return C.name+"_ib-"+N.toString()},G.prototype.getNodeAtIndex=function(C,N){if(this.inboundNodes.length===0)throw new L("The layer has never been called and thus has no defined "+N+".");if(this.inboundNodes.length<=C)throw new ee("Asked to get "+N+" at node "+C+", but the layer has only "+this.inboundNodes.length+" inbound nodes.");return this.inboundNodes[C]},G.prototype.getInputAt=function(C){return pe(this.getNodeAtIndex(C,"input").inputTensors)},G.prototype.getOutputAt=function(C){return pe(this.getNodeAtIndex(C,"output").outputTensors)},Object.defineProperty(G.prototype,"input",{get:function(){if(this.inboundNodes.length>1)throw new $("Layer "+this.name+' has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use `getInputAt(nodeIndex)` instead.');if(this.inboundNodes.length===0)throw new $("Layer "+this.name+" is not connected, no input to return.");return pe(this.getNodeAtIndex(0,"input").inputTensors)},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"output",{get:function(){if(this.inboundNodes.length===0)throw new $("Layer "+this.name+" has no inbound nodes.");if(this.inboundNodes.length>1)throw new $("Layer "+this.name+' has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use `getOutputAt(nodeIndex)` instead.');return pe(this.getNodeAtIndex(0,"output").outputTensors)},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"losses",{get:function(){return this._losses},enumerable:!0,configurable:!0}),G.prototype.calculateLosses=function(){return this.losses.map(function(C){return C()})},Object.defineProperty(G.prototype,"updates",{get:function(){return this._updates},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"built",{get:function(){return this._built},set:function(C){this._built=C},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"trainable",{get:function(){return this.trainable_},set:function(C){this._trainableWeights.forEach(function(N){return N.trainable=C}),this.trainable_=C},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"trainableWeights",{get:function(){return this.trainable_?this._trainableWeights.filter(function(C){return C.trainable}):[]},set:function(C){this._trainableWeights=C},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"nonTrainableWeights",{get:function(){return this.trainable?this._trainableWeights.filter(function(C){return!C.trainable}).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)},set:function(C){this._nonTrainableWeights=C},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"weights",{get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"stateful",{get:function(){return this._stateful},enumerable:!0,configurable:!0}),G.prototype.resetStates=function(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")},G.prototype.assertInputCompatibility=function(C){if(C=Ae(C),this.inputSpec!=null&&this.inputSpec.length!==0){var N=Ae(this.inputSpec);if(C.length!==N.length)throw new ee("Layer "+this.name+" expects "+N.length+" inputs, but it received "+C.length+" input tensors. Input received: "+C);for(var te=0;te<C.length;te++){var Be=C[te],Ge=N[te];if(Ge!=null){var ft=Be.rank;if(Ge.ndim!=null&&ft!==Ge.ndim)throw new ee("Input "+te+" is incompatible with layer "+this.name+": expected ndim="+Ge.ndim+", found ndim="+ft);if(Ge.maxNDim!=null&&ft>Ge.maxNDim)throw new ee("Input "+te+" is incompatible with layer "+this.name+": expected max_ndim="+Ge.maxNDim+", found ndim="+ft);if(Ge.minNDim!=null&&ft<Ge.minNDim)throw new ee("Input "+te+" is incompatible with layer "+this.name+": expected min_ndim="+Ge.minNDim+", found ndim="+ft+".");if(Ge.dtype!=null&&Be.dtype!==Ge.dtype)throw new ee("Input "+te+" is incompatible with layer "+this.name+" : expected dtype="+Ge.dtype+", found dtype="+Be.dtype+".");if(Ge.axes){var Nt=Be.shape;for(var Ut in Ge.axes){var ct=Number(Ut),yn=Ge.axes[Ut],_n=ct>=0?Nt[ct]:Nt[Nt.length+ct];if(yn!=null&&[yn,null].indexOf(_n)===-1)throw new ee("Input "+te+" is incompatible with layer "+this.name+": expected axis "+ct+" of input shape to have value "+yn+" but got shape "+Nt+".")}}if(Ge.shape!=null)for(var Nn=0;Nn<Ge.shape.length;++Nn){var Wn=Ge.shape[Nn],Mn=Be.shape[Nn];if(Wn!=null&&Mn!=null&&Wn!==Mn)throw new ee("Input "+te+" is incompatible with layer "+this.name+": expected shape="+Ge.shape+", found shape="+Be.shape+".")}}}}},G.prototype.call=function(C,N){return C},G.prototype.invokeCallHook=function(C,N){this._callHook!=null&&this._callHook(C,N)},G.prototype.setCallHook=function(C){this._callHook=C},G.prototype.clearCallHook=function(){this._callHook=null},G.prototype.apply=function(C,N){var te=this;N=N||{},this.assertNotDisposed();for(var Be=Ae(C),Ge=!0,ft=0,Nt=Be;ft<Nt.length;ft++)if(!(Nt[ft]instanceof ga)){Ge=!1;break}for(var Ut=!0,ct=0,yn=Be;ct<yn.length;ct++)if(yn[ct]instanceof ga){Ut=!1;break}if(Ge===Ut)throw new ee("Arguments to apply() must be all SymbolicTensors or all Tensors");return Xn(this.name,function(){if(!te.built){te.assertInputCompatibility(C);for(var _n=[],Nn=0,Wn=Ae(C);Nn<Wn.length;Nn++){var Mn=Wn[Nn];_n.push(Mn.shape)}te.build(pe(_n)),te.built=!0,te.initialWeights&&te.setWeights(te.initialWeights),te._refCount===null&&Ut&&(te._refCount=1)}if(te.assertInputCompatibility(C),Ut){for(var tr=[],rr=0,hr=Ae(Hr=te.call(C,N));rr<hr.length;rr++){var Nr=hr[rr];Be.indexOf(Nr)!==-1&&(Nr=Nr.clone()),tr.push(Nr)}if(Hr=pe(tr),te.activityRegularizer!=null)throw new F("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return Hr}var Vr=function(oi){for(var li=[],$r=0,Zr=oi=Ae(oi);$r<Zr.length;$r++){var pa=Zr[$r];li.push(pa.shape)}return pe(li)}(C),wr=te.computeOutputShape(Vr),Hr=void 0,Wr="float32";if(te.warnOnIncompatibleInputShape(Array.isArray(C)?Vr[0]:Vr),Hr=wr!=null&&wr.length>0&&Array.isArray(wr[0])?wr.map(function(oi,li){return new ga(Wr,oi,te,Ae(C),N,te.name,li)}):new ga(Wr,wr,te,Ae(C),N,te.name),te.addInboundNode(C,Hr,null,null,Vr,wr,N),te._refCount++,te.activityRegularizer!=null)throw new F("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return Hr})},G.prototype.warnOnIncompatibleInputShape=function(C){if(this.batchInputShape!=null)if(C.length!==this.batchInputShape.length)console.warn("The rank of the input tensor provided (shape: "+JSON.stringify(C)+") does not match that of the batchInputShape ("+JSON.stringify(this.batchInputShape)+") of the layer "+this.name);else{var N=!1;this.batchInputShape.forEach(function(te,Be){te!=null&&C[Be]!=null&&C[Be]!==te&&(N=!0)}),N&&console.warn("The shape of the input tensor ("+JSON.stringify(C)+") does not match the expectation of layer "+this.name+": "+JSON.stringify(this.batchInputShape))}},Object.defineProperty(G.prototype,"outputShape",{get:function(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new $("The layer "+this.name+" has never been called and thus has no defined output shape.");for(var C=[],N=0,te=this.inboundNodes;N<te.length;N++){var Be=te[N],Ge=JSON.stringify(Be.outputShapes);C.indexOf(Ge)===-1&&C.push(Ge)}if(C.length===1){var ft=this.inboundNodes[0].outputShapes;return Array.isArray(ft)&&Array.isArray(ft[0])&&ft.length===1?ft[0]:ft}throw new $("The layer "+this.name+' has multiple inbound nodes with different output shapes. Hence the notion of "outut shape" is ill-defined for the layer.')},enumerable:!0,configurable:!0}),G.prototype.countParams=function(){if(!this.built)throw new L("You tried to call countParams() on "+this.name+", but the layer is not built yet. Build it first by calling build(batchInputShape).");return ri(this.weights)},G.prototype.build=function(C){this.built=!0},G.prototype.getWeights=function(C){return C===void 0&&(C=!1),aa(C?this.trainableWeights:this.weights)},G.prototype.setWeights=function(C){var N=this;Object(b.tidy)(function(){var te=N.weights;if(te.length!==C.length)throw new ee('You called setWeights(weights) on layer "'+N.name+'" with a weight list of length '+C.length+", but the layer was expecting "+te.length+" weights. Provided weights: "+C+"...");if(te.length!==0){for(var Be=[],Ge=aa(te),ft=0;ft<Ge.length;++ft){var Nt=Ge[ft],Ut=te[ft],ct=C[ft];if(!b.util.arraysEqual(Nt.shape,ct.shape))throw new ee("Layer weight shape "+Nt.shape+" not compatible with provided weight shape "+ct.shape);Be.push([Ut,ct])}ma(Be)}})},G.prototype.addWeight=function(C,N,te,Be,Ge,ft,Nt){if(this._addedWeightNames.indexOf(C)!==-1)throw new ee("Duplicate weight name "+C+" for layer "+this.name);this._addedWeightNames.push(C),te==null&&(te="float32"),this.fastWeightInitDuringBuild&&(Be=zr("zeros"));var Ut=Be.apply(N,te),ct=new Fr(Ut,te,C,ft,Nt);return Ut.dispose(),Ge!=null&&this.addLoss(function(){return Ge.apply(ct.read())}),ft==null&&(ft=!0),ft?this._trainableWeights.push(ct):this._nonTrainableWeights.push(ct),ct},G.prototype.setFastWeightInitDuringBuild=function(C){this.fastWeightInitDuringBuild=C},G.prototype.addLoss=function(C){var N;C==null||Array.isArray(C)&&C.length===0||(C=Ae(C),this._losses!==void 0&&this._losses!==null&&(N=this.losses).push.apply(N,C))},G.prototype.computeOutputShape=function(C){return C},G.prototype.computeMask=function(C,N){var te=this;if(!this.supportsMasking){if(N!=null){if(!Array.isArray(N))throw new TypeError("Layer "+this.name+" does not support masking, but was passed an inputMask.");N.forEach(function(Be){if(Be!=null)throw new TypeError("Layer "+te.name+" does not support masking, but was passed an inputMask.")})}return null}return N},G.prototype.addInboundNode=function(C,N,te,Be,Ge,ft,Nt){Nt===void 0&&(Nt=null);var Ut=Ae(C);N=Ae(N),te=Ae(te),Be=Ae(Be),Ge=qr(Ge),ft=qr(ft);for(var ct=[],yn=[],_n=[],Nn=0,Wn=Ut;Nn<Wn.length;Nn++){var Mn=Wn[Nn];ct.push(Mn.sourceLayer),yn.push(Mn.nodeIndex),_n.push(Mn.tensorIndex)}new vs({outboundLayer:this,inboundLayers:ct,nodeIndices:yn,tensorIndices:_n,inputTensors:Ut,outputTensors:N,inputMasks:te,outputMasks:Be,inputShapes:Ge,outputShapes:ft},Nt);for(var tr=0;tr<N.length;tr++)N[tr].sourceLayer=this,N[tr].nodeIndex=this.inboundNodes.length-1,N[tr].tensorIndex=tr},G.prototype.getConfig=function(){var C={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(C.batchInputShape=this.batchInputShape),this.dtype!=null&&(C.dtype=this.dtype),C},G.prototype.disposeWeights=function(){return this.weights.forEach(function(C){return C.dispose()}),this.weights.length},G.prototype.assertNotDisposed=function(){if(this._refCount===0)throw new Error("Layer '"+this.name+"' is already disposed.")},G.prototype.dispose=function(){if(!this.built)throw new Error("Cannot dispose Layer "+this.name+" because it has not been built yet.");if(this._refCount===null)throw new Error("Cannot dispose Layer "+this.name+" because it has not been used yet.");this.assertNotDisposed();var C=0;return--this._refCount==0&&(C=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:C}},G}(b.serialization.Serializable),ec,bu=function(Z){function G(C){var N=Z.call(this,{dtype:C.dtype,name:C.name!=null?C.name:Qi("input").toString()})||this;if(C.batchSize==null&&(C.batchSize=null),C.sparse==null&&(C.sparse=!1),N.trainable=!1,N.built=!0,N.sparse=C.sparse,C.inputShape!=null&&C.batchInputShape!=null)throw new ee("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");var te=C.batchInputShape;if(te==null){if(C.inputShape==null)throw new ee("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");te=[C.batchSize].concat(C.inputShape)}else if(C.batchSize!=null)throw new ee("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");var Be=C.dtype||"float32";N.batchInputShape=te,N.dtype=Be,N.inputSpec=[{shape:te}];var Ge=new ga(N.dtype,N.batchInputShape,N,[],{},N.name);return Ge.nodeIndex=0,Ge.tensorIndex=0,new vs({outboundLayer:N,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[Ge],outputTensors:[Ge],inputMasks:[null],outputMasks:[null],inputShapes:[te],outputShapes:[te]}),N}return U(G,Z),G.prototype.apply=function(C,N){throw new ee("Cannot pass any input to an InputLayer's apply() method. InputLayer name: "+this.name)},G.prototype.dispose=function(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}},G.prototype.getConfig=function(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}},G.className="InputLayer",G}(qi);function bc(Z){if(Z.batchShape==null&&Z.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(Z.batchShape!=null&&Z.shape!=null)throw new ee("Please provide either a `shape` or `batchShape` argument to Input, but not both.");var G=Z.batchShape;Z.shape!=null&&G==null&&(G=[null].concat(Z.shape));var C=Z.dtype;return C==null&&(C="float32"),new bu({batchInputShape:G,name:Z.name,dtype:C,sparse:Z.sparse}).inboundNodes[0].outputTensors[0]}function Bu(Z){return J(this,void 0,void 0,function(){var G,C,N,te,Be,Ge,ft,Nt;return R(this,function(Ut){switch(Ut.label){case 0:if(Z==null)return[2];for(te in G=[],C=[],N=[],Z)typeof(Be=Z[te])!="number"&&(Ge=Be,G.push(Ge.data()),C.push(te),N.push(Ge));return G.length>0?[4,Promise.all(G)]:[3,2];case 1:for(ft=Ut.sent(),Nt=0;Nt<ft.length;++Nt)Z[C[Nt]]=ft[Nt][0];Object(b.dispose)(N),Ut.label=2;case 2:return[2]}})})}function xc(Z){if(Z!=null)for(var G in Z){var C=Z[G];typeof C!="number"&&C.dispose()}}b.serialization.registerClass(bu),function(Z){Z[Z.SILENT=0]="SILENT",Z[Z.VERBOSE=1]="VERBOSE"}(ec||(ec={}));var Dd=125,os=function(){function Z(){this.validationData=null}return Z.prototype.setParams=function(G){this.params=G},Z.prototype.onEpochBegin=function(G,C){return J(this,void 0,void 0,function(){return R(this,function(N){return[2]})})},Z.prototype.onEpochEnd=function(G,C){return J(this,void 0,void 0,function(){return R(this,function(N){return[2]})})},Z.prototype.onBatchBegin=function(G,C){return J(this,void 0,void 0,function(){return R(this,function(N){return[2]})})},Z.prototype.onBatchEnd=function(G,C){return J(this,void 0,void 0,function(){return R(this,function(N){return[2]})})},Z.prototype.onTrainBegin=function(G){return J(this,void 0,void 0,function(){return R(this,function(C){return[2]})})},Z.prototype.onTrainEnd=function(G){return J(this,void 0,void 0,function(){return R(this,function(C){return[2]})})},Z.prototype.setModel=function(G){},Z}(),vf=function(){function Z(G,C){C===void 0&&(C=10),G==null&&(G=[]),this.callbacks=G,this.queueLength=C}return Z.prototype.append=function(G){this.callbacks.push(G)},Z.prototype.setParams=function(G){for(var C=0,N=this.callbacks;C<N.length;C++)N[C].setParams(G)},Z.prototype.setModel=function(G){for(var C=0,N=this.callbacks;C<N.length;C++)N[C].setModel(G)},Z.prototype.onEpochBegin=function(G,C){return J(this,void 0,void 0,function(){var N,te;return R(this,function(Be){switch(Be.label){case 0:C==null&&(C={}),N=0,te=this.callbacks,Be.label=1;case 1:return N<te.length?[4,te[N].onEpochBegin(G,C)]:[3,4];case 2:Be.sent(),Be.label=3;case 3:return N++,[3,1];case 4:return[2]}})})},Z.prototype.onEpochEnd=function(G,C){return J(this,void 0,void 0,function(){var N,te;return R(this,function(Be){switch(Be.label){case 0:C==null&&(C={}),N=0,te=this.callbacks,Be.label=1;case 1:return N<te.length?[4,te[N].onEpochEnd(G,C)]:[3,4];case 2:Be.sent(),Be.label=3;case 3:return N++,[3,1];case 4:return[2]}})})},Z.prototype.onBatchBegin=function(G,C){return J(this,void 0,void 0,function(){var N,te;return R(this,function(Be){switch(Be.label){case 0:C==null&&(C={}),N=0,te=this.callbacks,Be.label=1;case 1:return N<te.length?[4,te[N].onBatchBegin(G,C)]:[3,4];case 2:Be.sent(),Be.label=3;case 3:return N++,[3,1];case 4:return[2]}})})},Z.prototype.onBatchEnd=function(G,C){return J(this,void 0,void 0,function(){var N,te;return R(this,function(Be){switch(Be.label){case 0:C==null&&(C={}),N=0,te=this.callbacks,Be.label=1;case 1:return N<te.length?[4,te[N].onBatchEnd(G,C)]:[3,4];case 2:Be.sent(),Be.label=3;case 3:return N++,[3,1];case 4:return[2]}})})},Z.prototype.onTrainBegin=function(G){return J(this,void 0,void 0,function(){var C,N;return R(this,function(te){switch(te.label){case 0:G==null&&(G={}),C=0,N=this.callbacks,te.label=1;case 1:return C<N.length?[4,N[C].onTrainBegin(G)]:[3,4];case 2:te.sent(),te.label=3;case 3:return C++,[3,1];case 4:return[2]}})})},Z.prototype.onTrainEnd=function(G){return J(this,void 0,void 0,function(){var C,N;return R(this,function(te){switch(te.label){case 0:G==null&&(G={}),C=0,N=this.callbacks,te.label=1;case 1:return C<N.length?[4,N[C].onTrainEnd(G)]:[3,4];case 2:te.sent(),te.label=3;case 3:return C++,[3,1];case 4:return[2]}})})},Z}(),Td=function(Z){function G(){return Z.call(this)||this}return U(G,Z),G.prototype.onEpochBegin=function(C){return J(this,void 0,void 0,function(){return R(this,function(N){return this.seen=0,this.totals={},[2]})})},G.prototype.onBatchEnd=function(C,N){return J(this,void 0,void 0,function(){var te,Be,Ge,ft,Nt=this;return R(this,function(Ut){for(ft in N==null&&(N={}),te=N.size==null?0:N.size,this.seen+=te,Be=function(ct){var yn=N[ct];if(typeof yn=="number")Ge.totals.hasOwnProperty(ct)||(Ge.totals[ct]=0),Ge.totals[ct]=Ge.totals[ct]+yn*te;else{var _n=void 0;ct in Ge.totals?_n=Ge.totals[ct]:Ge.totals[ct]=0;var Nn=Object(b.tidy)(function(){return Object(b.add)(Nt.totals[ct],Object(b.mul)(yn,te))});Ge.totals[ct]=Nn,_n?.dispose()}},Ge=this,N)Be(ft);return[2]})})},G.prototype.onEpochEnd=function(C,N){return J(this,void 0,void 0,function(){var te,Be,Ge,ft,Nt,Ut=this;return R(this,function(ct){if(N!=null)for(te=function(yn){if(Be.totals[yn]==null)return"continue";typeof Be.totals[yn]=="number"?N[yn]=Be.totals[yn]/Be.seen:Object(b.tidy)(function(){var _n=Object(b.mul)(Object(b.div)(1,Ut.seen),Ut.totals[yn]);N[yn]=_n,Ut.totals[yn].dispose(),Object(b.keep)(N[yn])})},Be=this,Ge=0,ft=this.params.metrics;Ge<ft.length;Ge++)Nt=ft[Ge],te(Nt);return[2]})})},G}(os),Pu=function(Z){function G(){return Z!==null&&Z.apply(this,arguments)||this}return U(G,Z),G.prototype.onTrainBegin=function(C){return J(this,void 0,void 0,function(){return R(this,function(N){return this.epoch=[],this.history={},[2]})})},G.prototype.onEpochEnd=function(C,N){return J(this,void 0,void 0,function(){var te;return R(this,function(Be){for(te in N==null&&(N={}),this.epoch.push(C),N)this.history[te]==null&&(this.history[te]=[]),this.history[te].push(N[te]);return[2]})})},G.prototype.syncData=function(){return J(this,void 0,void 0,function(){var C,N,te,Be,Ge,ft,Nt,Ut,ct;return R(this,function(yn){switch(yn.label){case 0:for(Be in C=[],N=[],te=[],this.history)for(Ge=this.history[Be],ft=0;ft<Ge.length;++ft)typeof Ge[ft]!="number"&&(Nt=Ge[ft],C.push(Nt.data()),N.push(Be),te.push(ft));return[4,Promise.all(C)];case 1:for(Ut=yn.sent(),ct=0;ct<Ut.length;++ct)this.history[N[ct]][te[ct]].dispose(),this.history[N[ct]][te[ct]]=Ut[ct][0];return[2]}})})},G}(os),yf=function(Z){function G(C,N){var te=Z.call(this)||this;if(te.currentEpoch=0,te.yieldEvery=N||"auto",te.yieldEvery==="auto"&&(te.yieldEvery=Dd),te.yieldEvery==="never"&&C.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");return b.util.isNumber(te.yieldEvery)&&(te.maybeWait=function(Be,Ge){var ft,Nt=b.util.now();return function(){for(var Ut=[],ct=0;ct<arguments.length;ct++)Ut[ct]=arguments[ct];var yn=b.util.now();return yn-Nt<Ge?ft:(Nt=yn,ft=Be.apply(void 0,Ut))}}(te.maybeWait.bind(te),te.yieldEvery)),te.trainBegin=C.onTrainBegin,te.trainEnd=C.onTrainEnd,te.epochBegin=C.onEpochBegin,te.epochEnd=C.onEpochEnd,te.batchBegin=C.onBatchBegin,te.batchEnd=C.onBatchEnd,te.yield=C.onYield,te}return U(G,Z),G.prototype.maybeWait=function(C,N,te){return J(this,void 0,void 0,function(){var Be;return R(this,function(Ge){switch(Ge.label){case 0:return Be=[],this.yield==null?[3,2]:[4,Bu(te)];case 1:Ge.sent(),Be.push(this.yield(C,N,te)),Ge.label=2;case 2:return Be.push(Object(b.nextFrame)()),[4,Promise.all(Be)];case 3:return Ge.sent(),[2]}})})},G.prototype.onEpochBegin=function(C,N){return J(this,void 0,void 0,function(){return R(this,function(te){switch(te.label){case 0:return this.currentEpoch=C,this.epochBegin==null?[3,3]:[4,Bu(N)];case 1:return te.sent(),[4,this.epochBegin(C,N)];case 2:te.sent(),te.label=3;case 3:return[2]}})})},G.prototype.onEpochEnd=function(C,N){return J(this,void 0,void 0,function(){var te;return R(this,function(Be){switch(Be.label){case 0:return te=[],this.epochEnd==null?[3,2]:[4,Bu(N)];case 1:Be.sent(),te.push(this.epochEnd(C,N)),Be.label=2;case 2:return this.yieldEvery==="epoch"&&te.push(Object(b.nextFrame)()),[4,Promise.all(te)];case 3:return Be.sent(),[2]}})})},G.prototype.onBatchBegin=function(C,N){return J(this,void 0,void 0,function(){return R(this,function(te){switch(te.label){case 0:return this.batchBegin==null?[3,3]:[4,Bu(N)];case 1:return te.sent(),[4,this.batchBegin(C,N)];case 2:te.sent(),te.label=3;case 3:return[2]}})})},G.prototype.onBatchEnd=function(C,N){return J(this,void 0,void 0,function(){var te;return R(this,function(Be){switch(Be.label){case 0:return te=[],this.batchEnd==null?[3,2]:[4,Bu(N)];case 1:Be.sent(),te.push(this.batchEnd(C,N)),Be.label=2;case 2:return this.yieldEvery==="batch"?te.push(Object(b.nextFrame)()):b.util.isNumber(this.yieldEvery)&&te.push(this.maybeWait(this.currentEpoch,C,N)),[4,Promise.all(te)];case 3:return Be.sent(),[2]}})})},G.prototype.onTrainBegin=function(C){return J(this,void 0,void 0,function(){return R(this,function(N){switch(N.label){case 0:return this.trainBegin==null?[3,3]:[4,Bu(C)];case 1:return N.sent(),[4,this.trainBegin(C)];case 2:N.sent(),N.label=3;case 3:return[2]}})})},G.prototype.onTrainEnd=function(C){return J(this,void 0,void 0,function(){return R(this,function(N){switch(N.label){case 0:return this.trainEnd==null?[3,3]:[4,Bu(C)];case 1:return N.sent(),[4,this.trainEnd(C)];case 2:N.sent(),N.label=3;case 3:return[2]}})})},G}(os);function Ch(Z,G){return Z==null&&(Z={}),Z instanceof os?[Z]:Array.isArray(Z)&&Z[0]instanceof os?Z:Ae(Z).map(function(C){return new yf(C,G)})}var wc=function(){function Z(){}return Z.registerCallbackConstructor=function(G,C){b.util.assert(G>=0&&Number.isInteger(G),function(){return"Verbosity level is expected to be an integer >= 0, but got "+G}),Z.checkForDuplicate(C),Z.constructors[G]==null&&(Z.constructors[G]=[]),Z.constructors[G].push(C)},Z.checkForDuplicate=function(G){for(var C in Z.constructors)Z.constructors[+C].forEach(function(N){if(N===G)throw new ee("Duplicate callback constructor.")})},Z.clear=function(){Z.constructors={}},Z.createCallbacks=function(G){var C=[];for(var N in Z.constructors){var te=+N;G>=te&&C.push.apply(C,Z.constructors[te])}return C.map(function(Be){return new Be})},Z.constructors={},Z}();function El(Z,G,C,N,te,Be,Ge,ft,Nt){var Ut=new Pu,ct=[new Td].concat(wc.createCallbacks(G));Z!=null&&ct.push.apply(ct,Z),ct.push(Ut);var yn=new vf(ct);return yn.setParams({epochs:C,initialEpoch:N,samples:te,steps:Be,batchSize:Ge,verbose:G,doValidation:ft,metrics:Nt}),{callbackList:yn,history:Ut}}function Io(Z,G,C){return G===void 0&&(G={}),C===void 0&&(C=!1),St(Z,b.serialization.SerializationMap.getMap().classNameMap,G,"layer",C)}function Vc(Z,G){return Object(b.tidy)(function(){Z.dtype!=="float32"&&(Z=Z.asType("float32"));var C=Object(b.sum)(Wi(Z),G,!0),N=Object(b.fill)(C.shape,P()),te=Object(b.sqrt)(Object(b.maximum)(C,N));return Object(b.div)(Z,te)})}function so(Z,G){return Object(b.tidy)(function(){return Object(b.mean)(Wi(Object(b.sub)(G,Z)),-1)})}function tc(Z,G){return Object(b.tidy)(function(){return Object(b.mean)(Object(b.abs)(Object(b.sub)(G,Z)),-1)})}function ss(Z,G){return Object(b.tidy)(function(){var C=Object(b.sub)(Z,G),N=Object(b.clipByValue)(Object(b.abs)(Z),P(),Number.MAX_VALUE),te=Object(b.abs)(Object(b.div)(C,N));return Object(b.mul)(100,Object(b.mean)(te,-1))})}function Eo(Z,G,C){return C===void 0&&(C=!1),Object(b.tidy)(function(){if(C)G=Object(b.softmax)(G);else{var N=Object(b.sum)(G,G.shape.length-1,!0);G=Object(b.div)(G,N)}return G=Object(b.clipByValue)(G,P(),1-P()),Object(b.neg)(Object(b.sum)(Object(b.mul)(Z.toFloat(),Object(b.log)(G)),G.shape.length-1))})}function nc(Z,G){return Object(b.tidy)(function(){var C=Object(b.floor)(function(te){var Be=[Xt(te.shape)];return te.reshape(Be)}(Z)).toInt(),N=(G=Object(b.clipByValue)(G,P(),1-P())).shape;return Eo(Object(b.oneHot)(C,N[N.length-1]).reshape(N),G,!1)})}function Cl(Z,G){return Object(b.tidy)(function(){var C;return C=Object(b.clipByValue)(G,P(),1-P()),C=Object(b.log)(Object(b.div)(C,Object(b.sub)(1,C))),Object(b.mean)(function(N,te){if(!b.util.arraysEqual(N.shape,te.shape))throw new ee("logits and labels must have the same shape, but got shapes "+JSON.stringify(N.shape)+" and "+JSON.stringify(te.shape));return Object(b.tidy)(function(){var Be=te.relu(),Ge=te.abs().neg();return Be.sub(te.mul(N)).add(Ge.exp().log1p())})}(Z,C),-1)})}function rc(Z,G){return Object(b.tidy)(function(){var C=Vc(Z,-1),N=Vc(G,-1),te=Object(b.mul)(C,N);return Object(b.neg)(Object(b.sum)(te,-1))})}var su={meanSquaredError:so,meanAbsoluteError:tc,meanAbsolutePercentageError:ss,meanSquaredLogarithmicError:function(Z,G){return Object(b.tidy)(function(){var C=Object(b.clipByValue)(G,P(),Number.MAX_VALUE),N=Object(b.log)(Object(b.add)(1,C)),te=Object(b.clipByValue)(Z,P(),Number.MAX_VALUE),Be=Object(b.log)(Object(b.add)(1,te));return Object(b.mean)(Wi(Object(b.sub)(N,Be)),-1)})},squaredHinge:function(Z,G){return Object(b.tidy)(function(){var C=Object(b.maximum)(0,Object(b.sub)(1,Object(b.mul)(Z,G)));return Object(b.mean)(Wi(C),-1)})},hinge:function(Z,G){return Object(b.tidy)(function(){var C=Object(b.maximum)(0,Object(b.sub)(1,Object(b.mul)(Z,G)));return Object(b.mean)(C,-1)})},categoricalHinge:function(Z,G){return Object(b.tidy)(function(){var C=Object(b.sum)(Object(b.mul)(Z,G),-1),N=Object(b.max)(Object(b.mul)(Object(b.sub)(1,Z),G),-1);return Object(b.maximum)(0,Object(b.add)(1,Object(b.sub)(N,C)))})},logcosh:function(Z,G){return Object(b.tidy)(function(){var C=Math.log(2),N=Object(b.sub)(G,Z),te=Object(b.sub)(Object(b.add)(N,Object(b.softplus)(Object(b.mul)(-2,N))),C);return Object(b.mean)(te,-1)})},categoricalCrossentropy:Eo,sparseCategoricalCrossentropy:nc,binaryCrossentropy:Cl,kullbackLeiblerDivergence:function(Z,G){return Object(b.tidy)(function(){var C=Object(b.clipByValue)(Z,P(),1),N=Object(b.clipByValue)(G,P(),1);return Object(b.sum)(Object(b.mul)(Z,Object(b.log)(Object(b.div)(C,N))),-1)})},poisson:function(Z,G){return Object(b.tidy)(function(){var C=Object(b.log)(Object(b.add)(P(),G));return Object(b.mean)(Object(b.sub)(G,Object(b.mul)(Z,C)),-1)})},cosineProximity:rc};function Oh(Z){if(typeof Z=="string"){if(Z in su)return su[Z];var G="Unknown loss "+Z;throw Z.toLowerCase().includes("softmaxcrossentropy")&&(G="Unknown loss "+Z+'. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy'),new ee(G)}return Z}function bf(Z,G){return Object(b.tidy)(function(){var C=Object(b.mul)(.5,Object(b.onesLike)(G)),N=xr(Object(b.greater)(G,C),Z.dtype);return Object(b.mean)(Object(b.equal)(Z,N),-1)})}function xf(Z,G){return Object(b.tidy)(function(){return xr(Object(b.equal)(Object(b.argMax)(Z,-1),Object(b.argMax)(G,-1)),"float32")})}function lo(Z,G){return Object(b.tidy)(function(){return Object(b.logicalAnd)(Z.equal(1),G.equal(1)).sum().cast("float32")})}function Ah(Z,G){return Object(b.tidy)(function(){var C=lo(Z,G),N=function(Be,Ge){return Object(b.tidy)(function(){return Object(b.logicalAnd)(Be.equal(0),Ge.equal(1)).sum().cast("float32")})}(Z,G),te=C.add(N);return Object(b.where)(Object(b.greater)(te,0),C.div(te),0).cast("float32")})}function Nd(Z,G){return Object(b.tidy)(function(){var C=lo(Z,G),N=function(Be,Ge){return Object(b.tidy)(function(){return Object(b.logicalAnd)(Be.equal(1),Ge.equal(0)).sum().cast("float32")})}(Z,G),te=C.add(N);return Object(b.where)(Object(b.greater)(te,0),C.div(te),0).cast("float32")})}function wf(Z,G){return Cl(Z,G)}function kf(Z,G){return Z.rank===G.rank&&(Z=Z.squeeze([Z.rank-1])),(G=G.argMax(-1)).dtype!==Z.dtype&&(G=G.asType(Z.dtype)),Object(b.equal)(Z,G).asType("float32")}var ys=Eo,Ef=nc,or={binaryAccuracy:bf,categoricalAccuracy:xf,precision:Ah,categoricalCrossentropy:ys,sparseCategoricalCrossentropy:Ef,mse:so,MSE:so,mae:tc,MAE:tc,mape:ss,MAPE:ss,cosine:rc};function xu(Z){if(K(Z!==null,"Unknown LossOrMetricFn "+Z),typeof Z=="string")return Z;for(var G=void 0,C=0,N=Object.keys(su);C<N.length;C++){var te=N[C];if(su[te]===Z){G=te;break}}if(G!==void 0)return G;for(var Be=0,Ge=Object.keys(or);Be<Ge.length;Be++)if(te=Ge[Be],or[te]===Z){G=te;break}return G!==void 0?G:Z.name}var Tp=1048576;function Np(Z,G,C){if(C===void 0&&(C=!1),Z==null||typeof Z!="object"||Object.getPrototypeOf(Z)!==Object.prototype||!function te(Be){if(Be===null)return!0;if(typeof Be=="object"){if(Object.getPrototypeOf(Be)===Object.prototype){for(var Ge=0,ft=Object.keys(Be);Ge<ft.length;Ge++){var Nt=ft[Ge];if(typeof Nt!="string"||!te(Be[Nt]))return!1}return!0}if(Array.isArray(Be)){for(var Ut=0,ct=Be;Ut<ct.length;Ut++)if(!te(ct[Ut]))return!1;return!0}return!1}var yn=typeof Be;return yn==="string"||yn==="number"||yn==="boolean"}(Z))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(C){var N=JSON.stringify(Z);N.length>Tp&&console.warn('User-defined metadata of model "'+G+'" is too large in size (length='+N.length+" when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= "+Tp+".")}}function Cf(Z,G,C,N){N===void 0&&(N=console.log);var te,Be=function(_n){var Nn=!0,Wn=[],Mn=[];for(var tr in _n.nodesByDepth)Wn.push(_n.nodesByDepth[tr]);for(var rr=0,hr=Wn;rr<hr.length;rr++){var Nr=hr[rr];if(Nr.length>1||Nr.length===1&&Nr[0].inboundLayers.length>1){Nn=!1;break}Mn.push.apply(Mn,Nr)}if(Nn)for(var Vr=0,wr=_n.layers;Vr<wr.length;Vr++){for(var Hr=!1,Wr=0,oi=wr[Vr].inboundNodes;Wr<oi.length;Wr++){var li=oi[Wr];if(Mn.indexOf(li)!==-1){if(Hr){Nn=!1;break}Hr=!0}}if(!Nn)break}return Nn}(Z),Ge=["Layer (type)","Output shape","Param #"];if(Be?(G=G||65,C=C||[.45,.85,1]):(G=G||98,C=C||[.33,.55,.67,1]),C[C.length-1]<=1&&(C=C.map(function(_n){return Math.floor(G*_n)})),!Be)for(var ft in Ge.push("Receives inputs"),te=[],Z.nodesByDepth)te.push.apply(te,Z.nodesByDepth[ft]);N("_".repeat(G)),Ol(Ge,C,N),N("=".repeat(G));for(var Nt=Z.layers,Ut=0;Ut<Nt.length;++Ut)Be?Id(Nt[Ut],C,N):_h(Nt[Ut],C,te,N),N((Ut===Nt.length-1?"=":"_").repeat(G));Z.checkTrainableWeightsConsistency();var ct=function(_n){return _n.collectedTrainableWeights!=null?ri(_n.collectedTrainableWeights):ri(_n.trainableWeights)}(Z),yn=ri(Z.nonTrainableWeights);N("Total params: "+(ct+yn)),N("Trainable params: "+ct),N("Non-trainable params: "+yn),N("_".repeat(G))}function Ol(Z,G,C){C===void 0&&(C=console.log);for(var N="",te=0;te<Z.length;++te)te>0&&(N=N.slice(0,N.length-1)+" "),N=(N+=Z[te]).slice(0,G[te]),N+=" ".repeat(G[te]-N.length);C(N)}function Id(Z,G,C){var N;try{N=JSON.stringify(Z.outputShape)}catch{N="multiple"}Ol([Z.name+" ("+Z.getClassName()+")",N,Z.countParams().toString()],G,C)}function _h(Z,G,C,N){var te;try{te=JSON.stringify(Z.outputShape)}catch{te="multiple"}for(var Be=[],Ge=0,ft=Z.inboundNodes;Ge<ft.length;Ge++){var Nt=ft[Ge];if(!(C!=null&&C.length>0&&C.indexOf(Nt)===-1))for(var Ut=0;Ut<Nt.inboundLayers.length;++Ut){var ct=Nt.inboundLayers[Ut].name,yn=Nt.nodeIndices[Ut],_n=Nt.tensorIndices[Ut];Be.push(ct+"["+yn+"]["+_n+"]")}}var Nn=Z.name,Wn=Z.getClassName(),Mn=Be.length===0?"":Be[0];for(Ol([Nn+" ("+Wn+")",te,Z.countParams().toString(),Mn],G,N),Ut=1;Ut<Be.length;++Ut)Ol(["","","",Be[Ut]],G,N)}function Sh(Z,G,C){return(Z==="inboundNodes"||Z==="outputLayers"||Z==="inputLayers")&&G===0&&typeof C=="string"}function Fi(Z,G){if(Z===null)return null;if(typeof Z=="string")return je(Z);if(typeof Z=="number"||typeof Z=="boolean")return Z;if(Z instanceof Array){for(var C=[],N=Z.length,te=0;te<N;++te){var Be=Z[te];Sh(G,te,Be)?C.push(Be):C.push(Fi(Be,G))}return C}for(var Ge={},ft=0,Nt=Object.keys(Z);ft<Nt.length;ft++){var Ut=Nt[ft],ct=Z[Ut];if(Ut==="name"&&typeof ct=="string")Ge[Ut]=ct;else{var yn=je(Ut);Ge[yn]=Fi(ct,yn)}}return Ge}var Na=function(){function Z(G){if(this.id2Value={},this.id2Mask={},this.name2Id={},G instanceof Z)for(var C in G.id2Value)this.id2Value[C]=G.id2Value[C],C in G.id2Mask&&(this.id2Mask[C]=G.id2Mask[C]);else{if(G==null)return;for(var N=0,te=G;N<te.length;N++){var Be=te[N];this.add(Be.key,Be.value)}}}return Z.prototype.add=function(G,C,N){if(this.id2Value[G.id]!=null)throw new ee("Duplicate key: name="+G.name+", id="+G.id);return this.id2Value[G.id]=function(te,Be){if(te.dtype==null||te.dtype===Be.dtype)return Be;try{return Object(b.cast)(Be,te.dtype)}catch{throw new ee("The dtype of the feed ("+Be.dtype+") can not be cast to the dtype of the key '"+te.name+"' ("+te.dtype+").")}}(G,C),this.name2Id[G.name]=G.id,N!=null&&(this.id2Mask[G.id]=N),this},Z.prototype.addFeed=function(G){this.add(G.key,G.value)},Z.prototype.hasKey=function(G){return this.id2Value[G.id]!=null},Z.prototype.names=function(){return Object.keys(this.name2Id)},Z.prototype.getValue=function(G){if(G instanceof ga){if(this.id2Value[G.id]==null)throw new ee("Nonexistent key: "+G.name);return this.id2Value[G.id]}var C=this.name2Id[G];if(C==null)throw new ee("Feed dict has no SymbolicTensor name: "+G);return this.id2Value[C]},Z.prototype.getMask=function(G){if(G instanceof ga){if(this.id2Value[G.id]==null)throw new ee("Nonexistent key: "+G.name);return this.id2Mask[G.id]}var C=this.name2Id[G];if(C==null)throw new ee("Feed dict has no SymbolicTensor name: "+G);return this.id2Mask[C]},Z.prototype.disposeMasks=function(){this.id2Mask!=null&&Object(b.dispose)(this.id2Mask)},Z}(),Dh={},bm={};function Of(Z,G,C,N){for(var te=C!=null&&C.training,Be=Array.isArray(Z),Ge=Be?Z:[Z],ft=Ge.map(function(ki){return ki.name}),Nt=[],Ut=G.names(),ct=0,yn=ft;ct<yn.length;ct++){var _n=yn[ct];Ut.indexOf(_n)!==-1?Nt.push(G.getValue(_n)):Nt.push(null)}var Nn,Wn,Mn=ft.join(",")+"|"+G.names().join(",");if(Dh[Mn]==null){var tr=function(ki,Ui){b.util.assert(ki!=null&&ki.length>0,function(){return"Expected at least one fetch, got none"});var ha=[],to={};if(ki.length===1){var Wo=Fd(ki[0],Ui);ha=Wo.sorted,to=Wo.recipientMap}else for(var io=new Set,Ja=0,fs=ki;Ja<fs.length;Ja++){for(var fo=Fd(fs[Ja],Ui),va=fo.sorted,ho=fo.recipientMap,cu=0,As=va;cu<As.length;cu++){var So=As[cu];io.has(So.name)||(ha.push(So),io.add(So.name))}var Ma=function(Vo){to[Vo]==null&&(to[Vo]=new Set),ho[Vo].forEach(function(lu){return to[Vo].add(lu)})};for(var cc in ho)Ma(cc)}return{sorted:ha,recipientCounts:function(Vo){var lu={};for(var ao in Vo)lu[ao]=Vo[ao].size;return lu}(to)}}(Ge,G);Nn=tr.sorted,Wn=tr.recipientCounts,Dh[Mn]=Nn,bm[Mn]=Wn}Nn=Dh[Mn],Wn={},te||Object.assign(Wn,bm[Mn]);for(var rr=new Na(G),hr=0;hr<Nn.length;++hr){var Nr=Nn[hr],Vr=Nr.sourceLayer;if(!(Vr instanceof bu)){for(var wr=[],Hr=[],Wr=[],oi=!1,li=0,$r=Nr.inputs;li<$r.length;li++){var Zr=$r[li],pa=rr.getValue(Zr),ea=rr.getMask(Zr);wr.push(pa),Hr.push(ea),ea!=null&&(oi=!0),te||(Wn[Zr.name]--,Wn[Zr.name]!==0||G.hasKey(Zr)||ft.indexOf(Zr.name)!==-1||pa.isDisposed||Zr.sourceLayer.stateful===!0||Wr.push(pa))}oi&&((C=C||{}).mask=Hr[0]);var La=Ae(Vr.apply(wr,C)),Ii=null;Vr.supportsMasking&&(Ii=Vr.computeMask(wr,Hr));for(var ra=bs(Nr),Ya=Array.isArray(ra)?ra:[ra],Sa=0;Sa<Ya.length;++Sa){rr.hasKey(Ya[Sa])||rr.add(Ya[Sa],La[Sa],Array.isArray(Ii)?Ii[0]:Ii);var xo=ft.indexOf(Ya[Sa].name);xo!==-1&&(Nt[xo]=La[Sa])}te||Object(b.dispose)(Wr)}}return rr.disposeMasks(),Be?Nt:Nt[0]}function Fd(Z,G){for(var C=new Set,N=[],te={},Be=0,Ge=G.names();Be<Ge.length;Be++){var ft=Ge[Be];C.add(ft)}var Nt=[],Ut=[];for(Nt.push(Z);Nt.length>0;){var ct=Nt[Nt.length-1];if(C.has(ct.name))Nt.pop();else{var yn=Ut[Ut.length-1]===Nt.length-1;if(ct.inputs.length===0||yn)Nt.pop(),N.push(ct),C.add(ct.name),yn&&Ut.pop();else{Ut.push(Nt.length-1);for(var _n=0,Nn=ct.inputs;_n<Nn.length;_n++){var Wn=Nn[_n];te[Wn.name]==null&&(te[Wn.name]=new Set),te[Wn.name].add(ct.name),C.has(Wn.name)||Nt.push(Wn)}}}}return{sorted:N,recipientMap:te}}function bs(Z){var G;if(Z.sourceLayer.inboundNodes.length===1)G=Z.sourceLayer.output;else{for(var C=null,N=0;N<Z.sourceLayer.inboundNodes.length;++N)for(var te=0,Be=Z.sourceLayer.inboundNodes[N].outputTensors;te<Be.length;te++)if(Be[te].id===Z.id){C=N;break}G=Z.sourceLayer.getOutputAt(C)}return G}function ic(Z,G){return function(C,N,te){var Be=N.length;if(C==null||Array.isArray(C)&&C.length===0)return N.map(function(ft){return null});if(Be===1)return Array.isArray(C)&&C.length===1?C:typeof C=="object"&&N[0]in C?[C[N[0]]]:[C];if(Array.isArray(C)){if(C.length!==Be)throw new Error("Provided "+te+" is an array of "+C.length+" element(s), but the model has "+Be+" outputs. Make sure a set of weights is provided for each model output.");return C}if(typeof C=="object"&&Object.keys(C).length>0&&typeof C[Object.keys(C)[0]]=="object"){var Ge=[];return N.forEach(function(ft){ft in C?Ge.push(C[ft]):Ge.push(null)}),Ge}throw new Error("The model has multiple ("+Be+") outputs, so "+te+" must be either an array with "+Be+" elements or an object with "+N+" keys. Provided "+te+" not understood: "+JSON.stringify(C))}(Z,G,"classWeight")}function Rd(Z,G,C,N){return J(this,void 0,void 0,function(){var te,Be,Ge,ft,Nt;return R(this,function(Ut){switch(Ut.label){case 0:return C==null?[3,2]:(te=Object(b.tidy)(function(){if(Z.shape.length===1)return Z.clone();if(Z.shape.length===2){if(Z.shape[1]>1)return Z.argMax(1);if(Z.shape[1]===1)return Z.reshape([Z.shape[0]]);throw new Error("Encountered unexpected last-dimension size ("+Z.shape[1]+") during handling of class weights. The size is expected to be >= 1.")}throw new Error("Unexpected rank of target (y) tensor ("+Z.rank+") during handling of class weights. The rank is expected to be 1 or 2.")}),ft=(Ge=Array).from,[4,te.data()]);case 1:return Be=ft.apply(Ge,[Ut.sent()]),Object(b.dispose)(te),Nt=[],Be.forEach(function(ct){if(C[ct]==null)throw new Error("classWeight must contain all classes in the training data. The class "+ct+" exists in the data but not in classWeight");Nt.push(C[ct])}),[2,Object(b.tensor1d)(Nt,"float32")];case 2:return[2,null]}})})}function Ip(Z,G){return Object(b.mul)(Z,G)}var Fp=32;function xm(Z,G){var C,N,te=G;C=te.xs,N=te.ys,b.util.assert(C!=null&&N!=null,function(){return"A Dataset iterator for fitDataset() is expected to generate objects of the form `{xs: xVal, ys: yVal}`, where the two values may be `tf.Tensor`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates "+G});var Be=wm("input",Z.inputNames,C),Ge=wm("output",Z.outputNames,N),ft=Be[0].shape[0];b.util.assert(Be.length===Z.inputs.length,function(){return"LayersModel has "+Z.inputs.length+" inputs, but the dataset provides "+Be.length+" inputs.  (Expected input keys: "+JSON.stringify(Z.inputNames)+")"}),b.util.assert(Ge.length===Z.outputs.length,function(){return"LayersModel has "+Z.outputs.length+" outputs, but the dataset provides "+Ge.length+" outputs.  (Expected output keys: "+JSON.stringify(Z.outputNames)+")"});for(var Nt=function(_n){b.util.assert(Be[_n].shape[0]===ft,function(){return"Batch size mismatch: input "+Z.inputNames[_n]+" has "+Be[_n].shape[0]+"; expected  "+ft+" based on input "+Z.inputNames[0]+"."})},Ut=0;Ut<Be.length;Ut++)Nt(Ut);for(var ct=function(_n){b.util.assert(Ge[_n].shape[0]===ft,function(){return"Batch size mismatch: output "+Z.outputNames[_n]+" has "+Ge[_n].shape[0]+"; expected  "+ft+" based on input "+Z.inputNames[0]+"."})},yn=0;yn<Ge.length;yn++)ct(yn);return{xs:Be,ys:Ge}}function wm(Z,G,C){if(C instanceof b.Tensor)return[C];if(Array.isArray(C))return b.util.assert(C.length===G.length,function(){return"Received an array of "+C.length+" Tensors, but expected "+G.length+" to match the "+Z+" keys "+G+"."}),C;for(var N=[],te=0,Be=G;te<Be.length;te++){var Ge=Be[te];if(C[Ge]==null)throw new ee("The feature data generated by the dataset lacks the required "+Z+" key '"+Ge+"'.");N.push(C[Ge])}return N}function qc(Z,G,C){return J(this,void 0,void 0,function(){var N,te,Be,Ge,ft,Nt,Ut,ct,yn,_n,Nn,Wn,Mn,tr,rr,hr,Nr,Vr,wr,Hr,Wr,oi,li,$r,Zr,pa,ea,La,Ii,ra,Ya,Sa,xo,ki;return R(this,function(Ui){switch(Ui.label){case 0:if(N=C.batchesPerEpoch!=null,b.util.assert(Z.optimizer!=null,function(){return"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."}),b.util.assert(C!=null,function(){return"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."}),b.util.assert(C.epochs!=null&&C.epochs>0&&Number.isInteger(C.epochs),function(){return"For fitDataset(), config.epochs is expected to be a positive integer, but got "+C.epochs}),b.util.assert(!N||C.batchesPerEpoch>0&&Number.isInteger(C.batchesPerEpoch),function(){return"For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got "+C.batchesPerEpoch}),b.util.assert(C.validationSplit==null,function(){return"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."}),Z.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");Z.isTraining=!0,Ui.label=1;case 1:return Ui.trys.push([1,,26,27]),te=C.validationData!=null,Be=void 0,Ge=void 0,te&&(zo(C.validationData)?b.util.assert(C.validationBatches==null||C.validationBatches>0&&Number.isInteger(C.validationBatches),function(){return"For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got "+C.validationBatches}):(ft=function(ha){if(ha.length===3)throw new F("Validation with sample weights is not implemented yet.");return{xs:ha[0],ys:ha[1]}}(C.validationData),Be=ft.xs,Ge=ft.ys)),Nt=Z.makeTrainFunction(),Ut=Z.getDedupedMetricsNames(),ct=void 0,ct=te?Ut.slice().concat(Ut.map(function(ha){return"val_"+ha})):Ut.slice(),yn=Ch(C.callbacks,C.yieldEvery),_n=C.verbose==null?1:C.verbose,Nn=El(yn,_n,C.epochs,null,null,function(ha,to){var Wo=null;return to.batchesPerEpoch!=null?Wo=to.batchesPerEpoch:Number.isFinite(ha.size)&&(Wo=ha.size),Wo}(G,C),null,te,ct),Wn=Nn.callbackList,Mn=Nn.history,Wn.setModel(Z),Z.history=Mn,[4,Wn.onTrainBegin()];case 2:return Ui.sent(),Z.stopTraining_=!1,tr=C.initialEpoch==null?0:C.initialEpoch,[4,G.iterator()];case 3:rr=Ui.sent(),Ui.label=4;case 4:return tr<C.epochs?(hr={},[4,Wn.onEpochBegin(tr)]):[3,23];case 5:return Ui.sent(),Nr=0,Vr=0,N?[3,7]:[4,G.iterator()];case 6:rr=Ui.sent(),Ui.label=7;case 7:return!N||Nr<C.batchesPerEpoch?[4,rr.next()]:[3,21];case 8:return wr=Ui.sent(),N&&wr.done?(console.warn("You provided `batchesPerEpoch` as "+C.batchesPerEpoch+", but your dataset iterator ran out of data after "+Nr+" batches; interrupting training. Make sure that your dataset can generate at least `batchesPerEpoch * epochs` batches (in this case, "+C.batchesPerEpoch*C.epochs+" batches). You may need to use the repeat() function when building your dataset."),[3,21]):wr.value==null?[3,15]:(Hr=xm(Z,wr.value),Wr=Hr.xs,oi=Hr.ys,(li={}).batch=Vr,li.size=Wr[0].shape[0],[4,Wn.onBatchBegin(Vr,li)]);case 9:if(Ui.sent(),$r=[],C.classWeight==null)return[3,13];Zr=ic(C.classWeight,Z.outputNames),ki=0,Ui.label=10;case 10:return ki<Zr.length?(ea=(pa=$r).push,[4,Rd(oi[ki],null,Zr[ki])]):[3,13];case 11:ea.apply(pa,[Ui.sent()]),Ui.label=12;case 12:return++ki,[3,10];case 13:for(La=Wr.concat(oi).concat($r),Ii=Nt(La),Object(b.dispose)(La),ki=0;ki<Ut.length;++ki)ra=Ut[ki],Ya=Ii[ki],li[ra]=Ya,Object(b.keep)(Ya);return[4,Wn.onBatchEnd(Vr,li)];case 14:Ui.sent(),xc(li),Vr++,Nr++,Ui.label=15;case 15:return(N?Nr>=C.batchesPerEpoch:wr.done)?te?(Sa=void 0,zo(C.validationData)?(xo=Ae,[4,Z.evaluateDataset(C.validationData,{batches:C.validationBatches})]):[3,17]):[3,19]:[3,20];case 16:return Sa=xo.apply(void 0,[Ui.sent()]),[3,18];case 17:Sa=Ae(Z.evaluate(Be,Ge,{batchSize:C.validationBatchSize==null?Fp:C.validationBatchSize,verbose:0})),Ui.label=18;case 18:for(ki=0;ki<Z.metricsNames.length;++ki)hr["val_"+Z.metricsNames[ki]]=Sa[ki];Ui.label=19;case 19:return[3,21];case 20:return Z.stopTraining_?[3,21]:[3,7];case 21:return[4,Wn.onEpochEnd(tr,hr)];case 22:return Ui.sent(),tr++,Z.stopTraining_?[3,23]:[3,4];case 23:return[4,Wn.onTrainEnd()];case 24:return Ui.sent(),[4,Z.history.syncData()];case 25:return Ui.sent(),[2,Z.history];case 26:return Z.isTraining=!1,[7];case 27:return[2]}})})}function zo(Z){return typeof Z.iterator=="function"}function Th(Z){b.util.assert(Z>0&&Number.isInteger(Z),function(){return"batchSize is required to be a positive integer, but got "+Z})}function Ke(Z,G,C){return Z==null?[null]:Array.isArray(Z)?Z.map(function(N){return Qr(N,G,C-G)}):Qr(Z,G,C-G)}function Lu(Z,G){return Object(b.tidy)(function(){return Z==null?null:Array.isArray(Z)?Z.map(function(C){return Lu(C,G)}):Oa(Z,G.dtype==="int32"?G:G.toInt())})}function Af(Z,G){for(var C=[],N=0,te=null;N<Z;)(te=N+G)>=Z&&(te=Z),C.push([N,te]),N=te;return C}function Md(Z,G,C,N){return N===void 0&&(N={}),J(this,void 0,void 0,function(){var te,Be,Ge,ft,Nt,Ut,ct,yn,_n,Nn,Wn,Mn,tr,rr,hr,Nr,Vr,wr,Hr,Wr,oi,li;return R(this,function($r){switch($r.label){case 0:if(Z.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");Z.isTraining=!0,$r.label=1;case 1:return $r.trys.push([1,,7,8]),Th(yn=N.batchSize==null?32:N.batchSize),_n=!1,[4,Z.standardizeUserData(G,C,N.sampleWeight,N.classWeight,_n,yn)];case 2:if(Nn=$r.sent(),te=Nn[0],Be=Nn[1],ct=Nn[2],Wn=!1,Mn=void 0,!(N.validationData!=null&&N.validationData.length>0))return[3,4];if(Wn=!0,N.validationData.length!==2)throw N.validationData.length===3?new F("validationData including sample weights is not supported yet."):new ee("When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; "+N.validationData+" is invalid.");return Ge=N.validationData[0],ft=N.validationData[1],tr=!0,[4,Z.standardizeUserData(Ge,ft,null,null,tr,yn)];case 3:return rr=$r.sent(),Nt=rr[0],Ut=rr[1],Mn=Nt.concat(Ut),[3,5];case 4:N.validationSplit!=null&&N.validationSplit>0&&N.validationSplit<1?(Wn=!0,hr=Math.floor(te[0].shape[0]*(1-N.validationSplit)),Nr=te[0].shape[0],Nt=Ke(te,hr,Nr),te=Ke(te,0,hr),Ut=Ke(Be,hr,Nr),Be=Ke(Be,0,hr),Mn=Nt.concat(Ut)):N.validationSteps!=null&&(Wn=!0),$r.label=5;case 5:return Vr=te.concat(Be).concat(ct),Z.checkTrainableWeightsConsistency(),wr=Z.makeTrainFunction(),Hr=Z.getDedupedMetricsNames(),Wr=void 0,oi=void 0,Wn?(Z.makeTestFunction(),Wr=Z.testFunction,oi=Hr.slice().concat(Hr.map(function(Zr){return"val_"+Zr}))):(Wr=null,Mn=[],oi=Hr.slice()),li=Ch(N.callbacks,N.yieldEvery),[4,function(Zr,pa,ea,La,Ii,ra,Ya,Sa,xo,ki,Ui,ha,to,Wo,io){return J(this,void 0,void 0,function(){var Ja,fs,fo,va,ho,cu,As,So;return R(this,function(Ma){switch(Ma.label){case 0:return Ii==null&&(Ii=32),ra==null&&(ra=1),Ui==null&&(Ui=!0),to==null&&(to=0),Ja=!1,xo!=null&&ki!=null&&(Ja=!0),io!=null,(fs=Zr.checkNumSamples(ea,Ii,Wo,"steps_per_epoch"))!=null&&(fo=mr(0,fs)),Ya==null&&(Ya=1),va=El(Sa,Ya,ra,to,fs,Wo,Ii,Ja,ha),ho=va.callbackList,cu=va.history,ho.setModel(Zr),Zr.history=cu,[4,ho.onTrainBegin()];case 1:Ma.sent(),Zr.stopTraining_=!1,As=function(cc){var Vo,lu,ao,fu,Ia;return R(this,function(_s){switch(_s.label){case 0:return[4,ho.onEpochBegin(cc)];case 1:if(_s.sent(),Vo={},Wo==null)return[3,2];case 2:if(Ui==="batch")throw new F("batch shuffling is not implemneted yet");Ui&&b.util.shuffle(fo),lu=Object(b.tensor1d)(fo),ao=Af(fs,Ii),fu=function(hs){var ia;return R(this,function(Ss){switch(Ss.label){case 0:return ia={},[4,ho.onBatchBegin(hs,ia)];case 1:return Ss.sent(),Object(b.tidy)(function(){var Ko=ao[hs][0],Gs=ao[hs][1],_c=Qr(lu,Ko,Gs-Ko);ia.batch=hs,ia.size=Gs-Ko;for(var za=Lu(ea,_c),es=pa(za),Mo=0;Mo<La.length;++Mo){var lc=La[Mo],el=es[Mo];ia[lc]=el,Object(b.keep)(el)}if(hs===ao.length-1&&Ja){var ci=Zr.testLoop(xo,ki,Ii);for(Mo=0;Mo<La.length;++Mo)lc=La[Mo],el=ci[Mo],Object(b.keep)(el),Vo["val_"+lc]=el}}),[4,ho.onBatchEnd(hs,ia)];case 2:return Ss.sent(),xc(ia),Zr.stopTraining_?[2,"break"]:[2]}})},Ia=0,_s.label=3;case 3:return Ia<ao.length?[5,fu(Ia)]:[3,6];case 4:if(_s.sent()==="break")return[3,6];_s.label=5;case 5:return++Ia,[3,3];case 6:lu.dispose(),_s.label=7;case 7:return[4,ho.onEpochEnd(cc,Vo)];case 8:return _s.sent(),Zr.stopTraining_?[2,"break"]:[2]}})},So=to,Ma.label=2;case 2:return So<ra?[5,As(So)]:[3,5];case 3:if(Ma.sent()==="break")return[3,5];Ma.label=4;case 4:return++So,[3,2];case 5:return[4,ho.onTrainEnd()];case 6:return Ma.sent(),[4,Zr.history.syncData()];case 7:return Ma.sent(),[2,Zr.history]}})})}(Z,wr,Vr,Hr,yn,N.epochs,N.verbose,li,Wr,Mn,N.shuffle,oi,N.initialEpoch,null,null)];case 6:return[2,$r.sent()];case 7:return Z.isTraining=!1,_a(te,G),_a(Be,C),_a(Nt,Ge),_a(Ut,ft),ct!=null&&Object(b.dispose)(ct),[7];case 8:return[2]}})})}function Aa(Z){var G=[];Z instanceof b.Tensor&&(Z=[Z]);for(var C=0;C<Z.length;++C){var N=Z[C];if(N.rank===1)G.push(gr(N,1));else{if(N.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");G.push(N)}}return G}function _a(Z,G){if(Z!=null){var C=[];if(G instanceof b.Tensor)C.push(G.id);else if(Array.isArray(G))G.forEach(function(Nt){return C.push(Nt.id)});else if(G!=null)for(var N in G){var te=G[N];C.push(te.id)}var Be=[];if(Z instanceof b.Tensor)C.indexOf(Z.id)===-1&&Be.push(Z);else if(Array.isArray(Z))Z.forEach(function(Nt){C.indexOf(Nt.id)===-1&&Be.push(Nt)});else if(Z!=null)for(var Ge in Z){var ft=Z[Ge];C.indexOf(ft.id)===-1&&Be.push(ft)}Be.forEach(function(Nt){Nt.isDisposed||Nt.dispose()})}}function Ga(Z){return Array.isArray(Z)}function Co(Z){return!function(G){return G instanceof b.Tensor}(Z)&&!Ga(Z)}function wu(Z,G,C,N,te){if(te===void 0&&(te=""),G==null||G.length===0){if(Z!=null){var Be=!1;if(Ga(Z)&&Z.length>0)Be=!0;else if(Co(Z)){for(var Ge in Z)if(Z.hasOwnProperty(Ge)){Be=!0;break}}else Be=!0;if(Be)throw new ee("Error when checking model "+te+" expected no data, but got "+Z)}return[]}if(Z==null)return G.map(function(tr){return null});var ft;if(Co(Z)){Z=Z,ft=[];for(var Nt=0,Ut=G;Nt<Ut.length;Nt++){var ct=Ut[Nt];if(Z[ct]==null)throw new ee('No data provided for "'+ct+'". Need data for each key in: '+G);ft.push(Z[ct])}}else if(Ga(Z)){if((Z=Z).length!==G.length)throw new ee("Error when checking model "+te+": the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see "+G.length+" Tensor(s), but instead got the following list of Tensor(s): "+Z);ft=Z}else{if(Z=Z,G.length>1)throw new ee("The model "+te+" expects "+G.length+" Tensor(s), but only received one Tensor. Found: Tensor with shape "+Z.shape);ft=[Z]}if(ft=Aa(ft),C!=null){for(var yn=0;yn<G.length;++yn)if(C[yn]!=null){var _n=ft[yn];if(_n.shape.length!==C[yn].length)throw new ee("Error when checking "+te+": expected "+G[yn]+" to have "+C[yn].length+" dimension(s). but got array with shape "+_n.shape);for(var Nn=0;Nn<C[yn].length;++Nn)if(Nn!==0||N){var Wn=_n.shape[Nn],Mn=C[yn][Nn];if(Mn!=null&&Mn>=0&&Wn!==Mn)throw new ee("Error when checking "+te+": expected "+G[yn]+" to have shape ["+C[yn]+"], but got array with shape ["+_n.shape+"].")}}}return ft}function Oo(Z,G,C,N,te){var Be;if(N===void 0&&(N=!0),te===void 0&&(te=""),Array.isArray(Z)){if(Z.length!==G.length)throw new ee("Error when checking model "+te+": the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see "+G.length+" Tensor(s), but instead got "+Z.length+" Tensors(s).");Be=Z}else{if(G.length>1)throw new ee("The model expects "+G.length+" "+te+" Tensors, but only received one Tensor. Found: array with shape "+JSON.stringify(Z.shape)+".");Be=[Z]}if(C!=null){for(var Ge=0;Ge<G.length;++Ge)if(C[Ge]!=null){var ft=Be[Ge];if(ft.shape.length!==C[Ge].length)throw new ee("Error when checking "+te+": expected "+G[Ge]+" to have "+C[Ge].length+" dimension(s), but got array with shape "+JSON.stringify(ft.shape));for(var Nt=0;Nt<C[Ge].length;++Nt)if(Nt!==0||N){var Ut=ft.shape[Nt],ct=C[Ge][Nt];if(ct!=null&&ct!==Ut)throw new ee("Error when checking "+te+": expected "+G[Ge]+" to have shape "+JSON.stringify(C[Ge])+" but got array with shape "+JSON.stringify(ft.shape)+".")}}}}var kc=function(Z){function G(C){var N=Z.call(this,C)||this;return N.isTraining=!1,N}return U(G,Z),G.prototype.summary=function(C,N,te){if(te===void 0&&(te=console.log),!this.built)throw new ee("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");Cf(this,C,N,te)},G.prototype.compile=function(C){var N=this;if(C.loss==null&&(C.loss=[]),this.loss=C.loss,typeof C.optimizer=="string")this.optimizer_=function(tr){var rr={Adagrad:function(){return b.train.adagrad(.01)},Adadelta:function(){return b.train.adadelta(1,.95,P())},Adam:function(){return b.train.adam(.001,.9,.999,P())},Adamax:function(){return b.train.adamax(.002,.9,.999,P(),0)},RMSProp:function(){return b.train.rmsprop(.001,.9,0,P())},SGD:function(){return b.train.sgd(.01)}};if(rr.adagrad=rr.Adagrad,rr.adadelta=rr.Adadelta,rr.adam=rr.Adam,rr.adamax=rr.Adamax,rr.rmsprop=rr.RMSProp,rr.sgd=rr.SGD,tr in rr)return rr[tr]();throw new ee("Unknown Optimizer "+tr)}(C.optimizer),this.isOptimizerOwned=!0;else{if(!(C.optimizer instanceof b.Optimizer))throw new ee("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=C.optimizer,this.isOptimizerOwned=!1}var te=[];if(Array.isArray(C.loss)||typeof C.loss=="string"||typeof C.loss=="function")if(Array.isArray(C.loss)){if(C.loss.length!==this.outputs.length)throw new ee("When passing an Array as loss, it should have one entry per model output. The model has "+this.outputs.length+" output(s), but you passed loss="+C.loss+".");var Be=C.loss;te=Be.map(function(tr){return Oh(tr)})}else{var Ge=Oh(C.loss);this.outputs.forEach(function(tr){te.push(Ge)})}else{for(var ft in C.loss=C.loss,C.loss)if(this.outputNames.indexOf(ft)===-1)throw new ee('Unknown entry in loss dictionary: "'+ft+'". Only expected the following keys: '+this.outputNames);for(var Nt=0,Ut=this.outputNames;Nt<Ut.length;Nt++){var ct=Ut[Nt];C.loss[ct]==null&&console.warn('Output "'+ct+'" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to '+ct+" during training"),te.push(Oh(C.loss[ct]))}}this.lossFunctions=te,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(var yn=0;yn<this.outputs.length;++yn){var _n=this.internalOutputShapes[yn],Nn=this.outputNames[yn];this.feedOutputNames.push(Nn),this.feedOutputShapes.push(_n),this.feedLossFns.push(this.lossFunctions[yn])}var Wn=[];this.metrics=C.metrics,this.metricsNames=["loss"],this.metricsTensors=[],Xn("loss",function(){for(var tr=0;tr<N.outputs.length;++tr)if(Wn.indexOf(tr)===-1){var rr=N.lossFunctions[tr];N.outputs.length>1&&(N.metricsTensors.push([rr,tr]),N.metricsNames.push(N.outputNames[tr]+"_loss"))}});var Mn=function(tr,rr){if(tr==null||Array.isArray(tr)&&tr.length===0)return rr.map(function(oi){return[]});var hr;if(typeof tr=="string"||typeof tr=="function")hr=[tr];else{if(!Array.isArray(tr)&&typeof tr!="object")throw new TypeError("Type of metrics argument not understood. Expected an string,function, Array, or Object, found: "+tr);hr=tr}if(Array.isArray(hr))return rr.map(function(oi){return hr});for(var Nr=[],Vr=0,wr=rr;Vr<wr.length;Vr++){var Hr=wr[Vr],Wr=hr.hasOwnProperty(Hr)?hr[Hr]:[];Array.isArray(Wr)||(Wr=[Wr]),Nr.push(Wr)}return Nr}(C.metrics,this.outputNames);Xn("metric",function(){for(var tr=function(hr){if(Wn.indexOf(hr)!==-1)return"continue";(function(Nr){for(var Vr,wr,Hr,Wr=function($r){if(typeof $r=="string"&&["accuracy","acc","crossentropy","ce"].indexOf($r)!==-1){var Zr=N.internalOutputShapes[hr];Zr[Zr.length-1]===1||N.lossFunctions[hr]===Cl?["accuracy","acc"].indexOf($r)!==-1?wr=bf:["crossentropy","ce"].indexOf($r)!==-1&&(wr=wf):N.lossFunctions[hr]===nc?["accuracy","acc"].indexOf($r)!==-1?wr=kf:["crossentropy","ce"].indexOf($r)!==-1&&(wr=Ef):["accuracy","acc"].indexOf($r)!==-1?wr=xf:["crossentropy","ce"].indexOf($r)!==-1&&(wr=ys);var pa=void 0;["accuracy","acc"].indexOf($r)!==-1?pa="acc":["crossentropy","ce"].indexOf($r)!==-1&&(pa="ce"),Hr=wr,Vr=""+pa}else{var ea=function(Ii){if(typeof Ii=="string"&&Ii in or)return or[Ii];if(typeof Ii!="string"&&Ii!=null)return Ii;throw new ee("Unknown metric "+Ii)}($r);Hr=ea,Vr=""+xu($r)}var La;Xn(Vr,function(){La=Hr}),function(Ii,ra,Ya){N.outputNames.length>1&&(ra=N.outputNames[Ii]+"_"+ra),N.metricsNames.push(ra),N.metricsTensors.push([Ya,Ii])}(hr,Vr,La)},oi=0,li=Mn[hr];oi<li.length;oi++)Wr(li[oi])})()},rr=0;rr<N.outputs.length;++rr)tr(rr)}),this.collectedTrainableWeights=this.trainableWeights},G.prototype.checkTrainableWeightsConsistency=function(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")},G.prototype.evaluate=function(C,N,te){te===void 0&&(te={});var Be=te.batchSize==null?32:te.batchSize;Th(Be);var Ge=this.standardizeUserDataXY(C,N,!0,Be);try{var ft=Ge[0].concat(Ge[1]);this.makeTestFunction();var Nt=this.testFunction;return pe(this.testLoop(Nt,ft,Be,te.verbose,te.steps))}finally{_a(Ge[0],C),_a(Ge[1],N)}},G.prototype.evaluateDataset=function(C,N){return J(this,void 0,void 0,function(){return R(this,function(te){return this.makeTestFunction(),[2,function(Be,Ge,ft){return J(this,void 0,void 0,function(){var Nt,Ut,ct,yn,_n,Nn,Wn,Mn,tr,rr;return R(this,function(hr){switch(hr.label){case 0:if(Nt=(ft=ft||{}).batches!=null,Ut=Be.testFunction,ct=[],ft.verbose>0)throw new F("Verbose mode is not implemented yet.");return b.util.assert(!Nt||ft.batches>0&&Number.isInteger(ft.batches),function(){return"Test loop expects `batches` to be a positive integer, but received "+JSON.stringify(ft.batches)}),function(Nr){return typeof Nr.next=="function"}(Ge)?(_n=Ge,[3,3]):[3,1];case 1:return[4,Ge.iterator()];case 2:_n=hr.sent(),hr.label=3;case 3:yn=_n,Nn=0,Wn=0,Mn=function(){var Nr;return R(this,function(Vr){switch(Vr.label){case 0:return[4,yn.next()];case 1:return Nr=Vr.sent(),ct=Object(b.tidy)(function(){if(Nr.value){var wr=xm(Be,Nr.value),Hr=wr.xs,Wr=wr.ys,oi=Hr.concat(Wr),li=Object(b.tidy)(function(){return Ut(oi)});if(Object(b.dispose)(oi),Wn===0)for(var $r=0;$r<li.length;++$r)ct.push(Object(b.scalar)(0));var Zr=oi[0].shape[0],pa=function(ea){var La=li[ea],Ii=ct[ea];ct[ea]=Object(b.tidy)(function(){return Object(b.add)(ct[ea],Object(b.mul)(Zr,La))}),Wn>0&&Object(b.dispose)(Ii)};for($r=0;$r<li.length;++$r)pa($r);Object(b.dispose)(li),Nn+=Zr,++Wn}return ct}),Nr.done?(Nt&&console.warn("Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least `batches` batches (in this case, "+ft.batches+" batches). You may need to use the repeat() function when building your dataset."),[2,"break"]):[2]}})},hr.label=4;case 4:return!Nt||Wn<ft.batches?[5,Mn()]:[3,6];case 5:return hr.sent()==="break"?[3,6]:[3,4];case 6:for(tr=0;tr<ct.length;++tr)rr=ct[tr],ct[tr]=Object(b.div)(ct[tr],Nn),Object(b.dispose)(rr);return[2,pe(ct)]}})})}(this,C,N)]})})},G.prototype.checkNumSamples=function(C,N,te,Be){var Ge;if(Be===void 0&&(Be="steps"),te!=null){if(Ge=null,N!=null)throw new ee("If "+Be+" is set, batchSize must be null or undefined.Got batchSize = "+N)}else{if(C==null)throw new ee("Either the input data should have a defined shape, or "+Be+" shoud be specified.");Ge=Array.isArray(C)?C[0].shape[0]:C.shape[0]}return Ge},G.prototype.execute=function(C,N){if(Array.isArray(N)&&N.length===0)throw new ee("`outputs` is an empty Array, which is not allowed.");var te=Array.isArray(N),Be=te?N:[N],Ge=this.retrieveSymbolicTensors(Be),ft=new Na;if(C instanceof b.Tensor&&(C=[C]),Array.isArray(C)){if(C.length!==this.inputs.length)throw new ee("The number of inputs provided ("+C.length+") does not match the number of inputs of this model ("+this.inputs.length+").");for(var Nt=0;Nt<this.inputs.length;++Nt)ft.add(this.inputs[Nt],C[Nt])}else for(var Ut=0,ct=this.inputs;Ut<ct.length;Ut++){var yn=ct[Ut],_n=C[yn.name];if(_n==null)throw new ee("No value is provided for the model's input "+yn.name);ft.add(yn,_n)}var Nn=Of(Ge,ft);return te?Nn:Nn[0]},G.prototype.retrieveSymbolicTensors=function(C){for(var N=ie(null,C.length),te=C.length,Be=0,Ge=this.layers;Be<Ge.length;Be++){for(var ft=Ge[Be],Nt=Array.isArray(ft.output)?ft.output:[ft.output],Ut=Nt.map(function(Nn){return Nn.name}),ct=0;ct<C.length;++ct){var yn=Ut.indexOf(C[ct]);if(yn!==-1&&(N[ct]=Nt[yn],te--),te===0)break}if(te===0)break}if(te>0){var _n=[];throw N.forEach(function(Nn,Wn){Nn==null&&_n.push(C[Wn])}),new ee("Cannot find SymbolicTensors for output name(s): "+JSON.stringify(_n))}return N},G.prototype.predictLoop=function(C,N,te){var Be=this;return N===void 0&&(N=32),te===void 0&&(te=!1),Object(b.tidy)(function(){var Ge=Be.checkNumSamples(C);if(te)throw new F("Verbose predictLoop() is not implemented yet.");for(var ft=Af(Ge,N),Nt=Be.outputs.map(function(yn){return[]}),Ut=function(yn){Object(b.tidy)(function(){var _n=ft[yn][0],Nn=ft[yn][1],Wn=Ke(C,_n,Nn),Mn=[];if(Array.isArray(Wn))for(var tr=0;tr<Wn.length;++tr)Mn.push({key:Be.inputs[tr],value:Wn[tr]});else Mn.push({key:Be.inputs[0],value:Wn});var rr=new Na(Mn);return Of(Be.outputs,rr)}).forEach(function(_n,Nn){return Nt[Nn].push(_n)})},ct=0;ct<ft.length;++ct)Ut(ct);return pe(Nt.map(function(yn){return Object(b.concat)(yn,0)}))})},G.prototype.predict=function(C,N){N===void 0&&(N={});var te=Aa(C);Oo(te,this.inputNames,this.feedInputShapes,!1);try{var Be=N.batchSize==null?32:N.batchSize;return Th(Be),this.predictLoop(te,Be)}finally{_a(te,C)}},G.prototype.predictOnBatch=function(C){Oo(C,this.inputNames,this.feedInputShapes,!0);var N=(Array.isArray(C)?C[0]:C).shape[0];return this.predictLoop(C,N)},G.prototype.standardizeUserDataXY=function(C,N,te,Be){if(this.optimizer_==null)throw new L("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");for(var Ge=[],ft=0;ft<this.feedOutputShapes.length;++ft){var Nt=this.feedOutputShapes[ft];this.feedLossFns[ft]===nc?Ge.push(Nt.slice(0,Nt.length-1).concat([1])):Ge.push(Nt)}if(function(Ut,ct,yn){var _n=$t(Ut.map(function(Wn){return Wn.shape[0]}));_n.sort();var Nn=$t(ct.map(function(Wn){return Wn.shape[0]}));if(Nn.sort(),_n.length>1)throw new ee("All input Tensors (x) should have the same number of samples. Got array shapes: "+JSON.stringify(Ut.map(function(Wn){return Wn.shape})));if(Nn.length>1)throw new ee("All target Tensors (y) should have the same number of samples. Got array shapes: "+JSON.stringify(ct.map(function(Wn){return Wn.shape})));if(_n.length>0&&Nn.length>0&&!b.util.arraysEqual(_n,Nn))throw new ee("Input Tensors should have the same number of samples as target Tensors. Found "+_n[0]+" input sample(s) and "+Nn[0]+" target sample(s).")}(C=wu(C,this.feedInputNames,this.feedInputShapes,!1,"input"),N=wu(N,this.feedOutputNames,Ge,!1,"target")),function(Ut,ct,yn){for(var _n=[so,Cl,Eo],Nn=0;Nn<Ut.length;++Nn){var Wn=Ut[Nn],Mn=ct[Nn],tr=yn[Nn];if(Mn!=null){if(Mn===Eo&&Wn.shape[Wn.shape.length-1]===1)throw new ee("You are passing a target array of shape "+Wn.shape+" while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].");if(_n.indexOf(Mn)!==-1)for(var rr=Wn.shape.slice(1),hr=tr.slice(1),Nr=0;Nr<rr.length;++Nr){var Vr=rr[Nr],wr=hr[Nr];if(wr!=null&&Vr!==wr)throw new ee("A target Tensor with shape "+Wn.shape+" was passed for an output of shape "+tr+", while using a loss function that expects targets to have the same shape as the output.")}}}}(N,this.feedLossFns,this.feedOutputShapes),this.stateful&&Be!=null&&Be>0&&C[0].shape[0]%Be!=0)throw new ee("In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size "+Be+". Found: "+C[0].shape[0]+" sample(s).");return[C,N]},G.prototype.standardizeUserData=function(C,N,te,Be,Ge,ft){return Ge===void 0&&(Ge=!0),J(this,void 0,void 0,function(){var Nt,Ut,ct,yn,_n,Nn,Wn,Mn;return R(this,function(tr){switch(tr.label){case 0:if(Nt=this.standardizeUserDataXY(C,N,Ge,ft),Ut=Nt[0],ct=Nt[1],te!=null)throw new Error("sample weight is not supported yet.");if(yn=null,Be==null)return[3,4];_n=ic(Be,this.outputNames),yn=[],Nn=0,tr.label=1;case 1:return Nn<_n.length?(Mn=(Wn=yn).push,[4,Rd(ct[Nn],null,_n[Nn])]):[3,4];case 2:Mn.apply(Wn,[tr.sent()]),tr.label=3;case 3:return++Nn,[3,1];case 4:return[2,[Ut,ct,yn]]}})})},G.prototype.testLoop=function(C,N,te,Be,Ge){var ft=this;return Be===void 0&&(Be=0),Object(b.tidy)(function(){var Nt=ft.checkNumSamples(N,te,Ge,"steps"),Ut=[];if(Be>0)throw new F("Verbose mode is not implemented yet.");if(Ge!=null)throw new F("steps mode in testLoop() is not implemented yet");for(var ct=Af(Nt,te),yn=Object(b.tensor1d)(mr(0,Nt)),_n=0;_n<ct.length;++_n){var Nn=ct[_n][0],Wn=ct[_n][1],Mn=Qr(yn,Nn,Wn-Nn),tr=Lu(N,Mn),rr=C(tr);if(_n===0)for(var hr=0;hr<rr.length;++hr)Ut.push(Object(b.scalar)(0));for(hr=0;hr<rr.length;++hr){var Nr=rr[hr];Ut[hr]=Object(b.add)(Ut[hr],Object(b.mul)(Wn-Nn,Nr))}}for(hr=0;hr<Ut.length;++hr)Ut[hr]=Object(b.div)(Ut[hr],Nt);return Ut})},G.prototype.getDedupedMetricsNames=function(){for(var C=this.metricsNames,N=[],te=0;te<C.length;++te){var Be=C[te],Ge=Be;he(C,Be)>1&&(Ge+="_"+he(C.slice(0,te),Be)),N.push(Ge)}return N},G.prototype.makeTrainFunction=function(){var C=this;return function(N){var te=[],Be=N.slice(0,C.inputs.length),Ge=N.slice(C.inputs.length,C.inputs.length+C.outputs.length),ft=N.slice(C.inputs.length+C.outputs.length,C.inputs.length+2*C.outputs.length),Nt=[],Ut=C.collectedTrainableWeights.map(function(ct){return ct.read()});return[C.optimizer_.minimize(function(){for(var ct=[],yn=0;yn<C.inputs.length;++yn)ct.push({key:C.inputs[yn],value:Be[yn]});var _n,Nn=new Na(ct),Wn=Of(C.outputs,Nn,{training:!0});for(yn=0;yn<C.lossFunctions.length;++yn){var Mn=(0,C.lossFunctions[yn])(Ge[yn],Wn[yn]);ft[yn]!=null&&(Mn=Ip(Mn,ft[yn]));var tr=Object(b.mean)(Mn);te.push(tr),_n=yn===0?Mn:Object(b.add)(_n,Mn)}for(yn=0;yn<C.metricsTensors.length;++yn){var rr=void 0;if(C.outputs.length>1&&yn<C.outputs.length)rr=te[yn];else{var hr=C.metricsTensors[yn][0],Nr=C.metricsTensors[yn][1];rr=Object(b.mean)(hr(Ge[Nr],Wn[Nr]))}Object(b.keep)(rr),Nt.push(rr)}return _n=Object(b.mean)(_n),C.calculateLosses().forEach(function(Vr){_n=Object(b.add)(_n,Vr)}),_n},!0,Ut)].concat(Nt)}},G.prototype.makeTestFunction=function(){var C=this;this.testFunction=function(N){return Object(b.tidy)(function(){for(var te,Be=[],Ge=N.slice(0,C.inputs.length),ft=N.slice(C.inputs.length,C.inputs.length+C.outputs.length),Nt=[],Ut=0;Ut<C.inputs.length;++Ut)Nt.push({key:C.inputs[Ut],value:Ge[Ut]});var ct=new Na(Nt),yn=Of(C.outputs,ct);for(Ut=0;Ut<C.lossFunctions.length;++Ut){var _n=C.lossFunctions[Ut],Nn=Object(b.mean)(_n(ft[Ut],yn[Ut]));te=Ut===0?Nn:Object(b.add)(te,Nn),Be.push(te)}for(Ut=0;Ut<C.metricsTensors.length;++Ut){var Wn=C.metricsTensors[Ut][0],Mn=C.metricsTensors[Ut][1],tr=Object(b.mean)(Wn(ft[Mn],yn[Mn]));Be.push(tr)}return Be})}},G.prototype.fit=function(C,N,te){return te===void 0&&(te={}),J(this,void 0,void 0,function(){return R(this,function(Be){return[2,Md(this,C,N,te)]})})},G.prototype.fitDataset=function(C,N){return J(this,void 0,void 0,function(){return R(this,function(te){return[2,qc(this,C,N)]})})},G.prototype.trainOnBatch=function(C,N){return J(this,void 0,void 0,function(){var te,Be,Ge,ft,Nt,Ut,ct,yn,_n;return R(this,function(Nn){switch(Nn.label){case 0:return[4,this.standardizeUserData(C,N)];case 1:te=Nn.sent(),Be=te[0],Ge=te[1],ft=this.makeTrainFunction(),Nt=ft(Be.concat(Ge)),Ut=[],ct=0,yn=Nt,Nn.label=2;case 2:return ct<yn.length?[4,yn[ct].data()]:[3,5];case 3:_n=Nn.sent(),Ut.push(_n[0]),Nn.label=4;case 4:return ct++,[3,2];case 5:return Object(b.dispose)(Nt),[2,pe(Ut)]}})})},G.prototype.getNamedWeights=function(C){for(var N=[],te=C!=null&&C.trainableOnly,Be=te?this.trainableWeights:this.weights,Ge=this.getWeights(te),ft=0;ft<Be.length;++ft)te&&!Be[ft].trainable||N.push({name:Be[ft].originalName,tensor:Ge[ft]});return N},Object.defineProperty(G.prototype,"stopTraining",{get:function(){return this.stopTraining_},set:function(C){this.stopTraining_=C},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"optimizer",{get:function(){return this.optimizer_},set:function(C){this.optimizer_!==C&&(this.optimizer_=C,this.isOptimizerOwned=!1)},enumerable:!0,configurable:!0}),G.prototype.dispose=function(){var C=Z.prototype.dispose.call(this);if(C.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){var N=Object(b.memory)().numTensors;this.optimizer_.dispose(),C.numDisposedVariables+=N-Object(b.memory)().numTensors}return C},G.prototype.getLossIdentifiers=function(){var C;if(typeof this.loss=="string")C=Te(this.loss);else if(Array.isArray(this.loss)){for(var N=0,te=this.loss;N<te.length;N++)if(typeof te[N]!="string")throw new Error("Serialization of non-string loss is not supported.");C=this.loss.map(function(ct){return Te(ct)})}else{var Be=Object.keys(this.loss);C={};for(var Ge=this.loss,ft=0,Nt=Be;ft<Nt.length;ft++){var Ut=Nt[ft];if(typeof Ge[Ut]!="string")throw new Error("Serialization of non-string loss is not supported.");C[Ut]=Te(Ge[Ut])}}return C},G.prototype.getMetricIdentifiers=function(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[Te(xu(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(function(te){return Te(xu(te))});var C={};for(var N in this.metrics)C[N]=Te(xu(this.metrics[N]));return C},G.prototype.getTrainingConfig=function(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}},G.prototype.loadTrainingConfig=function(C){if(C.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(C.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(C.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");var N,te,Be=Io(Fi(C.optimizer_config));if(typeof C.loss=="string")N=je(C.loss);else if(Array.isArray(C.loss))N=C.loss.map(function(ft){return je(ft)});else if(C.loss!=null)for(var Ge in N={},C.loss)N[Ge]=je(C.loss[Ge]);if(Array.isArray(C.metrics))te=C.metrics.map(function(ft){return je(ft)});else if(C.metrics!=null)for(var Ge in te={},C.metrics)te[Ge]=je(C.metrics[Ge]);this.compile({loss:N,metrics:te,optimizer:Be})},G.prototype.save=function(C,N){return J(this,void 0,void 0,function(){var te,Be,Ge,ft,Nt,Ut,ct,yn,_n,Nn,Wn,Mn,tr,rr;return R(this,function(hr){switch(hr.label){case 0:if(typeof C=="string"){if((te=b.io.getSaveHandlers(C)).length===0)throw new ee("Cannot find any save handlers for URL '"+C+"'");if(te.length>1)throw new ee("Found more than one ("+te.length+") save handlers for URL '"+C+"'");C=te[0]}if(C.save==null)throw new ee("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return[4,b.io.encodeWeights(this.getNamedWeights(N))];case 1:return Be=hr.sent(),Ge=!1,ft=null,Nt=this.toJSON(ft,Ge),Ut={modelTopology:Nt,format:"layers-model",generatedBy:"TensorFlow.js tfjs-layers v1.7.4",convertedBy:null},N!=null&&N.includeOptimizer&&this.optimizer!=null?(Ut.trainingConfig=this.getTrainingConfig(),ct="optimizer",Mn=(Wn=b.io).encodeWeights,[4,this.optimizer.getWeights()]):[3,4];case 2:return[4,Mn.apply(Wn,[hr.sent(),ct])];case 3:yn=hr.sent(),_n=yn.data,Nn=yn.specs,(rr=Be.specs).push.apply(rr,Nn),Be.data=b.io.concatenateArrayBuffers([Be.data,_n]),hr.label=4;case 4:return this.userDefinedMetadata!=null&&(tr=!0,Np(this.userDefinedMetadata,this.name,tr),Ut.userDefinedMetadata=this.userDefinedMetadata),Ut.weightData=Be.data,Ut.weightSpecs=Be.specs,[2,C.save(Ut)]}})})},G.prototype.setUserDefinedMetadata=function(C){Np(C,this.name),this.userDefinedMetadata=C},G.prototype.getUserDefinedMetadata=function(){return this.userDefinedMetadata},G.className="Model",G}(function(Z){function G(C){var N=Z.call(this,{})||this;if(N.containerNodes=new Set,N.name=C.name,N.name==null){var te=N.getClassName().toLowerCase();N.name=Qi(te)}if(N.supportsMasking=!1,N.trainable_=!0,Array.isArray(C.inputs)?N.inputs=C.inputs.slice():N.inputs=[C.inputs],Array.isArray(C.outputs)?N.outputs=C.outputs.slice():N.outputs=[C.outputs],$t(N.inputs).length!==N.inputs.length)throw new ee("The list of inputs passed to the model is redundant. All inputs should only appear once. Found: "+N.inputs.map(function(ia){return ia.name}));$t(N.outputs).length!==N.outputs.length&&console.warn("The list of outputs passed to the model is redundant. All outputs should only appear once. Found: "+N.outputs.map(function(ia){return ia.name})),N.inputLayers=[],N.inputLayersNodeIndices=[],N.inputLayersTensorIndices=[],N.outputLayers=[],N.outputLayersNodeIndices=[],N.outputLayersTensorIndices=[],N.layers=[],N.internalContainerRefs=[];for(var Be=0,Ge=N.outputs;Be<Ge.length;Be++){var ft=($r=Ge[Be]).sourceLayer,Nt=$r.nodeIndex,Ut=$r.tensorIndex;N.outputLayers.push(ft),N.outputLayersNodeIndices.push(Nt),N.outputLayersTensorIndices.push(Ut)}for(var ct=0,yn=N.inputs;ct<yn.length;ct++)ft=($r=yn[ct]).sourceLayer,Nt=$r.nodeIndex,Ut=$r.tensorIndex,K(Nt===0,"input layer has >1 nodes"),K(Ut===0,"input layer has >1 tensors"),N.inputLayers.push(ft),N.inputLayersNodeIndices.push(Nt),N.inputLayersTensorIndices.push(Ut);N.inputNames=[],N.outputNames=[],N.feedInputShapes=[],N.feedInputNames=[],N.feedOutputNames=[];for(var _n=0;_n<N.inputLayers.length;_n++){if(!((ft=N.inputLayers[_n])instanceof bu))throw new TypeError("Input layers to a LayersModel must be InputLayer objects. Received inputs: "+C.inputs+". Input "+_n+" (0-based) originates from layer type "+ft.getClassName()+".");N.inputNames.push(ft.name),N.feedInputShapes.push(ft.batchInputShape),N.feedInputNames.push(ft.name)}for(var Nn=0,Wn=N.outputLayers;Nn<Wn.length;Nn++)ft=Wn[Nn],N.outputNames.push(ft.name);N.internalInputShapes=N.inputs.map(function(ia){return ia.shape}),N.internalOutputShapes=N.outputs.map(function(ia){return ia.shape});for(var Mn={},tr={},rr={},hr={},Nr={},Vr=[],wr=function(ia,Ss,Ko,Gs,_c,za){Gs!=null&&_c!=null&&za!=null||(Gs=ia.sourceLayer,_c=ia.nodeIndex,za=ia.tensorIndex);var es=Gs.inboundNodes[_c];if(Ko.indexOf(es)!==-1)throw new L("The tensor "+ia.name+' at layer "'+Gs.name+'" is part of a cycle.');if(Ss.indexOf(es)===-1){N.containerNodes.add(G.nodeKey(Gs,_c)),Gs.id in Nr||(Nr[Gs.id]=Object.keys(Nr).length),Ko.indexOf(es)===-1&&Ko.push(es);for(var Mo=es.inboundLayers.length,lc=0;lc<Mo;lc++){var el=es.inputTensors[lc],ci=es.inboundLayers[lc],Xd=es.nodeIndices[lc],tl=es.tensorIndices[lc];wr(el,Ss,Ko,ci,Xd,tl)}for(Ss.push(es);Ko.indexOf(es)>=0;)Ko.splice(Ko.indexOf(es),1);Vr.push(es)}},Hr=[],Wr=[],oi=0,li=N.outputs;oi<li.length;oi++){var $r=li[oi];wr($r,Hr,Wr)}for(var Zr=0,pa=Vr.slice().reverse();Zr<pa.length;Zr++){tr[(Ma=pa[Zr]).id]=Ma,Ma.id in Mn||(Mn[Ma.id]=0);var ea=Mn[Ma.id],La=rr[Ma.outboundLayer.id]==null?0:rr[Ma.outboundLayer.id];for(ea=Math.max(ea,La),rr[Ma.outboundLayer.id]=ea,hr[Ma.outboundLayer.id]=Ma.outboundLayer,Mn[Ma.id]=ea,_n=0;_n<Ma.inboundLayers.length;_n++){var Ii=Ma.inboundLayers[_n],ra=(Nt=Ma.nodeIndices[_n],Ii.inboundNodes[Nt]),Ya=Mn[ra.id]==null?0:Mn[ra.id];Mn[ra.id]=Math.max(ea+1,Ya),tr[ra.id]=ra}}var Sa={};for(var xo in Mn)(ea=Mn[xo])in Sa||(Sa[ea]=[]),Sa[ea].push(tr[xo]);var ki={};for(var Ui in rr)(ea=rr[Ui])in ki||(ki[ea]=[]),ki[ea].push(hr[Ui]);var ha=Object.keys(ki).map(function(ia){return parseInt(ia,10)}).sort(zt);N.layers=[];for(var to=0,Wo=ha;to<Wo.length;to++){var io=ki[ea=Wo[to]];io.sort(function(ia,Ss){var Ko=Nr[ia.id],Gs=Nr[Ss.id];return Ko<Gs?-1:Ko>Gs?1:0});for(var Ja=0,fs=io;Ja<fs.length;Ja++)(ft=fs[Ja])instanceof G&&N.internalContainerRefs.push(ft),N.layers.push(ft)}N.layersByDepth=ki,ha=Object.keys(Sa).map(function(ia){return parseInt(ia,10)}).sort(zt);for(var fo=N.inputs.slice(),va=[],ho=0,cu=ha;ho<cu.length;ho++)for(var As=0,So=Sa[ea=cu[ho]];As<So.length;As++){var Ma;if((ft=(Ma=So[As]).outboundLayer)!=null){for(var cc=0,Vo=Ma.inputTensors;cc<Vo.length;cc++)if($r=Vo[cc],fo.indexOf($r)===-1)throw new L("Graph disconnected: cannot obtain value for tensor "+$r+' at layer "'+ft.name+'". The following previous layers were accessed without issue: '+va);for(var lu=0,ao=Ma.outputTensors;lu<ao.length;lu++)$r=ao[lu],fo.push($r);va.push(ft.name)}}N.nodesByDepth=Sa;for(var fu=N.layers.map(function(ia){return ia.name}),Ia=function(ia){var Ss=fu.filter(function(Ko){return Ko===ia}).length;if(Ss!==1)throw new L('The name "'+ia+'" is used '+Ss+" times in the model. All layer names should be unique. Layer names: "+JSON.stringify(fu))},_s=0,hs=fu;_s<hs.length;_s++)Ia(hs[_s]);return N.outboundNodes=[],N.inboundNodes=[],new vs({outboundLayer:N,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:N.inputs,outputTensors:N.outputs,inputMasks:N.inputs.map(function(ia){return null}),outputMasks:N.outputs.map(function(ia){return null}),inputShapes:N.inputs.map(function(ia){return ia.shape}),outputShapes:N.outputs.map(function(ia){return ia.shape})}),N.built=!0,N._refCount=1,N}return U(G,Z),G.prototype.assertNotDisposed=function(){if(this._refCount===0)throw new Error("Container '"+this.name+"' is already disposed.")},G.prototype.dispose=function(){this.assertNotDisposed();var C={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount==0){for(var N=0,te=this.layers;N<te.length;N++){var Be=te[N];C.numDisposedVariables+=Be.dispose().numDisposedVariables}for(var Ge=0,ft=this.internalContainerRefs;Ge<ft.length;Ge++){var Nt=ft[Ge];C.numDisposedVariables+=Nt.dispose().numDisposedVariables}}return C.refCountAfterDispose=this._refCount,C},Object.defineProperty(G.prototype,"trainable",{get:function(){return this.trainable_},set:function(C){this.layers.forEach(function(N){N._trainableWeights.forEach(function(te){return te.trainable=C})}),this.trainable_=C},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"trainableWeights",{get:function(){if(this._trainableWeights.length>0)throw new ee("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];for(var C=[],N=0,te=this.layers;N<te.length;N++){var Be=te[N];C=C.concat(Be.trainableWeights)}return C},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"nonTrainableWeights",{get:function(){for(var C=[],N=0,te=this.layers;N<te.length;N++){var Be=te[N];C.push.apply(C,Be.nonTrainableWeights)}if(!this.trainable){for(var Ge=[],ft=0,Nt=this.layers;ft<Nt.length;ft++)Be=Nt[ft],Ge.push.apply(Ge,Be.trainableWeights);return Ge.concat(C)}return C},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"weights",{get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)},enumerable:!0,configurable:!0}),G.prototype.loadWeights=function(C,N){N===void 0&&(N=!0);for(var te={},Be=0,Ge=0,ft=this.layers;Ge<ft.length;Ge++)for(var Nt=0,Ut=ft[Ge].weights;Nt<Ut.length;Nt++){var ct=Ut[Nt];if(te[ct.originalName]!=null)throw new ee("Duplicate weight name: "+ct.originalName);te[ct.originalName]=ct,Be++}var yn=[];for(var _n in C){if(te[_n]!=null)yn.push([te[_n],C[_n]]);else if(N)throw new ee("Provided weight data has no target variable: "+_n);delete te[_n]}if(N){var Nn=[];for(var Wn in te)Nn.push(Wn);if(Nn.length>0)throw new ee(Nn.length+" of "+Be+" weights are not set: "+Nn)}ma(yn)},G.prototype.updatedConfig=function(){var C=this.getConfig(),N={};return N.className=this.getClassName(),N.config=C,N.kerasVersion="tfjs-layers 1.7.4",N.backend="TensorFlow.js",N},G.prototype.toJSON=function(C,N){N===void 0&&(N=!0);var te=function Be(Ge,ft){if(Ge==null)return null;if(typeof Ge=="string")return Te(Ge);if(typeof Ge=="number"||typeof Ge=="boolean")return Ge;if(Ge instanceof Array){for(var Nt=[],Ut=Ge.length,ct=0;ct<Ut;++ct){var yn=Ge[ct];Sh(ft,ct,yn)?Nt.push(yn):Nt.push(Be(yn,ft))}return Nt}for(var _n={},Nn=0,Wn=Object.keys(Ge);Nn<Wn.length;Nn++){var Mn=Wn[Nn],tr=Ge[Mn];_n[Te(Mn)]=Mn!=="name"&&Mn!=="className"||typeof tr!="string"?Be(tr,Mn):tr}return _n}(this.updatedConfig());return N?JSON.stringify(te):te},G.prototype.call=function(C,N){var te=this;return Object(b.tidy)(function(){C=Ae(C);for(var Be=new Na,Ge=0;Ge<te.inputs.length;++Ge)Be.add(te.inputs[Ge],C[Ge]);return Of(te.outputs,Be,N)})},G.prototype.computeMask=function(C,N){var te=this;return Object(b.tidy)(function(){var Be;return C=Ae(C),Be=N==null?ie(null,C.length):Ae(N),te.runInternalGraph(C,Be)[1]})},G.prototype.computeOutputShape=function(C){var N=qr(C);if(N.length!==this.inputLayers.length)throw new ee("Invalid inputShape argument "+C+": model has "+this.inputLayers.length+" tensor inputs.");for(var te={},Be=0;Be<N.length;Be++){var Ge=this.inputLayers[Be],ft=N[Be];te[li=Ge.name+"_0_0"]=ft}var Nt=Object.keys(this.nodesByDepth).map(function(Zr){return parseInt(Zr,10)}).sort(zt);if(Nt.length>1)for(var Ut=0,ct=Nt;Ut<ct.length;Ut++)for(var yn=ct[Ut],_n=0,Nn=this.nodesByDepth[yn];_n<Nn.length;_n++){var Wn=Nn[_n];if(Ge=Wn.outboundLayer,this.inputLayers.map(function(Zr){return Zr.id}).indexOf(Ge.id)===-1){for(var Mn=[],tr=0;tr<Wn.inboundLayers.length;tr++){var rr=Wn.inboundLayers[tr],hr=Wn.nodeIndices[tr],Nr=Wn.tensorIndices[tr],Vr=te[li=rr.name+"_"+hr+"_"+Nr];Mn.push(Vr)}var wr=qr(Ge.computeOutputShape(pe(Mn))),Hr=Ge.inboundNodes.indexOf(Wn);for(tr=0;tr<wr.length;tr++)te[li=Ge.name+"_"+Hr+"_"+tr]=wr[tr]}}var Wr=[],oi=[];for(Be=0;Be<this.outputLayers.length;Be++){Ge=this.outputLayers[Be],Hr=this.outputLayersNodeIndices[Be],Nr=this.outputLayersTensorIndices[Be];var li=Ge.name+"_"+Hr+"_"+Nr;oi.push(li)}for(Be=0;Be<oi.length;Be++){var $r=oi[Be];K($r in te),Wr.push(te[$r])}return pe(Wr)},G.prototype.runInternalGraph=function(C,N){N==null&&(N=ie(null,C.length));for(var te={},Be=0;Be<this.inputs.length;++Be){var Ge=this.inputs[Be],ft=C[Be],Nt=N[Be];te[Ge.id]=[ft,Nt]}for(var Ut=0,ct=Object.keys(this.nodesByDepth).map(function(ki){return parseInt(ki,10)}).sort(zt);Ut<ct.length;Ut++)for(var yn=ct[Ut],_n=0,Nn=this.nodesByDepth[yn];_n<Nn.length;_n++){for(var Wn=Nn[_n],Mn=Wn.outboundLayer,tr=Wn.inputTensors,rr=Wn.outputTensors,hr=new Array,Nr=0,Vr=tr;Nr<Vr.length;Nr++)(Ge=Vr[Nr]).id in te&&hr.push(te[Ge.id]);if(hr.length===tr.length){var wr={},Hr=void 0,Wr=void 0,oi=void 0,li=void 0;if(Wn.callArgs!=null&&(wr=Wn.callArgs),hr.length===1){var $r=hr[0],Zr=$r[0],pa=$r[1];wr.mask==null&&(wr.mask=pa),oi=Ae(Mn.call(Zr,wr)),li=Ae(Mn.computeMask(Zr,pa)),Hr=[Zr],Wr=[pa]}else Hr=hr.map(function(ki){return ki[0]}),Wr=hr.map(function(ki){return ki[1]}),wr.mask==null&&(wr.mask=Wr),oi=Ae(Mn.call(Hr,wr)),li=Ae(Mn.computeMask(Hr,Wr));if(Mn.activityRegularizer)throw new F("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(Be=0;Be<rr.length;++Be)Ge=rr[Be],ft=oi[Be],Nt=li[Be],te[Ge.id]=[ft,Nt]}}for(var ea=[],La=[],Ii=[],ra=0,Ya=this.outputs;ra<Ya.length;ra++){K((Ge=Ya[ra]).id in te,"Could not compute output "+Ge.name+" : "+Ge.id);var Sa=te[Ge.id],xo=Sa[0];Nt=Sa[1],Ii.push(xo.shape),ea.push(xo),La.push(Nt)}return[ea,La,Ii]},G.prototype.buildNodeConversionMap=function(C){for(var N,te={},Be=0,Ge=this.layers;Be<Ge.length;Be++){var ft=Ge[Be];N=ft instanceof G?1:0;for(var Nt=0;Nt<ft.inboundNodes.length;Nt++){var Ut=G.nodeKey(ft,Nt);this.containerNodes.has(Ut)&&(te[Ut]=N,N+=1)}}return te},G.prototype.getLayer=function(C,N){if(N!=null){if(this.layers.length<=N)throw new ee("Was asked to retrieve layer at index "+N+", but model only has "+this.layers.length+" layer(s).");return this.layers[N]}if(C==null)throw new ee("Provide either a layer name or layer index");for(var te=0,Be=this.layers;te<Be.length;te++){var Ge=Be[te];if(Ge.name===C)return Ge}throw new ee("No such layer: "+C)},G.prototype.calculateLosses=function(){var C=this;return Object(b.tidy)(function(){for(var N=[],te=0,Be=C.layers;te<Be.length;te++)for(var Ge=Be[te],ft=0;ft<Ge.inboundNodes.length;++ft){var Nt=G.nodeKey(Ge,ft);C.containerNodes.has(Nt)&&N.push.apply(N,Ge.calculateLosses())}return N})},G.prototype.getConfig=function(){for(var C={name:this.name},N=this.buildNodeConversionMap(this.layers),te=[],Be=0,Ge=this.layers;Be<Ge.length;Be++){for(var ft=(wr=Ge[Be]).getClassName(),Nt=wr.getConfig(),Ut=[],ct=0;ct<wr.inboundNodes.length;ct++){var yn=wr.inboundNodes[ct],_n=G.nodeKey(wr,ct),Nn={};if(this.containerNodes.has(_n)){if(yn.callArgs)try{JSON.stringify(yn.callArgs),Nn=yn.callArgs}catch{console.warn("Layer "+wr.name+" was passed non-serializable keyword arguments: "+yn.callArgs+". They will not be included in the serialized model (and thus will be missing at deserialization time)."),Nn={}}if(yn.inboundLayers.length>0){for(var Wn=[],Mn=0;Mn<yn.inboundLayers.length;Mn++){var tr=yn.inboundLayers[Mn],rr=yn.nodeIndices[Mn],hr=yn.tensorIndices[Mn];(Wr=N[G.nodeKey(tr,rr)])==null&&(Wr=0),Wn.push([tr.name,Wr,hr,Nn])}Ut.push(Wn)}}}var Nr={};Nr.name=wr.name,Nr.className=ft,Nr.config=Nt,Nr.inboundNodes=Ut,te.push(Nr)}C.layers=te;var Vr=[];for(Mn=0;Mn<this.inputLayers.length;Mn++){var wr=this.inputLayers[Mn];rr=this.inputLayersNodeIndices[Mn],_n=G.nodeKey(wr,rr),this.containerNodes.has(_n)&&((Wr=N[_n])!==null&&Wr!==void 0||(Wr=0),hr=this.inputLayersTensorIndices[Mn],Vr.push([wr.name,Wr,hr]))}C.inputLayers=Vr;var Hr=[];for(Mn=0;Mn<this.outputLayers.length;Mn++){var Wr;wr=this.outputLayers[Mn],rr=this.outputLayersNodeIndices[Mn],_n=G.nodeKey(wr,rr),this.containerNodes.has(_n)&&((Wr=N[_n])!==null&&Wr!==void 0||(Wr=0),hr=this.outputLayersTensorIndices[Mn],Hr.push([wr.name,Wr,hr]))}return C.outputLayers=Hr,C},G.fromConfig=function(C,N,te,Be){Be===void 0&&(Be=!1);var Ge={},ft={};function Nt(ra,Ya){ra.name in ft?ft[ra.name].push(Ya):ft[ra.name]=[Ya]}function Ut(ra,Ya){for(var Sa,xo=[],ki=0,Ui=Ya;ki<Ui.length;ki++){var ha=Ui[ki],to=ha[0],Wo=ha[1],io=ha[2];if(Sa=ha[3]==null?{}:ha[3],!(to in Ge))return void Nt(ra,Ya);var Ja=Ge[to];if(Ja.inboundNodes.length<=Wo)return void Nt(ra,Ya);var fs=Ja.inboundNodes[Wo];xo.push(fs.outputTensors[io])}xo.length>0&&ra.apply(pe(xo),Sa)}function ct(ra){var Ya=ra.name,Sa=Io(ra,N.customObjects!=null?N.customObjects:{});Sa.setFastWeightInitDuringBuild(Be),Ge[Ya]=Sa,ra.inboundNodes.forEach(function(xo){if(!(xo instanceof Array))throw new ee("Corrupted configuration, expected array for nodeData: "+xo);Nt(Sa,xo)})}for(var yn=N.name,_n=N.layers,Nn=0,Wn=_n;Nn<Wn.length;Nn++)ct(rr=Wn[Nn]);for(;!we(ft);)for(var Mn=0,tr=_n;Mn<tr.length;Mn++){var rr=tr[Mn];if((Ii=Ge[rr.name]).name in ft){var hr=ft[Ii.name];delete ft[Ii.name];for(var Nr=0,Vr=hr;Nr<Vr.length;Nr++)Ut(Ii,Vr[Nr])}}for(var wr=[],Hr=[],Wr=0,oi=N.inputLayers;Wr<oi.length;Wr++){var li=(rr=oi[Wr])[0],$r=rr[1],Zr=rr[2];K(li in Ge);var pa=(Ii=Ge[li]).inboundNodes[$r].outputTensors;wr.push(pa[Zr])}for(var ea=0,La=N.outputLayers;ea<La.length;ea++){var Ii;li=(rr=La[ea])[0],$r=rr[1],Zr=rr[2],K(li in Ge),pa=(Ii=Ge[li]).inboundNodes[$r].outputTensors,Hr.push(pa[Zr])}return new C({inputs:wr,outputs:Hr,name:yn})},Object.defineProperty(G.prototype,"stateful",{get:function(){if(this._stateful)throw new ee("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(var C=0,N=this.layers;C<N.length;C++)if(N[C].stateful)return!0;return!1},enumerable:!0,configurable:!0}),G.prototype.resetStates=function(){var C=this;Object(b.tidy)(function(){C.layers.forEach(function(N){N.stateful&&N.resetStates()})})},G}(qi));function Zs(Z,G){return J(this,void 0,void 0,function(){var C;return R(this,function(N){if(G==null&&(G={}),typeof Z=="string"){if((C=b.io.getLoadHandlers(Z,G.onProgress)).length===0)C.push(b.io.browserHTTPRequest(Z,G));else if(C.length>1)throw new ee("Found more than one ("+C.length+") load handlers for URL '"+Z+"'");Z=C[0]}return[2,function(te,Be,Ge){return J(this,void 0,void 0,function(){var ft,Nt,Ut,ct,yn,_n,Nn,Wn,Mn;return R(this,function(tr){switch(tr.label){case 0:if(Ge==null&&(Ge={}),te.load==null)throw new ee("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");return[4,te.load()];case 1:if(ft=tr.sent(),(Nt=ft.modelTopology).model_config!=null&&(Nt=Nt.model_config),Ut=Ge.strict==null||Ge.strict,ct=ft.weightData!=null&&ft.weightSpecs!=null&&Ut,yn=Io(Fi(Nt),Be,ct),(_n=ft.trainingConfig)!=null&&yn.loadTrainingConfig(_n),ft.userDefinedMetadata!=null&&yn.setUserDefinedMetadata(ft.userDefinedMetadata),ft.weightData==null)return[3,4];if(ft.weightSpecs==null)throw new ee("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");return Nn=function(rr,hr){var Nr=b.io.decodeWeights(rr,hr),Vr={},wr=[];return hr.forEach(function(Hr){Hr.group==="optimizer"?wr.push({name:Hr.name,tensor:Nr[Hr.name]}):Vr[Hr.name]=Nr[Hr.name]}),{modelWeights:Vr,optimizerWeights:wr}}(ft.weightData,ft.weightSpecs),Wn=Nn.modelWeights,Mn=Nn.optimizerWeights,yn.loadWeights(Wn,Ut),yn.optimizer!=null&&Mn.length>0?[4,yn.optimizer.setWeights(Mn)]:[3,3];case 2:tr.sent(),tr.label=3;case 3:Object(b.dispose)(Wn),Object(b.dispose)(Mn.map(function(rr){return rr.tensor})),tr.label=4;case 4:return[2,yn]}})})}(Z,void 0,G)]})})}b.serialization.registerClass(kc);var xt=function(Z){function G(C){var N=Z.call(this,{inputs:[],outputs:[]})||this;if(C=C||{},N.trainable=!0,N.built=!1,N.name=C.name!=null?C.name:Qi("sequential_"),C.layers!=null)for(var te=0,Be=C.layers;te<Be.length;te++){var Ge=Be[te];N.add(Ge)}return N}return U(G,Z),G.prototype.checkShape=function(C){if(C.inboundNodes[0].outputTensors[0].shape.some(function(N){return N<0}))throw new ee("Negative dimension size caused by adding layer "+C.name+" with input shape ["+C.inboundNodes[0].inputTensors[0].shape+"]")},G.prototype.add=function(C){var N,te=C instanceof G||C instanceof kc;if(te){if((N=C).outputs.length!==1)throw new ee("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(N.inputs.length!==1)throw new ee("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(C.inboundNodes.length===0){if(C.batchInputShape==null)throw new ee("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");var Be=bc({batchShape:C.batchInputShape,dtype:C.dtype,name:C.name+"_input"});C.apply(Be)}if(te)this.outputs=N.outputs,this.inputs=N.inputs;else{if(C.inboundNodes.length!==1)throw new ee("A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer "+C.name+" which has "+C.inboundNodes.length+" pre-existing inbound connections.");if(C.inboundNodes[0].outputTensors.length!==1)throw new ee("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(C),this.outputs=[C.inboundNodes[0].outputTensors[0]],this.inputs=function ft(Nt,Ut,ct){if((Ut==null||ct!=null&&ct>0)&&(Ut=Nt.sourceLayer,ct=Nt.nodeIndex),Ut.inboundNodes.length===0)return[Nt];var yn=Ut.inboundNodes[ct];if(yn.inboundLayers.length===0)return yn.inputTensors;for(var _n=[],Nn=0;Nn<yn.inboundLayers.length;Nn++)for(var Wn=0,Mn=ft(yn.inputTensors[Nn],yn.inboundLayers[Nn],yn.nodeIndices[Nn]);Wn<Mn.length;Wn++){var tr=Mn[Wn];_n.indexOf(tr)===-1&&_n.push(tr)}return _n}(this.outputs[0])}this.inboundNodes=[],new vs({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:ie(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(function(ft){return ft.shape}),outputShapes:this.outputs[0].shape})}else{var Ge=C.apply(this.outputs[0]);if(Array.isArray(Ge))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(C),this.outputs=[Ge],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(C),this.built=!1},G.prototype.pop=function(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{var C=this.layers.length-1;this.layers[C].outboundNodes=[],this.outputs=[this.layers[C].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}},G.prototype.call=function(C,N){return this.model==null&&this.build(),this.model.call(C,N)},G.prototype.build=function(C){if(Bn(C),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new kc({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0},G.prototype.countParams=function(){return this.built||this.build(),Z.prototype.countParams.call(this)},G.prototype.summary=function(C,N,te){te===void 0&&(te=console.log),this.built||this.build(),Z.prototype.summary.call(this,C,N,te)},G.prototype.setWeights=function(C){this.model==null&&this.build(),this.model.setWeights(C)},G.prototype.evaluate=function(C,N,te){if(te===void 0&&(te={}),!this.built)throw new L("The model needs to be compiled before being used.");return this.model.evaluate(C,N,te)},G.prototype.evaluateDataset=function(C,N){return J(this,void 0,void 0,function(){return R(this,function(te){if(!this.built)throw new L("The model needs to be compiled before being used.");return[2,this.model.evaluateDataset(C,N)]})})},G.prototype.predict=function(C,N){return N===void 0&&(N={}),this.model==null&&this.build(),this.model.predict(C,N)},G.prototype.predictOnBatch=function(C){return this.model==null&&this.build(),this.model.predictOnBatch(C)},G.prototype.compile=function(C){this.build(),this.model.compile(C),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames},Object.defineProperty(G.prototype,"optimizer",{get:function(){return this.model==null?void 0:this.model.optimizer},set:function(C){this.model.optimizer=C},enumerable:!0,configurable:!0}),G.prototype.fit=function(C,N,te){return te===void 0&&(te={}),J(this,void 0,void 0,function(){return R(this,function(Be){if(!this.built)throw new L("The model needs to be compiled before being used.");return[2,this.model.fit(C,N,te)]})})},G.prototype.fitDataset=function(C,N){return J(this,void 0,void 0,function(){return R(this,function(te){if(!this.built)throw new L("The model needs to be compiled before being used.");return[2,this.model.fitDataset(C,N)]})})},G.prototype.trainOnBatch=function(C,N){return J(this,void 0,void 0,function(){return R(this,function(te){return[2,this.model.trainOnBatch(C,N)]})})},G.fromConfig=function(C,N,te,Be){var Ge;Be===void 0&&(Be=!1);var ft={};if(N instanceof Array){if(N[0].className==null||N[0].className==="Merge")throw new ee("Legacy serialization format not supported yet.");Ge=N}else b.util.assert(N.layers!=null,function(){return"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."}),Ge=N.layers,delete N.layers,ft=N;var Nt=new C(ft);if(!(Nt instanceof G))throw new F("Sequential.fromConfig called on non-Sequential input: "+Nt);for(var Ut=0,ct=Ge;Ut<ct.length;Ut++){var yn=Io(ct[Ut],void 0,Be);Be&&yn.setFastWeightInitDuringBuild(!0),Nt.add(yn)}return Nt},Object.defineProperty(G.prototype,"stopTraining",{get:function(){if(this.model==null)throw new ee("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining},set:function(C){if(this.model==null)throw new ee("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=C},enumerable:!0,configurable:!0}),G.prototype.getConfig=function(){for(var C=[],N=0,te=this.layers;N<te.length;N++){var Be=te[N],Ge={};Ge.className=Be.getClassName(),Ge.config=Be.getConfig(),C.push(Ge)}return{name:this.name,layers:C}},G.className="Sequential",G}(kc);function fa(Z){return new kc(Z)}function uo(Z){return new xt(Z)}function Uo(Z,G){return G==null&&(G={}),Zs(Z,G)}function wa(Z){return bc(Z)}function xs(Z,G){wc.registerCallbackConstructor(Z,G)}b.serialization.registerClass(xt);var fr=function(Z){function G(){return Z!==null&&Z.apply(this,arguments)||this}return U(G,Z),G.prototype.getConfig=function(){return{}},G}(b.serialization.Serializable),zs=function(Z){function G(){return Z!==null&&Z.apply(this,arguments)||this}return U(G,Z),G.prototype.apply=function(C,N){return N===void 0&&(N=1),function(te,Be){if(Be===void 0&&(Be=1),Be!==1)throw new F("Support for alpha values other than 1 ("+Be+") is not implemented yet.");return Object(b.elu)(te)}(C,N)},G.className="elu",G}(fr);b.serialization.registerClass(zs);var eu=function(Z){function G(){return Z!==null&&Z.apply(this,arguments)||this}return U(G,Z),G.prototype.apply=function(C){return Object(b.selu)(C)},G.className="selu",G}(fr);b.serialization.registerClass(eu);var Hc=function(Z){function G(){return Z!==null&&Z.apply(this,arguments)||this}return U(G,Z),G.prototype.apply=function(C){return Object(b.relu)(C)},G.className="relu",G}(fr);b.serialization.registerClass(Hc);var Us=function(Z){function G(){return Z!==null&&Z.apply(this,arguments)||this}return U(G,Z),G.prototype.apply=function(C){return Object(b.tidy)(function(){return Object(b.minimum)(6,Object(b.relu)(C))})},G.className="relu6",G}(fr);b.serialization.registerClass(Us);var Nh=function(Z){function G(){return Z!==null&&Z.apply(this,arguments)||this}return U(G,Z),G.prototype.apply=function(C){return C},G.className="linear",G}(fr);b.serialization.registerClass(Nh);var jd=function(Z){function G(){return Z!==null&&Z.apply(this,arguments)||this}return U(G,Z),G.prototype.apply=function(C){return Object(b.sigmoid)(C)},G.className="sigmoid",G}(fr);b.serialization.registerClass(jd);var Bd=function(Z){function G(){return Z!==null&&Z.apply(this,arguments)||this}return U(G,Z),G.prototype.apply=function(C){return function(N){return Object(b.tidy)(function(){var te=Object(b.add)(.5,Object(b.mul)(.2,N));return Object(b.clipByValue)(te,0,1)})}(C)},G.className="hardSigmoid",G}(fr);b.serialization.registerClass(Bd);var uu=function(Z){function G(){return Z!==null&&Z.apply(this,arguments)||this}return U(G,Z),G.prototype.apply=function(C){return Object(b.softplus)(C)},G.className="softplus",G}(fr);b.serialization.registerClass(uu);var Ki=function(Z){function G(){return Z!==null&&Z.apply(this,arguments)||this}return U(G,Z),G.prototype.apply=function(C){return function(N){return Object(b.tidy)(function(){return Object(b.div)(N,Object(b.abs)(N).add(1))})}(C)},G.className="softsign",G}(fr);b.serialization.registerClass(Ki);var ws=function(Z){function G(){return Z!==null&&Z.apply(this,arguments)||this}return U(G,Z),G.prototype.apply=function(C){return Object(b.tanh)(C)},G.className="tanh",G}(fr);b.serialization.registerClass(ws);var Ih=function(Z){function G(){return Z!==null&&Z.apply(this,arguments)||this}return U(G,Z),G.prototype.apply=function(C,N){return N===void 0&&(N=-1),Object(b.softmax)(C,N)},G.className="softmax",G}(fr);b.serialization.registerClass(Ih);var ac=function(Z){function G(){return Z!==null&&Z.apply(this,arguments)||this}return U(G,Z),G.prototype.apply=function(C,N){return N===void 0&&(N=-1),Object(b.logSoftmax)(C,N)},G.className="logSoftmax",G}(fr);function us(Z){return Z.getClassName()}function ii(Z,G){return G===void 0&&(G={}),St(Z,b.serialization.SerializationMap.getMap().classNameMap,G,"activation")}function Ba(Z){var G;return Z==null?ii(G={className:"linear",config:{}}):typeof Z=="string"?((G={}).className=Z,G.config={},ii(G)):Z instanceof fr?Z:ii(Z)}function Fh(Z){if(Z!=null&&typeof Z!="object")throw new Error("Argument to L1L2 regularizer's constructor is expected to be an object, but received: "+Z)}b.serialization.registerClass(ac);var Pd=function(Z){function G(){return Z!==null&&Z.apply(this,arguments)||this}return U(G,Z),G}(b.serialization.Serializable),Al=function(Z){function G(C){var N=Z.call(this)||this;return Fh(C),N.l1=C==null||C.l1==null?.01:C.l1,N.l2=C==null||C.l2==null?.01:C.l2,N.hasL1=N.l1!==0,N.hasL2=N.l2!==0,N}return U(G,Z),G.prototype.apply=function(C){var N=this;return Object(b.tidy)(function(){var te=Object(b.zeros)([1]);return N.hasL1&&(te=Object(b.add)(te,Object(b.sum)(Object(b.mul)(N.l1,Object(b.abs)(C))))),N.hasL2&&(te=Object(b.add)(te,Object(b.sum)(Object(b.mul)(N.l2,Wi(C))))),te.asScalar()})},G.prototype.getConfig=function(){return{l1:this.l1,l2:this.l2}},G.fromConfig=function(C,N){return new C({l1:N.l1,l2:N.l2})},G.className="L1L2",G}(Pd);b.serialization.registerClass(Al);var Rh={l1l2:"L1L2"};function Ri(Z){return at(Z)}function bi(Z,G){return G===void 0&&(G={}),St(Z,b.serialization.SerializationMap.getMap().classNameMap,G,"regularizer")}function ro(Z){return Z==null?null:typeof Z=="string"?bi({className:Z in Rh?Rh[Z]:Z,config:{}}):Z instanceof Pd?Z:bi(Z)}var Ld=function(Z){function G(C){var N=Z.call(this,C??{})||this;return N.supportsMasking=!0,C!=null&&(N.maxValue=C.maxValue),N}return U(G,Z),G.prototype.call=function(C,N){C=jr(C);var te=Object(b.relu)(C);return this.maxValue!=null&&(te=Object(b.clipByValue)(te,0,this.maxValue)),te},G.prototype.computeOutputShape=function(C){return C},G.prototype.getConfig=function(){var C={maxValue:this.maxValue},N=Z.prototype.getConfig.call(this);return Object.assign(C,N),C},G.className="ReLU",G}(qi);b.serialization.registerClass(Ld);var zd=function(Z){function G(C){var N=Z.call(this,C??{})||this;return N.DEFAULT_ALPHA=.3,C==null&&(C={}),N.alpha=C.alpha==null?N.DEFAULT_ALPHA:C.alpha,N}return U(G,Z),G.prototype.call=function(C,N){var te=jr(C);return Object(b.leakyRelu)(te,this.alpha)},G.prototype.computeOutputShape=function(C){return C},G.prototype.getConfig=function(){var C={alpha:this.alpha},N=Z.prototype.getConfig.call(this);return Object.assign(C,N),C},G.className="LeakyReLU",G}(qi);b.serialization.registerClass(zd);var Ud=function(Z){function G(C){var N=Z.call(this,C??{})||this;if(N.DEFAULT_ALPHA_INITIALIZER="zeros",C==null&&(C={}),N.supportsMasking=!0,N.alphaInitializer=zr(C.alphaInitializer||N.DEFAULT_ALPHA_INITIALIZER),N.alphaRegularizer=ro(C.alphaRegularizer),N.alphaConstraint=Yn(C.alphaConstraint),C.sharedAxes==null)N.sharedAxes=null;else if(Array.isArray(C.sharedAxes))N.sharedAxes=C.sharedAxes;else{if(typeof C.sharedAxes!="number")throw new ee("Expected sharedAxes to be a number or an array of numbers, but got "+C.sharedAxes);N.sharedAxes=[C.sharedAxes]}return N}return U(G,Z),G.prototype.build=function(C){var N=(C=Bn(C)).slice(1);if(this.sharedAxes!=null)for(var te=0,Be=this.sharedAxes;te<Be.length;te++)N[(ft=Be[te])-1]=1;this.alpha=this.addWeight("alpha",N,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);var Ge={};if(this.sharedAxes!=null)for(var ft=1;ft<C.length;++ft)Ge[ft]=C[ft];this.inputSpec=[new Zi({ndim:C.length,axes:Ge})],this.built=!0},G.prototype.call=function(C,N){return C=jr(C),Object(b.prelu)(C,this.alpha.read())},G.prototype.getConfig=function(){var C={alphaInitializer:ir(this.alphaInitializer),alphaRegularizer:Ri(this.alphaRegularizer),alphaConstraint:xn(this.alphaConstraint),sharedAxes:this.sharedAxes},N=Z.prototype.getConfig.call(this);return Object.assign(C,N),C},G.className="PReLU",G}(qi);b.serialization.registerClass(Ud);var Rp=function(Z){function G(C){var N=Z.call(this,C??{})||this;if(N.DEFAULT_ALPHA=1,C==null&&(C={}),C.alpha!=null&&C.alpha!==N.DEFAULT_ALPHA)throw new F("Non-default alpha value ("+C.alpha+") is not supported by the ELU layer yet.");return N.alpha=C.alpha==null?N.DEFAULT_ALPHA:C.alpha,N}return U(G,Z),G.prototype.call=function(C,N){var te=jr(C);return Object(b.elu)(te)},G.prototype.computeOutputShape=function(C){return C},G.prototype.getConfig=function(){var C={alpha:this.alpha},N=Z.prototype.getConfig.call(this);return Object.assign(C,N),C},G.className="ELU",G}(qi);b.serialization.registerClass(Rp);var zu=function(Z){function G(C){var N=Z.call(this,C??{})||this;return N.DEFAULT_THETA=1,C==null&&(C={}),N.theta=C.theta==null?N.DEFAULT_THETA:C.theta,N}return U(G,Z),G.prototype.call=function(C,N){var te=jr(C);return te.mul(xr(te.greater(this.theta),"float32"))},G.prototype.computeOutputShape=function(C){return C},G.prototype.getConfig=function(){var C={theta:this.theta},N=Z.prototype.getConfig.call(this);return Object.assign(C,N),C},G.className="ThresholdedReLU",G}(qi);b.serialization.registerClass(zu);var ks=function(Z){function G(C){var N=Z.call(this,C??{})||this;return N.DEFAULT_AXIS=1,C==null&&(C={}),N.softmax=new Ih().apply,N.axis=C.axis==null?N.DEFAULT_AXIS:C.axis,N}return U(G,Z),G.prototype.call=function(C,N){var te=jr(C);return this.softmax(te,this.axis)},G.prototype.computeOutputShape=function(C){return C},G.prototype.getConfig=function(){var C={axis:this.axis},N=Z.prototype.getConfig.call(this);return Object.assign(C,N),C},G.className="Softmax",G}(qi);function $c(Z,G,C){if(typeof Z=="number")return ie(Z,G);if(Z.length!==G)throw new ee("The "+C+" argument must be an integer or tuple of "+G+" integers. Received: "+Z.length+" elements.");for(var N=0;N<G;++N){var te=Z[N];if(!hn(te))throw new ee("The "+C+" argument must be an integer or tuple of "+G+" integers. Received: "+JSON.stringify(Z)+" including a non-integer number "+te)}return Z}function Rs(Z,G,C,N,te){return te===void 0&&(te=1),Z==null?Z:(Be=C==="same"?Z:Z-(G+(G-1)*(te-1))+1,Math.floor((Be+N-1)/N));var Be}function tu(Z,G,C,N){if(Z==null)return null;if(N==="valid")Z=Z*G+Dn([C-G,0]);else{if(N!=="same")throw new ee("Unsupport padding mode: "+N+".");Z*=G}return Z}function Mh(Z,G){return Object(b.tidy)(function(){return rn(G),G==="channelsFirst"?Object(b.transpose)(Z,[0,2,3,1]):Z})}function Ni(Z,G){return Object(b.tidy)(function(){return rn(G),G==="channelsFirst"?Object(b.transpose)(Z,[0,2,3,4,1]):Z})}function _f(Z,G,C,N,te,Be,Ge,ft){return N===void 0&&(N=[1,1]),te===void 0&&(te="valid"),ft===void 0&&(ft=null),Object(b.tidy)(function(){if(Be==null&&(Be="channelsLast"),rn(Be),Z.rank!==3&&Z.rank!==4)throw new ee("conv2dWithBiasActivation expects input to be of rank 3 or 4, but received "+Z.rank+".");if(G.rank!==3&&G.rank!==4)throw new ee("conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received "+Z.rank+".");var Nt=Mh(Z,Be);if(te==="causal")throw new F("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return Nt=b.fused.conv2d({x:Nt,filter:G,strides:N,pad:te==="same"?"same":"valid",dilations:Ge,dataFormat:"NHWC",bias:C,activation:ft}),Be==="channelsFirst"&&(Nt=Object(b.transpose)(Nt,[0,3,1,2])),Nt})}b.serialization.registerClass(ks);var Gc=function(Z){function G(C,N){var te=Z.call(this,N)||this;if(te.bias=null,te.DEFAULT_KERNEL_INITIALIZER="glorotNormal",te.DEFAULT_BIAS_INITIALIZER="zeros",G.verifyArgs(N),te.rank=C,Pt(te.rank,"rank"),te.rank!==1&&te.rank!==2&&te.rank!==3)throw new F("Convolution layer for rank other than 1, 2, or 3 ("+te.rank+") is not implemented yet.");if(te.kernelSize=$c(N.kernelSize,C,"kernelSize"),te.strides=$c(N.strides==null?1:N.strides,C,"strides"),te.padding=N.padding==null?"valid":N.padding,Sn(te.padding),te.dataFormat=N.dataFormat==null?"channelsLast":N.dataFormat,rn(te.dataFormat),te.activation=Ba(N.activation),te.useBias=N.useBias==null||N.useBias,te.biasInitializer=zr(N.biasInitializer||te.DEFAULT_BIAS_INITIALIZER),te.biasConstraint=Yn(N.biasConstraint),te.biasRegularizer=ro(N.biasRegularizer),te.activityRegularizer=ro(N.activityRegularizer),te.dilationRate=$c(N.dilationRate==null?1:N.dilationRate,C,"dilationRate"),te.rank===1&&Array.isArray(te.dilationRate)&&te.dilationRate.length!==1)throw new ee("dilationRate must be a number or an array of a single number for 1D convolution, but received "+JSON.stringify(te.dilationRate));if(te.rank===2){if(typeof te.dilationRate=="number")te.dilationRate=[te.dilationRate,te.dilationRate];else if(te.dilationRate.length!==2)throw new ee("dilationRate must be a number or array of two numbers for 2D convolution, but received "+JSON.stringify(te.dilationRate))}else if(te.rank===3){if(typeof te.dilationRate=="number")te.dilationRate=[te.dilationRate,te.dilationRate,te.dilationRate];else if(te.dilationRate.length!==3)throw new ee("dilationRate must be a number or array of three numbers for 3D convolution, but received "+JSON.stringify(te.dilationRate))}return te}return U(G,Z),G.verifyArgs=function(C){if(K("kernelSize"in C,"required key 'kernelSize' not in config"),typeof C.kernelSize!="number"&&!Gt(C.kernelSize,"number",1,3))throw new ee("BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received "+JSON.stringify(C.kernelSize)+".")},G.prototype.getConfig=function(){var C={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:us(this.activation),useBias:this.useBias,biasInitializer:ir(this.biasInitializer),biasRegularizer:Ri(this.biasRegularizer),activityRegularizer:Ri(this.activityRegularizer),biasConstraint:xn(this.biasConstraint)},N=Z.prototype.getConfig.call(this);return Object.assign(C,N),C},G}(qi),_l=function(Z){function G(C,N){var te=Z.call(this,C,N)||this;return te.kernel=null,G.verifyArgs(N),te.filters=N.filters,Pt(te.filters,"filters"),te.kernelInitializer=zr(N.kernelInitializer||te.DEFAULT_KERNEL_INITIALIZER),te.kernelConstraint=Yn(N.kernelConstraint),te.kernelRegularizer=ro(N.kernelRegularizer),te}return U(G,Z),G.prototype.build=function(C){var N;C=Bn(C);var te=this.dataFormat==="channelsFirst"?1:C.length-1;if(C[te]==null)throw new ee("The channel dimension of the input should be defined. Found "+C[te]);var Be=C[te],Ge=this.kernelSize.concat([Be,this.filters]);this.kernel=this.addWeight("kernel",Ge,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:(N={},N[te]=Be,N)}],this.built=!0},G.prototype.call=function(C,N){var te=this;return Object(b.tidy)(function(){var Be;C=jr(C);var Ge=te.bias==null?null:te.bias.read(),ft=Ye(te.activation.getClassName());if(ft!=null&&te.rank===2)Be=_f(C,te.kernel.read(),Ge,te.strides,te.padding,te.dataFormat,te.dilationRate,ft);else{if(te.rank===1)Be=function(Nt,Ut,ct,yn,_n,Nn,Wn){return yn===void 0&&(yn=1),_n===void 0&&(_n="valid"),Wn===void 0&&(Wn=1),Object(b.tidy)(function(){if(Nn==null&&(Nn="channelsLast"),rn(Nn),Nt.shape.length!==3)throw new ee("The input of a conv1dWithBias operation should be 3, but is "+Nt.shape.length+" instead.");if(Ut.shape.length!==3)throw new ee("The kernel for a conv1dWithBias operation should be 3, but is "+Ut.shape.length+" instead");if(ct!=null&&ct.shape.length!==1)throw new ee("The bias for a conv1dWithBias operation should be 1, but is "+Ut.shape.length+" instead");if(Nn==="channelsFirst"&&(Nt=Object(b.transpose)(Nt,[0,2,1])),_n==="causal")throw new F("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");var Mn=Object(b.conv1d)(Nt,Ut,yn,_n==="same"?"same":"valid","NWC",Wn);return ct!=null&&(Mn=yt(Mn,ct)),Mn})}(C,te.kernel.read(),Ge,te.strides[0],te.padding,te.dataFormat,te.dilationRate[0]);else if(te.rank===2)Be=_f(C,te.kernel.read(),Ge,te.strides,te.padding,te.dataFormat,te.dilationRate);else{if(te.rank!==3)throw new F("convolutions greater than 3D are not implemented yet.");Be=function(Nt,Ut,ct,yn,_n,Nn,Wn){return yn===void 0&&(yn=[1,1,1]),_n===void 0&&(_n="valid"),Object(b.tidy)(function(){if(Nn==null&&(Nn="channelsLast"),rn(Nn),Nt.rank!==4&&Nt.rank!==5)throw new ee("conv3dWithBias expects input to be of rank 4 or 5, but received "+Nt.rank+".");if(Ut.rank!==4&&Ut.rank!==5)throw new ee("conv3dWithBias expects kernel to be of rank 4 or 5, but received "+Nt.rank+".");var Mn=Ni(Nt,Nn);if(_n==="causal")throw new F("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return Mn=Object(b.conv3d)(Mn,Ut,yn,_n==="same"?"same":"valid","NDHWC",Wn),ct!=null&&(Mn=yt(Mn,ct)),Nn==="channelsFirst"&&(Mn=Object(b.transpose)(Mn,[0,4,1,2,3])),Mn})}(C,te.kernel.read(),Ge,te.strides,te.padding,te.dataFormat,te.dilationRate)}te.activation!=null&&(Be=te.activation.apply(Be))}return Be})},G.prototype.computeOutputShape=function(C){C=Bn(C);for(var N=[],te=this.dataFormat==="channelsLast"?C.slice(1,C.length-1):C.slice(2),Be=0;Be<te.length;++Be){var Ge=Rs(te[Be],this.kernelSize[Be],this.padding,this.strides[Be],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[Be]);N.push(Ge)}var ft=[C[0]];return this.dataFormat==="channelsLast"?(ft=ft.concat(N)).push(this.filters):(ft.push(this.filters),ft=ft.concat(N)),ft},G.prototype.getConfig=function(){var C={filters:this.filters,kernelInitializer:ir(this.kernelInitializer),kernelRegularizer:Ri(this.kernelRegularizer),kernelConstraint:xn(this.kernelConstraint)},N=Z.prototype.getConfig.call(this);return Object.assign(C,N),C},G.verifyArgs=function(C){if(!("filters"in C)||typeof C.filters!="number"||C.filters<1)throw new ee("Convolution layer expected config.filters to be a 'number' > 0 but got "+JSON.stringify(C.filters))},G}(Gc),Wd=function(Z){function G(C){var N=Z.call(this,2,C)||this;return G.verifyArgs(C),N}return U(G,Z),G.prototype.getConfig=function(){var C=Z.prototype.getConfig.call(this);return delete C.rank,C},G.verifyArgs=function(C){if(typeof C.kernelSize!="number"&&!Gt(C.kernelSize,"number",1,2))throw new ee("Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received "+JSON.stringify(C.kernelSize)+".")},G.className="Conv2D",G}(_l);b.serialization.registerClass(Wd);var Mp=function(Z){function G(C){var N=Z.call(this,3,C)||this;return G.verifyArgs(C),N}return U(G,Z),G.prototype.getConfig=function(){var C=Z.prototype.getConfig.call(this);return delete C.rank,C},G.verifyArgs=function(C){if(typeof C.kernelSize!="number"&&(!Array.isArray(C.kernelSize)||C.kernelSize.length!==1&&C.kernelSize.length!==3))throw new ee("Conv3D expects config.kernelSize to be number or [number, number, number], but received "+JSON.stringify(C.kernelSize)+".")},G.className="Conv3D",G}(_l);b.serialization.registerClass(Mp);var Sl=function(Z){function G(C){var N=Z.call(this,C)||this;if(N.inputSpec=[new Zi({ndim:4})],N.padding!=="same"&&N.padding!=="valid")throw new ee("Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode "+N.padding);return N}return U(G,Z),G.prototype.build=function(C){var N;if((C=Bn(C)).length!==4)throw new ee("Input should have rank 4; Received input shape: "+JSON.stringify(C));var te=this.dataFormat==="channelsFirst"?1:C.length-1;if(C[te]==null)throw new ee("The channel dimension of the inputs should be defined. Found `None`.");var Be=C[te],Ge=this.kernelSize.concat([this.filters,Be]);this.kernel=this.addWeight("kernel",Ge,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Zi({ndim:4,axes:(N={},N[te]=Be,N)})],this.built=!0},G.prototype.call=function(C,N){var te=this;return Object(b.tidy)(function(){var Be=jr(C);if(Be.shape.length!==4)throw new ee("Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-"+Be.shape.length);var Ge,ft,Nt=Be.shape,Ut=Nt[0];te.dataFormat==="channelsFirst"?(Ge=2,ft=3):(Ge=1,ft=2);var ct=Nt[Ge],yn=Nt[ft],_n=te.kernelSize[0],Nn=te.kernelSize[1],Wn=te.strides[0],Mn=te.strides[1],tr=[Ut,tu(ct,Wn,_n,te.padding),tu(yn,Mn,Nn,te.padding),te.filters];te.dataFormat!=="channelsLast"&&(Be=Object(b.transpose)(Be,[0,2,3,1]));var rr=Object(b.conv2dTranspose)(Be,te.kernel.read(),tr,te.strides,te.padding);return te.dataFormat!=="channelsLast"&&(rr=Object(b.transpose)(rr,[0,3,1,2])),te.bias!=null&&(rr=yt(rr,te.bias.read(),te.dataFormat)),te.activation!=null&&(rr=te.activation.apply(rr)),rr})},G.prototype.computeOutputShape=function(C){var N,te,Be,Ge=(C=Bn(C)).slice();this.dataFormat==="channelsFirst"?(N=1,te=2,Be=3):(N=3,te=1,Be=2);var ft=this.kernelSize[0],Nt=this.kernelSize[1],Ut=this.strides[0],ct=this.strides[1];return Ge[N]=this.filters,Ge[te]=tu(Ge[te],Ut,ft,this.padding),Ge[Be]=tu(Ge[Be],ct,Nt,this.padding),Ge},G.prototype.getConfig=function(){var C=Z.prototype.getConfig.call(this);return delete C.dilationRate,C},G.className="Conv2DTranspose",G}(Wd);b.serialization.registerClass(Sl);var jh=function(Z){function G(C){return Z.call(this,2,C)||this}return U(G,Z),G.className="SeparableConv2D",G}(function(Z){function G(C,N){var te=Z.call(this,C,N)||this;if(te.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",te.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",te.depthwiseKernel=null,te.pointwiseKernel=null,N.filters==null)throw new ee("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(N.kernelInitializer!=null||N.kernelRegularizer!=null||N.kernelConstraint!=null)throw new ee("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(N.padding!=null&&N.padding!=="same"&&N.padding!=="valid")throw new ee("SeparableConv"+te.rank+"D supports only padding modes: 'same' and 'valid', but received "+JSON.stringify(N.padding));return te.depthMultiplier=N.depthMultiplier==null?1:N.depthMultiplier,te.depthwiseInitializer=zr(N.depthwiseInitializer||te.DEFAULT_DEPTHWISE_INITIALIZER),te.depthwiseRegularizer=ro(N.depthwiseRegularizer),te.depthwiseConstraint=Yn(N.depthwiseConstraint),te.pointwiseInitializer=zr(N.depthwiseInitializer||te.DEFAULT_POINTWISE_INITIALIZER),te.pointwiseRegularizer=ro(N.pointwiseRegularizer),te.pointwiseConstraint=Yn(N.pointwiseConstraint),te}return U(G,Z),G.prototype.build=function(C){var N;if((C=Bn(C)).length<this.rank+2)throw new ee("Inputs to SeparableConv"+this.rank+"D should have rank "+(this.rank+2)+", but received input shape: "+JSON.stringify(C));var te=this.dataFormat==="channelsFirst"?1:C.length-1;if(C[te]==null||C[te]<0)throw new ee("The channel dimension of the inputs should be defined, but found "+JSON.stringify(C[te]));for(var Be=C[te],Ge=this.kernelSize.concat([Be,this.depthMultiplier]),ft=[],Nt=0;Nt<this.rank;++Nt)ft.push(1);ft.push(Be*this.depthMultiplier,this.filters),this.depthwiseKernel=this.addWeight("depthwise_kernel",Ge,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",ft,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,!0,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.inputSpec=[new Zi({ndim:this.rank+2,axes:(N={},N[te]=Be,N)})],this.built=!0},G.prototype.call=function(C,N){var te=this;return Object(b.tidy)(function(){var Be;if(C=jr(C),te.rank===1)throw new F("1D separable convolution is not implemented yet.");return te.rank===2&&(te.dataFormat==="channelsFirst"&&(C=Object(b.transpose)(C,[0,2,3,1])),Be=Object(b.separableConv2d)(C,te.depthwiseKernel.read(),te.pointwiseKernel.read(),te.strides,te.padding,te.dilationRate,"NHWC")),te.useBias&&(Be=yt(Be,te.bias.read(),te.dataFormat)),te.activation!=null&&(Be=te.activation.apply(Be)),te.dataFormat==="channelsFirst"&&(Be=Object(b.transpose)(Be,[0,3,1,2])),Be})},G.prototype.getConfig=function(){var C=Z.prototype.getConfig.call(this);return delete C.rank,delete C.kernelInitializer,delete C.kernelRegularizer,delete C.kernelConstraint,C.depthwiseInitializer=ir(this.depthwiseInitializer),C.pointwiseInitializer=ir(this.pointwiseInitializer),C.depthwiseRegularizer=Ri(this.depthwiseRegularizer),C.pointwiseRegularizer=Ri(this.pointwiseRegularizer),C.depthwiseConstraint=xn(this.depthwiseConstraint),C.pointwiseConstraint=xn(this.pointwiseConstraint),C},G.className="SeparableConv",G}(_l));b.serialization.registerClass(jh);var Pa=function(Z){function G(C){var N=Z.call(this,1,C)||this;return G.verifyArgs(C),N.inputSpec=[{ndim:3}],N}return U(G,Z),G.prototype.getConfig=function(){var C=Z.prototype.getConfig.call(this);return delete C.rank,delete C.dataFormat,C},G.verifyArgs=function(C){if(typeof C.kernelSize!="number"&&!Gt(C.kernelSize,"number",1,1))throw new ee("Conv1D expects config.kernelSize to be number or number[] with length 1, but received "+JSON.stringify(C.kernelSize)+".")},G.className="Conv1D",G}(_l);b.serialization.registerClass(Pa);var Bh=function(Z){function G(C){var N=Z.call(this,C)||this;return typeof C.cropping=="number"?N.cropping=[[C.cropping,C.cropping],[C.cropping,C.cropping]]:typeof C.cropping[0]=="number"?N.cropping=[[C.cropping[0],C.cropping[0]],[C.cropping[1],C.cropping[1]]]:N.cropping=C.cropping,N.dataFormat=C.dataFormat===void 0?"channelsLast":C.dataFormat,N.inputSpec=[{ndim:4}],N}return U(G,Z),G.prototype.computeOutputShape=function(C){return this.dataFormat==="channelsFirst"?[C[0],C[1],C[2]-this.cropping[0][0]-this.cropping[0][1],C[3]-this.cropping[1][0]-this.cropping[1][1]]:[C[0],C[1]-this.cropping[0][0]-this.cropping[0][1],C[2]-this.cropping[1][0]-this.cropping[1][1],C[3]]},G.prototype.call=function(C,N){var te=this;return Object(b.tidy)(function(){return C=jr(C),te.dataFormat==="channelsLast"?Mr(Mr(C,te.cropping[0][0],C.shape[1]-te.cropping[0][0]-te.cropping[0][1],2),te.cropping[1][0],C.shape[2]-te.cropping[1][1]-te.cropping[1][0],3):Mr(Mr(C,te.cropping[0][0],C.shape[2]-te.cropping[0][0]-te.cropping[0][1],3),te.cropping[1][0],C.shape[3]-te.cropping[1][1]-te.cropping[1][0],4)})},G.prototype.getConfig=function(){var C={cropping:this.cropping,dataFormat:this.dataFormat},N=Z.prototype.getConfig.call(this);return Object.assign(C,N),C},G.className="Cropping2D",G}(qi);b.serialization.registerClass(Bh);var Dl=function(Z){function G(C){var N=Z.call(this,C)||this;return N.DEFAULT_SIZE=[2,2],N.inputSpec=[{ndim:4}],N.size=C.size==null?N.DEFAULT_SIZE:C.size,N.dataFormat=C.dataFormat==null?"channelsLast":C.dataFormat,N}return U(G,Z),G.prototype.computeOutputShape=function(C){if(this.dataFormat==="channelsFirst"){var N=C[2]==null?null:this.size[0]*C[2],te=C[3]==null?null:this.size[1]*C[3];return[C[0],C[1],N,te]}return N=C[1]==null?null:this.size[0]*C[1],te=C[2]==null?null:this.size[1]*C[2],[C[0],N,te,C[3]]},G.prototype.call=function(C,N){var te=this;return Object(b.tidy)(function(){var Be=jr(C),Ge=Be.shape;if(te.dataFormat==="channelsFirst"){Be=Object(b.transpose)(Be,[0,2,3,1]);var ft=te.size[0]*Ge[2],Nt=te.size[1]*Ge[3],Ut=Be.resizeNearestNeighbor([ft,Nt]);return Object(b.transpose)(Ut,[0,3,1,2])}return ft=te.size[0]*Ge[1],Nt=te.size[1]*Ge[2],Be.resizeNearestNeighbor([ft,Nt])})},G.prototype.getConfig=function(){var C={size:this.size,dataFormat:this.dataFormat},N=Z.prototype.getConfig.call(this);return Object.assign(C,N),C},G.className="UpSampling2D",G}(qi);b.serialization.registerClass(Dl);var Ph=function(Z){function G(C){var N=Z.call(this,2,C)||this;return N.depthwiseKernel=null,N.depthMultiplier=C.depthMultiplier==null?1:C.depthMultiplier,N.depthwiseInitializer=zr(C.depthwiseInitializer||N.DEFAULT_KERNEL_INITIALIZER),N.depthwiseConstraint=Yn(C.depthwiseConstraint),N.depthwiseRegularizer=ro(C.depthwiseRegularizer),N}return U(G,Z),G.prototype.build=function(C){if((C=Bn(C)).length<4)throw new ee("Inputs to DepthwiseConv2D should have rank 4. Received input shape: "+JSON.stringify(C)+".");var N=this.dataFormat==="channelsFirst"?1:3;if(C[N]==null||C[N]<0)throw new ee("The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not ("+C[N]+").");var te=C[N],Be=[this.kernelSize[0],this.kernelSize[1],te,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",Be,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[te*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},G.prototype.call=function(C,N){var te=this;return Object(b.tidy)(function(){var Be=function(Ge,ft,Nt,Ut,ct,yn){return Nt===void 0&&(Nt=[1,1]),Ut===void 0&&(Ut="valid"),Object(b.tidy)(function(){ct==null&&(ct="channelsLast"),rn(ct);var _n=Mh(Ge,ct);if(Ge.rank!==4)throw new ee("Input for depthwiseConv2d is required to be 4-D, but is instead "+Ge.rank+"-D");if(ft.rank!==4)throw new ee("depthwiseKernel is required to be 4-D, but is instead "+ft.rank+"-D");return _n=Object(b.depthwiseConv2d)(_n,ft,Nt,Ut==="same"?"same":"valid","NHWC",yn),ct==="channelsFirst"&&(_n=Object(b.transpose)(_n,[0,3,1,2])),_n})}(C=jr(C),te.depthwiseKernel.read(),te.strides,te.padding,te.dataFormat,null);return te.useBias&&(Be=yt(Be,te.bias.read(),te.dataFormat)),te.activation!=null&&(Be=te.activation.apply(Be)),Be})},G.prototype.computeOutputShape=function(C){C=Bn(C);var N=this.dataFormat==="channelsFirst"?C[2]:C[1],te=this.dataFormat==="channelsFirst"?C[3]:C[2],Be=this.dataFormat==="channelsFirst"?C[1]*this.depthMultiplier:C[3]*this.depthMultiplier,Ge=Rs(N,this.kernelSize[0],this.padding,this.strides[0]),ft=Rs(te,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[C[0],Be,Ge,ft]:[C[0],Ge,ft,Be]},G.prototype.getConfig=function(){var C=Z.prototype.getConfig.call(this);return C.depthMultiplier=this.depthMultiplier,C.depthwiseInitializer=ir(this.depthwiseInitializer),C.depthwiseRegularizer=Ri(this.depthwiseRegularizer),C.depthwiseConstraint=xn(this.depthwiseRegularizer),C},G.className="DepthwiseConv2D",G}(Gc);b.serialization.registerClass(Ph);var Tl=function(Z){function G(C){var N=Z.call(this,C)||this;return N.rate=Math.max(Math.min(C.rate,1),0),N.noiseShape=C.noiseShape,N.seed=C.seed,N.supportsMasking=!0,N}return U(G,Z),G.prototype.getNoiseShape=function(C){if(this.noiseShape==null)return this.noiseShape;for(var N=C.shape,te=[],Be=0;Be<this.noiseShape.length;++Be)te.push(this.noiseShape[Be]==null?N[Be]:this.noiseShape[Be]);return te},G.prototype.call=function(C,N){var te=this;return Object(b.tidy)(function(){te.invokeCallHook(C,N);var Be=jr(C);if(0<te.rate&&te.rate<1){var Ge=N.training!=null&&N.training,ft=te.getNoiseShape(Be);return jt(function(){return Lr(Be,te.rate,ft,te.seed)},function(){return Be},Ge)}return C})},G.prototype.getConfig=function(){var C={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},N=Z.prototype.getConfig.call(this);return Object.assign(C,N),C},G.prototype.dispose=function(){return Z.prototype.dispose.call(this)},G.className="Dropout",G}(qi);b.serialization.registerClass(Tl);var Kc=function(Z){function G(C){var N=Z.call(this,C)||this;return N.inputSpec=[{ndim:3}],N}return U(G,Z),G.prototype.getNoiseShape=function(C){var N=C.shape;return[N[0],1,N[2]]},G.className="SpatialDropout1D",G}(Tl);b.serialization.registerClass(Kc);var Ec=function(Z){function G(C){var N=Z.call(this,C)||this;if(N.activation=null,N.useBias=!0,N.kernel=null,N.bias=null,N.DEFAULT_KERNEL_INITIALIZER="glorotNormal",N.DEFAULT_BIAS_INITIALIZER="zeros",C.batchInputShape==null&&C.inputShape==null&&C.inputDim!=null){var te=null;C.batchSize!=null&&(te=C.batchSize),N.batchInputShape=[te,C.inputDim]}return N.units=C.units,Pt(N.units,"units"),N.activation=Ba(C.activation),C.useBias!=null&&(N.useBias=C.useBias),N.kernelInitializer=zr(C.kernelInitializer||N.DEFAULT_KERNEL_INITIALIZER),N.biasInitializer=zr(C.biasInitializer||N.DEFAULT_BIAS_INITIALIZER),N.kernelConstraint=Yn(C.kernelConstraint),N.biasConstraint=Yn(C.biasConstraint),N.kernelRegularizer=ro(C.kernelRegularizer),N.biasRegularizer=ro(C.biasRegularizer),N.activityRegularizer=ro(C.activityRegularizer),N.supportsMasking=!0,N.inputSpec=[{minNDim:2}],N}return U(G,Z),G.prototype.build=function(C){var N,te=(C=Bn(C))[C.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[te,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:(N={},N[-1]=te,N)}],this.built=!0},G.prototype.computeOutputShape=function(C){var N=(C=Bn(C)).slice();return N[N.length-1]=this.units,N},G.prototype.call=function(C,N){var te=this;return Object(b.tidy)(function(){te.invokeCallHook(C,N);var Be,Ge=jr(C),ft=Ye(te.activation.getClassName());return ft!=null?Be=ai(Ge,te.kernel.read(),ft,te.bias?te.bias.read():null):(Be=ai(Ge,te.kernel.read()),te.bias!=null&&(Be=yt(Be,te.bias.read())),te.activation!=null&&(Be=te.activation.apply(Be))),Be})},G.prototype.getConfig=function(){var C={units:this.units,activation:us(this.activation),useBias:this.useBias,kernelInitializer:ir(this.kernelInitializer),biasInitializer:ir(this.biasInitializer),kernelRegularizer:Ri(this.kernelRegularizer),biasRegularizer:Ri(this.biasRegularizer),activityRegularizer:Ri(this.activityRegularizer),kernelConstraint:xn(this.kernelConstraint),biasConstraint:xn(this.biasConstraint)},N=Z.prototype.getConfig.call(this);return Object.assign(C,N),C},G.className="Dense",G}(qi);b.serialization.registerClass(Ec);var Lh=function(Z){function G(C){var N=this;return C=C||{},(N=Z.call(this,C)||this).inputSpec=[{minNDim:3}],N.dataFormat=C.dataFormat,N}return U(G,Z),G.prototype.computeOutputShape=function(C){for(var N=0,te=(C=Bn(C)).slice(1);N<te.length;N++)if(te[N]==null)throw new ee('The shape of the input to "Flatten" is not fully defined (got '+C.slice(1)+'). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.');return[C[0],Xt(C,1)]},G.prototype.call=function(C,N){var te=this;return Object(b.tidy)(function(){te.invokeCallHook(C,N);var Be=jr(C);if(te.dataFormat==="channelsFirst"&&Be.rank>1){for(var Ge=[0],ft=2;ft<Be.rank;++ft)Ge.push(ft);Ge.push(1),Be=Be.transpose(Ge)}return function(Nt){if(Nt.rank<=1)throw new ee("batchFlatten requires a minimum rank of 2. Got rank: "+Nt.rank+".");var Ut=[Nt.shape[0],Xt(Nt.shape,1)];return Nt.reshape(Ut)}(Be)})},G.prototype.getConfig=function(){var C={};this.dataFormat!=null&&(C.dataFormat=this.dataFormat);var N=Z.prototype.getConfig.call(this);return Object.assign(C,N),C},G.className="Flatten",G}(qi);b.serialization.registerClass(Lh);var Sf=function(Z){function G(C){var N=Z.call(this,C)||this;return N.supportsMasking=!0,N.activation=Ba(C.activation),N}return U(G,Z),G.prototype.call=function(C,N){var te=this;return Object(b.tidy)(function(){te.invokeCallHook(C,N);var Be=jr(C);return te.activation.apply(Be)})},G.prototype.getConfig=function(){var C={activation:us(this.activation)},N=Z.prototype.getConfig.call(this);return Object.assign(C,N),C},G.className="Activation",G}(qi);b.serialization.registerClass(Sf);var Nl=function(Z){function G(C){var N=Z.call(this,C)||this;return N.n=C.n,N.inputSpec=[{ndim:2}],N}return U(G,Z),G.prototype.computeOutputShape=function(C){return[C[0],this.n,C[1]]},G.prototype.call=function(C,N){var te=this;return Object(b.tidy)(function(){return function(Be,Ge){return Object(b.tidy)(function(){if(Be.shape.length!==2)throw new ee("repeat() expects a rank-2 tensor, but received a rank-"+Be.shape.length+" tensor.");return Xr(gr(Be,1),[1,Ge,1])})}(C=jr(C),te.n)})},G.prototype.getConfig=function(){var C={n:this.n},N=Z.prototype.getConfig.call(this);return Object.assign(C,N),C},G.className="RepeatVector",G}(qi);b.serialization.registerClass(Nl);var Cc=function(Z){function G(C){var N=Z.call(this,C)||this;N.targetShape=C.targetShape;for(var te=0;te<N.targetShape.length;++te)N.isUnknown(N.targetShape[te])&&(N.targetShape[te]=null);return N}return U(G,Z),G.prototype.isUnknown=function(C){return C<0||C==null},G.prototype.fixUnknownDimension=function(C,N){for(var te="Total size of new array must be unchanged.",Be=N.slice(),Ge=1,ft=null,Nt=0;Nt<Be.length;++Nt){var Ut=Be[Nt];if(this.isUnknown(Ut)){if(ft!==null)throw new ee("Can only specifiy one unknown dimension.");ft=Nt}else Ge*=Ut}var ct=Xt(C);if(ft!==null){if(Ge===0||ct%Ge!=0)throw new ee(te);Be[ft]=ct/Ge}else if(ct!==Ge)throw new ee(te);return Be},G.prototype.computeOutputShape=function(C){for(var N=!1,te=0;te<C.length;++te)if(this.isUnknown(C[te])){N=!0;break}return N?C.slice(0,1).concat(this.targetShape):C.slice(0,1).concat(this.fixUnknownDimension(C.slice(1),this.targetShape))},G.prototype.call=function(C,N){var te=this;return Object(b.tidy)(function(){te.invokeCallHook(C,N);var Be=jr(C),Ge=Be.shape,ft=Ge.slice(0,1).concat(te.fixUnknownDimension(Ge.slice(1),te.targetShape));return Be.reshape(ft)})},G.prototype.getConfig=function(){var C={targetShape:this.targetShape},N=Z.prototype.getConfig.call(this);return Object.assign(C,N),C},G.className="Reshape",G}(qi);b.serialization.registerClass(Cc);var km=function(Z){function G(C){var N=Z.call(this,C)||this;if(C.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(C.dims))throw new Error("Permute constructor requires `dims` to be an Array, but received "+C.dims+" instead.");var te=mr(1,C.dims.length+1);if(!b.util.arraysEqual(C.dims.slice().sort(),te))throw new Error("Invalid permutation `dims`: "+JSON.stringify(C.dims)+" `dims` must contain consecutive integers starting from 1.");return N.dims=C.dims,N.dimsIncludingBatch=[0].concat(N.dims),N.inputSpec=[new Zi({ndim:N.dims.length+1})],N}return U(G,Z),G.prototype.computeOutputShape=function(C){var N=(C=Bn(C)).slice();return this.dims.forEach(function(te,Be){N[Be+1]=C[te]}),N},G.prototype.call=function(C,N){return Object(b.transpose)(jr(C),this.dimsIncludingBatch)},G.prototype.getConfig=function(){var C={dims:this.dims},N=Z.prototype.getConfig.call(this);return Object.assign(C,N),C},G.className="Permute",G}(qi);b.serialization.registerClass(km);var Il=function(Z){function G(C){var N=Z.call(this,C??{})||this;return N.supportsMasking=!0,N.maskValue=C!=null?C.maskValue==null?0:C.maskValue:0,N}return U(G,Z),G.prototype.computeOutputShape=function(C){return C},G.prototype.getConfig=function(){var C=Z.prototype.getConfig.call(this),N={maskValue:this.maskValue};return Object.assign(N,C),N},G.prototype.computeMask=function(C,N){var te=jr(C);return Object(b.any)(Object(b.notEqual)(te,this.maskValue),-1)},G.prototype.call=function(C,N){var te=this;return Object(b.tidy)(function(){te.invokeCallHook(C,N);var Be=jr(C),Ge=Object(b.any)(Object(b.notEqual)(Be,te.maskValue),-1,!0);return Be.mul(Ge.asType(Be.dtype))})},G.className="Masking",G}(qi);b.serialization.registerClass(Il);var eo=function(Z){function G(C){var N=Z.call(this,C)||this;if(N.embeddings=null,N.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",C.batchInputShape==null&&C.inputShape==null){var te=null;C.batchSize!=null&&(te=C.batchSize),C.inputLength==null?N.batchInputShape=[te,null]:N.batchInputShape=[te].concat(Ae(C.inputLength))}return N.inputDim=C.inputDim,Pt(N.inputDim,"inputDim"),N.outputDim=C.outputDim,Pt(N.outputDim,"outputDim"),N.embeddingsInitializer=zr(C.embeddingsInitializer||N.DEFAULT_EMBEDDINGS_INITIALIZER),N.embeddingsRegularizer=ro(C.embeddingsRegularizer),N.activityRegularizer=ro(C.activityRegularizer),N.embeddingsConstraint=Yn(C.embeddingsConstraint),N.maskZero=C.maskZero,N.supportsMasking=C.maskZero,N.inputLength=C.inputLength,N}return U(G,Z),G.prototype.build=function(C){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0},G.prototype.warnOnIncompatibleInputShape=function(C){},G.prototype.computeMask=function(C,N){var te=this;return Object(b.tidy)(function(){return te.maskZero?(C=jr(C),Object(b.notEqual)(C,Object(b.zerosLike)(C))):null})},G.prototype.computeOutputShape=function(C){if(C=Bn(C),this.inputLength==null)return C.concat([this.outputDim]);var N=Ae(this.inputLength);if(N.length!==C.length-1)throw new ee('"inputLength" is '+this.inputLength+", but received input shape has shape "+C);for(var te=0,Be=0;Be<N.length;++Be){var Ge=N[Be],ft=C[Be+1];if(Ge!=null&&ft!=null&&Ge!==ft)throw new ee('"inputLength" is '+this.inputLength+", but received input shape has shape "+C);Ge==null&&(N[te]=ft),te++}return[C[0]].concat(N,[this.outputDim])},G.prototype.call=function(C,N){var te=this;return Object(b.tidy)(function(){te.invokeCallHook(C,N);var Be=jr(C);return Be.dtype!=="int32"&&(Be=xr(Be,"int32")),Oa(te.embeddings.read(),Be.as1D()).reshape(Bn(te.computeOutputShape(Be.shape)))})},G.prototype.getConfig=function(){var C={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:ir(this.embeddingsInitializer),embeddingsRegularizer:Ri(this.embeddingsRegularizer),activityRegularizer:Ri(this.activityRegularizer),embeddingsConstraint:xn(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},N=Z.prototype.getConfig.call(this);return Object.assign(C,N),C},G.className="Embedding",G}(qi);b.serialization.registerClass(eo);var Ao=function(Z){function G(C){var N=Z.call(this,C||{})||this;return N.supportsMasking=!0,N}return U(G,Z),G.prototype.mergeFunction=function(C){throw new F},G.prototype.computeElementwiseOpOutputShape=function(C,N){if(C==null||N==null)return null;if(C.length<N.length)return this.computeElementwiseOpOutputShape(N,C);if(N.length===0)return C;for(var te=C.slice(0,C.length-N.length),Be=0;Be<N.length;++Be){var Ge=C[C.length-N.length+Be],ft=N[Be];if(Ge==null||ft==null||Ge<0||ft<0)te.push(null);else if(Ge===1)te.push(ft);else if(ft===1)te.push(Ge);else{if(Ge!==ft)throw new ee("Operands could not be broadcast together with shapes "+JSON.stringify(C)+" "+JSON.stringify(N));te.push(Ge)}}return te},G.prototype.build=function(C){if(Array.isArray(C)&&!Array.isArray(C[0])&&(C=[Bn(C)]),(C=C).length<2)throw new ee("A merge layer should be called on an Array of at least 2 inputs. Got "+C.length+" input(s).");for(var N=[],te=0,Be=C;te<Be.length;te++)(Nt=Be[te])!=null&&Nt[0]!==null&&N.push(Nt[0]);if((N=$t(N)).length>1)throw new ee("Can not merge tensors with different batch sizes. Got tensors with shapes: "+JSON.stringify(C)+".");for(var Ge=C[0]==null?null:C[0].slice(1),ft=1;ft<C.length;++ft){var Nt=C[ft]==null?null:C[ft].slice(1);Ge=this.computeElementwiseOpOutputShape(Ge,Nt)}var Ut=C.map(function(ct){return ct.length});C.indexOf(null)===-1&&$t(Ut).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0},G.prototype.call=function(C,N){var te=this;return Object(b.tidy)(function(){if(C=C,te.reshapeRequired){var Be=[],Ge=C.map(function(oi){return oi.rank});if(Ge.indexOf(null)===-1){for(var ft=Dn(Ge),Nt=0,Ut=C;Nt<Ut.length;Nt++){for(var ct=(Mn=Ut[Nt]).rank,yn=0;yn<ft-ct;++yn)Mn=gr(Mn,1);Be.push(Mn)}return te.mergeFunction(Be)}for(var _n=!1,Nn=0,Wn=C;Nn<Wn.length;Nn++){var Mn;if((ct=(Mn=Wn[Nn]).rank)==null){var tr=Mn.shape,rr=tr[0],hr=tr.slice(1).concat([rr]),Nr=Mn.reshape([rr].concat(Xt(tr.slice(1))));Nr=(Nr=Object(b.transpose)(Nr,[1,0])).reshape(hr),Be.push(Nr),_n=!0}else if(ct>1){var Vr=mr(1,ct).concat([0]);Be.push(Object(b.transpose)(Mn,Vr)),_n=!0}else Be.push(Mn)}var wr=te.mergeFunction(Be),Hr=wr.rank;if(_n)if(Hr==null){var Wr=wr.shape;hr=[rr=Wr[Wr.length-1]].concat(Wr.slice(0,Wr.length-1)),wr=Object(b.transpose)(wr.reshape([-1,rr]),[1,0]).reshape(hr)}else Hr>1&&(Vr=[Hr-1].concat(mr(0,Hr-1)),wr=Object(b.transpose)(wr,Vr));return wr}return te.mergeFunction(C)})},G.prototype.computeOutputShape=function(C){var N;N=(C=C)[0]==null?null:C[0].slice(1);for(var te=1;te<C.length;++te){var Be=C[te]==null?null:C[te].slice(1);N=this.computeElementwiseOpOutputShape(N,Be)}for(var Ge=[],ft=0,Nt=C;ft<Nt.length;ft++)(Be=Nt[ft])!=null&&Be[0]!==null&&Ge.push(Be[0]);return(Ge=$t(Ge)).length===1?Ge.concat(N):[null].concat(N)},G.prototype.computeMask=function(C,N){return Object(b.tidy)(function(){if(N==null)return null;if(!Array.isArray(N))throw new ee("`mask` should be an Array");if(!Array.isArray(C))throw new ee("`inputs` should be an Array");if(N.length!==C.length)throw new ee("The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths ("+C.length+" vs "+N.length+")");if(N.every(function(Ge){return Ge==null}))return null;for(var te=(N=N.map(function(Ge){return Ge==null?Ge:Object(b.expandDims)(Ge,0)}))[0],Be=1;Be<N.length-1;++Be)te=Object(b.logicalAnd)(te,N[Be]);return te})},G}(qi),Fo=function(Z){function G(C){return Z.call(this,C)||this}return U(G,Z),G.prototype.mergeFunction=function(C){return Object(b.tidy)(function(){for(var N=C[0].clone(),te=1;te<C.length;++te)N=Object(b.add)(N,C[te]);return N})},G.className="Add",G}(Ao);b.serialization.registerClass(Fo);var Mi=function(Z){function G(C){return Z.call(this,C)||this}return U(G,Z),G.prototype.mergeFunction=function(C){return Object(b.tidy)(function(){for(var N=C[0].clone(),te=1;te<C.length;++te)N=Object(b.mul)(N,C[te]);return N})},G.className="Multiply",G}(Ao);b.serialization.registerClass(Mi);var Es=function(Z){function G(C){return Z.call(this,C)||this}return U(G,Z),G.prototype.mergeFunction=function(C){return Object(b.tidy)(function(){for(var N=C[0].clone(),te=1;te<C.length;++te)N=Object(b.add)(N,C[te]);return Object(b.mul)(1/C.length,N)})},G.className="Average",G}(Ao);b.serialization.registerClass(Es);var Oc=function(Z){function G(C){return Z.call(this,C)||this}return U(G,Z),G.prototype.mergeFunction=function(C){return Object(b.tidy)(function(){for(var N=C[0],te=1;te<C.length;++te)N=Object(b.maximum)(N,C[te]);return N})},G.className="Maximum",G}(Ao);b.serialization.registerClass(Oc);var Ro=function(Z){function G(C){return Z.call(this,C)||this}return U(G,Z),G.prototype.mergeFunction=function(C){return Object(b.tidy)(function(){for(var N=C[0],te=1;te<C.length;++te)N=Object(b.minimum)(N,C[te]);return N})},G.className="Minimum",G}(Ao);b.serialization.registerClass(Ro);var Ac=function(Z){function G(C){var N=Z.call(this,C)||this;return N.DEFAULT_AXIS=-1,C==null&&(C={}),N.axis=C.axis==null?N.DEFAULT_AXIS:C.axis,N.supportsMasking=!0,N.reshapeRequired=!1,N}return U(G,Z),G.prototype.build=function(C){if(!Array.isArray(C)||!Array.isArray(C[0])||C.length===1)throw new ee("A `Concatenate` layer should be called on a list of at least 2 inputs");for(var N=!0,te=0,Be=C=C;te<Be.length;te++)if((_n=Be[te])!=null){N=!1;break}if(!N){for(var Ge=[],ft=0;ft<C.length;++ft){var Nt=C[ft].slice();Nt.splice(this.axis,1);for(var Ut=!1,ct=0,yn=Ge;ct<yn.length;ct++){var _n=yn[ct];if(b.util.arraysEqual(_n,Nt)){Ut=!0;break}}Ut||Ge.push(Nt)}if(Ge.length>1)throw new ee("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(C))}},G.prototype.mergeFunction=function(C){var N=this;return Object(b.tidy)(function(){return di(C,N.axis)})},G.prototype.computeOutputShape=function(C){if(!Array.isArray(C)||!Array.isArray(C[0]))throw new ee("A `Concatenate` layer should be called on a list of inputs.");for(var N=C,te=N[0].slice(),Be=this.axis<0?te.length+this.axis:this.axis,Ge=0,ft=N.slice(1);Ge<ft.length;Ge++){var Nt=ft[Ge];if(te[Be]==null||Nt[Be]==null){te[Be]=null;break}te[Be]+=Nt[Be]}return te},G.prototype.computeMask=function(C,N){var te=this;if(N==null)return null;if(!Array.isArray(N))throw new ee("`mask` should be an array for Concatenate");if(!Array.isArray(C))throw new ee("`inputs` should be an array for Concatenate");if(N.length!==C.length)throw new ee("Mismatch in the length of mask ("+N.length+") and the legnth of inputs ("+C.length+")");return Object(b.tidy)(function(){var Be=!0;if(N.forEach(function(Ut){Ut==null||(Be=!1)}),Be)return null;for(var Ge=[],ft=0;ft<C.length;++ft)N[ft]==null?Ge.push(Object(b.onesLike)(C[ft]).asType("bool")):N[ft].rank<C[ft].rank?Ge.push(Object(b.expandDims)(N[ft],-1)):Ge.push(N[ft]);var Nt=Object(b.concat)(Ge,te.axis);return Object(b.all)(Nt,-1,!1)})},G.prototype.getConfig=function(){var C={axis:this.axis},N=Z.prototype.getConfig.call(this);return Object.assign(C,N),C},G.className="Concatenate",G}(Ao);function Uu(Z,G){for(;Z<0;)Z+=G;return Z}b.serialization.registerClass(Ac);var Df=function(Z){function G(C){var N=Z.call(this,C)||this;return N.axes=C.axes,N.normalize=C.normalize!=null&&C.normalize,N.supportsMasking=!0,N.reshapeRequired=!1,N}return U(G,Z),G.prototype.build=function(C){b.util.assert(Array.isArray(C)&&C.length===2&&Array.isArray(C[0])&&Array.isArray(C[1]),function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."});var N=C[0],te=C[1];if(N.length>3||te.length>3)throw new F("Dot layer does not support tensors of 4D or higher rank yet.");var Be=this.interpretAxes(N,te);if(N[Be[0]]!==te[Be[1]])throw new ee("Dimension incompatibility: "+N[Be[0]]+" !== "+te[Be[1]])},G.prototype.mergeFunction=function(C){if(C.length!==2)throw new ee("A `Dot` layer must be called on exactly 2 inputs, but received "+C.length+" input(s).");var N,te=C[0],Be=C[1];return N=Array.isArray(this.axes)?this.axes.map(function(Ge,ft){return Uu(Ge,C[ft].shape.length)}):[Uu(this.axes,te.shape.length),Uu(this.axes,Be.shape.length)],this.normalize&&(te=Vc(te,N[0]),Be=Vc(Be,N[1])),function(Ge,ft,Nt){if(Ge.shape.length>3||ft.shape.length>3)throw new F("batchDot is not implemented for tensors of 4D or higher rank yet");if(b.util.assert(Ge.shape.length>=2,function(){return"batchDot requires the rank of x to be >= 2, but got "+Ge.shape.length}),b.util.assert(Ge.shape.length>=2,function(){return"batchDot requires the rank of y to be >= 2, but got "+ft.shape.length}),typeof Nt=="number"&&(Nt=[Nt,Nt]),Ge.dtype==="complex64"||ft.dtype==="complex64")throw new F("batchDot is not implemented for complex64-type Tensors yet.");var Ut=Ge.shape.length,ct=ft.shape.length;Nt==null&&(Nt=[Ut-1,ct-2]);var yn=Nt;return Object(b.tidy)(function(){var _n,Nn;if(Ut>ct){_n=Ut-ct;for(var Wn=[],Mn=0;Mn<_n;++Mn)Wn.push(1);ft=ft.reshape(ft.shape.concat(Wn))}else if(ct>Ut){for(_n=ct-Ut,Wn=[],Mn=0;Mn<_n;++Mn)Wn.push(1);Ge=Ge.reshape(Ge.shape.concat(Wn))}else _n=0;if(Ge.shape.length===2&&ft.shape.length===2)Nn=yn[0]===yn[1]?Ge.mulStrict(ft).sum(yn[0]):Ge.transpose([1,0]).mulStrict(ft).sum(yn[1]);else{var tr=yn[0]!==Ge.shape.length-1,rr=yn[1]===ft.shape.length-1;Nn=Ge.matMul(ft,tr,rr)}if(_n>0){var hr,Nr=[];for(Mn=hr=Ut>ct?Ut+ct-3:Ut-1;Mn<hr+_n;++Mn)Nr.push(Mn);Nn=Nn.squeeze(Nr)}return Nn.shape.length===1&&(Nn=Nn.expandDims(1)),Nn})}(te,Be,N)},G.prototype.interpretAxes=function(C,N){return Array.isArray(this.axes)?this.axes:[Uu(this.axes,C.length),Uu(this.axes,N.length)]},G.prototype.computeOutputShape=function(C){b.util.assert(Array.isArray(C)&&C.length===2&&Array.isArray(C[0])&&Array.isArray(C[1]),function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."});var N=C[0].slice(),te=C[1].slice();if(N.length>3||te.length>3)throw new F("Dot layer does not support tensors of 4D or higher rank yet.");var Be=this.interpretAxes(N,te);N.splice(Be[0],1),te.splice(Be[1],1),te.splice(0,1);var Ge=N.concat(te);return Ge.length===1&&Ge.push(1),Ge},G.prototype.computeMask=function(C,N){return null},G.prototype.getConfig=function(){var C={axes:this.axes,normalize:this.normalize},N=Z.prototype.getConfig.call(this);return Object.assign(C,N),C},G.className="Dot",G}(Ao);b.serialization.registerClass(Df);var Tf=function(Z){function G(C){var N=Z.call(this,C)||this;return N.supportsMasking=!0,N.stddev=C.stddev,N}return U(G,Z),G.prototype.computeOutputShape=function(C){return C},G.prototype.getConfig=function(){var C=Z.prototype.getConfig.call(this),N={stddev:this.stddev};return Object.assign(N,C),N},G.prototype.call=function(C,N){var te=this;return Object(b.tidy)(function(){te.invokeCallHook(C,N);var Be=jr(C);return jt(function(){return fi(Be.shape,0,te.stddev).add(Be)},function(){return Be},N.training||!1)})},G.className="GaussianNoise",G}(qi);b.serialization.registerClass(Tf);var Xc=function(Z){function G(C){var N=Z.call(this,C)||this;return N.supportsMasking=!0,N.rate=C.rate,N}return U(G,Z),G.prototype.computeOutputShape=function(C){return C},G.prototype.getConfig=function(){var C=Z.prototype.getConfig.call(this),N={rate:this.rate};return Object.assign(N,C),N},G.prototype.call=function(C,N){var te=this;return Object(b.tidy)(function(){te.invokeCallHook(C,N);var Be=jr(C);return te.rate>0&&te.rate<1?jt(function(){var Ge=Math.sqrt(te.rate/(1-te.rate));return Be.mul(fi(Be.shape,1,Ge))},function(){return Be},N.training||!1):Be})},G.className="GaussianDropout",G}(qi);b.serialization.registerClass(Xc);var Vd=function(Z){function G(C){var N=Z.call(this,C)||this;return N.supportsMasking=!0,N.rate=C.rate,N.noiseShape=C.noiseShape,N}return U(G,Z),G.prototype._getNoiseShape=function(C){return this.noiseShape||jr(C).shape},G.prototype.computeOutputShape=function(C){return C},G.prototype.getConfig=function(){var C=Z.prototype.getConfig.call(this),N={rate:this.rate};return Object.assign(N,C),N},G.prototype.call=function(C,N){var te=this;return Object(b.tidy)(function(){if(te.rate<1&&te.rate>0){var Be=te._getNoiseShape(C);return jt(function(){var Ge=jr(C),ft=-1.7580993408473766,Nt=Object(b.greaterEqual)(Object(b.randomUniform)(Be),te.rate);Nt=xr(Nt,"float32");var Ut=Math.pow((1-te.rate)*(1+te.rate*Math.pow(ft,2)),-.5),ct=-Ut*ft*te.rate;return Ge.mul(Nt).add(Nt.add(-1).mul(ft)).mul(Ut).add(ct)},function(){return jr(C)},N.training||!1)}return C})},G.className="AlphaDropout",G}(qi);function Wu(Z,G,C,N,te,Be){var Ge;if(Be===void 0&&(Be=.001),Z.rank===2)Ge=Object(b.batchNorm2d)(Z,G,C,N,te,Be);else if(Z.rank===3)Ge=Object(b.batchNorm3d)(Z,G,C,N,te,Be);else{if(Z.rank!==4)throw new F("batchNormalization is not implemented for array of rank "+Z.rank+" yet");Ge=Object(b.batchNorm4d)(Z,G,C,N,te,Be)}return Ge}function Em(Z,G,C,N,te){return te===void 0&&(te=.001),b.util.arraysEqual(N.slice().sort(),mr(0,Z.rank-1))?function(Be,Ge,ft,Nt,Ut){return Ut===void 0&&(Ut=.001),Object(b.tidy)(function(){var ct=Object(b.moments)(Be,Nt),yn=ct.mean,_n=ct.variance;return[Wu(Be,yn,_n,ft,Ge,Ut),yn,_n]})}(Z,G,C,N,te):function(Be,Ge,ft,Nt,Ut){return Ut===void 0&&(Ut=.001),Object(b.tidy)(function(){for(var ct=Object(b.moments)(Be,Nt),yn=ct.mean,_n=ct.variance,Nn=[],Wn=0,Mn=mr(0,Be.rank);Wn<Mn.length;Wn++){var tr=Mn[Wn];Nt.indexOf(tr)!==-1?Nn.push(1):Nn.push(Be.shape[tr])}var rr=yn.reshape(Nn),hr=_n.reshape(Nn),Nr=Ge==null?null:Ge.reshape(Nn),Vr=ft==null?null:ft.reshape(Nn);return[Wu(Be,rr,hr,Vr,Nr,Ut),yn,_n]})}(Z,G,C,N,te)}b.serialization.registerClass(Vd);var qd=function(Z){function G(C){var N=this;return C==null&&(C={}),(N=Z.call(this,C)||this).supportsMasking=!0,N.axis=C.axis==null?-1:C.axis,N.momentum=C.momentum==null?.99:C.momentum,N.epsilon=C.epsilon==null?.001:C.epsilon,N.center=C.center==null||C.center,N.scale=C.scale==null||C.scale,N.betaInitializer=zr(C.betaInitializer||"zeros"),N.gammaInitializer=zr(C.gammaInitializer||"ones"),N.movingMeanInitializer=zr(C.movingMeanInitializer||"zeros"),N.movingVarianceInitializer=zr(C.movingVarianceInitializer||"ones"),N.betaConstraint=Yn(C.betaConstraint),N.gammaConstraint=Yn(C.gammaConstraint),N.betaRegularizer=ro(C.betaRegularizer),N.gammaRegularizer=ro(C.gammaRegularizer),N}return U(G,Z),G.prototype.build=function(C){var N;C=Bn(C);var te=this.axis>=0?this.axis:this.axis+C.length,Be=C[te];if(Be==null)throw new ee("Axis "+te+" of input tensor should have a defined dimension but the layer received an input with shape "+JSON.stringify(C)+".");this.inputSpec=[new Zi({ndim:C.length,axes:(N={},N[te]=Be,N)})];var Ge=[Be];this.scale&&(this.gamma=this.addWeight("gamma",Ge,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",Ge,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",Ge,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",Ge,null,this.movingVarianceInitializer,null,!1),this.built=!0},G.prototype.call=function(C,N){var te=this;return Object(b.tidy)(function(){var Be=N.training!=null&&N.training,Ge=jr(C),ft=Ge.shape,Nt=ft.length,Ut=mr(0,Nt),ct=te.axis>=0?te.axis:te.axis+Nt;Ut.splice(ct,1);var yn=ie(1,Nt);yn[ct]=ft[ct];var _n=Ut.slice();_n.sort();var Nn=!b.util.arraysEqual(_n,mr(0,Nt).slice(0,Nt-1));if(!Be)return function(){if(Nn){var Nr=te.movingMean.read().reshape(yn),Vr=te.movingVariance.read().reshape(yn),wr=te.center?te.beta.read().reshape(yn):null,Hr=te.scale?te.gamma.read().reshape(yn):null;return Wu(Ge,Nr,Vr,wr,Hr,te.epsilon)}return Wu(Ge,te.movingMean.read(),te.movingVariance.read(),te.beta==null?null:te.beta.read(),te.gamma==null?null:te.gamma.read(),te.epsilon)}();var Wn=Em(Ge,te.gamma.read(),te.beta.read(),Ut,te.epsilon),Mn=Wn[0],tr=Wn[1],rr=Wn[2],hr=function(Nr,Vr,wr){Object(b.tidy)(function(){var Hr=1-wr,Wr=Nr.read(),oi=Wr.sub(Vr).mul(Hr);Nr.write(Wr.sub(oi))})};return hr(te.movingMean,tr,te.momentum),hr(te.movingVariance,rr,te.momentum),Mn})},G.prototype.getConfig=function(){var C={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:ir(this.betaInitializer),gammaInitializer:ir(this.gammaInitializer),movingMeanInitializer:ir(this.movingMeanInitializer),movingVarianceInitializer:ir(this.movingVarianceInitializer),betaRegularizer:Ri(this.betaRegularizer),gammaRegularizer:Ri(this.gammaRegularizer),betaConstraint:xn(this.betaConstraint),gammaConstraint:xn(this.gammaConstraint)},N=Z.prototype.getConfig.call(this);return Object.assign(C,N),C},G.className="BatchNormalization",G}(qi);b.serialization.registerClass(qd);var Fl=function(Z){function G(C){var N=this;if(C==null&&(C={}),(N=Z.call(this,C)||this).axis=C.axis==null?-1:C.axis,typeof N.axis=="number"){if(!Number.isInteger(N.axis))throw new Error("Expected axis to be an integer, but received "+N.axis)}else{if(!Array.isArray(N.axis))throw new Error("Expected axis to be an integer or an array of integers, but received "+JSON.stringify(N.axis));for(var te=0,Be=N.axis;te<Be.length;te++){var Ge=Be[te];if(!Number.isInteger(Ge))throw new Error("Expected axis to be an array of integers, but received "+JSON.stringify(N.axis))}}return N.epsilon=C.epsilon==null?.001:C.epsilon,N.center=C.center==null||C.center,N.scale=C.scale==null||C.scale,N.betaInitializer=zr(C.betaInitializer||"zeros"),N.gammaInitializer=zr(C.gammaInitializer||"ones"),N.betaRegularizer=ro(C.betaRegularizer),N.gammaRegularizer=ro(C.gammaRegularizer),N.supportsMasking=!0,N}return U(G,Z),G.prototype.build=function(C){var N=(C=Bn(C)).length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(var te=0;te<this.axis.length;++te)this.axis[te]<0&&(this.axis[te]+=N);for(var Be=0,Ge=this.axis;Be<Ge.length;Be++){var ft=Ge[Be];if(ft<0||ft>=N)throw new Error("Invalid axis: "+ft)}if(this.axis.length!==$t(this.axis).length)throw new Error("Found duplicate axes in: "+this.axis);var Nt=this.axis.map(function(Ut){return C[Ut]});this.scale?this.gamma=this.addWeight("gamma",Nt,"float32",this.gammaInitializer,this.gammaRegularizer,!0):this.gamma=null,this.center?this.beta=this.addWeight("beta",Nt,"float32",this.betaInitializer,this.betaRegularizer,!0):this.beta=null,this.built=!0},G.prototype.call=function(C,N){var te=this,Be=jr(C),Ge=Be.shape,ft=Ge.length;return Object(b.tidy)(function(){for(var Nt=Object(b.moments)(Be,te.axis,!0),Ut=Nt.mean,ct=Nt.variance,yn=ie(1,ft),_n=0,Nn=te.axis;_n<Nn.length;_n++){var Wn=Nn[_n];yn[Wn]=Ge[Wn]}for(var Mn=function(wr){return wr!=null&&wr.shape.length!==ft&&te.axis!==[ft-1]?wr.reshape(yn):wr},tr=Mn(te.gamma.read()),rr=Mn(te.beta.read()),hr=[],Nr=[],Vr=0;Vr<ft;++Vr)te.axis.indexOf(Vr)!==-1?(hr.push(Ge[Vr]),Nr.push(1)):(hr.push(1),Nr.push(Ge[Vr]));return Ut=Ut.tile(hr),ct=ct.tile(hr),tr=tr.tile(Nr),rr=rr.tile(Nr),Wu(Be,Ut,ct,rr,tr,te.epsilon)})},G.prototype.getConfig=function(){var C={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:ir(this.betaInitializer),gammaInitializer:ir(this.gammaInitializer),betaRegularizer:Ri(this.betaRegularizer),gammaRegularizer:Ri(this.gammaRegularizer)},N=Z.prototype.getConfig.call(this);return Object.assign(C,N),C},G.className="LayerNormalization",G}(qi);b.serialization.registerClass(Fl);var jp=function(Z){function G(C){var N=this;if(C==null&&(C={}),(N=Z.call(this,C)||this).dataFormat=C.dataFormat==null?"channelsLast":C.dataFormat,C.padding==null)N.padding=[[1,1],[1,1]];else if(typeof C.padding=="number")N.padding=[[C.padding,C.padding],[C.padding,C.padding]];else{if(C.padding=C.padding,C.padding.length!==2)throw new ee("ZeroPadding2D expects padding to be a length-2 array, but received a length-"+C.padding.length+" array.");var te=void 0,Be=void 0;if(typeof C.padding[0]=="number")te=[C.padding[0],C.padding[0]],Be=[C.padding[1],C.padding[1]];else{if(C.padding=C.padding,C.padding[0].length!==2)throw new ee("ZeroPadding2D expects height padding to be a length-2 array, but received a length-"+C.padding[0].length+" array.");if(te=C.padding[0],C.padding[1].length!==2)throw new ee("ZeroPadding2D expects width padding to be a length-2 array, but received a length-"+C.padding[1].length+" array.");Be=C.padding[1]}N.padding=[te,Be]}return N.inputSpec=[new Zi({ndim:4})],N}return U(G,Z),G.prototype.computeOutputShape=function(C){var N,te;return C=Bn(C),this.dataFormat==="channelsFirst"?(N=C[2]!=null&&C[2]>=0?C[2]+this.padding[0][0]+this.padding[0][1]:null,te=C[3]!=null&&C[3]>=0?C[3]+this.padding[1][0]+this.padding[1][1]:null,[C[0],C[1],N,te]):(N=C[1]!=null&&C[1]>=0?C[1]+this.padding[0][0]+this.padding[0][1]:null,te=C[2]!=null&&C[2]>=0?C[2]+this.padding[1][0]+this.padding[1][1]:null,[C[0],N,te,C[3]])},G.prototype.call=function(C,N){var te=this;return Object(b.tidy)(function(){return function(Be,Ge,ft){return Object(b.tidy)(function(){if(Be.rank!==4)throw new ee("temporalPadding expects input tensor to be 4-D, but received a "+Be.rank+"-D tensor.");if(Ge==null&&(Ge=[[1,1],[1,1]]),Ge.length!==2||Ge[0].length!==2||Ge[1].length!==2)throw new ee("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(ft==null&&(ft="channelsLast"),ft!=="channelsLast"&&ft!=="channelsFirst")throw new ee("Unknown data format: "+ft+". Supported data formats are 'channelsLast' and 'channelsFirst.");var Nt;return Nt=ft==="channelsFirst"?[[0,0],[0,0],Ge[0],Ge[1]]:[[0,0],Ge[0],Ge[1],[0,0]],Object(b.pad)(Be,Nt)})}(jr(C),te.padding,te.dataFormat)})},G.prototype.getConfig=function(){var C={padding:this.padding,dataFormat:this.dataFormat},N=Z.prototype.getConfig.call(this);return Object.assign(C,N),C},G.className="ZeroPadding2D",G}(qi);function Nf(Z,G,C,N,te,Be){return Object(b.tidy)(function(){var Ge;rn(te),kn(Be),Sn(N),C==null&&(C=[1,1]),N==null&&(N="valid"),te==null&&(te="channelsLast"),Be==null&&(Be="max"),Z=Mh(Z,te);var ft=N==="same"?"same":"valid";return Ge=Be==="max"?Object(b.maxPool)(Z,G,C,ft):Object(b.avgPool)(Z,G,C,ft),te==="channelsFirst"&&(Ge=Object(b.transpose)(Ge,[0,3,1,2])),Ge})}function Yc(Z,G,C,N,te,Be){return Object(b.tidy)(function(){var Ge;rn(te),kn(Be),Sn(N),C==null&&(C=[1,1,1]),N==null&&(N="valid"),te==null&&(te="channelsLast"),Be==null&&(Be="max"),Z=Ni(Z,te);var ft=N==="same"?"same":"valid";return Ge=Be==="max"?Object(b.maxPool3d)(Z,G,C,ft):Object(b.avgPool3d)(Z,G,C,ft),te==="channelsFirst"&&(Ge=Object(b.transpose)(Ge,[0,4,1,2,3])),Ge})}b.serialization.registerClass(jp);var Hd=function(Z){function G(C){var N=this;if(C.poolSize==null&&(C.poolSize=2),N=Z.call(this,C)||this,typeof C.poolSize=="number")N.poolSize=[C.poolSize];else{if(!Array.isArray(C.poolSize)||C.poolSize.length!==1||typeof C.poolSize[0]!="number")throw new ee("poolSize for 1D convolutional layer must be a number or an Array of a single number, but received "+JSON.stringify(C.poolSize));N.poolSize=C.poolSize}if(Pt(N.poolSize,"poolSize"),C.strides==null)N.strides=N.poolSize;else if(typeof C.strides=="number")N.strides=[C.strides];else{if(!Array.isArray(C.strides)||C.strides.length!==1||typeof C.strides[0]!="number")throw new ee("strides for 1D convolutional layer must be a number or an Array of a single number, but received "+JSON.stringify(C.strides));N.strides=C.strides}return Pt(N.strides,"strides"),N.padding=C.padding==null?"valid":C.padding,Sn(N.padding),N.inputSpec=[new Zi({ndim:3})],N}return U(G,Z),G.prototype.computeOutputShape=function(C){var N=Rs((C=Bn(C))[1],this.poolSize[0],this.padding,this.strides[0]);return[C[0],N,C[2]]},G.prototype.call=function(C,N){var te=this;return Object(b.tidy)(function(){te.invokeCallHook(C,N),C=gr(jr(C),2);var Be=te.poolingFunction(jr(C),[te.poolSize[0],1],[te.strides[0],1],te.padding,"channelsLast");return Object(b.squeeze)(Be,[2])})},G.prototype.getConfig=function(){var C={poolSize:this.poolSize,padding:this.padding,strides:this.strides},N=Z.prototype.getConfig.call(this);return Object.assign(C,N),C},G}(qi),zh=function(Z){function G(C){return Z.call(this,C)||this}return U(G,Z),G.prototype.poolingFunction=function(C,N,te,Be,Ge){return rn(Ge),Sn(Be),Nf(C,N,te,Be,Ge,"max")},G.className="MaxPooling1D",G}(Hd);b.serialization.registerClass(zh);var yo=function(Z){function G(C){return Z.call(this,C)||this}return U(G,Z),G.prototype.poolingFunction=function(C,N,te,Be,Ge){return rn(Ge),Sn(Be),Nf(C,N,te,Be,Ge,"avg")},G.className="AveragePooling1D",G}(Hd);b.serialization.registerClass(yo);var Rl=function(Z){function G(C){var N=this;if(C.poolSize==null&&(C.poolSize=[2,2]),(N=Z.call(this,C)||this).poolSize=Array.isArray(C.poolSize)?C.poolSize:[C.poolSize,C.poolSize],C.strides==null)N.strides=N.poolSize;else if(Array.isArray(C.strides)){if(C.strides.length!==2)throw new ee("If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length "+C.strides.length+".");N.strides=C.strides}else N.strides=[C.strides,C.strides];return Pt(N.poolSize,"poolSize"),Pt(N.strides,"strides"),N.padding=C.padding==null?"valid":C.padding,N.dataFormat=C.dataFormat==null?"channelsLast":C.dataFormat,rn(N.dataFormat),Sn(N.padding),N.inputSpec=[new Zi({ndim:4})],N}return U(G,Z),G.prototype.computeOutputShape=function(C){C=Bn(C);var N=this.dataFormat==="channelsFirst"?C[2]:C[1],te=this.dataFormat==="channelsFirst"?C[3]:C[2];return N=Rs(N,this.poolSize[0],this.padding,this.strides[0]),te=Rs(te,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[C[0],C[1],N,te]:[C[0],N,te,C[3]]},G.prototype.call=function(C,N){var te=this;return Object(b.tidy)(function(){return te.invokeCallHook(C,N),te.poolingFunction(jr(C),te.poolSize,te.strides,te.padding,te.dataFormat)})},G.prototype.getConfig=function(){var C={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},N=Z.prototype.getConfig.call(this);return Object.assign(C,N),C},G}(qi),Cs=function(Z){function G(C){return Z.call(this,C)||this}return U(G,Z),G.prototype.poolingFunction=function(C,N,te,Be,Ge){return rn(Ge),Sn(Be),Nf(C,N,te,Be,Ge,"max")},G.className="MaxPooling2D",G}(Rl);b.serialization.registerClass(Cs);var Ml=function(Z){function G(C){return Z.call(this,C)||this}return U(G,Z),G.prototype.poolingFunction=function(C,N,te,Be,Ge){return rn(Ge),Sn(Be),Nf(C,N,te,Be,Ge,"avg")},G.className="AveragePooling2D",G}(Rl);b.serialization.registerClass(Ml);var If=function(Z){function G(C){var N=this;if(C.poolSize==null&&(C.poolSize=[2,2,2]),(N=Z.call(this,C)||this).poolSize=Array.isArray(C.poolSize)?C.poolSize:[C.poolSize,C.poolSize,C.poolSize],C.strides==null)N.strides=N.poolSize;else if(Array.isArray(C.strides)){if(C.strides.length!==3)throw new ee("If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length "+C.strides.length+".");N.strides=C.strides}else N.strides=[C.strides,C.strides,C.strides];return Pt(N.poolSize,"poolSize"),Pt(N.strides,"strides"),N.padding=C.padding==null?"valid":C.padding,N.dataFormat=C.dataFormat==null?"channelsLast":C.dataFormat,rn(N.dataFormat),Sn(N.padding),N.inputSpec=[new Zi({ndim:5})],N}return U(G,Z),G.prototype.computeOutputShape=function(C){C=Bn(C);var N=this.dataFormat==="channelsFirst"?C[2]:C[1],te=this.dataFormat==="channelsFirst"?C[3]:C[2],Be=this.dataFormat==="channelsFirst"?C[4]:C[3];return N=Rs(N,this.poolSize[0],this.padding,this.strides[0]),te=Rs(te,this.poolSize[1],this.padding,this.strides[1]),Be=Rs(Be,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[C[0],C[1],N,te,Be]:[C[0],N,te,Be,C[4]]},G.prototype.call=function(C,N){var te=this;return Object(b.tidy)(function(){return te.invokeCallHook(C,N),te.poolingFunction(jr(C),te.poolSize,te.strides,te.padding,te.dataFormat)})},G.prototype.getConfig=function(){var C={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},N=Z.prototype.getConfig.call(this);return Object.assign(C,N),C},G}(qi),Uh=function(Z){function G(C){return Z.call(this,C)||this}return U(G,Z),G.prototype.poolingFunction=function(C,N,te,Be,Ge){return rn(Ge),Sn(Be),Yc(C,N,te,Be,Ge,"max")},G.className="MaxPooling3D",G}(If);b.serialization.registerClass(Uh);var $d=function(Z){function G(C){return Z.call(this,C)||this}return U(G,Z),G.prototype.poolingFunction=function(C,N,te,Be,Ge){return rn(Ge),Sn(Be),Yc(C,N,te,Be,Ge,"avg")},G.className="AveragePooling3D",G}(If);b.serialization.registerClass($d);var Ff=function(Z){function G(C){var N=Z.call(this,C)||this;return N.inputSpec=[new Zi({ndim:3})],N}return U(G,Z),G.prototype.computeOutputShape=function(C){return[C[0],C[2]]},G.prototype.call=function(C,N){throw new F},G}(qi),jl=function(Z){function G(C){return Z.call(this,C||{})||this}return U(G,Z),G.prototype.call=function(C,N){return Object(b.tidy)(function(){var te=jr(C);return Object(b.mean)(te,1)})},G.className="GlobalAveragePooling1D",G}(Ff);b.serialization.registerClass(jl);var Gd=function(Z){function G(C){return Z.call(this,C||{})||this}return U(G,Z),G.prototype.call=function(C,N){return Object(b.tidy)(function(){var te=jr(C);return Object(b.max)(te,1)})},G.className="GlobalMaxPooling1D",G}(Ff);b.serialization.registerClass(Gd);var Kd=function(Z){function G(C){var N=Z.call(this,C)||this;return N.dataFormat=C.dataFormat==null?"channelsLast":C.dataFormat,rn(N.dataFormat),N.inputSpec=[new Zi({ndim:4})],N}return U(G,Z),G.prototype.computeOutputShape=function(C){return C=C,this.dataFormat==="channelsLast"?[C[0],C[3]]:[C[0],C[1]]},G.prototype.call=function(C,N){throw new F},G.prototype.getConfig=function(){var C={dataFormat:this.dataFormat},N=Z.prototype.getConfig.call(this);return Object.assign(C,N),C},G}(qi),en=function(Z){function G(){return Z!==null&&Z.apply(this,arguments)||this}return U(G,Z),G.prototype.call=function(C,N){var te=this;return Object(b.tidy)(function(){var Be=jr(C);return te.dataFormat==="channelsLast"?Object(b.mean)(Be,[1,2]):Object(b.mean)(Be,[2,3])})},G.className="GlobalAveragePooling2D",G}(Kd);b.serialization.registerClass(en);var Ws=function(Z){function G(){return Z!==null&&Z.apply(this,arguments)||this}return U(G,Z),G.prototype.call=function(C,N){var te=this;return Object(b.tidy)(function(){var Be=jr(C);return te.dataFormat==="channelsLast"?Object(b.max)(Be,[1,2]):Object(b.max)(Be,[2,3])})},G.className="GlobalMaxPooling2D",G}(Kd);function Un(Z,G,C,N){if(Array.isArray(Z)){if(G!=null||C!=null)throw new ee("When inputs is an array, neither initialState or constants should be provided");N!=null&&(C=Z.slice(Z.length-N,Z.length),Z=Z.slice(0,Z.length-N)),Z.length>1&&(G=Z.slice(1,Z.length)),Z=Z[0]}function te(Be){return Be==null||Array.isArray(Be)?Be:[Be]}return{inputs:Z,initialState:G=te(G),constants:C=te(C)}}function Os(Z,G,C,N,te,Be,Ge,ft){return N===void 0&&(N=!1),Ge===void 0&&(Ge=!1),ft===void 0&&(ft=!1),Object(b.tidy)(function(){var Nt=G.shape.length;if(Nt<3)throw new ee("Input should be at least 3D, but is "+Nt+"D.");var Ut=[1,0].concat(mr(2,Nt));G=Object(b.transpose)(G,Ut),Be!=null,Ge&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),te!=null&&((te=te.asType("bool").asType("float32")).rank===Nt-1&&(te=Object(b.expandDims)(te,-1)),te=Object(b.transpose)(te,Ut)),N&&(G=Object(b.reverse)(G,0),te!=null&&(te=Object(b.reverse)(te,0)));var ct,yn,_n=[],Nn=C,Wn=G.shape[0],Mn=Object(b.unstack)(G);te!=null&&(yn=Object(b.unstack)(te));for(var tr,rr=function(Nr){var Vr=Mn[Nr],wr=Object(b.tidy)(function(){return Z(Vr,Nn)});if(te==null)ct=wr[0],Nn=wr[1];else{var Hr=Object(b.tidy)(function(){var Wr=yn[Nr],oi=Object(b.onesLike)(Wr).sub(Wr);return{output:wr[0].mul(Wr).addStrict(Nn[0].mul(oi)),newStates:Nn.map(function(li,$r){return wr[1][$r].mul(Wr).addStrict(li.mul(oi))})}});ct=Hr.output,Nn=Hr.newStates}ft&&_n.push(ct)},hr=0;hr<Wn;++hr)rr(hr);return ft&&(tr=Object(b.stack)(_n,1)),[ct,tr,Nn]})}b.serialization.registerClass(Ws);var na=function(Z){function G(C){var N,te=Z.call(this,C)||this;if(C.cell==null)throw new ee("cell property is missing for the constructor of RNN.");if((N=Array.isArray(C.cell)?new oc({cells:C.cell}):C.cell).stateSize==null)throw new ee("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");return te.cell=N,te.returnSequences=C.returnSequences!=null&&C.returnSequences,te.returnState=C.returnState!=null&&C.returnState,te.goBackwards=C.goBackwards!=null&&C.goBackwards,te._stateful=C.stateful!=null&&C.stateful,te.unroll=C.unroll!=null&&C.unroll,te.supportsMasking=!0,te.inputSpec=[new Zi({ndim:3})],te.stateSpec=null,te.states_=null,te.numConstants=null,te.keptStates=[],te}return U(G,Z),G.prototype.getStates=function(){return this.states_==null?mr(0,Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1).map(function(C){return null}):this.states_},G.prototype.setStates=function(C){this.states_=C},G.prototype.computeOutputShape=function(C){Di(C)&&(C=C[0]),C=C;var N=this.cell.stateSize;Array.isArray(N)||(N=[N]);var te,Be=N[0];if(te=this.returnSequences?[C[0],C[1],Be]:[C[0],Be],this.returnState){for(var Ge=[],ft=0,Nt=N;ft<Nt.length;ft++){var Ut=Nt[ft];Ge.push([C[0],Ut])}return[te].concat(Ge)}return te},G.prototype.computeMask=function(C,N){var te=this;return Object(b.tidy)(function(){Array.isArray(N)&&(N=N[0]);var Be=te.returnSequences?N:null;if(te.returnState){var Ge=te.states.map(function(ft){return null});return[Be].concat(Ge)}return Be})},Object.defineProperty(G.prototype,"states",{get:function(){if(this.states_==null){for(var C=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,N=[],te=0;te<C;++te)N.push(null);return N}return this.states_},set:function(C){this.states_=C},enumerable:!0,configurable:!0}),G.prototype.build=function(C){if(this.numConstants!=null)throw new F("Constants support is not implemented in RNN yet.");Di(C)&&(C=C[0]),C=C;var N=this.stateful?C[0]:null,te=C[C.length-1];this.inputSpec[0]=new Zi({shape:[N,null,te]});var Be,Ge=[C[0]].concat(C.slice(2));if(this.cell.build(Ge),Be=Array.isArray(this.cell.stateSize)?this.cell.stateSize:[this.cell.stateSize],this.stateSpec!=null){if(!b.util.arraysEqual(this.stateSpec.map(function(ft){return ft.shape[ft.shape.length-1]}),Be))throw new ee("An initialState was passed that is not compatible with cell.stateSize. Received stateSpec="+this.stateSpec+"; However cell.stateSize is "+this.cell.stateSize)}else this.stateSpec=Be.map(function(ft){return new Zi({shape:[null,ft]})});this.stateful&&this.resetStates()},G.prototype.resetStates=function(C,N){var te=this;N===void 0&&(N=!1),Object(b.tidy)(function(){if(!te.stateful)throw new $("Cannot call resetStates() on an RNN Layer that is not stateful.");var Be=te.inputSpec[0].shape[0];if(Be==null)throw new ee("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(te.states_==null)Array.isArray(te.cell.stateSize)?te.states_=te.cell.stateSize.map(function(ct){return Object(b.zeros)([Be,ct])}):te.states_=[Object(b.zeros)([Be,te.cell.stateSize])];else if(C==null)Object(b.dispose)(te.states_),te.keptStates!=null&&(Object(b.dispose)(te.keptStates),te.keptStates=[]),Array.isArray(te.cell.stateSize)?te.states_=te.cell.stateSize.map(function(ct){return Object(b.zeros)([Be,ct])}):te.states_[0]=Object(b.zeros)([Be,te.cell.stateSize]);else{if(Array.isArray(C)||(C=[C]),C.length!==te.states_.length)throw new ee("Layer "+te.name+" expects "+te.states_.length+" state(s), but it received "+C.length+" state value(s). Input received: "+C);N===!0?te.keptStates.push(te.states_.slice()):Object(b.dispose)(te.states_);for(var Ge=0;Ge<te.states_.length;++Ge){var ft=C[Ge],Nt=Array.isArray(te.cell.stateSize)?te.cell.stateSize[Ge]:te.cell.stateSize,Ut=[Be,Nt];if(!b.util.arraysEqual(ft.shape,Ut))throw new ee("State "+Ge+" is incompatible with layer "+te.name+": expected shape="+Ut+", received shape="+ft.shape);te.states_[Ge]=ft}}te.states_=te.states_.map(function(ct){return Object(b.keep)(ct.clone())})})},G.prototype.apply=function(C,N){var te=N==null?null:N.initialState,Be=N==null?null:N.constants;N==null&&(N={});var Ge=Un(C,te,Be,this.numConstants);C=Ge.inputs,te=Ge.initialState,Be=Ge.constants;var ft=[],Nt=[];if(te!=null){N.initialState=te,ft=ft.concat(te),this.stateSpec=[];for(var Ut=0,ct=te;Ut<ct.length;Ut++){var yn=ct[Ut];this.stateSpec.push(new Zi({shape:yn.shape}))}Nt=Nt.concat(this.stateSpec)}if(Be!=null&&(N.constants=Be,ft=ft.concat(Be),this.numConstants=Be.length),ft[0]instanceof ga){var _n=[C].concat(ft),Nn=this.inputSpec.concat(Nt),Wn=this.inputSpec;this.inputSpec=Nn;var Mn=Z.prototype.apply.call(this,_n,N);return this.inputSpec=Wn,Mn}return Z.prototype.apply.call(this,C,N)},G.prototype.call=function(C,N){var te=this;return Object(b.tidy)(function(){var Be=N==null?null:N.mask,Ge=N==null?null:N.training,ft=N==null?null:N.initialState;C=jr(C),ft==null&&(ft=te.stateful?te.states_:te.getInitialState(C));var Nt=Array.isArray(te.cell.stateSize)?te.cell.stateSize.length:1;if(ft.length!==Nt)throw new ee("RNN Layer has "+Nt+" state(s) but was passed "+ft.length+" initial state(s).");te.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");var Ut={training:Ge},ct=Os(function(Mn,tr){var rr=te.cell.call([Mn].concat(tr),Ut);return[rr[0],rr.slice(1)]},C,ft,te.goBackwards,Be,null,te.unroll,te.returnSequences),yn=ct[0],_n=ct[1],Nn=ct[2];te.stateful&&te.resetStates(Nn,Ge);var Wn=te.returnSequences?_n:yn;return te.returnState?[Wn].concat(Nn):Wn})},G.prototype.getInitialState=function(C){var N=this;return Object(b.tidy)(function(){var te=Object(b.zeros)(C.shape);return te=gr(te=Object(b.sum)(te,[1,2])),Array.isArray(N.cell.stateSize)?N.cell.stateSize.map(function(Be){return Be>1?Xr(te,[1,Be]):te}):N.cell.stateSize>1?[Xr(te,[1,N.cell.stateSize])]:[te]})},Object.defineProperty(G.prototype,"trainableWeights",{get:function(){return this.trainable?this.cell.trainableWeights:[]},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"nonTrainableWeights",{get:function(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights},enumerable:!0,configurable:!0}),G.prototype.setFastWeightInitDuringBuild=function(C){Z.prototype.setFastWeightInitDuringBuild.call(this,C),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(C)},G.prototype.getConfig=function(){var C={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(C.numConstants=this.numConstants);var N=this.cell.getConfig();C.cell={className:this.cell.getClassName(),config:N};var te=Z.prototype.getConfig.call(this);return Object.assign(C,te),C},G.fromConfig=function(C,N,te){te===void 0&&(te={});var Be=Io(N.cell,te);return new C(Object.assign(N,{cell:Be}))},G.className="RNN",G}(qi);b.serialization.registerClass(na);var Bl=function(Z){function G(){return Z!==null&&Z.apply(this,arguments)||this}return U(G,Z),G}(qi),Rf=function(Z){function G(C){var N=Z.call(this,C)||this;return N.DEFAULT_ACTIVATION="tanh",N.DEFAULT_KERNEL_INITIALIZER="glorotNormal",N.DEFAULT_RECURRENT_INITIALIZER="orthogonal",N.DEFAULT_BIAS_INITIALIZER="zeros",N.units=C.units,Pt(N.units,"units"),N.activation=Ba(C.activation==null?N.DEFAULT_ACTIVATION:C.activation),N.useBias=C.useBias==null||C.useBias,N.kernelInitializer=zr(C.kernelInitializer||N.DEFAULT_KERNEL_INITIALIZER),N.recurrentInitializer=zr(C.recurrentInitializer||N.DEFAULT_RECURRENT_INITIALIZER),N.biasInitializer=zr(C.biasInitializer||N.DEFAULT_BIAS_INITIALIZER),N.kernelRegularizer=ro(C.kernelRegularizer),N.recurrentRegularizer=ro(C.recurrentRegularizer),N.biasRegularizer=ro(C.biasRegularizer),N.kernelConstraint=Yn(C.kernelConstraint),N.recurrentConstraint=Yn(C.recurrentConstraint),N.biasConstraint=Yn(C.biasConstraint),N.dropout=Gn([1,Dn([0,C.dropout==null?0:C.dropout])]),N.recurrentDropout=Gn([1,Dn([0,C.recurrentDropout==null?0:C.recurrentDropout])]),N.stateSize=N.units,N.dropoutMask=null,N.recurrentDropoutMask=null,N}return U(G,Z),G.prototype.build=function(C){C=Bn(C),this.kernel=this.addWeight("kernel",[C[C.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},G.prototype.call=function(C,N){var te=this;return Object(b.tidy)(function(){if((C=C).length!==2)throw new ee("SimpleRNNCell expects 2 input Tensors, got "+C.length+".");var Be=C[1];C=C[0];var Ge,ft=N.training!=null&&N.training;0<te.dropout&&te.dropout<1&&te.dropoutMask==null&&(te.dropoutMask=Vs(function(){return Object(b.onesLike)(C)},te.dropout,ft)),0<te.recurrentDropout&&te.recurrentDropout<1&&te.recurrentDropoutMask==null&&(te.recurrentDropoutMask=Vs(function(){return Object(b.onesLike)(Be)},te.recurrentDropout,ft));var Nt=te.dropoutMask,Ut=te.recurrentDropoutMask;Ge=ai(Nt!=null?Object(b.mul)(C,Nt):C,te.kernel.read()),te.bias!=null&&(Ge=yt(Ge,te.bias.read())),Ut!=null&&(Be=Object(b.mul)(Be,Ut));var ct=Object(b.add)(Ge,ai(Be,te.recurrentKernel.read()));return te.activation!=null&&(ct=te.activation.apply(ct)),[ct,ct]})},G.prototype.getConfig=function(){var C={units:this.units,activation:us(this.activation),useBias:this.useBias,kernelInitializer:ir(this.kernelInitializer),recurrentInitializer:ir(this.recurrentInitializer),biasInitializer:ir(this.biasInitializer),kernelRegularizer:Ri(this.kernelRegularizer),recurrentRegularizer:Ri(this.recurrentRegularizer),biasRegularizer:Ri(this.biasRegularizer),activityRegularizer:Ri(this.activityRegularizer),kernelConstraint:xn(this.kernelConstraint),recurrentConstraint:xn(this.recurrentConstraint),biasConstraint:xn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout},N=Z.prototype.getConfig.call(this);return Object.assign(C,N),C},G.className="SimpleRNNCell",G}(Bl);b.serialization.registerClass(Rf);var nr=function(Z){function G(C){return C.cell=new Rf(C),Z.call(this,C)||this}return U(G,Z),G.prototype.call=function(C,N){var te=this;return Object(b.tidy)(function(){te.cell.dropoutMask!=null&&(Object(b.dispose)(te.cell.dropoutMask),te.cell.dropoutMask=null),te.cell.recurrentDropoutMask!=null&&(Object(b.dispose)(te.cell.recurrentDropoutMask),te.cell.recurrentDropoutMask=null);var Be=N==null?null:N.mask,Ge=N==null?null:N.training,ft=N==null?null:N.initialState;return Z.prototype.call.call(te,C,{mask:Be,training:Ge,initialState:ft})})},Object.defineProperty(G.prototype,"units",{get:function(){return this.cell.units},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"activation",{get:function(){return this.cell.activation},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"useBias",{get:function(){return this.cell.useBias},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"kernelInitializer",{get:function(){return this.cell.kernelInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"recurrentInitializer",{get:function(){return this.cell.recurrentInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"biasInitializer",{get:function(){return this.cell.biasInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"kernelRegularizer",{get:function(){return this.cell.kernelRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"recurrentRegularizer",{get:function(){return this.cell.recurrentRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"biasRegularizer",{get:function(){return this.cell.biasRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"kernelConstraint",{get:function(){return this.cell.kernelConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"recurrentConstraint",{get:function(){return this.cell.recurrentConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"biasConstraint",{get:function(){return this.cell.biasConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"dropout",{get:function(){return this.cell.dropout},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"recurrentDropout",{get:function(){return this.cell.recurrentDropout},enumerable:!0,configurable:!0}),G.prototype.getConfig=function(){var C={units:this.units,activation:us(this.activation),useBias:this.useBias,kernelInitializer:ir(this.kernelInitializer),recurrentInitializer:ir(this.recurrentInitializer),biasInitializer:ir(this.biasInitializer),kernelRegularizer:Ri(this.kernelRegularizer),recurrentRegularizer:Ri(this.recurrentRegularizer),biasRegularizer:Ri(this.biasRegularizer),activityRegularizer:Ri(this.activityRegularizer),kernelConstraint:xn(this.kernelConstraint),recurrentConstraint:xn(this.recurrentConstraint),biasConstraint:xn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout},N=Z.prototype.getConfig.call(this);return delete N.cell,Object.assign(C,N),C},G.fromConfig=function(C,N){return new C(N)},G.className="SimpleRNN",G}(na);b.serialization.registerClass(nr);var Go=function(Z){function G(C){var N=Z.call(this,C)||this;return N.DEFAULT_ACTIVATION="tanh",N.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",N.DEFAULT_KERNEL_INITIALIZER="glorotNormal",N.DEFAULT_RECURRENT_INITIALIZER="orthogonal",N.DEFAULT_BIAS_INITIALIZER="zeros",N.units=C.units,Pt(N.units,"units"),N.activation=Ba(C.activation===void 0?N.DEFAULT_ACTIVATION:C.activation),N.recurrentActivation=Ba(C.recurrentActivation===void 0?N.DEFAULT_RECURRENT_ACTIVATION:C.recurrentActivation),N.useBias=C.useBias==null||C.useBias,N.kernelInitializer=zr(C.kernelInitializer||N.DEFAULT_KERNEL_INITIALIZER),N.recurrentInitializer=zr(C.recurrentInitializer||N.DEFAULT_RECURRENT_INITIALIZER),N.biasInitializer=zr(C.biasInitializer||N.DEFAULT_BIAS_INITIALIZER),N.kernelRegularizer=ro(C.kernelRegularizer),N.recurrentRegularizer=ro(C.recurrentRegularizer),N.biasRegularizer=ro(C.biasRegularizer),N.kernelConstraint=Yn(C.kernelConstraint),N.recurrentConstraint=Yn(C.recurrentConstraint),N.biasConstraint=Yn(C.biasConstraint),N.dropout=Gn([1,Dn([0,C.dropout==null?0:C.dropout])]),N.recurrentDropout=Gn([1,Dn([0,C.recurrentDropout==null?0:C.recurrentDropout])]),N.implementation=C.implementation,N.stateSize=N.units,N.dropoutMask=null,N.recurrentDropoutMask=null,N}return U(G,Z),G.prototype.build=function(C){var N=(C=Bn(C))[C.length-1];this.kernel=this.addWeight("kernel",[N,3*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,3*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[3*this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},G.prototype.call=function(C,N){var te=this;return Object(b.tidy)(function(){if((C=C).length!==2)throw new ee("GRUCell expects 2 input Tensors (inputs, h, c), got "+C.length+".");var Be=N.training!=null&&N.training,Ge=C[1];C=C[0],0<te.dropout&&te.dropout<1&&te.dropoutMask==null&&(te.dropoutMask=Vs(function(){return Object(b.onesLike)(C)},te.dropout,Be,3)),0<te.recurrentDropout&&te.recurrentDropout<1&&te.recurrentDropoutMask==null&&(te.recurrentDropoutMask=Vs(function(){return Object(b.onesLike)(Ge)},te.recurrentDropout,Be,3));var ft,Nt,Ut,ct=te.dropoutMask,yn=te.recurrentDropoutMask;0<te.dropout&&te.dropout<1&&(C=Object(b.mul)(C,ct[0]));var _n=ai(C,te.kernel.read());te.useBias&&(_n=yt(_n,te.bias.read())),0<te.recurrentDropout&&te.recurrentDropout<1&&(Ge=Object(b.mul)(Ge,yn[0]));var Nn=te.recurrentKernel.read(),Wn=Object(b.split)(Nn,[2*te.units,te.units],Nn.rank-1),Mn=Wn[0],tr=Wn[1],rr=ai(Ge,Mn),hr=Object(b.split)(_n,3,_n.rank-1),Nr=hr[0],Vr=hr[1],wr=hr[2],Hr=Object(b.split)(rr,2,rr.rank-1),Wr=Hr[0],oi=Hr[1];ft=te.recurrentActivation.apply(Object(b.add)(Nr,Wr)),Nt=te.recurrentActivation.apply(Object(b.add)(Vr,oi));var li=ai(Object(b.mul)(Nt,Ge),tr);Ut=te.activation.apply(Object(b.add)(wr,li));var $r=Object(b.add)(Object(b.mul)(ft,Ge),Object(b.mul)(Object(b.add)(1,Object(b.neg)(ft)),Ut));return[$r,$r]})},G.prototype.getConfig=function(){var C={units:this.units,activation:us(this.activation),recurrentActivation:us(this.recurrentActivation),useBias:this.useBias,kernelInitializer:ir(this.kernelInitializer),recurrentInitializer:ir(this.recurrentInitializer),biasInitializer:ir(this.biasInitializer),kernelRegularizer:Ri(this.kernelRegularizer),recurrentRegularizer:Ri(this.recurrentRegularizer),biasRegularizer:Ri(this.biasRegularizer),activityRegularizer:Ri(this.activityRegularizer),kernelConstraint:xn(this.kernelConstraint),recurrentConstraint:xn(this.recurrentConstraint),biasConstraint:xn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},N=Z.prototype.getConfig.call(this);return Object.assign(C,N),C},G.className="GRUCell",G}(Bl);b.serialization.registerClass(Go);var bo=function(Z){function G(C){return C.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),C.cell=new Go(C),Z.call(this,C)||this}return U(G,Z),G.prototype.call=function(C,N){var te=this;return Object(b.tidy)(function(){te.cell.dropoutMask!=null&&(Object(b.dispose)(te.cell.dropoutMask),te.cell.dropoutMask=null),te.cell.recurrentDropoutMask!=null&&(Object(b.dispose)(te.cell.recurrentDropoutMask),te.cell.recurrentDropoutMask=null);var Be=N==null?null:N.mask,Ge=N==null?null:N.training,ft=N==null?null:N.initialState;return Z.prototype.call.call(te,C,{mask:Be,training:Ge,initialState:ft})})},Object.defineProperty(G.prototype,"units",{get:function(){return this.cell.units},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"activation",{get:function(){return this.cell.activation},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"recurrentActivation",{get:function(){return this.cell.recurrentActivation},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"useBias",{get:function(){return this.cell.useBias},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"kernelInitializer",{get:function(){return this.cell.kernelInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"recurrentInitializer",{get:function(){return this.cell.recurrentInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"biasInitializer",{get:function(){return this.cell.biasInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"kernelRegularizer",{get:function(){return this.cell.kernelRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"recurrentRegularizer",{get:function(){return this.cell.recurrentRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"biasRegularizer",{get:function(){return this.cell.biasRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"kernelConstraint",{get:function(){return this.cell.kernelConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"recurrentConstraint",{get:function(){return this.cell.recurrentConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"biasConstraint",{get:function(){return this.cell.biasConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"dropout",{get:function(){return this.cell.dropout},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"recurrentDropout",{get:function(){return this.cell.recurrentDropout},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"implementation",{get:function(){return this.cell.implementation},enumerable:!0,configurable:!0}),G.prototype.getConfig=function(){var C={units:this.units,activation:us(this.activation),recurrentActivation:us(this.recurrentActivation),useBias:this.useBias,kernelInitializer:ir(this.kernelInitializer),recurrentInitializer:ir(this.recurrentInitializer),biasInitializer:ir(this.biasInitializer),kernelRegularizer:Ri(this.kernelRegularizer),recurrentRegularizer:Ri(this.recurrentRegularizer),biasRegularizer:Ri(this.biasRegularizer),activityRegularizer:Ri(this.activityRegularizer),kernelConstraint:xn(this.kernelConstraint),recurrentConstraint:xn(this.recurrentConstraint),biasConstraint:xn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},N=Z.prototype.getConfig.call(this);return delete N.cell,Object.assign(C,N),C},G.fromConfig=function(C,N){return N.implmentation===0&&(N.implementation=1),new C(N)},G.className="GRU",G}(na);b.serialization.registerClass(bo);var Hi=function(Z){function G(C){var N=Z.call(this,C)||this;return N.DEFAULT_ACTIVATION="tanh",N.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",N.DEFAULT_KERNEL_INITIALIZER="glorotNormal",N.DEFAULT_RECURRENT_INITIALIZER="orthogonal",N.DEFAULT_BIAS_INITIALIZER="zeros",N.units=C.units,Pt(N.units,"units"),N.activation=Ba(C.activation===void 0?N.DEFAULT_ACTIVATION:C.activation),N.recurrentActivation=Ba(C.recurrentActivation===void 0?N.DEFAULT_RECURRENT_ACTIVATION:C.recurrentActivation),N.useBias=C.useBias==null||C.useBias,N.kernelInitializer=zr(C.kernelInitializer||N.DEFAULT_KERNEL_INITIALIZER),N.recurrentInitializer=zr(C.recurrentInitializer||N.DEFAULT_RECURRENT_INITIALIZER),N.biasInitializer=zr(C.biasInitializer||N.DEFAULT_BIAS_INITIALIZER),N.unitForgetBias=C.unitForgetBias,N.kernelRegularizer=ro(C.kernelRegularizer),N.recurrentRegularizer=ro(C.recurrentRegularizer),N.biasRegularizer=ro(C.biasRegularizer),N.kernelConstraint=Yn(C.kernelConstraint),N.recurrentConstraint=Yn(C.recurrentConstraint),N.biasConstraint=Yn(C.biasConstraint),N.dropout=Gn([1,Dn([0,C.dropout==null?0:C.dropout])]),N.recurrentDropout=Gn([1,Dn([0,C.recurrentDropout==null?0:C.recurrentDropout])]),N.implementation=C.implementation,N.stateSize=[N.units,N.units],N.dropoutMask=null,N.recurrentDropoutMask=null,N}return U(G,Z),G.prototype.build=function(C){var N,te,Be=(C=Bn(C))[C.length-1];if(this.kernel=this.addWeight("kernel",[Be,4*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,4*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){if(this.unitForgetBias){var Ge=this.biasInitializer,ft=this.units;te=new((N=function(Nt){function Ut(){return Nt!==null&&Nt.apply(this,arguments)||this}return U(Ut,Nt),Ut.prototype.apply=function(ct,yn){var _n=Ge.apply([ft]),Nn=new Ze().apply([ft]),Wn=Ge.apply([2*ft]);return Yr(Yr(_n,Nn),Wn)},Ut}(ye)).className="CustomInit",N)}else te=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.units],null,te,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0},G.prototype.call=function(C,N){var te=this;return Object(b.tidy)(function(){var Be=N.training!=null&&N.training;if((C=C).length!==3)throw new ee("LSTMCell expects 3 input Tensors (inputs, h, c), got "+C.length+".");var Ge=C[1],ft=C[2];C=C[0],0<te.dropout&&te.dropout<1&&te.dropoutMask==null&&(te.dropoutMask=Vs(function(){return Object(b.onesLike)(C)},te.dropout,Be,4)),0<te.recurrentDropout&&te.recurrentDropout<1&&te.recurrentDropoutMask==null&&(te.recurrentDropoutMask=Vs(function(){return Object(b.onesLike)(Ge)},te.recurrentDropout,Be,4));var Nt,Ut,ct,yn,_n=te.dropoutMask,Nn=te.recurrentDropoutMask;0<te.dropout&&te.dropout<1&&(C=Object(b.mul)(C,_n[0]));var Wn=ai(C,te.kernel.read());0<te.recurrentDropout&&te.recurrentDropout<1&&(Ge=Object(b.mul)(Ge,Nn[0])),Wn=Object(b.add)(Wn,ai(Ge,te.recurrentKernel.read())),te.useBias&&(Wn=yt(Wn,te.bias.read()));var Mn=Object(b.split)(Wn,4,Wn.rank-1),tr=Mn[0],rr=Mn[1],hr=Mn[2],Nr=Mn[3];Nt=te.recurrentActivation.apply(tr),Ut=te.recurrentActivation.apply(rr),ct=Object(b.add)(Object(b.mul)(Ut,ft),Object(b.mul)(Nt,te.activation.apply(hr))),yn=te.recurrentActivation.apply(Nr);var Vr=Object(b.mul)(yn,te.activation.apply(ct));return[Vr,Vr,ct]})},G.prototype.getConfig=function(){var C={units:this.units,activation:us(this.activation),recurrentActivation:us(this.recurrentActivation),useBias:this.useBias,kernelInitializer:ir(this.kernelInitializer),recurrentInitializer:ir(this.recurrentInitializer),biasInitializer:ir(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:Ri(this.kernelRegularizer),recurrentRegularizer:Ri(this.recurrentRegularizer),biasRegularizer:Ri(this.biasRegularizer),activityRegularizer:Ri(this.activityRegularizer),kernelConstraint:xn(this.kernelConstraint),recurrentConstraint:xn(this.recurrentConstraint),biasConstraint:xn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},N=Z.prototype.getConfig.call(this);return Object.assign(C,N),C},G.className="LSTMCell",G}(Bl);b.serialization.registerClass(Hi);var ku=function(Z){function G(C){return C.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),C.cell=new Hi(C),Z.call(this,C)||this}return U(G,Z),G.prototype.call=function(C,N){var te=this;return Object(b.tidy)(function(){te.cell.dropoutMask!=null&&(Object(b.dispose)(te.cell.dropoutMask),te.cell.dropoutMask=null),te.cell.recurrentDropoutMask!=null&&(Object(b.dispose)(te.cell.recurrentDropoutMask),te.cell.recurrentDropoutMask=null);var Be=N==null?null:N.mask,Ge=N==null?null:N.training,ft=N==null?null:N.initialState;return Z.prototype.call.call(te,C,{mask:Be,training:Ge,initialState:ft})})},Object.defineProperty(G.prototype,"units",{get:function(){return this.cell.units},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"activation",{get:function(){return this.cell.activation},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"recurrentActivation",{get:function(){return this.cell.recurrentActivation},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"useBias",{get:function(){return this.cell.useBias},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"kernelInitializer",{get:function(){return this.cell.kernelInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"recurrentInitializer",{get:function(){return this.cell.recurrentInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"biasInitializer",{get:function(){return this.cell.biasInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"unitForgetBias",{get:function(){return this.cell.unitForgetBias},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"kernelRegularizer",{get:function(){return this.cell.kernelRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"recurrentRegularizer",{get:function(){return this.cell.recurrentRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"biasRegularizer",{get:function(){return this.cell.biasRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"kernelConstraint",{get:function(){return this.cell.kernelConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"recurrentConstraint",{get:function(){return this.cell.recurrentConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"biasConstraint",{get:function(){return this.cell.biasConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"dropout",{get:function(){return this.cell.dropout},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"recurrentDropout",{get:function(){return this.cell.recurrentDropout},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"implementation",{get:function(){return this.cell.implementation},enumerable:!0,configurable:!0}),G.prototype.getConfig=function(){var C={units:this.units,activation:us(this.activation),recurrentActivation:us(this.recurrentActivation),useBias:this.useBias,kernelInitializer:ir(this.kernelInitializer),recurrentInitializer:ir(this.recurrentInitializer),biasInitializer:ir(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:Ri(this.kernelRegularizer),recurrentRegularizer:Ri(this.recurrentRegularizer),biasRegularizer:Ri(this.biasRegularizer),activityRegularizer:Ri(this.activityRegularizer),kernelConstraint:xn(this.kernelConstraint),recurrentConstraint:xn(this.recurrentConstraint),biasConstraint:xn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},N=Z.prototype.getConfig.call(this);return delete N.cell,Object.assign(C,N),C},G.fromConfig=function(C,N){return N.implmentation===0&&(N.implementation=1),new C(N)},G.className="LSTM",G}(na);b.serialization.registerClass(ku);var oc=function(Z){function G(C){var N=Z.call(this,C)||this;return N.cells=C.cells,N}return U(G,Z),Object.defineProperty(G.prototype,"stateSize",{get:function(){for(var C=[],N=0,te=this.cells.slice().reverse();N<te.length;N++){var Be=te[N];Array.isArray(Be.stateSize)?C.push.apply(C,Be.stateSize):C.push(Be.stateSize)}return C},enumerable:!0,configurable:!0}),G.prototype.call=function(C,N){var te=this;return Object(b.tidy)(function(){for(var Be=(C=C).slice(1),Ge=[],ft=0,Nt=te.cells.slice().reverse();ft<Nt.length;ft++){var Ut=Nt[ft];Array.isArray(Ut.stateSize)?Ge.push(Be.splice(0,Ut.stateSize.length)):Ge.push(Be.splice(0,1))}Ge.reverse();for(var ct,yn=[],_n=0;_n<te.cells.length;++_n)Ut=te.cells[_n],Be=Ge[_n],ct=_n===0?[C[0]].concat(Be):[ct[0]].concat(Be),ct=Ut.call(ct,N),yn.push(ct.slice(1));Be=[];for(var Nn=0,Wn=yn.slice().reverse();Nn<Wn.length;Nn++){var Mn=Wn[Nn];Be.push.apply(Be,Mn)}return[ct[0]].concat(Be)})},G.prototype.build=function(C){var N;Di(C)&&(C=C[0]),C=C,this.cells.forEach(function(te,Be){Xn("RNNCell_"+Be,function(){te.build(C),N=Array.isArray(te.stateSize)?te.stateSize[0]:te.stateSize,C=[C[0],N]})}),this.built=!0},G.prototype.getConfig=function(){for(var C=[],N=0,te=this.cells;N<te.length;N++){var Be=te[N];C.push({className:Be.getClassName(),config:Be.getConfig()})}var Ge={cells:C},ft=Z.prototype.getConfig.call(this);return Object.assign(Ge,ft),Ge},G.fromConfig=function(C,N,te){te===void 0&&(te={});for(var Be=[],Ge=0,ft=N.cells;Ge<ft.length;Ge++){var Nt=ft[Ge];Be.push(Io(Nt,te))}return new C({cells:Be})},Object.defineProperty(G.prototype,"trainableWeights",{get:function(){if(!this.trainable)return[];for(var C=[],N=0,te=this.cells;N<te.length;N++){var Be=te[N];C.push.apply(C,Be.trainableWeights)}return C},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"nonTrainableWeights",{get:function(){for(var C=[],N=0,te=this.cells;N<te.length;N++){var Be=te[N];C.push.apply(C,Be.nonTrainableWeights)}if(!this.trainable){for(var Ge=[],ft=0,Nt=this.cells;ft<Nt.length;ft++)Be=Nt[ft],Ge.push.apply(Ge,Be.trainableWeights);return Ge.concat(C)}return C},enumerable:!0,configurable:!0}),G.prototype.getWeights=function(){for(var C=[],N=0,te=this.cells;N<te.length;N++){var Be=te[N];C.push.apply(C,Be.weights)}return aa(C)},G.prototype.setWeights=function(C){for(var N=[],te=0,Be=this.cells;te<Be.length;te++)for(var Ge=Be[te],ft=Ge.weights.length,Nt=C.splice(ft),Ut=0;Ut<Ge.weights.length;++Ut)N.push([Ge.weights[Ut],Nt[Ut]]);ma(N)},G.className="StackedRNNCells",G}(Bl);function Vs(Z,G,C,N){function te(){return Lr(Z(),G)}if(C===void 0&&(C=null),N===void 0&&(N=1),N>1){for(var Be=[],Ge=0;Ge<N;Ge++)Be.push(jt(te,Z,C));return Be.map(function(ft){return Object(b.keep)(ft.clone())})}return Object(b.keep)(jt(te,Z,C).clone())}b.serialization.registerClass(oc);var sc=function(Z){function G(C){var N=Z.call(this,C)||this;return N.layer=C.layer,N}return U(G,Z),G.prototype.build=function(C){this.built=!0},Object.defineProperty(G.prototype,"trainable",{get:function(){return this.layer!=null&&this.layer.trainable},set:function(C){this.layer!=null&&(this.layer.trainable=C)},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"trainableWeights",{get:function(){return this.layer.trainableWeights},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"nonTrainableWeights",{get:function(){return this.layer.nonTrainableWeights},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"updates",{get:function(){return this.layer._updates},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"losses",{get:function(){return this.layer.losses},enumerable:!0,configurable:!0}),G.prototype.getWeights=function(){return this.layer.getWeights()},G.prototype.setWeights=function(C){this.layer.setWeights(C)},G.prototype.getConfig=function(){var C={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},N=Z.prototype.getConfig.call(this);return Object.assign(C,N),C},G.prototype.setFastWeightInitDuringBuild=function(C){Z.prototype.setFastWeightInitDuringBuild.call(this,C),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(C)},G.fromConfig=function(C,N,te){te===void 0&&(te={});var Be=Io(N.layer,te);delete N.layer;var Ge={layer:Be};return Object.assign(Ge,N),new C(Ge)},G}(qi),Ka=function(Z){function G(C){var N=Z.call(this,C)||this;return N.supportsMasking=!0,N}return U(G,Z),G.prototype.build=function(C){if((C=Bn(C)).length<3)throw new ee("TimeDistributed layer expects an input shape >= 3D, but received input shape "+JSON.stringify(C));this.inputSpec=[{shape:C}];var N=[C[0]].concat(C.slice(2));this.layer.built||(this.layer.build(N),this.layer.built=!0),Z.prototype.build.call(this,C)},G.prototype.computeOutputShape=function(C){var N=[(C=Bn(C))[0]].concat(C.slice(2)),te=this.layer.computeOutputShape(N),Be=C[1];return[te[0],Be].concat(te.slice(1))},G.prototype.call=function(C,N){var te=this;return Object(b.tidy)(function(){return Os(function(Be,Ge){return[jr(te.layer.call(Be,N)),[]]},C=jr(C),[],!1,null,null,!1,!0)[1]})},G.className="TimeDistributed",G}(sc);b.serialization.registerClass(Ka);var Vu="concat",qs=function(Z){function G(C){var N=Z.call(this,C)||this,te=C.layer.getConfig(),Be={};Be.className=C.layer.getClassName(),Be.config=te,N.forwardLayer=Io(Be),te.goBackwards=te.goBackwards!==!0;var Ge={};if(Ge.className=C.layer.getClassName(),Ge.config=te,N.backwardLayer=Io(Ge),N.forwardLayer.name="forward_"+N.forwardLayer.name,N.backwardLayer.name="backward_"+N.backwardLayer.name,N.mergeMode=C.mergeMode===void 0?Vu:C.mergeMode,function(ft){Tt(Et,"BidirectionalMergeMode",ft)}(N.mergeMode),C.weights)throw new F("weights support is not implemented for Bidirectional layer yet.");return N._stateful=C.layer.stateful,N.returnSequences=C.layer.returnSequences,N.returnState=C.layer.returnState,N.supportsMasking=!0,N._trainable=!0,N.inputSpec=C.layer.inputSpec,N.numConstants=null,N}return U(G,Z),Object.defineProperty(G.prototype,"trainable",{get:function(){return this._trainable},set:function(C){this._trainable=C,this.forwardLayer!=null&&(this.forwardLayer.trainable=C),this.backwardLayer!=null&&(this.backwardLayer.trainable=C)},enumerable:!0,configurable:!0}),G.prototype.getWeights=function(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())},G.prototype.setWeights=function(C){var N=C.length,te=Math.floor(N/2);this.forwardLayer.setWeights(C.slice(0,te)),this.backwardLayer.setWeights(C.slice(te))},G.prototype.computeOutputShape=function(C){var N,te,Be,Ge=this.forwardLayer.computeOutputShape(C);return Array.isArray(Ge)&&Array.isArray(Ge[0])||(Ge=[Ge]),Ge=Ge,this.returnState&&(Be=Ge.slice(1)),N=Ge[0],N=N,this.mergeMode==="concat"?(N[N.length-1]*=2,te=[N]):te=this.mergeMode==null?[N,N.slice()]:[N],this.returnState?this.mergeMode==null?te.concat(Be).concat(Be.slice()):[N].concat(Be).concat(Be.slice()):pe(te)},G.prototype.apply=function(C,N){var te=N==null?null:N.initialState,Be=N==null?null:N.constants;N==null&&(N={});var Ge=Un(C,te,Be,this.numConstants);if(C=Ge.inputs,te=Ge.initialState,Be=Ge.constants,Array.isArray(C)&&(te=C.slice(1),C=C[0]),(te==null||te.length===0)&&Be==null)return Z.prototype.apply.call(this,C,N);var ft=[],Nt=[];if(te!=null){var Ut=te.length;if(Ut%2>0)throw new ee("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");N.initialState=te,ft.push.apply(ft,te);var ct=te.map(function(hr){return new Zi({shape:hr.shape})});this.forwardLayer.stateSpec=ct.slice(0,Ut/2),this.backwardLayer.stateSpec=ct.slice(Ut/2),Nt.push.apply(Nt,ct)}if(Be!=null)throw new F("Support for constants in Bidirectional layers is not implemented yet.");for(var yn=ft[0]instanceof ga,_n=0,Nn=ft;_n<Nn.length;_n++)if(Nn[_n]instanceof ga!==yn)throw new ee("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(yn){var Wn=[C].concat(ft),Mn=this.inputSpec.concat(Nt),tr=this.inputSpec;this.inputSpec=Mn;var rr=Z.prototype.apply.call(this,Wn,N);return this.inputSpec=tr,rr}return Z.prototype.apply.call(this,C,N)},G.prototype.call=function(C,N){var te=this;return Object(b.tidy)(function(){var Be,Ge,ft,Nt,Ut=N.initialState;if(Ut==null)Be=te.forwardLayer.call(C,N),Ge=te.backwardLayer.call(C,N);else{var ct=Ut.slice(0,Ut.length/2),yn=Ut.slice(Ut.length/2);Be=te.forwardLayer.call(C,Object.assign(N,{initialState:ct})),Ge=te.backwardLayer.call(C,Object.assign(N,{initialState:yn}))}return te.returnState&&(Array.isArray(Be)&&(ft=Be.slice(1).concat(Ge.slice(1))),Be=Be[0],Ge=Ge[0]),te.returnSequences&&(Ge=Object(b.reverse)(Ge,1)),te.mergeMode==="concat"?Nt=di([Be,Ge]):te.mergeMode==="sum"?Nt=Object(b.add)(Be,Ge):te.mergeMode==="ave"?Nt=Object(b.mul)(.5,Object(b.add)(Be,Ge)):te.mergeMode==="mul"?Nt=Object(b.mul)(Be,Ge):te.mergeMode==null&&(Nt=[Be,Ge]),te.returnState?te.mergeMode==null?Nt.concat(ft):[Nt].concat(ft):Nt})},G.prototype.resetStates=function(C){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()},G.prototype.build=function(C){var N=this;Xn(this.forwardLayer.name,function(){N.forwardLayer.build(C)}),Xn(this.backwardLayer.name,function(){N.backwardLayer.build(C)}),this.built=!0},G.prototype.computeMask=function(C,N){var te;if(Array.isArray(N)&&(N=N[0]),te=this.returnSequences?this.mergeMode==null?[N,N]:N:this.mergeMode==null?[null,null]:null,this.returnState){var Be=this.forwardLayer.states.map(function(Ge){return null});return Array.isArray(te)?te.concat(Be).concat(Be):[te].concat(Be).concat(Be)}return te},Object.defineProperty(G.prototype,"trainableWeights",{get:function(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"nonTrainableWeights",{get:function(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)},enumerable:!0,configurable:!0}),G.prototype.setFastWeightInitDuringBuild=function(C){Z.prototype.setFastWeightInitDuringBuild.call(this,C),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(C),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(C)},G.prototype.getConfig=function(){var C={mergeMode:this.mergeMode},N=Z.prototype.getConfig.call(this);return Object.assign(C,N),C},G.fromConfig=function(C,N){var te=Io(N.layer);if(delete N.layer,N.numConstants!=null)throw new F("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");var Be=N;return Be.layer=te,new C(Be)},G.className="Bidirectional",G}(sc);function oa(Z){return new yo(Z)}function cs(Z){return new Ml(Z)}function _o(Z){return new $d(Z)}function ls(Z){return new Gd(Z)}function Xa(Z){return new Ws(Z)}function Hs(Z){return new zh(Z)}function Eu(Z){return new Cs(Z)}b.serialization.registerClass(qs);var qu=ls,uc=Xa,Cu=Hs,Jc=Eu,Qc=Object.freeze({inputLayer:function(Z){return new bu(Z)},elu:function(Z){return new Rp(Z)},reLU:function(Z){return new Ld(Z)},leakyReLU:function(Z){return new zd(Z)},prelu:function(Z){return new Ud(Z)},softmax:function(Z){return new ks(Z)},thresholdedReLU:function(Z){return new zu(Z)},conv1d:function(Z){return new Pa(Z)},conv2d:function(Z){return new Wd(Z)},conv2dTranspose:function(Z){return new Sl(Z)},conv3d:function(Z){return new Mp(Z)},separableConv2d:function(Z){return new jh(Z)},cropping2D:function(Z){return new Bh(Z)},upSampling2d:function(Z){return new Dl(Z)},depthwiseConv2d:function(Z){return new Ph(Z)},activation:function(Z){return new Sf(Z)},dense:function(Z){return new Ec(Z)},dropout:function(Z){return new Tl(Z)},spatialDropout1d:function(Z){return new Kc(Z)},flatten:function(Z){return new Lh(Z)},repeatVector:function(Z){return new Nl(Z)},reshape:function(Z){return new Cc(Z)},permute:function(Z){return new km(Z)},embedding:function(Z){return new eo(Z)},add:function(Z){return new Fo(Z)},average:function(Z){return new Es(Z)},concatenate:function(Z){return new Ac(Z)},maximum:function(Z){return new Oc(Z)},minimum:function(Z){return new Ro(Z)},multiply:function(Z){return new Mi(Z)},dot:function(Z){return new Df(Z)},batchNormalization:function(Z){return new qd(Z)},layerNormalization:function(Z){return new Fl(Z)},zeroPadding2d:function(Z){return new jp(Z)},averagePooling1d:oa,avgPool1d:function(Z){return oa(Z)},avgPooling1d:function(Z){return oa(Z)},averagePooling2d:cs,avgPool2d:function(Z){return cs(Z)},avgPooling2d:function(Z){return cs(Z)},averagePooling3d:_o,avgPool3d:function(Z){return _o(Z)},avgPooling3d:function(Z){return _o(Z)},globalAveragePooling1d:function(Z){return new jl(Z)},globalAveragePooling2d:function(Z){return new en(Z)},globalMaxPooling1d:ls,globalMaxPooling2d:Xa,maxPooling1d:Hs,maxPooling2d:Eu,maxPooling3d:function(Z){return new Uh(Z)},gru:function(Z){return new bo(Z)},gruCell:function(Z){return new Go(Z)},lstm:function(Z){return new ku(Z)},lstmCell:function(Z){return new Hi(Z)},simpleRNN:function(Z){return new nr(Z)},simpleRNNCell:function(Z){return new Rf(Z)},rnn:function(Z){return new na(Z)},stackedRNNCells:function(Z){return new oc(Z)},bidirectional:function(Z){return new qs(Z)},timeDistributed:function(Z){return new Ka(Z)},globalMaxPool1d:qu,globalMaxPool2d:uc,maxPool1d:Cu,maxPool2d:Jc,Layer:qi,RNN:na,RNNCell:Bl,input:wa,gaussianNoise:function(Z){return new Tf(Z)},gaussianDropout:function(Z){return new Xc(Z)},alphaDropout:function(Z){return new Vd(Z)},masking:function(Z){return new Il(Z)}}),Wh=Object.freeze({binaryAccuracy:function(Z,G){return bf(Z,G)},binaryCrossentropy:function(Z,G){return wf(Z,G)},sparseCategoricalAccuracy:function(Z,G){return kf(Z,G)},categoricalAccuracy:function(Z,G){return xf(Z,G)},categoricalCrossentropy:function(Z,G){return ys(Z,G)},precision:function(Z,G){return Ah(Z,G)},recall:function(Z,G){return Nd(Z,G)},cosineProximity:function(Z,G){return rc(Z,G)},meanAbsoluteError:function(Z,G){return tc(Z,G)},meanAbsolutePercentageError:function(Z,G){return ss(Z,G)},MAPE:function(Z,G){return ss(Z,G)},mape:function(Z,G){return ss(Z,G)},meanSquaredError:function(Z,G){return so(Z,G)},MSE:function(Z,G){return so(Z,G)},mse:function(Z,G){return so(Z,G)}}),Zc=Object.freeze({modelFromJSON:function(Z,G){return J(this,void 0,void 0,function(){var C,N,te,Be,Ge,ft,Nt,Ut;return R(this,function(ct){switch(ct.label){case 0:return"modelTopology"in Z||(Z={modelTopology:Z}),(C=(Z=Z).modelTopology).model_config!=null&&(C=C.model_config),N=Fi(C),te=Io(N,G),Z.weightsManifest==null?[3,2]:[4,b.io.loadWeights(Z.weightsManifest,Z.pathPrefix,te.weights.map(function(yn){return yn.originalName}))];case 1:for(Be=ct.sent(),Ge={},ft=0,Nt=te.weights;ft<Nt.length;ft++)Ut=Nt[ft],Ge[Ut.originalName]=Be[Ut.originalName];te.loadWeights(Ge),Object(b.dispose)(Be),ct.label=2;case 2:return[2,te]}})})}}),$s=Object.freeze({l1l2:function(Z){return new Al(Z)},l1:function(Z){return function(G){return Fh(G),new Al({l1:G!=null?G.l1:null,l2:0})}(Z)},l2:function(Z){return function(G){return Fh(G),new Al({l2:G!=null?G.l2:null,l1:0})}(Z)}}),Ou=function(Z){function G(){var C=Z!==null&&Z.apply(this,arguments)||this;return C.model=null,C}return U(G,Z),G.prototype.setModel=function(C){if(!(C instanceof kc))throw new Error("model must be a LayersModel, not some other Container");this.model=C},G}(os);function Au(Z,G){return Z<G}function nu(Z,G){return Z>G}var Vh=function(Z){function G(C){var N=Z.call(this)||this;if(C==null&&(C={}),C.restoreBestWeights)throw new F("restoreBestWeights = True is not implemented in EarlyStopping yet.");return N.monitor=C.monitor||"val_loss",N.minDelta=Math.abs(C.minDelta||0),N.patience=C.patience||0,N.verbose=C.verbose||0,N.mode=C.mode||"auto",N.baseline=C.baseline,["auto","min","max"].indexOf(N.mode)===-1&&(console.warn("EarlyStopping mode '"+N.mode+"' is invalid. Falling back to mode 'auto'."),N.mode="auto"),N.mode==="min"?N.monitorFunc=Au:N.mode==="max"||N.monitor.indexOf("acc")!==-1?N.monitorFunc=nu:N.monitorFunc=Au,N.monitorFunc===Au&&(N.minDelta*=-1),N}return U(G,Z),G.prototype.onTrainBegin=function(C){return J(this,void 0,void 0,function(){return R(this,function(N){return this.wait=0,this.stoppedEpoch=0,this.baseline!=null?this.best=this.baseline:this.best=this.monitorFunc===Au?1/0:-1/0,[2]})})},G.prototype.onEpochEnd=function(C,N){return J(this,void 0,void 0,function(){var te;return R(this,function(Be){switch(Be.label){case 0:return[4,Bu(N)];case 1:return Be.sent(),(te=this.getMonitorValue(N))==null?[2]:(this.monitorFunc(te-this.minDelta,this.best)?(this.best=te,this.wait=0):(this.wait++,this.wait>=this.patience&&(this.stoppedEpoch=C,this.model.stopTraining=!0)),[2])}})})},G.prototype.onTrainEnd=function(C){return J(this,void 0,void 0,function(){return R(this,function(N){return this.stoppedEpoch>0&&this.verbose&&console.log("Epoch "+this.stoppedEpoch+": early stopping."),[2]})})},G.prototype.getMonitorValue=function(C){C==null&&(C={});var N=C[this.monitor];return N==null&&console.warn("Metric for EarlyStopping "+this.monitor+" is not available. Available metrics are: "+Object.keys(C)),N},G}(Ou),Mf={earlyStopping:function(Z){return new Vh(Z)}},jf=o(20),Pl=o(130);o.d(A,"version",function(){return Bf}),o.d(A,"AdadeltaOptimizer",function(){return b.AdadeltaOptimizer}),o.d(A,"AdagradOptimizer",function(){return b.AdagradOptimizer}),o.d(A,"AdamOptimizer",function(){return b.AdamOptimizer}),o.d(A,"AdamaxOptimizer",function(){return b.AdamaxOptimizer}),o.d(A,"Add",function(){return b.Add}),o.d(A,"AddN",function(){return b.AddN}),o.d(A,"BroadcastTo",function(){return b.BroadcastTo}),o.d(A,"DataStorage",function(){return b.DataStorage}),o.d(A,"Div",function(){return b.Div}),o.d(A,"ENV",function(){return b.ENV}),o.d(A,"Environment",function(){return b.Environment}),o.d(A,"FromPixels",function(){return b.FromPixels}),o.d(A,"FusedBatchNorm",function(){return b.FusedBatchNorm}),o.d(A,"Identity",function(){return b.Identity}),o.d(A,"KernelBackend",function(){return b.KernelBackend}),o.d(A,"MaxPoolWithArgmax",function(){return b.MaxPoolWithArgmax}),o.d(A,"MomentumOptimizer",function(){return b.MomentumOptimizer}),o.d(A,"NonMaxSuppressionV5",function(){return b.NonMaxSuppressionV5}),o.d(A,"OneHot",function(){return b.OneHot}),o.d(A,"Optimizer",function(){return b.Optimizer}),o.d(A,"PadV2",function(){return b.PadV2}),o.d(A,"RMSPropOptimizer",function(){return b.RMSPropOptimizer}),o.d(A,"Rank",function(){return b.Rank}),o.d(A,"Reduction",function(){return b.Reduction}),o.d(A,"SGDOptimizer",function(){return b.SGDOptimizer}),o.d(A,"Square",function(){return b.Square}),o.d(A,"SquaredDifference",function(){return b.SquaredDifference}),o.d(A,"Tensor",function(){return b.Tensor}),o.d(A,"TensorBuffer",function(){return b.TensorBuffer}),o.d(A,"Tile",function(){return b.Tile}),o.d(A,"Transpose",function(){return b.Transpose}),o.d(A,"Variable",function(){return b.Variable}),o.d(A,"abs",function(){return b.abs}),o.d(A,"acos",function(){return b.acos}),o.d(A,"acosh",function(){return b.acosh}),o.d(A,"add",function(){return b.add}),o.d(A,"addN",function(){return b.addN}),o.d(A,"addStrict",function(){return b.addStrict}),o.d(A,"all",function(){return b.all}),o.d(A,"any",function(){return b.any}),o.d(A,"argMax",function(){return b.argMax}),o.d(A,"argMin",function(){return b.argMin}),o.d(A,"asin",function(){return b.asin}),o.d(A,"asinh",function(){return b.asinh}),o.d(A,"atan",function(){return b.atan}),o.d(A,"atan2",function(){return b.atan2}),o.d(A,"atanh",function(){return b.atanh}),o.d(A,"avgPool",function(){return b.avgPool}),o.d(A,"avgPool3d",function(){return b.avgPool3d}),o.d(A,"backend",function(){return b.backend}),o.d(A,"backend_util",function(){return b.backend_util}),o.d(A,"basicLSTMCell",function(){return b.basicLSTMCell}),o.d(A,"batchNorm",function(){return b.batchNorm}),o.d(A,"batchNorm2d",function(){return b.batchNorm2d}),o.d(A,"batchNorm3d",function(){return b.batchNorm3d}),o.d(A,"batchNorm4d",function(){return b.batchNorm4d}),o.d(A,"batchNormalization",function(){return b.batchNormalization}),o.d(A,"batchNormalization2d",function(){return b.batchNormalization2d}),o.d(A,"batchNormalization3d",function(){return b.batchNormalization3d}),o.d(A,"batchNormalization4d",function(){return b.batchNormalization4d}),o.d(A,"batchToSpaceND",function(){return b.batchToSpaceND}),o.d(A,"booleanMaskAsync",function(){return b.booleanMaskAsync}),o.d(A,"broadcastTo",function(){return b.broadcastTo}),o.d(A,"browser",function(){return b.browser}),o.d(A,"buffer",function(){return b.buffer}),o.d(A,"cast",function(){return b.cast}),o.d(A,"ceil",function(){return b.ceil}),o.d(A,"clipByValue",function(){return b.clipByValue}),o.d(A,"clone",function(){return b.clone}),o.d(A,"complex",function(){return b.complex}),o.d(A,"concat",function(){return b.concat}),o.d(A,"concat1d",function(){return b.concat1d}),o.d(A,"concat2d",function(){return b.concat2d}),o.d(A,"concat3d",function(){return b.concat3d}),o.d(A,"concat4d",function(){return b.concat4d}),o.d(A,"conv1d",function(){return b.conv1d}),o.d(A,"conv2d",function(){return b.conv2d}),o.d(A,"conv2dTranspose",function(){return b.conv2dTranspose}),o.d(A,"conv3d",function(){return b.conv3d}),o.d(A,"conv3dTranspose",function(){return b.conv3dTranspose}),o.d(A,"cos",function(){return b.cos}),o.d(A,"cosh",function(){return b.cosh}),o.d(A,"cumsum",function(){return b.cumsum}),o.d(A,"customGrad",function(){return b.customGrad}),o.d(A,"deprecationWarn",function(){return b.deprecationWarn}),o.d(A,"depthToSpace",function(){return b.depthToSpace}),o.d(A,"depthwiseConv2d",function(){return b.depthwiseConv2d}),o.d(A,"diag",function(){return b.diag}),o.d(A,"disableDeprecationWarnings",function(){return b.disableDeprecationWarnings}),o.d(A,"dispose",function(){return b.dispose}),o.d(A,"disposeVariables",function(){return b.disposeVariables}),o.d(A,"div",function(){return b.div}),o.d(A,"divNoNan",function(){return b.divNoNan}),o.d(A,"divStrict",function(){return b.divStrict}),o.d(A,"dot",function(){return b.dot}),o.d(A,"dropout",function(){return b.dropout}),o.d(A,"elu",function(){return b.elu}),o.d(A,"enableDebugMode",function(){return b.enableDebugMode}),o.d(A,"enableProdMode",function(){return b.enableProdMode}),o.d(A,"engine",function(){return b.engine}),o.d(A,"env",function(){return b.env}),o.d(A,"equal",function(){return b.equal}),o.d(A,"equalStrict",function(){return b.equalStrict}),o.d(A,"erf",function(){return b.erf}),o.d(A,"exp",function(){return b.exp}),o.d(A,"expandDims",function(){return b.expandDims}),o.d(A,"expm1",function(){return b.expm1}),o.d(A,"eye",function(){return b.eye}),o.d(A,"fft",function(){return b.fft}),o.d(A,"fill",function(){return b.fill}),o.d(A,"findBackend",function(){return b.findBackend}),o.d(A,"findBackendFactory",function(){return b.findBackendFactory}),o.d(A,"floor",function(){return b.floor}),o.d(A,"floorDiv",function(){return b.floorDiv}),o.d(A,"frame",function(){return b.frame}),o.d(A,"fused",function(){return b.fused}),o.d(A,"gather",function(){return b.gather}),o.d(A,"gatherND",function(){return b.gatherND}),o.d(A,"gather_util",function(){return b.gather_util}),o.d(A,"getBackend",function(){return b.getBackend}),o.d(A,"getGradient",function(){return b.getGradient}),o.d(A,"getKernel",function(){return b.getKernel}),o.d(A,"getKernelsForBackend",function(){return b.getKernelsForBackend}),o.d(A,"grad",function(){return b.grad}),o.d(A,"grads",function(){return b.grads}),o.d(A,"greater",function(){return b.greater}),o.d(A,"greaterEqual",function(){return b.greaterEqual}),o.d(A,"greaterEqualStrict",function(){return b.greaterEqualStrict}),o.d(A,"greaterStrict",function(){return b.greaterStrict}),o.d(A,"hammingWindow",function(){return b.hammingWindow}),o.d(A,"hannWindow",function(){return b.hannWindow}),o.d(A,"ifft",function(){return b.ifft}),o.d(A,"imag",function(){return b.imag}),o.d(A,"image",function(){return b.image}),o.d(A,"inTopKAsync",function(){return b.inTopKAsync}),o.d(A,"io",function(){return b.io}),o.d(A,"irfft",function(){return b.irfft}),o.d(A,"isFinite",function(){return b.isFinite}),o.d(A,"isInf",function(){return b.isInf}),o.d(A,"isNaN",function(){return b.isNaN}),o.d(A,"keep",function(){return b.keep}),o.d(A,"leakyRelu",function(){return b.leakyRelu}),o.d(A,"less",function(){return b.less}),o.d(A,"lessEqual",function(){return b.lessEqual}),o.d(A,"lessEqualStrict",function(){return b.lessEqualStrict}),o.d(A,"lessStrict",function(){return b.lessStrict}),o.d(A,"linalg",function(){return b.linalg}),o.d(A,"linspace",function(){return b.linspace}),o.d(A,"localResponseNormalization",function(){return b.localResponseNormalization}),o.d(A,"log",function(){return b.log}),o.d(A,"log1p",function(){return b.log1p}),o.d(A,"logSigmoid",function(){return b.logSigmoid}),o.d(A,"logSoftmax",function(){return b.logSoftmax}),o.d(A,"logSumExp",function(){return b.logSumExp}),o.d(A,"logicalAnd",function(){return b.logicalAnd}),o.d(A,"logicalNot",function(){return b.logicalNot}),o.d(A,"logicalOr",function(){return b.logicalOr}),o.d(A,"logicalXor",function(){return b.logicalXor}),o.d(A,"losses",function(){return b.losses}),o.d(A,"matMul",function(){return b.matMul}),o.d(A,"math",function(){return b.math}),o.d(A,"max",function(){return b.max}),o.d(A,"maxPool",function(){return b.maxPool}),o.d(A,"maxPool3d",function(){return b.maxPool3d}),o.d(A,"maxPoolWithArgmax",function(){return b.maxPoolWithArgmax}),o.d(A,"maximum",function(){return b.maximum}),o.d(A,"maximumStrict",function(){return b.maximumStrict}),o.d(A,"mean",function(){return b.mean}),o.d(A,"memory",function(){return b.memory}),o.d(A,"min",function(){return b.min}),o.d(A,"minimum",function(){return b.minimum}),o.d(A,"minimumStrict",function(){return b.minimumStrict}),o.d(A,"mod",function(){return b.mod}),o.d(A,"modStrict",function(){return b.modStrict}),o.d(A,"moments",function(){return b.moments}),o.d(A,"movingAverage",function(){return b.movingAverage}),o.d(A,"mul",function(){return b.mul}),o.d(A,"mulStrict",function(){return b.mulStrict}),o.d(A,"multiRNNCell",function(){return b.multiRNNCell}),o.d(A,"multinomial",function(){return b.multinomial}),o.d(A,"neg",function(){return b.neg}),o.d(A,"nextFrame",function(){return b.nextFrame}),o.d(A,"norm",function(){return b.norm}),o.d(A,"notEqual",function(){return b.notEqual}),o.d(A,"notEqualStrict",function(){return b.notEqualStrict}),o.d(A,"oneHot",function(){return b.oneHot}),o.d(A,"ones",function(){return b.ones}),o.d(A,"onesLike",function(){return b.onesLike}),o.d(A,"op",function(){return b.op}),o.d(A,"outerProduct",function(){return b.outerProduct}),o.d(A,"pad",function(){return b.pad}),o.d(A,"pad1d",function(){return b.pad1d}),o.d(A,"pad2d",function(){return b.pad2d}),o.d(A,"pad3d",function(){return b.pad3d}),o.d(A,"pad4d",function(){return b.pad4d}),o.d(A,"pool",function(){return b.pool}),o.d(A,"pow",function(){return b.pow}),o.d(A,"powStrict",function(){return b.powStrict}),o.d(A,"prelu",function(){return b.prelu}),o.d(A,"print",function(){return b.print}),o.d(A,"prod",function(){return b.prod}),o.d(A,"profile",function(){return b.profile}),o.d(A,"rand",function(){return b.rand}),o.d(A,"randomGamma",function(){return b.randomGamma}),o.d(A,"randomNormal",function(){return b.randomNormal}),o.d(A,"randomUniform",function(){return b.randomUniform}),o.d(A,"range",function(){return b.range}),o.d(A,"ready",function(){return b.ready}),o.d(A,"real",function(){return b.real}),o.d(A,"reciprocal",function(){return b.reciprocal}),o.d(A,"registerBackend",function(){return b.registerBackend}),o.d(A,"registerGradient",function(){return b.registerGradient}),o.d(A,"registerKernel",function(){return b.registerKernel}),o.d(A,"relu",function(){return b.relu}),o.d(A,"relu6",function(){return b.relu6}),o.d(A,"removeBackend",function(){return b.removeBackend}),o.d(A,"reshape",function(){return b.reshape}),o.d(A,"reverse",function(){return b.reverse}),o.d(A,"reverse1d",function(){return b.reverse1d}),o.d(A,"reverse2d",function(){return b.reverse2d}),o.d(A,"reverse3d",function(){return b.reverse3d}),o.d(A,"reverse4d",function(){return b.reverse4d}),o.d(A,"rfft",function(){return b.rfft}),o.d(A,"round",function(){return b.round}),o.d(A,"rsqrt",function(){return b.rsqrt}),o.d(A,"scalar",function(){return b.scalar}),o.d(A,"scatterND",function(){return b.scatterND}),o.d(A,"scatter_util",function(){return b.scatter_util}),o.d(A,"selu",function(){return b.selu}),o.d(A,"separableConv2d",function(){return b.separableConv2d}),o.d(A,"serialization",function(){return b.serialization}),o.d(A,"setBackend",function(){return b.setBackend}),o.d(A,"setPlatform",function(){return b.setPlatform}),o.d(A,"setdiff1dAsync",function(){return b.setdiff1dAsync}),o.d(A,"sigmoid",function(){return b.sigmoid}),o.d(A,"sign",function(){return b.sign}),o.d(A,"signal",function(){return b.signal}),o.d(A,"sin",function(){return b.sin}),o.d(A,"sinh",function(){return b.sinh}),o.d(A,"slice",function(){return b.slice}),o.d(A,"slice1d",function(){return b.slice1d}),o.d(A,"slice2d",function(){return b.slice2d}),o.d(A,"slice3d",function(){return b.slice3d}),o.d(A,"slice4d",function(){return b.slice4d}),o.d(A,"slice_util",function(){return b.slice_util}),o.d(A,"softmax",function(){return b.softmax}),o.d(A,"softplus",function(){return b.softplus}),o.d(A,"spaceToBatchND",function(){return b.spaceToBatchND}),o.d(A,"sparseToDense",function(){return b.sparseToDense}),o.d(A,"spectral",function(){return b.spectral}),o.d(A,"split",function(){return b.split}),o.d(A,"sqrt",function(){return b.sqrt}),o.d(A,"square",function(){return b.square}),o.d(A,"squaredDifference",function(){return b.squaredDifference}),o.d(A,"squaredDifferenceStrict",function(){return b.squaredDifferenceStrict}),o.d(A,"squeeze",function(){return b.squeeze}),o.d(A,"stack",function(){return b.stack}),o.d(A,"step",function(){return b.step}),o.d(A,"stft",function(){return b.stft}),o.d(A,"stridedSlice",function(){return b.stridedSlice}),o.d(A,"sub",function(){return b.sub}),o.d(A,"subStrict",function(){return b.subStrict}),o.d(A,"sum",function(){return b.sum}),o.d(A,"sumOutType",function(){return b.sumOutType}),o.d(A,"tan",function(){return b.tan}),o.d(A,"tanh",function(){return b.tanh}),o.d(A,"tensor",function(){return b.tensor}),o.d(A,"tensor1d",function(){return b.tensor1d}),o.d(A,"tensor2d",function(){return b.tensor2d}),o.d(A,"tensor3d",function(){return b.tensor3d}),o.d(A,"tensor4d",function(){return b.tensor4d}),o.d(A,"tensor5d",function(){return b.tensor5d}),o.d(A,"tensor6d",function(){return b.tensor6d}),o.d(A,"tensor_util",function(){return b.tensor_util}),o.d(A,"test_util",function(){return b.test_util}),o.d(A,"tidy",function(){return b.tidy}),o.d(A,"tile",function(){return b.tile}),o.d(A,"time",function(){return b.time}),o.d(A,"topk",function(){return b.topk}),o.d(A,"train",function(){return b.train}),o.d(A,"transpose",function(){return b.transpose}),o.d(A,"truncatedNormal",function(){return b.truncatedNormal}),o.d(A,"unregisterGradient",function(){return b.unregisterGradient}),o.d(A,"unregisterKernel",function(){return b.unregisterKernel}),o.d(A,"unsortedSegmentSum",function(){return b.unsortedSegmentSum}),o.d(A,"unstack",function(){return b.unstack}),o.d(A,"util",function(){return b.util}),o.d(A,"valueAndGrad",function(){return b.valueAndGrad}),o.d(A,"valueAndGrads",function(){return b.valueAndGrads}),o.d(A,"variable",function(){return b.variable}),o.d(A,"variableGrads",function(){return b.variableGrads}),o.d(A,"version_core",function(){return b.version_core}),o.d(A,"webgl",function(){return b.webgl}),o.d(A,"where",function(){return b.where}),o.d(A,"whereAsync",function(){return b.whereAsync}),o.d(A,"zeros",function(){return b.zeros}),o.d(A,"zerosLike",function(){return b.zerosLike}),o.d(A,"constraints",function(){return fn}),o.d(A,"initializers",function(){return vr}),o.d(A,"layers",function(){return Qc}),o.d(A,"metrics",function(){return Wh}),o.d(A,"models",function(){return Zc}),o.d(A,"regularizers",function(){return $s}),o.d(A,"CallbackList",function(){return vf}),o.d(A,"CustomCallback",function(){return yf}),o.d(A,"History",function(){return Pu}),o.d(A,"Callback",function(){return Ou}),o.d(A,"callbacks",function(){return Mf}),o.d(A,"EarlyStopping",function(){return Vh}),o.d(A,"InputSpec",function(){return Zi}),o.d(A,"SymbolicTensor",function(){return ga}),o.d(A,"LayersModel",function(){return kc}),o.d(A,"input",function(){return wa}),o.d(A,"loadLayersModel",function(){return Uo}),o.d(A,"model",function(){return fa}),o.d(A,"registerCallbackConstructor",function(){return xs}),o.d(A,"sequential",function(){return uo}),o.d(A,"RNN",function(){return na}),o.d(A,"Sequential",function(){return xt}),o.d(A,"LayerVariable",function(){return Fr}),o.d(A,"version_layers",function(){return"1.7.4"}),o.d(A,"GraphModel",function(){return jf.GraphModel}),o.d(A,"loadGraphModel",function(){return jf.loadGraphModel}),o.d(A,"deregisterOp",function(){return jf.deregisterOp}),o.d(A,"registerOp",function(){return jf.registerOp}),o.d(A,"version_converter",function(){return jf.version_converter}),o.d(A,"data",function(){return Pl});var Bf={"tfjs-core":b.version_core,"tfjs-data":Pl.version_data,"tfjs-layers":"1.7.4","tfjs-converter":jf.version_converter,tfjs:"1.7.4"}},function(Oe,A,o){o.r(A),(function(b,H,U,B){o.d(A,"AdadeltaOptimizer",function(){return O0}),o.d(A,"AdagradOptimizer",function(){return A0}),o.d(A,"AdamOptimizer",function(){return _0}),o.d(A,"AdamaxOptimizer",function(){return rv}),o.d(A,"DataStorage",function(){return Bl}),o.d(A,"ENV",function(){return ee}),o.d(A,"Environment",function(){return $}),o.d(A,"KernelBackend",function(){return Rf}),o.d(A,"MomentumOptimizer",function(){return iv}),o.d(A,"Optimizer",function(){return fd}),o.d(A,"RMSPropOptimizer",function(){return Wv}),o.d(A,"Rank",function(){return ge}),o.d(A,"Reduction",function(){return rs}),o.d(A,"SGDOptimizer",function(){return Uv}),o.d(A,"Tensor",function(){return jt}),o.d(A,"TensorBuffer",function(){return Wi}),o.d(A,"Variable",function(){return mt}),o.d(A,"abs",function(){return Dc}),o.d(A,"acos",function(){return Tm}),o.d(A,"acosh",function(){return Nm}),o.d(A,"add",function(){return Xh}),o.d(A,"addN",function(){return Fv}),o.d(A,"addStrict",function(){return Rv}),o.d(A,"all",function(){return Vm}),o.d(A,"any",function(){return dc}),o.d(A,"argMax",function(){return qm}),o.d(A,"argMin",function(){return Hg}),o.d(A,"asin",function(){return _u}),o.d(A,"asinh",function(){return Im}),o.d(A,"atan",function(){return Hh}),o.d(A,"atan2",function(){return zp}),o.d(A,"atanh",function(){return Qd}),o.d(A,"avgPool",function(){return Wg}),o.d(A,"avgPool3d",function(){return Vg}),o.d(A,"backend",function(){return xm}),o.d(A,"backend_util",function(){return uc}),o.d(A,"basicLSTMCell",function(){return Xg}),o.d(A,"batchNorm",function(){return Iv}),o.d(A,"batchNorm2d",function(){return Vl}),o.d(A,"batchNorm3d",function(){return Kh}),o.d(A,"batchNorm4d",function(){return Wf}),o.d(A,"batchNormalization",function(){return k0}),o.d(A,"batchNormalization2d",function(){return Ig}),o.d(A,"batchNormalization3d",function(){return np}),o.d(A,"batchNormalization4d",function(){return Rm}),o.d(A,"batchToSpaceND",function(){return Gc}),o.d(A,"booleanMaskAsync",function(){return Hp}),o.d(A,"broadcastTo",function(){return _l}),o.d(A,"browser",function(){return Ku}),o.d(A,"buffer",function(){return Ni}),o.d(A,"cast",function(){return Wd}),o.d(A,"ceil",function(){return Nv}),o.d(A,"clipByValue",function(){return Zd}),o.d(A,"clone",function(){return Mp}),o.d(A,"complex",function(){return fa}),o.d(A,"concat",function(){return Ba}),o.d(A,"concat1d",function(){return Fh}),o.d(A,"concat2d",function(){return Pd}),o.d(A,"concat3d",function(){return Al}),o.d(A,"concat4d",function(){return Rh}),o.d(A,"conv1d",function(){return Gp}),o.d(A,"conv2d",function(){return Zh}),o.d(A,"conv2dTranspose",function(){return sl}),o.d(A,"conv3d",function(){return Kp}),o.d(A,"conv3dTranspose",function(){return Mv}),o.d(A,"cos",function(){return Tc}),o.d(A,"cosh",function(){return ep}),o.d(A,"cumsum",function(){return Sl}),o.d(A,"customGrad",function(){return Ws}),o.d(A,"deprecationWarn",function(){return Cf}),o.d(A,"depthToSpace",function(){return jh}),o.d(A,"depthwiseConv2d",function(){return sp}),o.d(A,"diag",function(){return hp}),o.d(A,"disableDeprecationWarnings",function(){return Np}),o.d(A,"dispose",function(){return Na}),o.d(A,"disposeVariables",function(){return Ol}),o.d(A,"div",function(){return Hl}),o.d(A,"divNoNan",function(){return al}),o.d(A,"divStrict",function(){return rp}),o.d(A,"dot",function(){return up}),o.d(A,"dropout",function(){return eh}),o.d(A,"elu",function(){return pc}),o.d(A,"enableDebugMode",function(){return Tp}),o.d(A,"enableProdMode",function(){return xu}),o.d(A,"engine",function(){return Id}),o.d(A,"env",function(){return L}),o.d(A,"equal",function(){return fc}),o.d(A,"equalStrict",function(){return Nu}),o.d(A,"erf",function(){return Cg}),o.d(A,"exp",function(){return Og}),o.d(A,"expandDims",function(){return Pa}),o.d(A,"expm1",function(){return Fm}),o.d(A,"eye",function(){return Bh}),o.d(A,"fft",function(){return em}),o.d(A,"fill",function(){return ws}),o.d(A,"findBackend",function(){return Rd}),o.d(A,"findBackendFactory",function(){return Ip}),o.d(A,"floor",function(){return b0}),o.d(A,"floorDiv",function(){return Yh}),o.d(A,"frame",function(){return pp}),o.d(A,"fused",function(){return Jm}),o.d(A,"gather",function(){return Vp}),o.d(A,"gatherND",function(){return fl}),o.d(A,"gather_util",function(){return Em}),o.d(A,"getBackend",function(){return bs}),o.d(A,"getGradient",function(){return K}),o.d(A,"getKernel",function(){return ie}),o.d(A,"getKernelsForBackend",function(){return he}),o.d(A,"grad",function(){return Ff}),o.d(A,"grads",function(){return jl}),o.d(A,"greater",function(){return hu}),o.d(A,"greaterEqual",function(){return Qh}),o.d(A,"greaterEqualStrict",function(){return Wp}),o.d(A,"greaterStrict",function(){return jm}),o.d(A,"hammingWindow",function(){return Gm}),o.d(A,"hannWindow",function(){return rm}),o.d(A,"ifft",function(){return tm}),o.d(A,"imag",function(){return Uo}),o.d(A,"image",function(){return Ym}),o.d(A,"inTopKAsync",function(){return Qg}),o.d(A,"io",function(){return ud}),o.d(A,"irfft",function(){return Fc}),o.d(A,"isFinite",function(){return $h}),o.d(A,"isInf",function(){return Tg}),o.d(A,"isNaN",function(){return Dg}),o.d(A,"keep",function(){return Dh}),o.d(A,"leakyRelu",function(){return nd}),o.d(A,"less",function(){return Bm}),o.d(A,"lessEqual",function(){return ip}),o.d(A,"lessEqualStrict",function(){return Fa}),o.d(A,"lessStrict",function(){return ap}),o.d(A,"linalg",function(){return om}),o.d(A,"linspace",function(){return Ih}),o.d(A,"localResponseNormalization",function(){return Kg}),o.d(A,"log",function(){return x0}),o.d(A,"log1p",function(){return sa}),o.d(A,"logSigmoid",function(){return Ag}),o.d(A,"logSoftmax",function(){return na}),o.d(A,"logSumExp",function(){return Yl}),o.d(A,"logicalAnd",function(){return Vf}),o.d(A,"logicalNot",function(){return Fg}),o.d(A,"logicalOr",function(){return Mm}),o.d(A,"logicalXor",function(){return qf}),o.d(A,"losses",function(){return im}),o.d(A,"matMul",function(){return jg}),o.d(A,"math",function(){return jc}),o.d(A,"max",function(){return Bv}),o.d(A,"maxPool",function(){return Ug}),o.d(A,"maxPool3d",function(){return jv}),o.d(A,"maximum",function(){return Hf}),o.d(A,"maximumStrict",function(){return $l}),o.d(A,"mean",function(){return ed}),o.d(A,"memory",function(){return _h}),o.d(A,"min",function(){return td}),o.d(A,"minimum",function(){return Gl}),o.d(A,"minimumStrict",function(){return Tu}),o.d(A,"mod",function(){return Jh}),o.d(A,"modStrict",function(){return $f}),o.d(A,"moments",function(){return Jl}),o.d(A,"movingAverage",function(){return Ql}),o.d(A,"mul",function(){return ol}),o.d(A,"mulStrict",function(){return Nc}),o.d(A,"multiRNNCell",function(){return Zp}),o.d(A,"multinomial",function(){return Dl}),o.d(A,"neg",function(){return _g}),o.d(A,"nextFrame",function(){return af}),o.d(A,"norm",function(){return rd}),o.d(A,"notEqual",function(){return hc}),o.d(A,"notEqualStrict",function(){return Xf}),o.d(A,"oneHot",function(){return Ph}),o.d(A,"ones",function(){return uu}),o.d(A,"onesLike",function(){return us}),o.d(A,"op",function(){return xt}),o.d(A,"outerProduct",function(){return Bg}),o.d(A,"pad",function(){return Tl}),o.d(A,"pad1d",function(){return Kc}),o.d(A,"pad2d",function(){return Ec}),o.d(A,"pad3d",function(){return Lh}),o.d(A,"pad4d",function(){return Sf}),o.d(A,"pool",function(){return Jf}),o.d(A,"pow",function(){return Gf}),o.d(A,"powStrict",function(){return Up}),o.d(A,"prelu",function(){return lp}),o.d(A,"print",function(){return _f}),o.d(A,"prod",function(){return Zf}),o.d(A,"profile",function(){return Sh}),o.d(A,"rand",function(){return Nl}),o.d(A,"randomGamma",function(){return km}),o.d(A,"randomNormal",function(){return Cc}),o.d(A,"randomUniform",function(){return Il}),o.d(A,"range",function(){return ac}),o.d(A,"ready",function(){return Fd}),o.d(A,"real",function(){return uo}),o.d(A,"reciprocal",function(){return Bp}),o.d(A,"registerBackend",function(){return Fp}),o.d(A,"registerGradient",function(){return Ae}),o.d(A,"registerKernel",function(){return pe}),o.d(A,"relu",function(){return Qp}),o.d(A,"relu6",function(){return Hm}),o.d(A,"removeBackend",function(){return ic}),o.d(A,"reshape",function(){return eo}),o.d(A,"reverse",function(){return Xl}),o.d(A,"reverse1d",function(){return Pg}),o.d(A,"reverse2d",function(){return cp}),o.d(A,"reverse3d",function(){return Yp}),o.d(A,"reverse4d",function(){return Lg}),o.d(A,"rfft",function(){return $m}),o.d(A,"round",function(){return Sg}),o.d(A,"rsqrt",function(){return tp}),o.d(A,"scalar",function(){return fr}),o.d(A,"scatterND",function(){return Yg}),o.d(A,"scatter_util",function(){return Hd}),o.d(A,"selu",function(){return Gg}),o.d(A,"separableConv2d",function(){return Mg}),o.d(A,"serialization",function(){return pl}),o.d(A,"setBackend",function(){return Of}),o.d(A,"setPlatform",function(){return wm}),o.d(A,"setdiff1dAsync",function(){return Ac}),o.d(A,"sigmoid",function(){return nl}),o.d(A,"sign",function(){return rl}),o.d(A,"signal",function(){return Km}),o.d(A,"sin",function(){return Uf}),o.d(A,"sinh",function(){return Gh}),o.d(A,"slice",function(){return ul}),o.d(A,"slice1d",function(){return Wm}),o.d(A,"slice2d",function(){return qg}),o.d(A,"slice3d",function(){return Qf}),o.d(A,"slice4d",function(){return cl}),o.d(A,"slice_util",function(){return $d}),o.d(A,"softmax",function(){return Os}),o.d(A,"softplus",function(){return w0}),o.d(A,"spaceToBatchND",function(){return Ao}),o.d(A,"sparseToDense",function(){return Jg}),o.d(A,"spectral",function(){return nm}),o.d(A,"split",function(){return Ri}),o.d(A,"sqrt",function(){return Pp}),o.d(A,"square",function(){return Dm}),o.d(A,"squaredDifference",function(){return zf}),o.d(A,"squaredDifferenceStrict",function(){return Kf}),o.d(A,"squeeze",function(){return Fo}),o.d(A,"stack",function(){return Mi}),o.d(A,"step",function(){return il}),o.d(A,"stft",function(){return mp}),o.d(A,"stridedSlice",function(){return fp}),o.d(A,"sub",function(){return Ic}),o.d(A,"subStrict",function(){return ts}),o.d(A,"sum",function(){return $g}),o.d(A,"sumOutType",function(){return Jn}),o.d(A,"tan",function(){return Su}),o.d(A,"tanh",function(){return zl}),o.d(A,"tensor",function(){return wa}),o.d(A,"tensor1d",function(){return zs}),o.d(A,"tensor2d",function(){return eu}),o.d(A,"tensor3d",function(){return Hc}),o.d(A,"tensor4d",function(){return Us}),o.d(A,"tensor5d",function(){return Nh}),o.d(A,"tensor6d",function(){return jd}),o.d(A,"tensor_util",function(){return Ot}),o.d(A,"test_util",function(){return ru}),o.d(A,"tidy",function(){return Fi}),o.d(A,"tile",function(){return Es}),o.d(A,"time",function(){return bm}),o.d(A,"topk",function(){return ll}),o.d(A,"train",function(){return S0}),o.d(A,"transpose",function(){return ns}),o.d(A,"truncatedNormal",function(){return Oc}),o.d(A,"unregisterGradient",function(){return je}),o.d(A,"unregisterKernel",function(){return Te}),o.d(A,"unsortedSegmentSum",function(){return qp}),o.d(A,"unstack",function(){return Ro}),o.d(A,"util",function(){return Qr}),o.d(A,"valueAndGrad",function(){return Gd}),o.d(A,"valueAndGrads",function(){return Kd}),o.d(A,"variable",function(){return Bd}),o.d(A,"variableGrads",function(){return en}),o.d(A,"version_core",function(){return C0}),o.d(A,"webgl",function(){return gl}),o.d(A,"where",function(){return ta}),o.d(A,"whereAsync",function(){return ql}),o.d(A,"zeros",function(){return Ki}),o.d(A,"zerosLike",function(){return ii});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var re=function(v,h){return(re=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,d){u.__proto__=d}||function(u,d){for(var y in d)d.hasOwnProperty(y)&&(u[y]=d[y])})(v,h)};function J(v,h){function u(){this.constructor=v}re(v,h),v.prototype=h===null?Object.create(h):(u.prototype=h.prototype,new u)}function R(v,h,u,d){return new(u||(u=Promise))(function(y,D){function W(de){try{ae(d.next(de))}catch(be){D(be)}}function X(de){try{ae(d.throw(de))}catch(be){D(be)}}function ae(de){de.done?y(de.value):new u(function(be){be(de.value)}).then(W,X)}ae((d=d.apply(v,[])).next())})}function P(v,h){var u,d,y,D,W={label:0,sent:function(){if(1&y[0])throw y[1];return y[1]},trys:[],ops:[]};return D={next:X(0),throw:X(1),return:X(2)},typeof Symbol=="function"&&(D[Symbol.iterator]=function(){return this}),D;function X(ae){return function(de){return function(be){if(u)throw new TypeError("Generator is already executing.");for(;W;)try{if(u=1,d&&(y=2&be[0]?d.return:be[0]?d.throw||((y=d.return)&&y.call(d),0):d.next)&&!(y=y.call(d,be[1])).done)return y;switch(d=0,y&&(be=[2&be[0],y.value]),be[0]){case 0:case 1:y=be;break;case 4:return W.label++,{value:be[1],done:!1};case 5:W.label++,d=be[1],be=[0];continue;case 7:be=W.ops.pop(),W.trys.pop();continue;default:if(!(y=(y=W.trys).length>0&&y[y.length-1])&&(be[0]===6||be[0]===2)){W=0;continue}if(be[0]===3&&(!y||be[1]>y[0]&&be[1]<y[3])){W.label=be[1];break}if(be[0]===6&&W.label<y[1]){W.label=y[1],y=be;break}if(y&&W.label<y[2]){W.label=y[2],W.ops.push(be);break}y[2]&&W.ops.pop(),W.trys.pop();continue}be=h.call(v,W)}catch(Ie){be=[6,Ie],d=0}finally{u=y=0}if(5&be[0])throw be[1];return{value:be[0]?be[1]:void 0,done:!0}}([ae,de])}}}var $=function(){function v(h){this.global=h,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return v.prototype.setPlatform=function(h,u){this.platform!=null&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+u+"."),this.platformName=h,this.platform=u},v.prototype.registerFlag=function(h,u,d){if(this.flagRegistry[h]={evaluationFn:u,setHook:d},this.urlFlags[h]!=null){var y=this.urlFlags[h];console.warn("Setting feature override from URL "+h+": "+y+"."),this.set(h,y)}},v.prototype.get=function(h){return h in this.flags?this.flags[h]:(this.flags[h]=this.evaluateFlag(h),this.flags[h])},v.prototype.getNumber=function(h){return this.get(h)},v.prototype.getBool=function(h){return this.get(h)},v.prototype.getFlags=function(){return this.flags},Object.defineProperty(v.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),v.prototype.set=function(h,u){if(this.flagRegistry[h]==null)throw new Error("Cannot set flag "+h+" as it has not been registered.");this.flags[h]=u,this.flagRegistry[h].setHook!=null&&this.flagRegistry[h].setHook(u)},v.prototype.evaluateFlag=function(h){if(this.flagRegistry[h]==null)throw new Error("Cannot evaluate flag '"+h+"': no evaluation function found.");return this.flagRegistry[h].evaluationFn()},v.prototype.setFlags=function(h){this.flags=Object.assign({},h)},v.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},v.prototype.populateURLFlags=function(){var h=this;if(this.global!==void 0&&this.global.location!==void 0&&this.global.location.search!==void 0){var u,d,y=(u=this.global.location.search,d={},u.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(D){for(var W=[],X=1;X<arguments.length;X++)W[X-1]=arguments[X];return function(ae,de,be){ae[decodeURIComponent(de)]=decodeURIComponent(be||"")}(d,W[0],W[1]),W.join("=")}),d);"tfjsflags"in y&&y.tfjsflags.split(",").forEach(function(D){var W=D.split(":"),X=W[0],ae=W[1];h.urlFlags[X]=function(de,be){if((be=be.toLowerCase())==="true"||be==="false")return be==="true";if(""+ +be===be)return+be;throw new Error("Could not parse value flag value "+be+" for flag "+de+".")}(X,ae)})}},v}();function L(){return ee}var ee=null,F=new Map,ue=new Map;function ie(v,h){var u=ke(v,h);return F.get(u)}function K(v){return ue.get(v)}function he(v){for(var h=F.entries(),u=[];;){var d=h.next(),y=d.done,D=d.value;if(y)break;var W=D[0],X=D[1];W.split("_")[0]===v&&u.push(X)}return u}function pe(v){var h=v.kernelName,u=v.backendName,d=ke(h,u);if(F.has(d))throw new Error("The kernel '"+h+"' for backend '"+u+"' is already registered");F.set(d,v)}function Ae(v){var h=v.kernelName;ue.has(h)&&console.warn("Overriding the gradient for '"+h+"'"),ue.set(h,v)}function Te(v,h){var u=ke(v,h);if(!F.has(u))throw new Error("The kernel '"+v+"' for backend '"+h+"' is not registered");F.delete(u)}function je(v){if(!ue.has(v))throw new Error("The gradient '"+v+"' for backend is not registered");ue.delete(v)}function ke(v,h){return h+"_"+v}function at(v){for(var h=v.length,u=0,d=0;h>0;)d=Math.random()*h|0,u=v[--h],v[h]=v[d],v[d]=u}function St(v,h,u){return Math.max(v,Math.min(h,u))}function zt(v){return v%2==0?v:v+1}function $t(v){for(var h=0,u=0;u<v.length;u++)h+=v[u];return h}function we(v,h){if(!v)throw new Error(typeof h=="string"?h:h())}function Tt(v,h,u){u===void 0&&(u=""),we(ln(v,h),function(){return u+" Shapes "+v+" and "+h+" must match"})}function Gt(v){we(v!=null,function(){return"The input to the tensor constructor must be a non-null value."})}function Pt(v,h,u){if(h===void 0&&(h=[]),u===void 0&&(u=!1),h==null&&(h=[]),Array.isArray(v)||Et(v)&&!u)for(var d=0;d<v.length;++d)Pt(v[d],h,u);else h.push(v);return h}function Ye(v){if(v.length===0)return 1;for(var h=v[0],u=1;u<v.length;u++)h*=v[u];return h}function ln(v,h){if(v===h)return!0;if(v==null||h==null||v.length!==h.length)return!1;for(var u=0;u<v.length;u++)if(v[u]!==h[u])return!1;return!0}function Zt(v){return v%1==0}function Bt(v){if(Math.tanh!=null)return Math.tanh(v);if(v===1/0)return 1;if(v===-1/0)return-1;var h=Math.exp(2*v);return(h-1)/(h+1)}function Mt(v){var h=Math.ceil(Math.sqrt(v));return[h,Math.ceil(v/h)]}function bn(v,h){return h<=v.length?v:v+" ".repeat(h-v.length)}function Dt(v,h,u){return h===void 0&&(h=function(d){return 0}),new Promise(function(d,y){var D=0,W=function(){if(v())d();else{var X=h(++D);u!=null&&D>=u?y():setTimeout(W,X)}};W()})}function _t(v,h){for(var u=1,d=-1,y=0;y<v.length;++y)if(v[y]>=0)u*=v[y];else if(v[y]===-1){if(d!==-1)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+d+" and dim "+y);d=y}else if(v[y]<0)throw Error("Shapes can not be < 0. Found "+v[y]+" at dim "+y);if(d===-1){if(h>0&&h!==u)throw Error("Size("+h+") must match the product of shape "+v);return v}if(u===0)throw Error("Cannot infer the missing size in ["+v+"] when there are 0 elements");if(h%u!=0)throw Error("The implicit shape can't be a fractional number. Got "+h+" / "+u);var D=v.slice();return D[d]=h/u,D}function xn(v,h){var u=h.length;return we((v=v==null?h.map(function(d,y){return y}):[].concat(v)).every(function(d){return d>=-u&&d<u}),function(){return"All values in axis param must be in range [-"+u+", "+u+") but got axis "+v}),we(v.every(function(d){return Zt(d)}),function(){return"All values in axis param must be integers but got axis "+v}),v.map(function(d){return d<0?u+d:d})}function In(v,h){for(var u=[],d=[],y=h!=null&&Array.isArray(h)&&h.length===0,D=h==null||y?null:xn(h,v).sort(),W=0,X=0;X<v.length;++X){if(D!=null){if(D[W]===X&&v[X]!==1)throw new Error("Can't squeeze axis "+X+" since its dim '"+v[X]+"' is not 1");(D[W]==null||D[W]>X)&&v[X]===1&&(u.push(v[X]),d.push(X)),D[W]<=X&&W++}v[X]!==1&&(u.push(v[X]),d.push(X))}return{newShape:u,keptDims:d}}function Yn(v,h){var u=null;if(v==null||v==="float32")u=new Float32Array(h);else if(v==="int32")u=new Int32Array(h);else{if(v!=="bool")throw new Error("Unknown data type "+v);u=new Uint8Array(h)}return u}function fn(v,h){var u=null;if(v==null||v==="float32")u=new Float32Array(h);else if(v==="int32")u=new Int32Array(h);else if(v==="bool")u=new Uint8Array(h);else{if(v!=="string")throw new Error("Unknown data type "+v);u=new Array(h)}return u}function We(v,h){for(var u=0;u<v.length;u++){var d=v[u];if(isNaN(d)||!isFinite(d))throw Error("A tensor of type "+h+" being uploaded contains "+d+".")}}function Pe(v){return v==="bool"||v==="complex64"||v==="float32"||v==="int32"||v==="string"}function rt(v,h){return!(h==="complex64"||h==="float32"&&v!=="complex64"||h==="int32"&&v!=="float32"&&v!=="complex64"||h==="bool"&&v==="bool")}function Et(v){return v instanceof Float32Array||v instanceof Int32Array||v instanceof Uint8Array}function Lt(v){if(v==="float32"||v==="int32")return 4;if(v==="complex64")return 8;if(v==="bool")return 1;throw new Error("Unknown dtype "+v)}function rn(v){if(v==null)return 0;var h=0;return v.forEach(function(u){return h+=u.length}),h}function Sn(v){return typeof v=="string"||v instanceof String}function kn(v){return typeof v=="boolean"}function qn(v){return typeof v=="number"}function xe(v){return Array.isArray(v)?xe(v[0]):v instanceof Float32Array?"float32":v instanceof Int32Array||v instanceof Uint8Array?"int32":qn(v)?"float32":Sn(v)?"string":kn(v)?"bool":"float32"}function Xn(v){return!!(v&&v.constructor&&v.call&&v.apply)}function br(v,h){for(var u=h;u<v;++u)if(v%u==0)return u;return v}function Cr(v){var h=v.length;if(h<2)return[];var u=new Array(h-1);u[h-2]=v[h-1];for(var d=h-3;d>=0;--d)u[d]=u[d+1]*v[d+1];return u}function dr(v,h,u){if(h==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(v)&&(v=Pt(v)),u&&We(v,h),function(D,W){return D instanceof Float32Array&&W==="float32"||D instanceof Int32Array&&W==="int32"||D instanceof Uint8Array&&W==="bool"}(v,h))return v;if(h==null||h==="float32"||h==="complex64")return new Float32Array(v);if(h==="int32")return new Int32Array(v);if(h==="bool"){for(var d=new Uint8Array(v.length),y=0;y<d.length;++y)Math.round(v[y])!==0&&(d[y]=1);return d}throw new Error("Unknown data type "+h)}function Rr(v,h){if(v.length===0)return h[0];var u=v.reduce(function(d,y){return d*y});if(u===0)return[];if(u!==h.length)throw new Error("["+v+"] does not match the input size.");return function d(y,D,W){var X=new Array;if(D.length===1)for(var ae=D[0],de=0;de<ae;de++)X[de]=W[y+de];else{ae=D[0];var be=D.slice(1),Ie=be.reduce(function(Re,Me){return Re*Me});for(de=0;de<ae;de++)X[de]=d(y+de*Ie,be,W)}return X}(0,v,h)}function hn(v,h){for(var u=Xt(v,h),d=0;d<u.length;d++)u[d]=1;return u}function Xt(v,h){if(h==null||h==="float32"||h==="complex64")return new Float32Array(v);if(h==="int32")return new Int32Array(v);if(h==="bool")return new Uint8Array(v);throw new Error("Unknown data type "+h)}function nn(){return L().platform.now()}function Gn(v){v.forEach(function(h){we(Number.isInteger(h)&&h>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+v+"]."})})}function Dn(v,h){return h===void 0&&(h="utf-8"),h=h||"utf-8",L().platform.encode(v,h)}function mr(v,h){return h===void 0&&(h="utf-8"),h=h||"utf-8",L().platform.decode(v,h)}function xr(v,h,u){if(h===0)return 0;if(h===1)return v[0];for(var d=v[v.length-1],y=0;y<v.length-1;++y)d+=u[y]*v[y];return d}function gr(v,h,u){if(h===0)return[];if(h===1)return[v];for(var d=new Array(h),y=0;y<d.length-1;++y)d[y]=Math.floor(v/u[y]),v-=d[y]*u[y];return d[d.length-1]=v,d}var Qr=Object.freeze({shuffle:at,clamp:St,nearestLargerEven:zt,sum:$t,randUniform:function(v,h){var u=Math.random();return h*u+(1-u)*v},distSquared:function(v,h){for(var u=0,d=0;d<v.length;d++){var y=Number(v[d])-Number(h[d]);u+=y*y}return u},assert:we,assertShapesMatch:Tt,assertNonNull:Gt,flatten:Pt,sizeFromShape:Ye,isScalarShape:function(v){return v.length===0},arraysEqual:ln,isInt:Zt,tanh:Bt,sizeToSquarishShape:Mt,createShuffledIndices:function(v){for(var h=new Uint32Array(v),u=0;u<v;++u)h[u]=u;return at(h),h},rightPad:bn,repeatedTry:Dt,inferFromImplicitShape:_t,parseAxisParam:xn,squeezeShape:In,getTypedArrayFromDType:Yn,getArrayFromDType:fn,checkConversionForErrors:We,isValidDtype:Pe,hasEncodingLoss:rt,isTypedArray:Et,bytesPerElement:Lt,bytesFromStringArray:rn,isString:Sn,isBoolean:kn,isNumber:qn,inferDtype:xe,isFunction:Xn,nearestDivisor:br,computeStrides:Cr,toTypedArray:dr,toNestedArray:Rr,makeOnesTypedArray:hn,makeZerosTypedArray:Xt,now:nn,assertNonNegativeIntegerDimensions:Gn,fetch:function(v,h){return L().platform.fetch(v,h)},encodeString:Dn,decodeString:mr,locToIndex:xr,indexToLoc:gr}),ni=function(){function v(h,u){this.backendTimer=h,this.logger=u,u==null&&(this.logger=new Mr)}return v.prototype.profileKernel=function(h,u,d){var y,D=this,W=this.backendTimer.time(function(){y=d()});return y.forEach(function(X){X.data().then(function(ae){(function(de,be,Ie){if(be!=="float32")return!1;for(var Re=0;Re<de.length;Re++){var Me=de[Re];if(isNaN(Me)||!isFinite(Me))return console.warn("Found "+Me+" in the result of '"+Ie+"'"),!0}})(ae,X.dtype,h),W.then(function(de){var be="";de.getExtraProfileInfo!=null&&(be=de.getExtraProfileInfo()),D.logger.logKernelProfile(h,X,ae,de.kernelMs,u,be)})})}),y},v}(),Mr=function(){function v(){}return v.prototype.logKernelProfile=function(h,u,d,y,D,W){var X=typeof y=="number"?bn(y+"ms",9):y.error,ae=bn(h,25),de=u.rank,be=u.size,Ie=bn(u.shape.toString(),14),Re="";for(var Me in D){var qe=D[Me].shape||u.shape,Je=qe.length;Re+=Me+": "+Je+"D "+(Je>0?qe:"")+" "}console.log("%c"+ae+"	%c"+X+"	%c"+de+"D "+Ie+"	%c"+be+"	%c"+Re+"	%c"+W,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},v}(),di=20,Yr=3,Xr=7;function fi(v,h,u){return bn(Array.isArray(v)?parseFloat(v[0].toFixed(Xr))+" + "+parseFloat(v[1].toFixed(Xr))+"j":Sn(v)?"'"+v+"'":u==="bool"?ai(v):parseFloat(v.toFixed(Xr)).toString(),h)}function ai(v){return v===0?"false":"true"}function Oa(v){for(var h=[],u=0;u<v.length;u+=2)h.push([v[u],v[u+1]]);return h}var Wi=function(){function v(h,u,d){var y=this;if(this.dtype=u,this.shape=h.slice(),this.size=Ye(h),d!=null){var D=d.length;we(D===this.size,function(){return"Length of values '"+D+"' does not match the size inferred by the shape '"+y.size+"'."})}if(u==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=d||fn(u,this.size),this.strides=Cr(h)}return v.prototype.set=function(h){for(var u=this,d=[],y=1;y<arguments.length;y++)d[y-1]=arguments[y];d.length===0&&(d=[0]),we(d.length===this.rank,function(){return"The number of provided coordinates ("+d.length+") must match the rank ("+u.rank+")"});var D=this.locToIndex(d);this.values[D]=h},v.prototype.get=function(){for(var h=[],u=0;u<arguments.length;u++)h[u]=arguments[u];h.length===0&&(h=[0]);for(var d=0,y=0,D=h;y<D.length;y++){var W=D[y];if(W<0||W>=this.shape[d]){var X="Requested out of range element at "+h+".   Buffer shape="+this.shape;throw new Error(X)}d++}for(var ae=h[h.length-1],de=0;de<h.length-1;++de)ae+=this.strides[de]*h[de];return this.values[ae]},v.prototype.locToIndex=function(h){if(this.rank===0)return 0;if(this.rank===1)return h[0];for(var u=h[h.length-1],d=0;d<h.length-1;++d)u+=this.strides[d]*h[d];return u},v.prototype.indexToLoc=function(h){if(this.rank===0)return[];if(this.rank===1)return[h];for(var u=new Array(this.shape.length),d=0;d<u.length-1;++d)u[d]=Math.floor(h/this.strides[d]),h-=u[d]*this.strides[d];return u[u.length-1]=h,u},Object.defineProperty(v.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),v.prototype.toTensor=function(){return Ci().makeTensor(this.values,this.shape,this.dtype)},v}(),Ci=null,yt=null,Lr=null,jt=function(){function v(h,u,d,y){this.kept=!1,this.isDisposedInternal=!1,this.shape=h.slice(),this.dtype=u||"float32",this.size=Ye(h),this.strides=Cr(h),this.dataId=d,this.id=y,this.rankType=this.rank<5?this.rank.toString():"higher"}return v.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},v.prototype.asScalar=function(){return this.throwIfDisposed(),we(this.size===1,function(){return"The array must have only 1 element."}),this.reshape([])},v.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},v.prototype.as2D=function(h,u){return this.throwIfDisposed(),this.reshape([h,u])},v.prototype.as3D=function(h,u,d){return this.throwIfDisposed(),this.reshape([h,u,d])},v.prototype.as4D=function(h,u,d,y){return this.throwIfDisposed(),this.reshape([h,u,d,y])},v.prototype.as5D=function(h,u,d,y,D){return this.throwIfDisposed(),this.reshape([h,u,d,y,D])},v.prototype.asType=function(h){return this.throwIfDisposed(),yt.cast(this,h)},Object.defineProperty(v.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),v.prototype.buffer=function(){return R(this,void 0,void 0,function(){var h;return P(this,function(u){switch(u.label){case 0:return[4,this.data()];case 1:return h=u.sent(),[2,yt.buffer(this.shape,this.dtype,h)]}})})},v.prototype.bufferSync=function(){return yt.buffer(this.shape,this.dtype,this.dataSync())},v.prototype.array=function(){return R(this,void 0,void 0,function(){var h;return P(this,function(u){switch(u.label){case 0:return[4,this.data()];case 1:return h=u.sent(),[2,Rr(this.shape,h)]}})})},v.prototype.arraySync=function(){return Rr(this.shape,this.dataSync())},v.prototype.data=function(){return R(this,void 0,void 0,function(){var h,u;return P(this,function(d){switch(d.label){case 0:return this.throwIfDisposed(),h=Ci().read(this.dataId),this.dtype!=="string"?[3,2]:[4,h];case 1:u=d.sent();try{return[2,u.map(function(y){return mr(y)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}d.label=2;case 2:return[2,h]}})})},v.prototype.dataSync=function(){this.throwIfDisposed();var h=Ci().readSync(this.dataId);if(this.dtype==="string")try{return h.map(function(u){return mr(u)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return h},v.prototype.bytes=function(){return R(this,void 0,void 0,function(){var h;return P(this,function(u){switch(u.label){case 0:return this.throwIfDisposed(),[4,Ci().read(this.dataId)];case 1:return h=u.sent(),this.dtype==="string"?[2,h]:[2,new Uint8Array(h.buffer)]}})})},v.prototype.dispose=function(){this.isDisposed||(Ci().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(v.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),v.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},v.prototype.toFloat=function(){return this.asType("float32")},v.prototype.toInt=function(){return this.asType("int32")},v.prototype.toBool=function(){return this.asType("bool")},v.prototype.print=function(h){return h===void 0&&(h=!1),yt.print(this,h)},v.prototype.reshape=function(h){return this.throwIfDisposed(),yt.reshape(this,h)},v.prototype.reshapeAs=function(h){return this.throwIfDisposed(),this.reshape(h.shape)},v.prototype.expandDims=function(h){return h===void 0&&(h=0),yt.expandDims(this,h)},v.prototype.cumsum=function(h,u,d){return h===void 0&&(h=0),u===void 0&&(u=!1),d===void 0&&(d=!1),yt.cumsum(this,h,u,d)},v.prototype.squeeze=function(h){return this.throwIfDisposed(),yt.squeeze(this,h)},v.prototype.clone=function(){return this.throwIfDisposed(),yt.clone(this)},v.prototype.oneHot=function(h,u,d){return this.throwIfDisposed(),yt.oneHot(this,h,u,d)},v.prototype.toString=function(h){return h===void 0&&(h=!1),function(u,d,y,D){var W=Cr(d),X=function(Ie,Re,Me,qe){var Je=Ye(Re),Qe=qe[qe.length-1],ot=new Array(Qe).fill(0),vt=Re.length,bt=Me==="complex64"?Oa(Ie):Ie;if(vt>1)for(var wt=0;wt<Je/Qe;wt++)for(var Ft=wt*Qe,Yt=0;Yt<Qe;Yt++)ot[Yt]=Math.max(ot[Yt],fi(bt[Ft+Yt],0,Me).length);return ot}(u,d,y,W),ae=d.length,de=function Ie(Re,Me,qe,Je,Qe,ot){ot===void 0&&(ot=!0);var vt=qe==="complex64"?2:1,bt=Me[0],wt=Me.length;if(wt===0)return qe==="complex64"?[fi(Oa(Re)[0],0,qe)]:qe==="bool"?[ai(Re[0])]:[Re[0].toString()];if(wt===1){if(bt>di){var Ft=Yr*vt,Yt=Array.from(Re.slice(0,Ft)),an=Array.from(Re.slice((bt-Yr)*vt,bt*vt));return qe==="complex64"&&(Yt=Oa(Yt),an=Oa(an)),["["+Yt.map(function(j,V){return fi(j,Qe[V],qe)}).join(", ")+", ..., "+an.map(function(j,V){return fi(j,Qe[bt-Yr+V],qe)}).join(", ")+"]"]}return["["+(qe==="complex64"?Oa(Re):Array.from(Re)).map(function(j,V){return fi(j,Qe[V],qe)}).join(", ")+"]"]}var Jt=Me.slice(1),un=Je.slice(1),gn=Je[0]*vt,p=[];if(bt>di){for(var c=0;c<Yr;c++){var a=(l=c*gn)+gn;p.push.apply(p,Ie(Re.slice(l,a),Jt,qe,un,Qe,!1))}for(p.push("..."),c=bt-Yr;c<bt;c++)a=(l=c*gn)+gn,p.push.apply(p,Ie(Re.slice(l,a),Jt,qe,un,Qe,c===bt-1))}else for(c=0;c<bt;c++){var l;a=(l=c*gn)+gn,p.push.apply(p,Ie(Re.slice(l,a),Jt,qe,un,Qe,c===bt-1))}var g=wt===2?",":"";for(p[0]="["+p[0]+g,c=1;c<p.length-1;c++)p[c]=" "+p[c]+g;var _=`,
`;for(c=2;c<wt;c++)_+=`
`;return p[p.length-1]=" "+p[p.length-1]+"]"+(ot?"":_),p}(u,d,y,W,X),be=["Tensor"];return D&&(be.push("  dtype: "+y),be.push("  rank: "+ae),be.push("  shape: ["+d+"]"),be.push("  values:")),be.push(de.map(function(Ie){return"    "+Ie}).join(`
`)),be.join(`
`)}(this.dataSync(),this.shape,this.dtype,h)},v.prototype.tile=function(h){return this.throwIfDisposed(),yt.tile(this,h)},v.prototype.gather=function(h,u){return u===void 0&&(u=0),this.throwIfDisposed(),yt.gather(this,h,u)},v.prototype.matMul=function(h,u,d){return u===void 0&&(u=!1),d===void 0&&(d=!1),this.throwIfDisposed(),yt.matMul(this,h,u,d)},v.prototype.dot=function(h){return this.throwIfDisposed(),yt.dot(this,h)},v.prototype.norm=function(h,u,d){return h===void 0&&(h="euclidean"),u===void 0&&(u=null),d===void 0&&(d=!1),this.throwIfDisposed(),yt.norm(this,h,u,d)},v.prototype.slice=function(h,u){return this.throwIfDisposed(),yt.slice(this,h,u)},v.prototype.reverse=function(h){return this.throwIfDisposed(),yt.reverse(this,h)},v.prototype.concat=function(h,u){return u===void 0&&(u=0),this.throwIfDisposed(),h instanceof v&&(h=[h]),yt.concat([this].concat(h),u)},v.prototype.split=function(h,u){return u===void 0&&(u=0),this.throwIfDisposed(),yt.split(this,h,u)},v.prototype.stack=function(h,u){return u===void 0&&(u=0),yt.stack([this,h],u)},v.prototype.unstack=function(h){return h===void 0&&(h=0),yt.unstack(this,h)},v.prototype.pad=function(h,u){return u===void 0&&(u=0),yt.pad(this,h,u)},v.prototype.batchNormalization=function(h,u,d,y,D){return d===void 0&&(d=.001),Lr("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(h,u,D,y,d)},v.prototype.batchNorm=function(h,u,d,y,D){return D===void 0&&(D=.001),this.throwIfDisposed(),yt.batchNorm(this,h,u,d,y,D)},v.prototype.all=function(h,u){return h===void 0&&(h=null),u===void 0&&(u=!1),this.throwIfDisposed(),yt.all(this,h,u)},v.prototype.any=function(h,u){return h===void 0&&(h=null),u===void 0&&(u=!1),this.throwIfDisposed(),yt.any(this,h,u)},v.prototype.logSumExp=function(h,u){return h===void 0&&(h=null),u===void 0&&(u=!1),this.throwIfDisposed(),yt.logSumExp(this,h,u)},v.prototype.sum=function(h,u){return h===void 0&&(h=null),u===void 0&&(u=!1),this.throwIfDisposed(),yt.sum(this,h,u)},v.prototype.prod=function(h,u){return h===void 0&&(h=null),u===void 0&&(u=!1),this.throwIfDisposed(),yt.prod(this,h,u)},v.prototype.mean=function(h,u){return h===void 0&&(h=null),u===void 0&&(u=!1),this.throwIfDisposed(),yt.mean(this,h,u)},v.prototype.min=function(h,u){return h===void 0&&(h=null),u===void 0&&(u=!1),this.throwIfDisposed(),yt.min(this,h,u)},v.prototype.max=function(h,u){return h===void 0&&(h=null),u===void 0&&(u=!1),this.throwIfDisposed(),yt.max(this,h,u)},v.prototype.argMin=function(h){return h===void 0&&(h=null),this.throwIfDisposed(),yt.argMin(this,h)},v.prototype.argMax=function(h){return h===void 0&&(h=null),this.throwIfDisposed(),yt.argMax(this,h)},v.prototype.cast=function(h){return this.throwIfDisposed(),yt.cast(this,h)},v.prototype.add=function(h){return this.throwIfDisposed(),yt.add(this,h)},v.prototype.addStrict=function(h){return this.throwIfDisposed(),yt.addStrict(this,h)},v.prototype.atan2=function(h){return this.throwIfDisposed(),yt.atan2(this,h)},v.prototype.sub=function(h){return this.throwIfDisposed(),yt.sub(this,h)},v.prototype.subStrict=function(h){return this.throwIfDisposed(),yt.subStrict(this,h)},v.prototype.pow=function(h){return this.throwIfDisposed(),yt.pow(this,h)},v.prototype.powStrict=function(h){return this.throwIfDisposed(),yt.powStrict(this,h)},v.prototype.mul=function(h){return this.throwIfDisposed(),yt.mul(this,h)},v.prototype.mulStrict=function(h){return this.throwIfDisposed(),yt.mulStrict(this,h)},v.prototype.div=function(h){return this.throwIfDisposed(),yt.div(this,h)},v.prototype.divNoNan=function(h){return this.throwIfDisposed(),yt.divNoNan(this,h)},v.prototype.floorDiv=function(h){return this.throwIfDisposed(),yt.floorDiv(this,h)},v.prototype.divStrict=function(h){return this.throwIfDisposed(),yt.divStrict(this,h)},v.prototype.minimum=function(h){return this.throwIfDisposed(),yt.minimum(this,h)},v.prototype.minimumStrict=function(h){return this.throwIfDisposed(),yt.minimumStrict(this,h)},v.prototype.maximum=function(h){return this.throwIfDisposed(),yt.maximum(this,h)},v.prototype.maximumStrict=function(h){return this.throwIfDisposed(),yt.maximumStrict(this,h)},v.prototype.mod=function(h){return this.throwIfDisposed(),yt.mod(this,h)},v.prototype.modStrict=function(h){return this.throwIfDisposed(),yt.modStrict(this,h)},v.prototype.squaredDifferenceStrict=function(h){return this.throwIfDisposed(),yt.squaredDifferenceStrict(this,h)},v.prototype.transpose=function(h){return this.throwIfDisposed(),yt.transpose(this,h)},v.prototype.notEqual=function(h){return this.throwIfDisposed(),yt.notEqual(this,h)},v.prototype.notEqualStrict=function(h){return this.throwIfDisposed(),yt.notEqualStrict(this,h)},v.prototype.less=function(h){return this.throwIfDisposed(),yt.less(this,h)},v.prototype.lessStrict=function(h){return this.throwIfDisposed(),yt.lessStrict(this,h)},v.prototype.equal=function(h){return this.throwIfDisposed(),yt.equal(this,h)},v.prototype.equalStrict=function(h){return this.throwIfDisposed(),yt.equalStrict(this,h)},v.prototype.lessEqual=function(h){return this.throwIfDisposed(),yt.lessEqual(this,h)},v.prototype.lessEqualStrict=function(h){return this.throwIfDisposed(),yt.lessEqualStrict(this,h)},v.prototype.greater=function(h){return this.throwIfDisposed(),yt.greater(this,h)},v.prototype.greaterStrict=function(h){return this.throwIfDisposed(),yt.greaterStrict(this,h)},v.prototype.greaterEqual=function(h){return this.throwIfDisposed(),yt.greaterEqual(this,h)},v.prototype.greaterEqualStrict=function(h){return this.throwIfDisposed(),yt.greaterEqualStrict(this,h)},v.prototype.logicalAnd=function(h){return this.throwIfDisposed(),yt.logicalAnd(this,h)},v.prototype.logicalOr=function(h){return this.throwIfDisposed(),yt.logicalOr(this,h)},v.prototype.logicalNot=function(){return this.throwIfDisposed(),yt.logicalNot(this)},v.prototype.logicalXor=function(h){return this.throwIfDisposed(),yt.logicalXor(this,h)},v.prototype.where=function(h,u){return this.throwIfDisposed(),yt.where(h,this,u)},v.prototype.neg=function(){return this.throwIfDisposed(),yt.neg(this)},v.prototype.ceil=function(){return this.throwIfDisposed(),yt.ceil(this)},v.prototype.floor=function(){return this.throwIfDisposed(),yt.floor(this)},v.prototype.sign=function(){return this.throwIfDisposed(),yt.sign(this)},v.prototype.isNaN=function(){return this.throwIfDisposed(),yt.isNaN(this)},v.prototype.isInf=function(){return this.throwIfDisposed(),yt.isInf(this)},v.prototype.isFinite=function(){return this.throwIfDisposed(),yt.isFinite(this)},v.prototype.exp=function(){return this.throwIfDisposed(),yt.exp(this)},v.prototype.expm1=function(){return this.throwIfDisposed(),yt.expm1(this)},v.prototype.log=function(){return this.throwIfDisposed(),yt.log(this)},v.prototype.log1p=function(){return this.throwIfDisposed(),yt.log1p(this)},v.prototype.sqrt=function(){return this.throwIfDisposed(),yt.sqrt(this)},v.prototype.rsqrt=function(){return this.throwIfDisposed(),yt.rsqrt(this)},v.prototype.square=function(){return this.throwIfDisposed(),yt.square(this)},v.prototype.reciprocal=function(){return this.throwIfDisposed(),yt.reciprocal(this)},v.prototype.abs=function(){return this.throwIfDisposed(),yt.abs(this)},v.prototype.clipByValue=function(h,u){return this.throwIfDisposed(),yt.clipByValue(this,h,u)},v.prototype.relu=function(){return this.throwIfDisposed(),yt.relu(this)},v.prototype.relu6=function(){return this.throwIfDisposed(),yt.relu6(this)},v.prototype.elu=function(){return this.throwIfDisposed(),yt.elu(this)},v.prototype.selu=function(){return this.throwIfDisposed(),yt.selu(this)},v.prototype.leakyRelu=function(h){return h===void 0&&(h=.2),this.throwIfDisposed(),yt.leakyRelu(this,h)},v.prototype.prelu=function(h){return this.throwIfDisposed(),yt.prelu(this,h)},v.prototype.sigmoid=function(){return this.throwIfDisposed(),yt.sigmoid(this)},v.prototype.logSigmoid=function(){return this.throwIfDisposed(),yt.logSigmoid(this)},v.prototype.softplus=function(){return this.throwIfDisposed(),yt.softplus(this)},v.prototype.zerosLike=function(){return this.throwIfDisposed(),yt.zerosLike(this)},v.prototype.onesLike=function(){return this.throwIfDisposed(),yt.onesLike(this)},v.prototype.sin=function(){return this.throwIfDisposed(),yt.sin(this)},v.prototype.cos=function(){return this.throwIfDisposed(),yt.cos(this)},v.prototype.tan=function(){return this.throwIfDisposed(),yt.tan(this)},v.prototype.asin=function(){return this.throwIfDisposed(),yt.asin(this)},v.prototype.acos=function(){return this.throwIfDisposed(),yt.acos(this)},v.prototype.atan=function(){return this.throwIfDisposed(),yt.atan(this)},v.prototype.sinh=function(){return this.throwIfDisposed(),yt.sinh(this)},v.prototype.cosh=function(){return this.throwIfDisposed(),yt.cosh(this)},v.prototype.tanh=function(){return this.throwIfDisposed(),yt.tanh(this)},v.prototype.asinh=function(){return this.throwIfDisposed(),yt.asinh(this)},v.prototype.acosh=function(){return this.throwIfDisposed(),yt.acosh(this)},v.prototype.atanh=function(){return this.throwIfDisposed(),yt.atanh(this)},v.prototype.erf=function(){return this.throwIfDisposed(),yt.erf(this)},v.prototype.round=function(){return this.throwIfDisposed(),yt.round(this)},v.prototype.step=function(h){return h===void 0&&(h=0),this.throwIfDisposed(),yt.step(this,h)},v.prototype.softmax=function(h){return h===void 0&&(h=-1),this.throwIfDisposed(),yt.softmax(this,h)},v.prototype.logSoftmax=function(h){return h===void 0&&(h=-1),this.throwIfDisposed(),yt.logSoftmax(this,h)},v.prototype.resizeBilinear=function(h,u){return u===void 0&&(u=!1),this.throwIfDisposed(),yt.image.resizeBilinear(this,h,u)},v.prototype.resizeNearestNeighbor=function(h,u){return u===void 0&&(u=!1),this.throwIfDisposed(),yt.image.resizeNearestNeighbor(this,h,u)},v.prototype.conv1d=function(h,u,d,y,D,W){return y===void 0&&(y="NWC"),D===void 0&&(D=1),this.throwIfDisposed(),yt.conv1d(this,h,u,d,y,D,W)},v.prototype.conv2d=function(h,u,d,y,D,W){return y===void 0&&(y="NHWC"),D===void 0&&(D=[1,1]),this.throwIfDisposed(),yt.conv2d(this,h,u,d,y,D,W)},v.prototype.conv2dTranspose=function(h,u,d,y,D){return this.throwIfDisposed(),yt.conv2dTranspose(this,h,u,d,y,D)},v.prototype.depthwiseConv2D=function(h,u,d,y,D,W){return y===void 0&&(y="NHWC"),D===void 0&&(D=[1,1]),this.throwIfDisposed(),yt.depthwiseConv2d(this,h,u,d,y,D,W)},v.prototype.separableConv2d=function(h,u,d,y,D,W){return D===void 0&&(D=[1,1]),W===void 0&&(W="NHWC"),this.throwIfDisposed(),yt.separableConv2d(this,h,u,d,y,D,W)},v.prototype.avgPool=function(h,u,d,y){return this.throwIfDisposed(),yt.avgPool(this,h,u,d,y)},v.prototype.maxPool=function(h,u,d,y){return this.throwIfDisposed(),yt.maxPool(this,h,u,d,y)},v.prototype.localResponseNormalization=function(h,u,d,y){return h===void 0&&(h=5),u===void 0&&(u=1),d===void 0&&(d=1),y===void 0&&(y=.5),yt.localResponseNormalization(this,h,u,d,y)},v.prototype.pool=function(h,u,d,y,D){return this.throwIfDisposed(),yt.pool(this,h,u,d,y,D)},v.prototype.variable=function(h,u,d){return h===void 0&&(h=!0),this.throwIfDisposed(),Ci().makeVariable(this,h,u,d)},v.prototype.unsortedSegmentSum=function(h,u){return this.throwIfDisposed(),yt.unsortedSegmentSum(this,h,u)},v.prototype.batchToSpaceND=function(h,u){return this.throwIfDisposed(),yt.batchToSpaceND(this,h,u)},v.prototype.spaceToBatchND=function(h,u){return this.throwIfDisposed(),yt.spaceToBatchND(this,h,u)},v.prototype.topk=function(h,u){return h===void 0&&(h=1),u===void 0&&(u=!0),this.throwIfDisposed(),yt.topk(this,h,u)},v.prototype.stridedSlice=function(h,u,d,y,D,W,X,ae){return y===void 0&&(y=0),D===void 0&&(D=0),W===void 0&&(W=0),X===void 0&&(X=0),ae===void 0&&(ae=0),this.throwIfDisposed(),yt.stridedSlice(this,h,u,d,y,D,W,X,ae)},v.prototype.depthToSpace=function(h,u){return this.throwIfDisposed(),yt.depthToSpace(this,h,u)},v.prototype.fft=function(){return this.throwIfDisposed(),yt.spectral.fft(this)},v.prototype.ifft=function(){return this.throwIfDisposed(),yt.spectral.ifft(this)},v.prototype.rfft=function(){return this.throwIfDisposed(),yt.spectral.rfft(this)},v.prototype.irfft=function(){return this.throwIfDisposed(),yt.spectral.irfft(this)},v}();Object.defineProperty(jt,Symbol.hasInstance,{value:function(v){return!!v&&v.dataId!=null&&v.shape!=null&&v.dtype!=null}});var ge,fe,ye,Se,Ze,mt=function(v){function h(u,d,y,D){var W=v.call(this,u.shape,u.dtype,u.dataId,D)||this;return W.trainable=d,W.name=y,W}return J(h,v),h.prototype.assign=function(u){if(u.dtype!==this.dtype)throw new Error("dtype of the new value ("+u.dtype+") and previous value ("+this.dtype+") must match");if(!ln(u.shape,this.shape))throw new Error("shape of the new value ("+u.shape+") and previous value ("+this.shape+") must match");Ci().disposeTensor(this),this.dataId=u.dataId,Ci().incRef(this,null)},h.prototype.dispose=function(){Ci().disposeVariable(this),this.isDisposedInternal=!0},h}(jt);Object.defineProperty(mt,Symbol.hasInstance,{value:function(v){return v instanceof jt&&v.assign!=null&&v.assign instanceof Function}}),function(v){v.R0="R0",v.R1="R1",v.R2="R2",v.R3="R3",v.R4="R4",v.R5="R5",v.R6="R6"}(ge||(ge={})),function(v){v.float32="float32",v.int32="int32",v.bool="int32",v.complex64="complex64"}(fe||(fe={})),function(v){v.float32="float32",v.int32="int32",v.bool="bool",v.complex64="complex64"}(ye||(ye={})),function(v){v.float32="float32",v.int32="float32",v.bool="float32",v.complex64="complex64"}(Se||(Se={})),function(v){v.float32="complex64",v.int32="complex64",v.bool="complex64",v.complex64="complex64"}(Ze||(Ze={}));var Rt={float32:Se,int32:fe,bool:ye,complex64:Ze};function cn(v,h){if(v==="string"||h==="string"){if(v==="string"&&h==="string")return"string";throw new Error("Can not upcast "+v+" with "+h)}return Rt[v][h]}function Jn(v){return cn(v,"int32")}function An(v,h){if(v.dtype===h.dtype)return[v,h];var u=cn(v.dtype,h.dtype);return[v.cast(u),h.cast(u)]}function Ln(v,h){we(v.dtype===h.dtype,function(){return"The dtypes of the first("+v.dtype+") and second("+h.dtype+") input must match"})}function Hn(v){var h=[];return function u(d,y,D){if(d!=null){if(d instanceof jt)y.push(d);else if(W=d,Array.isArray(W)||typeof W=="object"){var W,X=d;for(var ae in X){var de=X[ae];D.has(de)||(D.add(de),u(de,y,D))}}}}(v,h,new Set),h}var It,Ot=Object.freeze({makeTypesMatch:An,assertTypesMatch:Ln,isTensorInList:function(v,h){return h.some(function(u){return u.id===v.id})},getTensorsInContainer:Hn}),pn=function(){function v(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return v.prototype.dispose=function(){for(var h in this.registeredVariables)this.registeredVariables[h].dispose()},v}(),qt=function(){function v(h){this.ENV=h,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new pn}return v.prototype.ready=function(){return R(this,void 0,void 0,function(){var h,u,d;return P(this,function(y){switch(y.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];h=this.getSortedBackends(),u=0,y.label=1;case 1:return u<h.length?(d=h[u],[4,this.initializeBackend(d).success]):[3,5];case 2:return y.sent()?[4,this.setBackend(d)]:[3,4];case 3:return y.sent(),[2];case 4:return u++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(v.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var h=this.initializeBackendsAndReturnBest(),u=h.name;if(h.asyncInit)throw new Error("The highest priority backend '"+u+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(u)}return this.backendInstance},enumerable:!0,configurable:!0}),v.prototype.backendNames=function(){return Object.keys(this.registryFactory)},v.prototype.findBackend=function(h){return!(h in this.registry)&&(!(h in this.registryFactory)||this.initializeBackend(h).asyncInit)?null:this.registry[h]},v.prototype.findBackendFactory=function(h){return h in this.registryFactory?this.registryFactory[h].factory:null},v.prototype.registerBackend=function(h,u,d){return d===void 0&&(d=1),h in this.registryFactory?(console.warn(h+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[h]={factory:u,priority:d},!0)},v.prototype.setBackend=function(h){return R(this,void 0,void 0,function(){var u,d,y;return P(this,function(D){switch(D.label){case 0:if(this.registryFactory[h]==null)throw new Error("Backend name '"+h+"' not found in registry");return this.backendName=h,this.registry[h]!=null?[3,4]:(this.backendInstance=null,u=this.initializeBackend(h),d=u.success,u.asyncInit?[4,d]:[3,2]);case 1:return y=D.sent(),[3,3];case 2:y=d,D.label=3;case 3:if(!y)return[2,!1];D.label=4;case 4:return this.backendInstance=this.registry[h],this.setupRegisteredKernels(),this.profiler=new ni(this.backendInstance),[2,!0]}})})},v.prototype.setupRegisteredKernels=function(){var h=this;he(this.backendName).forEach(function(u){u.setupFunc!=null&&u.setupFunc(h.backendInstance)})},v.prototype.disposeRegisteredKernels=function(h){var u=this;he(h).forEach(function(d){d.disposeFunc!=null&&d.disposeFunc(u.registry[h])})},v.prototype.initializeBackend=function(h){var u=this,d=this.registryFactory[h];if(d==null)throw new Error("Cannot initialize backend "+h+", no registration found.");try{var y=d.factory();if(Promise.resolve(y)===y){var D=++this.pendingBackendInitId,W=y.then(function(X){return!(D<u.pendingBackendInitId||(u.registry[h]=X,u.pendingBackendInit=null,0))}).catch(function(X){return!(D<u.pendingBackendInitId||(u.pendingBackendInit=null,console.warn("Initialization of backend "+h+" failed"),console.warn(X.stack||X.message),1))});return this.pendingBackendInit=W,{success:W,asyncInit:!0}}return this.registry[h]=y,{success:!0,asyncInit:!1}}catch(X){return console.warn("Initialization of backend "+h+" failed"),console.warn(X.stack||X.message),{success:!1,asyncInit:!1}}},v.prototype.removeBackend=function(h){if(!(h in this.registryFactory))throw new Error(h+" backend not found in registry");this.backendName===h&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,h in this.registry&&(this.disposeRegisteredKernels(h),this.registry[h].dispose(),delete this.registry[h]),delete this.registryFactory[h],this.backendName===h&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},v.prototype.getSortedBackends=function(){var h=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(u,d){return h.registryFactory[d].priority-h.registryFactory[u].priority})},v.prototype.initializeBackendsAndReturnBest=function(){for(var h=this.getSortedBackends(),u=0;u<h.length;u++){var d=h[u],y=this.initializeBackend(d),D=y.success,W=y.asyncInit;if(W||D)return{name:d,asyncInit:W}}throw new Error("Could not initialize any backends, all backend initializations failed.")},v.prototype.moveData=function(h,u){var d=this.state.tensorInfo.get(u),y=d.backend,D=this.readSync(u);y.disposeData(u),d.backend=h,h.move(u,D,d.shape,d.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},v.prototype.tidy=function(h,u){var d,y=this,D=null;if(u==null){if(typeof h!="function")throw new Error("Please provide a function to tidy()");u=h}else{if(typeof h!="string"&&!(h instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof u!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");D=h}return this.scopedRun(function(){return y.startScope(D)},function(){return y.endScope(d)},function(){return(d=u())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),d})},v.prototype.scopedRun=function(h,u,d){h();try{var y=d();return u(),y}catch(D){throw u(),D}},v.prototype.nextTensorId=function(){return v.nextTensorId++},v.prototype.nextVariableId=function(){return v.nextVariableId++},v.prototype.clone=function(h){var u=this.makeTensorFromDataId(h.dataId,h.shape,h.dtype),d={x:h};return this.addTapeNode(this.state.activeScope.name,d,[u],function(y){return{x:function(){return y.toFloat()}}},[]),u},v.prototype.runKernel=function(h,u,d,y,D){return this.runKernelFunc(null,u,null,h,d,y,D)},v.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},v.prototype.checkKernelForMemLeak=function(h,u,d){var y=this.backend.numDataIds(),D=0;d.forEach(function(ae){D+=ae.dtype==="complex64"?3:1});var W=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],X=y-u-D-W;if(X>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+X+" data ids) after running '"+h+"'")},v.prototype.runKernelFunc=function(h,u,d,y,D,W,X){var ae,de=this;W===void 0&&(W=[]),X===void 0&&(X=[]);var be=[],Ie=this.isTapeOn();y==null&&(y=this.state.activeScope!=null?this.state.activeScope.name:"");var Re,Me=function(vt){Ie&&(be=vt.map(function(bt){return de.keep(de.clone(bt))}))},qe=this.state.numBytes,Je=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var Qe,ot=ie(y,this.backendName);return Re=ot!=null?function(){var vt=de.backend.numDataIds();Qe=ot.kernelFunc({inputs:u,attrs:D,backend:de.backend});var bt=Array.isArray(Qe)?Qe:[Qe];de.shouldCheckForMemLeaks()&&de.checkKernelForMemLeak(y,vt,bt);var wt=bt.map(function(Yt){var an=Yt.dataId,Jt=Yt.shape,un=Yt.dtype;return de.makeTensorFromDataId(an,Jt,un)}),Ft=wt.filter(function(Yt,an){return X[an]});return Me((W||[]).slice().concat(Ft)),wt}:function(){var vt=de.backend.numDataIds();Qe=de.tidy(function(){return h(de.backend,Me)});var bt=Array.isArray(Qe)?Qe:[Qe];return de.shouldCheckForMemLeaks()&&de.checkKernelForMemLeak(y,vt,bt),bt},this.scopedRun(function(){return de.state.kernelDepth++},function(){return de.state.kernelDepth--},function(){ae=de.ENV.getBool("DEBUG")?de.profiler.profileKernel(y,u,function(){return Re()}):Re()}),Ie&&this.addTapeNode(y,u,ae,d,be),this.state.profiling&&this.state.activeProfile.kernels.push({name:y,bytesAdded:this.state.numBytes-qe,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-Je,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(u).map(function(vt){return u[vt].shape}),outputShapes:ae.map(function(vt){return vt.shape})}),Array.isArray(Qe)?ae:ae[0]},v.prototype.makeTensor=function(h,u,d,y){if(h==null)throw new Error("Values passed to engine.makeTensor() are null");d=d||"float32",y=y||this.backend;var D=h;d==="string"&&Sn(h[0])&&(D=h.map(function(be){return Dn(be)}));var W=y.write(D,u,d),X=new jt(u,d,W,this.nextTensorId());if(this.incRef(X,y),d==="string"){var ae=this.state.tensorInfo.get(W),de=rn(D);this.state.numBytes+=de-ae.bytes,ae.bytes=de}return X},v.prototype.makeTensorFromDataId=function(h,u,d,y){var D=new jt(u,d=d||"float32",h,this.nextTensorId());return this.incRef(D,y),D},v.prototype.makeVariable=function(h,u,d,y){u===void 0&&(u=!0),d=d||this.nextVariableId().toString(),y!=null&&y!==h.dtype&&(h=h.asType(y));var D=new mt(h,u,d,this.nextTensorId());if(this.state.registeredVariables[D.name]!=null)throw new Error("Variable with name "+D.name+" was already registered");return this.state.registeredVariables[D.name]=D,this.incRef(D,this.backend),D},v.prototype.incRef=function(h,u){var d=this.state.tensorInfo.has(h.dataId)?this.state.tensorInfo.get(h.dataId).refCount:0;if(this.state.numTensors++,h.dtype==="string"&&this.state.numStringTensors++,d===0){this.state.numDataBuffers++;var y=0;h.dtype!=="complex64"&&h.dtype!=="string"&&(y=h.size*Lt(h.dtype)),this.state.tensorInfo.set(h.dataId,{backend:u||this.backend,dtype:h.dtype,shape:h.shape,bytes:y,refCount:0}),this.state.numBytes+=y}this.state.tensorInfo.get(h.dataId).refCount++,h instanceof mt||this.track(h)},v.prototype.disposeTensor=function(h){if(this.state.tensorInfo.has(h.dataId)){this.state.numTensors--,h.dtype==="string"&&this.state.numStringTensors--;var u=this.state.tensorInfo.get(h.dataId);u.refCount<=1?(h.dtype!=="complex64"&&(this.state.numBytes-=u.bytes),this.state.numDataBuffers--,u.backend.disposeData(h.dataId),this.state.tensorInfo.delete(h.dataId)):this.state.tensorInfo.get(h.dataId).refCount--}},v.prototype.disposeVariables=function(){for(var h in this.state.registeredVariables){var u=this.state.registeredVariables[h];this.disposeVariable(u)}},v.prototype.disposeVariable=function(h){this.disposeTensor(h),this.state.registeredVariables[h.name]!=null&&delete this.state.registeredVariables[h.name]},v.prototype.memory=function(){var h=this.backend.memory();return h.numTensors=this.state.numTensors,h.numDataBuffers=this.state.numDataBuffers,h.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(h.unreliable=!0,h.reasons==null&&(h.reasons=[]),h.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),h},v.prototype.profile=function(h){return R(this,void 0,void 0,function(){var u,d;return P(this,function(y){return this.state.profiling=!0,u=this.state.numBytes,d=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=h(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(D){return D.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-u,this.state.activeProfile.newTensors=this.state.numTensors-d,[2,this.state.activeProfile]})})},v.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},v.prototype.addTapeNode=function(h,u,d,y,D){var W=this,X={id:this.state.nextTapeNodeId++,kernelName:h,inputs:u,outputs:d,saved:D},ae=K(h);ae!=null&&(y=ae.gradFunc),y!=null&&(X.gradient=function(de){return de=de.map(function(be,Ie){if(be==null){var Re=d[Ie],Me=Xt(Re.size,Re.dtype);return W.makeTensor(Me,Re.shape,Re.dtype)}return be}),y(de.length>1?de:de[0],D)}),this.state.activeTape.push(X)},v.prototype.keep=function(h){return h.kept=!0,h},v.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},v.prototype.endTape=function(){this.state.gradientDepth--},v.prototype.startScope=function(h){var u={track:[],name:"unnamed scope",id:this.state.nextScopeId++};h&&(u.name=h),this.state.scopeStack.push(u),this.state.activeScope=u},v.prototype.endScope=function(h){for(var u=this,d=Hn(h),y=new Set(d.map(function(ae){return ae.id})),D=0;D<this.state.activeScope.track.length;D++){var W=this.state.activeScope.track[D];W.kept||y.has(W.id)||W.dispose()}var X=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],d.forEach(function(ae){ae.kept||ae.scopeId!==X.id||u.track(ae)})},v.prototype.gradients=function(h,u,d,y){var D=this;if(y===void 0&&(y=!1),we(u.length>0,function(){return"gradients() received an empty list of xs."}),d!=null&&d.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '"+d.dtype+"'");var W=this.scopedRun(function(){return D.startTape()},function(){return D.endTape()},function(){return D.tidy("forward",h)});we(W instanceof jt,function(){return"The result y returned by f() must be a tensor."});var X=function(ae,de,be){for(var Ie={},Re={},Me=0;Me<de.length;Me++)Ie[de[Me].id]=!0;for(Me=0;Me<ae.length;Me++){var qe=(Yt=ae[Me]).inputs;for(var Je in qe){for(var Qe=qe[Je],ot=!1,vt=0;vt<de.length;vt++)if(Ie[Qe.id]){Yt.outputs.forEach(function(gn){return Ie[gn.id]=!0}),ot=!0,Re[Yt.id]=!0;break}if(ot)break}}var bt={};bt[be.id]=!0;var wt={};for(Me=ae.length-1;Me>=0;Me--)for(qe=(Yt=ae[Me]).inputs,vt=0;vt<Yt.outputs.length;vt++)if(bt[Yt.outputs[vt].id]){for(var Je in qe)bt[qe[Je].id]=!0,wt[Yt.id]=!0;break}var Ft=[];for(Me=0;Me<ae.length;Me++){var Yt;if(Re[(Yt=ae[Me]).id]&&wt[Yt.id]){var an={};for(var Je in Yt.inputs){var Jt=Yt.inputs[Je];Ie[Jt.id]&&(an[Je]=Jt)}var un=Object.assign({},Yt);un.inputs=an,un.outputs=Yt.outputs,Ft.push(un)}}return Ft}(this.state.activeTape,u,W);if(!y&&X.length===0&&u.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var ae,de,be={};be[W.id]=d??(de=hn(Ye(ae=W.shape),"float32"),Ve.makeTensor(de,ae,"float32")),function(Re,Me,qe){for(var Je=function(ot){var vt=Me[ot],bt=[];if(vt.outputs.forEach(function(an){var Jt=Re[an.id];Jt!=null?bt.push(Jt):bt.push(null)}),vt.gradient==null)throw new Error("Cannot compute gradient: gradient function not found for "+vt.kernelName+".");var wt=vt.gradient(bt),Ft=function(an){if(!(an in wt))throw new Error("Cannot backprop through input "+an+". Available gradients found: "+Object.keys(wt)+".");var Jt=qe(function(){return wt[an]()});if(Jt.dtype!=="float32")throw new Error("Error in gradient for op "+vt.kernelName+". The gradient of input "+an+" must have 'float32' dtype, but has '"+Jt.dtype+"'");var un=vt.inputs[an];if(!ln(Jt.shape,un.shape))throw new Error("Error in gradient for op "+vt.kernelName+". The gradient of input '"+an+"' has shape '"+Jt.shape+"', which does not match the shape of the input '"+un.shape+"'");if(Re[un.id]==null)Re[un.id]=Jt;else{var gn=Re[un.id];Re[un.id]=gn.add(Jt),gn.dispose()}};for(var Yt in vt.inputs)Ft(Yt)},Qe=Me.length-1;Qe>=0;Qe--)Je(Qe)}(be,X,function(Re){return D.tidy(Re)});var Ie=u.map(function(Re){return be[Re.id]});return D.state.gradientDepth===0&&(D.state.activeTape.forEach(function(Re){for(var Me=0,qe=Re.saved;Me<qe.length;Me++)qe[Me].dispose()}),D.state.activeTape=null),{value:W,grads:Ie}})},v.prototype.customGrad=function(h){var u=this;return we(Xn(h),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var d,y=[],D=0;D<arguments.length;D++)y[D]=arguments[D];we(y.every(function(X){return X instanceof jt}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var W={};return y.forEach(function(X,ae){W[ae]=X}),u.runKernelFunc(function(X,ae){return we((d=h.apply(void 0,y.concat([ae]))).value instanceof jt,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),we(Xn(d.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),d.value},W,function(X,ae){var de=d.gradFunc(X,ae),be=Array.isArray(de)?de:[de];we(be.length===y.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),we(be.every(function(Re){return Re instanceof jt}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var Ie={};return be.forEach(function(Re,Me){Ie[Me]=function(){return Re}}),Ie})}},v.prototype.readSync=function(h){return this.state.tensorInfo.get(h).backend.readSync(h)},v.prototype.read=function(h){return this.state.tensorInfo.get(h).backend.read(h)},v.prototype.time=function(h){return R(this,void 0,void 0,function(){var u,d;return P(this,function(y){switch(y.label){case 0:return u=nn(),[4,this.backend.time(h)];case 1:return(d=y.sent()).wallMs=nn()-u,[2,d]}})})},v.prototype.track=function(h){return this.state.activeScope!=null&&(h.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(h)),h},Object.defineProperty(v.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),v.prototype.reset=function(){for(var h in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new pn,this.registry)this.disposeRegisteredKernels(h),this.registry[h].dispose(),delete this.registry[h];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},v.nextTensorId=0,v.nextVariableId=0,v}(),Ve=function(){var v=function(){if(It==null){var u=void 0;if(typeof window<"u")u=window;else if(b!==void 0)u=b;else if(H!==void 0)u=H;else{if(typeof self>"u")throw new Error("Could not find a global object");u=self}It=u}return It}();if(v._tfengine==null){var h=new $(v);v._tfengine=new qt(h)}return function(u){ee=u}(v._tfengine.ENV),Ci=function(){return v._tfengine},v._tfengine}();function jn(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var $n=L();$n.registerFlag("DEBUG",function(){return!1},function(v){v&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),$n.registerFlag("IS_BROWSER",function(){return jn()}),$n.registerFlag("IS_NODE",function(){return H!==void 0&&H.versions!==void 0&&H.versions.node!==void 0}),$n.registerFlag("IS_CHROME",function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}),$n.registerFlag("PROD",function(){return!1}),$n.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return $n.getBool("DEBUG")}),$n.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0}),$n.registerFlag("IS_TEST",function(){return!1});var Zn,ir,zr,vr={},pi={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function la(v,h){vr[v]=h}function ui(v){v in vr||(vr[v]=function(u){if(u!==1&&u!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var d=function(y){if(typeof OffscreenCanvas<"u"&&y===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(u);return d.addEventListener("webglcontextlost",function(y){y.preventDefault(),delete vr[u]},!1),u===1?d.getContext("webgl",pi)||d.getContext("experimental-webgl",pi):d.getContext("webgl2",pi)}(v));var h=vr[v];return h.isContextLost()?(delete vr[v],ui(v)):(h.disable(h.DEPTH_TEST),h.disable(h.STENCIL_TEST),h.disable(h.BLEND),h.disable(h.DITHER),h.disable(h.POLYGON_OFFSET_FILL),h.disable(h.SAMPLE_COVERAGE),h.enable(h.SCISSOR_TEST),h.enable(h.CULL_FACE),h.cullFace(h.BACK),vr[v])}function Qi(v,h){return[h,v]}function Di(v){var h=Ye(v);return Mt(Math.ceil(h/4))}function qr(v,h){return[Math.max(1,Math.ceil(h/2)),Math.max(1,Math.ceil(v/2))]}function jr(v,h){var u,d,y,D,W,X,ae,de,be,Ie=v;return L().getNumber("WEBGL_VERSION")===2?(u=Ie.R32F,d=Ie.R16F,y=Ie.RGBA16F,D=Ie.RGBA32F,W=Ie.RED,X=4,ae=1,de=Ie.HALF_FLOAT,be=Ie.FLOAT):(u=v.RGBA,d=v.RGBA,y=v.RGBA,D=Ie.RGBA,W=v.RGBA,X=4,ae=4,de=h!=null?h.HALF_FLOAT_OES:null,be=v.FLOAT),{internalFormatFloat:u,internalFormatHalfFloat:d,internalFormatPackedHalfFloat:y,internalFormatPackedFloat:D,textureFormatFloat:W,downloadTextureFormat:v.RGBA,downloadUnpackNumChannels:X,defaultNumChannels:ae,textureTypeHalfFloat:de,textureTypeFloat:be}}function Bn(v,h,u){var d=u();return h&&function(y){var D=y.getError();if(D!==y.NO_ERROR)throw new Error("WebGL Error: "+aa(y,D))}(v),d}(function(v){v[v.DENSE=0]="DENSE",v[v.SHARED_BATCH=1]="SHARED_BATCH"})(Zn||(Zn={})),function(v){v[v.RENDER=0]="RENDER",v[v.UPLOAD=1]="UPLOAD",v[v.PIXELS=2]="PIXELS",v[v.DOWNLOAD=3]="DOWNLOAD"}(ir||(ir={})),function(v){v[v.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",v[v.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",v[v.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",v[v.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",v[v.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(zr||(zr={}));var ri=596e-10,Vi=65504;function Fr(v){return!!(L().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||v===0||ri<Math.abs(v)&&Math.abs(v)<Vi)}function aa(v,h){switch(h){case v.NO_ERROR:return"NO_ERROR";case v.INVALID_ENUM:return"INVALID_ENUM";case v.INVALID_VALUE:return"INVALID_VALUE";case v.INVALID_OPERATION:return"INVALID_OPERATION";case v.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case v.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case v.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+h}}function ma(v,h,u){return so(v,h,function(){return v.getExtension(u)},'Extension "'+u+'" not supported on this browser.')}function Zi(v,h,u){var d=so(v,h,function(){return v.createShader(v.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(Bn(v,h,function(){return v.shaderSource(d,u)}),Bn(v,h,function(){return v.compileShader(d)}),v.getShaderParameter(d,v.COMPILE_STATUS)===!1)throw console.log(v.getShaderInfoLog(d)),new Error("Failed to compile vertex shader.");return d}function ga(v,h,u){var d=so(v,h,function(){return v.createShader(v.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(Bn(v,h,function(){return v.shaderSource(d,u)}),Bn(v,h,function(){return v.compileShader(d)}),v.getShaderParameter(d,v.COMPILE_STATUS)===!1)throw function(y,D){var W=Eh.exec(D);if(W==null)return console.log("Couldn't parse line number in error: "+D),void console.log(y);for(var X=+W[1],ae=y.split(`
`),de=ae.length.toString().length+2,be=ae.map(function(Qe,ot){return bn((ot+1).toString(),de)+Qe}),Ie=0,Re=0;Re<be.length;Re++)Ie=Math.max(be[Re].length,Ie);var Me=be.slice(0,X-1),qe=be.slice(X-1,X),Je=be.slice(X);console.log(Me.join(`
`)),console.log(D.split(`
`)[0]),console.log("%c "+bn(qe[0],Ie),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(Je.join(`
`))}(u,v.getShaderInfoLog(d)),new Error("Failed to compile fragment shader.");return d}var No,vs,Eh=/ERROR: [0-9]+:([0-9]+):/g;function qi(v,h){return so(v,h,function(){return v.createProgram()},"Unable to create WebGLProgram.")}function ec(v,h,u){if(Bn(v,h,function(){return v.linkProgram(u)}),v.getProgramParameter(u,v.LINK_STATUS)===!1)throw console.log(v.getProgramInfoLog(u)),new Error("Failed to link vertex and fragment shaders.")}function bu(v,h,u){if(Bn(v,h,function(){return v.validateProgram(u)}),v.getProgramParameter(u,v.VALIDATE_STATUS)===!1)throw console.log(v.getProgramInfoLog(u)),new Error("Shader program validation failed.")}function bc(v,h,u){var d=so(v,h,function(){return v.createBuffer()},"Unable to create WebGLBuffer");return Bn(v,h,function(){return v.bindBuffer(v.ARRAY_BUFFER,d)}),Bn(v,h,function(){return v.bufferData(v.ARRAY_BUFFER,u,v.STATIC_DRAW)}),d}function Bu(v,h,u){var d=so(v,h,function(){return v.createBuffer()},"Unable to create WebGLBuffer");return Bn(v,h,function(){return v.bindBuffer(v.ELEMENT_ARRAY_BUFFER,d)}),Bn(v,h,function(){return v.bufferData(v.ELEMENT_ARRAY_BUFFER,u,v.STATIC_DRAW)}),d}function xc(v,h){return so(v,h,function(){return v.createTexture()},"Unable to create WebGLTexture.")}function Dd(v,h){var u=L().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(v<=0||h<=0){var d="["+v+"x"+h+"]";throw new Error("Requested texture size "+d+" is invalid.")}if(v>u||h>u)throw d="["+v+"x"+h+"]",new Error("Requested texture size "+d+" greater than WebGL maximum on this browser / GPU ["+u+"x"+u+"].")}function os(v,h){return so(v,h,function(){return v.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function vf(v,h,u,d,y,D,W,X){var ae=v.getAttribLocation(u,d);return ae!==-1&&(Bn(v,h,function(){return v.bindBuffer(v.ARRAY_BUFFER,y)}),Bn(v,h,function(){return v.vertexAttribPointer(ae,D,v.FLOAT,!1,W,X)}),Bn(v,h,function(){return v.enableVertexAttribArray(ae)}),!0)}function Td(v,h,u,d){tc(v,d),Bn(v,h,function(){return v.activeTexture(v.TEXTURE0+d)}),Bn(v,h,function(){return v.bindTexture(v.TEXTURE_2D,u)})}function Pu(v,h,u,d){return so(v,h,function(){return v.getUniformLocation(u,d)},'uniform "'+d+'" not present in program.')}function yf(v,h,u){return v.getUniformLocation(h,u)}function Ch(v,h,u,d,y,D){Bn(v,h,function(){return Td(v,h,d,D)}),Bn(v,h,function(){return v.uniform1i(y,D)})}function wc(v,h,u,d){Bn(v,h,function(){return v.bindFramebuffer(v.FRAMEBUFFER,d)}),Bn(v,h,function(){return v.framebufferTexture2D(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0,v.TEXTURE_2D,u,0)})}function El(v,h,u){Bn(v,h,function(){return v.bindFramebuffer(v.FRAMEBUFFER,u)}),Bn(v,h,function(){return v.framebufferTexture2D(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0,v.TEXTURE_2D,null,0)})}function Io(v){var h=v.checkFramebufferStatus(v.FRAMEBUFFER);if(h!==v.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+Vc(v,h))}function Vc(v,h){switch(h){case v.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case v.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case v.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case v.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+h}}function so(v,h,u,d){var y=Bn(v,h,function(){return u()});if(y==null)throw new Error(d);return y}function tc(v,h){var u=v.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,d=h+v.TEXTURE0;if(d<v.TEXTURE0||d>u)throw new Error("textureUnit must be in [gl.TEXTURE0, gl.TEXTURE"+u+"].")}function ss(v,h){return h===void 0&&(h=2),Ye(v.slice(0,v.length-h))}function Eo(v){if(v.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[v.length>1?v[v.length-2]:1,v[v.length-1]]}function nc(v){var h=[1,1,1];return v.length===0||v.length===1&&v[0]===1||(h=[ss(v)].concat(Eo(v))),h}function Cl(v,h){var u;h===void 0&&(h=!1);var d=L().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(h&&(d*=2,(v=v.map(function(de,be){return be>=v.length-2?zt(v[be]):v[be]})).length===1&&(v=[2,v[0]])),v.length!==2){var y=In(v);v=y.newShape}var D=Ye(v);if(v.length<=1&&D<=d)return[1,D];if(v.length===2&&v[0]<=d&&v[1]<=d)return v;if(v.length===3&&v[0]*v[1]<=d&&v[2]<=d)return[v[0]*v[1],v[2]];if(v.length===3&&v[0]<=d&&v[1]*v[2]<=d)return[v[0],v[1]*v[2]];if(v.length===4&&v[0]*v[1]*v[2]<=d&&v[3]<=d)return[v[0]*v[1]*v[2],v[3]];if(v.length===4&&v[0]<=d&&v[1]*v[2]*v[3]<=d)return[v[0],v[1]*v[2]*v[3]];if(h){var W=ss(v),X=2,ae=2;return v.length&&(X=(u=Eo(v))[0],ae=u[1]),Mt(D=W*(X/2)*(ae/2)).map(function(de){return 2*de})}return Mt(D)}function rc(v){return v%2==0}function su(v,h){if(ln(v=v.slice(-2),h=h.slice(-2))||!v.length||!h.length||v[0]===0||v[1]===0||h[0]===0||h[1]===0)return!0;if(v.length!==h.length){var u=v.slice(-1)[0],d=h.slice(-1)[0];if(u===d||rc(u)&&rc(d)&&(v[0]===1||h[0]===1))return!0}return v[1]===h[1]&&rc(v[0])&&rc(h[0])}function Oh(v){if(No==null){var h=ui(v);No=h.getParameter(h.MAX_TEXTURE_SIZE)}return No}function bf(v){if(vs==null){var h=ui(v);vs=h.getParameter(h.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,vs)}function xf(v){if(v===0)return 0;var h=ui(v);return lo(h,"EXT_disjoint_timer_query_webgl2")&&v===2?2:lo(h,"EXT_disjoint_timer_query")?1:0}function lo(v,h){return v.getExtension(h)!=null}function Ah(v){try{if(ui(v)!=null)return!0}catch{return!1}return!1}function Nd(v){if(v===0)return!1;var h=ui(v);if(v===1){if(!lo(h,"OES_texture_float"))return!1}else if(!lo(h,"EXT_color_buffer_float"))return!1;return kf(h)}function wf(v){if(v===0)return!1;var h=ui(v);return v!==1?lo(h,"EXT_color_buffer_float")?kf(h):!!lo(h,"EXT_color_buffer_half_float")&&function(u,d){var y=jr(u,d),D=u.createTexture();u.bindTexture(u.TEXTURE_2D,D),u.texImage2D(u.TEXTURE_2D,0,y.internalFormatHalfFloat,1,1,0,y.textureFormatFloat,y.textureTypeHalfFloat,null);var W=u.createFramebuffer();u.bindFramebuffer(u.FRAMEBUFFER,W),u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,D,0);var X=u.checkFramebufferStatus(u.FRAMEBUFFER)===u.FRAMEBUFFER_COMPLETE;return u.bindTexture(u.TEXTURE_2D,null),u.bindFramebuffer(u.FRAMEBUFFER,null),u.deleteTexture(D),u.deleteFramebuffer(W),X}(h,h.getExtension("EXT_color_buffer_half_float")):!!lo(h,"OES_texture_float")&&!!lo(h,"WEBGL_color_buffer_float")&&kf(h)}function kf(v){var h=jr(v),u=v.createTexture();v.bindTexture(v.TEXTURE_2D,u),v.texImage2D(v.TEXTURE_2D,0,h.internalFormatFloat,1,1,0,h.textureFormatFloat,h.textureTypeFloat,null);var d=v.createFramebuffer();v.bindFramebuffer(v.FRAMEBUFFER,d),v.framebufferTexture2D(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0,v.TEXTURE_2D,u,0);var y=v.checkFramebufferStatus(v.FRAMEBUFFER)===v.FRAMEBUFFER_COMPLETE;return v.bindTexture(v.TEXTURE_2D,null),v.bindFramebuffer(v.FRAMEBUFFER,null),v.deleteTexture(u),v.deleteFramebuffer(d),y}function ys(v){return v===2&&ui(v).fenceSync!=null}var Ef=Object.freeze({callAndCheck:Bn,canBeRepresented:Fr,getWebGLErrorMessage:aa,getExtensionOrThrow:ma,createVertexShader:Zi,createFragmentShader:ga,createProgram:qi,linkProgram:ec,validateProgram:bu,createStaticVertexBuffer:bc,createStaticIndexBuffer:Bu,getNumChannels:function(){return L().getNumber("WEBGL_VERSION")===2?1:4},createTexture:xc,validateTextureSize:Dd,createFramebuffer:os,bindVertexBufferToProgramAttribute:vf,bindTextureUnit:Td,unbindTextureUnit:function(v,h,u){tc(v,u),Bn(v,h,function(){return v.activeTexture(v.TEXTURE0+u)}),Bn(v,h,function(){return v.bindTexture(v.TEXTURE_2D,null)})},getProgramUniformLocationOrThrow:Pu,getProgramUniformLocation:yf,bindTextureToProgramUniformSampler:Ch,bindCanvasToFramebuffer:function(v,h){Bn(v,h,function(){return v.bindFramebuffer(v.FRAMEBUFFER,null)}),Bn(v,h,function(){return v.viewport(0,0,v.canvas.width,v.canvas.height)}),Bn(v,h,function(){return v.scissor(0,0,v.canvas.width,v.canvas.height)})},bindColorTextureToFramebuffer:wc,unbindColorTextureFromFramebuffer:El,validateFramebuffer:Io,getFramebufferErrorMessage:Vc,getBatchDim:ss,getRowsCols:Eo,getShapeAs3D:nc,getTextureShapeFromLogicalShape:Cl,isReshapeFree:su,getWebGLMaxTextureSize:Oh,resetMaxTextureSize:function(){No=null},resetMaxTexturesInShader:function(){vs=null},getMaxTexturesInShader:bf,getWebGLDisjointQueryTimerVersion:xf,hasExtension:lo,isWebGLVersionEnabled:Ah,isCapableOfRenderingToFloatTexture:Nd,isDownloadFloatTextureEnabled:wf,isWebGLFenceEnabled:ys}),or=L();function xu(){L().set("PROD",!0)}function Tp(){L().set("DEBUG",!0)}function Np(){L().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")}function Cf(v){L().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(v+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function Ol(){Ve.disposeVariables()}function Id(){return Ve}function _h(){return Ve.memory()}function Sh(v){return Ve.profile(v)}function Fi(v,h){return Ve.tidy(v,h)}function Na(v){Hn(v).forEach(function(h){return h.dispose()})}function Dh(v){return Ve.keep(v)}function bm(v){return Ve.time(v)}function Of(v){return Ve.setBackend(v)}function Fd(){return Ve.ready()}function bs(){return Ve.backendName}function ic(v){Ve.removeBackend(v)}function Rd(v){return Ve.findBackend(v)}function Ip(v){return Ve.findBackendFactory(v)}function Fp(v,h,u){return u===void 0&&(u=1),Ve.registerBackend(v,h,u)}function xm(){return Ve.backend}function wm(v,h){L().setPlatform(v,h)}function qc(){for(var v=[],h=0;h<arguments.length;h++)v[h]=arguments[h];L().getBool("IS_TEST")||console.warn.apply(console,v)}function zo(v,h){var u=v;if(Et(v))return h==="string"?[]:[v.length];if(!Array.isArray(v))return[];for(var d=[];Array.isArray(u)||Et(u)&&h!=="string";)d.push(u.length),u=u[0];return Array.isArray(v)&&L().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function y(D,W,X){if(X=X||[],Array.isArray(D)||Et(D)){we(W.length>0,function(){return"Element arr["+X.join("][")+"] should be a primitive, but is an array of "+D.length+" elements"}),we(D.length===W[0],function(){return"Element arr["+X.join("][")+"] should have "+W[0]+" elements, but has "+D.length+" elements"});for(var ae=W.slice(1),de=0;de<D.length;++de)y(D[de],ae,X.concat(de))}else we(W.length===0,function(){return"Element arr["+X.join("][")+"] is a primitive, but should be an array/TypedArray of "+W[0]+" elements"})}(v,d,[]),d}function Th(v,h,u,d){if(v!=null&&(v!=="numeric"&&v!==h||v==="numeric"&&h==="string"))throw new Error("Argument '"+u+"' passed to '"+d+"' must be "+v+" tensor, but got "+h+" tensor")}function Ke(v,h,u,d){if(d===void 0&&(d="numeric"),v instanceof jt)return Th(d,v.dtype,h,u),v;var y=xe(v);if(y!=="string"&&["bool","int32","float32"].indexOf(d)>=0&&(y=d),Th(d,y,h,u),v==null||!Et(v)&&!Array.isArray(v)&&typeof v!="number"&&typeof v!="boolean"&&typeof v!="string"){var D=v==null?"null":v.constructor.name;throw new Error("Argument '"+h+"' passed to '"+u+"' must be a Tensor or TensorLike, but got '"+D+"'")}var W=zo(v,y);Et(v)||Array.isArray(v)||(v=[v]);var X=y!=="string"?dr(v,y,L().getBool("DEBUG")):Pt(v,[],!0);return Ve.makeTensor(X,W,y)}function Lu(v,h,u,d){if(d===void 0&&(d="numeric"),!Array.isArray(v))throw new Error("Argument "+h+" passed to "+u+" must be a `Tensor[]` or `TensorLike[]`");return v.map(function(y,D){return Ke(y,h+"["+D+"]",u)},d)}function Af(v,h){for(var u=0;u<v.length;++u)if(v[v.length-u-1]!==h-1-u)return!1;return!0}function Md(v,h,u){for(var d=v.length+h.length,y=[],D=0,W=0,X=0;X<d;X++)u.indexOf(X)===-1?y.push(v[D++]):y.push(h[W++]);return y}function Aa(v,h){for(var u=[],d=v.length,y=0;y<d;y++)h.indexOf(y)===-1&&u.push(v[y]);return[u,h.map(function(D){return v[D]})]}function _a(v,h){return Md(v,h.map(function(u){return 1}),h)}function Ga(v,h,u){we(Af(h,u),function(){return v+" supports only inner-most axes for now. Got axes "+h+" and rank-"+u+" input."})}function Co(v,h){if(Af(v,h))return null;for(var u=[],d=0;d<h;++d)v.indexOf(d)===-1&&u.push(d);return v.forEach(function(y){return u.push(y)}),u}function wu(v){return v.map(function(h,u){return[u,h]}).sort(function(h,u){return h[1]-u[1]}).map(function(h){return h[0]})}function Oo(v,h){for(var u=[],d=h-v;d<h;++d)u.push(d);return u}function kc(v,h){var u=v[0].length;v.forEach(function(y,D){we(y.length===u,function(){return"Error in concat"+u+"D: rank of tensors["+D+"] must be the same as the rank of the rest ("+u+")"})}),we(h>=0&&h<u,function(){return"Error in concat"+u+"D: axis must be between 0 and "+(u-1)+"."});var d=v[0];v.forEach(function(y,D){for(var W=0;W<u;W++)we(W===h||y[W]===d[W],function(){return"Error in concat"+u+"D: Shape of tensors["+D+"] ("+y+") does not match the shape of the rest ("+d+") along the non-concatenated axis "+D+"."})})}function Zs(v,h){for(var u=v[0].slice(),d=1;d<v.length;d++)u[h]+=v[d][h];return u}function xt(v){var h=Object.keys(v);if(h.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+h.length+" keys.");var u=h[0],d=v[u];u.endsWith("_")&&(u=u.substring(0,u.length-1));var y=function(){for(var D=[],W=0;W<arguments.length;W++)D[W]=arguments[W];Ve.startScope(u);try{var X=d.apply(void 0,D);return X instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),Ve.endScope(X),X}catch(ae){throw Ve.endScope(null),ae}};return Object.defineProperty(y,"name",{value:u,configurable:!0}),y}or.registerFlag("HAS_WEBGL",function(){return or.getNumber("WEBGL_VERSION")>0}),or.registerFlag("WEBGL_VERSION",function(){return Ah(2)?2:Ah(1)?1:0}),or.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return or.get("WEBGL_VERSION")===2}),or.registerFlag("WEBGL_CPU_FORWARD",function(){return!0}),or.registerFlag("WEBGL_FORCE_F16_TEXTURES",function(){return!1}),or.registerFlag("WEBGL_PACK",function(){return or.getBool("HAS_WEBGL")}),or.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return or.getBool("WEBGL_PACK")}),or.registerFlag("WEBGL_PACK_CLIP",function(){return or.getBool("WEBGL_PACK")}),or.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return!1}),or.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return or.getBool("WEBGL_PACK")}),or.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",function(){return or.getBool("WEBGL_PACK")}),or.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return or.getBool("WEBGL_PACK")}),or.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return or.getBool("WEBGL_PACK")}),or.registerFlag("WEBGL_PACK_REDUCE",function(){return or.getBool("WEBGL_PACK")}),or.registerFlag("WEBGL_LAZILY_UNPACK",function(){return or.getBool("WEBGL_PACK")}),or.registerFlag("WEBGL_CONV_IM2COL",function(){return or.getBool("WEBGL_PACK")}),or.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return Oh(or.getNumber("WEBGL_VERSION"))}),or.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return bf(or.getNumber("WEBGL_VERSION"))}),or.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var v=or.getNumber("WEBGL_VERSION");return v===0?0:xf(v)}),or.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return or.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(v=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(v)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(v.substr(0,4))));var v}),or.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",function(){return Nd(or.getNumber("WEBGL_VERSION"))}),or.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return!or.getBool("WEBGL_FORCE_F16_TEXTURES")&&or.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")}),or.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return wf(or.getNumber("WEBGL_VERSION"))}),or.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return ys(or.getNumber("WEBGL_VERSION"))}),or.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){return or.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0}),Lr=Cf;var fa=xt({complex_:function(v,h){var u=Ke(v,"real","complex"),d=Ke(h,"imag","complex");return Tt(u.shape,d.shape,"real and imag shapes, "+u.shape+" and "+d.shape+", must match in call to tf.complex()."),Ve.runKernelFunc(function(y){return y.complex(u,d)},{$real:u,$imag:d})}}),uo=xt({real_:function(v){var h=Ke(v,"input","real");return Ve.runKernelFunc(function(u){return u.real(h)},{$input:h})}}),Uo=xt({imag_:function(v){var h=Ke(v,"input","imag");return Ve.runKernelFunc(function(u){return u.imag(h)},{$input:h})}});function wa(v,h,u){return xs(v,h,zo(v,u),u)}function xs(v,h,u,d){if(d==null&&(d=xe(v)),d==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!Et(v)&&!Array.isArray(v)&&typeof v!="number"&&typeof v!="boolean"&&typeof v!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(h!=null){Gn(h);var y=Ye(h),D=Ye(u);we(y===D,function(){return"Based on the provided shape, ["+h+"], the tensor should have "+y+" values but has "+D});for(var W=0;W<u.length;++W){var X=u[W],ae=W!==u.length-1||X!==Ye(h.slice(W));we(u[W]===h[W]||!ae,function(){return"Error creating a new Tensor. Inferred shape ("+u+") does not match the provided shape ("+h+"). "})}}return Et(v)||Array.isArray(v)||(v=[v]),h=h||u,v=d!=="string"?dr(v,d,L().getBool("DEBUG")):Pt(v,[],!0),Ve.makeTensor(v,h,d)}function fr(v,h){if((Et(v)&&h!=="string"||Array.isArray(v))&&h!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(h==="string"&&Et(v)&&!(v instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return xs(v,[],[],h)}function zs(v,h){Gt(v);var u=zo(v,h);if(u.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return xs(v,null,u,h)}function eu(v,h,u){if(Gt(v),h!=null&&h.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var d=zo(v,u);if(d.length!==2&&d.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(d.length===1&&h==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return xs(v,h,d,u)}function Hc(v,h,u){if(Gt(v),h!=null&&h.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var d=zo(v,u);if(d.length!==3&&d.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(d.length===1&&h==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return xs(v,h,d,u)}function Us(v,h,u){if(Gt(v),h!=null&&h.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var d=zo(v,u);if(d.length!==4&&d.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(d.length===1&&h==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return xs(v,h,d,u)}function Nh(v,h,u){if(Gt(v),h!=null&&h.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var d=zo(v,u);if(d.length!==5&&d.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(d.length===1&&h==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return xs(v,h,d,u)}function jd(v,h,u){if(Gt(v),h!=null&&h.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var d=zo(v,u);if(d.length!==6&&d.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(d.length===1&&h==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return xs(v,h=h||d,d,u)}function Bd(v,h,u,d){return h===void 0&&(h=!0),Ve.makeVariable(v,h,u,d)}function uu(v,h){if(h===void 0&&(h="float32"),h==="complex64"){var u=uu(v,"float32"),d=Ki(v,"float32");return fa(u,d)}var y=hn(Ye(v),h);return Ve.makeTensor(y,v,h)}function Ki(v,h){if(h===void 0&&(h="float32"),h==="complex64"){var u=Ki(v,"float32"),d=Ki(v,"float32");return fa(u,d)}var y=Xt(Ye(v),h);return Ve.makeTensor(y,v,h)}function ws(v,h,u){return Ve.runKernelFunc(function(d){return d.fill(v,h,u)},{})}function Ih(v,h,u){if(u<=0)throw new Error("The number of values should be positive.");return Ve.runKernelFunc(function(d){return d.linspace(v,h,u)},{})}function ac(v,h,u,d){if(u===void 0&&(u=1),d===void 0&&(d="float32"),u===0)throw new Error("Cannot have a step of zero");if(v===h||v<h&&u<0||h<v&&u>1)return Ki([0],d);var y=Xt(Math.abs(Math.ceil((h-v)/u)),d);h<v&&u===1&&(u=-1),y[0]=v;for(var D=1;D<y.length;D++)y[D]=y[D-1]+u;return zs(y,d)}var us=xt({onesLike_:function(v){var h=Ke(v,"x","onesLike");if(h.dtype==="complex64"){var u=us(uo(h)),d=ii(Uo(h));return fa(u,d)}return Ve.runKernelFunc(function(y){return y.onesLike(h)},{$x:h},function(y,D){return{$x:function(){return ii(y)}}})}}),ii=xt({zerosLike_:function(v){var h=Ke(v,"x","zerosLike");return Ve.runKernelFunc(function(u){return u.zerosLike(h)},{$x:h},function(u,d){return{$x:function(){return ii(u)}}})}}),Ba=xt({concat_:function(v,h){h===void 0&&(h=0),we(v.length>=1,function(){return"Pass at least one tensor to concat"});var u=Lu(v,"tensors","concat");u[0].dtype==="complex64"&&u.forEach(function(X){if(X.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `+X.dtype+". ")}),h=xn(h,u[0].shape)[0];var d=Zs(u.map(function(X){return X.shape}),h);if(Ye(d)===0)return wa([],d);if((u=u.filter(function(X){return X.size>0})).length===1)return u[0];var y=u.map(function(X){return X.shape});kc(y,h);var D=u,W={axis:h};return Ve.runKernelFunc(function(X){return X.concat(u,h)},D,function(X){var ae=y.map(function(de){return de[h]});return Ri(X,ae,h).map(function(de){return function(){return de}})},"Concat",W)}}),Fh=xt({concat1d_:function(v){return Ba(v,0)}}),Pd=xt({concat2d_:function(v,h){return Ba(v,h)}}),Al=xt({concat3d_:function(v,h){return Ba(v,h)}}),Rh=xt({concat4d_:function(v,h){return Ba(v,h)}}),Ri=xt({split_:function(v,h,u){u===void 0&&(u=0);var d,y=Ke(v,"x","split");return u=xn(u,y.shape)[0],typeof h=="number"?(we(y.shape[u]%h==0,function(){return"Number of splits must evenly divide the axis."}),d=new Array(h).fill(y.shape[u]/h)):(we(y.shape[u]===h.reduce(function(D,W){return D+W}),function(){return"The sum of sizes must match the size of the axis dimension."}),d=h),Ve.runKernelFunc(function(D){return D.split(y,d,u)},{$x:y},function(D){return{$x:function(){return Ba(D,u)}}})}});function bi(v,h){return v(h={exports:{}},h.exports),h.exports}var ro=bi(function(v){(function(h,u,d){function y(W,X){return X.c=W.c,X.s0=W.s0,X.s1=W.s1,X.s2=W.s2,X}function D(W,X){var ae=new function(Ie){var Re,Me=this,qe=(Re=4022871197,function(Je){Je=Je.toString();for(var Qe=0;Qe<Je.length;Qe++){var ot=.02519603282416938*(Re+=Je.charCodeAt(Qe));ot-=Re=ot>>>0,Re=(ot*=Re)>>>0,Re+=4294967296*(ot-=Re)}return 23283064365386963e-26*(Re>>>0)});Me.next=function(){var Je=2091639*Me.s0+23283064365386963e-26*Me.c;return Me.s0=Me.s1,Me.s1=Me.s2,Me.s2=Je-(Me.c=0|Je)},Me.c=1,Me.s0=qe(" "),Me.s1=qe(" "),Me.s2=qe(" "),Me.s0-=qe(Ie),Me.s0<0&&(Me.s0+=1),Me.s1-=qe(Ie),Me.s1<0&&(Me.s1+=1),Me.s2-=qe(Ie),Me.s2<0&&(Me.s2+=1),qe=null}(W),de=X&&X.state,be=ae.next;return be.int32=function(){return 4294967296*ae.next()|0},be.double=function(){return be()+11102230246251565e-32*(2097152*be()|0)},be.quick=be,de&&(typeof de=="object"&&y(de,ae),be.state=function(){return y(ae,{})}),be}u&&u.exports?u.exports=D:this.alea=D})(0,v)}),Ld=bi(function(v){(function(h,u,d){function y(W,X){return X.x=W.x,X.y=W.y,X.z=W.z,X.w=W.w,X}function D(W,X){var ae=new function(Ie){var Re=this,Me="";Re.x=0,Re.y=0,Re.z=0,Re.w=0,Re.next=function(){var Je=Re.x^Re.x<<11;return Re.x=Re.y,Re.y=Re.z,Re.z=Re.w,Re.w^=Re.w>>>19^Je^Je>>>8},Ie===(0|Ie)?Re.x=Ie:Me+=Ie;for(var qe=0;qe<Me.length+64;qe++)Re.x^=0|Me.charCodeAt(qe),Re.next()}(W),de=X&&X.state,be=function(){return(ae.next()>>>0)/4294967296};return be.double=function(){do var Ie=((ae.next()>>>11)+(ae.next()>>>0)/4294967296)/2097152;while(Ie===0);return Ie},be.int32=ae.next,be.quick=be,de&&(typeof de=="object"&&y(de,ae),be.state=function(){return y(ae,{})}),be}u&&u.exports?u.exports=D:this.xor128=D})(0,v)}),zd=bi(function(v){(function(h,u,d){function y(W,X){return X.x=W.x,X.y=W.y,X.z=W.z,X.w=W.w,X.v=W.v,X.d=W.d,X}function D(W,X){var ae=new function(Ie){var Re=this,Me="";Re.next=function(){var Je=Re.x^Re.x>>>2;return Re.x=Re.y,Re.y=Re.z,Re.z=Re.w,Re.w=Re.v,(Re.d=Re.d+362437|0)+(Re.v=Re.v^Re.v<<4^Je^Je<<1)|0},Re.x=0,Re.y=0,Re.z=0,Re.w=0,Re.v=0,Ie===(0|Ie)?Re.x=Ie:Me+=Ie;for(var qe=0;qe<Me.length+64;qe++)Re.x^=0|Me.charCodeAt(qe),qe==Me.length&&(Re.d=Re.x<<10^Re.x>>>4),Re.next()}(W),de=X&&X.state,be=function(){return(ae.next()>>>0)/4294967296};return be.double=function(){do var Ie=((ae.next()>>>11)+(ae.next()>>>0)/4294967296)/2097152;while(Ie===0);return Ie},be.int32=ae.next,be.quick=be,de&&(typeof de=="object"&&y(de,ae),be.state=function(){return y(ae,{})}),be}u&&u.exports?u.exports=D:this.xorwow=D})(0,v)}),Ud=bi(function(v){(function(h,u,d){function y(W,X){return X.x=W.x.slice(),X.i=W.i,X}function D(W,X){W==null&&(W=+new Date);var ae=new function(Ie){var Re=this;Re.next=function(){var Me,qe,Je=Re.x,Qe=Re.i;return Me=Je[Qe],qe=(Me^=Me>>>7)^Me<<24,qe^=(Me=Je[Qe+1&7])^Me>>>10,qe^=(Me=Je[Qe+3&7])^Me>>>3,qe^=(Me=Je[Qe+4&7])^Me<<7,Me=Je[Qe+7&7],qe^=(Me^=Me<<13)^Me<<9,Je[Qe]=qe,Re.i=Qe+1&7,qe},function(Me,qe){var Je,Qe=[];if(qe===(0|qe))Qe[0]=qe;else for(qe=""+qe,Je=0;Je<qe.length;++Je)Qe[7&Je]=Qe[7&Je]<<15^qe.charCodeAt(Je)+Qe[Je+1&7]<<13;for(;Qe.length<8;)Qe.push(0);for(Je=0;Je<8&&Qe[Je]===0;++Je);for(Je==8?Qe[7]=-1:Qe[Je],Me.x=Qe,Me.i=0,Je=256;Je>0;--Je)Me.next()}(Re,Ie)}(W),de=X&&X.state,be=function(){return(ae.next()>>>0)/4294967296};return be.double=function(){do var Ie=((ae.next()>>>11)+(ae.next()>>>0)/4294967296)/2097152;while(Ie===0);return Ie},be.int32=ae.next,be.quick=be,de&&(de.x&&y(de,ae),be.state=function(){return y(ae,{})}),be}u&&u.exports?u.exports=D:this.xorshift7=D})(0,v)}),Rp=bi(function(v){(function(h,u,d){function y(W,X){return X.i=W.i,X.w=W.w,X.X=W.X.slice(),X}function D(W,X){W==null&&(W=+new Date);var ae=new function(Ie){var Re=this;Re.next=function(){var Me,qe,Je=Re.w,Qe=Re.X,ot=Re.i;return Re.w=Je=Je+1640531527|0,qe=Qe[ot+34&127],Me=Qe[ot=ot+1&127],qe^=qe<<13,Me^=Me<<17,qe^=qe>>>15,Me^=Me>>>12,qe=Qe[ot]=qe^Me,Re.i=ot,qe+(Je^Je>>>16)|0},function(Me,qe){var Je,Qe,ot,vt,bt,wt=[],Ft=128;for(qe===(0|qe)?(Qe=qe,qe=null):(qe+="\0",Qe=0,Ft=Math.max(Ft,qe.length)),ot=0,vt=-32;vt<Ft;++vt)qe&&(Qe^=qe.charCodeAt((vt+32)%qe.length)),vt===0&&(bt=Qe),Qe^=Qe<<10,Qe^=Qe>>>15,Qe^=Qe<<4,Qe^=Qe>>>13,vt>=0&&(bt=bt+1640531527|0,ot=(Je=wt[127&vt]^=Qe+bt)==0?ot+1:0);for(ot>=128&&(wt[127&(qe&&qe.length||0)]=-1),ot=127,vt=512;vt>0;--vt)Qe=wt[ot+34&127],Je=wt[ot=ot+1&127],Qe^=Qe<<13,Je^=Je<<17,Qe^=Qe>>>15,Je^=Je>>>12,wt[ot]=Qe^Je;Me.w=bt,Me.X=wt,Me.i=ot}(Re,Ie)}(W),de=X&&X.state,be=function(){return(ae.next()>>>0)/4294967296};return be.double=function(){do var Ie=((ae.next()>>>11)+(ae.next()>>>0)/4294967296)/2097152;while(Ie===0);return Ie},be.int32=ae.next,be.quick=be,de&&(de.X&&y(de,ae),be.state=function(){return y(ae,{})}),be}u&&u.exports?u.exports=D:this.xor4096=D})(0,v)}),zu=bi(function(v){(function(h,u,d){function y(W,X){return X.a=W.a,X.b=W.b,X.c=W.c,X.d=W.d,X}function D(W,X){var ae=new function(Ie){var Re=this,Me="";Re.next=function(){var Je=Re.b,Qe=Re.c,ot=Re.d,vt=Re.a;return Je=Je<<25^Je>>>7^Qe,Qe=Qe-ot|0,ot=ot<<24^ot>>>8^vt,vt=vt-Je|0,Re.b=Je=Je<<20^Je>>>12^Qe,Re.c=Qe=Qe-ot|0,Re.d=ot<<16^Qe>>>16^vt,Re.a=vt-Je|0},Re.a=0,Re.b=0,Re.c=-1640531527,Re.d=1367130551,Ie===Math.floor(Ie)?(Re.a=Ie/4294967296|0,Re.b=0|Ie):Me+=Ie;for(var qe=0;qe<Me.length+20;qe++)Re.b^=0|Me.charCodeAt(qe),Re.next()}(W),de=X&&X.state,be=function(){return(ae.next()>>>0)/4294967296};return be.double=function(){do var Ie=((ae.next()>>>11)+(ae.next()>>>0)/4294967296)/2097152;while(Ie===0);return Ie},be.int32=ae.next,be.quick=be,de&&(typeof de=="object"&&y(de,ae),be.state=function(){return y(ae,{})}),be}u&&u.exports?u.exports=D:this.tychei=D})(0,v)}),ks=bi(function(v){(function(h,u){var d,y=this,D=256,W=6,X="random",ae=u.pow(D,W),de=u.pow(2,52),be=2*de,Ie=D-1;function Re(ot,vt,bt){var wt=[],Ft=Je(function Jt(un,gn){var p,c=[],a=typeof un;if(gn&&a=="object")for(p in un)try{c.push(Jt(un[p],gn-1))}catch{}return c.length?c:a=="string"?un:un+"\0"}((vt=vt==1?{entropy:!0}:vt||{}).entropy?[ot,Qe(h)]:ot??function(){try{var Jt;return d&&(Jt=d.randomBytes)?Jt=Jt(D):(Jt=new Uint8Array(D),(y.crypto||y.msCrypto).getRandomValues(Jt)),Qe(Jt)}catch{var un=y.navigator,gn=un&&un.plugins;return[+new Date,y,gn,y.screen,Qe(h)]}}(),3),wt),Yt=new Me(wt),an=function(){for(var Jt=Yt.g(W),un=ae,gn=0;Jt<de;)Jt=(Jt+gn)*D,un*=D,gn=Yt.g(1);for(;Jt>=be;)Jt/=2,un/=2,gn>>>=1;return(Jt+gn)/un};return an.int32=function(){return 0|Yt.g(4)},an.quick=function(){return Yt.g(4)/4294967296},an.double=an,Je(Qe(Yt.S),h),(vt.pass||bt||function(Jt,un,gn,p){return p&&(p.S&&qe(p,Yt),Jt.state=function(){return qe(Yt,{})}),gn?(u[X]=Jt,un):Jt})(an,Ft,"global"in vt?vt.global:this==u,vt.state)}function Me(ot){var vt,bt=ot.length,wt=this,Ft=0,Yt=wt.i=wt.j=0,an=wt.S=[];for(bt||(ot=[bt++]);Ft<D;)an[Ft]=Ft++;for(Ft=0;Ft<D;Ft++)an[Ft]=an[Yt=Ie&Yt+ot[Ft%bt]+(vt=an[Ft])],an[Yt]=vt;(wt.g=function(Jt){for(var un,gn=0,p=wt.i,c=wt.j,a=wt.S;Jt--;)un=a[p=Ie&p+1],gn=gn*D+a[Ie&(a[p]=a[c=Ie&c+un])+(a[c]=un)];return wt.i=p,wt.j=c,gn})(D)}function qe(ot,vt){return vt.i=ot.i,vt.j=ot.j,vt.S=ot.S.slice(),vt}function Je(ot,vt){for(var bt,wt=ot+"",Ft=0;Ft<wt.length;)vt[Ie&Ft]=Ie&(bt^=19*vt[Ie&Ft])+wt.charCodeAt(Ft++);return Qe(vt)}function Qe(ot){return String.fromCharCode.apply(0,ot)}if(u["seed"+X]=Re,Je(u.random(),h),v.exports){v.exports=Re;try{d=o(251)}catch{}}})([],Math)});ks.alea=ro,ks.xor128=Ld,ks.xorwow=zd,ks.xorshift7=Ud,ks.xor4096=Rp,ks.tychei=zu;var $c=ks.alea,Rs=function(){function v(h,u,d,y,D){this.mean=h,this.stdDev=u,this.dtype=d,this.nextVal=NaN,this.truncated=y,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var W=D||Math.random();this.random=$c(W.toString())}return v.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var h=this.nextVal;return this.nextVal=NaN,h}for(var u,d,y=!1;!y;){var D=void 0,W=void 0,X=void 0;do X=(D=2*this.random()-1)*D+(W=2*this.random()-1)*W;while(X>=1||X===0);var ae=Math.sqrt(-2*Math.log(X)/X);u=this.mean+this.stdDev*D*ae,d=this.mean+this.stdDev*W*ae,this.truncated&&!this.isValidTruncated(u)||(y=!0)}return this.truncated&&!this.isValidTruncated(d)||(this.nextVal=this.convertValue(d)),this.convertValue(u)},v.prototype.convertValue=function(h){return this.dtype==null||this.dtype==="float32"?h:Math.round(h)},v.prototype.isValidTruncated=function(h){return h<=this.upper&&h>=this.lower},v}(),tu=function(){function v(h,u,d,y){this.alpha=h,this.beta=1/u,this.dtype=d;var D=y||Math.random();this.randu=$c(D.toString()),this.randn=new Rs(0,1,d,!1,this.randu()),this.d=h<1?h+2/3:h-1/3,this.c=1/Math.sqrt(9*this.d)}return v.prototype.nextValue=function(){for(var h,u,d,y,D,W;;){do y=this.randn.nextValue(),W=1+this.c*y;while(W<=0);if(W*=W*W,u=1-.331*(h=y*y)*h,d=.5*h+this.d*(1-W+Math.log(W)),(D=this.randu())<u||Math.log(D)<d)break}return W=1/this.beta*this.d*W,this.alpha<1&&(W*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(W)},v.prototype.convertValue=function(h){return this.dtype==="float32"?h:Math.round(h)},v}(),Mh=function(){function v(h,u,d,y){var D=this;if(h===void 0&&(h=0),u===void 0&&(u=1),this.canReturnFloat=function(){return D.dtype==null||D.dtype==="float32"},this.min=h,this.range=u-h,this.dtype=d,y==null&&(y=Math.random()),typeof y=="number"&&(y=y.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+h+" - "+u+" <= 1 and dtype is not float");this.random=$c(y)}return v.prototype.convertValue=function(h){return this.canReturnFloat()?h:Math.round(h)},v.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},v}();function Ni(v,h,u){return h===void 0&&(h="float32"),h=h||"float32",Gn(v),new Wi(v,h,u)}function _f(v,h){h===void 0&&(h=!1),console.log(v.toString(h))}var Gc=xt({batchToSpaceND_:function(v,h,u){var d=Ke(v,"x","batchToSpaceND"),y=h.reduce(function(D,W){return D*W});return we(d.rank>=1+h.length,function(){return"input rank is "+d.rank+" but should be > than blockShape.length "+h.length}),we(u.length===h.length,function(){return"crops.length is "+u.length+" but should be equal to blockShape.length  "+h.length}),we(d.shape[0]%y==0,function(){return"input tensor batch is "+d.shape[0]+" but is not divisible by the product of the elements of blockShape "+h.join(" * ")+" === "+y}),Ve.runKernelFunc(function(D){return D.batchToSpaceND(d,h,u)},{$x:d},function(D){return{$x:function(){return D.spaceToBatchND(h,u)}}})}}),_l=xt({broadcastTo_:function(v,h){var u=Ke(v,"broadcastTo","x"),d=u.shape;if(h.some(function(ae){return!(ae>0)||ae%1!=0}))throw new Error("broadcastTo(): Invalid broadcast shape ["+h+"].");if(h.length<u.rank)throw new Error("broadcastTo(): shape.length="+h.length+" < input.rank="+u.rank+".");if(h.length>u.rank){for(var y=u.shape.slice();y.length<h.length;)y.unshift(1);u=u.reshape(y)}for(var D=Array.from(h),W=h.length-1;W>=0;W--)if(u.shape[W]===h[W])D[W]=1;else if(u.shape[W]!==1)throw new Error("broadcastTo(): ["+d+"] cannot be broadcast to ["+h+"].");var X=D.map(function(ae,de){return ae>1?de:-1}).filter(function(ae){return ae>=0});return X.length===0?u.clone():Ve.runKernelFunc(function(ae){return ae.tile(u,D)},{input:u},function(ae){return{input:function(){return ae.sum(X,!0)}}})}}),Wd=xt({cast_:function(v,h){var u=Ke(v,"x","cast");if(!Pe(h))throw new Error("Failed to cast to unknown dtype "+h);if(h==="string"&&u.dtype!=="string"||h!=="string"&&u.dtype==="string")throw new Error("Only strings can be casted to strings");var d={dtype:h};return Ve.runKernelFunc(function(y){return y.cast(u,h)},{x:u},function(y){return{x:function(){return y.clone()}}},"Cast",d)}}),Mp=xt({clone_:function(v){var h=Ke(v,"x","clone",null);return Ve.runKernelFunc(function(){return Ve.makeTensorFromDataId(h.dataId,h.shape,h.dtype)},{$x:h},function(u){return{$x:function(){return u.toFloat()}}})}}),Sl=xt({cumsum_:function(v,h,u,d){h===void 0&&(h=0),u===void 0&&(u=!1),d===void 0&&(d=!1);var y=Ke(v,"x","cumsum"),D=Co([h|=0],y.rank),W=y;D!=null&&(W=y.transpose(D));var X=Oo(1,y.rank)[0],ae=Ve.runKernelFunc(function(de){return de.cumsum(W,X,u,d)},{permutedX:W},function(de){return{permutedX:function(){return de.cumsum(h,u,!d)}}});return D!=null&&(ae=ae.transpose(D)),ae}}),jh=xt({depthToSpace_:function(v,h,u){u===void 0&&(u="NHWC");var d=Ke(v,"x","depthToSpace"),y=u==="NHWC"?d.shape[1]:d.shape[2],D=u==="NHWC"?d.shape[2]:d.shape[3],W=u==="NHWC"?d.shape[3]:d.shape[1];return we(y*h>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+y+" and "+h+`  for depthToSpace with input shape
      `+d.shape}),we(D*h>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+D+" and "+h+` for depthToSpace with input shape
          `+d.shape}),we(W%(h*h)==0,function(){return"Dimension size must be evenly divisible by "+h*h+" but is "+W+" for depthToSpace with input shape "+d.shape}),Ve.runKernelFunc(function(X){return X.depthToSpace(d,h,u)},{$x:d})}}),Pa=xt({expandDims_:function(v,h){h===void 0&&(h=0);var u=Ke(v,"x","expandDims",null);we(h<=u.rank,function(){return"Axis must be <= rank of the tensor"});var d=u.shape.slice();return h<0&&(we(-(u.rank+1)<=h,function(){return"Axis must be in the interval ["+-(u.rank+1)+", "+u.rank+"]"}),h=u.rank+h+1),d.splice(h,0,1),eo(u,d)}}),Bh=xt({eye_:function(v,h,u,d){d===void 0&&(d="float32"),h==null&&(h=v);for(var y=Ni([v,h],d),D=v<=h?v:h,W=0;W<D;++W)y.set(1,W,W);var X=y.toTensor().as2D(v,h);if(u==null)return X;if(u.length===1)return Es(Pa(X,0),[u[0],1,1]);if(u.length===2)return Es(Pa(Pa(X,0),0),[u[0],u[1],1,1]);if(u.length===3)return Es(Pa(Pa(Pa(X,0),0),0),[u[0],u[1],u[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+u.length+"D.")}}),Dl=xt({multinomial_:function(v,h,u,d){d===void 0&&(d=!1);var y=Ke(v,"logits","multinomial"),D=y.size,W=y.rank;if(D<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+D+".");if(W>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+W);u=u||Math.random();var X=W===1?y.as2D(1,-1):y,ae=Ve.runKernelFunc(function(de){return de.multinomial(X,d,h,u)},{logits2D:X});return W===1?ae.as1D():ae}}),Ph=xt({oneHot_:function(v,h,u,d){if(u===void 0&&(u=1),d===void 0&&(d=0),h<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+h);var y=Ke(v,"indices","oneHot","int32"),D=y.shape.concat([h]);return y=y.flatten(),Ve.runKernelFunc(function(W){return W.oneHot(y,h,u,d)},{$indices:y},function(W){return{$indices:function(){return Ki(y.shape,"float32")}}}).reshape(D)}}),Tl=xt({pad_:function(v,h,u){u===void 0&&(u=0);var d=Ke(v,"x","pad");if(d.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var y={paddings:h,constantValue:u};return Ve.runKernelFunc(function(D){return D.pad(d,h,u)},{x:d},function(D){var W=h.map(function(X){return X[0]});return{x:function(){return D.slice(W,d.shape)}}},"PadV2",y)}}),Kc=xt({pad1d_:function(v,h,u){return u===void 0&&(u=0),we(h.length===2,function(){return"Invalid number of paddings. Must be length of 2."}),Tl(v,[h],u)}}),Ec=xt({pad2d_:function(v,h,u){return u===void 0&&(u=0),we(h.length===2&&h[0].length===2&&h[1].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Tl(v,h,u)}}),Lh=xt({pad3d_:function(v,h,u){return u===void 0&&(u=0),we(h.length===3&&h[0].length===2&&h[1].length===2&&h[2].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Tl(v,h,u)}}),Sf=xt({pad4d_:function(v,h,u){return u===void 0&&(u=0),we(h.length===4&&h[0].length===2&&h[1].length===2&&h[2].length===2&&h[3].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Tl(v,h,u)}}),Nl=xt({rand_:function(v,h,u){var d=Ye(v),y=null;if(u==null||u==="float32")y=new Float32Array(d);else if(u==="int32")y=new Int32Array(d);else{if(u!=="bool")throw new Error("Unknown data type "+u);y=new Uint8Array(d)}for(var D=0;D<d;D++)y[D]=h();return Ve.makeTensor(y,v,u)}}),Cc=xt({randomNormal_:function(v,h,u,d,y){if(h===void 0&&(h=0),u===void 0&&(u=1),d!=null&&d==="bool")throw new Error("Unsupported data type "+d);for(var D=new Rs(h,u,d,!1,y),W=Ni(v,d),X=0;X<W.values.length;X++)W.values[X]=D.nextValue();return W.toTensor()}}),km=xt({randomGamma_:function(v,h,u,d,y){if(u===void 0&&(u=1),d===void 0&&(d="float32"),u==null&&(u=1),d==null&&(d="float32"),d!=="float32"&&d!=="int32")throw new Error("Unsupported data type "+d);for(var D=new tu(h,u,d,y),W=Ni(v,d),X=0;X<W.values.length;X++)W.values[X]=D.nextValue();return W.toTensor()}}),Il=xt({randomUniform_:function(v,h,u,d,y){h===void 0&&(h=0),u===void 0&&(u=1),d===void 0&&(d="float32");for(var D=Ni(v,d),W=new Mh(h,u,null,y),X=0;X<D.values.length;X++)D.values[X]=W.nextValue();return D.toTensor()}}),eo=xt({reshape_:function(v,h){var u=Ke(v,"x","reshape",null);h=_t(h,u.size),we(u.size===Ye(h),function(){return"new shape and old shape must have the same number of elements."});var d={shape:h};return Ve.runKernelFunc(function(y){return y.reshape(u,h)},{x:u},function(y){return{x:function(){return y.reshape(u.shape)}}},"Reshape",d)}}),Ao=xt({spaceToBatchND_:function(v,h,u){var d=Ke(v,"x","spaceToBatchND");return we(d.rank>=1+h.length,function(){return"input rank "+d.rank+" should be > than [blockShape] "+h.length}),we(u.length===h.length,function(){return"paddings.shape[0] "+u.length+" must be equal to [blockShape] "+h.length}),we(d.shape.reduce(function(y,D,W){return W>0&&W<=h.length?y&&(D+u[W-1][0]+u[W-1][1])%h[W-1]==0:y},!0),function(){return"input spatial dimensions "+d.shape.slice(1)+" with paddings "+u.toString()+" must be divisible by blockShapes "+h.toString()}),Ve.runKernelFunc(function(y){return y.spaceToBatchND(d,h,u)},{$x:d},function(y){return{$x:function(){return y.batchToSpaceND(h,u)}}})}}),Fo=xt({squeeze_:function(v,h){var u=Ke(v,"x","squeeze");return eo(u,In(u.shape,h).newShape)}}),Mi=xt({stack_:function(v,h){h===void 0&&(h=0);var u=Lu(v,"tensors","stack");if(we(u.length>=1,function(){return"Pass at least one tensor to tf.stack"}),u.length===1)return u[0].expandDims(h);var d=u[0].rank,y=u[0].shape,D=u[0].dtype;we(h<=d,function(){return"Axis must be <= rank of the tensor"}),u.forEach(function(X){Tt(y,X.shape,"All tensors passed to stack must have matching shapes")}),u.forEach(function(X){we(D===X.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var W=u.map(function(X){return X.expandDims(h)});return Ba(W,h)}}),Es=xt({tile_:function(v,h){var u=Ke(v,"x","tile",null);we(u.rank===h.length,function(){return"Error in transpose: rank of input "+u.rank+" must match length of reps "+h+"."});var d=[u],y={reps:h};return Ve.runKernelFunc(function(D,W){var X=D.tile(u,h);return W([u]),X},{x:u},function(D,W){var X=W[0];return{x:function(){var ae=ii(X);if(X.rank===1)for(var de=0;de<h[0];++de)ae=ae.add(D.slice([de*X.shape[0]],[X.shape[0]]));else if(X.rank===2)for(de=0;de<h[0];++de)for(var be=0;be<h[1];++be)ae=ae.add(D.slice([de*X.shape[0],be*X.shape[1]],[X.shape[0],X.shape[1]]));else if(X.rank===3)for(de=0;de<h[0];++de)for(be=0;be<h[1];++be)for(var Ie=0;Ie<h[2];++Ie)ae=ae.add(D.slice([de*X.shape[0],be*X.shape[1],Ie*X.shape[2]],[X.shape[0],X.shape[1],X.shape[2]]));else{if(X.rank!==4)throw new Error("Gradient for tile operation is not implemented for rank-"+X.rank+" tensors yet.");for(de=0;de<h[0];++de)for(be=0;be<h[1];++be)for(Ie=0;Ie<h[2];++Ie)for(var Re=0;Re<h[3];++Re)ae=ae.add(D.slice([de*X.shape[0],be*X.shape[1],Ie*X.shape[2],Re*X.shape[3]],[X.shape[0],X.shape[1],X.shape[2],X.shape[3]]))}return ae}}},"Tile",y,d)}}),Oc=xt({truncatedNormal_:function(v,h,u,d,y){if(h===void 0&&(h=0),u===void 0&&(u=1),d!=null&&d==="bool")throw new Error("Unsupported data type "+d);for(var D=new Rs(h,u,d,!0,y),W=Ni(v,d),X=0;X<W.values.length;X++)W.values[X]=D.nextValue();return W.toTensor()}}),Ro=xt({unstack_:function(v,h){h===void 0&&(h=0),h=h||0;var u=Ke(v,"x","unstack");we(h>=-u.shape.length&&h<u.shape.length,function(){return"Axis = "+h+" is not in [-"+u.shape.length+", "+u.shape.length+")"}),h<0&&(h+=u.shape.length);var d={axis:h};return Ve.runKernelFunc(function(y){return y.unstack(u,h)},{x:u},function(y){return{x:function(){return Mi(y,h)}}},"Unpack",d)}}),Ac=function(v,h){return R(this,void 0,void 0,function(){var u,d,y,D,W,X,ae,de,be,Ie;return P(this,function(Re){switch(Re.label){case 0:return u=Ke(v,"x","setdiff1d"),d=Ke(h,"y","setdiff1d"),we(u.dtype===d.dtype,function(){return"x and y should have the same dtype, but got x ("+u.dtype+") and y ("+d.dtype+")."}),we(u.rank===1,function(){return"x should be 1D tensor, but got x ("+u.shape+")."}),we(d.rank===1,function(){return"y should be 1D tensor, but got y ("+d.shape+")."}),[4,u.data()];case 1:return y=Re.sent(),[4,d.data()];case 2:for(D=Re.sent(),W=new Set(D),X=0,be=0;be<y.length;be++)W.has(y[be])||X++;for(ae=new Wi([X],u.dtype),de=new Wi([X],"int32"),be=0,Ie=0;be<y.length;be++)W.has(y[be])||(ae.values[Ie]=y[be],de.values[Ie]=be,Ie++);return[2,[ae.toTensor(),de.toTensor()]]}})})};function Uu(v,h,u,d){d===void 0&&(d=!0);var y=[];if(d)(y=y.concat(h.slice(0))).push(v[0]/u),y=y.concat(v.slice(1));else{y=y.concat(v[0]);for(var D=h.length,W=0;W<D;++W)y=y.concat([v[W+1]/h[W],h[W]]);y=y.concat(v.slice(D+1))}return y}function Df(v,h,u){u===void 0&&(u=!0);var d=[];if(u){d.push(h);for(var y=h+1;y<v;++y)y<=2*h?(d.push(y),d.push(y-(h+1))):d.push(y)}else{var D=[],W=[];for(y=1;y<v;++y)y>=2*h+1||y%2==1?W.push(y):D.push(y);d.push.apply(d,D),d.push(0),d.push.apply(d,W)}return d}function Tf(v,h,u,d){d===void 0&&(d=!0);var y=[];d?y.push(v[0]/u):y.push(v[0]*u);for(var D=1;D<v.length;++D)D<=h.length?d?y.push(h[D-1]*v[D]):y.push(v[D]/h[D-1]):y.push(v[D]);return y}function Xc(v,h){for(var u=[0],d=0;d<h;++d)u.push(v[d][0]);return u}function Vd(v,h,u){for(var d=v.slice(0,1),y=0;y<u;++y)d.push(v[y+1]-h[y][0]-h[y][1]);return d}function Wu(v,h){if(v.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+v.rank+".");if(h.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+h.rank+".");if(h.dtype!=="int32")throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+h.dtype+".");if(h.shape[h.rank-1]>v.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+h.shape[h.rank-1]+" vs. "+v.rank);if(v.size===0)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+v.shape+".");for(var u=h.shape,d=u[u.length-1],y=1,D=0;D<u.length-1;++D)y*=u[D];var W=v.shape,X=u.slice();X.pop();var ae=1;for(D=d;D<v.rank;++D)ae*=W[D],X.push(W[D]);var de=Cr(v.shape).map(function(be){return be/ae}).concat([1]).slice(0,d);return[X,y,ae,de]}var Em=Object.freeze({prepareAndValidate:Wu}),qd=30;function Fl(v){return v<=qd?v:br(v,Math.floor(Math.sqrt(v)))}function jp(v,h,u){var d=h.rank>1?h.shape[h.rank-1]:1,y=h.rank>1?h.rank-1:1,D="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+u.shape+", indices.shape: "+h.shape+", shape: "+v+", sliceDim: "+d+", and batchDim: "+y+".";if(u.rank<y)throw new Error(D+" update.rank < "+y+". ");if(v.length<d+(u.rank-y))throw new Error(D+" Output shape length < "+(d+(u.rank-y)));if(u.rank!==y+v.length-d)throw new Error(D+" update.rank != "+(y+v.length-d));for(var W=0;W<y;++W)if(u.shape[W]!==h.shape[W])throw new Error(D+" updates.shape["+W+"] ("+u.shape[W]+") != indices.shape["+W+"] ("+h.shape[W]+").");for(W=0;W<u.rank-y;++W)if(u.shape[W+y]!==v[W+d])throw new Error(D+" updates.shape["+(W+y)+"] ("+u.shape[W+y]+") != shape["+(W+y)+"] ("+v[W+y]+")")}function Nf(v,h,u){if(h.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+h.rank+".");if(v.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+v.rank+".");if(h.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: "+h.dtype);if(u.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+u);if(u.length===0){if(h.size===0)throw new Error("Indices specified for empty output. indices shape: "+h.shape);if(v.size===0)throw new Error("Updates specified for empty output. updates shape: "+v.shape)}jp(u,h,v)}function Yc(v,h,u){for(var d=h.shape.length,y=d>1?h.shape[d-1]:1,D=u.length,W=1,X=y;X<D;++X)W*=u[X];var ae=y<1?1:y;return{sliceRank:y,numUpdates:Ye(h.shape)/ae,sliceSize:W,strides:Cr(u.slice(0,y)).concat([1]),outputSize:Ye(u)}}var Hd=Object.freeze({validateUpdateShape:jp,validateInput:Nf,calculateShapes:Yc});function zh(v,h,u){we(v.rank===h.length,function(){return"Error in slice"+v.rank+"D: Length of begin "+h+" must match the rank of the array ("+v.rank+")."}),we(v.rank===u.length,function(){return"Error in slice"+v.rank+"D: Length of size "+u+" must match the rank of the array ("+v.rank+")."});for(var d=function(D){we(h[D]+u[D]<=v.shape[D],function(){return"Error in slice"+v.rank+"D: begin["+D+"] + size["+D+"] ("+(h[D]+u[D])+") would overflow input.shape["+D+"] ("+v.shape[D]+")"})},y=0;y<v.rank;++y)d(y)}function yo(v){for(var h=[],u=0;v>0;)1&v&&h.push(u),v/=2,u++;return h}function Rl(v,h,u){for(var d=[],y=0;y<v.length;y++)d[y]=Math.ceil((h[y]-v[y])/u[y]);return d}function Cs(v,h,u,d,y){var D=h[y],W=u[y]||1;(v&1<<y||D==null)&&(D=W>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var X=d[y];return D<0&&(D+=X),St(0,D,X-1)}function Ml(v,h,u,d,y){var D=h[y],W=u[y]||1;(v&1<<y||D==null)&&(D=W>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var X=d[y];return D<0&&(D+=X),W>0?St(0,D,X):St(-1,D,X-1)}function If(v,h,u){for(var d=u.length,y=0;y<u.length;y++)if(u[y]>1){d=y;break}for(y=d+1;y<u.length;y++)if(h[y]>0||u[y]!==v[y])return!1;return!0}function Uh(v,h){for(var u=v.length>0?v[v.length-1]:1,d=0;d<v.length-1;d++)u+=v[d]*h[d];return u}var $d=Object.freeze({assertParamsValid:zh,maskToAxes:yo,computeOutShape:Rl,startForAxis:Cs,stopForAxis:Ml,isSliceContinous:If,computeFlatOffset:Uh});function Ff(v){return we(Xn(v),function(){return"The f passed in grad(f) must be a function"}),function(h,u){var d=Ke(h,"x","tf.grad",null),y=u!=null?Ke(u,"dy","tf.grad"):null;return Ve.tidy(function(){var D=Ve.gradients(function(){return v(d)},[d],y),W=D.value,X=D.grads;return y!=null&&Tt(W.shape,y.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),Un(X),X[0]})}}function jl(v){return we(Xn(v),function(){return"The f passed in grads(f) must be a function"}),function(h,u){we(Array.isArray(h),function(){return"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s"});var d=Lu(h,"args","tf.grads",null),y=u!=null?Ke(u,"dy","tf.grads"):null;return Ve.tidy(function(){var D=Ve.gradients(function(){return v.apply(void 0,d)},d,y),W=D.value,X=D.grads;return y!=null&&Tt(W.shape,y.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),Un(X),X})}}function Gd(v){return we(Xn(v),function(){return"The f passed in valueAndGrad(f) must be a function"}),function(h,u){we(h instanceof jt,function(){return"The x passed in valueAndGrad(f)(x) must be a tensor"}),we(u==null||u instanceof jt,function(){return"The dy passed in valueAndGrad(f)(x, dy) must be a tensor"});var d=Ve.gradients(function(){return v(h)},[h],u),y=d.grads,D=d.value;return Un(y),{grad:y[0],value:D}}}function Kd(v){return we(Xn(v),function(){return"The f passed in valueAndGrads(f) must be a function"}),function(h,u){we(Array.isArray(h)&&h.every(function(y){return y instanceof jt}),function(){return"The args passed in valueAndGrads(f)(args) must be array of tensors"}),we(u==null||u instanceof jt,function(){return"The dy passed in valueAndGrads(f)(args, dy) must be a tensor"});var d=Ve.gradients(function(){return v.apply(void 0,h)},h,u);return u!=null&&Tt(d.value.shape,u.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),Un(d.grads),d}}function en(v,h){we(Xn(v),function(){return"The f passed in variableGrads(f) must be a function"}),we(h==null||Array.isArray(h)&&h.every(function(be){return be instanceof mt}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var u=h!=null;if(!u)for(var d in h=[],Ve.registeredVariables)h.push(Ve.registeredVariables[d]);var y=u?h.filter(function(be){return!be.trainable}):null,D=h.length;we((h=h.filter(function(be){return be.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+D+" variables is trainable."});var W=Ve.gradients(v,h,null,!0),X=W.value,ae=W.grads;we(ae.some(function(be){return be!=null}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),we(X.rank===0,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+X.rank+" tensor"});var de={};return h.forEach(function(be,Ie){ae[Ie]!=null&&(de[be.name]=ae[Ie])}),y?.forEach(function(be){return de[be.name]=null}),{value:X,grads:de}}function Ws(v){return Ve.customGrad(v)}function Un(v){if(v.filter(function(h){return h==null}).length>0)throw new Error(`Cannot compute gradient of y=f(x) with respect to x. Make sure that
    the f you passed encloses all operations that lead from x to y.`)}var Os=xt({softmax_:function(v,h){h===void 0&&(h=-1);var u=Ke(v,"logits","softmax","float32");if(h===-1&&(h=u.rank-1),h!==u.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+u.rank+" and dim was "+h);return Ve.runKernelFunc(function(d,y){var D=d.softmax(u,h);return y([D]),D},{logits:u},function(d,y){var D=y[0],W=d.mul(D);return{logits:function(){return W.sub(W.sum([h],!0).mul(D))}}},"Softmax",{dim:h},[],[!0])}}),na=xt({logSoftmax_:function(v,h){h===void 0&&(h=-1);var u=Ke(v,"logits","logSoftmax");if(h===-1&&(h=u.rank-1),h!==u.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+u.rank+" and axis was "+h);return Ws(function(d,y){var D=d.max(h,!0),W=d.sub(D),X=W.toFloat().sub(W.exp().sum(h,!0).log());return y([X]),{value:X,gradFunc:function(ae,de){var be=de[0].exp();return ae.sub(ae.sum(h,!0).mul(be))}}})(u)}}),Bl=function(){function v(h,u){this.backend=h,this.dataMover=u,this.data=new WeakMap,this.dataIdsCount=0}return v.prototype.get=function(h){return this.data.has(h)||this.dataMover.moveData(this.backend,h),this.data.get(h)},v.prototype.set=function(h,u){this.dataIdsCount++,this.data.set(h,u)},v.prototype.has=function(h){return this.data.has(h)},v.prototype.delete=function(h){return this.dataIdsCount--,this.data.delete(h)},v.prototype.numDataIds=function(){return this.dataIdsCount},v}(),Rf=function(){function v(){}return v.prototype.time=function(h){return nr("time")},v.prototype.read=function(h){return nr("read")},v.prototype.readSync=function(h){return nr("readSync")},v.prototype.numDataIds=function(){return nr("numDataIds")},v.prototype.disposeData=function(h){return nr("disposeData")},v.prototype.write=function(h,u,d){return nr("write")},v.prototype.move=function(h,u,d,y){return nr("move")},v.prototype.memory=function(){return nr("memory")},v.prototype.floatPrecision=function(){return nr("floatPrecision")},v.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},v.prototype.batchMatMul=function(h,u,d,y){return nr("batchMatMul")},v.prototype.fusedBatchMatMul=function(h){return h.a,h.b,h.transposeA,h.transposeB,h.bias,h.activation,h.preluActivationWeights,nr("fusedBatchMatMul")},v.prototype.slice=function(h,u,d){return nr("slice")},v.prototype.stridedSlice=function(h,u,d,y){return nr("stridedSlice")},v.prototype.unstack=function(h,u){return nr("unstack")},v.prototype.reverse=function(h,u){return nr("reverse")},v.prototype.concat=function(h,u){return nr("concat")},v.prototype.neg=function(h){return nr("neg")},v.prototype.add=function(h,u){return nr("add")},v.prototype.addN=function(h){return nr("addN")},v.prototype.subtract=function(h,u){return nr("subtract")},v.prototype.multiply=function(h,u){return nr("multiply")},v.prototype.realDivide=function(h,u){return nr("realDivide")},v.prototype.floorDiv=function(h,u){return nr("floorDiv")},v.prototype.sum=function(h,u){return nr("sum")},v.prototype.prod=function(h,u){return nr("prod")},v.prototype.unsortedSegmentSum=function(h,u,d){return nr("unsortedSegmentSum")},v.prototype.argMin=function(h,u){return nr("argMin")},v.prototype.argMax=function(h,u){return nr("argMax")},v.prototype.equal=function(h,u){return nr("equal")},v.prototype.notEqual=function(h,u){return nr("notEqual")},v.prototype.less=function(h,u){return nr("less")},v.prototype.lessEqual=function(h,u){return nr("lessEqual")},v.prototype.greater=function(h,u){return nr("greater")},v.prototype.greaterEqual=function(h,u){return nr("greaterEqual")},v.prototype.logicalNot=function(h){return nr("logicalNot")},v.prototype.logicalAnd=function(h,u){return nr("logicalAnd")},v.prototype.logicalOr=function(h,u){return nr("logicalOr")},v.prototype.where=function(h){return nr("where")},v.prototype.select=function(h,u,d){return nr("select")},v.prototype.topk=function(h,u,d){return nr("topk")},v.prototype.min=function(h,u){return nr("min")},v.prototype.minimum=function(h,u){return nr("minimum")},v.prototype.mod=function(h,u){return nr("mod")},v.prototype.max=function(h,u){return nr("max")},v.prototype.maximum=function(h,u){return nr("maximum")},v.prototype.all=function(h,u){return nr("all")},v.prototype.any=function(h,u){return nr("any")},v.prototype.squaredDifference=function(h,u){return nr("squaredDifference")},v.prototype.ceil=function(h){return nr("ceil")},v.prototype.floor=function(h){return nr("floor")},v.prototype.round=function(h){return nr("round")},v.prototype.sign=function(h){return nr("sign")},v.prototype.isNaN=function(h){return nr("isNaN")},v.prototype.isInf=function(h){return nr("isInf")},v.prototype.isFinite=function(h){return nr("isFinite")},v.prototype.pow=function(h,u){return nr("pow")},v.prototype.exp=function(h){return nr("exp")},v.prototype.expm1=function(h){return nr("expm1")},v.prototype.softmax=function(h,u){return nr("softmax")},v.prototype.log=function(h){return nr("log")},v.prototype.log1p=function(h){return nr("log1p")},v.prototype.sqrt=function(h){return nr("sqrt")},v.prototype.rsqrt=function(h){return nr("rsqrt")},v.prototype.square=function(h){return nr("square")},v.prototype.reciprocal=function(h){return nr("reciprocal")},v.prototype.relu=function(h){return nr("relu")},v.prototype.relu6=function(h){return nr("relu6")},v.prototype.prelu=function(h,u){return nr("prelu")},v.prototype.elu=function(h){return nr("elu")},v.prototype.eluDer=function(h,u){return nr("eluDer")},v.prototype.selu=function(h){return nr("selu")},v.prototype.int=function(h){return nr("int")},v.prototype.clip=function(h,u,d){return nr("clip")},v.prototype.abs=function(h){return nr("abs")},v.prototype.complexAbs=function(h){return nr("complexAbs")},v.prototype.sigmoid=function(h){return nr("sigmoid")},v.prototype.softplus=function(h){return nr("softplus")},v.prototype.sin=function(h){return nr("sin")},v.prototype.cos=function(h){return nr("cos")},v.prototype.tan=function(h){return nr("tan")},v.prototype.asin=function(h){return nr("asin")},v.prototype.acos=function(h){return nr("acos")},v.prototype.atan=function(h){return nr("atan")},v.prototype.atan2=function(h,u){return nr("atan2")},v.prototype.sinh=function(h){return nr("sinh")},v.prototype.cosh=function(h){return nr("cosh")},v.prototype.tanh=function(h){return nr("tanh")},v.prototype.asinh=function(h){return nr("asinh")},v.prototype.acosh=function(h){return nr("acosh")},v.prototype.atanh=function(h){return nr("atanh")},v.prototype.erf=function(h){return nr("erf")},v.prototype.step=function(h,u){return nr("step")},v.prototype.fusedConv2d=function(h){return h.input,h.filter,h.convInfo,h.bias,h.activation,h.preluActivationWeights,nr("fusedConv2d")},v.prototype.conv2d=function(h,u,d){return nr("conv2d")},v.prototype.conv2dDerInput=function(h,u,d){return nr("conv2dDerInput")},v.prototype.conv2dDerFilter=function(h,u,d){return nr("conv2dDerFilter")},v.prototype.fusedDepthwiseConv2D=function(h){return h.input,h.filter,h.convInfo,h.bias,h.activation,h.preluActivationWeights,nr("fusedDepthwiseConv2D")},v.prototype.depthwiseConv2D=function(h,u,d){return nr("depthwiseConv2D")},v.prototype.depthwiseConv2DDerInput=function(h,u,d){return nr("depthwiseConv2DDerInput")},v.prototype.depthwiseConv2DDerFilter=function(h,u,d){return nr("depthwiseConv2DDerFilter")},v.prototype.conv3d=function(h,u,d){return nr("conv3d")},v.prototype.conv3dDerInput=function(h,u,d){return nr("conv3dDerInput")},v.prototype.conv3dDerFilter=function(h,u,d){return nr("conv3dDerFilter")},v.prototype.maxPool=function(h,u){return nr("maxPool")},v.prototype.maxPoolBackprop=function(h,u,d,y){return nr("maxPoolBackprop")},v.prototype.avgPool=function(h,u){return nr("avgPool")},v.prototype.avgPoolBackprop=function(h,u,d){return nr("avgPoolBackprop")},v.prototype.avgPool3d=function(h,u){return nr("avgPool3d")},v.prototype.avgPool3dBackprop=function(h,u,d){return nr("avgPool3dBackprop")},v.prototype.maxPool3d=function(h,u){return nr("maxPool3d")},v.prototype.maxPool3dBackprop=function(h,u,d,y){return nr("maxPool3dBackprop")},v.prototype.reshape=function(h,u){return nr("reshape")},v.prototype.cast=function(h,u){return nr("cast")},v.prototype.tile=function(h,u){return nr("tile")},v.prototype.pad=function(h,u,d){return nr("pad")},v.prototype.transpose=function(h,u){return nr("transpose")},v.prototype.gather=function(h,u,d){return nr("gather")},v.prototype.gatherND=function(h,u){return nr("gatherND")},v.prototype.scatterND=function(h,u,d){return nr("scatterND")},v.prototype.batchToSpaceND=function(h,u,d){return nr("batchToSpaceND")},v.prototype.spaceToBatchND=function(h,u,d){return nr("spaceToBatchND")},v.prototype.resizeBilinear=function(h,u,d,y){return nr("resizeBilinear")},v.prototype.resizeBilinearBackprop=function(h,u,d){return nr("resizeBilinearBackprop")},v.prototype.resizeNearestNeighbor=function(h,u,d,y){return nr("resizeNearestNeighbor")},v.prototype.resizeNearestNeighborBackprop=function(h,u,d){return nr("resizeNearestNeighborBackprop")},v.prototype.batchNormalization=function(h,u,d,y,D,W){return nr("batchNormalization")},v.prototype.localResponseNormalization4D=function(h,u,d,y,D){return nr("localResponseNormalization4D")},v.prototype.LRNGrad=function(h,u,d,y,D,W,X){return nr("LRNGrad")},v.prototype.multinomial=function(h,u,d,y){return nr("multinomial")},v.prototype.oneHot=function(h,u,d,y){return nr("oneHot")},v.prototype.cumsum=function(h,u,d,y){return nr("cumsum")},v.prototype.nonMaxSuppression=function(h,u,d,y,D){return nr("nonMaxSuppression")},v.prototype.fft=function(h){return nr("fft")},v.prototype.ifft=function(h){return nr("ifft")},v.prototype.complex=function(h,u){return nr("complex")},v.prototype.real=function(h){return nr("real")},v.prototype.imag=function(h){return nr("imag")},v.prototype.cropAndResize=function(h,u,d,y,D,W){return nr("cropAndResize")},v.prototype.depthToSpace=function(h,u,d){return nr("depthToSpace")},v.prototype.split=function(h,u,d){return nr("split")},v.prototype.sparseToDense=function(h,u,d,y){return nr("sparseToDense")},v.prototype.diag=function(h){return nr("diag")},v.prototype.fill=function(h,u,d){return nr("fill")},v.prototype.onesLike=function(h){return nr("onesLike")},v.prototype.zerosLike=function(h){return nr("zerosLike")},v.prototype.linspace=function(h,u,d){return nr("linspace")},v.prototype.dispose=function(){return nr("dispose")},v}();function nr(v){throw new Error("'"+v+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function Go(v,h){for(var u=v.length,d=[],y=0;y<u;y++){var D=u-1-y,W=v[D]||1;(h[h.length-1-y]||1)>1&&W===1&&d.unshift(D)}return d}function bo(v,h){for(var u=[],d=0;d<h.length;d++){var y=v[v.length-d-1],D=h.length-d-1,W=h[D];(y==null||y===1&&W>1)&&u.unshift(D)}return u}function Hi(v,h){for(var u=[],d=Math.max(v.length,h.length),y=0;y<d;y++){var D=v[v.length-y-1];D==null&&(D=1);var W=h[h.length-y-1];if(W==null&&(W=1),D===1)u.unshift(W);else if(W===1)u.unshift(D);else{if(D!==W)throw Error("Operands could not be broadcast together with shapes "+v+" and "+h+".");u.unshift(D)}}return u}function ku(v,h,u,d,y,D,W){W===void 0&&(W="channelsLast");var X,ae=Vu(h),de=ae[0],be=ae[1];if(W==="channelsLast")X=[de,be,v[3],v[3]];else{if(W!=="channelsFirst")throw new Error("Unknown dataFormat "+W);X=[de,be,v[1],v[1]]}return Vs(v,X,u,d,y,D,!1,W)}function oc(v,h,u,d,y,D,W){W===void 0&&(W="NDHWC");var X,ae,de=qs(h),be=de[0],Ie=de[1],Re=de[2];if(W==="NDHWC")ae="channelsLast",X=[be,Ie,Re,v[4],v[4]];else{if(W!=="NCDHW")throw new Error("Unknown dataFormat "+W);ae="channelsFirst",X=[be,Ie,Re,v[1],v[1]]}return sc(v,X,u,d,y,!1,ae,D)}function Vs(v,h,u,d,y,D,W,X){W===void 0&&(W=!1),X===void 0&&(X="channelsLast");var ae=[-1,-1,-1,-1],de=ae[0],be=ae[1],Ie=ae[2],Re=ae[3];if(X==="channelsLast")de=v[0],be=v[1],Ie=v[2],Re=v[3];else{if(X!=="channelsFirst")throw new Error("Unknown dataFormat "+X);de=v[0],Re=v[1],be=v[2],Ie=v[3]}var Me,qe=h[0],Je=h[1],Qe=h[3],ot=Vu(u),vt=ot[0],bt=ot[1],wt=Vu(d),Ft=wt[0],Yt=wt[1],an=oa(qe,Ft),Jt=oa(Je,Yt),un=function(l,g,_,j,V,ne,oe,me){var Ee,_e,Ne;if(typeof l=="number"){Ee={top:l,bottom:l,left:l,right:l,type:l===0?"VALID":"NUMBER"};var Ue=function(gt,Ct,Wt,Kt,Vt){Kt==null&&(Kt=Ka(gt,Ct,Wt));var Ht=gt[1],vn=cs((gt[0]-Ct+2*Kt)/Wt+1,Vt);we(Zt(vn),function(){return"The output # of rows ("+vn+") must be an integer. Change the stride and/or zero pad parameters"});var On=cs((Ht-Ct+2*Kt)/Wt+1,Vt);return we(Zt(On),function(){return"The output # of columns ("+On+") must be an integer. Change the stride and/or zero pad parameters"}),[vn,On]}([g,_],ne,j,l,me);_e=Ue[0],Ne=Ue[1]}else if(l==="same"){_e=Math.ceil(g/j),Ne=Math.ceil(_/V);var $e=Math.max(0,(_e-1)*j+ne-g),He=Math.max(0,(Ne-1)*V+oe-_),et=Math.floor($e/2),lt=$e-et,ht=Math.floor(He/2);Ee={top:et,bottom:lt,left:ht,right:He-ht,type:"SAME"}}else{if(l!=="valid")throw Error("Unknown padding parameter: "+l);Ee={top:0,bottom:0,left:0,right:0,type:"VALID"},_e=Math.ceil((g-ne+1)/j),Ne=Math.ceil((_-oe+1)/V)}return{padInfo:Ee,outHeight:_e,outWidth:Ne}}(y,be,Ie,vt,bt,an,Jt,D),gn=un.padInfo,p=un.outHeight,c=un.outWidth,a=W?Qe*Re:Qe;return X==="channelsFirst"?Me=[de,a,p,c]:X==="channelsLast"&&(Me=[de,p,c,a]),{batchSize:de,dataFormat:X,inHeight:be,inWidth:Ie,inChannels:Re,outHeight:p,outWidth:c,outChannels:a,padInfo:gn,strideHeight:vt,strideWidth:bt,filterHeight:qe,filterWidth:Je,effectiveFilterHeight:an,effectiveFilterWidth:Jt,dilationHeight:Ft,dilationWidth:Yt,inShape:v,outShape:Me,filterShape:h}}function sc(v,h,u,d,y,D,W,X){D===void 0&&(D=!1),W===void 0&&(W="channelsLast");var ae=[-1,-1,-1,-1,-1],de=ae[0],be=ae[1],Ie=ae[2],Re=ae[3],Me=ae[4];if(W==="channelsLast")de=v[0],be=v[1],Ie=v[2],Re=v[3],Me=v[4];else{if(W!=="channelsFirst")throw new Error("Unknown dataFormat "+W);de=v[0],Me=v[1],be=v[2],Ie=v[3],Re=v[4]}var qe,Je=h[0],Qe=h[1],ot=h[2],vt=h[4],bt=qs(u),wt=bt[0],Ft=bt[1],Yt=bt[2],an=qs(d),Jt=an[0],un=an[1],gn=an[2],p=oa(Je,Jt),c=oa(Qe,un),a=oa(ot,gn),l=function(oe,me,Ee,_e,Ne,Ue,$e,He,et,lt,ht){var gt,Ct,Wt,Kt;if(typeof oe=="number"){gt={top:oe,bottom:oe,left:oe,right:oe,front:oe,back:oe,type:oe===0?"VALID":"NUMBER"};var Vt=function(ur,ar,Or,Er,Ur,ei){Ur==null&&(Ur=Ka(ur,ar,Er));var mi=ur[1],ua=ur[2],ca=cs((ur[0]-ar+2*Ur)/Er+1,ei);we(Zt(ca),function(){return"The output # of depths ("+ca+") must be an integer. Change the stride and/or zero pad parameters"});var ka=cs((mi-ar+2*Ur)/Er+1,ei);we(Zt(ka),function(){return"The output # of rows ("+ka+") must be an integer. Change the stride and/or zero pad parameters"});var ba=cs((ua-ar+2*Ur)/Er+1,ei);return we(Zt(ba),function(){return"The output # of columns ("+ba+") must be an integer. Change the stride and/or zero pad parameters"}),[ca,ka,ba,1]}([me,Ee,_e,1],He,0,Ne,oe,ht);Ct=Vt[0],Wt=Vt[1],Kt=Vt[2]}else if(oe==="same"){var Ht=((Ct=Math.ceil(me/Ne))-1)*Ne+He-me,vn=((Wt=Math.ceil(Ee/Ue))-1)*Ue+et-Ee,On=((Kt=Math.ceil(_e/$e))-1)*$e+lt-_e,Cn=Math.floor(Ht/2),Kn=Ht-Cn,er=Math.floor(vn/2),sr=vn-er,lr=Math.floor(On/2);gt={top:er,bottom:sr,left:lr,right:On-lr,front:Cn,back:Kn,type:"SAME"}}else{if(oe!=="valid")throw Error("Unknown padding parameter: "+oe);gt={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},Ct=Math.ceil((me-He+1)/Ne),Wt=Math.ceil((Ee-et+1)/Ue),Kt=Math.ceil((_e-lt+1)/$e)}return{padInfo:gt,outDepth:Ct,outHeight:Wt,outWidth:Kt}}(y,be,Ie,Re,wt,Ft,Yt,p,c,a,X),g=l.padInfo,_=l.outDepth,j=l.outHeight,V=l.outWidth,ne=D?vt*Me:vt;return W==="channelsFirst"?qe=[de,ne,_,j,V]:W==="channelsLast"&&(qe=[de,_,j,V,ne]),{batchSize:de,dataFormat:W,inDepth:be,inHeight:Ie,inWidth:Re,inChannels:Me,outDepth:_,outHeight:j,outWidth:V,outChannels:ne,padInfo:g,strideDepth:wt,strideHeight:Ft,strideWidth:Yt,filterDepth:Je,filterHeight:Qe,filterWidth:ot,effectiveFilterDepth:p,effectiveFilterHeight:c,effectiveFilterWidth:a,dilationDepth:Jt,dilationHeight:un,dilationWidth:gn,inShape:v,outShape:qe,filterShape:h}}function Ka(v,h,u,d){d===void 0&&(d=1);var y=oa(h,d);return Math.floor((v[0]*(u-1)-u+y)/2)}function Vu(v){return typeof v=="number"?[v,v,v]:v.length===2?[v[0],v[1],1]:v}function qs(v){return typeof v=="number"?[v,v,v]:v}function oa(v,h){return h<=1?v:v+(v-1)*(h-1)}function cs(v,h){if(!h)return v;switch(h){case"round":return Math.round(v);case"ceil":return Math.ceil(v);case"floor":return Math.floor(v);default:throw new Error("Unknown roundingMode "+h)}}function _o(v){var h=Vu(v),u=h[0],d=h[1],y=h[2];return u===1&&d===1&&y===1}function ls(v,h){return _o(v)||_o(h)}function Xa(v){if(v==="NHWC")return"channelsLast";if(v==="NCHW")return"channelsFirst";throw new Error("Unknown dataFormat "+v)}function Hs(v,h,u){if(h==="complex64"){if(v.dtype==="complex64")return v.clone();var d=Ki(v.shape),y=v.toFloat(),D=u.complex(y,d);return d.dispose(),y.dispose(),D}if(!rt(v.dtype,h))return Ve.makeTensorFromDataId(v.dataId,v.shape,h);if(v.dtype==="complex64"){var W=u.real(v);return D=W.cast(h),W.dispose(),D}if(h==="int32")return u.int(v);if(h==="bool"){var X=fr(0,v.dtype);return D=u.notEqual(v,X),X.dispose(),D}throw new Error("Error in Cast: failed to cast "+v.dtype+" to "+h)}function Eu(v,h){return Ve.makeTensorFromDataId(v.dataId,h,v.dtype)}function qu(v,h,u){var d=(h-v)/(u-1),y=Xt(u,"float32");y[0]=v;for(var D=1;D<y.length;D++)y[D]=y[D-1]+d;return zs(y,"float32")}var uc=Object.freeze({castTensor:Hs,reshapeTensor:Eu,linspaceImpl:qu,upcastType:cn,axesAreInnerMostDims:Af,combineLocations:Md,computeOutAndReduceShapes:Aa,expandShapeToKeepDim:_a,assertAxesAreInnerMostDims:Ga,getAxesPermutation:Co,getUndoAxesPermutation:wu,getInnerMostAxes:Oo,getBroadcastDims:Go,getReductionAxes:bo,assertAndGetBroadcastShape:Hi,assertParamsConsistent:kc,computeOutShape:Zs,computePool2DInfo:ku,computePool3DInfo:oc,computeConv2DInfo:Vs,computeConv3DInfo:sc,computeDefaultPad:Ka,tupleValuesAreOne:_o,eitherStridesOrDilationsAreOne:ls,convertConv2DDataFormat:Xa,PARALLELIZE_THRESHOLD:qd,computeOptimalWindowSize:Fl});function Cu(v,h){if(v.length!==h.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+v.length+", imag: "+h.length+".");for(var u=new Float32Array(2*v.length),d=0;d<u.length;d+=2)u[d]=v[d/2],u[d+1]=h[d/2];return u}function Jc(v,h){return{real:v[2*h],imag:v[2*h+1]}}function Qc(v,h,u,d){v[2*d]=h,v[2*d+1]=u}function Wh(v,h,u){var d=(u?2:-2)*Math.PI*(v/h);return{real:Math.cos(d),imag:Math.sin(d)}}function Zc(v,h,u){var d=function(D,W,X){return function(ae,de,be){for(var Ie=0,Re=ae.length,Me=0,qe=!1;Ie<Re;){var Je=be(de,ae[Me=Ie+(Re-Ie>>>1)]);Je>0?Ie=Me+1:(Re=Me,qe=!Je)}return qe?Ie:-Ie-1}(D,W,X||$s)}(v,h,u),y=d<0?-(d+1):d;v.splice(y,0,h)}function $s(v,h){return v>h?1:v<h?-1:0}function Ou(v,h,u,d,y){return nu(v,h,u,d,y,0).selectedIndices}function Au(v,h,u,d,y,D){var W=nu(v,h,u,d,y,D);return W.numValidOutputs.dispose(),{selectedIndices:W.selectedIndices,selectedScores:W.selectedScores}}function nu(v,h,u,d,y,D,W,X){X===void 0&&(X=!1);for(var ae=Array.from(h).map(function(wt,Ft){return{score:wt,boxIndex:Ft,suppressBeginIndex:0}}).filter(function(wt){return wt.score>y}).sort(jf),de=D>0?-.5/D:0,be=[],Ie=[];be.length<u&&ae.length>0;){var Re=ae.pop(),Me=Re.score,qe=Re.boxIndex,Je=Re.suppressBeginIndex;if(Me<y)break;for(var Qe=!1,ot=be.length-1;ot>=Je;--ot){var vt=Vh(v,qe,be[ot]);if(vt>=d){Qe=!0;break}if(Re.score=Re.score*Mf(d,de,vt),Re.score<=y)break}Re.suppressBeginIndex=be.length,Qe||(Re.score===Me?(be.push(qe),Ie.push(Re.score)):Re.score>y&&Zc(ae,Re,jf))}var bt=be.length;return X&&(be.fill(0,bt),Ie.fill(0,bt)),{selectedIndices:zs(be,"int32"),selectedScores:zs(Ie,"float32"),numValidOutputs:fr(bt,"int32")}}function Vh(v,h,u){var d=v.subarray(4*h,4*h+4),y=v.subarray(4*u,4*u+4),D=Math.min(d[0],d[2]),W=Math.min(d[1],d[3]),X=Math.max(d[0],d[2]),ae=Math.max(d[1],d[3]),de=Math.min(y[0],y[2]),be=Math.min(y[1],y[3]),Ie=Math.max(y[0],y[2]),Re=Math.max(y[1],y[3]),Me=(X-D)*(ae-W),qe=(Ie-de)*(Re-be);if(Me<=0||qe<=0)return 0;var Je=Math.max(D,de),Qe=Math.max(W,be),ot=Math.min(X,Ie),vt=Math.min(ae,Re),bt=Math.max(ot-Je,0)*Math.max(vt-Qe,0);return bt/(Me+qe-bt)}function Mf(v,h,u){var d=Math.exp(h*u*u);return u<=v?d:0}function jf(v,h){return v.score-h.score||v.score===h.score&&h.boxIndex-v.boxIndex}function Pl(v,h,u){var d=new Array(v.rank).fill(0),y=v.shape.slice();return h.map(function(D){y[u]=D;var W=v.slice(d,y);return d[u]+=D,W})}function Bf(v,h){for(var u=new Array(v.rank),d=0;d<u.length;d++)u[d]=v.shape[d]*h[d];var y=Ni(u,v.dtype);for(d=0;d<y.values.length;++d){for(var D=y.indexToLoc(d),W=new Array(v.rank),X=0;X<W.length;X++)W[X]=D[X]%v.shape[X];var ae=v.locToIndex(W);y.values[d]=v.values[ae]}return y.toTensor()}function Z(v,h,u,d,y){for(var D=h[h.length-1],W=[v.length/D,D],X=W[0],ae=W[1],de=Yn(u,X*d),be=Yn("int32",X*d),Ie=0;Ie<X;Ie++){for(var Re=Ie*ae,Me=v.subarray(Re,Re+ae),qe=[],Je=0;Je<Me.length;Je++)qe.push({value:Me[Je],index:Je});qe.sort(function(wt,Ft){return Ft.value-wt.value});var Qe=Ie*d,ot=de.subarray(Qe,Qe+d),vt=be.subarray(Qe,Qe+d);for(Je=0;Je<d;Je++)ot[Je]=qe[Je].value,vt[Je]=qe[Je].index}var bt=h.slice();return bt[bt.length-1]=d,[wa(de,bt,u),wa(be,bt,"int32")]}function G(v,h){for(var u=[],d=0;d<h.length;d++)h[d]&&u.push(d);var y=Ni(v,"int32"),D=Ni([u.length,v.length],"int32");for(d=0;d<u.length;d++){var W=y.indexToLoc(u[d]),X=d*v.length;D.values.set(W,X)}return D.toTensor()}function C(v,h){return["x","y","z","w","u","v"].slice(0,h).map(function(u){return v+"."+u})}function N(v,h){return h===1?[v]:C(v,h)}function te(){var v,h,u,d,y,D,W,X,ae,de;return L().getNumber("WEBGL_VERSION")===2?(v="#version 300 es",h="in",u="out",d="in",y="texture",D="outputColor",W="out vec4 outputColor;",X=`
      bool isnan_custom(float val) {
        return (val > 0.0 || val < 0.0) ? false : val != 0.0;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `,ae="",de=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(v="",h="attribute",u="varying",d="varying",y="texture2D",D="gl_FragColor",W="",X=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,ae=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,de=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:v,attribute:h,varyingVs:u,varyingFs:d,texture2D:y,output:D,defineOutput:W,defineSpecialNaN:X,defineSpecialInf:ae,defineRound:de}}function Be(v,h,u){u===void 0&&(u="index");var d=Cr(h);return d.map(function(y,D){return"int "+v[D]+" = "+u+" / "+y+"; "+(D===d.length-1?"int "+v[D+1]+" = "+u+" - "+v[D]+" * "+y:"index -= "+v[D]+" * "+y)+";"}).join("")}function Ge(v){var h=Cr(v).map(function(u){return u.toString()});return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * `+h[0]+" + coords.y * "+h[1]+` + coords.z;
  }
`}var ft=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;function Nt(v,h,u,d){var y=[];v.forEach(function(Me){var qe=Ye(Me.shapeInfo.logicalShape);Me.shapeInfo.isUniform?y.push("uniform float "+Me.name+(qe>1?"["+qe+"]":"")+";"):(y.push("uniform sampler2D "+Me.name+";"),y.push("uniform int offset"+Me.name+";"))});var D,W,X=y.join(`
`),ae=v.map(function(Me){return function(qe,Je,Qe){Qe===void 0&&(Qe=!1);var ot="";ot+=Qe?function wt(Ft){var Yt,an,Jt;switch(Ft.shapeInfo.logicalShape.length){case 0:return Yt=Ft.name,an="get"+Yt.charAt(0).toUpperCase()+Yt.slice(1),Jt=te(),`
    vec4 `+an+`() {
      return `+Jt.texture2D+"("+Yt+`, halfCR);
    }
  `;case 1:return function(un){var gn=un.name,p="get"+gn.charAt(0).toUpperCase()+gn.slice(1),c=un.shapeInfo.texShape,a=[Math.ceil(c[0]/2),Math.ceil(c[1]/2)],l=te();return`
    vec4 `+p+`(int index) {
      vec2 uv = packedUVfrom1D(
        `+a[0]+", "+a[1]+`, index);
      return `+l.texture2D+"("+gn+`, uv);
    }
  `}(Ft);case 2:return function(un){var gn=un.shapeInfo.logicalShape,p=un.name,c="get"+p.charAt(0).toUpperCase()+p.slice(1),a=un.shapeInfo.texShape,l=a[0],g=a[1],_=te();if(a!=null&&ln(gn,a))return`
      vec4 `+c+`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`+g+".0, "+l+`.0);

        return `+_.texture2D+"("+p+`, uv);
      }
    `;var j=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],V=Math.ceil(gn[1]/2);return`
    vec4 `+c+`(int row, int col) {
      vec2 uv = packedUVfrom2D(`+V+", "+j[0]+", "+j[1]+`, row, col);
      return `+_.texture2D+"("+p+`, uv);
    }
  `}(Ft);case 3:return function(un){var gn=un.shapeInfo.logicalShape,p=un.name,c="get"+p.charAt(0).toUpperCase()+p.slice(1),a=un.shapeInfo.texShape,l=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];if(gn[0]===1){var g=gn.slice(1),_=tr(un,g);return`
        `+wt(_)+`
        vec4 `+c+`(int b, int row, int col) {
          return `+c+"("+rr(["b","row","col"],[1,2])+`);
        }
      `}var j=l[0],V=l[1],ne=Math.ceil(gn[2]/2),oe=ne*Math.ceil(gn[1]/2),me=te();return`
    vec4 `+c+`(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        `+j+", "+V+", "+oe+", "+ne+`, b, row, col);
      return `+me.texture2D+"("+p+`, uv);
    }
  `}(Ft);default:return function(un){for(var gn=un.shapeInfo.logicalShape,p=gn.length,c=un.name,a="get"+c.charAt(0).toUpperCase()+c.slice(1),l=un.shapeInfo.texShape,g=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)],_=g[0],j=g[1],V=Math.ceil(gn[p-1]/2),ne=V*Math.ceil(gn[p-2]/2),oe="int b, int row, int col",me="b * "+ne+" + (row / 2) * "+V+" + (col / 2)",Ee=2;Ee<p-1;Ee++)oe="int b"+Ee+", "+oe,ne*=gn[p-Ee-1],me="b"+Ee+" * "+ne+" + "+me;var _e=te();return`
    vec4 `+a+"("+oe+`) {
      int index = `+me+`;
      int texR = index / `+j+`;
      int texC = index - texR * `+j+`;
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+j+", "+_+`);
      return `+_e.texture2D+"("+c+`, uv);
    }
  `}(Ft)}}(qe):function wt(Ft){var Yt=Ft.shapeInfo.logicalShape;switch(Yt.length){case 0:return function(an){var Jt=an.name,un="get"+Jt.charAt(0).toUpperCase()+Jt.slice(1);if(an.shapeInfo.isUniform)return"float "+un+"() {return "+Jt+";}";var gn=an.shapeInfo.texShape,p=gn[0],c=gn[1];if(p===1&&c===1)return`
      float `+un+`() {
        return sampleTexture(`+Jt+`, halfCR);
      }
    `;var a=an.shapeInfo.texShape,l=a[0],g=a[1],_=Nn(Jt);return`
    float `+un+`() {
      vec2 uv = uvFromFlat(`+l+", "+g+", "+_+`);
      return sampleTexture(`+Jt+`, uv);
    }
  `}(Ft);case 1:return function(an){var Jt=an.name,un="get"+Jt.charAt(0).toUpperCase()+Jt.slice(1);if(an.shapeInfo.isUniform)return`
      float `+un+`(int index) {
        `+Wn(an)+`
      }
    `;var gn=an.shapeInfo.texShape,p=gn[0],c=gn[1];if(c===1&&p===1)return`
      float `+un+`(int index) {
        return sampleTexture(`+Jt+`, halfCR);
      }
    `;var a=Nn(Jt);return c===1?`
      float `+un+`(int index) {
        vec2 uv = vec2(0.5, (float(index + `+a+") + 0.5) / "+p+`.0);
        return sampleTexture(`+Jt+`, uv);
      }
    `:p===1?`
      float `+un+`(int index) {
        vec2 uv = vec2((float(index + `+a+") + 0.5) / "+c+`.0, 0.5);
        return sampleTexture(`+Jt+`, uv);
      }
    `:`
    float `+un+`(int index) {
      vec2 uv = uvFromFlat(`+p+", "+c+", index + "+a+`);
      return sampleTexture(`+Jt+`, uv);
    }
  `}(Ft);case 2:return function(an){var Jt=an.shapeInfo.logicalShape,un=an.name,gn="get"+un.charAt(0).toUpperCase()+un.slice(1),p=an.shapeInfo.texShape;if(p!=null&&ln(Jt,p)){var c=p[0],a=p[1];return`
    float `+gn+`(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(`+a+".0, "+c+`.0);
      return sampleTexture(`+un+`, uv);
    }
  `}var l=In(Jt),g=l.newShape,_=l.keptDims,j=g;if(j.length<Jt.length){var V=tr(an,j);return`
      `+wt(V)+`
      float `+gn+`(int row, int col) {
        return `+gn+"("+rr(["row","col"],_)+`);
      }
    `}if(an.shapeInfo.isUniform)return`
      float `+gn+`(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(`+Jt[1]+`, 1)));
        `+Wn(an)+`
      }
    `;var ne=p[0],oe=p[1],me=Nn(un);return oe===1?`
    float `+gn+`(int row, int col) {
      float index = dot(vec3(row, col, `+me+"), vec3("+Jt[1]+`, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / `+ne+`.0);
      return sampleTexture(`+un+`, uv);
    }
  `:ne===1?`
    float `+gn+`(int row, int col) {
      float index = dot(vec3(row, col, `+me+"), vec3("+Jt[1]+`, 1, 1));
      vec2 uv = vec2((index + 0.5) / `+oe+`.0, 0.5);
      return sampleTexture(`+un+`, uv);
    }
  `:`
  float `+gn+`(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * `+Jt[1]+" + col + "+me+`;
    vec2 uv = uvFromFlat(`+ne+", "+oe+`, index);
    return sampleTexture(`+un+`, uv);
  }
`}(Ft);case 3:return function(an){var Jt=an.shapeInfo.logicalShape,un=an.name,gn="get"+un.charAt(0).toUpperCase()+un.slice(1),p=Jt[1]*Jt[2],c=Jt[2],a=In(Jt),l=a.newShape,g=a.keptDims,_=l;if(_.length<Jt.length){var j=tr(an,_);return`
        `+wt(j)+`
        float `+gn+`(int row, int col, int depth) {
          return `+gn+"("+rr(["row","col","depth"],g)+`);
        }
      `}if(an.shapeInfo.isUniform)return`
      float `+gn+`(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(`+p+", "+c+`, 1)));
        `+Wn(an)+`
      }
    `;var V=an.shapeInfo.texShape,ne=V[0],oe=V[1],me=an.shapeInfo.flatOffset;if(oe===p&&me==null)return`
        float `+gn+`(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(`+c+`, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(`+oe+".0, "+ne+`.0);
          return sampleTexture(`+un+`, uv);
        }
      `;if(oe===c&&me==null)return`
    float `+gn+`(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(`+Jt[1]+`, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+oe+".0, "+ne+`.0);
      return sampleTexture(`+un+`, uv);
    }
  `;var Ee=Nn(un);return`
      float `+gn+`(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `+p+" + col * "+c+" + depth + "+Ee+`;
        vec2 uv = uvFromFlat(`+ne+", "+oe+`, index);
        return sampleTexture(`+un+`, uv);
      }
  `}(Ft);case 4:return function(an){var Jt=an.shapeInfo.logicalShape,un=an.name,gn="get"+un.charAt(0).toUpperCase()+un.slice(1),p=Jt[3],c=Jt[2]*p,a=Jt[1]*c,l=In(Jt),g=l.newShape,_=l.keptDims;if(g.length<Jt.length){var j=tr(an,g);return`
      `+wt(j)+`
      float `+gn+`(int row, int col, int depth, int depth2) {
        return `+gn+"("+rr(["row","col","depth","depth2"],_)+`);
      }
    `}if(an.shapeInfo.isUniform)return`
      float `+gn+`(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(`+a+", "+c+", "+p+`, 1)));
        `+Wn(an)+`
      }
    `;var V=an.shapeInfo.flatOffset,ne=an.shapeInfo.texShape,oe=ne[0],me=ne[1];if(me===a&&V==null)return`
      float `+gn+`(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(`+c+", "+p+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+me+".0, "+oe+`.0);
        return sampleTexture(`+un+`, uv);
      }
    `;if(me===p&&V==null)return`
      float `+gn+`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`+Jt[1]*Jt[2]+", "+Jt[2]+`, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+me+".0, "+oe+`.0);
        return sampleTexture(`+un+`, uv);
      }
    `;var Ee=Nn(un);return`
    float `+gn+`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+a+" + col * "+c+` +
          depth * `+p+` + depth2;
      vec2 uv = uvFromFlat(`+oe+", "+me+", index + "+Ee+`);
      return sampleTexture(`+un+`, uv);
    }
  `}(Ft);case 5:return function(an){var Jt=an.shapeInfo.logicalShape,un=an.name,gn="get"+un.charAt(0).toUpperCase()+un.slice(1),p=Jt[4],c=Jt[3]*p,a=Jt[2]*c,l=Jt[1]*a,g=In(Jt),_=g.newShape,j=g.keptDims;if(_.length<Jt.length){var V=tr(an,_);return`
      `+wt(V)+`
      float `+gn+`(int row, int col, int depth, int depth2, int depth3) {
        return `+gn+"("+rr(["row","col","depth","depth2","depth3"],j)+`);
      }
    `}if(an.shapeInfo.isUniform)return`
      float `+gn+`(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(`+l+", "+a+", "+c+", "+p+`)) +
          depth3;
        `+Wn(an)+`
      }
    `;var ne=an.shapeInfo.flatOffset,oe=an.shapeInfo.texShape,me=oe[0],Ee=oe[1];if(Ee===l&&ne==null)return`
      float `+gn+`(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(`+a+", "+c+", "+p+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+Ee+".0, "+me+`.0);
        return sampleTexture(`+un+`, uv);
      }
    `;if(Ee===p&&ne==null)return`
      float `+gn+`(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(`+Jt[1]*Jt[2]*Jt[3]+`,
               `+Jt[2]*Jt[3]+", "+Jt[3]+`, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+Ee+".0, "+me+`.0);
        return sampleTexture(`+un+`, uv);
      }
    `;var _e=Nn(un);return`
    float `+gn+`(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+l+" + col * "+a+" + depth * "+c+` +
          depth2 * `+p+" + depth3 + "+_e+`;
      vec2 uv = uvFromFlat(`+me+", "+Ee+`, index);
      return sampleTexture(`+un+`, uv);
    }
  `}(Ft);case 6:return function(an){var Jt=an.shapeInfo.logicalShape,un=an.name,gn="get"+un.charAt(0).toUpperCase()+un.slice(1),p=In(Jt),c=p.newShape,a=p.keptDims;if(c.length<Jt.length){var l=tr(an,c);return`
      `+wt(l)+`
      float `+gn+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return `+gn+"("+rr(["row","col","depth","depth2","depth3","depth4"],a)+`);
      }
    `}var g=Jt[5],_=Jt[4]*g,j=Jt[3]*_,V=Jt[2]*j,ne=Jt[1]*V;if(an.shapeInfo.isUniform)return`
      float `+gn+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(`+ne+", "+V+", "+j+", "+_+`)) +
          dot(
            vec2(depth3, depth4),
            vec2(`+g+`, 1)));
        `+Wn(an)+`
      }
    `;var oe=an.shapeInfo.flatOffset,me=an.shapeInfo.texShape,Ee=me[0],_e=me[1];if(_e===ne&&oe==null)return`
      float `+gn+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(`+V+", "+j+", "+_+", "+g+`)) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+_e+".0, "+Ee+`.0);
        return sampleTexture(`+un+`, uv);
      }
    `;if(_e===g&&oe==null)return`
      float `+gn+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(`+Jt[1]*Jt[2]*Jt[3]*Jt[4]+`,
               `+Jt[2]*Jt[3]*Jt[4]+`,
               `+Jt[3]*Jt[4]+`,
               `+Jt[4]+`)) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+_e+".0, "+Ee+`.0);
        return sampleTexture(`+un+`, uv);
      }
    `;var Ne=Nn(un);return`
    float `+gn+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+ne+" + col * "+V+" + depth * "+j+` +
          depth2 * `+_+" + depth3 * "+g+" + depth4 + "+Ne+`;
      vec2 uv = uvFromFlat(`+Ee+", "+_e+`, index);
      return sampleTexture(`+un+`, uv);
    }
  `}(Ft);default:throw new Error(Yt.length+"-D input sampling is not yet supported")}}(qe);var vt=qe.shapeInfo.logicalShape,bt=Je.logicalShape;return vt.length<=bt.length&&(ot+=Qe?function(wt,Ft){var Yt,an=wt.name,Jt=an.charAt(0).toUpperCase()+an.slice(1),un="get"+Jt+"AtOutCoords",gn=wt.shapeInfo.logicalShape.length,p=Ft.logicalShape.length,c=Go(wt.shapeInfo.logicalShape,Ft.logicalShape),a=Mn(p),l=p-gn,g=["x","y","z","w","u","v"];Yt=gn===0?"":p<2&&c.length>=1?"coords = 0;":c.map(function(Ee){return"coords."+g[Ee+l]+" = 0;"}).join(`
`);var _;_=p<2&&gn>0?"coords":wt.shapeInfo.logicalShape.map(function(Ee,_e){return"coords."+g[_e+l]}).join(", ");var j="return outputValue;",V=Ye(wt.shapeInfo.logicalShape)===1,ne=Ye(Ft.logicalShape)===1;if(gn!==1||V||ne){if(V&&!ne)j=p===1?`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:`
        return vec4(outputValue.x);
      `;else if(c.length){var oe=gn-2,me=gn-1;c.indexOf(oe)>-1&&c.indexOf(me)>-1?j="return vec4(outputValue.x);":c.indexOf(oe)>-1?j="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":c.indexOf(me)>-1&&(j="return vec4(outputValue.xx, outputValue.zz);")}}else j=`
      return vec4(outputValue.xy, outputValue.xy);
    `;return`
    vec4 `+un+`() {
      `+a+` coords = getOutputCoords();
      `+Yt+`
      vec4 outputValue = get`+Jt+"("+_+`);
      `+j+`
    }
  `}(qe,Je):function(wt,Ft){var Yt=wt.name,an=Yt.charAt(0).toUpperCase()+Yt.slice(1),Jt="get"+an+"AtOutCoords",un=Ft.texShape,gn=wt.shapeInfo.texShape,p=wt.shapeInfo.logicalShape.length,c=Ft.logicalShape.length;if(!wt.shapeInfo.isUniform&&p===c&&wt.shapeInfo.flatOffset==null&&ln(gn,un))return`
      float `+Jt+`() {
        return sampleTexture(`+Yt+`, resultUV);
      }
    `;var a=Mn(c),l=Go(wt.shapeInfo.logicalShape,Ft.logicalShape),g=c-p,_=["x","y","z","w","u","v"];return`
    float `+Jt+`() {
      `+a+` coords = getOutputCoords();
      `+(p===0?"":c<2&&l.length>=1?"coords = 0;":l.map(function(j){return"coords."+_[j+g]+" = 0;"}).join(`
`))+`
      return get`+an+"("+(c<2&&p>0?"coords":wt.shapeInfo.logicalShape.map(function(j,V){return"coords."+_[V+g]}).join(", "))+`);
    }
  `}(qe,Je)),ot}(Me,h,d)}).join(`
`),de=h.texShape,be=te(),Ie=`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return `+be.texture2D+`(textureSampler, uv).r;
    }
  `,Re=function(Me){return Me.version+`
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    `+Me.varyingFs+` vec2 resultUV;
    `+Me.defineOutput+`
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    `+Me.defineSpecialNaN+`
    `+Me.defineSpecialInf+`
    `+Me.defineRound+`

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    `+Ut+`
    `+ct+`
    `+yn+`
  `}(be);return h.isPacked?(D=function(Me,qe){switch(Me.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(wt,Ft){var Yt=[Math.ceil(Ft[0]/2),Math.ceil(Ft[1]/2)];return Yt[0]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * `+Yt[1]+`.0);
      }
    `:Yt[1]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * `+Yt[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+Yt[0]+", "+Yt[1]+`));
      return 2 * (resTexRC.x * `+Yt[1]+` + resTexRC.y);
    }
  `}(0,qe);case 2:return function(wt,Ft){var Yt=[Math.ceil(Ft[0]/2),Math.ceil(Ft[1]/2)];if(ln(wt,Ft))return`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(`+Yt[0]+", "+Yt[1]+`));
      }
    `;var an=Math.ceil(wt[1]/2);return`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+Yt[0]+", "+Yt[1]+`));

      int index = resTexRC.x * `+Yt[1]+` + resTexRC.y;
      int r = 2 * (index / `+an+`);
      int c = imod(index, `+an+`) * 2;

      return ivec2(r, c);
    }
  `}(Me,qe);case 3:return Je=Me,Qe=qe,ot=[Math.ceil(Qe[0]/2),Math.ceil(Qe[1]/2)],bt=(vt=Math.ceil(Je[2]/2))*Math.ceil(Je[1]/2),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+ot[0]+", "+ot[1]+`));
      int index = resTexRC.x * `+ot[1]+` + resTexRC.y;

      int b = index / `+bt+`;
      index -= b * `+bt+`;

      int r = 2 * (index / `+vt+`);
      int c = imod(index, `+vt+`) * 2;

      return ivec3(b, r, c);
    }
  `;default:return function(wt,Ft){for(var Yt=[Math.ceil(Ft[0]/2),Math.ceil(Ft[1]/2)],an=Math.ceil(wt[wt.length-1]/2),Jt=an*Math.ceil(wt[wt.length-2]/2),un=Jt,gn="",p="b, r, c",c=2;c<wt.length-1;c++)gn=`
      int b`+c+" = index / "+(un*=wt[wt.length-c-1])+`;
      index -= b`+c+" * "+un+`;
    `+gn,p="b"+c+", "+p;return`
    ivec`+wt.length+` getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+Yt[0]+", "+Yt[1]+`));
      int index = resTexRC.x * `+Yt[1]+` + resTexRC.y;

      `+gn+`

      int b = index / `+Jt+`;
      index -= b * `+Jt+`;

      int r = 2 * (index / `+an+`);
      int c = imod(index, `+an+`) * 2;

      return ivec`+wt.length+"("+p+`);
    }
  `}(Me,qe)}var Je,Qe,ot,vt,bt}(h.logicalShape,de),W=`
    void setOutput(vec4 val) {
      `+be.output+` = val;
    }
  `):(D=function(Me,qe){switch(Me.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(ot,vt){return vt[0]===1?`
      int getOutputCoords() {
        return int(resultUV.x * `+vt[1]+`.0);
      }
    `:vt[1]===1?`
      int getOutputCoords() {
        return int(resultUV.y * `+vt[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+vt[0]+", "+vt[1]+`));
      return resTexRC.x * `+vt[1]+` + resTexRC.y;
    }
  `}(0,qe);case 2:return function(ot,vt){return ln(ot,vt)?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(`+vt[0]+", "+vt[1]+`));
      }
    `:ot[1]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+vt[0]+", "+vt[1]+`));
        int index = resTexRC.x * `+vt[1]+` + resTexRC.y;
        return ivec2(index, 0);
      }
    `:ot[0]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+vt[0]+", "+vt[1]+`));
        int index = resTexRC.x * `+vt[1]+` + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+vt[0]+", "+vt[1]+`));
      int index = resTexRC.x * `+vt[1]+` + resTexRC.y;
      int r = index / `+ot[1]+`;
      int c = index - r * `+ot[1]+`;
      return ivec2(r, c);
    }
  `}(Me,qe);case 3:return Je=qe,Qe=Be(["r","c","d"],Me),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+Je[0]+", "+Je[1]+`));
      int index = resTexRC.x * `+Je[1]+` + resTexRC.y;
      `+Qe+`
      return ivec3(r, c, d);
    }
  `;case 4:return function(ot,vt){var bt=Be(["r","c","d","d2"],ot);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+vt[0]+", "+vt[1]+`));
      int index = resTexRC.x * `+vt[1]+` + resTexRC.y;
      `+bt+`
      return ivec4(r, c, d, d2);
    }
  `}(Me,qe);case 5:return function(ot,vt){var bt=Be(["r","c","d","d2","d3"],ot);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(`+vt[0]+`,
                             `+vt[1]+`));

      int index = resTexRC.x * `+vt[1]+` + resTexRC.y;

      `+bt+`

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}(Me,qe);case 6:return function(ot,vt){var bt=Be(["r","c","d","d2","d3","d4"],ot);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+vt[0]+", "+vt[1]+`));
      int index = resTexRC.x * `+vt[1]+` + resTexRC.y;

      `+bt+`

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}(Me,qe);default:throw new Error(Me.length+"-D output sampling is not yet supported")}var Je,Qe}(h.logicalShape,de),W=`
    void setOutput(float val) {
      `+be.output+` = vec4(val, 0, 0, 0);
    }
  `),d&&(Re+=_n),[Re,Ie,W,X,D,ae,u].join(`
`)}var Ut=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,ct=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,yn=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,_n=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function Nn(v){return"offset"+v}function Wn(v){var h=v.name,u=Ye(v.shapeInfo.logicalShape);return u<2?"return "+h+";":`
    for (int i = 0; i < `+u+`; i++) {
      if (i == index) {
        return `+h+`[i];
      }
    }
  `}function Mn(v){if(v<=1)return"int";if(v===2)return"ivec2";if(v===3)return"ivec3";if(v===4)return"ivec4";if(v===5)return"ivec5";if(v===6)return"ivec6";throw Error("GPU for rank "+v+" is not yet supported")}function tr(v,h){var u=JSON.parse(JSON.stringify(v));return u.shapeInfo.logicalShape=h,u}function rr(v,h){return h.map(function(u){return v[u]}).join(", ")}var hr=function(v,h,u){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Hi(h,u),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        `+v+`
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `},Nr="return a + b;",Vr="return a - b;",wr="return a * b;",Hr="return (a < 0.) ? b * a : a;",Wr=function(v,h,u){this.variableNames=["A","B"],this.outputShape=Hi(h,u),this.userCode=`
      float binaryOperation(float a, float b) {
        `+v+`
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `},oi=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`,li=function(v,h,u,d){d===void 0&&(d=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Hi(h,u);var y=this.outputShape.length,D="";if(d)if(y===0||Ye(this.outputShape)===1)D=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(D=`
          `+Mn(y)+` coords = getOutputCoords();
        `,y===1)D+=`
            result.y = (coords + 1) >= `+this.outputShape[0]+` ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{var W=N("coords",y);D+=`
            bool nextRowOutOfBounds =
              (`+W[y-2]+" + 1) >= "+this.outputShape[y-2]+`;
            bool nextColOutOfBounds =
              (`+W[y-1]+" + 1) >= "+this.outputShape[y-1]+`;
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        `+v+`
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        `+D+`

        setOutput(result);
      }
    `},$r=function(){function v(h){this.variableNames=["A"],this.outputShape=h,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}return v.prototype.getCustomSetupFunc=function(h,u){var d=this;return function(y,D){d.minLoc==null&&(d.minLoc=y.getUniformLocationNoThrow(D,"minVal"),d.maxLoc=y.getUniformLocationNoThrow(D,"maxVal")),y.gl.uniform1f(d.minLoc,h),y.gl.uniform1f(d.maxLoc,u)}},v}(),Zr=function(){function v(h){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=h,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}return v.prototype.getCustomSetupFunc=function(h,u){var d=this;return function(y,D){d.minLoc==null&&(d.minLoc=y.getUniformLocationNoThrow(D,"minVal"),d.maxLoc=y.getUniformLocationNoThrow(D,"maxVal")),y.gl.uniform1f(d.minLoc,h),y.gl.uniform1f(d.maxLoc,u)}},v}();function pa(v,h,u){var d=v.indexOf(h);return v.map(function(y,D){return D===d?y+" - "+u:y}).join()}var ea=function(v,h,u,d){h===void 0&&(h=!1),u===void 0&&(u=null),d===void 0&&(d=!1),this.variableNames=["x","W"],this.outputShape=v.outShape;var y=v.padInfo.top,D=v.padInfo.left,W=v.strideHeight,X=v.strideWidth,ae=v.dilationHeight,de=v.dilationWidth,be=v.filterHeight,Ie=v.filterWidth,Re=4*Math.floor(v.inChannels/4),Me=v.inChannels%4,qe=v.dataFormat==="channelsLast",Je=qe?1:2,Qe=qe?2:3,ot=qe?3:1,vt="",bt="";u&&(vt=d?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+u+`
        }`:`
          float activation(float x) {
            `+u+`
          }
        `,bt="result = activation(result);");var wt=h?"result += getBiasAtOutCoords();":"";h&&this.variableNames.push("bias"),d&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+vt+`

      const ivec2 strides = ivec2(`+W+", "+X+`);
      const ivec2 pads = ivec2(`+y+", "+D+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[`+ot+`];

        ivec2 xRCCorner =
            ivec2(coords[`+Je+"], coords["+Qe+`]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+be+`; wR++) {
          int xR = xRCorner + wR * `+ae+`;

          if (xR < 0 || xR >= `+v.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+Ie+`; wC++) {
            int xC = xCCorner + wC * `+de+`;

            if (xC < 0 || xC >= `+v.inWidth+`) {
              continue;
            }

            for (int d1 = 0; d1 < `+Re+`; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (`+qe+`) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (`+(Me===1)+`) {

              if (`+qe+`) {
                dotProd +=
                    getX(batch, xR, xC, `+Re+`) *
                    getW(wR, wC, `+Re+`, d2);
              } else {
                dotProd +=
                    getX(batch, `+Re+`, xR, xC) *
                    getW(wR, wC, `+Re+`, d2);
              }

            } else if (`+(Me===2)+`) {
              vec2 wValues = vec2(
                getW(wR, wC, `+Re+`, d2),
                getW(wR, wC, `+Re+` + 1, d2)
              );

              if (`+qe+`) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, `+Re+`),
                  getX(batch, xR, xC, `+Re+` + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, `+Re+`, xR, xC),
                  getX(batch, `+Re+` + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (`+(Me===3)+`) {
              vec3 wValues = vec3(
                getW(wR, wC, `+Re+`, d2),
                getW(wR, wC, `+Re+` + 1, d2),
                getW(wR, wC, `+Re+` + 2, d2)
              );

              if (`+qe+`) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, `+Re+`),
                  getX(batch, xR, xC, `+Re+` + 1),
                  getX(batch, xR, xC, `+Re+` + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, `+Re+`, xR, xC),
                  getX(batch, `+Re+` + 1, xR, xC),
                  getX(batch, `+Re+` + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        `+wt+`
        `+bt+`
        setOutput(result);
      }
    `},La=function(v,h,u,d){h===void 0&&(h=!1),u===void 0&&(u=null),d===void 0&&(d=!1),this.variableNames=["x","W"],this.outputShape=v.outShape;var y=v.inHeight,D=v.inWidth,W=v.padInfo.top,X=v.padInfo.left,ae=v.strideHeight,de=v.strideWidth,be=v.dilationHeight,Ie=v.dilationWidth,Re=v.filterHeight,Me=v.filterWidth,qe=v.outChannels/v.inChannels,Je="",Qe="";u&&(Je=d?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+u+`
        }`:`
          float activation(float x) {
            `+u+`
          }
        `,Qe="result = activation(result);");var ot=h?"result += getBiasAtOutCoords();":"";h&&this.variableNames.push("bias"),d&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+Je+`

      const ivec2 strides = ivec2(`+ae+", "+de+`);
      const ivec2 pads = ivec2(`+W+", "+X+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `+qe+`;
        int q = d2 - d1 * `+qe+`;

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < `+Re+`; wR++) {
          int xR = xRCorner + wR * `+be+`;

          if (xR < 0 || xR >= `+y+`) {
            continue;
          }

          for (int wC = 0; wC < `+Me+`; wC++) {
            int xC = xCCorner + wC * `+Ie+`;

            if (xC < 0 || xC >= `+D+`) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        `+ot+`
        `+Qe+`
        setOutput(result);
      }
    `},Ii=function(v,h,u,d){h===void 0&&(h=!1),u===void 0&&(u=null),d===void 0&&(d=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=v.outShape;for(var y=v.inHeight,D=v.inWidth,W=v.padInfo.top,X=v.padInfo.left,ae=v.strideHeight,de=v.strideWidth,be=v.dilationHeight,Ie=v.dilationWidth,Re=v.filterHeight,Me=v.filterWidth,qe=Me,Je="int xR; int xC; int xCOffset;",Qe=0;Qe<Re;Qe++)for(var ot=0;ot<Me;ot++)Je+=`
          vec4 xTexelR`+Qe+"C"+2*ot+` = vec4(0.);
          vec4 wR`+Qe+"C"+ot+` = vec4(0.);
          vec4 xR`+Qe+"C"+ot+" = vec4(0.);";for(Qe=0;Qe<Re;Qe++)for(var vt=0;vt<qe;vt++){if(Je+=`
          xR = xRCorner + `+Qe*be+`;
          xC = xCCorner + `+(ot=2*vt)*Ie+`;
        `,de===1){if(ot<Me&&(Je+=X%2==1?`
                xCOffset = xC + 1;
                if(xR >= 0 && xR < `+y+" && xCOffset >= 0 && xCOffset < "+D+`) {
                  xTexelR`+Qe+"C"+ot+` = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+D+`) {
                    xTexelR`+Qe+"C"+ot+`.zw = vec2(0.);
                  }
                } else {
                  xTexelR`+Qe+"C"+ot+` = vec4(0.);
                }

                xCOffset = xC + 1 - 2;
                if(xR >= 0 && xR < `+y+" && xCOffset >= 0 && xCOffset < "+D+`) {
                  vec4 previous = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+D+`) {
                    previous.zw = vec2(0.);
                  }

                  xR`+Qe+"C"+ot+" = vec4(previous.zw, xTexelR"+Qe+"C"+ot+`.xy);
                } else {
                  xR`+Qe+"C"+ot+" = vec4(0, 0, xTexelR"+Qe+"C"+ot+`.xy);
                }
              `:`
                if(xR >= 0 && xR < `+y+" && xC >= 0 && xC < "+D+`) {
                  xTexelR`+Qe+"C"+ot+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+Qe+"C"+ot+` = vec4(0.);
                }

                xR`+Qe+"C"+ot+" = xTexelR"+Qe+"C"+ot+`;
              `,ot+1<Me)){var bt=X%2==0?zt(Ie):Ie;Ie%2==0&&X%2==1||Ie%2!=0&&X%2!=1?(Je+=`
                  xCOffset = xC + `+X%2+" + "+bt+`;

                  if(xR >= 0 && xR < `+y+` &&
                    xCOffset >= 0 && xCOffset < `+D+`) {
                    xTexelR`+Qe+"C"+(ot+2)+` = getX(batch, xR, xCOffset, d1);
                  }
                `,Ie>1&&(Je+=`
                    xCOffset -= 2;
                    if(xR >= 0 && xR < `+y+` &&
                      xCOffset >= 0 && xCOffset < `+D+`) {
                      xTexelR`+Qe+"C"+ot+` = getX(batch, xR, xCOffset, d1);
                    } else {
                      xTexelR`+Qe+"C"+ot+` = vec4(0.);
                    }
                  `),Je+=`
                  xR`+Qe+"C"+(ot+1)+` = vec4(
                    xTexelR`+Qe+"C"+ot+".zw, xTexelR"+Qe+"C"+(ot+2)+`.xy);
                `):Je+=`
                  xCOffset = xC + `+bt+`;

                  if(xR >= 0 && xR < `+y+` &&
                    xCOffset >= 0 && xCOffset < `+D+`) {
                    xTexelR`+Qe+"C"+(ot+2)+` = getX(batch, xR, xCOffset, d1);
                  }

                  xR`+Qe+"C"+(ot+1)+" = xTexelR"+Qe+"C"+(ot+2)+`;
                `}}else ot<Me&&(Je+=`
              if(xR >= 0 && xR < `+y+`) {
            `,X%2==1?(Je+=`
                xCOffset = xC + 1 - `+de+`;
                if(xCOffset >= 0 && xCOffset < `+D+`) {
                  xTexelR`+Qe+"C"+ot+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+Qe+"C"+ot+` = vec4(0.);
                }

                if(xC + 1 >= 0 && xC + 1 < `+D+`) {
                  xTexelR`+Qe+"C"+(ot+2)+` = getX(batch, xR, xC + 1, d1);
                } else {
                  xTexelR`+Qe+"C"+(ot+2)+` = vec4(0.);
                }

                xR`+Qe+"C"+ot+` = vec4(
                  xTexelR`+Qe+"C"+ot+".zw, xTexelR"+Qe+"C"+(ot+2)+`.zw);
              `,ot+1<Me&&(Je+=`
                  vec4 final = vec4(0.);
                  xCOffset = xC + 1 + `+de+`;
                  if(xCOffset >= 0 && xCOffset < `+D+`) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xR`+Qe+"C"+(ot+1)+" = vec4(xTexelR"+Qe+"C"+(ot+2)+`.xy, final.xy);
                `)):(Je+=`
                if(xC >= 0 && xC < `+D+`) {
                  xTexelR`+Qe+"C"+ot+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+Qe+"C"+ot+` = vec4(0.);
                }

                xCOffset = xC + `+de+`;
                if(xCOffset >= 0 && xCOffset < `+D+`) {
                  xTexelR`+Qe+"C"+(ot+2)+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+Qe+"C"+(ot+2)+` = vec4(0.);
                }

                xR`+Qe+"C"+ot+` = vec4(
                  xTexelR`+Qe+"C"+ot+".xy, xTexelR"+Qe+"C"+(ot+2)+`.xy);
              `,ot+1<Me&&(Je+=`
                  xR`+Qe+"C"+(ot+1)+` = vec4(
                    xTexelR`+Qe+"C"+ot+".zw, xTexelR"+Qe+"C"+(ot+2)+`.zw);
                `)),Je+="}");ot<Me&&(Je+=`
            vec4 wTexelR`+Qe+"C"+ot+" = getW("+Qe+", "+ot+`, d1, q);
            wR`+Qe+"C"+ot+" = vec4(wTexelR"+Qe+"C"+ot+".xz, wTexelR"+Qe+"C"+ot+`.xz);
          `,ot+1<Me&&(Je+=`
              vec4 wTexelR`+Qe+"C"+(ot+1)+" = getW("+Qe+", "+(ot+1)+`, d1, q);
              wR`+Qe+"C"+(ot+1)+` =
                vec4(wTexelR`+Qe+"C"+(ot+1)+".xz, wTexelR"+Qe+"C"+(ot+1)+".xz);"))}for(Qe=0;Qe<Re;Qe++)for(ot=0;ot<Me;ot++)Je+="dotProd += xR"+Qe+"C"+ot+" * wR"+Qe+"C"+ot+";";var wt="",Ft="";u&&(wt=d?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+u+`
        }`:`vec4 activation(vec4 x) {
          `+u+`
        }`,Ft="result = activation(result);");var Yt=h?"result += getBiasAtOutCoords();":"";h&&this.variableNames.push("bias"),d&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+wt+`

      const ivec2 strides = ivec2(`+ae+", "+de+`);
      const ivec2 pads = ivec2(`+W+", "+X+`);

      void main() {

        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2;
        int q = 0;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        vec4 dotProd = vec4(0.);

        `+Je+`

        vec4 result = dotProd;
        `+Yt+`
        `+Ft+`
        setOutput(result);
      }
    `};function ra(v,h){if(v===1)return""+h;if(v===2)return h+".y";if(v===3)return h+".z";if(v===4)return h+".w";throw Error("Cumulative sum for rank "+v+" is not yet supported")}var Ya=function(){function v(h,u,d){this.variableNames=["x"],this.outputShape=[],this.outputShape=h,this.blockSize=u,this.dataFormat=d,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = `+this.getHeightCoordString()+`;
      int w = `+this.getWidthCoordString()+`;
      int d = `+this.getDepthCoordString()+`;

      int in_h = h / `+u+`;
      int offset_h = imod(h, `+u+`);
      int in_w = w / `+u+`;
      int offset_w = imod(w, `+u+`);
      int offset_d = (offset_h * `+u+` + offset_w) *
        `+this.getOutputDepthSize()+`;
      int in_d = d + offset_d;

      float result = `+this.getInputSamplingString()+`;
      setOutput(result);
    }
  `}return v.prototype.getHeightCoordString=function(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"},v.prototype.getWidthCoordString=function(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"},v.prototype.getDepthCoordString=function(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"},v.prototype.getOutputDepthSize=function(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]},v.prototype.getInputSamplingString=function(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},v}(),Sa=function(v,h,u){this.variableNames=["real","imag"];var d=h[1];this.outputShape=h;var y=u?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,D=u?d+".0":"1.0";this.userCode=`
      const float exponentMultiplier = `+y+`;

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        `+v+`
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(`+d+`);
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < `+d+`; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / `+D+`;
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `},xo=function(){function v(h,u){this.outputShape=[],this.variableNames=["x"],this.outputShape=h,this.userCode=`
      uniform float value;
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}return v.prototype.getCustomSetupFunc=function(h){var u=this;return function(d,y){u.valueLoc==null&&(u.valueLoc=d.getUniformLocationNoThrow(y,"value")),d.gl.uniform1f(u.valueLoc,h)}},v}();function ki(v,h){var u=te();return Zi(v,h,u.version+`
    precision highp float;
    `+u.attribute+` vec3 clipSpacePos;
    `+u.attribute+` vec2 uv;
    `+u.varyingVs+` vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`)}function Ui(v,h){return bc(v,h,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function ha(v,h){return Bu(v,h,new Uint16Array([0,1,2,2,1,3]))}function to(v,h,u,d,y,D,W){Dd(u,d);var X=xc(v,h),ae=v.TEXTURE_2D;return Bn(v,h,function(){return v.bindTexture(ae,X)}),Bn(v,h,function(){return v.texParameteri(ae,v.TEXTURE_WRAP_S,v.CLAMP_TO_EDGE)}),Bn(v,h,function(){return v.texParameteri(ae,v.TEXTURE_WRAP_T,v.CLAMP_TO_EDGE)}),Bn(v,h,function(){return v.texParameteri(ae,v.TEXTURE_MIN_FILTER,v.NEAREST)}),Bn(v,h,function(){return v.texParameteri(ae,v.TEXTURE_MAG_FILTER,v.NEAREST)}),Bn(v,h,function(){return v.texImage2D(ae,0,y,u,d,0,D,W,null)}),Bn(v,h,function(){return v.bindTexture(v.TEXTURE_2D,null)}),X}function Wo(v,h,u,d,y){var D=Qi(u,d);return to(v,h,D[0],D[1],y.internalFormatFloat,y.textureFormatFloat,v.FLOAT)}function io(v,h,u,d,y){var D=Qi(u,d);return to(v,h,D[0],D[1],y.internalFormatHalfFloat,y.textureFormatFloat,y.textureTypeHalfFloat)}function Ja(v,h,u,d,y){var D=Qi(u,d);return to(v,h,D[0],D[1],v.RGBA,v.RGBA,v.UNSIGNED_BYTE)}function fs(v,h,u,d,y){var D=qr(u,d);return to(v,h,D[0],D[1],y.internalFormatPackedFloat,v.RGBA,v.FLOAT)}function fo(v,h,u,d,y){var D=qr(u,d);return to(v,h,D[0],D[1],y.internalFormatPackedHalfFloat,v.RGBA,y.textureTypeHalfFloat)}function va(v,h,u,d){return Bn(v,h,function(){return v.bindBuffer(v.ARRAY_BUFFER,d)}),vf(v,h,u,"clipSpacePos",d,3,20,0)&&vf(v,h,u,"uv",d,2,20,12)}function ho(v,h,u,d,y,D,W){var X,ae,de;Bn(v,h,function(){return v.bindTexture(v.TEXTURE_2D,u)}),D instanceof Uint8Array?(X=new Uint8Array(d*y*4),ae=v.UNSIGNED_BYTE,de=v.RGBA):(X=new Float32Array(d*y*4),ae=v.FLOAT,de=W.internalFormatPackedFloat),X.set(D),Bn(v,h,function(){return v.texImage2D(v.TEXTURE_2D,0,de,d,y,0,v.RGBA,ae,X)}),Bn(v,h,function(){return v.bindTexture(v.TEXTURE_2D,null)})}function cu(v,h,u,d){Bn(v,h,function(){return v.bindTexture(v.TEXTURE_2D,u)}),d.data instanceof Uint8Array?Bn(v,h,function(){return v.texImage2D(v.TEXTURE_2D,0,v.RGBA,d.width,d.height,0,v.RGBA,v.UNSIGNED_BYTE,d.data)}):Bn(v,h,function(){return v.texImage2D(v.TEXTURE_2D,0,v.RGBA,v.RGBA,v.UNSIGNED_BYTE,d)}),Bn(v,h,function(){return v.bindTexture(v.TEXTURE_2D,null)})}function As(v,h,u,d,y){var D=v.createBuffer();Bn(v,h,function(){return v.bindBuffer(v.PIXEL_PACK_BUFFER,D)});var W=16*u*d;return Bn(v,h,function(){return v.bufferData(v.PIXEL_PACK_BUFFER,W,v.STREAM_READ)}),Bn(v,h,function(){return v.readPixels(0,0,d,u,v.RGBA,v.FLOAT,0)}),Bn(v,h,function(){return v.bindBuffer(v.PIXEL_PACK_BUFFER,null)}),D}function So(v,h,u){var d=v,y=new Float32Array(u);return d.bindBuffer(d.PIXEL_PACK_BUFFER,h),d.getBufferSubData(d.PIXEL_PACK_BUFFER,0,y),d.bindBuffer(d.PIXEL_PACK_BUFFER,null),y}function Ma(v,h,u,d,y){var D=Qi(u,d),W=D[0],X=D[1],ae=new Uint8Array(u*d*4);return Bn(v,h,function(){return v.readPixels(0,0,W,X,y.downloadTextureFormat,v.UNSIGNED_BYTE,ae)}),new Float32Array(ae.buffer)}function cc(v,h,u,d,y,D,W,X){var ae=v,de=new Float32Array(function(be,Ie){var Re=qr(D,W);return Re[0]*Re[1]*4}());return ae.bindBuffer(ae.PIXEL_PACK_BUFFER,h),ae.getBufferSubData(ae.PIXEL_PACK_BUFFER,0,de),ae.bindBuffer(ae.PIXEL_PACK_BUFFER,null),de}function Vo(v,h,u,d){var y=new Float32Array(u*d*4);return Bn(v,h,function(){return v.readPixels(0,0,d,u,v.RGBA,v.FLOAT,y)}),y}var lu=Object.freeze({createVertexShader:ki,createVertexBuffer:Ui,createIndexBuffer:ha,createFloat32MatrixTexture:Wo,createFloat16MatrixTexture:io,createUnsignedBytesMatrixTexture:Ja,createPackedMatrixTexture:fs,createFloat16PackedMatrixTexture:fo,bindVertexProgramAttributeStreams:va,uploadDenseMatrixToTexture:ho,uploadPixelDataToTexture:cu,createBufferFromOutputTexture:As,downloadFloat32MatrixFromBuffer:So,downloadByteEncodedFloatMatrixFromOutputTexture:Ma,downloadPackedMatrixFromBuffer:cc,downloadMatrixFromPackedOutputTexture:Vo}),ao=function(){function v(h){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var u=L().getNumber("WEBGL_VERSION");h!=null?(this.gl=h,la(u,h)):this.gl=ui(u);var d="WEBGL_color_buffer_float";if(L().getNumber("WEBGL_VERSION")===1){if(this.textureFloatExtension=ma(this.gl,this.debug,"OES_texture_float"),lo(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=ma(this.gl,this.debug,"OES_texture_half_float");else if(L().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(d),lo(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=ma(this.gl,this.debug,"EXT_color_buffer_half_float");else if(L().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(d="EXT_color_buffer_float",lo(this.gl,d))this.colorBufferFloatExtension=this.gl.getExtension(d);else{if(!lo(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=Ui(this.gl,this.debug),this.indexBuffer=ha(this.gl,this.debug),this.framebuffer=os(this.gl,this.debug),this.textureConfig=jr(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(v.prototype,"debug",{get:function(){return L().getBool("DEBUG")},enumerable:!0,configurable:!0}),v.prototype.dispose=function(){var h=this;if(!this.disposed){this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var u=this.gl;Bn(u,this.debug,function(){return u.finish()}),Bn(u,this.debug,function(){return u.bindFramebuffer(u.FRAMEBUFFER,null)}),Bn(u,this.debug,function(){return u.deleteFramebuffer(h.framebuffer)}),Bn(u,this.debug,function(){return u.bindBuffer(u.ARRAY_BUFFER,null)}),Bn(u,this.debug,function(){return u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,null)}),Bn(u,this.debug,function(){return u.deleteBuffer(h.indexBuffer)}),this.disposed=!0}},v.prototype.createFloat32MatrixTexture=function(h,u){return this.throwIfDisposed(),Wo(this.gl,this.debug,h,u,this.textureConfig)},v.prototype.createFloat16MatrixTexture=function(h,u){return this.throwIfDisposed(),io(this.gl,this.debug,h,u,this.textureConfig)},v.prototype.createUnsignedBytesMatrixTexture=function(h,u){return this.throwIfDisposed(),Ja(this.gl,this.debug,h,u,this.textureConfig)},v.prototype.uploadPixelDataToTexture=function(h,u){this.throwIfDisposed(),cu(this.gl,this.debug,h,u)},v.prototype.uploadDenseMatrixToTexture=function(h,u,d,y){this.throwIfDisposed(),ho(this.gl,this.debug,h,u,d,y,this.textureConfig)},v.prototype.createFloat16PackedMatrixTexture=function(h,u){return this.throwIfDisposed(),fo(this.gl,this.debug,h,u,this.textureConfig)},v.prototype.createPackedMatrixTexture=function(h,u){return this.throwIfDisposed(),fs(this.gl,this.debug,h,u,this.textureConfig)},v.prototype.deleteMatrixTexture=function(h){var u=this;this.throwIfDisposed(),this.outputTexture===h&&(El(this.gl,this.debug,this.framebuffer),this.outputTexture=null),Bn(this.gl,this.debug,function(){return u.gl.deleteTexture(h)})},v.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(h,u,d){var y=this;return this.downloadMatrixDriver(h,function(){return Ma(y.gl,y.debug,u,d,y.textureConfig)})},v.prototype.downloadPackedMatrixFromBuffer=function(h,u,d,y,D,W){return cc(this.gl,h,0,0,0,D,W,this.textureConfig)},v.prototype.downloadFloat32MatrixFromBuffer=function(h,u){return So(this.gl,h,u)},v.prototype.createBufferFromTexture=function(h,u,d){this.bindTextureToFrameBuffer(h);var y=As(this.gl,this.debug,u,d,this.textureConfig);return this.unbindTextureToFrameBuffer(),y},v.prototype.createAndWaitForFence=function(){var h=this.createFence(this.gl);return this.pollFence(h)},v.prototype.createFence=function(h){var u,d,y=this;if(L().getBool("WEBGL_FENCE_API_ENABLED")){var D=h,W=D.fenceSync(D.SYNC_GPU_COMMANDS_COMPLETE,0);h.flush(),d=function(){var X=D.clientWaitSync(W,0,0);return X===D.ALREADY_SIGNALED||X===D.CONDITION_SATISFIED},u=W}else L().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(u=this.beginQuery(),this.endQuery(),d=function(){return y.isQueryAvailable(u,L().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):d=function(){return!0};return{query:u,isFencePassed:d}},v.prototype.downloadMatrixFromPackedTexture=function(h,u,d){var y=this;return this.downloadMatrixDriver(h,function(){return Vo(y.gl,y.debug,u,d)})},v.prototype.createProgram=function(h){this.throwIfDisposed();var u=this.gl,d=ga(u,this.debug,h),y=ki(u,this.debug),D=qi(u,this.debug);return Bn(u,this.debug,function(){return u.attachShader(D,y)}),Bn(u,this.debug,function(){return u.attachShader(D,d)}),ec(u,this.debug,D),this.debug&&bu(u,this.debug,D),this.vertexAttrsAreBound||(this.setProgram(D),this.vertexAttrsAreBound=va(u,this.debug,this.program,this.vertexBuffer)),D},v.prototype.deleteProgram=function(h){var u=this;this.throwIfDisposed(),h===this.program&&(this.program=null),h!=null&&Bn(this.gl,this.debug,function(){return u.gl.deleteProgram(h)})},v.prototype.setProgram=function(h){var u=this;this.throwIfDisposed(),this.program=h,this.program!=null&&this.debug&&bu(this.gl,this.debug,this.program),Bn(this.gl,this.debug,function(){return u.gl.useProgram(h)})},v.prototype.getUniformLocation=function(h,u,d){return d===void 0&&(d=!0),this.throwIfDisposed(),d?Pu(this.gl,this.debug,h,u):yf(this.gl,h,u)},v.prototype.getAttributeLocation=function(h,u){var d=this;return this.throwIfDisposed(),Bn(this.gl,this.debug,function(){return d.gl.getAttribLocation(h,u)})},v.prototype.getUniformLocationNoThrow=function(h,u){return this.throwIfDisposed(),this.gl.getUniformLocation(h,u)},v.prototype.setInputMatrixTexture=function(h,u,d){this.throwIfDisposed(),this.throwIfNoProgram(),Ch(this.gl,this.debug,this.program,h,u,d)},v.prototype.setOutputMatrixTexture=function(h,u,d){this.setOutputMatrixTextureDriver(h,d,u)},v.prototype.setOutputPackedMatrixTexture=function(h,u,d){this.throwIfDisposed();var y=qr(u,d),D=y[0],W=y[1];this.setOutputMatrixTextureDriver(h,D,W)},v.prototype.setOutputMatrixWriteRegion=function(h,u,d,y){this.setOutputMatrixWriteRegionDriver(d,h,y,u)},v.prototype.setOutputPackedMatrixWriteRegion=function(h,u,d,y){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},v.prototype.debugValidate=function(){this.program!=null&&bu(this.gl,this.debug,this.program),Io(this.gl)},v.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var h=this.gl;this.debug&&this.debugValidate(),Bn(h,this.debug,function(){return h.drawElements(h.TRIANGLES,6,h.UNSIGNED_SHORT,0)})},v.prototype.blockUntilAllProgramsCompleted=function(){var h=this;this.throwIfDisposed(),Bn(this.gl,this.debug,function(){return h.gl.finish()})},v.prototype.getQueryTimerExtension=function(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=ma(this.gl,this.debug,L().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},v.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},v.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},v.prototype.beginQuery=function(){if(L().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var h=this.gl,u=this.getQueryTimerExtensionWebGL2(),d=h.createQuery();return h.beginQuery(u.TIME_ELAPSED_EXT,d),d}var y=this.getQueryTimerExtensionWebGL1(),D=y.createQueryEXT();return y.beginQueryEXT(y.TIME_ELAPSED_EXT,D),D},v.prototype.endQuery=function(){if(L().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")!==2){var h=this.getQueryTimerExtensionWebGL1();h.endQueryEXT(h.TIME_ELAPSED_EXT)}else{var u=this.gl,d=this.getQueryTimerExtensionWebGL2();u.endQuery(d.TIME_ELAPSED_EXT)}},v.prototype.waitForQueryAndGetTime=function(h){return R(this,void 0,void 0,function(){var u=this;return P(this,function(d){switch(d.label){case 0:return[4,Dt(function(){return u.disposed||u.isQueryAvailable(h,L().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return d.sent(),[2,this.getQueryTime(h,L().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},v.prototype.getQueryTime=function(h,u){if(u===0)return null;if(u===2){var d=this.gl;return d.getQueryParameter(h,d.QUERY_RESULT)/1e6}var y=this.getQueryTimerExtensionWebGL1();return y.getQueryObjectEXT(h,y.QUERY_RESULT_EXT)/1e6},v.prototype.isQueryAvailable=function(h,u){if(u===0)return!0;if(u===2){var d=this.gl,y=this.getQueryTimerExtensionWebGL2(),D=d.getQueryParameter(h,d.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(y.GPU_DISJOINT_EXT)),D&&!this.disjoint}return D=(y=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(h,y.QUERY_RESULT_AVAILABLE_EXT),this.disjoint==null&&(this.disjoint=this.gl.getParameter(y.GPU_DISJOINT_EXT)),D&&!this.disjoint},v.prototype.pollFence=function(h){var u=this;return new Promise(function(d){u.addItemToPoll(function(){return h.isFencePassed()},function(){return d()})})},v.prototype.pollItems=function(){for(var h=function(d){for(var y=0;y<d.length&&d[y]();++y);return y-1}(this.itemsToPoll.map(function(d){return d.isDoneFn})),u=0;u<=h;++u)(0,this.itemsToPoll[u].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(h+1)},v.prototype.addItemToPoll=function(h,u){var d=this;this.itemsToPoll.push({isDoneFn:h,resolveFn:u}),this.itemsToPoll.length>1||Dt(function(){return d.pollItems(),d.itemsToPoll.length===0})},v.prototype.bindTextureToFrameBuffer=function(h){this.throwIfDisposed(),wc(this.gl,this.debug,h,this.framebuffer),this.debug&&Io(this.gl)},v.prototype.unbindTextureToFrameBuffer=function(){this.outputTexture!=null?(wc(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&Io(this.gl)):El(this.gl,this.debug,this.framebuffer)},v.prototype.downloadMatrixDriver=function(h,u){this.bindTextureToFrameBuffer(h);var d=u();return this.unbindTextureToFrameBuffer(),d},v.prototype.setOutputMatrixTextureDriver=function(h,u,d){this.throwIfDisposed();var y=this.gl;wc(y,this.debug,h,this.framebuffer),this.debug&&Io(y),this.outputTexture=h,Bn(y,this.debug,function(){return y.viewport(0,0,u,d)}),Bn(y,this.debug,function(){return y.scissor(0,0,u,d)})},v.prototype.setOutputMatrixWriteRegionDriver=function(h,u,d,y){var D=this;this.throwIfDisposed(),Bn(this.gl,this.debug,function(){return D.gl.scissor(h,u,d,y)})},v.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},v.prototype.throwIfNoProgram=function(){if(this.program==null)throw new Error("No GPU program is currently set.")},v}();function fu(v,h){if(v.length!==h.length)throw Error("Binary was compiled with "+v.length+" inputs, but was executed with "+h.length+" inputs");v.forEach(function(u,d){var y=u.logicalShape,D=h[d],W=D.shape;if(!ln(y,W))throw Error("Binary was compiled with different shapes than the current args. Shapes "+y+" and "+W+" must match");if(!u.isUniform||!D.isUniform){var X=u.texShape,ae=D.isUniform?null:D.texData.texShape;if(!ln(X,ae))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+X+" and "+ae+" must match")}})}var Ia=function(v,h,u,d,y,D,W){u===void 0&&(u=!1),d===void 0&&(d=!1),y===void 0&&(y=!1),D===void 0&&(D=null),W===void 0&&(W=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=h;var X=u?v[1]:v[2],ae=Math.ceil(X/2),de=u?"i * 2, rc.y":"rc.y, i * 2",be=d?"rc.z, i * 2":"i * 2, rc.z",Ie=u?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],Re=d?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],Me="",qe="";D&&(Me=W?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+D+`
        }`:`vec4 activation(vec4 x) {
          `+D+`
        }`,qe="result = activation(result);");var Je=y?"result += getBiasAtOutCoords();":"";y&&this.variableNames.push("bias"),W&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+Me+`

      const float sharedDimension = `+ae+`.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < `+ae+`; i++) {
          vec4 a = getMatrixA(rc.x, `+de+`);
          vec4 b = getMatrixB(rc.x, `+be+`);

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (`+Ie[0]+" * "+Re[0]+`);
          result += (`+Ie[1]+" * "+Re[1]+`);
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        `+Je+`

        `+qe+`

        setOutput(result);
      }
    `},_s=function(){function v(h,u,d){this.variableNames=["probs"],this.outputShape=[h,d],this.userCode=`
      uniform float seed;

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < `+(u-1)+`; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(`+(u-1)+`));
      }
    `}return v.prototype.getCustomSetupFunc=function(h){var u=this;return function(d,y){u.seedLoc==null&&(u.seedLoc=d.getUniformLocation(y,"seed")),d.gl.uniform1f(u.seedLoc,h)}},v}(),hs=function(v,h,u){if(this.variableNames=["x"],h==="avg"&&u)throw new Error("Cannot compute positions for average pool.");var d=v.filterWidth,y=v.strideHeight,D=v.strideWidth,W=v.dilationHeight,X=v.dilationWidth,ae=v.effectiveFilterHeight,de=v.effectiveFilterWidth,be=v.padInfo.top,Ie=v.padInfo.left;this.outputShape=v.outShape;var Re=h==="avg",Me="0.0";if(Re||(Me="-1.0 / 1e-20"),u)this.userCode=`
        const ivec2 strides = ivec2(`+y+", "+D+`);
        const ivec2 pads = ivec2(`+be+", "+Ie+`);

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < `+ae+`;
              wR += `+W+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+v.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+de+`;
                wC += `+X+`) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= `+v.inWidth+`) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value >= currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = wR * `+de+` + wC;
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var qe=h+"("+h+"("+h+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";h==="avg"&&(qe="avgValue / count");var Je=4*Math.floor(d/4),Qe=d%4,ot=`
      if (`+Re+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(`+y+", "+D+`);
      const ivec2 pads = ivec2(`+be+", "+Ie+`);
      const float initializationValue = `+Me+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= `+v.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+Me+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < `+ae+`;
            wR += `+W+`) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= `+v.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+Je+`; wC += 4) {
            int xC = xCCorner + wC * `+X+`;

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+X+`, d),
              getValue(batch, xR, xC + 2 * `+X+`, d),
              getValue(batch, xR, xC + 3 * `+X+`, d)
            );

            `+ot+`
          }

          int xC = xCCorner + `+Je+`;
          if (`+(Qe===1)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            `+ot+`
          } else if (`+(Qe===2)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+X+`, d),
              initializationValue,
              initializationValue
            );

            `+ot+`
          } else if (`+(Qe===3)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+X+`, d),
              getValue(batch, xR, xC + 2 * `+X+`, d),
              initializationValue
            );

            `+ot+`
          }
        }
        setOutput(`+qe+`);
      }
    `}},ia=function(v,h,u){if(this.variableNames=["x"],h==="avg"&&u)throw new Error("Cannot compute positions for average pool.");var d=v.filterWidth,y=v.strideDepth,D=v.strideHeight,W=v.strideWidth,X=v.dilationDepth,ae=v.dilationHeight,de=v.dilationWidth,be=v.effectiveFilterDepth,Ie=v.effectiveFilterHeight,Re=v.effectiveFilterWidth,Me=v.padInfo.front,qe=v.padInfo.top,Je=v.padInfo.left;this.outputShape=v.outShape;var Qe=h==="avg",ot="0.0";if(Qe||(ot="-1.0 / 1e-20"),u)this.userCode=`
        const ivec3 strides =
            ivec3(`+y+", "+D+", "+W+`);
        const ivec3 pads = ivec3(`+Me+", "+qe+", "+Je+`);

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < `+be+`;
              wD += `+X+`) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= `+v.inDepth+`) {
              continue;
            }

            for (int wR = 0; wR < `+Ie+`;
                wR += `+ae+`) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= `+v.inHeight+`) {
                continue;
              }

              for (int wC = 0; wC < `+Re+`;
                  wC += `+de+`) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= `+v.inWidth+`) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value >= currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition =
                      wD * `+Ie+" * "+Re+` +
                      wR * `+Re+` + wC;;
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var vt=h+"("+h+"("+h+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";h==="avg"&&(vt="avgValue / count");var bt=4*Math.floor(d/4),wt=d%4,Ft=`
      if (`+Qe+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(`+y+", "+D+", "+W+`);
      const ivec3 pads = ivec3(`+Me+", "+qe+", "+Je+`);
      const float initializationValue = `+ot+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= `+v.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+ot+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < `+be+`;
            wD += `+X+`) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= `+v.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+Ie+`;
            wR += `+ae+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+v.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+bt+`; wC += 4) {
              int xC = xCCorner + wC * `+de+`;

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+de+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+de+`, ch),
                getValue(batch, xD, xR, xC + 3 * `+de+`, ch)
              );

              `+Ft+`
            }

            int xC = xCCorner + `+bt+`;
            if (`+(wt===1)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              `+Ft+`
            } else if (`+(wt===2)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+de+`, ch),
                initializationValue,
                initializationValue
              );

              `+Ft+`
            } else if (`+(wt===3)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+de+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+de+`, ch),
                initializationValue
              );

              `+Ft+`
            }
          }
          setOutput(`+vt+`);
        }
      }
    `}},Ss=function(v,h,u,d,y,D,W){this.variableNames=["updates","indices","defaultValue"],this.outputShape=D;var X=Mn(y.length),ae=Mn(D.length),de="";u===1?de="i":u===2&&(de="i, j");var be="getIndices("+de+")",Ie="";d===1?Ie="i":d===2&&(Ie="i, coords[1]");var Re="getUpdates("+Ie+")",Me=h>1?"strides[j]":"strides";this.userCode=`
        `+X+" strides = "+X+"("+y+`);

        void main() {
          `+ae+` coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < `+v+`; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < `+h+`; j++) {
              int index = round(`+be+`);
              flattenedIndex += index * `+Me+`;
            }
            if (flattenedIndex == coords[0]) {
              sum += `+Re+`;
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `},Ko=function(){function v(h){this.variableNames=["source"],this.outputShape=h,this.rank=h.length;var u,d=Mn(this.rank),y="uniform int start["+this.rank+"];",D=function(W){if(W===1)return"sourceLoc";if(W<=6)return Gs.slice(0,W).map(function(X){return"sourceLoc."+X}).join(",");throw Error("Slicing for rank "+W+" is not yet supported")}(this.rank);u=`
        `+d+` sourceLoc;
        `+d+` coords = getOutputCoords();
        `+h.map(function(W,X){return"sourceLoc."+Gs[X]+" = start["+X+"] + coords."+Gs[X]+";"}).join(`
`)+`
      `,this.userCode=`
      `+y+`
      void main() {
        `+u+`
        setOutput(getSource(`+D+`));
      }
    `}return v.prototype.getCustomSetupFunc=function(h){var u=this;if(h.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+h.length+")");return function(d,y){u.startLoc==null&&(u.startLoc=d.getUniformLocationNoThrow(y,"start"),u.startLoc==null)||d.gl.uniform1iv(u.startLoc,h)}},v}(),Gs=["x","y","z","w","u","v"],_c=function(){function v(h){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=h,this.rank=h.length;var u=Mn(this.rank),d=N("coords",this.rank),y=N("sourceLoc",this.rank),D=this.rank===1?"sourceLoc":"vec2("+y.slice(-2).join()+")",W="getChannel(getSource("+y.join()+"), "+D+")",X=`
      result.x = `+W+`;
      if (++`+d[this.rank-1]+" < "+h[this.rank-1]+`) {
        ++`+y[this.rank-1]+`;
        result.y = `+W+`;
        --`+y[this.rank-1]+`;
      }
    `,ae=this.rank===1?"":`
      --`+d[this.rank-1]+`;
      if (++`+d[this.rank-2]+" < "+h[this.rank-2]+`) {
        ++`+y[this.rank-2]+`;
        result.z = `+W+`;
        if (++`+d[this.rank-1]+" < "+h[this.rank-1]+`) {
          ++`+y[this.rank-1]+`;
          result.w = `+W+`;
        }
      }
    `,de=this.rank<=4?`sourceLoc = coords +
            `+u+"("+h.map(function(be,Ie){return"start["+Ie+"]"}).join()+");":h.map(function(be,Ie){return y[Ie]+" = "+d[Ie]+" + start["+Ie+"];"}).join(`
`);this.userCode=`
      uniform int start[`+this.rank+`];
      void main() {
        `+u+` coords = getOutputCoords();
        `+u+` sourceLoc;
        `+de+`
        vec4 result = vec4(0.);
        `+X+`
        `+ae+`
        setOutput(result);
      }
    `}return v.prototype.getCustomSetupFunc=function(h){var u=this;if(h.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+h.length+")");return function(d,y){u.startLoc==null&&(u.startLoc=d.getUniformLocationNoThrow(y,"start"),u.startLoc==null)||d.gl.uniform1iv(u.startLoc,h)}},v}(),za=function(){function v(h){this.gpgpu=h,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return v.prototype.acquireTexture=function(h,u,d){var y,D=es(u,d),W=Mo(h,D,d);if(W in this.freeTextures||(this.freeTextures[W]=[]),W in this.usedTextures||(this.usedTextures[W]=[]),this.freeTextures[W].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var X=this.freeTextures[W].shift();return this.usedTextures[W].push(X),X}return this.numUsedTextures++,this.log(),D===zr.PACKED_2X2_FLOAT32?y=this.gpgpu.createPackedMatrixTexture(h[0],h[1]):D===zr.PACKED_2X2_FLOAT16?y=this.gpgpu.createFloat16PackedMatrixTexture(h[0],h[1]):D===zr.UNPACKED_FLOAT32?y=this.gpgpu.createFloat32MatrixTexture(h[0],h[1]):D===zr.UNPACKED_FLOAT16?y=this.gpgpu.createFloat16MatrixTexture(h[0],h[1]):D===zr.PACKED_4X1_UNSIGNED_BYTE&&(y=this.gpgpu.createUnsignedBytesMatrixTexture(h[0],h[1])),this.usedTextures[W].push(y),y},v.prototype.releaseTexture=function(h,u,d,y){if(this.freeTextures!=null){var D=Mo(u,es(d,y),y);D in this.freeTextures||(this.freeTextures[D]=[]),this.freeTextures[D].push(h),this.numFreeTextures++,this.numUsedTextures--;var W=this.usedTextures[D],X=W.indexOf(h);if(X<0)throw new Error("Cannot release a texture that was never provided by this texture manager");W.splice(X,1),this.log()}},v.prototype.log=function(){if(this.logEnabled){var h=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+h+")")}},v.prototype.getNumUsedTextures=function(){return this.numUsedTextures},v.prototype.getNumFreeTextures=function(){return this.numFreeTextures},v.prototype.dispose=function(){var h=this;if(this.freeTextures!=null){for(var u in this.freeTextures)this.freeTextures[u].forEach(function(d){h.gpgpu.deleteMatrixTexture(d)});for(var u in this.usedTextures)this.usedTextures[u].forEach(function(y){h.gpgpu.deleteMatrixTexture(y)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},v}();function es(v,h){if(v===ir.UPLOAD)return zr.PACKED_2X2_FLOAT32;if(v===ir.RENDER||v==null)return function(u){return L().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?u?zr.PACKED_2X2_FLOAT32:zr.UNPACKED_FLOAT32:u?zr.PACKED_2X2_FLOAT16:zr.UNPACKED_FLOAT16}(h);if(v===ir.DOWNLOAD||v===ir.PIXELS)return zr.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+v)}function Mo(v,h,u){return v[0]+"_"+v[1]+"_"+h+"_"+u}var lc=1.7580993408473768,el=1.0507009873554805,ci=function(v,h){this.variableNames=["A"],this.outputShape=v,this.userCode=`
      float unaryOperation(float x) {
        `+h+`
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `},Xd="if (isnan(x)) return x;",tl="return x;",Ll="return abs(x);",vg=Xd+`
  return (x < 0.0) ? 0.0 : x;
`,yg=Xd+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Cm="return (x >= 0.0) ? x : (exp(x) - 1.0);",Om="return -x;",bg="return ceil(x);",Am="return floor(x);",xg="return exp(x);",Pf="return exp(x) - 1.0;",Yd="return x;",wg="return x;",kg=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Eg=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Sc=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,Lf=function(v,h){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=v,this.userCode=`
      vec4 unaryOperation(vec4 x) {
        `+h+`
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `},Jd={};function _m(v,h){if(h===void 0&&(h=!1),v==="linear")return h?wg:tl;if(v==="relu")return h?kg:vg;if(v==="elu")return h?Sc:Cm;if(v==="relu6")return h?Eg:yg;if(v==="prelu")return h?oi:Hr;throw new Error("Activation "+v+" has not been implemented for the WebGL backend.")}var Sm=600,Tv=function(v){function h(u){var d,y=v.call(this)||this;if(y.pendingRead=new WeakMap,y.pendingDisposal=new WeakSet,y.dataRefCount=new WeakMap,y.numBytesInGPU=0,y.uploadWaitMs=0,y.downloadWaitMs=0,y.warnedAboutMemory=!1,y.pendingDeletes=0,y.disposed=!1,!L().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(u==null){var D=ui(L().getNumber("WEBGL_VERSION"));y.binaryCache=((d=L().getNumber("WEBGL_VERSION"))in Jd||(Jd[d]={}),Jd[d]),y.gpgpu=new ao(D),y.canvas=D.canvas,y.gpgpuCreatedLocally=!0}else y.gpgpu=u,y.binaryCache={},y.gpgpuCreatedLocally=!1,y.canvas=u.gl.canvas;return y.textureManager=new za(y.gpgpu),y.numMBBeforeWarning=L().global.screen==null?1024:L().global.screen.height*L().global.screen.width*window.devicePixelRatio*Sm/1024/1024,y.texData=new Bl(y,Ve),y}return J(h,v),h.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},h.prototype.write=function(u,d,y){if(L().getBool("DEBUG")&&this.checkNumericalProblems(u),y==="complex64"&&u!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var D={};return this.texData.set(D,{shape:d,dtype:y,values:u,usage:ir.UPLOAD}),D},h.prototype.move=function(u,d,y,D){if(L().getBool("DEBUG")&&this.checkNumericalProblems(d),D==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(u,{shape:y,dtype:D,values:d,usage:ir.UPLOAD})},h.prototype.readSync=function(u){var d=this.texData.get(u),y=d.values,D=d.dtype,W=d.complexTensors,X=d.slice,ae=d.shape,de=d.isPacked;if(X!=null){var be;be=de?new Lf(ae,Yd):new ci(ae,Yd);var Ie=this.runWebGLProgram(be,[{dataId:u,shape:ae,dtype:D}],D),Re=this.readSync(Ie.dataId);return this.disposeData(Ie.dataId),Re}if(y!=null)return this.convertAndCacheOnCPU(u);if(D==="string")return y;var Me,qe,Je=this.activeTimers!=null;return Je&&(Me=nn()),qe=D==="complex64"?Cu(W.real.dataSync(),W.imag.dataSync()):this.getValuesFromTexture(u),Je&&(this.downloadWaitMs+=nn()-Me),this.convertAndCacheOnCPU(u,qe)},h.prototype.read=function(u){return R(this,void 0,void 0,function(){var d,y,D,W,X,ae,de,be,Ie,Re,Me,qe,Je,Qe,ot,vt,bt,wt,Ft,Yt,an,Jt;return P(this,function(un){switch(un.label){case 0:if(this.pendingRead.has(u))return d=this.pendingRead.get(u),[2,new Promise(function(gn){return d.push(gn)})];if(y=this.texData.get(u),D=y.values,W=y.shape,X=y.slice,ae=y.dtype,de=y.complexTensors,be=y.isPacked,X!=null)return Ie=void 0,Ie=be?new Lf(W,Yd):new ci(W,Yd),Re=this.runWebGLProgram(Ie,[{dataId:u,shape:W,dtype:ae}],ae),Me=this.read(Re.dataId),this.disposeData(Re.dataId),[2,Me];if(D!=null)return[2,this.convertAndCacheOnCPU(u)];if(!L().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&L().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return qe=null,ae!=="complex64"&&L().get("WEBGL_BUFFER_SUPPORTED")&&(Je=this.decode(u),Qe=this.texData.get(Je.dataId),qe=(Jt=this.gpgpu).createBufferFromTexture.apply(Jt,[Qe.texture].concat(Di(W)))),this.pendingRead.set(u,[]),ae==="complex64"?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:un.sent(),un.label=2;case 2:return ae!=="complex64"?[3,4]:[4,Promise.all([de.real.data(),de.imag.data()])];case 3:return vt=un.sent(),bt=vt[0],wt=vt[1],ot=Cu(bt,wt),[3,5];case 4:qe==null?ot=this.getValuesFromTexture(u):(Ft=Ye(W),ot=this.gpgpu.downloadFloat32MatrixFromBuffer(qe,Ft)),un.label=5;case 5:return Je!=null&&this.disposeData(Je.dataId),Yt=this.convertAndCacheOnCPU(u,ot),an=this.pendingRead.get(u),this.pendingRead.delete(u),an.forEach(function(gn){return gn(Yt)}),this.pendingDisposal.has(u)&&(this.pendingDisposal.delete(u),this.disposeData(u),this.pendingDeletes--),[2,Yt]}})})},h.prototype.checkNumericalProblems=function(u){if(u!=null)for(var d=0;d<u.length;d++){var y=u[d];if(!Fr(y))throw L().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value "+y+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"):Error("The value "+y+" cannot be represented on this device.")}},h.prototype.getValuesFromTexture=function(u){var d,y=this.texData.get(u),D=y.shape,W=y.dtype,X=y.isPacked,ae=Ye(D);if(L().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var de=this.decode(u),be=this.texData.get(de.dataId),Ie=(d=this.gpgpu).downloadMatrixFromPackedTexture.apply(d,[be.texture].concat(Di(D))).subarray(0,ae);return this.disposeData(de.dataId),Ie}var Re=L().getBool("WEBGL_PACK")&&X===!0,Me=Re?nc(D):D,qe=Re?new function(vt){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=ir.DOWNLOAD;var bt=te();this.outputShape=vt,this.userCode=`
      `+ft+`

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        `+bt.output+` = encode_float(x);
      }
    `}(Me):new function(vt){this.variableNames=["A"],this.outTexUsage=ir.DOWNLOAD;var bt=te();this.outputShape=vt,this.userCode=`
      `+ft+`

      void main() {
        float x = getAAtOutCoords();
        `+bt.output+` = encode_float(x);
      }
    `}(Me),Je=this.runWebGLProgram(qe,[{shape:Me,dtype:W,dataId:u}],"float32"),Qe=this.texData.get(Je.dataId),ot=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(Qe.texture,Qe.texShape[0],Qe.texShape[1]).subarray(0,ae);return this.disposeData(Je.dataId),ot},h.prototype.time=function(u){return R(this,void 0,void 0,function(){var d,y,D,W,X,ae,de;return P(this,function(be){switch(be.label){case 0:return d=this.activeTimers,y=[],D=!1,this.programTimersStack==null?(this.programTimersStack=y,D=!0):this.activeTimers.push(y),this.activeTimers=y,u(),W=Pt(this.activeTimers.map(function(Ie){return Ie.query})).filter(function(Ie){return Ie!=null}),X=Pt(this.activeTimers.map(function(Ie){return Ie.name})).filter(function(Ie){return Ie!=null}),this.activeTimers=d,D&&(this.programTimersStack=null),ae={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},L().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(W)]:[3,2];case 1:return de=be.sent(),ae.kernelMs=$t(de),ae.getExtraProfileInfo=function(){return de.map(function(Ie,Re){return{name:X[Re],ms:Ie}}).map(function(Ie){return Ie.name+": "+Ie.ms}).join(", ")},[3,3];case 2:ae.kernelMs={error:"WebGL query timers are not supported in this environment."},be.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,ae]}})})},h.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},h.prototype.startTimer=function(){return L().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:nn(),endMs:null}},h.prototype.endTimer=function(u){return L().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),u):(u.endMs=nn(),u)},h.prototype.getQueryTime=function(u){return R(this,void 0,void 0,function(){var d;return P(this,function(y){return L().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(u)]:[2,(d=u).endMs-d.startMs]})})},h.prototype.disposeData=function(u){if(!this.pendingDisposal.has(u)){if(this.pendingRead.has(u))return this.pendingDisposal.add(u),void this.pendingDeletes++;if(this.texData.has(u)){this.releaseGPUData(u);var d=this.texData.get(u).complexTensors;d!=null&&(d.real.dispose(),d.imag.dispose()),this.texData.delete(u)}}},h.prototype.releaseGPUData=function(u){var d=this.texData.get(u),y=d.texture,D=d.dtype,W=d.texShape,X=d.usage,ae=d.isPacked,de=d.slice,be=de&&de.origDataId||u,Ie=this.dataRefCount.get(be);Ie>1?this.dataRefCount.set(be,Ie-1):(this.dataRefCount.delete(be),y!=null&&(this.numBytesInGPU-=this.computeBytes(W,D),this.textureManager.releaseTexture(y,W,X,ae)));var Re=this.texData.get(u);Re.texture=null,Re.texShape=null,Re.isPacked=!1,Re.slice=null},h.prototype.getTexture=function(u){return this.uploadToGPU(u),this.texData.get(u).texture},h.prototype.getDataInfo=function(u){return this.texData.get(u)},h.prototype.getCPUBackend=function(){return L().getBool("WEBGL_CPU_FORWARD")?(this.cpuBackend==null&&(this.cpuBackend=Ve.findBackend("cpu")),this.cpuBackend):null},h.prototype.shouldExecuteOnCPU=function(u,d){var y=this;return d===void 0&&(d=128),this.getCPUBackend()!=null&&u.every(function(D){return y.texData.get(D.dataId).texture==null&&D.size<d})},h.prototype.getGPGPUContext=function(){return this.gpgpu},h.prototype.complex=function(u,d){var y=this.makeOutput(u.shape,"complex64");return this.texData.get(y.dataId).complexTensors={real:Ve.keep(u.clone()),imag:Ve.keep(d.clone())},y},h.prototype.real=function(u){return this.texData.get(u.dataId).complexTensors.real.clone()},h.prototype.imag=function(u){return this.texData.get(u.dataId).complexTensors.imag.clone()},h.prototype.slice=function(u,d,y){if(this.shouldExecuteOnCPU([u]))return this.cpuBackend.slice(u,d,y);if(Ye(y)===0)return wa([],y,u.dtype);var D=this.texData.get(u.dataId).isPacked,W=If(u.shape,d,y);if(D||!W){var X=L().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new _c(y):new Ko(y),ae=X.getCustomSetupFunc(d);return this.compileAndRun(X,[u],null,ae)}return this.uploadToGPU(u.dataId),this.shallowSlice(u,d,y)},h.prototype.shallowSlice=function(u,d,y){var D=this.texData.get(u.dataId),W=this.makeOutput(y,u.dtype),X=this.texData.get(W.dataId);Object.assign(X,D),X.shape=y,X.dtype=u.dtype;var ae=Uh(d,u.strides);D.slice&&(ae+=D.slice.flatOffset),X.slice={flatOffset:ae,origDataId:D.slice&&D.slice.origDataId||u.dataId};var de=this.dataRefCount.get(X.slice.origDataId)||1;return this.dataRefCount.set(X.slice.origDataId,de+1),W},h.prototype.stridedSlice=function(u,d,y,D){if(this.shouldExecuteOnCPU([u]))return this.cpuBackend.stridedSlice(u,d,y,D);var W=Rl(d,y,D);if(W.some(function(ae){return ae===0}))return wa([],W);var X=new function(ae,de,be){this.variableNames=["x"],this.outputShape=be;var Ie=be.length,Re=Mn(be.length),Me=Mn(be.length),qe="";if(Ie===1)qe="coords * strides + begin";else{var Je=0;qe=be.map(function(Qe,ot){return Je++,be.length===1?"coords * strides["+ot+"] + begin["+ot+"]":"coords["+(Je-1)+"] * strides["+ot+"] + begin["+ot+"]"}).join(",")}this.userCode=`
      `+Re+" begin = "+Re+"("+ae+`);
      `+Re+" strides = "+Re+"("+de+`);

      void main() {
        `+Me+` coords = getOutputCoords();
        setOutput(getX(`+qe+`));
      }
    `}(d,D,W);return this.compileAndRun(X,[u])},h.prototype.reverse=function(u,d){var y=L().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new function(D,W){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var X=D.length;if(X>4)throw new Error("WebGL backend: Reverse of rank-"+X+" tensor is not yet supported");this.outputShape=D;var ae=N("rc",X),de=ae[X-1]+" + 1 < "+this.outputShape[X-1],be=ae[X-2]+" + 1 < "+this.outputShape[X-2],Ie=Mn(X);function Re(Me){var qe=D.map(function(Je,Qe){return function(ot,vt){return W.indexOf(ot)!==-1&&D[ot]!==1?D[ot]+" - "+vt[ot]+" - 1":""+vt[ot]}(Qe,Me)});return"getChannel(getX("+qe.join(",")+"), vec2("+qe.slice(-2).join(",")+"))"}this.userCode=X===1?`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(`+D[0]+` - rc - 1),
            `+D[0]+` - rc - 1);
          if(`+de+`){
              result.g = getChannel(getX(`+D[0]+` - (rc  + 1) - 1),
                `+D[0]+` - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:`
        void main() {
          `+Ie+` rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = `+Re(ae.slice())+`;
          if(`+de+`){
            result.g = `+function(Me){return Me[X-1]="("+Me[X-1]+" + 1)",Re(Me)}(ae.slice())+`;
          }
          if(`+be+`) {
            result.b = `+function(Me){return Me[X-2]="("+Me[X-2]+" + 1)",Re(Me)}(ae.slice())+`;
            if(`+de+`) {
              result.a = `+function(Me){return Me[X-1]="("+Me[X-1]+" + 1)",Me[X-2]="("+Me[X-2]+" + 1)",Re(Me)}(ae.slice())+`;
            }
          }
          setOutput(result);
        }
    `}(u.shape,d):new function(D,W){this.variableNames=["x"];var X=D.length;if(X>4)throw new Error("WebGL backend: Reverse of rank-"+X+" tensor is not yet supported");if(this.outputShape=D,X!==1){var ae=D.map(function(be,Ie){return function(Re){return W.indexOf(Re)!==-1&&D[Re]!==1?D[Re]+" - coords["+Re+"] - 1":"coords["+Re+"]"}(Ie)}).join(","),de=Mn(X);this.userCode=`
      void main() {
        `+de+` coords = getOutputCoords();
        setOutput(getX(`+ae+`));
      }
    `}else this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(`+D[0]+` - coord - 1));
        }
      `}(u.shape,d);return this.compileAndRun(y,[u])},h.prototype.concat=function(u,d){if(u[0].dtype==="complex64"){var y=u.map(function(Me){return uo(Me)}),D=u.map(function(Me){return Uo(Me)});return fa(this.concat(y,d),this.concat(D,d))}if(this.shouldExecuteOnCPU(u))return this.cpuBackend.concat(u,d);if(u.length===1)return u[0];if(u.length>L().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var W=Math.floor(u.length/2),X=this.concat(u.slice(0,W),d),ae=this.concat(u.slice(W),d);return this.concat([X,ae],d)}if(L().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&u[0].rank>1){var de=new function(Me,qe){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Zs(Me,qe);var Je=this.outputShape,Qe=Je.length,ot=Mn(Qe),vt=N("coords",Qe),bt=["x","y","z","w","u","v"].slice(0,Qe);this.variableNames=Me.map(function(a,l){return"T"+l});var wt=new Array(Me.length-1);wt[0]=Me[0][qe];for(var Ft=1;Ft<wt.length;Ft++)wt[Ft]=wt[Ft-1]+Me[Ft][qe];var Yt=bt[qe],an=bt.slice(-2),Jt=bt.join(),un="if ("+Yt+" < "+wt[0]+`) {
        return getChannel(
            getT0(`+Jt+"), vec2("+an.join()+`));
        }`;for(Ft=1;Ft<wt.length;Ft++){var gn=wt[Ft-1];un+=`
        if (`+Yt+" < "+wt[Ft]+"  && "+Yt+" >= "+wt[Ft-1]+`) {
          return getChannel(
            getT`+Ft+"("+pa(bt,Yt,gn)+`),
            vec2(`+pa(an,Yt,gn)+`));
        }`}var p=wt.length,c=wt[wt.length-1];un+=`
        return getChannel(
          getT`+p+"("+pa(bt,Yt,c)+`),
          vec2(`+pa(an,Yt,c)+"));",this.userCode=`
      float getValue(`+bt.map(function(a){return"int "+a})+`) {
        `+un+`
      }

      void main() {
        `+ot+` coords = getOutputCoords();
        vec4 result = vec4(getValue(`+vt+`), 0., 0., 0.);

        `+vt[Qe-1]+" = "+vt[Qe-1]+` + 1;
        if (`+vt[Qe-1]+" < "+Je[Qe-1]+`) {
          result.g = getValue(`+vt+`);
        }

        `+vt[Qe-2]+" = "+vt[Qe-2]+` + 1;
        if (`+vt[Qe-2]+" < "+Je[Qe-2]+`) {
          result.a = getValue(`+vt+`);
        }

        `+vt[Qe-1]+" = "+vt[Qe-1]+` - 1;
        if (`+vt[Qe-2]+" < "+Je[Qe-2]+` &&
            `+vt[Qe-1]+" < "+Je[Qe-1]+`) {
          result.b = getValue(`+vt+`);
        }
        setOutput(result);
      }
    `}(u.map(function(Me){return Me.shape}),d);return this.compileAndRun(de,u)}var be=Zs(u.map(function(Me){return Me.shape}),d),Ie=u.map(function(Me){return Me.as2D(-1,Ye(Me.shape.slice(d)))}),Re=new function(Me){this.outputShape=[],this.outputShape=Zs(Me,1),this.variableNames=Me.map(function(wt,Ft){return"T"+Ft});var qe=new Array(Me.length-1);qe[0]=Me[0][1];for(var Je=1;Je<qe.length;Je++)qe[Je]=qe[Je-1]+Me[Je][1];var Qe=["if (yC < "+qe[0]+") setOutput(getT0(yR, yC));"];for(Je=1;Je<qe.length;Je++){var ot=qe[Je-1];Qe.push("else if (yC < "+qe[Je]+") setOutput(getT"+Je+"(yR, yC-"+ot+"));")}var vt=qe.length,bt=qe[qe.length-1];Qe.push("else setOutput(getT"+vt+"(yR, yC-"+bt+"));"),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        `+Qe.join(`
        `)+`
      }
    `}(Ie.map(function(Me){return Me.shape}));return this.compileAndRun(Re,Ie).reshape(be)},h.prototype.neg=function(u){if(this.shouldExecuteOnCPU([u]))return this.cpuBackend.neg(u);if(L().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(u,Om,u.dtype);var d=new ci(u.shape,Om);return this.compileAndRun(d,[u])},h.prototype.batchMatMul=function(u,d,y,D){var W=y?u.shape[2]:u.shape[1],X=D?d.shape[1]:d.shape[2],ae=y?u.shape[1]:u.shape[2],de=u.shape[0];if((W===1||X===1)&&ae>1e3){y&&(u=u.transpose([0,2,1])),D&&(d=d.transpose([0,2,1]));var be=X===1?u:u.as3D(de,ae,1),Ie=X===1?2:1,Re=X===1?d.as3D(de,1,ae):d;return this.multiply(be,Re).sum(Ie,!0)}var Me=cn(u.dtype,d.dtype),qe=new Ia(u.shape,[de,W,X],y,D);return this.compileAndRun(qe,[u,d],Me)},h.prototype.fusedBatchMatMul=function(u){var d=u.a,y=u.b,D=u.transposeA,W=u.transposeB,X=u.bias,ae=u.activation,de=u.preluActivationWeights,be=D?d.shape[2]:d.shape[1],Ie=W?y.shape[1]:y.shape[2],Re=d.shape[0],Me=cn(d.dtype,y.dtype),qe=X!=null,Je=de!=null,Qe=ae?_m(ae,!0):null,ot=new Ia(d.shape,[Re,be,Ie],D,W,qe,Qe,Je),vt=[d,y];return X&&vt.push(X),de&&vt.push(de),this.compileAndRun(ot,vt,Me)},h.prototype.multiply=function(u,d){if(u.dtype==="complex64"){var y=this.texData.get(u.dataId),D=this.texData.get(d.dataId),W=new hr("return areal * breal - aimag * bimag;",u.shape,d.shape),X=new hr("return areal * bimag + aimag * breal;",u.shape,d.shape),ae=[this.makeComplexComponentTensorInfo(u,y.complexTensors.real),this.makeComplexComponentTensorInfo(u,y.complexTensors.imag),this.makeComplexComponentTensorInfo(d,D.complexTensors.real),this.makeComplexComponentTensorInfo(d,D.complexTensors.imag)],de=this.compileAndRun(W,ae),be=this.compileAndRun(X,ae),Ie=this.complex(de,be);return de.dispose(),be.dispose(),Ie}if(this.shouldExecuteOnCPU([u,d]))return this.cpuBackend.multiply(u,d);if(L().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(u,d,wr,u.dtype);var Re=new Wr(wr,u.shape,d.shape);return this.compileAndRun(Re,[u,d],u.dtype)},h.prototype.batchNormalization=function(u,d,y,D,W,X){var ae=[u,d,y],de=null;X!=null&&(de=X.shape,ae.push(X));var be=null;if(W!=null&&(be=W.shape,ae.push(W)),L().getBool("WEBGL_PACK_NORMALIZATION")){var Ie=new function(Me,qe,Je,Qe,ot,vt){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Hi(Me,qe),Hi(Me,Je);var bt="vec4(0.0)";Qe!=null&&(Hi(Me,Qe),this.variableNames.push("offset"),bt="getOffsetAtOutCoords()");var wt="vec4(1.0)";ot!=null&&(Hi(Me,ot),this.variableNames.push("scale"),wt="getScaleAtOutCoords()"),this.outputShape=Me,this.userCode=`
      void main() {
        vec4 offset = `+bt+`;
        vec4 scale = `+wt+`;

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(`+vt+`));

        setOutput((x - mean) * inv + offset);
      }
    `}(u.shape,d.shape,y.shape,de,be,D);return this.compileAndRun(Ie,ae)}var Re=new function(Me,qe,Je,Qe,ot,vt){this.outputShape=[],this.variableNames=["x","mean","variance"],Hi(Me,qe),Hi(Me,Je);var bt="0.0";Qe!=null&&(Hi(Me,Qe),this.variableNames.push("offset"),bt="getOffsetAtOutCoords()");var wt="1.0";ot!=null&&(Hi(Me,ot),this.variableNames.push("scale"),wt="getScaleAtOutCoords()"),this.outputShape=Me,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = `+bt+`;
        float scale = `+wt+`;
        float inv = scale * inversesqrt(variance + float(`+vt+`));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}(u.shape,d.shape,y.shape,de,be,D);return this.compileAndRun(Re,ae)},h.prototype.localResponseNormalization4D=function(u,d,y,D,W){var X=L().getBool("WEBGL_PACK_NORMALIZATION")?new function(ae,de,be,Ie,Re){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var Me,qe=de,Je=ae[3]-1;this.outputShape=ae;var Qe="float("+be+") + float("+Ie+") * sum";Me=Re===.5?"inversesqrt("+Qe+")":Re===1?"1.0/("+Qe+")":"exp(log("+Qe+") * float(-"+Re+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < `+this.outputShape[3]+`;
        bool hasNextRow = c < `+this.outputShape[2]+`;

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - `+qe+`;
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - `+qe+"; j <= "+qe+`; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(`+Je+`));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * `+Me+`;
        setOutput(result);
      }
    `}(u.shape,d,y,D,W):new function(ae,de,be,Ie,Re){this.variableNames=["x"],this.outputShape=[];var Me,qe=de,Je=ae[3]-1;this.outputShape=ae;var Qe="float("+be+") + float("+Ie+") * sum";Me=Re===.5?"inversesqrt("+Qe+")":Re===1?"1.0/("+Qe+")":"exp(log("+Qe+") * float(-"+Re+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -`+qe+"; j <= "+qe+`; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  `+Je+`) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * `+Me+`;
        setOutput(val);
      }
    `}(u.shape,d,y,D,W);return this.compileAndRun(X,[u])},h.prototype.LRNGrad=function(u,d,y,D,W,X,ae){var de=new function(be,Ie,Re,Me,qe){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=be,this.depth=be[3],this.depthRadius=Ie,this.bias=Re,this.alpha=Me,this.beta=qe,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < `+this.depth+`; ++d) {
          int depthBegin = int(max(0.0, float(d - `+Ie+`)));
          int depthEnd = int(min(float(`+this.depth+`),
              float(d + `+Ie+` + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = `+this.depth+`;

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(`+Me+") * norm + float("+Re+`);

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(`+Me+`)
                * float(`+qe+`)
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * `+qe+`);
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}(d.shape,D,W,X,ae);return this.compileAndRun(de,[d,y,u])},h.prototype.tile=function(u,d){if(u.dtype==="string"){var y=this.readSync(u.dataId).map(function(W){return mr(W)});return Bf(Ni(u.shape,u.dtype,y),d)}var D=new function(W,X){this.variableNames=["A"];for(var ae=new Array(W.length),de=0;de<ae.length;de++)ae[de]=W[de]*X[de];this.outputShape=ae,this.rank=ae.length;var be=Mn(this.rank),Ie=function(Re){var Me=Re.length;if(Me>5)throw Error("Tile for rank "+Me+" is not yet supported");if(Me===1)return"imod(resRC, "+Re[0]+")";for(var qe=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],Je=[],Qe=0;Qe<Re.length;Qe++)Je.push("imod("+qe[Qe]+", "+Re[Qe]+")");return Je.join()}(W);this.userCode=`
      void main() {
        `+be+` resRC = getOutputCoords();
        setOutput(getA(`+Ie+`));
      }
    `}(u.shape,d);return this.compileAndRun(D,[u])},h.prototype.pad=function(u,d,y){var D=L().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new function(W,X,ae){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=X.map(function(Yt,an){return Yt[0]+W[an]+Yt[1]});for(var de=W.length,be=Mn(de),Ie=X.map(function(Yt){return Yt[0]}).join(","),Re=X.map(function(Yt,an){return Yt[0]+W[an]}).join(","),Me=N("rc",de),qe=N("source",de),Je=Me[de-1]+" < "+this.outputShape[de-1],Qe=de===1?"source":"vec2("+qe.slice(-2).join()+")",ot=[be+" rc = outputLoc;",Me[de-1]+` += 1;
       if(`+Je+`) {
      `,de===1?"":`}
       rc = outputLoc;
       `+Me[de-2]+` += 1;
       if(`+Me[de-2]+" < "+this.outputShape[de-2]+") {",de===1?"":"  "+Me[de-1]+` += 1;
         if(`+Je+") {"],vt=de===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",bt="",wt=0,Ft=de===1?2:4;wt<Ft;wt++)bt+=`
        `+ot[wt]+`
        if (`+vt+`) {
          result[`+wt+"] = float("+ae+`);
        } else {
          `+be+` source = rc - start;
          result[`+wt+"] = getChannel(getX("+qe.join()+"), "+Qe+`);
        }
      `;bt+=de===1?"} ":"}}",this.userCode=`
      const `+be+" start = "+be+"("+Ie+`);
      const `+be+" end = "+be+"("+Re+`);

      void main() {
        `+be+` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `+bt+`
        setOutput(result);
      }
    `}(u.shape,d,y):new function(W,X,ae){this.variableNames=["x"],this.outputShape=X.map(function(qe,Je){return qe[0]+W[Je]+qe[1]});var de=W.length,be=Mn(de),Ie=X.map(function(qe){return qe[0]}).join(","),Re=X.map(function(qe,Je){return qe[0]+W[Je]}).join(","),Me=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,de);this.userCode=de!==1?`
      `+be+" start = "+be+"("+Ie+`);
      `+be+" end = "+be+"("+Re+`);

      void main() {
        `+be+` outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(float(`+ae+`));
        } else {
          `+be+` coords = outC - start;
          setOutput(getX(`+Me+`));
        }
      }
    `:`
        int start = `+Ie+`;
        int end = `+Re+`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(float(`+ae+`));
          } else {
            setOutput(getX(outC - start));
          }
        }
      `}(u.shape,d,y);return this.compileAndRun(D,[u])},h.prototype.transpose=function(u,d){if(this.shouldExecuteOnCPU([u]))return this.cpuBackend.transpose(u,d);var y=L().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new function(D,W){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var X=new Array(D.length),ae=0;ae<X.length;ae++)X[ae]=D[W[ae]];if(this.outputShape=X,this.rank=X.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var de=Mn(this.rank),be=C("rc",this.rank),Ie=new Array(this.rank);for(ae=0;ae<W.length;ae++)Ie[W[ae]]=be[ae];var Re="vec2("+Ie.slice(-2).join()+")",Me="++"+be[this.rank-1]+" < "+X[this.rank-1],qe="getChannel(getA("+Ie.join()+"), "+Re+")";this.userCode=`
    void main() {
      `+de+` rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = `+qe+`;
      if(`+Me+`) {
        result[1] = `+qe+`;
      }
      --`+be[this.rank-1]+`;
      if(++`+be[this.rank-2]+" < "+X[this.rank-2]+`) {
        result[2] = `+qe+`;
        if(`+Me+`) {
          result[3] = `+qe+`;
        }
      }
      setOutput(result);
    }
    `}(u.shape,d):new function(D,W){this.variableNames=["A"];for(var X=new Array(D.length),ae=0;ae<X.length;ae++)X[ae]=D[W[ae]];this.outputShape=X,this.rank=X.length;var de=Mn(this.rank),be=function(Ie){var Re=Ie.length;if(Re>6)throw Error("Transpose for rank "+Re+" is not yet supported");for(var Me=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],qe=new Array(Re),Je=0;Je<Ie.length;Je++)qe[Ie[Je]]=Me[Je];return qe.join()}(W);this.userCode=`
    void main() {
      `+de+` resRC = getOutputCoords();
      setOutput(getA(`+be+`));
    }
    `}(u.shape,d);return this.compileAndRun(y,[u])},h.prototype.gather=function(u,d,y){if(this.shouldExecuteOnCPU([u,d]))return this.cpuBackend.gather(u,d,y);var D=new function(W,X,ae){this.variableNames=["A","indices"];var de=W.slice();de[ae]=X,this.outputShape=de,this.rank=de.length;var be=Mn(this.rank),Ie=function(Re,Me){var qe=Re.length;if(qe>4)throw Error("Gather for rank "+qe+" is not yet supported");if(qe===1)return"int(getIndices(resRC))";for(var Je=["resRC.x","resRC.y","resRC.z","resRC.w"],Qe=[],ot=0;ot<Re.length;ot++)ot===Me?Qe.push("int(getIndices("+Je[ot]+"))"):Qe.push(""+Je[ot]);return Qe.join()}(W,ae);this.userCode=`
      void main() {
        `+be+` resRC = getOutputCoords();
        setOutput(getA(`+Ie+`));
      }
    `}(u.shape,d.size,y);return this.compileAndRun(D,[u,d])},h.prototype.batchToSpaceND=function(u,d,y){we(u.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var D=d.reduce(function(Ie,Re){return Ie*Re}),W=Uu(u.shape,d,D),X=Df(W.length,d.length),ae=Tf(u.shape,d,D),de=Xc(y,d.length),be=Vd(ae,y,d.length);return u.reshape(W).transpose(X).reshape(ae).slice(de,be)},h.prototype.spaceToBatchND=function(u,d,y){we(u.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var D=d.reduce(function(Re,Me){return Re*Me}),W=[[0,0]];W.push.apply(W,y);for(var X=1+d.length;X<u.shape.length;++X)W.push([0,0]);var ae=u.pad(W),de=Uu(ae.shape,d,D,!1),be=Df(de.length,d.length,!1),Ie=Tf(ae.shape,d,D,!1);return ae.reshape(de).transpose(be).reshape(Ie)},h.prototype.reduce=function(u,d,y){var D=u.shape[0],W=u.shape[1],X=new function(de,be){this.variableNames=["x"];var Ie=de.windowSize,Re=de.batchSize,Me=de.inSize,qe=Math.ceil(Me/Ie);this.outputShape=[Re,qe];var Je="0.0",Qe="";be==="prod"?Je="1.0":be==="min"?(Je="1.0 / 1e-20",Qe="min"):be==="max"&&(Je="-1.0 / 1e-20",Qe="max");var ot=be+"("+be+"("+be+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";be==="sum"?ot="sumValue":be==="prod"?ot="prodValue":be==="all"?ot="allValue":be==="any"&&(ot="anyValue");var vt=4*Math.floor(Ie/4),bt=Ie%4,wt=`
      if (`+(be==="sum")+`) {
        sumValue += dot(values, ones);
      } else if (`+(be==="prod")+`) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = `+Qe+`(values, minMaxValue);
      }
    `,Ft="vec4";be==="all"?(Je="1.0",wt=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,Ft="bvec4"):be==="any"&&(Je="0.0",wt=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,Ft="bvec4");var Yt="";Me%Ie>0&&(Yt=`
        if (inIdx < 0 || inIdx >= `+Me+`) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = `+Je+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `+Yt+`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+Ie+`;

        vec4 minMaxValue = vec4(`+Je+`);
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < `+vt+`; i += 4) {
          int inIdx = inOffset + i;
          `+Ft+" values = "+Ft+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `+wt+`
        }

        int inIdx = inOffset + `+vt+`;
        if (`+(bt===1)+`) {
          `+Ft+" values = "+Ft+`(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          `+wt+`
        } else if (`+(bt===2)+`) {
          `+Ft+" values = "+Ft+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          `+wt+`
        } else if (`+(bt===3)+`) {
          `+Ft+" values = "+Ft+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          `+wt+`
        }
        setOutput(`+ot+`);
      }
    `}({windowSize:Fl(W),inSize:W,batchSize:D},d),ae=this.compileAndRun(X,[u],y);return ae.shape[1]===1?ae:this.reduce(ae,d,y)},h.prototype.argReduce=function(u,d,y){y===void 0&&(y=null);var D=u.shape[0],W=u.shape[1];y!=null&&(D=y.shape[0],W=y.shape[1]);var X=new function(be,Ie,Re){this.variableNames=["A"];var Me=be.windowSize,qe=be.batchSize,Je=be.inSize,Qe=Math.ceil(Je/Me);Re||this.variableNames.push("bestIndicesA"),this.outputShape=[qe,Qe];var ot=Ie==="max"?">":"<",vt=Re?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+Me+`;

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < `+Me+`; i++) {
          int inIdx = `+vt+`;
          float candidate = getA(batch, inIdx);
          if (candidate `+ot+` bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}({windowSize:Fl(W),inSize:W,batchSize:D},d,y==null),ae=[u];y!=null&&ae.push(y);var de=this.compileAndRun(X,ae,"int32");return de.shape[1]===1?de:this.argReduce(u,d,de)},h.prototype.argReducePacked=function(u,d,y){y===void 0&&(y=null);var D=y!=null?y.shape:u.shape,W=new function(de,be,Ie,Re){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,we(de.length>2,function(){return"Packed arg"+(Ie.charAt(0).toUpperCase()+Ie.slice(1))+" supports only inputs with rank above 2."});var Me=de[de.length-1],qe=Math.ceil(Me/be);this.outputShape=de.slice(0,-1),qe>1&&this.outputShape.push(qe),Re||this.variableNames.push("bestIndicesA");var Je,Qe,ot=this.outputShape,vt=ot.length,bt=Mn(vt),wt=N("coords",vt);if(qe===1){var Ft=Mn(Qe=vt+1);Je=`
        `+Ft+" sourceLocR = "+Ft+"("+wt.join()+`, 0);
        ++`+wt[vt-1]+`;
        `+Ft+" sourceLocG = "+Ft+"("+wt.join()+`, 0);
        ++`+wt[vt-2]+`;
        `+Ft+" sourceLocA = "+Ft+"("+wt.join()+`, 0);
        --`+wt[vt-1]+`;
        `+Ft+" sourceLocB = "+Ft+"("+wt.join()+`, 0);
        --`+wt[vt-2]+";"}else Qe=vt,Je=`
        `+bt+` sourceLocR = coords;
        ++`+wt[vt-1]+`;
        `+bt+` sourceLocG = coords;
        ++`+wt[vt-2]+`;
        `+bt+` sourceLocA = coords;
        --`+wt[vt-1]+`;
        `+bt+` sourceLocB = coords;
        --`+wt[vt-2]+";";var Yt=["x","y","z","w","u","v"].slice(0,Qe),an="."+Yt[Qe-1],Jt=Yt.map(function(j){return"int "+j}),un=N("sourceLocR",Qe-1).concat("inIdx.r"),gn=N("sourceLocG",Qe-1).concat("inIdx.g"),p=N("sourceLocB",Qe-1).concat("inIdx.b"),c=N("sourceLocA",Qe-1).concat("inIdx.a"),a=Ie==="max"?"greaterThan":"lessThan",l=Re?"":`
          inIdx = round(vec4(getBestIndicesAChannel(`+un.join()+`),
                             getBestIndicesAChannel(`+gn.join()+`),
                             getBestIndicesAChannel(`+p.join()+`),
                             getBestIndicesAChannel(`+c.join()+")));",g=`vec4(
            getAChannel(`+un.join()+`),
            hasNextCol ? getAChannel(`+gn.join()+`) : 0.,
            hasNextRow ? getAChannel(`+p.join()+`) : 0.,
            hasNextRow && hasNextCol ? getAChannel(`+c.join()+") : 0.)",_=Re?"":`
      float getBestIndicesAChannel(`+Jt.join()+`) {
        return getChannel(getBestIndicesA(`+Yt.join()+`),
                                          vec2(`+Yt.slice(-2).join()+`));
      }`;this.userCode=`
      float getAChannel(`+Jt.join()+`) {
        return getChannel(getA(`+Yt.join()+`),
                               vec2(`+Yt.slice(-2).join()+`));
      }
      `+_+`
      void main() {
        `+bt+` coords = getOutputCoords();
        bool hasNextCol = `+wt[vt-1]+" < "+(ot[vt-1]-1)+`;
        bool hasNextRow = `+wt[vt-2]+" < "+(ot[vt-2]-1)+`;
        `+Je+`
        ivec4 srcIdx = ivec4(sourceLocR`+an+", sourceLocG"+an+`,
          sourceLocB`+an+", sourceLocA"+an+") * "+be+`;
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = `+g+`;

        for (int i = 0; i < `+be+`; i++) {
          inIdx = srcIdx;
          `+l+`
          vec4 candidate = `+g+`;
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(`+a+`(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}(D,Fl(D[D.length-1]),d,y==null),X=y==null?[u]:[u,y],ae=this.compileAndRun(W,X,"int32");return ae.rank===u.rank?this.argReducePacked(u,d,ae):ae},h.prototype.sum=function(u,d){Ga("sum",d,u.rank);var y=Aa(u.shape,d),D=y[0],W=Ye(y[1]),X=u.as2D(-1,W),ae=Jn(u.dtype);return this.reduce(X,"sum",ae).reshape(D)},h.prototype.prod=function(u,d){if(this.shouldExecuteOnCPU([u]))return this.cpuBackend.prod(u,d);var y=Aa(u.shape,d),D=y[0],W=Ye(y[1]),X=u.as2D(-1,W),ae=Jn(u.dtype);return this.reduce(X,"prod",ae).reshape(D)},h.prototype.unsortedSegmentSum=function(u,d,y){var D=0,W=Co([D],u.rank),X=u;W!=null&&(X=u.transpose(W),D=Oo(1,u.rank)[0]);var ae=function(Me,qe,Je){for(var Qe=[],ot=Me.length,vt=0;vt<ot;vt++)vt!==qe?Qe.push(Me[vt]):Qe.push(Je);return Qe}(X.shape,D,y),de=Ye([X.shape[D]]),be=X.as2D(-1,de),Ie=Jn(u.dtype),Re=this.segOpCompute(be,"unsortedSegmentSum",d,Ie,y).reshape(ae);return W!=null&&(Re=Re.transpose(wu(W))),Re},h.prototype.segOpCompute=function(u,d,y,D,W){var X=u.shape[0],ae=u.shape[1],de=function(Re,Me){var qe,Je=!1;for(Re<=qd?(qe=Re,Je=!0):qe=br(Re,Math.floor(Math.sqrt(Re)));!Je;)qe>Me||qe===Re?Je=!0:qe=br(Re,qe+1);return qe}(ae,W),be=new function(Re,Me){this.variableNames=["x","segmentIds"];var qe=Re.windowSize,Je=Re.batchSize,Qe=Re.inSize,ot=Re.numSegments,vt=ot*Math.ceil(Qe/qe);this.outputShape=[Je,vt];var bt=4*Math.floor(qe/4),wt=qe%4,Ft=`
        sumValue += dot(values, segFilter);
    `,Yt="";Qe%qe>0&&(Yt=`
        if (inIdx < 0 || inIdx >= `+Qe+`) {
          return initializationValue;
        }
      `);var an="";Qe%qe>0&&(an=`
        if (inIdx < 0 || inIdx >= `+Qe+`) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = 0.0;

      float getValue(int batch, int inIdx) {
        `+Yt+`
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        `+an+`
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          `+ot+")) * float("+qe+`));
        int currentSeg = int(mod(float(outIdx), float(`+ot+`)));

        float sumValue = 0.0;

        for (int i = 0; i < `+bt+`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          `+Ft+`
        }

        int inIdx = inOffset + `+bt+`;
        if (`+(wt===1)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          `+Ft+`
        } else if (`+(wt===2)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          `+Ft+`
        } else if (`+(wt===3)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          `+Ft+`
        }
        setOutput(sumValue);
      }
    `}({windowSize:de,inSize:ae,batchSize:X,numSegments:W}),Ie=this.compileAndRun(be,[u,y],D);return Ie.shape[1]===W?Ie:(y=ac(0,W).tile([ae/de]),this.segOpCompute(Ie,d,y,D,W))},h.prototype.argMinMaxReduce=function(u,d,y){var D=[d];if(Ga("arg"+y.charAt(0).toUpperCase()+y.slice(1),D,u.rank),!L().getBool("WEBGL_PACK_REDUCE")||u.rank<=2){var W=Aa(u.shape,D),X=W[0],ae=Ye(W[1]),de=u.as2D(-1,ae);return this.argReduce(de,y).reshape(X)}return this.argReducePacked(u,y)},h.prototype.argMin=function(u,d){return this.argMinMaxReduce(u,d,"min")},h.prototype.argMax=function(u,d){return this.argMinMaxReduce(u,d,"max")},h.prototype.cumsum=function(u,d,y,D){if(d!==u.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(u.rank-1)+" but got axis="+d);var W=new function(X,ae,de){this.variableNames=["x"],this.outputShape=X;var be=X.length,Ie=X[X.length-1],Re=de?"<":">";this.userCode=`
      int getIndex(int i) {
        `+(de?"return "+Ie+" -i - 1;":"return i;")+`
      }

      void main() {
        `+Mn(be)+` coords = getOutputCoords();
        int end = `+ra(be,"coords")+`;
        float val = 0.0;
        for (int i = `+Ie+` - 1; i >= 0; i -= 1) {
          int idx = getIndex(i);
          if (idx `+Re+` end) {
            continue;
          }
          if (idx == end && `+ae+`) {
            continue;
          }
          `+ra(be,"coords")+` = idx;
          val += getX(`+function(Me,qe){if(Me===1)return""+qe;if(Me===2)return qe+".x, "+qe+".y";if(Me===3)return qe+".x, "+qe+".y, "+qe+".z";if(Me===4)return qe+".x, "+qe+".y, "+qe+".z, "+qe+".w";throw Error("Cumulative sum for rank "+Me+" is not yet supported")}(be,"coords")+`);
        }
        setOutput(val);
      }
    `}(u.shape,y,D);return this.compileAndRun(W,[u])},h.prototype.equal=function(u,d){if(L().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(u,d,`
  return vec4(equal(a, b));
`,"bool");var y=new Wr("return float(a == b);",u.shape,d.shape);return this.compileAndRun(y,[u,d],"bool")},h.prototype.notEqual=function(u,d){if(L().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(u,d,`
  return vec4(notEqual(a, b));
`,"bool");var y=new Wr("return float(a != b);",u.shape,d.shape);return this.compileAndRun(y,[u,d],"bool")},h.prototype.less=function(u,d){if(this.shouldExecuteOnCPU([u,d]))return this.cpuBackend.less(u,d);if(L().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(u,d,`
  return vec4(lessThan(a, b));
`,"bool");var y=new Wr("return float(a < b);",u.shape,d.shape);return this.compileAndRun(y,[u,d],"bool")},h.prototype.lessEqual=function(u,d){if(L().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(u,d,`
  return vec4(lessThanEqual(a, b));
`,"bool");var y=new Wr("return float(a <= b);",u.shape,d.shape);return this.compileAndRun(y,[u,d],"bool")},h.prototype.greater=function(u,d){if(this.shouldExecuteOnCPU([u,d]))return this.cpuBackend.greater(u,d);if(L().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(u,d,`
  return vec4(greaterThan(a, b));
`,"bool");var y=new Wr("return float(a > b);",u.shape,d.shape);return this.compileAndRun(y,[u,d],"bool")},h.prototype.greaterEqual=function(u,d){if(L().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(u,d,`
  return vec4(greaterThanEqual(a, b));
`,"bool");var y=new Wr("return float(a >= b);",u.shape,d.shape);return this.compileAndRun(y,[u,d],"bool")},h.prototype.logicalNot=function(u){var d=new ci(u.shape,"return float(!(x >= 1.0));");return this.compileAndRun(d,[u])},h.prototype.logicalAnd=function(u,d){if(L().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(u,d,`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,"bool");var y=new Wr("return float(a >= 1.0 && b >= 1.0);",u.shape,d.shape);return this.compileAndRun(y,[u,d],"bool")},h.prototype.logicalOr=function(u,d){if(L().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(u,d,`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,"bool");var y=new Wr("return float(a >= 1.0 || b >= 1.0);",u.shape,d.shape);return this.compileAndRun(y,[u,d],"bool")},h.prototype.select=function(u,d,y){var D=new function(W,X,ae){var de,be;if(this.variableNames=["c","a","b"],this.outputShape=X,ae>4)throw Error("Where for rank "+ae+" is not yet supported");if(ae===1)be="resRC",de="resRC";else{for(var Ie=["resRC.x","resRC.y","resRC.z","resRC.w"],Re=[],Me=[],qe=0;qe<X.length;qe++)Me.push(""+Ie[qe]),qe<W&&Re.push(""+Ie[qe]);de=Re.join(),be=Me.join()}var Je=Mn(ae);this.userCode=`
      void main() {
        `+Je+` resRC = getOutputCoords();
        float cVal = getC(`+de+`);
        if (cVal >= 1.0) {
          setOutput(getA(`+be+`));
        } else {
          setOutput(getB(`+be+`));
        }
      }
    `}(u.rank,d.shape,d.rank);return this.compileAndRun(D,[u,d,y],cn(d.dtype,y.dtype))},h.prototype.where=function(u){qc("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var d=u.dataSync();return G(u.shape,d)},h.prototype.topk=function(u,d,y){return Z(u.dataSync(),u.shape,u.dtype,d)},h.prototype.min=function(u,d){Ga("min",d,u.rank);var y=Aa(u.shape,d),D=y[0],W=Ye(y[1]),X=u.as2D(-1,W);return this.reduce(X,"min",X.dtype).reshape(D)},h.prototype.minimum=function(u,d){if(this.shouldExecuteOnCPU([u,d]))return this.cpuBackend.minimum(u,d);var y=L().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new li(`
  vec4 result = vec4(min(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,u.shape,d.shape):new Wr(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return min(a, b);
`,u.shape,d.shape);return this.compileAndRun(y,[u,d])},h.prototype.mod=function(u,d){var y=L().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new li(`
  vec4 result = mod(a, b);
  vec4 isNaN = vec4(equal(b, vec4(0.0)));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,u.shape,d.shape):new Wr(`if (b == 0.0) return NAN;
  return mod(a, b);`,u.shape,d.shape);return this.compileAndRun(y,[u,d])},h.prototype.max=function(u,d){if(this.shouldExecuteOnCPU([u]))return this.cpuBackend.max(u,d);Ga("max",d,u.rank);var y=Aa(u.shape,d),D=y[0],W=Ye(y[1]),X=u.as2D(-1,W);return this.reduce(X,"max",X.dtype).reshape(D)},h.prototype.maximum=function(u,d){if(this.shouldExecuteOnCPU([u,d]))return this.cpuBackend.maximum(u,d);var y=L().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new li(`
  vec4 result = vec4(max(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,u.shape,d.shape):new Wr(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return max(a, b);
`,u.shape,d.shape);return this.compileAndRun(y,[u,d])},h.prototype.all=function(u,d){Ga("all",d,u.rank);var y=Aa(u.shape,d),D=y[0],W=Ye(y[1]),X=u.as2D(-1,W);return this.reduce(X,"all",X.dtype).reshape(D)},h.prototype.any=function(u,d){Ga("any",d,u.rank);var y=Aa(u.shape,d),D=y[0],W=Ye(y[1]),X=u.as2D(-1,W);return this.reduce(X,"any",X.dtype).reshape(D)},h.prototype.realDivide=function(u,d){if(L().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(u,d,`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,"float32",!0);var y=new Wr(`
if (a == b) {
  return 1.0;
};
return a / b;`,u.shape,d.shape);return this.compileAndRun(y,[u,d],"float32")},h.prototype.floorDiv=function(u,d){if(L().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(u,d,`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,"int32");var y=new Wr(`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,u.shape,d.shape);return this.compileAndRun(y,[u,d],"int32")},h.prototype.add=function(u,d){if(u.dtype==="complex64"&&d.dtype==="complex64")return this.complexSeparableBinaryOp(u,d,Nr);if(this.shouldExecuteOnCPU([u,d]))return this.cpuBackend.add(u,d);var y=cn(u.dtype,d.dtype);if(L().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(u,d,Nr,y);var D=new Wr(Nr,u.shape,d.shape);return this.compileAndRun(D,[u,d],y)},h.prototype.packedUnaryOp=function(u,d,y){var D=new Lf(u.shape,d);return this.compileAndRun(D,[u],y)},h.prototype.packedBinaryOp=function(u,d,y,D,W){W===void 0&&(W=!1);var X=new li(y,u.shape,d.shape,W);return this.compileAndRun(X,[u,d],D)},h.prototype.complexSeparableBinaryOp=function(u,d,y){var D=this,W=this.texData.get(u.dataId),X=this.texData.get(d.dataId),ae=[[W.complexTensors.real,X.complexTensors.real],[W.complexTensors.imag,X.complexTensors.imag]].map(function(Re){var Me=Re[0],qe=Re[1],Je=D.makeComplexComponentTensorInfo(u,Me),Qe=D.makeComplexComponentTensorInfo(d,qe),ot=new Wr(y,u.shape,d.shape);return D.compileAndRun(ot,[Je,Qe],cn(Me.dtype,qe.dtype))}),de=ae[0],be=ae[1],Ie=this.complex(de,be);return de.dispose(),be.dispose(),Ie},h.prototype.makeComplexComponentTensorInfo=function(u,d){return{dataId:d.dataId,dtype:d.dtype,shape:u.shape}},h.prototype.addN=function(u){if(u.length===1)return u[0];if(u.length>L().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var d=Math.floor(u.length/2),y=this.addN(u.slice(0,d)),D=this.addN(u.slice(d));return this.addN([y,D])}var W=u.map(function(de){return de.dtype}).reduce(function(de,be){return cn(de,be)}),X=u.map(function(de){return de.shape}),ae=L().getBool("WEBGL_PACK")?new function(de,be){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=de,this.variableNames=be.map(function(Me,qe){return"T"+qe});var Ie=[];this.variableNames.forEach(function(Me){Ie.push("vec4 v"+Me+" = get"+Me+"AtOutCoords();")});var Re=this.variableNames.map(function(Me){return"v"+Me}).join(" + ");this.userCode=`
      void main() {
        `+Ie.join(`
        `)+`

        vec4 result = `+Re+`;
        setOutput(result);
      }
    `}(u[0].shape,X):new function(de,be){this.outputShape=[],this.outputShape=de,this.variableNames=be.map(function(Me,qe){return"T"+qe});var Ie=[];this.variableNames.forEach(function(Me){Ie.push("float v"+Me+" = get"+Me+"AtOutCoords();")});var Re=this.variableNames.map(function(Me){return"v"+Me}).join(" + ");this.userCode=`
      void main() {
        `+Ie.join(`
        `)+`

        float result = `+Re+`;
        setOutput(result);
      }
    `}(u[0].shape,X);return this.compileAndRun(ae,u,W)},h.prototype.subtract=function(u,d){if(u.dtype==="complex64"&&d.dtype==="complex64")return this.complexSeparableBinaryOp(u,d,Vr);if(this.shouldExecuteOnCPU([u,d]))return this.cpuBackend.subtract(u,d);var y=cn(u.dtype,d.dtype);if(L().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(u,d,Vr,u.dtype);var D=new Wr(Vr,u.shape,d.shape);return this.compileAndRun(D,[u,d],y)},h.prototype.pow=function(u,d){var y=L().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new li(`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,u.shape,d.shape):new Wr(`
if(a < 0.0 && floor(b) < b){
  return NAN;
}
if (b == 0.0) {
  return 1.0;
}
return (round(mod(b, 2.0)) != 1) ?
    pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,u.shape,d.shape),D=cn(u.dtype,d.dtype);return this.compileAndRun(y,[u,d],D)},h.prototype.ceil=function(u){if(this.shouldExecuteOnCPU([u]))return this.cpuBackend.ceil(u);if(L().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(u,bg,u.dtype);var d=new ci(u.shape,bg);return this.compileAndRun(d,[u])},h.prototype.floor=function(u){if(this.shouldExecuteOnCPU([u]))return this.cpuBackend.floor(u);if(L().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(u,Am,u.dtype);var d=new ci(u.shape,Am);return this.compileAndRun(d,[u])},h.prototype.sign=function(u){var d=new ci(u.shape,`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`);return this.compileAndRun(d,[u])},h.prototype.isNaN=function(u){var d=new ci(u.shape,"return float(isnan(x));");return this.compileAndRun(d,[u],"bool")},h.prototype.isInf=function(u){var d=new ci(u.shape,"return float(isinf(x));");return this.compileAndRun(d,[u],"bool")},h.prototype.isFinite=function(u){var d=new ci(u.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(d,[u],"bool")},h.prototype.round=function(u){var d=new ci(u.shape,`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`);return this.compileAndRun(d,[u])},h.prototype.exp=function(u){if(this.shouldExecuteOnCPU([u]))return this.cpuBackend.exp(u);if(L().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(u,xg,u.dtype);var d=new ci(u.shape,xg);return this.compileAndRun(d,[u])},h.prototype.expm1=function(u){if(this.shouldExecuteOnCPU([u]))return this.cpuBackend.expm1(u);if(L().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(u,Pf,u.dtype);var d=new ci(u.shape,Pf);return this.compileAndRun(d,[u])},h.prototype.softmax=function(u,d){var y=xn([d],u.shape),D=this.max(u,y),W=_a(D.shape,y),X=this.subtract(u,D.reshape(W)),ae=this.exp(X),de=this.sum(ae,y).reshape(W);return this.realDivide(ae,de)},h.prototype.log=function(u){if(this.shouldExecuteOnCPU([u]))return this.cpuBackend.log(u);if(L().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(u,`
  vec4 result = log(x);
  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));
  result.r = isNaN.r == 1.0 ? NAN : result.r;
  result.g = isNaN.g == 1.0 ? NAN : result.g;
  result.b = isNaN.b == 1.0 ? NAN : result.b;
  result.a = isNaN.a == 1.0 ? NAN : result.a;

  return result;
`,u.dtype);var d=new ci(u.shape,`if (x < 0.0) return NAN;
  return log(x);`);return this.compileAndRun(d,[u])},h.prototype.log1p=function(u){var d=new ci(u.shape,"return log(1.0 + x);");return this.compileAndRun(d,[u])},h.prototype.sqrt=function(u){var d=new ci(u.shape,"return sqrt(x);");return this.compileAndRun(d,[u])},h.prototype.rsqrt=function(u){if(this.shouldExecuteOnCPU([u]))return this.cpuBackend.rsqrt(u);var d=new ci(u.shape,"return inversesqrt(x);");return this.compileAndRun(d,[u])},h.prototype.reciprocal=function(u){var d=new ci(u.shape,"return 1.0 / x;");return this.compileAndRun(d,[u])},h.prototype.relu=function(u){var d;return d=L().getBool("WEBGL_PACK")?new Lf(u.shape,kg):new ci(u.shape,vg),this.compileAndRun(d,[u])},h.prototype.relu6=function(u){var d;return d=L().getBool("WEBGL_PACK")?new Lf(u.shape,Eg):new ci(u.shape,yg),this.compileAndRun(d,[u])},h.prototype.prelu=function(u,d){var y=L().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new li(oi,u.shape,d.shape):new Wr(Hr,u.shape,d.shape);return this.compileAndRun(y,[u,d])},h.prototype.elu=function(u){if(L().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(u,Sc,u.dtype);var d=new ci(u.shape,Cm);return this.compileAndRun(d,[u])},h.prototype.eluDer=function(u,d){var y=L().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new li(`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,u.shape,d.shape):new Wr("return (b >= 1.0) ? a : a * (b + 1.0);",u.shape,d.shape);return this.compileAndRun(y,[u,d])},h.prototype.selu=function(u){var d=new ci(u.shape,`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = 1.7580993408473768;
  float scale = 1.0507009873554805;
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`);return this.compileAndRun(d,[u])},h.prototype.int=function(u){var d=new ci(u.shape,"return float(int(x));");return this.compileAndRun(d,[u],"int32")},h.prototype.clip=function(u,d,y){var D,W=(D=L().getBool("WEBGL_PACK_CLIP")?new Zr(u.shape):new $r(u.shape)).getCustomSetupFunc(d,y);return this.compileAndRun(D,[u],null,W)},h.prototype.abs=function(u){if(this.shouldExecuteOnCPU([u]))return this.cpuBackend.abs(u);if(L().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(u,Ll,u.dtype);var d=new ci(u.shape,Ll);return this.compileAndRun(d,[u])},h.prototype.complexAbs=function(u){var d=this.texData.get(u.dataId),y=new function(W){this.variableNames=["real","imag"],this.outputShape=W,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}(u.shape),D=[this.makeComplexComponentTensorInfo(u,d.complexTensors.real),this.makeComplexComponentTensorInfo(u,d.complexTensors.imag)];return this.compileAndRun(y,D)},h.prototype.sigmoid=function(u){var d=new ci(u.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(d,[u])},h.prototype.softplus=function(u){var d=new ci(u.shape,`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`);return this.compileAndRun(d,[u])},h.prototype.sin=function(u){var d=new ci(u.shape,`if (isnan(x)) return x;
  return sin(x);
`);return this.compileAndRun(d,[u])},h.prototype.cos=function(u){var d=new ci(u.shape,`if (isnan(x)) return x;
  return cos(x);
`);return this.compileAndRun(d,[u])},h.prototype.tan=function(u){var d=new ci(u.shape,"return tan(x);");return this.compileAndRun(d,[u])},h.prototype.asin=function(u){var d=new ci(u.shape,`if (isnan(x)) return x;
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`);return this.compileAndRun(d,[u])},h.prototype.acos=function(u){var d=new ci(u.shape,`if (isnan(x)) return x;
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`);return this.compileAndRun(d,[u])},h.prototype.atan=function(u){var d=new ci(u.shape,`if (isnan(x)) return x;
  return atan(x);
`);return this.compileAndRun(d,[u])},h.prototype.atan2=function(u,d){var y=L().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new li(`
  vec4 result = atan(a, b);
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,u.shape,d.shape):new Wr(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return atan(a, b);
`,u.shape,d.shape);return this.compileAndRun(y,[u,d])},h.prototype.sinh=function(u){var d=new ci(u.shape,`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`);return this.compileAndRun(d,[u])},h.prototype.cosh=function(u){var d=new ci(u.shape,`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`);return this.compileAndRun(d,[u])},h.prototype.tanh=function(u){var d=new ci(u.shape,`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`);return this.compileAndRun(d,[u])},h.prototype.asinh=function(u){var d=new ci(u.shape,"if (isnan(x)) return x;return log(x + sqrt(x * x + 1.0));");return this.compileAndRun(d,[u])},h.prototype.acosh=function(u){var d=new ci(u.shape,`if (isnan(x)) return x;
  if (x < 1.0) return NAN;
  return log(x + sqrt(x * x - 1.0));`);return this.compileAndRun(d,[u])},h.prototype.atanh=function(u){var d=new ci(u.shape,`if (isnan(x)) return x;
  if ((x < -1.0) || (x > 1.0)) return NAN;
  return (log(1.0 + x) - log(1.0 - x)) / 2.0;`);return this.compileAndRun(d,[u])},h.prototype.erf=function(u){var d=new ci(u.shape,`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = 0.3275911;
  float a1 = 0.254829592;
  float a2 = -0.284496736;
  float a3 = 1.421413741;
  float a4 = -1.453152027;
  float a5 = 1.061405429;

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`);return this.compileAndRun(d,[u])},h.prototype.step=function(u,d){var y=new ci(u.shape,function(D){return D===void 0&&(D=0),Xd+`
    return x > 0.0 ? 1.0 : float(`+D+`);
  `}(d));return this.compileAndRun(y,[u])},h.prototype.conv2dByMatMul=function(u,d,y,D,W,X){var ae=u.shape,de=this.texData.get(u.dataId),be=y.inChannels,Ie=ae[0]*ae[1]*ae[2],Re=y.outChannels,Me=y.dataFormat==="channelsLast",qe=(Ie===1||Re===1)&&be>1e3,Je=ae[2]%2!=0&&!!de.isPacked;if(qe||!L().getBool("WEBGL_LAZILY_UNPACK")||!L().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!Je){var Qe=Me?ae[0]*ae[1]*ae[2]:ae[0]*ae[2]*ae[3],ot=this.reshape(u,[1,Qe,y.inChannels]),vt=this.reshape(d,[1,y.inChannels,y.outChannels]);return this.reshape(this.fusedBatchMatMul({a:ot,b:vt,transposeA:!1,transposeB:!1,bias:D,activation:W,preluActivationWeights:X}),y.outShape)}var bt=Me?ae[0]*ae[1]*(ae[2]+1):ae[0]*ae[2]*(ae[3]+1),wt={dataId:u.dataId,shape:[1,bt,y.inChannels],dtype:u.dtype},Ft=de.shape;de.shape=de.shape.slice(),de.shape[de.shape.length-2]++,we(su(de.shape,wt.shape),function(){return"packed reshape "+de.shape+" to "+wt.shape+" isn't free"});var Yt=this.reshape(d,[1,y.inChannels,y.outChannels]),an=this.fusedBatchMatMul({a:wt,b:Yt,transposeA:!1,transposeB:!1,bias:D,activation:W,preluActivationWeights:X}),Jt=this.texData.get(an.dataId);return we(Jt.isPacked,function(){return"batchMatMul result is expected to be packed"}),de.shape=Ft,Jt.shape=y.outShape,Ve.makeTensorFromDataId(an.dataId,y.outShape,an.dtype)},h.prototype.conv2dWithIm2Row=function(u,d,y,D,W,X){var ae=y.filterWidth,de=y.filterHeight,be=y.inChannels,Ie=y.outWidth,Re=y.outHeight,Me=y.dataFormat==="channelsLast",qe=ae*de*be,Je=Re*Ie,Qe=[qe,Je],ot=u.squeeze([0]),vt=d.reshape([1,qe,-1]),bt=new function(p,c,a){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=p;for(var l=a.filterWidth,g=a.inChannels,_=a.strideWidth,j=a.strideHeight,V=a.padInfo,ne=a.outWidth,oe=a.dilationWidth,me=a.dilationHeight,Ee=a.dataFormat,_e=V.left,Ne=V.top,Ue=g*l,$e=te(),He=Ee==="channelsLast",et=He?0:1,lt=He?1:2,ht="",gt=0;gt<=1;gt++)for(var Ct=0;Ct<=1;Ct++)ht+=`
          blockIndex = rc.y + `+Ct+`;
          pos = rc.x + `+gt+`;

          if(blockIndex < `+p[1]+" && pos < "+p[0]+`) {
            offsetY = int(blockIndex / (`+ne+")) * "+j+" - "+Ne+`;
            d0 = offsetY + `+me+" * (pos / "+Ue+`);

            if(d0 < `+c[et]+` && d0 >= 0) {

              offsetX = int(mod(float(blockIndex), `+ne+".) * "+_+". - "+_e+`.);
              d1 = offsetX + `+oe+" * (int(mod(float(pos), "+Ue+".) / "+g+`.));

              if(d1 < `+c[lt]+` && d1 >= 0) {

                ch = int(mod(float(pos), `+g+`.));

                if (`+He+`) {
                  innerDims = vec2(d1, ch);
                  result[`+(2*gt+Ct)+`] = getChannel(
                    getA(d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[`+(2*gt+Ct)+`] = getChannel(
                    getA(ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec2 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        `+ht+`

        `+$e.output+` = result;
      }
    `}(Qe,ot.shape,y),wt=this.compileAndRun(bt,[ot]).reshape([1,Qe[0],Qe[1]]),Ft=D!=null,Yt=X!=null,an=W?_m(W,!0):null,Jt=new Ia(wt.shape,[1,Je,y.outChannels],!0,!1,Ft,an,Yt),un=[wt,vt];D&&un.push(D),Yt&&un.push(X);var gn=this.compileAndRun(Jt,un);return Me?gn.reshape([1,Re,Ie,y.outChannels]):gn.reshape([1,y.outChannels,Re,Ie])},h.prototype.fusedConv2d=function(u){var d=u.input,y=u.filter,D=u.convInfo,W=u.bias,X=u.activation,ae=u.preluActivationWeights;if(D.filterHeight===1&&D.filterWidth===1&&D.dilationHeight===1&&D.dilationWidth===1&&D.strideHeight===1&&D.strideWidth===1&&(D.padInfo.type==="SAME"||D.padInfo.type==="VALID"))return this.conv2dByMatMul(d,y,D,W,X,ae);if(L().getBool("WEBGL_CONV_IM2COL")&&d.shape[0]===1)return this.conv2dWithIm2Row(d,y,D,W,X,ae);var de=W!=null,be=ae!=null,Ie=X?_m(X,!1):null,Re=new ea(D,de,Ie,be),Me=[d,y];return W&&Me.push(W),ae&&Me.push(ae),this.compileAndRun(Re,Me)},h.prototype.conv2d=function(u,d,y){if(y.filterHeight===1&&y.filterWidth===1&&y.dilationHeight===1&&y.dilationWidth===1&&y.strideHeight===1&&y.strideWidth===1&&(y.padInfo.type==="SAME"||y.padInfo.type==="VALID"))return this.conv2dByMatMul(u,d,y);if(L().getBool("WEBGL_CONV_IM2COL")&&u.shape[0]===1)return this.conv2dWithIm2Row(u,d,y);var D=new ea(y);return this.compileAndRun(D,[u,d])},h.prototype.conv2dDerInput=function(u,d,y){var D=new function(W){this.variableNames=["dy","W"],this.outputShape=W.inShape;var X=W.filterHeight,ae=W.filterWidth,de=W.strideHeight,be=W.strideWidth,Ie=W.dataFormat==="channelsLast",Re=X-1-W.padInfo.top,Me=ae-1-W.padInfo.left,qe=Ie?1:2,Je=Ie?2:3,Qe=Ie?3:1;this.userCode=`
      const ivec2 pads = ivec2(`+Re+", "+Me+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[`+Qe+`];

        ivec2 dyCorner = ivec2(coords[`+qe+"], coords["+Je+`]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+X+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+de+`.0;

          if (dyR < 0.0 || dyR >= `+W.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+X+` - 1 - wR;

          for (int wC = 0; wC < `+ae+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+be+`.0;

            if (dyC < 0.0 || dyC >= `+W.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+ae+` - 1 - wC;

            for (int d2 = 0; d2 < `+W.outChannels+`; d2++) {

              if (`+Ie+`) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}(y);return this.compileAndRun(D,[u,d])},h.prototype.conv2dDerFilter=function(u,d,y){var D=new function(W){this.variableNames=["x","dy"],this.outputShape=W.filterShape;var X=W.strideHeight,ae=W.strideWidth,de=W.padInfo.top,be=W.padInfo.left,Ie=W.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < `+W.batchSize+`; b++) {
          for (int yR = 0; yR < `+W.outHeight+`; yR++) {
            int xR = wR + yR * `+X+" - "+de+`;

            if (xR < 0 || xR >= `+W.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+W.outWidth+`; yC++) {
              int xC = wC + yC * `+ae+" - "+be+`;

              if (xC < 0 || xC >= `+W.inWidth+`) {
                continue;
              }

              if (`+Ie+`) {
                float dyValue = getDy(b, yR, yC, d2);
                float xValue = getX(b, xR, xC, d1);
                dotProd += (xValue * dyValue);
              } else {
                float dyValue = getDy(b, d2, yR, yC);
                float xValue = getX(b, d1, xR, xC);
                dotProd += (xValue * dyValue);
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}(y);return this.compileAndRun(D,[u,d])},h.prototype.fusedDepthwiseConv2D=function(u){var d,y=u.input,D=u.filter,W=u.convInfo,X=u.bias,ae=u.activation,de=u.preluActivationWeights,be=L().getBool("WEBGL_PACK_DEPTHWISECONV")&&W.strideWidth<=2&&W.outChannels/W.inChannels==1,Ie=ae?_m(ae,be):null,Re=[y,D],Me=X!=null,qe=de!=null;return Me&&Re.push(X),qe&&Re.push(de),be?(d=new Ii(W,Me,Ie,qe),this.compileAndRun(d,Re)):(d=new La(W,Me,Ie,qe),this.compileAndRun(d,Re))},h.prototype.depthwiseConv2D=function(u,d,y){var D;return L().getBool("WEBGL_PACK_DEPTHWISECONV")&&y.strideWidth<=2&&y.outChannels/y.inChannels==1?(D=new Ii(y),this.compileAndRun(D,[u,d])):(D=new La(y),this.compileAndRun(D,[u,d]))},h.prototype.depthwiseConv2DDerInput=function(u,d,y){var D=new function(W){this.variableNames=["dy","W"],this.outputShape=W.inShape;var X=W.filterHeight,ae=W.filterWidth,de=W.strideHeight,be=W.strideWidth,Ie=X-1-W.padInfo.top,Re=ae-1-W.padInfo.left,Me=W.outChannels/W.inChannels;this.userCode=`
      const ivec2 pads = ivec2(`+Ie+", "+Re+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < `+X+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+de+`.0;

          if (dyR < 0.0 || dyR >= `+W.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+X+` - 1 - wR;

          for (int wC = 0; wC < `+ae+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+be+`.0;

            if (dyC < 0.0 || dyC >= `+W.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+ae+` - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < `+Me+`; dm++) {
              int d2 = d1 * `+Me+` + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}(y);return this.compileAndRun(D,[u,d])},h.prototype.depthwiseConv2DDerFilter=function(u,d,y){var D=new function(W){this.variableNames=["x","dy"],this.outputShape=W.filterShape;var X=W.strideHeight,ae=W.strideWidth,de=W.padInfo.top,be=W.padInfo.left,Ie=W.outChannels/W.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * `+Ie+` + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < `+W.batchSize+`; b++) {
          for (int yR = 0; yR < `+W.outHeight+`; yR++) {
            int xR = wR + yR * `+X+" - "+de+`;

            if (xR < 0 || xR >= `+W.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+W.outWidth+`; yC++) {
              int xC = wC + yC * `+ae+" - "+be+`;

              if (xC < 0 || xC >= `+W.inWidth+`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}(y);return this.compileAndRun(D,[u,d])},h.prototype.conv3d=function(u,d,y){var D=new function(W){this.variableNames=["x","W"],this.outputShape=W.outShape;var X=W.padInfo.front,ae=W.padInfo.top,de=W.padInfo.left,be=W.strideDepth,Ie=W.strideHeight,Re=W.strideWidth,Me=W.dilationDepth,qe=W.dilationHeight,Je=W.dilationWidth,Qe=W.filterDepth,ot=W.filterHeight,vt=W.filterWidth,bt=4*Math.floor(W.inChannels/4),wt=W.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(`+be+", "+Ie+", "+Re+`);
      const ivec3 pads = ivec3(`+X+", "+ae+", "+de+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < `+Qe+`; wF++) {
          int xF = xFCorner + wF * `+Me+`;

          if (xF < 0 || xF >= `+W.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+ot+`; wR++) {
            int xR = xRCorner + wR * `+qe+`;

            if (xR < 0 || xR >= `+W.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+vt+`; wC++) {
              int xC = xCCorner + wC * `+Je+`;

              if (xC < 0 || xC >= `+W.inWidth+`) {
                continue;
              }

              for (int d1 = 0; d1 < `+bt+`; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (`+(wt===1)+`) {
                dotProd +=
                  getX(batch, xF, xR, xC, `+bt+`) *
                  getW(wF, wR, wC, `+bt+`, d2);
              } else if (`+(wt===2)+`) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, `+bt+`),
                  getX(batch, xF, xR, xC, `+bt+` + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, `+bt+`, d2),
                  getW(wF, wR, wC, `+bt+` + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (`+(wt===3)+`) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, `+bt+`),
                  getX(batch, xF, xR, xC, `+bt+` + 1),
                  getX(batch, xF, xR, xC, `+bt+` + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, `+bt+`, d2),
                  getW(wF, wR, wC, `+bt+` + 1, d2),
                  getW(wF, wR, wC, `+bt+` + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}(y);return this.compileAndRun(D,[u,d])},h.prototype.conv3dDerInput=function(u,d,y){var D=new function(W){this.variableNames=["dy","W"],this.outputShape=W.inShape;var X=W.filterDepth,ae=W.filterHeight,de=W.filterWidth,be=W.strideDepth,Ie=W.strideHeight,Re=W.strideWidth,Me=X-1-W.padInfo.front,qe=ae-1-W.padInfo.top,Je=de-1-W.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(`+Me+", "+qe+", "+Je+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < `+X+`; wF++) {
          float dyF = float(dyFCorner + wF) / `+be+`.0;

          if (dyF < 0.0 || dyF >= `+W.outDepth+`.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = `+X+` - 1 - wF;

          for (int wR = 0; wR < `+ae+`; wR++) {
            float dyR = float(dyRCorner + wR) / `+Ie+`.0;

            if (dyR < 0.0 || dyR >= `+W.outHeight+`.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = `+ae+` - 1 - wR;

            for (int wC = 0; wC < `+de+`; wC++) {
              float dyC = float(dyCCorner + wC) / `+Re+`.0;

              if (dyC < 0.0 || dyC >= `+W.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = `+de+` - 1 - wC;

              for (int d2 = 0; d2 < `+W.outChannels+`; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}(y);return this.compileAndRun(D,[u,d])},h.prototype.conv3dDerFilter=function(u,d,y){var D=new function(W){this.variableNames=["x","dy"],this.outputShape=W.filterShape;var X=W.strideDepth,ae=W.strideHeight,de=W.strideWidth,be=W.padInfo.front,Ie=W.padInfo.top,Re=W.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < `+W.batchSize+`; b++) {
          for (int yF = 0; yF < `+W.outDepth+`; yF++) {
            int xF = wF + yF * `+X+" - "+be+`;

            if (xF < 0 || xF >= `+W.inDepth+`) {
              continue;
            }

            for (int yR = 0; yR < `+W.outHeight+`; yR++) {
              int xR = wR + yR * `+ae+" - "+Ie+`;

              if (xR < 0 || xR >= `+W.inHeight+`) {
                continue;
              }

              for (int yC = 0; yC < `+W.outWidth+`; yC++) {
                int xC = wC + yC * `+de+" - "+Re+`;

                if (xC < 0 || xC >= `+W.inWidth+`) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}(y);return this.compileAndRun(D,[u,d])},h.prototype.maxPool=function(u,d){var y=new hs(d,"max",!1);return this.compileAndRun(y,[u])},h.prototype.avgPool=function(u,d){var y=new hs(d,"avg",!1);return this.compileAndRun(y,[u],"float32")},h.prototype.maxPoolBackprop=function(u,d,y,D){var W=new hs(D,"max",!0),X=this.compileAndRun(W,[d]),ae=new function(be){this.variableNames=["dy","maxPos"],this.outputShape=be.inShape;var Ie=be.strideHeight,Re=be.strideWidth,Me=be.dilationHeight,qe=be.effectiveFilterHeight,Je=be.effectiveFilterWidth,Qe=qe-1-be.padInfo.top,ot=Je-1-be.padInfo.left,vt=qe*Je-1;this.userCode=`
      const ivec2 pads = ivec2(`+Qe+", "+ot+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+qe+`;
          wR += `+Me+`) {
          float dyR = float(dyRCorner + wR) / `+Ie+`.0;

          if (dyR < 0.0 || dyR >= `+be.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+Je+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+Re+`.0;

            if (dyC < 0.0 || dyC >= `+be.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = `+vt+` - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * `+Je+` + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}(D),de=this.compileAndRun(ae,[u,X],d.dtype);return X.dispose(),de},h.prototype.avgPoolBackprop=function(u,d,y){var D=new function(W){this.variableNames=["dy"],this.outputShape=W.inShape;var X=W.filterHeight,ae=W.filterWidth,de=W.strideHeight,be=W.strideWidth,Ie=W.dilationHeight,Re=W.dilationWidth,Me=W.effectiveFilterHeight,qe=W.effectiveFilterWidth,Je=Me-1-W.padInfo.top,Qe=qe-1-W.padInfo.left,ot=1/(X*ae);this.userCode=`
      const ivec2 pads = ivec2(`+Je+", "+Qe+`);
      const float avgMultiplier = float(`+ot+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+Me+`;
            wR += `+Ie+`) {
          float dyR = float(dyRCorner + wR) / `+de+`.0;

          if (dyR < 0.0 || dyR >= `+W.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+qe+`;
            wC+= `+Re+`) {
            float dyC = float(dyCCorner + wC) / `+be+`.0;

            if (dyC < 0.0 || dyC >= `+W.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}(y);return this.compileAndRun(D,[u],d.dtype)},h.prototype.cast=function(u,d){return Hs(u,d,this)},h.prototype.unstack=function(u,d){for(var y=u.shape[d],D=new Array(u.rank-1),W=0,X=0;X<u.rank;X++)X!==d&&(D[W++]=u.shape[X]);var ae=new Array(u.rank).fill(0),de=u.shape.slice();de[d]=1;var be=new Array(y);for(X=0;X<be.length;X++)ae[d]=X,be[X]=this.slice(u,ae,de).reshape(D);return be},h.prototype.avgPool3d=function(u,d){var y=new ia(d,"avg",!1);return this.compileAndRun(y,[u],"float32")},h.prototype.avgPool3dBackprop=function(u,d,y){var D=new function(W){this.variableNames=["dy"],this.outputShape=W.inShape;var X=W.filterDepth,ae=W.filterHeight,de=W.filterWidth,be=W.strideDepth,Ie=W.strideHeight,Re=W.strideWidth,Me=W.dilationDepth,qe=W.dilationHeight,Je=W.dilationWidth,Qe=W.effectiveFilterDepth,ot=W.effectiveFilterHeight,vt=W.effectiveFilterWidth,bt=Qe-1-W.padInfo.front,wt=ot-1-W.padInfo.top,Ft=vt-1-W.padInfo.left,Yt=1/(X*ae*de);this.userCode=`
      const ivec3 pads = ivec3(`+bt+", "+wt+", "+Ft+`);
      const float avgMultiplier = float(`+Yt+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+Qe+`;
            wD += `+Me+`) {
          float dyD = float(dyDCorner + wD) / `+be+`.0;

          if (dyD < 0.0 || dyD >= `+W.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+ot+`;
              wR += `+qe+`) {
            float dyR = float(dyRCorner + wR) / `+Ie+`.0;

            if (dyR < 0.0 || dyR >= `+W.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+vt+`;
                wC += `+Je+`) {
              float dyC = float(dyCCorner + wC) / `+Re+`.0;

              if (dyC < 0.0 || dyC >= `+W.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}(y);return this.compileAndRun(D,[u],d.dtype)},h.prototype.maxPool3d=function(u,d){var y=new ia(d,"max",!1);return this.compileAndRun(y,[u],"float32")},h.prototype.maxPool3dBackprop=function(u,d,y,D){var W=new ia(D,"max",!0),X=this.compileAndRun(W,[d]),ae=new function(be){this.variableNames=["dy","maxPos"],this.outputShape=be.inShape;var Ie=be.strideDepth,Re=be.strideHeight,Me=be.strideWidth,qe=be.dilationDepth,Je=be.dilationHeight,Qe=be.dilationWidth,ot=be.effectiveFilterDepth,vt=be.effectiveFilterHeight,bt=be.effectiveFilterWidth,wt=ot-1-be.padInfo.front,Ft=vt-1-be.padInfo.top,Yt=bt-1-be.padInfo.left,an=ot*vt*bt-1;this.userCode=`
      const ivec3 pads = ivec3(`+wt+", "+Ft+", "+Yt+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+ot+`;
           wD += `+qe+`) {
          float dyD = float(dyDCorner + wD) / `+Ie+`.0;

          if (dyD < 0.0 || dyD >= `+be.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+vt+`;
              wR += `+Je+`) {
            float dyR = float(dyRCorner + wR) / `+Re+`.0;

            if (dyR < 0.0 || dyR >= `+be.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+bt+`;
                wC += `+Qe+`) {
              float dyC = float(dyCCorner + wC) / `+Me+`.0;

              if (dyC < 0.0 || dyC >= `+be.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = `+an+` -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * `+vt+" * "+bt+` +
                  wR * `+bt+` + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}(D),de=this.compileAndRun(ae,[u,X],d.dtype);return X.dispose(),de},h.prototype.reshape=function(u,d){var y=this.texData.get(u.dataId);if(y.isPacked&&!su(u.shape,d)&&(y.texture===null||!su(y.shape,d))){var D=this.packedReshape(u,d);return Ve.makeTensorFromDataId(D.dataId,D.shape,D.dtype)}return Eu(u,d)},h.prototype.resizeBilinear=function(u,d,y,D){var W=L().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new function(X,ae,de,be){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var Ie=X[0],Re=X[1],Me=X[2],qe=X[3];this.outputShape=[Ie,ae,de,qe];var Je=[be&&ae>1?Re-1:Re,be&&de>1?Me-1:Me],Qe=[be&&ae>1?ae-1:ae,be&&de>1?de-1:de];this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `+Je[0]/Qe[0]+`,
          `+Je[1]/Qe[1]+`,
          `+Je[1]/Qe[1]+`);
      const vec3 inputShapeRC = vec3(`+Re+".0, "+Me+`.0,
                                     `+Me+`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `+(qe-1)+`;
        bool hasNextRow = coords.z < `+(de-1)+`;

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}(u.shape,d,y,D):new function(X,ae,de,be){this.variableNames=["A"],this.outputShape=[];var Ie=X[0],Re=X[1],Me=X[2],qe=X[3];this.outputShape=[Ie,ae,de,qe];var Je=[be&&ae>1?Re-1:Re,be&&de>1?Me-1:Me],Qe=[be&&ae>1?ae-1:ae,be&&de>1?de-1:de];this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+Je[0]/Qe[0]+`,
          `+Je[1]/Qe[1]+`);
      const vec2 inputShapeRC = vec2(`+Re+".0, "+Me+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}(u.shape,d,y,D);return this.compileAndRun(W,[u],"float32")},h.prototype.resizeBilinearBackprop=function(u,d,y){var D=new function(W,X,ae){this.variableNames=["dy"],this.outputShape=[],this.outputShape=X.shape;var de=X.shape,be=de[1],Ie=de[2],Re=W.shape,Me=Re[1],qe=Re[2],Je=[ae&&Me>1?be-1:be,ae&&qe>1?Ie-1:Ie],Qe=[ae&&Me>1?Me-1:Me,ae&&qe>1?qe-1:qe],ot=Je[0]/Qe[0],vt=Je[1]/Qe[1],bt=1/ot,wt=1/vt,Ft=2*Math.ceil(bt)+2,Yt=2*Math.ceil(wt)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+ot+`);
        const float widthScale = float(`+vt+`);

        const float invHeightScale = float(`+bt+`);
        const float invWidthScale = float(`+wt+`);

        const int winHeight = int(`+Ft+`);
        const int winWidth = int(`+Yt+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+Me+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+qe+`) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), `+(be-1)+`.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), `+(Ie-1)+`.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}(u,d,y);return this.compileAndRun(D,[u])},h.prototype.resizeNearestNeighbor=function(u,d,y,D){var W=new function(X,ae,de,be){this.variableNames=["A"],this.outputShape=[];var Ie=X[0],Re=X[1],Me=X[2],qe=X[3];this.outputShape=[Ie,ae,de,qe];var Je=[be&&ae>1?Re-1:Re,be&&de>1?Me-1:Me],Qe=[be&&ae>1?ae-1:ae,be&&de>1?de-1:de],ot=be?"0.5":"0.0";this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+Je[0]/Qe[0]+`,
          `+Je[1]/Qe[1]+`);
      const vec2 inputShapeRC = vec2(`+Re+".0, "+Me+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `+ot+`)));

        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}(u.shape,d,y,D);return this.compileAndRun(W,[u])},h.prototype.resizeNearestNeighborBackprop=function(u,d,y){var D=new function(W,X,ae){this.variableNames=["dy"],this.outputShape=[],this.outputShape=X.shape;var de=X.shape,be=de[1],Ie=de[2],Re=W.shape,Me=Re[1],qe=Re[2],Je=[ae&&Me>1?be-1:be,ae&&qe>1?Ie-1:Ie],Qe=[ae&&Me>1?Me-1:Me,ae&&qe>1?qe-1:qe],ot=Je[0]/Qe[0],vt=Je[1]/Qe[1],bt=1/ot,wt=1/vt,Ft=2*Math.ceil(bt)+2,Yt=2*Math.ceil(wt)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+ot+`);
        const float widthScale = float(`+vt+`);

        const float invHeightScale = float(`+bt+`);
        const float invWidthScale = float(`+wt+`);

        const int winHeight = int(`+Ft+`);
        const int winWidth = int(`+Yt+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+Me+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+qe+`) {
              continue;
            }

            float sourceFracRow =
              float(`+Je[0]+`) *
                (float(dyR) / float(`+Qe[0]+`));

            float sourceFracCol =
                float(`+Je[1]+`) *
                  (float(dyC) / float(`+Qe[1]+`));

            int sourceNearestRow = int(min(
                float(int(`+be+`) - 1),
                `+ae+` ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(`+Ie+`) - 1),
                `+ae+` ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}(u,d,y);return this.compileAndRun(D,[u])},h.prototype.multinomial=function(u,d,y,D){var W=d?u:Os(u),X=W.shape[0],ae=W.shape[1],de=new _s(X,ae,y),be=de.getCustomSetupFunc(D);return this.compileAndRun(de,[W],"int32",be)},h.prototype.oneHot=function(u,d,y,D){var W=new function(X,ae,de,be){this.variableNames=["indices"],this.outputShape=[X,ae],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(`+be+"), float("+de+`),
                      float(index == coords.y)));
      }
    `}(u.size,d,y,D);return this.compileAndRun(W,[u])},h.prototype.diag=function(u){var d=new function(y){this.variableNames=["X"],this.outputShape=[y,y],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}(u.size);return this.compileAndRun(d,[u])},h.prototype.nonMaxSuppression=function(u,d,y,D,W){return qc("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),Ou(u.dataSync(),d.dataSync(),y,D,W)},h.prototype.cropAndResize=function(u,d,y,D,W,X){var ae=new function(de,be,Ie,Re,Me){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var qe=de[0],Je=de[1],Qe=de[2],ot=de[3],vt=be[0],bt=Ie[0],wt=Ie[1];this.outputShape=[vt,bt,wt,ot];var Ft=Re==="bilinear"?1:0,Yt=[Je-1+".0",Qe-1+".0"],an=Yt[0],Jt=Yt[1],un=bt>1?[""+(Je-1)/(bt-1),"(y2-y1) * height_ratio","y1*"+an+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+an],gn=un[0],p=un[1],c=un[2],a=wt>1?[""+(Qe-1)/(wt-1),"(x2-x1) * width_ratio","x1*"+Jt+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+Jt],l=a[0],g=a[1],_=a[2];this.userCode=`
      const float height_ratio = float(`+gn+`);
      const float width_ratio = float(`+l+`);
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= `+qe+`) {
          return;
        }

        float height_scale = `+p+`;
        float width_scale = `+g+`;

        float in_y = `+c+`;
        if( in_y < 0.0 || in_y > `+an+` ) {
          setOutput(float(`+Me+`));
          return;
        }
        float in_x = `+_+`;
        if( in_x < 0.0 || in_x > `+Jt+` ) {
          setOutput(float(`+Me+`));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(`+Ft+` == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}(u.shape,d.shape,D,W,X);return this.compileAndRun(ae,[u,d,y],"float32")},h.prototype.depthToSpace=function(u,d,y){we(d>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+d});var D=u.shape[0],W=y==="NHWC"?u.shape[1]:u.shape[2],X=y==="NHWC"?u.shape[2]:u.shape[3],ae=y==="NHWC"?u.shape[3]:u.shape[1],de=W*d,be=X*d,Ie=ae/(d*d),Re=new Ya(y==="NHWC"?[D,de,be,Ie]:[D,Ie,de,be],d,y);return this.compileAndRun(Re,[u])},h.prototype.split=function(u,d,y){return Pl(u,d,y)},h.prototype.scatterND=function(u,d,y){var D=Yc(0,u,y),W=D.sliceRank,X=D.numUpdates,ae=D.sliceSize,de=D.strides,be=D.outputSize,Ie=[be/ae,ae],Re=u.reshape([X,W]),Me=d.reshape([X,ae]);if(be===0)return Eu(wa([]),y);var qe=fr(0),Je=new Ss(X,W,Re.rank,Me.rank,de,Ie);return this.compileAndRun(Je,[Me,Re,qe]).reshape(y)},h.prototype.sparseToDense=function(u,d,y,D){var W=Yc(0,u,y),X=W.sliceRank,ae=W.numUpdates,de=W.strides,be=W.outputSize,Ie=new Ss(ae,X,u.rank,d.rank,de,[be,1]);return this.compileAndRun(Ie,[d,u,D]).reshape(y)},h.prototype.fft=function(u){return this.fftImpl(u,!1)},h.prototype.ifft=function(u){return this.fftImpl(u,!0)},h.prototype.fftImpl=function(u,d){var y=this.texData.get(u.dataId),D=new Sa("return real * expR - imag * expI;",u.shape,d),W=new Sa("return real * expI + imag * expR;",u.shape,d),X=[this.makeComplexComponentTensorInfo(u,y.complexTensors.real),this.makeComplexComponentTensorInfo(u,y.complexTensors.imag)],ae=this.compileAndRun(D,X),de=this.compileAndRun(W,X),be=this.complex(ae,de).as2D(u.shape[0],u.shape[1]);return ae.dispose(),de.dispose(),be},h.prototype.gatherND=function(u,d){var y=d.shape,D=y[y.length-1],W=Wu(u,d),X=W[0],ae=W[1],de=W[2],be=W[3],Ie=d.reshape([ae,D]),Re=u.reshape([u.size/de,de]),Me=new function(qe,Je,Qe){this.sliceDim=qe,this.strides=Je,this.variableNames=["x","indices"],this.outputShape=Qe;var ot=Mn(Je.length),vt=Mn(Qe.length),bt=this.sliceDim>1?"strides[j]":"strides";this.userCode=`
        `+ot+" strides = "+ot+"("+this.strides+`);
         void main() {
          `+vt+` coords = getOutputCoords();
          int flattenIndex = 0;
          for (int j = 0; j < `+this.sliceDim+`; j++) {
            int index = round(getIndices(coords[0], j));
            flattenIndex += index * `+bt+`;
          }
          setOutput(getX(flattenIndex, coords[1]));
        }
      `}(D,be,[ae,de]);return this.compileAndRun(Me,[Re,Ie]).reshape(X)},h.prototype.fill=function(u,d,y){if((y=y||xe(d))==="string"){var D=fn(y,Ye(u));return D.fill(d),Ve.makeTensor(D,u,y,this)}var W=new xo(u,d),X=W.getCustomSetupFunc(d);return this.compileAndRun(W,[],y,X)},h.prototype.onesLike=function(u){if(u.dtype==="string")throw new Error("onesLike is not supported under string dtype");return this.fill(u.shape,1,u.dtype)},h.prototype.zerosLike=function(u){return this.fill(u.shape,u.dtype==="string"?"":0,u.dtype)},h.prototype.linspace=function(u,d,y){return qu(u,d,y)},h.prototype.makeTensorInfo=function(u,d){var y=this.write(null,u,d);return this.texData.get(y).usage=null,{dataId:y,shape:u,dtype:d}},h.prototype.makeOutput=function(u,d){var y=this.makeTensorInfo(u,d).dataId;return Ve.makeTensorFromDataId(y,u,d,this)},h.prototype.unpackTensor=function(u){var d=new function(y){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=y;var D=y.length,W=N("rc",D),X=Mn(D),ae=function(Ie,Re){if(Ie===1)return"rc";for(var Me="",qe=0;qe<Ie;qe++)Me+=Re[qe],qe<Ie-1&&(Me+=",");return Me}(D,W),de=W.slice(-2),be=D<=1?"rc":"vec2("+de.join(",")+")";this.userCode=`
      void main() {
        `+X+` rc = getOutputCoords();
        vec4 packedInput = getA(`+ae+`);

        setOutput(getChannel(packedInput, `+be+`));
      }
    `}(u.shape);return this.runWebGLProgram(d,[u],u.dtype)},h.prototype.packTensor=function(u){var d=new function(y){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=y;var D=y.length;if(D===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{var W=N("rc",D),X=Mn(D),ae=function(Ie,Re,Me){if(Ie===1)return"rc > "+Re[0];for(var qe="",Je=Ie-2;Je<Ie;Je++)qe+=Me[Je]+" >= "+Re[Je],Je<Ie-1&&(qe+="||");return qe}(D,y,W),de=function(Ie,Re,Me,qe){if(Ie===1)return"";var Je=qe.slice(-2);return`
    int r = `+Je[0]+`;
    int c = `+Je[1]+`;
    int rp1 = r + 1;
    int cp1 = c + 1;

    bool cEdge = cp1 >= `+Re+`;
    bool rEdge = rp1 >= `+Me+`;
  `}(D,y[y.length-1],y[y.length-2],W),be=function(Ie,Re){var Me=Ie.length,qe=function(Je,Qe){for(var ot=[],vt=0;vt<=1;vt++)for(var bt=0;bt<=1;bt++){for(var wt=(vt===0?"r":"rp1")+", "+(bt===0?"c":"cp1"),Ft=2;Ft<Je;Ft++)wt=Qe[Qe.length-1-Ft]+","+wt;ot.push(wt)}return ot}(Me,Re);return Me===1?`getA(rc),
            rc + 1 >= `+Ie[0]+` ? 0. : getA(rc + 1),
            0, 0`:"getA("+qe[0]+`),
          cEdge ? 0. : getA(`+qe[1]+`),
          rEdge ? 0. : getA(`+qe[2]+`),
          rEdge || cEdge ? 0. : getA(`+qe[3]+")"}(y,W);this.userCode=`
        void main() {
          `+X+` rc = getOutputCoords();

          if(`+ae+`) {
            setOutput(vec4(0));
          } else {
            `+de+`

            setOutput(vec4(`+be+`));
          }
        }
      `}}(u.shape);return this.runWebGLProgram(d,[u],u.dtype,null,!0)},h.prototype.packedReshape=function(u,d){var y=[ss(u.shape)].concat(Eo(u.shape)),D={dtype:u.dtype,shape:y,dataId:u.dataId},W=new function(ae,de){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=ae;for(var be="",Ie=0;Ie<4;Ie++){var Re="thisRC = rc;";Ie%2==1&&(Re+="thisRC.z += 1;"),Ie>1&&(Re+="thisRC.y += 1;"),be+=`
        `+Re+`
        `+(Ie>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+`
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[`+Ie+`] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        `+(Ie>0?"}":"")+`
      `}this.userCode=`
      
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      `+Be(["r","c","d"],de)+`
      return ivec3(r, c, d);
    }
  
      `+Ge(ae)+`

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = `+ae[1]+`;
        int cols = `+ae[2]+`;

        `+be+`

        setOutput(result);
      }
    `}([ss(d)].concat(Eo(d)),y),X=this.runWebGLProgram(W,[D],u.dtype,null,!0);return{dataId:X.dataId,shape:d,dtype:X.dtype}},h.prototype.decode=function(u){var d,y=this.texData.get(u),D=y.isPacked,W=y.shape,X=y.dtype,ae=nc(W);return d=D?new function(de){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Zn.DENSE;var be=Di(de),Ie=te();this.outputShape=de,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+Be(["r","c","d"],de)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+be[0]+", "+be[1]+`));
        int index = 4 * (resTexRC.x * `+be[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        `+Ie.output+` = result;
      }
    `}(ae):new function(de){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Zn.DENSE;var be=Di(de),Ie=te();this.outputShape=de,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+Be(["r","c","d"],de)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+be[0]+", "+be[1]+`));
        int index = 4 * (resTexRC.x * `+be[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        `+Ie.output+` = result;
      }
    `}(ae),{dtype:X,shape:W,dataId:this.runWebGLProgram(d,[{shape:ae,dtype:X,dataId:u}],X,null,!0).dataId}},h.prototype.runWebGLProgram=function(u,d,y,D,W){var X=this;W===void 0&&(W=!1);var ae=this.makeTensorInfo(u.outputShape,y),de=this.texData.get(ae.dataId);if(u.packedOutput&&(de.isPacked=!0),u.outPackingScheme===Zn.DENSE){var be=Di(u.outputShape);de.texShape=be.map(function(bt){return 2*bt})}if(u.outTexUsage!=null&&(de.usage=u.outTexUsage),Ye(ae.shape)===0)return de.values=Yn(ae.dtype,0),ae;var Ie=[],Re=d.map(function(bt){if(bt.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var wt=X.texData.get(bt.dataId);if(wt.texture==null){if(!u.packedInputs&&Ye(bt.shape)<=L().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:bt.shape,texData:null,isUniform:!0,uniformValues:wt.values};u.packedInputs&&(wt.isPacked=!0,wt.shape=bt.shape)}else if(!!wt.isPacked!=!!u.packedInputs)bt=wt.isPacked?X.unpackTensor(bt):X.packTensor(bt),Ie.push(bt),wt=X.texData.get(bt.dataId);else if(wt.isPacked&&!su(wt.shape,bt.shape)){var Ft=bt,Yt=bt.shape;bt.shape=wt.shape,bt=X.packedReshape(bt,Yt),Ie.push(bt),wt=X.texData.get(bt.dataId),Ft.shape=Yt}return X.uploadToGPU(bt.dataId),{shape:bt.shape,texData:wt,isUniform:!1}});this.uploadToGPU(ae.dataId);var Me,qe={shape:ae.shape,texData:de,isUniform:!1},Je=function(bt,wt,Ft){var Yt="";Re.concat(Ft).forEach(function(Jt){var un=Jt.texData!=null&&Jt.texData.slice!=null&&Jt.texData.slice.flatOffset>0,gn=Jt.isUniform?"uniform":Jt.texData.texShape;Yt+=Jt.shape+"_"+gn+"_"+un});var an=bt.userCode;return bt.constructor.name+"_"+Yt+"_"+an}(u,0,qe),Qe=this.getAndSaveBinary(Je,function(){return function(bt,wt,Ft,Yt){var an=wt.userCode,Jt=Ft.map(function(V,ne){var oe={logicalShape:V.shape,texShape:V.isUniform?null:V.texData.texShape,isUniform:V.isUniform,isPacked:!V.isUniform&&V.texData.isPacked,flatOffset:null};return V.texData!=null&&V.texData.slice!=null&&V.texData.slice.flatOffset>0&&(oe.flatOffset=V.texData.slice.flatOffset),{name:wt.variableNames[ne],shapeInfo:oe}}),un=Jt.map(function(V){return V.shapeInfo}),gn={logicalShape:Yt.shape,texShape:Yt.texData.texShape,isUniform:!1,isPacked:Yt.texData.isPacked,flatOffset:null},p=Nt(Jt,gn,an,wt.packedInputs),c=bt.createProgram(p),a=null,l=bt.getUniformLocation(c,"NAN",!1);L().getNumber("WEBGL_VERSION")===1&&(a=bt.getUniformLocation(c,"INFINITY",!1));for(var g={},_=0;_<wt.variableNames.length;_++){var j=wt.variableNames[_];g[j]=bt.getUniformLocation(c,j,!1),g["offset"+j]=bt.getUniformLocation(c,"offset"+j,!1)}return{program:wt,source:p,webGLProgram:c,uniformLocations:g,inShapeInfos:un,outShapeInfo:gn,infLoc:a,nanLoc:l}}(X.gpgpu,u,Re,qe)}),ot=this.activeTimers!=null;if(ot&&(Me=this.startTimer()),function(bt,wt,Ft,Yt,an){fu(wt.inShapeInfos,Ft),fu([wt.outShapeInfo],[Yt]);var Jt=Yt.texData.texture,un=Yt.texData.texShape;Yt.texData.isPacked?bt.setOutputPackedMatrixTexture(Jt,un[0],un[1]):bt.setOutputMatrixTexture(Jt,un[0],un[1]),bt.setProgram(wt.webGLProgram),L().getNumber("WEBGL_VERSION")===1&&wt.infLoc!==null&&bt.gl.uniform1f(wt.infLoc,1/0),wt.nanLoc!==null&&bt.gl.uniform1f(wt.nanLoc,NaN),Ft.forEach(function(gn,p){var c=wt.program.variableNames[p],a=wt.uniformLocations[c],l=wt.uniformLocations["offset"+c];if(a!=null)if(gn.isUniform)if(Ye(gn.shape)<2)bt.gl.uniform1f(a,gn.uniformValues[0]);else{var g=gn.uniformValues;g instanceof Float32Array||(g=new Float32Array(g)),bt.gl.uniform1fv(a,g)}else gn.texData.slice!=null&&l!=null&&bt.gl.uniform1i(l,gn.texData.slice.flatOffset),bt.setInputMatrixTexture(gn.texData.texture,a,p)}),an?.(bt,wt.webGLProgram),bt.executeProgram()}(this.gpgpu,Qe,Re,qe,D),Ie.forEach(function(bt){return X.disposeData(bt.dataId)}),ot&&(Me=this.endTimer(Me),this.activeTimers.push({name:u.constructor.name,query:this.getQueryTime(Me)})),!L().getBool("WEBGL_LAZILY_UNPACK")&&de.isPacked&&W===!1){var vt=this.unpackTensor(ae);return this.disposeData(ae.dataId),vt}return ae},h.prototype.compileAndRun=function(u,d,y,D,W){W===void 0&&(W=!1),y=y||d[0].dtype;var X=this.runWebGLProgram(u,d,y,D,W);return Ve.makeTensorFromDataId(X.dataId,X.shape,X.dtype)},h.prototype.getAndSaveBinary=function(u,d){return u in this.binaryCache||(this.binaryCache[u]=d()),this.binaryCache[u]},h.prototype.getTextureManager=function(){return this.textureManager},h.prototype.dispose=function(){var u=this;this.disposed||(L().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(function(d){u.gpgpu.deleteProgram(u.binaryCache[d].webGLProgram),delete u.binaryCache[d]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},h.prototype.floatPrecision=function(){var u=this;return this.floatPrecisionValue==null&&(this.floatPrecisionValue=Fi(function(){if(!L().get("WEBGL_RENDER_FLOAT32_ENABLED")){var d=L().getBool("DEBUG");L().set("DEBUG",!1);var y=u.abs(fr(1e-8)).dataSync()[0];if(L().set("DEBUG",d),y>0)return 32}return 16})),this.floatPrecisionValue},h.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},h.prototype.uploadToGPU=function(u){var d,y=this.texData.get(u),D=y.shape,W=y.dtype,X=y.values,ae=y.texture,de=y.usage,be=y.isPacked;if(ae==null){var Ie,Re=this.activeTimers!=null;Re&&(Ie=nn());var Me=y.texShape;if(Me==null&&(Me=Cl(D,be),y.texShape=Me),X!=null){var qe=nc(D),Je=void 0,Qe=Me[1],ot=Me[0],vt=X instanceof Uint8Array;be?(Qe=(d=qr(Me[0],Me[1]))[0],Je=new function(an,Jt,un){un===void 0&&(un=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var gn=te(),p=Jt[0],c=Jt[1];this.outputShape=an;var a="",l="result";un&&(l="floor(result * 255. + 0.5)");for(var g=0;g<=1;g++)for(var _=0;_<=1;_++){var j=2*g+_;a+=`
          localCoords = coords;
          if(localCoords[2] + `+_+" < "+an[2]+`) {
            localCoords[2] += `+_+`;
            if(localCoords[1] + `+g+" < "+an[1]+`) {
              localCoords[1] += `+g+`;

              flatIndex = getFlatIndex(localCoords);
              offset = imod(flatIndex, 4);

              flatIndex = idiv(flatIndex, 4, 1.);

              r = flatIndex / `+c+`;
              c = imod(flatIndex, `+c+`);
              uv = (vec2(c, r) + halfCR) / vec2(`+c+".0, "+p+`.0);
              values = `+gn.texture2D+`(A, uv);

              if(offset == 0) {
                result[`+j+`] = values[0];
              } else if(offset == 1) {
                result[`+j+`] = values[1];
              } else if(offset == 2) {
                result[`+j+`] = values[2];
              } else {
                result[`+j+`] = values[3];
              }
            }
          }
        `}this.userCode=`
      `+Ge(an)+`

      void main() {
        ivec3 coords = getOutputCoords();

        vec4 result = vec4(0.);
        int flatIndex, r, c, offset;
        ivec3 localCoords;
        vec2 uv;
        vec4 values;

        `+a+`

        `+gn.output+" = "+l+`;
      }
    `}(qe,[ot=d[1],Qe],vt)):Je=new function(an,Jt,un){un===void 0&&(un=!1),this.variableNames=["A"];var gn=te(),p=Jt[0],c=Jt[1];this.outputShape=an;var a="result";un&&(a="floor(result * 255. + 0.5)"),this.userCode=`
      `+Ge(an)+`

      void main() {
        ivec3 coords = getOutputCoords();

        int flatIndex = getFlatIndex(coords);
        int offset = imod(flatIndex, 4);

        flatIndex = idiv(flatIndex, 4, 1.);
        
        int r = flatIndex / `+c+`;
        int c = imod(flatIndex, `+c+`);
        vec2 uv = (vec2(c, r) + halfCR) / vec2(`+c+".0, "+p+`.0);
        vec4 values = `+gn.texture2D+`(A, uv);

        float result;

        if(offset == 0) {
          result = values[0];
        } else if(offset == 1) {
          result = values[1];
        } else if(offset == 2) {
          result = values[2];
        } else {
          result = values[3];
        }

        `+gn.output+" = vec4("+a+`, 0., 0., 0.);
      }
    `}(qe,[ot,Qe],vt);var bt=this.makeTensorInfo([ot,Qe],W);this.texData.get(bt.dataId).usage=vt?ir.PIXELS:ir.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(bt.dataId),Qe,ot,X);var wt=this.runWebGLProgram(Je,[bt],W,null,!0),Ft=this.texData.get(wt.dataId);y.texture=Ft.texture,y.texShape=Ft.texShape,y.isPacked=Ft.isPacked,y.usage=Ft.usage,this.disposeData(bt.dataId),this.texData.delete(wt.dataId),y.values=null,Re&&(this.uploadWaitMs+=nn()-Ie)}else{var Yt=this.acquireTexture(Me,de,W,be);y.texture=Yt}}},h.prototype.convertAndCacheOnCPU=function(u,d){var y=this.texData.get(u),D=y.dtype;return this.releaseGPUData(u),d!=null&&(y.values=function(W,X){if(X==="float32"||X==="complex64")return W;if(X==="int32"||X==="bool"){for(var ae=X==="int32"?new Int32Array(W.length):new Uint8Array(W.length),de=0;de<ae.length;++de)ae[de]=Math.round(W[de]);return ae}throw new Error("Unknown dtype "+X)}(d,D)),y.values},h.prototype.acquireTexture=function(u,d,y,D){if(this.numBytesInGPU+=this.computeBytes(u,y),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var W=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+W+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(u,d,D)},h.prototype.computeBytes=function(u,d){return u[0]*u[1]*Lt(d)},h}(Rf);jn()&&Ve.registerBackend("webgl",function(){return new Tv},2);var Dm=xt({square_:function(v){var h=Ke(v,"x","square"),u=[h];return Ve.runKernelFunc(function(d,y){return y([h]),d.square(h)},{x:h},null,"Square",{},u,[])}}),qh="SquaredDifference",zf=xt({squaredDifference_:function(v,h){var u,d=Ke(v,"a","squaredDifference"),y=Ke(h,"b","squaredDifference");u=An(d,y),d=u[0],y=u[1],Hi(d.shape,y.shape);var D={a:d,b:y},W=[d,y];return Ve.runKernelFunc(function(X,ae){var de=X.squaredDifference(d,y);return ae([d,y]),de},D,function(X,ae){var de=ae[0],be=ae[1],Ie=fr(2);return{a:function(){return X.mul(de.sub(be).mul(Ie))},b:function(){return X.mul(be.sub(de).mul(Ie))}}},qh,{},W,[])}}),Dc=xt({abs_:function(v){var h=Ke(v,"x","abs");return h.dtype==="complex64"?Ve.runKernelFunc(function(u){return u.complexAbs(h)},{$x:h}):Ve.runKernelFunc(function(u,d){var y=u.abs(h);return d([h]),y},{x:h},function(u,d){var y=d[0];return{x:function(){return u.mul(y.toFloat().step(-1))}}},"Abs")}}),Tm=xt({acos_:function(v){var h=Ke(v,"x","acos");return Ve.runKernelFunc(function(u,d){var y=u.acos(h);return d([h]),y},{$x:h},function(u,d){var y=d[0];return{$x:function(){return u.divStrict(fr(1).sub(y.toFloat().square()).sqrt()).neg()}}})}}),Nm=xt({acosh_:function(v){var h=Ke(v,"x","acosh");return Ve.runKernelFunc(function(u,d){var y=u.acosh(h);return d([h]),y},{$x:h},function(u,d){var y=d[0];return{$x:function(){return u.divStrict(y.toFloat().square().sub(1).sqrt())}}})}}),_u=xt({asin_:function(v){var h=Ke(v,"x","asin");return Ve.runKernelFunc(function(u,d){var y=u.asin(h);return d([h]),y},{$x:h},function(u,d){var y=d[0];return{$x:function(){return u.divStrict(fr(1).sub(y.toFloat().square()).sqrt())}}})}}),Im=xt({asinh_:function(v){var h=Ke(v,"x","asinh");return Ve.runKernelFunc(function(u,d){var y=u.asinh(h);return d([h]),y},{$x:h},function(u,d){var y=d[0];return{$x:function(){return u.divStrict(fr(1).add(y.toFloat().square()).sqrt())}}})}}),Hh=xt({atan_:function(v){var h=Ke(v,"x","atan");return Ve.runKernelFunc(function(u,d){var y=u.atan(h);return d([h]),y},{$x:h},function(u,d){var y=d[0];return{$x:function(){return u.div(y.toFloat().square().add(1))}}})}}),Qd=xt({atanh_:function(v){var h=Ke(v,"x","atanh");return Ve.runKernelFunc(function(u,d){var y=u.atanh(h);return d([h]),y},{$x:h},function(u,d){var y=d[0];return{$x:function(){return u.div(fr(1).sub(y.toFloat().square()))}}})}}),Nv=xt({ceil_:function(v){var h=Ke(v,"x","ceil");return Ve.runKernelFunc(function(u){return u.ceil(h)},{$x:h},function(u){return{$x:function(){return ii(u)}}})}}),Zd=xt({clipByValue_:function(v,h,u){var d=Ke(v,"x","clipByValue");we(h<=u,function(){return"Error in clip: min ("+h+") must be less than or equal to max ("+u+")."});var y=[d],D={min:h,max:u};return Ve.runKernelFunc(function(W,X){var ae=W.clip(d,h,u);return X([d]),ae},{x:d},function(W,X){var ae=X[0];return{x:function(){return W.where(ae.greaterEqual(h).logicalAnd(ae.lessEqual(u)),ii(W))}}},"ClipByValue",D,y)}}),Tc=xt({cos_:function(v){var h=Ke(v,"x","cos"),u=[h];return Ve.runKernelFunc(function(d,y){var D=d.cos(h);return y([h]),D},{x:h},function(d,y){var D=y[0];return{x:function(){return D.toFloat().sin().neg().mul(d)}}},"Cos",{},u)}}),ep=xt({cosh_:function(v){var h=Ke(v,"x","cosh");return Ve.runKernelFunc(function(u,d){var y=u.cosh(h);return d([h]),y},{$x:h},function(u,d){var y=d[0];return{$x:function(){return y.toFloat().sinh().mulStrict(u)}}})}}),Cg=xt({erf_:function(v){var h=Ke(v,"x","erf");return we(h.dtype==="int32"||h.dtype==="float32",function(){return"Input dtype must be `int32` or `float32`."}),h.dtype==="int32"&&(h=h.toFloat()),Ve.runKernelFunc(function(u,d){var y=u.erf(h);return d([h]),y},{$x:h},function(u,d){var y=d[0];return{$x:function(){return u.mul(y.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),Og=xt({exp_:function(v){var h=Ke(v,"x","exp");return Ve.runKernelFunc(function(u,d){var y=u.exp(h);return d([y]),y},{x:h},function(u,d){return{x:function(){return u.mulStrict(d[0])}}},"Exp",{},[],[!0])}}),Fm=xt({expm1_:function(v){var h=Ke(v,"x","expm1");return Ve.runKernelFunc(function(u,d){var y=u.expm1(h);return d([h]),y},{$x:h},function(u,d){var y=d[0];return{$x:function(){return u.mul(y.exp())}}})}}),b0=xt({floor_:function(v){var h=Ke(v,"x","floor");return Ve.runKernelFunc(function(u){return u.floor(h)},{$x:h},function(u){return{$x:function(){return ii(u)}}})}}),x0=xt({log_:function(v){var h=Ke(v,"x","log"),u=[h];return Ve.runKernelFunc(function(d,y){var D=d.log(h);return y([h]),D},{x:h},function(d,y){var D=y[0];return{x:function(){return d.div(D.toFloat())}}},"Log",{},u)}}),sa=xt({log1p_:function(v){var h=Ke(v,"x","log1p");return Ve.runKernelFunc(function(u,d){var y=u.log1p(h);return d([h]),y},{$x:h},function(u,d){var y=d[0];return{$x:function(){return u.div(y.add(1))}}})}}),Ag=xt({logSigmoid_:function(v){var h=Ke(v,"x","logSigmoid");return Ve.runKernelFunc(function(u,d){var y=u.softplus(h.neg()).neg();return d([h]),y},{$x:h},function(u,d){var y=d[0];return{$x:function(){return u.mul(y.neg().sigmoid())}}})}}),_g=xt({neg_:function(v){var h=Ke(v,"x","neg"),u=[h];return Ve.runKernelFunc(function(d){return d.neg(h)},{x:h},function(d){return{x:function(){return d.neg()}}},"Neg",{},u)}}),Bp=xt({reciprocal_:function(v){var h=Ke(v,"x","reciprocal");return Ve.runKernelFunc(function(u,d){var y=u.reciprocal(h);return d([h]),y},{$x:h},function(u,d){var y=d[0];return{$x:function(){return u.div(y.square().neg())}}})}}),Sg=xt({round_:function(v){var h=Ke(v,"x","round");return Ve.runKernelFunc(function(u){return u.round(h)},{$x:h},function(u){return{$x:function(){return ii(u)}}})}}),tp=xt({rsqrt_:function(v){var h=Ke(v,"x","rsqrt"),u=[h];return Ve.runKernelFunc(function(d,y){var D=d.rsqrt(h);return y([h]),D},{x:h},function(d,y){var D=y[0];return{x:function(){return d.div(D.pow(1.5).mul(2)).neg()}}},"Rsqrt",{},u)}}),nl=xt({sigmoid_:function(v){var h=Ke(v,"x","sigmoid");return Ve.runKernelFunc(function(u,d){var y=u.sigmoid(h);return d([y]),y},{x:h},function(u,d){var y=d[0];return{x:function(){return u.mul(y.mul(fr(1).sub(y)))}}},"Sigmoid")}}),rl=xt({sign_:function(v){var h=Ke(v,"x","sign");return Ve.runKernelFunc(function(u){return u.sign(h)},{$x:h},function(u){return{$x:function(){return ii(u)}}})}}),Dg=xt({isNaN_:function(v){var h=Ke(v,"x","isNaN");return Ve.runKernelFunc(function(u){return u.isNaN(h)},{$x:h},function(u){return{$x:function(){return ii(u)}}})}}),Tg=xt({isInf_:function(v){var h=Ke(v,"x","isInf");return Ve.runKernelFunc(function(u){return u.isInf(h)},{$x:h},function(u){return{$x:function(){return ii(u)}}})}}),$h=xt({isFinite_:function(v){var h=Ke(v,"x","isFinite");return Ve.runKernelFunc(function(u){return u.isFinite(h)},{$x:h},function(u){return{$x:function(){return ii(u)}}})}}),Uf=xt({sin_:function(v){var h=Ke(v,"x","sin"),u=[h];return Ve.runKernelFunc(function(d,y){var D=d.sin(h);return y([h]),D},{x:h},function(d,y){var D=y[0];return{x:function(){return D.toFloat().cos().mul(d)}}},"Sin",{},u)}}),Gh=xt({sinh_:function(v){var h=Ke(v,"x","sinh");return Ve.runKernelFunc(function(u,d){var y=u.sinh(h);return d([h]),y},{$x:h},function(u,d){var y=d[0];return{$x:function(){return y.toFloat().cosh().mulStrict(u)}}})}}),w0=xt({softplus_:function(v){var h=Ke(v,"x","softplus");return Ve.runKernelFunc(function(u,d){var y=u.softplus(h);return d([h]),y},{$x:h},function(u,d){var y=d[0];return{$x:function(){return u.mul(y.sigmoid())}}})}}),Pp=xt({sqrt_:function(v){var h=Ke(v,"x","sqrt");return Ve.runKernelFunc(function(u,d){var y=u.sqrt(h);return d([h]),y},{$x:h},function(u,d){var y=d[0];return{$x:function(){return u.div(y.toFloat().sqrt().mul(2))}}})}}),il=xt({step_:function(v,h){h===void 0&&(h=0);var u=Ke(v,"x","step");return Ve.runKernelFunc(function(d){return d.step(u,h)},{$x:u},function(d){return{$x:function(){return ii(d)}}})}}),Su=xt({tan_:function(v){var h=Ke(v,"x","tan");return Ve.runKernelFunc(function(u,d){var y=u.tan(h);return d([h]),y},{$x:h},function(u,d){var y=d[0];return{$x:function(){return u.div(y.cos().square())}}})}}),zl=xt({tanh_:function(v){var h=Ke(v,"x","tanh");return Ve.runKernelFunc(function(u,d){var y=u.tanh(h);return d([y]),y},{x:h},function(u,d){var y=d[0];return{x:function(){return fr(1).sub(y.square()).mulStrict(u)}}},"Tanh",{},null,[!0])}});function Ul(v,h,u,d,y,D){var W,X,ae=Ke(v,"x","batchNorm"),de=Ke(h,"mean","batchNorm"),be=Ke(u,"variance","batchNorm");return y!=null&&(W=Ke(y,"scale","batchNorm")),d!=null&&(X=Ke(d,"offset","batchNorm")),we(ae.rank===2,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+ae.rank+"."}),we(de.rank===2||de.rank===1,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+de.rank+"."}),we(be.rank===2||be.rank===1,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+be.rank+"."}),W!=null&&we(W.rank===2||W.rank===1,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+W.rank+"."}),X!=null&&we(X.rank===2||X.rank===1,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+X.rank+"."}),Lp(ae,de,be,X,W,D)}function Wl(v,h,u,d,y,D){var W,X,ae=Ke(v,"x","batchNorm"),de=Ke(h,"mean","batchNorm"),be=Ke(u,"variance","batchNorm");return y!=null&&(W=Ke(y,"scale","batchNorm")),d!=null&&(X=Ke(d,"offset","batchNorm")),we(ae.rank===3,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+ae.rank+"."}),we(de.rank===3||de.rank===1,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+de.rank+"."}),we(be.rank===3||be.rank===1,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+be.rank+"."}),W!=null&&we(W.rank===3||W.rank===1,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+W.rank+"."}),X!=null&&we(X.rank===3||X.rank===1,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+X.rank+"."}),Lp(ae,de,be,X,W,D)}function Ng(v,h,u,d,y,D){var W,X,ae=Ke(v,"x","batchNorm"),de=Ke(h,"mean","batchNorm"),be=Ke(u,"variance","batchNorm");return y!=null&&(W=Ke(y,"scale","batchNorm")),d!=null&&(X=Ke(d,"offset","batchNorm")),we(ae.rank===4,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+ae.rank+"."}),we(de.rank===4||de.rank===1,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+de.rank+"."}),we(be.rank===4||be.rank===1,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+be.rank+"."}),W!=null&&we(W.rank===4||W.rank===1,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+W.rank+"."}),X!=null&&we(X.rank===4||X.rank===1,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+X.rank+"."}),Lp(ae,de,be,X,W,D)}function Lp(v,h,u,d,y,D){D==null&&(D=.001);var W,X,ae,de=Ke(v,"x","batchNorm"),be=Ke(h,"mean","batchNorm"),Ie=Ke(u,"variance","batchNorm");y!=null&&(W=Ke(y,"scale","batchNorm")),d!=null&&(X=Ke(d,"offset","batchNorm")),we(be.rank===Ie.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),we(X==null||be.rank===X.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),we(W==null||be.rank===W.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),ae=de.rank===0||de.rank===1?de.as4D(1,1,1,de.size):de.rank===2?de.as4D(1,1,de.shape[0],de.shape[1]):de.rank===3?de.as4D(1,de.shape[0],de.shape[1],de.shape[2]):de;var Re=[de,be,Ie,W];return Ve.runKernelFunc(function(Me,qe){var Je=Me.batchNormalization(ae,Du(be),Du(Ie),D,Du(W),Du(X));return qe([de,be,Ie,W]),Je},{x:de,mean:be,variance:Ie,scale:W,offset:X},function(Me,qe){var Je=qe,Qe=Je[0],ot=Je[1],vt=Je[2],bt=Je[3],wt=bt??fr(1),Ft=bo(ot.shape,ae.shape),Yt=[];if(ot.rank===1){for(var an=0;an<ae.shape.length-1;++an)Yt.push(ae.shape[an]);Yt.push(1)}var Jt=Qe.sub(ot),un=Me.mul(wt),gn=tp(vt.add(fr(D))),p=gn.mul(gn).mul(gn).mul(fr(-.5));return{x:function(){return ot.rank===1?Me.mul(Es(gn.as4D(1,1,1,ot.shape[0]),Yt)).mul(wt).reshape(Qe.shape):Me.mul(gn).mul(wt).reshape(Qe.shape)},mean:function(){var c=gn.mul(fr(-1)).mul(un);return ot.rank===1&&(c=c.sum(Ft)),c.reshape(ot.shape)},variance:function(){var c=p.mul(Jt).mul(un);return ot.rank===1&&(c=c.sum(Ft)),c.reshape(ot.shape)},scale:function(){var c=Jt.mul(gn),a=Me.mul(c);return ot.rank===1&&(a=a.sum(Ft)),a.reshape(ot.shape)},offset:function(){var c=Me;return ot.rank===1&&(c=c.sum(Ft)),c.reshape(ot.shape)}}},"BatchNormalization",{varianceEpsilon:D},Re).reshape(de.shape)}function Du(v){return v==null?null:v.rank===0?v.as1D():v.rank===1?v:v.rank===2?v.as4D(1,1,v.shape[0],v.shape[1]):v.rank===3?v.as4D(1,v.shape[0],v.shape[1],v.shape[2]):v}function Hu(){Cf("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var Ig=xt({batchNormalization2d_:function(v,h,u,d,y,D){return d===void 0&&(d=.001),Hu(),Ul(v,h,u,D,y,d)}}),np=xt({batchNormalization3d_:function(v,h,u,d,y,D){return d===void 0&&(d=.001),Hu(),Wl(v,h,u,D,y,d)}}),Rm=xt({batchNormalization4d_:function(v,h,u,d,y,D){return d===void 0&&(d=.001),Hu(),Ng(v,h,u,D,y,d)}}),k0=xt({batchNormalization_:function(v,h,u,d,y,D){return d===void 0&&(d=.001),Hu(),Lp(v,h,u,D,y,d)}}),Iv=xt({batchNorm_:Lp}),Vl=xt({batchNorm2d_:Ul}),Kh=xt({batchNorm3d_:Wl}),Wf=xt({batchNorm4d_:Ng}),Vf=xt({logicalAnd_:function(v,h){var u=Ke(v,"a","logicalAnd","bool"),d=Ke(h,"b","logicalAnd","bool");return Hi(u.shape,d.shape),Ve.runKernelFunc(function(y){return y.logicalAnd(u,d)},{a:u,b:d},null,"LogicalAnd")}}),Fg=xt({logicalNot_:function(v){var h=Ke(v,"x","logicalNot","bool");return Ve.runKernelFunc(function(u){return u.logicalNot(h)},{$x:h})}}),Mm=xt({logicalOr_:function(v,h){var u=Ke(v,"a","logicalOr","bool"),d=Ke(h,"b","logicalOr","bool");return Hi(u.shape,d.shape),Ve.runKernelFunc(function(y){return y.logicalOr(u,d)},{$a:u,$b:d})}}),qf=xt({logicalXor_:function(v,h){var u=Ke(v,"a","logicalXor","bool"),d=Ke(h,"b","logicalXor","bool");return Hi(u.shape,d.shape),Mm(v,h).logicalAnd(Vf(v,h).logicalNot())}}),ta=xt({where_:function(v,h,u){var d=Ke(h,"a","where"),y=Ke(u,"b","where"),D=Ke(v,"condition","where","bool");return Tt(d.shape,y.shape,"Error in where: "),D.rank===1?we(D.shape[0]===d.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):Tt(D.shape,y.shape,"Error in where: "),Ve.runKernelFunc(function(W,X){var ae=W.select(D,d,y);return X([D]),ae},{$condition:D,$a:d,$b:y},function(W,X){var ae=X[0];return{$condition:function(){return ii(ae).toFloat()},$a:function(){return W.mul(ae.cast(W.dtype))},$b:function(){return W.mul(ae.logicalNot().cast(W.dtype))}}})}}),ql=function(v){return R(this,void 0,void 0,function(){var h,u,d;return P(this,function(y){switch(y.label){case 0:return[4,(h=Ke(v,"condition","whereAsync","bool")).data()];case 1:return u=y.sent(),d=G(h.shape,u),v!==h&&h.dispose(),[2,d]}})})},Xh=xt({add_:function(v,h){var u,d=Ke(v,"a","add"),y=Ke(h,"b","add");u=An(d,y),d=u[0],y=u[1];var D=Hi(d.shape,y.shape);return Ve.runKernelFunc(function(W){return W.add(d,y)},{a:d,b:y},function(W){return{a:function(){var X=W,ae=bo(d.shape,D);return ae.length>0&&(X=X.sum(ae)),X.reshape(d.shape)},b:function(){var X=W,ae=bo(y.shape,D);return ae.length>0&&(X=X.sum(ae)),X.reshape(y.shape)}}},"Add")}}),Fv=xt({addN_:function(v){we(Array.isArray(v),function(){return"The argument passed to tf.addN() must be a list of tensors"}),we(v.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+v.length});var h=v.map(function(y,D){return Ke(y,"tensors"+D,"addN")}),u=h[0];h.forEach(function(y){if(y.dtype!==u.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),h.forEach(function(y){if(!ln(y.shape,u.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var d=h;return Ve.runKernelFunc(function(y){return y.addN(h)},d,function(y){var D={};return h.forEach(function(W,X){D[X]=function(){return y.clone()}}),D},"AddN")}}),Rv=xt({addStrict_:function(v,h){var u=Ke(v,"a","addStrict"),d=Ke(h,"b","addStrict");return Tt(u.shape,d.shape,"Error in addStrict: "),u.add(d)}}),zp=xt({atan2_:function(v,h){var u,d=Ke(v,"a","atan2"),y=Ke(h,"b","atan2");u=An(d,y),d=u[0],y=u[1];var D=Hi(d.shape,y.shape);return Ve.runKernelFunc(function(W,X){var ae=W.atan2(d,y);return X([d,y]),ae},{$a:d,$b:y},function(W,X){var ae=X[0],de=X[1];return{$a:function(){var be=Xh(ae.square(),de.square()),Ie=W.mul(de.div(be)),Re=bo(ae.shape,D);return Re.length>0&&(Ie=Ie.sum(Re)),Ie.reshape(ae.shape)},$b:function(){var be=Xh(ae.square(),de.square()),Ie=_g(W.mul(ae.div(be))),Re=bo(de.shape,D);return Re.length>0&&(Ie=Ie.sum(Re)),Ie.reshape(de.shape)}}})}}),Hl=xt({div_:function(v,h){var u,d=Ke(v,"a","div"),y=Ke(h,"b","div");if(u=An(d,y),d=u[0],y=u[1],d.dtype==="int32"&&y.dtype==="int32")return Yh(d,y);var D=Hi(d.shape,y.shape);return Ve.runKernelFunc(function(W,X){var ae=W.realDivide(d,y);return X([d,y]),ae},{a:d,b:y},function(W,X){var ae=X[0],de=X[1];return{a:function(){var be=W.div(de.toFloat()),Ie=bo(ae.shape,D);return Ie.length>0?be.sum(Ie).reshape(ae.shape):be},b:function(){var be=W.mul(ae.toFloat()),Ie=bo(de.shape,D);Ie.length>0&&(be=be.sum(Ie).reshape(de.shape));var Re=de.square();return be.div(Re.toFloat()).neg()}}},"Div")}}),al=xt({divNoNan_:function(v,h){var u,d=Ke(v,"a","div"),y=Ke(h,"b","div");d=(u=An(d,y))[0],y=u[1];var D=Hl(d,y),W=ii(D),X=y.equal(W);return ta(X,W,D)}}),rp=xt({divStrict_:function(v,h){var u=Ke(v,"a","div"),d=Ke(h,"b","div");return Tt(u.shape,d.shape,"Error in divideStrict: "),u.div(d)}}),Yh=xt({floorDiv_:function(v,h){var u,d=Ke(v,"a","floorDiv"),y=Ke(h,"b","floorDiv");u=An(d,y),d=u[0],y=u[1];var D=Hi(d.shape,y.shape);return Ve.runKernelFunc(function(W,X){var ae=W.floorDiv(d,y);return X([d,y]),ae},{a:d,b:y},function(W,X){var ae=X[0],de=X[1];return{a:function(){var be=W.div(de.toFloat()),Ie=bo(ae.shape,D);return Ie.length>0?be.sum(Ie).reshape(ae.shape):be},b:function(){var be=W.mul(ae.toFloat()),Ie=bo(de.shape,D);Ie.length>0&&(be=be.sum(Ie).reshape(de.shape));var Re=de.square();return be.div(Re.toFloat()).neg()}}},"FloorDiv")}}),Hf=xt({maximum_:function(v,h){var u,d=Ke(v,"a","maximum"),y=Ke(h,"b","maximum");return u=An(d,y),d=u[0],y=u[1],d.dtype==="bool"&&(d=d.toInt(),y=y.toInt()),Hi(d.shape,y.shape),Ve.runKernelFunc(function(D,W){var X=D.maximum(d,y);return W([d,y]),X},{a:d,b:y},function(D,W){var X=W[0],ae=W[1];return{a:function(){return D.mul(X.greaterEqual(ae).toFloat())},b:function(){return D.mul(X.less(ae).toFloat())}}},"Maximum")}}),$l=xt({maximumStrict_:function(v,h){var u=Ke(v,"a","maximumStrict"),d=Ke(h,"b","maximumStrict");return Tt(u.shape,d.shape,"Error in maximumStrict: "),u.maximum(d)}}),Gl=xt({minimum_:function(v,h){var u,d=Ke(v,"a","minimum"),y=Ke(h,"b","minimum");return u=An(d,y),d=u[0],y=u[1],d.dtype==="bool"&&(d=d.toInt(),y=y.toInt()),Hi(d.shape,y.shape),Ve.runKernelFunc(function(D,W){var X=D.minimum(d,y);return W([d,y]),X},{a:d,b:y},function(D,W){var X=W[0],ae=W[1];return{a:function(){return D.mul(X.lessEqual(ae).toFloat())},b:function(){return D.mul(X.greater(ae).toFloat())}}},"Minimum")}}),Tu=xt({minimumStrict_:function(v,h){var u=Ke(v,"a","minimumStrict"),d=Ke(h,"b","minimumStrict");return Tt(u.shape,d.shape,"Error in minimumStrict: "),u.minimum(d)}}),Jh=xt({mod_:function(v,h){var u,d=Ke(v,"a","mod"),y=Ke(h,"b","mod");u=An(d,y),d=u[0],y=u[1];var D=Hi(d.shape,y.shape);return Ve.runKernelFunc(function(W,X){var ae=W.mod(d,y);return X([d,y]),ae},{$a:d,$b:y},function(W,X){var ae=X[0],de=X[1];return{$a:function(){var be=bo(ae.shape,D);return be.length>0?W.sum(be).reshape(ae.shape):W},$b:function(){var be=W.mul(ae.div(de).floor().neg()),Ie=bo(de.shape,D);return Ie.length>0?be.sum(Ie).reshape(de.shape):be}}})}}),$f=xt({modStrict_:function(v,h){var u=Ke(v,"a","modStrict"),d=Ke(h,"b","modStrict");return Tt(u.shape,d.shape,"Error in modStrict: "),u.mod(d)}}),ol=xt({mul_:function(v,h){var u,d=Ke(v,"a","mul"),y=Ke(h,"b","mul");u=An(d,y),d=u[0],y=u[1];var D=Hi(d.shape,y.shape);return Ve.runKernelFunc(function(W,X){var ae=W.multiply(d,y);return X([d,y]),ae},{a:d,b:y},function(W,X){var ae=X[0],de=X[1];return{a:function(){var be=W.mul(de.toFloat()),Ie=bo(ae.shape,D);return Ie.length>0?be.sum(Ie).reshape(ae.shape):be},b:function(){var be=W.mul(ae.toFloat()),Ie=bo(de.shape,D);return Ie.length>0?be.sum(Ie).reshape(de.shape):be}}},"Mul")}}),Nc=xt({mulStrict_:function(v,h){var u=Ke(v,"a","mul"),d=Ke(h,"b","mul");return Tt(u.shape,d.shape,"Error in multiplyStrict: "),u.mul(d)}}),Gf=xt({pow_:function(v,h){var u,d=Ke(v,"base","pow"),y=Ke(h,"exp","pow");u=An(d,y),d=u[0],y=u[1];var D=Hi(d.shape,y.shape),W=[d,y];return Ve.runKernelFunc(function(X,ae){var de=X.pow(d,y);return ae([d,y,de]),de},{a:d,b:y},function(X,ae){var de=ae[0],be=ae[1],Ie=ae[2];return{a:function(){var Re=be.toFloat(),Me=X.mul(Re.mul(de.pow(Re.sub(fr(1))))),qe=bo(de.shape,D);return qe.length>0&&(Me=Me.sum(qe)),Me.reshape(de.shape)},b:function(){var Re=de.greater(0),Me=de.log().where(Re,ii(de)),qe=X.mul(Ie.mul(Me)),Je=bo(be.shape,D);return Je.length>0&&(qe=qe.sum(Je)),qe.reshape(be.shape)}}},"Pow",{},W,[!0])}}),Up=xt({powStrict_:function(v,h){return Tt(v.shape,h.shape,"Error in powStrict: "),v.pow(h)}}),Kf=xt({squaredDifferenceStrict_:function(v,h){var u=Ke(v,"a","squaredDifferenceStrict"),d=Ke(h,"b","squaredDifferenceStrict");return Tt(u.shape,d.shape,"Error in squaredDifferenceStrict: "),u.squaredDifference(d)}}),Ic=xt({sub_:function(v,h){var u,d=Ke(v,"a","sub"),y=Ke(h,"b","sub");u=An(d,y),d=u[0],y=u[1];var D=Hi(d.shape,y.shape);return Ve.runKernelFunc(function(W){return W.subtract(d,y)},{a:d,b:y},function(W){return{a:function(){var X=W,ae=bo(d.shape,D);return ae.length>0&&(X=X.sum(ae)),X.reshape(d.shape)},b:function(){var X=W,ae=bo(y.shape,D);return ae.length>0&&(X=X.sum(ae)),X.neg().reshape(y.shape)}}},"Sub")}}),ts=xt({subStrict_:function(v,h){var u=Ke(v,"a","subStrict"),d=Ke(h,"b","subStrict");return Tt(u.shape,d.shape,"Error in subStrict: "),u.sub(d)}}),fc=xt({equal_:function(v,h){var u,d=Ke(v,"a","equal"),y=Ke(h,"b","equal");return u=An(d,y),d=u[0],y=u[1],Hi(d.shape,y.shape),Ve.runKernelFunc(function(D){return D.equal(d,y)},{$a:d,$b:y})}}),Nu=xt({equalStrict_:function(v,h){var u=Ke(v,"a","equalStrict"),d=Ke(h,"b","equalStrict");return Tt(u.shape,d.shape,"Error in equalStrict: "),u.equal(d)}}),hu=xt({greater_:function(v,h){var u,d=Ke(v,"a","greater"),y=Ke(h,"b","greater");return u=An(d,y),d=u[0],y=u[1],Hi(d.shape,y.shape),Ve.runKernelFunc(function(D){return D.greater(d,y)},{a:d,b:y},null,"Greater")}}),Qh=xt({greaterEqual_:function(v,h){var u,d=Ke(v,"a","greaterEqual"),y=Ke(h,"b","greaterEqual");return u=An(d,y),d=u[0],y=u[1],Hi(d.shape,y.shape),Ve.runKernelFunc(function(D,W){var X=D.greaterEqual(d,y);return W([d,y]),X},{a:d,b:y},function(D,W){var X=W[0],ae=W[1];return{a:function(){return ii(X)},b:function(){return ii(ae)}}},"GreaterEqual")}}),Wp=xt({greaterEqualStrict_:function(v,h){var u=Ke(v,"a","greaterEqualStrict"),d=Ke(h,"b","greaterEqualStrict");return Tt(u.shape,d.shape,"Error in greaterEqualStrict: "),u.greaterEqual(d)}}),jm=xt({greaterStrict_:function(v,h){var u=Ke(v,"a","greaterStrict"),d=Ke(h,"b","greaterStrict");return Tt(u.shape,d.shape,"Error in greaterStrict: "),u.greater(d)}}),Bm=xt({less_:function(v,h){var u,d=Ke(v,"a","less"),y=Ke(h,"b","less");return u=An(d,y),d=u[0],y=u[1],Hi(d.shape,y.shape),Ve.runKernelFunc(function(D){return D.less(d,y)},{a:d,b:y},null,"Less")}}),ip=xt({lessEqual_:function(v,h){var u,d=Ke(v,"a","lessEqual"),y=Ke(h,"b","lessEqual");return u=An(d,y),d=u[0],y=u[1],Hi(d.shape,y.shape),Ve.runKernelFunc(function(D,W){var X=D.lessEqual(d,y);return W([d,y]),X},{a:d,b:y},null,"LessEqual")}}),Fa=xt({lessEqualStrict_:function(v,h){var u=Ke(v,"a","lessEqualStrict"),d=Ke(h,"b","lessEqualStrict");return Tt(u.shape,d.shape,"Error in lessEqualStrict: "),u.lessEqual(d)}}),ap=xt({lessStrict_:function(v,h){var u=Ke(v,"a","lessStrict"),d=Ke(h,"b","lessStrict");return Tt(u.shape,d.shape,"Error in lessStrict: "),u.less(d)}}),hc=xt({notEqual_:function(v,h){var u,d=Ke(v,"a","notEqual"),y=Ke(h,"b","notEqual");return u=An(d,y),d=u[0],y=u[1],Hi(d.shape,y.shape),Ve.runKernelFunc(function(D){return D.notEqual(d,y)},{a:d,b:y},null,"NotEqual")}}),Xf=xt({notEqualStrict_:function(v,h){var u=Ke(v,"a","notEqualStrict"),d=Ke(h,"b","notEqualStrict");return Tt(u.shape,d.shape,"Error in notEqualStrict: "),u.notEqual(d)}});function Yf(v,h){for(var u=[],d=v;d<h;++d)u.push(d);return u}function op(v){for(var h=[],u=0;u<v.length;++u)for(var d=0;d<v[u].length;++d)h.push(v[u][d]);return h}var Vp=xt({gather_:function(v,h,u){u===void 0&&(u=0);var d=Ke(v,"x","gather"),y=Ke(h,"indices","gather","int32");u=xn(u,d.shape)[0];var D=function(W,X,ae){for(var de=W.shape[ae],be=[],Ie=1,Re=1,Me=0;Me<ae;Me++)be.push(W.shape[Me]),Ie*=W.shape[Me];for(Me=0;Me<X.rank;Me++)be.push(X.shape[Me]);for(Me=ae+1;Me<W.rank;Me++)be.push(W.shape[Me]),Re*=W.shape[Me];return{batchSize:Ie,sliceSize:Re,dimSize:de,outputShape:be}}(d,y,u);return Ve.runKernelFunc(function(W,X){var ae=W.gather(d,y.flatten(),u);return X([y]),ae},{x:d,indices:y},function(W,X){var ae=X[0];return{x:function(){var de=d.shape,be=ae.size,Ie=de.slice(0,u),Re=Ie.length,Me=de.slice(u,de.length).slice(1),qe=Me.length,Je=Yf(0,Re),Qe=Yf(Re+1,Re+1+qe),ot=op([Ie,[be],Me]),vt=W.reshape(ot),bt=ae.reshape([be]),wt=op([[Re],Je,Qe]),Ft=vt.transpose(wt),Yt=qp(Ft,bt,d.shape[u]),an=wu(wt);return Yt.transpose(an)},indices:function(){return ae}}},"Gather",{axis:u}).reshape(D.outputShape)}}),qp=xt({unsortedSegmentSum_:function(v,h,u){var d=Ke(v,"x","unsortedSegmentSum"),y=Ke(h,"segmentIds","unsortedSegmentSum","int32");return we(Zt(u),function(){return"numSegments must be of dtype int"}),Ve.runKernelFunc(function(D,W){var X=D.unsortedSegmentSum(d,y,u);return W([y]),X},{$x:d},function(D,W){var X=W[0];return{$x:function(){return function(ae,de){for(var be=Hf(de,ii(de)),Ie=Vp(ae,be),Re=Qh(de,fr(0,"int32")),Me=Ie.rank-Re.rank,qe=0;qe<Me;++qe)Re=Pa(Re,qe+1);Re=Vf(Re,uu(Ie.shape,"bool"));var Je=ii(Ie);return ta(Re,Ie,Je)}(D,X)}}})}}),Hp=function(v,h,u){return R(this,void 0,void 0,function(){var d,y,D,W,X,ae,de,be,Ie,Re,Me,qe,Je;return P(this,function(Qe){switch(Qe.label){case 0:for(d=Ke(v,"tensor","boolMask"),y=Ke(h,"mask","boolMask","bool"),D=u??0,W=y.rank,X=d.shape,we(W>0,function(){return"mask cannot be scalar"}),Tt(X.slice(D,D+W),y.shape,"mask's shape must match the first K dimensions of tensor's shape,"),ae=1,de=D;de<D+W;de++)ae*=X[de];return be=X.slice(0,D).concat([ae],X.slice(D+W)),Ie=d.reshape(be),Re=y.reshape([-1]),[4,ql(Re)];case 1:return Me=Qe.sent(),qe=Me.squeeze([1]),Je=Vp(Ie,qe,D),v!==d&&d.dispose(),h!==y&&y.dispose(),qe.dispose(),Ie.dispose(),Re.dispose(),Me.dispose(),[2,Je]}})})};function Rg(v,h,u,d,y,D,W){D===void 0&&(D="NHWC"),we(v.length===h.rank,function(){return"Length of inShape ("+v.length+") and rank of dy ("+h.rank+") must match"});var X=v,ae=h,de=!1;h.rank===3&&(de=!0,ae=h.as4D(1,h.shape[0],h.shape[1],h.shape[2]),X=[1,v[0],v[1],v[2]]),we(X.length===4,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+X.length+"."}),we(ae.rank===4,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+ae.rank}),we(u.rank===4,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+u.rank});var be=D==="NHWC"?X[3]:X[1],Ie=D==="NHWC"?ae.shape[3]:ae.shape[1];we(be===u.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+be+") must match input depth for filter "+u.shape[2]+"."}),we(Ie===u.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+Ie+") must match output depth for filter "+u.shape[3]+"."}),W!=null&&we(Zt(y),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+W+" but got pad "+y+"."});var Re=Xa(D),Me=Vs(X,u.shape,d,1,y,W,!1,Re),qe=Ve.runKernelFunc(function(Je,Qe){var ot=Je.conv2dDerInput(ae,u,Me);return Qe([u,ae]),ot},{dy4D:ae,filter:u},function(Je,Qe){var ot=Qe[0],vt=Qe[1];return{dy4D:function(){return Zh(Je,ot,d,y,D,1,W)},filter:function(){return Pm(Je,vt,ot.shape,d,y,D,W)}}});return de?qe.as3D(qe.shape[1],qe.shape[2],qe.shape[3]):qe}function $p(v){var h=function(D){return typeof D=="number"?[D,D,D]:D.length===2?[D[0],D[1],1]:D}(v),u=h[0],d=h[1],y=h[2];return u===1&&d===1&&y===1}function Kl(v,h,u,d,y){we(v.length===h.rank,function(){return"Length of inShape ("+v.length+") and rank of dy ("+h.rank+") must match"});var D=v,W=h,X=!1;h.rank===4&&(X=!0,W=h.as5D(1,h.shape[0],h.shape[1],h.shape[2],h.shape[3]),D=[1,v[0],v[1],v[2],v[3]]);var ae=D[4],de=W.shape[4];we(D.length===5,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+D.length+"."}),we(W.rank===5,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+W.rank}),we(u.rank===5,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+u.rank}),we(ae===u.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+ae+") must match input depth for filter "+u.shape[3]+"."}),we(de===u.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+de+") must match output depth for filter "+u.shape[4]+"."});var be=sc(D,u.shape,d,1,y),Ie=Ve.runKernelFunc(function(Re){return Re.conv3dDerInput(W,u,be)},{dy5D:W});return X?Ie.as4D(Ie.shape[1],Ie.shape[2],Ie.shape[3],Ie.shape[4]):Ie}var Gp=xt({conv1d_:function(v,h,u,d,y,D,W){y===void 0&&(y="NWC"),D===void 0&&(D=1);var X=Ke(v,"x","conv1d"),ae=Ke(h,"filter","conv1d"),de=X,be=!1;X.rank===2&&(be=!0,de=X.as3D(1,X.shape[0],X.shape[1])),we(de.rank===3,function(){return"Error in conv1d: input must be rank 3, but got rank "+de.rank+"."}),we(ae.rank===3,function(){return"Error in conv1d: filter must be rank 3, but got rank "+ae.rank+"."}),W!=null&&we(Zt(d),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+W+" but got pad "+d+"."}),we(de.shape[2]===ae.shape[1],function(){return"Error in conv1d: depth of input ("+de.shape[2]+") must match input depth for filter "+ae.shape[1]+"."}),we(ls(u,D),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+u+" and dilation '"+D+"'"}),we(y==="NWC",function(){return"Error in conv1d: got dataFormat of "+y+" but only NWC is currently supported."});var Ie=ae.as4D(1,ae.shape[0],ae.shape[1],ae.shape[2]),Re=de.as4D(de.shape[0],1,de.shape[1],de.shape[2]),Me=Zh(Re,Ie,[1,u],d,"NHWC",[1,D],W);return be?Me.as2D(Me.shape[2],Me.shape[3]):Me.as3D(Me.shape[0],Me.shape[2],Me.shape[3])}}),Zh=xt({conv2d_:function(v,h,u,d,y,D,W){y===void 0&&(y="NHWC"),D===void 0&&(D=[1,1]);var X=Ke(v,"x","conv2d"),ae=Ke(h,"filter","conv2d"),de=X,be=!1;X.rank===3&&(be=!0,de=X.as4D(1,X.shape[0],X.shape[1],X.shape[2])),we(de.rank===4,function(){return"Error in conv2d: input must be rank 4, but got rank "+de.rank+"."}),we(ae.rank===4,function(){return"Error in conv2d: filter must be rank 4, but got rank "+ae.rank+"."}),W!=null&&we(Zt(d),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+W+" but got pad "+d+"."});var Ie=y==="NHWC"?de.shape[3]:de.shape[1];we(Ie===ae.shape[2],function(){return"Error in conv2d: depth of input ("+Ie+") must match input depth for filter "+ae.shape[2]+"."}),we(ls(u,D),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+u+" and dilations '"+D+"'"});var Re=Xa(y),Me=Vs(de.shape,ae.shape,u,D,d,W,!1,Re),qe=[ae,de],Je=Ve.runKernelFunc(function(Qe,ot){var vt=Qe.conv2d(de,ae,Me);return ot([ae,de]),vt},{x:de,filter:ae},function(Qe,ot){var vt=ot,bt=vt[0],wt=vt[1];return we(_o(D),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+D+"'"}),{x:function(){return Lm(wt.shape,Qe,bt,u,d,y)},filter:function(){return Pm(wt,Qe,bt.shape,u,d,y)}}},"Conv2D",Me,qe);return be?Je.as3D(Je.shape[1],Je.shape[2],Je.shape[3]):Je}}),Kp=xt({conv3d_:function(v,h,u,d,y,D){y===void 0&&(y="NDHWC"),D===void 0&&(D=[1,1,1]);var W=Ke(v,"x","conv3d"),X=Ke(h,"filter","conv3d"),ae=W,de=!1;W.rank===4&&(de=!0,ae=W.as5D(1,W.shape[0],W.shape[1],W.shape[2],W.shape[3])),we(ae.rank===5,function(){return"Error in conv3d: input must be rank 5, but got rank "+ae.rank+"."}),we(X.rank===5,function(){return"Error in conv3d: filter must be rank 5, but got rank "+X.rank+"."}),we(ae.shape[4]===X.shape[3],function(){return"Error in conv3d: depth of input ("+ae.shape[4]+") must match input depth for filter "+X.shape[3]+"."}),we(function(Re,Me){return $p(u)||$p(Me)}(0,D),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+u+" and dilations '"+D+"'"}),we(y==="NDHWC",function(){return"Error in conv3d: got dataFormat of "+y+" but only NDHWC is currently supported."});var be=sc(ae.shape,X.shape,u,D,d),Ie=Ve.runKernelFunc(function(Re,Me){var qe=Re.conv3d(ae,X,be);return Me([ae,X]),qe},{x:ae,$filter:X},function(Re,Me){we($p(D),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+D+"'"});var qe=Me[0],Je=Me[1];return{x:function(){return Kl(qe.shape,Re,Je,u,d)},$filter:function(){return function(Qe,ot,vt,bt,wt){var Ft=Qe;Qe.rank===4&&(Ft=Qe.as5D(1,Qe.shape[0],Qe.shape[1],Qe.shape[2],Qe.shape[3]));var Yt=ot;Yt.rank===4&&(Yt=ot.as5D(1,ot.shape[0],ot.shape[1],ot.shape[2],ot.shape[3])),we(Ft.rank===5,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+Ft.shape+"."}),we(Yt.rank===5,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+Yt.shape+"."}),we(vt.length===5,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+vt+"."}),we(Ft.shape[4]===vt[3],function(){return"Error in conv3dDerFilter: depth of input "+Ft.shape[4]+") must match input depth in filter ("+vt[3]+"."}),we(Yt.shape[4]===vt[4],function(){return"Error in conv3dDerFilter: depth of dy ("+Yt.shape[4]+") must match output depth for filter ("+vt[4]+")."});var an=sc(Ft.shape,vt,bt,1,wt);return Ve.runKernelFunc(function(Jt){return Jt.conv3dDerFilter(Ft,Yt,an)},{x5D:Ft,dy5D:Yt})}(qe,Re,Je.shape,u,d)}}});return de?Ie.as4D(Ie.shape[1],Ie.shape[2],Ie.shape[3],Ie.shape[4]):Ie}}),Pm=xt({conv2dDerFilter_:function(v,h,u,d,y,D,W){D===void 0&&(D="NHWC");var X=v;v.rank===3&&(X=v.as4D(1,v.shape[0],v.shape[1],v.shape[2]));var ae=h;ae.rank===3&&(ae=h.as4D(1,h.shape[0],h.shape[1],h.shape[2])),we(X.rank===4,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+X.shape+"."}),we(ae.rank===4,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+ae.shape+"."}),we(u.length===4,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+u+"."});var de=D==="NHWC"?X.shape[3]:X.shape[1],be=D==="NHWC"?ae.shape[3]:ae.shape[1];we(de===u[2],function(){return"Error in conv2dDerFilter: depth of input "+de+") must match input depth in filter ("+u[2]+"."}),we(be===u[3],function(){return"Error in conv2dDerFilter: depth of dy ("+be+") must match output depth for filter ("+u[3]+")."}),W!=null&&we(Zt(y),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+W+" but got pad "+y+"."});var Ie=Xa(D),Re=Vs(X.shape,u,d,1,y,W,!1,Ie);return Ve.runKernelFunc(function(Me){return Me.conv2dDerFilter(X,ae,Re)},{x4D:X,dy4D:ae})}}),Lm=xt({conv2dDerInput_:Rg}),sp=xt({depthwiseConv2d_:function(v,h,u,d,y,D,W){D===void 0&&(D=[1,1]);var X=Ke(v,"x","depthwiseConv2d"),ae=Ke(h,"filter","depthwiseConv2d"),de=X,be=!1;X.rank===3&&(be=!0,de=X.as4D(1,X.shape[0],X.shape[1],X.shape[2])),we(de.rank===4,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+de.rank+"."}),we(ae.rank===4,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+ae.rank+"."}),we(de.shape[3]===ae.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+de.shape[3]+") must match the inChannels dimension in filter "+ae.shape[2]+"."}),D==null&&(D=[1,1]),we(ls(u,D),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+u+" and dilations '"+D+"'"}),W!=null&&we(Zt(d),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+W+" but got pad "+d+"."});var Ie=Vs(de.shape,ae.shape,u,D,d,W,!0),Re=[de,ae],Me=Ve.runKernelFunc(function(qe,Je){var Qe=qe.depthwiseConv2D(de,ae,Ie);return Je([de,ae]),Qe},{x:de,filter:ae},function(qe,Je){we(_o(D),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+D+"'"});var Qe=Je[0],ot=Je[1];return{x:function(){return zm(Qe.shape,qe,ot,Ie)},filter:function(){return Xp(Qe,qe,ot.shape,Ie)}}},"DepthwiseConv2dNative",Ie,Re);return be?Me.as3D(Me.shape[1],Me.shape[2],Me.shape[3]):Me}}),zm=xt({depthwiseConv2dDerInput_:function(v,h,u,d){var y=h,D=!1;h.rank===3&&(D=!0,y=h.as4D(1,h.shape[0],h.shape[1],h.shape[2]));var W=Ve.runKernelFunc(function(X){return X.depthwiseConv2DDerInput(y,u,d)},{dy4D:y});return D?W.as3D(W.shape[1],W.shape[2],W.shape[3]):W}}),Xp=xt({depthwiseConv2dDerFilter_:function(v,h,u,d){var y=v;v.rank===3&&(y=v.as4D(1,v.shape[0],v.shape[1],v.shape[2]));var D=h;return D.rank===3&&(D=h.as4D(1,h.shape[0],h.shape[1],h.shape[2])),Ve.runKernelFunc(function(W){return W.depthwiseConv2DDerFilter(y,D,d)},{x4D:y,dy4D:D})}}),Mg=xt({separableConv2d_:function(v,h,u,d,y,D,W){D===void 0&&(D=[1,1]),W===void 0&&(W="NHWC");var X=Ke(v,"x","separableConv2d"),ae=Ke(h,"depthwiseFilter","separableConv2d"),de=Ke(u,"pointwiseFilter","separableConv2d"),be=X,Ie=!1;if(X.rank===3&&(Ie=!0,be=X.as4D(1,X.shape[0],X.shape[1],X.shape[2])),W==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");we(be.rank===4,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+be.rank+"."}),we(ae.rank===4,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+ae.rank+"."}),we(de.rank===4,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+ae.rank+"."}),we(de.shape[0]===1,function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+de.shape[0]+"."}),we(de.shape[1]===1,function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+de.shape[1]+"."});var Re=ae.shape[2],Me=ae.shape[3];we(de.shape[2]===Re*Me,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+Re*Me+", but got "+de.shape[2]+"."});var qe=sp(be,ae,d,y,W,D),Je=Zh(qe,de,1,"valid",W);return Ie?Je.as3D(Je.shape[1],Je.shape[2],Je.shape[3]):Je}}),sl=xt({conv2dTranspose_:function(v,h,u,d,y,D){return Rg(u,Ke(v,"x","conv2dTranspose"),Ke(h,"filter","conv2dTranspose"),d,y,"NHWC",D)}}),Mv=xt({conv3dTranspose_:function(v,h,u,d,y){return Kl(u,Ke(v,"x","conv3dTranspose"),Ke(h,"filter","conv3dTranspose"),d,y)}}),jg=xt({matMul_:function(v,h,u,d){var y;u===void 0&&(u=!1),d===void 0&&(d=!1);var D=Ke(v,"a","matMul"),W=Ke(h,"b","matMul");y=An(D,W),D=y[0],W=y[1];var X=u?D.shape[D.rank-2]:D.shape[D.rank-1],ae=d?W.shape[W.rank-1]:W.shape[W.rank-2],de=u?D.shape[D.rank-1]:D.shape[D.rank-2],be=d?W.shape[W.rank-2]:W.shape[W.rank-1],Ie=D.shape.slice(0,-2),Re=W.shape.slice(0,-2),Me=Ye(Ie),qe=Ye(Re);we(D.rank>=2&&W.rank>=2&&D.rank===W.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+D.rank+" and "+W.rank+"."}),we(ln(Ie,Re),function(){return"Error in matMul: outer dimensions ("+Ie+") and ("+Re+") of Tensors with shapes "+D.shape+" and "+W.shape+" must match."}),we(X===ae,function(){return"Error in matMul: inner shapes ("+X+") and ("+ae+") of Tensors with shapes "+D.shape+" and "+W.shape+" and transposeA="+u+" and transposeB="+d+" must match."});var Je=D.shape.slice(0,-2).concat([de,be]),Qe=u?D.as3D(Me,X,de):D.as3D(Me,de,X),ot=d?W.as3D(qe,be,ae):W.as3D(qe,ae,be),vt={transposeA:u,transposeB:d};return Ve.runKernelFunc(function(bt,wt){var Ft=bt.batchMatMul(Qe,ot,u,d);return wt([Qe,ot]),Ft},{a:Qe,b:ot},function(bt,wt){var Ft=wt,Yt=Ft[0],an=Ft[1];return u||d?!u&&d?{a:function(){return bt.matMul(an,!1,!1)},b:function(){return bt.matMul(Yt,!0,!1)}}:u&&!d?{a:function(){return an.matMul(bt,!1,!0)},b:function(){return Yt.matMul(bt,!1,!1)}}:{a:function(){return an.matMul(bt,!0,!0)},b:function(){return bt.matMul(Yt,!0,!0)}}:{a:function(){return bt.matMul(an,!1,!0)},b:function(){return Yt.matMul(bt,!0,!1)}}},"BatchMatMul",vt).reshape(Je)}}),up=xt({dot_:function(v,h){var u=Ke(v,"t1","dot"),d=Ke(h,"t2","dot");we(!(u.rank!==1&&u.rank!==2||d.rank!==1&&d.rank!==2),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+u.rank+" and "+d.rank+"."});var y=u.rank===1?u.size:u.shape[1],D=d.rank===1?d.size:d.shape[0];return we(y===D,function(){return"Error in dot: inner dimensions of inputs must match, but got "+y+" and "+D+"."}),u.rank===1&&d.rank===1?u.as2D(1,-1).matMul(d.as2D(-1,1)).asScalar():u.rank===1&&d.rank===2?u.as2D(1,-1).matMul(d.as2D(d.shape[0],d.shape[1])).as1D():u.rank===2&&d.rank===1?u.matMul(d.as2D(-1,1)).as1D():u.matMul(d.as2D(d.shape[0],d.shape[1]))}}),Bg=xt({outerProduct_:function(v,h){var u=Ke(v,"v1","outerProduct"),d=Ke(h,"v2","outerProduct");return we(u.rank===1&&d.rank===1,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+u.rank+" and "+d.rank+"."}),u.as2D(-1,1).matMul(d.as2D(1,-1))}}),Xl=xt({reverse_:function(v,h){var u=Ke(v,"x","reverse");if(u.rank===0)return u.clone();var d=xn(h,u.shape);return Ve.runKernelFunc(function(y){return y.reverse(u,d)},{$x:u},function(y){return{$x:function(){return y.reverse(d)}}}).reshapeAs(u)}}),Pg=xt({reverse1d_:function(v){var h=Ke(v,"x","reverse");return we(h.rank===1,function(){return"Error in reverse1D: x must be rank 1 but got rank "+h.rank+"."}),Xl(h,0)}}),cp=xt({reverse2d_:function(v,h){var u=Ke(v,"x","reverse");return we(u.rank===2,function(){return"Error in reverse2D: x must be rank 2 but got rank "+u.rank+"."}),Xl(u,h)}}),Yp=xt({reverse3d_:function(v,h){var u=Ke(v,"x","reverse");return we(u.rank===3,function(){return"Error in reverse3D: x must be rank 3 but got rank "+u.rank+"."}),Xl(u,h)}}),Lg=xt({reverse4d_:function(v,h){var u=Ke(v,"x","reverse");return we(u.rank===4,function(){return"Error in reverse4D: x must be rank 4 but got rank "+u.rank+"."}),Xl(u,h)}});function zg(v,h,u,d,y,D){var W=Ke(v,"x","maxPool"),X=W,ae=!1;W.rank===3&&(ae=!0,X=W.as4D(1,W.shape[0],W.shape[1],W.shape[2])),we(X.rank===4,function(){return"Error in maxPool: input must be rank 4 but got rank "+X.rank+"."}),we(ls(u,d),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+u+" and dilations '"+d+"'"}),D!=null&&we(Zt(y),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+D+" but got pad "+y+"."});var de=ku(X.shape,h,u,d,y,D);if(de.filterWidth===1&&de.filterHeight===1&&ln(de.inShape,de.outShape))return W.clone();var be=[X],Ie=Ve.runKernelFunc(function(Re,Me){var qe=Re.maxPool(X,de);return Me([X,qe]),qe},{x:X},function(Re,Me){var qe=Me[0],Je=Me[1];return{x:function(){return function(Qe,ot,vt,bt,wt,Ft,Yt,an){var Jt=Ke(Qe,"dy","maxPoolBackprop"),un=Ke(ot,"input","maxPoolBackprop"),gn=Ke(vt,"output","maxPoolBackprop");we(un.rank===Jt.rank,function(){return"Rank of input ("+un.rank+") does not match rank of dy ("+Jt.rank+")"}),we(ls(wt,Ft),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+wt+" and dilations '"+Ft+"'"}),we(Jt.rank===4,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+Jt.rank+"."}),we(un.rank===4,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+un.rank+"."});var p=ku(un.shape,bt,wt,Ft,Yt,an);return Ve.runKernelFunc(function(c){return c.maxPoolBackprop(Jt,un,gn,p)},{$dy:Jt,$input:un})}(Re,qe,Je,h,u,d,y)}}},"MaxPool",de,be);return ae?Ie.as3D(Ie.shape[1],Ie.shape[2],Ie.shape[3]):Ie}function Um(v,h,u,d,y,D){var W=Ke(v,"x","avgPool","float32");we(ls(u,d),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+u+" and dilations '"+d+"'"});var X=W,ae=!1;W.rank===3&&(ae=!0,X=W.as4D(1,W.shape[0],W.shape[1],W.shape[2])),we(X.rank===4,function(){return"Error in avgPool: x must be rank 4 but got rank "+X.rank+"."}),D!=null&&we(Zt(y),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+D+" but got pad "+y+"."});var de=ku(X.shape,h,u,d,y,D);if(de.filterWidth===1&&de.filterHeight===1&&ln(de.inShape,de.outShape))return W.clone();var be=Ve.runKernelFunc(function(Ie){return Ie.avgPool(X,de)},{x:X},function(Ie){return{x:function(){return function(Re,Me,qe,Je,Qe,ot){var vt=Ke(Re,"dy","avgPoolBackprop"),bt=Ke(Me,"input","avgPoolBackprop");we(bt.rank===vt.rank,function(){return"Rank of input ("+bt.rank+") does not match rank of dy ("+vt.rank+")"}),we(ls(Je,Qe),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+Je+" and dilations '"+Qe+"'"});var wt=bt,Ft=vt,Yt=!1;bt.rank===3&&(Yt=!0,wt=bt.as4D(1,bt.shape[0],bt.shape[1],bt.shape[2]),Ft=vt.as4D(1,vt.shape[0],vt.shape[1],vt.shape[2])),we(Ft.rank===4,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+Ft.rank+"."}),we(wt.rank===4,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+wt.rank+"."});var an=ku(wt.shape,qe,Je,Qe,ot),Jt=Ve.runKernelFunc(function(un){return un.avgPoolBackprop(Ft,wt,an)},{dy4D:Ft,input4D:wt});return Yt?Jt.as3D(Jt.shape[1],Jt.shape[2],Jt.shape[3]):Jt}(Ie,X,h,u,d,y)}}},"AvgPool",de);return be=be.cast(W.dtype),ae?be.as3D(be.shape[1],be.shape[2],be.shape[3]):be}var Ug=xt({maxPool_:function(v,h,u,d,y){return zg(v,h,u,1,d,y)}}),Wg=xt({avgPool_:function(v,h,u,d,y){return Um(v,h,u,1,d,y)}}),Jf=xt({pool_:function(v,h,u,d,y,D){y==null&&(y=[1,1]),D==null&&(D=1),d===0&&(d="valid");var W=Ke(v,"x","maxPool"),X=W,ae=!1;W.rank===3&&(ae=!0,X=W.as4D(1,W.shape[0],W.shape[1],W.shape[2])),we(ls(D,y),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+D+" and dilations '"+y+"'"});var de,be=ku(X.shape,h,D,y,d),Ie=[be.dilationHeight,be.dilationWidth];de=d==="same"?function(wt,Ft){var Yt=wt.map(function(un,gn){return un+(un-1)*(Ft[gn]-1)}).map(function(un){return un-1}),an=Yt.map(function(un){return Math.floor(un/2)}),Jt=Yt.map(function(un,gn){return un-an[gn]});return Yt.map(function(un,gn){return[an[gn],Jt[gn]]})}([be.filterHeight,be.filterWidth],Ie):[[0,0],[0,0]];var Re=Ie[0]===1&&Ie[1]===1,Me=function(wt,Ft,Yt){var an=Yt.map(function(c){return c[0]}),Jt=Yt.map(function(c){return c[1]}),un=wt.concat(an,Jt),gn=Ft.map(function(c,a){return(c-un[a]%c)%c}),p=Jt.map(function(c,a){return c+gn[a]});return[Ft.map(function(c,a){return[an[a],p[a]]}),Ft.map(function(c,a){return[0,gn[a]]})]}([be.inHeight,be.inWidth],Ie,de),qe=Me[0],Je=Me[1],Qe=Re?d:"valid",ot=Re?X:Ao(X,Ie,qe),vt=(u==="avg"?function(){return Um(ot,h,D,1,Qe)}:function(){return zg(ot,h,D,1,Qe)})(),bt=Re?vt:Gc(vt,Ie,Je);return ae?bt.as3D(bt.shape[1],bt.shape[2],bt.shape[3]):bt}}),jv=xt({maxPool3d_:function(v,h,u,d,y,D,W){D===void 0&&(D="NDHWC");var X=Ke(v,"x","maxPool3d"),ae=X,de=!1;X.rank===4&&(de=!0,ae=X.as5D(1,X.shape[0],X.shape[1],X.shape[2],X.shape[3])),W==null&&(W=[1,1,1]),we(ae.rank===5,function(){return"Error in maxPool3d: x must be rank 5 but got rank "+ae.rank+"."}),we(D==="NDHWC",function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+D}),we(ls(u,W),function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+u+" and dilations '"+W+"'"}),y!=null&&we(Zt(d),function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+y+" but got pad "+d+"."});var be=oc(ae.shape,h,u,W,d,y,D),Ie=Ve.runKernelFunc(function(Re,Me){var qe=Re.maxPool3d(ae,be);return Me([ae,qe]),qe},{x:ae},function(Re,Me){var qe=Me[0],Je=Me[1];return{x:function(){return function(Qe,ot,vt,bt,wt,Ft,Yt,an){var Jt=Ke(Qe,"dy","maxPool3dBackprop"),un=Ke(ot,"input","maxPool3dBackprop"),gn=Ke(vt,"output","maxPool3dBackprop"),p=Jt,c=un,a=gn,l=!1;un.rank===4&&(l=!0,p=Jt.as5D(1,Jt.shape[0],Jt.shape[1],Jt.shape[2],Jt.shape[3]),c=un.as5D(1,un.shape[0],un.shape[1],un.shape[2],un.shape[3]),a=gn.as5D(1,gn.shape[0],gn.shape[1],gn.shape[2],gn.shape[3])),we(p.rank===5,function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+p.rank+"."}),we(c.rank===5,function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+c.rank+"."}),we(a.rank===5,function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+a.rank+"."}),Ft==null&&(Ft=[1,1,1]),we(ls(wt,Ft),function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+wt+" and dilations '"+Ft+"'"}),an!=null&&we(Zt(Yt),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+an+" but got pad "+Yt+"."});var g=oc(c.shape,bt,wt,Ft,Yt,an),_=Ve.runKernelFunc(function(j){return j.maxPool3dBackprop(p,c,a,g)},{dy5D:p,input5D:c});return l?_.as4D(_.shape[1],_.shape[2],_.shape[3],_.shape[4]):_}(Re,qe,Je,h,u,W,d,y)}}});return de?Ie.as4D(Ie.shape[1],Ie.shape[2],Ie.shape[3],Ie.shape[4]):Ie}}),Vg=xt({avgPool3d_:function(v,h,u,d,y,D,W){D===void 0&&(D="NDHWC");var X=Ke(v,"x","avgPool3d","float32"),ae=X,de=!1;X.rank===4&&(de=!0,ae=X.as5D(1,X.shape[0],X.shape[1],X.shape[2],X.shape[3])),W==null&&(W=[1,1,1]),we(ae.rank===5,function(){return"Error in avgPool3d: x must be rank 5 but got rank "+ae.rank+"."}),we(D==="NDHWC",function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+D}),we(ls(u,W),function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+u+" and dilations '"+W+"'"}),y!=null&&we(Zt(d),function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+y+" but got pad "+d+"."});var be=oc(ae.shape,h,u,W,d,y,D),Ie=Ve.runKernelFunc(function(Re){return Re.avgPool3d(ae,be)},{x:ae},function(Re){return{x:function(){return function(Me,qe,Je,Qe,ot,vt,bt){var wt=Ke(Me,"dy","avgPool3dBackprop"),Ft=Ke(qe,"input","avgPool3dBackprop"),Yt=wt,an=Ft,Jt=!1;Ft.rank===4&&(Jt=!0,Yt=wt.as5D(1,wt.shape[0],wt.shape[1],wt.shape[2],wt.shape[3]),an=Ft.as5D(1,Ft.shape[0],Ft.shape[1],Ft.shape[2],Ft.shape[3])),we(Yt.rank===5,function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+Yt.rank+"."}),we(an.rank===5,function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+an.rank+"."}),ot==null&&(ot=[1,1,1]),we(ls(Qe,ot),function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+Qe+" and dilations '"+ot+"'"}),bt!=null&&we(Zt(vt),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+bt+" but got pad "+vt+"."});var un=oc(an.shape,Je,Qe,ot,vt,bt),gn=Ve.runKernelFunc(function(p){return p.avgPool3dBackprop(Yt,an,un)},{dy5D:Yt,input5D:an});return Jt?gn.as4D(gn.shape[1],gn.shape[2],gn.shape[3],gn.shape[4]):gn}(Re,ae,h,u,W,d,y)}}});return Ie=Ie.cast(ae.dtype),de?Ie.as4D(Ie.shape[1],Ie.shape[2],Ie.shape[3],Ie.shape[4]):Ie}}),ul=xt({slice_:function(v,h,u){var d,y,D=Ke(v,"x","slice");if(D.rank===0)throw new Error("Slicing scalar is not possible");(d=typeof h=="number"?[h].concat(new Array(D.rank-1).fill(0)):h.length<D.rank?h.concat(new Array(D.rank-h.length).fill(0)):h.slice()).forEach(function(ae){we(ae!==-1,function(){return"slice() does not support negative begin indexing."})}),y=(y=u==null?new Array(D.rank).fill(-1):typeof u=="number"?[u].concat(new Array(D.rank-1).fill(-1)):u.length<D.rank?u.concat(new Array(D.rank-u.length).fill(-1)):u).map(function(ae,de){return ae>=0?ae:(we(ae===-1,function(){return"Negative size values should be exactly -1 but got "+ae+" for the slice() size at index "+de+"."}),D.shape[de]-d[de])}),zh(D,d,y);var W=D.shape,X={begin:d,size:y};return Ve.runKernelFunc(function(ae){return ae.slice(D,d,y)},{x:D},function(ae){for(var de=[],be=0;be<ae.rank;be++)de.push([d[be],W[be]-d[be]-y[be]]);return{x:function(){return ae.pad(de)}}},"Slice",X)}}),Wm=xt({slice1d_:function(v,h,u){var d=Ke(v,"x","slice1d");return we(d.rank===1,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+d.rank+" tensor"}),ul(d,[h],[u])}}),qg=xt({slice2d_:function(v,h,u){var d=Ke(v,"x","slice2d");return we(d.rank===2,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+d.rank+" tensor"}),ul(d,h,u)}}),Qf=xt({slice3d_:function(v,h,u){var d=Ke(v,"x","slice3d");return we(d.rank===3,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+d.rank+" tensor"}),ul(d,h,u)}}),cl=xt({slice4d_:function(v,h,u){var d=Ke(v,"x","slice4d");return we(d.rank===4,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+d.rank+" tensor"}),ul(d,h,u)}});function Jp(v,h,u,d,y){return h.rank<u.rank&&(h=h.reshape(_a(h.shape,d))),v.rank<u.rank&&(v=v.reshape(_a(v.shape,d))),{x:function(){var D=v.mul(u.equal(h).cast(v.dtype));return y==null?D:D.transpose(y)}}}var Vm=xt({all_:function(v,h,u){h===void 0&&(h=null),u===void 0&&(u=!1);var d=Ke(v,"x","all","bool"),y=xn(h,d.shape),D=y,W=Co(D,d.rank);W!=null&&(d=d.transpose(W),D=Oo(D.length,d.rank));var X=Ve.runKernelFunc(function(de){return de.all(d,D)},{$x:d});if(u){var ae=_a(X.shape,y);return X.reshape(ae)}return X}}),dc=xt({any_:function(v,h,u){h===void 0&&(h=null),u===void 0&&(u=!1);var d=Ke(v,"x","any","bool"),y=xn(h,d.shape),D=y,W=Co(D,d.rank);W!=null&&(d=d.transpose(W),D=Oo(D.length,d.rank));var X=Ve.runKernelFunc(function(de){return de.any(d,D)},{$x:d});if(u){var ae=_a(X.shape,y);return X.reshape(ae)}return X}}),qm=xt({argMax_:function(v,h){h===void 0&&(h=0);var u=Ke(v,"x","argMax");h==null&&(h=0);var d=xn(h,u.shape),y=Co(d,u.rank);y!=null&&(u=u.transpose(y),d=Oo(d.length,u.rank));var D={axis:d[0]},W=[u];return Ve.runKernelFunc(function(X,ae){var de=X.argMax(u,d[0]);return ae([u]),de},{x:u},function(X,ae){var de=ae[0];return{x:function(){return ii(de)}}},"ArgMax",D,W)}}),Hg=xt({argMin_:function(v,h){h===void 0&&(h=0);var u=Ke(v,"x","argMin");h==null&&(h=0);var d=xn(h,u.shape),y=Co(d,u.rank);return y!=null&&(u=u.transpose(y),d=Oo(d.length,u.rank)),Ve.runKernelFunc(function(D,W){var X=D.argMin(u,d[0]);return W([u]),X},{$x:u},function(D,W){var X=W[0];return{$x:function(){return ii(X)}}})}}),Yl=xt({logSumExp_:function(v,h,u){h===void 0&&(h=null),u===void 0&&(u=!1);var d=Ke(v,"x","logSumExp"),y=xn(h,d.shape),D=d.max(y,!0),W=d.sub(D).exp().sum(y).log(),X=D.reshape(W.shape).add(W);if(u){var ae=_a(X.shape,y);return X.reshape(ae)}return X}}),Bv=xt({max_:function(v,h,u){h===void 0&&(h=null),u===void 0&&(u=!1);var d=Ke(v,"x","max"),y=d,D=xn(h,d.shape),W=D,X=Co(W,d.rank);X!=null&&(d=d.transpose(X),W=Oo(W.length,d.rank));var ae=[d],de=Ve.runKernelFunc(function(Ie,Re){var Me=Ie.max(d,W);return Re([y,Me]),Me},{x:d},function(Ie,Re){return Jp(Ie,Re[1],Re[0],D,X)},"Max",{axes:W},ae,[!0]);if(u){var be=_a(de.shape,D);de=de.reshape(be)}return de}}),ed=xt({mean_:function(v,h,u){h===void 0&&(h=null),u===void 0&&(u=!1);var d=Ke(v,"x","mean"),y=xn(h,d.shape),D=Ye(Aa(d.shape,y)[1]);return Ws(function(W){var X=fr(D);return{value:(X.dtype===W.dtype?W:W.cast(X.dtype)).div(X).sum(h,u),gradFunc:function(ae){var de=W.shape.slice();return y.forEach(function(be){de[be]=1}),ae.reshape(de).mul(uu(W.shape,"float32")).div(D)}}})(d)}}),td=xt({min_:function(v,h,u){h===void 0&&(h=null),u===void 0&&(u=!1);var d=Ke(v,"x","min"),y=d,D=xn(h,d.shape),W=D,X=Co(W,d.rank);X!=null&&(d=d.transpose(X),W=Oo(W.length,d.rank));var ae=[d],de=Ve.runKernelFunc(function(Ie,Re){var Me=Ie.min(d,W);return Re([y,Me]),Me},{x:d},function(Ie,Re){return Jp(Ie,Re[1],Re[0],D,X)},"Min",{axes:W},ae,[!0]);if(u){var be=_a(de.shape,D);de=de.reshape(be)}return de}}),Jl=xt({moments_:function(v,h,u){h===void 0&&(h=null),u===void 0&&(u=!1);var d=xn(h,(v=Ke(v,"x","moments")).shape),y=v.mean(d,u),D=y.shape;return u||(D=_a(y.shape,d)),{mean:y,variance:v.toFloat().sub(y.reshape(D)).square().mean(d,u)}}}),$g=xt({sum_:function(v,h,u){h===void 0&&(h=null),u===void 0&&(u=!1);var d=Ke(v,"x","sum");d.dtype==="bool"&&(d=d.toInt());var y=xn(h,d.shape);return Ws(function(D){var W=Co(y,D.rank),X=y,ae=D;W!=null&&(ae=D.transpose(W),X=Oo(X.length,D.rank));var de=function(Me){var qe=D.shape.slice();return y.forEach(function(Je){qe[Je]=1}),Me.reshape(qe).mul(uu(D.shape,"float32"))},be={axes:X},Ie=Ve.runKernelFunc(function(Me){return Me.sum(ae,X)},{x:ae},function(Me){return{x:function(){return de(Me)}}},"Sum",be);if(u){var Re=_a(Ie.shape,y);Ie=Ie.reshape(Re)}return{value:Ie,gradFunc:de}})(d)}}),Zf=xt({prod_:function(v,h,u){h===void 0&&(h=null),u===void 0&&(u=!1);var d=Ke(v,"x","prod");d.dtype==="bool"&&(d=d.toInt());var y=xn(h,d.shape),D=Co(y,d.rank),W=y,X=d;D!=null&&(X=d.transpose(D),W=Oo(W.length,d.rank));var ae=Ve.runKernelFunc(function(be){return be.prod(X,W)},{permutedX:X});if(u){var de=_a(ae.shape,y);ae=ae.reshape(de)}return ae}}),pc=xt({elu_:function(v){var h=Ke(v,"x","elu");return Ve.runKernelFunc(function(u,d){var y=u.elu(h);return d([y]),y},{$x:h},function(u,d){var y=d[0];return{$x:function(){return Ve.runKernelFunc(function(D){return D.eluDer(u,y)},{dy:u,y})}}})}}),nd=xt({leakyRelu_:function(v,h){h===void 0&&(h=.2);var u=Ke(v,"x","leakyRelu");return Hf(fr(h).mul(u),u)}}),lp=xt({prelu_:function(v,h){var u=Ke(v,"x","prelu"),d=Ke(h,"alpha","prelu");return Ve.runKernelFunc(function(y,D){var W=y.prelu(u,d);return D([u,d]),W},{x:u,alpha:d},function(y,D){var W=D[0],X=D[1],ae=W.greater(0);return{x:function(){return ta(ae,y,y.mul(X))},alpha:function(){var de=ta(ae,ii(y),y.mul(W)),be=bo(X.shape,y.shape);return be.length>0&&(de=de.sum(be)),de.reshape(X.shape)}}},"Prelu")}}),Qp=xt({relu_:function(v){var h=Ke(v,"x","relu");return h.dtype==="bool"?h.toInt():Ve.runKernelFunc(function(u,d){var y=u.relu(h);return d([h]),y},{x:h},function(u,d){var y=d[0];return{x:function(){return u.mulStrict(y.step().toFloat())}}},"Relu")}}),Hm=xt({relu6_:function(v){var h=Ke(v,"x","relu6");return h.dtype==="bool"?h.toInt():Ve.runKernelFunc(function(u,d){var y=u.relu6(h);return d([h]),y},{x:h},function(u,d){var y=d[0],D=y.lessEqual(6).mul(y.step());return{x:function(){return u.mulStrict(D.toFloat())}}},"Relu6")}}),Gg=xt({selu_:function(v){var h=Ke(v,"x","selu");return Ve.runKernelFunc(function(u,d){var y=u.selu(h);return d([h]),y},{$x:h},function(u,d){var y=d[0];return{$x:function(){var D=y.greater(fr(0)),W=fr(lc),X=fr(el),ae=u.mul(X),de=u.mul(W).mul(y.toFloat().exp());return ta(D,ae,de)}}})}}),ns=xt({transpose_:function(v,h){var u=Ke(v,"x","transpose");if(h==null&&(h=u.shape.map(function(y,D){return D}).reverse()),we(u.rank===h.length,function(){return"Error in transpose: rank of input "+u.rank+" must match length of perm "+h+"."}),h.forEach(function(y){we(y>=0&&y<u.rank,function(){return"All entries in 'perm' must be between 0 and "+(u.rank-1)+" but got "+h})}),u.rank<=1)return u.clone();var d={perm:h};return Ve.runKernelFunc(function(y){return y.transpose(u,h)},{x:u},function(y){var D=wu(h);return{x:function(){return y.transpose(D)}}},"Transpose",d)}}),Kg=xt({localResponseNormalization_:function(v,h,u,d,y){h===void 0&&(h=5),u===void 0&&(u=1),d===void 0&&(d=1),y===void 0&&(y=.5);var D=Ke(v,"x","localResponseNormalization");we(D.rank===4||D.rank===3,function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `+D.rank+"."}),we(Zt(h),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+h+"."});var W=D,X=!1;D.rank===3&&(X=!0,W=D.as4D(1,D.shape[0],D.shape[1],D.shape[2]));var ae=Ve.runKernelFunc(function(de,be){var Ie=de.localResponseNormalization4D(W,h,u,d,y);return be([W,Ie]),Ie},{x4D:W},function(de,be){var Ie=be[0],Re=be[1];return{x4D:function(){return Ve.runKernelFunc(function(Me){return Me.LRNGrad(de,Ie,Re,h,u,d,y)},{})}}});return X?ae.as3D(ae.shape[1],ae.shape[2],ae.shape[3]):ae}}),rd=xt({norm_:function(v,h,u,d){h===void 0&&(h="euclidean"),u===void 0&&(u=null),d===void 0&&(d=!1);var y=function X(ae,de,be){if(be===void 0&&(be=null),ae.rank===0)return ae.abs();if(ae.rank!==1&&be===null)return X(ae.reshape([-1]),de,be);if(ae.rank===1||typeof be=="number"||Array.isArray(be)&&be.length===1){if(de===1)return ae.abs().sum(be);if(de===1/0)return ae.abs().max(be);if(de===-1/0)return ae.abs().min(be);if(de==="euclidean"||de===2)return ae.abs().pow(fr(2,"int32")).sum(be).sqrt();throw new Error("Error in norm: invalid ord value: "+de)}if(Array.isArray(be)&&be.length===2){if(de===1)return ae.abs().sum(be[0]).max(be[1]-1);if(de===1/0)return ae.abs().sum(be[1]).max(be[0]);if(de===-1/0)return ae.abs().sum(be[1]).min(be[0]);if(de==="fro"||de==="euclidean")return ae.square().sum(be).sqrt();throw new Error("Error in norm: invalid ord value: "+de)}throw new Error("Error in norm: invalid axis: "+be)}(v=Ke(v,"x","norm"),h,u),D=y.shape;if(d){var W=xn(u,v.shape);D=_a(y.shape,W)}return y.reshape(D)}}),Xg=xt({basicLSTMCell_:function(v,h,u,d,y,D){var W=Ke(v,"forgetBias","basicLSTMCell"),X=Ke(h,"lstmKernel","basicLSTMCell"),ae=Ke(u,"lstmBias","basicLSTMCell"),de=Ke(d,"data","basicLSTMCell"),be=Ke(y,"c","basicLSTMCell"),Ie=Ke(D,"h","basicLSTMCell"),Re=de.concat(Ie,1).matMul(X).add(ae),Me=Re.shape[0],qe=Re.shape[1]/4,Je=[Me,qe],Qe=Re.slice([0,0],Je),ot=Re.slice([0,qe],Je),vt=Re.slice([0,2*qe],Je),bt=Re.slice([0,3*qe],Je),wt=Qe.sigmoid().mulStrict(ot.tanh()).addStrict(be.mulStrict(W.add(vt).sigmoid()));return[wt,wt.tanh().mulStrict(bt.sigmoid())]}}),Zp=xt({multiRNNCell_:function(v,h,u,d){for(var y=Ke(h,"data","multiRNNCell"),D=Lu(u,"c","multiRNNCell"),W=Lu(d,"h","multiRNNCell"),X=y,ae=[],de=0;de<v.length;de++){var be=v[de](X,D[de],W[de]);ae.push(be[0]),ae.push(be[1]),X=be[1]}var Ie=[],Re=[];for(de=0;de<ae.length;de+=2)Ie.push(ae[de]),Re.push(ae[de+1]);return[Ie,Re]}}),Ql=xt({movingAverage_:function(v,h,u,d,y){y===void 0&&(y=!0);var D=Ke(v,"v","movingAverage"),W=Ke(h,"x","movingAverage"),X=Ke(u,"decay","movingAverage");Ln(D,W),we(ln(D.shape,W.shape),function(){return"Shape mismatch in v and x"});var ae=fr(1),de=ae.sub(X),be=W.sub(D).mul(de);if(y){we(d!=null,function(){return"When using zeroDebias: true, step is required."});var Ie=Ke(d,"step","movingAverage");be=be.div(ae.sub(Gf(X,Ie)))}return D.add(be)}}),fp=xt({stridedSlice_:function(v,h,u,d,y,D,W,X,ae){if(y===void 0&&(y=0),D===void 0&&(D=0),W===void 0&&(W=0),X===void 0&&(X=0),ae===void 0&&(ae=0),d==null&&(d=new Array(h.length)),W!==0)throw new Error("ellipsis mask is not yet supported");var de=Ke(v,"x","stridedSlice"),be=yo(X),Ie=de.shape.slice();be.forEach(function(Qe){h[Qe]=0,u[Qe]=1,Ie.splice(Qe,0,1)}),de=de.reshape(Ie);for(var Re=0;Re<de.rank;Re++)h[Re]=Cs(y,h,d,de.shape,Re),u[Re]=Ml(D,u,d,de.shape,Re),d[Re]=d[Re]||1;var Me=yo(ae);Me.forEach(function(Qe){u[Qe]=h[Qe]+1,d[Qe]=1});var qe=Rl(h,u,d),Je=qe.filter(function(Qe,ot){return Me.indexOf(ot)===-1});return d.every(function(Qe){return Qe===1})?ul(de,h,qe).reshape(Je):Ve.runKernelFunc(function(Qe){return Qe.stridedSlice(de,h,u,d)},{$x:de}).reshape(Je)}}),ll=xt({topk_:function(v,h,u){h===void 0&&(h=1),u===void 0&&(u=!0);var d=Ke(v,"x","topk");if(d.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var y=d.shape[d.shape.length-1];if(h>y)throw new Error("'k' passed to topk() must be <= the last dimension ("+y+") but got "+h);var D=Ve.runKernelFunc(function(W){return W.topk(d,h,u)},{$x:d});return{values:D[0],indices:D[1]}}}),Yg=xt({scatterND_:function(v,h,u){var d=Ke(v,"indices","scatterND","int32"),y=Ke(h,"updates","scatterND");return Nf(y,d,u),Ve.runKernelFunc(function(D){return D.scatterND(d,y,u)},{indices:d,updates:y},null,"ScatterNd",{shape:u})}}),em=xt({fft_:function(v){we(v.dtype==="complex64",function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+v.dtype+"."});var h=v.shape[v.shape.length-1],u=v.size/h,d=v.as2D(u,h);return Ve.runKernelFunc(function(y){return y.fft(d)},{input:v}).reshape(v.shape)}}),tm=xt({ifft_:function(v){we(v.dtype==="complex64",function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+v.dtype+"."});var h=v.shape[v.shape.length-1],u=v.size/h,d=v.as2D(u,h);return Ve.runKernelFunc(function(y){return y.ifft(d)},{input:v}).reshape(v.shape)}}),$m=xt({rfft_:function(v,h){we(v.dtype==="float32",function(){return"The dtype for rfft() must be real value but got "+v.dtype});var u,d=v.shape[v.shape.length-1],y=v.size/d;if(h!=null&&h<d){var D=v.shape.map(function(ot){return 0}),W=v.shape.map(function(ot){return ot});W[v.shape.length-1]=h,u=v.slice(D,W),d=h}else if(h!=null&&h>d){var X=v.shape.map(function(ot){return ot});X[v.shape.length-1]=h-d,u=v.concat(Ki(X),v.shape.length-1),d=h}else u=v;var ae=u.zerosLike(),de=fa(u,ae).as2D(y,d),be=em(de),Ie=Math.floor(d/2)+1,Re=uo(be),Me=Uo(be),qe=Re.split([Ie,d-Ie],Re.shape.length-1),Je=Me.split([Ie,d-Ie],Me.shape.length-1),Qe=u.shape.slice();return Qe[u.shape.length-1]=Ie,fa(qe[0],Je[0]).reshape(Qe)}}),Fc=xt({irfft_:function(v){var h=v.shape[v.shape.length-1],u=v.size/h;if(h<=2){var d=v.as2D(u,h),y=tm(d);return uo(y)}var D=[u,2*(h-1)],W=uo(v).as2D(u,h),X=Uo(v).as2D(u,h),ae=W.slice([0,1],[u,h-2]).reverse(1),de=X.slice([0,1],[u,h-2]).reverse(1).mul(fr(-1)),be=W.concat(ae,1),Ie=X.concat(de,1);return d=fa(be,Ie).as2D(D[0],D[1]),y=tm(d),uo(y)}}),nm=Object.freeze({fft:em,ifft:tm,rfft:$m,irfft:Fc}),Jg=xt({sparseToDense_:function(v,h,u,d){d===void 0&&(d=0);var y=Ke(v,"sparseIndices","sparseToDense","int32"),D=Ke(h,"sparseValues","sparseToDense"),W=Ke(d,"defaultValue","sparseToDense",D.dtype);return function(X,ae,de,be){if(X.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+X.dtype+".");if(X.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+X.shape+".");var Ie=X.rank>0?X.shape[0]:1,Re=X.rank>1?X.shape[1]:1;if(de.length!==Re)throw new Error("outputShape has incorrect number of elements:, "+de.length+", should be: "+Re+".");var Me=ae.size;if(ae.rank!==0&&(ae.rank!==1||Me!==Ie))throw new Error("sparseValues has incorrect shape "+ae.shape+", should be [] or ["+Ie+"]");if(ae.dtype!==be.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(y,D,u,W),Ve.runKernelFunc(function(X){return X.sparseToDense(y,D,u,W)},{$sparseIndices:y,$sparseValues:D,$defaultValue:W})}}),fl=xt({gatherND_:function(v,h){var u=Ke(h,"indices","gatherND","int32"),d=Ke(v,"x","gatherND");return Ve.runKernelFunc(function(y){return y.gatherND(d,u)},{x:d,indices:u},null,"GatherNd")}}),hp=xt({diag_:function(v){var h=Ke(v,"x","diag").flatten(),u=v.shape.concat(v.shape);return Ve.runKernelFunc(function(d){return d.diag(h)},{$x:h}).reshape(u)}}),eh=xt({dropout_:function(v,h,u,d){var y=Ke(v,"x","dropout");if(we(y.dtype==="float32",function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+y.dtype+" tensor instead."}),we(h>=0&&h<1,function(){return"rate must be a float in the range [0, 1), but got "+h+"."}),h===0)return v instanceof jt?y.clone():y;var D=function(ae,de){if(de==null)return ae.shape.slice();if(ln(ae.shape,de))return de;if(ae.shape.length===de.length){for(var be=[],Ie=0;Ie<ae.shape.length;Ie++)de[Ie]==null&&ae.shape[Ie]!=null?be.push(ae.shape[Ie]):be.push(de[Ie]);return be}return de}(y,u),W=1-h,X=Il(D,0,1,"float32",d).add(W).floor().div(W);return y.mul(X)}});function dp(v,h,u){for(var d=1-v%2,y=new Float32Array(v),D=0;D<v;++D){var W=2*Math.PI*D/(v+d-1);y[D]=h-u*Math.cos(W)}return zs(y,"float32")}var rs,rm=xt({hannWindow_:function(v){return dp(v,.5,.5)}}),Gm=xt({hammingWindow_:function(v){return dp(v,.54,.46)}}),pp=xt({frame_:function(v,h,u,d,y){d===void 0&&(d=!1),y===void 0&&(y=0);for(var D=0,W=[];D+h<=v.size;)W.push(ul(v,D,h)),D+=u;if(d)for(;D<v.size;){var X=D+h-v.size,ae=Ba([ul(v,D,h-X),ws([X],y)]);W.push(ae),D+=u}return W.length===0?eu([],[0,h]):Ba(W).as2D(W.length,h)}}),mp=xt({stft_:function(v,h,u,d,y){var D;y===void 0&&(y=rm),d==null&&(D=h,d=Math.floor(Math.pow(2,Math.ceil(Math.log(D)/Math.log(2)))));for(var W=pp(v,h,u),X=ol(W,y(h)),ae=[],de=0;de<W.shape[0];de++)ae.push($m(X.slice([de,0],[1,h]),d));return Ba(ae)}}),Km=Object.freeze({hannWindow:rm,hammingWindow:Gm,frame:pp,stft:mp}),Qg=function(v,h,u){return u===void 0&&(u=1),R(this,void 0,void 0,function(){var d,y,D,W,X,ae,de,be,Ie,Re,Me,qe,Je,Qe;return P(this,function(ot){switch(ot.label){case 0:return d=Ke(v,"predictions","inTopK"),y=Ke(h,"targets","inTopK"),we(d.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+d.rank}),we(d.rank-1===y.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+d.rank+" and targets rank "+y.rank}),Tt(d.shape.slice(0,d.shape.length-1),y.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),D=d.shape[d.shape.length-1],we(u>0&&u<=D,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+D+"), but got "+u}),[4,d.data()];case 1:return W=ot.sent(),[4,y.data()];case 2:for(X=ot.sent(),ae=[W.length/D,D],be=ae[1],Ie=Yn("bool",de=ae[0]),Re=0;Re<de;Re++){for(Me=Re*be,qe=W.subarray(Me,Me+be),Je=[],Qe=0;Qe<qe.length;Qe++)Je.push({value:qe[Qe],index:Qe});for(Je.sort(function(vt,bt){return bt.value-vt.value}),Ie[Re]=0,Qe=0;Qe<u;Qe++)if(Je[Qe].index===X[Re]){Ie[Re]=1;break}}return v!==d&&d.dispose(),h!==y&&y.dispose(),[2,wa(Ie,y.shape,"bool")]}})})};(function(v){v[v.NONE=0]="NONE",v[v.MEAN=1]="MEAN",v[v.SUM=2]="SUM",v[v.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(rs||(rs={}));var Pv=xt({absoluteDifference_:function(v,h,u,d){d===void 0&&(d=rs.SUM_BY_NONZERO_WEIGHTS);var y=Ke(v,"labels","absoluteDifference"),D=Ke(h,"predictions","absoluteDifference"),W=null;u!=null&&(W=Ke(u,"weights","absoluteDifference")),Tt(y.shape,D.shape,"Error in absoluteDifference: ");var X=y.sub(D).abs();return Rc(X,W,d)}}),Rc=xt({computeWeightedLoss_:function(v,h,u){u===void 0&&(u=rs.SUM_BY_NONZERO_WEIGHTS);var d=Ke(v,"losses","computeWeightedLoss"),y=null;h!=null&&(y=Ke(h,"weights","computeWeightedLoss"));var D=y==null?d:d.mul(y);if(u===rs.NONE)return D;if(u===rs.SUM)return D.sum();if(u===rs.MEAN){if(y==null)return D.mean();var W=d.size/y.size,X=D.sum().div(y.sum());return W>1?X.div(fr(W)):X}if(u===rs.SUM_BY_NONZERO_WEIGHTS){if(y==null)return D.sum().div(fr(d.size));var ae=y.mul(uu(d.shape)).notEqual(fr(0)).sum().toFloat();return D.sum().div(ae)}throw Error("Unknown reduction: "+u)}}),th=xt({cosineDistance_:function(v,h,u,d,y){y===void 0&&(y=rs.SUM_BY_NONZERO_WEIGHTS);var D=Ke(v,"labels","cosineDistance"),W=Ke(h,"predictions","cosineDistance"),X=null;d!=null&&(X=Ke(d,"weights","cosineDistance")),Tt(D.shape,W.shape,"Error in cosineDistance: ");var ae=fr(1).sub(D.mul(W).sum(u,!0));return Rc(ae,X,y)}}),Lv=xt({hingeLoss_:function(v,h,u,d){d===void 0&&(d=rs.SUM_BY_NONZERO_WEIGHTS);var y=Ke(v,"labels","hingeLoss"),D=Ke(h,"predictions","hingeLoss"),W=null;u!=null&&(W=Ke(u,"weights","hingeLoss")),Tt(y.shape,D.shape,"Error in hingeLoss: ");var X=fr(1);y=fr(2).mul(y).sub(X);var ae=X.sub(y.mul(D)).relu();return Rc(ae,W,d)}}),Zg=xt({huberLoss_:function(v,h,u,d,y){d===void 0&&(d=1),y===void 0&&(y=rs.SUM_BY_NONZERO_WEIGHTS);var D=Ke(v,"labels","huberLoss"),W=Ke(h,"predictions","huberLoss"),X=null;u!=null&&(X=Ke(u,"weights","huberLoss")),Tt(D.shape,W.shape,"Error in huberLoss: ");var ae=fr(d),de=W.sub(D).abs(),be=Gl(de,ae),Ie=de.sub(be),Re=fr(.5).mul(be.square()).add(ae.mul(Ie));return Rc(Re,X,y)}}),Mc=xt({logLoss_:function(v,h,u,d,y){d===void 0&&(d=1e-7),y===void 0&&(y=rs.SUM_BY_NONZERO_WEIGHTS);var D=Ke(v,"labels","logLoss"),W=Ke(h,"predictions","logLoss"),X=null;u!=null&&(X=Ke(u,"weights","logLoss")),Tt(D.shape,W.shape,"Error in logLoss: ");var ae=fr(1),de=fr(d),be=D.mul(W.add(de).log()).neg().sub(ae.sub(D).mul(ae.sub(W).add(de).log()));return Rc(be,X,y)}}),Xo=xt({meanSquaredError_:function(v,h,u,d){d===void 0&&(d=rs.SUM_BY_NONZERO_WEIGHTS);var y=Ke(v,"labels","meanSquaredError"),D=Ke(h,"predictions","meanSquaredError"),W=null;u!=null&&(W=Ke(u,"weights","meanSquaredError")),Tt(y.shape,D.shape,"Error in meanSquaredError: ");var X=y.squaredDifference(D);return Rc(X,W,d)}}),id=xt({sigmoidCrossEntropy_:function(v,h,u,d,y){d===void 0&&(d=0),y===void 0&&(y=rs.SUM_BY_NONZERO_WEIGHTS);var D=Ke(v,"multiClassLabels","sigmoidCrossEntropy"),W=Ke(h,"logits","sigmoidCrossEntropy"),X=null;if(u!=null&&(X=Ke(u,"weights","sigmoidCrossEntropy")),Tt(D.shape,W.shape,"Error in sigmoidCrossEntropy: "),d>0){var ae=fr(d),de=fr(1),be=fr(.5);D=D.mul(de.sub(ae)).add(be.mul(ae))}var Ie=function(Re,Me){var qe=Ke(Re,"labels","sigmoidCrossEntropyWithLogits"),Je=Ke(Me,"logits","sigmoidCrossEntropyWithLogits");Tt(qe.shape,Je.shape,"Error in sigmoidCrossEntropyWithLogits: ");var Qe=Je.relu(),ot=Je.mul(qe),vt=Je.abs().neg().exp().log1p();return Qe.sub(ot).add(vt)}(D,W);return Rc(Ie,X,y)}}),gp=xt({softmaxCrossEntropy_:function(v,h,u,d,y){d===void 0&&(d=0),y===void 0&&(y=rs.SUM_BY_NONZERO_WEIGHTS);var D=Ke(v,"onehotLabels","softmaxCrossEntropy"),W=Ke(h,"logits","softmaxCrossEntropy"),X=null;if(u!=null&&(X=Ke(u,"weights","softmaxCrossEntropy")),Tt(D.shape,W.shape,"Error in softmaxCrossEntropy: "),d>0){var ae=fr(d),de=fr(1),be=fr(D.shape[1]);D=D.mul(de.sub(ae)).add(ae.div(be))}var Ie=function(Re,Me,qe){if(qe===void 0&&(qe=-1),qe===-1&&(qe=Me.rank-1),qe!==Me.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+Me.rank+" and dim was "+qe);return Ws(function(Je,Qe,ot){var vt=Qe.logSumExp([qe],!0),bt=Qe.toFloat().sub(vt);return ot([Je,bt]),{value:bt.mul(Je).neg().sum([qe]),gradFunc:function(wt,Ft){var Yt=Ft[0],an=Ft[1],Jt=_a(wt.shape,[qe]);return[wt.reshape(Jt).mul(Yt.toFloat().sub(an.exp())),wt.reshape(Jt).mul(an.exp().sub(Yt.toFloat()))]}}})(Re,Me)}(D,W);return Rc(Ie,X,y)}}),im=Object.freeze({get Reduction(){return rs},absoluteDifference:Pv,computeWeightedLoss:Rc,cosineDistance:th,hingeLoss:Lv,huberLoss:Zg,logLoss:Mc,meanSquaredError:Xo,sigmoidCrossEntropy:id,softmaxCrossEntropy:gp});function ev(v,h){return h===void 0&&(h=!1),Ve.tidy(function(){if(v.shape.length!==2)throw new Error("qr2d() requires a 2D Tensor, but got a "+v.shape.length+"D Tensor.");for(var u=v.shape[0],d=v.shape[1],y=Bh(u),D=v.clone(),W=eu([[1]],[1,1]),X=W.clone(),ae=u>=d?d:u,de=function(Ie){var Re,Me=D,qe=X,Je=y;Re=Ve.tidy(function(){var Qe=D.slice([Ie,Ie],[u-Ie,1]),ot=Qe.norm(),vt=D.slice([Ie,Ie],[1,1]),bt=eu([[-1]]).where(vt.greater(0),eu([[1]])),wt=vt.sub(bt.mul(ot)),Ft=Qe.div(wt);X=Ft.shape[0]===1?W.clone():W.concat(Ft.slice([1,0],[Ft.shape[0]-1,Ft.shape[1]]),0);var Yt=bt.matMul(wt).div(ot).neg(),an=D.slice([Ie,0],[u-Ie,d]),Jt=Yt.mul(X);if(Ie===0)D=an.sub(Jt.matMul(X.transpose().matMul(an)));else{var un=an.sub(Jt.matMul(X.transpose().matMul(an)));D=D.slice([0,0],[Ie,d]).concat(un,0)}var gn=y.slice([0,Ie],[u,y.shape[1]-Ie]);if(Ie===0)y=gn.sub(gn.matMul(X).matMul(Jt.transpose()));else{var p=gn.sub(gn.matMul(X).matMul(Jt.transpose()));y=y.slice([0,0],[u,Ie]).concat(p,1)}return[X,D,y]}),X=Re[0],D=Re[1],y=Re[2],Na([Me,qe,Je])},be=0;be<ae;++be)de(be);return!h&&u>d&&(y=y.slice([0,0],[u,d]),D=D.slice([0,0],[d,d])),[y,D]})}var am=xt({bandPart_:function(v,h,u){if(h%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+h+".");if(u%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+u+".");var d=Ke(v,"a","bandPart");if(d.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+d.rank+".");var y=d.shape,D=d.shape.slice(-2),W=D[0],X=D[1];if(!(h<=W))throw new Error("bandPart(): numLower ("+h+") must not be greater than the number of rows ("+W+").");if(!(u<=X))throw new Error("bandPart(): numUpper ("+u+") must not be greater than the number of columns ("+X+").");h<0&&(h=W),u<0&&(u=X);var ae=ac(0,W,1,"int32").reshape([-1,1]),de=ac(0,X,1,"int32"),be=Ic(ae,de),Ie=Vf(be.lessEqual(fr(+h,"int32")),be.greaterEqual(fr(-u,"int32"))),Re=Ki([W,X],d.dtype);return Mi(Ro(d.reshape([-1,W,X])).map(function(Me){return ta(Ie,Me,Re)})).reshape(y)}}),Zl=xt({gramSchmidt_:function(v){var h;if(Array.isArray(v)){h=!1,we(v!=null&&v.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var u=v[0].shape[0],d=function(ae){we(v[ae].shape[0]===u,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+v[ae].shape[0]+" vs. "+u+")"})},y=1;y<v.length;++y)d(y)}else h=!0,v=Ri(v,v.shape[0],0).map(function(ae){return Fo(ae,[0])});we(v.length<=v[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+v.length+") exceeds number of dimensions ("+v[0].shape[0]+")."});var D=[],W=v,X=function(ae){D.push(Ve.tidy(function(){var de=W[ae];if(ae>0)for(var be=0;be<ae;++be){var Ie=$g(D[be].mulStrict(de)).mul(D[be]);de=de.sub(Ie)}return de.div(rd(de,"euclidean"))}))};for(y=0;y<v.length;++y)X(y);return h?Mi(D,0):D}}),E0=xt({qr_:function(v,h){if(h===void 0&&(h=!1),v.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+v.rank);if(v.rank===2)return ev(v,h);var u=v.shape.slice(0,v.shape.length-2).reduce(function(D,W){return D*W}),d=[],y=[];return Ro(v.reshape([u,v.shape[v.shape.length-2],v.shape[v.shape.length-1]]),0).forEach(function(D){var W=ev(D,h),X=W[0],ae=W[1];d.push(X),y.push(ae)}),[Mi(d,0).reshape(v.shape),Mi(y,0).reshape(v.shape)]}}),om=Object.freeze({bandPart:am,gramSchmidt:Zl,qr:E0});function qo(v,h,u,d,y,D){d==null&&(d=.5),y==null&&(y=Number.NEGATIVE_INFINITY),D==null&&(D=0);var W=v.shape[0];return u=Math.min(u,W),we(0<=d&&d<=1,function(){return"iouThreshold must be in [0, 1], but was '"+d+"'"}),we(v.rank===2,function(){return"boxes must be a 2D tensor, but was of rank '"+v.rank+"'"}),we(v.shape[1]===4,function(){return"boxes must have 4 columns, but 2nd dimension was "+v.shape[1]}),we(h.rank===1,function(){return"scores must be a 1D tensor"}),we(h.shape[0]===W,function(){return"scores has incompatible shape with boxes. Expected "+W+", but was "+h.shape[0]}),we(0<=D&&D<=1,function(){return"softNmsSigma must be in [0, 1], but was '"+D+"'"}),{maxOutputSize:u,iouThreshold:d,scoreThreshold:y,softNmsSigma:D}}var vp=xt({resizeBilinear_:function(v,h,u){u===void 0&&(u=!1);var d=Ke(v,"images","resizeBilinear");we(d.rank===3||d.rank===4,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+d.rank+"."}),we(h.length===2,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+h+"."});var y=d,D=!1;d.rank===3&&(D=!0,y=d.as4D(1,d.shape[0],d.shape[1],d.shape[2]));var W=h[0],X=h[1],ae=Ve.runKernelFunc(function(de,be){return be([y]),de.resizeBilinear(y,W,X,u)},{x:y},function(de,be){return{x:function(){return Ve.runKernelFunc(function(Ie){return Ie.resizeBilinearBackprop(de,be[0],u)},{})}}},"ResizeBilinear",{alignCorners:u,newHeight:W,newWidth:X});return D?ae.as3D(ae.shape[1],ae.shape[2],ae.shape[3]):ae}}),nh=xt({resizeNearestNeighbor_:function(v,h,u){u===void 0&&(u=!1);var d=Ke(v,"images","resizeNearestNeighbor");we(d.rank===3||d.rank===4,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+d.rank+"."}),we(h.length===2,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+h+"."}),we(d.dtype==="float32"||d.dtype==="int32",function(){return"`images` must have `int32` or `float32` as dtype"});var y=d,D=!1;d.rank===3&&(D=!0,y=d.as4D(1,d.shape[0],d.shape[1],d.shape[2]));var W=h[0],X=h[1],ae=Ve.runKernelFunc(function(de,be){return be([y]),de.resizeNearestNeighbor(y,W,X,u)},{batchImages:y},function(de,be){return{batchImages:function(){return Ve.runKernelFunc(function(Ie){return Ie.resizeNearestNeighborBackprop(de,be[0],u)},{})}}});return D?ae.as3D(ae.shape[1],ae.shape[2],ae.shape[3]):ae}}),sm=xt({nonMaxSuppression_:function(v,h,u,d,y){d===void 0&&(d=.5),y===void 0&&(y=Number.NEGATIVE_INFINITY);var D=Ke(v,"boxes","nonMaxSuppression"),W=Ke(h,"scores","nonMaxSuppression"),X=qo(D,W,u,d,y);u=X.maxOutputSize,d=X.iouThreshold,y=X.scoreThreshold;var ae={maxOutputSize:u,iouThreshold:d,scoreThreshold:y};return Ve.runKernelFunc(function(de){return de.nonMaxSuppression(D,W,u,d,y)},{boxes:D,scores:W},null,"NonMaxSuppressionV3",ae)}}),yp=xt({nonMaxSuppressionWithScore_:function(v,h,u,d,y,D){d===void 0&&(d=.5),y===void 0&&(y=Number.NEGATIVE_INFINITY),D===void 0&&(D=0);var W=Ke(v,"boxes","nonMaxSuppression"),X=Ke(h,"scores","nonMaxSuppression"),ae=qo(W,X,u,d,y,D),de={maxOutputSize:u=ae.maxOutputSize,iouThreshold:d=ae.iouThreshold,scoreThreshold:y=ae.scoreThreshold,softNmsSigma:D=ae.softNmsSigma},be=Ve.runKernel("NonMaxSuppressionV5",{boxes:W,scores:X},de);return{selectedIndices:be[0],selectedScores:be[1]}}}),Xm=xt({cropAndResize_:function(v,h,u,d,y,D){var W=Ke(v,"image","cropAndResize"),X=Ke(h,"boxes","cropAndResize","float32"),ae=Ke(u,"boxInd","cropAndResize","int32");y=y||"bilinear",D=D||0;var de=X.shape[0];return we(W.rank===4,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+W.rank+"."}),we(X.rank===2&&X.shape[1]===4,function(){return"Error in cropAndResize: boxes must be have size ["+de+",4] but had shape "+X.shape+"."}),we(ae.rank===1&&ae.shape[0]===de,function(){return"Error in cropAndResize: boxInd must be have size ["+de+"] but had shape "+X.shape+"."}),we(d.length===2,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+d.length+"."}),we(d[0]>=1&&d[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+d}),we(y==="bilinear"||y==="nearest",function(){return"method must be bilinear or nearest, but was "+y}),Ve.runKernelFunc(function(be,Ie){return be.cropAndResize(W,X,ae,d,y,D)},{images:W,boxes:X,boxInd:ae},null,"CropAndResize",{method:y,extrapolationValue:D,cropSize:d})}}),Ym=Object.freeze({resizeBilinear:vp,resizeNearestNeighbor:nh,nonMaxSuppression:sm,nonMaxSuppressionAsync:function(v,h,u,d,y){return d===void 0&&(d=.5),y===void 0&&(y=Number.NEGATIVE_INFINITY),R(this,void 0,void 0,function(){var D,W,X,ae,de,be,Ie;return P(this,function(Re){switch(Re.label){case 0:return D=Ke(v,"boxes","nonMaxSuppressionAsync"),W=Ke(h,"scores","nonMaxSuppressionAsync"),X=qo(D,W,u,d,y),u=X.maxOutputSize,d=X.iouThreshold,y=X.scoreThreshold,[4,Promise.all([D.data(),W.data()])];case 1:return ae=Re.sent(),de=ae[0],be=ae[1],Ie=Ou(de,be,u,d,y),D!==v&&D.dispose(),W!==h&&W.dispose(),[2,Ie]}})})},nonMaxSuppressionWithScore:yp,nonMaxSuppressionWithScoreAsync:function(v,h,u,d,y,D){return d===void 0&&(d=.5),y===void 0&&(y=Number.NEGATIVE_INFINITY),D===void 0&&(D=0),R(this,void 0,void 0,function(){var W,X,ae,de,be,Ie,Re;return P(this,function(Me){switch(Me.label){case 0:return W=Ke(v,"boxes","nonMaxSuppressionAsync"),X=Ke(h,"scores","nonMaxSuppressionAsync"),ae=qo(W,X,u,d,y,D),u=ae.maxOutputSize,d=ae.iouThreshold,y=ae.scoreThreshold,D=ae.softNmsSigma,[4,Promise.all([W.data(),X.data()])];case 1:return de=Me.sent(),be=de[0],Ie=de[1],Re=Au(be,Ie,u,d,y,D),W!==v&&W.dispose(),X!==h&&X.dispose(),[2,Re]}})})},cropAndResize:Xm}),ef=function(v,h){return!(v>0)||h==="linear"},$u=function(v,h,u){if(u==null||u==="linear")return v;if(u==="relu")return v.mul(h.step());throw new Error("Gradient for activation "+u+" has not been implemented yet.")},tv=function(v,h){var u=h,d=bo(v.shape,h.shape);return d.length>0&&(u=u.sum(d)),u.reshape(v.shape)},nv=function(v,h,u){if(h==="linear")return v;if(h==="relu")return Qp(v);if(h==="elu")return pc(v);if(h==="relu6")return Hm(v);if(h==="prelu")return lp(v,u);throw new Error("Unknown fused activation "+h+".")},ad=xt({fusedMatMul_:function(v){var h,u=v.a,d=v.b,y=v.transposeA,D=y!==void 0&&y,W=v.transposeB,X=W!==void 0&&W,ae=v.bias,de=v.activation,be=de===void 0?"linear":de,Ie=v.preluActivationWeights;if(ef(Ve.state.gradientDepth,be)===!1){var Re=jg(u,d,D,X);return ae!=null&&(Re=Xh(Re,ae)),nv(Re,be,Ie)}var Me=Ke(u,"a","fused matMul"),qe=Ke(d,"b","fused matMul");h=An(Me,qe),Me=h[0],qe=h[1];var Je=D?Me.shape[Me.rank-2]:Me.shape[Me.rank-1],Qe=X?qe.shape[qe.rank-1]:qe.shape[qe.rank-2],ot=D?Me.shape[Me.rank-1]:Me.shape[Me.rank-2],vt=X?qe.shape[qe.rank-2]:qe.shape[qe.rank-1],bt=Me.shape.slice(0,-2),wt=qe.shape.slice(0,-2),Ft=Ye(bt),Yt=Ye(wt);we(Me.rank>=2&&qe.rank>=2&&Me.rank===qe.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+Me.rank+" and "+qe.rank+"."}),we(ln(bt,wt),function(){return"Error in fused matMul: outer dimensions ("+bt+") and ("+wt+") of Tensors with shapes "+Me.shape+" and "+qe.shape+" must match."}),we(Je===Qe,function(){return"Error in fused matMul: inner shapes ("+Je+") and ("+Qe+") of Tensors with shapes "+Me.shape+" and "+qe.shape+" and transposeA="+D+" and transposeB="+X+" must match."});var an,Jt,un=Me.shape.slice(0,-2).concat([ot,vt]),gn=D?Me.as3D(Ft,Je,ot):Me.as3D(Ft,ot,Je),p=X?qe.as3D(Yt,vt,Qe):qe.as3D(Yt,Qe,vt);ae!=null&&Hi(un,(an=An(an=Ke(ae,"bias","fused matMul"),Me)[0]).shape),Ie!=null&&(Jt=Ke(Ie,"prelu weights","fused matMul"));var c={a:gn,b:p};ae!=null&&(c.bias=an),Ie!=null&&(c.preluActivationWeights=Jt);var a=[gn,p];return Ve.runKernelFunc(function(l,g){var _=l.fusedBatchMatMul({a:gn,b:p,transposeA:D,transposeB:X,bias:an,activation:be,preluActivationWeights:Jt});return g([gn,p,_]),_},c,function(l,g){var _=g[0],j=g[1],V=g[2],ne=$u(l,V,be),oe={};return ae!=null&&(oe={bias:function(){return tv(an,ne)}}),Object.assign(D||X?!D&&X?{a:function(){return ne.matMul(j,!1,!1)},b:function(){return ne.matMul(_,!0,!1)}}:D&&!X?{a:function(){return j.matMul(ne,!1,!0)},b:function(){return _.matMul(ne,!1,!1)}}:{a:function(){return j.matMul(ne,!0,!0)},b:function(){return ne.matMul(_,!0,!0)}}:{a:function(){return ne.matMul(j,!1,!0)},b:function(){return _.matMul(ne,!0,!1)}},oe)},"_FusedMatMul",{transposeA:D,transposeB:X,activation:be},a,[!0]).reshape(un)}}),bp=xt({fusedConv2d_:function(v){var h=v.x,u=v.filter,d=v.strides,y=v.pad,D=v.dataFormat,W=D===void 0?"NHWC":D,X=v.dilations,ae=X===void 0?[1,1]:X,de=v.dimRoundingMode,be=v.bias,Ie=v.activation,Re=Ie===void 0?"linear":Ie,Me=v.preluActivationWeights;if(Re=Re||"linear",ef(Ve.state.gradientDepth,Re)===!1){var qe=Zh(h,u,d,y,W,ae,de);return be!=null&&(qe=Xh(qe,be)),nv(qe,Re,Me)}var Je=Ke(h,"x","conv2d"),Qe=Ke(u,"filter","conv2d"),ot=Je,vt=!1;Je.rank===3&&(vt=!0,ot=Je.as4D(1,Je.shape[0],Je.shape[1],Je.shape[2])),we(ot.rank===4,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+ot.rank+"."}),we(Qe.rank===4,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+Qe.rank+"."}),de!=null&&we(Zt(y),function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+de+" but got pad "+y+"."}),we(ot.shape[3]===Qe.shape[2],function(){return"Error in conv2d: depth of input ("+ot.shape[3]+") must match input depth for filter "+Qe.shape[2]+"."}),we(ls(d,ae),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+d+" and dilations '"+ae+"'"}),we(W==="NHWC",function(){return"Error in conv2d: got dataFormat of "+W+" but only NHWC is currently supported."});var bt,wt,Ft=Vs(ot.shape,Qe.shape,d,ae,y,de);be!=null&&(bt=An(bt=Ke(be,"bias","fused conv2d"),Je)[0],Hi(Ft.outShape,bt.shape)),Me!=null&&(wt=Ke(Me,"prelu weights","fused conv2d"));var Yt={x:ot,filter:Qe};be!=null&&(Yt.bias=bt),Me!=null&&(Yt.preluActivationWeights=wt);var an=[Qe,ot],Jt=Ve.runKernelFunc(function(un,gn){var p=un.fusedConv2d({input:ot,filter:Qe,convInfo:Ft,bias:bt,activation:Re,preluActivationWeights:wt});return gn([Qe,ot,p]),p},Yt,function(un,gn){var p=gn,c=p[0],a=p[1],l=p[2],g=$u(un,l,Re);we(_o(ae),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+ae+"'"});var _={};return be!=null&&(_={bias:function(){return tv(bt,g)}}),Object.assign({x:function(){return Lm(a.shape,g,c,d,y)},filter:function(){return Pm(a,g,c.shape,d,y)}},_)},"FusedConv2D",{convInfo:Ft,activation:Re},an,[!0]);return vt?Jt.as3D(Jt.shape[1],Jt.shape[2],Jt.shape[3]):Jt}}),zv=xt({fusedDepthwiseConv2d_:function(v){var h=v.x,u=v.filter,d=v.strides,y=v.pad,D=v.dataFormat,W=D===void 0?"NHWC":D,X=v.dilations,ae=X===void 0?[1,1]:X,de=v.dimRoundingMode,be=v.bias,Ie=v.activation,Re=Ie===void 0?"linear":Ie,Me=v.preluActivationWeights;if(ef(Ve.state.gradientDepth,Re)===!1){var qe=sp(h,u,d,y,W,ae,de);return be!=null&&(qe=Xh(qe,be)),nv(qe,Re,Me)}var Je=Ke(h,"x","depthwiseConv2d"),Qe=Ke(u,"filter","depthwiseConv2d"),ot=Je,vt=!1;Je.rank===3&&(vt=!0,ot=Je.as4D(1,Je.shape[0],Je.shape[1],Je.shape[2])),we(ot.rank===4,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+ot.rank+"."}),we(Qe.rank===4,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+Qe.rank+"."}),we(ot.shape[3]===Qe.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels ("+ot.shape[3]+") must match the inChannels dimension in filter "+Qe.shape[2]+"."}),ae==null&&(ae=[1,1]),we(ls(d,ae),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+d+" and dilations '"+ae+"'"}),de!=null&&we(Zt(y),function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+de+" but got pad "+y+"."});var bt,wt,Ft=Vs(ot.shape,Qe.shape,d,ae,y,de,!0);be!=null&&(bt=An(bt=Ke(be,"bias","fused conv2d"),Je)[0],Hi(Ft.outShape,bt.shape)),Me!=null&&(wt=Ke(Me,"prelu weights","fused depthwiseConv2d"));var Yt={x:ot,filter:Qe};be!=null&&(Yt.bias=bt),Me!=null&&(Yt.preluActivationWeights=wt);var an=[Qe,ot],Jt=Ve.runKernelFunc(function(un,gn){var p=un.fusedDepthwiseConv2D({input:ot,filter:Qe,convInfo:Ft,bias:bt,activation:Re,preluActivationWeights:wt});return gn([Qe,ot,p]),p},Yt,function(un,gn){we(_o(ae),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+ae+"'"});var p=gn[0],c=gn[1],a=gn[2],l=$u(un,a,Re),g={};return be!=null&&(g={bias:function(){return tv(bt,l)}}),Object.assign({x:function(){return zm(c.shape,l,p,Ft)},filter:function(){return Xp(c,l,p.shape,Ft)}},g)},"FusedDepthwiseConv2D",{convInfo:Ft,activation:Re},an,[!0]);return vt?Jt.as3D(Jt.shape[1],Jt.shape[2],Jt.shape[3]):Jt}}),Jm=Object.freeze({matMul:ad,conv2d:bp,depthwiseConv2d:zv}),um=Object.freeze({image:Ym,linalg:om,losses:im,spectral:nm,fused:Jm,signal:Km,square:Dm,squaredDifference:zf,conv1d:Gp,conv2d:Zh,conv3d:Kp,depthwiseConv2d:sp,separableConv2d:Mg,conv2dTranspose:sl,conv3dTranspose:Mv,op:xt,batchNormalization2d:Ig,batchNormalization3d:np,batchNormalization4d:Rm,batchNormalization:k0,batchNorm:Iv,batchNorm2d:Vl,batchNorm3d:Kh,batchNorm4d:Wf,booleanMaskAsync:Hp,complex:fa,real:uo,imag:Uo,concat:Ba,concat1d:Fh,concat2d:Pd,concat3d:Al,concat4d:Rh,split:Ri,matMul:jg,dot:up,outerProduct:Bg,reverse:Xl,reverse1d:Pg,reverse2d:cp,reverse3d:Yp,reverse4d:Lg,maxPool:Ug,avgPool:Wg,pool:Jf,maxPool3d:jv,avgPool3d:Vg,slice:ul,slice1d:Wm,slice2d:qg,slice3d:Qf,slice4d:cl,abs:Dc,acos:Tm,acosh:Nm,asin:_u,asinh:Im,atan:Hh,atanh:Qd,ceil:Nv,clipByValue:Zd,cos:Tc,cosh:ep,erf:Cg,exp:Og,expm1:Fm,floor:b0,log:x0,log1p:sa,logSigmoid:Ag,neg:_g,reciprocal:Bp,round:Sg,rsqrt:tp,sigmoid:nl,sign:rl,isNaN:Dg,isInf:Tg,isFinite:$h,sin:Uf,sinh:Gh,softplus:w0,sqrt:Pp,step:il,tan:Su,tanh:zl,all:Vm,any:dc,argMax:qm,argMin:Hg,logSumExp:Yl,max:Bv,mean:ed,min:td,moments:Jl,sum:$g,prod:Zf,equal:fc,equalStrict:Nu,greater:hu,greaterEqual:Qh,greaterEqualStrict:Wp,greaterStrict:jm,less:Bm,lessEqual:ip,lessEqualStrict:Fa,lessStrict:ap,notEqual:hc,notEqualStrict:Xf,add:Xh,addN:Fv,addStrict:Rv,atan2:zp,div:Hl,divNoNan:al,divStrict:rp,floorDiv:Yh,maximum:Hf,maximumStrict:$l,minimum:Gl,minimumStrict:Tu,mod:Jh,modStrict:$f,mul:ol,mulStrict:Nc,pow:Gf,powStrict:Up,squaredDifferenceStrict:Kf,sub:Ic,subStrict:ts,elu:pc,leakyRelu:nd,prelu:lp,relu:Qp,relu6:Hm,selu:Gg,logicalAnd:Vf,logicalNot:Fg,logicalOr:Mm,logicalXor:qf,where:ta,whereAsync:ql,buffer:Ni,print:_f,batchToSpaceND:Gc,broadcastTo:_l,cast:Wd,clone:Mp,cumsum:Sl,depthToSpace:jh,expandDims:Pa,eye:Bh,multinomial:Dl,oneHot:Ph,pad:Tl,pad1d:Kc,pad2d:Ec,pad3d:Lh,pad4d:Sf,rand:Nl,randomNormal:Cc,randomGamma:km,randomUniform:Il,reshape:eo,spaceToBatchND:Ao,squeeze:Fo,stack:Mi,tile:Es,truncatedNormal:Oc,unstack:Ro,setdiff1dAsync:Ac,fill:ws,linspace:Ih,ones:uu,range:ac,scalar:fr,tensor:wa,tensor1d:zs,tensor2d:eu,tensor3d:Hc,tensor4d:Us,tensor5d:Nh,tensor6d:jd,variable:Bd,zeros:Ki,onesLike:us,zerosLike:ii,transpose:ns,softmax:Os,logSoftmax:na,localResponseNormalization:Kg,norm:rd,gather:Vp,unsortedSegmentSum:qp,basicLSTMCell:Xg,multiRNNCell:Zp,movingAverage:Ql,stridedSlice:fp,topk:ll,scatterND:Yg,fft:em,ifft:tm,rfft:$m,irfft:Fc,sparseToDense:Jg,gatherND:fl,diag:hp,dropout:eh,hannWindow:rm,hammingWindow:Gm,frame:pp,stft:mp,inTopKAsync:Qg});function Ir(v,h){Array.isArray(v)||(v=[v]),v.forEach(function(u){u!=null&&we(u.dtype!=="complex64",function(){return h+" does not support complex64 tensors."})})}function I(v,h,u,d){if(u==="linear")return v.linear(h);if(u==="relu")return v.relu(h);if(u==="elu")return v.elu(h);if(u==="relu6")return v.relu6(h);if(u==="prelu")return v.prelu(h,d);throw new Error("Activation "+u+" has not been implemented for the CPU backend.")}var E=function(v){function h(){var u=v.call(this)||this;return u.blockSize=48,u.firstUse=!0,u.data=new Bl(u,Ve),u}return J(h,v),h.prototype.write=function(u,d,y){this.firstUse&&(this.firstUse=!1,L().get("IS_NODE")&&qc(`
============================
Hi there . Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.
============================`));var D={};return this.data.set(D,{values:u,dtype:y}),D},h.prototype.move=function(u,d,y,D){this.data.set(u,{values:d,dtype:D})},h.prototype.numDataIds=function(){return this.data.numDataIds()},h.prototype.read=function(u){return R(this,void 0,void 0,function(){return P(this,function(d){return[2,this.readSync(u)]})})},h.prototype.readSync=function(u){var d=this.data.get(u),y=d.dtype,D=d.complexTensors;return y==="complex64"?Cu(this.readSync(D.real.dataId),this.readSync(D.imag.dataId)):this.data.get(u).values},h.prototype.bufferSync=function(u){var d=this.readSync(u.dataId),y=d;if(u.dtype==="string")try{y=d.map(function(D){return mr(D)})}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Ni(u.shape,u.dtype,y)},h.prototype.makeOutput=function(u,d,y){var D=this.write(u,d,y);return Ve.makeTensorFromDataId(D,d,y,this)},h.prototype.disposeData=function(u){if(this.data.has(u)){var d=this.data.get(u).complexTensors;d!=null&&(d.real.dispose(),d.imag.dispose()),this.data.delete(u)}},h.prototype.time=function(u){return R(this,void 0,void 0,function(){var d;return P(this,function(y){return d=nn(),u(),[2,{kernelMs:nn()-d}]})})},h.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},h.prototype.complex=function(u,d){var y=this.makeOutput(null,u.shape,"complex64");return this.data.get(y.dataId).complexTensors={real:Ve.keep(u.clone()),imag:Ve.keep(d.clone())},y},h.prototype.real=function(u){return this.data.get(u.dataId).complexTensors.real.clone()},h.prototype.imag=function(u){return this.data.get(u.dataId).complexTensors.imag.clone()},h.prototype.slice=function(u,d,y){if(Ir(u,"slice"),If(u.shape,d,y)){var D=Uh(d,u.strides),W=Ye(y);return wa(this.readSync(u.dataId).subarray(D,D+W),y,u.dtype)}for(var X=Ni(y,u.dtype),ae=this.bufferSync(u),de=0;de<X.size;++de){var be=X.indexToLoc(de).map(function(Ie,Re){return Ie+d[Re]});X.values[de]=ae.get.apply(ae,be)}return X.toTensor()},h.prototype.stridedSlice=function(u,d,y,D){Ir(u,"stridedSlice");var W=Rl(d,y,D);if(W.some(function(Me){return Me===0}))return wa([],W);for(var X=Ni(W,u.dtype),ae=this.bufferSync(u),de=0;de<X.size;de++){for(var be=X.indexToLoc(de),Ie=new Array(be.length),Re=0;Re<Ie.length;Re++)Ie[Re]=be[Re]*D[Re]+d[Re];X.set.apply(X,[ae.get.apply(ae,Ie)].concat(be))}return X.toTensor()},h.prototype.diag=function(u){for(var d=this.readSync(u.dataId),y=Ni([u.size,u.size],u.dtype),D=y.values,W=0;W<d.length;W++)D[W*u.size+W]=d[W];return y.toTensor()},h.prototype.unstack=function(u,d){for(var y=u.shape[d],D=new Array(u.rank-1),W=0,X=0;X<u.rank;X++)X!==d&&(D[W++]=u.shape[X]);var ae=new Array(u.rank).fill(0),de=u.shape.slice();de[d]=1;var be=new Array(y);for(X=0;X<be.length;X++)ae[d]=X,be[X]=this.slice(u,ae,de).reshape(D);return be},h.prototype.reverse=function(u,d){Ir(u,"reverse");for(var y=Ni(u.shape,u.dtype),D=this.bufferSync(u),W=function(ae){var de=y.indexToLoc(ae),be=de.slice();d.forEach(function(Ie){return be[Ie]=u.shape[Ie]-1-be[Ie]}),y.set.apply(y,[D.get.apply(D,be)].concat(de))},X=0;X<y.size;X++)W(X);return y.toTensor()},h.prototype.concat=function(u,d){var y=this;if(u[0].dtype==="complex64"){var D=u.map(function(Me){return uo(Me)}),W=u.map(function(Me){return Uo(Me)});return fa(this.concat(D,d),this.concat(W,d))}var X=u.map(function(Me){var qe=Ye(Me.shape.slice(d));return Me.as2D(-1,qe)}),ae=Zs(X.map(function(Me){return Me.shape}),1),de=Ni(ae,u[0].dtype).values;if(X[0].shape[0]===1){var be=0;X.forEach(function(Me){de.set(y.readSync(Me.dataId),be),be+=Me.size})}else{var Ie=0;X.forEach(function(Me){for(var qe=y.readSync(Me.dataId),Je=0,Qe=0;Qe<Me.shape[0];++Qe)for(var ot=Qe*ae[1]+Ie,vt=0;vt<Me.shape[1];++vt)de[ot+vt]=qe[Je++];Ie+=Me.shape[1]})}var Re=Zs(u.map(function(Me){return Me.shape}),d);return wa(de,Re,u[0].dtype)},h.prototype.neg=function(u){return Ir(u,"neg"),this.multiply(fr(-1),u)},h.prototype.add=function(u,d){return u.dtype==="complex64"||d.dtype==="complex64"?this.broadcastedBinaryComplexOp(u.cast("complex64"),d.cast("complex64"),function(y,D,W,X){return{real:y+W,imag:D+X}}):this.broadcastedBinaryOp(u,d,cn(u.dtype,d.dtype),function(y,D){return y+D})},h.prototype.addN=function(u){var d=this;Ir(u,"addN");for(var y=u.map(function(be){return d.readSync(be.dataId)}),D=Ni(u[0].shape,u[0].dtype),W=D.values,X=0;X<u.length;X++)for(var ae=y[X],de=0;de<W.length;de++)W[de]+=ae[de];return D.toTensor()},h.prototype.softmax=function(u,d){var y=xn([d],u.shape),D=this.max(u,y),W=_a(D.shape,y),X=this.subtract(u,D.reshape(W)),ae=this.exp(X),de=this.sum(ae,y).reshape(W);return this.realDivide(ae,de)},h.prototype.subtract=function(u,d){return u.dtype==="complex64"||d.dtype==="complex64"?this.broadcastedBinaryComplexOp(u.cast("complex64"),d.cast("complex64"),function(y,D,W,X){return{real:y-W,imag:D-X}}):this.broadcastedBinaryOp(u,d,cn(u.dtype,d.dtype),function(y,D){return y-D})},h.prototype.pow=function(u,d){return Ir([u,d],"pow"),this.broadcastedBinaryOp(u,d,u.dtype,function(y,D){return Math.pow(y,D)})},h.prototype.batchMatMul=function(u,d,y,D){Ir([u,d],"matMul");for(var W=y?u.shape[1]:u.shape[2],X=y?u.shape[2]:u.shape[1],ae=D?d.shape[1]:d.shape[2],de=u.shape[0],be=this.readSync(u.dataId),Ie=this.readSync(d.dataId),Re=y?[u.strides[0],1,u.strides[1]]:[u.strides[0],u.strides[1],1],Me=Re[0],qe=Re[1],Je=Re[2],Qe=D?[1,d.strides[1],d.strides[0]]:[d.strides[1],1,d.strides[0]],ot=Qe[0],vt=Qe[1],bt=Qe[2],wt=X*ae,Ft=Ni([de,X,ae],u.dtype),Yt=Ft.values,an=this.blockSize,Jt=0;Jt<de;Jt++)for(var un=0;un<X;un+=an)for(var gn=0;gn<ae;gn+=an)for(var p=0;p<W;p+=an)for(var c=Math.min(un+an,X),a=Math.min(gn+an,ae),l=Math.min(p+an,W),g=un;g<c;g++)for(var _=gn;_<a;_++){for(var j=0,V=p;V<l;V++)j+=be[Jt*Me+g*qe+V*Je]*Ie[V*ot+_*vt+Jt*bt];Yt[Jt*wt+(g*ae+_)]+=j}return Ft.toTensor()},h.prototype.fusedBatchMatMul=function(u){var d=u.a,y=u.b,D=u.transposeA,W=u.transposeB,X=u.bias,ae=u.activation,de=u.preluActivationWeights,be=this.batchMatMul(d,y,D,W);return X&&(be=this.add(be,X)),ae&&(be=I(this,be,ae,de)),be},h.prototype.multiply=function(u,d){return u.dtype==="complex64"||d.dtype==="complex64"?this.broadcastedBinaryComplexOp(u.cast("complex64"),d.cast("complex64"),function(y,D,W,X){return{real:y*W-D*X,imag:y*X+D*W}}):this.broadcastedBinaryOp(u,d,cn(u.dtype,d.dtype),function(y,D){return y*D})},h.prototype.realDivide=function(u,d){return Ir([u,d],"realDivide"),this.broadcastedBinaryOp(u,d,"float32",function(y,D){return y/D})},h.prototype.floorDiv=function(u,d){return Ir([u,d],"floorDiv"),this.broadcastedBinaryOp(u,d,"int32",function(y,D){return Math.floor(y/D)})},h.prototype.sum=function(u,d){Ir(u,"sum"),Ga("sum",d,u.rank);for(var y=Aa(u.shape,d),D=y[0],W=y[1],X=Ki(D,cn(u.dtype,"int32")),ae=Ye(W),de=this.readSync(X.dataId),be=this.readSync(u.dataId),Ie=0;Ie<de.length;++Ie){for(var Re=Ie*ae,Me=0,qe=0;qe<ae;++qe)Me+=be[Re+qe];de[Ie]=Me}return X},h.prototype.prod=function(u,d){Ir(u,"sum");for(var y=Aa(u.shape,d),D=y[0],W=y[1],X=Ki(D,cn(u.dtype,"int32")),ae=Ye(W),de=this.readSync(X.dataId),be=this.readSync(u.dataId),Ie=0;Ie<de.length;++Ie){for(var Re=Ie*ae,Me=1,qe=0;qe<ae;++qe)Me*=be[Re+qe];de[Ie]=Me}return X},h.prototype.unsortedSegmentSum=function(u,d,y){Ir(u,"unsortedSegmentSum");for(var D=[],W=u.rank-d.rank,X=0;X<W;++X)d=d.expandDims(X+1);for(X=0;X<y;++X){var ae=fr(X,"int32"),de=fc(ae,d).asType("float32").mul(u).sum(0);D.push(de)}return Mi(D)},h.prototype.argMin=function(u,d){Ir(u,"argMin");var y=[d];Ga("argMin",y,u.rank);for(var D=Aa(u.shape,y),W=D[0],X=D[1],ae=Ki(W,"int32"),de=Ye(X),be=this.readSync(ae.dataId),Ie=this.readSync(u.dataId),Re=0;Re<be.length;++Re){for(var Me=Re*de,qe=Ie[Me],Je=0,Qe=0;Qe<de;++Qe){var ot=Ie[Me+Qe];ot<qe&&(qe=ot,Je=Qe)}be[Re]=Je}return ae},h.prototype.argMax=function(u,d){Ir(u,"argMax");var y=[d];Ga("argMax",y,u.rank);for(var D=Aa(u.shape,y),W=D[0],X=D[1],ae=Ki(W,"int32"),de=Ye(X),be=this.readSync(ae.dataId),Ie=this.readSync(u.dataId),Re=0;Re<be.length;++Re){for(var Me=Re*de,qe=Ie[Me],Je=0,Qe=0;Qe<de;++Qe){var ot=Ie[Me+Qe];ot>qe&&(qe=ot,Je=Qe)}be[Re]=Je}return ae},h.prototype.cumsum=function(u,d,y,D){if(Ir(u,"cumsum"),d!==u.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(u.rank-1)+" but got axis="+d);for(var W=cn(u.dtype,"int32"),X=Ki(u.shape,W),ae=this.readSync(X.dataId),de=this.readSync(u.dataId),be=u.shape[u.rank-1],Ie=D?function(Qe,ot){return Qe+be-ot-1}:function(Qe,ot){return Qe+ot},Re=0;Re<de.length;Re+=be)for(var Me=0;Me<be;Me++){var qe=Ie(Re,Me);if(Me===0)ae[qe]=y?0:de[qe];else{var Je=Ie(Re,Me-1);ae[qe]=y?de[Je]+ae[Je]:de[qe]+ae[Je]}}return X},h.prototype.equal=function(u,d){return Ir([u,d],"equal"),this.broadcastedBinaryOp(u,d,"bool",function(y,D){return y===D?1:0})},h.prototype.notEqual=function(u,d){return Ir([u,d],"notEqual"),this.broadcastedBinaryOp(u,d,"bool",function(y,D){return y!==D?1:0})},h.prototype.less=function(u,d){return Ir([u,d],"less"),this.broadcastedBinaryOp(u,d,"bool",function(y,D){return y<D?1:0})},h.prototype.lessEqual=function(u,d){return Ir([u,d],"lessEqual"),this.broadcastedBinaryOp(u,d,"bool",function(y,D){return y<=D?1:0})},h.prototype.greater=function(u,d){return Ir([u,d],"greater"),this.broadcastedBinaryOp(u,d,"bool",function(y,D){return y>D?1:0})},h.prototype.greaterEqual=function(u,d){return Ir([u,d],"greaterEqual"),this.broadcastedBinaryOp(u,d,"bool",function(y,D){return y>=D?1:0})},h.prototype.logicalNot=function(u){Ir(u,"logicalNot");for(var d=this.readSync(u.dataId),y=new Uint8Array(d.length),D=0;D<d.length;++D)y[D]=d[D]?0:1;return this.makeOutput(y,u.shape,"bool")},h.prototype.logicalAnd=function(u,d){return Ir([u,d],"logicalAnd"),this.broadcastedBinaryOp(u,d,"bool",function(y,D){return y&&D})},h.prototype.logicalOr=function(u,d){return Ir([u,d],"logicalOr"),this.broadcastedBinaryOp(u,d,"bool",function(y,D){return y||D})},h.prototype.select=function(u,d,y){Ir([u,d,y],"select");for(var D=this.readSync(u.dataId),W=this.readSync(d.dataId),X=this.readSync(y.dataId),ae=Ki(d.shape,cn(d.dtype,y.dtype)),de=this.readSync(ae.dataId),be=0,Ie=u.rank===0||u.rank>1||d.rank===1?1:Ye(d.shape.slice(1)),Re=0;Re<D.length;Re++)for(var Me=0;Me<Ie;Me++)D[Re]===1?de[be++]=W[Re]:de[be++]=X[Re];return ae},h.prototype.where=function(u){Ir([u],"where");var d=this.readSync(u.dataId);return G(u.shape,d)},h.prototype.topk=function(u,d,y){return Ir(u,"topk"),Z(this.readSync(u.dataId),u.shape,u.dtype,d)},h.prototype.min=function(u,d){Ir(u,"min"),Ga("min",d,u.rank);for(var y=Aa(u.shape,d),D=y[0],W=y[1],X=Ki(D,u.dtype),ae=Ye(W),de=this.readSync(X.dataId),be=this.readSync(u.dataId),Ie=0;Ie<de.length;++Ie){for(var Re=Ie*ae,Me=be[Re],qe=0;qe<ae;++qe){var Je=be[Re+qe];Je<Me&&(Me=Je)}de[Ie]=Me}return X},h.prototype.minimum=function(u,d){return Ir([u,d],"minimum"),this.broadcastedBinaryOp(u,d,u.dtype,function(y,D){return Math.min(y,D)})},h.prototype.mod=function(u,d){return Ir([u,d],"mod"),this.broadcastedBinaryOp(u,d,u.dtype,function(y,D){var W=y%D;return y<0&&D<0||y>=0&&D>=0?W:(W+D)%D})},h.prototype.max=function(u,d){Ir(u,"max"),Ga("max",d,u.rank);for(var y=Aa(u.shape,d),D=y[0],W=y[1],X=Ki(D,u.dtype),ae=Ye(W),de=this.readSync(X.dataId),be=this.readSync(u.dataId),Ie=0;Ie<de.length;++Ie){for(var Re=Ie*ae,Me=be[Re],qe=0;qe<ae;++qe){var Je=be[Re+qe];Je>Me&&(Me=Je)}de[Ie]=Me}return X},h.prototype.maximum=function(u,d){return Ir([u,d],"maximum"),this.broadcastedBinaryOp(u,d,u.dtype,function(y,D){return Math.max(y,D)})},h.prototype.all=function(u,d){Ir(u,"all"),Ga("all",d,u.rank);for(var y=Aa(u.shape,d),D=y[0],W=y[1],X=Ki(D,u.dtype),ae=Ye(W),de=this.readSync(X.dataId),be=this.readSync(u.dataId),Ie=0;Ie<de.length;++Ie){for(var Re=Ie*ae,Me=be[Re],qe=0;qe<ae;++qe){var Je=be[Re+qe];Me=Me&&Je}de[Ie]=Me}return X},h.prototype.any=function(u,d){Ir(u,"any"),Ga("any",d,u.rank);for(var y=Aa(u.shape,d),D=y[0],W=y[1],X=Ki(D,u.dtype),ae=Ye(W),de=this.readSync(X.dataId),be=this.readSync(u.dataId),Ie=0;Ie<de.length;++Ie){for(var Re=Ie*ae,Me=be[Re],qe=0;qe<ae;++qe){var Je=be[Re+qe];Me=Me||Je}de[Ie]=Me}return X},h.prototype.squaredDifference=function(u,d){return Ir([u,d],"squaredDifference"),this.broadcastedBinaryOp(u,d,u.dtype,function(y,D){var W=y-D;return W*W})},h.prototype.ceil=function(u){Ir(u,"ceil");for(var d=this.readSync(u.dataId),y=new Float32Array(d.length),D=0;D<d.length;++D)y[D]=Math.ceil(d[D]);return this.makeOutput(y,u.shape,"float32")},h.prototype.floor=function(u){Ir(u,"floor");for(var d=this.readSync(u.dataId),y=new Float32Array(d.length),D=0;D<d.length;++D)y[D]=Math.floor(d[D]);return this.makeOutput(y,u.shape,"float32")},h.prototype.sign=function(u){Ir(u,"x");for(var d=this.readSync(u.dataId),y=new Float32Array(d.length),D=0;D<d.length;++D)d[D]<0?y[D]=-1:d[D]>0?y[D]=1:y[D]=0;return this.makeOutput(y,u.shape,"float32")},h.prototype.isNaN=function(u){Ir(u,"x");for(var d=this.readSync(u.dataId),y=new Uint8Array(d.length),D=0;D<d.length;++D)Number.isNaN(d[D])&&(y[D]=1);return this.makeOutput(y,u.shape,"bool")},h.prototype.isInf=function(u){Ir(u,"x");for(var d=this.readSync(u.dataId),y=new Uint8Array(d.length),D=0;D<d.length;++D)Math.abs(d[D])===1/0&&(y[D]=1);return this.makeOutput(y,u.shape,"bool")},h.prototype.isFinite=function(u){Ir(u,"x");for(var d=this.readSync(u.dataId),y=new Uint8Array(d.length),D=0;D<d.length;++D)Number.isFinite(d[D])&&(y[D]=1);return this.makeOutput(y,u.shape,"bool")},h.prototype.round=function(u){Ir(u,"round");for(var d=this.readSync(u.dataId),y=new Float32Array(d.length),D=0;D<d.length;++D){var W=Math.floor(d[D]);d[D]-W<.5?y[D]=Math.floor(d[D]):d[D]-W>.5?y[D]=Math.ceil(d[D]):y[D]=W%2==0?W:W+1}return this.makeOutput(y,u.shape,"float32")},h.prototype.exp=function(u){Ir(u,"exp");for(var d=this.readSync(u.dataId),y=new Float32Array(d.length),D=0;D<d.length;++D)y[D]=Math.exp(d[D]);return this.makeOutput(y,u.shape,"float32")},h.prototype.expm1=function(u){Ir(u,"expm1");for(var d=this.readSync(u.dataId),y=new Float32Array(d.length),D=0;D<d.length;++D)y[D]=Math.expm1(d[D]);return this.makeOutput(y,u.shape,"float32")},h.prototype.log=function(u){Ir(u,"log");for(var d=this.readSync(u.dataId),y=new Float32Array(d.length),D=0;D<d.length;++D){var W=d[D];y[D]=Math.log(W)}return this.makeOutput(y,u.shape,"float32")},h.prototype.log1p=function(u){Ir(u,"log1p");for(var d=this.readSync(u.dataId),y=new Float32Array(d.length),D=0;D<d.length;++D){var W=d[D];y[D]=Math.log1p(W)}return this.makeOutput(y,u.shape,"float32")},h.prototype.sqrt=function(u){Ir(u,"sqrt");for(var d=this.readSync(u.dataId),y=new Float32Array(d.length),D=0;D<d.length;++D){var W=d[D];y[D]=Math.sqrt(W)}return this.makeOutput(y,u.shape,"float32")},h.prototype.rsqrt=function(u){Ir(u,"rsqrt");for(var d=this.readSync(u.dataId),y=new Float32Array(d.length),D=0;D<d.length;++D){var W=d[D];y[D]=1/Math.sqrt(W)}return this.makeOutput(y,u.shape,"float32")},h.prototype.reciprocal=function(u){Ir(u,"reciprocal");for(var d=this.readSync(u.dataId),y=new Float32Array(d.length),D=0;D<d.length;++D)y[D]=1/d[D];return this.makeOutput(y,u.shape,"float32")},h.prototype.linear=function(u){return u},h.prototype.relu=function(u){Ir(u,"relu");for(var d=Ki(u.shape,u.dtype),y=this.readSync(d.dataId),D=this.readSync(u.dataId),W=0;W<D.length;++W)y[W]=Math.max(0,D[W]);return d},h.prototype.relu6=function(u){Ir(u,"relu");for(var d=Ki(u.shape,u.dtype),y=this.readSync(d.dataId),D=this.readSync(u.dataId),W=0;W<D.length;++W)y[W]=Math.min(Math.max(0,D[W]),6);return d},h.prototype.prelu=function(u,d){return Ir([u,d],"prelu"),this.broadcastedBinaryOp(u,d,u.dtype,function(y,D){return y<0?D*y:y})},h.prototype.elu=function(u){Ir(u,"elu");for(var d=new Float32Array(u.size),y=this.readSync(u.dataId),D=0;D<y.length;++D){var W=y[D];d[D]=W>=0?W:Math.exp(W)-1}return this.makeOutput(d,u.shape,"float32")},h.prototype.eluDer=function(u,d){Ir([u,d],"eluDer");for(var y=new Float32Array(d.size),D=this.readSync(d.dataId),W=this.readSync(u.dataId),X=0;X<D.length;++X){var ae=D[X];y[X]=ae>=1?W[X]:W[X]*(ae+1)}return this.makeOutput(y,d.shape,"float32")},h.prototype.selu=function(u){Ir(u,"selu");for(var d=new Float32Array(u.size),y=this.readSync(u.dataId),D=0;D<y.length;++D){var W=y[D];d[D]=W>=0?1.0507009873554805*W:1.7580993408473768*(Math.exp(W)-1)}return this.makeOutput(d,u.shape,"float32")},h.prototype.clip=function(u,d,y){Ir(u,"clip");for(var D=new Float32Array(u.size),W=this.readSync(u.dataId),X=0;X<W.length;++X){var ae=W[X];D[X]=ae>y?y:ae<d?d:ae}return this.makeOutput(D,u.shape,"float32")},h.prototype.abs=function(u){for(var d=new Float32Array(u.size),y=this.readSync(u.dataId),D=0;D<y.length;++D)d[D]=Math.abs(y[D]);return this.makeOutput(d,u.shape,"float32")},h.prototype.complexAbs=function(u){for(var d=new Float32Array(u.size),y=this.readSync(u.dataId),D=0;D<u.size;++D){var W=y[2*D],X=y[2*D+1];d[D]=Math.hypot(W,X)}return this.makeOutput(d,u.shape,"float32")},h.prototype.int=function(u){Ir(u,"int");for(var d=new Int32Array(u.size),y=this.readSync(u.dataId),D=0;D<y.length;++D)d[D]=y[D];return this.makeOutput(d,u.shape,"int32")},h.prototype.sigmoid=function(u){Ir(u,"sigmoid");for(var d=new Float32Array(u.size),y=this.readSync(u.dataId),D=0;D<y.length;++D)d[D]=1/(1+Math.exp(-y[D]));return this.makeOutput(d,u.shape,"float32")},h.prototype.softplus=function(u){Ir(u,"softplus");for(var d=Math.log(11920928955078125e-23)+2,y=new Float32Array(u.size),D=this.readSync(u.dataId),W=0;W<D.length;++W){var X,ae=D[W]>-d,de=D[W]<d,be=Math.exp(D[W]);X=de?be:ae?D[W]:Math.log(1+be),y[W]=X}return this.makeOutput(y,u.shape,"float32")},h.prototype.sin=function(u){Ir(u,"sin");for(var d=new Float32Array(u.size),y=this.readSync(u.dataId),D=0;D<y.length;++D)d[D]=Math.sin(y[D]);return this.makeOutput(d,u.shape,"float32")},h.prototype.cos=function(u){Ir(u,"cos");for(var d=new Float32Array(u.size),y=this.readSync(u.dataId),D=0;D<y.length;++D)d[D]=Math.cos(y[D]);return this.makeOutput(d,u.shape,"float32")},h.prototype.tan=function(u){Ir(u,"tan");for(var d=new Float32Array(u.size),y=this.readSync(u.dataId),D=0;D<y.length;++D)d[D]=Math.tan(y[D]);return this.makeOutput(d,u.shape,"float32")},h.prototype.asin=function(u){Ir(u,"asin");for(var d=new Float32Array(u.size),y=this.readSync(u.dataId),D=0;D<y.length;++D)d[D]=Math.asin(y[D]);return this.makeOutput(d,u.shape,"float32")},h.prototype.acos=function(u){Ir(u,"acos");for(var d=new Float32Array(u.size),y=this.readSync(u.dataId),D=0;D<y.length;++D)d[D]=Math.acos(y[D]);return this.makeOutput(d,u.shape,"float32")},h.prototype.atan=function(u){Ir(u,"atan");for(var d=new Float32Array(u.size),y=this.readSync(u.dataId),D=0;D<y.length;++D)d[D]=Math.atan(y[D]);return this.makeOutput(d,u.shape,"float32")},h.prototype.atan2=function(u,d){return Ir([u,d],"atan2"),this.broadcastedBinaryOp(u,d,u.dtype,function(y,D){return Math.atan2(y,D)})},h.prototype.sinh=function(u){Ir(u,"sinh");for(var d=new Float32Array(u.size),y=this.readSync(u.dataId),D=0;D<y.length;++D)d[D]=Math.sinh(y[D]);return this.makeOutput(d,u.shape,"float32")},h.prototype.cosh=function(u){Ir(u,"cosh");for(var d=new Float32Array(u.size),y=this.readSync(u.dataId),D=0;D<y.length;++D)d[D]=Math.cosh(y[D]);return this.makeOutput(d,u.shape,"float32")},h.prototype.tanh=function(u){Ir(u,"tanh");for(var d=new Float32Array(u.size),y=this.readSync(u.dataId),D=0;D<y.length;++D)d[D]=Bt(y[D]);return this.makeOutput(d,u.shape,"float32")},h.prototype.asinh=function(u){Ir(u,"asinh");for(var d=new Float32Array(u.size),y=this.readSync(u.dataId),D=0;D<y.length;++D)d[D]=Math.asinh(y[D]);return this.makeOutput(d,u.shape,"float32")},h.prototype.acosh=function(u){Ir(u,"acosh");for(var d=new Float32Array(u.size),y=this.readSync(u.dataId),D=0;D<y.length;++D)d[D]=Math.acosh(y[D]);return this.makeOutput(d,u.shape,"float32")},h.prototype.atanh=function(u){Ir(u,"atanh");for(var d=new Float32Array(u.size),y=this.readSync(u.dataId),D=0;D<y.length;++D)d[D]=Math.atanh(y[D]);return this.makeOutput(d,u.shape,"float32")},h.prototype.erf=function(u){Ir(u,"erf");for(var d=new Float32Array(u.size),y=this.readSync(u.dataId),D=0;D<y.length;++D){var W=Math.sign(y[D]),X=Math.abs(y[D]),ae=1/(1+.3275911*X);d[D]=W*(1-((((1.061405429*ae-1.453152027)*ae+1.421413741)*ae-.284496736)*ae+.254829592)*ae*Math.exp(-X*X))}return this.makeOutput(d,u.shape,"float32")},h.prototype.step=function(u,d){d===void 0&&(d=0),Ir(u,"step");for(var y=new Float32Array(u.size),D=this.readSync(u.dataId),W=0;W<D.length;++W){var X=D[W];isNaN(X)?y[W]=NaN:y[W]=X>0?1:d}return this.makeOutput(y,u.shape,"float32")},h.prototype.fusedConv2d=function(u){var d=u.input,y=u.filter,D=u.convInfo,W=u.bias,X=u.activation,ae=u.preluActivationWeights,de=this.conv2d(d,y,D);return W&&(de=this.add(de,W)),X&&(de=I(this,de,X,ae)),de},h.prototype.conv2d=function(u,d,y){Ir([u,d],"conv2d");for(var D=y.filterHeight,W=y.filterWidth,X=y.dilationHeight,ae=y.dilationWidth,de=y.padInfo.left,be=y.padInfo.top,Ie=y.dataFormat==="channelsLast",Re=Ni(y.outShape,u.dtype),Me=u.strides[0],qe=Ie?u.strides[1]:u.strides[2],Je=Ie?u.strides[2]:1,Qe=Ie?1:u.strides[1],ot=Re.strides[0],vt=Ie?Re.strides[1]:Re.strides[2],bt=Ie?Re.strides[2]:1,wt=Ie?1:Re.strides[1],Ft=this.readSync(u.dataId),Yt=this.readSync(d.dataId),an=Re.values,Jt=0;Jt<y.batchSize;++Jt)for(var un=Jt*Me,gn=Jt*ot,p=0;p<y.outHeight;++p)for(var c=gn+p*vt,a=p*y.strideHeight-be,l=0;l<D;l++){var g=a+l*X;if(!(g<0||g>=y.inHeight))for(var _=l*d.strides[0],j=un+g*qe,V=0;V<y.outWidth;++V)for(var ne=c+V*bt,oe=V*y.strideWidth-de,me=0;me<W;me++){var Ee=oe+me*ae;if(!(Ee<0||Ee>=y.inWidth))for(var _e=j+Ee*Je,Ne=_+me*d.strides[1],Ue=0;Ue<y.inChannels;++Ue){for(var $e=Ft[_e+Ue*Qe],He=0;He<y.outChannels;++He)an[ne+He*wt]+=$e*Yt[Ne+He];Ne+=y.outChannels}}}return Re.toTensor()},h.prototype.conv3d=function(u,d,y){for(var D=y.filterDepth,W=y.filterHeight,X=y.filterWidth,ae=y.dilationDepth,de=y.dilationHeight,be=y.dilationWidth,Ie=y.padInfo.front,Re=y.padInfo.left,Me=y.padInfo.top,qe=Ni(y.outShape,u.dtype),Je=this.readSync(u.dataId),Qe=this.readSync(d.dataId),ot=qe.values,vt=0;vt<y.batchSize;++vt)for(var bt=vt*u.strides[0],wt=vt*qe.strides[0],Ft=0;Ft<y.outDepth;++Ft)for(var Yt=wt+Ft*qe.strides[1],an=Ft*y.strideDepth-Ie,Jt=0;Jt<D;Jt++){var un=an+Jt*ae;if(!(un<0||un>=y.inDepth))for(var gn=Jt*d.strides[0],p=bt+un*u.strides[1],c=0;c<y.outHeight;++c)for(var a=Yt+c*qe.strides[2],l=c*y.strideHeight-Me,g=0;g<W;g++){var _=l+g*de;if(!(_<0||_>=y.inHeight))for(var j=gn+g*d.strides[1],V=p+_*u.strides[2],ne=0;ne<y.outWidth;++ne)for(var oe=a+ne*y.outChannels,me=ne*y.strideWidth-Re,Ee=0;Ee<X;Ee++){var _e=me+Ee*be;if(!(_e<0||_e>=y.inWidth))for(var Ne=j+Ee*d.strides[2],Ue=V+_e*y.inChannels,$e=Ne,He=0;He<y.inChannels;++He){for(var et=Je[Ue+He],lt=0;lt<y.outChannels;++lt)ot[oe+lt]+=et*Qe[$e+lt];$e+=y.outChannels}}}}return qe.toTensor()},h.prototype.conv2dDerInput=function(u,d,y){Ir([u,d],"conv2dDerInput");for(var D=Ni(y.inShape,"float32"),W=D.values,X=this.readSync(u.dataId),ae=this.readSync(d.dataId),de=d.strides,be=de[0],Ie=de[1],Re=de[2],Me=y.batchSize,qe=y.filterHeight,Je=y.filterWidth,Qe=y.inChannels,ot=y.inHeight,vt=y.inWidth,bt=y.outChannels,wt=y.outHeight,Ft=y.outWidth,Yt=y.strideHeight,an=y.strideWidth,Jt=y.dataFormat,un=qe-1-y.padInfo.top,gn=Je-1-y.padInfo.left,p=Jt==="channelsLast",c=D.strides[0],a=p?D.strides[1]:D.strides[2],l=p?D.strides[2]:1,g=p?1:D.strides[1],_=u.strides[0],j=p?u.strides[1]:u.strides[2],V=p?u.strides[2]:1,ne=p?1:u.strides[1],oe=0;oe<Me;++oe)for(var me=0;me<Qe;++me)for(var Ee=0;Ee<ot;++Ee)for(var _e=Ee-un,Ne=Math.max(0,Math.ceil(_e/Yt)),Ue=Math.min(wt,(qe+_e)/Yt),$e=0;$e<vt;++$e){for(var He=$e-gn,et=Math.max(0,Math.ceil(He/an)),lt=Math.min(Ft,(Je+He)/an),ht=0,gt=Ne;gt<Ue;++gt)for(var Ct=gt*Yt-_e,Wt=et;Wt<lt;++Wt)for(var Kt=_*oe+j*gt+V*Wt,Vt=be*(qe-1-Ct)+Ie*(Je-1-(Wt*an-He))+Re*me,Ht=0;Ht<bt;++Ht)ht+=X[Kt+ne*Ht]*ae[Vt+Ht];W[c*oe+a*Ee+l*$e+g*me]=ht}return D.toTensor()},h.prototype.conv3dDerInput=function(u,d,y){for(var D=Ni(y.inShape,"float32"),W=D.values,X=D.strides,ae=X[0],de=X[1],be=X[2],Ie=X[3],Re=this.readSync(u.dataId),Me=u.strides,qe=Me[0],Je=Me[1],Qe=Me[2],ot=Me[3],vt=this.readSync(d.dataId),bt=d.strides,wt=bt[0],Ft=bt[1],Yt=bt[2],an=bt[3],Jt=y.batchSize,un=y.filterDepth,gn=y.filterHeight,p=y.filterWidth,c=y.inChannels,a=y.inDepth,l=y.inHeight,g=y.inWidth,_=y.outChannels,j=y.outDepth,V=y.outHeight,ne=y.outWidth,oe=y.strideDepth,me=y.strideHeight,Ee=y.strideWidth,_e=un-1-y.padInfo.front,Ne=gn-1-y.padInfo.top,Ue=p-1-y.padInfo.left,$e=0;$e<Jt;++$e)for(var He=0;He<c;++He)for(var et=0;et<a;++et)for(var lt=et-_e,ht=Math.max(0,Math.ceil(lt/oe)),gt=Math.min(j,(un+lt)/oe),Ct=0;Ct<l;++Ct)for(var Wt=Ct-Ne,Kt=Math.max(0,Math.ceil(Wt/me)),Vt=Math.min(V,(gn+Wt)/me),Ht=0;Ht<g;++Ht){for(var vn=Ht-Ue,On=Math.max(0,Math.ceil(vn/Ee)),Cn=Math.min(ne,(p+vn)/Ee),Kn=0,er=ht;er<gt;++er)for(var sr=er*oe-lt,lr=Kt;lr<Vt;++lr)for(var ur=lr*me-Wt,ar=On;ar<Cn;++ar)for(var Or=qe*$e+Je*er+Qe*lr+ot*ar,Er=wt*(un-1-sr)+Ft*(gn-1-ur)+Yt*(p-1-(ar*Ee-vn))+an*He,Ur=0;Ur<_;++Ur)Kn+=Re[Or+Ur]*vt[Er+Ur];W[ae*$e+de*et+be*Ct+Ie*Ht+He]=Kn}return D.toTensor()},h.prototype.conv2dDerFilter=function(u,d,y){Ir([u,d],"conv2dDerFilter");for(var D=y.strideHeight,W=y.strideWidth,X=y.filterHeight,ae=y.filterWidth,de=y.dataFormat==="channelsLast",be=Ni(y.filterShape,"float32"),Ie=y.padInfo.left,Re=y.padInfo.top,Me=this.bufferSync(u),qe=this.bufferSync(d),Je=0;Je<X;++Je)for(var Qe=Math.max(0,Math.ceil((Re-Je)/D)),ot=Math.min(y.outHeight,(y.inHeight+Re-Je)/D),vt=0;vt<ae;++vt)for(var bt=Math.max(0,Math.ceil((Ie-vt)/W)),wt=Math.min(y.outWidth,(y.inWidth+Ie-vt)/W),Ft=0;Ft<y.inChannels;++Ft)for(var Yt=0;Yt<y.outChannels;++Yt){for(var an=0,Jt=0;Jt<y.batchSize;++Jt)for(var un=Qe;un<ot;++un)for(var gn=Je+un*D-Re,p=bt;p<wt;++p){var c=vt+p*W-Ie;an+=de?Me.get(Jt,gn,c,Ft)*qe.get(Jt,un,p,Yt):Me.get(Jt,Ft,gn,c)*qe.get(Jt,Yt,un,p)}be.set(an,Je,vt,Ft,Yt)}return be.toTensor()},h.prototype.conv3dDerFilter=function(u,d,y){for(var D=y.strideDepth,W=y.strideHeight,X=y.strideWidth,ae=y.filterDepth,de=y.filterHeight,be=y.filterWidth,Ie=Ni(y.filterShape,"float32"),Re=Ie.values,Me=Ie.strides,qe=Me[0],Je=Me[1],Qe=Me[2],ot=Me[3],vt=this.readSync(d.dataId),bt=d.strides,wt=bt[0],Ft=bt[1],Yt=bt[2],an=bt[3],Jt=this.readSync(u.dataId),un=u.strides,gn=un[0],p=un[1],c=un[2],a=un[3],l=y.padInfo.front,g=y.padInfo.left,_=y.padInfo.top,j=0;j<ae;++j)for(var V=Math.max(0,Math.ceil((l-j)/D)),ne=Math.min(y.outDepth,(y.inDepth+l-j)/D),oe=j*qe,me=0;me<de;++me)for(var Ee=Math.max(0,Math.ceil((_-me)/W)),_e=Math.min(y.outHeight,(y.inHeight+_-me)/W),Ne=me*Je+oe,Ue=0;Ue<be;++Ue)for(var $e=Math.max(0,Math.ceil((g-Ue)/X)),He=Math.min(y.outWidth,(y.inWidth+g-Ue)/X),et=Ue*Qe+Ne,lt=0;lt<y.inChannels;++lt)for(var ht=lt*ot+et,gt=0;gt<y.outChannels;++gt){for(var Ct=0,Wt=0;Wt<y.batchSize;++Wt)for(var Kt=Wt*gn,Vt=Wt*wt,Ht=V;Ht<ne;++Ht)for(var vn=(j+Ht*D-l)*p+Kt,On=Ht*Ft+Vt,Cn=Ee;Cn<_e;++Cn)for(var Kn=(me+Cn*W-_)*c+vn,er=Cn*Yt+On,sr=$e;sr<He;++sr){var lr=sr*an+er;Ct+=Jt[(Ue+sr*X-g)*a+Kn+lt]*vt[lr+gt]}Re[ht+gt]=Ct}return Ie.toTensor()},h.prototype.fusedDepthwiseConv2D=function(u){var d=u.input,y=u.filter,D=u.convInfo,W=u.bias,X=u.activation,ae=u.preluActivationWeights,de=this.depthwiseConv2D(d,y,D);return W&&(de=this.add(de,W)),X&&(de=I(this,de,X,ae)),de},h.prototype.depthwiseConv2D=function(u,d,y){Ir([u,d],"depthwiseConv2D");for(var D=y.filterHeight,W=y.filterWidth,X=y.dilationHeight,ae=y.dilationWidth,de=y.padInfo.left,be=y.padInfo.top,Ie=y.outChannels/y.inChannels,Re=Ni(y.outShape,u.dtype),Me=this.readSync(u.dataId),qe=this.readSync(d.dataId),Je=Re.values,Qe=0;Qe<y.batchSize;++Qe)for(var ot=Qe*u.strides[0],vt=Qe*Re.strides[0],bt=0;bt<y.outHeight;++bt)for(var wt=vt+bt*Re.strides[1],Ft=bt*y.strideHeight-de,Yt=0;Yt<D;++Yt){var an=Ft+Yt*X;if(!(an<0||an>=y.inHeight))for(var Jt=Yt*d.strides[0],un=ot+an*u.strides[1],gn=0;gn<y.outWidth;++gn)for(var p=wt+gn*Re.strides[2],c=gn*y.strideWidth-be,a=0;a<W;++a){var l=c+a*ae;if(!(l<0||l>=y.inWidth))for(var g=Jt+a*d.strides[1],_=un+l*y.inChannels,j=p,V=g,ne=0;ne<y.inChannels;++ne){for(var oe=Me[_+ne],me=0;me<Ie;++me)Je[j+me]+=oe*qe[V+me];j+=Ie,V+=Ie}}}return Re.toTensor()},h.prototype.depthwiseConv2DDerInput=function(u,d,y){Ir([u,d],"depthwiseConv2DDerInput");for(var D=Ni(y.inShape,"float32"),W=D.values,X=D.strides,ae=X[0],de=X[1],be=X[2],Ie=this.readSync(u.dataId),Re=u.strides,Me=Re[0],qe=Re[1],Je=Re[2],Qe=this.readSync(d.dataId),ot=d.strides,vt=ot[0],bt=ot[1],wt=ot[2],Ft=y.batchSize,Yt=y.filterHeight,an=y.filterWidth,Jt=y.inChannels,un=y.inHeight,gn=y.inWidth,p=y.outChannels,c=y.outHeight,a=y.outWidth,l=y.strideHeight,g=y.strideWidth,_=Yt-1-y.padInfo.top,j=an-1-y.padInfo.left,V=p/Jt,ne=0;ne<Ft;++ne)for(var oe=0;oe<Jt;++oe)for(var me=0;me<un;++me)for(var Ee=me-_,_e=Math.max(0,Math.ceil(Ee/l)),Ne=Math.min(c,(Yt+Ee)/l),Ue=0;Ue<gn;++Ue){for(var $e=Ue-j,He=Math.max(0,Math.ceil($e/g)),et=Math.min(a,(an+$e)/g),lt=0,ht=_e;ht<Ne;++ht)for(var gt=ht*l-Ee,Ct=He;Ct<et;++Ct)for(var Wt=Me*ne+qe*ht+Je*Ct,Kt=vt*(Yt-1-gt)+bt*(an-1-(Ct*g-$e))+wt*oe,Vt=0;Vt<V;++Vt)lt+=Ie[Wt+(oe*V+Vt)]*Qe[Kt+Vt];W[ae*ne+de*me+be*Ue+oe]=lt}return D.toTensor()},h.prototype.depthwiseConv2DDerFilter=function(u,d,y){Ir([u,d],"depthwiseConv2DDerFilter");for(var D=y.strideHeight,W=y.strideWidth,X=y.filterHeight,ae=y.filterWidth,de=Ni(y.filterShape,"float32"),be=y.padInfo.left,Ie=y.padInfo.top,Re=y.outChannels/y.inChannels,Me=this.bufferSync(u),qe=this.bufferSync(d),Je=0;Je<X;++Je)for(var Qe=Math.max(0,Math.ceil((Ie-Je)/D)),ot=Math.min(y.outHeight,(y.inHeight+Ie-Je)/D),vt=0;vt<ae;++vt)for(var bt=Math.max(0,Math.ceil((be-vt)/W)),wt=Math.min(y.outWidth,(y.inWidth+be-vt)/W),Ft=0;Ft<y.outChannels;++Ft){for(var Yt=Math.trunc(Ft/Re),an=Ft%Re,Jt=0,un=0;un<y.batchSize;++un)for(var gn=Qe;gn<ot;++gn)for(var p=Je+gn*D-Ie,c=bt;c<wt;++c){var a=vt+c*W-be;Jt+=Me.get(un,p,a,Yt)*qe.get(un,gn,c,Ft)}de.set(Jt,Je,vt,Yt,an)}return de.toTensor()},h.prototype.tile=function(u,d){return Ir(u,"tile"),Bf(this.bufferSync(u),d)},h.prototype.pad=function(u,d,y){Ir(u,"pad");var D=d.map(function(Re,Me){return Re[0]+u.shape[Me]+Re[1]}),W=d.map(function(Re){return Re[0]}),X=this.bufferSync(u),ae=Ni(D,u.dtype);y!==0&&ae.values.fill(y);for(var de=0;de<u.size;de++){var be=X.indexToLoc(de),Ie=be.map(function(Re,Me){return Re+W[Me]});ae.set.apply(ae,[X.get.apply(X,be)].concat(Ie))}return ae.toTensor()},h.prototype.transpose=function(u,d){Ir(u,"transpose");for(var y=new Array(u.rank),D=0;D<y.length;D++)y[D]=u.shape[d[D]];var W=this.readSync(u.dataId),X=Ni(y,u.dtype),ae=this.bufferSync(u);for(D=0;D<u.size;++D){for(var de=ae.indexToLoc(D),be=new Array(de.length),Ie=0;Ie<be.length;Ie++)be[Ie]=de[d[Ie]];var Re=X.locToIndex(be);X.values[Re]=W[D]}return X.toTensor()},h.prototype.gather=function(u,d,y){Ir([u,d],"gather");var D=u.shape.slice(),W=this.readSync(d.dataId);D[y]=W.length;for(var X=Ni(D,u.dtype),ae=this.bufferSync(u),de=0;de<X.size;++de){var be=X.indexToLoc(de),Ie=be.slice();Ie[y]=W[be[y]];var Re=ae.locToIndex(Ie);X.values[de]=ae.values[Re]}return X.toTensor()},h.prototype.batchToSpaceND=function(u,d,y){Ir([u],"batchToSpaceND");var D=d.reduce(function(Ie,Re){return Ie*Re}),W=Uu(u.shape,d,D),X=Df(W.length,d.length),ae=Tf(u.shape,d,D),de=Xc(y,d.length),be=Vd(ae,y,d.length);return u.reshape(W).transpose(X).reshape(ae).slice(de,be)},h.prototype.spaceToBatchND=function(u,d,y){Ir([u],"spaceToBatchND");var D=d.reduce(function(Re,Me){return Re*Me}),W=[[0,0]];W.push.apply(W,y);for(var X=1+d.length;X<u.shape.length;++X)W.push([0,0]);var ae=u.pad(W),de=Uu(ae.shape,d,D,!1),be=Df(de.length,d.length,!1),Ie=Tf(ae.shape,d,D,!1);return ae.reshape(de).transpose(be).reshape(Ie)},h.prototype.pool=function(u,d,y){Ir(u,"pool");for(var D=d.strideHeight,W=d.strideWidth,X=d.dilationHeight,ae=d.dilationWidth,de=d.effectiveFilterHeight,be=d.effectiveFilterWidth,Ie=d.padInfo.top,Re=d.padInfo.left,Me=y==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,qe=this.readSync(u.dataId),Je=Ni(d.outShape,u.dtype),Qe=Je.values,ot=d.outShape[1]*d.outShape[2]*d.outShape[3],vt=d.outShape[2]*d.outShape[3],bt=d.outShape[3],wt=0;wt<d.batchSize;++wt)for(var Ft=wt*ot,Yt=wt*u.strides[0],an=0;an<d.inChannels;++an)for(var Jt=0;Jt<d.outHeight;++Jt)for(var un=Jt*D-Ie,gn=Math.max(0,un),p=Math.min(d.inHeight,de+un),c=Ft+Jt*vt,a=0;a<d.outWidth;++a){for(var l=a*W-Re,g=Math.max(0,l),_=Math.min(d.inWidth,be+l),j=Me,V=0,ne=0,oe=gn;oe<p;oe+=X){for(var me=Yt+oe*u.strides[1],Ee=g;Ee<_;Ee+=ae){var _e=qe[me+Ee*u.strides[2]+an];y==="max"&&_e>j?j=_e:y==="avg"&&(V+=_e,ne++)}if(isNaN(j))break}Qe[c+a*bt+an]=y==="avg"?V/ne:j}return Je.toTensor()},h.prototype.maxPool=function(u,d){return this.pool(u,d,"max")},h.prototype.maxPoolPositions=function(u,d){for(var y=Ni(d.outShape,"int32"),D=d.strideHeight,W=d.strideWidth,X=d.dilationHeight,ae=d.dilationWidth,de=d.effectiveFilterHeight,be=d.effectiveFilterWidth,Ie=d.padInfo.top,Re=d.padInfo.left,Me=this.bufferSync(u),qe=0;qe<d.batchSize;++qe)for(var Je=0;Je<d.inChannels;++Je)for(var Qe=0;Qe<d.outHeight;++Qe){for(var ot=Qe*D-Ie,vt=ot;vt<0;)vt+=X;for(var bt=Math.min(d.inHeight,de+ot),wt=0;wt<d.outWidth;++wt){for(var Ft=wt*W-Re,Yt=Ft;Yt<0;)Yt+=ae;for(var an=Math.min(d.inWidth,be+Ft),Jt=Number.NEGATIVE_INFINITY,un=-1,gn=vt;gn<bt;gn+=X)for(var p=gn-ot,c=Yt;c<an;c+=ae){var a=c-Ft,l=Me.get(qe,gn,c,Je);l>Jt&&(Jt=l,un=p*be+a)}y.set(un,qe,Qe,wt,Je)}}return y.toTensor()},h.prototype.maxPoolBackprop=function(u,d,y,D){Ir([d,y],"maxPoolBackprop");for(var W=this.maxPoolPositions(d,D),X=D.strideHeight,ae=D.strideWidth,de=D.dilationHeight,be=D.dilationWidth,Ie=D.effectiveFilterHeight,Re=D.effectiveFilterWidth,Me=Re-1-D.padInfo.left,qe=Ie-1-D.padInfo.top,Je=Ni(d.shape,"float32"),Qe=this.bufferSync(W),ot=this.bufferSync(u),vt=0;vt<D.batchSize;++vt)for(var bt=0;bt<D.inChannels;++bt)for(var wt=0;wt<D.inHeight;++wt)for(var Ft=0;Ft<D.inWidth;++Ft){for(var Yt=wt-qe,an=Ft-Me,Jt=0,un=0;un<Ie;un+=de){var gn=(Yt+un)/X;if(!(gn<0||gn>=D.outHeight||Math.floor(gn)!==gn))for(var p=0;p<Re;p+=be){var c=(an+p)/ae;if(!(c<0||c>=D.outWidth||Math.floor(c)!==c)){var a=Ie*Re-1-Qe.get(vt,gn,c,bt)===un*Re+p?1:0;a!==0&&(Jt+=ot.get(vt,gn,c,bt)*a)}}}Je.set(Jt,vt,wt,Ft,bt)}return Je.toTensor()},h.prototype.avgPoolBackprop=function(u,d,y){Ir([u,d],"avgPoolBackprop");for(var D=y.strideHeight,W=y.strideWidth,X=y.filterHeight,ae=y.filterWidth,de=y.dilationHeight,be=y.dilationWidth,Ie=y.effectiveFilterHeight,Re=y.effectiveFilterWidth,Me=Re-1-y.padInfo.left,qe=Ie-1-y.padInfo.top,Je=Ni(d.shape,"float32"),Qe=1/(X*ae),ot=this.bufferSync(u),vt=0;vt<y.batchSize;++vt)for(var bt=0;bt<y.inChannels;++bt)for(var wt=0;wt<y.inHeight;++wt)for(var Ft=0;Ft<y.inWidth;++Ft){for(var Yt=wt-qe,an=Ft-Me,Jt=0,un=0;un<Ie;un+=de){var gn=(Yt+un)/D;if(!(gn<0||gn>=y.outHeight||Math.floor(gn)!==gn))for(var p=0;p<Re;p+=be){var c=(an+p)/W;c<0||c>=y.outWidth||Math.floor(c)!==c||(Jt+=ot.get(vt,gn,c,bt))}}Je.set(Jt*Qe,vt,wt,Ft,bt)}return Je.toTensor()},h.prototype.pool3d=function(u,d,y){Ir(u,"pool3d");for(var D=d.strideDepth,W=d.strideHeight,X=d.strideWidth,ae=d.dilationDepth,de=d.dilationHeight,be=d.dilationWidth,Ie=d.effectiveFilterDepth,Re=d.effectiveFilterHeight,Me=d.effectiveFilterWidth,qe=d.padInfo.front,Je=d.padInfo.top,Qe=d.padInfo.left,ot=y==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,vt=this.readSync(u.dataId),bt=Ni(d.outShape,u.dtype),wt=bt.values,Ft=d.outShape[1]*d.outShape[2]*d.outShape[3]*d.outShape[4],Yt=d.outShape[2]*d.outShape[3]*d.outShape[4],an=d.outShape[3]*d.outShape[4],Jt=d.outShape[4],un=0;un<d.batchSize;++un)for(var gn=un*Ft,p=un*u.strides[0],c=0;c<d.inChannels;++c)for(var a=0;a<d.outDepth;++a){for(var l=a*D-qe,g=l;g<0;)g+=ae;for(var _=Math.min(d.inDepth,Ie+l),j=gn+a*Yt,V=0;V<d.outHeight;++V){for(var ne=V*W-Je,oe=ne;oe<0;)oe+=de;for(var me=Math.min(d.inHeight,Re+ne),Ee=j+V*an,_e=0;_e<d.outWidth;++_e){for(var Ne=_e*X-Qe,Ue=Ne;Ue<0;)Ue+=be;for(var $e=Math.min(d.inWidth,Me+Ne),He=Ee+_e*Jt,et=ot,lt=0,ht=0,gt=g;gt<_;gt+=ae){for(var Ct=p+gt*u.strides[1],Wt=oe;Wt<me;Wt+=de){for(var Kt=Ct+Wt*u.strides[2],Vt=Ue;Vt<$e;Vt+=be){var Ht=vt[Kt+Vt*u.strides[3]+c];if(y==="max"&&Ht>et?et=Ht:y==="avg"&&(lt+=Ht,ht++),isNaN(et))break}if(isNaN(et))break}if(isNaN(et))break}wt[He+c]=y==="avg"?lt/ht:et}}}return bt.toTensor()},h.prototype.avgPool3d=function(u,d){return Ir(u,"avgPool3d"),this.pool3d(u,d,"avg").toFloat()},h.prototype.avgPool3dBackprop=function(u,d,y){Ir([u,d],"avgPool3dBackprop");for(var D=y.strideDepth,W=y.strideHeight,X=y.strideWidth,ae=y.filterDepth,de=y.filterHeight,be=y.filterWidth,Ie=y.dilationDepth,Re=y.dilationHeight,Me=y.dilationWidth,qe=y.effectiveFilterDepth,Je=y.effectiveFilterHeight,Qe=y.effectiveFilterWidth,ot=qe-1-y.padInfo.front,vt=Qe-1-y.padInfo.left,bt=Je-1-y.padInfo.top,wt=Ni(d.shape,"float32"),Ft=1/(ae*de*be),Yt=this.bufferSync(u),an=0;an<y.batchSize;++an)for(var Jt=0;Jt<y.inChannels;++Jt)for(var un=0;un<y.inDepth;++un)for(var gn=0;gn<y.inHeight;++gn)for(var p=0;p<y.inWidth;++p){for(var c=un-ot,a=gn-bt,l=p-vt,g=0,_=0;_<qe;_+=Ie){var j=(c+_)/D;if(!(j<0||j>=y.outDepth||Math.floor(j)!==j))for(var V=0;V<Je;V+=Re){var ne=(a+V)/W;if(!(ne<0||ne>=y.outHeight||Math.floor(ne)!==ne))for(var oe=0;oe<Qe;oe+=Me){var me=(l+oe)/X;me<0||me>=y.outWidth||Math.floor(me)!==me||(g+=Yt.get(an,j,ne,me,Jt))}}}wt.set(g*Ft,an,un,gn,p,Jt)}return wt.toTensor()},h.prototype.maxPool3d=function(u,d){return Ir(u,"maxPool3d"),this.pool3d(u,d,"max").toFloat()},h.prototype.maxPool3dPositions=function(u,d){for(var y=Ni(d.outShape,"int32"),D=d.strideDepth,W=d.strideHeight,X=d.strideWidth,ae=d.dilationDepth,de=d.dilationHeight,be=d.dilationWidth,Ie=d.effectiveFilterDepth,Re=d.effectiveFilterHeight,Me=d.effectiveFilterWidth,qe=d.padInfo.front,Je=d.padInfo.top,Qe=d.padInfo.left,ot=this.bufferSync(u),vt=0;vt<d.batchSize;++vt)for(var bt=0;bt<d.inChannels;++bt)for(var wt=0;wt<d.outDepth;++wt){for(var Ft=wt*D-qe,Yt=Ft;Yt<0;)Yt+=ae;for(var an=Math.min(d.inDepth,Ie+Ft),Jt=0;Jt<d.outHeight;++Jt){for(var un=Jt*W-Je,gn=un;gn<0;)gn+=de;for(var p=Math.min(d.inHeight,Re+un),c=0;c<d.outWidth;++c){for(var a=c*X-Qe,l=a;l<0;)l+=be;for(var g=Math.min(d.inWidth,Me+a),_=Number.NEGATIVE_INFINITY,j=-1,V=Yt;V<an;V+=ae)for(var ne=V-Ft,oe=gn;oe<p;oe+=de)for(var me=oe-un,Ee=l;Ee<g;Ee+=be){var _e=Ee-a,Ne=ot.get(vt,V,oe,Ee,bt);Ne>=_&&(_=Ne,j=ne*Re*Me+me*Re+_e)}y.set(j,vt,wt,Jt,c,bt)}}}return y.toTensor()},h.prototype.maxPool3dBackprop=function(u,d,y,D){Ir([d,y],"maxPool3dBackprop");for(var W=this.maxPool3dPositions(d,D),X=D.strideDepth,ae=D.strideHeight,de=D.strideWidth,be=D.dilationDepth,Ie=D.dilationHeight,Re=D.dilationWidth,Me=D.effectiveFilterDepth,qe=D.effectiveFilterHeight,Je=D.effectiveFilterWidth,Qe=Me-1-D.padInfo.front,ot=Je-1-D.padInfo.left,vt=qe-1-D.padInfo.top,bt=Ni(d.shape,"float32"),wt=this.bufferSync(W),Ft=this.bufferSync(u),Yt=0;Yt<D.batchSize;++Yt)for(var an=0;an<D.inChannels;++an)for(var Jt=0;Jt<D.inDepth;++Jt)for(var un=0;un<D.inHeight;++un)for(var gn=0;gn<D.inWidth;++gn){for(var p=Jt-Qe,c=un-vt,a=gn-ot,l=0,g=0;g<Me;g+=be){var _=(p+g)/X;if(!(_<0||_>=D.outDepth||Math.floor(_)!==_))for(var j=0;j<qe;j+=Ie){var V=(c+j)/ae;if(!(V<0||V>=D.outHeight||Math.floor(V)!==V))for(var ne=0;ne<Je;ne+=Re){var oe=(a+ne)/de;if(!(oe<0||oe>=D.outWidth||Math.floor(oe)!==oe)){var me=Me*qe*Je-1-wt.get(Yt,_,V,oe,an)===g*qe*Je+j*Je+ne?1:0;me!==0&&(l+=Ft.get(Yt,_,V,oe,an)*me)}}}}bt.set(l,Yt,Jt,un,gn,an)}return bt.toTensor()},h.prototype.cast=function(u,d){return Hs(u,d,this)},h.prototype.reshape=function(u,d){return Eu(u,d)},h.prototype.avgPool=function(u,d){return Ir(u,"avgPool"),this.pool(u,d,"avg").toFloat()},h.prototype.resizeBilinear=function(u,d,y,D){Ir(u,"resizeBilinear");for(var W=u.shape,X=W[0],ae=W[1],de=W[2],be=W[3],Ie=this.readSync(u.dataId),Re=new Float32Array(Ye([X,d,y,be])),Me=[D&&d>1?ae-1:ae,D&&y>1?de-1:de],qe=[D&&d>1?d-1:d,D&&y>1?y-1:y],Je=0,Qe=Me[0]/qe[0],ot=Me[1]/qe[1],vt=0;vt<X;vt++)for(var bt=0;bt<d;bt++)for(var wt=Qe*bt,Ft=Math.floor(wt),Yt=wt-Ft,an=Math.min(ae-1,Math.ceil(wt)),Jt=vt*u.strides[0]+Ft*u.strides[1],un=vt*u.strides[0]+an*u.strides[1],gn=0;gn<y;gn++)for(var p=ot*gn,c=Math.floor(p),a=p-c,l=Math.min(de-1,Math.ceil(p)),g=Jt+c*u.strides[2],_=un+c*u.strides[2],j=Jt+l*u.strides[2],V=un+l*u.strides[2],ne=0;ne<be;ne++){var oe=Ie[g+ne],me=Ie[_+ne],Ee=oe+(Ie[j+ne]-oe)*a,_e=Ee+(me+(Ie[V+ne]-me)*a-Ee)*Yt;Re[Je++]=_e}return wa(Re,[X,d,y,be])},h.prototype.resizeBilinearBackprop=function(u,d,y){Ir([u,d],"resizeBilinearBackprop");for(var D=d.shape,W=D[0],X=D[1],ae=D[2],de=D[3],be=u.shape,Ie=be[1],Re=be[2],Me=new Float32Array(W*X*ae*de),qe=[y&&Ie>1?X-1:X,y&&Re>1?ae-1:ae],Je=[y&&Ie>1?Ie-1:Ie,y&&Re>1?Re-1:Re],Qe=qe[0]/Je[0],ot=qe[1]/Je[1],vt=this.readSync(u.dataId),bt=0,wt=0;wt<W;wt++)for(var Ft=wt*d.strides[0],Yt=0;Yt<Ie;Yt++)for(var an=Yt*Qe,Jt=Math.floor(an),un=Math.min(Math.ceil(an),X-1),gn=Ft+Jt*d.strides[1],p=Ft+un*d.strides[1],c=an-Jt,a=1-c,l=0;l<Re;l++)for(var g=l*ot,_=Math.floor(g),j=Math.min(Math.ceil(g),ae-1),V=g-_,ne=1-V,oe=gn+_*d.strides[2],me=gn+j*d.strides[2],Ee=p+_*d.strides[2],_e=p+j*d.strides[2],Ne=a*ne,Ue=a*V,$e=c*ne,He=c*V,et=0;et<de;et++){var lt=vt[bt++];Me[oe+et]+=lt*Ne,Me[me+et]+=lt*Ue,Me[Ee+et]+=lt*$e,Me[_e+et]+=lt*He}return Us(Me,[W,ae,X,de],d.dtype)},h.prototype.resizeNearestNeighbor=function(u,d,y,D){Ir(u,"resizeNearestNeighbor");for(var W=u.shape,X=W[0],ae=W[1],de=W[2],be=W[3],Ie=this.readSync(u.dataId),Re=new Float32Array(X*d*y*be),Me=[D&&d>1?ae-1:ae,D&&y>1?de-1:de],qe=[D&&d>1?d-1:d,D&&y>1?y-1:y],Je=Me[0]/qe[0],Qe=Me[1]/qe[1],ot=0,vt=0;vt<X;vt++)for(var bt=vt*u.strides[0],wt=0;wt<d;wt++)for(var Ft=Je*wt,Yt=bt+Math.min(ae-1,D?Math.round(Ft):Math.floor(Ft))*u.strides[1],an=0;an<y;an++)for(var Jt=Qe*an,un=Yt+Math.min(de-1,D?Math.round(Jt):Math.floor(Jt))*u.strides[2],gn=0;gn<be;gn++){var p=Ie[un+gn];Re[ot++]=p}return wa(Re,[X,d,y,be],u.dtype)},h.prototype.resizeNearestNeighborBackprop=function(u,d,y){Ir([u,d],"resizeNearestNeighborBackprop");for(var D=d.shape,W=D[0],X=D[1],ae=D[2],de=D[3],be=u.shape,Ie=be[1],Re=be[2],Me=new Float32Array(W*X*ae*de),qe=this.readSync(u.dataId),Je=[y&&Ie>1?X-1:X,y&&Re>1?ae-1:ae],Qe=[y&&Ie>1?Ie-1:Ie,y&&Re>1?Re-1:Re],ot=Je[0]/Qe[0],vt=Je[1]/Qe[1],bt=1/ot,wt=1/vt,Ft=2*Math.ceil(bt)+2,Yt=2*Math.ceil(wt)+2,an=0;an<W;an++)for(var Jt=an*d.strides[0],un=0;un<X;un++)for(var gn=Jt+un*d.strides[1],p=Math.floor(un*bt),c=Math.floor(p-Ft/2),a=0;a<ae;a++)for(var l=gn+a*d.strides[2],g=Math.floor(a*wt),_=Math.floor(g-Yt/2),j=0;j<de;j++){for(var V=0,ne=0;ne<Ft;ne++){var oe=ne+c;if(!(oe<0||oe>=Ie)){var me=Jt+oe*u.strides[1],Ee=oe*ot;if(un===Math.min(X-1,y?Math.round(Ee):Math.floor(Ee)))for(var _e=0;_e<Yt;_e++){var Ne=_e+_;if(!(Ne<0||Ne>=Re)){var Ue=me+Ne*u.strides[2],$e=Ne*vt;a===Math.min(ae-1,y?Math.round($e):Math.floor($e))&&(V+=qe[Ue+j])}}}}Me[l+j]=V}return Us(Me,d.shape,d.dtype)},h.prototype.batchNormalization=function(u,d,y,D,W,X){Ir([u,d,y,W,X],"batchNorm");for(var ae=this.readSync(u.dataId),de=this.readSync(d.dataId),be=this.readSync(y.dataId),Ie=W?this.readSync(W.dataId):new Float32Array([1]),Re=X?this.readSync(X.dataId):new Float32Array([0]),Me=new Float32Array(ae.length),qe=Re.length,Je=Ie.length,Qe=be.length,ot=de.length,vt=0,bt=0,wt=0,Ft=0,Yt=0;Yt<ae.length;++Yt)Me[Yt]=Re[vt++]+(ae[Yt]-de[bt++])*Ie[wt++]/Math.sqrt(be[Ft++]+D),vt>=qe&&(vt=0),bt>=ot&&(bt=0),wt>=Je&&(wt=0),Ft>=Qe&&(Ft=0);return Us(Me,u.shape)},h.prototype.localResponseNormalization4D=function(u,d,y,D,W){Ir(u,"localResponseNormalization4D");var X=u.shape[3],ae=X-1,de=this.readSync(u.dataId),be=u.size,Ie=new Float32Array(be);function Re(Qe){for(var ot=Qe%X,vt=Qe-ot+Math.max(0,ot-d),bt=Qe-ot+Math.min(ot+d,ae),wt=0;vt<=bt;vt++){var Ft=de[vt];wt+=Ft*Ft}return wt}for(var Me=0;Me<be;Me++){var qe=Re(Me),Je=de[Me]*Math.pow(y+D*qe,-W);Ie[Me]=Je}return Us(Ie,u.shape)},h.prototype.LRNGrad=function(u,d,y,D,W,X,ae){Ir(u,"LRNGrad");for(var de=u.shape[3],be=this.readSync(u.dataId),Ie=this.readSync(d.dataId),Re=this.readSync(y.dataId),Me=new Float32Array(u.size),qe=u.size,Je=0;Je<qe;Je++){for(var Qe=Je%de,ot=Je-Qe+Math.max(0,Qe-D),vt=Je-Qe+Math.min(de,Qe+D+1),bt=0,wt=ot;wt<vt;wt++)bt+=Math.pow(Ie[wt],2);for(bt=X*bt+W,wt=ot;wt<vt;wt++){var Ft=-2*X*ae*Ie[wt]*Re[Je]/bt;Je===wt&&(Ft+=Math.pow(bt,-ae)),Ft*=be[Je],Me[wt]+=Ft}}return Us(Me,u.shape)},h.prototype.multinomial=function(u,d,y,D){Ir(u,"multinomial");for(var W=d?u:Os(u),X=W.shape[0],ae=W.shape[1],de=Ki([X,y],"int32"),be=this.readSync(de.dataId),Ie=this.readSync(W.dataId),Re=0;Re<X;++Re){var Me=Re*ae,qe=new Float32Array(ae-1);qe[0]=Ie[Me];for(var Je=1;Je<qe.length;++Je)qe[Je]=qe[Je-1]+Ie[Me+Je];for(var Qe=$c(D.toString()),ot=Re*y,vt=0;vt<y;++vt){var bt=Qe();be[ot+vt]=qe.length;for(var wt=0;wt<qe.length;wt++)if(bt<qe[wt]){be[ot+vt]=wt;break}}}return de},h.prototype.oneHot=function(u,d,y,D){Ir(u,"oneHot");var W=new Float32Array(u.size*d);W.fill(D);for(var X=this.readSync(u.dataId),ae=0;ae<u.size;++ae)X[ae]>=0&&X[ae]<d&&(W[ae*d+X[ae]]=y);return eu(W,[u.size,d],"int32")},h.prototype.nonMaxSuppression=function(u,d,y,D,W){return Ir(u,"nonMaxSuppression"),Ou(this.readSync(u.dataId),this.readSync(d.dataId),y,D,W)},h.prototype.fft=function(u){return this.fftBatch(u,!1)},h.prototype.ifft=function(u){return this.fftBatch(u,!0)},h.prototype.fftBatch=function(u,d){for(var y=u.shape[0],D=u.shape[1],W=Ni(u.shape,"float32"),X=Ni(u.shape,"float32"),ae=uo(u).as2D(y,D),de=Uo(u).as2D(y,D),be=0;be<y;be++)for(var Ie=ae.slice([be,0],[1,D]),Re=de.slice([be,0],[1,D]),Me=fa(Ie,Re),qe=this.readSync(this.fftImpl(Me,d).dataId),Je=0;Je<D;Je++){var Qe=Jc(qe,Je);W.values[be*D+Je]=Qe.real,X.values[be*D+Je]=Qe.imag}return fa(W.toTensor(),X.toTensor()).as2D(y,D)},h.prototype.fftImpl=function(u,d){var y=u.as1D(),D=y.size;if(this.isExponentOf2(D)){var W=this.fftRadix2(y,D,d).as2D(u.shape[0],u.shape[1]);return d&&(W=fa(uo(W).div(fr(D)),Uo(W).div(fr(D)))),W}var X=this.readSync(u.dataId),ae=function(de){for(var be=new Float32Array(de.length/2),Ie=new Float32Array(de.length/2),Re=0;Re<de.length;Re+=2)be[Re/2]=de[Re],Ie[Re/2]=de[Re+1];return{real:be,imag:Ie}}(this.fourierTransformByMatmul(X,D,d));return fa(ae.real,ae.imag).as2D(u.shape[0],u.shape[1])},h.prototype.isExponentOf2=function(u){return(u&u-1)==0},h.prototype.fftRadix2=function(u,d,y){if(d===1)return u;var D=this.readSync(u.dataId),W=d/2,X=function(ot){for(var vt=Math.ceil(ot.length/4),bt=new Float32Array(vt),wt=new Float32Array(vt),Ft=0;Ft<ot.length;Ft+=4)bt[Math.floor(Ft/4)]=ot[Ft],wt[Math.floor(Ft/4)]=ot[Ft+1];return{real:bt,imag:wt}}(D),ae=fa(X.real,X.imag).as1D(),de=function(ot){for(var vt=Math.floor(ot.length/4),bt=new Float32Array(vt),wt=new Float32Array(vt),Ft=2;Ft<ot.length;Ft+=4)bt[Math.floor(Ft/4)]=ot[Ft],wt[Math.floor(Ft/4)]=ot[Ft+1];return{real:bt,imag:wt}}(D),be=fa(de.real,de.imag).as1D();ae=this.fftRadix2(ae,W,y),be=this.fftRadix2(be,W,y);var Ie=function(ot,vt){for(var bt=new Float32Array(ot/2),wt=new Float32Array(ot/2),Ft=0;Ft<Math.ceil(ot/2);Ft++){var Yt=(vt?2:-2)*Math.PI*(Ft/ot);bt[Ft]=Math.cos(Yt),wt[Ft]=Math.sin(Yt)}return{real:bt,imag:wt}}(d,y),Re=fa(Ie.real,Ie.imag).mul(be),Me=ae.add(Re),qe=ae.sub(Re),Je=uo(Me).concat(uo(qe)),Qe=Uo(Me).concat(Uo(qe));return fa(Je,Qe).as1D()},h.prototype.fourierTransformByMatmul=function(u,d,y){for(var D=new Float32Array(2*d),W=0;W<d;W++){for(var X=0,ae=0,de=0;de<d;de++){var be=Wh(W*de,d,y),Ie=Jc(u,de);X+=Ie.real*be.real-Ie.imag*be.imag,ae+=Ie.real*be.imag+Ie.imag*be.real}y&&(X/=d,ae/=d),Qc(D,X,ae,W)}return D},h.prototype.depthToSpace=function(u,d,y){we(y==="NHWC",function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+y}),we(d>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+d});for(var D=u.shape[0],W=u.shape[1],X=u.shape[2],ae=u.shape[3],de=W*d,be=X*d,Ie=ae/(d*d),Re=this.readSync(u.dataId),Me=new Float32Array(D*de*be*Ie),qe=0,Je=0;Je<D;++Je)for(var Qe=0;Qe<de;++Qe)for(var ot=Math.floor(Qe/d),vt=Qe%d,bt=0;bt<be;++bt)for(var wt=Math.floor(bt/d),Ft=(vt*d+bt%d)*Ie,Yt=0;Yt<Ie;++Yt){var an=Yt+Ft+ae*(wt+X*(ot+W*Je));Me[qe++]=Re[an]}return Us(Me,[D,de,be,Ie])},h.prototype.broadcastedBinaryOp=function(u,d,y,D){var W=Hi(u.shape,d.shape),X=Ni(W,y),ae=this.readSync(u.dataId),de=this.readSync(d.dataId),be=Go(u.shape,W),Ie=Go(d.shape,W),Re=X.values;if(be.length+Ie.length===0)for(var Me=0;Me<Re.length;++Me)Re[Me]=D(ae[Me%ae.length],de[Me%de.length]);else{var qe=this.bufferSync(u),Je=this.bufferSync(d),Qe=function(ot){var vt=X.indexToLoc(ot),bt=vt.slice(-u.rank);be.forEach(function(an){return bt[an]=0});var wt=qe.locToIndex(bt),Ft=vt.slice(-d.rank);Ie.forEach(function(an){return Ft[an]=0});var Yt=Je.locToIndex(Ft);Re[ot]=D(ae[wt],de[Yt])};for(Me=0;Me<Re.length;++Me)Qe(Me)}return X.toTensor()},h.prototype.broadcastedBinaryComplexOp=function(u,d,y){var D=Hi(u.shape,d.shape),W=Ni(D,"float32"),X=Ni(D,"float32"),ae=this.readSync(u.dataId),de=this.readSync(d.dataId),be=Go(u.shape,D),Ie=Go(d.shape,D),Re=W.values,Me=X.values;if(be.length+Ie.length===0)for(var qe=0;qe<Re.length;qe++){var Je=qe%ae.length,Qe=qe%de.length,ot=y(ae[2*Je],ae[2*Je+1],de[2*Qe],de[2*Qe+1]);Re[qe]=ot.real,Me[qe]=ot.imag}else{var vt=this.bufferSync(this.data.get(u.dataId).complexTensors.real),bt=this.bufferSync(this.data.get(d.dataId).complexTensors.real),wt=function(Ft){var Yt=W.indexToLoc(Ft),an=Yt.slice(-u.rank);be.forEach(function(c){return an[c]=0});var Jt=vt.locToIndex(an),un=Yt.slice(-d.rank);Ie.forEach(function(c){return un[c]=0});var gn=bt.locToIndex(un),p=y(ae[2*Jt],ae[2*Jt+1],de[2*gn],de[2*gn+1]);Re[Ft]=p.real,Me[Ft]=p.imag};for(qe=0;qe<Re.length;qe++)wt(qe)}return this.complex(W.toTensor(),X.toTensor())},h.prototype.split=function(u,d,y){return Pl(u,d,y)},h.prototype.dispose=function(){},h.prototype.floatPrecision=function(){return 32},h.prototype.epsilon=function(){return 1e-7},h.prototype.cropAndResize=function(u,d,y,D,W,X){for(var ae=u.shape,de=ae[0],be=ae[1],Ie=ae[2],Re=ae[3],Me=d.shape[0],qe=D[0],Je=D[1],Qe=Ni([Me,qe,Je,Re],"float32"),ot=this.readSync(d.dataId),vt=this.readSync(y.dataId),bt=this.readSync(u.dataId),wt=u.strides,Ft=Qe.strides,Yt=0;Yt<Me;Yt++){var an=4*Yt,Jt=ot[an],un=ot[an+1],gn=ot[an+2],p=ot[an+3],c=vt[Yt];if(!(c>=de))for(var a=qe>1?(gn-Jt)*(be-1)/(qe-1):0,l=Je>1?(p-un)*(Ie-1)/(Je-1):0,g=0;g<qe;g++){var _=qe>1?Jt*(be-1)+g*a:.5*(Jt+gn)*(be-1);if(_<0||_>be-1)for(var j=0;j<Je;j++)for(var V=0;V<Re;V++){var ne=V+j*Ft[2]+g*Ft[1]+Yt*Ft[0];Qe.values[ne]=X}else if(W==="bilinear"){var oe=Math.floor(_),me=Math.ceil(_),Ee=_-oe;for(j=0;j<Je;j++)if((gt=Je>1?un*(Ie-1)+j*l:.5*(un+p)*(Ie-1))<0||gt>Ie-1)for(V=0;V<Re;V++)ne=V+j*Ft[2]+g*Ft[1]+Yt*Ft[0],Qe.values[ne]=X;else{var _e=Math.floor(gt),Ne=Math.ceil(gt),Ue=gt-_e;for(V=0;V<Re;V++){var $e=bt[ne=V+_e*wt[2]+oe*wt[1]+c*wt[0]],He=bt[ne=V+Ne*wt[2]+oe*wt[1]+c*wt[0]],et=bt[ne=V+_e*wt[2]+me*wt[1]+c*wt[0]],lt=$e+(He-$e)*Ue,ht=et+(bt[ne=V+Ne*wt[2]+me*wt[1]+c*wt[0]]-et)*Ue;ne=V+j*Ft[2]+g*Ft[1]+Yt*Ft[0],Qe.values[ne]=lt+(ht-lt)*Ee}}}else for(j=0;j<Je;++j){var gt;if((gt=Je>1?un*(Ie-1)+j*l:.5*(un+p)*(Ie-1))<0||gt>Ie-1)for(V=0;V<Re;V++)ne=V+j*Ft[2]+g*Ft[1]+Yt*Ft[0],Qe.values[ne]=X;else{var Ct=Math.round(gt),Wt=Math.round(_);for(V=0;V<Re;V++){var Kt=V+Ct*wt[2]+Wt*wt[1]+c*wt[0],Vt=V+j*Ft[2]+g*Ft[1]+Yt*Ft[0];Qe.values[Vt]=bt[Kt]}}}}}return Qe.toTensor()},h.prototype.sparseToDense=function(u,d,y,D){var W=Yc(0,u,y),X=W.sliceRank,ae=W.numUpdates,de=W.sliceSize,be=W.strides,Ie=W.outputSize;return this.scatter(u,d,y,Ie,de,ae,X,be,D,!1)},h.prototype.gatherND=function(u,d){var y=d.shape,D=y[y.length-1],W=Wu(u,d),X=W[0],ae=W[1],de=W[2],be=W[3];if(ae===0)return wa([],X,u.dtype);for(var Ie=new Wi([ae,de],u.dtype),Re=this.readSync(d.dataId),Me=this.readSync(u.dataId),qe=0;qe<ae;qe++){for(var Je=[],Qe=0,ot=0;ot<D;ot++){var vt=Re[qe*D+ot];Qe+=vt*be[ot],Je.push(vt)}if(Qe<0||Qe>=u.size/de)throw new Error("Invalid indices: "+Je+" does not index into "+u.shape);for(var bt=0;bt<de;bt++)Ie.values[qe*de+bt]=Me[Qe*de+bt]}return Ie.toTensor().reshape(X)},h.prototype.scatterND=function(u,d,y){var D=Yc(0,u,y),W=D.sliceRank,X=D.numUpdates,ae=D.sliceSize,de=D.strides,be=D.outputSize,Ie=fr(0);return this.scatter(u,d,y,be,ae,X,W,de,Ie,!0)},h.prototype.fill=function(u,d,y){var D=fn(y=y||xe(d),Ye(u));return D.fill(d),Ve.makeTensor(D,u,y,this)},h.prototype.onesLike=function(u){if(u.dtype==="string")throw new Error("onesLike is not supported for string tensors");return this.fill(u.shape,1,u.dtype)},h.prototype.zerosLike=function(u){var d=fn(u.dtype,Ye(u.shape));return this.makeOutput(d,u.shape,u.dtype)},h.prototype.linspace=function(u,d,y){return qu(u,d,y)},h.prototype.scatter=function(u,d,y,D,W,X,ae,de,be,Ie){var Re=[D/W,W],Me=this.readSync(u.dataId),qe=this.readSync(d.dataId);if(D===0)return wa([],y,d.dtype);var Je=new Wi(Re,d.dtype);Je.values.fill(this.readSync(be.dataId)[0]);for(var Qe=0;Qe<X;Qe++){for(var ot=[],vt=0,bt=0;bt<ae;bt++){var wt=Me[Qe*ae+bt];ot.push(wt),vt+=wt*de[bt]}if(vt<0||vt>=D/W)throw new Error("Invalid indices: "+ot+" does not index into "+y);for(var Ft=0;Ft<W;Ft++)Ie?Je.values[vt*W+Ft]+=qe[Qe*W+Ft]:Je.values[vt*W+Ft]=d.rank===0?qe[0]:qe[Qe*W+Ft]}return Je.toTensor().reshape(y)},h}(Rf);Ve.registerBackend("cpu",function(){return new E},1);for(var k=0,w=[{kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(v){var h=v.inputs,u=v.backend,d=v.attrs,y=h,D=y.boxes,W=y.scores,X=d,ae=X.maxOutputSize,de=X.iouThreshold,be=X.scoreThreshold,Ie=X.softNmsSigma,Re=u;Ir(D,"NonMaxSuppressionWithScore");var Me=Au(Re.data.get(D.dataId).values,Re.data.get(W.dataId).values,ae,de,be,Ie);return[Me.selectedIndices,Me.selectedScores]}},{kernelName:"Square",backendName:"cpu",kernelFunc:function(v){var h=v.inputs,u=v.backend,d=h.x,y=u;Ir(d,"square");for(var D=y.data.get(d.dataId).values,W=new Float32Array(D.length),X=0;X<D.length;++X){var ae=D[X];W[X]=ae*ae}return{dataId:y.write(W,d.shape,d.dtype),shape:d.shape,dtype:d.dtype}}},{kernelName:qh,backendName:"cpu",kernelFunc:function(v){var h=v.inputs,u=v.backend,d=h,y=d.a,D=d.b,W=u;Ir([y,D],qh);var X=W.data.get(y.dataId).values,ae=W.data.get(D.dataId).values,de=function(Re,Me,qe,Je,Qe,ot){var vt=Hi(Re,Me),bt=vt.length,wt=Cr(vt),Ft=Yn(Qe,Ye(vt)),Yt=Re.length,an=Me.length,Jt=Cr(Re),un=Cr(Me),gn=Go(Re,vt),p=Go(Me,vt);if(gn.length+p.length===0)for(var c=0;c<Ft.length;++c)Ft[c]=ot(qe[c%qe.length],Je[c%Je.length]);else{var a=function(l){var g=gr(l,bt,wt),_=g.slice(-Yt);gn.forEach(function(oe){return _[oe]=0});var j=xr(_,Yt,Jt),V=g.slice(-an);p.forEach(function(oe){return V[oe]=0});var ne=xr(V,an,un);Ft[l]=ot(qe[j],Je[ne])};for(c=0;c<Ft.length;++c)a(c)}return[Ft,vt]}(y.shape,D.shape,X,ae,y.dtype,function(Re,Me){var qe=Re-Me;return qe*qe}),be=de[0],Ie=de[1];return{dataId:W.write(be,Ie,y.dtype),shape:Ie,dtype:y.dtype}}}];k<w.length;k++)pe(w[k]);for(var S,z=0,Y=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(v){var h=v.inputs,u=v.backend,d=v.attrs,y=h.pixels,D=d.numChannels,W=typeof HTMLVideoElement<"u"&&y instanceof HTMLVideoElement,X=typeof HTMLImageElement<"u"&&y instanceof HTMLImageElement,ae=W?[y.videoWidth,y.videoHeight]:[y.width,y.height],de=ae[0],be=ae[1],Ie=[be,de],Re=[be,de,D];(X||W)&&(S==null&&(S=document.createElement("canvas").getContext("2d")),S.canvas.width=de,S.canvas.height=be,S.drawImage(y,0,0,de,be),y=S.canvas);var Me=u.makeTensorInfo(Ie,"int32");u.texData.get(Me.dataId).usage=ir.PIXELS,u.gpgpu.uploadPixelDataToTexture(u.getTexture(Me.dataId),y);var qe=L().getBool("WEBGL_PACK")?new function(Qe){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var ot=te(),vt=Qe[0],bt=Qe[1];this.outputShape=Qe,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(`+bt+".0, "+vt+`.0);
            vec4 values = `+ot.texture2D+`(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        `+ot.output+` = result;
      }
    `}(Re):new function(Qe){this.variableNames=["A"];var ot=te(),vt=Qe[0],bt=Qe[1];this.outputShape=Qe,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+bt+".0, "+vt+`.0);

        vec4 values = `+ot.texture2D+`(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}(Re),Je=u.runWebGLProgram(qe,[Me],"int32");return u.disposeData(Me.dataId),Je}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(v){var h=v.inputs,u=v.backend,d=v.attrs;qc("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var y=h,D=y.boxes,W=y.scores,X=d,ae=X.maxOutputSize,de=X.iouThreshold,be=X.scoreThreshold,Ie=X.softNmsSigma,Re=u,Me=Au(Re.readSync(D.dataId),Re.readSync(W.dataId),ae,de,be,Ie);return[Me.selectedIndices,Me.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(v){var h=v.inputs,u=v.backend,d=h.x,y=u,D=new ci(d.shape,"return x * x;");return y.runWebGLProgram(D,[d],d.dtype)}},{kernelName:qh,backendName:"webgl",kernelFunc:function(v){var h=v.inputs,u=v.backend,d=h,y=d.a,D=d.b,W=u,X=L().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new li("return (a - b) * (a - b);",y.shape,D.shape):new Wr("return (a - b) * (a - b);",y.shape,D.shape);return W.compileAndRun(X,[y,D])}}];z<Y.length;z++)pe(Y[z]);for(var ce=0,ve=[{kernelName:"Square",gradFunc:function(v,h){var u=h[0];return{x:function(){return v.mul(u.toFloat().mul(2))}}}},{kernelName:qh,gradFunc:function(v,h){var u=h[0],d=h[1],y=fr(2);return{a:function(){return ol(v,ol(y,Ic(u,d)))},b:function(){return ol(v,ol(y,Ic(d,u)))}}}}];ce<ve.length;ce++)Ae(ve[ce]);var De=function(){function v(){}return v.prototype.fetch=function(h,u){return fetch(h,u)},v.prototype.now=function(){return performance.now()},v.prototype.encode=function(h,u){if(u!=="utf-8"&&u!=="utf8")throw new Error("Browser's encoder only supports utf-8, but got "+u);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(h)},v.prototype.decode=function(h,u){return new TextDecoder(u).decode(h)},v}();L().get("IS_BROWSER")&&L().setPlatform("browser",new De);var Ce,Xe=function(){function v(){this.util=o(249),this.textEncoder=new this.util.TextEncoder}return v.prototype.fetch=function(h,u){return L().global.fetch!=null?L().global.fetch(h,u):(Ce==null&&(Ce=o(250)),Ce(h,u))},v.prototype.now=function(){var h=H.hrtime();return 1e3*h[0]+h[1]/1e6},v.prototype.encode=function(h,u){if(u!=="utf-8"&&u!=="utf8")throw new Error("Node built-in encoder only supports utf-8, but got "+u);return this.textEncoder.encode(h)},v.prototype.decode=function(h,u){return h.length===0?"":new this.util.TextDecoder(u).decode(h)},v}();L().get("IS_NODE")&&L().setPlatform("node",new Xe);var tt={float32:4,int32:4,uint16:2,uint8:1,bool:1},kt=4;function At(v,h){for(var u={},d=0,y=function(X){var ae=X.name,de=X.dtype,be=X.shape,Ie=Ye(be),Re=void 0;if("quantization"in X){var Me=X.quantization;if(Me.dtype!=="uint8"&&Me.dtype!=="uint16")throw new Error("Weight "+X.name+" has unknown quantization dtype "+Me.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var qe=tt[Me.dtype],Je=v.slice(d,d+Ie*qe),Qe=Me.dtype==="uint8"?new Uint8Array(Je):new Uint16Array(Je);if(de==="float32")Re=Float32Array.from(Qe,function(Yt){return Yt*Me.scale+Me.min});else{if(de!=="int32")throw new Error("Unsupported dtype in weight '"+ae+"': "+de);Re=Int32Array.from(Qe,function(Yt){return Math.round(Yt*Me.scale+Me.min)})}d+=Ie*qe}else if(de==="string"){var ot=Ye(X.shape);Re=[];for(var vt=0;vt<ot;vt++){var bt=new Uint32Array(v.slice(d,d+kt))[0];d+=kt;var wt=new Uint8Array(v.slice(d,d+bt));Re.push(wt),d+=bt}}else{var Ft=tt[de];if(Je=v.slice(d,d+Ie*Ft),de==="float32")Re=new Float32Array(Je);else if(de==="int32")Re=new Int32Array(Je);else{if(de!=="bool")throw new Error("Unsupported dtype in weight '"+ae+"': "+de);Re=new Uint8Array(Je)}d+=Ie*Ft}u[ae]=wa(Re,be,de)},D=0,W=h;D<W.length;D++)y(W[D]);return u}var tn=U!==void 0&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function sn(v){return tn?U.byteLength(v):new Blob([v]).size}function wn(v){var h=0;v.forEach(function(y){h+=y.byteLength});var u=new Uint8Array(h),d=0;return v.forEach(function(y){u.set(new Uint8Array(y),d),d+=y.byteLength}),u.buffer}function En(v){for(v=v.trim();v.endsWith("/");)v=v.slice(0,v.length-1);var h=v.split("/");return h[h.length-1]}function Tn(v){if(v.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:v.modelTopology==null?0:sn(JSON.stringify(v.modelTopology)),weightSpecsBytes:v.weightSpecs==null?0:sn(JSON.stringify(v.weightSpecs)),weightDataBytes:v.weightData==null?0:v.weightData.byteLength}}var Pn=function(){function v(){this.saveRouters=[],this.loadRouters=[]}return v.getInstance=function(){return v.instance==null&&(v.instance=new v),v.instance},v.registerSaveRouter=function(h){v.getInstance().saveRouters.push(h)},v.registerLoadRouter=function(h){v.getInstance().loadRouters.push(h)},v.getSaveHandlers=function(h){return v.getHandlers(h,"save")},v.getLoadHandlers=function(h,u){return v.getHandlers(h,"load",u)},v.getHandlers=function(h,u,d){var y=[];return(u==="load"?v.getInstance().loadRouters:v.getInstance().saveRouters).forEach(function(D){var W=D(h,d);W!==null&&y.push(W)}),y},v}(),dn="://",cr=function(){function v(){this.managers={}}return v.getInstance=function(){return v.instance==null&&(v.instance=new v),v.instance},v.registerManager=function(h,u){we(h!=null,function(){return"scheme must not be undefined or null."}),h.endsWith(dn)&&(h=h.slice(0,h.indexOf(dn))),we(h.length>0,function(){return"scheme must not be an empty string."});var d=v.getInstance();we(d.managers[h]==null,function(){return"A model store manager is already registered for scheme '"+h+"'."}),d.managers[h]=u},v.getManager=function(h){var u=this.getInstance().managers[h];if(u==null)throw new Error("Cannot find model manager for scheme '"+h+"'");return u},v.getSchemes=function(){return Object.keys(this.getInstance().managers)},v}();function kr(v){if(v.indexOf(dn)===-1)throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+cr.getSchemes().join(","));return{scheme:v.split(dn)[0],path:v.split(dn)[1]}}function yr(v,h,u){return u===void 0&&(u=!1),R(this,void 0,void 0,function(){var d,y,D,W,X,ae,de,be,Ie;return P(this,function(Re){switch(Re.label){case 0:return we(v!==h,function(){return"Old path and new path are the same: '"+v+"'"}),we((d=Pn.getLoadHandlers(v)).length>0,function(){return"Copying failed because no load handler is found for source URL "+v+"."}),we(d.length<2,function(){return"Copying failed because more than one ("+d.length+") load handlers for source URL "+v+"."}),y=d[0],we((D=Pn.getSaveHandlers(h)).length>0,function(){return"Copying failed because no save handler is found for destination URL "+h+"."}),we(D.length<2,function(){return"Copying failed because more than one ("+d.length+") save handlers for destination URL "+h+"."}),W=D[0],X=kr(v).scheme,ae=kr(v).path,de=X===kr(v).scheme,[4,y.load()];case 1:return be=Re.sent(),u&&de?[4,cr.getManager(X).removeModel(ae)]:[3,3];case 2:Re.sent(),Re.label=3;case 3:return[4,W.save(be)];case 4:return Ie=Re.sent(),!u||de?[3,6]:[4,cr.getManager(X).removeModel(ae)];case 5:Re.sent(),Re.label=6;case 6:return[2,Ie.modelArtifactsInfo]}})})}var Br="models_store",_r="model_info_store";function hi(){if(!L().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var v=window||self,h=v.indexedDB||v.mozIndexedDB||v.webkitIndexedDB||v.msIndexedDB||v.shimIndexedDB;if(h==null)throw new Error("The current browser does not appear to support IndexedDB.");return h}function Ei(v){var h=v.result;h.createObjectStore(Br,{keyPath:"modelPath"}),h.createObjectStore(_r,{keyPath:"modelPath"})}var xi=function(){function v(h){if(this.indexedDB=hi(),h==null||!h)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=h}return v.prototype.save=function(h){return R(this,void 0,void 0,function(){return P(this,function(u){if(h.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,h)]})})},v.prototype.load=function(){return R(this,void 0,void 0,function(){return P(this,function(h){return[2,this.databaseAction(this.modelPath)]})})},v.prototype.databaseAction=function(h,u){var d=this;return new Promise(function(y,D){var W=d.indexedDB.open("tensorflowjs",1);W.onupgradeneeded=function(){return Ei(W)},W.onsuccess=function(){var X=W.result;if(u==null){var ae=X.transaction(Br,"readonly"),de=ae.objectStore(Br).get(d.modelPath);de.onsuccess=function(){if(de.result==null)return X.close(),D(new Error("Cannot find model with path '"+d.modelPath+"' in IndexedDB."));y(de.result.modelArtifacts)},de.onerror=function(Je){return X.close(),D(de.error)},ae.oncomplete=function(){return X.close()}}else{var be,Ie=Tn(u),Re=X.transaction(_r,"readwrite"),Me=Re.objectStore(_r),qe=Me.put({modelPath:d.modelPath,modelArtifactsInfo:Ie});qe.onsuccess=function(){var Je=(be=X.transaction(Br,"readwrite")).objectStore(Br).put({modelPath:d.modelPath,modelArtifacts:u,modelArtifactsInfo:Ie});Je.onsuccess=function(){return y({modelArtifactsInfo:Ie})},Je.onerror=function(Qe){var ot=(Me=Re.objectStore(_r)).delete(d.modelPath);ot.onsuccess=function(){return X.close(),D(Je.error)},ot.onerror=function(vt){return X.close(),D(Je.error)}}},qe.onerror=function(Je){return X.close(),D(qe.error)},Re.oncomplete=function(){be==null?X.close():be.oncomplete=function(){return X.close()}}}},W.onerror=function(X){return D(W.error)}})},v.URL_SCHEME="indexeddb://",v}(),ya=function(v){return L().getBool("IS_BROWSER")&&!Array.isArray(v)&&v.startsWith(xi.URL_SCHEME)?(h=v.slice(xi.URL_SCHEME.length),new xi(h)):null;var h};Pn.registerSaveRouter(ya),Pn.registerLoadRouter(ya);var Ua=function(){function v(){this.indexedDB=hi()}return v.prototype.listModels=function(){return R(this,void 0,void 0,function(){var h=this;return P(this,function(u){return[2,new Promise(function(d,y){var D=h.indexedDB.open("tensorflowjs",1);D.onupgradeneeded=function(){return Ei(D)},D.onsuccess=function(){var W=D.result,X=W.transaction(_r,"readonly"),ae=X.objectStore(_r).getAll();ae.onsuccess=function(){for(var de={},be=0,Ie=ae.result;be<Ie.length;be++){var Re=Ie[be];de[Re.modelPath]=Re.modelArtifactsInfo}d(de)},ae.onerror=function(de){return W.close(),y(ae.error)},X.oncomplete=function(){return W.close()}},D.onerror=function(W){return y(D.error)}})]})})},v.prototype.removeModel=function(h){return R(this,void 0,void 0,function(){var u=this;return P(this,function(d){var y;return h=(y=h).startsWith(xi.URL_SCHEME)?y.slice(xi.URL_SCHEME.length):y,[2,new Promise(function(D,W){var X=u.indexedDB.open("tensorflowjs",1);X.onupgradeneeded=function(){return Ei(X)},X.onsuccess=function(){var ae,de=X.result,be=de.transaction(_r,"readwrite"),Ie=be.objectStore(_r),Re=Ie.get(h);Re.onsuccess=function(){if(Re.result==null)return de.close(),W(new Error("Cannot find model with path '"+h+"' in IndexedDB."));var Me=Ie.delete(h),qe=function(){var Je=(ae=de.transaction(Br,"readwrite")).objectStore(Br).delete(h);Je.onsuccess=function(){return D(Re.result.modelArtifactsInfo)},Je.onerror=function(Qe){return W(Re.error)}};Me.onsuccess=qe,Me.onerror=function(Je){return qe(),de.close(),W(Re.error)}},Re.onerror=function(Me){return de.close(),W(Re.error)},be.oncomplete=function(){ae==null?de.close():ae.oncomplete=function(){return de.close()}}},X.onerror=function(ae){return W(X.error)}})]})})},v}();if(L().getBool("IS_BROWSER"))try{cr.registerManager(xi.URL_SCHEME,new Ua)}catch{}var Ta="/",Da="tensorflowjs_models",Ra="info",Qa="model_topology",oo="weight_specs",wo="weight_data",Ks="model_metadata";function Ti(v){return{info:[Da,v,Ra].join(Ta),topology:[Da,v,Qa].join(Ta),weightSpecs:[Da,v,oo].join(Ta),weightData:[Da,v,wo].join(Ta),modelMetadata:[Da,v,Ks].join(Ta)}}function Ho(v){var h=v.split(Ta);if(h.length<3)throw new Error("Invalid key format: "+v);return h.slice(1,h.length-1).join(Ta)}var Yo=function(){function v(h){if(!L().getBool("IS_BROWSER")||typeof window>"u"||window.localStorage===void 0)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,h==null||!h)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=h,this.keys=Ti(this.modelPath)}return v.prototype.save=function(h){return R(this,void 0,void 0,function(){var u,d,y;return P(this,function(D){if(h.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");u=JSON.stringify(h.modelTopology),d=JSON.stringify(h.weightSpecs),y=Tn(h);try{return this.LS.setItem(this.keys.info,JSON.stringify(y)),this.LS.setItem(this.keys.topology,u),this.LS.setItem(this.keys.weightSpecs,d),this.LS.setItem(this.keys.weightData,function(W){if(tn)return U.from(W).toString("base64");for(var X=new Uint8Array(W),ae="",de=0,be=X.length;de<be;de++)ae+=String.fromCharCode(X[de]);return btoa(ae)}(h.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:h.format,generatedBy:h.generatedBy,convertedBy:h.convertedBy,userDefinedMetadata:h.userDefinedMetadata})),[2,{modelArtifactsInfo:y}]}catch{throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+y.modelTopologyBytes+", weightSpecsBytes="+y.weightSpecsBytes+", weightDataBytes="+y.weightDataBytes+".")}return[2]})})},v.prototype.load=function(){return R(this,void 0,void 0,function(){var h,u,d,y,D,W,X;return P(this,function(ae){if((h=JSON.parse(this.LS.getItem(this.keys.info)))==null)throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if(h.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(u={},(d=JSON.parse(this.LS.getItem(this.keys.topology)))==null)throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(u.modelTopology=d,(y=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))==null)throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(u.weightSpecs=y,(D=this.LS.getItem(this.keys.modelMetadata))!=null&&(W=JSON.parse(D),u.format=W.format,u.generatedBy=W.generatedBy,u.convertedBy=W.convertedBy,u.userDefinedMetadata=W.userDefinedMetadata),(X=this.LS.getItem(this.keys.weightData))==null)throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return u.weightData=function(de){if(tn){var be=U.from(de,"base64");return be.buffer.slice(be.byteOffset,be.byteOffset+be.byteLength)}for(var Ie=atob(de),Re=new Uint8Array(Ie.length),Me=0;Me<Ie.length;++Me)Re.set([Ie.charCodeAt(Me)],Me);return Re.buffer}(X),[2,u]})})},v.URL_SCHEME="localstorage://",v}(),Xs=function(v){return L().getBool("IS_BROWSER")&&!Array.isArray(v)&&v.startsWith(Yo.URL_SCHEME)?(h=v.slice(Yo.URL_SCHEME.length),new Yo(h)):null;var h};Pn.registerSaveRouter(Xs),Pn.registerLoadRouter(Xs);var Ds=function(){function v(){we(L().getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),we(typeof window>"u"||window.localStorage!==void 0,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return v.prototype.listModels=function(){return R(this,void 0,void 0,function(){var h,u,d,y,D,W;return P(this,function(X){for(h={},u=Da+Ta,d=Ta+Ra,y=0;y<this.LS.length;++y)(D=this.LS.key(y)).startsWith(u)&&D.endsWith(d)&&(W=Ho(D),h[W]=JSON.parse(this.LS.getItem(D)));return[2,h]})})},v.prototype.removeModel=function(h){return R(this,void 0,void 0,function(){var u,d;return P(this,function(y){var D;if(h=(D=h).startsWith(Yo.URL_SCHEME)?D.slice(Yo.URL_SCHEME.length):D,u=Ti(h),this.LS.getItem(u.info)==null)throw new Error("Cannot find model at path '"+h+"'");return d=JSON.parse(this.LS.getItem(u.info)),this.LS.removeItem(u.info),this.LS.removeItem(u.topology),this.LS.removeItem(u.weightSpecs),this.LS.removeItem(u.weightData),[2,d]})})},v}();if(L().getBool("IS_BROWSER"))try{cr.registerManager(Yo.URL_SCHEME,new Ds)}catch{}var du="model",Iu=".json",pu=".weights.bin";function od(v){return new Promise(function(h){return setTimeout(h)}).then(v)}var rh=function(){function v(h){if(!L().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");h.startsWith(v.URL_SCHEME)&&(h=h.slice(v.URL_SCHEME.length)),h!=null&&h.length!==0||(h=du),this.modelTopologyFileName=h+Iu,this.weightDataFileName=h+pu}return v.prototype.save=function(h){return R(this,void 0,void 0,function(){var u,d,y,D,W,X;return P(this,function(ae){switch(ae.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(u=window.URL.createObjectURL(new Blob([h.weightData],{type:"application/octet-stream"})),!(h.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return d=[{paths:["./"+this.weightDataFileName],weights:h.weightSpecs}],y={modelTopology:h.modelTopology,format:h.format,generatedBy:h.generatedBy,convertedBy:h.convertedBy,weightsManifest:d},D=window.URL.createObjectURL(new Blob([JSON.stringify(y)],{type:"application/json"})),(W=this.jsonAnchor==null?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,W.href=D,[4,od(function(){return W.dispatchEvent(new MouseEvent("click"))})];case 2:return ae.sent(),h.weightData==null?[3,4]:((X=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,X.href=u,[4,od(function(){return X.dispatchEvent(new MouseEvent("click"))})]);case 3:ae.sent(),ae.label=4;case 4:return[2,{modelArtifactsInfo:Tn(h)}]}})})},v.URL_SCHEME="downloads://",v}(),hl=function(){function v(h){if(h==null||h.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+h);this.files=h}return v.prototype.load=function(){return R(this,void 0,void 0,function(){var h,u,d=this;return P(this,function(y){return h=this.files[0],u=this.files.slice(1),[2,new Promise(function(D,W){var X=new FileReader;X.onload=function(ae){var de=JSON.parse(ae.target.result),be=de.modelTopology;if(be!=null){u.length===0&&D({modelTopology:be});var Ie=de.weightsManifest;if(Ie!=null){var Re;try{Re=d.checkManifestAndWeightFiles(Ie,u)}catch(Qe){return void W(Qe)}var Me=[],qe=[],Je=[];Ie.forEach(function(Qe){Qe.paths.forEach(function(ot){qe.push(ot),Je.push(null)}),Me.push.apply(Me,Qe.weights)}),Ie.forEach(function(Qe){Qe.paths.forEach(function(ot){var vt=new FileReader;vt.onload=function(bt){var wt=bt.target.result,Ft=qe.indexOf(ot);Je[Ft]=wt,Je.indexOf(null)===-1&&D({modelTopology:be,weightSpecs:Me,weightData:wn(Je),format:de.format,generatedBy:de.generatedBy,convertedBy:de.convertedBy,userDefinedMetadata:de.userDefinedMetadata})},vt.onerror=function(bt){return W("Failed to weights data from file of path '"+ot+"'.")},vt.readAsArrayBuffer(Re[ot])})})}else W(new Error("weightManifest field is missing from file "+h.name))}else W(new Error("modelTopology field is missing from file "+h.name))},X.onerror=function(ae){return W("Failed to read model topology and weights manifest JSON from file '"+h.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},X.readAsText(h)})]})})},v.prototype.checkManifestAndWeightFiles=function(h,u){for(var d=[],y=u.map(function(ae){return En(ae.name)}),D={},W=0,X=h;W<X.length;W++)X[W].paths.forEach(function(ae){var de=En(ae);if(d.indexOf(de)!==-1)throw new Error("Duplicate file basename found in weights manifest: '"+de+"'");if(d.push(de),y.indexOf(de)===-1)throw new Error("Weight file with basename '"+de+"' is not provided.");D[ae]=u[y.indexOf(de)]});if(d.length!==u.length)throw new Error("Mismatch in the number of files in weights manifest ("+d.length+") and the number of weight files provided ("+u.length+").");return D},v}();function tf(v,h,u,d){(function(D){we(D!=null&&Array.isArray(D)&&D.length>0,function(){return"promises must be a none empty array"})})(v),function(D,W){we(D>=0&&D<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+D}),we(W>=0&&W<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+W}),we(W>=D,function(){return"startFraction must be no more than endFraction, but got startFraction "+D+" and endFraction "+W})}(u=u??0,d=d??1);var y=0;return Promise.all(v.map(function(D){return D.then(function(W){var X=u+ ++y/v.length*(d-u);return h(X),W}),D}))}function dl(v,h){return R(this,void 0,void 0,function(){var u,d,y,D,W,X,ae,de,be;return P(this,function(Ie){switch(Ie.label){case 0:return h==null&&(h={}),u=h.fetchFunc==null?L().platform.fetch:h.fetchFunc,d=v.map(function(Re){return u(Re,h.requestInit,{isBinary:!0})}),y=0,D=.5,h.onProgress!=null?[3,2]:[4,Promise.all(d)];case 1:return W=Ie.sent(),[3,4];case 2:return[4,tf(d,h.onProgress,y,D)];case 3:W=Ie.sent(),Ie.label=4;case 4:return X=W.map(function(Re){return Re.arrayBuffer()}),ae=.5,de=1,h.onProgress!=null?[3,6]:[4,Promise.all(X)];case 5:return be=Ie.sent(),[3,8];case 6:return[4,tf(X,h.onProgress,ae,de)];case 7:be=Ie.sent(),Ie.label=8;case 8:return[2,be]}})})}function Gu(v){var h=this;return function(u,d,y){return d===void 0&&(d=""),R(h,void 0,void 0,function(){var D,W,X,ae,de,be,Ie,Re,Me,qe;return P(this,function(Je){switch(Je.label){case 0:if(D=u.map(function(){return!1}),W={},X=y!=null?y.map(function(){return!1}):[],ae=[],u.forEach(function(Qe,ot){var vt=0;Qe.weights.forEach(function(bt){var wt="quantization"in bt?bt.quantization.dtype:bt.dtype,Ft=tt[wt]*Ye(bt.shape),Yt=function(){D[ot]=!0,W[ot]==null&&(W[ot]=[]),W[ot].push({manifestEntry:bt,groupOffset:vt,sizeBytes:Ft})};y!=null?y.forEach(function(an,Jt){an===bt.name&&(Yt(),X[Jt]=!0)}):Yt(),ae.push(bt.name),vt+=Ft})}),!X.every(function(Qe){return Qe}))throw de=y.filter(function(Qe,ot){return!X[ot]}),new Error("Could not find weights in manifest with names: "+de.join(", ")+`. 
Manifest JSON has weights with names: `+ae.join(", ")+".");return be=D.reduce(function(Qe,ot,vt){return ot&&Qe.push(vt),Qe},[]),Ie=[],be.forEach(function(Qe){u[Qe].paths.forEach(function(ot){var vt=d+(d.endsWith("/")?"":"/")+ot;Ie.push(vt)})}),[4,v(Ie)];case 1:return Re=Je.sent(),Me={},qe=0,be.forEach(function(Qe){for(var ot=u[Qe].paths.length,vt=0,bt=0;bt<ot;bt++)vt+=Re[qe+bt].byteLength;for(var wt=new ArrayBuffer(vt),Ft=new Uint8Array(wt),Yt=0,an=0;an<ot;an++){var Jt=new Uint8Array(Re[qe+an]);Ft.set(Jt,Yt),Yt+=Jt.byteLength}W[Qe].forEach(function(un){var gn=At(wt.slice(un.groupOffset,un.groupOffset+un.sizeBytes),[un.manifestEntry]);for(var p in gn)Me[p]=gn[p]}),qe+=ot}),[2,Me]}})})}}Pn.registerSaveRouter(function(v){return L().getBool("IS_BROWSER")&&!Array.isArray(v)&&v.startsWith(rh.URL_SCHEME)?function(h){return h===void 0&&(h="model"),new rh(h)}(v.slice(rh.URL_SCHEME.length)):null});var jo=function(){function v(h,u){if(this.DEFAULT_METHOD="POST",u==null&&(u={}),this.weightPathPrefix=u.weightPathPrefix,this.onProgress=u.onProgress,u.fetchFunc!=null?(we(typeof u.fetchFunc=="function",function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=u.fetchFunc):this.fetch=L().platform.fetch,we(h!=null&&h.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(h)&&we(h.length===2,function(){return"URL paths for http must have a length of 2, (actual length is "+h.length+")."}),this.path=h,u.requestInit!=null&&u.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=u.requestInit||{}}return v.prototype.save=function(h){return R(this,void 0,void 0,function(){var u,d,y,D;return P(this,function(W){switch(W.label){case 0:if(h.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(u=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,d=[{paths:["./model.weights.bin"],weights:h.weightSpecs}],y={modelTopology:h.modelTopology,format:h.format,generatedBy:h.generatedBy,convertedBy:h.convertedBy,userDefinedMetadata:h.userDefinedMetadata,weightsManifest:d},u.body.append("model.json",new Blob([JSON.stringify(y)],{type:"application/json"}),"model.json"),h.weightData!=null&&u.body.append("model.weights.bin",new Blob([h.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,u)];case 1:if((D=W.sent()).ok)return[2,{modelArtifactsInfo:Tn(h),responses:[D]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+D.status+".")}})})},v.prototype.load=function(){return R(this,void 0,void 0,function(){var h,u,d,y,D,W,X,ae,de,be,Ie,Re;return P(this,function(Me){switch(Me.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(h=Me.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+h.status+". Please verify this URL points to the model JSON of the model to load.");Me.label=2;case 2:return Me.trys.push([2,4,,5]),[4,h.json()];case 3:return u=Me.sent(),[3,5];case 4:throw Me.sent(),d="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?d+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":d+=" Please make sure the server is serving valid JSON for this request.",new Error(d);case 5:if(y=u.modelTopology,D=u.weightsManifest,W=u.generatedBy,X=u.convertedBy,ae=u.format,de=u.userDefinedMetadata,y==null&&D==null)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return D==null?[3,7]:[4,this.loadWeights(D)];case 6:Re=Me.sent(),be=Re[0],Ie=Re[1],Me.label=7;case 7:return[2,{modelTopology:y,weightSpecs:be,weightData:Ie,userDefinedMetadata:de,generatedBy:W,convertedBy:X,format:ae}]}})})},v.prototype.loadWeights=function(h){return R(this,void 0,void 0,function(){var u,d,y,D,W,X,ae,de,be,Ie,Re;return P(this,function(Me){switch(Me.label){case 0:for(u=Array.isArray(this.path)?this.path[1]:this.path,d=function(qe){var Je=qe.lastIndexOf("/"),Qe=qe.lastIndexOf("?");return[qe.substring(0,Je)+"/",Qe>Je?qe.substring(Qe):""]}(u),y=d[0],D=d[1],W=this.weightPathPrefix||y,X=[],ae=0,de=h;ae<de.length;ae++)be=de[ae],X.push.apply(X,be.weights);return Ie=[],h.forEach(function(qe){qe.paths.forEach(function(Je){Ie.push(W+Je+D)})}),[4,dl(Ie,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return Re=Me.sent(),[2,[X,wn(Re)]]}})})},v.URL_SCHEME_REGEX=/^https?:\/\//,v}();function nf(v){return v.match(jo.URL_SCHEME_REGEX)!=null}var ih=function(v,h){return typeof fetch>"u"?null:(Array.isArray(v)?v.every(function(u){return nf(u)}):nf(v))?sd(v,{onProgress:h}):null};function sd(v,h){return new jo(v,h)}Pn.registerSaveRouter(ih),Pn.registerLoadRouter(ih);var rf,ds=function(){function v(h){this.modelArtifacts=h}return v.prototype.load=function(){return R(this,void 0,void 0,function(){return P(this,function(h){return[2,this.modelArtifacts]})})},v}(),ah=function(){function v(h){this.saveHandler=h}return v.prototype.save=function(h){return R(this,void 0,void 0,function(){return P(this,function(u){return[2,this.saveHandler(h)]})})},v}(),ud=Object.freeze({browserFiles:function(v){return new hl(v)},browserHTTPRequest:function(v,h){return sd(v,h)},concatenateArrayBuffers:wn,decodeWeights:At,encodeWeights:function(v,h){return R(this,void 0,void 0,function(){var u,d,y,D,W,X=this;return P(this,function(ae){switch(ae.label){case 0:for(u=[],d=[],y=Array.isArray(v)?v.map(function(de){return de.name}):Object.keys(v),D=function(de){var be=y[de],Ie=Array.isArray(v)?v[de].tensor:v[be];if(Ie.dtype!=="float32"&&Ie.dtype!=="int32"&&Ie.dtype!=="bool"&&Ie.dtype!=="string")throw new Error("Unsupported dtype in weight '"+be+"': "+Ie.dtype);var Re={name:be,shape:Ie.shape,dtype:Ie.dtype};if(Ie.dtype==="string"){var Me=new Promise(function(qe){return R(X,void 0,void 0,function(){var Je,Qe,ot,vt,bt,wt,Ft;return P(this,function(Yt){switch(Yt.label){case 0:return[4,Ie.bytes()];case 1:for(Je=Yt.sent(),Qe=Je.reduce(function(an,Jt){return an+Jt.length},0)+kt*Je.length,ot=new Uint8Array(Qe),vt=0,bt=0;bt<Je.length;bt++)wt=Je[bt],Ft=new Uint8Array(new Uint32Array([wt.length]).buffer),ot.set(Ft,vt),vt+=kt,ot.set(wt,vt),vt+=wt.length;return qe(ot),[2]}})})});d.push(Me)}else d.push(Ie.data());h!=null&&(Re.group=h),u.push(Re)},W=0;W<y.length;++W)D(W);return[4,Promise.all(d)];case 1:return[2,{data:function(de){if(de===null)throw new Error("Invalid input value: "+JSON.stringify(de));var be=0,Ie=[];de.forEach(function(qe){if(be+=qe.byteLength,Ie.push(qe.byteLength===qe.buffer.byteLength?qe:new qe.constructor(qe)),!(qe instanceof Float32Array||qe instanceof Int32Array||qe instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+qe.constructor.name)});var Re=new Uint8Array(be),Me=0;return Ie.forEach(function(qe){Re.set(new Uint8Array(qe.buffer),Me),Me+=qe.byteLength}),Re.buffer}(ae.sent()),specs:u}]}})})},fromMemory:function(v,h,u,d){return arguments.length===1?v.modelTopology!=null||v.weightSpecs!=null?new ds(v):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new ds({modelTopology:v})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new ds({modelTopology:v,weightSpecs:h,weightData:u,trainingConfig:d}))},getLoadHandlers:function(v,h){return Pn.getLoadHandlers(v,h)},getModelArtifactsInfoForJSON:Tn,getSaveHandlers:function(v){return Pn.getSaveHandlers(v)},http:sd,isHTTPScheme:nf,loadWeights:function(v,h,u,d){return h===void 0&&(h=""),R(this,void 0,void 0,function(){return P(this,function(y){return[2,Gu(function(D){return dl(D,{requestInit:d})})(v,h,u)]})})},registerLoadRouter:function(v){return Pn.registerLoadRouter(v)},registerSaveRouter:function(v){return Pn.registerSaveRouter(v)},weightsLoaderFactory:Gu,withSaveHandler:function(v){return new ah(v)},copyModel:function(v,h){return R(this,void 0,void 0,function(){return P(this,function(u){return[2,yr(v,h,!1)]})})},listModels:function(){return R(this,void 0,void 0,function(){var v,h,u,d,y,D,W;return P(this,function(X){switch(X.label){case 0:v=cr.getSchemes(),h={},u=0,d=v,X.label=1;case 1:return u<d.length?(y=d[u],[4,cr.getManager(y).listModels()]):[3,4];case 2:for(W in D=X.sent())h[y+dn+W]=D[W];X.label=3;case 3:return u++,[3,1];case 4:return[2,h]}})})},moveModel:function(v,h){return R(this,void 0,void 0,function(){return P(this,function(u){return[2,yr(v,h,!0)]})})},removeModel:function(v){return R(this,void 0,void 0,function(){var h;return P(this,function(u){return h=kr(v),[2,cr.getManager(h.scheme).removeModel(h.path)]})})}}),cd=xt({confusionMatrix_:function(v,h,u){var d=Ke(v,"labels","confusionMatrix"),y=Ke(h,"predictions","confusionMatrix");we(u==null||u>0&&Number.isInteger(u),function(){return"If provided, numClasses must be a positive integer, but got "+u}),we(d.rank===1,function(){return"Expected the rank of labels to be 1, but got "+d.rank}),we(y.rank===1,function(){return"Expected the rank of predictions to be 1, but got "+y.rank}),we(d.shape[0]===y.shape[0],function(){return"Mismatch in the number of examples: "+d.shape[0]+" vs. "+y.shape[0]+". Labels and predictions should have the same number of elements."}),we(u>0&&Number.isInteger(u),function(){return"numClasses is required to be a positive integer, but got "+u});var D=Ph(d.asType("int32"),u),W=Ph(y.asType("int32"),u);return D.transpose().matMul(W).asType("int32")}}),jc=Object.freeze({confusionMatrix:cd}),xp=xt({fromPixels_:function(v,h){if(h===void 0&&(h=3),h>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(v==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var u=!1,d=!1,y=!1,D=!1,W=!1;if(v.data instanceof Uint8Array)u=!0;else if(typeof ImageData<"u"&&v instanceof ImageData)d=!0;else if(typeof HTMLVideoElement<"u"&&v instanceof HTMLVideoElement)y=!0;else if(typeof HTMLImageElement<"u"&&v instanceof HTMLImageElement)D=!0;else{if(v.getContext==null)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+v.constructor.name);W=!0}if(y&&y&&v.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(ie("FromPixels",Ve.backendName)!=null)return Ve.runKernel("FromPixels",{pixels:v},{numChannels:h});var X,ae,de=y?[v.videoWidth,v.videoHeight]:[v.width,v.height],be=de[0],Ie=de[1];if(W?X=v.getContext("2d").getImageData(0,0,be,Ie).data:d||u?X=v.data:(D||y)&&(rf==null&&(rf=document.createElement("canvas").getContext("2d")),rf.canvas.width=be,rf.canvas.height=Ie,rf.drawImage(v,0,0,be,Ie),X=rf.getImageData(0,0,be,Ie).data),h===4)ae=new Int32Array(X);else{var Re=be*Ie;ae=new Int32Array(Re*h);for(var Me=0;Me<Re;Me++)for(var qe=0;qe<h;++qe)ae[Me*h+qe]=X[4*Me+qe]}return Hc(ae,[Ie,be,h],"int32")}}),Ku=Object.freeze({toPixels:function(v,h){return R(this,void 0,void 0,function(){var u,d,y,D,W,X,ae,de,be,Ie,Re,Me,qe,Je,Qe,ot,vt,bt,wt,Ft,Yt,an,Jt;return P(this,function(un){switch(un.label){case 0:if(u=Ke(v,"img","toPixels"),v instanceof jt||(u=u.toInt()),u.rank!==2&&u.rank!==3)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+u.rank+".");if(d=u.shape.slice(0,2),y=d[0],D=d[1],(W=u.rank===2?1:u.shape[2])>4||W===2)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+W);return[4,u.data()];case 1:return X=un.sent(),ae=u.min(),de=u.max(),[4,Promise.all([ae.data(),de.data()])];case 2:if(be=un.sent(),Ie=be[0],Re=be[1],Me=Ie[0],qe=Re[0],ae.dispose(),de.dispose(),u.dtype==="float32"){if(Me<0||qe>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+Me+" - "+qe+"].")}else{if(u.dtype!=="int32")throw new Error("Unsupported type for toPixels: "+u.dtype+". Please use float32 or int32 tensors.");if(Me<0||qe>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+Me+" - "+qe+"].")}for(Je=u.dtype==="float32"?255:1,Qe=new Uint8ClampedArray(D*y*4),ot=0;ot<y*D;++ot)vt=void 0,bt=void 0,wt=void 0,Ft=void 0,W===1?(vt=X[ot]*Je,bt=X[ot]*Je,wt=X[ot]*Je,Ft=255):W===3?(vt=X[3*ot]*Je,bt=X[3*ot+1]*Je,wt=X[3*ot+2]*Je,Ft=255):W===4&&(vt=X[4*ot]*Je,bt=X[4*ot+1]*Je,wt=X[4*ot+2]*Je,Ft=X[4*ot+3]*Je),Qe[0+(Yt=4*ot)]=Math.round(vt),Qe[Yt+1]=Math.round(bt),Qe[Yt+2]=Math.round(wt),Qe[Yt+3]=Math.round(Ft);return h!=null&&(h.width=D,h.height=y,an=h.getContext("2d"),Jt=new ImageData(Qe,D,y),an.putImageData(Jt,0,0)),u!==v&&u.dispose(),[2,Qe]}})})},fromPixels:xp}),Ts=function(){function v(){}return v.prototype.getClassName=function(){return this.constructor.className},v.fromConfig=function(h,u){return new h(u)},v}(),Fu=function(){function v(){this.classNameMap={}}return v.getMap=function(){return v.instance==null&&(v.instance=new v),v.instance},v.register=function(h){v.getMap().classNameMap[h.className]=[h,h.fromConfig]},v}();function ps(v){we(v.className!=null,function(){return"Class being registered does not have the static className property defined."}),we(typeof v.className=="string",function(){return"className is required to be a string, but got type "+typeof v.className}),we(v.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),Fu.register(v)}var pl=Object.freeze({Serializable:Ts,SerializationMap:Fu,registerClass:ps}),oh=.001,ld=.1;function sh(){return Ve.backend.floatPrecision()===32?oh:ld}function wp(v,h,u){var d=!0;if((Et(v)||Et(h))&&(d=!1),Et(v)&&Et(h)&&(d=!0),d){var y=v.constructor.name,D=h.constructor.name;if(y!==D)throw new Error("Arrays are of different type. Actual: "+y+". Expected: "+D)}if(Array.isArray(v)&&Array.isArray(h)){var W=zo(v),X=zo(h);if(!ln(W,X))throw new Error("Arrays have different shapes. Actual: ["+W+"]. Expected: ["+X+"]")}var ae=Et(v)?v:Pt(v),de=Et(h)?h:Pt(h);if(ae.length!==de.length)throw new Error("Arrays have different lengths actual: "+ae.length+" vs expected: "+de.length+`.
Actual:   `+ae+`.
Expected: `+de+".");for(var be=0;be<de.length;++be){var Ie=ae[be],Re=de[be];if(!u(Ie,Re))throw new Error("Arrays differ: actual["+be+"] = "+Ie+", expected["+be+"] = "+Re+`.
Actual:   `+ae+`.
Expected: `+de+".")}}function ml(v,h,u){return!isFinite(v)&&!isFinite(h)||!(isNaN(v)||isNaN(h)||Math.abs(v-h)>u)}var ru=Object.freeze({TEST_EPSILON_FLOAT16:ld,expectArraysClose:function(v,h,u){return u==null&&(u=sh()),wp(v,h,function(d,y){return ml(d,y,u)})},testEpsilon:sh,expectPromiseToFail:function(v,h){v().then(function(){return h.fail()},function(){return h()})},expectArraysEqual:function(v,h){var u=typeof h=="string"||typeof h=="number"||typeof h=="boolean"?[h]:h;return Sn(v)||Sn(v[0])||Sn(h)||Sn(h[0])?wp(v,u,function(d,y){return d==y}):wp(v,h,function(d,y){return ml(d,y,0)})},expectNumbersClose:function(v,h,u){if(u==null&&(u=sh()),!ml(v,h,u))throw new Error("Numbers differ: actual === "+v+", expected === "+h)},expectValuesInRange:function(v,h,u){for(var d=0;d<v.length;d++)if(v[d]<h||v[d]>u)throw new Error("Value out of range:"+v[d]+" low: "+h+", high: "+u)},expectArrayBuffersEqual:function(v,h){expect(new Float32Array(v)).toEqual(new Float32Array(h))}}),C0="1.7.0",gl=Object.freeze({gpgpu_util:lu,webgl_util:Ef,forceHalfFloat:function(){L().set("WEBGL_FORCE_F16_TEXTURES",!0)},MathBackendWebGL:Tv,setWebGLContext:la,GPGPUContext:ao}),fd=function(v){function h(){return v!==null&&v.apply(this,arguments)||this}return J(h,v),h.prototype.minimize=function(u,d,y){d===void 0&&(d=!1);var D=this.computeGradients(u,y),W=D.value,X=D.grads;if(y!=null){var ae=y.map(function(de){return{name:de.name,tensor:X[de.name]}});this.applyGradients(ae)}else this.applyGradients(X);return Na(X),d?W:(W.dispose(),null)},Object.defineProperty(h.prototype,"iterations",{get:function(){return this.iterations_==null&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),h.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},h.prototype.computeGradients=function(u,d){return en(u,d)},h.prototype.dispose=function(){this.iterations_!=null&&Na(this.iterations_)},h.prototype.saveIterations=function(){return R(this,void 0,void 0,function(){return P(this,function(u){return this.iterations_==null&&(this.iterations_=0),[2,{name:"iter",tensor:fr(this.iterations_,"int32")}]})})},h.prototype.getWeights=function(){return R(this,void 0,void 0,function(){return P(this,function(u){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},h.prototype.setWeights=function(u){return R(this,void 0,void 0,function(){return P(this,function(d){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())})})},h.prototype.extractIterations=function(u){return R(this,void 0,void 0,function(){var d;return P(this,function(y){switch(y.label){case 0:return d=this,[4,u[0].tensor.data()];case 1:return d.iterations_=y.sent()[0],[2,u.slice(1)]}})})},h}(Ts);Object.defineProperty(fd,Symbol.hasInstance,{value:function(v){return v.minimize!=null&&v.computeGradients!=null&&v.applyGradients!=null}});var O0=function(v){function h(u,d,y){y===void 0&&(y=null);var D=v.call(this)||this;return D.learningRate=u,D.rho=d,D.epsilon=y,D.accumulatedGrads=[],D.accumulatedUpdates=[],y==null&&(D.epsilon=Ve.backend.epsilon()),D}return J(h,v),h.prototype.applyGradients=function(u){var d=this;(Array.isArray(u)?u.map(function(y){return y.name}):Object.keys(u)).forEach(function(y,D){var W=Ve.registeredVariables[y];d.accumulatedGrads[D]==null&&(d.accumulatedGrads[D]={originalName:y+"/accum_grad",variable:Fi(function(){return ii(W).variable(!1)})}),d.accumulatedUpdates[D]==null&&(d.accumulatedUpdates[D]={originalName:y+"/accum_var",variable:Fi(function(){return ii(W).variable(!1)})});var X=Array.isArray(u)?u[D].tensor:u[y];if(X!=null){var ae=d.accumulatedGrads[D].variable,de=d.accumulatedUpdates[D].variable;Fi(function(){var be=ae.mul(d.rho).add(X.square().mul(1-d.rho)),Ie=de.add(d.epsilon).sqrt().div(ae.add(d.epsilon).sqrt()).mul(X),Re=de.mul(d.rho).add(Ie.square().mul(1-d.rho));ae.assign(be),de.assign(Re);var Me=Ie.mul(-d.learningRate).add(W);W.assign(Me)})}}),this.incrementIterations()},h.prototype.dispose=function(){this.accumulatedUpdates!=null&&(Na(this.accumulatedGrads.map(function(u){return u.variable})),Na(this.accumulatedUpdates.map(function(u){return u.variable})))},h.prototype.getWeights=function(){return R(this,void 0,void 0,function(){var u;return P(this,function(d){switch(d.label){case 0:return u=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[d.sent()].concat(u.map(function(y){return{name:y.originalName,tensor:y.variable}}))]}})})},h.prototype.setWeights=function(u){return R(this,void 0,void 0,function(){var d;return P(this,function(y){switch(y.label){case 0:return[4,this.extractIterations(u)];case 1:return u=y.sent(),d=u.length/2,this.accumulatedGrads=u.slice(0,d).map(function(D){return{originalName:D.name,variable:D.tensor.variable(!1)}}),this.accumulatedUpdates=u.slice(d,2*d).map(function(D){return{originalName:D.name,variable:D.tensor.variable(!1)}}),[2]}})})},h.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},h.fromConfig=function(u,d){return new u(d.learningRate,d.rho,d.epsilon)},h.className="Adadelta",h}(fd);ps(O0);var A0=function(v){function h(u,d){d===void 0&&(d=.1);var y=v.call(this)||this;return y.learningRate=u,y.initialAccumulatorValue=d,y.accumulatedGrads=[],y}return J(h,v),h.prototype.applyGradients=function(u){var d=this;(Array.isArray(u)?u.map(function(y){return y.name}):Object.keys(u)).forEach(function(y,D){var W=Ve.registeredVariables[y];d.accumulatedGrads[D]==null&&(d.accumulatedGrads[D]={originalName:y+"/accumulator",variable:Fi(function(){return ws(W.shape,d.initialAccumulatorValue).variable(!1)})});var X=Array.isArray(u)?u[D].tensor:u[y];if(X!=null){var ae=d.accumulatedGrads[D].variable;Fi(function(){var de=ae.add(X.square());ae.assign(de);var be=X.div(de.add(Ve.backend.epsilon()).sqrt()).mul(-d.learningRate).add(W);W.assign(be)})}}),this.incrementIterations()},h.prototype.dispose=function(){this.accumulatedGrads!=null&&Na(this.accumulatedGrads.map(function(u){return u.variable}))},h.prototype.getWeights=function(){return R(this,void 0,void 0,function(){return P(this,function(u){switch(u.label){case 0:return[4,this.saveIterations()];case 1:return[2,[u.sent()].concat(this.accumulatedGrads.map(function(d){return{name:d.originalName,tensor:d.variable}}))]}})})},h.prototype.setWeights=function(u){return R(this,void 0,void 0,function(){return P(this,function(d){switch(d.label){case 0:return[4,this.extractIterations(u)];case 1:return u=d.sent(),this.accumulatedGrads=u.map(function(y){return{originalName:y.name,variable:y.tensor.variable(!1)}}),[2]}})})},h.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},h.fromConfig=function(u,d){return new u(d.learningRate,d.initialAccumulatorValue)},h.className="Adagrad",h}(fd);ps(A0);var _0=function(v){function h(u,d,y,D){D===void 0&&(D=null);var W=v.call(this)||this;return W.learningRate=u,W.beta1=d,W.beta2=y,W.epsilon=D,W.accumulatedFirstMoment=[],W.accumulatedSecondMoment=[],Fi(function(){W.accBeta1=fr(d).variable(),W.accBeta2=fr(y).variable()}),D==null&&(W.epsilon=Ve.backend.epsilon()),W}return J(h,v),h.prototype.applyGradients=function(u){var d=this,y=Array.isArray(u)?u.map(function(D){return D.name}):Object.keys(u);Fi(function(){var D=Ic(1,d.accBeta1),W=Ic(1,d.accBeta2);y.forEach(function(X,ae){var de=Ve.registeredVariables[X];d.accumulatedFirstMoment[ae]==null&&(d.accumulatedFirstMoment[ae]={originalName:X+"/m",variable:Fi(function(){return ii(de).variable(!1)})}),d.accumulatedSecondMoment[ae]==null&&(d.accumulatedSecondMoment[ae]={originalName:X+"/v",variable:Fi(function(){return ii(de).variable(!1)})});var be=Array.isArray(u)?u[ae].tensor:u[X];if(be!=null){var Ie=d.accumulatedFirstMoment[ae].variable,Re=d.accumulatedSecondMoment[ae].variable,Me=Ie.mul(d.beta1).add(be.mul(1-d.beta1)),qe=Re.mul(d.beta2).add(be.square().mul(1-d.beta2)),Je=Me.div(D),Qe=qe.div(W);Ie.assign(Me),Re.assign(qe);var ot=Je.div(Qe.sqrt().add(d.epsilon)).mul(-d.learningRate).add(de);de.assign(ot)}}),d.accBeta1.assign(d.accBeta1.mul(d.beta1)),d.accBeta2.assign(d.accBeta2.mul(d.beta2))}),this.incrementIterations()},h.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&Na(this.accumulatedFirstMoment.map(function(u){return u.variable})),this.accumulatedSecondMoment!=null&&Na(this.accumulatedSecondMoment.map(function(u){return u.variable}))},h.prototype.getWeights=function(){return R(this,void 0,void 0,function(){var u;return P(this,function(d){switch(d.label){case 0:return u=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[d.sent()].concat(u.map(function(y){return{name:y.originalName,tensor:y.variable}}))]}})})},h.prototype.setWeights=function(u){return R(this,void 0,void 0,function(){var d,y=this;return P(this,function(D){switch(D.label){case 0:return[4,this.extractIterations(u)];case 1:return u=D.sent(),Fi(function(){y.accBeta1.assign(Gf(y.beta1,y.iterations_+1)),y.accBeta2.assign(Gf(y.beta2,y.iterations_+1))}),d=u.length/2,this.accumulatedFirstMoment=u.slice(0,d).map(function(W){return{originalName:W.name,variable:W.tensor.variable(!1)}}),this.accumulatedSecondMoment=u.slice(d,2*d).map(function(W){return{originalName:W.name,variable:W.tensor.variable(!1)}}),[2]}})})},h.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},h.fromConfig=function(u,d){return new u(d.learningRate,d.beta1,d.beta2,d.epsilon)},h.className="Adam",h}(fd);ps(_0);var rv=function(v){function h(u,d,y,D,W){D===void 0&&(D=null),W===void 0&&(W=0);var X=v.call(this)||this;return X.learningRate=u,X.beta1=d,X.beta2=y,X.epsilon=D,X.decay=W,X.accumulatedFirstMoment=[],X.accumulatedWeightedInfNorm=[],Fi(function(){X.iteration=fr(0).variable(),X.accBeta1=fr(d).variable()}),D==null&&(X.epsilon=Ve.backend.epsilon()),X}return J(h,v),h.prototype.applyGradients=function(u){var d=this,y=Array.isArray(u)?u.map(function(D){return D.name}):Object.keys(u);Fi(function(){var D=Ic(1,d.accBeta1),W=Hl(-d.learningRate,d.iteration.mul(d.decay).add(1));y.forEach(function(X,ae){var de=Ve.registeredVariables[X];d.accumulatedFirstMoment[ae]==null&&(d.accumulatedFirstMoment[ae]={originalName:X+"/m",variable:ii(de).variable(!1)}),d.accumulatedWeightedInfNorm[ae]==null&&(d.accumulatedWeightedInfNorm[ae]={originalName:X+"/v",variable:ii(de).variable(!1)});var be=Array.isArray(u)?u[ae].tensor:u[X];if(be!=null){var Ie=d.accumulatedFirstMoment[ae].variable,Re=d.accumulatedWeightedInfNorm[ae].variable,Me=Ie.mul(d.beta1).add(be.mul(1-d.beta1)),qe=Re.mul(d.beta2),Je=be.abs(),Qe=qe.maximum(Je);Ie.assign(Me),Re.assign(Qe);var ot=W.div(D).mul(Me.div(Qe.add(d.epsilon))).add(de);de.assign(ot)}}),d.iteration.assign(d.iteration.add(1)),d.accBeta1.assign(d.accBeta1.mul(d.beta1))}),this.incrementIterations()},h.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&Na(this.accumulatedFirstMoment.map(function(u){return u.variable})),this.accumulatedWeightedInfNorm!=null&&Na(this.accumulatedWeightedInfNorm.map(function(u){return u.variable}))},h.prototype.getWeights=function(){return R(this,void 0,void 0,function(){return P(this,function(u){throw new Error("getWeights() is not implemented for Adamax yet.")})})},h.prototype.setWeights=function(u){return R(this,void 0,void 0,function(){return P(this,function(d){throw new Error("setWeights() is not implemented for Adamax yet.")})})},h.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},h.fromConfig=function(u,d){return new u(d.learningRate,d.beta1,d.beta2,d.epsilon,d.decay)},h.className="Adamax",h}(fd);ps(rv);var Uv=function(v){function h(u){var d=v.call(this)||this;return d.learningRate=u,d.setLearningRate(u),d}return J(h,v),h.prototype.applyGradients=function(u){var d=this;(Array.isArray(u)?u.map(function(y){return y.name}):Object.keys(u)).forEach(function(y,D){var W=Array.isArray(u)?u[D].tensor:u[y];if(W!=null){var X=Ve.registeredVariables[y];Fi(function(){var ae=d.c.mul(W).add(X);X.assign(ae)})}}),this.incrementIterations()},h.prototype.setLearningRate=function(u){this.learningRate=u,this.c!=null&&this.c.dispose(),this.c=Dh(fr(-u))},h.prototype.dispose=function(){this.c.dispose()},h.prototype.getWeights=function(){return R(this,void 0,void 0,function(){return P(this,function(u){switch(u.label){case 0:return[4,this.saveIterations()];case 1:return[2,[u.sent()]]}})})},h.prototype.setWeights=function(u){return R(this,void 0,void 0,function(){return P(this,function(d){switch(d.label){case 0:return[4,this.extractIterations(u)];case 1:if((u=d.sent()).length!==0)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},h.prototype.getConfig=function(){return{learningRate:this.learningRate}},h.fromConfig=function(u,d){return new u(d.learningRate)},h.className="SGD",h}(fd);ps(Uv);var iv=function(v){function h(u,d,y){y===void 0&&(y=!1);var D=v.call(this,u)||this;return D.learningRate=u,D.momentum=d,D.useNesterov=y,D.accumulations=[],D.m=fr(D.momentum),D}return J(h,v),h.prototype.applyGradients=function(u){var d=this;(Array.isArray(u)?u.map(function(y){return y.name}):Object.keys(u)).forEach(function(y,D){var W=Ve.registeredVariables[y];d.accumulations[D]==null&&(d.accumulations[D]={originalName:y+"/momentum",variable:Fi(function(){return ii(W).variable(!1)})});var X=d.accumulations[D].variable,ae=Array.isArray(u)?u[D].tensor:u[y];ae!=null&&Fi(function(){var de,be=d.m.mul(X).add(ae);de=d.useNesterov?d.c.mul(ae.add(be.mul(d.m))).add(W):d.c.mul(be).add(W),X.assign(be),W.assign(de)})}),this.incrementIterations()},h.prototype.dispose=function(){this.m.dispose(),this.accumulations!=null&&Na(this.accumulations.map(function(u){return u.variable}))},h.prototype.setMomentum=function(u){this.momentum=u},h.prototype.getWeights=function(){return R(this,void 0,void 0,function(){return P(this,function(u){switch(u.label){case 0:return[4,this.saveIterations()];case 1:return[2,[u.sent()].concat(this.accumulations.map(function(d){return{name:d.originalName,tensor:d.variable}}))]}})})},h.prototype.setWeights=function(u){return R(this,void 0,void 0,function(){return P(this,function(d){switch(d.label){case 0:return[4,this.extractIterations(u)];case 1:return u=d.sent(),this.accumulations=u.map(function(y){return{originalName:y.name,variable:y.tensor.variable(!1)}}),[2]}})})},h.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},h.fromConfig=function(u,d){return new u(d.learningRate,d.momentum,d.useNesterov)},h.className="Momentum",h}(Uv);ps(iv);var Wv=function(v){function h(u,d,y,D,W){d===void 0&&(d=.9),y===void 0&&(y=0),D===void 0&&(D=null),W===void 0&&(W=!1);var X=v.call(this)||this;if(X.learningRate=u,X.decay=d,X.momentum=y,X.epsilon=D,X.accumulatedMeanSquares=[],X.accumulatedMoments=[],X.accumulatedMeanGrads=[],X.centered=W,D==null&&(X.epsilon=Ve.backend.epsilon()),u==null)throw new Error("learningRate for RMSPropOptimizer must be defined.");return X}return J(h,v),h.prototype.applyGradients=function(u){var d=this;(Array.isArray(u)?u.map(function(y){return y.name}):Object.keys(u)).forEach(function(y,D){var W=Ve.registeredVariables[y];d.accumulatedMeanSquares[D]==null&&(d.accumulatedMeanSquares[D]={originalName:y+"/rms",variable:Fi(function(){return ii(W).variable(!1)})}),d.accumulatedMoments[D]==null&&(d.accumulatedMoments[D]={originalName:y+"/momentum",variable:Fi(function(){return ii(W).variable(!1)})}),d.accumulatedMeanGrads[D]==null&&d.centered&&(d.accumulatedMeanGrads[D]={originalName:y+"/mg",variable:Fi(function(){return ii(W).variable(!1)})});var X=Array.isArray(u)?u[D].tensor:u[y];if(X!=null){var ae=d.accumulatedMeanSquares[D].variable,de=d.accumulatedMoments[D].variable;Fi(function(){var be=ae.mul(d.decay).add(X.square().mul(1-d.decay));if(d.centered){var Ie=d.accumulatedMeanGrads[D].variable,Re=Ie.mul(d.decay).add(X.mul(1-d.decay)),Me=de.mul(d.momentum).add(X.mul(d.learningRate).div(be.sub(Re.square().add(d.epsilon)).sqrt()));ae.assign(be),Ie.assign(Re),de.assign(Me);var qe=W.sub(Me);W.assign(qe)}else{var Je=ae.mul(d.decay).add(X.square().mul(1-d.decay));Me=de.mul(d.momentum).add(X.mul(d.learningRate).div(Je.add(d.epsilon).sqrt())),ae.assign(Je),de.assign(Me),qe=W.sub(Me),W.assign(qe)}})}}),this.incrementIterations()},h.prototype.dispose=function(){this.accumulatedMeanSquares!=null&&Na(this.accumulatedMeanSquares.map(function(u){return u.variable})),this.accumulatedMeanGrads!=null&&this.centered&&Na(this.accumulatedMeanGrads.map(function(u){return u.variable})),this.accumulatedMoments!=null&&Na(this.accumulatedMoments.map(function(u){return u.variable}))},h.prototype.getWeights=function(){return R(this,void 0,void 0,function(){var u;return P(this,function(d){switch(d.label){case 0:return u=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&u.push.apply(u,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[d.sent()].concat(u.map(function(y){return{name:y.originalName,tensor:y.variable}}))]}})})},h.prototype.setWeights=function(u){return R(this,void 0,void 0,function(){var d;return P(this,function(y){switch(y.label){case 0:return[4,this.extractIterations(u)];case 1:return u=y.sent(),d=this.centered?u.length/3:u.length/2,this.accumulatedMeanSquares=u.slice(0,d).map(function(D){return{originalName:D.name,variable:D.tensor.variable(!1)}}),this.accumulatedMoments=u.slice(d,2*d).map(function(D){return{originalName:D.name,variable:D.tensor.variable(!1)}}),this.centered&&(this.accumulatedMeanGrads=u.slice(2*d,3*d).map(function(D){return{originalName:D.name,variable:D.tensor.variable(!1)}})),[2]}})})},h.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},h.fromConfig=function(u,d){return new u(d.learningRate,d.decay,d.momentum,d.epsilon,d.centered)},h.className="RMSProp",h}(fd);ps(Wv);var mc=function(){function v(){}return v.sgd=function(h){return new Uv(h)},v.momentum=function(h,u,d){return d===void 0&&(d=!1),new iv(h,u,d)},v.rmsprop=function(h,u,d,y,D){return u===void 0&&(u=.9),d===void 0&&(d=0),y===void 0&&(y=null),D===void 0&&(D=!1),new Wv(h,u,d,y,D)},v.adam=function(h,u,d,y){return h===void 0&&(h=.001),u===void 0&&(u=.9),d===void 0&&(d=.999),y===void 0&&(y=null),new _0(h,u,d,y)},v.adadelta=function(h,u,d){return h===void 0&&(h=.001),u===void 0&&(u=.95),d===void 0&&(d=null),new O0(h,u,d)},v.adamax=function(h,u,d,y,D){return h===void 0&&(h=.002),u===void 0&&(u=.9),d===void 0&&(d=.999),y===void 0&&(y=null),D===void 0&&(D=0),new rv(h,u,d,y,D)},v.adagrad=function(h,u){return u===void 0&&(u=.1),new A0(h,u)},v}(),S0={sgd:mc.sgd,momentum:mc.momentum,adadelta:mc.adadelta,adagrad:mc.adagrad,rmsprop:mc.rmsprop,adamax:mc.adamax,adam:mc.adam},Xu=typeof requestAnimationFrame<"u"?requestAnimationFrame:B!==void 0?B:function(v){return v()};function af(){return new Promise(function(v){return Xu(function(){return v()})})}jt.prototype.squaredDifference=function(v){return zf(this,v)},yt=um}).call(this,o(59),o(75),o(92).Buffer,o(207).setImmediate)},function(Oe,A,o){Oe.exports=o(281)},function(Oe,A,o){o.d(A,"c",function(){return H}),o.d(A,"a",function(){return U}),o.d(A,"b",function(){return B}),o.d(A,"d",function(){return re}),o.d(A,"e",function(){return J});/*! *****************************************************************************
		Copyright (c) Microsoft Corporation.

		Permission to use, copy, modify, and/or distribute this software for any
		purpose with or without fee is hereby granted.

		THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
		REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
		AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
		INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
		LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
		OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
		PERFORMANCE OF THIS SOFTWARE.
		***************************************************************************** */var b=function(R,P){return(b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function($,L){$.__proto__=L}||function($,L){for(var ee in L)L.hasOwnProperty(ee)&&($[ee]=L[ee])})(R,P)};function H(R,P){function $(){this.constructor=R}b(R,P),R.prototype=P===null?Object.create(P):($.prototype=P.prototype,new $)}var U=function(){return(U=Object.assign||function(R){for(var P,$=1,L=arguments.length;$<L;$++)for(var ee in P=arguments[$])Object.prototype.hasOwnProperty.call(P,ee)&&(R[ee]=P[ee]);return R}).apply(this,arguments)};function B(R,P,$,L){return new($||($=Promise))(function(ee,F){function ue(he){try{K(L.next(he))}catch(pe){F(pe)}}function ie(he){try{K(L.throw(he))}catch(pe){F(pe)}}function K(he){he.done?ee(he.value):function(pe){return pe instanceof $?pe:new $(function(Ae){Ae(pe)})}(he.value).then(ue,ie)}K((L=L.apply(R,P||[])).next())})}function re(R,P){var $,L,ee,F,ue={label:0,sent:function(){if(1&ee[0])throw ee[1];return ee[1]},trys:[],ops:[]};return F={next:ie(0),throw:ie(1),return:ie(2)},typeof Symbol=="function"&&(F[Symbol.iterator]=function(){return this}),F;function ie(K){return function(he){return function(pe){if($)throw new TypeError("Generator is already executing.");for(;ue;)try{if($=1,L&&(ee=2&pe[0]?L.return:pe[0]?L.throw||((ee=L.return)&&ee.call(L),0):L.next)&&!(ee=ee.call(L,pe[1])).done)return ee;switch(L=0,ee&&(pe=[2&pe[0],ee.value]),pe[0]){case 0:case 1:ee=pe;break;case 4:return ue.label++,{value:pe[1],done:!1};case 5:ue.label++,L=pe[1],pe=[0];continue;case 7:pe=ue.ops.pop(),ue.trys.pop();continue;default:if(!(ee=(ee=ue.trys).length>0&&ee[ee.length-1])&&(pe[0]===6||pe[0]===2)){ue=0;continue}if(pe[0]===3&&(!ee||pe[1]>ee[0]&&pe[1]<ee[3])){ue.label=pe[1];break}if(pe[0]===6&&ue.label<ee[1]){ue.label=ee[1],ee=pe;break}if(ee&&ue.label<ee[2]){ue.label=ee[2],ue.ops.push(pe);break}ee[2]&&ue.ops.pop(),ue.trys.pop();continue}pe=P.call(R,ue)}catch(Ae){pe=[6,Ae],L=0}finally{$=ee=0}if(5&pe[0])throw pe[1];return{value:pe[0]?pe[1]:void 0,done:!0}}([K,he])}}}function J(){for(var R=0,P=0,$=arguments.length;P<$;P++)R+=arguments[P].length;var L=Array(R),ee=0;for(P=0;P<$;P++)for(var F=arguments[P],ue=0,ie=F.length;ue<ie;ue++,ee++)L[ee]=F[ue];return L}},function(Oe,A){function o(b,H,U,B,re,J,R){try{var P=b[J](R),$=P.value}catch(L){return void U(L)}P.done?H($):Promise.resolve($).then(B,re)}Oe.exports=function(b){return function(){var H=this,U=arguments;return new Promise(function(B,re){var J=b.apply(H,U);function R($){o(J,B,re,R,P,"next",$)}function P($){o(J,B,re,R,P,"throw",$)}R(void 0)})}},Oe.exports.__esModule=!0,Oe.exports.default=Oe.exports},function(Oe,A){function o(b){"@babel/helpers - typeof";return Oe.exports=o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(H){return typeof H}:function(H){return H&&typeof Symbol=="function"&&H.constructor===Symbol&&H!==Symbol.prototype?"symbol":typeof H},Oe.exports.__esModule=!0,Oe.exports.default=Oe.exports,o(b)}Oe.exports=o,Oe.exports.__esModule=!0,Oe.exports.default=Oe.exports},function(Oe,A,o){var b=o(16),H=o(24),U=o(42),B=o(38),re=o(56),J=function(R,P,$){var L,ee,F,ue,ie=R&J.F,K=R&J.G,he=R&J.S,pe=R&J.P,Ae=R&J.B,Te=K?b:he?b[P]||(b[P]={}):(b[P]||{}).prototype,je=K?H:H[P]||(H[P]={}),ke=je.prototype||(je.prototype={});for(L in K&&($=P),$)F=((ee=!ie&&Te&&Te[L]!==void 0)?Te:$)[L],ue=Ae&&ee?re(F,b):pe&&typeof F=="function"?re(Function.call,F):F,Te&&B(Te,L,F,R&J.U),je[L]!=F&&U(je,L,ue),pe&&ke[L]!=F&&(ke[L]=F)};b.core=H,J.F=1,J.G=2,J.S=4,J.P=8,J.B=16,J.W=32,J.U=64,J.R=128,Oe.exports=J},function(Oe,A){function o(b,H){for(var U=0;U<H.length;U++){var B=H[U];B.enumerable=B.enumerable||!1,B.configurable=!0,"value"in B&&(B.writable=!0),Object.defineProperty(b,B.key,B)}}Oe.exports=function(b,H,U){return H&&o(b.prototype,H),U&&o(b,U),Object.defineProperty(b,"prototype",{writable:!1}),b},Oe.exports.__esModule=!0,Oe.exports.default=Oe.exports},function(Oe,A){Oe.exports=function(o,b){if(!(o instanceof b))throw new TypeError("Cannot call a class as a function")},Oe.exports.__esModule=!0,Oe.exports.default=Oe.exports},function(Oe,A,o){o.d(A,"a",function(){return at}),o.d(A,"b",function(){return St}),o.d(A,"c",function(){return zt}),o.d(A,"d",function(){return $t}),o.d(A,"e",function(){return Gt}),o.d(A,"f",function(){return we}),o.d(A,"g",function(){return je}),o.d(A,"h",function(){return Te}),o.d(A,"i",function(){return Tt}),o.d(A,"j",function(){return Pt}),o.d(A,"k",function(){return ke}),o.d(A,"l",function(){return Ae}),o.d(A,"m",function(){return Dt}),o.d(A,"n",function(){return Ci}),o.d(A,"o",function(){return Xn}),o.d(A,"p",function(){return Xt}),o.d(A,"q",function(){return Dn}),o.d(A,"r",function(){return gr}),o.d(A,"s",function(){return Bt}),o.d(A,"t",function(){return ln}),o.d(A,"u",function(){return dr}),o.d(A,"v",function(){return nn}),o.d(A,"w",function(){return mr}),o.d(A,"x",function(){return Qr}),o.d(A,"y",function(){return We}),o.d(A,"z",function(){return Pe}),o.d(A,"A",function(){return _t});var b=o(1),H=o(72),U=o(40),B=o(71),re=o(39),J=o(70),R=o(135),P=o(184),$=o(183),L=o(69),ee=o(182),F=o(68),ue=o(134),ie=o(181),K=o(180),he=o(108),pe=o(45);const Ae="year",Te="quarter",je="month",ke="week",at="date",St="day",zt="dayofyear",$t="hours",we="minutes",Tt="seconds",Gt="milliseconds",Pt=[Ae,Te,je,ke,at,St,zt,$t,we,Tt,Gt],Ye=Pt.reduce((yt,Lr,jt)=>(yt[Lr]=1+jt,yt),{});function ln(yt){const Lr=Object(b.i)(yt).slice(),jt={};return Lr.length||Object(b.o)("Missing time unit."),Lr.forEach(ge=>{Object(b.w)(Ye,ge)?jt[ge]=1:Object(b.o)("Invalid time unit: ".concat(ge,"."))}),(jt[ke]||jt[St]?1:0)+(jt[Te]||jt[je]||jt[at]?1:0)+(jt[zt]?1:0)>1&&Object(b.o)("Incompatible time units: ".concat(yt)),Lr.sort((ge,fe)=>Ye[ge]-Ye[fe]),Lr}const Zt={[Ae]:"%Y ",[Te]:"Q%q ",[je]:"%b ",[at]:"%d ",[ke]:"W%U ",[St]:"%a ",[zt]:"%j ",[$t]:"%H:00",[we]:"00:%M",[Tt]:":%S",[Gt]:".%L",["".concat(Ae,"-").concat(je)]:"%Y-%m ",["".concat(Ae,"-").concat(je,"-").concat(at)]:"%Y-%m-%d ",["".concat($t,"-").concat(we)]:"%H:%M"};function Bt(yt,Lr){const jt=Object(b.p)({},Zt,Lr),ge=ln(yt),fe=ge.length;let ye,Se,Ze="",mt=0;for(mt=0;mt<fe;)for(ye=ge.length;ye>mt;--ye)if(jt[Se=ge.slice(mt,ye).join("-")]!=null){Ze+=jt[Se],mt=ye;break}return Ze.trim()}const Mt=new Date;function bn(yt){return Mt.setFullYear(yt),Mt.setMonth(0),Mt.setDate(1),Mt.setHours(0,0,0,0),Mt}function Dt(yt){return xn(new Date(yt))}function _t(yt){return In(new Date(yt))}function xn(yt){return H.a.count(bn(yt.getFullYear())-1,yt)}function In(yt){return U.b.count(bn(yt.getFullYear())-1,yt)}function Yn(yt){return bn(yt).getDay()}function fn(yt,Lr,jt,ge,fe,ye,Se){if(0<=yt&&yt<100){const Ze=new Date(-1,Lr,jt,ge,fe,ye,Se);return Ze.setFullYear(yt),Ze}return new Date(yt,Lr,jt,ge,fe,ye,Se)}function We(yt){return rt(new Date(yt))}function Pe(yt){return Et(new Date(yt))}function rt(yt){const Lr=Date.UTC(yt.getUTCFullYear(),0,1);return B.a.count(Lr-1,yt)}function Et(yt){const Lr=Date.UTC(yt.getUTCFullYear(),0,1);return re.b.count(Lr-1,yt)}function Lt(yt){return Mt.setTime(Date.UTC(yt,0,1)),Mt.getUTCDay()}function rn(yt,Lr,jt,ge,fe,ye,Se){if(0<=yt&&yt<100){const Ze=new Date(Date.UTC(-1,Lr,jt,ge,fe,ye,Se));return Ze.setUTCFullYear(jt.y),Ze}return new Date(Date.UTC(yt,Lr,jt,ge,fe,ye,Se))}function Sn(yt,Lr,jt,ge,fe){const ye=Lr||1,Se=Object(b.W)(yt),Ze=(pn,qt,Ve)=>function(jn,$n,Zn,ir){const zr=Zn<=1?jn:ir?(vr,pi)=>ir+Zn*Math.floor((jn(vr,pi)-ir)/Zn):(vr,pi)=>Zn*Math.floor(jn(vr,pi)/Zn);return $n?(vr,pi)=>$n(zr(vr,pi),pi):zr}(jt[Ve=Ve||pn],ge[Ve],pn===Se&&ye,qt),mt=new Date,Rt=Object(b.Fa)(yt),cn=Rt[Ae]?Ze(Ae):Object(b.m)(2012),Jn=Rt[je]?Ze(je):Rt[Te]?Ze(Te):b.Ma,An=Rt[ke]&&Rt[St]?Ze(St,1,ke+St):Rt[ke]?Ze(ke,1):Rt[St]?Ze(St,1):Rt[at]?Ze(at,1):Rt[zt]?Ze(zt,1):b.Q,Ln=Rt[$t]?Ze($t):b.Ma,Hn=Rt[we]?Ze(we):b.Ma,It=Rt[Tt]?Ze(Tt):b.Ma,Ot=Rt[Gt]?Ze(Gt):b.Ma;return function(pn){mt.setTime(+pn);const qt=cn(mt);return fe(qt,Jn(mt),An(mt,qt),Ln(mt),Hn(mt),It(mt),Ot(mt))}}function kn(yt,Lr,jt){return Lr+7*yt-(jt+6)%7}const qn={[Ae]:yt=>yt.getFullYear(),[Te]:yt=>Math.floor(yt.getMonth()/3),[je]:yt=>yt.getMonth(),[at]:yt=>yt.getDate(),[$t]:yt=>yt.getHours(),[we]:yt=>yt.getMinutes(),[Tt]:yt=>yt.getSeconds(),[Gt]:yt=>yt.getMilliseconds(),[zt]:yt=>xn(yt),[ke]:yt=>In(yt),[ke+St]:(yt,Lr)=>kn(In(yt),yt.getDay(),Yn(Lr)),[St]:(yt,Lr)=>kn(1,yt.getDay(),Yn(Lr))},xe={[Te]:yt=>3*yt,[ke]:(yt,Lr)=>kn(yt,0,Yn(Lr))};function Xn(yt,Lr){return Sn(yt,Lr||1,qn,xe,fn)}const br={[Ae]:yt=>yt.getUTCFullYear(),[Te]:yt=>Math.floor(yt.getUTCMonth()/3),[je]:yt=>yt.getUTCMonth(),[at]:yt=>yt.getUTCDate(),[$t]:yt=>yt.getUTCHours(),[we]:yt=>yt.getUTCMinutes(),[Tt]:yt=>yt.getUTCSeconds(),[Gt]:yt=>yt.getUTCMilliseconds(),[zt]:yt=>rt(yt),[ke]:yt=>Et(yt),[St]:(yt,Lr)=>kn(1,yt.getUTCDay(),Lt(Lr)),[ke+St]:(yt,Lr)=>kn(Et(yt),yt.getUTCDay(),Lt(Lr))},Cr={[Te]:yt=>3*yt,[ke]:(yt,Lr)=>kn(yt,0,Lt(Lr))};function dr(yt,Lr){return Sn(yt,Lr||1,br,Cr,rn)}const Rr={[Ae]:J.a,[Te]:R.a.every(3),[je]:R.a,[ke]:U.b,[at]:H.a,[St]:H.a,[zt]:H.a,[$t]:P.a,[we]:$.a,[Tt]:L.a,[Gt]:ee.a},hn={[Ae]:F.a,[Te]:ue.a.every(3),[je]:ue.a,[ke]:re.b,[at]:B.a,[St]:B.a,[zt]:B.a,[$t]:ie.a,[we]:K.a,[Tt]:L.a,[Gt]:ee.a};function Xt(yt){return Rr[yt]}function nn(yt){return hn[yt]}function Gn(yt,Lr,jt){return yt?yt.offset(Lr,jt):void 0}function Dn(yt,Lr,jt){return Gn(Xt(yt),Lr,jt)}function mr(yt,Lr,jt){return Gn(nn(yt),Lr,jt)}function xr(yt,Lr,jt,ge){return yt?yt.range(Lr,jt,ge):void 0}function gr(yt,Lr,jt,ge){return xr(Xt(yt),Lr,jt,ge)}function Qr(yt,Lr,jt,ge){return xr(nn(yt),Lr,jt,ge)}const ni=31536e6,Mr=[Ae,je,at,$t,we,Tt,Gt],di=Mr.slice(0,-1),Yr=di.slice(0,-1),Xr=Yr.slice(0,-1),fi=Xr.slice(0,-1),ai=[Ae,je],Oa=[Ae],Wi=[[di,1,1e3],[di,5,5e3],[di,15,15e3],[di,30,3e4],[Yr,1,6e4],[Yr,5,3e5],[Yr,15,9e5],[Yr,30,18e5],[Xr,1,36e5],[Xr,3,108e5],[Xr,6,216e5],[Xr,12,432e5],[fi,1,864e5],[[Ae,ke],1,6048e5],[ai,1,2592e6],[ai,3,7776e6],[Oa,1,ni]];function Ci(yt){const Lr=yt.extent,jt=yt.maxbins||40,ge=Math.abs(Object(b.Z)(Lr))/jt;let fe,ye,Se=Object(he.a)(Ze=>Ze[2]).right(Wi,ge);return Se===Wi.length?(fe=Oa,ye=Object(pe.c)(Lr[0]/ni,Lr[1]/ni,jt)):Se?(fe=(Se=Wi[ge/Wi[Se-1][2]<Wi[Se][2]/ge?Se-1:Se])[0],ye=Se[1]):(fe=Mr,ye=Math.max(Object(pe.c)(Lr[0],Lr[1],jt),1)),{units:fe,step:ye}}},function(Oe,A,o){o.d(A,"e",function(){return b}),o.d(A,"c",function(){return H}),o.d(A,"b",function(){return U}),o.d(A,"a",function(){return B}),o.d(A,"f",function(){return re}),o.d(A,"d",function(){return J}),o.d(A,"g",function(){return R});const b=1e3,H=60*b,U=60*H,B=24*U,re=7*B,J=30*B,R=365*B},function(Oe,A){Oe.exports=function(o){return typeof o=="object"?o!==null:typeof o=="function"}},function(Oe,A,o){var b=o(13);Oe.exports=function(H){if(!b(H))throw TypeError(H+" is not an object!");return H}},function(Oe,A){Oe.exports=function(o){try{return!!o()}catch{return!0}}},function(Oe,A){var o=Oe.exports=typeof window<"u"&&window.Math==Math?window:typeof self<"u"&&self.Math==Math?self:Function("return this")();typeof __g=="number"&&(__g=o)},function(Oe,A,o){Oe.exports=o(280)},function(Oe,A){Oe.exports=function(o,b,H){return b in o?Object.defineProperty(o,b,{value:H,enumerable:!0,configurable:!0,writable:!0}):o[b]=H,o},Oe.exports.__esModule=!0,Oe.exports.default=Oe.exports},function(Oe,A,o){var b=o(129)("wks"),H=o(84),U=o(16).Symbol,B=typeof U=="function";(Oe.exports=function(re){return b[re]||(b[re]=B&&U[re]||(B?U:H)("Symbol."+re))}).store=b},function(Oe,A,o){o.r(A),(function(b){o.d(A,"GraphModel",function(){return yt}),o.d(A,"loadGraphModel",function(){return Lr}),o.d(A,"deregisterOp",function(){return ee}),o.d(A,"registerOp",function(){return $}),o.d(A,"version_converter",function(){return jt});var H,U,B=o(0),re=function(){return(re=Object.assign||function(ge){for(var fe,ye=1,Se=arguments.length;ye<Se;ye++)for(var Ze in fe=arguments[ye])Object.prototype.hasOwnProperty.call(fe,Ze)&&(ge[Ze]=fe[Ze]);return ge}).apply(this,arguments)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J(ge,fe,ye,Se){return new(ye||(ye=Promise))(function(Ze,mt){function Rt(An){try{Jn(Se.next(An))}catch(Ln){mt(Ln)}}function cn(An){try{Jn(Se.throw(An))}catch(Ln){mt(Ln)}}function Jn(An){An.done?Ze(An.value):new ye(function(Ln){Ln(An.value)}).then(Rt,cn)}Jn((Se=Se.apply(ge,[])).next())})}function R(ge,fe){var ye,Se,Ze,mt,Rt={label:0,sent:function(){if(1&Ze[0])throw Ze[1];return Ze[1]},trys:[],ops:[]};return mt={next:cn(0),throw:cn(1),return:cn(2)},typeof Symbol=="function"&&(mt[Symbol.iterator]=function(){return this}),mt;function cn(Jn){return function(An){return function(Ln){if(ye)throw new TypeError("Generator is already executing.");for(;Rt;)try{if(ye=1,Se&&(Ze=2&Ln[0]?Se.return:Ln[0]?Se.throw||((Ze=Se.return)&&Ze.call(Se),0):Se.next)&&!(Ze=Ze.call(Se,Ln[1])).done)return Ze;switch(Se=0,Ze&&(Ln=[2&Ln[0],Ze.value]),Ln[0]){case 0:case 1:Ze=Ln;break;case 4:return Rt.label++,{value:Ln[1],done:!1};case 5:Rt.label++,Se=Ln[1],Ln=[0];continue;case 7:Ln=Rt.ops.pop(),Rt.trys.pop();continue;default:if(!(Ze=(Ze=Rt.trys).length>0&&Ze[Ze.length-1])&&(Ln[0]===6||Ln[0]===2)){Rt=0;continue}if(Ln[0]===3&&(!Ze||Ln[1]>Ze[0]&&Ln[1]<Ze[3])){Rt.label=Ln[1];break}if(Ln[0]===6&&Rt.label<Ze[1]){Rt.label=Ze[1],Ze=Ln;break}if(Ze&&Rt.label<Ze[2]){Rt.label=Ze[2],Rt.ops.push(Ln);break}Ze[2]&&Rt.ops.pop(),Rt.trys.pop();continue}Ln=fe.call(ge,Rt)}catch(Hn){Ln=[6,Hn],Se=0}finally{ye=Ze=0}if(5&Ln[0])throw Ln[1];return{value:Ln[0]?Ln[1]:void 0,done:!0}}([Jn,An])}}}(function(ge){ge[ge.DT_INVALID=0]="DT_INVALID",ge[ge.DT_FLOAT=1]="DT_FLOAT",ge[ge.DT_DOUBLE=2]="DT_DOUBLE",ge[ge.DT_INT32=3]="DT_INT32",ge[ge.DT_UINT8=4]="DT_UINT8",ge[ge.DT_INT16=5]="DT_INT16",ge[ge.DT_INT8=6]="DT_INT8",ge[ge.DT_STRING=7]="DT_STRING",ge[ge.DT_COMPLEX64=8]="DT_COMPLEX64",ge[ge.DT_INT64=9]="DT_INT64",ge[ge.DT_BOOL=10]="DT_BOOL",ge[ge.DT_QINT8=11]="DT_QINT8",ge[ge.DT_QUINT8=12]="DT_QUINT8",ge[ge.DT_QINT32=13]="DT_QINT32",ge[ge.DT_BFLOAT16=14]="DT_BFLOAT16",ge[ge.DT_FLOAT_REF=101]="DT_FLOAT_REF",ge[ge.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",ge[ge.DT_INT32_REF=103]="DT_INT32_REF",ge[ge.DT_UINT8_REF=104]="DT_UINT8_REF",ge[ge.DT_INT16_REF=105]="DT_INT16_REF",ge[ge.DT_INT8_REF=106]="DT_INT8_REF",ge[ge.DT_STRING_REF=107]="DT_STRING_REF",ge[ge.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",ge[ge.DT_INT64_REF=109]="DT_INT64_REF",ge[ge.DT_BOOL_REF=110]="DT_BOOL_REF",ge[ge.DT_QINT8_REF=111]="DT_QINT8_REF",ge[ge.DT_QUINT8_REF=112]="DT_QUINT8_REF",ge[ge.DT_QINT32_REF=113]="DT_QINT32_REF",ge[ge.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF"})(H||(H={})),function(ge){(function(fe){fe[fe.LEGACY=0]="LEGACY",fe[fe.V1=1]="V1",fe[fe.V2=2]="V2"})(ge.CheckpointFormatVersion||(ge.CheckpointFormatVersion={}))}(U||(U={}));var P={};function $(ge,fe){var ye={tfOpName:ge,category:"custom",inputs:[],attrs:[],customExecutor:fe};P[ge]=ye}function L(ge){return P[ge]}function ee(ge){delete P[ge]}function F(ge,fe,ye,Se){var Ze=fe.inputParams[ge];if(Ze&&Ze.inputIndexStart!==void 0){var mt=Ze.inputIndexStart,Rt=Ze.inputIndexEnd===0?void 0:Ze.inputIndexEnd===void 0?mt+1:Ze.inputIndexEnd;if(Ze.type==="tensor")return ue(fe.inputNames[Ze.inputIndexStart],ye,Se);if(Ze.type==="tensors")return fe.inputNames.slice(mt,Rt).map(function(An){return ue(An,ye,Se)});var cn=Array.prototype.slice.call(ue(fe.inputNames.slice(mt)[0],ye,Se).dataSync());return Ze.type==="number"?cn[0]:cn}var Jn=fe.attrParams[ge];return Jn&&Jn.value}function ue(ge,fe,ye){var Se=he(ge),Ze=Se[0],mt=Se[1],Rt=ye.currentContextIds.find(function(cn){return!!fe[K(Ze,cn)]});return Rt!==void 0?fe[K(Ze,Rt)][mt]:void 0}function ie(ge,fe){var ye=he(ge),Se=ye[0],Ze=ye[1];return[K(Se,fe&&fe.currentContextId),Ze]}function K(ge,fe){return fe?ge+"-"+fe:ge}function he(ge){var fe=ge.lastIndexOf(":");return fe===-1?[ge,0]:[ge.substring(0,fe),Number(ge.substring(fe+1))]}function pe(ge,fe){for(var ye=[],Se=0;Se<ge.length;Se+=fe)ye.push(ge.slice(Se,Se+fe));return ye}var Ae=Object.freeze({json:[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),Te=Object.freeze({json:[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"clip_value_min",name:"clipValueMin",type:"number"},{tfName:"clip_value_max",name:"clipValueMax",type:"number"}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"clipValueMin",name:"clipValueMin",type:"number",defaultValue:0},{tfName:"clipValueMax",name:"clipValueMax",type:"number",defaultValue:6}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Prod",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axes",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),je=Object.freeze({json:[{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"}]}]}),ke=Object.freeze({json:[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]}]}),at=Object.freeze({json:[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}]}),St=Object.freeze({json:[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),zt=Object.freeze({json:[{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]}]}),$t=Object.freeze({json:[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}]}),we=Object.freeze({json:[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]}]}),Tt=Object.freeze({json:[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),Gt=Object.freeze({json:[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),Pt=Object.freeze({json:[{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"SparseToDense",category:"normalization",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!0,notSupported:!0}]}]}),Ye=Object.freeze({json:[{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]}]}),ln=Object.freeze({json:[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool",notSupported:!0}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]}]}),Zt=Object.freeze({json:[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}]}),Bt=Object.freeze({json:[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]}]}),Mt=function(){function ge(){var fe=[Ae,Te,je,ke,at,St,zt,Tt,we,$t,Gt,Pt,Ye,ln,Zt,Bt],ye=[].concat.apply([],fe.map(function(Se){return Se.json}));this.opMappers=ye.reduce(function(Se,Ze){return Se[Ze.tfOpName]=Ze,Se},{})}return Object.defineProperty(ge,"Instance",{get:function(){return this._instance||(this._instance=new this)},enumerable:!0,configurable:!0}),ge.prototype.transformGraph=function(fe,ye){var Se=this;ye===void 0&&(ye={});var Ze=[],mt=[],Rt=fe.node.reduce(function(It,Ot){return It[Ot.name]=Se.mapNode(Ot),Ot.op.startsWith("Placeholder")&&Ze.push(It[Ot.name]),Ot.op==="Const"&&mt.push(It[Ot.name]),It},{}),cn=[],Jn=[],An={},Ln={};ye!=null&&(An=this.mapSignatureEntries(ye.inputs),Ln=this.mapSignatureEntries(ye.outputs));var Hn=Object.keys(Rt);return Hn.forEach(function(It){var Ot=Rt[It];Ot.inputNames.forEach(function(pn){var qt=ie(pn)[0];Ot.inputs.push(Rt[qt]),Rt[qt].children.push(Ot)})}),Object.keys(Ln).length===0?Hn.forEach(function(It){var Ot=Rt[It];Ot.children.length===0&&Jn.push(Ot)}):Object.keys(Ln).forEach(function(It){var Ot=ie(It)[0],pn=Rt[Ot];pn!=null&&(pn.signatureKey=Ln[It],Jn.push(pn))}),Object.keys(An).length>0?Object.keys(An).forEach(function(It){var Ot=ie(It)[0],pn=Rt[Ot];pn&&(pn.signatureKey=An[It],cn.push(pn))}):cn=Ze,{nodes:Rt,inputs:cn,outputs:Jn,weights:mt,placeholders:Ze,signature:ye}},ge.prototype.mapSignatureEntries=function(fe){return Object.keys(fe||{}).reduce(function(ye,Se){return ye[fe[Se].name]=Se,ye},{})},ge.prototype.mapNode=function(fe){var ye=L(fe.op)||this.opMappers[fe.op]||{};fe.attr==null&&(fe.attr={});var Se={name:fe.name,op:fe.op,category:ye.category,inputNames:(fe.input||[]).map(function(Ze){return Ze.startsWith("^")?Ze.substr(1):Ze}),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:fe.attr};return ye.inputs!=null&&(Se.inputParams=ye.inputs.reduce(function(Ze,mt){return Ze[mt.name]={type:mt.type,inputIndexStart:mt.start,inputIndexEnd:mt.end},Ze},{})),ye.attrs!=null&&(Se.attrParams=ye.attrs.reduce(function(Ze,mt){var Rt=mt.type,cn=void 0;switch(mt.type){case"string":(cn=Dt(fe.attr,mt.tfName,mt.defaultValue))===void 0&&mt.tfDeprecatedName&&(cn=Dt(fe.attr,mt.tfDeprecatedName,mt.defaultValue));break;case"string[]":(cn=Et(fe.attr,mt.tfName,mt.defaultValue))===void 0&&mt.tfDeprecatedName&&(cn=Et(fe.attr,mt.tfDeprecatedName,mt.defaultValue));break;case"number":(cn=xn(fe.attr,mt.tfName,mt.defaultValue||0))===void 0&&mt.tfDeprecatedName&&(cn=xn(fe.attr,mt.tfDeprecatedName,mt.defaultValue));break;case"number[]":(cn=rt(fe.attr,mt.tfName,mt.defaultValue))===void 0&&mt.tfDeprecatedName&&(cn=rt(fe.attr,mt.tfDeprecatedName,mt.defaultValue));break;case"bool":(cn=_t(fe.attr,mt.tfName,mt.defaultValue))===void 0&&mt.tfDeprecatedName&&(cn=_t(fe.attr,mt.tfDeprecatedName,mt.defaultValue));break;case"bool[]":(cn=rn(fe.attr,mt.tfName,mt.defaultValue))===void 0&&mt.tfDeprecatedName&&(cn=rn(fe.attr,mt.tfDeprecatedName,mt.defaultValue));break;case"shape":(cn=Pe(fe.attr,mt.tfName,mt.defaultValue))===void 0&&mt.tfDeprecatedName&&(cn=Pe(fe.attr,mt.tfDeprecatedName,mt.defaultValue));break;case"shape[]":(cn=Lt(fe.attr,mt.tfName,mt.defaultValue))===void 0&&mt.tfDeprecatedName&&(cn=Lt(fe.attr,mt.tfDeprecatedName,mt.defaultValue));break;case"dtype":(cn=Yn(fe.attr,mt.tfName,mt.defaultValue))===void 0&&mt.tfDeprecatedName&&(cn=Yn(fe.attr,mt.tfDeprecatedName,mt.defaultValue));break;case"dtype[]":(cn=fn(fe.attr,mt.tfName,mt.defaultValue))===void 0&&mt.tfDeprecatedName&&(cn=fn(fe.attr,mt.tfDeprecatedName,mt.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error("Unsupported param type: "+mt.type+" for op: "+fe.op)}return Ze[mt.name]={value:cn,type:Rt},Ze},{})),Se},ge}();function bn(ge,fe){var ye=Array.isArray(ge)?String.fromCharCode.apply(null,ge):function(Se){var Ze=Object(B.env)().global;if(Ze.atob!==void 0)return Ze.atob(Se);if(b!==void 0)return new b(Se,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}(ge);return fe?ye:ye.toLowerCase()}function Dt(ge,fe,ye,Se){Se===void 0&&(Se=!1);var Ze=ge[fe];return Ze!=null?bn(Ze.s,Se):ye}function _t(ge,fe,ye){var Se=ge[fe];return Se?Se.b:ye}function xn(ge,fe,ye){var Se=ge[fe]||{},Ze=Se.i!=null?Se.i:Se.f!=null?Se.f:ye;return typeof Ze=="number"?Ze:parseInt(Ze,10)}function In(ge){switch(typeof ge=="string"&&(ge=H[ge]),ge){case H.DT_FLOAT:return"float32";case H.DT_INT32:case H.DT_INT64:case H.DT_INT8:case H.DT_UINT8:return"int32";case H.DT_BOOL:return"bool";case H.DT_DOUBLE:return"float32";case H.DT_STRING:return"string";default:return null}}function Yn(ge,fe,ye){var Se=ge[fe];return Se&&Se.type?In(Se.type):ye}function fn(ge,fe,ye){var Se=ge[fe];return Se&&Se.list&&Se.list.type?Se.list.type.map(function(Ze){return In(Ze)}):ye}function We(ge){if(!ge.unknownRank)return ge.dim!=null?ge.dim.map(function(fe){return typeof fe.size=="number"?fe.size:parseInt(fe.size,10)}):[]}function Pe(ge,fe,ye){var Se=ge[fe];return Se&&Se.shape?We(Se.shape):ye}function rt(ge,fe,ye){var Se=ge[fe];return Se?((Se.list.f&&Se.list.f.length?Se.list.f:Se.list.i)||[]).map(function(Ze){return typeof Ze=="number"?Ze:parseInt(Ze,10)}):ye}function Et(ge,fe,ye,Se){Se===void 0&&(Se=!1);var Ze=ge[fe];return Ze&&Ze.list&&Ze.list.s?Ze.list.s.map(function(mt){return bn(mt,Se)}):ye}function Lt(ge,fe,ye){var Se=ge[fe];return Se&&Se.list&&Se.list.shape?Se.list.shape.map(function(Ze){return We(Ze)}):ye}function rn(ge,fe,ye){var Se=ge[fe];return Se&&Se.list&&Se.list.b?Se.list.b:ye}var Sn=function(){function ge(fe,ye,Se){var Ze=this;this.node=fe,this.tensorMap=ye,this.context=Se,this.inputs=[],this.attrs={},this.inputs=fe.inputNames.map(function(mt){return Ze.getInput(mt)}),fe.rawAttrs!=null&&(this.attrs=Object.keys(fe.rawAttrs).reduce(function(mt,Rt){return mt[Rt]=Ze.getAttr(Rt),mt},{}))}return ge.prototype.getInput=function(fe){return ue(fe,this.tensorMap,this.context)},ge.prototype.getAttr=function(fe,ye){var Se=this.node.rawAttrs[fe];if(Se.tensor!=null)return ue(fe,this.tensorMap,this.context);if(Se.i!=null||Se.f!=null)return xn(this.node.rawAttrs,fe,ye);if(Se.s!=null)return Dt(this.node.rawAttrs,fe,ye);if(Se.b!=null)return _t(this.node.rawAttrs,fe,ye);if(Se.shape!=null)return Pe(this.node.rawAttrs,fe,ye);if(Se.type!=null)return Yn(this.node.rawAttrs,fe,ye);if(Se.list!=null){if(Se.list.i!=null||Se.list.f!=null)return rt(this.node.rawAttrs,fe,ye);if(Se.list.s!=null)return Et(this.node.rawAttrs,fe,ye);if(Se.list.shape!=null)return Lt(this.node.rawAttrs,fe,ye);if(Se.list.b!=null)return rn(this.node.rawAttrs,fe,ye);if(Se.list.type!=null)return fn(this.node.rawAttrs,fe,ye)}return ye},ge}(),kn=function(ge,fe,ye){switch(ge.op){case"BiasAdd":case"AddV2":case"Add":return[Object(B.add)(F("a",ge,fe,ye),F("b",ge,fe,ye))];case"AddN":return[Object(B.addN)(F("tensors",ge,fe,ye))];case"FloorMod":case"Mod":return[Object(B.mod)(F("a",ge,fe,ye),F("b",ge,fe,ye))];case"Mul":return[Object(B.mul)(F("a",ge,fe,ye),F("b",ge,fe,ye))];case"RealDiv":case"Div":return[Object(B.div)(F("a",ge,fe,ye),F("b",ge,fe,ye))];case"DivNoNan":return[Object(B.divNoNan)(F("a",ge,fe,ye),F("b",ge,fe,ye))];case"FloorDiv":return[Object(B.floorDiv)(F("a",ge,fe,ye),F("b",ge,fe,ye))];case"Sub":return[Object(B.sub)(F("a",ge,fe,ye),F("b",ge,fe,ye))];case"Minimum":return[Object(B.minimum)(F("a",ge,fe,ye),F("b",ge,fe,ye))];case"Maximum":return[Object(B.maximum)(F("a",ge,fe,ye),F("b",ge,fe,ye))];case"Pow":return[Object(B.pow)(F("a",ge,fe,ye),F("b",ge,fe,ye))];case"SquaredDifference":return[Object(B.squaredDifference)(F("a",ge,fe,ye),F("b",ge,fe,ye))];default:throw TypeError("Node type "+ge.op+" is not implemented")}},qn=function(ge,fe,ye){switch(ge.op){case"Abs":case"ComplexAbs":return[Object(B.abs)(F("x",ge,fe,ye))];case"Acos":return[Object(B.acos)(F("x",ge,fe,ye))];case"Acosh":return[Object(B.acosh)(F("x",ge,fe,ye))];case"Asin":return[Object(B.asin)(F("x",ge,fe,ye))];case"Asinh":return[Object(B.asinh)(F("x",ge,fe,ye))];case"Atan":return[Object(B.atan)(F("x",ge,fe,ye))];case"Atan2":return[Object(B.atan2)(F("x",ge,fe,ye),F("y",ge,fe,ye))];case"Atanh":return[Object(B.atanh)(F("x",ge,fe,ye))];case"Ceil":return[Object(B.ceil)(F("x",ge,fe,ye))];case"Complex":return[Object(B.complex)(F("real",ge,fe,ye),F("imag",ge,fe,ye))];case"Cos":return[Object(B.cos)(F("x",ge,fe,ye))];case"Cosh":return[Object(B.cosh)(F("x",ge,fe,ye))];case"Elu":return[Object(B.elu)(F("x",ge,fe,ye))];case"Erf":return[Object(B.erf)(F("x",ge,fe,ye))];case"Exp":return[Object(B.exp)(F("x",ge,fe,ye))];case"Expm1":return[Object(B.expm1)(F("x",ge,fe,ye))];case"Floor":return[Object(B.floor)(F("x",ge,fe,ye))];case"Log":return[Object(B.log)(F("x",ge,fe,ye))];case"Log1p":return[Object(B.log1p)(F("x",ge,fe,ye))];case"Imag":return[Object(B.imag)(F("x",ge,fe,ye))];case"Neg":return[Object(B.neg)(F("x",ge,fe,ye))];case"Reciprocal":return[Object(B.reciprocal)(F("x",ge,fe,ye))];case"Real":return[Object(B.real)(F("x",ge,fe,ye))];case"Relu":return[Object(B.relu)(F("x",ge,fe,ye))];case"Round":return[Object(B.round)(F("x",ge,fe,ye))];case"Selu":return[Object(B.selu)(F("x",ge,fe,ye))];case"Sigmoid":return[Object(B.sigmoid)(F("x",ge,fe,ye))];case"Sin":return[Object(B.sin)(F("x",ge,fe,ye))];case"Sign":return[Object(B.sign)(F("x",ge,fe,ye))];case"Sinh":return[Object(B.sinh)(F("x",ge,fe,ye))];case"Softplus":return[Object(B.softplus)(F("x",ge,fe,ye))];case"Sqrt":return[Object(B.sqrt)(F("x",ge,fe,ye))];case"Square":return[Object(B.square)(F("x",ge,fe,ye))];case"Tanh":return[Object(B.tanh)(F("x",ge,fe,ye))];case"Tan":return[Object(B.tan)(F("x",ge,fe,ye))];case"Relu6":case"ClipByValue":return[Object(B.clipByValue)(F("x",ge,fe,ye),F("clipValueMin",ge,fe,ye),F("clipValueMax",ge,fe,ye))];case"Rsqrt":return[Object(B.rsqrt)(ue(ge.inputNames[0],fe,ye))];case"Prod":return[Object(B.prod)(F("x",ge,fe,ye),F("axes",ge,fe,ye))];case"LeakyRelu":return[Object(B.leakyRelu)(F("x",ge,fe,ye),F("alpha",ge,fe,ye))];case"Prelu":return[Object(B.prelu)(F("x",ge,fe,ye),F("alpha",ge,fe,ye))];default:throw TypeError("Node type "+ge.op+" is not implemented")}},xe=function(){function ge(fe,ye,Se,Ze,mt,Rt,cn){this.name=fe,this.dtype=ye,this.maxSize=Se,this.elementShape=Ze,this.identicalElementShapes=mt,this.dynamicSize=Rt,this.clearAfterRead=cn,this.tensors=[],this.closed_=!1,this.id=ge.nextId++}return Object.defineProperty(ge.prototype,"closed",{get:function(){return this.closed_},enumerable:!0,configurable:!0}),ge.prototype.clearAndClose=function(){this.tensors.forEach(function(fe){return fe.tensor.dispose()}),this.tensors=[],this.closed_=!0},ge.prototype.size=function(){return this.tensors.length},ge.prototype.read=function(fe){if(this.closed_)throw new Error("TensorArray "+this.name+" has already been closed.");if(fe<0||fe>=this.tensors.length)throw new Error("Tried to read from index "+fe+", but array size is: "+this.tensors.length);var ye=this.tensors[fe];if(ye.cleared)throw new Error("TensorArray "+this.name+": Could not read index "+fe+" twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?).");return this.clearAfterRead&&(ye.cleared=!0),ye.read=!0,ye.tensor},ge.prototype.readMany=function(fe){var ye=this;return fe.map(function(Se){return ye.read(Se)})},ge.prototype.write=function(fe,ye){if(this.closed_)throw new Error("TensorArray "+this.name+" has already been closed.");if(fe<0||!this.dynamicSize&&fe>=this.maxSize)throw new Error("Tried to write to index "+fe+", but array is not resizeable and size is: "+this.maxSize);var Se=this.tensors[fe]||{};if(ye.dtype!==this.dtype)throw new Error("TensorArray "+this.name+": Could not write to TensorArray index "+fe+`,
          because the value dtype is `+ye.dtype+", but TensorArray dtype is "+this.dtype+".");if(this.size()!==0||this.elementShape!=null&&this.elementShape.length!==0||(this.elementShape=ye.shape),this.assertShapesMatchAllowUndefinedSize(this.elementShape,ye.shape,"TensorArray "+this.name+": Could not write to TensorArray index "+fe+"."),Se&&Se.read)throw new Error("TensorArray "+this.name+": Could not write to TensorArray index "+fe+", because it has already been read.");if(Se&&Se.written)throw new Error("TensorArray "+this.name+": Could not write to TensorArray index "+fe+", because it has already been written.");Se.tensor=ye,Se.written=!0,this.tensors[fe]=Se},ge.prototype.writeMany=function(fe,ye){var Se=this;if(fe.length!==ye.length)throw new Error("TensorArray "+this.name+": could not write multiple tensors,because the index size: "+fe.length+" is not the same as tensors size: "+ye.length+".");fe.forEach(function(Ze,mt){return Se.write(Ze,ye[mt])})},ge.prototype.gather=function(fe,ye){if(ye&&ye!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but gather requested dtype "+ye);if(!fe){fe=[];for(var Se=0;Se<this.size();Se++)fe.push(Se)}if(fe.length===0)return Object(B.tensor)([],[0].concat(this.elementShape));var Ze=this.readMany(fe);return this.assertShapesMatchAllowUndefinedSize(this.elementShape,Ze[0].shape,"TensorArray shape mismatch: "),Object(B.stack)(Ze,0)},ge.prototype.concat=function(fe){if(fe&&fe!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but concat requested dtype "+fe);if(this.size()===0)return Object(B.tensor)([],[0].concat(this.elementShape));for(var ye=[],Se=0;Se<this.size();Se++)ye.push(Se);var Ze=this.readMany(ye);return this.assertShapesMatchAllowUndefinedSize(this.elementShape,Ze[0].shape,"TensorArray shape mismatch: tensor array shape ("+this.elementShape+") vs first tensor shape ("+Ze[0].shape+")"),Object(B.concat)(Ze,0)},ge.prototype.scatter=function(fe,ye){if(ye.dtype!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but tensor has dtype "+ye.dtype);if(fe.length!==ye.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: "+fe.length+" vs. "+ye.shape[0]);var Se=Math.max.apply(Math,fe);if(!this.dynamicSize&&Se>=this.maxSize)throw new Error("Max index must be < array size ("+Se+"  vs. "+this.maxSize+")");this.writeMany(fe,Object(B.unstack)(ye,0))},ge.prototype.split=function(fe,ye){var Se=this;if(ye.dtype!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but tensor has dtype "+ye.dtype);var Ze=0,mt=fe.map(function(Ln){return Ze+=Ln});if(Ze!==ye.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        `+Ze+", and tensor's shape is: "+ye.shape);if(!this.dynamicSize&&fe.length!==this.maxSize)throw new Error("TensorArray's size is not equal to the size of lengths ("+this.maxSize+" vs. "+fe.length+"), and the TensorArray is not marked as dynamically resizeable");var Rt=Ze===0?0:ye.size/Ze,cn=[];Object(B.tidy)(function(){ye=ye.reshape([1,Ze,Rt]);for(var Ln=0;Ln<fe.length;++Ln){var Hn=[0,Ln===0?0:mt[Ln-1],0],It=[1,fe[Ln],Rt];cn[Ln]=Object(B.slice)(ye,Hn,It).reshape(Se.elementShape)}return cn});for(var Jn=[],An=0;An<fe.length;An++)Jn[An]=An;this.writeMany(Jn,cn)},ge.prototype.assertShapesMatchAllowUndefinedSize=function(fe,ye,Se){Se===void 0&&(Se=""),B.util.assert(this.shapesEqualAllowUndefinedSize(fe,ye),function(){return Se+" Shapes "+fe+" and "+ye+" must match"})},ge.prototype.shapesEqualAllowUndefinedSize=function(fe,ye){if(fe.length!==ye.length)return!1;for(var Se=0;Se<fe.length;Se++)if(fe[Se]!==-1&&ye[Se]!==-1&&fe[Se]!==ye[Se])return!1;return!0},ge.nextId=0,ge}(),Xn=function(ge,fe,ye){return J(void 0,void 0,void 0,function(){var Se,Ze,mt,Rt,cn,Jn,An,Ln,Hn,It,Ot,pn,qt,Ve,jn,$n,Zn,ir,zr,vr,pi,la,ui,Qi,Di,qr,jr,Bn,ri,Vi,Fr,aa,ma,Zi,ga;return R(this,function(No){switch(No.label){case 0:switch(ge.op){case"LoopCond":return[3,1];case"Switch":return[3,2];case"Merge":return[3,4];case"Enter":return[3,5];case"Exit":return[3,6];case"NextIteration":return[3,7];case"TensorArrayV3":return[3,8];case"TensorArrayWriteV3":return[3,9];case"TensorArrayReadV3":return[3,10];case"TensorArrayGatherV3":return[3,11];case"TensorArrayScatterV3":return[3,12];case"TensorArrayConcatV3":return[3,13];case"TensorArraySplitV3":return[3,14];case"TensorArraySizeV3":return[3,15];case"TensorArrayCloseV3":return[3,16]}return[3,17];case 1:return[2,[F("pred",ge,fe,ye).clone()]];case 2:return Se=F("pred",ge,fe,ye),Ze=F("data",ge,fe,ye),[4,Se.data()];case 3:return[2,No.sent()[0]?[void 0,Ze.clone()]:[Ze.clone(),void 0]];case 4:return[2,(mt=ge.inputNames.find(function(vs){return ue(vs,fe,ye)!==void 0}))?[ue(mt,fe,ye).clone()]:void 0];case 5:return Rt=F("frameName",ge,fe,ye),cn=F("tensor",ge,fe,ye),ye.enterFrame(Rt),[2,[cn.clone()]];case 6:return Jn=F("tensor",ge,fe,ye),ye.exitFrame(),[2,[Jn.clone()]];case 7:return An=F("tensor",ge,fe,ye),ye.nextIteration(),[2,[An.clone()]];case 8:return Ln=F("size",ge,fe,ye),Hn=F("dtype",ge,fe,ye),It=F("elementShape",ge,fe,ye),Ot=F("dynamicSize",ge,fe,ye),pn=F("clearAfterRead",ge,fe,ye),qt=F("identicalElementShapes",ge,fe,ye),Ve=F("name",ge,fe,ye),jn=new xe(Ve,Hn,Ln,It,qt,Ot,pn),ye.addTensorArray(jn),[2,[Object(B.scalar)(jn.id),Object(B.scalar)(1)]];case 9:return $n=F("tensorArrayId",ge,fe,ye),Zn=F("index",ge,fe,ye),ir=F("tensor",ge,fe,ye),ye.getTensorArray($n).write(Zn,ir),[2,[Object(B.scalar)(1)]];case 10:return zr=F("tensorArrayId",ge,fe,ye),vr=F("index",ge,fe,ye),[2,[ye.getTensorArray(zr).read(vr)]];case 11:return pi=F("tensorArrayId",ge,fe,ye),la=F("indices",ge,fe,ye),ui=F("dtype",ge,fe,ye),[2,[ye.getTensorArray(pi).gather(la,ui)]];case 12:return Qi=F("tensorArrayId",ge,fe,ye),Di=F("indices",ge,fe,ye),qr=F("tensor",ge,fe,ye),ye.getTensorArray(Qi).scatter(Di,qr),[2,[Object(B.scalar)(1)]];case 13:return jr=F("tensorArrayId",ge,fe,ye),Bn=ye.getTensorArray(jr),ri=F("dtype",ge,fe,ye),[2,[Bn.concat(ri)]];case 14:return Vi=F("tensorArrayId",ge,fe,ye),Fr=F("tensor",ge,fe,ye),aa=F("lengths",ge,fe,ye),ye.getTensorArray(Vi).split(aa,Fr),[2,[Object(B.scalar)(1)]];case 15:return ma=F("tensorArrayId",ge,fe,ye),Zi=ye.getTensorArray(ma),[2,[Object(B.scalar)(Zi.size(),"int32")]];case 16:return ga=F("tensorArrayId",ge,fe,ye),ye.getTensorArray(ga).clearAndClose(),[2,[Object(B.scalar)(0)]];case 17:throw TypeError("Node type "+ge.op+" is not implemented")}})})},br=function(ge,fe,ye){switch(ge.op){case"Conv1D":var Se=F("stride",ge,fe,ye),Ze=F("pad",ge,fe,ye),mt=F("dataFormat",ge,fe,ye).toUpperCase(),Rt=F("dilation",ge,fe,ye);return[Object(B.conv1d)(F("x",ge,fe,ye),F("filter",ge,fe,ye),Se,Ze,mt,Rt)];case"Conv2D":Se=F("strides",ge,fe,ye),Ze=F("pad",ge,fe,ye),mt=F("dataFormat",ge,fe,ye).toUpperCase();var cn=F("dilations",ge,fe,ye);return[Object(B.conv2d)(F("x",ge,fe,ye),F("filter",ge,fe,ye),[Se[1],Se[2]],Ze,mt,[cn[1],cn[2]])];case"_FusedConv2D":case"FusedDepthwiseConv2dNative":var Jn=F("fusedOps",ge,fe,ye),An=Jn[0],Ln=Jn[1],Hn=An==="biasadd",It=Ln==="prelu",Ot=An==="fusedbatchnorm",pn=F("numArgs",ge,fe,ye);if(Hn){if(It&&pn!==2)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!It&&pn!==1)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(Ot)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported.");Se=F("strides",ge,fe,ye),Ze=F("pad",ge,fe,ye),mt=F("dataFormat",ge,fe,ye).toUpperCase(),cn=F("dilations",ge,fe,ye);var qt=F("args",ge,fe,ye),Ve=qt[0],jn=qt[1];return[(ge.op==="_FusedConv2D"?B.fused.conv2d:B.fused.depthwiseConv2d)({x:F("x",ge,fe,ye),filter:F("filter",ge,fe,ye),strides:[Se[1],Se[2]],pad:Ze,dataFormat:mt,dilations:[cn[1],cn[2]],bias:Ve,activation:Ln,preluActivationWeights:jn})];case"Conv2DBackpropInput":case"Conv2dTranspose":var $n=F("outputShape",ge,fe,ye);return Se=F("strides",ge,fe,ye),Ze=F("pad",ge,fe,ye),[Object(B.conv2dTranspose)(F("x",ge,fe,ye),F("filter",ge,fe,ye),$n,[Se[1],Se[2]],Ze)];case"DepthwiseConv2dNative":case"DepthwiseConv2d":return Se=F("strides",ge,fe,ye),Ze=F("pad",ge,fe,ye),cn=F("dilations",ge,fe,ye),mt=F("dataFormat",ge,fe,ye).toUpperCase(),[Object(B.depthwiseConv2d)(F("input",ge,fe,ye),F("filter",ge,fe,ye),[Se[1],Se[2]],Ze,mt,[cn[1],cn[2]])];case"Conv3D":return Se=F("strides",ge,fe,ye),Ze=F("pad",ge,fe,ye),mt=F("dataFormat",ge,fe,ye).toUpperCase(),cn=F("dilations",ge,fe,ye),[Object(B.conv3d)(F("x",ge,fe,ye),F("filter",ge,fe,ye),[Se[1],Se[2],Se[3]],Ze,mt,[cn[1],cn[2],cn[3]])];case"AvgPool":Se=F("strides",ge,fe,ye),Ze=F("pad",ge,fe,ye);var Zn=F("kernelSize",ge,fe,ye);return[Object(B.avgPool)(F("x",ge,fe,ye),[Zn[1],Zn[2]],[Se[1],Se[2]],Ze)];case"MaxPool":return Se=F("strides",ge,fe,ye),Ze=F("pad",ge,fe,ye),Zn=F("kernelSize",ge,fe,ye),[Object(B.maxPool)(F("x",ge,fe,ye),[Zn[1],Zn[2]],[Se[1],Se[2]],Ze)];case"MaxPoolWithArgmax":Se=F("strides",ge,fe,ye),Ze=F("pad",ge,fe,ye),Zn=F("kernelSize",ge,fe,ye);var ir=F("includeBatchInIndex",ge,fe,ye),zr=Object(B.maxPoolWithArgmax)(F("x",ge,fe,ye),[Zn[1],Zn[2]],[Se[1],Se[2]],Ze,ir);return[zr.result,zr.indexes];case"AvgPool3D":return Se=F("strides",ge,fe,ye),Ze=F("pad",ge,fe,ye),Zn=F("kernelSize",ge,fe,ye),[Object(B.avgPool3d)(F("x",ge,fe,ye),[Zn[1],Zn[2],Zn[3]],[Se[1],Se[2],Se[3]],Ze)];case"MaxPool3D":return Se=F("strides",ge,fe,ye),Ze=F("pad",ge,fe,ye),Zn=F("kernelSize",ge,fe,ye),[Object(B.maxPool3d)(F("x",ge,fe,ye),[Zn[1],Zn[2],Zn[3]],[Se[1],Se[2],Se[3]],Ze)];default:throw TypeError("Node type "+ge.op+" is not implemented")}},Cr=function(ge,fe,ye){switch(ge.op){case"Fill":var Se=F("shape",ge,fe,ye),Ze=F("dtype",ge,fe,ye),mt=F("value",ge,fe,ye);return[Object(B.fill)(Se,mt,Ze)];case"LinSpace":var Rt=F("start",ge,fe,ye),cn=F("stop",ge,fe,ye),Jn=F("num",ge,fe,ye);return[Object(B.linspace)(Rt,cn,Jn)];case"Multinomial":var An=F("logits",ge,fe,ye),Ln=F("numSamples",ge,fe,ye),Hn=F("seed",ge,fe,ye);return[Object(B.multinomial)(An,Ln,Hn)];case"OneHot":var It=F("indices",ge,fe,ye),Ot=F("depth",ge,fe,ye),pn=F("onValue",ge,fe,ye),qt=F("offValue",ge,fe,ye);return[Object(B.oneHot)(It,Ot,pn,qt)];case"Ones":return[Object(B.ones)(F("shape",ge,fe,ye),F("dtype",ge,fe,ye))];case"OnesLike":return[Object(B.onesLike)(F("x",ge,fe,ye))];case"RandomUniform":return[Object(B.randomUniform)(F("shape",ge,fe,ye),F("minval",ge,fe,ye),F("maxval",ge,fe,ye),F("dtype",ge,fe,ye))];case"Range":Rt=F("start",ge,fe,ye);var Ve=F("stop",ge,fe,ye),jn=F("step",ge,fe,ye);return[Object(B.range)(Rt,Ve,jn,F("dtype",ge,fe,ye))];case"TruncatedNormal":Se=F("shape",ge,fe,ye);var $n=F("mean",ge,fe,ye),Zn=F("stdDev",ge,fe,ye);return Hn=F("seed",ge,fe,ye),[Object(B.truncatedNormal)(Se,$n,Zn,F("dtype",ge,fe,ye),Hn)];case"Zeros":return[Object(B.zeros)(F("shape",ge,fe,ye),F("dtype",ge,fe,ye))];case"ZerosLike":return[Object(B.zerosLike)(F("x",ge,fe,ye))];default:throw TypeError("Node type "+ge.op+" is not implemented")}},dr=function(ge,fe,ye){return J(void 0,void 0,void 0,function(){var Se,Ze,mt,Rt,cn,Jn,An,Ln;return R(this,function(Hn){switch(Hn.label){case 0:switch(ge.op){case"NonMaxSuppressionV5":case"NonMaxSuppressionV3":case"NonMaxSuppressionV2":return[3,1];case"Where":return[3,5];case"ListDiff":return[3,7]}return[3,8];case 1:return Se=F("boxes",ge,fe,ye),Ze=F("scores",ge,fe,ye),mt=F("maxOutputSize",ge,fe,ye),Rt=F("iouThreshold",ge,fe,ye),cn=F("scoreThreshold",ge,fe,ye),ge.op!=="NonMaxSuppressionV5"?[3,3]:(Jn=F("softNmsSigma",ge,fe,ye),[4,B.image.nonMaxSuppressionWithScoreAsync(Se,Ze,mt,Rt,cn,Jn)]);case 2:return[2,[(Ln=Hn.sent()).selectedIndices,Ln.selectedScores]];case 3:return[4,B.image.nonMaxSuppressionAsync(Se,Ze,mt,Rt,cn)];case 4:return[2,[Hn.sent()]];case 5:return An=F("condition",ge,fe,ye).asType("bool"),[4,Object(B.whereAsync)(An)];case 6:return Ln=[Hn.sent()],An.dispose(),[2,Ln];case 7:return[2,Object(B.setdiff1dAsync)(F("x",ge,fe,ye),F("y",ge,fe,ye))];case 8:throw TypeError("Node type "+ge.op+" is not implemented")}})})},Rr=function(ge,fe,ye){switch(ge.op){case"TopKV2":var Se=F("x",ge,fe,ye),Ze=F("k",ge,fe,ye),mt=F("sorted",ge,fe,ye),Rt=Object(B.topk)(Se,Ze,mt);return[Rt.values,Rt.indices];default:throw TypeError("Node type "+ge.op+" is not implemented")}},hn=function(ge,fe,ye){switch(ge.op){case"Const":return fe[ge.name];case"PlaceholderWithDefault":var Se=F("default",ge,fe,ye);return[ue(ge.name,fe,ye)||Se];case"Placeholder":return[ue(ge.name,fe,ye)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":return[F("x",ge,fe,ye).clone()];case"IdentityN":return F("x",ge,fe,ye).map(function(An){return An.clone()});case"Snapshot":return[F("x",ge,fe,ye).clone()];case"Shape":return[Object(B.tensor1d)(F("x",ge,fe,ye).shape,"int32")];case"ShapeN":return F("x",ge,fe,ye).map(function(An){return Object(B.tensor1d)(An.shape)});case"Size":return[Object(B.scalar)(F("x",ge,fe,ye).size,"int32")];case"Rank":return[Object(B.scalar)(F("x",ge,fe,ye).rank,"int32")];case"NoOp":return[Object(B.scalar)(1)];case"Print":var Ze=F("x",ge,fe,ye),mt=F("data",ge,fe,ye),Rt=F("message",ge,fe,ye),cn=F("summarize",ge,fe,ye);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(Rt);for(var Jn=0;Jn<mt.length;Jn++)console.log(Array.prototype.slice.call(mt[Jn].dataSync()).slice(0,cn));return[Ze];default:throw TypeError("Node type "+ge.op+" is not implemented")}},Xt=function(ge,fe,ye){switch(ge.op){case"ResizeBilinear":var Se=F("images",ge,fe,ye),Ze=F("size",ge,fe,ye),mt=F("alignCorners",ge,fe,ye);return[B.image.resizeBilinear(Se,[Ze[0],Ze[1]],mt)];case"ResizeNearestNeighbor":return Se=F("images",ge,fe,ye),Ze=F("size",ge,fe,ye),mt=F("alignCorners",ge,fe,ye),[B.image.resizeNearestNeighbor(Se,[Ze[0],Ze[1]],mt)];case"CropAndResize":var Rt=F("image",ge,fe,ye),cn=F("boxes",ge,fe,ye),Jn=F("boxInd",ge,fe,ye),An=F("cropSize",ge,fe,ye),Ln=F("method",ge,fe,ye),Hn=F("extrapolationValue",ge,fe,ye);return[B.image.cropAndResize(Rt,cn,Jn,An,Ln,Hn)];default:throw TypeError("Node type "+ge.op+" is not implemented")}},nn=function(ge,fe,ye){switch(ge.op){case"Equal":return[Object(B.equal)(F("a",ge,fe,ye),F("b",ge,fe,ye))];case"NotEqual":return[Object(B.notEqual)(F("a",ge,fe,ye),F("b",ge,fe,ye))];case"Greater":return[Object(B.greater)(F("a",ge,fe,ye),F("b",ge,fe,ye))];case"GreaterEqual":return[Object(B.greaterEqual)(F("a",ge,fe,ye),F("b",ge,fe,ye))];case"Less":return[Object(B.less)(F("a",ge,fe,ye),F("b",ge,fe,ye))];case"LessEqual":return[Object(B.lessEqual)(F("a",ge,fe,ye),F("b",ge,fe,ye))];case"LogicalAnd":return[Object(B.logicalAnd)(F("a",ge,fe,ye),F("b",ge,fe,ye))];case"LogicalNot":return[Object(B.logicalNot)(F("a",ge,fe,ye))];case"LogicalOr":return[Object(B.logicalOr)(F("a",ge,fe,ye),F("b",ge,fe,ye))];case"Select":case"SelectV2":return[Object(B.where)(F("condition",ge,fe,ye),F("a",ge,fe,ye),F("b",ge,fe,ye))];default:throw TypeError("Node type "+ge.op+" is not implemented")}},Gn=function(ge,fe,ye){switch(ge.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[Object(B.matMul)(F("a",ge,fe,ye),F("b",ge,fe,ye),F("transposeA",ge,fe,ye),F("transposeB",ge,fe,ye))];case"Transpose":return[Object(B.transpose)(F("x",ge,fe,ye),F("perm",ge,fe,ye))];case"_FusedMatMul":var Se=F("fusedOps",ge,fe,ye),Ze=Se[0],mt=Se[1],Rt=Ze==="biasadd",cn=mt==="prelu",Jn=F("numArgs",ge,fe,ye);if(Rt){if(cn&&Jn!==2)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!cn&&Jn!==1)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}var An=F("args",ge,fe,ye),Ln=An[0],Hn=An[1];return[B.fused.matMul({a:F("a",ge,fe,ye),b:F("b",ge,fe,ye),transposeA:F("transposeA",ge,fe,ye),transposeB:F("transposeB",ge,fe,ye),bias:Ln,activation:mt,preluActivationWeights:Hn})];default:throw TypeError("Node type "+ge.op+" is not implemented")}},Dn=function(ge,fe,ye){switch(ge.op){case"FusedBatchNorm":case"FusedBatchNormV2":case"FusedBatchNormV3":return[Object(B.batchNorm)(F("x",ge,fe,ye),F("mean",ge,fe,ye),F("variance",ge,fe,ye),F("offset",ge,fe,ye),F("scale",ge,fe,ye),F("epsilon",ge,fe,ye))];case"LRN":return[Object(B.localResponseNormalization)(F("x",ge,fe,ye),F("radius",ge,fe,ye),F("bias",ge,fe,ye),F("alpha",ge,fe,ye),F("beta",ge,fe,ye))];case"Softmax":return[Object(B.softmax)(F("x",ge,fe,ye))];case"LogSoftmax":return[Object(B.logSoftmax)(F("x",ge,fe,ye))];case"SparseToDense":return[Object(B.sparseToDense)(F("sparseIndices",ge,fe,ye),F("outputShape",ge,fe,ye),F("sparseValues",ge,fe,ye),F("defaultValue",ge,fe,ye))];default:throw TypeError("Node type "+ge.op+" is not implemented")}},mr=function(ge,fe,ye){switch(ge.op){case"Max":var Se=F("axis",ge,fe,ye),Ze=F("keepDims",ge,fe,ye);return[Object(B.max)(F("x",ge,fe,ye),Se,Ze)];case"Mean":return Se=F("axis",ge,fe,ye),Ze=F("keepDims",ge,fe,ye),[Object(B.mean)(F("x",ge,fe,ye),Se,Ze)];case"Min":return Se=F("axis",ge,fe,ye),Ze=F("keepDims",ge,fe,ye),[Object(B.min)(F("x",ge,fe,ye),Se,Ze)];case"Sum":return Se=F("axis",ge,fe,ye),Ze=F("keepDims",ge,fe,ye),[Object(B.sum)(F("x",ge,fe,ye),Se,Ze)];case"All":return Se=F("axis",ge,fe,ye),Ze=F("keepDims",ge,fe,ye),[Object(B.all)(F("x",ge,fe,ye),Se,Ze)];case"Any":return Se=F("axis",ge,fe,ye),Ze=F("keepDims",ge,fe,ye),[Object(B.any)(F("x",ge,fe,ye),Se,Ze)];case"ArgMax":return Se=F("axis",ge,fe,ye),[Object(B.argMax)(F("x",ge,fe,ye),Se)];case"ArgMin":return Se=F("axis",ge,fe,ye),[Object(B.argMin)(F("x",ge,fe,ye),Se)];case"Prod":return Se=F("axis",ge,fe,ye),Ze=F("keepDims",ge,fe,ye),[Object(B.prod)(F("x",ge,fe,ye),Se,Ze)];default:throw TypeError("Node type "+ge.op+" is not implemented")}},xr=function(ge,fe,ye){switch(ge.op){case"ConcatV2":case"Concat":var Se=F("n",ge,fe,ye),Ze=F("axis",ge,fe,ye),mt=F("tensors",ge,fe,ye);return mt=mt.slice(0,Se),[Object(B.concat)(mt,Ze)];case"GatherV2":case"Gather":Ze=F("axis",ge,fe,ye);var Rt=F("x",ge,fe,ye),cn=F("indices",ge,fe,ye);return[Object(B.gather)(Rt,cn.asType("int32"),Ze)];case"ReverseV2":case"Reverse":return Ze=F("axis",ge,fe,ye),Rt=F("x",ge,fe,ye),[Object(B.reverse)(Rt,Ze)];case"Slice":var Jn=F("begin",ge,fe,ye),An=F("size",ge,fe,ye);return[Object(B.slice)(F("x",ge,fe,ye),Jn,An)];case"StridedSlice":Jn=F("begin",ge,fe,ye);var Ln=F("end",ge,fe,ye),Hn=F("strides",ge,fe,ye),It=F("beginMask",ge,fe,ye),Ot=F("endMask",ge,fe,ye),pn=F("ellipsisMask",ge,fe,ye),qt=F("newAxisMask",ge,fe,ye),Ve=F("shrinkAxisMask",ge,fe,ye),jn=F("x",ge,fe,ye);if(Jn.length===1&&jn.shape.length>1)for(var $n=1;$n<jn.shape.length;$n++)Jn.push(0),Ln.push(jn.shape[$n]),Hn.push(Hn[0]);return[Object(B.stridedSlice)(jn,Jn,Ln,Hn,It,Ot,pn,qt,Ve)];case"Pack":return Object(B.tidy)(function(){var Qi=F("axis",ge,fe,ye),Di=F("tensors",ge,fe,ye),qr=Di[0].shape,jr=Di[0].squeeze().shape,Bn=Di.map(function(ri){var Vi=B.util.arraysEqual(ri.shape,qr);if(!Vi&&!B.util.arraysEqual(ri.squeeze().shape,jr))throw new Error("the input tensors shape does not match");return Vi?ri:ri.reshape(qr)});return[Object(B.stack)(Bn,Qi)]});case"Unpack":return Object(B.tidy)(function(){var Qi=F("axis",ge,fe,ye),Di=F("tensor",ge,fe,ye);return Object(B.unstack)(Di,Qi)});case"Tile":var Zn=F("reps",ge,fe,ye);return[Object(B.tile)(F("x",ge,fe,ye),Zn)];case"Split":case"SplitV":Ze=F("axis",ge,fe,ye);var ir=F("numOrSizeSplits",ge,fe,ye);return Object(B.split)(F("x",ge,fe,ye),ir,Ze);case"ScatterNd":cn=F("indices",ge,fe,ye);var zr=F("values",ge,fe,ye),vr=F("shape",ge,fe,ye);return[Object(B.scatterND)(cn,zr,vr)];case"GatherNd":var pi=F("x",ge,fe,ye);return cn=F("indices",ge,fe,ye),[Object(B.gatherND)(pi,cn)];case"SparseToDense":cn=F("sparseIndices",ge,fe,ye),vr=F("outputShape",ge,fe,ye);var la=F("sparseValues",ge,fe,ye),ui=F("defaultValue",ge,fe,ye);return[Object(B.sparseToDense)(cn,la,vr,la.dtype===ui.dtype?ui:ui.asType(la.dtype))];default:throw TypeError("Node type "+ge.op+" is not implemented")}},gr=function(ge,fe,ye){switch(ge.op){case"FFT":return[Object(B.fft)(F("x",ge,fe,ye))];case"IFFT":return[Object(B.ifft)(F("x",ge,fe,ye))];case"RFFT":return[Object(B.rfft)(F("x",ge,fe,ye))];case"IRFFT":return[Object(B.irfft)(F("x",ge,fe,ye))];default:throw TypeError("Node type "+ge.op+" is not implemented")}},Qr=function(ge,fe,ye){switch(ge.op){case"Cast":return[Object(B.cast)(F("x",ge,fe,ye),F("dtype",ge,fe,ye))];case"ExpandDims":var Se=F("axis",ge,fe,ye);return[Object(B.expandDims)(F("x",ge,fe,ye),Se)];case"Squeeze":return Se=F("axis",ge,fe,ye),[Object(B.squeeze)(F("x",ge,fe,ye),Se)];case"Reshape":return[Object(B.reshape)(F("x",ge,fe,ye),F("shape",ge,fe,ye))];case"PadV2":case"Pad":return[Object(B.pad)(F("x",ge,fe,ye),pe(F("padding",ge,fe,ye),2),F("constantValue",ge,fe,ye))];case"SpaceToBatchND":var Ze=F("blockShape",ge,fe,ye),mt=pe(F("paddings",ge,fe,ye),2);return[Object(B.spaceToBatchND)(F("x",ge,fe,ye),Ze,mt)];case"BatchToSpaceND":Ze=F("blockShape",ge,fe,ye);var Rt=pe(F("crops",ge,fe,ye),2);return[Object(B.batchToSpaceND)(F("x",ge,fe,ye),Ze,Rt)];case"DepthToSpace":var cn=F("blockSize",ge,fe,ye),Jn=F("dataFormat",ge,fe,ye).toUpperCase();return[Object(B.depthToSpace)(F("x",ge,fe,ye),cn,Jn)];default:throw TypeError("Node type "+ge.op+" is not implemented")}};function ni(ge,fe,ye){var Se=function(Ze,mt,Rt){switch(Ze.category){case"arithmetic":return Object(B.tidy)(function(){return kn(Ze,mt,Rt)});case"basic_math":return Object(B.tidy)(function(){return qn(Ze,mt,Rt)});case"control":return Xn(Ze,mt,Rt);case"convolution":return Object(B.tidy)(function(){return br(Ze,mt,Rt)});case"creation":return Object(B.tidy)(function(){return Cr(Ze,mt,Rt)});case"dynamic":return dr(Ze,mt,Rt);case"evaluation":return Object(B.tidy)(function(){return Rr(Ze,mt,Rt)});case"image":return Object(B.tidy)(function(){return Xt(Ze,mt,Rt)});case"graph":return Object(B.tidy)(function(){return hn(Ze,mt,Rt)});case"logical":return Object(B.tidy)(function(){return nn(Ze,mt,Rt)});case"matrices":return Object(B.tidy)(function(){return Gn(Ze,mt,Rt)});case"normalization":return Object(B.tidy)(function(){return Dn(Ze,mt,Rt)});case"reduction":return Object(B.tidy)(function(){return mr(Ze,mt,Rt)});case"slice_join":return Object(B.tidy)(function(){return xr(Ze,mt,Rt)});case"spectral":return Object(B.tidy)(function(){return gr(Ze,mt,Rt)});case"transformation":return Object(B.tidy)(function(){return Qr(Ze,mt,Rt)});case"custom":var cn=L(Ze.op);if(cn&&cn.customExecutor)return cn.customExecutor(new Sn(Ze,mt,Rt));throw TypeError("Custom op "+Ze.op+" is not registered.");default:throw TypeError("Unknown op '"+Ze.op+"'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()")}}(ge,fe,ye);return Se instanceof Promise?Se.then(function(Ze){return[].concat(Ze)}):[].concat(Se)}var Mr=function(){function ge(fe,ye){this.weightMap=fe,this.tensorArrayMap=ye,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}return ge.prototype.newFrame=function(fe,ye){return{id:fe,frameName:ye,iterationId:0}},Object.defineProperty(ge.prototype,"currentContext",{get:function(){return this.contexts},set:function(fe){this.contexts!==fe&&(this.contexts=fe,this.generateCurrentContextIds())},enumerable:!0,configurable:!0}),Object.defineProperty(ge.prototype,"currentContextId",{get:function(){return this._currentContextIds[0]},enumerable:!0,configurable:!0}),Object.defineProperty(ge.prototype,"currentContextIds",{get:function(){return this._currentContextIds},enumerable:!0,configurable:!0}),ge.prototype.generateCurrentContextIds=function(){for(var fe=[],ye=0;ye<this.contexts.length-1;ye++){var Se=this.contexts.slice(0,this.contexts.length-ye);fe.push(this.contextIdforContexts(Se))}fe.push(""),this._currentContextIds=fe},ge.prototype.contextIdforContexts=function(fe){return fe?fe.map(function(ye){return ye.id===0&&ye.iterationId===0?"":ye.frameName+"-"+ye.iterationId}).join("/"):""},ge.prototype.enterFrame=function(fe){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,fe)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))},ge.prototype.exitFrame=function(){if(!(this.contexts&&this.contexts.length>1))throw new Error("Cannot exit frame, the context is empty");this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift()},ge.prototype.nextIteration=function(){if(!(this.contexts&&this.contexts.length>0))throw new Error("Cannot increase frame iteration, the context is empty");this.contexts=this.contexts.slice(),this.lastId++;var fe=Object.assign({},this.contexts[this.contexts.length-1]);fe.iterationId+=1,fe.id=this.lastId,this.contexts.splice(-1,1,fe),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))},ge.prototype.getWeight=function(fe){return this.weightMap[fe]},ge.prototype.addTensorArray=function(fe){this.tensorArrayMap[fe.id]=fe},ge.prototype.getTensorArray=function(fe){return this.tensorArrayMap[fe]},ge}();function di(ge,fe,ye){for(var Se=new Set,Ze=[],mt=null,Rt=null,cn=new Set,Jn=Object.keys(ge).map(function(Hn){return he(Hn)[0]}),An=fe.slice();An.length>0;){var Ln=An.pop();(fi(Ln)||ai(Ln))&&mt==null&&(Rt=(mt=Ln).children.map(function(Hn){return Hn.name}).filter(function(Hn){return Se.has(Hn)})),Se.add(Ln.name),ye[Ln.name]==null&&Jn.indexOf(Ln.name)===-1&&(Ln.inputs.length!==0?Ln.inputs.forEach(function(Hn){cn.has(Hn.name)||(cn.add(Hn.name),An.push(Hn))}):Ze.push(Ln.name))}return{inputs:ge,outputs:fe,usedNodes:Se,missingInputs:Ze,dynamicNode:mt,syncInputs:Rt}}var Yr=["Switch","Merge","Enter","Exit","NextIteration"],Xr=["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"];function fi(ge){return Yr.indexOf(ge.op)>=0}function ai(ge){return Xr.indexOf(ge.op)>=0}var Oa=function(){function ge(fe){this.graph=fe,this.compiledMap=new Map,this._weightMap={},this.SEPERATOR=",",this._outputs=fe.outputs,this._inputs=fe.inputs,this._signature=fe.signature}return Object.defineProperty(ge.prototype,"weightMap",{get:function(){return this._weightMap},set:function(fe){var ye=Object.keys(fe).map(function(Se){return fe[Se].map(function(Ze){return Ze.id})});this.weightIds=[].concat.apply([],ye),this._weightMap=fe},enumerable:!0,configurable:!0}),Object.defineProperty(ge.prototype,"inputs",{get:function(){return this._inputs.map(function(fe){return{name:fe.name,shape:fe.attrParams.shape?fe.attrParams.shape.value:void 0,dtype:fe.attrParams.dtype?fe.attrParams.dtype.value:void 0}})},enumerable:!0,configurable:!0}),Object.defineProperty(ge.prototype,"outputs",{get:function(){return this._outputs.map(function(fe){return{name:fe.name,shape:fe.attrParams.shape?fe.attrParams.shape.value:void 0,dtype:fe.attrParams.dtype?fe.attrParams.dtype.value:void 0}})},enumerable:!0,configurable:!0}),Object.defineProperty(ge.prototype,"inputNodes",{get:function(){return this._inputs.map(function(fe){return fe.signatureKey||fe.name})},enumerable:!0,configurable:!0}),Object.defineProperty(ge.prototype,"outputNodes",{get:function(){return this._outputs.map(function(fe){return fe.signatureKey||fe.name})},enumerable:!0,configurable:!0}),ge.prototype.getCompilationKey=function(fe,ye){var Se=fe.map(function(mt){return mt.name}).sort(),Ze=ye.map(function(mt){return mt.name}).sort();return Se.join(this.SEPERATOR)+"--"+Ze.join(this.SEPERATOR)},ge.prototype.compile=function(fe,ye){var Se=di(fe,ye,this.weightMap),Ze=Se.missingInputs,mt=Se.dynamicNode,Rt=Se.syncInputs;if(mt!=null)throw new Error("This execution contains the node '"+mt.name+"', which has the dynamic op '"+mt.op+"'. Please use model.executeAsync() instead. Alternatively, to avoid the dynamic ops, specify the inputs ["+Rt+"]");if(Ze.length>0){var cn=ye.map(function(An){return An.name}),Jn=Object.keys(fe);throw new Error("Cannot compute the outputs ["+cn+"] from the provided inputs ["+Jn+"]. Missing the following inputs: ["+Ze+"]")}return function(An,Ln,Hn){var It=Hn.usedNodes,Ot=Hn.inputs,pn=[];Object.keys(Ot).map(function($n){return he($n)[0]}).map(function($n){return An.nodes[$n]}).forEach(function($n){It.has($n.name)&&pn.push($n)}),An.weights.forEach(function($n){It.has($n.name)&&pn.push($n)});for(var qt=new Set,Ve=[];pn.length>0;){var jn=pn.pop();qt.add(jn.name),Ln[jn.name]||Ve.push(jn),jn.children.forEach(function($n){!qt.has($n.name)&&It.has($n.name)&&$n.inputs.every(function(Zn){return qt.has(Zn.name)})&&pn.push($n)})}return Ve}(this.graph,this.weightMap,Se)},ge.prototype.execute=function(fe,ye){var Se=this;fe=this.mapInputs(fe);var Ze=Object.keys(fe).sort();this.checkInputs(fe),this.checkInputShapeAndType(fe),ye=this.mapOutputs(ye),this.checkOutputs(ye);var mt=Ze.map(function(Ln){return Se.graph.nodes[he(Ln)[0]]}),Rt=ye.map(function(Ln){return Se.graph.nodes[he(Ln)[0]]}),cn=this.getCompilationKey(mt,Rt),Jn=this.compiledMap.get(cn);Jn==null&&(Jn=this.compile(fe,Rt),this.compiledMap.set(cn,Jn));var An={};return Object(B.tidy)(function(){var Ln=new Mr(Se._weightMap,An),Hn=re({},Se.weightMap);Object.keys(fe).forEach(function(jn){var $n=he(jn),Zn=$n[0],ir=[];ir[$n[1]]=fe[jn],Hn[Zn]=ir});for(var It=Se.getFrozenTensorIds(Hn),Ot={},pn=0;pn<Jn.length;pn++){var qt=Jn[pn];if(!Hn[qt.name]){var Ve=ni(qt,Hn,Ln);if(Ve instanceof Promise)throw new Error("The execution of the op '"+qt.op+"' returned a promise. Please use model.executeAsync() instead.");Hn[qt.name]=Ve,Se.checkTensorForDisposal(qt.name,qt,Hn,Ln,It,ye,Ot)}}return ye.map(function(jn){return ue(jn,Hn,Ln)})})},ge.prototype.getFrozenTensorIds=function(fe){var ye=[].concat.apply([],Object.keys(fe).map(function(Se){return fe[Se]}).map(function(Se){return Se.map(function(Ze){return Ze.id})}));return new Set(ye)},ge.prototype.checkTensorForDisposal=function(fe,ye,Se,Ze,mt,Rt,cn){ye.category!=="control"&&Rt.indexOf(fe)===-1&&(Se[fe].forEach(function(Jn){Jn!=null&&(cn[Jn.id]=(cn[Jn.id]||0)+ye.children.length)}),ye.inputs.forEach(function(Jn){if(Jn.category!=="control"){var An=function(Ln,Hn,It){return Hn[K(Ln,It.currentContextId)]}(Jn.name,Se,Ze);An?.forEach(function(Ln){if(Ln&&!mt.has(Ln.id)){var Hn=cn[Ln.id];Hn===1?(Ln.dispose(),delete cn[Ln.id]):Hn!=null&&cn[Ln.id]--}})}}))},ge.prototype.executeAsync=function(fe,ye){return J(this,void 0,void 0,function(){var Se,Ze,mt,Rt,cn,Jn,An=this;return R(this,function(Ln){switch(Ln.label){case 0:return fe=this.mapInputs(fe),this.checkInputs(fe),this.checkInputShapeAndType(fe),ye=this.mapOutputs(ye),this.checkOutputs(ye),Se={},Ze=new Mr(this._weightMap,Se),[4,this.executeWithControlFlow(fe,Ze,ye)];case 1:return mt=Ln.sent(),Rt=ye.map(function(Hn){return ue(Hn,mt,Ze)}),cn=new Set(Rt.map(function(Hn){return Hn.id})),Jn=new Set(Object.keys(fe).map(function(Hn){return fe[Hn].id})),Object.keys(mt).forEach(function(Hn){mt[Hn].forEach(function(It){!It||It.isDisposed||cn.has(It.id)||Jn.has(It.id)||An.weightIds.indexOf(It.id)!==-1||It.dispose()})}),[2,Rt]}})})},ge.prototype.executeWithControlFlow=function(fe,ye,Se){return J(this,void 0,void 0,function(){var Ze,mt,Rt,cn,Jn,An,Ln,Hn,It,Ot,pn,qt,Ve,jn,$n,Zn,ir=this;return R(this,function(zr){switch(zr.label){case 0:Ze=Object.keys(fe),mt=Ze.map(function(vr){return ir.graph.nodes[he(vr)[0]]}),Rt=Se.map(function(vr){return ir.graph.nodes[he(vr)[0]]}),cn=di(fe,Rt,this.weightMap),Jn=cn.usedNodes,An=cn.missingInputs,Ln=cn.dynamicNode,Hn=cn.syncInputs,It=mt.concat(this.graph.weights).map(function(vr){return{node:vr,contexts:ye.currentContext}}),Ot=re({},this.weightMap),Object.keys(fe).forEach(function(vr){var pi=he(vr),la=pi[0],ui=[];ui[pi[1]]=fe[vr],Ot[la]=ui}),pn={},qt=this.getFrozenTensorIds(Ot),Ve={},zr.label=1;case 1:return It.length>0?(jn=this.processStack(mt,It,ye,Ot,Ve,qt,Se,pn,Jn),[4,Promise.all(jn)]):[3,3];case 2:return zr.sent(),[3,1];case 3:if(Ln==null&&console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead."),($n=Rt.filter(function(vr){return!fi(vr)&&!ue(vr.name,Ot,ye)}).map(function(vr){return vr.name})).length>0)throw Zn="",Ln!=null&&(Zn="Alternatively, to avoid the dynamic ops, use model.execute() and specify the inputs ["+Hn+"]"),new Error("Cannot compute the outputs ["+$n+"] from the provided inputs ["+Ze+"]. Consider providing the following inputs: ["+An+"]. "+Zn);return[2,Ot]}})})},ge.prototype.processStack=function(fe,ye,Se,Ze,mt,Rt,cn,Jn,An){for(var Ln=this,Hn=[],It=function(){var pn=ye.pop();Se.currentContext=pn.contexts;var qt="";if(pn.node.op==="Enter"&&F("isConstant",pn.node,Ze,Se)&&(qt=ie(pn.node.name,Se)[0]),fe.indexOf(pn.node)===-1){var Ve=ni(pn.node,Ze,Se);qt||(qt=ie(pn.node.name,Se)[0]);var jn=Se.currentContext;Ve instanceof Promise?Hn.push(Ve.then(function($n){return Ze[qt]=$n,Se.currentContext=jn,Ln.checkTensorForDisposal(qt,pn.node,Ze,Se,Rt,cn,Jn),Ln.processChildNodes(pn.node,ye,Se,Ze,mt,An),$n})):(Ze[qt]=Ve,Ot.checkTensorForDisposal(qt,pn.node,Ze,Se,Rt,cn,Jn),Ot.processChildNodes(pn.node,ye,Se,Ze,mt,An))}else Ot.processChildNodes(pn.node,ye,Se,Ze,mt,An)},Ot=this;ye.length>0;)It();return Hn},ge.prototype.processChildNodes=function(fe,ye,Se,Ze,mt,Rt){fe.children.forEach(function(cn){var Jn=ie(cn.name,Se)[0];!mt[Jn]&&Rt.has(cn.name)&&(cn.op==="Merge"?cn.inputNames.some(function(An){return!!ue(An,Ze,Se)})&&(mt[Jn]=!0,ye.push({contexts:Se.currentContext,node:cn})):cn.inputNames.every(function(An){return!!ue(An,Ze,Se)})&&(mt[Jn]=!0,ye.push({contexts:Se.currentContext,node:cn})))})},ge.prototype.dispose=function(){var fe=this;Object.keys(this.weightMap).forEach(function(ye){return fe.weightMap[ye].forEach(function(Se){return Se.dispose()})})},ge.prototype.checkInputShapeAndType=function(fe){var ye=this;Object.keys(fe).forEach(function(Se){var Ze=fe[Se],mt=he(Se)[0],Rt=ye.graph.nodes[mt];if(Rt.attrParams.shape&&Rt.attrParams.shape.value){var cn=Rt.attrParams.shape.value,Jn=cn.length===Ze.shape.length&&Ze.shape.every(function(An,Ln){return cn[Ln]===-1||cn[Ln]===An});B.util.assert(Jn,function(){return"The shape of dict['"+Rt.name+"'] provided in model.execute(dict) must be ["+cn+"], but was ["+Ze.shape+"]"})}Rt.attrParams.dtype&&Rt.attrParams.dtype.value&&B.util.assert(Ze.dtype===Rt.attrParams.dtype.value,function(){return"The dtype of dict['"+Rt.name+"'] provided in model.execute(dict) must be "+Rt.attrParams.dtype.value+", but was "+Ze.dtype})})},ge.prototype.mapInputs=function(fe){var ye={};for(var Se in fe)this._signature!=null&&this._signature.inputs!=null&&this._signature.inputs[Se]!=null?ye[this._signature.inputs[Se].name]=fe[Se]:ye[Se]=fe[Se];return ye},ge.prototype.checkInputs=function(fe){var ye=this,Se=Object.keys(fe).filter(function(Ze){var mt=he(Ze)[0];return ye.graph.nodes[mt]==null});if(Se.length>0)throw new Error("The dict provided in model.execute(dict) has keys: ["+Se+"] that are not part of graph")},ge.prototype.mapOutputs=function(fe){var ye=this;return fe.map(function(Se){return ye._signature!=null&&ye._signature.outputs!=null&&ye._signature.outputs[Se]!=null?ye._signature.outputs[Se].name:Se},{})},ge.prototype.checkOutputs=function(fe){var ye=this;fe.forEach(function(Se){var Ze=he(Se)[0];if(!ye.graph.nodes[Ze])throw new Error("The output '"+Se+"' is not found in the graph")})},ge}(),Wi="?tfjs-format=file",Ci="model.json",yt=function(){function ge(fe,ye){ye===void 0&&(ye={}),this.modelUrl=fe,this.loadOptions=ye,this.version="n/a",ye==null&&(this.loadOptions={})}return Object.defineProperty(ge.prototype,"modelVersion",{get:function(){return this.version},enumerable:!0,configurable:!0}),Object.defineProperty(ge.prototype,"inputNodes",{get:function(){return this.executor.inputNodes},enumerable:!0,configurable:!0}),Object.defineProperty(ge.prototype,"outputNodes",{get:function(){return this.executor.outputNodes},enumerable:!0,configurable:!0}),Object.defineProperty(ge.prototype,"inputs",{get:function(){return this.executor.inputs},enumerable:!0,configurable:!0}),Object.defineProperty(ge.prototype,"outputs",{get:function(){return this.executor.outputs},enumerable:!0,configurable:!0}),Object.defineProperty(ge.prototype,"weights",{get:function(){return this.executor.weightMap},enumerable:!0,configurable:!0}),ge.prototype.findIOHandler=function(){var fe=this.modelUrl;if(fe.load!=null)this.handler=fe;else if(this.loadOptions.requestInit!=null)this.handler=B.io.browserHTTPRequest(fe,this.loadOptions);else{var ye=B.io.getLoadHandlers(fe,this.loadOptions.onProgress);if(ye.length===0)ye.push(B.io.browserHTTPRequest(fe,this.loadOptions));else if(ye.length>1)throw new Error("Found more than one ("+ye.length+") load handlers for URL '"+[fe]+"'");this.handler=ye[0]}},ge.prototype.load=function(){return J(this,void 0,void 0,function(){var fe,ye,Se,Ze;return R(this,function(mt){switch(mt.label){case 0:if(this.findIOHandler(),this.handler.load==null)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");return fe=this,[4,this.handler.load()];case 1:return fe.artifacts=mt.sent(),ye=this.artifacts.modelTopology,Se={},this.artifacts.userDefinedMetadata!=null&&(Se=this.artifacts.userDefinedMetadata.signature),this.version=ye.versions.producer+"."+ye.versions.minConsumer,Ze=B.io.decodeWeights(this.artifacts.weightData,this.artifacts.weightSpecs),this.executor=new Oa(Mt.Instance.transformGraph(ye,Se)),this.executor.weightMap=this.convertTensorMapToTensorsMap(Ze),[2,!0]}})})},ge.prototype.save=function(fe,ye){return J(this,void 0,void 0,function(){var Se;return R(this,function(Ze){if(typeof fe=="string"){if((Se=B.io.getSaveHandlers(fe)).length===0)throw new Error("Cannot find any save handlers for URL '"+fe+"'");if(Se.length>1)throw new Error("Found more than one ("+Se.length+") save handlers for URL '"+fe+"'");fe=Se[0]}if(fe.save==null)throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return[2,fe.save(this.artifacts)]})})},ge.prototype.predict=function(fe,ye){return this.execute(fe,this.outputNodes)},ge.prototype.normalizeInputs=function(fe){if(!(fe instanceof B.Tensor||Array.isArray(fe)))return fe;if((fe=Array.isArray(fe)?fe:[fe]).length!==this.inputNodes.length)throw new Error("Input tensor count mismatch,the graph model has "+this.inputNodes.length+" placeholders, while there are "+fe.length+" input tensors.");return this.inputNodes.reduce(function(ye,Se,Ze){return ye[Se]=fe[Ze],ye},{})},ge.prototype.normalizeOutputs=function(fe){return fe=fe||this.outputNodes,Array.isArray(fe)?fe:[fe]},ge.prototype.execute=function(fe,ye){fe=this.normalizeInputs(fe),ye=this.normalizeOutputs(ye);var Se=this.executor.execute(fe,ye);return Se.length>1?Se:Se[0]},ge.prototype.executeAsync=function(fe,ye){return J(this,void 0,void 0,function(){var Se;return R(this,function(Ze){switch(Ze.label){case 0:return fe=this.normalizeInputs(fe),ye=this.normalizeOutputs(ye),[4,this.executor.executeAsync(fe,ye)];case 1:return[2,(Se=Ze.sent()).length>1?Se:Se[0]]}})})},ge.prototype.convertTensorMapToTensorsMap=function(fe){return Object.keys(fe).reduce(function(ye,Se){return ye[Se]=[fe[Se]],ye},{})},ge.prototype.dispose=function(){this.executor.dispose()},ge}();function Lr(ge,fe){return fe===void 0&&(fe={}),J(this,void 0,void 0,function(){var ye;return R(this,function(Se){switch(Se.label){case 0:if(ge==null)throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");return fe==null&&(fe={}),fe.fromTFHub&&ge.load==null&&(ge.endsWith("/")||(ge+="/"),ge=""+ge+Ci+Wi),[4,(ye=new yt(ge,fe)).load()];case 1:return Se.sent(),[2,ye]}})})}var jt="1.7.4"}).call(this,o(92).Buffer)},function(Oe,A,o){/**
* @license
* Copyright 2017 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});var b=o(103);function H(ie){for(var K=ie.length,he=0,pe=0;K>0;)pe=Math.random()*K|0,he=ie[--K],ie[K]=ie[pe],ie[pe]=he}function U(ie,K){if(!ie)throw new Error(typeof K=="string"?K:K())}function B(ie,K,he){if(K===void 0&&(K=[]),he===void 0&&(he=!1),K==null&&(K=[]),Array.isArray(ie)||$(ie)&&!he)for(var pe=0;pe<ie.length;++pe)B(ie[pe],K,he);else K.push(ie);return K}function re(ie,K){if(ie===K)return!0;if(ie==null||K==null||ie.length!==K.length)return!1;for(var he=0;he<ie.length;he++)if(ie[he]!==K[he])return!1;return!0}function J(ie){return ie%1==0}function R(ie,K){var he=K.length;return U((ie=ie==null?K.map(function(pe,Ae){return Ae}):[].concat(ie)).every(function(pe){return pe>=-he&&pe<he}),function(){return"All values in axis param must be in range [-"+he+", "+he+") but got axis "+ie}),U(ie.every(function(pe){return J(pe)}),function(){return"All values in axis param must be integers but got axis "+ie}),ie.map(function(pe){return pe<0?he+pe:pe})}function P(ie,K){for(var he=0;he<ie.length;he++){var pe=ie[he];if(isNaN(pe)||!isFinite(pe))throw Error("A tensor of type "+K+" being uploaded contains "+pe+".")}}function $(ie){return ie instanceof Float32Array||ie instanceof Int32Array||ie instanceof Uint8Array}function L(ie){return typeof ie=="string"||ie instanceof String}function ee(ie){return typeof ie=="boolean"}function F(ie){return typeof ie=="number"}function ue(ie,K){if(K==null||K==="float32"||K==="complex64")return new Float32Array(ie);if(K==="int32")return new Int32Array(ie);if(K==="bool")return new Uint8Array(ie);throw new Error("Unknown data type "+K)}A.shuffle=H,A.clamp=function(ie,K,he){return Math.max(ie,Math.min(K,he))},A.nearestLargerEven=function(ie){return ie%2==0?ie:ie+1},A.sum=function(ie){for(var K=0,he=0;he<ie.length;he++)K+=ie[he];return K},A.randUniform=function(ie,K){var he=Math.random();return K*he+(1-he)*ie},A.distSquared=function(ie,K){for(var he=0,pe=0;pe<ie.length;pe++){var Ae=Number(ie[pe])-Number(K[pe]);he+=Ae*Ae}return he},A.assert=U,A.assertShapesMatch=function(ie,K,he){he===void 0&&(he=""),U(re(ie,K),function(){return he+" Shapes "+ie+" and "+K+" must match"})},A.assertNonNull=function(ie){U(ie!=null,function(){return"The input to the tensor constructor must be a non-null value."})},A.flatten=B,A.sizeFromShape=function(ie){if(ie.length===0)return 1;for(var K=ie[0],he=1;he<ie.length;he++)K*=ie[he];return K},A.isScalarShape=function(ie){return ie.length===0},A.arraysEqual=re,A.isInt=J,A.tanh=function(ie){if(Math.tanh!=null)return Math.tanh(ie);if(ie===1/0)return 1;if(ie===-1/0)return-1;var K=Math.exp(2*ie);return(K-1)/(K+1)},A.sizeToSquarishShape=function(ie){var K=Math.ceil(Math.sqrt(ie));return[K,Math.ceil(ie/K)]},A.createShuffledIndices=function(ie){for(var K=new Uint32Array(ie),he=0;he<ie;++he)K[he]=he;return H(K),K},A.rightPad=function(ie,K){return K<=ie.length?ie:ie+" ".repeat(K-ie.length)},A.repeatedTry=function(ie,K,he){return K===void 0&&(K=function(pe){return 0}),new Promise(function(pe,Ae){var Te=0,je=function(){if(ie())pe();else{var ke=K(++Te);he!=null&&Te>=he?Ae():setTimeout(je,ke)}};je()})},A.inferFromImplicitShape=function(ie,K){for(var he=1,pe=-1,Ae=0;Ae<ie.length;++Ae)if(ie[Ae]>=0)he*=ie[Ae];else if(ie[Ae]===-1){if(pe!==-1)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+pe+" and dim "+Ae);pe=Ae}else if(ie[Ae]<0)throw Error("Shapes can not be < 0. Found "+ie[Ae]+" at dim "+Ae);if(pe===-1){if(K>0&&K!==he)throw Error("Size("+K+") must match the product of shape "+ie);return ie}if(he===0)throw Error("Cannot infer the missing size in ["+ie+"] when there are 0 elements");if(K%he!=0)throw Error("The implicit shape can't be a fractional number. Got "+K+" / "+he);var Te=ie.slice();return Te[pe]=K/he,Te},A.parseAxisParam=R,A.squeezeShape=function(ie,K){for(var he=[],pe=[],Ae=K!=null&&Array.isArray(K)&&K.length===0,Te=K==null||Ae?null:R(K,ie).sort(),je=0,ke=0;ke<ie.length;++ke){if(Te!=null){if(Te[je]===ke&&ie[ke]!==1)throw new Error("Can't squeeze axis "+ke+" since its dim '"+ie[ke]+"' is not 1");(Te[je]==null||Te[je]>ke)&&ie[ke]===1&&(he.push(ie[ke]),pe.push(ke)),Te[je]<=ke&&je++}ie[ke]!==1&&(he.push(ie[ke]),pe.push(ke))}return{newShape:he,keptDims:pe}},A.getTypedArrayFromDType=function(ie,K){var he=null;if(ie==null||ie==="float32")he=new Float32Array(K);else if(ie==="int32")he=new Int32Array(K);else{if(ie!=="bool")throw new Error("Unknown data type "+ie);he=new Uint8Array(K)}return he},A.getArrayFromDType=function(ie,K){var he=null;if(ie==null||ie==="float32")he=new Float32Array(K);else if(ie==="int32")he=new Int32Array(K);else if(ie==="bool")he=new Uint8Array(K);else{if(ie!=="string")throw new Error("Unknown data type "+ie);he=new Array(K)}return he},A.checkConversionForErrors=P,A.isValidDtype=function(ie){return ie==="bool"||ie==="complex64"||ie==="float32"||ie==="int32"||ie==="string"},A.hasEncodingLoss=function(ie,K){return!(K==="complex64"||K==="float32"&&ie!=="complex64"||K==="int32"&&ie!=="float32"&&ie!=="complex64"||K==="bool"&&ie==="bool")},A.isTypedArray=$,A.bytesPerElement=function(ie){if(ie==="float32"||ie==="int32")return 4;if(ie==="complex64")return 8;if(ie==="bool")return 1;throw new Error("Unknown dtype "+ie)},A.bytesFromStringArray=function(ie){if(ie==null)return 0;var K=0;return ie.forEach(function(he){return K+=he.length}),K},A.isString=L,A.isBoolean=ee,A.isNumber=F,A.inferDtype=function ie(K){return Array.isArray(K)?ie(K[0]):K instanceof Float32Array?"float32":K instanceof Int32Array||K instanceof Uint8Array?"int32":F(K)?"float32":L(K)?"string":ee(K)?"bool":"float32"},A.isFunction=function(ie){return!!(ie&&ie.constructor&&ie.call&&ie.apply)},A.nearestDivisor=function(ie,K){for(var he=K;he<ie;++he)if(ie%he==0)return he;return ie},A.computeStrides=function(ie){var K=ie.length;if(K<2)return[];var he=new Array(K-1);he[K-2]=ie[K-1];for(var pe=K-3;pe>=0;--pe)he[pe]=he[pe+1]*ie[pe+1];return he},A.toTypedArray=function(ie,K,he){if(K==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(ie)&&(ie=B(ie)),he&&P(ie,K),function(Te,je){return Te instanceof Float32Array&&je==="float32"||Te instanceof Int32Array&&je==="int32"||Te instanceof Uint8Array&&je==="bool"}(ie,K))return ie;if(K==null||K==="float32"||K==="complex64")return new Float32Array(ie);if(K==="int32")return new Int32Array(ie);if(K==="bool"){for(var pe=new Uint8Array(ie.length),Ae=0;Ae<pe.length;++Ae)Math.round(ie[Ae])!==0&&(pe[Ae]=1);return pe}throw new Error("Unknown data type "+K)},A.toNestedArray=function(ie,K){if(ie.length===0)return K[0];var he=ie.reduce(function(pe,Ae){return pe*Ae});if(he===0)return[];if(he!==K.length)throw new Error("["+ie+"] does not match the input size.");return function pe(Ae,Te,je){var ke=new Array;if(Te.length===1)for(var at=Te[0],St=0;St<at;St++)ke[St]=je[Ae+St];else{at=Te[0];var zt=Te.slice(1),$t=zt.reduce(function(we,Tt){return we*Tt});for(St=0;St<at;St++)ke[St]=pe(Ae+St*$t,zt,je)}return ke}(0,ie,K)},A.makeOnesTypedArray=function(ie,K){for(var he=ue(ie,K),pe=0;pe<he.length;pe++)he[pe]=1;return he},A.makeZerosTypedArray=ue,A.now=function(){return b.env().platform.now()},A.assertNonNegativeIntegerDimensions=function(ie){ie.forEach(function(K){U(Number.isInteger(K)&&K>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+ie+"]."})})},A.fetch=function(ie,K){return b.env().platform.fetch(ie,K)},A.encodeString=function(ie,K){return K===void 0&&(K="utf-8"),K=K||"utf-8",b.env().platform.encode(ie,K)},A.decodeString=function(ie,K){return K===void 0&&(K="utf-8"),K=K||"utf-8",b.env().platform.decode(ie,K)},A.locToIndex=function(ie,K,he){if(K===0)return 0;if(K===1)return ie[0];for(var pe=ie[ie.length-1],Ae=0;Ae<ie.length-1;++Ae)pe+=he[Ae]*ie[Ae];return pe},A.indexToLoc=function(ie,K,he){if(K===0)return[];if(K===1)return[ie];for(var pe=new Array(K),Ae=0;Ae<pe.length-1;++Ae)pe[Ae]=Math.floor(ie/he[Ae]),ie-=pe[Ae]*he[Ae];return pe[pe.length-1]=ie,pe}},function(Oe,A,o){var b=o(54),H=Math.min;Oe.exports=function(U){return U>0?H(b(U),9007199254740991):0}},function(Oe,A,o){var b=o(262),H=o(261),U=o(187),B=o(260);Oe.exports=function(re,J){return b(re)||H(re,J)||U(re,J)||B()},Oe.exports.__esModule=!0,Oe.exports.default=Oe.exports},function(Oe,A){var o=Oe.exports={version:"2.6.12"};typeof __e=="number"&&(__e=o)},function(Oe,A,o){(function(b,H){/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var U=this&&this.__awaiter||function(he,pe,Ae,Te){return new(Ae||(Ae=Promise))(function(je,ke){function at($t){try{zt(Te.next($t))}catch(we){ke(we)}}function St($t){try{zt(Te.throw($t))}catch(we){ke(we)}}function zt($t){$t.done?je($t.value):new Ae(function(we){we($t.value)}).then(at,St)}zt((Te=Te.apply(he,pe||[])).next())})},B=this&&this.__generator||function(he,pe){var Ae,Te,je,ke,at={label:0,sent:function(){if(1&je[0])throw je[1];return je[1]},trys:[],ops:[]};return ke={next:St(0),throw:St(1),return:St(2)},typeof Symbol=="function"&&(ke[Symbol.iterator]=function(){return this}),ke;function St(zt){return function($t){return function(we){if(Ae)throw new TypeError("Generator is already executing.");for(;at;)try{if(Ae=1,Te&&(je=2&we[0]?Te.return:we[0]?Te.throw||((je=Te.return)&&je.call(Te),0):Te.next)&&!(je=je.call(Te,we[1])).done)return je;switch(Te=0,je&&(we=[2&we[0],je.value]),we[0]){case 0:case 1:je=we;break;case 4:return at.label++,{value:we[1],done:!1};case 5:at.label++,Te=we[1],we=[0];continue;case 7:we=at.ops.pop(),at.trys.pop();continue;default:if(!(je=(je=at.trys).length>0&&je[je.length-1])&&(we[0]===6||we[0]===2)){at=0;continue}if(we[0]===3&&(!je||we[1]>je[0]&&we[1]<je[3])){at.label=we[1];break}if(we[0]===6&&at.label<je[1]){at.label=je[1],je=we;break}if(je&&at.label<je[2]){at.label=je[2],at.ops.push(we);break}je[2]&&at.ops.pop(),at.trys.pop();continue}we=pe.call(he,at)}catch(Tt){we=[6,Tt],Te=0}finally{Ae=je=0}if(5&we[0])throw we[1];return{value:we[0]?we[1]:void 0,done:!0}}([zt,$t])}}};Object.defineProperty(A,"__esModule",{value:!0});var re,J=o(103),R=o(382),P=o(381),$=o(380),L=o(33),ee=o(74),F=o(21),ue=o(21),ie=function(){function he(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return he.prototype.dispose=function(){for(var pe in this.registeredVariables)this.registeredVariables[pe].dispose()},he}(),K=function(){function he(pe){this.ENV=pe,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new ie}return he.prototype.ready=function(){return U(this,void 0,void 0,function(){var pe,Ae,Te;return B(this,function(je){switch(je.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];pe=this.getSortedBackends(),Ae=0,je.label=1;case 1:return Ae<pe.length?(Te=pe[Ae],[4,this.initializeBackend(Te).success]):[3,5];case 2:return je.sent()?[4,this.setBackend(Te)]:[3,4];case 3:return je.sent(),[2];case 4:return Ae++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(he.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var pe=this.initializeBackendsAndReturnBest(),Ae=pe.name;if(pe.asyncInit)throw new Error("The highest priority backend '"+Ae+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(Ae)}return this.backendInstance},enumerable:!0,configurable:!0}),he.prototype.backendNames=function(){return Object.keys(this.registryFactory)},he.prototype.findBackend=function(pe){return!(pe in this.registry)&&(!(pe in this.registryFactory)||this.initializeBackend(pe).asyncInit)?null:this.registry[pe]},he.prototype.findBackendFactory=function(pe){return pe in this.registryFactory?this.registryFactory[pe].factory:null},he.prototype.registerBackend=function(pe,Ae,Te){return Te===void 0&&(Te=1),pe in this.registryFactory?(console.warn(pe+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[pe]={factory:Ae,priority:Te},!0)},he.prototype.setBackend=function(pe){return U(this,void 0,void 0,function(){var Ae,Te,je;return B(this,function(ke){switch(ke.label){case 0:if(this.registryFactory[pe]==null)throw new Error("Backend name '"+pe+"' not found in registry");return this.backendName=pe,this.registry[pe]!=null?[3,4]:(this.backendInstance=null,Ae=this.initializeBackend(pe),Te=Ae.success,Ae.asyncInit?[4,Te]:[3,2]);case 1:return je=ke.sent(),[3,3];case 2:je=Te,ke.label=3;case 3:if(!je)return[2,!1];ke.label=4;case 4:return this.backendInstance=this.registry[pe],this.setupRegisteredKernels(),this.profiler=new P.Profiler(this.backendInstance),[2,!0]}})})},he.prototype.setupRegisteredKernels=function(){var pe=this;R.getKernelsForBackend(this.backendName).forEach(function(Ae){Ae.setupFunc!=null&&Ae.setupFunc(pe.backendInstance)})},he.prototype.disposeRegisteredKernels=function(pe){var Ae=this;R.getKernelsForBackend(pe).forEach(function(Te){Te.disposeFunc!=null&&Te.disposeFunc(Ae.registry[pe])})},he.prototype.initializeBackend=function(pe){var Ae=this,Te=this.registryFactory[pe];if(Te==null)throw new Error("Cannot initialize backend "+pe+", no registration found.");try{var je=Te.factory();if(Promise.resolve(je)===je){var ke=++this.pendingBackendInitId,at=je.then(function(St){return!(ke<Ae.pendingBackendInitId)&&(Ae.registry[pe]=St,Ae.pendingBackendInit=null,!0)}).catch(function(St){return!(ke<Ae.pendingBackendInitId)&&(Ae.pendingBackendInit=null,console.warn("Initialization of backend "+pe+" failed"),console.warn(St.stack||St.message),!1)});return this.pendingBackendInit=at,{success:at,asyncInit:!0}}return this.registry[pe]=je,{success:!0,asyncInit:!1}}catch(St){return console.warn("Initialization of backend "+pe+" failed"),console.warn(St.stack||St.message),{success:!1,asyncInit:!1}}},he.prototype.removeBackend=function(pe){if(!(pe in this.registryFactory))throw new Error(pe+" backend not found in registry");this.backendName===pe&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,pe in this.registry&&(this.disposeRegisteredKernels(pe),this.registry[pe].dispose(),delete this.registry[pe]),delete this.registryFactory[pe],this.backendName===pe&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},he.prototype.getSortedBackends=function(){var pe=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(Ae,Te){return pe.registryFactory[Te].priority-pe.registryFactory[Ae].priority})},he.prototype.initializeBackendsAndReturnBest=function(){for(var pe=this.getSortedBackends(),Ae=0;Ae<pe.length;Ae++){var Te=pe[Ae],je=this.initializeBackend(Te),ke=je.success,at=je.asyncInit;if(at||ke)return{name:Te,asyncInit:at}}throw new Error("Could not initialize any backends, all backend initializations failed.")},he.prototype.moveData=function(pe,Ae){var Te=this.state.tensorInfo.get(Ae),je=Te.backend,ke=this.readSync(Ae);je.disposeData(Ae),Te.backend=pe,pe.move(Ae,ke,Te.shape,Te.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},he.prototype.tidy=function(pe,Ae){var Te,je=this,ke=null;if(Ae==null){if(typeof pe!="function")throw new Error("Please provide a function to tidy()");Ae=pe}else{if(typeof pe!="string"&&!(pe instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof Ae!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");ke=pe}return this.scopedRun(function(){return je.startScope(ke)},function(){return je.endScope(Te)},function(){return(Te=Ae())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),Te})},he.prototype.scopedRun=function(pe,Ae,Te){pe();try{var je=Te();return Ae(),je}catch(ke){throw Ae(),ke}},he.prototype.nextTensorId=function(){return he.nextTensorId++},he.prototype.nextVariableId=function(){return he.nextVariableId++},he.prototype.clone=function(pe){var Ae=this.makeTensorFromDataId(pe.dataId,pe.shape,pe.dtype),Te={x:pe};return this.addTapeNode(this.state.activeScope.name,Te,[Ae],function(je){return{x:function(){return je.toFloat()}}},[],{}),Ae},he.prototype.runKernel=function(pe,Ae,Te,je,ke){return this.runKernelFunc(null,Ae,null,pe,Te,je,ke)},he.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},he.prototype.checkKernelForMemLeak=function(pe,Ae,Te){var je=this.backend.numDataIds(),ke=0;Te.forEach(function(zt){ke+=zt.dtype==="complex64"?3:1});var at=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],St=je-Ae-ke-at;if(St>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+St+" data ids) after running '"+pe+"'")},he.prototype.runKernelFunc=function(pe,Ae,Te,je,ke,at,St){var zt,$t=this,we=[],Tt=this.isTapeOn();je==null&&(je=this.state.activeScope!=null?this.state.activeScope.name:"");var Gt,Pt=this.state.numBytes,Ye=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var ln,Zt=R.getKernel(je,this.backendName);if(Zt!=null)Gt=function(){var Mt=$t.backend.numDataIds();ln=Zt.kernelFunc({inputs:Ae,attrs:ke,backend:$t.backend});var bn=Array.isArray(ln)?ln:[ln];$t.shouldCheckForMemLeaks()&&$t.checkKernelForMemLeak(je,Mt,bn);var Dt=bn.map(function(In){var Yn=In.dataId,fn=In.shape,We=In.dtype;return $t.makeTensorFromDataId(Yn,fn,We)});if(Tt){var _t=$t.getTensorsForGradient(je,Ae,Dt);if(_t==null){St==null&&(St=[]);var xn=Dt.filter(function(In,Yn){return St[Yn]});_t=(at||[]).slice().concat(xn)}we=$t.saveTensorsForBackwardMode(_t)}return Dt};else{var Bt=function(Mt){Tt&&(we=Mt.map(function(bn){return $t.keep($t.clone(bn))}))};Gt=function(){var Mt=$t.backend.numDataIds();ln=$t.tidy(function(){return pe($t.backend,Bt)});var bn=Array.isArray(ln)?ln:[ln];return $t.shouldCheckForMemLeaks()&&$t.checkKernelForMemLeak(je,Mt,bn),bn}}return this.scopedRun(function(){return $t.state.kernelDepth++},function(){return $t.state.kernelDepth--},function(){zt=$t.ENV.getBool("DEBUG")?$t.profiler.profileKernel(je,Ae,function(){return Gt()}):Gt()}),Tt&&this.addTapeNode(je,Ae,zt,Te,we,ke),this.state.profiling&&this.state.activeProfile.kernels.push({name:je,bytesAdded:this.state.numBytes-Pt,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-Ye,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(Ae).map(function(Mt){return Ae[Mt].shape}),outputShapes:zt.map(function(Mt){return Mt.shape})}),Array.isArray(ln)?zt:zt[0]},he.prototype.saveTensorsForBackwardMode=function(pe){var Ae=this;return pe.map(function(Te){return Ae.keep(Ae.clone(Te))})},he.prototype.getTensorsForGradient=function(pe,Ae,Te){var je=R.getGradient(pe);if(je!=null){var ke=je.inputsToSave||[],at=je.outputsToSave||[],St=void 0;je.saveAllInputs?(F.assert(Array.isArray(Ae),function(){return"saveAllInputs is true, expected inputs to be an array."}),St=Object.keys(Ae).map(function($t){return Ae[$t]})):St=ke.map(function($t){return Ae[$t]});var zt=Te.filter(function($t,we){return at[we]});return St.concat(zt)}return null},he.prototype.makeTensor=function(pe,Ae,Te,je){if(pe==null)throw new Error("Values passed to engine.makeTensor() are null");Te=Te||"float32",je=je||this.backend;var ke=pe;Te==="string"&&F.isString(pe[0])&&(ke=pe.map(function(we){return F.encodeString(we)}));var at=je.write(ke,Ae,Te),St=new L.Tensor(Ae,Te,at,this.nextTensorId());if(this.incRef(St,je),Te==="string"){var zt=this.state.tensorInfo.get(at),$t=ue.bytesFromStringArray(ke);this.state.numBytes+=$t-zt.bytes,zt.bytes=$t}return St},he.prototype.makeTensorFromDataId=function(pe,Ae,Te,je){Te=Te||"float32";var ke=new L.Tensor(Ae,Te,pe,this.nextTensorId());return this.incRef(ke,je),ke},he.prototype.makeVariable=function(pe,Ae,Te,je){Ae===void 0&&(Ae=!0),Te=Te||this.nextVariableId().toString(),je!=null&&je!==pe.dtype&&(pe=pe.asType(je));var ke=new L.Variable(pe,Ae,Te,this.nextTensorId());if(this.state.registeredVariables[ke.name]!=null)throw new Error("Variable with name "+ke.name+" was already registered");return this.state.registeredVariables[ke.name]=ke,this.incRef(ke,this.backend),ke},he.prototype.incRef=function(pe,Ae){var Te=this.state.tensorInfo.has(pe.dataId)?this.state.tensorInfo.get(pe.dataId).refCount:0;if(this.state.numTensors++,pe.dtype==="string"&&this.state.numStringTensors++,Te===0){this.state.numDataBuffers++;var je=0;pe.dtype!=="complex64"&&pe.dtype!=="string"&&(je=pe.size*F.bytesPerElement(pe.dtype)),this.state.tensorInfo.set(pe.dataId,{backend:Ae||this.backend,dtype:pe.dtype,shape:pe.shape,bytes:je,refCount:0}),this.state.numBytes+=je}this.state.tensorInfo.get(pe.dataId).refCount++,pe instanceof L.Variable||this.track(pe)},he.prototype.disposeTensor=function(pe){if(this.state.tensorInfo.has(pe.dataId)){this.state.numTensors--,pe.dtype==="string"&&this.state.numStringTensors--;var Ae=this.state.tensorInfo.get(pe.dataId);Ae.refCount<=1?(pe.dtype!=="complex64"&&(this.state.numBytes-=Ae.bytes),this.state.numDataBuffers--,Ae.backend.disposeData(pe.dataId),this.state.tensorInfo.delete(pe.dataId)):this.state.tensorInfo.get(pe.dataId).refCount--}},he.prototype.disposeVariables=function(){for(var pe in this.state.registeredVariables){var Ae=this.state.registeredVariables[pe];this.disposeVariable(Ae)}},he.prototype.disposeVariable=function(pe){this.disposeTensor(pe),this.state.registeredVariables[pe.name]!=null&&delete this.state.registeredVariables[pe.name]},he.prototype.memory=function(){var pe=this.backend.memory();return pe.numTensors=this.state.numTensors,pe.numDataBuffers=this.state.numDataBuffers,pe.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(pe.unreliable=!0,pe.reasons==null&&(pe.reasons=[]),pe.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),pe},he.prototype.profile=function(pe){return U(this,void 0,void 0,function(){var Ae,Te;return B(this,function(je){return this.state.profiling=!0,Ae=this.state.numBytes,Te=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=pe(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(ke){return ke.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-Ae,this.state.activeProfile.newTensors=this.state.numTensors-Te,[2,this.state.activeProfile]})})},he.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},he.prototype.addTapeNode=function(pe,Ae,Te,je,ke,at){var St=this,zt={id:this.state.nextTapeNodeId++,kernelName:pe,inputs:Ae,outputs:Te,saved:ke},$t=R.getGradient(pe);$t!=null&&(je=$t.gradFunc),je!=null&&(zt.gradient=function(we){return we=we.map(function(Tt,Gt){if(Tt==null){var Pt=Te[Gt],Ye=F.makeZerosTypedArray(Pt.size,Pt.dtype);return St.makeTensor(Ye,Pt.shape,Pt.dtype)}return Tt}),je(we.length>1?we:we[0],ke,at)}),this.state.activeTape.push(zt)},he.prototype.keep=function(pe){return pe.kept=!0,pe},he.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},he.prototype.endTape=function(){this.state.gradientDepth--},he.prototype.startScope=function(pe){var Ae={track:[],name:"unnamed scope",id:this.state.nextScopeId++};pe&&(Ae.name=pe),this.state.scopeStack.push(Ae),this.state.activeScope=Ae},he.prototype.endScope=function(pe){for(var Ae=this,Te=ee.getTensorsInContainer(pe),je=new Set(Te.map(function(zt){return zt.id})),ke=0;ke<this.state.activeScope.track.length;ke++){var at=this.state.activeScope.track[ke];at.kept||je.has(at.id)||at.dispose()}var St=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],Te.forEach(function(zt){zt.kept||zt.scopeId!==St.id||Ae.track(zt)})},he.prototype.gradients=function(pe,Ae,Te,je){var ke=this;if(je===void 0&&(je=!1),F.assert(Ae.length>0,function(){return"gradients() received an empty list of xs."}),Te!=null&&Te.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '"+Te.dtype+"'");var at=this.scopedRun(function(){return ke.startTape()},function(){return ke.endTape()},function(){return ke.tidy("forward",pe)});F.assert(at instanceof L.Tensor,function(){return"The result y returned by f() must be a tensor."});var St=$.getFilteredNodesXToY(this.state.activeTape,Ae,at);if(!je&&St.length===0&&Ae.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var zt={};zt[at.id]=Te??function(we){var Tt=ue.makeOnesTypedArray(ue.sizeFromShape(we),"float32");return A.ENGINE.makeTensor(Tt,we,"float32")}(at.shape),$.backpropagateGradients(zt,St,function(we){return ke.tidy(we)});var $t=Ae.map(function(we){return zt[we.id]});return ke.state.gradientDepth===0&&(ke.state.activeTape.forEach(function(we){for(var Tt=0,Gt=we.saved;Tt<Gt.length;Tt++)Gt[Tt].dispose()}),ke.state.activeTape=null),{value:at,grads:$t}})},he.prototype.customGrad=function(pe){var Ae=this;return F.assert(F.isFunction(pe),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var Te,je=[],ke=0;ke<arguments.length;ke++)je[ke]=arguments[ke];F.assert(je.every(function(St){return St instanceof L.Tensor}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var at={};return je.forEach(function(St,zt){at[zt]=St}),Ae.runKernelFunc(function(St,zt){return Te=pe.apply(void 0,je.concat([zt])),F.assert(Te.value instanceof L.Tensor,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),F.assert(F.isFunction(Te.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),Te.value},at,function(St,zt){var $t=Te.gradFunc(St,zt),we=Array.isArray($t)?$t:[$t];F.assert(we.length===je.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),F.assert(we.every(function(Gt){return Gt instanceof L.Tensor}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var Tt={};return we.forEach(function(Gt,Pt){Tt[Pt]=function(){return Gt}}),Tt})}},he.prototype.readSync=function(pe){return this.state.tensorInfo.get(pe).backend.readSync(pe)},he.prototype.read=function(pe){return this.state.tensorInfo.get(pe).backend.read(pe)},he.prototype.time=function(pe){return U(this,void 0,void 0,function(){var Ae,Te;return B(this,function(je){switch(je.label){case 0:return Ae=ue.now(),[4,this.backend.time(pe)];case 1:return(Te=je.sent()).wallMs=ue.now()-Ae,[2,Te]}})})},he.prototype.track=function(pe){return this.state.activeScope!=null&&(pe.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(pe)),pe},Object.defineProperty(he.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),he.prototype.reset=function(){for(var pe in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new ie,this.registry)this.disposeRegisteredKernels(pe),this.registry[pe].dispose(),delete this.registry[pe];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},he.nextTensorId=0,he.nextVariableId=0,he}();A.Engine=K,A.ENGINE=function(){var he=function(){if(re==null){var Ae=void 0;if(typeof window<"u")Ae=window;else if(b!==void 0)Ae=b;else if(H!==void 0)Ae=H;else{if(typeof self>"u")throw new Error("Could not find a global object");Ae=self}re=Ae}return re}();if(he._tfengine==null){var pe=new J.Environment(he);he._tfengine=new K(pe)}return J.setEnvironmentGlobal(he._tfengine.ENV),L.setTensorTracker(function(){return he._tfengine}),he._tfengine}()}).call(this,o(59),o(75))},function(Oe,A,o){var b=o(14),H=o(240),U=o(66),B=Object.defineProperty;A.f=o(27)?Object.defineProperty:function(re,J,R){if(b(re),J=U(J,!0),b(R),H)try{return B(re,J,R)}catch{}if("get"in R||"set"in R)throw TypeError("Accessors not supported!");return"value"in R&&(re[J]=R.value),re}},function(Oe,A,o){Oe.exports=!o(15)(function(){return Object.defineProperty({},"a",{get:function(){return 7}}).a!=7})},function(Oe,A,o){Object.defineProperty(A,"__esModule",{value:!0});/**
 * @license
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var b=o(25);A.op=function(H){var U=Object.keys(H);if(U.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+U.length+" keys.");var B=U[0],re=H[B];B.endsWith("_")&&(B=B.substring(0,B.length-1));var J=function(){for(var R=[],P=0;P<arguments.length;P++)R[P]=arguments[P];b.ENGINE.startScope(B);try{var $=re.apply(void 0,R);return $ instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),b.ENGINE.endScope($),$}catch(L){throw b.ENGINE.endScope(null),L}};return Object.defineProperty(J,"name",{value:B,configurable:!0}),J}},function(Oe,A,o){/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});var b=o(25),H=o(103),U=o(33),B=o(21);function re(P,$){var L=P;if(B.isTypedArray(P))return $==="string"?[]:[P.length];if(!Array.isArray(P))return[];for(var ee=[];Array.isArray(L)||B.isTypedArray(L)&&$!=="string";)ee.push(L.length),L=L[0];return Array.isArray(P)&&H.env().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function F(ue,ie,K){if(K=K||[],!Array.isArray(ue)&&!B.isTypedArray(ue))return void B.assert(ie.length===0,function(){return"Element arr["+K.join("][")+"] is a primitive, but should be an array/TypedArray of "+ie[0]+" elements"});B.assert(ie.length>0,function(){return"Element arr["+K.join("][")+"] should be a primitive, but is an array of "+ue.length+" elements"}),B.assert(ue.length===ie[0],function(){return"Element arr["+K.join("][")+"] should have "+ie[0]+" elements, but has "+ue.length+" elements"});for(var he=ie.slice(1),pe=0;pe<ue.length;++pe)F(ue[pe],he,K.concat(pe))}(P,ee,[]),ee}function J(P,$,L,ee){if(P!=null&&(P!=="numeric"&&P!==$||P==="numeric"&&$==="string"))throw new Error("Argument '"+L+"' passed to '"+ee+"' must be "+P+" tensor, but got "+$+" tensor")}function R(P,$,L,ee){if(ee===void 0&&(ee="numeric"),P instanceof U.Tensor)return J(ee,P.dtype,$,L),P;var F=B.inferDtype(P);if(F!=="string"&&["bool","int32","float32"].indexOf(ee)>=0&&(F=ee),J(ee,F,$,L),P==null||!B.isTypedArray(P)&&!Array.isArray(P)&&typeof P!="number"&&typeof P!="boolean"&&typeof P!="string"){var ue=P==null?"null":P.constructor.name;throw new Error("Argument '"+$+"' passed to '"+L+"' must be a Tensor or TensorLike, but got '"+ue+"'")}var ie=re(P,F);B.isTypedArray(P)||Array.isArray(P)||(P=[P]);var K=F!=="string"?B.toTypedArray(P,F,H.env().getBool("DEBUG")):B.flatten(P,[],!0);return b.ENGINE.makeTensor(K,ie,F)}A.inferShape=re,A.convertToTensor=R,A.convertToTensorArray=function(P,$,L,ee){if(ee===void 0&&(ee="numeric"),!Array.isArray(P))throw new Error("Argument "+$+" passed to "+L+" must be a `Tensor[]` or `TensorLike[]`");return P.map(function(F,ue){return R(F,$+"["+ue+"]",L)},ee)}},function(Oe,A,o){var b=o(254),H=o(253),U=o(187),B=o(252);Oe.exports=function(re){return b(re)||H(re)||U(re)||B()},Oe.exports.__esModule=!0,Oe.exports.default=Oe.exports},function(Oe,A,o){o.d(A,"a",function(){return U});var b=new Date,H=new Date;function U(B,re,J,R){function P($){return B($=arguments.length===0?new Date:new Date(+$)),$}return P.floor=function($){return B($=new Date(+$)),$},P.ceil=function($){return B($=new Date($-1)),re($,1),B($),$},P.round=function($){var L=P($),ee=P.ceil($);return $-L<ee-$?L:ee},P.offset=function($,L){return re($=new Date(+$),L==null?1:Math.floor(L)),$},P.range=function($,L,ee){var F,ue=[];if($=P.ceil($),ee=ee==null?1:Math.floor(ee),!($<L&&ee>0))return ue;do ue.push(F=new Date(+$)),re($,ee),B($);while(F<$&&$<L);return ue},P.filter=function($){return U(function(L){if(L>=L)for(;B(L),!$(L);)L.setTime(L-1)},function(L,ee){if(L>=L)if(ee<0)for(;++ee<=0;)for(;re(L,-1),!$(L););else for(;--ee>=0;)for(;re(L,1),!$(L););})},J&&(P.count=function($,L){return b.setTime(+$),H.setTime(+L),B(b),B(H),Math.floor(J(b,H))},P.every=function($){return $=Math.floor($),isFinite($)&&$>0?$>1?P.filter(R?function(L){return R(L)%$==0}:function(L){return P.count(0,L)%$==0}):P:null}),P}},function(Oe,A,o){const b=o(116),{MAX_LENGTH:H,MAX_SAFE_INTEGER:U}=o(117),{re:B,t:re}=o(90),J=o(115),{compareIdentifiers:R}=o(146);class P{constructor(L,ee){if(ee=J(ee),L instanceof P){if(L.loose===!!ee.loose&&L.includePrerelease===!!ee.includePrerelease)return L;L=L.version}else if(typeof L!="string")throw new TypeError(`Invalid Version: ${L}`);if(L.length>H)throw new TypeError(`version is longer than ${H} characters`);b("SemVer",L,ee),this.options=ee,this.loose=!!ee.loose,this.includePrerelease=!!ee.includePrerelease;const F=L.trim().match(ee.loose?B[re.LOOSE]:B[re.FULL]);if(!F)throw new TypeError(`Invalid Version: ${L}`);if(this.raw=L,this.major=+F[1],this.minor=+F[2],this.patch=+F[3],this.major>U||this.major<0)throw new TypeError("Invalid major version");if(this.minor>U||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>U||this.patch<0)throw new TypeError("Invalid patch version");F[4]?this.prerelease=F[4].split(".").map(ue=>{if(/^[0-9]+$/.test(ue)){const ie=+ue;if(ie>=0&&ie<U)return ie}return ue}):this.prerelease=[],this.build=F[5]?F[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(L){if(b("SemVer.compare",this.version,this.options,L),!(L instanceof P)){if(typeof L=="string"&&L===this.version)return 0;L=new P(L,this.options)}return L.version===this.version?0:this.compareMain(L)||this.comparePre(L)}compareMain(L){return L instanceof P||(L=new P(L,this.options)),R(this.major,L.major)||R(this.minor,L.minor)||R(this.patch,L.patch)}comparePre(L){if(L instanceof P||(L=new P(L,this.options)),this.prerelease.length&&!L.prerelease.length)return-1;if(!this.prerelease.length&&L.prerelease.length)return 1;if(!this.prerelease.length&&!L.prerelease.length)return 0;let ee=0;do{const F=this.prerelease[ee],ue=L.prerelease[ee];if(b("prerelease compare",ee,F,ue),F===void 0&&ue===void 0)return 0;if(ue===void 0)return 1;if(F===void 0)return-1;if(F!==ue)return R(F,ue)}while(++ee)}compareBuild(L){L instanceof P||(L=new P(L,this.options));let ee=0;do{const F=this.build[ee],ue=L.build[ee];if(b("prerelease compare",ee,F,ue),F===void 0&&ue===void 0)return 0;if(ue===void 0)return 1;if(F===void 0)return-1;if(F!==ue)return R(F,ue)}while(++ee)}inc(L,ee){switch(L){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",ee);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",ee);break;case"prepatch":this.prerelease.length=0,this.inc("patch",ee),this.inc("pre",ee);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",ee),this.inc("pre",ee);break;case"major":this.minor===0&&this.patch===0&&this.prerelease.length!==0||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":this.patch===0&&this.prerelease.length!==0||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":if(this.prerelease.length===0)this.prerelease=[0];else{let F=this.prerelease.length;for(;--F>=0;)typeof this.prerelease[F]=="number"&&(this.prerelease[F]++,F=-2);F===-1&&this.prerelease.push(0)}ee&&(this.prerelease[0]===ee?isNaN(this.prerelease[1])&&(this.prerelease=[ee,0]):this.prerelease=[ee,0]);break;default:throw new Error(`invalid increment argument: ${L}`)}return this.format(),this.raw=this.version,this}}Oe.exports=P},function(Oe,A,o){/**
* @license
* Copyright 2017 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/var b=this&&this.__extends||function(){var ue=function(ie,K){return(ue=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(he,pe){he.__proto__=pe}||function(he,pe){for(var Ae in pe)pe.hasOwnProperty(Ae)&&(he[Ae]=pe[Ae])})(ie,K)};return function(ie,K){function he(){this.constructor=ie}ue(ie,K),ie.prototype=K===null?Object.create(K):(he.prototype=K.prototype,new he)}}(),H=this&&this.__awaiter||function(ue,ie,K,he){return new(K||(K=Promise))(function(pe,Ae){function Te(at){try{ke(he.next(at))}catch(St){Ae(St)}}function je(at){try{ke(he.throw(at))}catch(St){Ae(St)}}function ke(at){at.done?pe(at.value):new K(function(St){St(at.value)}).then(Te,je)}ke((he=he.apply(ue,ie||[])).next())})},U=this&&this.__generator||function(ue,ie){var K,he,pe,Ae,Te={label:0,sent:function(){if(1&pe[0])throw pe[1];return pe[1]},trys:[],ops:[]};return Ae={next:je(0),throw:je(1),return:je(2)},typeof Symbol=="function"&&(Ae[Symbol.iterator]=function(){return this}),Ae;function je(ke){return function(at){return function(St){if(K)throw new TypeError("Generator is already executing.");for(;Te;)try{if(K=1,he&&(pe=2&St[0]?he.return:St[0]?he.throw||((pe=he.return)&&pe.call(he),0):he.next)&&!(pe=pe.call(he,St[1])).done)return pe;switch(he=0,pe&&(St=[2&St[0],pe.value]),St[0]){case 0:case 1:pe=St;break;case 4:return Te.label++,{value:St[1],done:!1};case 5:Te.label++,he=St[1],St=[0];continue;case 7:St=Te.ops.pop(),Te.trys.pop();continue;default:if(!(pe=(pe=Te.trys).length>0&&pe[pe.length-1])&&(St[0]===6||St[0]===2)){Te=0;continue}if(St[0]===3&&(!pe||St[1]>pe[0]&&St[1]<pe[3])){Te.label=St[1];break}if(St[0]===6&&Te.label<pe[1]){Te.label=pe[1],pe=St;break}if(pe&&Te.label<pe[2]){Te.label=pe[2],Te.ops.push(St);break}pe[2]&&Te.ops.pop(),Te.trys.pop();continue}St=ie.call(ue,Te)}catch(zt){St=[6,zt],he=0}finally{K=pe=0}if(5&St[0])throw St[1];return{value:St[0]?St[1]:void 0,done:!0}}([ke,at])}}};Object.defineProperty(A,"__esModule",{value:!0});var B=o(379),re=o(21),J=o(21),R=function(){function ue(ie,K,he){var pe=this;if(this.dtype=K,this.shape=ie.slice(),this.size=re.sizeFromShape(ie),he!=null){var Ae=he.length;re.assert(Ae===this.size,function(){return"Length of values '"+Ae+"' does not match the size inferred by the shape '"+pe.size+"'."})}if(K==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=he||re.getArrayFromDType(K,this.size),this.strides=J.computeStrides(ie)}return ue.prototype.set=function(ie){for(var K=this,he=[],pe=1;pe<arguments.length;pe++)he[pe-1]=arguments[pe];he.length===0&&(he=[0]),re.assert(he.length===this.rank,function(){return"The number of provided coordinates ("+he.length+") must match the rank ("+K.rank+")"});var Ae=this.locToIndex(he);this.values[Ae]=ie},ue.prototype.get=function(){for(var ie=[],K=0;K<arguments.length;K++)ie[K]=arguments[K];ie.length===0&&(ie=[0]);for(var he=0,pe=0,Ae=ie;pe<Ae.length;pe++){var Te=Ae[pe];if(Te<0||Te>=this.shape[he]){var je="Requested out of range element at "+ie+".   Buffer shape="+this.shape;throw new Error(je)}he++}for(var ke=ie[ie.length-1],at=0;at<ie.length-1;++at)ke+=this.strides[at]*ie[at];return this.values[ke]},ue.prototype.locToIndex=function(ie){if(this.rank===0)return 0;if(this.rank===1)return ie[0];for(var K=ie[ie.length-1],he=0;he<ie.length-1;++he)K+=this.strides[he]*ie[he];return K},ue.prototype.indexToLoc=function(ie){if(this.rank===0)return[];if(this.rank===1)return[ie];for(var K=new Array(this.shape.length),he=0;he<K.length-1;++he)K[he]=Math.floor(ie/this.strides[he]),ie-=K[he]*this.strides[he];return K[K.length-1]=ie,K},Object.defineProperty(ue.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),ue.prototype.toTensor=function(){return P().makeTensor(this.values,this.shape,this.dtype)},ue}();A.TensorBuffer=R;var P=null,$=null,L=null;A.setTensorTracker=function(ue){P=ue},A.setOpHandler=function(ue){$=ue},A.setDeprecationWarningFn=function(ue){L=ue};var ee=function(){function ue(ie,K,he,pe){this.kept=!1,this.isDisposedInternal=!1,this.shape=ie.slice(),this.dtype=K||"float32",this.size=re.sizeFromShape(ie),this.strides=J.computeStrides(ie),this.dataId=he,this.id=pe,this.rankType=this.rank<5?this.rank.toString():"higher"}return ue.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},ue.prototype.asScalar=function(){return this.throwIfDisposed(),re.assert(this.size===1,function(){return"The array must have only 1 element."}),this.reshape([])},ue.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},ue.prototype.as2D=function(ie,K){return this.throwIfDisposed(),this.reshape([ie,K])},ue.prototype.as3D=function(ie,K,he){return this.throwIfDisposed(),this.reshape([ie,K,he])},ue.prototype.as4D=function(ie,K,he,pe){return this.throwIfDisposed(),this.reshape([ie,K,he,pe])},ue.prototype.as5D=function(ie,K,he,pe,Ae){return this.throwIfDisposed(),this.reshape([ie,K,he,pe,Ae])},ue.prototype.asType=function(ie){return this.throwIfDisposed(),$.cast(this,ie)},Object.defineProperty(ue.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),ue.prototype.buffer=function(){return H(this,void 0,void 0,function(){var ie;return U(this,function(K){switch(K.label){case 0:return[4,this.data()];case 1:return ie=K.sent(),[2,$.buffer(this.shape,this.dtype,ie)]}})})},ue.prototype.bufferSync=function(){return $.buffer(this.shape,this.dtype,this.dataSync())},ue.prototype.array=function(){return H(this,void 0,void 0,function(){var ie;return U(this,function(K){switch(K.label){case 0:return[4,this.data()];case 1:return ie=K.sent(),[2,J.toNestedArray(this.shape,ie)]}})})},ue.prototype.arraySync=function(){return J.toNestedArray(this.shape,this.dataSync())},ue.prototype.data=function(){return H(this,void 0,void 0,function(){var ie,K;return U(this,function(he){switch(he.label){case 0:return this.throwIfDisposed(),ie=P().read(this.dataId),this.dtype!=="string"?[3,2]:[4,ie];case 1:K=he.sent();try{return[2,K.map(function(pe){return re.decodeString(pe)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}he.label=2;case 2:return[2,ie]}})})},ue.prototype.dataSync=function(){this.throwIfDisposed();var ie=P().readSync(this.dataId);if(this.dtype==="string")try{return ie.map(function(K){return re.decodeString(K)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return ie},ue.prototype.bytes=function(){return H(this,void 0,void 0,function(){var ie;return U(this,function(K){switch(K.label){case 0:return this.throwIfDisposed(),[4,P().read(this.dataId)];case 1:return ie=K.sent(),this.dtype==="string"?[2,ie]:[2,new Uint8Array(ie.buffer)]}})})},ue.prototype.dispose=function(){this.isDisposed||(P().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(ue.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),ue.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},ue.prototype.toFloat=function(){return this.asType("float32")},ue.prototype.toInt=function(){return this.asType("int32")},ue.prototype.toBool=function(){return this.asType("bool")},ue.prototype.print=function(ie){return ie===void 0&&(ie=!1),$.print(this,ie)},ue.prototype.reshape=function(ie){return this.throwIfDisposed(),$.reshape(this,ie)},ue.prototype.reshapeAs=function(ie){return this.throwIfDisposed(),this.reshape(ie.shape)},ue.prototype.expandDims=function(ie){return ie===void 0&&(ie=0),$.expandDims(this,ie)},ue.prototype.cumsum=function(ie,K,he){return ie===void 0&&(ie=0),K===void 0&&(K=!1),he===void 0&&(he=!1),$.cumsum(this,ie,K,he)},ue.prototype.squeeze=function(ie){return this.throwIfDisposed(),$.squeeze(this,ie)},ue.prototype.clone=function(){return this.throwIfDisposed(),$.clone(this)},ue.prototype.toString=function(ie){ie===void 0&&(ie=!1);var K=this.dataSync();return B.tensorToString(K,this.shape,this.dtype,ie)},ue.prototype.gather=function(ie,K){return K===void 0&&(K=0),this.throwIfDisposed(),$.gather(this,ie,K)},ue.prototype.matMul=function(ie,K,he){return K===void 0&&(K=!1),he===void 0&&(he=!1),this.throwIfDisposed(),$.matMul(this,ie,K,he)},ue.prototype.dot=function(ie){return this.throwIfDisposed(),$.dot(this,ie)},ue.prototype.norm=function(ie,K,he){return ie===void 0&&(ie="euclidean"),K===void 0&&(K=null),he===void 0&&(he=!1),this.throwIfDisposed(),$.norm(this,ie,K,he)},ue.prototype.slice=function(ie,K){return this.throwIfDisposed(),$.slice(this,ie,K)},ue.prototype.reverse=function(ie){return this.throwIfDisposed(),$.reverse(this,ie)},ue.prototype.concat=function(ie,K){return K===void 0&&(K=0),this.throwIfDisposed(),ie instanceof ue&&(ie=[ie]),$.concat([this].concat(ie),K)},ue.prototype.split=function(ie,K){return K===void 0&&(K=0),this.throwIfDisposed(),$.split(this,ie,K)},ue.prototype.stack=function(ie,K){return K===void 0&&(K=0),$.stack([this,ie],K)},ue.prototype.unstack=function(ie){return ie===void 0&&(ie=0),$.unstack(this,ie)},ue.prototype.batchNormalization=function(ie,K,he,pe,Ae){return he===void 0&&(he=.001),L("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(ie,K,Ae,pe,he)},ue.prototype.all=function(ie,K){return ie===void 0&&(ie=null),K===void 0&&(K=!1),this.throwIfDisposed(),$.all(this,ie,K)},ue.prototype.any=function(ie,K){return ie===void 0&&(ie=null),K===void 0&&(K=!1),this.throwIfDisposed(),$.any(this,ie,K)},ue.prototype.logSumExp=function(ie,K){return ie===void 0&&(ie=null),K===void 0&&(K=!1),this.throwIfDisposed(),$.logSumExp(this,ie,K)},ue.prototype.sum=function(ie,K){return ie===void 0&&(ie=null),K===void 0&&(K=!1),this.throwIfDisposed(),$.sum(this,ie,K)},ue.prototype.prod=function(ie,K){return ie===void 0&&(ie=null),K===void 0&&(K=!1),this.throwIfDisposed(),$.prod(this,ie,K)},ue.prototype.mean=function(ie,K){return ie===void 0&&(ie=null),K===void 0&&(K=!1),this.throwIfDisposed(),$.mean(this,ie,K)},ue.prototype.min=function(ie,K){return ie===void 0&&(ie=null),K===void 0&&(K=!1),this.throwIfDisposed(),$.min(this,ie,K)},ue.prototype.max=function(ie,K){return ie===void 0&&(ie=null),K===void 0&&(K=!1),this.throwIfDisposed(),$.max(this,ie,K)},ue.prototype.argMin=function(ie){return ie===void 0&&(ie=null),this.throwIfDisposed(),$.argMin(this,ie)},ue.prototype.argMax=function(ie){return ie===void 0&&(ie=null),this.throwIfDisposed(),$.argMax(this,ie)},ue.prototype.cast=function(ie){return this.throwIfDisposed(),$.cast(this,ie)},ue.prototype.addStrict=function(ie){return this.throwIfDisposed(),$.addStrict(this,ie)},ue.prototype.atan2=function(ie){return this.throwIfDisposed(),$.atan2(this,ie)},ue.prototype.sub=function(ie){return this.throwIfDisposed(),$.sub(this,ie)},ue.prototype.subStrict=function(ie){return this.throwIfDisposed(),$.subStrict(this,ie)},ue.prototype.pow=function(ie){return this.throwIfDisposed(),$.pow(this,ie)},ue.prototype.powStrict=function(ie){return this.throwIfDisposed(),$.powStrict(this,ie)},ue.prototype.mul=function(ie){return this.throwIfDisposed(),$.mul(this,ie)},ue.prototype.mulStrict=function(ie){return this.throwIfDisposed(),$.mulStrict(this,ie)},ue.prototype.floorDiv=function(ie){return this.throwIfDisposed(),$.floorDiv(this,ie)},ue.prototype.divStrict=function(ie){return this.throwIfDisposed(),$.divStrict(this,ie)},ue.prototype.minimum=function(ie){return this.throwIfDisposed(),$.minimum(this,ie)},ue.prototype.minimumStrict=function(ie){return this.throwIfDisposed(),$.minimumStrict(this,ie)},ue.prototype.maximum=function(ie){return this.throwIfDisposed(),$.maximum(this,ie)},ue.prototype.maximumStrict=function(ie){return this.throwIfDisposed(),$.maximumStrict(this,ie)},ue.prototype.mod=function(ie){return this.throwIfDisposed(),$.mod(this,ie)},ue.prototype.modStrict=function(ie){return this.throwIfDisposed(),$.modStrict(this,ie)},ue.prototype.squaredDifferenceStrict=function(ie){return this.throwIfDisposed(),$.squaredDifferenceStrict(this,ie)},ue.prototype.notEqual=function(ie){return this.throwIfDisposed(),$.notEqual(this,ie)},ue.prototype.notEqualStrict=function(ie){return this.throwIfDisposed(),$.notEqualStrict(this,ie)},ue.prototype.less=function(ie){return this.throwIfDisposed(),$.less(this,ie)},ue.prototype.lessStrict=function(ie){return this.throwIfDisposed(),$.lessStrict(this,ie)},ue.prototype.equal=function(ie){return this.throwIfDisposed(),$.equal(this,ie)},ue.prototype.equalStrict=function(ie){return this.throwIfDisposed(),$.equalStrict(this,ie)},ue.prototype.lessEqual=function(ie){return this.throwIfDisposed(),$.lessEqual(this,ie)},ue.prototype.lessEqualStrict=function(ie){return this.throwIfDisposed(),$.lessEqualStrict(this,ie)},ue.prototype.greater=function(ie){return this.throwIfDisposed(),$.greater(this,ie)},ue.prototype.greaterStrict=function(ie){return this.throwIfDisposed(),$.greaterStrict(this,ie)},ue.prototype.greaterEqual=function(ie){return this.throwIfDisposed(),$.greaterEqual(this,ie)},ue.prototype.greaterEqualStrict=function(ie){return this.throwIfDisposed(),$.greaterEqualStrict(this,ie)},ue.prototype.logicalAnd=function(ie){return this.throwIfDisposed(),$.logicalAnd(this,ie)},ue.prototype.logicalOr=function(ie){return this.throwIfDisposed(),$.logicalOr(this,ie)},ue.prototype.logicalNot=function(){return this.throwIfDisposed(),$.logicalNot(this)},ue.prototype.logicalXor=function(ie){return this.throwIfDisposed(),$.logicalXor(this,ie)},ue.prototype.where=function(ie,K){return this.throwIfDisposed(),$.where(ie,this,K)},ue.prototype.neg=function(){return this.throwIfDisposed(),$.neg(this)},ue.prototype.ceil=function(){return this.throwIfDisposed(),$.ceil(this)},ue.prototype.floor=function(){return this.throwIfDisposed(),$.floor(this)},ue.prototype.sign=function(){return this.throwIfDisposed(),$.sign(this)},ue.prototype.isNaN=function(){return this.throwIfDisposed(),$.isNaN(this)},ue.prototype.isInf=function(){return this.throwIfDisposed(),$.isInf(this)},ue.prototype.isFinite=function(){return this.throwIfDisposed(),$.isFinite(this)},ue.prototype.exp=function(){return this.throwIfDisposed(),$.exp(this)},ue.prototype.expm1=function(){return this.throwIfDisposed(),$.expm1(this)},ue.prototype.log=function(){return this.throwIfDisposed(),$.log(this)},ue.prototype.log1p=function(){return this.throwIfDisposed(),$.log1p(this)},ue.prototype.sqrt=function(){return this.throwIfDisposed(),$.sqrt(this)},ue.prototype.rsqrt=function(){return this.throwIfDisposed(),$.rsqrt(this)},ue.prototype.square=function(){return this.throwIfDisposed(),$.square(this)},ue.prototype.reciprocal=function(){return this.throwIfDisposed(),$.reciprocal(this)},ue.prototype.abs=function(){return this.throwIfDisposed(),$.abs(this)},ue.prototype.clipByValue=function(ie,K){return this.throwIfDisposed(),$.clipByValue(this,ie,K)},ue.prototype.relu=function(){return this.throwIfDisposed(),$.relu(this)},ue.prototype.relu6=function(){return this.throwIfDisposed(),$.relu6(this)},ue.prototype.elu=function(){return this.throwIfDisposed(),$.elu(this)},ue.prototype.selu=function(){return this.throwIfDisposed(),$.selu(this)},ue.prototype.leakyRelu=function(ie){return ie===void 0&&(ie=.2),this.throwIfDisposed(),$.leakyRelu(this,ie)},ue.prototype.prelu=function(ie){return this.throwIfDisposed(),$.prelu(this,ie)},ue.prototype.sigmoid=function(){return this.throwIfDisposed(),$.sigmoid(this)},ue.prototype.logSigmoid=function(){return this.throwIfDisposed(),$.logSigmoid(this)},ue.prototype.softplus=function(){return this.throwIfDisposed(),$.softplus(this)},ue.prototype.zerosLike=function(){return this.throwIfDisposed(),$.zerosLike(this)},ue.prototype.onesLike=function(){return this.throwIfDisposed(),$.onesLike(this)},ue.prototype.sin=function(){return this.throwIfDisposed(),$.sin(this)},ue.prototype.cos=function(){return this.throwIfDisposed(),$.cos(this)},ue.prototype.tan=function(){return this.throwIfDisposed(),$.tan(this)},ue.prototype.asin=function(){return this.throwIfDisposed(),$.asin(this)},ue.prototype.acos=function(){return this.throwIfDisposed(),$.acos(this)},ue.prototype.atan=function(){return this.throwIfDisposed(),$.atan(this)},ue.prototype.sinh=function(){return this.throwIfDisposed(),$.sinh(this)},ue.prototype.cosh=function(){return this.throwIfDisposed(),$.cosh(this)},ue.prototype.tanh=function(){return this.throwIfDisposed(),$.tanh(this)},ue.prototype.asinh=function(){return this.throwIfDisposed(),$.asinh(this)},ue.prototype.acosh=function(){return this.throwIfDisposed(),$.acosh(this)},ue.prototype.atanh=function(){return this.throwIfDisposed(),$.atanh(this)},ue.prototype.erf=function(){return this.throwIfDisposed(),$.erf(this)},ue.prototype.round=function(){return this.throwIfDisposed(),$.round(this)},ue.prototype.step=function(ie){return ie===void 0&&(ie=0),this.throwIfDisposed(),$.step(this,ie)},ue.prototype.softmax=function(ie){return ie===void 0&&(ie=-1),this.throwIfDisposed(),$.softmax(this,ie)},ue.prototype.logSoftmax=function(ie){return ie===void 0&&(ie=-1),this.throwIfDisposed(),$.logSoftmax(this,ie)},ue.prototype.resizeBilinear=function(ie,K){return K===void 0&&(K=!1),this.throwIfDisposed(),$.image.resizeBilinear(this,ie,K)},ue.prototype.resizeNearestNeighbor=function(ie,K){return K===void 0&&(K=!1),this.throwIfDisposed(),$.image.resizeNearestNeighbor(this,ie,K)},ue.prototype.conv1d=function(ie,K,he,pe,Ae,Te){return pe===void 0&&(pe="NWC"),Ae===void 0&&(Ae=1),this.throwIfDisposed(),$.conv1d(this,ie,K,he,pe,Ae,Te)},ue.prototype.conv2d=function(ie,K,he,pe,Ae,Te){return pe===void 0&&(pe="NHWC"),Ae===void 0&&(Ae=[1,1]),this.throwIfDisposed(),$.conv2d(this,ie,K,he,pe,Ae,Te)},ue.prototype.conv2dTranspose=function(ie,K,he,pe,Ae){return this.throwIfDisposed(),$.conv2dTranspose(this,ie,K,he,pe,Ae)},ue.prototype.depthwiseConv2D=function(ie,K,he,pe,Ae,Te){return pe===void 0&&(pe="NHWC"),Ae===void 0&&(Ae=[1,1]),this.throwIfDisposed(),$.depthwiseConv2d(this,ie,K,he,pe,Ae,Te)},ue.prototype.separableConv2d=function(ie,K,he,pe,Ae,Te){return Ae===void 0&&(Ae=[1,1]),Te===void 0&&(Te="NHWC"),this.throwIfDisposed(),$.separableConv2d(this,ie,K,he,pe,Ae,Te)},ue.prototype.avgPool=function(ie,K,he,pe){return this.throwIfDisposed(),$.avgPool(this,ie,K,he,pe)},ue.prototype.maxPool=function(ie,K,he,pe){return this.throwIfDisposed(),$.maxPool(this,ie,K,he,pe)},ue.prototype.localResponseNormalization=function(ie,K,he,pe){return ie===void 0&&(ie=5),K===void 0&&(K=1),he===void 0&&(he=1),pe===void 0&&(pe=.5),$.localResponseNormalization(this,ie,K,he,pe)},ue.prototype.pool=function(ie,K,he,pe,Ae){return this.throwIfDisposed(),$.pool(this,ie,K,he,pe,Ae)},ue.prototype.variable=function(ie,K,he){return ie===void 0&&(ie=!0),this.throwIfDisposed(),P().makeVariable(this,ie,K,he)},ue.prototype.unsortedSegmentSum=function(ie,K){return this.throwIfDisposed(),$.unsortedSegmentSum(this,ie,K)},ue.prototype.batchToSpaceND=function(ie,K){return this.throwIfDisposed(),$.batchToSpaceND(this,ie,K)},ue.prototype.spaceToBatchND=function(ie,K){return this.throwIfDisposed(),$.spaceToBatchND(this,ie,K)},ue.prototype.topk=function(ie,K){return ie===void 0&&(ie=1),K===void 0&&(K=!0),this.throwIfDisposed(),$.topk(this,ie,K)},ue.prototype.stridedSlice=function(ie,K,he,pe,Ae,Te,je,ke){return pe===void 0&&(pe=0),Ae===void 0&&(Ae=0),Te===void 0&&(Te=0),je===void 0&&(je=0),ke===void 0&&(ke=0),this.throwIfDisposed(),$.stridedSlice(this,ie,K,he,pe,Ae,Te,je,ke)},ue.prototype.depthToSpace=function(ie,K){return this.throwIfDisposed(),$.depthToSpace(this,ie,K)},ue.prototype.fft=function(){return this.throwIfDisposed(),$.spectral.fft(this)},ue.prototype.ifft=function(){return this.throwIfDisposed(),$.spectral.ifft(this)},ue.prototype.rfft=function(){return this.throwIfDisposed(),$.spectral.rfft(this)},ue.prototype.irfft=function(){return this.throwIfDisposed(),$.spectral.irfft(this)},ue}();A.Tensor=ee,Object.defineProperty(ee,Symbol.hasInstance,{value:function(ue){return!!ue&&ue.dataId!=null&&ue.shape!=null&&ue.dtype!=null}});var F=function(ue){function ie(K,he,pe,Ae){var Te=ue.call(this,K.shape,K.dtype,K.dataId,Ae)||this;return Te.trainable=he,Te.name=pe,Te}return b(ie,ue),ie.prototype.assign=function(K){if(K.dtype!==this.dtype)throw new Error("dtype of the new value ("+K.dtype+") and previous value ("+this.dtype+") must match");if(!re.arraysEqual(K.shape,this.shape))throw new Error("shape of the new value ("+K.shape+") and previous value ("+this.shape+") must match");P().disposeTensor(this),this.dataId=K.dataId,P().incRef(this,null)},ie.prototype.dispose=function(){P().disposeVariable(this),this.isDisposedInternal=!0},ie}(ee);A.Variable=F,Object.defineProperty(F,Symbol.hasInstance,{value:function(ue){return ue instanceof ee&&ue.assign!=null&&ue.assign instanceof Function}})},function(Oe,A,o){var b=o(61);Oe.exports=function(H){return Object(b(H))}},function(Oe,A){function o(b){return Oe.exports=o=Object.setPrototypeOf?Object.getPrototypeOf:function(H){return H.__proto__||Object.getPrototypeOf(H)},Oe.exports.__esModule=!0,Oe.exports.default=Oe.exports,o(b)}Oe.exports=o,Oe.exports.__esModule=!0,Oe.exports.default=Oe.exports},function(Oe,A,o){var b=o(195),H=Object.prototype.toString;function U($){return H.call($)==="[object Array]"}function B($){return $===void 0}function re($){return $!==null&&typeof $=="object"}function J($){if(H.call($)!=="[object Object]")return!1;var L=Object.getPrototypeOf($);return L===null||L===Object.prototype}function R($){return H.call($)==="[object Function]"}function P($,L){if($!=null)if(typeof $!="object"&&($=[$]),U($))for(var ee=0,F=$.length;ee<F;ee++)L.call(null,$[ee],ee,$);else for(var ue in $)Object.prototype.hasOwnProperty.call($,ue)&&L.call(null,$[ue],ue,$)}Oe.exports={isArray:U,isArrayBuffer:function($){return H.call($)==="[object ArrayBuffer]"},isBuffer:function($){return $!==null&&!B($)&&$.constructor!==null&&!B($.constructor)&&typeof $.constructor.isBuffer=="function"&&$.constructor.isBuffer($)},isFormData:function($){return typeof FormData<"u"&&$ instanceof FormData},isArrayBufferView:function($){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView($):$&&$.buffer&&$.buffer instanceof ArrayBuffer},isString:function($){return typeof $=="string"},isNumber:function($){return typeof $=="number"},isObject:re,isPlainObject:J,isUndefined:B,isDate:function($){return H.call($)==="[object Date]"},isFile:function($){return H.call($)==="[object File]"},isBlob:function($){return H.call($)==="[object Blob]"},isFunction:R,isStream:function($){return re($)&&R($.pipe)},isURLSearchParams:function($){return typeof URLSearchParams<"u"&&$ instanceof URLSearchParams},isStandardBrowserEnv:function(){return(typeof navigator>"u"||navigator.product!=="ReactNative"&&navigator.product!=="NativeScript"&&navigator.product!=="NS")&&typeof window<"u"&&typeof document<"u"},forEach:P,merge:function $(){var L={};function ee(ie,K){J(L[K])&&J(ie)?L[K]=$(L[K],ie):J(ie)?L[K]=$({},ie):U(ie)?L[K]=ie.slice():L[K]=ie}for(var F=0,ue=arguments.length;F<ue;F++)P(arguments[F],ee);return L},extend:function($,L,ee){return P(L,function(F,ue){$[ue]=ee&&typeof F=="function"?b(F,ee):F}),$},trim:function($){return $.trim?$.trim():$.replace(/^\s+|\s+$/g,"")},stripBOM:function($){return $.charCodeAt(0)===65279&&($=$.slice(1)),$}}},function(Oe,A,o){var b=o(8),H=o(15),U=o(61),B=/"/g,re=function(J,R,P,$){var L=String(U(J)),ee="<"+R;return P!==""&&(ee+=" "+P+'="'+String($).replace(B,"&quot;")+'"'),ee+">"+L+"</"+R+">"};Oe.exports=function(J,R){var P={};P[J]=R(re),b(b.P+b.F*H(function(){var $=""[J]('"');return $!==$.toLowerCase()||$.split('"').length>3}),"String",P)}},function(Oe,A,o){var b=o(16),H=o(42),U=o(43),B=o(84)("src"),re=o(576),J=(""+re).split("toString");o(24).inspectSource=function(R){return re.call(R)},(Oe.exports=function(R,P,$,L){var ee=typeof $=="function";ee&&(U($,"name")||H($,"name",P)),R[P]!==$&&(ee&&(U($,B)||H($,B,R[P]?""+R[P]:J.join(String(P)))),R===b?R[P]=$:L?R[P]?R[P]=$:H(R,P,$):(delete R[P],H(R,P,$)))})(Function.prototype,"toString",function(){return typeof this=="function"&&this[B]||re.call(this)})},function(Oe,A,o){o.d(A,"b",function(){return B}),o.d(A,"a",function(){return re}),o.d(A,"c",function(){return P});var b=o(31),H=o(12);function U(ee){return Object(b.a)(function(F){F.setUTCDate(F.getUTCDate()-(F.getUTCDay()+7-ee)%7),F.setUTCHours(0,0,0,0)},function(F,ue){F.setUTCDate(F.getUTCDate()+7*ue)},function(F,ue){return(ue-F)/H.f})}var B=U(0),re=U(1),J=U(2),R=U(3),P=U(4),$=U(5),L=U(6);B.range,re.range,J.range,R.range,P.range,$.range,L.range},function(Oe,A,o){o.d(A,"b",function(){return B}),o.d(A,"a",function(){return re}),o.d(A,"c",function(){return P});var b=o(31),H=o(12);function U(ee){return Object(b.a)(function(F){F.setDate(F.getDate()-(F.getDay()+7-ee)%7),F.setHours(0,0,0,0)},function(F,ue){F.setDate(F.getDate()+7*ue)},function(F,ue){return(ue-F-(ue.getTimezoneOffset()-F.getTimezoneOffset())*H.c)/H.f})}var B=U(0),re=U(1),J=U(2),R=U(3),P=U(4),$=U(5),L=U(6);B.range,re.range,J.range,R.range,P.range,$.range,L.range},function(Oe,A,o){var b=o(107),H=o(61);Oe.exports=function(U){return b(H(U))}},function(Oe,A,o){var b=o(26),H=o(85);Oe.exports=o(27)?function(U,B,re){return b.f(U,B,H(1,re))}:function(U,B,re){return U[B]=re,U}},function(Oe,A){var o={}.hasOwnProperty;Oe.exports=function(b,H){return o.call(b,H)}},function(Oe,A,o){var b=o(45),H=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function U(fn){if(!(We=H.exec(fn)))throw new Error("invalid format: "+fn);var We;return new B({fill:We[1],align:We[2],sign:We[3],symbol:We[4],zero:We[5],width:We[6],comma:We[7],precision:We[8]&&We[8].slice(1),trim:We[9],type:We[10]})}function B(fn){this.fill=fn.fill===void 0?" ":fn.fill+"",this.align=fn.align===void 0?">":fn.align+"",this.sign=fn.sign===void 0?"-":fn.sign+"",this.symbol=fn.symbol===void 0?"":fn.symbol+"",this.zero=!!fn.zero,this.width=fn.width===void 0?void 0:+fn.width,this.comma=!!fn.comma,this.precision=fn.precision===void 0?void 0:+fn.precision,this.trim=!!fn.trim,this.type=fn.type===void 0?"":fn.type+""}U.prototype=B.prototype,B.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,0|this.width))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};function re(fn,We){if((Pe=(fn=We?fn.toExponential(We-1):fn.toExponential()).indexOf("e"))<0)return null;var Pe,rt=fn.slice(0,Pe);return[rt.length>1?rt[0]+rt.slice(2):rt,+fn.slice(Pe+1)]}var J,R,P,$,L=function(fn){return(fn=re(Math.abs(fn)))?fn[1]:NaN},ee=function(fn,We){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(L(We)/3)))-L(Math.abs(fn)))},F=function(fn,We){return fn=Math.abs(fn),We=Math.abs(We)-fn,Math.max(0,L(We)-L(fn))+1},ue=function(fn){return Math.max(0,-L(Math.abs(fn)))},ie=function(fn){e:for(var We,Pe=fn.length,rt=1,Et=-1;rt<Pe;++rt)switch(fn[rt]){case".":Et=We=rt;break;case"0":Et===0&&(Et=rt),We=rt;break;default:if(!+fn[rt])break e;Et>0&&(Et=0)}return Et>0?fn.slice(0,Et)+fn.slice(We+1):fn},K=function(fn,We){var Pe=re(fn,We);if(!Pe)return fn+"";var rt=Pe[0],Et=Pe[1];return Et<0?"0."+new Array(-Et).join("0")+rt:rt.length>Et+1?rt.slice(0,Et+1)+"."+rt.slice(Et+1):rt+new Array(Et-rt.length+2).join("0")},he={"%":(fn,We)=>(100*fn).toFixed(We),b:fn=>Math.round(fn).toString(2),c:fn=>fn+"",d:function(fn){return Math.abs(fn=Math.round(fn))>=1e21?fn.toLocaleString("en").replace(/,/g,""):fn.toString(10)},e:(fn,We)=>fn.toExponential(We),f:(fn,We)=>fn.toFixed(We),g:(fn,We)=>fn.toPrecision(We),o:fn=>Math.round(fn).toString(8),p:(fn,We)=>K(100*fn,We),r:K,s:function(fn,We){var Pe=re(fn,We);if(!Pe)return fn+"";var rt=Pe[0],Et=Pe[1],Lt=Et-(J=3*Math.max(-8,Math.min(8,Math.floor(Et/3))))+1,rn=rt.length;return Lt===rn?rt:Lt>rn?rt+new Array(Lt-rn+1).join("0"):Lt>0?rt.slice(0,Lt)+"."+rt.slice(Lt):"0."+new Array(1-Lt).join("0")+re(fn,Math.max(0,We+Lt-1))[0]},X:fn=>Math.round(fn).toString(16).toUpperCase(),x:fn=>Math.round(fn).toString(16)},pe=function(fn){return fn},Ae=Array.prototype.map,Te=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"],je=function(fn){var We=fn.grouping===void 0||fn.thousands===void 0?pe:function(xe,Xn){return function(br,Cr){for(var dr=br.length,Rr=[],hn=0,Xt=xe[0],nn=0;dr>0&&Xt>0&&(nn+Xt+1>Cr&&(Xt=Math.max(1,Cr-nn)),Rr.push(br.substring(dr-=Xt,dr+Xt)),!((nn+=Xt+1)>Cr));)Xt=xe[hn=(hn+1)%xe.length];return Rr.reverse().join(Xn)}}(Ae.call(fn.grouping,Number),fn.thousands+""),Pe=fn.currency===void 0?"":fn.currency[0]+"",rt=fn.currency===void 0?"":fn.currency[1]+"",Et=fn.decimal===void 0?".":fn.decimal+"",Lt=fn.numerals===void 0?pe:function(xe){return function(Xn){return Xn.replace(/[0-9]/g,function(br){return xe[+br]})}}(Ae.call(fn.numerals,String)),rn=fn.percent===void 0?"%":fn.percent+"",Sn=fn.minus===void 0?"":fn.minus+"",kn=fn.nan===void 0?"NaN":fn.nan+"";function qn(xe){var Xn=(xe=U(xe)).fill,br=xe.align,Cr=xe.sign,dr=xe.symbol,Rr=xe.zero,hn=xe.width,Xt=xe.comma,nn=xe.precision,Gn=xe.trim,Dn=xe.type;Dn==="n"?(Xt=!0,Dn="g"):he[Dn]||(nn===void 0&&(nn=12),Gn=!0,Dn="g"),(Rr||Xn==="0"&&br==="=")&&(Rr=!0,Xn="0",br="=");var mr=dr==="$"?Pe:dr==="#"&&/[boxX]/.test(Dn)?"0"+Dn.toLowerCase():"",xr=dr==="$"?rt:/[%p]/.test(Dn)?rn:"",gr=he[Dn],Qr=/[defgprs%]/.test(Dn);function ni(Mr){var di,Yr,Xr,fi=mr,ai=xr;if(Dn==="c")ai=gr(Mr)+ai,Mr="";else{var Oa=(Mr=+Mr)<0||1/Mr<0;if(Mr=isNaN(Mr)?kn:gr(Math.abs(Mr),nn),Gn&&(Mr=ie(Mr)),Oa&&+Mr==0&&Cr!=="+"&&(Oa=!1),fi=(Oa?Cr==="("?Cr:Sn:Cr==="-"||Cr==="("?"":Cr)+fi,ai=(Dn==="s"?Te[8+J/3]:"")+ai+(Oa&&Cr==="("?")":""),Qr){for(di=-1,Yr=Mr.length;++di<Yr;)if(48>(Xr=Mr.charCodeAt(di))||Xr>57){ai=(Xr===46?Et+Mr.slice(di+1):Mr.slice(di))+ai,Mr=Mr.slice(0,di);break}}}Xt&&!Rr&&(Mr=We(Mr,1/0));var Wi=fi.length+Mr.length+ai.length,Ci=Wi<hn?new Array(hn-Wi+1).join(Xn):"";switch(Xt&&Rr&&(Mr=We(Ci+Mr,Ci.length?hn-ai.length:1/0),Ci=""),br){case"<":Mr=fi+Mr+ai+Ci;break;case"=":Mr=fi+Ci+Mr+ai;break;case"^":Mr=Ci.slice(0,Wi=Ci.length>>1)+fi+Mr+ai+Ci.slice(Wi);break;default:Mr=Ci+fi+Mr+ai}return Lt(Mr)}return nn=nn===void 0?6:/[gprs]/.test(Dn)?Math.max(1,Math.min(21,nn)):Math.max(0,Math.min(20,nn)),ni.toString=function(){return xe+""},ni}return{format:qn,formatPrefix:function(xe,Xn){var br=qn(((xe=U(xe)).type="f",xe)),Cr=3*Math.max(-8,Math.min(8,Math.floor(L(Xn)/3))),dr=Math.pow(10,-Cr),Rr=Te[8+Cr/3];return function(hn){return br(dr*hn)+Rr}}}};(function(fn){R=je(fn),P=R.format,$=R.formatPrefix})({thousands:",",grouping:[3],currency:["$",""]});var ke=o(11),at=o(1),St=o(100),zt=o(246);function $t(fn){const We={};return Pe=>We[Pe]||(We[Pe]=fn(Pe))}function we(fn){const We=$t(fn.format),Pe=fn.formatPrefix;return{format:We,formatPrefix:Pe,formatFloat(rt){const Et=U(rt||",");if(Et.precision==null){switch(Et.precision=12,Et.type){case"%":Et.precision-=2;break;case"e":Et.precision-=1}return function(Lt,rn){return Sn=>{const kn=Lt(Sn),qn=kn.indexOf(rn);if(qn<0)return kn;let xe=function(br,Cr){let dr,Rr=br.lastIndexOf("e");if(Rr>0)return Rr;for(Rr=br.length;--Rr>Cr;)if((dr=br.charCodeAt(Rr))>=48&&dr<=57)return Rr+1}(kn,qn);const Xn=xe<kn.length?kn.slice(xe):"";for(;--xe>qn;)if(kn[xe]!=="0"){++xe;break}return kn.slice(0,xe)+Xn}}(We(Et),We(".1f")(1)[1])}return We(Et)},formatSpan(rt,Et,Lt,rn){rn=U(rn??",f");const Sn=Object(b.c)(rt,Et,Lt),kn=Math.max(Math.abs(rt),Math.abs(Et));let qn;if(rn.precision==null)switch(rn.type){case"s":return isNaN(qn=ee(Sn,kn))||(rn.precision=qn),Pe(rn,kn);case"":case"e":case"g":case"p":case"r":isNaN(qn=F(Sn,kn))||(rn.precision=qn-(rn.type==="e"));break;case"f":case"%":isNaN(qn=ue(Sn))||(rn.precision=qn-2*(rn.type==="%"))}return We(rn)}}}let Tt,Gt;function Pt(){return Tt=we({format:P,formatPrefix:$})}function Ye(fn){return we(je(fn))}function ln(fn){return arguments.length?Tt=Ye(fn):Tt}function Zt(fn,We,Pe){Pe=Pe||{},Object(at.H)(Pe)||Object(at.o)("Invalid time multi-format specifier: ".concat(Pe));const rt=We(ke.i),Et=We(ke.f),Lt=We(ke.d),rn=We(ke.a),Sn=We(ke.k),kn=We(ke.g),qn=We(ke.h),xe=We(ke.l),Xn=fn(Pe[ke.e]||".%L"),br=fn(Pe[ke.i]||":%S"),Cr=fn(Pe[ke.f]||"%I:%M"),dr=fn(Pe[ke.d]||"%I %p"),Rr=fn(Pe[ke.a]||Pe[ke.b]||"%a %d"),hn=fn(Pe[ke.k]||"%b %d"),Xt=fn(Pe[ke.g]||"%B"),nn=fn(Pe[ke.h]||"%B"),Gn=fn(Pe[ke.l]||"%Y");return Dn=>(rt(Dn)<Dn?Xn:Et(Dn)<Dn?br:Lt(Dn)<Dn?Cr:rn(Dn)<Dn?dr:kn(Dn)<Dn?Sn(Dn)<Dn?Rr:hn:xe(Dn)<Dn?qn(Dn)<Dn?Xt:nn:Gn)(Dn)}function Bt(fn){const We=$t(fn.format),Pe=$t(fn.utcFormat);return{timeFormat:rt=>Object(at.J)(rt)?We(rt):Zt(We,ke.p,rt),utcFormat:rt=>Object(at.J)(rt)?Pe(rt):Zt(Pe,ke.v,rt),timeParse:$t(fn.parse),utcParse:$t(fn.utcParse)}}function Mt(){return Gt=Bt({format:St.a,parse:St.b,utcFormat:St.c,utcParse:St.d})}function bn(fn){return Bt(Object(zt.a)(fn))}function Dt(fn){return arguments.length?Gt=bn(fn):Gt}o.d(A,"a",function(){return In}),o.d(A,"b",function(){return xn}),o.d(A,"c",function(){return ln}),o.d(A,"d",function(){return Yn}),o.d(A,"e",function(){return Dt}),Pt(),Mt();const _t=(fn,We)=>Object(at.p)({},fn,We);function xn(fn,We){const Pe=fn?Ye(fn):ln(),rt=We?bn(We):Dt();return _t(Pe,rt)}function In(fn,We){const Pe=arguments.length;return Pe&&Pe!==2&&Object(at.o)("defaultLocale expects either zero or two arguments."),Pe?_t(ln(fn),Dt(We)):_t(ln(),Dt())}function Yn(){return Pt(),Mt(),In()}},function(Oe,A,o){o.d(A,"b",function(){return B}),o.d(A,"c",function(){return re});var b=Math.sqrt(50),H=Math.sqrt(10),U=Math.sqrt(2);function B(J,R,P){var $=(R-J)/Math.max(0,P),L=Math.floor(Math.log($)/Math.LN10),ee=$/Math.pow(10,L);return L>=0?(ee>=b?10:ee>=H?5:ee>=U?2:1)*Math.pow(10,L):-Math.pow(10,-L)/(ee>=b?10:ee>=H?5:ee>=U?2:1)}function re(J,R,P){var $=Math.abs(R-J)/Math.max(0,P),L=Math.pow(10,Math.floor(Math.log($)/Math.LN10)),ee=$/L;return ee>=b?L*=10:ee>=H?L*=5:ee>=U&&(L*=2),R<J?-L:L}A.a=function(J,R,P){var $,L,ee,F,ue=-1;if(P=+P,(J=+J)==(R=+R)&&P>0)return[J];if(($=R<J)&&(L=J,J=R,R=L),(F=B(J,R,P))===0||!isFinite(F))return[];if(F>0){let ie=Math.round(J/F),K=Math.round(R/F);for(ie*F<J&&++ie,K*F>R&&--K,ee=new Array(L=K-ie+1);++ue<L;)ee[ue]=(ie+ue)*F}else{F=-F;let ie=Math.round(J*F),K=Math.round(R*F);for(ie/F<J&&++ie,K/F>R&&--K,ee=new Array(L=K-ie+1);++ue<L;)ee[ue]=(ie+ue)/F}return $&&ee.reverse(),ee}},function(Oe,A,o){/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/var b=this&&this.__awaiter||function(B,re,J,R){return new(J||(J=Promise))(function(P,$){function L(ue){try{F(R.next(ue))}catch(ie){$(ie)}}function ee(ue){try{F(R.throw(ue))}catch(ie){$(ie)}}function F(ue){ue.done?P(ue.value):new J(function(ie){ie(ue.value)}).then(L,ee)}F((R=R.apply(B,re||[])).next())})};Object.defineProperty(A,"__esModule",{value:!0});const H=o(198),U=o(197);A.getDrawArea=function(B){if(B instanceof HTMLElement)return B;if(H.isSurface(B))return B.drawArea;if(H.isSurfaceInfo(B))return U.visor().surface({name:B.name,tab:B.tab,styles:B.styles}).drawArea;throw new Error("Not a drawable")},A.shallowEquals=function(B,re){const J=Object.getOwnPropertyNames(B),R=Object.getOwnPropertyNames(re);if(J.length!==R.length)return!1;for(let P=0;P<J.length;P++){const $=J[P];if(B[$]!==re[$])return!1}return!0},A.nextFrame=function(){return b(this,void 0,void 0,function*(){yield new Promise(B=>requestAnimationFrame(B))})}},function(Oe,A,o){class b{constructor(Gt,Pt){if(Pt=U(Pt),Gt instanceof b)return Gt.loose===!!Pt.loose&&Gt.includePrerelease===!!Pt.includePrerelease?Gt:new b(Gt.raw,Pt);if(Gt instanceof B)return this.raw=Gt.value,this.set=[[Gt]],this.format(),this;if(this.options=Pt,this.loose=!!Pt.loose,this.includePrerelease=!!Pt.includePrerelease,this.raw=Gt,this.set=Gt.split(/\s*\|\|\s*/).map(Ye=>this.parseRange(Ye.trim())).filter(Ye=>Ye.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${Gt}`);if(this.set.length>1){const Ye=this.set[0];if(this.set=this.set.filter(ln=>!F(ln[0])),this.set.length===0)this.set=[Ye];else if(this.set.length>1){for(const ln of this.set)if(ln.length===1&&ue(ln[0])){this.set=[ln];break}}}this.format()}format(){return this.range=this.set.map(Gt=>Gt.join(" ").trim()).join("||").trim(),this.range}toString(){return this.range}parseRange(Gt){Gt=Gt.trim();const Pt=`parseRange:${Object.keys(this.options).join(",")}:${Gt}`,Ye=H.get(Pt);if(Ye)return Ye;const ln=this.options.loose,Zt=ln?R[P.HYPHENRANGELOOSE]:R[P.HYPHENRANGE];Gt=Gt.replace(Zt,$t(this.options.includePrerelease)),re("hyphen replace",Gt),Gt=Gt.replace(R[P.COMPARATORTRIM],$),re("comparator trim",Gt,R[P.COMPARATORTRIM]),Gt=(Gt=(Gt=Gt.replace(R[P.TILDETRIM],L)).replace(R[P.CARETTRIM],ee)).split(/\s+/).join(" ");const Bt=ln?R[P.COMPARATORLOOSE]:R[P.COMPARATOR],Mt=Gt.split(" ").map(_t=>K(_t,this.options)).join(" ").split(/\s+/).map(_t=>zt(_t,this.options)).filter(this.options.loose?_t=>!!_t.match(Bt):()=>!0).map(_t=>new B(_t,this.options)),bn=(Mt.length,new Map);for(const _t of Mt){if(F(_t))return[_t];bn.set(_t.value,_t)}bn.size>1&&bn.has("")&&bn.delete("");const Dt=[...bn.values()];return H.set(Pt,Dt),Dt}intersects(Gt,Pt){if(!(Gt instanceof b))throw new TypeError("a Range is required");return this.set.some(Ye=>ie(Ye,Pt)&&Gt.set.some(ln=>ie(ln,Pt)&&Ye.every(Zt=>ln.every(Bt=>Zt.intersects(Bt,Pt)))))}test(Gt){if(!Gt)return!1;if(typeof Gt=="string")try{Gt=new J(Gt,this.options)}catch{return!1}for(let Pt=0;Pt<this.set.length;Pt++)if(we(this.set[Pt],Gt,this.options))return!0;return!1}}Oe.exports=b;const H=new(o(335))({max:1e3}),U=o(115),B=o(113),re=o(116),J=o(32),{re:R,t:P,comparatorTrimReplace:$,tildeTrimReplace:L,caretTrimReplace:ee}=o(90),F=Tt=>Tt.value==="<0.0.0-0",ue=Tt=>Tt.value==="",ie=(Tt,Gt)=>{let Pt=!0;const Ye=Tt.slice();let ln=Ye.pop();for(;Pt&&Ye.length;)Pt=Ye.every(Zt=>ln.intersects(Zt,Gt)),ln=Ye.pop();return Pt},K=(Tt,Gt)=>(re("comp",Tt,Gt),Tt=Te(Tt,Gt),re("caret",Tt),Tt=pe(Tt,Gt),re("tildes",Tt),Tt=ke(Tt,Gt),re("xrange",Tt),Tt=St(Tt,Gt),re("stars",Tt),Tt),he=Tt=>!Tt||Tt.toLowerCase()==="x"||Tt==="*",pe=(Tt,Gt)=>Tt.trim().split(/\s+/).map(Pt=>Ae(Pt,Gt)).join(" "),Ae=(Tt,Gt)=>{const Pt=Gt.loose?R[P.TILDELOOSE]:R[P.TILDE];return Tt.replace(Pt,(Ye,ln,Zt,Bt,Mt)=>{let bn;return re("tilde",Tt,Ye,ln,Zt,Bt,Mt),he(ln)?bn="":he(Zt)?bn=`>=${ln}.0.0 <${+ln+1}.0.0-0`:he(Bt)?bn=`>=${ln}.${Zt}.0 <${ln}.${+Zt+1}.0-0`:Mt?(re("replaceTilde pr",Mt),bn=`>=${ln}.${Zt}.${Bt}-${Mt} <${ln}.${+Zt+1}.0-0`):bn=`>=${ln}.${Zt}.${Bt} <${ln}.${+Zt+1}.0-0`,re("tilde return",bn),bn})},Te=(Tt,Gt)=>Tt.trim().split(/\s+/).map(Pt=>je(Pt,Gt)).join(" "),je=(Tt,Gt)=>{re("caret",Tt,Gt);const Pt=Gt.loose?R[P.CARETLOOSE]:R[P.CARET],Ye=Gt.includePrerelease?"-0":"";return Tt.replace(Pt,(ln,Zt,Bt,Mt,bn)=>{let Dt;return re("caret",Tt,ln,Zt,Bt,Mt,bn),he(Zt)?Dt="":he(Bt)?Dt=`>=${Zt}.0.0${Ye} <${+Zt+1}.0.0-0`:he(Mt)?Dt=Zt==="0"?`>=${Zt}.${Bt}.0${Ye} <${Zt}.${+Bt+1}.0-0`:`>=${Zt}.${Bt}.0${Ye} <${+Zt+1}.0.0-0`:bn?(re("replaceCaret pr",bn),Dt=Zt==="0"?Bt==="0"?`>=${Zt}.${Bt}.${Mt}-${bn} <${Zt}.${Bt}.${+Mt+1}-0`:`>=${Zt}.${Bt}.${Mt}-${bn} <${Zt}.${+Bt+1}.0-0`:`>=${Zt}.${Bt}.${Mt}-${bn} <${+Zt+1}.0.0-0`):(re("no pr"),Dt=Zt==="0"?Bt==="0"?`>=${Zt}.${Bt}.${Mt}${Ye} <${Zt}.${Bt}.${+Mt+1}-0`:`>=${Zt}.${Bt}.${Mt}${Ye} <${Zt}.${+Bt+1}.0-0`:`>=${Zt}.${Bt}.${Mt} <${+Zt+1}.0.0-0`),re("caret return",Dt),Dt})},ke=(Tt,Gt)=>(re("replaceXRanges",Tt,Gt),Tt.split(/\s+/).map(Pt=>at(Pt,Gt)).join(" ")),at=(Tt,Gt)=>{Tt=Tt.trim();const Pt=Gt.loose?R[P.XRANGELOOSE]:R[P.XRANGE];return Tt.replace(Pt,(Ye,ln,Zt,Bt,Mt,bn)=>{re("xRange",Tt,Ye,ln,Zt,Bt,Mt,bn);const Dt=he(Zt),_t=Dt||he(Bt),xn=_t||he(Mt),In=xn;return ln==="="&&In&&(ln=""),bn=Gt.includePrerelease?"-0":"",Dt?Ye=ln===">"||ln==="<"?"<0.0.0-0":"*":ln&&In?(_t&&(Bt=0),Mt=0,ln===">"?(ln=">=",_t?(Zt=+Zt+1,Bt=0,Mt=0):(Bt=+Bt+1,Mt=0)):ln==="<="&&(ln="<",_t?Zt=+Zt+1:Bt=+Bt+1),ln==="<"&&(bn="-0"),Ye=`${ln+Zt}.${Bt}.${Mt}${bn}`):_t?Ye=`>=${Zt}.0.0${bn} <${+Zt+1}.0.0-0`:xn&&(Ye=`>=${Zt}.${Bt}.0${bn} <${Zt}.${+Bt+1}.0-0`),re("xRange return",Ye),Ye})},St=(Tt,Gt)=>(re("replaceStars",Tt,Gt),Tt.trim().replace(R[P.STAR],"")),zt=(Tt,Gt)=>(re("replaceGTE0",Tt,Gt),Tt.trim().replace(R[Gt.includePrerelease?P.GTE0PRE:P.GTE0],"")),$t=Tt=>(Gt,Pt,Ye,ln,Zt,Bt,Mt,bn,Dt,_t,xn,In,Yn)=>`${Pt=he(Ye)?"":he(ln)?`>=${Ye}.0.0${Tt?"-0":""}`:he(Zt)?`>=${Ye}.${ln}.0${Tt?"-0":""}`:Bt?`>=${Pt}`:`>=${Pt}${Tt?"-0":""}`} ${bn=he(Dt)?"":he(_t)?`<${+Dt+1}.0.0-0`:he(xn)?`<${Dt}.${+_t+1}.0-0`:In?`<=${Dt}.${_t}.${xn}-${In}`:Tt?`<${Dt}.${_t}.${+xn+1}-0`:`<=${bn}`}`.trim(),we=(Tt,Gt,Pt)=>{for(let Ye=0;Ye<Tt.length;Ye++)if(!Tt[Ye].test(Gt))return!1;if(Gt.prerelease.length&&!Pt.includePrerelease){for(let Ye=0;Ye<Tt.length;Ye++)if(re(Tt[Ye].semver),Tt[Ye].semver!==B.ANY&&Tt[Ye].semver.prerelease.length>0){const ln=Tt[Ye].semver;if(ln.major===Gt.major&&ln.minor===Gt.minor&&ln.patch===Gt.patch)return!0}return!1}return!0}},function(Oe,A,o){const b=o(32);Oe.exports=(H,U,B)=>new b(H,B).compare(new b(U,B))},function(Oe,A,o){var b=o(15);Oe.exports=function(H,U){return!!H&&b(function(){U?H.call(null,function(){},1):H.call(null)})}},function(Oe,A,o){o.r(A);var b=function(je,ke){if((at=(je=ke?je.toExponential(ke-1):je.toExponential()).indexOf("e"))<0)return null;var at,St=je.slice(0,at);return[St.length>1?St[0]+St.slice(2):St,+je.slice(at+1)]},H=function(je){return(je=b(Math.abs(je)))?je[1]:NaN},U=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function B(je){return new re(je)}function re(je){if(!(ke=U.exec(je)))throw new Error("invalid format: "+je);var ke;this.fill=ke[1]||" ",this.align=ke[2]||">",this.sign=ke[3]||"-",this.symbol=ke[4]||"",this.zero=!!ke[5],this.width=ke[6]&&+ke[6],this.comma=!!ke[7],this.precision=ke[8]&&+ke[8].slice(1),this.trim=!!ke[9],this.type=ke[10]||""}B.prototype=re.prototype,re.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width==null?"":Math.max(1,0|this.width))+(this.comma?",":"")+(this.precision==null?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var J,R,P,$,L=function(je){e:for(var ke,at=je.length,St=1,zt=-1;St<at;++St)switch(je[St]){case".":zt=ke=St;break;case"0":zt===0&&(zt=St),ke=St;break;default:if(zt>0){if(!+je[St])break e;zt=0}}return zt>0?je.slice(0,zt)+je.slice(ke+1):je},ee=function(je,ke){var at=b(je,ke);if(!at)return je+"";var St=at[0],zt=at[1];return zt<0?"0."+new Array(-zt).join("0")+St:St.length>zt+1?St.slice(0,zt+1)+"."+St.slice(zt+1):St+new Array(zt-St.length+2).join("0")},F={"%":function(je,ke){return(100*je).toFixed(ke)},b:function(je){return Math.round(je).toString(2)},c:function(je){return je+""},d:function(je){return Math.round(je).toString(10)},e:function(je,ke){return je.toExponential(ke)},f:function(je,ke){return je.toFixed(ke)},g:function(je,ke){return je.toPrecision(ke)},o:function(je){return Math.round(je).toString(8)},p:function(je,ke){return ee(100*je,ke)},r:ee,s:function(je,ke){var at=b(je,ke);if(!at)return je+"";var St=at[0],zt=at[1],$t=zt-(J=3*Math.max(-8,Math.min(8,Math.floor(zt/3))))+1,we=St.length;return $t===we?St:$t>we?St+new Array($t-we+1).join("0"):$t>0?St.slice(0,$t)+"."+St.slice($t):"0."+new Array(1-$t).join("0")+b(je,Math.max(0,ke+$t-1))[0]},X:function(je){return Math.round(je).toString(16).toUpperCase()},x:function(je){return Math.round(je).toString(16)}},ue=function(je){return je},ie=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"],K=function(je){var ke=je.grouping&&je.thousands?function(Tt,Gt){return function(Pt,Ye){for(var ln=Pt.length,Zt=[],Bt=0,Mt=Tt[0],bn=0;ln>0&&Mt>0&&(bn+Mt+1>Ye&&(Mt=Math.max(1,Ye-bn)),Zt.push(Pt.substring(ln-=Mt,ln+Mt)),!((bn+=Mt+1)>Ye));)Mt=Tt[Bt=(Bt+1)%Tt.length];return Zt.reverse().join(Gt)}}(je.grouping,je.thousands):ue,at=je.currency,St=je.decimal,zt=je.numerals?function(Tt){return function(Gt){return Gt.replace(/[0-9]/g,function(Pt){return Tt[+Pt]})}}(je.numerals):ue,$t=je.percent||"%";function we(Tt){var Gt=(Tt=B(Tt)).fill,Pt=Tt.align,Ye=Tt.sign,ln=Tt.symbol,Zt=Tt.zero,Bt=Tt.width,Mt=Tt.comma,bn=Tt.precision,Dt=Tt.trim,_t=Tt.type;_t==="n"?(Mt=!0,_t="g"):F[_t]||(bn==null&&(bn=12),Dt=!0,_t="g"),(Zt||Gt==="0"&&Pt==="=")&&(Zt=!0,Gt="0",Pt="=");var xn=ln==="$"?at[0]:ln==="#"&&/[boxX]/.test(_t)?"0"+_t.toLowerCase():"",In=ln==="$"?at[1]:/[%p]/.test(_t)?$t:"",Yn=F[_t],fn=/[defgprs%]/.test(_t);function We(Pe){var rt,Et,Lt,rn=xn,Sn=In;if(_t==="c")Sn=Yn(Pe)+Sn,Pe="";else{var kn=(Pe=+Pe)<0;if(Pe=Yn(Math.abs(Pe),bn),Dt&&(Pe=L(Pe)),kn&&+Pe==0&&(kn=!1),rn=(kn?Ye==="("?Ye:"-":Ye==="-"||Ye==="("?"":Ye)+rn,Sn=(_t==="s"?ie[8+J/3]:"")+Sn+(kn&&Ye==="("?")":""),fn){for(rt=-1,Et=Pe.length;++rt<Et;)if(48>(Lt=Pe.charCodeAt(rt))||Lt>57){Sn=(Lt===46?St+Pe.slice(rt+1):Pe.slice(rt))+Sn,Pe=Pe.slice(0,rt);break}}}Mt&&!Zt&&(Pe=ke(Pe,1/0));var qn=rn.length+Pe.length+Sn.length,xe=qn<Bt?new Array(Bt-qn+1).join(Gt):"";switch(Mt&&Zt&&(Pe=ke(xe+Pe,xe.length?Bt-Sn.length:1/0),xe=""),Pt){case"<":Pe=rn+Pe+Sn+xe;break;case"=":Pe=rn+xe+Pe+Sn;break;case"^":Pe=xe.slice(0,qn=xe.length>>1)+rn+Pe+Sn+xe.slice(qn);break;default:Pe=xe+rn+Pe+Sn}return zt(Pe)}return bn=bn==null?6:/[gprs]/.test(_t)?Math.max(1,Math.min(21,bn)):Math.max(0,Math.min(20,bn)),We.toString=function(){return Tt+""},We}return{format:we,formatPrefix:function(Tt,Gt){var Pt=we(((Tt=B(Tt)).type="f",Tt)),Ye=3*Math.max(-8,Math.min(8,Math.floor(H(Gt)/3))),ln=Math.pow(10,-Ye),Zt=ie[8+Ye/3];return function(Bt){return Pt(ln*Bt)+Zt}}}};function he(je){return R=K(je),P=R.format,$=R.formatPrefix,R}he({decimal:".",thousands:",",grouping:[3],currency:["$",""]});var pe=function(je){return Math.max(0,-H(Math.abs(je)))},Ae=function(je,ke){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(H(ke)/3)))-H(Math.abs(je)))},Te=function(je,ke){return je=Math.abs(je),ke=Math.abs(ke)-je,Math.max(0,H(ke)-H(je))+1};o.d(A,"formatDefaultLocale",function(){return he}),o.d(A,"format",function(){return P}),o.d(A,"formatPrefix",function(){return $}),o.d(A,"formatLocale",function(){return K}),o.d(A,"formatSpecifier",function(){return B}),o.d(A,"precisionFixed",function(){return pe}),o.d(A,"precisionPrefix",function(){return Ae}),o.d(A,"precisionRound",function(){return Te})},function(Oe,A,o){var b=o(56),H=o(107),U=o(34),B=o(22),re=o(224);Oe.exports=function(J,R){var P=J==1,$=J==2,L=J==3,ee=J==4,F=J==6,ue=J==5||F,ie=R||re;return function(K,he,pe){for(var Ae,Te,je=U(K),ke=H(je),at=b(he,pe,3),St=B(ke.length),zt=0,$t=P?ie(K,St):$?ie(K,0):void 0;St>zt;zt++)if((ue||zt in ke)&&(Te=at(Ae=ke[zt],zt,je),J)){if(P)$t[zt]=Te;else if(Te)switch(J){case 3:return!0;case 5:return Ae;case 6:return zt;case 2:$t.push(Ae)}else if(ee)return!1}return F?-1:L||ee?ee:$t}}},function(Oe,A,o){var b=o(8),H=o(24),U=o(15);Oe.exports=function(B,re){var J=(H.Object||{})[B]||Object[B],R={};R[B]=re(J),b(b.S+b.F*U(function(){J(1)}),"Object",R)}},function(Oe,A,o){var b=o(106),H=o(85),U=o(41),B=o(66),re=o(43),J=o(240),R=Object.getOwnPropertyDescriptor;A.f=o(27)?R:function(P,$){if(P=U(P),$=B($,!0),J)try{return R(P,$)}catch{}if(re(P,$))return H(!b.f.call(P,$),P[$])}},function(Oe,A){var o=Math.ceil,b=Math.floor;Oe.exports=function(H){return isNaN(H=+H)?0:(H>0?b:o)(H)}},function(Oe,A){Oe.exports=function(o){if(typeof o!="function")throw TypeError(o+" is not a function!");return o}},function(Oe,A,o){var b=o(55);Oe.exports=function(H,U,B){if(b(H),U===void 0)return H;switch(B){case 1:return function(re){return H.call(U,re)};case 2:return function(re,J){return H.call(U,re,J)};case 3:return function(re,J,R){return H.call(U,re,J,R)}}return function(){return H.apply(U,arguments)}}},function(Oe,A,o){var b=o(7).default,H=o(258);Oe.exports=function(U,B){if(B&&(b(B)==="object"||typeof B=="function"))return B;if(B!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return H(U)},Oe.exports.__esModule=!0,Oe.exports.default=Oe.exports},function(Oe,A,o){var b=o(259);Oe.exports=function(H,U){if(typeof U!="function"&&U!==null)throw new TypeError("Super expression must either be null or a function");H.prototype=Object.create(U&&U.prototype,{constructor:{value:H,writable:!0,configurable:!0}}),Object.defineProperty(H,"prototype",{writable:!1}),U&&b(H,U)},Oe.exports.__esModule=!0,Oe.exports.default=Oe.exports},function(Oe,A){var o;o=function(){return this}();try{o=o||Function("return this")()||(0,eval)("this")}catch{typeof window=="object"&&(o=window)}Oe.exports=o},function(Oe,A,o){if(o(27)){var b=o(83),H=o(16),U=o(15),B=o(8),re=o(118),J=o(151),R=o(56),P=o(94),$=o(85),L=o(42),ee=o(93),F=o(54),ue=o(22),ie=o(213),K=o(81),he=o(66),pe=o(43),Ae=o(105),Te=o(13),je=o(34),ke=o(159),at=o(80),St=o(78),zt=o(79).f,$t=o(157),we=o(84),Tt=o(19),Gt=o(51),Pt=o(128),Ye=o(104),ln=o(155),Zt=o(96),Bt=o(125),Mt=o(95),bn=o(156),Dt=o(222),_t=o(26),xn=o(53),In=_t.f,Yn=xn.f,fn=H.RangeError,We=H.TypeError,Pe=H.Uint8Array,rt=Array.prototype,Et=J.ArrayBuffer,Lt=J.DataView,rn=Gt(0),Sn=Gt(2),kn=Gt(3),qn=Gt(4),xe=Gt(5),Xn=Gt(6),br=Pt(!0),Cr=Pt(!1),dr=ln.values,Rr=ln.keys,hn=ln.entries,Xt=rt.lastIndexOf,nn=rt.reduce,Gn=rt.reduceRight,Dn=rt.join,mr=rt.sort,xr=rt.slice,gr=rt.toString,Qr=rt.toLocaleString,ni=Tt("iterator"),Mr=Tt("toStringTag"),di=we("typed_constructor"),Yr=we("def_constructor"),Xr=re.CONSTR,fi=re.TYPED,ai=re.VIEW,Oa=Gt(1,function(qt,Ve){return jt(Ye(qt,qt[Yr]),Ve)}),Wi=U(function(){return new Pe(new Uint16Array([1]).buffer)[0]===1}),Ci=!!Pe&&!!Pe.prototype.set&&U(function(){new Pe(1).set({})}),yt=function(qt,Ve){var jn=F(qt);if(jn<0||jn%Ve)throw fn("Wrong offset!");return jn},Lr=function(qt){if(Te(qt)&&fi in qt)return qt;throw We(qt+" is not a typed array!")},jt=function(qt,Ve){if(!(Te(qt)&&di in qt))throw We("It is not a typed array constructor!");return new qt(Ve)},ge=function(qt,Ve){return fe(Ye(qt,qt[Yr]),Ve)},fe=function(qt,Ve){for(var jn=0,$n=Ve.length,Zn=jt(qt,$n);$n>jn;)Zn[jn]=Ve[jn++];return Zn},ye=function(qt,Ve,jn){In(qt,Ve,{get:function(){return this._d[jn]}})},Se=function(qt){var Ve,jn,$n,Zn,ir,zr,vr=je(qt),pi=arguments.length,la=pi>1?arguments[1]:void 0,ui=la!==void 0,Qi=$t(vr);if(Qi!=null&&!ke(Qi)){for(zr=Qi.call(vr),$n=[],Ve=0;!(ir=zr.next()).done;Ve++)$n.push(ir.value);vr=$n}for(ui&&pi>2&&(la=R(la,arguments[2],2)),Ve=0,jn=ue(vr.length),Zn=jt(this,jn);jn>Ve;Ve++)Zn[Ve]=ui?la(vr[Ve],Ve):vr[Ve];return Zn},Ze=function(){for(var qt=0,Ve=arguments.length,jn=jt(this,Ve);Ve>qt;)jn[qt]=arguments[qt++];return jn},mt=!!Pe&&U(function(){Qr.call(new Pe(1))}),Rt=function(){return Qr.apply(mt?xr.call(Lr(this)):Lr(this),arguments)},cn={copyWithin:function(qt,Ve){return Dt.call(Lr(this),qt,Ve,arguments.length>2?arguments[2]:void 0)},every:function(qt){return qn(Lr(this),qt,arguments.length>1?arguments[1]:void 0)},fill:function(qt){return bn.apply(Lr(this),arguments)},filter:function(qt){return ge(this,Sn(Lr(this),qt,arguments.length>1?arguments[1]:void 0))},find:function(qt){return xe(Lr(this),qt,arguments.length>1?arguments[1]:void 0)},findIndex:function(qt){return Xn(Lr(this),qt,arguments.length>1?arguments[1]:void 0)},forEach:function(qt){rn(Lr(this),qt,arguments.length>1?arguments[1]:void 0)},indexOf:function(qt){return Cr(Lr(this),qt,arguments.length>1?arguments[1]:void 0)},includes:function(qt){return br(Lr(this),qt,arguments.length>1?arguments[1]:void 0)},join:function(qt){return Dn.apply(Lr(this),arguments)},lastIndexOf:function(qt){return Xt.apply(Lr(this),arguments)},map:function(qt){return Oa(Lr(this),qt,arguments.length>1?arguments[1]:void 0)},reduce:function(qt){return nn.apply(Lr(this),arguments)},reduceRight:function(qt){return Gn.apply(Lr(this),arguments)},reverse:function(){for(var qt,Ve=Lr(this).length,jn=Math.floor(Ve/2),$n=0;$n<jn;)qt=this[$n],this[$n++]=this[--Ve],this[Ve]=qt;return this},some:function(qt){return kn(Lr(this),qt,arguments.length>1?arguments[1]:void 0)},sort:function(qt){return mr.call(Lr(this),qt)},subarray:function(qt,Ve){var jn=Lr(this),$n=jn.length,Zn=K(qt,$n);return new(Ye(jn,jn[Yr]))(jn.buffer,jn.byteOffset+Zn*jn.BYTES_PER_ELEMENT,ue((Ve===void 0?$n:K(Ve,$n))-Zn))}},Jn=function(qt,Ve){return ge(this,xr.call(Lr(this),qt,Ve))},An=function(qt){Lr(this);var Ve=yt(arguments[1],1),jn=this.length,$n=je(qt),Zn=ue($n.length),ir=0;if(Zn+Ve>jn)throw fn("Wrong length!");for(;ir<Zn;)this[Ve+ir]=$n[ir++]},Ln={entries:function(){return hn.call(Lr(this))},keys:function(){return Rr.call(Lr(this))},values:function(){return dr.call(Lr(this))}},Hn=function(qt,Ve){return Te(qt)&&qt[fi]&&typeof Ve!="symbol"&&Ve in qt&&String(+Ve)==String(Ve)},It=function(qt,Ve){return Hn(qt,Ve=he(Ve,!0))?$(2,qt[Ve]):Yn(qt,Ve)},Ot=function(qt,Ve,jn){return!(Hn(qt,Ve=he(Ve,!0))&&Te(jn)&&pe(jn,"value"))||pe(jn,"get")||pe(jn,"set")||jn.configurable||pe(jn,"writable")&&!jn.writable||pe(jn,"enumerable")&&!jn.enumerable?In(qt,Ve,jn):(qt[Ve]=jn.value,qt)};Xr||(xn.f=It,_t.f=Ot),B(B.S+B.F*!Xr,"Object",{getOwnPropertyDescriptor:It,defineProperty:Ot}),U(function(){gr.call({})})&&(gr=Qr=function(){return Dn.call(this)});var pn=ee({},cn);ee(pn,Ln),L(pn,ni,Ln.values),ee(pn,{slice:Jn,set:An,constructor:function(){},toString:gr,toLocaleString:Rt}),ye(pn,"buffer","b"),ye(pn,"byteOffset","o"),ye(pn,"byteLength","l"),ye(pn,"length","e"),In(pn,Mr,{get:function(){return this[fi]}}),Oe.exports=function(qt,Ve,jn,$n){var Zn=qt+(($n=!!$n)?"Clamped":"")+"Array",ir="get"+qt,zr="set"+qt,vr=H[Zn],pi=vr||{},la=vr&&St(vr),ui=!vr||!re.ABV,Qi={},Di=vr&&vr.prototype,qr=function(Vi,Fr){In(Vi,Fr,{get:function(){return function(aa,ma){var Zi=aa._d;return Zi.v[ir](ma*Ve+Zi.o,Wi)}(this,Fr)},set:function(aa){return function(ma,Zi,ga){var No=ma._d;$n&&(ga=(ga=Math.round(ga))<0?0:ga>255?255:255&ga),No.v[zr](Zi*Ve+No.o,ga,Wi)}(this,Fr,aa)},enumerable:!0})};ui?(vr=jn(function(Vi,Fr,aa,ma){P(Vi,vr,Zn,"_d");var Zi,ga,No,vs,Eh=0,qi=0;if(Te(Fr)){if(!(Fr instanceof Et||(vs=Ae(Fr))=="ArrayBuffer"||vs=="SharedArrayBuffer"))return fi in Fr?fe(vr,Fr):Se.call(vr,Fr);Zi=Fr,qi=yt(aa,Ve);var ec=Fr.byteLength;if(ma===void 0){if(ec%Ve||(ga=ec-qi)<0)throw fn("Wrong length!")}else if((ga=ue(ma)*Ve)+qi>ec)throw fn("Wrong length!");No=ga/Ve}else No=ie(Fr),Zi=new Et(ga=No*Ve);for(L(Vi,"_d",{b:Zi,o:qi,l:ga,e:No,v:new Lt(Zi)});Eh<No;)qr(Vi,Eh++)}),Di=vr.prototype=at(pn),L(Di,"constructor",vr)):U(function(){vr(1)})&&U(function(){new vr(-1)})&&Bt(function(Vi){new vr,new vr(null),new vr(1.5),new vr(Vi)},!0)||(vr=jn(function(Vi,Fr,aa,ma){var Zi;return P(Vi,vr,Zn),Te(Fr)?Fr instanceof Et||(Zi=Ae(Fr))=="ArrayBuffer"||Zi=="SharedArrayBuffer"?ma!==void 0?new pi(Fr,yt(aa,Ve),ma):aa!==void 0?new pi(Fr,yt(aa,Ve)):new pi(Fr):fi in Fr?fe(vr,Fr):Se.call(vr,Fr):new pi(ie(Fr))}),rn(la!==Function.prototype?zt(pi).concat(zt(la)):zt(pi),function(Vi){Vi in vr||L(vr,Vi,pi[Vi])}),vr.prototype=Di,b||(Di.constructor=vr));var jr=Di[ni],Bn=!!jr&&(jr.name=="values"||jr.name==null),ri=Ln.values;L(vr,di,!0),L(Di,fi,Zn),L(Di,ai,!0),L(Di,Yr,vr),($n?new vr(1)[Mr]==Zn:Mr in Di)||In(Di,Mr,{get:function(){return Zn}}),Qi[Zn]=vr,B(B.G+B.W+B.F*(vr!=pi),Qi),B(B.S,Zn,{BYTES_PER_ELEMENT:Ve}),B(B.S+B.F*U(function(){pi.of.call(vr,1)}),Zn,{from:Se,of:Ze}),"BYTES_PER_ELEMENT"in Di||L(Di,"BYTES_PER_ELEMENT",Ve),B(B.P,Zn,cn),Mt(Zn),B(B.P+B.F*Ci,Zn,{set:An}),B(B.P+B.F*!Bn,Zn,Ln),b||Di.toString==gr||(Di.toString=gr),B(B.P+B.F*U(function(){new vr(1).slice()}),Zn,{slice:Jn}),B(B.P+B.F*(U(function(){return[1,2].toLocaleString()!=new vr([1,2]).toLocaleString()})||!U(function(){Di.toLocaleString.call([1,2])})),Zn,{toLocaleString:Rt}),Zt[Zn]=Bn?jr:ri,b||Bn||L(Di,ni,ri)}}else Oe.exports=function(){}},function(Oe,A){Oe.exports=function(o){if(o==null)throw TypeError("Can't call method on  "+o);return o}},function(Oe,A){var o={}.toString;Oe.exports=function(b){return o.call(b).slice(8,-1)}},function(Oe,A,o){(function(b){o.d(A,"a",function(){return zt}),o.d(A,"b",function(){return $t}),o.d(A,"c",function(){return pe}),o.d(A,"d",function(){return Ae}),o.d(A,"e",function(){return Gt}),o.d(A,"f",function(){return Tt}),o.d(A,"g",function(){return we}),o.d(A,"h",function(){return ie});var H=o(1),U=o(582),B=o(176),re=o(44);const J=/^(data:|([A-Za-z]+:)?\/\/)/,R=/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp|file|data):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i,P=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g,$="file://";async function L(){Object(H.o)("No file system access.")}async function ee(){Object(H.o)("No HTTP fetch method available.")}const F=Pt=>Pt!=null&&Pt==Pt,ue=Pt=>!(Number.isNaN(+Pt)||Pt instanceof Date),ie={boolean:H.Ca,integer:H.Ea,number:H.Ea,date:H.Da,string:H.Ga,unknown:H.y},K=[Pt=>Pt==="true"||Pt==="false"||Pt===!0||Pt===!1,Pt=>ue(Pt)&&Number.isInteger(+Pt),ue,Pt=>!Number.isNaN(Date.parse(Pt))],he=["boolean","integer","number","date"];function pe(Pt,Ye){if(!Pt||!Pt.length)return"unknown";const ln=Pt.length,Zt=K.length,Bt=K.map((Mt,bn)=>bn+1);for(let Mt,bn,Dt=0,_t=0;Dt<ln;++Dt)for(bn=Ye?Pt[Dt][Ye]:Pt[Dt],Mt=0;Mt<Zt;++Mt)if(Bt[Mt]&&F(bn)&&!K[Mt](bn)&&(Bt[Mt]=0,++_t===K.length))return"string";return he[Bt.reduce((Mt,bn)=>Mt===0?bn:Mt,0)-1]}function Ae(Pt,Ye){return Ye.reduce((ln,Zt)=>(ln[Zt]=pe(Pt,Zt),ln),{})}function Te(Pt){const Ye=function(ln,Zt){const Bt={delimiter:Pt};return je(ln,Zt?Object(H.p)(Zt,Bt):Bt)};return Ye.responseType="text",Ye}function je(Pt,Ye){return Ye.header&&(Pt=Ye.header.map(H.Ba).join(Ye.delimiter)+`
`+Pt),Object(U.a)(Ye.delimiter).parse(Pt+"")}function ke(Pt,Ye){const ln=Ye&&Ye.property?Object(H.u)(Ye.property):H.y;return Object(H.H)(Pt)&&!function(Zt){return!(typeof b!="function"||!Object(H.E)(b.isBuffer))&&b.isBuffer(Zt)}(Pt)?function(Zt,Bt){return!Object(H.B)(Zt)&&Object(H.F)(Zt)&&(Zt=[...Zt]),Bt&&Bt.copy?JSON.parse(JSON.stringify(Zt)):Zt}(ln(Pt),Ye):ln(JSON.parse(Pt))}je.responseType="text",ke.responseType="json";const at={interior:(Pt,Ye)=>Pt!==Ye,exterior:(Pt,Ye)=>Pt===Ye};function St(Pt,Ye){let ln,Zt,Bt,Mt;return Pt=ke(Pt,Ye),Ye&&Ye.feature?(ln=B.a,Bt=Ye.feature):Ye&&Ye.mesh?(ln=B.b,Bt=Ye.mesh,Mt=at[Ye.filter]):Object(H.o)("Missing TopoJSON feature or mesh parameter."),(Zt=(Zt=Pt.objects[Bt])?ln(Pt,Zt,Mt):Object(H.o)("Invalid TopoJSON object: "+Bt))&&Zt.features||[Zt]}St.responseType="json";const zt={dsv:je,csv:Te(","),tsv:Te("	"),json:ke,topojson:St};function $t(Pt,Ye){return arguments.length>1?(zt[Pt]=Ye,this):Object(H.w)(zt,Pt)?zt[Pt]:null}function we(Pt){const Ye=$t(Pt);return Ye&&Ye.responseType||"text"}function Tt(Pt,Ye,ln,Zt){const Bt=$t((Ye=Ye||{}).type||"json");return Bt||Object(H.o)("Unknown data format type: "+Ye.type),Pt=Bt(Pt,Ye),Ye.parse&&function(Mt,bn,Dt,_t){if(!Mt.length)return;const xn=Object(re.e)();Dt=Dt||xn.timeParse,_t=_t||xn.utcParse;let In,Yn,fn,We,Pe,rt,Et=Mt.columns||Object.keys(Mt[0]);bn==="auto"&&(bn=Ae(Mt,Et));const Lt=(Et=Object.keys(bn)).map(rn=>{const Sn=bn[rn];let kn,qn;if(Sn&&(Sn.startsWith("date:")||Sn.startsWith("utc:")))return kn=Sn.split(/:(.+)?/,2),((qn=kn[1])[0]==="'"&&qn[qn.length-1]==="'"||qn[0]==='"'&&qn[qn.length-1]==='"')&&(qn=qn.slice(1,-1)),(kn[0]==="utc"?_t:Dt)(qn);if(!ie[Sn])throw Error("Illegal format pattern: "+rn+":"+Sn);return ie[Sn]});for(fn=0,Pe=Mt.length,rt=Et.length;fn<Pe;++fn)for(In=Mt[fn],We=0;We<rt;++We)Yn=Et[We],In[Yn]=Lt[We](In[Yn])}(Pt,Ye.parse,ln,Zt),Object(H.w)(Pt,"columns")&&delete Pt.columns,Pt}const Gt=function(Pt,Ye){return ln=>({options:ln||{},sanitize:async function(Zt,Bt){Bt=Object(H.p)({},this.options,Bt);const Mt=this.fileAccess,bn={href:null};let Dt,_t,xn;const In=R.test(Zt.replace(P,""));Zt!=null&&typeof Zt=="string"&&In||Object(H.o)("Sanitize failure, invalid URI: "+Object(H.Ba)(Zt));const Yn=J.test(Zt);return(xn=Bt.baseURL)&&!Yn&&(Zt.startsWith("/")||xn.endsWith("/")||(Zt="/"+Zt),Zt=xn+Zt),_t=(Dt=Zt.startsWith($))||Bt.mode==="file"||Bt.mode!=="http"&&!Yn&&Mt,Dt?Zt=Zt.slice($.length):Zt.startsWith("//")&&(Bt.defaultProtocol==="file"?(Zt=Zt.slice(2),_t=!0):Zt=(Bt.defaultProtocol||"http")+":"+Zt),Object.defineProperty(bn,"localFile",{value:!!_t}),bn.href=Zt,Bt.target&&(bn.target=Bt.target+""),Bt.rel&&(bn.rel=Bt.rel+""),Bt.context==="image"&&Bt.crossOrigin&&(bn.crossOrigin=Bt.crossOrigin+""),bn},load:async function(Zt,Bt){const Mt=await this.sanitize(Zt,Bt),bn=Mt.href;return Mt.localFile?this.file(bn):this.http(bn,Bt)},fileAccess:!1,file:function(Zt){return Zt?Bt=>new Promise((Mt,bn)=>{Zt.readFile(Bt,(Dt,_t)=>{Dt?bn(Dt):Mt(_t)})}):L}(Ye),http:function(Zt){return Zt?async function(Bt,Mt){const bn=Object(H.p)({},this.options.http,Mt),Dt=Mt&&Mt.response,_t=await Zt(Bt,bn);return _t.ok?Object(H.E)(_t[Dt])?_t[Dt]():_t.text():Object(H.o)(_t.status+""+_t.statusText)}:ee}(Pt)})}(typeof fetch<"u"&&fetch,null)}).call(this,o(92).Buffer)},function(Oe,A,o){/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});const b=o(102),H=o(46),U={prepend:!1};A.subSurface=function(B,re,J={}){const R=H.getDrawArea(B),P=b.css({"& canvas":{display:"block"},marginTop:".5rem",marginBottom:".5rem"}),$=b.css({backgroundColor:"white",display:"inline-block",boxSizing:"border-box",borderBottom:"1px solid #357EDD",lineHeight:"2em",padding:"0 10px 0 10px",marginBottom:"20px",fontWeight:"600",textAlign:"left"}),L=Object.assign({},U,J);let ee=R.querySelector(`div[data-name=${re}]`);if(!ee){if((ee=document.createElement("div")).setAttribute("class",`${P}`),ee.dataset.name=re,L.title){const F=document.createElement("div");F.setAttribute("class",`subsurface-title ${$}`),F.innerText=L.title,ee.appendChild(F)}L.prepend?R.insertBefore(ee,R.firstChild):R.appendChild(ee)}return ee},A.getDefaultWidth=function(B){let re=0,J=B;for(;J&&J.clientWidth===0;)J=J.parentElement,re=50;return J.clientWidth-re},A.getDefaultHeight=function(B){return B.clientHeight===0?200:B.clientHeight}},function(Oe,A,o){var b=o(84)("meta"),H=o(13),U=o(43),B=o(26).f,re=0,J=Object.isExtensible||function(){return!0},R=!o(15)(function(){return J(Object.preventExtensions({}))}),P=function(L){B(L,b,{value:{i:"O"+ ++re,w:{}}})},$=Oe.exports={KEY:b,NEED:!1,fastKey:function(L,ee){if(!H(L))return typeof L=="symbol"?L:(typeof L=="string"?"S":"P")+L;if(!U(L,b)){if(!J(L))return"F";if(!ee)return"E";P(L)}return L[b].i},getWeak:function(L,ee){if(!U(L,b)){if(!J(L))return!0;if(!ee)return!1;P(L)}return L[b].w},onFreeze:function(L){return R&&$.NEED&&J(L)&&!U(L,b)&&P(L),L}}},function(Oe,A,o){var b=o(13);Oe.exports=function(H,U){if(!b(H))return H;var B,re;if(U&&typeof(B=H.toString)=="function"&&!b(re=B.call(H))||typeof(B=H.valueOf)=="function"&&!b(re=B.call(H))||!U&&typeof(B=H.toString)=="function"&&!b(re=B.call(H)))return re;throw TypeError("Can't convert object to primitive value")}},function(Oe,A,o){Object.defineProperty(A,"__esModule",{value:!0}),o(0),o(384);const b=o(349),H=o(289),U=o(288),B=o(137),re=o(196),J=o(287),R=o(109),P=o(286),$=o(285),L=o(284),ee=o(283),F=o(110),ue=o(282);A.version_vis=ue.version;const ie={barchart:b.barchart,table:R.table,histogram:B.histogram,linechart:re.linechart,scatterplot:J.scatterplot,confusionMatrix:H.confusionMatrix,heatmap:U.heatmap};A.render=ie;const K={accuracy:F.accuracy,perClassAccuracy:F.perClassAccuracy,confusionMatrix:F.confusionMatrix};A.metrics=K;const he={history:P.history,fitCallbacks:P.fitCallbacks,perClassAccuracy:L.perClassAccuracy,valuesDistribution:ee.valuesDistribution,layer:$.layer,modelSummary:$.modelSummary};A.show=he;var pe=o(197);A.visor=pe.visor,function(Ae){for(var Te in Ae)A.hasOwnProperty(Te)||(A[Te]=Ae[Te])}(o(198))},function(Oe,A,o){var b=o(31),H=Object(b.a)(function(U){U.setUTCMonth(0,1),U.setUTCHours(0,0,0,0)},function(U,B){U.setUTCFullYear(U.getUTCFullYear()+B)},function(U,B){return B.getUTCFullYear()-U.getUTCFullYear()},function(U){return U.getUTCFullYear()});H.every=function(U){return isFinite(U=Math.floor(U))&&U>0?Object(b.a)(function(B){B.setUTCFullYear(Math.floor(B.getUTCFullYear()/U)*U),B.setUTCMonth(0,1),B.setUTCHours(0,0,0,0)},function(B,re){B.setUTCFullYear(B.getUTCFullYear()+re*U)}):null},A.a=H,H.range},function(Oe,A,o){var b=o(31),H=o(12),U=Object(b.a)(function(B){B.setTime(B-B.getMilliseconds())},function(B,re){B.setTime(+B+re*H.e)},function(B,re){return(re-B)/H.e},function(B){return B.getUTCSeconds()});A.a=U,U.range},function(Oe,A,o){var b=o(31),H=Object(b.a)(function(U){U.setMonth(0,1),U.setHours(0,0,0,0)},function(U,B){U.setFullYear(U.getFullYear()+B)},function(U,B){return B.getFullYear()-U.getFullYear()},function(U){return U.getFullYear()});H.every=function(U){return isFinite(U=Math.floor(U))&&U>0?Object(b.a)(function(B){B.setFullYear(Math.floor(B.getFullYear()/U)*U),B.setMonth(0,1),B.setHours(0,0,0,0)},function(B,re){B.setFullYear(B.getFullYear()+re*U)}):null},A.a=H,H.range},function(Oe,A,o){var b=o(31),H=o(12),U=Object(b.a)(function(B){B.setUTCHours(0,0,0,0)},function(B,re){B.setUTCDate(B.getUTCDate()+re)},function(B,re){return(re-B)/H.a},function(B){return B.getUTCDate()-1});A.a=U,U.range},function(Oe,A,o){var b=o(31),H=o(12),U=Object(b.a)(B=>B.setHours(0,0,0,0),(B,re)=>B.setDate(B.getDate()+re),(B,re)=>(re-B-(re.getTimezoneOffset()-B.getTimezoneOffset())*H.c)/H.a,B=>B.getDate()-1);A.a=U,U.range},function(Oe,A,o){Object.defineProperty(A,"__esModule",{value:!0}),A.Add="Add",A.AddN="AddN",A.Div="Div",A.FusedBatchNorm="FusedBatchNorm",A.SquaredDifference="SquaredDifference",A.Square="Square",A.Transpose="Transpose",A.NonMaxSuppressionV5="NonMaxSuppressionV5",A.BroadcastTo="BroadcastTo",A.OneHot="OneHot",A.Identity="Identity",A.Tile="Tile",A.PadV2="PadV2",A.FromPixels="FromPixels",A.MaxPoolWithArgmax="MaxPoolWithArgmax"},function(Oe,A,o){/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});var b=o(33),H=o(378),U=o(21);A.makeTypesMatch=function(B,re){if(B.dtype===re.dtype)return[B,re];var J=H.upcastType(B.dtype,re.dtype);return[B.cast(J),re.cast(J)]},A.assertTypesMatch=function(B,re){U.assert(B.dtype===re.dtype,function(){return"The dtypes of the first("+B.dtype+") and second("+re.dtype+") input must match"})},A.isTensorInList=function(B,re){return re.some(function(J){return J.id===B.id})},A.getTensorsInContainer=function(B){var re=[];return function J(R,P,$){if(R!=null){if(R instanceof b.Tensor)P.push(R);else if(function(ue){return Array.isArray(ue)||typeof ue=="object"}(R)){var L=R;for(var ee in L){var F=L[ee];$.has(F)||($.add(F),J(F,P,$))}}}}(B,re,new Set),re}},function(Oe,A){var o,b,H=Oe.exports={};function U(){throw new Error("setTimeout has not been defined")}function B(){throw new Error("clearTimeout has not been defined")}function re(ie){if(o===setTimeout)return setTimeout(ie,0);if((o===U||!o)&&setTimeout)return o=setTimeout,setTimeout(ie,0);try{return o(ie,0)}catch{try{return o.call(null,ie,0)}catch{return o.call(this,ie,0)}}}(function(){try{o=typeof setTimeout=="function"?setTimeout:U}catch{o=U}try{b=typeof clearTimeout=="function"?clearTimeout:B}catch{b=B}})();var J,R=[],P=!1,$=-1;function L(){P&&J&&(P=!1,J.length?R=J.concat(R):$=-1,R.length&&ee())}function ee(){if(!P){var ie=re(L);P=!0;for(var K=R.length;K;){for(J=R,R=[];++$<K;)J&&J[$].run();$=-1,K=R.length}J=null,P=!1,function(he){if(b===clearTimeout)return clearTimeout(he);if((b===B||!b)&&clearTimeout)return b=clearTimeout,clearTimeout(he);try{b(he)}catch{try{return b.call(null,he)}catch{return b.call(this,he)}}}(ie)}}function F(ie,K){this.fun=ie,this.array=K}function ue(){}H.nextTick=function(ie){var K=new Array(arguments.length-1);if(arguments.length>1)for(var he=1;he<arguments.length;he++)K[he-1]=arguments[he];R.push(new F(ie,K)),R.length!==1||P||re(ee)},F.prototype.run=function(){this.fun.apply(null,this.array)},H.title="browser",H.browser=!0,H.env={},H.argv=[],H.version="",H.versions={},H.on=ue,H.addListener=ue,H.once=ue,H.off=ue,H.removeListener=ue,H.removeAllListeners=ue,H.emit=ue,H.prependListener=ue,H.prependOnceListener=ue,H.listeners=function(ie){return[]},H.binding=function(ie){throw new Error("process.binding is not supported")},H.cwd=function(){return"/"},H.chdir=function(ie){throw new Error("process.chdir is not supported")},H.umask=function(){return 0}},function(Oe,A,o){var b=o(13);Oe.exports=function(H,U){if(!b(H)||H._t!==U)throw TypeError("Incompatible receiver, "+U+" required!");return H}},function(Oe,A,o){var b=o(19)("unscopables"),H=Array.prototype;H[b]==null&&o(42)(H,b,{}),Oe.exports=function(U){H[b][U]=!0}},function(Oe,A,o){var b=o(43),H=o(34),U=o(173)("IE_PROTO"),B=Object.prototype;Oe.exports=Object.getPrototypeOf||function(re){return re=H(re),b(re,U)?re[U]:typeof re.constructor=="function"&&re instanceof re.constructor?re.constructor.prototype:re instanceof Object?B:null}},function(Oe,A,o){var b=o(238),H=o(172).concat("length","prototype");A.f=Object.getOwnPropertyNames||function(U){return b(U,H)}},function(Oe,A,o){var b=o(14),H=o(237),U=o(172),B=o(173)("IE_PROTO"),re=function(){},J=function(){var R,P=o(175)("iframe"),$=U.length;for(P.style.display="none",o(171).appendChild(P),P.src="javascript:",(R=P.contentWindow.document).open(),R.write("<script>document.F=Object<\/script>"),R.close(),J=R.F;$--;)delete J.prototype[U[$]];return J()};Oe.exports=Object.create||function(R,P){var $;return R!==null?(re.prototype=b(R),$=new re,re.prototype=null,$[B]=R):$=J(),P===void 0?$:H($,P)}},function(Oe,A,o){var b=o(54),H=Math.max,U=Math.min;Oe.exports=function(B,re){return(B=b(B))<0?H(B+re,0):U(B,re)}},function(Oe,A,o){var b=o(238),H=o(172);Oe.exports=Object.keys||function(U){return b(U,H)}},function(Oe,A){Oe.exports=!1},function(Oe,A){var o=0,b=Math.random();Oe.exports=function(H){return"Symbol(".concat(H===void 0?"":H,")_",(++o+b).toString(36))}},function(Oe,A){Oe.exports=function(o,b){return{enumerable:!(1&o),configurable:!(2&o),writable:!(4&o),value:b}}},function(Oe,A,o){Oe.exports=function(b,H){H||(H={}),typeof H=="function"&&(H={cmp:H});var U=typeof H.cycles=="boolean"&&H.cycles,B=H.cmp&&function(J){return function(R){return function(P,$){var L={key:P,value:R[P]},ee={key:$,value:R[$]};return J(L,ee)}}}(H.cmp),re=[];return function J(R){if(R&&R.toJSON&&typeof R.toJSON=="function"&&(R=R.toJSON()),R!==void 0){if(typeof R=="number")return isFinite(R)?""+R:"null";if(typeof R!="object")return JSON.stringify(R);var P,$;if(Array.isArray(R)){for($="[",P=0;P<R.length;P++)P&&($+=","),$+=J(R[P])||"null";return $+"]"}if(R===null)return"null";if(re.indexOf(R)!==-1){if(U)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var L=re.push(R)-1,ee=Object.keys(R).sort(B&&B(R));for($="",P=0;P<ee.length;P++){var F=ee[P],ue=J(R[F]);ue&&($&&($+=","),$+=JSON.stringify(F)+":"+ue)}return re.splice(L,1),"{"+$+"}"}}(b)}},function(Oe,A,o){A.a=function(b,H){return b<H?-1:b>H?1:b>=H?0:NaN}},function(Oe,A,o){o.r(A);var b={};o.d(b,"JsonPatchError",function(){return Pt}),o.d(b,"deepClone",function(){return Ye}),o.d(b,"getValueByPointer",function(){return Bt}),o.d(b,"applyOperation",function(){return Mt}),o.d(b,"applyPatch",function(){return bn}),o.d(b,"applyReducer",function(){return Dt}),o.d(b,"validator",function(){return _t}),o.d(b,"validate",function(){return xn}),o.d(b,"_areEquals",function(){return In});var H={};o.d(H,"unobserve",function(){return Pe}),o.d(H,"observe",function(){return rt}),o.d(H,"generate",function(){return Et}),o.d(H,"compare",function(){return rn});var U={};o.d(U,"aggregate",function(){return ic}),o.d(U,"bin",function(){return Rd}),o.d(U,"collect",function(){return Fp}),o.d(U,"compare",function(){return xm}),o.d(U,"countpattern",function(){return qc}),o.d(U,"cross",function(){return zo}),o.d(U,"density",function(){return Md}),o.d(U,"dotbin",function(){return wu}),o.d(U,"expression",function(){return Oo}),o.d(U,"extent",function(){return Zs}),o.d(U,"facet",function(){return fa}),o.d(U,"field",function(){return uo}),o.d(U,"filter",function(){return wa}),o.d(U,"flatten",function(){return xs}),o.d(U,"fold",function(){return fr}),o.d(U,"formula",function(){return zs}),o.d(U,"generate",function(){return eu}),o.d(U,"impute",function(){return Nh}),o.d(U,"joinaggregate",function(){return jd}),o.d(U,"kde",function(){return Bd}),o.d(U,"key",function(){return uu}),o.d(U,"load",function(){return ws}),o.d(U,"lookup",function(){return ac}),o.d(U,"multiextent",function(){return us}),o.d(U,"multivalues",function(){return Ba}),o.d(U,"params",function(){return Pd}),o.d(U,"pivot",function(){return Al}),o.d(U,"prefacet",function(){return Rh}),o.d(U,"project",function(){return Ri}),o.d(U,"proxy",function(){return bi}),o.d(U,"quantile",function(){return ro}),o.d(U,"relay",function(){return Ld}),o.d(U,"sample",function(){return zd}),o.d(U,"sequence",function(){return Ud}),o.d(U,"sieve",function(){return Rp}),o.d(U,"subflow",function(){return xt}),o.d(U,"timeunit",function(){return zu}),o.d(U,"tupleindex",function(){return $c}),o.d(U,"values",function(){return Rs}),o.d(U,"window",function(){return Gc});var B={};o.d(B,"interpolate",function(){return io}),o.d(B,"interpolateArray",function(){return Ya}),o.d(B,"interpolateBasis",function(){return Vr}),o.d(B,"interpolateBasisClosed",function(){return wr}),o.d(B,"interpolateDate",function(){return xo}),o.d(B,"interpolateDiscrete",function(){return Nv}),o.d(B,"interpolateHue",function(){return Zd}),o.d(B,"interpolateNumber",function(){return ki}),o.d(B,"interpolateNumberArray",function(){return Ii}),o.d(B,"interpolateObject",function(){return Ui}),o.d(B,"interpolateRound",function(){return Ja}),o.d(B,"interpolateString",function(){return Wo}),o.d(B,"interpolateTransformCss",function(){return Fm}),o.d(B,"interpolateTransformSvg",function(){return b0}),o.d(B,"interpolateZoom",function(){return Ag}),o.d(B,"interpolateRgb",function(){return Zr}),o.d(B,"interpolateRgbBasis",function(){return ea}),o.d(B,"interpolateRgbBasisClosed",function(){return La}),o.d(B,"interpolateHsl",function(){return Bp}),o.d(B,"interpolateHslLong",function(){return Sg}),o.d(B,"interpolateLab",function(){return np}),o.d(B,"interpolateHcl",function(){return k0}),o.d(B,"interpolateHclLong",function(){return Iv}),o.d(B,"interpolateCubehelix",function(){return Xh}),o.d(B,"interpolateCubehelixLong",function(){return Fv}),o.d(B,"piecewise",function(){return _u}),o.d(B,"quantize",function(){return Rv});var re={};o.d(re,"bound",function(){return VA}),o.d(re,"identifier",function(){return Yk}),o.d(re,"mark",function(){return HA}),o.d(re,"overlap",function(){return $A}),o.d(re,"render",function(){return QA}),o.d(re,"viewlayout",function(){return i_});var J={};o.d(J,"axisticks",function(){return o_}),o.d(J,"datajoin",function(){return s_}),o.d(J,"encode",function(){return u_}),o.d(J,"legendentries",function(){return c_}),o.d(J,"linkpath",function(){return Jk}),o.d(J,"pie",function(){return Qk}),o.d(J,"scale",function(){return m_}),o.d(J,"sortitems",function(){return y_}),o.d(J,"stack",function(){return eE});var R={};o.d(R,"contour",function(){return IE}),o.d(R,"geojson",function(){return ME}),o.d(R,"geopath",function(){return jE}),o.d(R,"geopoint",function(){return BE}),o.d(R,"geoshape",function(){return PE}),o.d(R,"graticule",function(){return LE}),o.d(R,"heatmap",function(){return zE}),o.d(R,"isocontour",function(){return DE}),o.d(R,"kde2d",function(){return NE}),o.d(R,"projection",function(){return DS});var P={};o.d(P,"force",function(){return $E});var $={};o.d($,"nest",function(){return ZE}),o.d($,"pack",function(){return tC}),o.d($,"partition",function(){return rC}),o.d($,"stratify",function(){return iC}),o.d($,"tree",function(){return oC}),o.d($,"treelinks",function(){return sC}),o.d($,"treemap",function(){return cC});var L={};o.d(L,"label",function(){return fC});var ee={};o.d(ee,"loess",function(){return hC}),o.d(ee,"regression",function(){return pC});var F={};o.d(F,"voronoi",function(){return bC});var ue={};o.d(ue,"wordcloud",function(){return wC});var ie={};o.d(ie,"crossfilter",function(){return kC}),o.d(ie,"resolvefilter",function(){return EC});var K={};o.d(K,"Dataflow",function(){return Hn}),o.d(K,"EventStream",function(){return Ci}),o.d(K,"MultiPulse",function(){return Rt}),o.d(K,"Operator",function(){return ai}),o.d(K,"Parameters",function(){return Yr}),o.d(K,"Pulse",function(){return ye}),o.d(K,"Transform",function(){return Ot}),o.d(K,"changeset",function(){return Mr}),o.d(K,"definition",function(){return qt}),o.d(K,"ingest",function(){return Dn}),o.d(K,"isTuple",function(){return Xt}),o.d(K,"transform",function(){return Ve}),o.d(K,"transforms",function(){return pn}),o.d(K,"tupleid",function(){return nn}),o.d(K,"interpolate",function(){return Kp}),o.d(K,"interpolateColors",function(){return Kl}),o.d(K,"interpolateRange",function(){return $p}),o.d(K,"quantizeInterpolator",function(){return Gp}),o.d(K,"scale",function(){return Fa}),o.d(K,"scheme",function(){return zm}),o.d(K,"projection",function(){return SE}),o.d(K,"View",function(){return ID}),o.d(K,"defaultLocale",function(){return br.a}),o.d(K,"formatLocale",function(){return br.c}),o.d(K,"locale",function(){return br.b}),o.d(K,"resetDefaultLocale",function(){return br.d}),o.d(K,"timeFormatLocale",function(){return br.e}),o.d(K,"expressionFunction",function(){return Yu}),o.d(K,"parse",function(){return lB}),o.d(K,"runtimeContext",function(){return hD}),o.d(K,"codegenExpression",function(){return i7}),o.d(K,"parseExpression",function(){return t7}),o.d(K,"parseSelector",function(){return Sy}),o.d(K,"version",function(){return h7}),o.d(K,"Debug",function(){return xe.a}),o.d(K,"Error",function(){return xe.b}),o.d(K,"Info",function(){return xe.c}),o.d(K,"None",function(){return xe.d}),o.d(K,"Warn",function(){return xe.e}),o.d(K,"accessor",function(){return xe.f}),o.d(K,"accessorFields",function(){return xe.g}),o.d(K,"accessorName",function(){return xe.h}),o.d(K,"array",function(){return xe.i}),o.d(K,"ascending",function(){return xe.j}),o.d(K,"clampRange",function(){return xe.k}),o.d(K,"compare",function(){return xe.l}),o.d(K,"constant",function(){return xe.m}),o.d(K,"debounce",function(){return xe.n}),o.d(K,"error",function(){return xe.o}),o.d(K,"extend",function(){return xe.p}),o.d(K,"extent",function(){return xe.q}),o.d(K,"extentIndex",function(){return xe.r}),o.d(K,"falsy",function(){return xe.s}),o.d(K,"fastmap",function(){return xe.t}),o.d(K,"field",function(){return xe.u}),o.d(K,"flush",function(){return xe.v}),o.d(K,"hasOwnProperty",function(){return xe.w}),o.d(K,"id",function(){return xe.x}),o.d(K,"identity",function(){return xe.y}),o.d(K,"inherits",function(){return xe.z}),o.d(K,"inrange",function(){return xe.A}),o.d(K,"isArray",function(){return xe.B}),o.d(K,"isBoolean",function(){return xe.C}),o.d(K,"isDate",function(){return xe.D}),o.d(K,"isFunction",function(){return xe.E}),o.d(K,"isIterable",function(){return xe.F}),o.d(K,"isNumber",function(){return xe.G}),o.d(K,"isObject",function(){return xe.H}),o.d(K,"isRegExp",function(){return xe.I}),o.d(K,"isString",function(){return xe.J}),o.d(K,"key",function(){return xe.K}),o.d(K,"lerp",function(){return xe.L}),o.d(K,"logger",function(){return xe.M}),o.d(K,"lruCache",function(){return xe.N}),o.d(K,"merge",function(){return xe.O}),o.d(K,"mergeConfig",function(){return xe.P}),o.d(K,"one",function(){return xe.Q}),o.d(K,"pad",function(){return xe.R}),o.d(K,"panLinear",function(){return xe.S}),o.d(K,"panLog",function(){return xe.T}),o.d(K,"panPow",function(){return xe.U}),o.d(K,"panSymlog",function(){return xe.V}),o.d(K,"peek",function(){return xe.W}),o.d(K,"quarter",function(){return xe.X}),o.d(K,"repeat",function(){return xe.Y}),o.d(K,"span",function(){return xe.Z}),o.d(K,"splitAccessPath",function(){return xe.Aa}),o.d(K,"stringValue",function(){return xe.Ba}),o.d(K,"toBoolean",function(){return xe.Ca}),o.d(K,"toDate",function(){return xe.Da}),o.d(K,"toNumber",function(){return xe.Ea}),o.d(K,"toSet",function(){return xe.Fa}),o.d(K,"toString",function(){return xe.Ga}),o.d(K,"truncate",function(){return xe.Ha}),o.d(K,"truthy",function(){return xe.Ia}),o.d(K,"utcquarter",function(){return xe.Ja}),o.d(K,"visitArray",function(){return xe.Ka}),o.d(K,"writeConfig",function(){return xe.La}),o.d(K,"zero",function(){return xe.Ma}),o.d(K,"zoomLinear",function(){return xe.Na}),o.d(K,"zoomLog",function(){return xe.Oa}),o.d(K,"zoomPow",function(){return xe.Pa}),o.d(K,"zoomSymlog",function(){return xe.Qa}),o.d(K,"bandwidthNRD",function(){return qr}),o.d(K,"bin",function(){return jr}),o.d(K,"bootstrapCI",function(){return Vi}),o.d(K,"cumulativeLogNormal",function(){return Dd}),o.d(K,"cumulativeNormal",function(){return qi}),o.d(K,"cumulativeUniform",function(){return Ch}),o.d(K,"densityLogNormal",function(){return xc}),o.d(K,"densityNormal",function(){return Eh}),o.d(K,"densityUniform",function(){return yf}),o.d(K,"dotbin",function(){return Fr}),o.d(K,"quantileLogNormal",function(){return os}),o.d(K,"quantileNormal",function(){return ec}),o.d(K,"quantileUniform",function(){return wc}),o.d(K,"quantiles",function(){return Qi}),o.d(K,"quartiles",function(){return Di}),o.d(K,"random",function(){return Bn}),o.d(K,"randomInteger",function(){return ma}),o.d(K,"randomKDE",function(){return bc}),o.d(K,"randomLCG",function(){return aa}),o.d(K,"randomLogNormal",function(){return vf}),o.d(K,"randomMixture",function(){return Td}),o.d(K,"randomNormal",function(){return bu}),o.d(K,"randomUniform",function(){return El}),o.d(K,"regressionExp",function(){return nc}),o.d(K,"regressionLinear",function(){return ss}),o.d(K,"regressionLoess",function(){return xf}),o.d(K,"regressionLog",function(){return Eo}),o.d(K,"regressionPoly",function(){return su}),o.d(K,"regressionPow",function(){return Cl}),o.d(K,"regressionQuad",function(){return rc}),o.d(K,"sampleCurve",function(){return wf}),o.d(K,"sampleLogNormal",function(){return Bu}),o.d(K,"sampleNormal",function(){return vs}),o.d(K,"sampleUniform",function(){return Pu}),o.d(K,"setRandom",function(){return ri}),o.d(K,"DATE",function(){return or.a}),o.d(K,"DAY",function(){return or.b}),o.d(K,"DAYOFYEAR",function(){return or.c}),o.d(K,"HOURS",function(){return or.d}),o.d(K,"MILLISECONDS",function(){return or.e}),o.d(K,"MINUTES",function(){return or.f}),o.d(K,"MONTH",function(){return or.g}),o.d(K,"QUARTER",function(){return or.h}),o.d(K,"SECONDS",function(){return or.i}),o.d(K,"TIME_UNITS",function(){return or.j}),o.d(K,"WEEK",function(){return or.k}),o.d(K,"YEAR",function(){return or.l}),o.d(K,"dayofyear",function(){return or.m}),o.d(K,"timeBin",function(){return or.n}),o.d(K,"timeFloor",function(){return or.o}),o.d(K,"timeInterval",function(){return or.p}),o.d(K,"timeOffset",function(){return or.q}),o.d(K,"timeSequence",function(){return or.r}),o.d(K,"timeUnitSpecifier",function(){return or.s}),o.d(K,"timeUnits",function(){return or.t}),o.d(K,"utcFloor",function(){return or.u}),o.d(K,"utcInterval",function(){return or.v}),o.d(K,"utcOffset",function(){return or.w}),o.d(K,"utcSequence",function(){return or.x}),o.d(K,"utcdayofyear",function(){return or.y}),o.d(K,"utcweek",function(){return or.z}),o.d(K,"week",function(){return or.A}),o.d(K,"format",function(){return Xn.a}),o.d(K,"formats",function(){return Xn.b}),o.d(K,"inferType",function(){return Xn.c}),o.d(K,"inferTypes",function(){return Xn.d}),o.d(K,"loader",function(){return Xn.e}),o.d(K,"read",function(){return Xn.f}),o.d(K,"responseType",function(){return Xn.g}),o.d(K,"typeParsers",function(){return Xn.h}),o.d(K,"Bounds",function(){return Xo}),o.d(K,"CanvasHandler",function(){return qe}),o.d(K,"CanvasRenderer",function(){return wt}),o.d(K,"Gradient",function(){return qm}),o.d(K,"GroupItem",function(){return gp}),o.d(K,"Handler",function(){return u}),o.d(K,"Item",function(){return id}),o.d(K,"Marks",function(){return gl}),o.d(K,"RenderType",function(){return ur}),o.d(K,"Renderer",function(){return y}),o.d(K,"ResourceLoader",function(){return im}),o.d(K,"SVGHandler",function(){return Yt}),o.d(K,"SVGRenderer",function(){return lt}),o.d(K,"SVGStringRenderer",function(){return lr}),o.d(K,"Scenegraph",function(){return iv}),o.d(K,"boundClip",function(){return ca}),o.d(K,"boundContext",function(){return um}),o.d(K,"boundItem",function(){return fd}),o.d(K,"boundMark",function(){return A0}),o.d(K,"boundStroke",function(){return Zl}),o.d(K,"domChild",function(){return Xu}),o.d(K,"domClear",function(){return af}),o.d(K,"domCreate",function(){return mc}),o.d(K,"domFind",function(){return S0}),o.d(K,"font",function(){return ld}),o.d(K,"fontFamily",function(){return oh}),o.d(K,"fontSize",function(){return Ku}),o.d(K,"intersect",function(){return Er}),o.d(K,"intersectBoxLine",function(){return De}),o.d(K,"intersectPath",function(){return z}),o.d(K,"intersectPoint",function(){return Y}),o.d(K,"intersectRule",function(){return ve}),o.d(K,"lineHeight",function(){return Ts}),o.d(K,"markup",function(){return Ne}),o.d(K,"multiLineOffset",function(){return ps}),o.d(K,"pathCurves",function(){return Yl}),o.d(K,"pathEqual",function(){return ja}),o.d(K,"pathParse",function(){return td}),o.d(K,"pathRectangle",function(){return Jg}),o.d(K,"pathRender",function(){return rd}),o.d(K,"pathSymbols",function(){return Ql}),o.d(K,"pathTrail",function(){return fl}),o.d(K,"point",function(){return h}),o.d(K,"renderModule",function(){return Or}),o.d(K,"resetSVGClipId",function(){return Zg}),o.d(K,"resetSVGDefIds",function(){return Za}),o.d(K,"sceneEqual",function(){return ba}),o.d(K,"sceneFromJSON",function(){return Uv}),o.d(K,"scenePickVisit",function(){return Pn}),o.d(K,"sceneToJSON",function(){return rv}),o.d(K,"sceneVisit",function(){return Tn}),o.d(K,"sceneZOrder",function(){return En}),o.d(K,"serializeXML",function(){return Ue}),o.d(K,"textMetrics",function(){return ds});var he={};o.d(he,"invalidSpec",function(){return eP}),o.d(he,"FIT_NON_SINGLE",function(){return tP}),o.d(he,"containerSizeNonSingle",function(){return nP}),o.d(he,"containerSizeNotCompatibleWithAutosize",function(){return rP}),o.d(he,"droppingFit",function(){return iP}),o.d(he,"cannotProjectOnChannelWithoutField",function(){return aP}),o.d(he,"cannotProjectAggregate",function(){return oP}),o.d(he,"nearestNotSupportForContinuous",function(){return sP}),o.d(he,"selectionNotSupported",function(){return uP}),o.d(he,"selectionNotFound",function(){return cP}),o.d(he,"SCALE_BINDINGS_CONTINUOUS",function(){return lP}),o.d(he,"LEGEND_BINDINGS_PROJECT_LENGTH",function(){return fP}),o.d(he,"noSameUnitLookup",function(){return hP}),o.d(he,"noSuchRepeatedValue",function(){return dP}),o.d(he,"columnsNotSupportByRowCol",function(){return pP}),o.d(he,"CONCAT_CANNOT_SHARE_AXIS",function(){return mP}),o.d(he,"unrecognizedParse",function(){return gP}),o.d(he,"differentParse",function(){return vP}),o.d(he,"invalidTransformIgnored",function(){return yP}),o.d(he,"NO_FIELDS_NEEDS_AS",function(){return bP}),o.d(he,"customFormatTypeNotAllowed",function(){return xP}),o.d(he,"encodingOverridden",function(){return wP}),o.d(he,"projectionOverridden",function(){return kP}),o.d(he,"REPLACE_ANGLE_WITH_THETA",function(){return EP}),o.d(he,"primitiveChannelDef",function(){return CP}),o.d(he,"invalidFieldType",function(){return OP}),o.d(he,"invalidFieldTypeForCountAggregate",function(){return AP}),o.d(he,"invalidAggregate",function(){return _P}),o.d(he,"missingFieldType",function(){return SP}),o.d(he,"droppingColor",function(){return DP}),o.d(he,"emptyFieldDef",function(){return TP}),o.d(he,"latLongDeprecated",function(){return NP}),o.d(he,"LINE_WITH_VARYING_SIZE",function(){return IP}),o.d(he,"incompatibleChannel",function(){return FP}),o.d(he,"invalidEncodingChannel",function(){return RP}),o.d(he,"facetChannelShouldBeDiscrete",function(){return MP}),o.d(he,"facetChannelDropped",function(){return jP}),o.d(he,"discreteChannelCannotEncode",function(){return BP}),o.d(he,"lineWithRange",function(){return PP}),o.d(he,"orientOverridden",function(){return LP}),o.d(he,"CANNOT_UNION_CUSTOM_DOMAIN_WITH_FIELD_DOMAIN",function(){return zP}),o.d(he,"RANGE_STEP_DEPRECATED",function(){return UP}),o.d(he,"cannotUseScalePropertyWithNonColor",function(){return WP}),o.d(he,"unaggregateDomainHasNoEffectForRawField",function(){return VP}),o.d(he,"unaggregateDomainWithNonSharedDomainOp",function(){return qP}),o.d(he,"unaggregatedDomainWithLogScale",function(){return HP}),o.d(he,"cannotApplySizeToNonOrientedMark",function(){return $P}),o.d(he,"scaleTypeNotWorkWithChannel",function(){return GP}),o.d(he,"scaleTypeNotWorkWithFieldDef",function(){return KP}),o.d(he,"scalePropertyNotWorkWithScaleType",function(){return XP}),o.d(he,"scaleTypeNotWorkWithMark",function(){return YP}),o.d(he,"stepDropped",function(){return JP}),o.d(he,"mergeConflictingProperty",function(){return QP}),o.d(he,"mergeConflictingDomainProperty",function(){return ZP}),o.d(he,"independentScaleMeansIndependentGuide",function(){return eL}),o.d(he,"domainSortDropped",function(){return tL}),o.d(he,"MORE_THAN_ONE_SORT",function(){return nL}),o.d(he,"FACETED_INDEPENDENT_DIFFERENT_SOURCES",function(){return rL}),o.d(he,"FACETED_INDEPENDENT_SAME_FIELDS_DIFFERENT_SOURCES",function(){return iL}),o.d(he,"FACETED_INDEPENDENT_SAME_SOURCE",function(){return aL}),o.d(he,"INVALID_CHANNEL_FOR_AXIS",function(){return oL}),o.d(he,"cannotStackRangedMark",function(){return sL}),o.d(he,"cannotStackNonLinearScale",function(){return uL}),o.d(he,"stackNonSummativeAggregate",function(){return cL}),o.d(he,"invalidTimeUnit",function(){return lL}),o.d(he,"droppedDay",function(){return fL}),o.d(he,"errorBarCenterAndExtentAreNotNeeded",function(){return hL}),o.d(he,"errorBarCenterIsUsedWithWrongExtent",function(){return dL}),o.d(he,"errorBarContinuousAxisHasCustomizedAggregate",function(){return pL}),o.d(he,"errorBarCenterIsNotNeeded",function(){return mL}),o.d(he,"errorBand1DNotSupport",function(){return gL}),o.d(he,"channelRequiredForBinned",function(){return vL}),o.d(he,"domainRequiredForThresholdScale",function(){return yL});var pe={};o.d(pe,"compile",function(){return BW}),o.d(pe,"extractTransforms",function(){return LW}),o.d(pe,"normalize",function(){return nF}),o.d(pe,"version",function(){return zW});var Ae={};o.d(Ae,"dark",function(){return UW}),o.d(Ae,"excel",function(){return WW}),o.d(Ae,"fivethirtyeight",function(){return VW}),o.d(Ae,"ggplot2",function(){return qW}),o.d(Ae,"googlecharts",function(){return XW}),o.d(Ae,"latimes",function(){return HW}),o.d(Ae,"quartz",function(){return $W}),o.d(Ae,"urbaninstitute",function(){return KW}),o.d(Ae,"version",function(){return YW}),o.d(Ae,"vox",function(){return GW});/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017 Joachim Wester
 * MIT license
 */var Te=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)i.hasOwnProperty(s)&&(r[s]=i[s])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),je=Object.prototype.hasOwnProperty;function ke(e,t){return je.call(e,t)}function at(e){if(Array.isArray(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);t=[];for(var r in e)ke(e,r)&&t.push(r);return t}function St(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function zt(e){for(var t,n=0,r=e.length;n<r;){if(!((t=e.charCodeAt(n))>=48&&t<=57))return!1;n++}return!0}function $t(e){return e.indexOf("/")===-1&&e.indexOf("~")===-1?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function we(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function Tt(e,t){var n=[e];for(var r in t){var i=typeof t[r]=="object"?JSON.stringify(t[r],null,2):t[r];i!==void 0&&n.push(r+": "+i)}return n.join(`
`)}var Gt=function(e){function t(n,r,i,s,f){var m=this.constructor,x=e.call(this,Tt(n,{name:r,index:i,operation:s,tree:f}))||this;return x.name=r,x.index=i,x.operation=s,x.tree=f,Object.setPrototypeOf(x,m.prototype),x.message=Tt(n,{name:r,index:i,operation:s,tree:f}),x}return Te(t,e),t}(Error),Pt=Gt,Ye=St,ln={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var r=e[t];return delete e[t],{newDocument:n,removed:r}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:function(e,t,n){var r=Bt(n,this.path);r&&(r=St(r));var i=Mt(n,{op:"remove",path:this.from}).removed;return Mt(n,{op:"add",path:this.path,value:i}),{newDocument:n,removed:r}},copy:function(e,t,n){var r=Bt(n,this.from);return Mt(n,{op:"add",path:this.path,value:St(r)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:In(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}},Zt={add:function(e,t,n){return zt(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){return{newDocument:n,removed:e.splice(t,1)[0]}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:ln.move,copy:ln.copy,test:ln.test,_get:ln._get};function Bt(e,t){if(t=="")return e;var n={op:"_get",path:t};return Mt(e,n),n.value}function Mt(e,t,n,r,i,s){if(n===void 0&&(n=!1),r===void 0&&(r=!0),i===void 0&&(i=!0),s===void 0&&(s=0),n&&(typeof n=="function"?n(t,0,e,t.path):_t(t,0)),t.path===""){var f={newDocument:e};if(t.op==="add")return f.newDocument=t.value,f;if(t.op==="replace")return f.newDocument=t.value,f.removed=e,f;if(t.op==="move"||t.op==="copy")return f.newDocument=Bt(e,t.from),t.op==="move"&&(f.removed=e),f;if(t.op==="test"){if(f.test=In(e,t.value),f.test===!1)throw new Pt("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return f.newDocument=e,f}if(t.op==="remove")return f.removed=e,f.newDocument=null,f;if(t.op==="_get")return t.value=e,f;if(n)throw new Pt("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,t,e);return f}r||(e=St(e));var m=(t.path||"").split("/"),x=e,O=1,T=m.length,M=void 0,q=void 0,Q=void 0;for(Q=typeof n=="function"?n:_t;;){if((q=m[O])&&q.indexOf("~")!=-1&&(q=we(q)),i&&q=="__proto__")throw new TypeError("JSON-Patch: modifying `__proto__` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&M===void 0&&(x[q]===void 0?M=m.slice(0,O).join("/"):O==T-1&&(M=t.path),M!==void 0&&Q(t,0,e,M)),O++,Array.isArray(x)){if(q==="-")q=x.length;else{if(n&&!zt(q))throw new Pt("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,t,e);zt(q)&&(q=~~q)}if(O>=T){if(n&&t.op==="add"&&q>x.length)throw new Pt("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,t,e);if((f=Zt[t.op].call(t,x,q,e)).test===!1)throw new Pt("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return f}}else if(O>=T){if((f=ln[t.op].call(t,x,q,e)).test===!1)throw new Pt("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return f}if(x=x[q],n&&O<T&&(!x||typeof x!="object"))throw new Pt("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,t,e)}}function bn(e,t,n,r,i){if(r===void 0&&(r=!0),i===void 0&&(i=!0),n&&!Array.isArray(t))throw new Pt("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(e=St(e));for(var s=new Array(t.length),f=0,m=t.length;f<m;f++)s[f]=Mt(e,t[f],n,!0,i,f),e=s[f].newDocument;return s.newDocument=e,s}function Dt(e,t,n){var r=Mt(e,t);if(r.test===!1)throw new Pt("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return r.newDocument}function _t(e,t,n,r){if(typeof e!="object"||e===null||Array.isArray(e))throw new Pt("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n);if(!ln[e.op])throw new Pt("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n);if(typeof e.path!="string")throw new Pt("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n);if(e.path.indexOf("/")!==0&&e.path.length>0)throw new Pt('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n);if((e.op==="move"||e.op==="copy")&&typeof e.from!="string")throw new Pt("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&e.value===void 0)throw new Pt("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&function m(x){if(x===void 0)return!0;if(x){if(Array.isArray(x)){for(var O=0,T=x.length;O<T;O++)if(m(x[O]))return!0}else if(typeof x=="object"){var M=at(x),q=M.length;for(O=0;O<q;O++)if(m(x[M[O]]))return!0}}return!1}(e.value))throw new Pt("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n);if(n){if(e.op=="add"){var i=e.path.split("/").length,s=r.split("/").length;if(i!==s+1&&i!==s)throw new Pt("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}else if(e.op==="replace"||e.op==="remove"||e.op==="_get"){if(e.path!==r)throw new Pt("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}else if(e.op==="move"||e.op==="copy"){var f=xn([{op:"_get",path:e.from,value:void 0}],n);if(f&&f.name==="OPERATION_PATH_UNRESOLVABLE")throw new Pt("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}}function xn(e,t,n){try{if(!Array.isArray(e))throw new Pt("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)bn(St(t),St(e),n||!0);else{n=n||_t;for(var r=0;r<e.length;r++)n(e[r],r,t,void 0)}}catch(i){if(i instanceof Pt)return i;throw i}}function In(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var n,r,i,s=Array.isArray(e),f=Array.isArray(t);if(s&&f){if((r=e.length)!=t.length)return!1;for(n=r;n--!=0;)if(!In(e[n],t[n]))return!1;return!0}if(s!=f)return!1;var m=Object.keys(e);if((r=m.length)!==Object.keys(t).length)return!1;for(n=r;n--!=0;)if(!t.hasOwnProperty(m[n]))return!1;for(n=r;n--!=0;)if(!In(e[i=m[n]],t[i]))return!1;return!0}return e!=e&&t!=t}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017 Joachim Wester
 * MIT license
 */var Yn=new WeakMap,fn=function(){return function(e){this.observers=new Map,this.obj=e}}(),We=function(){return function(e,t){this.callback=e,this.observer=t}}();function Pe(e,t){t.unobserve()}function rt(e,t){var n,r=function(m){return Yn.get(m)}(e);if(r){var i=function(m,x){return m.observers.get(x)}(r,t);n=i&&i.observer}else r=new fn(e),Yn.set(e,r);if(n)return n;if(n={},r.value=St(e),t){n.callback=t,n.next=null;var s=function(){Et(n)},f=function(){clearTimeout(n.next),n.next=setTimeout(s)};typeof window<"u"&&(window.addEventListener("mouseup",f),window.addEventListener("keyup",f),window.addEventListener("mousedown",f),window.addEventListener("keydown",f),window.addEventListener("change",f))}return n.patches=[],n.object=e,n.unobserve=function(){Et(n),clearTimeout(n.next),function(m,x){m.observers.delete(x.callback)}(r,n),typeof window<"u"&&(window.removeEventListener("mouseup",f),window.removeEventListener("keyup",f),window.removeEventListener("mousedown",f),window.removeEventListener("keydown",f),window.removeEventListener("change",f))},r.observers.set(t,new We(t,n)),n}function Et(e,t){t===void 0&&(t=!1);var n=Yn.get(e.object);Lt(n.value,e.object,e.patches,"",t),e.patches.length&&bn(n.value,e.patches);var r=e.patches;return r.length>0&&(e.patches=[],e.callback&&e.callback(r)),r}function Lt(e,t,n,r,i){if(t!==e){typeof t.toJSON=="function"&&(t=t.toJSON());for(var s=at(t),f=at(e),m=!1,x=f.length-1;x>=0;x--){var O=e[M=f[x]];if(!ke(t,M)||t[M]===void 0&&O!==void 0&&Array.isArray(t)===!1)Array.isArray(e)===Array.isArray(t)?(i&&n.push({op:"test",path:r+"/"+$t(M),value:St(O)}),n.push({op:"remove",path:r+"/"+$t(M)}),m=!0):(i&&n.push({op:"test",path:r,value:e}),n.push({op:"replace",path:r,value:t}));else{var T=t[M];typeof O=="object"&&O!=null&&typeof T=="object"&&T!=null&&Array.isArray(O)===Array.isArray(T)?Lt(O,T,n,r+"/"+$t(M),i):O!==T&&(i&&n.push({op:"test",path:r+"/"+$t(M),value:St(O)}),n.push({op:"replace",path:r+"/"+$t(M),value:St(T)}))}}if(m||s.length!=f.length)for(x=0;x<s.length;x++){var M;ke(e,M=s[x])||t[M]===void 0||n.push({op:"add",path:r+"/"+$t(M),value:St(t[M])})}}}function rn(e,t,n){n===void 0&&(n=!1);var r=[];return Lt(e,t,r,"",n),r}Object.assign({},b,H,{JsonPatchError:Gt,deepClone:St,escapePathComponent:$t,unescapePathComponent:we});var Sn=o(133),kn=o.n(Sn),qn=o(179),xe=o(1),Xn=o(63),br=o(44);function Cr(e){const t=e||xe.y,n=[],r={};return n.add=i=>{const s=t(i);return r[s]||(r[s]=1,n.push(i)),n},n.remove=i=>{const s=t(i);if(r[s]){r[s]=0;const f=n.indexOf(i);f>=0&&n.splice(f,1)}return n},n}async function dr(e,t){try{await t(e)}catch(n){e.error(n)}}const Rr=Symbol("vega_id");let hn=1;function Xt(e){return!(!e||!nn(e))}function nn(e){return e[Rr]}function Gn(e,t){return e[Rr]=t,e}function Dn(e){const t=e===Object(e)?e:{data:e};return nn(t)?t:Gn(t,hn++)}function mr(e){return xr(e,Dn({}))}function xr(e,t){for(const n in e)t[n]=e[n];return t}function gr(e,t){return Gn(t,nn(e))}function Qr(e,t){return e?t?(n,r)=>e(n,r)||nn(t(n))-nn(t(r)):(n,r)=>e(n,r)||nn(n)-nn(r):null}function ni(e){return e&&e.constructor===Mr}function Mr(){const e=[],t=[],n=[],r=[],i=[];let s=null,f=!1;return{constructor:Mr,insert(m){const x=Object(xe.i)(m),O=x.length;for(let T=0;T<O;++T)e.push(x[T]);return this},remove(m){const x=Object(xe.E)(m)?r:t,O=Object(xe.i)(m),T=O.length;for(let M=0;M<T;++M)x.push(O[M]);return this},modify(m,x,O){const T={field:x,value:Object(xe.m)(O)};return Object(xe.E)(m)?(T.filter=m,i.push(T)):(T.tuple=m,n.push(T)),this},encode(m,x){return Object(xe.E)(m)?i.push({filter:m,field:x}):n.push({tuple:m,field:x}),this},clean(m){return s=m,this},reflow(){return f=!0,this},pulse(m,x){const O={},T={};let M,q,Q,se,le,Fe;for(M=0,q=x.length;M<q;++M)O[nn(x[M])]=1;for(M=0,q=t.length;M<q;++M)O[nn(le=t[M])]=-1;for(M=0,q=r.length;M<q;++M)se=r[M],x.forEach(ze=>{se(ze)&&(O[nn(ze)]=-1)});for(M=0,q=e.length;M<q;++M)Fe=nn(le=e[M]),O[Fe]?O[Fe]=1:m.add.push(Dn(e[M]));for(M=0,q=x.length;M<q;++M)le=x[M],O[nn(le)]<0&&m.rem.push(le);function Le(ze,nt,it){it?ze[nt]=it(ze):m.encode=nt,f||(T[nn(ze)]=ze)}for(M=0,q=n.length;M<q;++M)le=(Q=n[M]).tuple,se=Q.field,(Fe=O[nn(le)])>0&&(Le(le,se,Q.value),m.modifies(se));for(M=0,q=i.length;M<q;++M)Q=i[M],se=Q.filter,x.forEach(ze=>{se(ze)&&O[nn(ze)]>0&&Le(ze,Q.field,Q.value)}),m.modifies(Q.field);if(f)m.mod=t.length||r.length?x.filter(ze=>O[nn(ze)]>0):x.slice();else for(Fe in T)m.mod.push(T[Fe]);return(s||s==null&&(t.length||r.length))&&m.clean(!0),m}}}const di="_:mod:_";function Yr(){Object.defineProperty(this,di,{writable:!0,value:{}})}Yr.prototype={set(e,t,n,r){const i=this,s=i[e],f=i[di];return t!=null&&t>=0?(s[t]!==n||r)&&(s[t]=n,f[t+":"+e]=-1,f[e]=-1):(s!==n||r)&&(i[e]=n,f[e]=Object(xe.B)(n)?1+n.length:-1),i},modified(e,t){const n=this[di];if(!arguments.length){for(const r in n)if(n[r])return!0;return!1}if(Object(xe.B)(e)){for(let r=0;r<e.length;++r)if(n[e[r]])return!0;return!1}return t!=null&&t>=0?t+1<n[e]||!!n[t+":"+e]:!!n[e]},clear(){return this[di]={},this}};let Xr=0;const fi=new Yr;function ai(e,t,n,r){this.id=++Xr,this.value=e,this.stamp=-1,this.rank=-1,this.qrank=-1,this.flags=0,t&&(this._update=t),n&&this.parameters(n,r)}function Oa(e){return function(t){const n=this.flags;return arguments.length===0?!!(n&e):(this.flags=t?n|e:n&~e,this)}}ai.prototype={targets(){return this._targets||(this._targets=Cr(xe.x))},set(e){return this.value!==e?(this.value=e,1):0},skip:Oa(1),modified:Oa(2),parameters(e,t,n){t=t!==!1;const r=this._argval=this._argval||new Yr,i=this._argops=this._argops||[],s=[];let f,m,x,O;const T=(M,q,Q)=>{Q instanceof ai?(Q!==this&&(t&&Q.targets().add(this),s.push(Q)),i.push({op:Q,name:M,index:q})):r.set(M,q,Q)};for(f in e)if(m=e[f],f==="pulse")Object(xe.i)(m).forEach(M=>{M instanceof ai?M!==this&&(M.targets().add(this),s.push(M)):Object(xe.o)("Pulse parameters must be operator instances.")}),this.source=m;else if(Object(xe.B)(m))for(r.set(f,-1,Array(x=m.length)),O=0;O<x;++O)T(f,O,m[O]);else T(f,-1,m);return this.marshall().clear(),n&&(i.initonly=!0),s},marshall(e){const t=this._argval||fi,n=this._argops;let r,i,s,f;if(n){const m=n.length;for(i=0;i<m;++i)f=(s=(r=n[i]).op).modified()&&s.stamp===e,t.set(r.name,r.index,s.value,f);if(n.initonly){for(i=0;i<m;++i)(r=n[i]).op.targets().remove(this);this._argops=null,this._update=null}}return t},detach(){const e=this._argops;let t,n,r;if(e)for(t=0,n=e.length;t<n;++t)(r=e[t].op)._targets&&r._targets.remove(this);this.pulse=null,this.source=null},evaluate(e){const t=this._update;if(t){const n=this.marshall(e.stamp),r=t.call(this,n,e);if(n.clear(),r!==this.value)this.value=r;else if(!this.modified())return e.StopPropagation}},run(e){if(e.stamp<this.stamp)return e.StopPropagation;let t;return this.skip()?(this.skip(!1),t=0):t=this.evaluate(e),this.pulse=t||e}};let Wi=0;function Ci(e,t,n){this.id=++Wi,this.value=null,n&&(this.receive=n),e&&(this._filter=e),t&&(this._apply=t)}function yt(e,t,n){return new Ci(e,t,n)}Ci.prototype={_filter:xe.Ia,_apply:xe.y,targets(){return this._targets||(this._targets=Cr(xe.x))},consume(e){return arguments.length?(this._consume=!!e,this):!!this._consume},receive(e){if(this._filter(e)){const t=this.value=this._apply(e),n=this._targets,r=n?n.length:0;for(let i=0;i<r;++i)n[i].receive(t);this._consume&&(e.preventDefault(),e.stopPropagation())}},filter(e){const t=yt(e);return this.targets().add(t),t},apply(e){const t=yt(null,e);return this.targets().add(t),t},merge(){const e=yt();this.targets().add(e);for(let t=0,n=arguments.length;t<n;++t)arguments[t].targets().add(e);return e},throttle(e){let t=-1;return this.filter(()=>{const n=Date.now();return n-t>e?(t=n,1):0})},debounce(e){const t=yt();return this.targets().add(yt(null,null,Object(xe.n)(e,n=>{const r=n.dataflow;t.receive(n),r&&r.run&&r.run()}))),t},between(e,t){let n=!1;return e.targets().add(yt(null,null,()=>n=!0)),t.targets().add(yt(null,null,()=>n=!1)),this.filter(()=>n)},detach(){this._filter=xe.Ia,this._targets=null}};const Lr={skip:!0};function jt(e,t,n,r,i,s){const f=Object(xe.p)({},s,Lr);let m,x;Object(xe.E)(n)||(n=Object(xe.m)(n)),r===void 0?m=O=>e.touch(n(O)):Object(xe.E)(r)?(x=new ai(null,r,i,!1),m=O=>{x.evaluate(O);const T=n(O),M=x.value;ni(M)?e.pulse(T,M,s):e.update(T,M,f)}):m=O=>e.update(n(O),r,f),t.apply(m)}function ge(e,t,n,r,i,s){if(r===void 0)t.targets().add(n);else{const f=s||{},m=new ai(null,function(x,O){return O=Object(xe.E)(O)?O:Object(xe.m)(O),x?function(T,M){const q=O(T,M);return x.skip()||(x.skip(q!==this.value).value=q),q}:O}(n,r),i,!1);m.modified(f.force),m.rank=t.rank,t.targets().add(m),n&&(m.skip(!0),m.value=n.value,m.targets().add(n),e.connect(n,[m]))}}const fe={};function ye(e,t,n){this.dataflow=e,this.stamp=t??-1,this.add=[],this.rem=[],this.mod=[],this.fields=null,this.encode=n||null}function Se(e,t){const n=[];return Object(xe.Ka)(e,t,r=>n.push(r)),n}function Ze(e,t){const n={};return e.visit(t,r=>{n[nn(r)]=1}),r=>n[nn(r)]?null:r}function mt(e,t){return e?(n,r)=>e(n,r)&&t(n,r):t}function Rt(e,t,n,r){const i=this,s=n.length;let f=0;this.dataflow=e,this.stamp=t,this.fields=null,this.encode=r||null,this.pulses=n;for(let m=0;m<s;++m){const x=n[m];if(x.stamp===t){if(x.fields){const O=i.fields||(i.fields={});for(const T in x.fields)O[T]=1}x.changed(i.ADD)&&(f|=i.ADD),x.changed(i.REM)&&(f|=i.REM),x.changed(i.MOD)&&(f|=i.MOD)}}this.changes=f}function cn(e){return e.error("Dataflow already running. Use runAsync() to chain invocations."),e}ye.prototype={StopPropagation:fe,ADD:1,REM:2,MOD:4,ADD_REM:3,ADD_MOD:5,ALL:7,REFLOW:8,SOURCE:16,NO_SOURCE:32,NO_FIELDS:64,fork(e){return new ye(this.dataflow).init(this,e)},clone(){const e=this.fork(7);return e.add=e.add.slice(),e.rem=e.rem.slice(),e.mod=e.mod.slice(),e.source&&(e.source=e.source.slice()),e.materialize(23)},addAll(){let e=this;return!e.source||e.add===e.rem||!e.rem.length&&e.source.length===e.add.length||((e=new ye(this.dataflow).init(this)).add=e.source,e.rem=[]),e},init(e,t){const n=this;return n.stamp=e.stamp,n.encode=e.encode,!e.fields||64&t||(n.fields=e.fields),1&t?(n.addF=e.addF,n.add=e.add):(n.addF=null,n.add=[]),2&t?(n.remF=e.remF,n.rem=e.rem):(n.remF=null,n.rem=[]),4&t?(n.modF=e.modF,n.mod=e.mod):(n.modF=null,n.mod=[]),32&t?(n.srcF=null,n.source=null):(n.srcF=e.srcF,n.source=e.source,e.cleans&&(n.cleans=e.cleans)),n},runAfter(e){this.dataflow.runAfter(e)},changed(e){const t=e||7;return 1&t&&this.add.length||2&t&&this.rem.length||4&t&&this.mod.length},reflow(e){if(e)return this.fork(7).reflow();const t=this.add.length,n=this.source&&this.source.length;return n&&n!==t&&(this.mod=this.source,t&&this.filter(4,Ze(this,1))),this},clean(e){return arguments.length?(this.cleans=!!e,this):this.cleans},modifies(e){const t=this.fields||(this.fields={});return Object(xe.B)(e)?e.forEach(n=>t[n]=!0):t[e]=!0,this},modified(e,t){const n=this.fields;return!(!t&&!this.mod.length||!n)&&(arguments.length?Object(xe.B)(e)?e.some(r=>n[r]):n[e]:!!n)},filter(e,t){const n=this;return 1&e&&(n.addF=mt(n.addF,t)),2&e&&(n.remF=mt(n.remF,t)),4&e&&(n.modF=mt(n.modF,t)),16&e&&(n.srcF=mt(n.srcF,t)),n},materialize(e){const t=this;return 1&(e=e||7)&&t.addF&&(t.add=Se(t.add,t.addF),t.addF=null),2&e&&t.remF&&(t.rem=Se(t.rem,t.remF),t.remF=null),4&e&&t.modF&&(t.mod=Se(t.mod,t.modF),t.modF=null),16&e&&t.srcF&&(t.source=t.source.filter(t.srcF),t.srcF=null),t},visit(e,t){const n=this,r=t;if(16&e)return Object(xe.Ka)(n.source,n.srcF,r),n;1&e&&Object(xe.Ka)(n.add,n.addF,r),2&e&&Object(xe.Ka)(n.rem,n.remF,r),4&e&&Object(xe.Ka)(n.mod,n.modF,r);const i=n.source;if(8&e&&i){const s=n.add.length+n.mod.length;s===i.length||(s?Object(xe.Ka)(i,Ze(n,5),r):Object(xe.Ka)(i,n.srcF,r))}return n}},Object(xe.z)(Rt,ye,{fork(e){const t=new ye(this.dataflow).init(this,e&this.NO_FIELDS);return e!==void 0&&(e&t.ADD&&this.visit(t.ADD,n=>t.add.push(n)),e&t.REM&&this.visit(t.REM,n=>t.rem.push(n)),e&t.MOD&&this.visit(t.MOD,n=>t.mod.push(n))),t},changed(e){return this.changes&e},modified(e){const t=this,n=t.fields;return n&&t.changes&t.MOD?Object(xe.B)(e)?e.some(r=>n[r]):n[e]:0},filter(){Object(xe.o)("MultiPulse does not support filtering.")},materialize(){Object(xe.o)("MultiPulse does not support materialization.")},visit(e,t){const n=this,r=n.pulses,i=r.length;let s=0;if(e&n.SOURCE)for(;s<i;++s)r[s].visit(e,t);else for(;s<i;++s)r[s].stamp===n.stamp&&r[s].visit(e,t);return n}});const Jn={skip:!1,force:!1};function An(e){let t=[];return{clear:()=>t=[],size:()=>t.length,peek:()=>t[0],push:n=>(t.push(n),Ln(t,0,t.length-1,e)),pop:()=>{const n=t.pop();let r;return t.length?(r=t[0],t[0]=n,function(i,s,f){const m=s,x=i.length,O=i[s];let T,M=1+(s<<1);for(;M<x;)(T=M+1)<x&&f(i[M],i[T])>=0&&(M=T),i[s]=i[M],M=1+((s=M)<<1);i[s]=O,Ln(i,m,s,f)}(t,0,e)):r=n,r}}}function Ln(e,t,n,r){let i,s;const f=e[n];for(;n>t&&r(f,i=e[s=n-1>>1])<0;)e[n]=i,n=s;return e[n]=f}function Hn(){this.logger(Object(xe.M)()),this.logLevel(xe.b),this._clock=0,this._rank=0,this._locale=Object(br.a)();try{this._loader=Object(Xn.e)()}catch{}this._touched=Cr(xe.x),this._input={},this._pulse=null,this._heap=An((e,t)=>e.qrank-t.qrank),this._postrun=[]}function It(e){return function(){return this._log[e].apply(this,arguments)}}function Ot(e,t){ai.call(this,e,null,t)}Hn.prototype={stamp(){return this._clock},loader(e){return arguments.length?(this._loader=e,this):this._loader},locale(e){return arguments.length?(this._locale=e,this):this._locale},logger(e){return arguments.length?(this._log=e,this):this._log},error:It("error"),warn:It("warn"),info:It("info"),debug:It("debug"),logLevel:It("level"),cleanThreshold:1e4,add:function(e,t,n,r){let i,s=1;return e instanceof ai?i=e:e&&e.prototype instanceof ai?i=new e:Object(xe.E)(e)?i=new ai(null,e):(s=0,i=new ai(e,t)),this.rank(i),s&&(r=n,n=t),n&&this.connect(i,i.parameters(n,r)),this.touch(i),i},connect:function(e,t){const n=e.rank,r=t.length;for(let i=0;i<r;++i)if(n<t[i].rank)return void this.rerank(e)},rank:function(e){e.rank=++this._rank},rerank:function(e){const t=[e];let n,r,i;for(;t.length;)if(this.rank(n=t.pop()),r=n._targets)for(i=r.length;--i>=0;)t.push(n=r[i]),n===e&&Object(xe.o)("Cycle detected in dataflow graph.")},pulse:function(e,t,n){this.touch(e,n||Jn);const r=new ye(this,this._clock+(this._pulse?0:1)),i=e.pulse&&e.pulse.source||[];return r.target=e,this._input[e.id]=t.pulse(r,i),this},touch:function(e,t){const n=t||Jn;return this._pulse?this._enqueue(e):this._touched.add(e),n.skip&&e.skip(!0),this},update:function(e,t,n){const r=n||Jn;return(e.set(t)||r.force)&&this.touch(e,r),this},changeset:Mr,ingest:function(e,t,n){return t=this.parse(t,n),this.pulse(e,this.changeset().insert(t))},parse:function(e,t){const n=this.locale();return Object(Xn.f)(e,t,n.timeParse,n.utcParse)},preload:async function(e,t,n){const r=this,i=r._pending||function(f){let m;const x=new Promise(O=>m=O);return x.requests=0,x.done=()=>{--x.requests==0&&(f._pending=null,m(f))},f._pending=x}(r);i.requests+=1;const s=await r.request(t,n);return r.pulse(e,r.changeset().remove(xe.Ia).insert(s.data||[])),i.done(),s},request:async function(e,t){const n=this;let r,i=0;try{r=await n.loader().load(e,{context:"dataflow",response:Object(Xn.g)(t&&t.type)});try{r=n.parse(r,t)}catch(s){i=-2,n.warn("Data ingestion failed",e,s)}}catch(s){i=-1,n.warn("Loading failed",e,s)}return{data:r,status:i}},events:function(e,t,n,r){const i=this,s=yt(n,r),f=function(O){O.dataflow=i;try{s.receive(O)}catch(T){i.error(T)}finally{i.run()}};let m;const x=(m=typeof e=="string"&&typeof document<"u"?document.querySelectorAll(e):Object(xe.i)(e)).length;for(let O=0;O<x;++O)m[O].addEventListener(t,f);return s},on:function(e,t,n,r,i){return(e instanceof ai?ge:jt)(this,e,t,n,r,i),this},evaluate:async function(e,t,n){const r=this,i=[];if(r._pulse)return cn(r);if(r._pending&&await r._pending,t&&await dr(r,t),!r._touched.length)return r.debug("Dataflow invoked, but nothing to do."),r;const s=++r._clock;r._pulse=new ye(r,s,e),r._touched.forEach(T=>r._enqueue(T,!0)),r._touched=Cr(xe.x);let f,m,x,O=0;try{for(;r._heap.size()>0;)(f=r._heap.pop()).rank===f.qrank?((m=f.run(r._getPulse(f,e))).then?m=await m:m.async&&(i.push(m.async),m=fe),m!==fe&&f._targets&&f._targets.forEach(T=>r._enqueue(T)),++O):r._enqueue(f,!0)}catch(T){r._heap.clear(),x=T}if(r._input={},r._pulse=null,r.debug(`Pulse ${s}: ${O} operators`),x&&(r._postrun=[],r.error(x)),r._postrun.length){const T=r._postrun.sort((M,q)=>q.priority-M.priority);r._postrun=[];for(let M=0;M<T.length;++M)await dr(r,T[M].callback)}return n&&await dr(r,n),i.length&&Promise.all(i).then(T=>r.runAsync(null,()=>{T.forEach(M=>{try{M(r)}catch(q){r.error(q)}})})),r},run:function(e,t,n){return this._pulse?cn(this):(this.evaluate(e,t,n),this)},runAsync:async function(e,t,n){for(;this._running;)await this._running;const r=()=>this._running=null;return(this._running=this.evaluate(e,t,n)).then(r,r),this._running},runAfter:function(e,t,n){if(this._pulse||t)this._postrun.push({priority:n||0,callback:e});else try{e(this)}catch(r){this.error(r)}},_enqueue:function(e,t){const n=e.stamp<this._clock;n&&(e.stamp=this._clock),(n||t)&&(e.qrank=e.rank,this._heap.push(e))},_getPulse:function(e,t){const n=e.source,r=this._clock;return n&&Object(xe.B)(n)?new Rt(this,r,n.map(i=>i.pulse),t):this._input[e.id]||function(i,s){return s&&s.stamp===i.stamp?s:(i=i.fork(),s&&s!==fe&&(i.source=s.source),i)}(this._pulse,n&&n.pulse)}},Object(xe.z)(Ot,ai,{run(e){if(e.stamp<this.stamp)return e.StopPropagation;let t;return this.skip()?this.skip(!1):t=this.evaluate(e),(t=t||e).then?t=t.then(n=>this.pulse=n):t!==e.StopPropagation&&(this.pulse=t),t},evaluate(e){const t=this.marshall(e.stamp),n=this.transform(t,e);return t.clear(),n},transform(){}});const pn={};function qt(e){const t=Ve(e);return t&&t.Definition||null}function Ve(e){return e=e&&e.toLowerCase(),Object(xe.w)(pn,e)?pn[e]:null}var jn=o(87);function $n(e,t){let n;if(t===void 0)for(const r of e)r!=null&&(n<r||n===void 0&&r>=r)&&(n=r);else{let r=-1;for(let i of e)(i=t(i,++r,e))!=null&&(n<i||n===void 0&&i>=i)&&(n=i)}return n}function Zn(e,t){let n;if(t===void 0)for(const r of e)r!=null&&(n>r||n===void 0&&r>=r)&&(n=r);else{let r=-1;for(let i of e)(i=t(i,++r,e))!=null&&(n>i||n===void 0&&i>=i)&&(n=i)}return n}function ir(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}var zr=function(e){return e===null?NaN:+e};function vr(e,t,n){if(r=(e=Float64Array.from(function*(m,x){if(x===void 0)for(let O of m)O!=null&&(O=+O)>=O&&(yield O);else{let O=-1;for(let T of m)(T=x(T,++O,m))!=null&&(T=+T)>=T&&(yield T)}}(e,n))).length){if((t=+t)<=0||r<2)return Zn(e);if(t>=1)return $n(e);var r,i=(r-1)*t,s=Math.floor(i),f=$n(function m(x,O,T=0,M=x.length-1,q=jn.a){for(;M>T;){if(M-T>600){const Fe=M-T+1,Le=O-T+1,ze=Math.log(Fe),nt=.5*Math.exp(2*ze/3),it=.5*Math.sqrt(ze*nt*(Fe-nt)/Fe)*(Le-Fe/2<0?-1:1);m(x,O,Math.max(T,Math.floor(O-Le*nt/Fe+it)),Math.min(M,Math.floor(O+(Fe-Le)*nt/Fe+it)),q)}const Q=x[O];let se=T,le=M;for(ir(x,T,O),q(x[M],Q)>0&&ir(x,T,M);se<le;){for(ir(x,se,le),++se,--le;q(x[se],Q)<0;)++se;for(;q(x[le],Q)>0;)--le}q(x[T],Q)===0?ir(x,T,le):ir(x,++le,M),le<=O&&(T=le+1),O<=le&&(M=le-1)}return x}(e,s).subarray(0,s+1));return f+(Zn(e.subarray(s+1))-f)*(i-s)}}function pi(e,t,n=zr){if(r=e.length){if((t=+t)<=0||r<2)return+n(e[0],0,e);if(t>=1)return+n(e[r-1],r-1,e);var r,i=(r-1)*t,s=Math.floor(i),f=+n(e[s],s,e);return f+(+n(e[s+1],s+1,e)-f)*(i-s)}}var la=function(e,t){return vr(e,.5,t)};function*ui(e,t){if(t==null)for(let n of e)n!=null&&n!==""&&(n=+n)>=n&&(yield n);else{let n=-1;for(let r of e)(r=t(r,++n,e))!=null&&r!==""&&(r=+r)>=r&&(yield r)}}function Qi(e,t,n){const r=Float64Array.from(ui(e,n));return r.sort(jn.a),t.map(i=>pi(r,i))}function Di(e,t){return Qi(e,[.25,.5,.75],t)}function qr(e,t){const n=e.length,r=function(f,m){const x=function(O,T){let M,q=0,Q=0,se=0;if(T===void 0)for(let le of O)le!=null&&(le=+le)>=le&&(se+=(M=le-Q)*(le-(Q+=M/++q)));else{let le=-1;for(let Fe of O)(Fe=T(Fe,++le,O))!=null&&(Fe=+Fe)>=Fe&&(se+=(M=Fe-Q)*(Fe-(Q+=M/++q)))}if(q>1)return se/(q-1)}(f,m);return x&&Math.sqrt(x)}(e,t),i=Di(e,t),s=(i[2]-i[0])/1.34;return 1.06*(Math.min(r,s)||r||Math.abs(i[0])||1)*Math.pow(n,-.2)}function jr(e){const t=e.maxbins||20,n=e.base||10,r=Math.log(n),i=e.divide||[5,2];let s,f,m,x,O,T,M=e.extent[0],q=e.extent[1];const Q=e.span||q-M||Math.abs(M)||1;if(e.step)s=e.step;else if(e.steps){for(x=Q/t,O=0,T=e.steps.length;O<T&&e.steps[O]<x;++O);s=e.steps[Math.max(0,O-1)]}else{for(f=Math.ceil(Math.log(t)/r),m=e.minstep||0,s=Math.max(m,Math.pow(n,Math.round(Math.log(Q)/r)-f));Math.ceil(Q/s)>t;)s*=n;for(O=0,T=i.length;O<T;++O)(x=s/i[O])>=m&&Q/x<=t&&(s=x)}const se=(x=Math.log(s))>=0?0:1+~~(-x/r),le=Math.pow(n,-se-1);return(e.nice||e.nice===void 0)&&(M=M<(x=Math.floor(M/s+le)*s)?x-s:x,q=Math.ceil(q/s)*s),{start:M,stop:q===M?M+s:q,step:s}}var Bn=Math.random;function ri(e){Bn=e}function Vi(e,t,n,r){if(!e.length)return[void 0,void 0];const i=Float64Array.from(ui(e,r)),s=i.length,f=t;let m,x,O,T;for(O=0,T=Array(f);O<f;++O){for(m=0,x=0;x<s;++x)m+=i[~~(Bn()*s)];T[O]=m/s}return T.sort(jn.a),[vr(T,n/2),vr(T,1-n/2)]}function Fr(e,t,n,r){r=r||(q=>q);const i=e.length,s=new Float64Array(i);let f,m=0,x=1,O=r(e[0]),T=O,M=O+t;for(;x<i;++x){if((f=r(e[x]))>=M){for(T=(O+T)/2;m<x;++m)s[m]=T;M=f+t,O=f}T=f}for(T=(O+T)/2;m<x;++m)s[m]=T;return n?function(q,Q){const se=q.length;let le,Fe,Le=0,ze=1;for(;q[Le]===q[ze];)++ze;for(;ze<se;){for(le=ze+1;q[ze]===q[le];)++le;if(q[ze]-q[ze-1]<Q){for(Fe=ze+(Le+le-ze-ze>>1);Fe<ze;)q[Fe++]=q[ze];for(;Fe>ze;)q[Fe--]=q[Le]}Le=ze,ze=le}return q}(s,t+t/4):s}function aa(e){return function(){return(e=(1103515245*e+12345)%2147483647)/2147483647}}function ma(e,t){let n,r,i;t==null&&(t=e,e=0);const s={min(f){return arguments.length?(i=r-(n=f||0),s):n},max(f){return arguments.length?(i=(r=f||0)-n,s):r},sample:()=>n+Math.floor(i*Bn()),pdf:f=>f===Math.floor(f)&&f>=n&&f<r?1/i:0,cdf(f){const m=Math.floor(f);return m<n?0:m>=r?1:(m-n+1)/i},icdf:f=>f>=0&&f<=1?n-1+Math.floor(f*i):NaN};return s.min(e).max(t)}const Zi=Math.sqrt(2*Math.PI),ga=Math.SQRT2;let No=NaN;function vs(e,t){e=e||0,t=t??1;let n,r,i=0,s=0;if(No==No)i=No,No=NaN;else{do n=(i=2*Bn()-1)*i+(s=2*Bn()-1)*s;while(n===0||n>1);i*=r=Math.sqrt(-2*Math.log(n)/n),No=s*r}return e+i*t}function Eh(e,t,n){n=n??1;const r=(e-(t||0))/n;return Math.exp(-.5*r*r)/(n*Zi)}function qi(e,t,n){const r=(e-(t=t||0))/(n=n??1),i=Math.abs(r);let s;if(i>37)s=0;else{const f=Math.exp(-i*i/2);i<7.07106781186547?(s=f*((((((.0352624965998911*i+.700383064443688)*i+6.37396220353165)*i+33.912866078383)*i+112.079291497871)*i+221.213596169931)*i+220.206867912376),s/=((((((.0883883476483184*i+1.75566716318264)*i+16.064177579207)*i+86.7807322029461)*i+296.564248779674)*i+637.333633378831)*i+793.826512519948)*i+440.413735824752):s=f/(i+1/(i+2/(i+3/(i+4/(i+.65)))))/2.506628274631}return r>0?1-s:s}function ec(e,t,n){return e<0||e>1?NaN:(t||0)+(n??1)*ga*function(r){let i,s=-Math.log((1-r)*(1+r));return s<6.25?i=1.6536545626831027+(i=.24015818242558962+(i=(i=(i=.00018673420803405714+(i=(i=(i=42347877827932404e-23+(i=(i=(i=10512122733215323e-25+(i=(i=(i=26335093153082323e-28+(i=(i=(i=6637638134358324e-30+(i=20972767875968562e-33+(i=(i=11157877678025181e-33+(i=128584807152564e-32+(i=(i=-364441206401782e-35)*(s-=3.125)-16850591381820166e-35)*s)*s)*s-1333171662854621e-31)*s)*s)*s-4054566272975207e-29)*s-8151934197605472e-29)*s)*s-12975133253453532e-27)*s-5415412054294628e-26)*s)*s-4112633980346984e-24)*s-29070369957882005e-24)*s)*s-13654692000834679e-22)*s-13882523362786469e-21)*s)*s-.000740702534166267)*s-.006033670871430149)*s)*s:s<16?(s=Math.sqrt(s)-3.25,i=3.0838856104922208+(i=1.0052589676941592+(i=.005370914553590064+(i=(i=.002491442096107851+(i=(i=.0009532893797373805+(i=(i=24031110387097894e-21+(i=6828485145957318e-20+(i=(i=12475304481671779e-21+(i=29234449089955446e-22+(i=(i=15027403968909828e-22+(i=18239629214389228e-24+(i=(i=9075656193888539e-23+(i=22137376921775787e-25)*s)*s-27517406297064545e-23)*s)*s)*s-4013867526981546e-21)*s)*s)*s-47318229009055734e-21)*s)*s)*s-.0003550375203628475)*s)*s-.0016882755560235047)*s)*s-.003751208507569241)*s)*s)*s):Number.isFinite(s)?(s=Math.sqrt(s)-5,i=4.849906401408584+(i=1.0103004648645344+(i=(i=(i=7599527703001776e-20+(i=(i=4526062597223154e-21+(i=(i=22900482228026655e-23+(i=(i=2914795345090108e-23+(i=(i=761570120807834e-23+(i=(i=15076572693500548e-25+(i=(i=-27109920616438573e-27)*s-2555641816996525e-25)*s)*s-3789465440126737e-24)*s)*s-1496002662714924e-23)*s)*s-6771199775845234e-23)*s)*s-99298272942317e-20)*s)*s-1968177810553167e-20)*s)*s-.00021503011930044477)*s-.00013871931833623122)*s)*s):i=1/0,i*r}(2*e-1)}function bu(e,t){let n,r;const i={mean(s){return arguments.length?(n=s||0,i):n},stdev(s){return arguments.length?(r=s??1,i):r},sample:()=>vs(n,r),pdf:s=>Eh(s,n,r),cdf:s=>qi(s,n,r),icdf:s=>ec(s,n,r)};return i.mean(e).stdev(t)}function bc(e,t){const n=bu();let r=0;const i={data(s){return arguments.length?(e=s,r=s?s.length:0,i.bandwidth(t)):e},bandwidth(s){return arguments.length?(!(t=s)&&e&&(t=qr(e)),i):t},sample:()=>e[~~(Bn()*r)]+t*n.sample(),pdf(s){let f=0,m=0;for(;m<r;++m)f+=n.pdf((s-e[m])/t);return f/t/r},cdf(s){let f=0,m=0;for(;m<r;++m)f+=n.cdf((s-e[m])/t);return f/r},icdf(){throw Error("KDE icdf not supported.")}};return i.data(e)}function Bu(e,t){return e=e||0,t=t??1,Math.exp(e+vs()*t)}function xc(e,t,n){if(e<=0)return 0;t=t||0,n=n??1;const r=(Math.log(e)-t)/n;return Math.exp(-.5*r*r)/(n*Zi*e)}function Dd(e,t,n){return qi(Math.log(e),t,n)}function os(e,t,n){return Math.exp(ec(e,t,n))}function vf(e,t){let n,r;const i={mean(s){return arguments.length?(n=s||0,i):n},stdev(s){return arguments.length?(r=s??1,i):r},sample:()=>Bu(n,r),pdf:s=>xc(s,n,r),cdf:s=>Dd(s,n,r),icdf:s=>os(s,n,r)};return i.mean(e).stdev(t)}function Td(e,t){let n,r=0;const i={weights(s){return arguments.length?(n=function(f){const m=[];let x,O=0;for(x=0;x<r;++x)O+=m[x]=f[x]==null?1:+f[x];for(x=0;x<r;++x)m[x]/=O;return m}(t=s||[]),i):t},distributions(s){return arguments.length?(s?(r=s.length,e=s):(r=0,e=[]),i.weights(t)):e},sample(){const s=Bn();let f=e[r-1],m=n[0],x=0;for(;x<r-1;m+=n[++x])if(s<m){f=e[x];break}return f.sample()},pdf(s){let f=0,m=0;for(;m<r;++m)f+=n[m]*e[m].pdf(s);return f},cdf(s){let f=0,m=0;for(;m<r;++m)f+=n[m]*e[m].cdf(s);return f},icdf(){throw Error("Mixture icdf not supported.")}};return i.distributions(e).weights(t)}function Pu(e,t){return t==null&&(t=e??1,e=0),e+(t-e)*Bn()}function yf(e,t,n){return n==null&&(n=t??1,t=0),e>=t&&e<=n?1/(n-t):0}function Ch(e,t,n){return n==null&&(n=t??1,t=0),e<t?0:e>n?1:(e-t)/(n-t)}function wc(e,t,n){return n==null&&(n=t??1,t=0),e>=0&&e<=1?t+e*(n-t):NaN}function El(e,t){let n,r;const i={min(s){return arguments.length?(n=s||0,i):n},max(s){return arguments.length?(r=s??1,i):r},sample:()=>Pu(n,r),pdf:s=>yf(s,n,r),cdf:s=>Ch(s,n,r),icdf:s=>wc(s,n,r)};return t==null&&(t=e??1,e=0),i.min(e).max(t)}function Io(e,t,n,r){const i=r-e*e,s=Math.abs(i)<1e-24?0:(n-e*t)/i;return[t-s*e,s]}function Vc(e,t,n,r){e=e.filter(Q=>{let se=t(Q),le=n(Q);return se!=null&&(se=+se)>=se&&le!=null&&(le=+le)>=le}),r&&e.sort((Q,se)=>t(Q)-t(se));const i=e.length,s=new Float64Array(i),f=new Float64Array(i);let m,x,O,T=0,M=0,q=0;for(O of e)s[T]=m=+t(O),f[T]=x=+n(O),M+=(m-M)/++T,q+=(x-q)/T;for(T=0;T<i;++T)s[T]-=M,f[T]-=q;return[s,f,M,q]}function so(e,t,n,r){let i,s,f=-1;for(const m of e)i=t(m),s=n(m),i!=null&&(i=+i)>=i&&s!=null&&(s=+s)>=s&&r(i,s,++f)}function tc(e,t,n,r,i){let s=0,f=0;return so(e,t,n,(m,x)=>{const O=x-i(m),T=x-r;s+=O*O,f+=T*T}),1-s/f}function ss(e,t,n){let r=0,i=0,s=0,f=0,m=0;so(e,t,n,(T,M)=>{r+=(T-r)/++m,i+=(M-i)/m,s+=(T*M-s)/m,f+=(T*T-f)/m});const x=Io(r,i,s,f),O=T=>x[0]+x[1]*T;return{coef:x,predict:O,rSquared:tc(e,t,n,i,O)}}function Eo(e,t,n){let r=0,i=0,s=0,f=0,m=0;so(e,t,n,(T,M)=>{++m,T=Math.log(T),r+=(T-r)/m,i+=(M-i)/m,s+=(T*M-s)/m,f+=(T*T-f)/m});const x=Io(r,i,s,f),O=T=>x[0]+x[1]*Math.log(T);return{coef:x,predict:O,rSquared:tc(e,t,n,i,O)}}function nc(e,t,n){const[r,i,s,f]=Vc(e,t,n);let m,x,O,T=0,M=0,q=0,Q=0,se=0;so(e,t,n,(ze,nt)=>{m=r[se++],x=Math.log(nt),T+=(nt*x-T)/se,M+=((O=m*nt)-M)/se,q+=(O*x-q)/se,Q+=(m*O-Q)/se});const[le,Fe]=Io(M/f,T/f,q/f,Q/f),Le=ze=>Math.exp(le+Fe*(ze-s));return{coef:[Math.exp(le-Fe*s),Fe],predict:Le,rSquared:tc(e,t,n,f,Le)}}function Cl(e,t,n){let r=0,i=0,s=0,f=0,m=0,x=0;so(e,t,n,(M,q)=>{const Q=Math.log(M),se=Math.log(q);r+=(Q-r)/++x,i+=(se-i)/x,s+=(Q*se-s)/x,f+=(Q*Q-f)/x,m+=(q-m)/x});const O=Io(r,i,s,f),T=M=>O[0]*Math.pow(M,O[1]);return O[0]=Math.exp(O[0]),{coef:O,predict:T,rSquared:tc(e,t,n,m,T)}}function rc(e,t,n){const[r,i,s,f]=Vc(e,t,n),m=r.length;let x,O,T,M,q=0,Q=0,se=0,le=0,Fe=0;for(x=0;x<m;)O=r[x],T=i[x++],q+=((M=O*O)-q)/x,Q+=(M*O-Q)/x,se+=(M*M-se)/x,le+=(O*T-le)/x,Fe+=(M*T-Fe)/x;const Le=se-q*q,ze=q*Le-Q*Q,nt=(Fe*q-le*Q)/ze,it=(le*Le-Fe*Q)/ze,ut=-nt*q,st=pt=>nt*(pt-=s)*pt+it*pt+ut+f;return{coef:[ut-it*s+nt*s*s+f,it-2*nt*s,nt],predict:st,rSquared:tc(e,t,n,f,st)}}function su(e,t,n,r){if(r===1)return ss(e,t,n);if(r===2)return rc(e,t,n);const[i,s,f,m]=Vc(e,t,n),x=i.length,O=[],T=[],M=r+1;let q,Q,se,le,Fe;for(q=0;q<M;++q){for(se=0,le=0;se<x;++se)le+=Math.pow(i[se],q)*s[se];for(O.push(le),Fe=new Float64Array(M),Q=0;Q<M;++Q){for(se=0,le=0;se<x;++se)le+=Math.pow(i[se],q+Q);Fe[Q]=le}T.push(Fe)}T.push(O);const Le=function(nt){const it=nt.length-1,ut=[];let st,pt,dt,Qt,mn;for(st=0;st<it;++st){for(Qt=st,pt=st+1;pt<it;++pt)Math.abs(nt[st][pt])>Math.abs(nt[st][Qt])&&(Qt=pt);for(dt=st;dt<it+1;++dt)mn=nt[dt][st],nt[dt][st]=nt[dt][Qt],nt[dt][Qt]=mn;for(pt=st+1;pt<it;++pt)for(dt=it;dt>=st;dt--)nt[dt][pt]-=nt[dt][st]*nt[st][pt]/nt[st][st]}for(pt=it-1;pt>=0;--pt){for(mn=0,dt=pt+1;dt<it;++dt)mn+=nt[dt][pt]*ut[dt];ut[pt]=(nt[it][pt]-mn)/nt[pt][pt]}return ut}(T),ze=nt=>{nt-=f;let it=m+Le[0]+Le[1]*nt+Le[2]*nt*nt;for(q=3;q<M;++q)it+=Le[q]*Math.pow(nt,q);return it};return{coef:function(nt,it,ut,st){const pt=Array(nt);let dt,Qt,mn,on;for(dt=0;dt<nt;++dt)pt[dt]=0;for(dt=nt-1;dt>=0;--dt)for(mn=it[dt],on=1,pt[dt]+=mn,Qt=1;Qt<=dt;++Qt)on*=(dt+1-Qt)/Qt,pt[dt-Qt]+=mn*Math.pow(ut,Qt)*on;return pt[0]+=st,pt}(M,Le,-f,m),predict:ze,rSquared:tc(e,t,n,m,ze)}}const Oh=2,bf=1e-12;function xf(e,t,n,r){const[i,s,f,m]=Vc(e,t,n,!0),x=i.length,O=Math.max(2,~~(r*x)),T=new Float64Array(x),M=new Float64Array(x),q=new Float64Array(x).fill(1);for(let Q=-1;++Q<=Oh;){const se=[0,O-1];for(let Fe=0;Fe<x;++Fe){const Le=i[Fe],ze=se[0],nt=se[1],it=Le-i[ze]>i[nt]-Le?ze:nt;let ut=0,st=0,pt=0,dt=0,Qt=0;const mn=1/Math.abs(i[it]-Le||1);for(let Fn=ze;Fn<=nt;++Fn){const zn=i[Fn],Vn=s[Fn],Qn=lo(Math.abs(Le-zn)*mn)*q[Fn],pr=zn*Qn;ut+=Qn,st+=pr,pt+=Vn*Qn,dt+=Vn*pr,Qt+=zn*pr}const[on,Rn]=Io(st/ut,pt/ut,dt/ut,Qt/ut);T[Fe]=on+Rn*Le,M[Fe]=Math.abs(s[Fe]-T[Fe]),Ah(i,Fe+1,se)}if(Q===Oh)break;const le=la(M);if(Math.abs(le)<bf)break;for(let Fe,Le,ze=0;ze<x;++ze)Fe=M[ze]/(6*le),q[ze]=Fe>=1?bf:(Le=1-Fe*Fe)*Le}return function(Q,se,le,Fe){const Le=Q.length,ze=[];let nt,it=0,ut=0,st=[];for(;it<Le;++it)nt=Q[it]+le,st[0]===nt?st[1]+=(se[it]-st[1])/++ut:(ut=0,st[1]+=Fe,st=[nt,se[it]],ze.push(st));return st[1]+=Fe,ze}(i,T,f,m)}function lo(e){return(e=1-e*e*e)*e*e}function Ah(e,t,n){const r=e[t];let i=n[0],s=n[1]+1;if(!(s>=e.length))for(;t>i&&e[s]-r<=r-e[i];)n[0]=++i,n[1]=s,++s}const Nd=.5*Math.PI/180;function wf(e,t,n,r){n=n||25,r=Math.max(n,r||200);const i=le=>[le,e(le)],s=t[0],f=t[1],m=f-s,x=m/r,O=[i(s)],T=[];if(n===r){for(let le=1;le<r;++le)O.push(i(s+le/n*m));return O.push(i(f)),O}T.push(i(f));for(let le=n;--le>0;)T.push(i(s+le/n*m));let M=O[0],q=T[T.length-1];const Q=1/m,se=function(le,Fe){let Le=le,ze=le;const nt=Fe.length;for(let it=0;it<nt;++it){const ut=Fe[it][1];ut<Le&&(Le=ut),ut>ze&&(ze=ut)}return 1/(ze-Le)}(M[1],T);for(;q;){const le=i((M[0]+q[0])/2);le[0]-M[0]>=x&&kf(M,le,q,Q,se)>Nd?T.push(le):(M=q,O.push(q),T.pop()),q=T[T.length-1]}return O}function kf(e,t,n,r,i){const s=Math.atan2(i*(n[1]-e[1]),r*(n[0]-e[0])),f=Math.atan2(i*(t[1]-e[1]),r*(t[0]-e[0]));return Math.abs(s-f)}var ys=function(e,t,n){e=+e,t=+t,n=(i=arguments.length)<2?(t=e,e=0,1):i<3?1:+n;for(var r=-1,i=0|Math.max(0,Math.ceil((t-e)/n)),s=new Array(i);++r<i;)s[r]=e+r*n;return s},Ef=o(108),or=o(11);function xu(e){return e&&e.length?e.length===1?e[0]:function(t){return n=>{const r=t.length;let i=1,s=String(t[0](n));for(;i<r;++i)s+="|"+t[i](n);return s}}(e):function(){return""}}function Tp(e,t,n){return n||e+(t?"_"+t:"")}const Np=()=>{},Cf={init:Np,add:Np,rem:Np,idx:0},Ol={values:{init:e=>e.cell.store=!0,value:e=>e.cell.data.values(),idx:-1},count:{value:e=>e.cell.num},__count__:{value:e=>e.missing+e.valid},missing:{value:e=>e.missing},valid:{value:e=>e.valid},sum:{init:e=>e.sum=0,value:e=>e.sum,add:(e,t)=>e.sum+=+t,rem:(e,t)=>e.sum-=t},product:{init:e=>e.product=1,value:e=>e.valid?e.product:void 0,add:(e,t)=>e.product*=t,rem:(e,t)=>e.product/=t},mean:{init:e=>e.mean=0,value:e=>e.valid?e.mean:void 0,add:(e,t)=>(e.mean_d=t-e.mean,e.mean+=e.mean_d/e.valid),rem:(e,t)=>(e.mean_d=t-e.mean,e.mean-=e.valid?e.mean_d/e.valid:e.mean)},average:{value:e=>e.valid?e.mean:void 0,req:["mean"],idx:1},variance:{init:e=>e.dev=0,value:e=>e.valid>1?e.dev/(e.valid-1):void 0,add:(e,t)=>e.dev+=e.mean_d*(t-e.mean),rem:(e,t)=>e.dev-=e.mean_d*(t-e.mean),req:["mean"],idx:1},variancep:{value:e=>e.valid>1?e.dev/e.valid:void 0,req:["variance"],idx:2},stdev:{value:e=>e.valid>1?Math.sqrt(e.dev/(e.valid-1)):void 0,req:["variance"],idx:2},stdevp:{value:e=>e.valid>1?Math.sqrt(e.dev/e.valid):void 0,req:["variance"],idx:2},stderr:{value:e=>e.valid>1?Math.sqrt(e.dev/(e.valid*(e.valid-1))):void 0,req:["variance"],idx:2},distinct:{value:e=>e.cell.data.distinct(e.get),req:["values"],idx:3},ci0:{value:e=>e.cell.data.ci0(e.get),req:["values"],idx:3},ci1:{value:e=>e.cell.data.ci1(e.get),req:["values"],idx:3},median:{value:e=>e.cell.data.q2(e.get),req:["values"],idx:3},q1:{value:e=>e.cell.data.q1(e.get),req:["values"],idx:3},q3:{value:e=>e.cell.data.q3(e.get),req:["values"],idx:3},min:{init:e=>e.min=void 0,value:e=>e.min=Number.isNaN(e.min)?e.cell.data.min(e.get):e.min,add:(e,t)=>{(t<e.min||e.min===void 0)&&(e.min=t)},rem:(e,t)=>{t<=e.min&&(e.min=NaN)},req:["values"],idx:4},max:{init:e=>e.max=void 0,value:e=>e.max=Number.isNaN(e.max)?e.cell.data.max(e.get):e.max,add:(e,t)=>{(t>e.max||e.max===void 0)&&(e.max=t)},rem:(e,t)=>{t>=e.max&&(e.max=NaN)},req:["values"],idx:4},argmin:{init:e=>e.argmin=void 0,value:e=>e.argmin||e.cell.data.argmin(e.get),add:(e,t,n)=>{t<e.min&&(e.argmin=n)},rem:(e,t)=>{t<=e.min&&(e.argmin=void 0)},req:["min","values"],idx:3},argmax:{init:e=>e.argmax=void 0,value:e=>e.argmax||e.cell.data.argmax(e.get),add:(e,t,n)=>{t>e.max&&(e.argmax=n)},rem:(e,t)=>{t>=e.max&&(e.argmax=void 0)},req:["max","values"],idx:3}},Id=Object.keys(Ol);function _h(e,t){return Ol[e](t)}function Sh(e,t){return e.idx-t.idx}function Fi(){this.valid=0,this.missing=0,this._ops.forEach(e=>e.init(this))}function Na(e,t){e!=null&&e!==""?e==e&&(++this.valid,this._ops.forEach(n=>n.add(this,e,t))):++this.missing}function Dh(e,t){e!=null&&e!==""?e==e&&(--this.valid,this._ops.forEach(n=>n.rem(this,e,t))):--this.missing}function bm(e){return this._out.forEach(t=>e[t.out]=t.value(this)),e}function Of(e,t){const n=t||xe.y,r=function(f){const m={};f.forEach(O=>m[O.name]=O);const x=O=>{O.req&&O.req.forEach(T=>{m[T]||x(m[T]=Ol[T]())})};return f.forEach(x),Object.values(m).sort(Sh)}(e),i=e.slice().sort(Sh);function s(f){this._ops=r,this._out=i,this.cell=f,this.init()}return s.prototype.init=Fi,s.prototype.add=Na,s.prototype.rem=Dh,s.prototype.set=bm,s.prototype.get=n,s.fields=e.map(f=>f.out),s}function Fd(e){this._key=e?Object(xe.u)(e):nn,this.reset()}Id.forEach(e=>{Ol[e]=function(t,n){return r=>Object(xe.p)({name:t,out:r||t},Cf,n)}(e,Ol[e])});const bs=Fd.prototype;function ic(e){Ot.call(this,null,e),this._adds=[],this._mods=[],this._alen=0,this._mlen=0,this._drop=!0,this._cross=!1,this._dims=[],this._dnames=[],this._measures=[],this._countOnly=!1,this._counts=null,this._prev=null,this._inputs=null,this._outputs=null}bs.reset=function(){this._add=[],this._rem=[],this._ext=null,this._get=null,this._q=null},bs.add=function(e){this._add.push(e)},bs.rem=function(e){this._rem.push(e)},bs.values=function(){if(this._get=null,this._rem.length===0)return this._add;const e=this._add,t=this._rem,n=this._key,r=e.length,i=t.length,s=Array(r-i),f={};let m,x,O;for(m=0;m<i;++m)f[n(t[m])]=1;for(m=0,x=0;m<r;++m)f[n(O=e[m])]?f[n(O)]=0:s[x++]=O;return this._rem=[],this._add=s},bs.distinct=function(e){const t=this.values(),n={};let r,i=t.length,s=0;for(;--i>=0;)r=e(t[i])+"",Object(xe.w)(n,r)||(n[r]=1,++s);return s},bs.extent=function(e){if(this._get!==e||!this._ext){const t=this.values(),n=Object(xe.r)(t,e);this._ext=[t[n[0]],t[n[1]]],this._get=e}return this._ext},bs.argmin=function(e){return this.extent(e)[0]||{}},bs.argmax=function(e){return this.extent(e)[1]||{}},bs.min=function(e){const t=this.extent(e)[0];return t!=null?e(t):void 0},bs.max=function(e){const t=this.extent(e)[1];return t!=null?e(t):void 0},bs.quartile=function(e){return this._get===e&&this._q||(this._q=Di(this.values(),e),this._get=e),this._q},bs.q1=function(e){return this.quartile(e)[0]},bs.q2=function(e){return this.quartile(e)[1]},bs.q3=function(e){return this.quartile(e)[2]},bs.ci=function(e){return this._get===e&&this._ci||(this._ci=Vi(this.values(),1e3,.05,e),this._get=e),this._ci},bs.ci0=function(e){return this.ci(e)[0]},bs.ci1=function(e){return this.ci(e)[1]},ic.Definition={type:"Aggregate",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:Id},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"drop",type:"boolean",default:!0},{name:"cross",type:"boolean",default:!1},{name:"key",type:"field"}]},Object(xe.z)(ic,Ot,{transform(e,t){const n=this,r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=e.modified();return n.stamp=r.stamp,n.value&&(i||t.modified(n._inputs,!0))?(n._prev=n.value,n.value=i?n.init(e):{},t.visit(t.SOURCE,s=>n.add(s))):(n.value=n.value||n.init(e),t.visit(t.REM,s=>n.rem(s)),t.visit(t.ADD,s=>n.add(s))),r.modifies(n._outputs),n._drop=e.drop!==!1,e.cross&&n._dims.length>1&&(n._drop=!1,n.cross()),t.clean()&&n._drop&&r.clean(!0).runAfter(()=>this.clean()),n.changes(r)},cross(){const e=this,t=e.value,n=e._dnames,r=n.map(()=>({})),i=n.length;function s(f){let m,x,O,T;for(m in f)for(O=f[m].tuple,x=0;x<i;++x)r[x][T=O[n[x]]]=T}s(e._prev),s(t),function f(m,x,O){const T=n[O],M=r[O++];for(const q in M){const Q=m?m+"|"+q:q;x[T]=M[q],O<i?f(Q,x,O):t[Q]||e.cell(Q,x)}}("",{},0)},init(e){const t=this._inputs=[],n=this._outputs=[],r={};function i(Fe){const Le=Object(xe.i)(Object(xe.g)(Fe)),ze=Le.length;let nt,it=0;for(;it<ze;++it)r[nt=Le[it]]||(r[nt]=1,t.push(nt))}this._dims=Object(xe.i)(e.groupby),this._dnames=this._dims.map(Fe=>{const Le=Object(xe.h)(Fe);return i(Fe),n.push(Le),Le}),this.cellkey=e.key?e.key:xu(this._dims),this._countOnly=!0,this._counts=[],this._measures=[];const s=e.fields||[null],f=e.ops||["count"],m=e.as||[],x=s.length,O={};let T,M,q,Q,se,le;for(x!==f.length&&Object(xe.o)("Unmatched number of fields and aggregate ops."),le=0;le<x;++le)T=s[le],M=f[le],T==null&&M!=="count"&&Object(xe.o)("Null aggregate field specified."),se=Tp(M,Q=Object(xe.h)(T),m[le]),n.push(se),M!=="count"?((q=O[Q])||(i(T),(q=O[Q]=[]).field=T,this._measures.push(q)),M!=="count"&&(this._countOnly=!1),q.push(_h(M,se))):this._counts.push(se);return this._measures=this._measures.map(Fe=>Of(Fe,Fe.field)),{}},cellkey:xu(),cell(e,t){let n=this.value[e];return n?n.num===0&&this._drop&&n.stamp<this.stamp?(n.stamp=this.stamp,this._adds[this._alen++]=n):n.stamp<this.stamp&&(n.stamp=this.stamp,this._mods[this._mlen++]=n):(n=this.value[e]=this.newcell(e,t),this._adds[this._alen++]=n),n},newcell(e,t){const n={key:e,num:0,agg:null,tuple:this.newtuple(t,this._prev&&this._prev[e]),stamp:this.stamp,store:!1};if(!this._countOnly){const r=this._measures,i=r.length;n.agg=Array(i);for(let s=0;s<i;++s)n.agg[s]=new r[s](n)}return n.store&&(n.data=new Fd),n},newtuple(e,t){const n=this._dnames,r=this._dims,i=r.length,s={};for(let f=0;f<i;++f)s[n[f]]=r[f](e);return t?gr(t.tuple,s):Dn(s)},clean(){const e=this.value;for(const t in e)e[t].num===0&&delete e[t]},add(e){const t=this.cellkey(e),n=this.cell(t,e);if(n.num+=1,this._countOnly)return;n.store&&n.data.add(e);const r=n.agg;for(let i=0,s=r.length;i<s;++i)r[i].add(r[i].get(e),e)},rem(e){const t=this.cellkey(e),n=this.cell(t,e);if(n.num-=1,this._countOnly)return;n.store&&n.data.rem(e);const r=n.agg;for(let i=0,s=r.length;i<s;++i)r[i].rem(r[i].get(e),e)},celltuple(e){const t=e.tuple,n=this._counts;e.store&&e.data.values();for(let r=0,i=n.length;r<i;++r)t[n[r]]=e.num;if(!this._countOnly){const r=e.agg;for(let i=0,s=r.length;i<s;++i)r[i].set(t)}return t},changes(e){const t=this._adds,n=this._mods,r=this._prev,i=this._drop,s=e.add,f=e.rem,m=e.mod;let x,O,T,M;if(r)for(O in r)x=r[O],i&&!x.num||f.push(x.tuple);for(T=0,M=this._alen;T<M;++T)s.push(this.celltuple(t[T])),t[T]=null;for(T=0,M=this._mlen;T<M;++T)((x=n[T]).num===0&&i?f:m).push(this.celltuple(x)),n[T]=null;return this._alen=this._mlen=0,this._prev=null,e}});function Rd(e){Ot.call(this,null,e)}function Ip(e,t,n){const r=e;let i=t||[],s=n||[],f={},m=0;return{add:x=>s.push(x),remove:x=>f[r(x)]=++m,size:()=>i.length,data:(x,O)=>(m&&(i=i.filter(T=>!f[r(T)]),f={},m=0),O&&x&&i.sort(x),s.length&&(i=x?Object(xe.O)(x,i,s.sort(x)):i.concat(s),s=[]),i)}}function Fp(e){Ot.call(this,[],e)}function xm(e){ai.call(this,null,wm,e)}function wm(e){return this.value&&!e.modified()?this.value:Object(xe.l)(e.fields,e.orders)}function qc(e){Ot.call(this,null,e)}function zo(e){Ot.call(this,null,e)}Rd.Definition={type:"Bin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"anchor",type:"number"},{name:"maxbins",type:"number",default:20},{name:"base",type:"number",default:10},{name:"divide",type:"number",array:!0,default:[5,2]},{name:"extent",type:"number",array:!0,length:2,required:!0},{name:"span",type:"number"},{name:"step",type:"number"},{name:"steps",type:"number",array:!0},{name:"minstep",type:"number",default:0},{name:"nice",type:"boolean",default:!0},{name:"name",type:"string"},{name:"as",type:"string",array:!0,length:2,default:["bin0","bin1"]}]},Object(xe.z)(Rd,Ot,{transform(e,t){const n=e.interval!==!1,r=this._bins(e),i=r.start,s=r.step,f=e.as||["bin0","bin1"],m=f[0],x=f[1];let O;return O=e.modified()?(t=t.reflow(!0)).SOURCE:t.modified(Object(xe.g)(e.field))?t.ADD_MOD:t.ADD,t.visit(O,n?T=>{const M=r(T);T[m]=M,T[x]=M==null?null:i+s*(1+(M-i)/s)}:T=>T[m]=r(T)),t.modifies(n?f:m)},_bins(e){if(this.value&&!e.modified())return this.value;const t=e.field,n=jr(e),r=n.step;let i,s,f=n.start,m=f+Math.ceil((n.stop-f)/r)*r;(i=e.anchor)!=null&&(s=i-(f+r*Math.floor((i-f)/r)),f+=s,m+=s);const x=function(O){let T=Object(xe.Ea)(t(O));return T==null?null:T<f?-1/0:T>m?1/0:(T=Math.max(f,Math.min(T,m-r)),f+r*Math.floor(1e-14+(T-f)/r))};return x.start=f,x.stop=n.stop,x.step=r,this.value=Object(xe.f)(x,Object(xe.g)(t),e.name||"bin_"+Object(xe.h)(t))}}),Fp.Definition={type:"Collect",metadata:{source:!0},params:[{name:"sort",type:"compare"}]},Object(xe.z)(Fp,Ot,{transform(e,t){const n=t.fork(t.ALL),r=Ip(nn,this.value,n.materialize(n.ADD).add),i=e.sort,s=t.changed()||i&&(e.modified("sort")||t.modified(i.fields));return n.visit(n.REM,r.remove),this.modified(s),this.value=n.source=r.data(Qr(i),s),t.source&&t.source.root&&(this.value.root=t.source.root),n}}),Object(xe.z)(xm,ai),qc.Definition={type:"CountPattern",metadata:{generates:!0,changes:!0},params:[{name:"field",type:"field",required:!0},{name:"case",type:"enum",values:["upper","lower","mixed"],default:"mixed"},{name:"pattern",type:"string",default:'[\\w"]+'},{name:"stopwords",type:"string",default:""},{name:"as",type:"string",array:!0,length:2,default:["text","count"]}]},Object(xe.z)(qc,Ot,{transform(e,t){const n=M=>q=>{for(var Q,se=function(Le,ze,nt){switch(ze){case"upper":Le=Le.toUpperCase();break;case"lower":Le=Le.toLowerCase()}return Le.match(nt)}(m(q),e.case,s)||[],le=0,Fe=se.length;le<Fe;++le)f.test(Q=se[le])||M(Q)},r=this._parameterCheck(e,t),i=this._counts,s=this._match,f=this._stop,m=e.field,x=e.as||["text","count"],O=n(M=>i[M]=1+(i[M]||0)),T=n(M=>i[M]-=1);return r?t.visit(t.SOURCE,O):(t.visit(t.ADD,O),t.visit(t.REM,T)),this._finish(t,x)},_parameterCheck(e,t){let n=!1;return!e.modified("stopwords")&&this._stop||(this._stop=new RegExp("^"+(e.stopwords||"")+"$","i"),n=!0),!e.modified("pattern")&&this._match||(this._match=new RegExp(e.pattern||"[\\w']+","g"),n=!0),(e.modified("field")||t.modified(e.field.fields))&&(n=!0),n&&(this._counts={}),n},_finish(e,t){const n=this._counts,r=this._tuples||(this._tuples={}),i=t[0],s=t[1],f=e.fork(e.NO_SOURCE|e.NO_FIELDS);let m,x,O;for(m in n)x=r[m],O=n[m]||0,!x&&O?(r[m]=x=Dn({}),x[i]=m,x[s]=O,f.add.push(x)):O===0?(x&&f.rem.push(x),n[m]=null,r[m]=null):x[s]!==O&&(x[s]=O,f.mod.push(x));return f.modifies(t)}}),zo.Definition={type:"Cross",metadata:{generates:!0},params:[{name:"filter",type:"expr"},{name:"as",type:"string",array:!0,length:2,default:["a","b"]}]},Object(xe.z)(zo,Ot,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.as||["a","b"],i=r[0],s=r[1],f=!this.value||t.changed(t.ADD_REM)||e.modified("as")||e.modified("filter");let m=this.value;return f?(m&&(n.rem=m),m=t.materialize(t.SOURCE).source,n.add=this.value=function(x,O,T,M){for(var q,Q,se=[],le={},Fe=x.length,Le=0;Le<Fe;++Le)for(le[O]=Q=x[Le],q=0;q<Fe;++q)le[T]=x[q],M(le)&&(se.push(Dn(le)),(le={})[O]=Q);return se}(m,i,s,e.filter||xe.Ia)):n.mod=m,n.source=this.value,n.modifies(r)}});const Th={kde:bc,mixture:Td,normal:bu,lognormal:vf,uniform:El},Ke="distributions",Lu="function",Af="field";function Md(e){Ot.call(this,null,e)}const Aa=[{key:{function:"normal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"lognormal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"uniform"},params:[{name:"min",type:"number",default:0},{name:"max",type:"number",default:1}]},{key:{function:"kde"},params:[{name:"field",type:"field",required:!0},{name:"from",type:"data"},{name:"bandwidth",type:"number",default:0}]}],_a={key:{function:"mixture"},params:[{name:"distributions",type:"param",array:!0,params:Aa},{name:"weights",type:"number",array:!0}]};function Ga(e,t){return e?e.map((n,r)=>t[r]||Object(xe.h)(n)):null}function Co(e,t,n){const r=[],i=M=>M(x);let s,f,m,x,O,T;if(t==null)r.push(e.map(n));else for(s={},f=0,m=e.length;f<m;++f)x=e[f],(T=s[O=t.map(i)])||(s[O]=T=[],T.dims=O,r.push(T)),T.push(n(x));return r}Md.Definition={type:"Density",metadata:{generates:!0},params:[{name:"extent",type:"number",array:!0,length:2},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"method",type:"string",default:"pdf",values:["pdf","cdf"]},{name:"distribution",type:"param",params:Aa.concat(_a)},{name:"as",type:"string",array:!0,default:["value","density"]}]},Object(xe.z)(Md,Ot,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const r=function O(T,M){const q=T[Lu];Object(xe.w)(Th,q)||Object(xe.o)("Unknown distribution function: "+q);const Q=Th[q]();for(const se in T)se===Af?Q.data((T.from||M()).map(T[se])):se===Ke?Q[se](T[se].map(le=>O(le,M))):typeof Q[se]===Lu&&Q[se](T[se]);return Q}(e.distribution,function(O){return()=>O.materialize(O.SOURCE).source}(t)),i=e.steps||e.minsteps||25,s=e.steps||e.maxsteps||200;let f=e.method||"pdf";f!=="pdf"&&f!=="cdf"&&Object(xe.o)("Invalid density method: "+f),e.extent||r.data||Object(xe.o)("Missing density extent parameter."),f=r[f];const m=e.as||["value","density"],x=wf(f,e.extent||Object(xe.q)(r.data()),i,s).map(O=>{const T={};return T[m[0]]=O[0],T[m[1]]=O[1],Dn(T)});this.value&&(n.rem=this.value),this.value=n.add=n.source=x}return n}});function wu(e){Ot.call(this,null,e)}wu.Definition={type:"DotBin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"step",type:"number"},{name:"smooth",type:"boolean",default:!1},{name:"as",type:"string",default:"bin"}]};function Oo(e){ai.call(this,null,kc,e),this.modified(!0)}function kc(e){const t=e.expr;return this.value&&!e.modified("expr")?this.value:Object(xe.f)(n=>t(n,e),Object(xe.g)(t),Object(xe.h)(t))}function Zs(e){Ot.call(this,[void 0,void 0],e)}function xt(e,t){ai.call(this,e),this.parent=t,this.count=0}function fa(e){Ot.call(this,{},e),this._keys=Object(xe.t)();const t=this._targets=[];t.active=0,t.forEach=n=>{for(let r=0,i=t.active;r<i;++r)n(t[r],r,t)}}function uo(e){ai.call(this,null,Uo,e)}function Uo(e){return this.value&&!e.modified()?this.value:Object(xe.B)(e.name)?Object(xe.i)(e.name).map(t=>Object(xe.u)(t)):Object(xe.u)(e.name,e.as)}function wa(e){Ot.call(this,Object(xe.t)(),e)}function xs(e){Ot.call(this,[],e)}function fr(e){Ot.call(this,[],e)}function zs(e){Ot.call(this,null,e)}function eu(e){Ot.call(this,[],e)}Object(xe.z)(wu,Ot,{transform(e,t){if(this.value&&!e.modified()&&!t.changed())return t;const n=t.materialize(t.SOURCE).source,r=Co(t.source,e.groupby,xe.y),i=e.smooth||!1,s=e.field,f=e.step||((se,le)=>Object(xe.Z)(Object(xe.q)(se,le))/30)(n,s),m=Qr((se,le)=>s(se)-s(le)),x=e.as||"bin",O=r.length;let T,M=1/0,q=-1/0,Q=0;for(;Q<O;++Q){const se=r[Q].sort(m);T=-1;for(const le of Fr(se,f,i,s))le<M&&(M=le),le>q&&(q=le),se[++T][x]=le}return this.value={start:M,stop:q,step:f},t.reflow(!0).modifies(x)}}),Object(xe.z)(Oo,ai),Zs.Definition={type:"Extent",metadata:{},params:[{name:"field",type:"field",required:!0}]},Object(xe.z)(Zs,Ot,{transform(e,t){const n=this.value,r=e.field,i=t.changed()||t.modified(r.fields)||e.modified("field");let s=n[0],f=n[1];if((i||s==null)&&(s=1/0,f=-1/0),t.visit(i?t.SOURCE:t.ADD,m=>{const x=Object(xe.Ea)(r(m));x!=null&&(x<s&&(s=x),x>f&&(f=x))}),!Number.isFinite(s)||!Number.isFinite(f)){let m=Object(xe.h)(r);m&&(m=` for field "${m}"`),t.dataflow.warn(`Infinite extent${m}: [${s}, ${f}]`),s=f=void 0}this.value=[s,f]}}),Object(xe.z)(xt,ai,{connect(e){return this.detachSubflow=e.detachSubflow,this.targets().add(e),e.source=this},add(e){this.count+=1,this.value.add.push(e)},rem(e){this.count-=1,this.value.rem.push(e)},mod(e){this.value.mod.push(e)},init(e){this.value.init(e,e.NO_SOURCE)},evaluate(){return this.value}}),Object(xe.z)(fa,Ot,{activate(e){this._targets[this._targets.active++]=e},subflow(e,t,n,r){const i=this.value;let s,f,m=Object(xe.w)(i,e)&&i[e];return m?m.value.stamp<n.stamp&&(m.init(n),this.activate(m)):(f=r||(f=this._group[e])&&f.tuple,s=n.dataflow,m=new xt(n.fork(n.NO_SOURCE),this),s.add(m).connect(t(s,e,f)),i[e]=m,this.activate(m)),m},clean(){const e=this.value;let t=0;for(const n in e)if(e[n].count===0){const r=e[n].detachSubflow;r&&r(),delete e[n],++t}if(t){const n=this._targets.filter(r=>r&&r.count>0);this.initTargets(n)}},initTargets(e){const t=this._targets,n=t.length,r=e?e.length:0;let i=0;for(;i<r;++i)t[i]=e[i];for(;i<n&&t[i]!=null;++i)t[i]=null;t.active=r},transform(e,t){const n=t.dataflow,r=e.key,i=e.subflow,s=this._keys,f=e.modified("key"),m=x=>this.subflow(x,i,t);return this._group=e.group||{},this.initTargets(),t.visit(t.REM,x=>{const O=nn(x),T=s.get(O);T!==void 0&&(s.delete(O),m(T).rem(x))}),t.visit(t.ADD,x=>{const O=r(x);s.set(nn(x),O),m(O).add(x)}),f||t.modified(r.fields)?t.visit(t.MOD,x=>{const O=nn(x),T=s.get(O),M=r(x);T===M?m(M).mod(x):(s.set(O,M),m(T).rem(x),m(M).add(x))}):t.changed(t.MOD)&&t.visit(t.MOD,x=>{m(s.get(nn(x))).mod(x)}),f&&t.visit(t.REFLOW,x=>{const O=nn(x),T=s.get(O),M=r(x);T!==M&&(s.set(O,M),m(T).rem(x),m(M).add(x))}),t.clean()?n.runAfter(()=>{this.clean(),s.clean()}):s.empty>n.cleanThreshold&&n.runAfter(s.clean),t}}),Object(xe.z)(uo,ai),wa.Definition={type:"Filter",metadata:{changes:!0},params:[{name:"expr",type:"expr",required:!0}]},Object(xe.z)(wa,Ot,{transform(e,t){const n=t.dataflow,r=this.value,i=t.fork(),s=i.add,f=i.rem,m=i.mod,x=e.expr;let O=!0;function T(M){const q=nn(M),Q=x(M,e),se=r.get(q);Q&&se?(r.delete(q),s.push(M)):Q||se?O&&Q&&!se&&m.push(M):(r.set(q,1),f.push(M))}return t.visit(t.REM,M=>{const q=nn(M);r.has(q)?r.delete(q):f.push(M)}),t.visit(t.ADD,M=>{x(M,e)?s.push(M):r.set(nn(M),1)}),t.visit(t.MOD,T),e.modified()&&(O=!1,t.visit(t.REFLOW,T)),r.empty>n.cleanThreshold&&n.runAfter(r.clean),i}}),xs.Definition={type:"Flatten",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"index",type:"string"},{name:"as",type:"string",array:!0}]},Object(xe.z)(xs,Ot,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.fields,i=Ga(r,e.as||[]),s=e.index||null,f=i.length;return n.rem=this.value,t.visit(t.SOURCE,m=>{const x=r.map(se=>se(m)),O=x.reduce((se,le)=>Math.max(se,le.length),0);let T,M,q,Q=0;for(;Q<O;++Q){for(M=mr(m),T=0;T<f;++T)M[i[T]]=(q=x[T][Q])==null?null:q;s&&(M[s]=Q),n.add.push(M)}}),this.value=n.source=n.add,s&&n.modifies(s),n.modifies(i)}}),fr.Definition={type:"Fold",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0,length:2,default:["key","value"]}]},Object(xe.z)(fr,Ot,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.fields,i=r.map(xe.h),s=e.as||["key","value"],f=s[0],m=s[1],x=r.length;return n.rem=this.value,t.visit(t.SOURCE,O=>{for(let T,M=0;M<x;++M)(T=mr(O))[f]=i[M],T[m]=r[M](O),n.add.push(T)}),this.value=n.source=n.add,n.modifies(s)}}),zs.Definition={type:"Formula",metadata:{modifies:!0},params:[{name:"expr",type:"expr",required:!0},{name:"as",type:"string",required:!0},{name:"initonly",type:"boolean"}]},Object(xe.z)(zs,Ot,{transform(e,t){const n=e.expr,r=e.as,i=e.modified(),s=e.initonly?t.ADD:i?t.SOURCE:t.modified(n.fields)||t.modified(r)?t.ADD_MOD:t.ADD;return i&&(t=t.materialize().reflow(!0)),e.initonly||t.modifies(r),t.visit(s,f=>f[r]=n(f,e))}}),Object(xe.z)(eu,Ot,{transform(e,t){const n=t.fork(t.ALL),r=e.generator;let i,s,f,m=this.value,x=e.size-m.length;if(x>0){for(i=[];--x>=0;)i.push(f=Dn(r(e))),m.push(f);n.add=n.add.length?n.materialize(n.ADD).add.concat(i):i}else s=m.slice(0,-x),n.rem=n.rem.length?n.materialize(n.REM).rem.concat(s):s,m=m.slice(-x);return n.source=this.value=m,n}});const Hc={value:"value",median:la,mean:function(e,t){let n=0,r=0;if(t===void 0)for(let i of e)i!=null&&(i=+i)>=i&&(++n,r+=i);else{let i=-1;for(let s of e)(s=t(s,++i,e))!=null&&(s=+s)>=s&&(++n,r+=s)}if(n)return r/n},min:Zn,max:$n},Us=[];function Nh(e){Ot.call(this,[],e)}function jd(e){ic.call(this,e)}function Bd(e){Ot.call(this,null,e)}function uu(e){ai.call(this,null,Ki,e)}function Ki(e){return this.value&&!e.modified()?this.value:Object(xe.K)(e.fields,e.flat)}function ws(e){Ot.call(this,[],e),this._pending=null}function Ih(e,t,n){n.forEach(Dn);const r=t.fork(t.NO_FIELDS&t.NO_SOURCE);return r.rem=e.value,e.value=r.source=r.add=n,e._pending=null,r.rem.length&&r.clean(!0),r}function ac(e){Ot.call(this,{},e)}function us(e){ai.call(this,null,ii,e)}function ii(e){if(this.value&&!e.modified())return this.value;const t=e.extents,n=t.length;let r,i,s=1/0,f=-1/0;for(r=0;r<n;++r)(i=t[r])[0]<s&&(s=i[0]),i[1]>f&&(f=i[1]);return[s,f]}function Ba(e){ai.call(this,null,Fh,e)}function Fh(e){return this.value&&!e.modified()?this.value:e.values.reduce((t,n)=>t.concat(n),[])}function Pd(e){Ot.call(this,null,e)}function Al(e){ic.call(this,e)}function Rh(e){fa.call(this,e)}function Ri(e){Ot.call(this,null,e)}function bi(e){Ot.call(this,null,e)}function ro(e){Ot.call(this,null,e)}Nh.Definition={type:"Impute",metadata:{changes:!0},params:[{name:"field",type:"field",required:!0},{name:"key",type:"field",required:!0},{name:"keyvals",array:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"enum",default:"value",values:["value","mean","median","max","min"]},{name:"value",default:0}]},Object(xe.z)(Nh,Ot,{transform(e,t){var n,r,i,s,f,m,x,O,T,M,q=t.fork(t.ALL),Q=function(st){var pt,dt=st.method||Hc.value;if(Hc[dt]!=null)return dt===Hc.value?(pt=st.value!==void 0?st.value:0,()=>pt):Hc[dt];Object(xe.o)("Unrecognized imputation method: "+dt)}(e),se=function(st){const pt=st.field;return dt=>dt?pt(dt):NaN}(e),le=Object(xe.h)(e.field),Fe=Object(xe.h)(e.key),Le=(e.groupby||[]).map(xe.h),ze=function(st,pt,dt,Qt){var mn,on,Rn,Fn,zn,Vn,Qn,pr,Pr=Li=>Li(pr),Ar=[],Jr=Qt?Qt.slice():[],gi={},vi={};for(Jr.forEach((Li,wi)=>gi[Li]=wi+1),Fn=0,Qn=st.length;Fn<Qn;++Fn)pr=st[Fn],Vn=dt(pr),zn=gi[Vn]||(gi[Vn]=Jr.push(Vn)),on=(mn=pt?pt.map(Pr):Us)+"",(Rn=vi[on])||(Rn=vi[on]=[],Ar.push(Rn),Rn.values=mn),Rn[zn-1]=pr;return Ar.domain=Jr,Ar}(t.source,e.groupby,e.key,e.keyvals),nt=[],it=this.value,ut=ze.domain.length;for(f=0,O=ze.length;f<O;++f)for(i=(n=ze[f]).values,r=NaN,x=0;x<ut;++x)if(n[x]==null){for(s=ze.domain[x],M={_impute:!0},m=0,T=i.length;m<T;++m)M[Le[m]]=i[m];M[Fe]=s,M[le]=Number.isNaN(r)?r=Q(n,se):r,nt.push(Dn(M))}return nt.length&&(q.add=q.materialize(q.ADD).add.concat(nt)),it.length&&(q.rem=q.materialize(q.REM).rem.concat(it)),this.value=nt,q}}),jd.Definition={type:"JoinAggregate",metadata:{modifies:!0},params:[{name:"groupby",type:"field",array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"ops",type:"enum",array:!0,values:Id},{name:"as",type:"string",null:!0,array:!0},{name:"key",type:"field"}]},Object(xe.z)(jd,ic,{transform(e,t){const n=this,r=e.modified();let i;return n.value&&(r||t.modified(n._inputs,!0))?(i=n.value=r?n.init(e):{},t.visit(t.SOURCE,s=>n.add(s))):(i=n.value=n.value||this.init(e),t.visit(t.REM,s=>n.rem(s)),t.visit(t.ADD,s=>n.add(s))),n.changes(),t.visit(t.SOURCE,s=>{Object(xe.p)(s,i[n.cellkey(s)].tuple)}),t.reflow(r).modifies(this._outputs)},changes(){const e=this._adds,t=this._mods;let n,r;for(n=0,r=this._alen;n<r;++n)this.celltuple(e[n]),e[n]=null;for(n=0,r=this._mlen;n<r;++n)this.celltuple(t[n]),t[n]=null;this._alen=this._mlen=0}}),Bd.Definition={type:"KDE",metadata:{generates:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"cumulative",type:"boolean",default:!1},{name:"counts",type:"boolean",default:!1},{name:"bandwidth",type:"number",default:0},{name:"extent",type:"number",array:!0,length:2},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"as",type:"string",array:!0,default:["value","density"]}]},Object(xe.z)(Bd,Ot,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const r=t.materialize(t.SOURCE).source,i=Co(r,e.groupby,e.field),s=(e.groupby||[]).map(xe.h),f=e.bandwidth,m=e.cumulative?"cdf":"pdf",x=e.as||["value","density"],O=[];let T=e.extent,M=e.steps||e.minsteps||25,q=e.steps||e.maxsteps||200;m!=="pdf"&&m!=="cdf"&&Object(xe.o)("Invalid density method: "+m),e.resolve==="shared"&&(T||(T=Object(xe.q)(r,e.field)),M=q=e.steps||q),i.forEach(Q=>{const se=bc(Q,f)[m],le=e.counts?Q.length:1;wf(se,T||Object(xe.q)(Q),M,q).forEach(Fe=>{const Le={};for(let ze=0;ze<s.length;++ze)Le[s[ze]]=Q.dims[ze];Le[x[0]]=Fe[0],Le[x[1]]=Fe[1]*le,O.push(Dn(Le))})}),this.value&&(n.rem=this.value),this.value=n.add=n.source=O}return n}}),Object(xe.z)(uu,ai),Object(xe.z)(ws,Ot,{transform(e,t){const n=t.dataflow;return this._pending?Ih(this,t,this._pending):function(r){return r.modified("async")&&!(r.modified("values")||r.modified("url")||r.modified("format"))}(e)?t.StopPropagation:e.values?Ih(this,t,n.parse(e.values,e.format)):e.async?{async:n.request(e.url,e.format).then(r=>(this._pending=Object(xe.i)(r.data),i=>i.touch(this)))}:n.request(e.url,e.format).then(r=>Ih(this,t,Object(xe.i)(r.data)))}}),ac.Definition={type:"Lookup",metadata:{modifies:!0},params:[{name:"index",type:"index",params:[{name:"from",type:"data",required:!0},{name:"key",type:"field",required:!0}]},{name:"values",type:"field",array:!0},{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0},{name:"default",default:null}]},Object(xe.z)(ac,Ot,{transform(e,t){const n=e.fields,r=e.index,i=e.values,s=e.default==null?null:e.default,f=e.modified(),m=n.length;let x,O,T=f?t.SOURCE:t.ADD,M=t,q=e.as;return i?(O=i.length,m>1&&!q&&Object(xe.o)('Multi-field lookup requires explicit "as" parameter.'),q&&q.length!==m*O&&Object(xe.o)('The "as" parameter has too few output field names.'),q=q||i.map(xe.h),x=function(Q){for(var se,le,Fe=0,Le=0;Fe<m;++Fe)if((le=r.get(n[Fe](Q)))==null)for(se=0;se<O;++se,++Le)Q[q[Le]]=s;else for(se=0;se<O;++se,++Le)Q[q[Le]]=i[se](le)}):(q||Object(xe.o)("Missing output field names."),x=function(Q){for(var se,le=0;le<m;++le)se=r.get(n[le](Q)),Q[q[le]]=se??s}),f?M=t.reflow(!0):T|=n.some(Q=>t.modified(Q.fields))?t.MOD:0,t.visit(T,x),M.modifies(q)}}),Object(xe.z)(us,ai),Object(xe.z)(Ba,ai),Object(xe.z)(Pd,Ot,{transform(e,t){return this.modified(e.modified()),this.value=e,t.fork(t.NO_SOURCE|t.NO_FIELDS)}}),Al.Definition={type:"Pivot",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"value",type:"field",required:!0},{name:"op",type:"enum",values:Id,default:"sum"},{name:"limit",type:"number",default:0},{name:"key",type:"field"}]},Object(xe.z)(Al,ic,{_transform:ic.prototype.transform,transform(e,t){return this._transform(function(n,r){const i=n.field,s=n.value,f=(n.op==="count"?"__count__":n.op)||"sum",m=Object(xe.g)(i).concat(Object(xe.g)(s)),x=function(O,T,M){const q={},Q=[];return M.visit(M.SOURCE,se=>{const le=O(se);q[le]||(q[le]=1,Q.push(le))}),Q.sort(xe.j),T?Q.slice(0,T):Q}(i,n.limit||0,r);return r.changed()&&n.set("__pivot__",null,null,!0),{key:n.key,groupby:n.groupby,ops:x.map(()=>f),fields:x.map(O=>function(T,M,q,Q){return Object(xe.f)(se=>M(se)===T?q(se):NaN,Q,T+"")}(O,i,s,m)),as:x.map(O=>O+""),modified:n.modified.bind(n)}}(e,t),t)}}),Object(xe.z)(Rh,fa,{transform(e,t){const n=e.subflow,r=e.field,i=s=>this.subflow(nn(s),n,t,s);return(e.modified("field")||r&&t.modified(Object(xe.g)(r)))&&Object(xe.o)("PreFacet does not support field modification."),this.initTargets(),r?(t.visit(t.MOD,s=>{const f=i(s);r(s).forEach(m=>f.mod(m))}),t.visit(t.ADD,s=>{const f=i(s);r(s).forEach(m=>f.add(Dn(m)))}),t.visit(t.REM,s=>{const f=i(s);r(s).forEach(m=>f.rem(m))})):(t.visit(t.MOD,s=>i(s).mod(s)),t.visit(t.ADD,s=>i(s).add(s)),t.visit(t.REM,s=>i(s).rem(s))),t.clean()&&t.runAfter(()=>this.clean()),t}}),Ri.Definition={type:"Project",metadata:{generates:!0,changes:!0},params:[{name:"fields",type:"field",array:!0},{name:"as",type:"string",null:!0,array:!0}]},Object(xe.z)(Ri,Ot,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.fields,i=Ga(e.fields,e.as||[]),s=r?(m,x)=>function(O,T,M,q){for(let Q=0,se=M.length;Q<se;++Q)T[q[Q]]=M[Q](O);return T}(m,x,r,i):xr;let f;return this.value?f=this.value:(t=t.addAll(),f=this.value={}),t.visit(t.REM,m=>{const x=nn(m);n.rem.push(f[x]),f[x]=null}),t.visit(t.ADD,m=>{const x=s(m,Dn({}));f[nn(m)]=x,n.add.push(x)}),t.visit(t.MOD,m=>{n.mod.push(s(m,f[nn(m)]))}),n}}),Object(xe.z)(bi,Ot,{transform(e,t){return this.value=e.value,e.modified("value")?t.fork(t.NO_SOURCE|t.NO_FIELDS):t.StopPropagation}}),ro.Definition={type:"Quantile",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"probs",type:"number",array:!0},{name:"step",type:"number",default:.01},{name:"as",type:"string",array:!0,default:["prob","value"]}]};function Ld(e){Ot.call(this,null,e)}function zd(e){Ot.call(this,[],e),this.count=0}function Ud(e){Ot.call(this,null,e)}function Rp(e){Ot.call(this,null,e),this.modified(!0)}function zu(e){Ot.call(this,null,e)}Object(xe.z)(ro,Ot,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=e.as||["prob","value"];if(this.value&&!e.modified()&&!t.changed())return n.source=this.value,n;const i=Co(t.materialize(t.SOURCE).source,e.groupby,e.field),s=(e.groupby||[]).map(xe.h),f=[],m=e.step||.01,x=e.probs||ys(m/2,1-1e-14,m),O=x.length;return i.forEach(T=>{const M=Qi(T,x);for(let q=0;q<O;++q){const Q={};for(let se=0;se<s.length;++se)Q[s[se]]=T.dims[se];Q[r[0]]=x[q],Q[r[1]]=M[q],f.push(Dn(Q))}}),this.value&&(n.rem=this.value),this.value=n.add=n.source=f,n}}),Object(xe.z)(Ld,Ot,{transform(e,t){let n,r;return this.value?r=this.value:(n=t=t.addAll(),r=this.value={}),e.derive&&(n=t.fork(t.NO_SOURCE),t.visit(t.REM,i=>{const s=nn(i);n.rem.push(r[s]),r[s]=null}),t.visit(t.ADD,i=>{const s=mr(i);r[nn(i)]=s,n.add.push(s)}),t.visit(t.MOD,i=>{const s=r[nn(i)];for(const f in i)s[f]=i[f],n.modifies(f);n.mod.push(s)})),n}}),zd.Definition={type:"Sample",metadata:{},params:[{name:"size",type:"number",default:1e3}]},Object(xe.z)(zd,Ot,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.modified("size"),i=e.size,s=this.value.reduce((T,M)=>(T[nn(M)]=1,T),{});let f=this.value,m=this.count,x=0;function O(T){let M,q;f.length<i?f.push(T):(q=~~((m+1)*Bn()))<f.length&&q>=x&&(M=f[q],s[nn(M)]&&n.rem.push(M),f[q]=T),++m}if(t.rem.length&&(t.visit(t.REM,T=>{const M=nn(T);s[M]&&(s[M]=-1,n.rem.push(T)),--m}),f=f.filter(T=>s[nn(T)]!==-1)),(t.rem.length||r)&&f.length<i&&t.source&&(x=m=f.length,t.visit(t.SOURCE,T=>{s[nn(T)]||O(T)}),x=-1),r&&f.length>i){const T=f.length-i;for(let M=0;M<T;++M)s[nn(f[M])]=-1,n.rem.push(f[M]);f=f.slice(T)}return t.mod.length&&t.visit(t.MOD,T=>{s[nn(T)]&&n.mod.push(T)}),t.add.length&&t.visit(t.ADD,O),(t.add.length||x<0)&&(n.add=f.filter(T=>!s[nn(T)])),this.count=m,this.value=n.source=f,n}}),Ud.Definition={type:"Sequence",metadata:{generates:!0,changes:!0},params:[{name:"start",type:"number",required:!0},{name:"stop",type:"number",required:!0},{name:"step",type:"number",default:1},{name:"as",type:"string",default:"data"}]},Object(xe.z)(Ud,Ot,{transform(e,t){if(this.value&&!e.modified())return;const n=t.materialize().fork(t.MOD),r=e.as||"data";return n.rem=this.value?t.rem.concat(this.value):t.rem,this.value=ys(e.start,e.stop,e.step||1).map(i=>{const s={};return s[r]=i,Dn(s)}),n.add=t.add.concat(this.value),n}}),Object(xe.z)(Rp,Ot,{transform(e,t){return this.value=t.source,t.changed()?t.fork(t.NO_SOURCE|t.NO_FIELDS):t.StopPropagation}});const ks=["unit0","unit1"];function $c(e){Ot.call(this,Object(xe.t)(),e)}function Rs(e){Ot.call(this,null,e)}zu.Definition={type:"TimeUnit",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"units",type:"enum",values:or.j,array:!0},{name:"step",type:"number",default:1},{name:"maxbins",type:"number",default:40},{name:"extent",type:"date",array:!0},{name:"timezone",type:"enum",default:"local",values:["local","utc"]},{name:"as",type:"string",array:!0,length:2,default:ks}]},Object(xe.z)(zu,Ot,{transform(e,t){const n=e.field,r=e.interval!==!1,i=e.timezone==="utc",s=this._floor(e,t),f=(i?or.v:or.p)(s.unit).offset,m=e.as||ks,x=m[0],O=m[1],T=s.step;let M=s.start||1/0,q=s.stop||-1/0,Q=t.ADD;return(e.modified()||t.modified(Object(xe.g)(n)))&&(Q=(t=t.reflow(!0)).SOURCE,M=1/0,q=-1/0),t.visit(Q,se=>{const le=n(se);let Fe,Le;le==null?(se[x]=null,r&&(se[O]=null)):(se[x]=Fe=Le=s(le),r&&(se[O]=Le=f(Fe,T)),Fe<M&&(M=Fe),Le>q&&(q=Le))}),s.start=M,s.stop=q,t.modifies(r?m:x)},_floor(e,t){const n=e.timezone==="utc",{units:r,step:i}=e.units?{units:e.units,step:e.step||1}:Object(or.n)({extent:e.extent||Object(xe.q)(t.materialize(t.SOURCE).source,e.field),maxbins:e.maxbins}),s=Object(or.t)(r),f=this.value||{},m=(n?or.u:or.o)(s,i);return m.unit=Object(xe.W)(s),m.units=s,m.step=i,m.start=f.start,m.stop=f.stop,this.value=m}}),Object(xe.z)($c,Ot,{transform(e,t){const n=t.dataflow,r=e.field,i=this.value,s=m=>i.set(r(m),m);let f=!0;return e.modified("field")||t.modified(r.fields)?(i.clear(),t.visit(t.SOURCE,s)):t.changed()?(t.visit(t.REM,m=>i.delete(r(m))),t.visit(t.ADD,s)):f=!1,this.modified(f),i.empty>n.cleanThreshold&&n.runAfter(i.clean),t.fork()}}),Object(xe.z)(Rs,Ot,{transform(e,t){(!this.value||e.modified("field")||e.modified("sort")||t.changed()||e.sort&&t.modified(e.sort.fields))&&(this.value=(e.sort?t.source.slice().sort(Qr(e.sort)):t.source).map(e.field))}});const tu={row_number:function(){return{next:e=>e.index+1}},rank:function(){let e;return{init:()=>e=1,next:t=>{const n=t.index,r=t.data;return n&&t.compare(r[n-1],r[n])?e=n+1:e}}},dense_rank:function(){let e;return{init:()=>e=1,next:t=>{const n=t.index,r=t.data;return n&&t.compare(r[n-1],r[n])?++e:e}}},percent_rank:function(){const e=tu.rank(),t=e.next;return{init:e.init,next:n=>(t(n)-1)/(n.data.length-1)}},cume_dist:function(){let e;return{init:()=>e=0,next:t=>{const n=t.data,r=t.compare;let i=t.index;if(e<i){for(;i+1<n.length&&!r(n[i],n[i+1]);)++i;e=i}return(1+e)/n.length}}},ntile:function(e,t){(t=+t)>0||Object(xe.o)("ntile num must be greater than zero.");const n=tu.cume_dist(),r=n.next;return{init:n.init,next:i=>Math.ceil(t*r(i))}},lag:function(e,t){return t=+t||1,{next:n=>{const r=n.index-t;return r>=0?e(n.data[r]):null}}},lead:function(e,t){return t=+t||1,{next:n=>{const r=n.index+t,i=n.data;return r<i.length?e(i[r]):null}}},first_value:function(e){return{next:t=>e(t.data[t.i0])}},last_value:function(e){return{next:t=>e(t.data[t.i1-1])}},nth_value:function(e,t){return(t=+t)>0||Object(xe.o)("nth_value nth must be greater than zero."),{next:n=>{const r=n.i0+(t-1);return r<n.i1?e(n.data[r]):null}}},prev_value:function(e){let t;return{init:()=>t=null,next:n=>{const r=e(n.data[n.index]);return r!=null?t=r:t}}},next_value:function(e){let t,n;return{init:()=>(t=null,n=-1),next:r=>{const i=r.data;return r.index<=n?t:(n=function(s,f,m){for(let x=f.length;m<x;++m)if(s(f[m])!=null)return m;return-1}(e,i,r.index))<0?(n=i.length,t=null):t=e(i[n])}}}},Mh=Object.keys(tu);function Ni(e){const t=Object(xe.i)(e.ops),n=Object(xe.i)(e.fields),r=Object(xe.i)(e.params),i=Object(xe.i)(e.as),s=this.outputs=[],f=this.windows=[],m={},x={},O=[],T=[];let M=!0;function q(Q){Object(xe.i)(Object(xe.g)(Q)).forEach(se=>m[se]=1)}q(e.sort),t.forEach((Q,se)=>{const le=n[se],Fe=Object(xe.h)(le),Le=Tp(Q,Fe,i[se]);if(q(le),s.push(Le),Object(xe.w)(tu,Q))f.push(function(ze,nt,it,ut){const st=tu[ze](nt,it);return{init:st.init||xe.Ma,update:function(pt,dt){dt[ut]=st.next(pt)}}}(Q,n[se],r[se],Le));else{if(le==null&&Q!=="count"&&Object(xe.o)("Null aggregate field specified."),Q==="count")return void O.push(Le);M=!1;let ze=x[Fe];ze||((ze=x[Fe]=[]).field=le,T.push(ze)),ze.push(_h(Q,Le))}}),(O.length||T.length)&&(this.cell=function(Q,se,le){Q=Q.map(ut=>Of(ut,ut.field));const Fe={num:0,agg:null,store:!1,count:se};if(!le)for(var Le=Q.length,ze=Fe.agg=Array(Le),nt=0;nt<Le;++nt)ze[nt]=new Q[nt](Fe);if(Fe.store)var it=Fe.data=new Fd;return Fe.add=function(ut){if(Fe.num+=1,!le){it&&it.add(ut);for(let st=0;st<Le;++st)ze[st].add(ze[st].get(ut),ut)}},Fe.rem=function(ut){if(Fe.num-=1,!le){it&&it.rem(ut);for(let st=0;st<Le;++st)ze[st].rem(ze[st].get(ut),ut)}},Fe.set=function(ut){let st,pt;for(it&&it.values(),st=0,pt=se.length;st<pt;++st)ut[se[st]]=Fe.num;if(!le)for(st=0,pt=ze.length;st<pt;++st)ze[st].set(ut)},Fe.init=function(){Fe.num=0,it&&it.reset();for(let ut=0;ut<Le;++ut)ze[ut].init()},Fe}(T,O,M)),this.inputs=Object.keys(m)}const _f=Ni.prototype;function Gc(e){Ot.call(this,{},e),this._mlen=0,this._mods=[]}function _l(e,t,n,r){const i=r.sort,s=i&&!r.ignorePeers,f=r.frame||[null,0],m=e.data(n),x=m.length,O=s?Object(Ef.a)(i):null,T={i0:0,i1:0,p0:0,p1:0,index:0,data:m,compare:i||Object(xe.m)(-1)};t.init();for(let M=0;M<x;++M)Wd(T,f,M,x),s&&Mp(T,O),t.update(T,m[M])}function Wd(e,t,n,r){e.p0=e.i0,e.p1=e.i1,e.i0=t[0]==null?0:Math.max(0,n-Math.abs(t[0])),e.i1=t[1]==null?r:Math.min(r,n+Math.abs(t[1])+1),e.index=n}function Mp(e,t){const n=e.i0,r=e.i1-1,i=e.compare,s=e.data,f=s.length-1;n>0&&!i(s[n],s[n-1])&&(e.i0=t.left(s,s[n])),r<f&&!i(s[r],s[r+1])&&(e.i1=t.right(s,s[r]))}function Sl(e,t,n){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+n)/6)}function jh(e){this._context=e}_f.init=function(){this.windows.forEach(e=>e.init()),this.cell&&this.cell.init()},_f.update=function(e,t){const n=this.cell,r=this.windows,i=e.data,s=r&&r.length;let f;if(n){for(f=e.p0;f<e.i0;++f)n.rem(i[f]);for(f=e.p1;f<e.i1;++f)n.add(i[f]);n.set(t)}for(f=0;f<s;++f)r[f].update(e,t)},Gc.Definition={type:"Window",metadata:{modifies:!0},params:[{name:"sort",type:"compare"},{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:Mh.concat(Id)},{name:"params",type:"number",null:!0,array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"frame",type:"number",null:!0,array:!0,length:2,default:[null,0]},{name:"ignorePeers",type:"boolean",default:!1}]},Object(xe.z)(Gc,Ot,{transform(e,t){this.stamp=t.stamp;const n=e.modified(),r=Qr(e.sort),i=xu(e.groupby),s=m=>this.group(i(m));let f=this.state;f&&!n||(f=this.state=new Ni(e)),n||t.modified(f.inputs)?(this.value={},t.visit(t.SOURCE,m=>s(m).add(m))):(t.visit(t.REM,m=>s(m).remove(m)),t.visit(t.ADD,m=>s(m).add(m)));for(let m=0,x=this._mlen;m<x;++m)_l(this._mods[m],f,r,e);return this._mlen=0,this._mods=[],t.reflow(n).modifies(f.outputs)},group(e){let t=this.value[e];return t||((t=this.value[e]=Ip(nn)).stamp=-1),t.stamp<this.stamp&&(t.stamp=this.stamp,this._mods[this._mlen++]=t),t}}),jh.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:Sl(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1)}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:Sl(this,e,t)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};var Pa=function(){};function Bh(e){this._context=e}Bh.prototype={areaStart:Pa,areaEnd:Pa,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x2,this._y2),this._context.closePath();break;case 2:this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break;case 3:this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4)}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x2=e,this._y2=t;break;case 1:this._point=2,this._x3=e,this._y3=t;break;case 2:this._point=3,this._x4=e,this._y4=t,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+t)/6);break;default:Sl(this,e,t)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function Dl(e){this._context=e}Dl.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var n=(this._x0+4*this._x1+e)/6,r=(this._y0+4*this._y1+t)/6;this._line?this._context.lineTo(n,r):this._context.moveTo(n,r);break;case 3:this._point=4;default:Sl(this,e,t)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function Ph(e,t){this._basis=new jh(e),this._beta=t}Ph.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var e=this._x,t=this._y,n=e.length-1;if(n>0)for(var r,i=e[0],s=t[0],f=e[n]-i,m=t[n]-s,x=-1;++x<=n;)r=x/n,this._basis.point(this._beta*e[x]+(1-this._beta)*(i+r*f),this._beta*t[x]+(1-this._beta)*(s+r*m));this._x=this._y=null,this._basis.lineEnd()},point:function(e,t){this._x.push(+e),this._y.push(+t)}};var Tl=function e(t){function n(r){return t===1?new jh(r):new Ph(r,t)}return n.beta=function(r){return e(+r)},n}(.85);function Kc(e,t,n){e._context.bezierCurveTo(e._x1+e._k*(e._x2-e._x0),e._y1+e._k*(e._y2-e._y0),e._x2+e._k*(e._x1-t),e._y2+e._k*(e._y1-n),e._x2,e._y2)}function Ec(e,t){this._context=e,this._k=(1-t)/6}Ec.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:Kc(this,this._x1,this._y1)}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2,this._x1=e,this._y1=t;break;case 2:this._point=3;default:Kc(this,e,t)}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var Lh=function e(t){function n(r){return new Ec(r,t)}return n.tension=function(r){return e(+r)},n}(0);function Sf(e,t){this._context=e,this._k=(1-t)/6}Sf.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:Kc(this,e,t)}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var Nl=function e(t){function n(r){return new Sf(r,t)}return n.tension=function(r){return e(+r)},n}(0);function Cc(e,t){this._context=e,this._k=(1-t)/6}Cc.prototype={areaStart:Pa,areaEnd:Pa,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:Kc(this,e,t)}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var km=function e(t){function n(r){return new Cc(r,t)}return n.tension=function(r){return e(+r)},n}(0),Il=Math.abs,eo=Math.atan2,Ao=Math.cos,Fo=Math.max,Mi=Math.min,Es=Math.sin,Oc=Math.sqrt,Ro=1e-12,Ac=Math.PI,Uu=Ac/2,Df=2*Ac;function Tf(e){return e>=1?Uu:e<=-1?-Uu:Math.asin(e)}function Xc(e,t,n){var r=e._x1,i=e._y1,s=e._x2,f=e._y2;if(e._l01_a>Ro){var m=2*e._l01_2a+3*e._l01_a*e._l12_a+e._l12_2a,x=3*e._l01_a*(e._l01_a+e._l12_a);r=(r*m-e._x0*e._l12_2a+e._x2*e._l01_2a)/x,i=(i*m-e._y0*e._l12_2a+e._y2*e._l01_2a)/x}if(e._l23_a>Ro){var O=2*e._l23_2a+3*e._l23_a*e._l12_a+e._l12_2a,T=3*e._l23_a*(e._l23_a+e._l12_a);s=(s*O+e._x1*e._l23_2a-t*e._l12_2a)/T,f=(f*O+e._y1*e._l23_2a-n*e._l12_2a)/T}e._context.bezierCurveTo(r,i,s,f,e._x2,e._y2)}function Vd(e,t){this._context=e,this._alpha=t}Vd.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2)}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,r=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3;default:Xc(this,e,t)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var Wu=function e(t){function n(r){return t?new Vd(r,t):new Ec(r,0)}return n.alpha=function(r){return e(+r)},n}(.5);function Em(e,t){this._context=e,this._alpha=t}Em.prototype={areaStart:Pa,areaEnd:Pa,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,r=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:Xc(this,e,t)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var qd=function e(t){function n(r){return t?new Em(r,t):new Cc(r,0)}return n.alpha=function(r){return e(+r)},n}(.5);function Fl(e,t){this._context=e,this._alpha=t}Fl.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,r=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:Xc(this,e,t)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var jp=function e(t){function n(r){return t?new Fl(r,t):new Sf(r,0)}return n.alpha=function(r){return e(+r)},n}(.5);function Nf(e){this._context=e}Nf.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t)}}};var Yc=function(e){return new Nf(e)};function Hd(e){this._context=e}Hd.prototype={areaStart:Pa,areaEnd:Pa,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,t){e=+e,t=+t,this._point?this._context.lineTo(e,t):(this._point=1,this._context.moveTo(e,t))}};function zh(e){return e<0?-1:1}function yo(e,t,n){var r=e._x1-e._x0,i=t-e._x1,s=(e._y1-e._y0)/(r||i<0&&-0),f=(n-e._y1)/(i||r<0&&-0),m=(s*i+f*r)/(r+i);return(zh(s)+zh(f))*Math.min(Math.abs(s),Math.abs(f),.5*Math.abs(m))||0}function Rl(e,t){var n=e._x1-e._x0;return n?(3*(e._y1-e._y0)/n-t)/2:t}function Cs(e,t,n){var r=e._x0,i=e._y0,s=e._x1,f=e._y1,m=(s-r)/3;e._context.bezierCurveTo(r+m,i+m*t,s-m,f-m*n,s,f)}function Ml(e){this._context=e}function If(e){this._context=new Uh(e)}function Uh(e){this._context=e}function $d(e){this._context=e}function Ff(e){var t,n,r=e.length-1,i=new Array(r),s=new Array(r),f=new Array(r);for(i[0]=0,s[0]=2,f[0]=e[0]+2*e[1],t=1;t<r-1;++t)i[t]=1,s[t]=4,f[t]=4*e[t]+2*e[t+1];for(i[r-1]=2,s[r-1]=7,f[r-1]=8*e[r-1]+e[r],t=1;t<r;++t)n=i[t]/s[t-1],s[t]-=n,f[t]-=n*f[t-1];for(i[r-1]=f[r-1]/s[r-1],t=r-2;t>=0;--t)i[t]=(f[t]-i[t+1])/s[t];for(s[r-1]=(e[r]+i[r-1])/2,t=0;t<r-1;++t)s[t]=2*e[t+1]-i[t+1];return[i,s]}Ml.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:Cs(this,this._t0,Rl(this,this._t0))}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var n=NaN;if(t=+t,(e=+e)!==this._x1||t!==this._y1){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,Cs(this,Rl(this,n=yo(this,e,t)),n);break;default:Cs(this,this._t0,n=yo(this,e,t))}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=n}}},(If.prototype=Object.create(Ml.prototype)).point=function(e,t){Ml.prototype.point.call(this,t,e)},Uh.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,n,r,i,s){this._context.bezierCurveTo(t,e,r,n,s,i)}},$d.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,n=e.length;if(n)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),n===2)this._context.lineTo(e[1],t[1]);else for(var r=Ff(e),i=Ff(t),s=0,f=1;f<n;++s,++f)this._context.bezierCurveTo(r[0][s],i[0][s],r[1][s],i[1][s],e[f],t[f]);(this._line||this._line!==0&&n===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}};function jl(e,t){this._context=e,this._t=t}jl.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var n=this._x*(1-this._t)+e*this._t;this._context.lineTo(n,this._y),this._context.lineTo(n,t)}}this._x=e,this._y=t}};const Gd=Math.PI,Kd=2*Gd,en=Kd-1e-6;function Ws(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function Un(){return new Ws}Ws.prototype=Un.prototype={constructor:Ws,moveTo:function(e,t){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)},closePath:function(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(e,t){this._+="L"+(this._x1=+e)+","+(this._y1=+t)},quadraticCurveTo:function(e,t,n,r){this._+="Q"+ +e+","+ +t+","+(this._x1=+n)+","+(this._y1=+r)},bezierCurveTo:function(e,t,n,r,i,s){this._+="C"+ +e+","+ +t+","+ +n+","+ +r+","+(this._x1=+i)+","+(this._y1=+s)},arcTo:function(e,t,n,r,i){e=+e,t=+t,n=+n,r=+r,i=+i;var s=this._x1,f=this._y1,m=n-e,x=r-t,O=s-e,T=f-t,M=O*O+T*T;if(i<0)throw new Error("negative radius: "+i);if(this._x1===null)this._+="M"+(this._x1=e)+","+(this._y1=t);else if(M>1e-6)if(Math.abs(T*m-x*O)>1e-6&&i){var q=n-s,Q=r-f,se=m*m+x*x,le=q*q+Q*Q,Fe=Math.sqrt(se),Le=Math.sqrt(M),ze=i*Math.tan((Gd-Math.acos((se+M-le)/(2*Fe*Le)))/2),nt=ze/Le,it=ze/Fe;Math.abs(nt-1)>1e-6&&(this._+="L"+(e+nt*O)+","+(t+nt*T)),this._+="A"+i+","+i+",0,0,"+ +(T*q>O*Q)+","+(this._x1=e+it*m)+","+(this._y1=t+it*x)}else this._+="L"+(this._x1=e)+","+(this._y1=t)},arc:function(e,t,n,r,i,s){e=+e,t=+t,s=!!s;var f=(n=+n)*Math.cos(r),m=n*Math.sin(r),x=e+f,O=t+m,T=1^s,M=s?r-i:i-r;if(n<0)throw new Error("negative radius: "+n);this._x1===null?this._+="M"+x+","+O:(Math.abs(this._x1-x)>1e-6||Math.abs(this._y1-O)>1e-6)&&(this._+="L"+x+","+O),n&&(M<0&&(M=M%Kd+Kd),M>en?this._+="A"+n+","+n+",0,1,"+T+","+(e-f)+","+(t-m)+"A"+n+","+n+",0,1,"+T+","+(this._x1=x)+","+(this._y1=O):M>1e-6&&(this._+="A"+n+","+n+",0,"+ +(M>=Gd)+","+T+","+(this._x1=e+n*Math.cos(i))+","+(this._y1=t+n*Math.sin(i))))},rect:function(e,t,n,r){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)+"h"+ +n+"v"+ +r+"h"+-n+"Z"},toString:function(){return this._}};var Os=Un,na=function(e){return function(){return e}};function Bl(e){return e.innerRadius}function Rf(e){return e.outerRadius}function nr(e){return e.startAngle}function Go(e){return e.endAngle}function bo(e){return e&&e.padAngle}function Hi(e,t,n,r,i,s,f){var m=e-n,x=t-r,O=(f?s:-s)/Oc(m*m+x*x),T=O*x,M=-O*m,q=e+T,Q=t+M,se=n+T,le=r+M,Fe=(q+se)/2,Le=(Q+le)/2,ze=se-q,nt=le-Q,it=ze*ze+nt*nt,ut=i-s,st=q*le-se*Q,pt=(nt<0?-1:1)*Oc(Fo(0,ut*ut*it-st*st)),dt=(st*nt-ze*pt)/it,Qt=(-st*ze-nt*pt)/it,mn=(st*nt+ze*pt)/it,on=(-st*ze+nt*pt)/it,Rn=dt-Fe,Fn=Qt-Le,zn=mn-Fe,Vn=on-Le;return Rn*Rn+Fn*Fn>zn*zn+Vn*Vn&&(dt=mn,Qt=on),{cx:dt,cy:Qt,x01:-T,y01:-M,x11:dt*(i/ut-1),y11:Qt*(i/ut-1)}}var ku=function(e){return typeof e=="object"&&"length"in e?e:Array.from(e)};function oc(e){return e[0]}function Vs(e){return e[1]}var sc=function(e,t){var n=na(!0),r=null,i=Yc,s=null;function f(m){var x,O,T,M=(m=ku(m)).length,q=!1;for(r==null&&(s=i(T=Os())),x=0;x<=M;++x)!(x<M&&n(O=m[x],x,m))===q&&((q=!q)?s.lineStart():s.lineEnd()),q&&s.point(+e(O,x,m),+t(O,x,m));if(T)return s=null,T+""||null}return e=typeof e=="function"?e:e===void 0?oc:na(e),t=typeof t=="function"?t:t===void 0?Vs:na(t),f.x=function(m){return arguments.length?(e=typeof m=="function"?m:na(+m),f):e},f.y=function(m){return arguments.length?(t=typeof m=="function"?m:na(+m),f):t},f.defined=function(m){return arguments.length?(n=typeof m=="function"?m:na(!!m),f):n},f.curve=function(m){return arguments.length?(i=m,r!=null&&(s=i(r)),f):i},f.context=function(m){return arguments.length?(m==null?r=s=null:s=i(r=m),f):r},f},Ka=function(e,t,n){var r=null,i=na(!0),s=null,f=Yc,m=null;function x(T){var M,q,Q,se,le,Fe=(T=ku(T)).length,Le=!1,ze=new Array(Fe),nt=new Array(Fe);for(s==null&&(m=f(le=Os())),M=0;M<=Fe;++M){if(!(M<Fe&&i(se=T[M],M,T))===Le)if(Le=!Le)q=M,m.areaStart(),m.lineStart();else{for(m.lineEnd(),m.lineStart(),Q=M-1;Q>=q;--Q)m.point(ze[Q],nt[Q]);m.lineEnd(),m.areaEnd()}Le&&(ze[M]=+e(se,M,T),nt[M]=+t(se,M,T),m.point(r?+r(se,M,T):ze[M],n?+n(se,M,T):nt[M]))}if(le)return m=null,le+""||null}function O(){return sc().defined(i).curve(f).context(s)}return e=typeof e=="function"?e:e===void 0?oc:na(+e),t=typeof t=="function"?t:na(t===void 0?0:+t),n=typeof n=="function"?n:n===void 0?Vs:na(+n),x.x=function(T){return arguments.length?(e=typeof T=="function"?T:na(+T),r=null,x):e},x.x0=function(T){return arguments.length?(e=typeof T=="function"?T:na(+T),x):e},x.x1=function(T){return arguments.length?(r=T==null?null:typeof T=="function"?T:na(+T),x):r},x.y=function(T){return arguments.length?(t=typeof T=="function"?T:na(+T),n=null,x):t},x.y0=function(T){return arguments.length?(t=typeof T=="function"?T:na(+T),x):t},x.y1=function(T){return arguments.length?(n=T==null?null:typeof T=="function"?T:na(+T),x):n},x.lineX0=x.lineY0=function(){return O().x(e).y(t)},x.lineY1=function(){return O().x(e).y(n)},x.lineX1=function(){return O().x(r).y(t)},x.defined=function(T){return arguments.length?(i=typeof T=="function"?T:na(!!T),x):i},x.curve=function(T){return arguments.length?(f=T,s!=null&&(m=f(s)),x):f},x.context=function(T){return arguments.length?(T==null?s=m=null:m=f(s=T),x):s},x},Vu={draw:function(e,t){var n=Math.sqrt(t/Ac);e.moveTo(n,0),e.arc(0,0,n,0,Df)}};function qs(e,t){if(typeof document<"u"&&document.createElement){const n=document.createElement("canvas");if(n&&n.getContext)return n.width=e,n.height=t,n}return null}const oa=()=>typeof Image<"u"?Image:null,cs=Object(Ef.a)(jn.a),_o=cs.right,ls=cs.left;Object(Ef.a)(zr).center;var Xa=_o;function Hs(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e)}return this}function Eu(e,t){switch(arguments.length){case 0:break;case 1:typeof e=="function"?this.interpolator(e):this.range(e);break;default:this.domain(e),typeof t=="function"?this.interpolator(t):this.range(t)}return this}const qu=Symbol("implicit");function uc(){var e=new Map,t=[],n=[],r=qu;function i(s){var f=s+"",m=e.get(f);if(!m){if(r!==qu)return r;e.set(f,m=t.push(s))}return n[(m-1)%n.length]}return i.domain=function(s){if(!arguments.length)return t.slice();t=[],e=new Map;for(const f of s){const m=f+"";e.has(m)||e.set(m,t.push(f))}return i},i.range=function(s){return arguments.length?(n=Array.from(s),i):n.slice()},i.unknown=function(s){return arguments.length?(r=s,i):r},i.copy=function(){return uc(t,n).unknown(r)},Hs.apply(i,arguments),i}var Cu=o(45),Jc=o(50);function Qc(e,t,n,r){var i,s=Object(Cu.c)(e,t,n);switch((r=Object(Jc.formatSpecifier)(r??",f")).type){case"s":var f=Math.max(Math.abs(e),Math.abs(t));return r.precision!=null||isNaN(i=Object(Jc.precisionPrefix)(s,f))||(r.precision=i),Object(Jc.formatPrefix)(r,f);case"":case"e":case"g":case"p":case"r":r.precision!=null||isNaN(i=Object(Jc.precisionRound)(s,Math.max(Math.abs(e),Math.abs(t))))||(r.precision=i-(r.type==="e"));break;case"f":case"%":r.precision!=null||isNaN(i=Object(Jc.precisionFixed)(s))||(r.precision=i-2*(r.type==="%"))}return Object(Jc.format)(r)}var Wh=function(e,t,n){e.prototype=t.prototype=n,n.constructor=e};function Zc(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function $s(){}var Ou="\\s*([+-]?\\d+)\\s*",Au="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",nu="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Vh=/^#([0-9a-f]{3,8})$/,Mf=new RegExp("^rgb\\("+[Ou,Ou,Ou]+"\\)$"),jf=new RegExp("^rgb\\("+[nu,nu,nu]+"\\)$"),Pl=new RegExp("^rgba\\("+[Ou,Ou,Ou,Au]+"\\)$"),Bf=new RegExp("^rgba\\("+[nu,nu,nu,Au]+"\\)$"),Z=new RegExp("^hsl\\("+[Au,nu,nu]+"\\)$"),G=new RegExp("^hsla\\("+[Au,nu,nu,Au]+"\\)$"),C={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function N(){return this.rgb().formatHex()}function te(){return this.rgb().formatRgb()}function Be(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=Vh.exec(e))?(n=t[1].length,t=parseInt(t[1],16),n===6?Ge(t):n===3?new ct(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):n===8?ft(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):n===4?ft(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=Mf.exec(e))?new ct(t[1],t[2],t[3],1):(t=jf.exec(e))?new ct(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=Pl.exec(e))?ft(t[1],t[2],t[3],t[4]):(t=Bf.exec(e))?ft(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=Z.exec(e))?Wn(t[1],t[2]/100,t[3]/100,1):(t=G.exec(e))?Wn(t[1],t[2]/100,t[3]/100,t[4]):C.hasOwnProperty(e)?Ge(C[e]):e==="transparent"?new ct(NaN,NaN,NaN,0):null}function Ge(e){return new ct(e>>16&255,e>>8&255,255&e,1)}function ft(e,t,n,r){return r<=0&&(e=t=n=NaN),new ct(e,t,n,r)}function Nt(e){return e instanceof $s||(e=Be(e)),e?new ct((e=e.rgb()).r,e.g,e.b,e.opacity):new ct}function Ut(e,t,n,r){return arguments.length===1?Nt(e):new ct(e,t,n,r??1)}function ct(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}function yn(){return"#"+Nn(this.r)+Nn(this.g)+Nn(this.b)}function _n(){var e=this.opacity;return((e=isNaN(e)?1:Math.max(0,Math.min(1,e)))===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(e===1?")":", "+e+")")}function Nn(e){return((e=Math.max(0,Math.min(255,Math.round(e)||0)))<16?"0":"")+e.toString(16)}function Wn(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new rr(e,t,n,r)}function Mn(e){if(e instanceof rr)return new rr(e.h,e.s,e.l,e.opacity);if(e instanceof $s||(e=Be(e)),!e)return new rr;if(e instanceof rr)return e;var t=(e=e.rgb()).r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),s=Math.max(t,n,r),f=NaN,m=s-i,x=(s+i)/2;return m?(f=t===s?(n-r)/m+6*(n<r):n===s?(r-t)/m+2:(t-n)/m+4,m/=x<.5?s+i:2-s-i,f*=60):m=x>0&&x<1?0:f,new rr(f,m,x,e.opacity)}function tr(e,t,n,r){return arguments.length===1?Mn(e):new rr(e,t,n,r??1)}function rr(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function hr(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}function Nr(e,t,n,r,i){var s=e*e,f=s*e;return((1-3*e+3*s-f)*t+(4-6*s+3*f)*n+(1+3*e+3*s-3*f)*r+f*i)/6}Wh($s,Be,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:N,formatHex:N,formatHsl:function(){return Mn(this).formatHsl()},formatRgb:te,toString:te}),Wh(ct,Ut,Zc($s,{brighter:function(e){return e=e==null?1/.7:Math.pow(1/.7,e),new ct(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=e==null?.7:Math.pow(.7,e),new ct(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:yn,formatHex:yn,formatRgb:_n,toString:_n})),Wh(rr,tr,Zc($s,{brighter:function(e){return e=e==null?1/.7:Math.pow(1/.7,e),new rr(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=e==null?.7:Math.pow(.7,e),new rr(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new ct(hr(e>=240?e-240:e+120,i,r),hr(e,i,r),hr(e<120?e+240:e-120,i,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return((e=isNaN(e)?1:Math.max(0,Math.min(1,e)))===1?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(e===1?")":", "+e+")")}}));var Vr=function(e){var t=e.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),i=e[r],s=e[r+1],f=r>0?e[r-1]:2*i-s,m=r<t-1?e[r+2]:2*s-i;return Nr((n-r/t)*t,f,i,s,m)}},wr=function(e){var t=e.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*t),i=e[(r+t-1)%t],s=e[r%t],f=e[(r+1)%t],m=e[(r+2)%t];return Nr((n-r/t)*t,i,s,f,m)}},Hr=e=>()=>e;function Wr(e,t){return function(n){return e+n*t}}function oi(e,t){var n=t-e;return n?Wr(e,n>180||n<-180?n-360*Math.round(n/360):n):Hr(isNaN(e)?t:e)}function li(e){return(e=+e)==1?$r:function(t,n){return n-t?function(r,i,s){return r=Math.pow(r,s),i=Math.pow(i,s)-r,s=1/s,function(f){return Math.pow(r+f*i,s)}}(t,n,e):Hr(isNaN(t)?n:t)}}function $r(e,t){var n=t-e;return n?Wr(e,n):Hr(isNaN(e)?t:e)}var Zr=function e(t){var n=li(t);function r(i,s){var f=n((i=Ut(i)).r,(s=Ut(s)).r),m=n(i.g,s.g),x=n(i.b,s.b),O=$r(i.opacity,s.opacity);return function(T){return i.r=f(T),i.g=m(T),i.b=x(T),i.opacity=O(T),i+""}}return r.gamma=e,r}(1);function pa(e){return function(t){var n,r,i=t.length,s=new Array(i),f=new Array(i),m=new Array(i);for(n=0;n<i;++n)r=Ut(t[n]),s[n]=r.r||0,f[n]=r.g||0,m[n]=r.b||0;return s=e(s),f=e(f),m=e(m),r.opacity=1,function(x){return r.r=s(x),r.g=f(x),r.b=m(x),r+""}}}var ea=pa(Vr),La=pa(wr),Ii=function(e,t){t||(t=[]);var n,r=e?Math.min(t.length,e.length):0,i=t.slice();return function(s){for(n=0;n<r;++n)i[n]=e[n]*(1-s)+t[n]*s;return i}};function ra(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}var Ya=function(e,t){return(ra(t)?Ii:Sa)(e,t)};function Sa(e,t){var n,r=t?t.length:0,i=e?Math.min(r,e.length):0,s=new Array(i),f=new Array(r);for(n=0;n<i;++n)s[n]=io(e[n],t[n]);for(;n<r;++n)f[n]=t[n];return function(m){for(n=0;n<i;++n)f[n]=s[n](m);return f}}var xo=function(e,t){var n=new Date;return e=+e,t=+t,function(r){return n.setTime(e*(1-r)+t*r),n}},ki=function(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}},Ui=function(e,t){var n,r={},i={};for(n in e!==null&&typeof e=="object"||(e={}),t!==null&&typeof t=="object"||(t={}),t)n in e?r[n]=io(e[n],t[n]):i[n]=t[n];return function(s){for(n in r)i[n]=r[n](s);return i}},ha=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,to=new RegExp(ha.source,"g"),Wo=function(e,t){var n,r,i,s=ha.lastIndex=to.lastIndex=0,f=-1,m=[],x=[];for(e+="",t+="";(n=ha.exec(e))&&(r=to.exec(t));)(i=r.index)>s&&(i=t.slice(s,i),m[f]?m[f]+=i:m[++f]=i),(n=n[0])===(r=r[0])?m[f]?m[f]+=r:m[++f]=r:(m[++f]=null,x.push({i:f,x:ki(n,r)})),s=to.lastIndex;return s<t.length&&(i=t.slice(s),m[f]?m[f]+=i:m[++f]=i),m.length<2?x[0]?function(O){return function(T){return O(T)+""}}(x[0].x):function(O){return function(){return O}}(t):(t=x.length,function(O){for(var T,M=0;M<t;++M)m[(T=x[M]).i]=T.x(O);return m.join("")})},io=function(e,t){var n,r=typeof t;return t==null||r==="boolean"?Hr(t):(r==="number"?ki:r==="string"?(n=Be(t))?(t=n,Zr):Wo:t instanceof Be?Zr:t instanceof Date?xo:ra(t)?Ii:Array.isArray(t)?Sa:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?Ui:ki)(e,t)},Ja=function(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}};function fs(e){return+e}var fo=[0,1];function va(e){return e}function ho(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:function(n){return function(){return n}}(isNaN(t)?NaN:.5)}function cu(e,t,n){var r=e[0],i=e[1],s=t[0],f=t[1];return i<r?(r=ho(i,r),s=n(f,s)):(r=ho(r,i),s=n(s,f)),function(m){return s(r(m))}}function As(e,t,n){var r=Math.min(e.length,t.length)-1,i=new Array(r),s=new Array(r),f=-1;for(e[r]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++f<r;)i[f]=ho(e[f],e[f+1]),s[f]=n(t[f],t[f+1]);return function(m){var x=Xa(e,m,1,r)-1;return s[x](i[x](m))}}function So(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function Ma(){var e,t,n,r,i,s,f=fo,m=fo,x=io,O=va;function T(){var q=Math.min(f.length,m.length);return O!==va&&(O=function(Q,se){var le;return Q>se&&(le=Q,Q=se,se=le),function(Fe){return Math.max(Q,Math.min(se,Fe))}}(f[0],f[q-1])),r=q>2?As:cu,i=s=null,M}function M(q){return q==null||isNaN(q=+q)?n:(i||(i=r(f.map(e),m,x)))(e(O(q)))}return M.invert=function(q){return O(t((s||(s=r(m,f.map(e),ki)))(q)))},M.domain=function(q){return arguments.length?(f=Array.from(q,fs),T()):f.slice()},M.range=function(q){return arguments.length?(m=Array.from(q),T()):m.slice()},M.rangeRound=function(q){return m=Array.from(q),x=Ja,T()},M.clamp=function(q){return arguments.length?(O=!!q||va,T()):O!==va},M.interpolate=function(q){return arguments.length?(x=q,T()):x},M.unknown=function(q){return arguments.length?(n=q,M):n},function(q,Q){return e=q,t=Q,T()}}function cc(){return Ma()(va,va)}function Vo(e){var t=e.domain;return e.ticks=function(n){var r=t();return Object(Cu.a)(r[0],r[r.length-1],n??10)},e.tickFormat=function(n,r){var i=t();return Qc(i[0],i[i.length-1],n??10,r)},e.nice=function(n){n==null&&(n=10);var r,i,s=t(),f=0,m=s.length-1,x=s[f],O=s[m],T=10;for(O<x&&(i=x,x=O,O=i,i=f,f=m,m=i);T-- >0;){if((i=Object(Cu.b)(x,O,n))===r)return s[f]=x,s[m]=O,t(s);if(i>0)x=Math.floor(x/i)*i,O=Math.ceil(O/i)*i;else{if(!(i<0))break;x=Math.ceil(x*i)/i,O=Math.floor(O*i)/i}r=i}return e},e}function lu(e,t){var n,r=0,i=(e=e.slice()).length-1,s=e[r],f=e[i];return f<s&&(n=r,r=i,i=n,n=s,s=f,f=n),e[r]=t.floor(s),e[i]=t.ceil(f),e}function ao(e){return Math.log(e)}function fu(e){return Math.exp(e)}function Ia(e){return-Math.log(-e)}function _s(e){return-Math.exp(-e)}function hs(e){return isFinite(e)?+("1e"+e):e<0?0:e}function ia(e){return function(t){return-e(-t)}}function Ss(e){var t,n,r=e(ao,fu),i=r.domain,s=10;function f(){return t=function(m){return m===Math.E?Math.log:m===10&&Math.log10||m===2&&Math.log2||(m=Math.log(m),function(x){return Math.log(x)/m})}(s),n=function(m){return m===10?hs:m===Math.E?Math.exp:function(x){return Math.pow(m,x)}}(s),i()[0]<0?(t=ia(t),n=ia(n),e(Ia,_s)):e(ao,fu),r}return r.base=function(m){return arguments.length?(s=+m,f()):s},r.domain=function(m){return arguments.length?(i(m),f()):i()},r.ticks=function(m){var x,O=i(),T=O[0],M=O[O.length-1];(x=M<T)&&(le=T,T=M,M=le);var q,Q,se,le=t(T),Fe=t(M),Le=m==null?10:+m,ze=[];if(!(s%1)&&Fe-le<Le){if(le=Math.floor(le),Fe=Math.ceil(Fe),T>0){for(;le<=Fe;++le)for(Q=1,q=n(le);Q<s;++Q)if(!((se=q*Q)<T)){if(se>M)break;ze.push(se)}}else for(;le<=Fe;++le)for(Q=s-1,q=n(le);Q>=1;--Q)if(!((se=q*Q)<T)){if(se>M)break;ze.push(se)}2*ze.length<Le&&(ze=Object(Cu.a)(T,M,Le))}else ze=Object(Cu.a)(le,Fe,Math.min(Fe-le,Le)).map(n);return x?ze.reverse():ze},r.tickFormat=function(m,x){if(x==null&&(x=s===10?".0e":","),typeof x!="function"&&(x=Object(Jc.format)(x)),m===1/0)return x;m==null&&(m=10);var O=Math.max(1,s*m/r.ticks().length);return function(T){var M=T/n(Math.round(t(T)));return M*s<s-.5&&(M*=s),M<=O?x(T):""}},r.nice=function(){return i(lu(i(),{floor:function(m){return n(Math.floor(t(m)))},ceil:function(m){return n(Math.ceil(t(m)))}}))},r}function Ko(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function Gs(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function _c(e){return e<0?-e*e:e*e}function za(e){var t=e(va,va),n=1;return t.exponent=function(r){return arguments.length?(n=+r)==1?e(va,va):n===.5?e(Gs,_c):e(Ko(n),Ko(1/n)):n},Vo(t)}function es(){var e=za(Ma());return e.copy=function(){return So(e,es()).exponent(e.exponent())},Hs.apply(e,arguments),e}function Mo(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function lc(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function el(e){var t=1,n=e(Mo(t),lc(t));return n.constant=function(r){return arguments.length?e(Mo(t=+r),lc(t)):t},Vo(n)}var ci=o(12),Xd=o(182),tl=o(69),Ll=o(183),vg=o(184),yg=o(72),Cm=o(40),Om=o(135),bg=o(70),Am=o(180),xg=o(181),Pf=o(71),Yd=o(39),wg=o(134),kg=o(68);function Eg(e,t,n,r,i,s){const f=[[tl.a,1,ci.e],[tl.a,5,5*ci.e],[tl.a,15,15*ci.e],[tl.a,30,30*ci.e],[s,1,ci.c],[s,5,5*ci.c],[s,15,15*ci.c],[s,30,30*ci.c],[i,1,ci.b],[i,3,3*ci.b],[i,6,6*ci.b],[i,12,12*ci.b],[r,1,ci.a],[r,2,2*ci.a],[n,1,ci.f],[t,1,ci.d],[t,3,3*ci.d],[e,1,ci.g]];function m(x,O,T){const M=Math.abs(O-x)/T,q=Object(Ef.a)(([,,le])=>le).right(f,M);if(q===f.length)return e.every(Object(Cu.c)(x/ci.g,O/ci.g,T));if(q===0)return Xd.a.every(Math.max(Object(Cu.c)(x,O,T),1));const[Q,se]=f[M/f[q-1][2]<f[q][2]/M?q-1:q];return Q.every(se)}return[function(x,O,T){const M=O<x;M&&([x,O]=[O,x]);const q=T&&typeof T.range=="function"?T:m(x,O,T),Q=q?q.range(x,+O+1):[];return M?Q.reverse():Q},m]}const[Sc,Lf]=Eg(kg.a,wg.a,Yd.b,Pf.a,xg.a,Am.a),[Jd,_m]=Eg(bg.a,Om.a,Cm.b,yg.a,vg.a,Ll.a);var Sm=o(100);function Tv(e){return new Date(e)}function Dm(e){return e instanceof Date?+e:+new Date(+e)}function qh(e,t,n,r,i,s,f,m,x,O){var T=cc(),M=T.invert,q=T.domain,Q=O(".%L"),se=O(":%S"),le=O("%I:%M"),Fe=O("%I %p"),Le=O("%a %d"),ze=O("%b %d"),nt=O("%B"),it=O("%Y");function ut(st){return(x(st)<st?Q:m(st)<st?se:f(st)<st?le:s(st)<st?Fe:r(st)<st?i(st)<st?Le:ze:n(st)<st?nt:it)(st)}return T.invert=function(st){return new Date(M(st))},T.domain=function(st){return arguments.length?q(Array.from(st,Dm)):q().map(Tv)},T.ticks=function(st){var pt=q();return e(pt[0],pt[pt.length-1],st??10)},T.tickFormat=function(st,pt){return pt==null?ut:O(pt)},T.nice=function(st){var pt=q();return st&&typeof st.range=="function"||(st=t(pt[0],pt[pt.length-1],st??10)),st?q(lu(pt,st)):T},T.copy=function(){return So(T,qh(e,t,n,r,i,s,f,m,x,O))},T}function zf(){var e,t,n,r,i,s=0,f=1,m=va,x=!1;function O(M){return M==null||isNaN(M=+M)?i:m(n===0?.5:(M=(r(M)-e)*n,x?Math.max(0,Math.min(1,M)):M))}function T(M){return function(q){var Q,se;return arguments.length?([Q,se]=q,m=M(Q,se),O):[m(0),m(1)]}}return O.domain=function(M){return arguments.length?([s,f]=M,e=r(s=+s),t=r(f=+f),n=e===t?0:1/(t-e),O):[s,f]},O.clamp=function(M){return arguments.length?(x=!!M,O):x},O.interpolator=function(M){return arguments.length?(m=M,O):m},O.range=T(io),O.rangeRound=T(Ja),O.unknown=function(M){return arguments.length?(i=M,O):i},function(M){return r=M,e=M(s),t=M(f),n=e===t?0:1/(t-e),O}}function Dc(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function Tm(){var e=Vo(zf()(va));return e.copy=function(){return Dc(e,Tm())},Eu.apply(e,arguments)}function Nm(){var e=za(zf());return e.copy=function(){return Dc(e,Nm()).exponent(e.exponent())},Eu.apply(e,arguments)}function _u(e,t){t===void 0&&(t=e,e=io);for(var n=0,r=t.length-1,i=t[0],s=new Array(r<0?0:r);n<r;)s[n]=e(i,i=t[++n]);return function(f){var m=Math.max(0,Math.min(r-1,Math.floor(f*=r)));return s[m](f-m)}}function Im(){var e,t,n,r,i,s,f,m=0,x=.5,O=1,T=1,M=va,q=!1;function Q(le){return isNaN(le=+le)?f:(le=.5+((le=+s(le))-t)*(T*le<T*t?r:i),M(q?Math.max(0,Math.min(1,le)):le))}function se(le){return function(Fe){var Le,ze,nt;return arguments.length?([Le,ze,nt]=Fe,M=_u(le,[Le,ze,nt]),Q):[M(0),M(.5),M(1)]}}return Q.domain=function(le){return arguments.length?([m,x,O]=le,e=s(m=+m),t=s(x=+x),n=s(O=+O),r=e===t?0:.5/(t-e),i=t===n?0:.5/(n-t),T=t<e?-1:1,Q):[m,x,O]},Q.clamp=function(le){return arguments.length?(q=!!le,Q):q},Q.interpolator=function(le){return arguments.length?(M=le,Q):M},Q.range=se(io),Q.rangeRound=se(Ja),Q.unknown=function(le){return arguments.length?(f=le,Q):f},function(le){return s=le,e=le(m),t=le(x),n=le(O),r=e===t?0:.5/(t-e),i=t===n?0:.5/(n-t),T=t<e?-1:1,Q}}function Hh(){var e=za(Im());return e.copy=function(){return Dc(e,Hh()).exponent(e.exponent())},Eu.apply(e,arguments)}var Qd,Nv=function(e){var t=e.length;return function(n){return e[Math.max(0,Math.min(t-1,Math.floor(n*t)))]}},Zd=function(e,t){var n=oi(+e,+t);return function(r){var i=n(r);return i-360*Math.floor(i/360)}},Tc=180/Math.PI,ep={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1},Cg=function(e,t,n,r,i,s){var f,m,x;return(f=Math.sqrt(e*e+t*t))&&(e/=f,t/=f),(x=e*n+t*r)&&(n-=e*x,r-=t*x),(m=Math.sqrt(n*n+r*r))&&(n/=m,r/=m,x/=m),e*r<t*n&&(e=-e,t=-t,x=-x,f=-f),{translateX:i,translateY:s,rotate:Math.atan2(t,e)*Tc,skewX:Math.atan(x)*Tc,scaleX:f,scaleY:m}};function Og(e,t,n,r){function i(s){return s.length?s.pop()+" ":""}return function(s,f){var m=[],x=[];return s=e(s),f=e(f),function(O,T,M,q,Q,se){if(O!==M||T!==q){var le=Q.push("translate(",null,t,null,n);se.push({i:le-4,x:ki(O,M)},{i:le-2,x:ki(T,q)})}else(M||q)&&Q.push("translate("+M+t+q+n)}(s.translateX,s.translateY,f.translateX,f.translateY,m,x),function(O,T,M,q){O!==T?(O-T>180?T+=360:T-O>180&&(O+=360),q.push({i:M.push(i(M)+"rotate(",null,r)-2,x:ki(O,T)})):T&&M.push(i(M)+"rotate("+T+r)}(s.rotate,f.rotate,m,x),function(O,T,M,q){O!==T?q.push({i:M.push(i(M)+"skewX(",null,r)-2,x:ki(O,T)}):T&&M.push(i(M)+"skewX("+T+r)}(s.skewX,f.skewX,m,x),function(O,T,M,q,Q,se){if(O!==M||T!==q){var le=Q.push(i(Q)+"scale(",null,",",null,")");se.push({i:le-4,x:ki(O,M)},{i:le-2,x:ki(T,q)})}else M===1&&q===1||Q.push(i(Q)+"scale("+M+","+q+")")}(s.scaleX,s.scaleY,f.scaleX,f.scaleY,m,x),s=f=null,function(O){for(var T,M=-1,q=x.length;++M<q;)m[(T=x[M]).i]=T.x(O);return m.join("")}}}var Fm=Og(function(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?ep:Cg(t.a,t.b,t.c,t.d,t.e,t.f)},"px, ","px)","deg)"),b0=Og(function(e){return e==null?ep:(Qd||(Qd=document.createElementNS("http://www.w3.org/2000/svg","g")),Qd.setAttribute("transform",e),(e=Qd.transform.baseVal.consolidate())?(e=e.matrix,Cg(e.a,e.b,e.c,e.d,e.e,e.f)):ep)},", ",")",")"),x0=1e-12;function sa(e){return((e=Math.exp(e))+1/e)/2}var Ag=function e(t,n,r){function i(s,f){var m,x,O=s[0],T=s[1],M=s[2],q=f[0],Q=f[1],se=f[2],le=q-O,Fe=Q-T,Le=le*le+Fe*Fe;if(Le<x0)x=Math.log(se/M)/t,m=function(pt){return[O+pt*le,T+pt*Fe,M*Math.exp(t*pt*x)]};else{var ze=Math.sqrt(Le),nt=(se*se-M*M+r*Le)/(2*M*n*ze),it=(se*se-M*M-r*Le)/(2*se*n*ze),ut=Math.log(Math.sqrt(nt*nt+1)-nt),st=Math.log(Math.sqrt(it*it+1)-it);x=(st-ut)/t,m=function(pt){var dt=pt*x,Qt=sa(ut),mn=M/(n*ze)*(Qt*function(on){return((on=Math.exp(2*on))-1)/(on+1)}(t*dt+ut)-function(on){return((on=Math.exp(on))-1/on)/2}(ut));return[O+mn*le,T+mn*Fe,M*Qt/sa(t*dt+ut)]}}return m.duration=1e3*x*t/Math.SQRT2,m}return i.rho=function(s){var f=Math.max(.001,+s),m=f*f;return e(f,m,m*m)},i}(Math.SQRT2,2,4);function _g(e){return function(t,n){var r=e((t=tr(t)).h,(n=tr(n)).h),i=$r(t.s,n.s),s=$r(t.l,n.l),f=$r(t.opacity,n.opacity);return function(m){return t.h=r(m),t.s=i(m),t.l=s(m),t.opacity=f(m),t+""}}}var Bp=_g(oi),Sg=_g($r);const tp=Math.PI/180,nl=180/Math.PI,rl=.96422,Dg=1,Tg=.82521,$h=4/29,Uf=6/29,Gh=3*Uf*Uf,w0=Uf*Uf*Uf;function Pp(e){if(e instanceof Su)return new Su(e.l,e.a,e.b,e.opacity);if(e instanceof Hu)return Ig(e);e instanceof ct||(e=Nt(e));var t,n,r=Ng(e.r),i=Ng(e.g),s=Ng(e.b),f=zl((.2225045*r+.7168786*i+.0606169*s)/Dg);return r===i&&i===s?t=n=f:(t=zl((.4360747*r+.3850649*i+.1430804*s)/rl),n=zl((.0139322*r+.0971045*i+.7141733*s)/Tg)),new Su(116*f-16,500*(t-f),200*(f-n),e.opacity)}function il(e,t,n,r){return arguments.length===1?Pp(e):new Su(e,t,n,r??1)}function Su(e,t,n,r){this.l=+e,this.a=+t,this.b=+n,this.opacity=+r}function zl(e){return e>w0?Math.pow(e,1/3):e/Gh+$h}function Ul(e){return e>Uf?e*e*e:Gh*(e-$h)}function Wl(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function Ng(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function Lp(e){if(e instanceof Hu)return new Hu(e.h,e.c,e.l,e.opacity);if(e instanceof Su||(e=Pp(e)),e.a===0&&e.b===0)return new Hu(NaN,0<e.l&&e.l<100?0:NaN,e.l,e.opacity);var t=Math.atan2(e.b,e.a)*nl;return new Hu(t<0?t+360:t,Math.sqrt(e.a*e.a+e.b*e.b),e.l,e.opacity)}function Du(e,t,n,r){return arguments.length===1?Lp(e):new Hu(e,t,n,r??1)}function Hu(e,t,n,r){this.h=+e,this.c=+t,this.l=+n,this.opacity=+r}function Ig(e){if(isNaN(e.h))return new Su(e.l,0,0,e.opacity);var t=e.h*tp;return new Su(e.l,Math.cos(t)*e.c,Math.sin(t)*e.c,e.opacity)}function np(e,t){var n=$r((e=il(e)).l,(t=il(t)).l),r=$r(e.a,t.a),i=$r(e.b,t.b),s=$r(e.opacity,t.opacity);return function(f){return e.l=n(f),e.a=r(f),e.b=i(f),e.opacity=s(f),e+""}}function Rm(e){return function(t,n){var r=e((t=Du(t)).h,(n=Du(n)).h),i=$r(t.c,n.c),s=$r(t.l,n.l),f=$r(t.opacity,n.opacity);return function(m){return t.h=r(m),t.c=i(m),t.l=s(m),t.opacity=f(m),t+""}}}Wh(Su,il,Zc($s,{brighter:function(e){return new Su(this.l+18*(e??1),this.a,this.b,this.opacity)},darker:function(e){return new Su(this.l-18*(e??1),this.a,this.b,this.opacity)},rgb:function(){var e=(this.l+16)/116,t=isNaN(this.a)?e:e+this.a/500,n=isNaN(this.b)?e:e-this.b/200;return new ct(Wl(3.1338561*(t=rl*Ul(t))-1.6168667*(e=Dg*Ul(e))-.4906146*(n=Tg*Ul(n))),Wl(-.9787684*t+1.9161415*e+.033454*n),Wl(.0719453*t-.2289914*e+1.4052427*n),this.opacity)}})),Wh(Hu,Du,Zc($s,{brighter:function(e){return new Hu(this.h,this.c,this.l+18*(e??1),this.opacity)},darker:function(e){return new Hu(this.h,this.c,this.l-18*(e??1),this.opacity)},rgb:function(){return Ig(this).rgb()}}));var k0=Rm(oi),Iv=Rm($r),Vl=-.29227,Kh=-.90649,Wf=1.97294,Vf=Wf*Kh,Fg=1.78277*Wf,Mm=1.78277*Vl- -.14861*Kh;function qf(e,t,n,r){return arguments.length===1?function(i){if(i instanceof ta)return new ta(i.h,i.s,i.l,i.opacity);i instanceof ct||(i=Nt(i));var s=i.r/255,f=i.g/255,m=i.b/255,x=(Mm*m+Vf*s-Fg*f)/(Mm+Vf-Fg),O=m-x,T=(Wf*(f-x)-Vl*O)/Kh,M=Math.sqrt(T*T+O*O)/(Wf*x*(1-x)),q=M?Math.atan2(T,O)*nl-120:NaN;return new ta(q<0?q+360:q,M,x,i.opacity)}(e):new ta(e,t,n,r??1)}function ta(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function ql(e){return function t(n){function r(i,s){var f=e((i=qf(i)).h,(s=qf(s)).h),m=$r(i.s,s.s),x=$r(i.l,s.l),O=$r(i.opacity,s.opacity);return function(T){return i.h=f(T),i.s=m(T),i.l=x(Math.pow(T,n)),i.opacity=O(T),i+""}}return n=+n,r.gamma=t,r}(1)}Wh(ta,qf,Zc($s,{brighter:function(e){return e=e==null?1/.7:Math.pow(1/.7,e),new ta(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=e==null?.7:Math.pow(.7,e),new ta(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=isNaN(this.h)?0:(this.h+120)*tp,t=+this.l,n=isNaN(this.s)?0:this.s*t*(1-t),r=Math.cos(e),i=Math.sin(e);return new ct(255*(t+n*(-.14861*r+1.78277*i)),255*(t+n*(Vl*r+Kh*i)),255*(t+n*(Wf*r)),this.opacity)}}));var Xh=ql(oi),Fv=ql($r),Rv=function(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e(r/(t-1));return n};function zp(e,t,n){const r=e-t+2*n;return e?r>0?r:1:0}const Hl="linear",al="log",rp="pow",Yh="sqrt",Hf="symlog",$l="time",Gl="utc",Tu="sequential",Jh="diverging",$f="quantile",ol="quantize",Nc="threshold",Gf="ordinal",Up="point",Kf="band",Ic="bin-ordinal",ts="continuous",fc="discrete",Nu="discretizing",hu="interpolating",Qh="temporal";function Wp(){const e=uc().unknown(void 0),t=e.domain,n=e.range;let r,i,s=[0,1],f=!1,m=0,x=0,O=.5;function T(){const M=t().length,q=s[1]<s[0],Q=s[1-q],se=zp(M,m,x);let le=s[q-0];r=(Q-le)/(se||1),f&&(r=Math.floor(r)),le+=(Q-le-r*(M-m))*O,i=r*(1-m),f&&(le=Math.round(le),i=Math.round(i));const Fe=ys(M).map(Le=>le+r*Le);return n(q?Fe.reverse():Fe)}return delete e.unknown,e.domain=function(M){return arguments.length?(t(M),T()):t()},e.range=function(M){return arguments.length?(s=[+M[0],+M[1]],T()):s.slice()},e.rangeRound=function(M){return s=[+M[0],+M[1]],f=!0,T()},e.bandwidth=function(){return i},e.step=function(){return r},e.round=function(M){return arguments.length?(f=!!M,T()):f},e.padding=function(M){return arguments.length?(x=Math.max(0,Math.min(1,M)),m=x,T()):m},e.paddingInner=function(M){return arguments.length?(m=Math.max(0,Math.min(1,M)),T()):m},e.paddingOuter=function(M){return arguments.length?(x=Math.max(0,Math.min(1,M)),T()):x},e.align=function(M){return arguments.length?(O=Math.max(0,Math.min(1,M)),T()):O},e.invertRange=function(M){if(M[0]==null||M[1]==null)return;const q=s[1]<s[0],Q=q?n().reverse():n(),se=Q.length-1;let le,Fe,Le,ze=+M[0],nt=+M[1];return ze!=ze||nt!=nt||(nt<ze&&(Le=ze,ze=nt,nt=Le),nt<Q[0]||ze>s[1-q])?void 0:(le=Math.max(0,_o(Q,ze)-1),Fe=ze===nt?le:_o(Q,nt)-1,ze-Q[le]>i+1e-10&&++le,q&&(Le=le,le=se-Fe,Fe=se-Le),le>Fe?void 0:t().slice(le,Fe+1))},e.invert=function(M){const q=e.invertRange([M,M]);return q&&q[0]},e.copy=function(){return Wp().domain(t()).range(s).round(f).paddingInner(m).paddingOuter(x).align(O)},T()}var jm=Array.prototype.map;const Bm=Array.prototype.slice,ip={};function Fa(e,t,n){return arguments.length>1?(ip[e]=function(r,i,s){const f=function(){const m=i();return m.invertRange||(m.invertRange=m.invert?function(x){return function(O){let T,M=O[0],q=O[1];return q<M&&(T=M,M=q,q=T),[x.invert(M),x.invert(q)]}}(m):m.invertExtent?function(x){return function(O){const T=x.range();let M,q,Q,se,le=O[0],Fe=O[1],Le=-1;for(Fe<le&&(q=le,le=Fe,Fe=q),Q=0,se=T.length;Q<se;++Q)T[Q]>=le&&T[Q]<=Fe&&(Le<0&&(Le=Q),M=Q);if(!(Le<0))return le=x.invertExtent(T[Le]),Fe=x.invertExtent(T[M]),[le[0]===void 0?le[1]:le[0],Fe[1]===void 0?Fe[0]:Fe[1]]}}(m):void 0),m.type=r,m};return f.metadata=Object(xe.Fa)(Object(xe.i)(s)),f}(e,t,n),this):ap(e)?ip[e]:void 0}function ap(e){return Object(xe.w)(ip,e)}function hc(e,t){const n=ip[e];return n&&n.metadata[t]}function Xf(e){return hc(e,ts)}function Yf(e){return hc(e,fc)}function op(e){return hc(e,Nu)}function Vp(e){return hc(e,al)}function qp(e){return hc(e,hu)}function Hp(e){return hc(e,$f)}Fa("identity",function e(t){var n;function r(i){return i==null||isNaN(i=+i)?n:i}return r.invert=r,r.domain=r.range=function(i){return arguments.length?(t=Array.from(i,fs),r):t.slice()},r.unknown=function(i){return arguments.length?(n=i,r):n},r.copy=function(){return e(t).unknown(n)},t=arguments.length?Array.from(t,fs):[0,1],Vo(r)}),Fa(Hl,function e(){var t=cc();return t.copy=function(){return So(t,e())},Hs.apply(t,arguments),Vo(t)},ts),Fa(al,function e(){var t=Ss(Ma()).domain([1,10]);return t.copy=function(){return So(t,e()).base(t.base())},Hs.apply(t,arguments),t},[ts,al]),Fa(rp,es,ts),Fa(Yh,function(){return es.apply(null,arguments).exponent(.5)},ts),Fa(Hf,function e(){var t=el(Ma());return t.copy=function(){return So(t,e()).constant(t.constant())},Hs.apply(t,arguments)},ts),Fa($l,function(){return Hs.apply(qh(Jd,_m,bg.a,Om.a,Cm.b,yg.a,vg.a,Ll.a,tl.a,Sm.a).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)},[ts,Qh]),Fa(Gl,function(){return Hs.apply(qh(Sc,Lf,kg.a,wg.a,Yd.b,Pf.a,xg.a,Am.a,tl.a,Sm.c).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)},[ts,Qh]),Fa(Tu,Tm,[ts,hu]),Fa("".concat(Tu,"-").concat(Hl),Tm,[ts,hu]),Fa("".concat(Tu,"-").concat(al),function e(){var t=Ss(zf()).domain([1,10]);return t.copy=function(){return Dc(t,e()).base(t.base())},Eu.apply(t,arguments)},[ts,hu,al]),Fa("".concat(Tu,"-").concat(rp),Nm,[ts,hu]),Fa("".concat(Tu,"-").concat(Yh),function(){return Nm.apply(null,arguments).exponent(.5)},[ts,hu]),Fa("".concat(Tu,"-").concat(Hf),function e(){var t=el(zf());return t.copy=function(){return Dc(t,e()).constant(t.constant())},Eu.apply(t,arguments)},[ts,hu]),Fa("".concat(Jh,"-").concat(Hl),function e(){var t=Vo(Im()(va));return t.copy=function(){return Dc(t,e())},Eu.apply(t,arguments)},[ts,hu]),Fa("".concat(Jh,"-").concat(al),function e(){var t=Ss(Im()).domain([.1,1,10]);return t.copy=function(){return Dc(t,e()).base(t.base())},Eu.apply(t,arguments)},[ts,hu,al]),Fa("".concat(Jh,"-").concat(rp),Hh,[ts,hu]),Fa("".concat(Jh,"-").concat(Yh),function(){return Hh.apply(null,arguments).exponent(.5)},[ts,hu]),Fa("".concat(Jh,"-").concat(Hf),function e(){var t=el(Im());return t.copy=function(){return Dc(t,e()).constant(t.constant())},Eu.apply(t,arguments)},[ts,hu]),Fa($f,function e(){var t,n=[],r=[],i=[];function s(){var m=0,x=Math.max(1,r.length);for(i=new Array(x-1);++m<x;)i[m-1]=pi(n,m/x);return f}function f(m){return m==null||isNaN(m=+m)?t:r[Xa(i,m)]}return f.invertExtent=function(m){var x=r.indexOf(m);return x<0?[NaN,NaN]:[x>0?i[x-1]:n[0],x<i.length?i[x]:n[n.length-1]]},f.domain=function(m){if(!arguments.length)return n.slice();n=[];for(let x of m)x==null||isNaN(x=+x)||n.push(x);return n.sort(jn.a),s()},f.range=function(m){return arguments.length?(r=Array.from(m),s()):r.slice()},f.unknown=function(m){return arguments.length?(t=m,f):t},f.quantiles=function(){return i.slice()},f.copy=function(){return e().domain(n).range(r).unknown(t)},Hs.apply(f,arguments)},[Nu,$f]),Fa(ol,function e(){var t,n=0,r=1,i=1,s=[.5],f=[0,1];function m(O){return O!=null&&O<=O?f[Xa(s,O,0,i)]:t}function x(){var O=-1;for(s=new Array(i);++O<i;)s[O]=((O+1)*r-(O-i)*n)/(i+1);return m}return m.domain=function(O){return arguments.length?([n,r]=O,n=+n,r=+r,x()):[n,r]},m.range=function(O){return arguments.length?(i=(f=Array.from(O)).length-1,x()):f.slice()},m.invertExtent=function(O){var T=f.indexOf(O);return T<0?[NaN,NaN]:T<1?[n,s[0]]:T>=i?[s[i-1],r]:[s[T-1],s[T]]},m.unknown=function(O){return arguments.length&&(t=O),m},m.thresholds=function(){return s.slice()},m.copy=function(){return e().domain([n,r]).range(f).unknown(t)},Hs.apply(Vo(m),arguments)},Nu),Fa(Nc,function e(){var t,n=[.5],r=[0,1],i=1;function s(f){return f!=null&&f<=f?r[Xa(n,f,0,i)]:t}return s.domain=function(f){return arguments.length?(n=Array.from(f),i=Math.min(n.length,r.length-1),s):n.slice()},s.range=function(f){return arguments.length?(r=Array.from(f),i=Math.min(n.length,r.length-1),s):r.slice()},s.invertExtent=function(f){var m=r.indexOf(f);return[n[m-1],n[m]]},s.unknown=function(f){return arguments.length?(t=f,s):t},s.copy=function(){return e().domain(n).range(r).unknown(t)},Hs.apply(s,arguments)},Nu),Fa(Ic,function e(){let t=[],n=[];function r(i){return i==null||i!=i?void 0:n[(Xa(t,i)-1)%n.length]}return r.domain=function(i){return arguments.length?(t=function(s){return jm.call(s,xe.Ea)}(i),r):t.slice()},r.range=function(i){return arguments.length?(n=Bm.call(i),r):n.slice()},r.tickFormat=function(i,s){return Qc(t[0],Object(xe.W)(t),i??10,s)},r.copy=function(){return e().domain(r.domain()).range(r.range())},r},[fc,Nu]),Fa(Gf,uc,fc),Fa(Kf,Wp,fc),Fa(Up,function(){return function e(t){const n=t.copy;return t.padding=t.paddingOuter,delete t.paddingInner,t.copy=function(){return e(n())},t}(Wp().paddingInner(1))},fc);const Rg=["clamp","base","constant","exponent"];function $p(e,t){const n=t[0],r=Object(xe.W)(t)-n;return function(i){return e(n+i*r)}}function Kl(e,t,n){return _u(Kp(t||"rgb",n),e)}function Gp(e,t){const n=new Array(t),r=t+1;for(let i=0;i<t;)n[i]=e(++i/r);return n}function Zh(e,t,n){const r=n-t;let i,s,f;return r&&Number.isFinite(r)?(i=(s=e.type).indexOf("-"),s=i<0?s:s.slice(i+1),f=Fa(s)().domain([t,n]).range([0,1]),Rg.forEach(m=>e[m]?f[m](e[m]()):0),f):Object(xe.m)(.5)}function Kp(e,t){const n=B[function(r){return"interpolate"+r.toLowerCase().split("-").map(i=>i[0].toUpperCase()+i.slice(1)).join("")}(e)];return t!=null&&n&&n.gamma?n.gamma(t):n}function Pm(e){const t=e.length/6|0,n=new Array(t);for(let r=0;r<t;)n[r]="#"+e.slice(6*r,6*++r);return n}function Lm(e,t){for(const n in e)zm(n,t(e[n]))}const sp={};function zm(e,t){return e=e&&e.toLowerCase(),arguments.length>1?(sp[e]=t,this):sp[e]}Lm({category10:"1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf",category20:"1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5",category20b:"393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6",category20c:"3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9",tableau10:"4c78a8f58518e4575672b7b254a24beeca3bb279a2ff9da69d755dbab0ac",tableau20:"4c78a89ecae9f58518ffbf7954a24b88d27ab79a20f2cf5b43989483bcb6e45756ff9d9879706ebab0acd67195fcbfd2b279a2d6a5c99e765fd8b5a5",accent:"7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666",dark2:"1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666",paired:"a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928",pastel1:"fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2",pastel2:"b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc",set1:"e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999",set2:"66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3",set3:"8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"},Pm),Lm({blues:"cfe1f2bed8eca8cee58fc1de74b2d75ba3cf4592c63181bd206fb2125ca40a4a90",greens:"d3eecdc0e6baabdda594d3917bc77d60ba6c46ab5e329a512089430e7735036429",greys:"e2e2e2d4d4d4c4c4c4b1b1b19d9d9d8888887575756262624d4d4d3535351e1e1e",oranges:"fdd8b3fdc998fdb87bfda55efc9244f87f2cf06b18e4580bd14904b93d029f3303",purples:"e2e1efd4d4e8c4c5e0b4b3d6a3a0cc928ec3827cb97566ae684ea25c3696501f8c",reds:"fdc9b4fcb49afc9e80fc8767fa7051f6573fec3f2fdc2a25c81b1db21218970b13",blueGreen:"d5efedc1e8e0a7ddd18bd2be70c6a958ba9144ad77319c5d2089460e7736036429",bluePurple:"ccddecbad0e4a8c2dd9ab0d4919cc98d85be8b6db28a55a6873c99822287730f71",greenBlue:"d3eecec5e8c3b1e1bb9bd8bb82cec269c2ca51b2cd3c9fc7288abd1675b10b60a1",orangeRed:"fddcaffdcf9bfdc18afdad77fb9562f67d53ee6545e24932d32d1ebf130da70403",purpleBlue:"dbdaebc8cee4b1c3de97b7d87bacd15b9fc93a90c01e7fb70b70ab056199045281",purpleBlueGreen:"dbd8eac8cee4b0c3de93b7d872acd1549fc83892bb1c88a3097f8702736b016353",purpleRed:"dcc9e2d3b3d7ce9eccd186c0da6bb2e14da0e23189d91e6fc61159ab07498f023a",redPurple:"fccfccfcbec0faa9b8f98faff571a5ec539ddb3695c41b8aa908808d0179700174",yellowGreen:"e4f4acd1eca0b9e2949ed68880c97c62bb6e47aa5e3297502083440e723b036034",yellowOrangeBrown:"feeaa1fedd84fecc63feb746fca031f68921eb7215db5e0bc54c05ab3d038f3204",yellowOrangeRed:"fee087fed16ffebd59fea849fd903efc7335f9522bee3423de1b20ca0b22af0225",blueOrange:"134b852f78b35da2cb9dcae1d2e5eff2f0ebfce0bafbbf74e8932fc5690d994a07",brownBlueGreen:"704108a0651ac79548e3c78af3e6c6eef1eac9e9e48ed1c74da79e187a72025147",purpleGreen:"5b1667834792a67fb6c9aed3e6d6e8eff0efd9efd5aedda971bb75368e490e5e29",purpleOrange:"4114696647968f83b7b9b4d6dadbebf3eeeafce0bafbbf74e8932fc5690d994a07",redBlue:"8c0d25bf363adf745ef4ae91fbdbc9f2efeed2e5ef9dcae15da2cb2f78b3134b85",redGrey:"8c0d25bf363adf745ef4ae91fcdccbfaf4f1e2e2e2c0c0c0969696646464343434",yellowGreenBlue:"eff9bddbf1b4bde5b594d5b969c5be45b4c22c9ec02182b82163aa23479c1c3185",redYellowBlue:"a50026d4322cf16e43fcac64fedd90faf8c1dcf1ecabd6e875abd04a74b4313695",redYellowGreen:"a50026d4322cf16e43fcac63fedd8df9f7aed7ee8ea4d86e64bc6122964f006837",pinkYellowGreen:"8e0152c0267edd72adf0b3d6faddedf5f3efe1f2cab6de8780bb474f9125276419",spectral:"9e0142d13c4bf0704afcac63fedd8dfbf8b0e0f3a1a9dda269bda94288b55e4fa2",viridis:"440154470e61481a6c482575472f7d443a834144873d4e8a39568c35608d31688e2d708e2a788e27818e23888e21918d1f988b1fa08822a8842ab07f35b77943bf7154c56866cc5d7ad1518fd744a5db36bcdf27d2e21be9e51afde725",magma:"0000040404130b0924150e3720114b2c11603b0f704a107957157e651a80721f817f24828c29819a2e80a8327db6377ac43c75d1426fde4968e95462f1605df76f5cfa7f5efc8f65fe9f6dfeaf78febf84fece91fddea0fcedaffcfdbf",inferno:"0000040403130c0826170c3b240c4f330a5f420a68500d6c5d126e6b176e781c6d86216b932667a12b62ae305cbb3755c73e4cd24644dd513ae65c30ed6925f3771af8850ffb9506fca50afcb519fac62df6d645f2e661f3f484fcffa4",plasma:"0d088723069033059742039d5002a25d01a66a00a87801a88405a7900da49c179ea72198b12a90ba3488c33d80cb4779d35171da5a69e16462e76e5bed7953f2834cf68f44fa9a3dfca636fdb32ffec029fcce25f9dc24f5ea27f0f921",cividis:"00205100235800265d002961012b65042e670831690d346b11366c16396d1c3c6e213f6e26426e2c456e31476e374a6e3c4d6e42506e47536d4c566d51586e555b6e5a5e6e5e616e62646f66676f6a6a706e6d717270717573727976737c79747f7c75827f758682768985778c8877908b78938e789691789a94789e9778a19b78a59e77a9a177aea575b2a874b6ab73bbaf71c0b26fc5b66dc9b96acebd68d3c065d8c462ddc85fe2cb5ce7cf58ebd355f0d652f3da4ff7de4cfae249fce647",rainbow:"6e40aa883eb1a43db3bf3cafd83fa4ee4395fe4b83ff576eff6659ff7847ff8c38f3a130e2b72fcfcc36bee044aff05b8ff4576ff65b52f6673af27828ea8d1ddfa319d0b81cbecb23abd82f96e03d82e14c6edb5a5dd0664dbf6e40aa",sinebow:"ff4040fc582af47218e78d0bd5a703bfbf00a7d5038de70b72f41858fc2a40ff402afc5818f4720be78d03d5a700bfbf03a7d50b8de71872f42a58fc4040ff582afc7218f48d0be7a703d5bf00bfd503a7e70b8df41872fc2a58ff4040",turbo:"23171b32204a3e2a71453493493eae4b49c54a53d7485ee44569ee4074f53c7ff8378af93295f72e9ff42ba9ef28b3e926bce125c5d925cdcf27d5c629dcbc2de3b232e9a738ee9d3ff39347f68950f9805afc7765fd6e70fe667cfd5e88fc5795fb51a1f84badf545b9f140c5ec3cd0e637dae034e4d931ecd12ef4c92bfac029ffb626ffad24ffa223ff9821ff8d1fff821dff771cfd6c1af76118f05616e84b14df4111d5380fcb2f0dc0260ab61f07ac1805a313029b0f00950c00910b00",browns:"eedbbdecca96e9b97ae4a865dc9856d18954c7784cc0673fb85536ad44339f3632",tealBlues:"bce4d89dd3d181c3cb65b3c245a2b9368fae347da0306a932c5985",teals:"bbdfdfa2d4d58ac9c975bcbb61b0af4da5a43799982b8b8c1e7f7f127273006667",warmGreys:"dcd4d0cec5c1c0b8b4b3aaa7a59c9998908c8b827f7e7673726866665c5a59504e",goldGreen:"f4d166d5ca60b6c35c98bb597cb25760a6564b9c533f8f4f33834a257740146c36",goldOrange:"f4d166f8be5cf8aa4cf5983bf3852aef701be2621fd65322c54923b142239e3a26",goldRed:"f4d166f6be59f9aa51fc964ef6834bee734ae56249db5247cf4244c43141b71d3e",lightGreyRed:"efe9e6e1dad7d5cbc8c8bdb9bbaea9cd967ddc7b43e15f19df4011dc000b",lightGreyTeal:"e4eaead6dcddc8ced2b7c2c7a6b4bc64b0bf22a6c32295c11f85be1876bc",lightMulti:"e0f1f2c4e9d0b0de9fd0e181f6e072f6c053f3993ef77440ef4a3c",lightOrange:"f2e7daf7d5baf9c499fab184fa9c73f68967ef7860e8645bde515bd43d5b",lightTealBlue:"e3e9e0c0dccf9aceca7abfc859afc0389fb9328dad2f7ca0276b95255988",darkBlue:"3232322d46681a5c930074af008cbf05a7ce25c0dd38daed50f3faffffff",darkGold:"3c3c3c584b37725e348c7631ae8b2bcfa424ecc31ef9de30fff184ffffff",darkGreen:"3a3a3a215748006f4d048942489e4276b340a6c63dd2d836ffeb2cffffaa",darkMulti:"3737371f5287197d8c29a86995ce3fffe800ffffff",darkRed:"3434347036339e3c38cc4037e75d1eec8620eeab29f0ce32ffeb2c"},e=>Kl(Pm(e)));const Xp="symbol",Mg="discrete",sl=e=>Object(xe.B)(e)?e.map(t=>String(t)):String(e),Mv=(e,t)=>e[1]-t[1],jg=(e,t)=>t[1]-e[1];function up(e,t,n){let r;return Object(xe.G)(t)&&(e.bins&&(t=Math.max(t,e.bins.length)),n!=null&&(t=Math.min(t,Math.floor(Object(xe.Z)(e.domain())/n||1)))),Object(xe.H)(t)&&(r=t.step,t=t.interval),Object(xe.J)(t)&&(t=e.type===$l?Object(or.p)(t):e.type==Gl?Object(or.v)(t):Object(xe.o)("Only time and utc scales accept interval strings."),r&&(t=t.every(r))),t}function Bg(e,t,n){let r=e.range(),i=r[0],s=Object(xe.W)(r),f=Mv;if(i>s&&(r=s,s=i,i=r,f=jg),i=Math.floor(i),s=Math.ceil(s),t=t.map(m=>[m,e(m)]).filter(m=>i<=m[1]&&m[1]<=s).sort(f).map(m=>m[0]),n>0&&t.length>1){const m=[t[0],Object(xe.W)(t)];for(;t.length>n&&t.length>=3;)t=t.filter((x,O)=>!(O%2));t.length<3&&(t=m)}return t}function Xl(e,t){return e.bins?Bg(e,e.bins):e.ticks?e.ticks(t):e.domain()}function Pg(e,t,n,r,i,s){const f=t.type;let m=sl;if(f===$l||i===$l)m=e.timeFormat(r);else if(f===Gl||i===Gl)m=e.utcFormat(r);else if(Vp(f)){const x=e.formatFloat(r);if(s||t.bins)m=x;else{const O=cp(t,n,!1);m=T=>O(T)?x(T):""}}else if(t.tickFormat){const x=t.domain();m=e.formatSpan(x[0],x[x.length-1],n,r)}else r&&(m=e.format(r));return m}function cp(e,t,n){const r=Xl(e,t),i=e.base(),s=Math.log(i),f=Math.max(1,i*t/r.length),m=x=>{let O=x/Math.pow(i,Math.round(Math.log(x)/s));return O*i<i-.5&&(O*=i),O<=f};return n?r.filter(m):m}const Yp={[$f]:"quantiles",[ol]:"thresholds",[Nc]:"domain"},Lg={[$f]:"quantiles",[ol]:"domain"};function zg(e,t){return e.bins?function(n){const r=n.slice(0,-1);return r.max=Object(xe.W)(n),r}(e.bins):e.type===al?cp(e,t,!0):Yp[e.type]?function(n){const r=[-1/0].concat(n);return r.max=1/0,r}(e[Yp[e.type]]()):Xl(e,t)}const Um=e=>Yp[e.type]||e.bins;function Ug(e,t,n,r,i,s,f){const m=Lg[t.type]&&s!==$l&&s!==Gl?function(x,O,T){const M=O[Lg[O.type]](),q=M.length;let Q,se=q>1?M[1]-M[0]:M[0];for(Q=1;Q<q;++Q)se=Math.min(se,M[Q]-M[Q-1]);return x.formatSpan(0,se,30,T)}(e,t,i):Pg(e,t,n,i,s,f);return r===Xp&&Um(t)?Wg(m):r===Mg?jv(m):Vg(m)}const Wg=e=>(t,n,r)=>{const i=Jf(r[n+1],Jf(r.max,1/0)),s=ul(t,e),f=ul(i,e);return s&&f?s+"  "+f:f?"< "+f:" "+s},Jf=(e,t)=>e??t,jv=e=>(t,n)=>n?e(t):null,Vg=e=>t=>e(t),ul=(e,t)=>Number.isFinite(e)?t(e):null;function Wm(e,t,n,r){const i=r||t.type;return Object(xe.J)(n)&&function(s){return hc(s,Qh)}(i)&&(n=n.replace(/%a/g,"%A").replace(/%b/g,"%B")),n||i!==$l?n||i!==Gl?Ug(e,t,5,null,n,r,!0):e.utcFormat("%A, %d %B %Y, %X UTC"):e.timeFormat("%A, %d %B %Y, %X")}function qg(e,t,n){n=n||{};const r=Math.max(3,n.maxlen||7),i=Wm(e,t,n.format,n.formatType);if(op(t.type)){const s=zg(t).slice(1).map(i),f=s.length;return"".concat(f," boundar").concat(f===1?"y":"ies",": ").concat(s.join(", "))}if(Yf(t.type)){const s=t.domain(),f=s.length,m=f>r?s.slice(0,r-2).map(i).join(", ")+", ending with "+s.slice(-1).map(i):s.map(i).join(", ");return"".concat(f," value").concat(f===1?"":"s",": ").concat(m)}{const s=t.domain();return"values from ".concat(i(s[0])," to ").concat(i(Object(xe.W)(s)))}}let Qf=0;const cl="p_";function Jp(e){return e&&e.gradient}function Vm(e,t,n){const r=e.gradient;let i=e.id,s=r==="radial"?cl:"";return i||(i=e.id="gradient_"+Qf++,r==="radial"?(e.x1=dc(e.x1,.5),e.y1=dc(e.y1,.5),e.r1=dc(e.r1,0),e.x2=dc(e.x2,.5),e.y2=dc(e.y2,.5),e.r2=dc(e.r2,.5),s=cl):(e.x1=dc(e.x1,0),e.y1=dc(e.y1,0),e.x2=dc(e.x2,1),e.y2=dc(e.y2,0))),t[i]=e,"url("+(n||"")+"#"+s+i+")"}function dc(e,t){return e??t}function qm(e,t){var n,r=[];return n={gradient:"linear",x1:e?e[0]:0,y1:e?e[1]:0,x2:t?t[0]:1,y2:t?t[1]:0,stops:r,stop:function(i,s){return r.push({offset:i,color:s}),n}}}const Hg={basis:{curve:function(e){return new jh(e)}},"basis-closed":{curve:function(e){return new Bh(e)}},"basis-open":{curve:function(e){return new Dl(e)}},bundle:{curve:Tl,tension:"beta",value:.85},cardinal:{curve:Lh,tension:"tension",value:0},"cardinal-open":{curve:Nl,tension:"tension",value:0},"cardinal-closed":{curve:km,tension:"tension",value:0},"catmull-rom":{curve:Wu,tension:"alpha",value:.5},"catmull-rom-closed":{curve:qd,tension:"alpha",value:.5},"catmull-rom-open":{curve:jp,tension:"alpha",value:.5},linear:{curve:Yc},"linear-closed":{curve:function(e){return new Hd(e)}},monotone:{horizontal:function(e){return new If(e)},vertical:function(e){return new Ml(e)}},natural:{curve:function(e){return new $d(e)}},step:{curve:function(e){return new jl(e,.5)}},"step-after":{curve:function(e){return new jl(e,1)}},"step-before":{curve:function(e){return new jl(e,0)}}};function Yl(e,t,n){var r=Object(xe.w)(Hg,e)&&Hg[e],i=null;return r&&(i=r.curve||r[t||"vertical"],r.tension&&n!=null&&(i=i[r.tension](n))),i}const Bv={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},ed=[/([MLHVCSQTAZmlhvcsqtaz])/g,/###/,/(\.\d+)(\.\d)/g,/(\d)([-+])/g,/\s|,|###/];function td(e){const t=[];let n,r,i,s,f,m,x,O,T,M;const q=e.slice().replace(ed[0],"###$1").split(ed[1]).slice(1);for(x=0,T=q.length;x<T;++x){for(r=(n=q[x]).slice(1).trim().replace(ed[2],"$1###$2").replace(ed[3],"$1###$2").split(ed[4]),i=[f=n.charAt(0)],O=0,M=r.length;O<M;++O)(s=+r[O])===s&&i.push(s);if(m=Bv[f.toLowerCase()],i.length-1>m){const Q=i.length;for(O=1,t.push([f].concat(i.slice(O,O+=m))),f=f==="M"?"L":f==="m"?"l":f;O<Q;O+=m)t.push([f].concat(i.slice(O,O+m)))}else t.push(i)}return t}const Jl=Math.PI/180,$g=1e-14,Zf=Math.PI/2,pc=2*Math.PI,nd=Math.sqrt(3)/2;var lp={},Qp={},Hm=[].join;function Gg(e){const t=Hm.call(e);if(Qp[t])return Qp[t];var n=e[0],r=e[1],i=e[2],s=e[3],f=e[4],m=e[5],x=e[6],O=e[7];const T=O*f,M=-x*m,q=x*f,Q=O*m,se=Math.cos(i),le=Math.sin(i),Fe=Math.cos(s),Le=Math.sin(s),ze=.5*(s-i),nt=Math.sin(.5*ze),it=8/3*nt*nt/Math.sin(ze),ut=n+se-it*le,st=r+le+it*se,pt=n+Fe,dt=r+Le,Qt=pt+it*Le,mn=dt-it*Fe;return Qp[t]=[T*ut+M*st,q*ut+Q*st,T*Qt+M*mn,q*Qt+Q*mn,T*pt+M*dt,q*pt+Q*dt]}const ns=["l",0,0,0,0,0,0,0];function Kg(e,t,n){const r=ns[0]=e[0];if(r==="a"||r==="A")ns[1]=t*e[1],ns[2]=n*e[2],ns[3]=e[3],ns[4]=e[4],ns[5]=e[5],ns[6]=t*e[6],ns[7]=n*e[7];else if(r==="h"||r==="H")ns[1]=t*e[1];else if(r==="v"||r==="V")ns[1]=n*e[1];else for(var i=1,s=e.length;i<s;++i)ns[i]=(i%2==1?t:n)*e[i];return ns}function rd(e,t,n,r,i,s){var f,m,x,O,T,M=null,q=0,Q=0,se=0,le=0;n==null&&(n=0),r==null&&(r=0),i==null&&(i=1),s==null&&(s=i),e.beginPath&&e.beginPath();for(var Fe=0,Le=t.length;Fe<Le;++Fe){switch(f=t[Fe],i===1&&s===1||(f=Kg(f,i,s)),f[0]){case"l":q+=f[1],Q+=f[2],e.lineTo(q+n,Q+r);break;case"L":q=f[1],Q=f[2],e.lineTo(q+n,Q+r);break;case"h":q+=f[1],e.lineTo(q+n,Q+r);break;case"H":q=f[1],e.lineTo(q+n,Q+r);break;case"v":Q+=f[1],e.lineTo(q+n,Q+r);break;case"V":Q=f[1],e.lineTo(q+n,Q+r);break;case"m":q+=f[1],Q+=f[2],e.moveTo(q+n,Q+r);break;case"M":q=f[1],Q=f[2],e.moveTo(q+n,Q+r);break;case"c":m=q+f[5],x=Q+f[6],se=q+f[3],le=Q+f[4],e.bezierCurveTo(q+f[1]+n,Q+f[2]+r,se+n,le+r,m+n,x+r),q=m,Q=x;break;case"C":q=f[5],Q=f[6],se=f[3],le=f[4],e.bezierCurveTo(f[1]+n,f[2]+r,se+n,le+r,q+n,Q+r);break;case"s":m=q+f[3],x=Q+f[4],se=2*q-se,le=2*Q-le,e.bezierCurveTo(se+n,le+r,q+f[1]+n,Q+f[2]+r,m+n,x+r),se=q+f[1],le=Q+f[2],q=m,Q=x;break;case"S":m=f[3],x=f[4],se=2*q-se,le=2*Q-le,e.bezierCurveTo(se+n,le+r,f[1]+n,f[2]+r,m+n,x+r),q=m,Q=x,se=f[1],le=f[2];break;case"q":m=q+f[3],x=Q+f[4],se=q+f[1],le=Q+f[2],e.quadraticCurveTo(se+n,le+r,m+n,x+r),q=m,Q=x;break;case"Q":m=f[3],x=f[4],e.quadraticCurveTo(f[1]+n,f[2]+r,m+n,x+r),q=m,Q=x,se=f[1],le=f[2];break;case"t":m=q+f[1],x=Q+f[2],M[0].match(/[QqTt]/)===null?(se=q,le=Q):M[0]==="t"?(se=2*q-O,le=2*Q-T):M[0]==="q"&&(se=2*q-se,le=2*Q-le),O=se,T=le,e.quadraticCurveTo(se+n,le+r,m+n,x+r),Q=x,se=(q=m)+f[1],le=Q+f[2];break;case"T":m=f[1],x=f[2],se=2*q-se,le=2*Q-le,e.quadraticCurveTo(se+n,le+r,m+n,x+r),q=m,Q=x;break;case"a":Xg(e,q+n,Q+r,[f[1],f[2],f[3],f[4],f[5],f[6]+q+n,f[7]+Q+r]),q+=f[6],Q+=f[7];break;case"A":Xg(e,q+n,Q+r,[f[1],f[2],f[3],f[4],f[5],f[6]+n,f[7]+r]),q=f[6],Q=f[7];break;case"z":case"Z":e.closePath()}M=f}}function Xg(e,t,n,r){const i=function(s,f,m,x,O,T,M,q,Q){const se=Hm.call(arguments);if(lp[se])return lp[se];const le=M*Jl,Fe=Math.sin(le),Le=Math.cos(le),ze=Le*(q-s)*.5+Fe*(Q-f)*.5,nt=Le*(Q-f)*.5-Fe*(q-s)*.5;let it=ze*ze/((m=Math.abs(m))*m)+nt*nt/((x=Math.abs(x))*x);it>1&&(m*=it=Math.sqrt(it),x*=it);const ut=Le/m,st=Fe/m,pt=-Fe/x,dt=Le/x,Qt=ut*q+st*Q,mn=pt*q+dt*Q,on=ut*s+st*f,Rn=pt*s+dt*f;let Fn=1/((on-Qt)*(on-Qt)+(Rn-mn)*(Rn-mn))-.25;Fn<0&&(Fn=0);let zn=Math.sqrt(Fn);T==O&&(zn=-zn);const Vn=.5*(Qt+on)-zn*(Rn-mn),Qn=.5*(mn+Rn)+zn*(on-Qt),pr=Math.atan2(mn-Qn,Qt-Vn);let Pr=Math.atan2(Rn-Qn,on-Vn)-pr;Pr<0&&T===1?Pr+=pc:Pr>0&&T===0&&(Pr-=pc);const Ar=Math.ceil(Math.abs(Pr/(Zf+.001))),Jr=[];for(let gi=0;gi<Ar;++gi){const vi=pr+gi*Pr/Ar,Li=pr+(gi+1)*Pr/Ar;Jr[gi]=[Vn,Qn,vi,Li,m,x,Fe,Le]}return lp[se]=Jr}(r[5],r[6],r[0],r[1],r[3],r[4],r[2],t,n);for(let s=0;s<i.length;++s){const f=Gg(i[s]);e.bezierCurveTo(f[0],f[1],f[2],f[3],f[4],f[5])}}const Zp={circle:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(n,0),e.arc(0,0,n,0,pc)}},cross:{draw:function(e,t){var n=Math.sqrt(t)/2,r=n/2.5;e.moveTo(-n,-r),e.lineTo(-n,r),e.lineTo(-r,r),e.lineTo(-r,n),e.lineTo(r,n),e.lineTo(r,r),e.lineTo(n,r),e.lineTo(n,-r),e.lineTo(r,-r),e.lineTo(r,-n),e.lineTo(-r,-n),e.lineTo(-r,-r),e.closePath()}},diamond:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(-n,0),e.lineTo(0,-n),e.lineTo(n,0),e.lineTo(0,n),e.closePath()}},square:{draw:function(e,t){var n=Math.sqrt(t),r=-n/2;e.rect(r,r,n,n)}},arrow:{draw:function(e,t){var n=Math.sqrt(t)/2,r=n/7,i=n/2.5,s=n/8;e.moveTo(-r,n),e.lineTo(r,n),e.lineTo(r,-s),e.lineTo(i,-s),e.lineTo(0,-n),e.lineTo(-i,-s),e.lineTo(-r,-s),e.closePath()}},wedge:{draw:function(e,t){var n=Math.sqrt(t)/2,r=nd*n,i=r-.5773502691896257*n,s=n/4;e.moveTo(0,-r-i),e.lineTo(-s,r-i),e.lineTo(s,r-i),e.closePath()}},triangle:{draw:function(e,t){var n=Math.sqrt(t)/2,r=nd*n,i=r-.5773502691896257*n;e.moveTo(0,-r-i),e.lineTo(-n,r-i),e.lineTo(n,r-i),e.closePath()}},"triangle-up":{draw:function(e,t){var n=Math.sqrt(t)/2,r=nd*n;e.moveTo(0,-r),e.lineTo(-n,r),e.lineTo(n,r),e.closePath()}},"triangle-down":{draw:function(e,t){var n=Math.sqrt(t)/2,r=nd*n;e.moveTo(0,r),e.lineTo(-n,-r),e.lineTo(n,-r),e.closePath()}},"triangle-right":{draw:function(e,t){var n=Math.sqrt(t)/2,r=nd*n;e.moveTo(r,0),e.lineTo(-r,-n),e.lineTo(-r,n),e.closePath()}},"triangle-left":{draw:function(e,t){var n=Math.sqrt(t)/2,r=nd*n;e.moveTo(-r,0),e.lineTo(r,-n),e.lineTo(r,n),e.closePath()}},stroke:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(-n,0),e.lineTo(n,0)}}};function Ql(e){return Object(xe.w)(Zp,e)?Zp[e]:function(t){if(!Object(xe.w)(fp,t)){const n=td(t);fp[t]={draw:function(r,i){rd(r,n,0,0,Math.sqrt(i)/2)}}}return fp[t]}(e)}var fp={};const ll=.448084975506;function Yg(e){return e.x}function em(e){return e.y}function tm(e){return e.width}function $m(e){return e.height}function Fc(e){return typeof e=="function"?e:()=>+e}function nm(e,t,n){return Math.max(t,Math.min(e,n))}function Jg(){var e=Yg,t=em,n=tm,r=$m,i=Fc(0),s=i,f=i,m=i,x=null;function O(T,M,q){var Q,se=M??+e.call(this,T),le=q??+t.call(this,T),Fe=+n.call(this,T),Le=+r.call(this,T),ze=Math.min(Fe,Le)/2,nt=nm(+i.call(this,T),0,ze),it=nm(+s.call(this,T),0,ze),ut=nm(+f.call(this,T),0,ze),st=nm(+m.call(this,T),0,ze);if(x||(x=Q=Os()),nt<=0&&it<=0&&ut<=0&&st<=0)x.rect(se,le,Fe,Le);else{var pt=se+Fe,dt=le+Le;x.moveTo(se+nt,le),x.lineTo(pt-it,le),x.bezierCurveTo(pt-ll*it,le,pt,le+ll*it,pt,le+it),x.lineTo(pt,dt-st),x.bezierCurveTo(pt,dt-ll*st,pt-ll*st,dt,pt-st,dt),x.lineTo(se+ut,dt),x.bezierCurveTo(se+ll*ut,dt,se,dt-ll*ut,se,dt-ut),x.lineTo(se,le+nt),x.bezierCurveTo(se,le+ll*nt,se+ll*nt,le,se+nt,le),x.closePath()}if(Q)return x=null,Q+""||null}return O.x=function(T){return arguments.length?(e=Fc(T),O):e},O.y=function(T){return arguments.length?(t=Fc(T),O):t},O.width=function(T){return arguments.length?(n=Fc(T),O):n},O.height=function(T){return arguments.length?(r=Fc(T),O):r},O.cornerRadius=function(T,M,q,Q){return arguments.length?(i=Fc(T),s=M!=null?Fc(M):i,m=q!=null?Fc(q):i,f=Q!=null?Fc(Q):s,O):i},O.context=function(T){return arguments.length?(x=T??null,O):x},O}function fl(){var e,t,n,r,i,s,f,m,x=null;function O(M,q,Q){const se=Q/2;if(i){var le=f-q,Fe=M-s;if(le||Fe){var Le=Math.sqrt(le*le+Fe*Fe),ze=(le/=Le)*m,nt=(Fe/=Le)*m,it=Math.atan2(Fe,le);x.moveTo(s-ze,f-nt),x.lineTo(M-le*se,q-Fe*se),x.arc(M,q,se,it-Math.PI,it),x.lineTo(s+ze,f+nt),x.arc(s,f,m,it,it+Math.PI)}else x.arc(M,q,se,0,pc);x.closePath()}else i=1;s=M,f=q,m=se}function T(M){var q,Q,se,le=M.length,Fe=!1;for(x==null&&(x=se=Os()),q=0;q<=le;++q)!(q<le&&r(Q=M[q],q,M))===Fe&&(Fe=!Fe)&&(i=0),Fe&&O(+e(Q,q,M),+t(Q,q,M),+n(Q,q,M));if(se)return x=null,se+""||null}return T.x=function(M){return arguments.length?(e=M,T):e},T.y=function(M){return arguments.length?(t=M,T):t},T.size=function(M){return arguments.length?(n=M,T):n},T.defined=function(M){return arguments.length?(r=M,T):r},T.context=function(M){return arguments.length?(x=M??null,T):x},T}function hp(e,t){return e??t}const eh=e=>e.x||0,dp=e=>e.y||0,rs=e=>e.defined!==!1,rm=function(){var e=Bl,t=Rf,n=na(0),r=null,i=nr,s=Go,f=bo,m=null;function x(){var O,T,M=+e.apply(this,arguments),q=+t.apply(this,arguments),Q=i.apply(this,arguments)-Uu,se=s.apply(this,arguments)-Uu,le=Il(se-Q),Fe=se>Q;if(m||(m=O=Os()),q<M&&(T=q,q=M,M=T),q>Ro)if(le>Df-Ro)m.moveTo(q*Ao(Q),q*Es(Q)),m.arc(0,0,q,Q,se,!Fe),M>Ro&&(m.moveTo(M*Ao(se),M*Es(se)),m.arc(0,0,M,se,Q,Fe));else{var Le,ze,nt=Q,it=se,ut=Q,st=se,pt=le,dt=le,Qt=f.apply(this,arguments)/2,mn=Qt>Ro&&(r?+r.apply(this,arguments):Oc(M*M+q*q)),on=Mi(Il(q-M)/2,+n.apply(this,arguments)),Rn=on,Fn=on;if(mn>Ro){var zn=Tf(mn/M*Es(Qt)),Vn=Tf(mn/q*Es(Qt));(pt-=2*zn)>Ro?(ut+=zn*=Fe?1:-1,st-=zn):(pt=0,ut=st=(Q+se)/2),(dt-=2*Vn)>Ro?(nt+=Vn*=Fe?1:-1,it-=Vn):(dt=0,nt=it=(Q+se)/2)}var Qn=q*Ao(nt),pr=q*Es(nt),Pr=M*Ao(st),Ar=M*Es(st);if(on>Ro){var Jr,gi=q*Ao(it),vi=q*Es(it),Li=M*Ao(ut),wi=M*Es(ut);if(le<Ac&&(Jr=function(Lo,co,Is,Fs,gs,kl,$k,BA){var qb=Is-Lo,y0=Fs-co,Hb=$k-gs,cy=BA-kl,kh=cy*qb-Hb*y0;if(!(kh*kh<Ro))return[Lo+(kh=(Hb*(co-kl)-cy*(Lo-gs))/kh)*qb,co+kh*y0]}(Qn,pr,Li,wi,gi,vi,Pr,Ar))){var yi=Qn-Jr[0],Si=pr-Jr[1],xa=gi-Jr[0],no=vi-Jr[1],zi=1/Es(function(Lo){return Lo>1?0:Lo<-1?Ac:Math.acos(Lo)}((yi*xa+Si*no)/(Oc(yi*yi+Si*Si)*Oc(xa*xa+no*no)))/2),vo=Oc(Jr[0]*Jr[0]+Jr[1]*Jr[1]);Rn=Mi(on,(M-vo)/(zi-1)),Fn=Mi(on,(q-vo)/(zi+1))}}dt>Ro?Fn>Ro?(Le=Hi(Li,wi,Qn,pr,q,Fn,Fe),ze=Hi(gi,vi,Pr,Ar,q,Fn,Fe),m.moveTo(Le.cx+Le.x01,Le.cy+Le.y01),Fn<on?m.arc(Le.cx,Le.cy,Fn,eo(Le.y01,Le.x01),eo(ze.y01,ze.x01),!Fe):(m.arc(Le.cx,Le.cy,Fn,eo(Le.y01,Le.x01),eo(Le.y11,Le.x11),!Fe),m.arc(0,0,q,eo(Le.cy+Le.y11,Le.cx+Le.x11),eo(ze.cy+ze.y11,ze.cx+ze.x11),!Fe),m.arc(ze.cx,ze.cy,Fn,eo(ze.y11,ze.x11),eo(ze.y01,ze.x01),!Fe))):(m.moveTo(Qn,pr),m.arc(0,0,q,nt,it,!Fe)):m.moveTo(Qn,pr),M>Ro&&pt>Ro?Rn>Ro?(Le=Hi(Pr,Ar,gi,vi,M,-Rn,Fe),ze=Hi(Qn,pr,Li,wi,M,-Rn,Fe),m.lineTo(Le.cx+Le.x01,Le.cy+Le.y01),Rn<on?m.arc(Le.cx,Le.cy,Rn,eo(Le.y01,Le.x01),eo(ze.y01,ze.x01),!Fe):(m.arc(Le.cx,Le.cy,Rn,eo(Le.y01,Le.x01),eo(Le.y11,Le.x11),!Fe),m.arc(0,0,M,eo(Le.cy+Le.y11,Le.cx+Le.x11),eo(ze.cy+ze.y11,ze.cx+ze.x11),Fe),m.arc(ze.cx,ze.cy,Rn,eo(ze.y11,ze.x11),eo(ze.y01,ze.x01),!Fe))):m.arc(0,0,M,st,ut,Fe):m.lineTo(Pr,Ar)}else m.moveTo(0,0);if(m.closePath(),O)return m=null,O+""||null}return x.centroid=function(){var O=(+e.apply(this,arguments)+ +t.apply(this,arguments))/2,T=(+i.apply(this,arguments)+ +s.apply(this,arguments))/2-Ac/2;return[Ao(T)*O,Es(T)*O]},x.innerRadius=function(O){return arguments.length?(e=typeof O=="function"?O:na(+O),x):e},x.outerRadius=function(O){return arguments.length?(t=typeof O=="function"?O:na(+O),x):t},x.cornerRadius=function(O){return arguments.length?(n=typeof O=="function"?O:na(+O),x):n},x.padRadius=function(O){return arguments.length?(r=O==null?null:typeof O=="function"?O:na(+O),x):r},x.startAngle=function(O){return arguments.length?(i=typeof O=="function"?O:na(+O),x):i},x.endAngle=function(O){return arguments.length?(s=typeof O=="function"?O:na(+O),x):s},x.padAngle=function(O){return arguments.length?(f=typeof O=="function"?O:na(+O),x):f},x.context=function(O){return arguments.length?(m=O??null,x):m},x}().startAngle(e=>e.startAngle||0).endAngle(e=>e.endAngle||0).padAngle(e=>e.padAngle||0).innerRadius(e=>e.innerRadius||0).outerRadius(e=>e.outerRadius||0).cornerRadius(e=>e.cornerRadius||0),Gm=Ka().x(eh).y1(dp).y0(e=>(e.y||0)+(e.height||0)).defined(rs),pp=Ka().y(dp).x1(eh).x0(e=>(e.x||0)+(e.width||0)).defined(rs),mp=sc().x(eh).y(dp).defined(rs),Km=Jg().x(eh).y(dp).width(e=>e.width||0).height(e=>e.height||0).cornerRadius(e=>hp(e.cornerRadiusTopLeft,e.cornerRadius)||0,e=>hp(e.cornerRadiusTopRight,e.cornerRadius)||0,e=>hp(e.cornerRadiusBottomRight,e.cornerRadius)||0,e=>hp(e.cornerRadiusBottomLeft,e.cornerRadius)||0),Qg=function(e,t){var n=null;function r(){var i;if(n||(n=i=Os()),e.apply(this,arguments).draw(n,+t.apply(this,arguments)),i)return n=null,i+""||null}return e=typeof e=="function"?e:na(e||Vu),t=typeof t=="function"?t:na(t===void 0?64:+t),r.type=function(i){return arguments.length?(e=typeof i=="function"?i:na(i),r):e},r.size=function(i){return arguments.length?(t=typeof i=="function"?i:na(+i),r):t},r.context=function(i){return arguments.length?(n=i??null,r):n},r}().type(e=>Ql(e.shape||"circle")).size(e=>hp(e.size,64)),Pv=fl().x(eh).y(dp).defined(rs).size(e=>e.size||1);function Rc(e){return e.cornerRadius||e.cornerRadiusTopLeft||e.cornerRadiusTopRight||e.cornerRadiusBottomRight||e.cornerRadiusBottomLeft}function th(e,t,n,r){return Km.context(e)(t,n,r)}var Lv=1;function Zg(){Lv=1}function Mc(e,t,n){var r=t.clip,i=e._defs,s=t.clip_id||(t.clip_id="clip"+Lv++),f=i.clipping[s]||(i.clipping[s]={id:s});return Object(xe.E)(r)?f.path=r(null):Rc(n)?f.path=th(null,n,0,0):(f.width=n.width||0,f.height=n.height||0),"url(#"+s+")"}function Xo(e){this.clear(),e&&this.union(e)}function id(e){this.mark=e,this.bounds=this.bounds||new Xo}function gp(e){id.call(this,e),this.items=this.items||[]}function im(e){this._pending=0,this._loader=e||Object(Xn.e)()}function ev(e){e._pending+=1}function am(e){e._pending-=1}function Zl(e,t,n){if(t.stroke&&t.opacity!==0&&t.strokeOpacity!==0){const r=t.strokeWidth!=null?+t.strokeWidth:1;e.expand(r+(n?function(i,s){return i.strokeJoin&&i.strokeJoin!=="miter"?0:s}(t,r):0))}return e}Xo.prototype={clone(){return new Xo(this)},clear(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this},empty(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE},equals(e){return this.x1===e.x1&&this.y1===e.y1&&this.x2===e.x2&&this.y2===e.y2},set(e,t,n,r){return n<e?(this.x2=e,this.x1=n):(this.x1=e,this.x2=n),r<t?(this.y2=t,this.y1=r):(this.y1=t,this.y2=r),this},add(e,t){return e<this.x1&&(this.x1=e),t<this.y1&&(this.y1=t),e>this.x2&&(this.x2=e),t>this.y2&&(this.y2=t),this},expand(e){return this.x1-=e,this.y1-=e,this.x2+=e,this.y2+=e,this},round(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this},scale(e){return this.x1*=e,this.y1*=e,this.x2*=e,this.y2*=e,this},translate(e,t){return this.x1+=e,this.x2+=e,this.y1+=t,this.y2+=t,this},rotate(e,t,n){const r=this.rotatedPoints(e,t,n);return this.clear().add(r[0],r[1]).add(r[2],r[3]).add(r[4],r[5]).add(r[6],r[7])},rotatedPoints(e,t,n){var{x1:r,y1:i,x2:s,y2:f}=this,m=Math.cos(e),x=Math.sin(e),O=t-t*m+n*x,T=n-t*x-n*m;return[m*r-x*i+O,x*r+m*i+T,m*r-x*f+O,x*r+m*f+T,m*s-x*i+O,x*s+m*i+T,m*s-x*f+O,x*s+m*f+T]},union(e){return e.x1<this.x1&&(this.x1=e.x1),e.y1<this.y1&&(this.y1=e.y1),e.x2>this.x2&&(this.x2=e.x2),e.y2>this.y2&&(this.y2=e.y2),this},intersect(e){return e.x1>this.x1&&(this.x1=e.x1),e.y1>this.y1&&(this.y1=e.y1),e.x2<this.x2&&(this.x2=e.x2),e.y2<this.y2&&(this.y2=e.y2),this},encloses(e){return e&&this.x1<=e.x1&&this.x2>=e.x2&&this.y1<=e.y1&&this.y2>=e.y2},alignsWith(e){return e&&(this.x1==e.x1||this.x2==e.x2||this.y1==e.y1||this.y2==e.y2)},intersects(e){return e&&!(this.x2<e.x1||this.x1>e.x2||this.y2<e.y1||this.y1>e.y2)},contains(e,t){return!(e<this.x1||e>this.x2||t<this.y1||t>this.y2)},width(){return this.x2-this.x1},height(){return this.y2-this.y1}},Object(xe.z)(gp,id),im.prototype={pending(){return this._pending},sanitizeURL(e){const t=this;return ev(t),t._loader.sanitize(e,{context:"href"}).then(n=>(am(t),n)).catch(()=>(am(t),null))},loadImage(e){const t=this,n=oa();return ev(t),t._loader.sanitize(e,{context:"image"}).then(r=>{const i=r.href;if(!i||!n)throw{url:i};const s=new n,f=Object(xe.w)(r,"crossOrigin")?r.crossOrigin:"anonymous";return f!=null&&(s.crossOrigin=f),s.onload=()=>am(t),s.onerror=()=>am(t),s.src=i,s}).catch(r=>(am(t),{complete:!1,width:0,height:0,src:r&&r.url||""}))},ready(){const e=this;return new Promise(t=>{(function n(r){e.pending()?setTimeout(()=>{n(!0)},10):t(r)})(!1)})}};const E0=pc-1e-8;let om,qo,vp,nh,sm,yp,Xm,Ym;const ef=(e,t)=>om.add(e,t),$u=(e,t)=>ef(qo=e,vp=t),tv=e=>ef(e,om.y1),nv=e=>ef(om.x1,e),ad=(e,t)=>sm*e+Xm*t,bp=(e,t)=>yp*e+Ym*t,zv=(e,t)=>ef(ad(e,t),bp(e,t)),Jm=(e,t)=>$u(ad(e,t),bp(e,t));function um(e,t){return om=e,t?(nh=t*Jl,sm=Ym=Math.cos(nh),yp=Math.sin(nh),Xm=-yp):(sm=Ym=1,nh=yp=Xm=0),Ir}const Ir={beginPath(){},closePath(){},moveTo:Jm,lineTo:Jm,rect(e,t,n,r){nh?(zv(e+n,t),zv(e+n,t+r),zv(e,t+r),Jm(e,t)):(ef(e+n,t+r),$u(e,t))},quadraticCurveTo(e,t,n,r){const i=ad(e,t),s=bp(e,t),f=ad(n,r),m=bp(n,r);I(qo,i,f,tv),I(vp,s,m,nv),$u(f,m)},bezierCurveTo(e,t,n,r,i,s){const f=ad(e,t),m=bp(e,t),x=ad(n,r),O=bp(n,r),T=ad(i,s),M=bp(i,s);E(qo,f,x,T,tv),E(vp,m,O,M,nv),$u(T,M)},arc(e,t,n,r,i,s){if(r+=nh,i+=nh,qo=n*Math.cos(i)+e,vp=n*Math.sin(i)+t,Math.abs(i-r)>E0)ef(e-n,t-n),ef(e+n,t+n);else{const f=O=>ef(n*Math.cos(O)+e,n*Math.sin(O)+t);let m,x;if(f(r),f(i),i!==r)if((r%=pc)<0&&(r+=pc),(i%=pc)<0&&(i+=pc),i<r&&(s=!s,m=r,r=i,i=m),s)for(i-=pc,m=r-r%Zf,x=0;x<4&&m>i;++x,m-=Zf)f(m);else for(m=r-r%Zf+Zf,x=0;x<4&&m<i;++x,m+=Zf)f(m)}}};function I(e,t,n,r){const i=(e-t)/(e+n-2*t);0<i&&i<1&&r(e+(t-e)*i)}function E(e,t,n,r,i){const s=r-e+3*t-3*n,f=e+n-2*t,m=e-t;let x,O=0,T=0;Math.abs(s)>$g?(x=f*f+m*s)>=0&&(O=(-f+(x=Math.sqrt(x)))/s,T=(-f-x)/s):O=.5*m/f,0<O&&O<1&&i(k(O,e,t,n,r)),0<T&&T<1&&i(k(T,e,t,n,r))}function k(e,t,n,r,i){const s=1-e,f=s*s,m=e*e;return f*s*t+3*f*e*n+3*s*m*r+m*e*i}var w=(w=qs(1,1))?w.getContext("2d"):null;const S=new Xo;function z(e){return function(t,n){if(!w)return!0;e(w,t),S.clear().union(t.bounds).intersect(n).round();const{x1:r,y1:i,x2:s,y2:f}=S;for(let m=i;m<=f;++m)for(let x=r;x<=s;++x)if(w.isPointInPath(x,m))return!0;return!1}}function Y(e,t){return t.contains(e.x||0,e.y||0)}function ce(e,t){const n=e.x||0,r=e.y||0,i=e.width||0,s=e.height||0;return t.intersects(S.set(n,r,n+i,r+s))}function ve(e,t){const n=e.x||0,r=e.y||0;return De(t,n,r,e.x2!=null?e.x2:n,e.y2!=null?e.y2:r)}function De(e,t,n,r,i){const{x1:s,y1:f,x2:m,y2:x}=e,O=r-t,T=i-n;let M,q,Q,se,le=0,Fe=1;for(se=0;se<4;++se){if(se===0&&(M=-O,q=-(s-t)),se===1&&(M=O,q=m-t),se===2&&(M=-T,q=-(f-n)),se===3&&(M=T,q=x-n),Math.abs(M)<1e-10&&q<0)return!1;if(Q=q/M,M<0){if(Q>Fe)return!1;Q>le&&(le=Q)}else if(M>0){if(Q<le)return!1;Q<Fe&&(Fe=Q)}}return!0}function Ce(e,t){e.globalCompositeOperation=t.blend||"source-over"}function Xe(e,t){return e??t}function tt(e,t){const n=t.length;for(let r=0;r<n;++r)e.addColorStop(t[r].offset,t[r].color);return e}function kt(e,t,n){return Jp(n)?function(r,i,s){const f=s.width(),m=s.height();let x;if(i.gradient==="radial")x=r.createRadialGradient(s.x1+Xe(i.x1,.5)*f,s.y1+Xe(i.y1,.5)*m,Math.max(f,m)*Xe(i.r1,0),s.x1+Xe(i.x2,.5)*f,s.y1+Xe(i.y2,.5)*m,Math.max(f,m)*Xe(i.r2,.5));else{const O=Xe(i.x1,0),T=Xe(i.y1,0),M=Xe(i.x2,1),q=Xe(i.y2,0);if(O!==M&&T!==q&&f!==m){const Q=qs(Math.ceil(f),Math.ceil(m)),se=Q.getContext("2d");return se.scale(f,m),se.fillStyle=tt(se.createLinearGradient(O,T,M,q),i.stops),se.fillRect(0,0,f,m),r.createPattern(Q,"no-repeat")}x=r.createLinearGradient(s.x1+O*f,s.y1+T*m,s.x1+M*f,s.y1+q*m)}return tt(x,i.stops)}(e,n,t.bounds):n}function At(e,t,n){return(n*=t.fillOpacity==null?1:t.fillOpacity)>0&&(e.globalAlpha=n,e.fillStyle=kt(e,t,t.fill),!0)}var tn=[];function sn(e,t,n){var r=(r=t.strokeWidth)!=null?r:1;return!(r<=0)&&(n*=t.strokeOpacity==null?1:t.strokeOpacity)>0&&(e.globalAlpha=n,e.strokeStyle=kt(e,t,t.stroke),e.lineWidth=r,e.lineCap=t.strokeCap||"butt",e.lineJoin=t.strokeJoin||"miter",e.miterLimit=t.strokeMiterLimit||10,e.setLineDash&&(e.setLineDash(t.strokeDash||tn),e.lineDashOffset=t.strokeDashOffset||0),!0)}function wn(e,t){return e.zindex-t.zindex||e.index-t.index}function En(e){if(!e.zdirty)return e.zitems;var t,n,r,i=e.items,s=[];for(n=0,r=i.length;n<r;++n)(t=i[n]).index=n,t.zindex&&s.push(t);return e.zdirty=!1,e.zitems=s.sort(wn)}function Tn(e,t){var n,r,i=e.items;if(!i||!i.length)return;const s=En(e);if(s&&s.length){for(n=0,r=i.length;n<r;++n)i[n].zindex||t(i[n]);i=s}for(n=0,r=i.length;n<r;++n)t(i[n])}function Pn(e,t){var n,r,i=e.items;if(!i||!i.length)return null;const s=En(e);for(s&&s.length&&(i=s),r=i.length;--r>=0;)if(n=t(i[r]))return n;if(i===s){for(r=(i=e.items).length;--r>=0;)if(!i[r].zindex&&(n=t(i[r])))return n}return null}function dn(e){return function(t,n,r){Tn(n,i=>{r&&!r.intersects(i.bounds)||cr(e,t,i,i)})}}function cr(e,t,n,r){var i=n.opacity==null?1:n.opacity;i!==0&&(e(t,r)||(Ce(t,n),n.fill&&At(t,n,i)&&t.fill(),n.stroke&&sn(t,n,i)&&t.stroke()))}function kr(e){return e=e||xe.Ia,function(t,n,r,i,s,f){return r*=t.pixelRatio,i*=t.pixelRatio,Pn(n,m=>{const x=m.bounds;if((!x||x.contains(s,f))&&x)return e(t,m,r,i,s,f)?m:void 0})}}function yr(e,t){return function(n,r,i,s){var f,m,x=Array.isArray(r)?r[0]:r,O=t??x.fill,T=x.stroke&&n.isPointInStroke;return T&&(f=x.strokeWidth,m=x.strokeCap,n.lineWidth=f??1,n.lineCap=m??"butt"),!e(n,r)&&(O&&n.isPointInPath(i,s)||T&&n.isPointInStroke(i,s))}}function Br(e){return kr(yr(e))}function _r(e,t){return"translate("+e+","+t+")"}function hi(e){return"rotate("+e+")"}function Ei(e){return _r(e.x||0,e.y||0)}function xi(e,t,n){function r(i,s){var f=s.x||0,m=s.y||0,x=s.angle||0;i.translate(f,m),x&&i.rotate(x*=Jl),i.beginPath(),t(i,s),x&&i.rotate(-x),i.translate(-f,-m)}return{type:e,tag:"path",nested:!1,attr:function(i,s){i("transform",function(f){return _r(f.x||0,f.y||0)+(f.angle?" "+hi(f.angle):"")}(s)),i("d",t(null,s))},bound:function(i,s){return t(um(i,s.angle),s),Zl(i,s).translate(s.x||0,s.y||0)},draw:dn(r),pick:Br(r),isect:n||z(r)}}var ya=xi("arc",function(e,t){return rm.context(e)(t)});function Ua(e,t,n){function r(s,f){s.beginPath(),t(s,f)}const i=yr(r);return{type:e,tag:"path",nested:!0,attr:function(s,f){var m=f.mark.items;m.length&&s("d",t(null,m))},bound:function(s,f){var m=f.items;return m.length===0?s:(t(um(s),m),Zl(s,m[0]))},draw:function(s){return function(f,m,x){!m.items.length||x&&!x.intersects(m.bounds)||cr(s,f,m.items[0],m.items)}}(r),pick:function(s,f,m,x,O,T){var M=f.items,q=f.bounds;return!M||!M.length||q&&!q.contains(O,T)?null:(m*=s.pixelRatio,x*=s.pixelRatio,i(s,M,m,x)?M[0]:null)},isect:Y,tip:n}}var Ta=Ua("area",function(e,t){const n=t[0],r=n.interpolate||"linear";return(n.orient==="horizontal"?pp:Gm).curve(Yl(r,n.orient,n.tension)).context(e)(t)},function(e,t){for(var n,r,i=e[0].orient==="horizontal"?t[1]:t[0],s=e[0].orient==="horizontal"?"y":"x",f=e.length,m=1/0;--f>=0;)e[f].defined!==!1&&(r=Math.abs(e[f][s]-i))<m&&(m=r,n=e[f]);return n});function Da(e,t){e.beginPath(),Rc(t)?th(e,t,0,0):e.rect(0,0,t.width||0,t.height||0),e.clip()}function Ra(e){const t=Xe(e.strokeWidth,1);return e.strokeOffset!=null?e.strokeOffset:e.stroke&&t>.5&&t<1.5?.5-Math.abs(t-1):0}function Qa(e,t){const n=Ra(t);e("d",th(null,t,n,n))}function oo(e,t,n,r){const i=Ra(t);e.beginPath(),th(e,t,(n||0)+i,(r||0)+i)}const wo=yr(oo),Ks=yr(oo,!1),Ti=yr(oo,!0);var Ho={type:"group",tag:"g",nested:!1,attr:function(e,t){e("transform",Ei(t))},bound:function(e,t){if(!t.clip&&t.items){const n=t.items,r=n.length;for(let i=0;i<r;++i)e.union(n[i].bounds)}return(t.clip||t.width||t.height)&&!t.noBound&&e.add(0,0).add(t.width||0,t.height||0),Zl(e,t),e.translate(t.x||0,t.y||0)},draw:function(e,t,n){Tn(t,r=>{const i=r.x||0,s=r.y||0,f=r.strokeForeground,m=r.opacity==null?1:r.opacity;(r.stroke||r.fill)&&m&&(oo(e,r,i,s),Ce(e,r),r.fill&&At(e,r,m)&&e.fill(),r.stroke&&!f&&sn(e,r,m)&&e.stroke()),e.save(),e.translate(i,s),r.clip&&Da(e,r),n&&n.translate(-i,-s),Tn(r,x=>{this.draw(e,x,n)}),n&&n.translate(i,s),e.restore(),f&&r.stroke&&m&&(oo(e,r,i,s),Ce(e,r),sn(e,r,m)&&e.stroke())})},pick:function(e,t,n,r,i,s){if(t.bounds&&!t.bounds.contains(i,s)||!t.items)return null;const f=n*e.pixelRatio,m=r*e.pixelRatio;return Pn(t,x=>{let O,T,M;const q=x.bounds;if(q&&!q.contains(i,s))return;T=x.x||0,M=x.y||0;const Q=T+(x.width||0),se=M+(x.height||0),le=x.clip;if(le&&(i<T||i>Q||s<M||s>se))return;if(e.save(),e.translate(T,M),T=i-T,M=s-M,le&&Rc(x)&&!Ti(e,x,f,m))return e.restore(),null;const Fe=x.strokeForeground,Le=t.interactive!==!1;return Le&&Fe&&x.stroke&&Ks(e,x,f,m)?(e.restore(),x):(!(O=Pn(x,ze=>function(nt,it,ut){return(nt.interactive!==!1||nt.marktype==="group")&&nt.bounds&&nt.bounds.contains(it,ut)}(ze,T,M)?this.pick(ze,n,r,T,M):null))&&Le&&(x.fill||!Fe&&x.stroke)&&wo(e,x,f,m)&&(O=x),e.restore(),O||null)})},isect:ce,content:function(e,t,n){e("clip-path",t.clip?Mc(n,t,t):null)},background:function(e,t){e("class","background"),e("aria-hidden",!0),Qa(e,t)},foreground:function(e,t){e("class","foreground"),e("aria-hidden",!0),t.strokeForeground?Qa(e,t):e("d","")}},Yo={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1"};function Xs(e,t){var n=e.image;return(!n||e.url&&e.url!==n.url)&&(n={complete:!1,width:0,height:0},t.loadImage(e.url).then(r=>{e.image=r,e.image.url=e.url})),n}function Ds(e,t){return e.width!=null?e.width:t&&t.width?e.aspect!==!1&&e.height?e.height*t.width/t.height:t.width:0}function du(e,t){return e.height!=null?e.height:t&&t.height?e.aspect!==!1&&e.width?e.width*t.height/t.width:t.height:0}function Iu(e,t){return e==="center"?t/2:e==="right"?t:0}function pu(e,t){return e==="middle"?t/2:e==="bottom"?t:0}var od={type:"image",tag:"image",nested:!1,attr:function(e,t,n){const r=Xs(t,n),i=Ds(t,r),s=du(t,r),f=(t.x||0)-Iu(t.align,i),m=(t.y||0)-pu(t.baseline,s);e("href",!r.src&&r.toDataURL?r.toDataURL():r.src||"",Yo["xmlns:xlink"],"xlink:href"),e("transform",_r(f,m)),e("width",i),e("height",s),e("preserveAspectRatio",t.aspect===!1?"none":"xMidYMid")},bound:function(e,t){const n=t.image,r=Ds(t,n),i=du(t,n),s=(t.x||0)-Iu(t.align,r),f=(t.y||0)-pu(t.baseline,i);return e.set(s,f,s+r,f+i)},draw:function(e,t,n){Tn(t,r=>{if(n&&!n.intersects(r.bounds))return;const i=Xs(r,this);let s=Ds(r,i),f=du(r,i);if(s===0||f===0)return;let m,x,O,T,M=(r.x||0)-Iu(r.align,s),q=(r.y||0)-pu(r.baseline,f);r.aspect!==!1&&(x=i.width/i.height,O=r.width/r.height,x==x&&O==O&&x!==O&&(O<x?(q+=(f-(T=s/x))/2,f=T):(M+=(s-(T=f*x))/2,s=T))),(i.complete||i.toDataURL)&&(Ce(e,r),e.globalAlpha=(m=r.opacity)!=null?m:1,e.imageSmoothingEnabled=r.smooth!==!1,e.drawImage(i,M,q,s,f))})},pick:kr(),isect:xe.Ia,get:Xs,xOffset:Iu,yOffset:pu},rh=Ua("line",function(e,t){const n=t[0],r=n.interpolate||"linear";return mp.curve(Yl(r,n.orient,n.tension)).context(e)(t)},function(e,t){for(var n,r,i=Math.pow(e[0].strokeWidth||1,2),s=e.length;--s>=0;)if(e[s].defined!==!1&&(n=e[s].x-t[0])*n+(r=e[s].y-t[1])*r<i)return e[s];return null});function hl(e,t){var n=t.path;if(n==null)return!0;var r=t.x||0,i=t.y||0,s=t.scaleX||1,f=t.scaleY||1,m=(t.angle||0)*Jl,x=t.pathCache;x&&x.path===n||((t.pathCache=x=td(n)).path=n),m&&e.rotate&&e.translate?(e.translate(r,i),e.rotate(m),rd(e,x,0,0,s,f),e.rotate(-m),e.translate(-r,-i)):rd(e,x,r,i,s,f)}var tf={type:"path",tag:"path",nested:!1,attr:function(e,t){var n=t.scaleX||1,r=t.scaleY||1;n===1&&r===1||e("vector-effect","non-scaling-stroke"),e("transform",function(i){return _r(i.x||0,i.y||0)+(i.angle?" "+hi(i.angle):"")+(i.scaleX||i.scaleY?" "+function(s,f){return"scale("+s+","+f+")"}(i.scaleX||1,i.scaleY||1):"")}(t)),e("d",t.path)},bound:function(e,t){return hl(um(e,t.angle),t)?e.set(0,0,0,0):Zl(e,t,!0)},draw:dn(hl),pick:Br(hl),isect:z(hl)};function dl(e,t){e.beginPath(),th(e,t)}var Gu={type:"rect",tag:"path",nested:!1,attr:function(e,t){e("d",th(null,t))},bound:function(e,t){var n,r;return Zl(e.set(n=t.x||0,r=t.y||0,n+t.width||0,r+t.height||0),t)},draw:dn(dl),pick:Br(dl),isect:ce};function jo(e,t,n){var r,i,s,f;return!(!t.stroke||!sn(e,t,n))&&(r=t.x||0,i=t.y||0,s=t.x2!=null?t.x2:r,f=t.y2!=null?t.y2:i,e.beginPath(),e.moveTo(r,i),e.lineTo(s,f),!0)}var nf={type:"rule",tag:"line",nested:!1,attr:function(e,t){e("transform",Ei(t)),e("x2",t.x2!=null?t.x2-(t.x||0):0),e("y2",t.y2!=null?t.y2-(t.y||0):0)},bound:function(e,t){var n,r;return Zl(e.set(n=t.x||0,r=t.y||0,t.x2!=null?t.x2:n,t.y2!=null?t.y2:r),t)},draw:function(e,t,n){Tn(t,r=>{if(!n||n.intersects(r.bounds)){var i=r.opacity==null?1:r.opacity;i&&jo(e,r,i)&&(Ce(e,r),e.stroke())}})},pick:kr(function(e,t,n,r){return!!e.isPointInStroke&&jo(e,t,1)&&e.isPointInStroke(n,r)}),isect:ve},ih=xi("shape",function(e,t){return(t.mark.shape||t.shape).context(e)(t)}),sd=xi("symbol",function(e,t){return Qg.context(e)(t)},Y);const rf=Object(xe.N)();var ds={height:Ku,measureWidth:jc,estimateWidth:ud,width:ud,canvas:ah};function ah(e){ds.width=e&&w?jc:ud}function ud(e,t){return cd(pl(e,t),Ku(e))}function cd(e,t){return~~(.8*e.length*t)}function jc(e,t){return Ku(e)<=0||!(t=pl(e,t))?0:xp(t,ld(e))}function xp(e,t){const n=`(${t}) ${e}`;let r=rf.get(n);return r===void 0&&(w.font=t,r=w.measureText(e).width,rf.set(n,r)),r}function Ku(e){return e.fontSize!=null?+e.fontSize||0:11}function Ts(e){return e.lineHeight!=null?e.lineHeight:Ku(e)+2}function Fu(e){return function(t){return Object(xe.B)(t)?t.length>1?t:t[0]:t}(e.lineBreak&&e.text&&!Object(xe.B)(e.text)?e.text.split(e.lineBreak):e.text)}function ps(e){const t=Fu(e);return(Object(xe.B)(t)?t.length-1:0)*Ts(e)}function pl(e,t){const n=t==null?"":(t+"").trim();return e.limit>0&&n.length?function(r,i){var s=+r.limit,f=function(q){if(ds.width===jc){const Q=ld(q);return se=>xp(se,Q)}{const Q=Ku(q);return se=>cd(se,Q)}}(r);if(f(i)<s)return i;var m,x=r.ellipsis||"",O=r.dir==="rtl",T=0,M=i.length;if(s-=f(x),O){for(;T<M;)m=T+M>>>1,f(i.slice(m))>s?T=m+1:M=m;return x+i.slice(T)}for(;T<M;)m=1+(T+M>>>1),f(i.slice(0,m))<s?T=m:M=m-1;return i.slice(0,T)+x}(e,n):n}function oh(e,t){var n=e.font;return(t&&n?String(n).replace(/"/g,"'"):n)||"sans-serif"}function ld(e,t){return(e.fontStyle?e.fontStyle+" ":"")+(e.fontVariant?e.fontVariant+" ":"")+(e.fontWeight?e.fontWeight+" ":"")+Ku(e)+"px "+oh(e,t)}function sh(e){var t=e.baseline,n=Ku(e);return Math.round(t==="top"?.79*n:t==="middle"?.3*n:t==="bottom"?-.21*n:t==="line-top"?.29*n+.5*Ts(e):t==="line-bottom"?.29*n-.5*Ts(e):0)}ah(!0);const wp={left:"start",center:"middle",right:"end"},ml=new Xo;function ru(e){var t,n=e.x||0,r=e.y||0,i=e.radius||0;return i&&(t=(e.theta||0)-Zf,n+=i*Math.cos(t),r+=i*Math.sin(t)),ml.x1=n,ml.y1=r,ml}function C0(e,t,n){var r,i=ds.height(t),s=t.align,f=ru(t),m=f.x1,x=f.y1,O=t.dx||0,T=(t.dy||0)+sh(t)-Math.round(.8*i),M=Fu(t);if(Object(xe.B)(M)?(i+=Ts(t)*(M.length-1),r=M.reduce((q,Q)=>Math.max(q,ds.width(t,Q)),0)):r=ds.width(t,M),s==="center"?O-=r/2:s==="right"&&(O-=r),e.set(O+=m,T+=x,O+r,T+i),t.angle&&!n)e.rotate(t.angle*Jl,m,x);else if(n===2)return e.rotatedPoints(t.angle*Jl,m,x);return e}var gl={arc:ya,area:Ta,group:Ho,image:od,line:rh,path:tf,rect:Gu,rule:nf,shape:ih,symbol:sd,text:{type:"text",tag:"text",nested:!1,attr:function(e,t){var n,r=t.dx||0,i=(t.dy||0)+sh(t),s=ru(t),f=s.x1,m=s.y1,x=t.angle||0;e("text-anchor",wp[t.align]||"start"),x?(n=_r(f,m)+" "+hi(x),(r||i)&&(n+=" "+_r(r,i))):n=_r(f+r,m+i),e("transform",n)},bound:C0,draw:function(e,t,n){Tn(t,r=>{var i,s,f,m,x,O,T,M=r.opacity==null?1:r.opacity;if(!(n&&!n.intersects(r.bounds)||M===0||r.fontSize<=0||r.text==null||r.text.length===0)){if(e.font=ld(r),e.textAlign=r.align||"left",s=(i=ru(r)).x1,f=i.y1,r.angle&&(e.save(),e.translate(s,f),e.rotate(r.angle*Jl),s=f=0),s+=r.dx||0,f+=(r.dy||0)+sh(r),O=Fu(r),Ce(e,r),Object(xe.B)(O))for(x=Ts(r),m=0;m<O.length;++m)T=pl(r,O[m]),r.fill&&At(e,r,M)&&e.fillText(T,s,f),r.stroke&&sn(e,r,M)&&e.strokeText(T,s,f),f+=x;else T=pl(r,O),r.fill&&At(e,r,M)&&e.fillText(T,s,f),r.stroke&&sn(e,r,M)&&e.strokeText(T,s,f);r.angle&&e.restore()}})},pick:kr(function(e,t,n,r,i,s){if(t.fontSize<=0)return!1;if(!t.angle)return!0;var f=ru(t),m=f.x1,x=f.y1,O=C0(ml,t,1),T=-t.angle*Jl,M=Math.cos(T),q=Math.sin(T),Q=M*i-q*s+(m-M*m+q*x),se=q*i+M*s+(x-q*m-M*x);return O.contains(Q,se)}),isect:function(e,t){const n=C0(ml,e,2);return De(t,n[0],n[1],n[2],n[3])||De(t,n[0],n[1],n[4],n[5])||De(t,n[4],n[5],n[6],n[7])||De(t,n[2],n[3],n[6],n[7])}},trail:Ua("trail",function(e,t){return Pv.context(e)(t)},function(e,t){for(var n,r,i=e.length;--i>=0;)if(e[i].defined!==!1&&(n=e[i].x-t[0])*n+(r=e[i].y-t[1])*r<(n=e[i].size||1)*n)return e[i];return null})};function fd(e,t,n){var r=gl[e.mark.marktype],i=t||r.bound;return r.nested&&(e=e.mark),i(e.bounds||(e.bounds=new Xo),e,n)}var O0={mark:null};function A0(e,t,n){var r,i,s,f,m=gl[e.marktype],x=m.bound,O=e.items,T=O&&O.length;if(m.nested)return T?s=O[0]:(O0.mark=e,s=O0),f=fd(s,x,n),t=t&&t.union(f)||f;if(t=t||e.bounds&&e.bounds.clear()||new Xo,T)for(r=0,i=O.length;r<i;++r)t.union(fd(O[r],x,n));return e.bounds=t}const _0=["marktype","name","role","interactive","clip","items","zindex","x","y","width","height","align","baseline","fill","fillOpacity","opacity","blend","stroke","strokeOpacity","strokeWidth","strokeCap","strokeDash","strokeDashOffset","strokeForeground","strokeOffset","startAngle","endAngle","innerRadius","outerRadius","cornerRadius","padAngle","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight","interpolate","tension","orient","defined","url","aspect","smooth","path","scaleX","scaleY","x2","y2","size","shape","text","angle","theta","radius","dir","dx","dy","ellipsis","limit","lineBreak","lineHeight","font","fontSize","fontWeight","fontStyle","fontVariant","description","aria","ariaRole","ariaRoleDescription"];function rv(e,t){return JSON.stringify(e,_0,t)}function Uv(e){return function t(n){var r,i,s,f=n.marktype,m=n.items;if(m)for(i=0,s=m.length;i<s;++i)r=f?"mark":"group",m[i][r]=n,m[i].zindex&&(m[i][r].zdirty=!0),(f||r)==="group"&&t(m[i]);return f&&A0(n),n}(typeof e=="string"?JSON.parse(e):e)}function iv(e){arguments.length?this.root=Uv(e):(this.root=Wv({marktype:"group",name:"root",role:"frame"}),this.root.items=[new gp(this.root)])}function Wv(e,t){const n={bounds:new Xo,clip:!!e.clip,group:t,interactive:e.interactive!==!1,items:[],marktype:e.marktype,name:e.name||void 0,role:e.role||void 0,zindex:e.zindex||0};return e.aria!=null&&(n.aria=e.aria),e.description&&(n.description=e.description),n}function mc(e,t,n){return!e&&typeof document<"u"&&document.createElement&&(e=document),e?n?e.createElementNS(n,t):e.createElement(t):null}function S0(e,t){t=t.toLowerCase();for(var n=e.childNodes,r=0,i=n.length;r<i;++r)if(n[r].tagName.toLowerCase()===t)return n[r]}function Xu(e,t,n,r){var i,s=e.childNodes[t];return s&&s.tagName.toLowerCase()===n.toLowerCase()||(i=s||null,s=mc(e.ownerDocument,n,r),e.insertBefore(s,i)),s}function af(e,t){for(var n=e.childNodes,r=n.length;r>t;)e.removeChild(n[--r]);return e}function v(e){return"mark-"+e.marktype+(e.role?" role-"+e.role:"")+(e.name?" "+e.name:"")}function h(e,t){const n=t.getBoundingClientRect();return[e.clientX-n.left-(t.clientLeft||0),e.clientY-n.top-(t.clientTop||0)]}function u(e,t){this._active=null,this._handlers={},this._loader=e||Object(Xn.e)(),this._tooltip=t||d}function d(e,t,n,r){e.element().setAttribute("title",r||"")}function y(e){this._el=null,this._bgcolor=null,this._loader=new im(e)}iv.prototype={toJSON(e){return rv(this.root,e||0)},mark(e,t,n){const r=Wv(e,t=t||this.root.items[0]);return t.items[n]=r,r.zindex&&(r.group.zdirty=!0),r}},u.prototype={initialize(e,t,n){return this._el=e,this._obj=n||null,this.origin(t)},element(){return this._el},canvas(){return this._el&&this._el.firstChild},origin(e){return arguments.length?(this._origin=e||[0,0],this):this._origin.slice()},scene(e){return arguments.length?(this._scene=e,this):this._scene},on(){},off(){},_handlerIndex(e,t,n){for(let r=e?e.length:0;--r>=0;)if(e[r].type===t&&(!n||e[r].handler===n))return r;return-1},handlers(e){const t=this._handlers,n=[];if(e)n.push(...t[this.eventName(e)]);else for(const r in t)n.push(...t[r]);return n},eventName(e){const t=e.indexOf(".");return t<0?e:e.slice(0,t)},handleHref(e,t,n){this._loader.sanitize(n,{context:"href"}).then(r=>{const i=new MouseEvent(e.type,e),s=mc(null,"a");for(const f in r)s.setAttribute(f,r[f]);s.dispatchEvent(i)}).catch(()=>{})},handleTooltip(e,t,n){if(t&&t.tooltip!=null){t=function(i,s,f,m){var x,O,T=i&&i.mark;if(T&&(x=gl[T.marktype]).tip){for((O=h(s,f))[0]-=m[0],O[1]-=m[1];i=i.mark.group;)O[0]-=i.x||0,O[1]-=i.y||0;i=x.tip(T.items,O)}return i}(t,e,this.canvas(),this._origin);const r=n&&t&&t.tooltip||null;this._tooltip.call(this._obj,this,e,t,r)}},getItemBoundingClientRect(e){const t=this.canvas();if(!t)return;const n=t.getBoundingClientRect(),r=this._origin,i=e.bounds,s=i.width(),f=i.height();let m=i.x1+r[0]+n.left,x=i.y1+r[1]+n.top;for(;e.mark&&(e=e.mark.group);)m+=e.x||0,x+=e.y||0;return{x:m,y:x,width:s,height:f,left:m,top:x,right:m+s,bottom:x+f}}},y.prototype={initialize(e,t,n,r,i){return this._el=e,this.resize(t,n,r,i)},element(){return this._el},canvas(){return this._el&&this._el.firstChild},background(e){return arguments.length===0?this._bgcolor:(this._bgcolor=e,this)},resize(e,t,n,r){return this._width=e,this._height=t,this._origin=n||[0,0],this._scale=r||1,this},dirty(){},render(e){const t=this;return t._call=function(){t._render(e)},t._call(),t._call=null,t},_render(){},renderAsync(e){const t=this.render(e);return this._ready?this._ready.then(()=>t):Promise.resolve(t)},_load(e,t){var n=this,r=n._loader[e](t);if(!n._ready){const i=n._call;n._ready=n._loader.ready().then(s=>{s&&i(),n._ready=null})}return r},sanitizeURL(e){return this._load("sanitizeURL",e)},loadImage(e){return this._load("loadImage",e)}};const D="dragleave",W="mousedown",X="mousemove",ae="mouseout",de="click",be=["keydown","keypress","keyup","dragenter",D,"dragover",W,"mouseup",X,ae,"mouseover",de,"dblclick","wheel","mousewheel","touchstart","touchmove","touchend"],Ie=X,Re=ae,Me=de;function qe(e,t){u.call(this,e,t),this._down=null,this._touch=null,this._first=!0,this._events={}}const Je=e=>e==="touchstart"||e==="touchmove"||e==="touchend"?["touchstart","touchmove","touchend"]:[e];function Qe(e,t){Je(t).forEach(n=>function(r,i){const s=r.canvas();s&&!r._events[i]&&(r._events[i]=1,s.addEventListener(i,r[i]?f=>r[i](f):f=>r.fire(i,f)))}(e,n))}function ot(e,t,n){return function(r){const i=this._active,s=this.pickEvent(r);s===i?this.fire(e,r):(i&&i.exit||this.fire(n,r),this._active=s,this.fire(t,r),this.fire(e,r))}}function vt(e){return function(t){this.fire(e,t),this._active=null}}Object(xe.z)(qe,u,{initialize(e,t,n){return this._canvas=e&&S0(e,"canvas"),[de,W,X,ae,D].forEach(r=>Qe(this,r)),u.prototype.initialize.call(this,e,t,n)},canvas(){return this._canvas},context(){return this._canvas.getContext("2d")},events:be,DOMMouseScroll(e){this.fire("mousewheel",e)},mousemove:ot(X,"mouseover",ae),dragover:ot("dragover","dragenter",D),mouseout:vt(ae),dragleave:vt(D),mousedown(e){this._down=this._active,this.fire(W,e)},click(e){this._down===this._active&&(this.fire(de,e),this._down=null)},touchstart(e){this._touch=this.pickEvent(e.changedTouches[0]),this._first&&(this._active=this._touch,this._first=!1),this.fire("touchstart",e,!0)},touchmove(e){this.fire("touchmove",e,!0)},touchend(e){this.fire("touchend",e,!0),this._touch=null},fire(e,t,n){const r=n?this._touch:this._active,i=this._handlers[e];if(t.vegaType=e,e===Me&&r&&r.href?this.handleHref(t,r,r.href):e!==Ie&&e!==Re||this.handleTooltip(t,r,e!==Re),i)for(let s=0,f=i.length;s<f;++s)i[s].handler.call(this._obj,t,r)},on(e,t){const n=this.eventName(e),r=this._handlers;return this._handlerIndex(r[n],e,t)<0&&(Qe(this,e),(r[n]||(r[n]=[])).push({type:e,handler:t})),this},off(e,t){const n=this.eventName(e),r=this._handlers[n],i=this._handlerIndex(r,e,t);return i>=0&&r.splice(i,1),this},pickEvent(e){const t=h(e,this._canvas),n=this._origin;return this.pick(this._scene,t[0],t[1],t[0]-n[0],t[1]-n[1])},pick(e,t,n,r,i){const s=this.context();return gl[e.marktype].pick.call(this,s,e,t,n,r,i)}});var bt=typeof window<"u"&&window.devicePixelRatio||1;function wt(e){y.call(this,e),this._options={},this._redraw=!1,this._dirty=new Xo,this._tempb=new Xo}const Ft=y.prototype;function Yt(e,t){u.call(this,e,t);const n=this;n._hrefHandler=an(n,(r,i)=>{i&&i.href&&n.handleHref(r,i,i.href)}),n._tooltipHandler=an(n,(r,i)=>{n.handleTooltip(r,i,r.type!==Re)})}Object(xe.z)(wt,y,{initialize(e,t,n,r,i,s){return this._options=s||{},this._canvas=this._options.externalContext?null:qs(1,1,this._options.type),e&&this._canvas&&(af(e,0).appendChild(this._canvas),this._canvas.setAttribute("class","marks")),Ft.initialize.call(this,e,t,n,r,i)},resize(e,t,n,r){if(Ft.resize.call(this,e,t,n,r),this._canvas)(function(i,s,f,m,x,O){const T=typeof HTMLElement<"u"&&i instanceof HTMLElement&&i.parentNode!=null,M=i.getContext("2d"),q=T?bt:x;i.width=s*q,i.height=f*q;for(const Q in O)M[Q]=O[Q];T&&q!==1&&(i.style.width=s+"px",i.style.height=f+"px"),M.pixelRatio=q,M.setTransform(q,0,0,q,q*m[0],q*m[1])})(this._canvas,this._width,this._height,this._origin,this._scale,this._options.context);else{const i=this._options.externalContext;i||Object(xe.o)("CanvasRenderer is missing a valid canvas or context"),i.scale(this._scale,this._scale),i.translate(this._origin[0],this._origin[1])}return this._redraw=!0,this},canvas(){return this._canvas},context(){return this._options.externalContext||(this._canvas?this._canvas.getContext("2d"):null)},dirty(e){const t=this._tempb.clear().union(e.bounds);let n=e.mark.group;for(;n;)t.translate(n.x||0,n.y||0),n=n.mark.group;this._dirty.union(t)},_render(e){const t=this.context(),n=this._origin,r=this._width,i=this._height,s=this._dirty,f=((x,O,T)=>new Xo().set(0,0,O,T).translate(-x[0],-x[1]))(n,r,i);t.save();const m=this._redraw||s.empty()?(this._redraw=!1,f.expand(1)):function(x,O,T){return O.expand(1).round(),x.pixelRatio%1&&O.scale(x.pixelRatio).round().scale(1/x.pixelRatio),O.translate(-T[0]%1,-T[1]%1),x.beginPath(),x.rect(O.x1,O.y1,O.width(),O.height()),x.clip(),O}(t,f.intersect(s),n);return this.clear(-n[0],-n[1],r,i),this.draw(t,e,m),t.restore(),s.clear(),this},draw(e,t,n){const r=gl[t.marktype];t.clip&&function(i,s){var f=s.clip;i.save(),Object(xe.E)(f)?(i.beginPath(),f(i),i.clip()):Da(i,s.group)}(e,t),r.draw.call(this,e,t,n),t.clip&&e.restore()},clear(e,t,n,r){const i=this._options,s=this.context();i.type==="pdf"||i.externalContext||s.clearRect(e,t,n,r),this._bgcolor!=null&&(s.fillStyle=this._bgcolor,s.fillRect(e,t,n,r))}});const an=(e,t)=>n=>{let r=n.target.__data__;r=Array.isArray(r)?r[0]:r,n.vegaType=n.type,t.call(e._obj,n,r)};Object(xe.z)(Yt,u,{initialize(e,t,n){let r=this._svg;return r&&(r.removeEventListener(Me,this._hrefHandler),r.removeEventListener(Ie,this._tooltipHandler),r.removeEventListener(Re,this._tooltipHandler)),this._svg=r=e&&S0(e,"svg"),r&&(r.addEventListener(Me,this._hrefHandler),r.addEventListener(Ie,this._tooltipHandler),r.addEventListener(Re,this._tooltipHandler)),u.prototype.initialize.call(this,e,t,n)},canvas(){return this._svg},on(e,t){const n=this.eventName(e),r=this._handlers;if(this._handlerIndex(r[n],e,t)<0){const i={type:e,handler:t,listener:an(this,t)};(r[n]||(r[n]=[])).push(i),this._svg&&this._svg.addEventListener(n,i.listener)}return this},off(e,t){const n=this.eventName(e),r=this._handlers[n],i=this._handlerIndex(r,e,t);return i>=0&&(this._svg&&this._svg.removeEventListener(n,r[i].listener),r.splice(i,1)),this}});const Jt="aria-hidden",un="aria-label",gn="role",p="aria-roledescription",c="graphics-object",a="graphics-symbol",l=(e,t,n)=>({[gn]:e,[p]:t,[un]:n||void 0}),g=Object(xe.Fa)(["axis-domain","axis-grid","axis-label","axis-tick","axis-title","legend-band","legend-entry","legend-gradient","legend-label","legend-title","legend-symbol","title"]),_={axis:{desc:"axis",caption:function(e){const t=e.datum,n=e.orient,r=t.title?me(e):null,i=e.context,s=i.scales[t.scale].value,f=i.dataflow.locale(),m=s.type;return`${n==="left"||n==="right"?"Y":"X"}-axis`+(r?` titled '${r}'`:"")+` for a ${Yf(m)?"discrete":m} scale with ${qg(f,s,e)}`}},legend:{desc:"legend",caption:function(e){const t=e.datum,n=t.title?me(e):null,r=`${t.type||""} legend`.trim(),i=t.scales,s=Object.keys(i),f=e.context,m=f.scales[i[s[0]]].value,x=f.dataflow.locale();return function(O){return O.length?O[0].toUpperCase()+O.slice(1):O}(r)+(n?` titled '${n}'`:"")+` for ${function(O){return(O=O.map(T=>T+(T==="fill"||T==="stroke"?" color":""))).length<2?O[0]:O.slice(0,-1).join(", ")+" and "+Object(xe.W)(O)}(s)} with ${qg(x,m,e)}`}},"title-text":{desc:"title",caption:e=>`Title text '${oe(e)}'`},"title-subtitle":{desc:"subtitle",caption:e=>`Subtitle text '${oe(e)}'`}},j={ariaRole:gn,ariaRoleDescription:p,description:un};function V(e,t){const n=t.aria===!1;if(e(Jt,n||void 0),n||t.description==null)for(const r in j)e(j[r],void 0);else{const r=t.mark.marktype;e(un,t.description),e(gn,t.ariaRole||(r==="group"?c:a)),e(p,t.ariaRoleDescription||`${r} mark`)}}function ne(e){return e.aria===!1?{[Jt]:!0}:g[e.role]?null:_[e.role]?function(t,n){try{const r=t.items[0],i=n.caption||(()=>"");return l(n.role||a,n.desc,r.description||i(r))}catch{return null}}(e,_[e.role]):function(t){const n=t.marktype,r=n==="group"||n==="text"||t.items.some(i=>i.description!=null&&i.aria!==!1);return l(r?c:a,`${n} mark container`,t.description)}(e)}function oe(e){return Object(xe.i)(e.text).join(" ")}function me(e){try{return Object(xe.i)(Object(xe.W)(e.items).items[0].text).join(" ")}catch{return null}}const Ee=e=>(e+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),_e=e=>Ee(e).replace(/"/g,"&quot;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;");function Ne(){let e="",t="",n="";const r=[],i=()=>t=n="",s=(m,x)=>(x!=null&&(t+=` ${m}="${_e(x)}"`),f),f={open(m,...x){(O=>{t&&(e+=`${t}>${n}`,i()),r.push(O)})(m),t="<"+m;for(const O of x)for(const T in O)s(T,O[T]);return f},close(){const m=r.pop();return e+=t?t+(n?`>${n}</${m}>`:"/>"):`</${m}>`,i(),f},attr:s,text:m=>(n+=Ee(m),f),toString:()=>e};return f}const Ue=e=>function t(n,r){if(n.open(r.tagName),r.hasAttributes()){const i=r.attributes,s=i.length;for(let f=0;f<s;++f)n.attr(i[f].name,i[f].value)}if(r.hasChildNodes()){const i=r.childNodes,s=i.length;for(let f=0;f<s;f++){const m=i[f];m.nodeType===3?n.text(m.nodeValue):t(n,m)}}return n.close()}(Ne(),e)+"",$e={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",strokeCap:"stroke-linecap",strokeJoin:"stroke-linejoin",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeMiterLimit:"stroke-miterlimit",opacity:"opacity",blend:"mix-blend-mode"},He={fill:"none","stroke-miterlimit":10},et=Yo.xmlns;function lt(e){y.call(this,e),this._dirtyID=0,this._dirty=[],this._svg=null,this._root=null,this._defs=null}const ht=y.prototype;function gt(e,t){for(;e&&e.dirty!==t;e=e.mark.group){if(e.dirty=t,!e.mark||e.mark.dirty===t)return;e.mark.dirty=t}}function Ct(e,t,n){let r,i,s;if(t.gradient==="radial"){let f=Xu(e,n++,"pattern",et);Kn(f,{id:cl+t.id,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),Kn(f=Xu(f,0,"rect",et),{width:1,height:1,fill:`url(${sr()}#${t.id})`}),Kn(e=Xu(e,n++,"radialGradient",et),{id:t.id,fx:t.x1,fy:t.y1,fr:t.r1,cx:t.x2,cy:t.y2,r:t.r2})}else Kn(e=Xu(e,n++,"linearGradient",et),{id:t.id,x1:t.x1,x2:t.x2,y1:t.y1,y2:t.y2});for(r=0,i=t.stops.length;r<i;++r)(s=Xu(e,r,"stop",et)).setAttribute("offset",t.stops[r].offset),s.setAttribute("stop-color",t.stops[r].color);return af(e,r),n}function Wt(e,t,n){return(e=Xu(e,n,"clipPath",et)).setAttribute("id",t.id),t.path?Xu(e,0,"path",et).setAttribute("d",t.path):Kn(Xu(e,0,"rect",et),{x:0,y:0,width:t.width,height:t.height}),af(e,1),n+1}function Kt(e,t,n,r,i){let s,f=e._svg;if(!f&&(f=mc(s=t.ownerDocument,r,et),e._svg=f,e.mark&&(f.__data__=e,f.__values__={fill:"default"},r==="g"))){const m=mc(s,"path",et);f.appendChild(m),m.__data__=e;const x=mc(s,"g",et);f.appendChild(x),x.__data__=e;const O=mc(s,"path",et);f.appendChild(O),O.__data__=e,O.__values__={fill:"default"}}return(f.ownerSVGElement!==i||function(m,x){return m.parentNode&&m.parentNode.childNodes.length>1&&m.previousSibling!=x}(f,n))&&t.insertBefore(f,n?n.nextSibling:t.firstChild),f}Object(xe.z)(lt,y,{initialize(e,t,n,r,i){return this._defs={},this._clearDefs(),e&&(this._svg=Xu(e,0,"svg",et),this._svg.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns",et),this._svg.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink",Yo["xmlns:xlink"]),this._svg.setAttribute("version",Yo.version),this._svg.setAttribute("class","marks"),af(e,1),this._root=Xu(this._svg,0,"g",et),Kn(this._root,He),af(this._svg,1)),this.background(this._bgcolor),ht.initialize.call(this,e,t,n,r,i)},background(e){return arguments.length&&this._svg&&this._svg.style.setProperty("background-color",e),ht.background.apply(this,arguments)},resize(e,t,n,r){return ht.resize.call(this,e,t,n,r),this._svg&&(Kn(this._svg,{width:this._width*this._scale,height:this._height*this._scale,viewBox:`0 0 ${this._width} ${this._height}`}),this._root.setAttribute("transform",`translate(${this._origin})`)),this._dirty=[],this},canvas(){return this._svg},svg(){const e=this._svg,t=this._bgcolor;if(!e)return null;let n;t&&(e.removeAttribute("style"),Kn(n=Xu(e,0,"rect",et),{width:this._width,height:this._height,fill:t}));const r=Ue(e);return t&&(e.removeChild(n),this._svg.style.setProperty("background-color",t)),r},_render(e){return this._dirtyCheck()&&(this._dirtyAll&&this._clearDefs(),this.mark(this._root,e),af(this._root,1)),this.defs(),this._dirty=[],++this._dirtyID,this},dirty(e){e.dirty!==this._dirtyID&&(e.dirty=this._dirtyID,this._dirty.push(e))},isDirty(e){return this._dirtyAll||!e._svg||e.dirty===this._dirtyID},_dirtyCheck(){this._dirtyAll=!0;const e=this._dirty;if(!e.length||!this._dirtyID)return!0;const t=++this._dirtyID;let n,r,i,s,f,m,x;for(f=0,m=e.length;f<m;++f)(r=(n=e[f]).mark).marktype!==i&&(i=r.marktype,s=gl[i]),r.zdirty&&r.dirty!==t&&(this._dirtyAll=!1,gt(n,t),r.items.forEach(O=>{O.dirty=t})),r.zdirty||(n.exit?(s.nested&&r.items.length?(x=r.items[0])._svg&&this._update(s,x._svg,x):n._svg&&(x=n._svg.parentNode)&&x.removeChild(n._svg),n._svg=null):(n=s.nested?r.items[0]:n)._update!==t&&(n._svg&&n._svg.ownerSVGElement?this._update(s,n._svg,n):(this._dirtyAll=!1,gt(n,t)),n._update=t));return!this._dirtyAll},mark(e,t,n){if(!this.isDirty(t))return t._svg;const r=this._svg,i=gl[t.marktype],s=t.interactive===!1?"none":null,f=i.tag==="g";let m=null,x=0;const O=Kt(t,e,n,"g",r);O.setAttribute("class",v(t));const T=ne(t);for(const q in T)er(O,q,T[q]);f||er(O,"pointer-events",s),er(O,"clip-path",t.clip?Mc(this,t,t.group):null);const M=q=>{const Q=this.isDirty(q),se=Kt(q,O,m,i.tag,r);Q&&(this._update(i,se,q),f&&function(le,Fe,Le){Fe=Fe.lastChild.previousSibling;let ze,nt=0;Tn(Le,it=>{ze=le.mark(Fe,it,ze),++nt}),af(Fe,1+nt)}(this,se,q)),m=se,++x};return i.nested?t.items.length&&M(t.items[0]):Tn(t,M),af(O,x),O},_update(e,t,n){Vt=t,Ht=t.__values__,V(On,n),e.attr(On,n,this);const r=vn[e.type];r&&r.call(this,e,t,n),Vt&&this.style(Vt,n)},style(e,t){if(t!=null)for(const n in $e){let r=n==="font"?oh(t):t[n];if(r===Ht[n])continue;const i=$e[n];r==null?e.removeAttribute(i):(Jp(r)&&(r=Vm(r,this._defs.gradient,sr())),e.setAttribute(i,r+"")),Ht[n]=r}},defs(){const e=this._svg,t=this._defs;let n=t.el,r=0;for(const i in t.gradient)n||(t.el=n=Xu(e,1,"defs",et)),r=Ct(n,t.gradient[i],r);for(const i in t.clipping)n||(t.el=n=Xu(e,1,"defs",et)),r=Wt(n,t.clipping[i],r);n&&(r===0?(e.removeChild(n),t.el=null):af(n,r))},_clearDefs(){const e=this._defs;e.gradient={},e.clipping={}}});let Vt=null,Ht=null;const vn={group(e,t,n){const r=Vt=t.childNodes[2];Ht=r.__values__,e.foreground(On,n,this),Ht=t.__values__,Vt=t.childNodes[1],e.content(On,n,this);const i=Vt=t.childNodes[0];e.background(On,n,this);const s=n.mark.interactive===!1?"none":null;if(s!==Ht.events&&(er(r,"pointer-events",s),er(i,"pointer-events",s),Ht.events=s),n.strokeForeground&&n.stroke){const f=n.fill;er(r,"display",null),this.style(i,n),er(i,"stroke",null),f&&(n.fill=null),Ht=r.__values__,this.style(r,n),f&&(n.fill=f),Vt=null}else er(r,"display","none")},image(e,t,n){n.smooth===!1?(Cn(t,"image-rendering","optimizeSpeed"),Cn(t,"image-rendering","pixelated")):Cn(t,"image-rendering",null)},text(e,t,n){const r=Fu(n);let i,s,f,m;Object(xe.B)(r)?(i=(s=r.map(x=>pl(n,x))).join(`
`))!==Ht.text&&(af(t,0),f=t.ownerDocument,m=Ts(n),s.forEach((x,O)=>{const T=mc(f,"tspan",et);T.__data__=n,T.textContent=x,O&&(T.setAttribute("x",0),T.setAttribute("dy",m)),t.appendChild(T)}),Ht.text=i):(s=pl(n,r))!==Ht.text&&(t.textContent=s,Ht.text=s),er(t,"font-family",oh(n)),er(t,"font-size",Ku(n)+"px"),er(t,"font-style",n.fontStyle),er(t,"font-variant",n.fontVariant),er(t,"font-weight",n.fontWeight)}};function On(e,t,n){t!==Ht[e]&&(n?function(r,i,s,f){s!=null?r.setAttributeNS(f,i,s):r.removeAttributeNS(f,i)}(Vt,e,t,n):er(Vt,e,t),Ht[e]=t)}function Cn(e,t,n){n!==Ht[t]&&(n==null?e.style.removeProperty(t):e.style.setProperty(t,n+""),Ht[t]=n)}function Kn(e,t){for(const n in t)er(e,n,t[n])}function er(e,t,n){n!=null?e.setAttribute(t,n):e.removeAttribute(t)}function sr(){let e;return typeof window>"u"?"":(e=window.location).hash?e.href.slice(0,-e.hash.length):e.href}function lr(e){y.call(this,e),this._text=null,this._defs={gradient:{},clipping:{}}}Object(xe.z)(lr,y,{svg(){return this._text},_render(e){const t=Ne();t.open("svg",Object(xe.p)({},Yo,{class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:`0 0 ${this._width} ${this._height}`}));const n=this._bgcolor;return n&&n!=="transparent"&&n!=="none"&&t.open("rect",{width:this._width,height:this._height,fill:n}).close(),t.open("g",He,{transform:"translate("+this._origin+")"}),this.mark(t,e),t.close(),this.defs(t),this._text=t.close()+"",this},mark(e,t){const n=gl[t.marktype],r=n.tag,i=[V,n.attr];e.open("g",{class:v(t),"clip-path":t.clip?Mc(this,t,t.group):null},ne(t),{"pointer-events":r!=="g"&&t.interactive===!1?"none":null});const s=f=>{const m=this.href(f);if(m&&e.open("a",m),e.open(r,this.attr(t,f,i,r!=="g"?r:null)),r==="text"){const x=Fu(f);if(Object(xe.B)(x)){const O={x:0,dy:Ts(f)};for(let T=0;T<x.length;++T)e.open("tspan",T?O:null).text(pl(f,x[T])).close()}else e.text(pl(f,x))}else if(r==="g"){const x=f.strokeForeground,O=f.fill,T=f.stroke;x&&T&&(f.stroke=null),e.open("path",this.attr(t,f,n.background,"bgrect")).close(),e.open("g",this.attr(t,f,n.content)),Tn(f,M=>this.mark(e,M)),e.close(),x&&T?(O&&(f.fill=null),f.stroke=T,e.open("path",this.attr(t,f,n.foreground,"bgrect")).close(),O&&(f.fill=O)):e.open("path",this.attr(t,f,n.foreground,"bgfore")).close()}e.close(),m&&e.close()};return n.nested?t.items&&t.items.length&&s(t.items[0]):Tn(t,s),e.close()},href(e){const t=e.href;let n;if(t){if(n=this._hrefs&&this._hrefs[t])return n;this.sanitizeURL(t).then(r=>{r["xlink:href"]=r.href,r.href=null,(this._hrefs||(this._hrefs={}))[t]=r})}return null},attr(e,t,n,r){const i={},s=(f,m,x,O)=>{i[O||f]=m};return Array.isArray(n)?n.forEach(f=>f(s,t,this)):n(s,t,this),r&&function(f,m,x,O,T){if(m==null||(O==="bgrect"&&x.interactive===!1&&(f["pointer-events"]="none"),O==="bgfore"&&(x.interactive===!1&&(f["pointer-events"]="none"),f.display="none",m.fill!==null)))return f;O==="image"&&m.smooth===!1&&(f.style="image-rendering: optimizeSpeed; image-rendering: pixelated;"),O==="text"&&(f["font-family"]=oh(m),f["font-size"]=Ku(m)+"px",f["font-style"]=m.fontStyle,f["font-variant"]=m.fontVariant,f["font-weight"]=m.fontWeight);for(const M in $e){let q=m[M];const Q=$e[M];(q!=="transparent"||Q!=="fill"&&Q!=="stroke")&&q!=null&&(Jp(q)&&(q=Vm(q,T.gradient,"")),f[Q]=q)}}(i,t,e,r,this._defs),i},defs(e){const t=this._defs.gradient,n=this._defs.clipping;if(Object.keys(t).length+Object.keys(n).length!==0){e.open("defs");for(const r in t){const i=t[r],s=i.stops;i.gradient==="radial"?(e.open("pattern",{id:cl+r,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),e.open("rect",{width:"1",height:"1",fill:"url(#"+r+")"}).close(),e.close(),e.open("radialGradient",{id:r,fx:i.x1,fy:i.y1,fr:i.r1,cx:i.x2,cy:i.y2,r:i.r2})):e.open("linearGradient",{id:r,x1:i.x1,x2:i.x2,y1:i.y1,y2:i.y2});for(let f=0;f<s.length;++f)e.open("stop",{offset:s[f].offset,"stop-color":s[f].color}).close();e.close()}for(const r in n){const i=n[r];e.open("clipPath",{id:r}),i.path?e.open("path",{d:i.path}).close():e.open("rect",{x:0,y:0,width:i.width,height:i.height}).close(),e.close()}e.close()}}});const ur={Canvas:"canvas",PNG:"png",SVG:"svg",None:"none"},ar={};function Or(e,t){return e=String(e||"").toLowerCase(),arguments.length>1?(ar[e]=t,this):ar[e]}function Er(e,t,n){const r=[],i=new Xo().union(t),s=e.marktype;return s?Ur(e,i,n,r):s==="group"?ei(e,i,n,r):Object(xe.o)("Intersect scene must be mark node or group item.")}function Ur(e,t,n,r){if(function(i,s,f){return i.bounds&&s.intersects(i.bounds)&&(i.marktype==="group"||i.interactive!==!1&&(!f||f(i)))}(e,t,n)){const i=e.items,s=e.marktype,f=i.length;let m=0;if(s==="group")for(;m<f;++m)ei(i[m],t,n,r);else for(const x=gl[s].isect;m<f;++m){const O=i[m];mi(O,t,x)&&r.push(O)}}return r}function ei(e,t,n,r){n&&n(e.mark)&&mi(e,t,gl.group.isect)&&r.push(e);const i=e.items,s=i&&i.length;if(s){const f=e.x||0,m=e.y||0;t.translate(-f,-m);for(let x=0;x<s;++x)Ur(i[x],t,n,r);t.translate(f,m)}return r}function mi(e,t,n){const r=e.bounds;return t.encloses(r)||t.intersects(r)&&n(e,t)}ar.canvas=ar.png={renderer:wt,headless:wt,handler:qe},ar.svg={renderer:lt,headless:lr,handler:Yt},ar.none={};const ua=new Xo;function ca(e){const t=e.clip;if(Object(xe.E)(t))t(um(ua.clear()));else{if(!t)return;ua.set(0,0,e.group.width,e.group.height)}e.bounds.intersect(ua)}const ka=1e-9;function ba(e,t,n){return e===t||(n==="path"?ja(e,t):e instanceof Date&&t instanceof Date?+e==+t:Object(xe.G)(e)&&Object(xe.G)(t)?Math.abs(e-t)<=ka:e&&t&&(Object(xe.H)(e)||Object(xe.H)(t))?function(r,i){var s,f,m=Object.keys(r),x=Object.keys(i);if(m.length!==x.length)return!1;for(m.sort(),x.sort(),f=m.length-1;f>=0;f--)if(m[f]!=x[f])return!1;for(f=m.length-1;f>=0;f--)if(s=m[f],!ba(r[s],i[s],s))return!1;return typeof r==typeof i}(e,t):e==t)}function ja(e,t){return ba(td(e),td(t))}function Za(){Zg(),Qf=0}const Bo="top",Xi="left",Ea="right",Wa="bottom",iu="top-left",Ms="top-right",js="bottom-left",hd="bottom-right",dd="start",kp="middle",mu="end",Qm="x",av="y",pd="group",ov="axis",Ep="title",Rx="frame",D0="scope",md="legend",Zy="row-header",Mx="row-footer",jx="row-title",eb="column-header",tb="column-footer",nb="column-title",c5="padding",l5="symbol",WA="fit",f5="fit-x",h5="fit-y",d5="pad",Gk="none",Bx="all",Kk="each",Xk="flush",T0="column",N0="row";function VA(e){Ot.call(this,null,e)}function Px(e,t,n){return t(e.bounds.clear(),e,n)}Object(xe.z)(VA,Ot,{transform(e,t){const n=t.dataflow,r=e.mark,i=r.marktype,s=gl[i],f=s.bound;let m,x=r.bounds;if(s.nested)r.items.length&&n.dirty(r.items[0]),x=Px(r,f),r.items.forEach(O=>{O.bounds.clear().union(x)});else if(i===pd||e.modified())switch(t.visit(t.MOD,O=>n.dirty(O)),x.clear(),r.items.forEach(O=>x.union(Px(O,f))),r.role){case ov:case md:case Ep:t.reflow()}else m=t.changed(t.REM),t.visit(t.ADD,O=>{x.union(Px(O,f))}),t.visit(t.MOD,O=>{m=m||x.alignsWith(O.bounds),n.dirty(O),x.union(Px(O,f))}),m&&(x.clear(),r.items.forEach(O=>x.union(O.bounds)));return ca(r),t.modifies("bounds")}});const qA=":vega_identifier:";function Yk(e){Ot.call(this,0,e)}function HA(e){Ot.call(this,null,e)}function $A(e){Ot.call(this,null,e)}Yk.Definition={type:"Identifier",metadata:{modifies:!0},params:[{name:"as",type:"string",required:!0}]},Object(xe.z)(Yk,Ot,{transform(e,t){const n=function(s){return s._signals[qA]||(s._signals[qA]=s.add(0))}(t.dataflow),r=e.as;let i=n.value;return t.visit(t.ADD,s=>s[r]=s[r]||++i),n.set(this.value=i),t}}),Object(xe.z)(HA,Ot,{transform(e,t){let n=this.value;n||((n=t.dataflow.scenegraph().mark(e.markdef,function(i){const s=i.groups,f=i.parent;return s&&s.size===1?s.get(Object.keys(s.object)[0]):s&&f?s.lookup(f):null}(e),e.index)).group.context=e.context,e.context.group||(e.context.group=n.group),n.source=this.source,n.clip=e.clip,n.interactive=e.interactive,this.value=n);const r=n.marktype===pd?gp:id;return t.visit(t.ADD,i=>r.call(i,n)),(e.modified("clip")||e.modified("interactive"))&&(n.clip=e.clip,n.interactive=!!e.interactive,n.zdirty=!0,t.reflow()),n.items=t.source,t}});const GA={parity:e=>e.filter((t,n)=>n%2?t.opacity=0:1),greedy:(e,t)=>{let n;return e.filter((r,i)=>i&&KA(n.bounds,r.bounds,t)?r.opacity=0:(n=r,1))}},KA=(e,t,n)=>n>Math.max(t.x1-e.x2,e.x1-t.x2,t.y1-e.y2,e.y1-t.y2),XA=(e,t)=>{for(var n,r=1,i=e.length,s=e[0].bounds;r<i;s=n,++r)if(KA(s,n=e[r].bounds,t))return!0},p5=e=>{const t=e.bounds;return t.width()>1&&t.height()>1},YA=e=>(e.forEach(t=>t.opacity=1),e),JA=(e,t)=>e.reflow(t.modified()).modifies("opacity");function QA(e){Ot.call(this,null,e)}Object(xe.z)($A,Ot,{transform(e,t){const n=GA[e.method]||GA.parity,r=e.separation||0;let i,s,f=t.materialize(t.SOURCE).source;if(!f||!f.length)return;if(!e.method)return e.modified("method")&&(YA(f),t=JA(t,e)),t;if(!(f=f.filter(p5)).length)return;if(e.sort&&(f=f.slice().sort(e.sort)),i=YA(f),t=JA(t,e),i.length>=3&&XA(i,r)){do i=n(i,r);while(i.length>=3&&XA(i,r));i.length<3&&!Object(xe.W)(f).opacity&&(i.length>1&&(Object(xe.W)(i).opacity=0),Object(xe.W)(f).opacity=1)}e.boundScale&&e.boundTolerance>=0&&(s=((x,O,T)=>{var M=x.range(),q=new Xo;return O===Bo||O===Wa?q.set(M[0],-1/0,M[1],1/0):q.set(-1/0,M[0],1/0,M[1]),q.expand(T||1),Q=>q.encloses(Q.bounds)})(e.boundScale,e.boundOrient,+e.boundTolerance),f.forEach(x=>{s(x)||(x.opacity=0)}));const m=i[0].mark.bounds.clear();return f.forEach(x=>{x.opacity&&m.union(x.bounds)}),t}}),Object(xe.z)(QA,Ot,{transform(e,t){const n=t.dataflow;if(t.visit(t.ALL,r=>n.dirty(r)),t.fields&&t.fields.zindex){const r=t.source&&t.source[0];r&&(r.mark.zdirty=!0)}}});const of=new Xo;function rb(e,t,n){return e[t]===n?0:(e[t]=n,1)}function m5(e){var t=e.items[0].orient;return t===Xi||t===Ea}function g5(e,t,n,r){var i,s,f=t.items[0],m=f.datum,x=f.translate!=null?f.translate:.5,O=f.orient,T=function(st){let pt=+st.grid;return[st.ticks?pt++:-1,st.labels?pt++:-1,pt+ +st.domain]}(m),M=f.range,q=f.offset,Q=f.position,se=f.minExtent,le=f.maxExtent,Fe=m.title&&f.items[T[2]].items[0],Le=f.titlePadding,ze=f.bounds,nt=Fe&&ps(Fe),it=0,ut=0;switch(of.clear().union(ze),ze.clear(),(i=T[0])>-1&&ze.union(f.items[i].bounds),(i=T[1])>-1&&ze.union(f.items[i].bounds),O){case Bo:it=Q||0,ut=-q,s=Math.max(se,Math.min(le,-ze.y1)),ze.add(0,-s).add(M,0),Fe&&Lx(e,Fe,s,Le,nt,0,-1,ze);break;case Xi:it=-q,ut=Q||0,s=Math.max(se,Math.min(le,-ze.x1)),ze.add(-s,0).add(0,M),Fe&&Lx(e,Fe,s,Le,nt,1,-1,ze);break;case Ea:it=n+q,ut=Q||0,s=Math.max(se,Math.min(le,ze.x2)),ze.add(0,0).add(s,M),Fe&&Lx(e,Fe,s,Le,nt,1,1,ze);break;case Wa:it=Q||0,ut=r+q,s=Math.max(se,Math.min(le,ze.y2)),ze.add(0,0).add(M,s),Fe&&Lx(e,Fe,s,Le,0,0,1,ze);break;default:it=f.x,ut=f.y}return Zl(ze.translate(it,ut),f),rb(f,"x",it+x)|rb(f,"y",ut+x)&&(f.bounds=of,e.dirty(f),f.bounds=ze,e.dirty(f)),f.mark.bounds.clear().union(ze)}function Lx(e,t,n,r,i,s,f,m){const x=t.bounds;if(t.auto){const O=f*(n+i+r);let T=0,M=0;e.dirty(t),s?T=(t.x||0)-(t.x=O):M=(t.y||0)-(t.y=O),t.mark.bounds.clear().union(x.translate(-T,-M)),e.dirty(t)}m.union(x)}const ZA=(e,t)=>Math.floor(Math.min(e,t)),e_=(e,t)=>Math.ceil(Math.max(e,t));function v5(e){return new Xo().set(0,0,e.width||0,e.height||0)}function y5(e){const t=e.bounds.clone();return t.empty()?t.set(0,0,0,0):t.translate(-(e.x||0),-(e.y||0))}function Ys(e,t,n){const r=Object(xe.H)(e)?e[t]:e;return r??(n!==void 0?n:0)}function t_(e){return e<0?Math.ceil(-e):0}function n_(e,t,n){var r,i,s,f,m,x,O,T,M,q,Q,se=!n.nodirty,le=n.bounds===Xk?v5:y5,Fe=of.set(0,0,0,0),Le=Ys(n.align,T0),ze=Ys(n.align,N0),nt=Ys(n.padding,T0),it=Ys(n.padding,N0),ut=n.columns||t.length,st=ut<=0?1:Math.ceil(t.length/ut),pt=t.length,dt=Array(pt),Qt=Array(ut),mn=0,on=Array(pt),Rn=Array(st),Fn=0,zn=Array(pt),Vn=Array(pt),Qn=Array(pt);for(i=0;i<ut;++i)Qt[i]=0;for(i=0;i<st;++i)Rn[i]=0;for(i=0;i<pt;++i)x=t[i],m=Qn[i]=le(x),x.x=x.x||0,zn[i]=0,x.y=x.y||0,Vn[i]=0,s=i%ut,f=~~(i/ut),mn=Math.max(mn,O=Math.ceil(m.x2)),Fn=Math.max(Fn,T=Math.ceil(m.y2)),Qt[s]=Math.max(Qt[s],O),Rn[f]=Math.max(Rn[f],T),dt[i]=nt+t_(m.x1),on[i]=it+t_(m.y1),se&&e.dirty(t[i]);for(i=0;i<pt;++i)i%ut==0&&(dt[i]=0),i<ut&&(on[i]=0);if(Le===Kk)for(s=1;s<ut;++s){for(Q=0,i=s;i<pt;i+=ut)Q<dt[i]&&(Q=dt[i]);for(i=s;i<pt;i+=ut)dt[i]=Q+Qt[s-1]}else if(Le===Bx){for(Q=0,i=0;i<pt;++i)i%ut&&Q<dt[i]&&(Q=dt[i]);for(i=0;i<pt;++i)i%ut&&(dt[i]=Q+mn)}else for(Le=!1,s=1;s<ut;++s)for(i=s;i<pt;i+=ut)dt[i]+=Qt[s-1];if(ze===Kk)for(f=1;f<st;++f){for(Q=0,r=(i=f*ut)+ut;i<r;++i)Q<on[i]&&(Q=on[i]);for(i=f*ut;i<r;++i)on[i]=Q+Rn[f-1]}else if(ze===Bx){for(Q=0,i=ut;i<pt;++i)Q<on[i]&&(Q=on[i]);for(i=ut;i<pt;++i)on[i]=Q+Fn}else for(ze=!1,f=1;f<st;++f)for(r=(i=f*ut)+ut;i<r;++i)on[i]+=Rn[f-1];for(M=0,i=0;i<pt;++i)M=dt[i]+(i%ut?M:0),zn[i]+=M-t[i].x;for(s=0;s<ut;++s)for(q=0,i=s;i<pt;i+=ut)q+=on[i],Vn[i]+=q-t[i].y;if(Le&&Ys(n.center,T0)&&st>1)for(i=0;i<pt;++i)(M=(m=Le===Bx?mn:Qt[i%ut])-Qn[i].x2-t[i].x-zn[i])>0&&(zn[i]+=M/2);if(ze&&Ys(n.center,N0)&&ut!==1)for(i=0;i<pt;++i)(q=(m=ze===Bx?Fn:Rn[~~(i/ut)])-Qn[i].y2-t[i].y-Vn[i])>0&&(Vn[i]+=q/2);for(i=0;i<pt;++i)Fe.union(Qn[i].translate(zn[i],Vn[i]));switch(M=Ys(n.anchor,Qm),q=Ys(n.anchor,av),Ys(n.anchor,T0)){case mu:M-=Fe.width();break;case kp:M-=Fe.width()/2}switch(Ys(n.anchor,N0)){case mu:q-=Fe.height();break;case kp:q-=Fe.height()/2}for(M=Math.round(M),q=Math.round(q),Fe.clear(),i=0;i<pt;++i)t[i].mark.bounds.clear();for(i=0;i<pt;++i)(x=t[i]).x+=zn[i]+=M,x.y+=Vn[i]+=q,Fe.union(x.mark.bounds.union(x.bounds.translate(zn[i],Vn[i]))),se&&e.dirty(x);return Fe}function b5(e,t,n){var r,i,s,f,m,x,O,T=function(ze){var nt,it,ut=ze.items,st=ut.length,pt=0;const dt={marks:[],rowheaders:[],rowfooters:[],colheaders:[],colfooters:[],rowtitle:null,coltitle:null};for(;pt<st;++pt)if(it=(nt=ut[pt]).items,nt.marktype===pd)switch(nt.role){case ov:case md:case Ep:break;case Zy:dt.rowheaders.push(...it);break;case Mx:dt.rowfooters.push(...it);break;case eb:dt.colheaders.push(...it);break;case tb:dt.colfooters.push(...it);break;case jx:dt.rowtitle=it[0];break;case nb:dt.coltitle=it[0];break;default:dt.marks.push(...it)}return dt}(t),M=T.marks,q=n.bounds===Xk?x5:w5,Q=n.offset,se=n.columns||M.length,le=se<=0?1:Math.ceil(M.length/se),Fe=le*se;const Le=n_(e,M,n);Le.empty()&&Le.set(0,0,0,0),T.rowheaders&&(x=Ys(n.headerBand,N0,null),r=zx(e,T.rowheaders,M,se,le,-Ys(Q,"rowHeader"),ZA,0,q,"x1",0,se,1,x)),T.colheaders&&(x=Ys(n.headerBand,T0,null),i=zx(e,T.colheaders,M,se,se,-Ys(Q,"columnHeader"),ZA,1,q,"y1",0,1,se,x)),T.rowfooters&&(x=Ys(n.footerBand,N0,null),s=zx(e,T.rowfooters,M,se,le,Ys(Q,"rowFooter"),e_,0,q,"x2",se-1,se,1,x)),T.colfooters&&(x=Ys(n.footerBand,T0,null),f=zx(e,T.colfooters,M,se,se,Ys(Q,"columnFooter"),e_,1,q,"y2",Fe-se,1,se,x)),T.rowtitle&&(m=Ys(n.titleAnchor,N0),O=Ys(Q,"rowTitle"),O=m===mu?s+O:r-O,x=Ys(n.titleBand,N0,.5),r_(e,T.rowtitle,O,0,Le,x)),T.coltitle&&(m=Ys(n.titleAnchor,T0),O=Ys(Q,"columnTitle"),O=m===mu?f+O:i-O,x=Ys(n.titleBand,T0,.5),r_(e,T.coltitle,O,1,Le,x))}function x5(e,t){return t==="x1"?e.x||0:t==="y1"?e.y||0:t==="x2"?(e.x||0)+(e.width||0):t==="y2"?(e.y||0)+(e.height||0):void 0}function w5(e,t){return e.bounds[t]}function zx(e,t,n,r,i,s,f,m,x,O,T,M,q,Q){var se,le,Fe,Le,ze,nt,it,ut,st,pt=n.length,dt=0,Qt=0;if(!pt)return dt;for(se=T;se<pt;se+=M)n[se]&&(dt=f(dt,x(n[se],O)));if(!t.length)return dt;for(t.length>i&&(e.warn("Grid headers exceed limit: "+i),t=t.slice(0,i)),dt+=s,le=0,Le=t.length;le<Le;++le)e.dirty(t[le]),t[le].mark.bounds.clear();for(se=T,le=0,Le=t.length;le<Le;++le,se+=M){for(ze=(nt=t[le]).mark.bounds,Fe=se;Fe>=0&&(it=n[Fe])==null;Fe-=q);m?(ut=Q==null?it.x:Math.round(it.bounds.x1+Q*it.bounds.width()),st=dt):(ut=dt,st=Q==null?it.y:Math.round(it.bounds.y1+Q*it.bounds.height())),ze.union(nt.bounds.translate(ut-(nt.x||0),st-(nt.y||0))),nt.x=ut,nt.y=st,e.dirty(nt),Qt=f(Qt,ze[O])}return Qt}function r_(e,t,n,r,i,s){if(t){e.dirty(t);var f=n,m=n;r?f=Math.round(i.x1+s*i.width()):m=Math.round(i.y1+s*i.height()),t.bounds.translate(f-(t.x||0),m-(t.y||0)),t.mark.bounds.clear().union(t.bounds),t.x=f,t.y=m,e.dirty(t)}}function k5(e,t,n,r,i,s,f){const m=function(q,Q){const se=q[Q]||{};return(le,Fe)=>se[le]!=null?se[le]:q[le]!=null?q[le]:Fe}(n,t),x=function(q,Q){let se=-1/0;return q.forEach(le=>{le.offset!=null&&(se=Math.max(se,le.offset))}),se>-1/0?se:Q}(e,m("offset",0)),O=m("anchor",dd),T=O===mu?1:O===kp?.5:0,M={align:Kk,bounds:m("bounds",Xk),columns:m("direction")==="vertical"?1:e.length,padding:m("margin",8),center:m("center"),nodirty:!0};switch(t){case Xi:M.anchor={x:Math.floor(r.x1)-x,column:mu,y:T*(f||r.height()+2*r.y1),row:O};break;case Ea:M.anchor={x:Math.ceil(r.x2)+x,y:T*(f||r.height()+2*r.y1),row:O};break;case Bo:M.anchor={y:Math.floor(i.y1)-x,row:mu,x:T*(s||i.width()+2*i.x1),column:O};break;case Wa:M.anchor={y:Math.ceil(i.y2)+x,x:T*(s||i.width()+2*i.x1),column:O};break;case iu:M.anchor={x,y:x};break;case Ms:M.anchor={x:s-x,y:x,column:mu};break;case js:M.anchor={x,y:f-x,row:mu};break;case hd:M.anchor={x:s-x,y:f-x,column:mu,row:mu}}return M}function E5(e,t){var n,r,i=t.items[0],s=i.datum,f=i.orient,m=i.bounds,x=i.x,O=i.y;return i._bounds?i._bounds.clear().union(m):i._bounds=m.clone(),m.clear(),function(T,M,q){var Q=M.padding,se=Q-q.x,le=Q-q.y;if(M.datum.title){var Fe=M.items[1].items[0],Le=Fe.anchor,ze=M.titlePadding||0,nt=Q-Fe.x,it=Q-Fe.y;switch(Fe.orient){case Xi:se+=Math.ceil(Fe.bounds.width())+ze;break;case Ea:case Wa:break;default:le+=Fe.bounds.height()+ze}switch((se||le)&&Gb(T,q,se,le),Fe.orient){case Xi:it+=ib(M,q,Fe,Le,1,1);break;case Ea:nt+=ib(M,q,Fe,mu,0,0)+ze,it+=ib(M,q,Fe,Le,1,1);break;case Wa:nt+=ib(M,q,Fe,Le,0,0),it+=ib(M,q,Fe,mu,-1,0,1)+ze;break;default:nt+=ib(M,q,Fe,Le,0,0)}(nt||it)&&Gb(T,Fe,nt,it),(nt=Math.round(Fe.bounds.x1-Q))<0&&(Gb(T,q,-nt,0),Gb(T,Fe,-nt,0))}else(se||le)&&Gb(T,q,se,le)}(e,i,i.items[0].items[0]),m=function(T,M){return T.items.forEach(q=>M.union(q.bounds)),M.x1=T.padding,M.y1=T.padding,M}(i,m),n=2*i.padding,r=2*i.padding,m.empty()||(n=Math.ceil(m.width()+n),r=Math.ceil(m.height()+r)),s.type===l5&&function(T){const M=T.reduce((q,Q)=>(q[Q.column]=Math.max(Q.bounds.x2-Q.x,q[Q.column]||0),q),{});T.forEach(q=>{q.width=M[q.column],q.height=q.bounds.y2-q.y})}(i.items[0].items[0].items[0].items),f!==Gk&&(i.x=x=0,i.y=O=0),i.width=n,i.height=r,Zl(m.set(x,O,x+n,O+r),i),i.mark.bounds.clear().union(m),i}function ib(e,t,n,r,i,s,f){const m=e.datum.type!=="symbol",x=n.datum.vgrad,O=(!m||!s&&x||f?t:t.items[0]).bounds[i?"y2":"x2"]-e.padding,T=x&&s?O:0,M=x&&s?0:O,q=i<=0?0:ps(n);return Math.round(r===dd?T:r===mu?M-q:.5*(O-q))}function Gb(e,t,n,r){t.x+=n,t.y+=r,t.bounds.translate(n,r),t.mark.bounds.translate(n,r),e.dirty(t)}function i_(e){Ot.call(this,null,e)}function a_(e,t){let n=0;for(let r of e)(r=+r)&&(n+=r);return n}function o_(e){Ot.call(this,null,e)}function s_(e){Ot.call(this,null,e)}function C5(){return Dn({})}function u_(e){Ot.call(this,null,e)}function c_(e){Ot.call(this,[],e)}Object(xe.z)(i_,Ot,{transform(e,t){const n=t.dataflow;return e.mark.items.forEach(r=>{e.layout&&b5(n,r,e.layout),function(i,s,f){var m,x,O,T,M,q=s.items,Q=Math.max(0,s.width||0),se=Math.max(0,s.height||0),le=new Xo().set(0,0,Q,se),Fe=le.clone(),Le=le.clone(),ze=[];for(T=0,M=q.length;T<M;++T)switch((x=q[T]).role){case ov:(m5(x)?Fe:Le).union(g5(i,x,Q,se));break;case Ep:m=x;break;case md:ze.push(E5(i,x));break;case Rx:case D0:case Zy:case Mx:case jx:case eb:case tb:case nb:Fe.union(x.bounds),Le.union(x.bounds);break;default:le.union(x.bounds)}if(ze.length){const nt={};ze.forEach(it=>{(O=it.orient||Ea)!==Gk&&(nt[O]||(nt[O]=[])).push(it)});for(const it in nt){const ut=nt[it];n_(i,ut,k5(ut,it,f.legends,Fe,Le,Q,se))}ze.forEach(it=>{const ut=it.bounds;if(ut.equals(it._bounds)||(it.bounds=it._bounds,i.dirty(it),it.bounds=ut,i.dirty(it)),f.autosize&&f.autosize.type===WA)switch(it.orient){case Xi:case Ea:le.add(ut.x1,0).add(ut.x2,0);break;case Bo:case Wa:le.add(0,ut.y1).add(0,ut.y2)}else le.union(ut)})}le.union(Fe).union(Le),m&&le.union(function(nt,it,ut,st,pt){var dt,Qt=it.items[0],mn=Qt.frame,on=Qt.orient,Rn=Qt.anchor,Fn=Qt.offset,zn=Qt.padding,Vn=Qt.items[0].items[0],Qn=Qt.items[1]&&Qt.items[1].items[0],pr=on===Xi||on===Ea?st:ut,Pr=0,Ar=0,Jr=0,gi=0,vi=0;if(mn!==pd?on===Xi?(Pr=pt.y2,pr=pt.y1):on===Ea?(Pr=pt.y1,pr=pt.y2):(Pr=pt.x1,pr=pt.x2):on===Xi&&(Pr=st,pr=0),dt=Rn===dd?Pr:Rn===mu?pr:(Pr+pr)/2,Qn&&Qn.text){switch(on){case Bo:case Wa:vi=Vn.bounds.height()+zn;break;case Xi:gi=Vn.bounds.width()+zn;break;case Ea:gi=-Vn.bounds.width()-zn}of.clear().union(Qn.bounds),of.translate(gi-(Qn.x||0),vi-(Qn.y||0)),rb(Qn,"x",gi)|rb(Qn,"y",vi)&&(nt.dirty(Qn),Qn.bounds.clear().union(of),Qn.mark.bounds.clear().union(of),nt.dirty(Qn)),of.clear().union(Qn.bounds)}else of.clear();switch(of.union(Vn.bounds),on){case Bo:Ar=dt,Jr=pt.y1-of.height()-Fn;break;case Xi:Ar=pt.x1-of.width()-Fn,Jr=dt;break;case Ea:Ar=pt.x2+of.width()+Fn,Jr=dt;break;case Wa:Ar=dt,Jr=pt.y2+Fn;break;default:Ar=Qt.x,Jr=Qt.y}return rb(Qt,"x",Ar)|rb(Qt,"y",Jr)&&(of.translate(Ar,Jr),nt.dirty(Qt),Qt.bounds.clear().union(of),it.bounds.clear().union(of),nt.dirty(Qt)),Qt.bounds}(i,m,Q,se,le)),s.clip&&le.set(0,0,s.width||0,s.height||0),function(nt,it,ut,st){const pt=st.autosize||{},dt=pt.type;if(nt._autosize<1||!dt)return;let Qt=nt._width,mn=nt._height,on=Math.max(0,it.width||0),Rn=Math.max(0,Math.ceil(-ut.x1)),Fn=Math.max(0,it.height||0),zn=Math.max(0,Math.ceil(-ut.y1));const Vn=Math.max(0,Math.ceil(ut.x2-on)),Qn=Math.max(0,Math.ceil(ut.y2-Fn));if(pt.contains===c5){const pr=nt.padding();Qt-=pr.left+pr.right,mn-=pr.top+pr.bottom}dt===Gk?(Rn=0,zn=0,on=Qt,Fn=mn):dt===WA?(on=Math.max(0,Qt-Rn-Vn),Fn=Math.max(0,mn-zn-Qn)):dt===f5?(on=Math.max(0,Qt-Rn-Vn),mn=Fn+zn+Qn):dt===h5?(Qt=on+Rn+Vn,Fn=Math.max(0,mn-zn-Qn)):dt===d5&&(Qt=on+Rn+Vn,mn=Fn+zn+Qn),nt._resizeView(Qt,mn,on,Fn,[Rn,zn],pt.resize)}(i,s,le,f)}(n,r,e)}),function(r){return r&&r.mark.role!=="legend-entry"}(e.mark.group)?t.reflow():t}}),Object(xe.z)(o_,Ot,{transform(e,t){if(this.value&&!e.modified())return t.StopPropagation;var n=t.dataflow.locale(),r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=this.value,s=e.scale,f=up(s,e.count==null?e.values?e.values.length:10:e.count,e.minstep),m=e.format||Pg(n,s,f,e.formatSpecifier,e.formatType,!!e.values),x=e.values?Bg(s,e.values,f):Xl(s,f);return i&&(r.rem=i),i=x.map((O,T)=>Dn({index:T/(x.length-1||1),value:O,label:m(O)})),e.extra&&i.length&&i.push(Dn({index:-1,extra:{value:i[0].value},label:""})),r.source=i,r.add=i,this.value=i,r}}),Object(xe.z)(s_,Ot,{transform(e,t){var n=t.dataflow,r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=e.item||C5,s=e.key||nn,f=this.value;return Object(xe.B)(r.encode)&&(r.encode=null),f&&(e.modified("key")||t.modified(s))&&Object(xe.o)("DataJoin does not support modified key function or fields."),f||(t=t.addAll(),this.value=f=function(m){const x=Object(xe.t)().test(O=>O.exit);return x.lookup=O=>x.get(m(O)),x}(s)),t.visit(t.ADD,m=>{const x=s(m);let O=f.get(x);O?O.exit?(f.empty--,r.add.push(O)):r.mod.push(O):(O=i(m),f.set(x,O),r.add.push(O)),O.datum=m,O.exit=!1}),t.visit(t.MOD,m=>{const x=s(m),O=f.get(x);O&&(O.datum=m,r.mod.push(O))}),t.visit(t.REM,m=>{const x=s(m),O=f.get(x);m!==O.datum||O.exit||(r.rem.push(O),O.exit=!0,++f.empty)}),t.changed(t.ADD_MOD)&&r.modifies("datum"),(t.clean()||e.clean&&f.empty>n.cleanThreshold)&&n.runAfter(f.clean),r}}),Object(xe.z)(u_,Ot,{transform(e,t){var n=t.fork(t.ADD_REM),r=e.mod||!1,i=e.encoders,s=t.encode;if(Object(xe.B)(s)){if(!n.changed()&&!s.every(M=>i[M]))return t.StopPropagation;s=s[0],n.encode=null}var f=s==="enter",m=i.update||xe.s,x=i.enter||xe.s,O=i.exit||xe.s,T=(s&&!f?i[s]:m)||xe.s;if(t.changed(t.ADD)&&(t.visit(t.ADD,M=>{x(M,e),m(M,e)}),n.modifies(x.output),n.modifies(m.output),T!==xe.s&&T!==m&&(t.visit(t.ADD,M=>{T(M,e)}),n.modifies(T.output))),t.changed(t.REM)&&O!==xe.s&&(t.visit(t.REM,M=>{O(M,e)}),n.modifies(O.output)),f||T!==xe.s){const M=t.MOD|(e.modified()?t.REFLOW:0);f?(t.visit(M,q=>{const Q=x(q,e)||r;(T(q,e)||Q)&&n.mod.push(q)}),n.mod.length&&n.modifies(x.output)):t.visit(M,q=>{(T(q,e)||r)&&n.mod.push(q)}),n.mod.length&&n.modifies(T.output)}return n.changed()?n:t.StopPropagation}}),Object(xe.z)(c_,Ot,{transform(e,t){if(this.value!=null&&!e.modified())return t.StopPropagation;var n,r,i,s,f,m=t.dataflow.locale(),x=t.fork(t.NO_SOURCE|t.NO_FIELDS),O=this.value,T=e.type||Xp,M=e.scale,q=+e.limit,Q=up(M,e.count==null?5:e.count,e.minstep),se=!!e.values||T===Xp,le=e.format||Ug(m,M,Q,T,e.formatSpecifier,e.formatType,se),Fe=e.values||zg(M,Q);return O&&(x.rem=O),T===Xp?(q&&Fe.length>q?(t.dataflow.warn("Symbol legend count exceeds limit, filtering items."),O=Fe.slice(0,q-1),f=!0):O=Fe,Object(xe.E)(i=e.size)?(e.values||M(O[0])!==0||(O=O.slice(1)),s=O.reduce((Le,ze)=>Math.max(Le,i(ze,e)),0)):i=Object(xe.m)(s=i||8),O=O.map((Le,ze)=>Dn({index:ze,label:le(Le,ze,O),value:Le,offset:s,size:i(Le,e)})),f&&(f=Fe[O.length],O.push(Dn({index:O.length,label:"".concat(Fe.length-O.length," entries"),value:f,offset:s,size:i(f,e)})))):T==="gradient"?(n=M.domain(),r=Zh(M,n[0],Object(xe.W)(n)),Fe.length<3&&!e.values&&n[0]!==Object(xe.W)(n)&&(Fe=[n[0],Object(xe.W)(n)]),O=Fe.map((Le,ze)=>Dn({index:ze,label:le(Le,ze,Fe),value:Le,perc:r(Le)}))):(i=Fe.length-1,r=function(Le){const ze=Le.domain(),nt=ze.length-1;let it=+ze[0],ut=+Object(xe.W)(ze),st=ut-it;if(Le.type===Nc){const pt=nt?st/nt:.1;st=(ut+=pt)-(it-=pt)}return pt=>(pt-it)/st}(M),O=Fe.map((Le,ze)=>Dn({index:ze,label:le(Le,ze,Fe),value:Le,perc:ze?r(Le):0,perc2:ze===i?1:r(Fe[ze+1])}))),x.source=O,x.add=O,this.value=O,x}});const O5=e=>e.source.x,A5=e=>e.source.y,_5=e=>e.target.x,S5=e=>e.target.y;function Jk(e){Ot.call(this,{},e)}Jk.Definition={type:"LinkPath",metadata:{modifies:!0},params:[{name:"sourceX",type:"field",default:"source.x"},{name:"sourceY",type:"field",default:"source.y"},{name:"targetX",type:"field",default:"target.x"},{name:"targetY",type:"field",default:"target.y"},{name:"orient",type:"enum",default:"vertical",values:["horizontal","vertical","radial"]},{name:"shape",type:"enum",default:"line",values:["line","arc","curve","diagonal","orthogonal"]},{name:"require",type:"signal"},{name:"as",type:"string",default:"path"}]},Object(xe.z)(Jk,Ot,{transform(e,t){var n=e.sourceX||O5,r=e.sourceY||A5,i=e.targetX||_5,s=e.targetY||S5,f=e.as||"path",m=e.orient||"vertical",x=e.shape||"line",O=d_.get(x+"-"+m)||d_.get(x);return O||Object(xe.o)("LinkPath unsupported type: "+e.shape+(e.orient?"-"+e.orient:"")),t.visit(t.SOURCE,T=>{T[f]=O(n(T),r(T),i(T),s(T))}),t.reflow(e.modified()).modifies(f)}});const l_=(e,t,n,r)=>"M"+e+","+t+"L"+n+","+r,f_=(e,t,n,r)=>{var i=n-e,s=r-t,f=Math.sqrt(i*i+s*s)/2;return"M"+e+","+t+"A"+f+","+f+" "+180*Math.atan2(s,i)/Math.PI+" 0 1 "+n+","+r},h_=(e,t,n,r)=>{const i=n-e,s=r-t,f=.2*(i+s),m=.2*(s-i);return"M"+e+","+t+"C"+(e+f)+","+(t+m)+" "+(n+m)+","+(r-f)+" "+n+","+r},d_=Object(xe.t)({line:l_,"line-radial":(e,t,n,r)=>l_(t*Math.cos(e),t*Math.sin(e),r*Math.cos(n),r*Math.sin(n)),arc:f_,"arc-radial":(e,t,n,r)=>f_(t*Math.cos(e),t*Math.sin(e),r*Math.cos(n),r*Math.sin(n)),curve:h_,"curve-radial":(e,t,n,r)=>h_(t*Math.cos(e),t*Math.sin(e),r*Math.cos(n),r*Math.sin(n)),"orthogonal-horizontal":(e,t,n,r)=>"M"+e+","+t+"V"+r+"H"+n,"orthogonal-vertical":(e,t,n,r)=>"M"+e+","+t+"H"+n+"V"+r,"orthogonal-radial":(e,t,n,r)=>{const i=Math.cos(e),s=Math.sin(e),f=Math.cos(n),m=Math.sin(n);return"M"+t*i+","+t*s+"A"+t+","+t+" 0 0,"+((Math.abs(n-e)>Math.PI?n<=e:n>e)?1:0)+" "+t*f+","+t*m+"L"+r*f+","+r*m},"diagonal-horizontal":(e,t,n,r)=>{const i=(e+n)/2;return"M"+e+","+t+"C"+i+","+t+" "+i+","+r+" "+n+","+r},"diagonal-vertical":(e,t,n,r)=>{const i=(t+r)/2;return"M"+e+","+t+"C"+e+","+i+" "+n+","+i+" "+n+","+r},"diagonal-radial":(e,t,n,r)=>{const i=Math.cos(e),s=Math.sin(e),f=Math.cos(n),m=Math.sin(n),x=(t+r)/2;return"M"+t*i+","+t*s+"C"+x*i+","+x*s+" "+x*f+","+x*m+" "+r*f+","+r*m}});function Qk(e){Ot.call(this,null,e)}Qk.Definition={type:"Pie",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"startAngle",type:"number",default:0},{name:"endAngle",type:"number",default:6.283185307179586},{name:"sort",type:"boolean",default:!1},{name:"as",type:"string",array:!0,length:2,default:["startAngle","endAngle"]}]},Object(xe.z)(Qk,Ot,{transform(e,t){var n,r,i,s=e.as||["startAngle","endAngle"],f=s[0],m=s[1],x=e.field||xe.Q,O=e.startAngle||0,T=e.endAngle!=null?e.endAngle:2*Math.PI,M=t.source,q=M.map(x),Q=q.length,se=O,le=(T-O)/a_(q),Fe=ys(Q);for(e.sort&&Fe.sort((Le,ze)=>q[Le]-q[ze]),n=0;n<Q;++n)i=q[Fe[n]],(r=M[Fe[n]])[f]=se,r[m]=se+=i*le;return this.value=q,t.reflow(e.modified()).modifies(s)}});const D5=5;function p_(e){return Xf(e)&&e!==Tu}const T5=Object(xe.Fa)(["set","modified","clear","type","scheme","schemeExtent","schemeCount","domain","domainMin","domainMid","domainMax","domainRaw","domainImplicit","nice","zero","bins","range","rangeStep","round","reverse","interpolate","interpolateGamma"]);function m_(e){Ot.call(this,null,e),this.modified(!0)}function g_(e,t,n){return Vp(e)&&Math.abs(t.reduce((r,i)=>r+(i<0?-1:i>0?1:0),0))!==t.length&&n.warn("Log scale domain includes zero: "+Object(xe.Ba)(t)),t}function v_(e,t,n){return Object(xe.E)(e)&&(t||n)?$p(e,Zk(t||[0,1],n)):e}function Zk(e,t){return t?e.slice().reverse():e}function y_(e){Ot.call(this,null,e)}Object(xe.z)(m_,Ot,{transform(e,t){var n=t.dataflow,r=this.value,i=function(s){var f,m=s.type,x="";return m===Tu?Tu+"-"+Hl:(function(O){const T=O.type;return Xf(T)&&T!==$l&&T!==Gl&&(O.scheme||O.range&&O.range.length&&O.range.every(xe.J))}(s)&&(f=s.rawDomain?s.rawDomain.length:s.domain?s.domain.length+ +(s.domainMid!=null):0,x=f===2?Tu+"-":f===3?Jh+"-":""),(x+m||Hl).toLowerCase())}(e);for(i in r&&i===r.type||(this.value=r=Fa(i)()),e)if(!T5[i]){if(i==="padding"&&p_(r.type))continue;Object(xe.E)(r[i])?r[i](e[i]):n.warn("Unsupported scale property: "+i)}return function(s,f,m){var x=s.type,O=f.round||!1,T=f.range;if(f.rangeStep!=null)T=function(M,q,Q){M!==Kf&&M!==Up&&Object(xe.o)("Only band and point scales support rangeStep.");var se=(q.paddingOuter!=null?q.paddingOuter:q.padding)||0,le=M===Up?1:(q.paddingInner!=null?q.paddingInner:q.padding)||0;return[0,q.rangeStep*zp(Q,le,se)]}(x,f,m);else if(f.scheme&&(T=function(M,q,Q){var se,le,Fe=q.schemeExtent;return Object(xe.B)(q.scheme)?le=Kl(q.scheme,q.interpolate,q.interpolateGamma):(se=q.scheme.toLowerCase(),(le=zm(se))||Object(xe.o)("Unrecognized scheme name: ".concat(q.scheme))),Q=M===Nc?Q+1:M===Ic?Q-1:M===$f||M===ol?+q.schemeCount||D5:Q,qp(M)?v_(le,Fe,q.reverse):Object(xe.E)(le)?Gp(v_(le,Fe),Q):M===Gf?le:le.slice(0,Q)}(x,f,m),Object(xe.E)(T))){if(s.interpolator)return s.interpolator(T);Object(xe.o)("Scale type ".concat(x," does not support interpolating color schemes."))}if(T&&qp(x))return s.interpolator(Kl(Zk(T,f.reverse),f.interpolate,f.interpolateGamma));T&&f.interpolate&&s.interpolate?s.interpolate(Kp(f.interpolate,f.interpolateGamma)):Object(xe.E)(s.round)?s.round(O):Object(xe.E)(s.rangeRound)&&s.interpolate(O?Ja:io),T&&s.range(Zk(T,f.reverse))}(r,e,function(s,f,m){let x=f.bins;if(x&&!Object(xe.B)(x)){const O=s.domain(),T=O[0],M=Object(xe.W)(O),q=x.step;let Q=x.start==null?T:x.start,se=x.stop==null?M:x.stop;q||Object(xe.o)("Scale bins parameter missing step property."),Q<T&&(Q=q*Math.ceil(T/q)),se>M&&(se=q*Math.floor(M/q)),x=ys(Q,se+q/2,q)}return x?s.bins=x:s.bins&&delete s.bins,s.type===Ic&&(x?f.domain||f.domainRaw||(s.domain(x),m=x.length):s.bins=s.domain()),m}(r,e,function(s,f,m){const x=function(se,le,Fe){return le?(se.domain(g_(se.type,le,Fe)),le.length):-1}(s,f.domainRaw,m);if(x>-1)return x;var O,T,M=f.domain,q=s.type,Q=f.zero||f.zero===void 0&&function(se){const le=se.type;return!se.bins&&(le===Hl||le===rp||le===Yh)}(s);if(!M)return 0;if(p_(q)&&f.padding&&M[0]!==Object(xe.W)(M)&&(M=function(se,le,Fe,Le,ze,nt){var it=Math.abs(Object(xe.W)(Fe)-Fe[0]),ut=it/(it-2*Le),st=se===al?Object(xe.Oa)(le,null,ut):se===Yh?Object(xe.Pa)(le,null,ut,.5):se===rp?Object(xe.Pa)(le,null,ut,ze||1):se===Hf?Object(xe.Qa)(le,null,ut,nt||1):Object(xe.Na)(le,null,ut);return(le=le.slice())[0]=st[0],le[le.length-1]=st[1],le}(q,M,f.range,f.padding,f.exponent,f.constant)),(Q||f.domainMin!=null||f.domainMax!=null||f.domainMid!=null)&&(O=(M=M.slice()).length-1||1,Q&&(M[0]>0&&(M[0]=0),M[O]<0&&(M[O]=0)),f.domainMin!=null&&(M[0]=f.domainMin),f.domainMax!=null&&(M[O]=f.domainMax),f.domainMid!=null)){const se=(T=f.domainMid)>M[O]?O+1:T<M[0]?0:O;se!==O&&m.warn("Scale domainMid exceeds domain min or max.",T),M.splice(se,0,T)}return s.domain(g_(q,M,m)),q===Gf&&s.unknown(f.domainImplicit?qu:void 0),f.nice&&s.nice&&s.nice(f.nice!==!0&&up(s,f.nice)||null),M.length}(r,e,n))),t.fork(t.NO_SOURCE|t.NO_FIELDS)}}),Object(xe.z)(y_,Ot,{transform(e,t){const n=e.modified("sort")||t.changed(t.ADD)||t.modified(e.sort.fields)||t.modified("datum");return n&&t.source.sort(Qr(e.sort)),this.modified(n),t}});const b_=["y0","y1"];function eE(e){Ot.call(this,null,e)}function N5(e,t,n,r,i){for(var s,f=(t-e.sum)/2,m=e.length,x=0;x<m;++x)(s=e[x])[r]=f,s[i]=f+=Math.abs(n(s))}function I5(e,t,n,r,i){for(var s,f=1/e.sum,m=0,x=e.length,O=0,T=0;O<x;++O)(s=e[O])[r]=m,s[i]=m=f*(T+=Math.abs(n(s)))}function F5(e,t,n,r,i){for(var s,f,m=0,x=0,O=e.length,T=0;T<O;++T)(s=+n(f=e[T]))<0?(f[r]=x,f[i]=x+=s):(f[r]=m,f[i]=m+=s)}eE.Definition={type:"Stack",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"groupby",type:"field",array:!0},{name:"sort",type:"compare"},{name:"offset",type:"enum",default:"zero",values:["zero","center","normalize"]},{name:"as",type:"string",array:!0,length:2,default:b_}]},Object(xe.z)(eE,Ot,{transform(e,t){var n,r,i,s,f=e.as||b_,m=f[0],x=f[1],O=Qr(e.sort),T=e.field||xe.Q,M=e.offset==="center"?N5:e.offset==="normalize"?I5:F5;for(n=function(q,Q,se,le){var Fe,Le,ze,nt,it,ut,st,pt,dt,Qt=[],mn=on=>on(it);if(Q==null)Qt.push(q.slice());else for(Fe={},Le=0,ze=q.length;Le<ze;++Le)it=q[Le],ut=Q.map(mn),(st=Fe[ut])||(Fe[ut]=st=[],Qt.push(st)),st.push(it);for(ut=0,dt=0,nt=Qt.length;ut<nt;++ut){for(st=Qt[ut],Le=0,pt=0,ze=st.length;Le<ze;++Le)pt+=Math.abs(le(st[Le]));st.sum=pt,pt>dt&&(dt=pt),se&&st.sort(se)}return Qt.max=dt,Qt}(t.source,e.groupby,O,T),r=0,i=n.length,s=n.max;r<i;++r)M(n[r],s,T,m,x);return t.reflow(e.modified()).modifies(f)}});var Kb=e=>e;function Ux(e,t){e&&w_.hasOwnProperty(e.type)&&w_[e.type](e,t)}var x_={Feature:function(e,t){Ux(e.geometry,t)},FeatureCollection:function(e,t){for(var n=e.features,r=-1,i=n.length;++r<i;)Ux(n[r].geometry,t)}},w_={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)e=n[r],t.point(e[0],e[1],e[2])},LineString:function(e,t){tE(e.coordinates,t,0)},MultiLineString:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)tE(n[r],t,0)},Polygon:function(e,t){k_(e.coordinates,t)},MultiPolygon:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)k_(n[r],t)},GeometryCollection:function(e,t){for(var n=e.geometries,r=-1,i=n.length;++r<i;)Ux(n[r],t)}};function tE(e,t,n){var r,i=-1,s=e.length-n;for(t.lineStart();++i<s;)r=e[i],t.point(r[0],r[1],r[2]);t.lineEnd()}function k_(e,t){var n=-1,r=e.length;for(t.polygonStart();++n<r;)tE(e[n],t,1);t.polygonEnd()}var Vv=function(e,t){e&&x_.hasOwnProperty(e.type)?x_[e.type](e,t):Ux(e,t)};class uh{constructor(){this._partials=new Float64Array(32),this._n=0}add(t){const n=this._partials;let r=0;for(let i=0;i<this._n&&i<32;i++){const s=n[i],f=t+s,m=Math.abs(t)<Math.abs(s)?t-(f-s):s-(f-t);m&&(n[r++]=m),t=f}return n[r]=t,this._n=r+1,this}valueOf(){const t=this._partials;let n,r,i,s=this._n,f=0;if(s>0){for(f=t[--s];s>0&&(n=f,!(i=(r=t[--s])-((f=n+r)-n))););s>0&&(i<0&&t[s-1]<0||i>0&&t[s-1]>0)&&(r=2*i)==(n=f+r)-f&&(f=n)}return f}}var $i=1e-6,Va=Math.PI,gu=Va/2,Wx=Va/4,ch=2*Va,Ru=180/Va,qa=Va/180,po=Math.abs,ab=Math.atan,cm=Math.atan2,Yi=Math.cos,Vx=Math.ceil,E_=Math.exp,nE=Math.hypot,qx=Math.log,rE=Math.pow,ji=Math.sin,lm=Math.sign||function(e){return e>0?1:e<0?-1:0},lh=Math.sqrt,iE=Math.tan;function C_(e){return e>1?0:e<-1?Va:Math.acos(e)}function gd(e){return e>1?gu:e<-1?-gu:Math.asin(e)}function vl(){}var O_,A_,aE,oE,sE=new uh,uE=new uh,I0={point:vl,lineStart:vl,lineEnd:vl,polygonStart:function(){I0.lineStart=R5,I0.lineEnd=j5},polygonEnd:function(){I0.lineStart=I0.lineEnd=I0.point=vl,sE.add(po(uE)),uE=new uh},result:function(){var e=sE/2;return sE=new uh,e}};function R5(){I0.point=M5}function M5(e,t){I0.point=__,O_=aE=e,A_=oE=t}function __(e,t){uE.add(oE*e-aE*t),aE=e,oE=t}function j5(){__(O_,A_)}var S_=I0,ob=1/0,Hx=ob,Xb=-ob,$x=Xb,D_,T_,sv,uv,Gx={point:function(e,t){e<ob&&(ob=e),e>Xb&&(Xb=e),t<Hx&&(Hx=t),t>$x&&($x=t)},lineStart:vl,lineEnd:vl,polygonStart:vl,polygonEnd:vl,result:function(){var e=[[ob,Hx],[Xb,$x]];return Xb=$x=-(Hx=ob=1/0),e}},cE=0,lE=0,Yb=0,Kx=0,Xx=0,sb=0,fE=0,hE=0,Jb=0,Zm={point:ly,lineStart:N_,lineEnd:I_,polygonStart:function(){Zm.lineStart=L5,Zm.lineEnd=z5},polygonEnd:function(){Zm.point=ly,Zm.lineStart=N_,Zm.lineEnd=I_},result:function(){var e=Jb?[fE/Jb,hE/Jb]:sb?[Kx/sb,Xx/sb]:Yb?[cE/Yb,lE/Yb]:[NaN,NaN];return cE=lE=Yb=Kx=Xx=sb=fE=hE=Jb=0,e}};function ly(e,t){cE+=e,lE+=t,++Yb}function N_(){Zm.point=B5}function B5(e,t){Zm.point=P5,ly(sv=e,uv=t)}function P5(e,t){var n=e-sv,r=t-uv,i=lh(n*n+r*r);Kx+=i*(sv+e)/2,Xx+=i*(uv+t)/2,sb+=i,ly(sv=e,uv=t)}function I_(){Zm.point=ly}function L5(){Zm.point=U5}function z5(){F_(D_,T_)}function U5(e,t){Zm.point=F_,ly(D_=sv=e,T_=uv=t)}function F_(e,t){var n=e-sv,r=t-uv,i=lh(n*n+r*r);Kx+=i*(sv+e)/2,Xx+=i*(uv+t)/2,sb+=i,fE+=(i=uv*e-sv*t)*(sv+e),hE+=i*(uv+t),Jb+=3*i,ly(sv=e,uv=t)}var R_=Zm;function M_(e){this._context=e}M_.prototype={_radius:4.5,pointRadius:function(e){return this._radius=e,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._context.closePath(),this._point=NaN},point:function(e,t){switch(this._point){case 0:this._context.moveTo(e,t),this._point=1;break;case 1:this._context.lineTo(e,t);break;default:this._context.moveTo(e+this._radius,t),this._context.arc(e,t,this._radius,0,ch)}},result:vl};var dE,j_,B_,Qb,Zb,pE=new uh,Yx={point:vl,lineStart:function(){Yx.point=W5},lineEnd:function(){dE&&P_(j_,B_),Yx.point=vl},polygonStart:function(){dE=!0},polygonEnd:function(){dE=null},result:function(){var e=+pE;return pE=new uh,e}};function W5(e,t){Yx.point=P_,j_=Qb=e,B_=Zb=t}function P_(e,t){Qb-=e,Zb-=t,pE.add(lh(Qb*Qb+Zb*Zb)),Qb=e,Zb=t}var L_=Yx;function z_(){this._string=[]}function U_(e){return"m0,"+e+"a"+e+","+e+" 0 1,1 0,"+-2*e+"a"+e+","+e+" 0 1,1 0,"+2*e+"z"}z_.prototype={_radius:4.5,_circle:U_(4.5),pointRadius:function(e){return(e=+e)!==this._radius&&(this._radius=e,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._string.push("Z"),this._point=NaN},point:function(e,t){switch(this._point){case 0:this._string.push("M",e,",",t),this._point=1;break;case 1:this._string.push("L",e,",",t);break;default:this._circle==null&&(this._circle=U_(this._radius)),this._string.push("M",e,",",t,this._circle)}},result:function(){if(this._string.length){var e=this._string.join("");return this._string=[],e}return null}};var W_=function(e,t){var n,r,i=4.5;function s(f){return f&&(typeof i=="function"&&r.pointRadius(+i.apply(this,arguments)),Vv(f,n(r))),r.result()}return s.area=function(f){return Vv(f,n(S_)),S_.result()},s.measure=function(f){return Vv(f,n(L_)),L_.result()},s.bounds=function(f){return Vv(f,n(Gx)),Gx.result()},s.centroid=function(f){return Vv(f,n(R_)),R_.result()},s.projection=function(f){return arguments.length?(n=f==null?(e=null,Kb):(e=f).stream,s):e},s.context=function(f){return arguments.length?(r=f==null?(t=null,new z_):new M_(t=f),typeof i!="function"&&r.pointRadius(i),s):t},s.pointRadius=function(f){return arguments.length?(i=typeof f=="function"?f:(r.pointRadius(+f),+f),s):i},s.projection(e).context(t)},V_=function(){var e,t=[];return{point:function(n,r,i){e.push([n,r,i])},lineStart:function(){t.push(e=[])},lineEnd:vl,rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))},result:function(){var n=t;return t=[],e=null,n}}},Jx=function(e,t){return po(e[0]-t[0])<$i&&po(e[1]-t[1])<$i};function Qx(e,t,n,r){this.x=e,this.z=t,this.o=n,this.e=r,this.v=!1,this.n=this.p=null}var q_=function(e,t,n,r,i){var s,f,m=[],x=[];if(e.forEach(function(se){if(!((le=se.length-1)<=0)){var le,Fe,Le=se[0],ze=se[le];if(Jx(Le,ze)){if(!Le[2]&&!ze[2]){for(i.lineStart(),s=0;s<le;++s)i.point((Le=se[s])[0],Le[1]);return void i.lineEnd()}ze[0]+=2*$i}m.push(Fe=new Qx(Le,se,null,!0)),x.push(Fe.o=new Qx(Le,null,Fe,!1)),m.push(Fe=new Qx(ze,se,null,!1)),x.push(Fe.o=new Qx(ze,null,Fe,!0))}}),m.length){for(x.sort(t),H_(m),H_(x),s=0,f=x.length;s<f;++s)x[s].e=n=!n;for(var O,T,M=m[0];;){for(var q=M,Q=!0;q.v;)if((q=q.n)===M)return;O=q.z,i.lineStart();do{if(q.v=q.o.v=!0,q.e){if(Q)for(s=0,f=O.length;s<f;++s)i.point((T=O[s])[0],T[1]);else r(q.x,q.n.x,1,i);q=q.n}else{if(Q)for(O=q.p.z,s=O.length-1;s>=0;--s)i.point((T=O[s])[0],T[1]);else r(q.x,q.p.x,-1,i);q=q.p}O=(q=q.o).z,Q=!Q}while(!q.v);i.lineEnd()}}};function H_(e){if(t=e.length){for(var t,n,r=0,i=e[0];++r<t;)i.n=n=e[r],n.p=i,i=n;i.n=n=e[0],n.p=i}}function Zx(e){return[cm(e[1],e[0]),gd(e[2])]}function fy(e){var t=e[0],n=e[1],r=Yi(n);return[r*Yi(t),r*ji(t),ji(n)]}function e2(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function ub(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function mE(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function t2(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function n2(e){var t=lh(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}function gE(e){return po(e[0])<=Va?e[0]:lm(e[0])*((po(e[0])+Va)%ch-Va)}function $_(e){return Array.from(function*(t){for(const n of t)yield*n}(e))}var G_=function(e,t,n,r){return function(i){var s,f,m,x=t(i),O=V_(),T=t(O),M=!1,q={point:Q,lineStart:le,lineEnd:Fe,polygonStart:function(){q.point=Le,q.lineStart=ze,q.lineEnd=nt,f=[],s=[]},polygonEnd:function(){q.point=Q,q.lineStart=le,q.lineEnd=Fe,f=$_(f);var it=function(ut,st){var pt=gE(st),dt=st[1],Qt=ji(dt),mn=[ji(pt),-Yi(pt),0],on=0,Rn=0,Fn=new uh;Qt===1?dt=gu+$i:Qt===-1&&(dt=-gu-$i);for(var zn=0,Vn=ut.length;zn<Vn;++zn)if(pr=(Qn=ut[zn]).length)for(var Qn,pr,Pr=Qn[pr-1],Ar=gE(Pr),Jr=Pr[1]/2+Wx,gi=ji(Jr),vi=Yi(Jr),Li=0;Li<pr;++Li,Ar=yi,gi=xa,vi=no,Pr=wi){var wi=Qn[Li],yi=gE(wi),Si=wi[1]/2+Wx,xa=ji(Si),no=Yi(Si),zi=yi-Ar,vo=zi>=0?1:-1,Lo=vo*zi,co=Lo>Va,Is=gi*xa;if(Fn.add(cm(Is*vo*ji(Lo),vi*no+Is*Yi(Lo))),on+=co?zi+vo*ch:zi,co^Ar>=pt^yi>=pt){var Fs=ub(fy(Pr),fy(wi));n2(Fs);var gs=ub(mn,Fs);n2(gs);var kl=(co^zi>=0?-1:1)*gd(gs[2]);(dt>kl||dt===kl&&(Fs[0]||Fs[1]))&&(Rn+=co^zi>=0?1:-1)}}return(on<-$i||on<$i&&Fn<-1e-12)^1&Rn}(s,r);f.length?(M||(i.polygonStart(),M=!0),q_(f,q5,it,n,i)):it&&(M||(i.polygonStart(),M=!0),i.lineStart(),n(null,null,1,i),i.lineEnd()),M&&(i.polygonEnd(),M=!1),f=s=null},sphere:function(){i.polygonStart(),i.lineStart(),n(null,null,1,i),i.lineEnd(),i.polygonEnd()}};function Q(it,ut){e(it,ut)&&i.point(it,ut)}function se(it,ut){x.point(it,ut)}function le(){q.point=se,x.lineStart()}function Fe(){q.point=Q,x.lineEnd()}function Le(it,ut){m.push([it,ut]),T.point(it,ut)}function ze(){T.lineStart(),m=[]}function nt(){Le(m[0][0],m[0][1]),T.lineEnd();var it,ut,st,pt,dt=T.clean(),Qt=O.result(),mn=Qt.length;if(m.pop(),s.push(m),m=null,mn)if(1&dt){if((ut=(st=Qt[0]).length-1)>0){for(M||(i.polygonStart(),M=!0),i.lineStart(),it=0;it<ut;++it)i.point((pt=st[it])[0],pt[1]);i.lineEnd()}}else mn>1&&2&dt&&Qt.push(Qt.pop().concat(Qt.shift())),f.push(Qt.filter(V5))}return q}};function V5(e){return e.length>1}function q5(e,t){return((e=e.x)[0]<0?e[1]-gu-$i:gu-e[1])-((t=t.x)[0]<0?t[1]-gu-$i:gu-t[1])}var K_=G_(function(){return!0},function(e){var t,n=NaN,r=NaN,i=NaN;return{lineStart:function(){e.lineStart(),t=1},point:function(s,f){var m=s>0?Va:-Va,x=po(s-n);po(x-Va)<$i?(e.point(n,r=(r+f)/2>0?gu:-gu),e.point(i,r),e.lineEnd(),e.lineStart(),e.point(m,r),e.point(s,r),t=0):i!==m&&x>=Va&&(po(n-i)<$i&&(n-=i*$i),po(s-m)<$i&&(s-=m*$i),r=function(O,T,M,q){var Q,se,le=ji(O-M);return po(le)>$i?ab((ji(T)*(se=Yi(q))*ji(M)-ji(q)*(Q=Yi(T))*ji(O))/(Q*se*le)):(T+q)/2}(n,r,s,f),e.point(i,r),e.lineEnd(),e.lineStart(),e.point(m,r),t=0),e.point(n=s,r=f),i=m},lineEnd:function(){e.lineEnd(),n=r=NaN},clean:function(){return 2-t}}},function(e,t,n,r){var i;if(e==null)i=n*gu,r.point(-Va,i),r.point(0,i),r.point(Va,i),r.point(Va,0),r.point(Va,-i),r.point(0,-i),r.point(-Va,-i),r.point(-Va,0),r.point(-Va,i);else if(po(e[0]-t[0])>$i){var s=e[0]<t[0]?Va:-Va;i=n*s/2,r.point(-s,i),r.point(0,i),r.point(s,i)}else r.point(t[0],t[1])},[-Va,-gu]),vE=function(e,t){function n(r,i){return r=e(r,i),t(r[0],r[1])}return e.invert&&t.invert&&(n.invert=function(r,i){return(r=t.invert(r,i))&&e.invert(r[0],r[1])}),n};function yE(e,t){return[po(e)>Va?e+Math.round(-e/ch)*ch:e,t]}function X_(e,t,n){return(e%=ch)?t||n?vE(J_(e),Q_(t,n)):J_(e):t||n?Q_(t,n):yE}function Y_(e){return function(t,n){return[(t+=e)>Va?t-ch:t<-Va?t+ch:t,n]}}function J_(e){var t=Y_(e);return t.invert=Y_(-e),t}function Q_(e,t){var n=Yi(e),r=ji(e),i=Yi(t),s=ji(t);function f(m,x){var O=Yi(x),T=Yi(m)*O,M=ji(m)*O,q=ji(x),Q=q*n+T*r;return[cm(M*i-Q*s,T*n-q*r),gd(Q*i+M*s)]}return f.invert=function(m,x){var O=Yi(x),T=Yi(m)*O,M=ji(m)*O,q=ji(x),Q=q*i-M*s;return[cm(M*i+q*s,T*n+Q*r),gd(Q*n-T*r)]},f}yE.invert=yE;var H5=function(e){function t(n){return(n=e(n[0]*qa,n[1]*qa))[0]*=Ru,n[1]*=Ru,n}return e=X_(e[0]*qa,e[1]*qa,e.length>2?e[2]*qa:0),t.invert=function(n){return(n=e.invert(n[0]*qa,n[1]*qa))[0]*=Ru,n[1]*=Ru,n},t};function $5(e,t,n,r,i,s){if(n){var f=Yi(t),m=ji(t),x=r*n;i==null?(i=t+r*ch,s=t-x/2):(i=Z_(f,i),s=Z_(f,s),(r>0?i<s:i>s)&&(i+=r*ch));for(var O,T=i;r>0?T>s:T<s;T-=x)O=Zx([f,-m*Yi(T),-m*ji(T)]),e.point(O[0],O[1])}}function Z_(e,t){(t=fy(t))[0]-=e,n2(t);var n=C_(-t[1]);return((-t[2]<0?-n:n)+ch-$i)%ch}var G5=function(e){var t=Yi(e),n=6*qa,r=t>0,i=po(t)>$i;function s(x,O){return Yi(x)*Yi(O)>t}function f(x,O,T){var M=[1,0,0],q=ub(fy(x),fy(O)),Q=e2(q,q),se=q[0],le=Q-se*se;if(!le)return!T&&x;var Fe=t*Q/le,Le=-t*se/le,ze=ub(M,q),nt=t2(M,Fe);mE(nt,t2(q,Le));var it=ze,ut=e2(nt,it),st=e2(it,it),pt=ut*ut-st*(e2(nt,nt)-1);if(!(pt<0)){var dt=lh(pt),Qt=t2(it,(-ut-dt)/st);if(mE(Qt,nt),Qt=Zx(Qt),!T)return Qt;var mn,on=x[0],Rn=O[0],Fn=x[1],zn=O[1];Rn<on&&(mn=on,on=Rn,Rn=mn);var Vn=Rn-on,Qn=po(Vn-Va)<$i;if(!Qn&&zn<Fn&&(mn=Fn,Fn=zn,zn=mn),Qn||Vn<$i?Qn?Fn+zn>0^Qt[1]<(po(Qt[0]-on)<$i?Fn:zn):Fn<=Qt[1]&&Qt[1]<=zn:Vn>Va^(on<=Qt[0]&&Qt[0]<=Rn)){var pr=t2(it,(-ut+dt)/st);return mE(pr,nt),[Qt,Zx(pr)]}}}function m(x,O){var T=r?e:Va-e,M=0;return x<-T?M|=1:x>T&&(M|=2),O<-T?M|=4:O>T&&(M|=8),M}return G_(s,function(x){var O,T,M,q,Q;return{lineStart:function(){q=M=!1,Q=1},point:function(se,le){var Fe,Le=[se,le],ze=s(se,le),nt=r?ze?0:m(se,le):ze?m(se+(se<0?Va:-Va),le):0;if(!O&&(q=M=ze)&&x.lineStart(),ze!==M&&(!(Fe=f(O,Le))||Jx(O,Fe)||Jx(Le,Fe))&&(Le[2]=1),ze!==M)Q=0,ze?(x.lineStart(),Fe=f(Le,O),x.point(Fe[0],Fe[1])):(Fe=f(O,Le),x.point(Fe[0],Fe[1],2),x.lineEnd()),O=Fe;else if(i&&O&&r^ze){var it;nt&T||!(it=f(Le,O,!0))||(Q=0,r?(x.lineStart(),x.point(it[0][0],it[0][1]),x.point(it[1][0],it[1][1]),x.lineEnd()):(x.point(it[1][0],it[1][1]),x.lineEnd(),x.lineStart(),x.point(it[0][0],it[0][1],3)))}!ze||O&&Jx(O,Le)||x.point(Le[0],Le[1]),O=Le,M=ze,T=nt},lineEnd:function(){M&&x.lineEnd(),O=null},clean:function(){return Q|(q&&M)<<1}}},function(x,O,T,M){$5(M,e,n,T,x,O)},r?[0,-e]:[-Va,e-Va])},K5=function(e,t,n,r,i,s){var f,m=e[0],x=e[1],O=0,T=1,M=t[0]-m,q=t[1]-x;if(f=n-m,M||!(f>0)){if(f/=M,M<0){if(f<O)return;f<T&&(T=f)}else if(M>0){if(f>T)return;f>O&&(O=f)}if(f=i-m,M||!(f<0)){if(f/=M,M<0){if(f>T)return;f>O&&(O=f)}else if(M>0){if(f<O)return;f<T&&(T=f)}if(f=r-x,q||!(f>0)){if(f/=q,q<0){if(f<O)return;f<T&&(T=f)}else if(q>0){if(f>T)return;f>O&&(O=f)}if(f=s-x,q||!(f<0)){if(f/=q,q<0){if(f>T)return;f>O&&(O=f)}else if(q>0){if(f<O)return;f<T&&(T=f)}return O>0&&(e[0]=m+O*M,e[1]=x+O*q),T<1&&(t[0]=m+T*M,t[1]=x+T*q),!0}}}}},e1=1e9,r2=-e1;function eS(e,t,n,r){function i(O,T){return e<=O&&O<=n&&t<=T&&T<=r}function s(O,T,M,q){var Q=0,se=0;if(O==null||(Q=f(O,M))!==(se=f(T,M))||x(O,T)<0^M>0)do q.point(Q===0||Q===3?e:n,Q>1?r:t);while((Q=(Q+M+4)%4)!==se);else q.point(T[0],T[1])}function f(O,T){return po(O[0]-e)<$i?T>0?0:3:po(O[0]-n)<$i?T>0?2:1:po(O[1]-t)<$i?T>0?1:0:T>0?3:2}function m(O,T){return x(O.x,T.x)}function x(O,T){var M=f(O,1),q=f(T,1);return M!==q?M-q:M===0?T[1]-O[1]:M===1?O[0]-T[0]:M===2?O[1]-T[1]:T[0]-O[0]}return function(O){var T,M,q,Q,se,le,Fe,Le,ze,nt,it,ut=O,st=V_(),pt={point:dt,lineStart:function(){pt.point=Qt,M&&M.push(q=[]),nt=!0,ze=!1,Fe=Le=NaN},lineEnd:function(){T&&(Qt(Q,se),le&&ze&&st.rejoin(),T.push(st.result())),pt.point=dt,ze&&ut.lineEnd()},polygonStart:function(){ut=st,T=[],M=[],it=!0},polygonEnd:function(){var mn=function(){for(var Fn=0,zn=0,Vn=M.length;zn<Vn;++zn)for(var Qn,pr,Pr=M[zn],Ar=1,Jr=Pr.length,gi=Pr[0],vi=gi[0],Li=gi[1];Ar<Jr;++Ar)Qn=vi,pr=Li,gi=Pr[Ar],vi=gi[0],Li=gi[1],pr<=r?Li>r&&(vi-Qn)*(r-pr)>(Li-pr)*(e-Qn)&&++Fn:Li<=r&&(vi-Qn)*(r-pr)<(Li-pr)*(e-Qn)&&--Fn;return Fn}(),on=it&&mn,Rn=(T=$_(T)).length;(on||Rn)&&(O.polygonStart(),on&&(O.lineStart(),s(null,null,1,O),O.lineEnd()),Rn&&q_(T,m,mn,s,O),O.polygonEnd()),ut=O,T=M=q=null}};function dt(mn,on){i(mn,on)&&ut.point(mn,on)}function Qt(mn,on){var Rn=i(mn,on);if(M&&q.push([mn,on]),nt)Q=mn,se=on,le=Rn,nt=!1,Rn&&(ut.lineStart(),ut.point(mn,on));else if(Rn&&ze)ut.point(mn,on);else{var Fn=[Fe=Math.max(r2,Math.min(e1,Fe)),Le=Math.max(r2,Math.min(e1,Le))],zn=[mn=Math.max(r2,Math.min(e1,mn)),on=Math.max(r2,Math.min(e1,on))];K5(Fn,zn,e,t,n,r)?(ze||(ut.lineStart(),ut.point(Fn[0],Fn[1])),ut.point(zn[0],zn[1]),Rn||ut.lineEnd(),it=!1):Rn&&(ut.lineStart(),ut.point(mn,on),it=!1)}Fe=mn,Le=on,ze=Rn}return pt}}function i2(e){return function(t){var n=new bE;for(var r in e)n[r]=e[r];return n.stream=t,n}}function bE(){}function xE(e,t,n){var r=e.clipExtent&&e.clipExtent();return e.scale(150).translate([0,0]),r!=null&&e.clipExtent(null),Vv(n,e.stream(Gx)),t(Gx.result()),r!=null&&e.clipExtent(r),e}function a2(e,t,n){return xE(e,function(r){var i=t[1][0]-t[0][0],s=t[1][1]-t[0][1],f=Math.min(i/(r[1][0]-r[0][0]),s/(r[1][1]-r[0][1])),m=+t[0][0]+(i-f*(r[1][0]+r[0][0]))/2,x=+t[0][1]+(s-f*(r[1][1]+r[0][1]))/2;e.scale(150*f).translate([m,x])},n)}function wE(e,t,n){return a2(e,[[0,0],t],n)}function kE(e,t,n){return xE(e,function(r){var i=+t,s=i/(r[1][0]-r[0][0]),f=(i-s*(r[1][0]+r[0][0]))/2,m=-s*r[0][1];e.scale(150*s).translate([f,m])},n)}function EE(e,t,n){return xE(e,function(r){var i=+t,s=i/(r[1][1]-r[0][1]),f=-s*r[0][0],m=(i-s*(r[1][1]+r[0][1]))/2;e.scale(150*s).translate([f,m])},n)}bE.prototype={constructor:bE,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var tS=16,X5=Yi(30*qa),nS=function(e,t){return+t?function(n,r){function i(s,f,m,x,O,T,M,q,Q,se,le,Fe,Le,ze){var nt=M-s,it=q-f,ut=nt*nt+it*it;if(ut>4*r&&Le--){var st=x+se,pt=O+le,dt=T+Fe,Qt=lh(st*st+pt*pt+dt*dt),mn=gd(dt/=Qt),on=po(po(dt)-1)<$i||po(m-Q)<$i?(m+Q)/2:cm(pt,st),Rn=n(on,mn),Fn=Rn[0],zn=Rn[1],Vn=Fn-s,Qn=zn-f,pr=it*Vn-nt*Qn;(pr*pr/ut>r||po((nt*Vn+it*Qn)/ut-.5)>.3||x*se+O*le+T*Fe<X5)&&(i(s,f,m,x,O,T,Fn,zn,on,st/=Qt,pt/=Qt,dt,Le,ze),ze.point(Fn,zn),i(Fn,zn,on,st,pt,dt,M,q,Q,se,le,Fe,Le,ze))}}return function(s){var f,m,x,O,T,M,q,Q,se,le,Fe,Le,ze={point:nt,lineStart:it,lineEnd:st,polygonStart:function(){s.polygonStart(),ze.lineStart=pt},polygonEnd:function(){s.polygonEnd(),ze.lineStart=it}};function nt(mn,on){mn=n(mn,on),s.point(mn[0],mn[1])}function it(){Q=NaN,ze.point=ut,s.lineStart()}function ut(mn,on){var Rn=fy([mn,on]),Fn=n(mn,on);i(Q,se,q,le,Fe,Le,Q=Fn[0],se=Fn[1],q=mn,le=Rn[0],Fe=Rn[1],Le=Rn[2],tS,s),s.point(Q,se)}function st(){ze.point=nt,s.lineEnd()}function pt(){it(),ze.point=dt,ze.lineEnd=Qt}function dt(mn,on){ut(f=mn,on),m=Q,x=se,O=le,T=Fe,M=Le,ze.point=ut}function Qt(){i(Q,se,q,le,Fe,Le,m,x,f,O,T,M,tS,s),ze.lineEnd=st,st()}return ze}}(e,t):function(n){return i2({point:function(r,i){r=n(r,i),this.stream.point(r[0],r[1])}})}(e)},Y5=i2({point:function(e,t){this.stream.point(e*qa,t*qa)}});function rS(e,t,n,r,i,s){if(!s)return function(le,Fe,Le,ze,nt){function it(ut,st){return[Fe+le*(ut*=ze),Le-le*(st*=nt)]}return it.invert=function(ut,st){return[(ut-Fe)/le*ze,(Le-st)/le*nt]},it}(e,t,n,r,i);var f=Yi(s),m=ji(s),x=f*e,O=m*e,T=f/e,M=m/e,q=(m*n-f*t)/e,Q=(m*t+f*n)/e;function se(le,Fe){return[x*(le*=r)-O*(Fe*=i)+t,n-O*le-x*Fe]}return se.invert=function(le,Fe){return[r*(T*le-M*Fe+q),i*(Q-M*le-T*Fe)]},se}function cv(e){return iS(function(){return e})()}function iS(e){var t,n,r,i,s,f,m,x,O,T,M=150,q=480,Q=250,se=0,le=0,Fe=0,Le=0,ze=0,nt=0,it=1,ut=1,st=null,pt=K_,dt=null,Qt=Kb,mn=.5;function on(Vn){return x(Vn[0]*qa,Vn[1]*qa)}function Rn(Vn){return(Vn=x.invert(Vn[0],Vn[1]))&&[Vn[0]*Ru,Vn[1]*Ru]}function Fn(){var Vn=rS(M,0,0,it,ut,nt).apply(null,t(se,le)),Qn=rS(M,q-Vn[0],Q-Vn[1],it,ut,nt);return n=X_(Fe,Le,ze),m=vE(t,Qn),x=vE(n,m),f=nS(m,mn),zn()}function zn(){return O=T=null,on}return on.stream=function(Vn){return O&&T===Vn?O:O=Y5(function(Qn){return i2({point:function(pr,Pr){var Ar=Qn(pr,Pr);return this.stream.point(Ar[0],Ar[1])}})}(n)(pt(f(Qt(T=Vn)))))},on.preclip=function(Vn){return arguments.length?(pt=Vn,st=void 0,zn()):pt},on.postclip=function(Vn){return arguments.length?(Qt=Vn,dt=r=i=s=null,zn()):Qt},on.clipAngle=function(Vn){return arguments.length?(pt=+Vn?G5(st=Vn*qa):(st=null,K_),zn()):st*Ru},on.clipExtent=function(Vn){return arguments.length?(Qt=Vn==null?(dt=r=i=s=null,Kb):eS(dt=+Vn[0][0],r=+Vn[0][1],i=+Vn[1][0],s=+Vn[1][1]),zn()):dt==null?null:[[dt,r],[i,s]]},on.scale=function(Vn){return arguments.length?(M=+Vn,Fn()):M},on.translate=function(Vn){return arguments.length?(q=+Vn[0],Q=+Vn[1],Fn()):[q,Q]},on.center=function(Vn){return arguments.length?(se=Vn[0]%360*qa,le=Vn[1]%360*qa,Fn()):[se*Ru,le*Ru]},on.rotate=function(Vn){return arguments.length?(Fe=Vn[0]%360*qa,Le=Vn[1]%360*qa,ze=Vn.length>2?Vn[2]%360*qa:0,Fn()):[Fe*Ru,Le*Ru,ze*Ru]},on.angle=function(Vn){return arguments.length?(nt=Vn%360*qa,Fn()):nt*Ru},on.reflectX=function(Vn){return arguments.length?(it=Vn?-1:1,Fn()):it<0},on.reflectY=function(Vn){return arguments.length?(ut=Vn?-1:1,Fn()):ut<0},on.precision=function(Vn){return arguments.length?(f=nS(m,mn=Vn*Vn),zn()):lh(mn)},on.fitExtent=function(Vn,Qn){return a2(on,Vn,Qn)},on.fitSize=function(Vn,Qn){return wE(on,Vn,Qn)},on.fitWidth=function(Vn,Qn){return kE(on,Vn,Qn)},on.fitHeight=function(Vn,Qn){return EE(on,Vn,Qn)},function(){return t=e.apply(this,arguments),on.invert=t.invert&&Rn,Fn()}}function CE(e){var t=0,n=Va/3,r=iS(e),i=r(t,n);return i.parallels=function(s){return arguments.length?r(t=s[0]*qa,n=s[1]*qa):[t*Ru,n*Ru]},i}function J5(e,t){var n=ji(e),r=(n+ji(t))/2;if(po(r)<$i)return function(m){var x=Yi(m);function O(T,M){return[T*x,ji(M)/x]}return O.invert=function(T,M){return[T/x,gd(M*x)]},O}(e);var i=1+n*(2*r-n),s=lh(i)/r;function f(m,x){var O=lh(i-2*r*ji(x))/r;return[O*ji(m*=r),s-O*Yi(m)]}return f.invert=function(m,x){var O=s-x,T=cm(m,po(O))*lm(O);return O*r<0&&(T-=Va*lm(m)*lm(O)),[T/r,gd((i-(m*m+O*O)*r*r)/(2*r))]},f}var o2=function(){return CE(J5).scale(155.424).center([0,33.6442])},aS=function(){return o2().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])};function oS(e){return function(t,n){var r=Yi(t),i=Yi(n),s=e(r*i);return s===1/0?[2,0]:[s*i*ji(t),s*ji(n)]}}function t1(e){return function(t,n){var r=lh(t*t+n*n),i=e(r),s=ji(i),f=Yi(i);return[cm(t*s,r*f),gd(r&&n*s/r)]}}var sS=oS(function(e){return lh(2/(1+e))});sS.invert=t1(function(e){return 2*gd(e/2)});var uS=oS(function(e){return(e=C_(e))&&e/ji(e)});uS.invert=t1(function(e){return e});function s2(e,t){return[e,qx(iE((gu+t)/2))]}s2.invert=function(e,t){return[e,2*ab(E_(t))-gu]};function cS(e){var t,n,r,i=cv(e),s=i.center,f=i.scale,m=i.translate,x=i.clipExtent,O=null;function T(){var M=Va*f(),q=i(H5(i.rotate()).invert([0,0]));return x(O==null?[[q[0]-M,q[1]-M],[q[0]+M,q[1]+M]]:e===s2?[[Math.max(q[0]-M,O),t],[Math.min(q[0]+M,n),r]]:[[O,Math.max(q[1]-M,t)],[n,Math.min(q[1]+M,r)]])}return i.scale=function(M){return arguments.length?(f(M),T()):f()},i.translate=function(M){return arguments.length?(m(M),T()):m()},i.center=function(M){return arguments.length?(s(M),T()):s()},i.clipExtent=function(M){return arguments.length?(M==null?O=t=n=r=null:(O=+M[0][0],t=+M[0][1],n=+M[1][0],r=+M[1][1]),T()):O==null?null:[[O,t],[n,r]]},T()}function u2(e){return iE((gu+e)/2)}function Q5(e,t){var n=Yi(e),r=e===t?ji(e):qx(n/Yi(t))/qx(u2(t)/u2(e)),i=n*rE(u2(e),r)/r;if(!r)return s2;function s(f,m){i>0?m<-gu+$i&&(m=-gu+$i):m>gu-$i&&(m=gu-$i);var x=i/rE(u2(m),r);return[x*ji(r*f),i-x*Yi(r*f)]}return s.invert=function(f,m){var x=i-m,O=lm(r)*lh(f*f+x*x),T=cm(f,po(x))*lm(x);return x*r<0&&(T-=Va*lm(f)*lm(x)),[T/r,2*ab(rE(i/O,1/r))-gu]},s}function c2(e,t){return[e,t]}c2.invert=c2;function Z5(e,t){var n=Yi(e),r=e===t?ji(e):(n-Yi(t))/(t-e),i=n/r+e;if(po(r)<$i)return c2;function s(f,m){var x=i-m,O=r*f;return[x*ji(O),i-x*Yi(O)]}return s.invert=function(f,m){var x=i-m,O=cm(f,po(x))*lm(x);return x*r<0&&(O-=Va*lm(f)*lm(x)),[O/r,i-lm(r)*lh(f*f+x*x)]},s}var n1=1.340264,r1=-.081106,i1=893e-6,a1=.003796,l2=lh(3)/2;function lS(e,t){var n=gd(l2*ji(t)),r=n*n,i=r*r*r;return[e*Yi(n)/(l2*(n1+3*r1*r+i*(7*i1+9*a1*r))),n*(n1+r1*r+i*(i1+a1*r))]}lS.invert=function(e,t){for(var n,r=t,i=r*r,s=i*i*i,f=0;f<12&&(s=(i=(r-=n=(r*(n1+r1*i+s*(i1+a1*i))-t)/(n1+3*r1*i+s*(7*i1+9*a1*i)))*r)*i*i,!(po(n)<1e-12));++f);return[l2*e*(n1+3*r1*i+s*(7*i1+9*a1*i))/Yi(r),gd(ji(r)/l2)]};function fS(e,t){var n=Yi(t),r=Yi(e)*n;return[n*ji(e)/r,ji(t)/r]}fS.invert=t1(ab);function hS(e,t){var n=t*t,r=n*n;return[e*(.8707-.131979*n+r*(r*(.003971*n-.001529*r)-.013791)),t*(1.007226+n*(.015085+r*(.028874*n-.044475-.005916*r)))]}hS.invert=function(e,t){var n,r=t,i=25;do{var s=r*r,f=s*s;r-=n=(r*(1.007226+s*(.015085+f*(.028874*s-.044475-.005916*f)))-t)/(1.007226+s*(.045255+f*(.259866*s-.311325-.005916*11*f)))}while(po(n)>$i&&--i>0);return[e/(.8707+(s=r*r)*(s*(s*s*s*(.003971-.001529*s)-.013791)-.131979)),r]};function dS(e,t){return[Yi(t)*ji(e),ji(t)]}dS.invert=t1(gd);function pS(e,t){var n=Yi(t),r=1+Yi(e)*n;return[n*ji(e)/r,ji(t)/r]}pS.invert=t1(function(e){return 2*ab(e)});function mS(e,t){return[qx(iE((gu+t)/2)),-e]}mS.invert=function(e,t){return[-t,2*ab(E_(e))-gu]};var eM=Math.abs,OE=Math.cos,f2=Math.sin,tM=1e-6,gS=Math.PI,AE=gS/2,vS=nM(2);function yS(e){return e>1?AE:e<-1?-AE:Math.asin(e)}function nM(e){return e>0?Math.sqrt(e):0}var rM=function(e,t,n){function r(i,s){return[e*i*OE(s=function(f,m){var x,O=f*f2(m),T=30;do m-=x=(m+f2(m)-O)/(1+OE(m));while(eM(x)>tM&&--T>0);return m/2}(n,s)),t*f2(s)]}return r.invert=function(i,s){return s=yS(s/t),[i/(e*OE(s)),yS((2*s+f2(2*s))/n)]},r}(vS/AE,vS,gS);const iM=W_(),_E=["clipAngle","clipExtent","scale","translate","center","rotate","parallels","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];function SE(e,t){if(!e||typeof e!="string")throw new Error("Projection type must be a name string.");return e=e.toLowerCase(),arguments.length>1?(h2[e]=function(n,r){return function i(){const s=r();return s.type=n,s.path=W_().projection(s),s.copy=s.copy||function(){const f=i();return _E.forEach(m=>{s[m]&&f[m](s[m]())}),f.path.pointRadius(s.path.pointRadius()),f},s}}(e,t),this):h2[e]||null}function bS(e){return e&&e.path||iM}const h2={albers:aS,albersusa:function(){var e,t,n,r,i,s,f=aS(),m=o2().rotate([154,0]).center([-2,58.5]).parallels([55,65]),x=o2().rotate([157,0]).center([-3,19.9]).parallels([8,18]),O={point:function(q,Q){s=[q,Q]}};function T(q){var Q=q[0],se=q[1];return s=null,n.point(Q,se),s||(r.point(Q,se),s)||(i.point(Q,se),s)}function M(){return e=t=null,T}return T.invert=function(q){var Q=f.scale(),se=f.translate(),le=(q[0]-se[0])/Q,Fe=(q[1]-se[1])/Q;return(Fe>=.12&&Fe<.234&&le>=-.425&&le<-.214?m:Fe>=.166&&Fe<.234&&le>=-.214&&le<-.115?x:f).invert(q)},T.stream=function(q){return e&&t===q?e:e=function(Q){var se=Q.length;return{point:function(le,Fe){for(var Le=-1;++Le<se;)Q[Le].point(le,Fe)},sphere:function(){for(var le=-1;++le<se;)Q[le].sphere()},lineStart:function(){for(var le=-1;++le<se;)Q[le].lineStart()},lineEnd:function(){for(var le=-1;++le<se;)Q[le].lineEnd()},polygonStart:function(){for(var le=-1;++le<se;)Q[le].polygonStart()},polygonEnd:function(){for(var le=-1;++le<se;)Q[le].polygonEnd()}}}([f.stream(t=q),m.stream(q),x.stream(q)])},T.precision=function(q){return arguments.length?(f.precision(q),m.precision(q),x.precision(q),M()):f.precision()},T.scale=function(q){return arguments.length?(f.scale(q),m.scale(.35*q),x.scale(q),T.translate(f.translate())):f.scale()},T.translate=function(q){if(!arguments.length)return f.translate();var Q=f.scale(),se=+q[0],le=+q[1];return n=f.translate(q).clipExtent([[se-.455*Q,le-.238*Q],[se+.455*Q,le+.238*Q]]).stream(O),r=m.translate([se-.307*Q,le+.201*Q]).clipExtent([[se-.425*Q+$i,le+.12*Q+$i],[se-.214*Q-$i,le+.234*Q-$i]]).stream(O),i=x.translate([se-.205*Q,le+.212*Q]).clipExtent([[se-.214*Q+$i,le+.166*Q+$i],[se-.115*Q-$i,le+.234*Q-$i]]).stream(O),M()},T.fitExtent=function(q,Q){return a2(T,q,Q)},T.fitSize=function(q,Q){return wE(T,q,Q)},T.fitWidth=function(q,Q){return kE(T,q,Q)},T.fitHeight=function(q,Q){return EE(T,q,Q)},T.scale(1070)},azimuthalequalarea:function(){return cv(sS).scale(124.75).clipAngle(179.999)},azimuthalequidistant:function(){return cv(uS).scale(79.4188).clipAngle(179.999)},conicconformal:function(){return CE(Q5).scale(109.5).parallels([30,30])},conicequalarea:o2,conicequidistant:function(){return CE(Z5).scale(131.154).center([0,13.9389])},equalEarth:function(){return cv(lS).scale(177.158)},equirectangular:function(){return cv(c2).scale(152.63)},gnomonic:function(){return cv(fS).scale(144.049).clipAngle(60)},identity:function(){var e,t,n,r,i,s,f,m=1,x=0,O=0,T=1,M=1,q=0,Q=null,se=1,le=1,Fe=i2({point:function(it,ut){var st=nt([it,ut]);this.stream.point(st[0],st[1])}}),Le=Kb;function ze(){return se=m*T,le=m*M,s=f=null,nt}function nt(it){var ut=it[0]*se,st=it[1]*le;if(q){var pt=st*e-ut*t;ut=ut*e+st*t,st=pt}return[ut+x,st+O]}return nt.invert=function(it){var ut=it[0]-x,st=it[1]-O;if(q){var pt=st*e+ut*t;ut=ut*e-st*t,st=pt}return[ut/se,st/le]},nt.stream=function(it){return s&&f===it?s:s=Fe(Le(f=it))},nt.postclip=function(it){return arguments.length?(Le=it,Q=n=r=i=null,ze()):Le},nt.clipExtent=function(it){return arguments.length?(Le=it==null?(Q=n=r=i=null,Kb):eS(Q=+it[0][0],n=+it[0][1],r=+it[1][0],i=+it[1][1]),ze()):Q==null?null:[[Q,n],[r,i]]},nt.scale=function(it){return arguments.length?(m=+it,ze()):m},nt.translate=function(it){return arguments.length?(x=+it[0],O=+it[1],ze()):[x,O]},nt.angle=function(it){return arguments.length?(t=ji(q=it%360*qa),e=Yi(q),ze()):q*Ru},nt.reflectX=function(it){return arguments.length?(T=it?-1:1,ze()):T<0},nt.reflectY=function(it){return arguments.length?(M=it?-1:1,ze()):M<0},nt.fitExtent=function(it,ut){return a2(nt,it,ut)},nt.fitSize=function(it,ut){return wE(nt,it,ut)},nt.fitWidth=function(it,ut){return kE(nt,it,ut)},nt.fitHeight=function(it,ut){return EE(nt,it,ut)},nt},mercator:function(){return cS(s2).scale(961/ch)},mollweide:function(){return cv(rM).scale(169.529)},naturalEarth1:function(){return cv(hS).scale(175.295)},orthographic:function(){return cv(dS).scale(249.5).clipAngle(90+$i)},stereographic:function(){return cv(pS).scale(250).clipAngle(142)},transversemercator:function(){var e=cS(mS),t=e.center,n=e.rotate;return e.center=function(r){return arguments.length?t([-r[1],r[0]]):[(r=t())[1],-r[0]]},e.rotate=function(r){return arguments.length?n([r[0],r[1],r.length>2?r[2]+90:90]):[(r=n())[0],r[1],r[2]-90]},n([0,0,90]).scale(159.155)}};for(const e in h2)SE(e,h2[e]);function xS(e,t,n){var r=ys(e,t-$i,n).concat(t);return function(i){return r.map(function(s){return[i,s]})}}function wS(e,t,n){var r=ys(e,t-$i,n).concat(t);return function(i){return r.map(function(s){return[s,i]})}}function aM(){var e,t,n,r,i,s,f,m,x,O,T,M,q=10,Q=q,se=90,le=360,Fe=2.5;function Le(){return{type:"MultiLineString",coordinates:ze()}}function ze(){return ys(Vx(r/se)*se,n,se).map(T).concat(ys(Vx(m/le)*le,f,le).map(M)).concat(ys(Vx(t/q)*q,e,q).filter(function(nt){return po(nt%se)>$i}).map(x)).concat(ys(Vx(s/Q)*Q,i,Q).filter(function(nt){return po(nt%le)>$i}).map(O))}return Le.lines=function(){return ze().map(function(nt){return{type:"LineString",coordinates:nt}})},Le.outline=function(){return{type:"Polygon",coordinates:[T(r).concat(M(f).slice(1),T(n).reverse().slice(1),M(m).reverse().slice(1))]}},Le.extent=function(nt){return arguments.length?Le.extentMajor(nt).extentMinor(nt):Le.extentMinor()},Le.extentMajor=function(nt){return arguments.length?(r=+nt[0][0],n=+nt[1][0],m=+nt[0][1],f=+nt[1][1],r>n&&(nt=r,r=n,n=nt),m>f&&(nt=m,m=f,f=nt),Le.precision(Fe)):[[r,m],[n,f]]},Le.extentMinor=function(nt){return arguments.length?(t=+nt[0][0],e=+nt[1][0],s=+nt[0][1],i=+nt[1][1],t>e&&(nt=t,t=e,e=nt),s>i&&(nt=s,s=i,i=nt),Le.precision(Fe)):[[t,s],[e,i]]},Le.step=function(nt){return arguments.length?Le.stepMajor(nt).stepMinor(nt):Le.stepMinor()},Le.stepMajor=function(nt){return arguments.length?(se=+nt[0],le=+nt[1],Le):[se,le]},Le.stepMinor=function(nt){return arguments.length?(q=+nt[0],Q=+nt[1],Le):[q,Q]},Le.precision=function(nt){return arguments.length?(Fe=+nt,x=xS(s,i,90),O=wS(t,e,Fe),T=xS(m,f,90),M=wS(r,n,Fe),Le):Fe},Le.extentMajor([[-180,-90+$i],[180,90-$i]]).extentMinor([[-180,-80-$i],[180,80+$i]])}function oM(){}const qv=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function kS(){var e=1,t=1,n=f;function r(m,x){return x.map(O=>i(m,O))}function i(m,x){var O=[],T=[];return function(M,q,Q){var se,le,Fe,Le,ze,nt,it=new Array,ut=new Array;for(se=le=-1,Le=M[0]>=q,qv[Le<<1].forEach(st);++se<e-1;)Fe=Le,Le=M[se+1]>=q,qv[Fe|Le<<1].forEach(st);for(qv[Le<<0].forEach(st);++le<t-1;){for(se=-1,Le=M[le*e+e]>=q,ze=M[le*e]>=q,qv[Le<<1|ze<<2].forEach(st);++se<e-1;)Fe=Le,Le=M[le*e+e+se+1]>=q,nt=ze,ze=M[le*e+se+1]>=q,qv[Fe|Le<<1|ze<<2|nt<<3].forEach(st);qv[Le|ze<<3].forEach(st)}for(se=-1,ze=M[le*e]>=q,qv[ze<<2].forEach(st);++se<e-1;)nt=ze,ze=M[le*e+se+1]>=q,qv[ze<<2|nt<<3].forEach(st);function st(pt){var dt,Qt,mn=[pt[0][0]+se,pt[0][1]+le],on=[pt[1][0]+se,pt[1][1]+le],Rn=s(mn),Fn=s(on);(dt=ut[Rn])?(Qt=it[Fn])?(delete ut[dt.end],delete it[Qt.start],dt===Qt?(dt.ring.push(on),Q(dt.ring)):it[dt.start]=ut[Qt.end]={start:dt.start,end:Qt.end,ring:dt.ring.concat(Qt.ring)}):(delete ut[dt.end],dt.ring.push(on),ut[dt.end=Fn]=dt):(dt=it[Fn])?(Qt=ut[Rn])?(delete it[dt.start],delete ut[Qt.end],dt===Qt?(dt.ring.push(on),Q(dt.ring)):it[Qt.start]=ut[dt.end]={start:Qt.start,end:dt.end,ring:Qt.ring.concat(dt.ring)}):(delete it[dt.start],dt.ring.unshift(mn),it[dt.start=Rn]=dt):it[Rn]=ut[Fn]={start:Rn,end:Fn,ring:[mn,on]}}qv[ze<<3].forEach(st)}(m,x,M=>{n(M,m,x),function(q){for(var Q=0,se=q.length,le=q[se-1][1]*q[0][0]-q[se-1][0]*q[0][1];++Q<se;)le+=q[Q-1][1]*q[Q][0]-q[Q-1][0]*q[Q][1];return le}(M)>0?O.push([M]):T.push(M)}),T.forEach(M=>{for(var q,Q=0,se=O.length;Q<se;++Q)if(sM((q=O[Q])[0],M)!==-1)return void q.push(M)}),{type:"MultiPolygon",value:x,coordinates:O}}function s(m){return 2*m[0]+m[1]*(e+1)*4}function f(m,x,O){m.forEach(T=>{var M,q=T[0],Q=T[1],se=0|q,le=0|Q,Fe=x[le*e+se];q>0&&q<e&&se===q&&(M=x[le*e+se-1],T[0]=q+(O-M)/(Fe-M)-.5),Q>0&&Q<t&&le===Q&&(M=x[(le-1)*e+se],T[1]=Q+(O-M)/(Fe-M)-.5)})}return r.contour=i,r.size=function(m){if(!arguments.length)return[e,t];var x=Math.floor(m[0]),O=Math.floor(m[1]);return x>=0&&O>=0||Object(xe.o)("invalid size"),e=x,t=O,r},r.smooth=function(m){return arguments.length?(n=m?f:oM,r):n===f},r}function sM(e,t){for(var n,r=-1,i=t.length;++r<i;)if(n=uM(e,t[r]))return n;return 0}function uM(e,t){for(var n=t[0],r=t[1],i=-1,s=0,f=e.length,m=f-1;s<f;m=s++){var x=e[s],O=x[0],T=x[1],M=e[m],q=M[0],Q=M[1];if(cM(x,M,t))return 0;T>r!=Q>r&&n<(q-O)*(r-T)/(Q-T)+O&&(i=-i)}return i}function cM(e,t,n){var r;return function(i,s,f){return(s[0]-i[0])*(f[1]-i[1])==(f[0]-i[0])*(s[1]-i[1])}(e,t,n)&&function(i,s,f){return i<=s&&s<=f||f<=s&&s<=i}(e[r=+(e[0]===t[0])],n[r],t[r])}function ES(e,t,n){return function(r){var i=Object(xe.q)(r),s=n?Math.min(i[0],0):i[0],f=i[1],m=f-s,x=t?Object(Cu.c)(s,f,e):m/(e+1);return ys(s+x,f,x)}}function DE(e){Ot.call(this,null,e)}function CS(e,t,n,r,i){const s=e.x1||0,f=e.y1||0,m=t*n<0;function x(M){M.forEach(O)}function O(M){m&&M.reverse(),M.forEach(T)}function T(M){M[0]=(M[0]-s)*t+r,M[1]=(M[1]-f)*n+i}return function(M){return M.coordinates.forEach(x),M}}function OS(e,t,n){const r=e>=0?e:qr(t,n);return Math.round((Math.sqrt(4*r*r+1)-1)/2)}function TE(e){return Object(xe.E)(e)?e:Object(xe.m)(+e)}function AS(){var e=x=>x[0],t=x=>x[1],n=xe.Q,r=[-1,-1],i=960,s=500,f=2;function m(x,O){const T=OS(r[0],x,e)>>f,M=OS(r[1],x,t)>>f,q=T?T+2:0,Q=M?M+2:0,se=2*q+(i>>f),le=2*Q+(s>>f),Fe=new Float32Array(se*le),Le=new Float32Array(se*le);let ze=Fe;x.forEach(it=>{const ut=q+(+e(it)>>f),st=Q+(+t(it)>>f);ut>=0&&ut<se&&st>=0&&st<le&&(Fe[ut+st*se]+=+n(it))}),T>0&&M>0?(cb(se,le,Fe,Le,T),lb(se,le,Le,Fe,M),cb(se,le,Fe,Le,T),lb(se,le,Le,Fe,M),cb(se,le,Fe,Le,T),lb(se,le,Le,Fe,M)):T>0?(cb(se,le,Fe,Le,T),cb(se,le,Le,Fe,T),cb(se,le,Fe,Le,T),ze=Le):M>0&&(lb(se,le,Fe,Le,M),lb(se,le,Le,Fe,M),lb(se,le,Fe,Le,M),ze=Le);const nt=O?Math.pow(2,-2*f):1/a_(ze);for(let it=0,ut=se*le;it<ut;++it)ze[it]*=nt;return{values:ze,scale:1<<f,width:se,height:le,x1:q,y1:Q,x2:q+(i>>f),y2:Q+(s>>f)}}return m.x=function(x){return arguments.length?(e=TE(x),m):e},m.y=function(x){return arguments.length?(t=TE(x),m):t},m.weight=function(x){return arguments.length?(n=TE(x),m):n},m.size=function(x){if(!arguments.length)return[i,s];var O=+x[0],T=+x[1];return O>=0&&T>=0||Object(xe.o)("invalid size"),i=O,s=T,m},m.cellSize=function(x){return arguments.length?((x=+x)>=1||Object(xe.o)("invalid cell size"),f=Math.floor(Math.log(x)/Math.LN2),m):1<<f},m.bandwidth=function(x){return arguments.length?((x=Object(xe.i)(x)).length===1&&(x=[+x[0],+x[0]]),x.length!==2&&Object(xe.o)("invalid bandwidth"),r=x,m):r},m}function cb(e,t,n,r,i){const s=1+(i<<1);for(let f=0;f<t;++f)for(let m=0,x=0;m<e+i;++m)m<e&&(x+=n[m+f*e]),m>=i&&(m>=s&&(x-=n[m-s+f*e]),r[m-i+f*e]=x/Math.min(m+1,e-1+s-m,s))}function lb(e,t,n,r,i){const s=1+(i<<1);for(let f=0;f<e;++f)for(let m=0,x=0;m<t+i;++m)m<t&&(x+=n[f+m*e]),m>=i&&(m>=s&&(x-=n[f+(m-s)*e]),r[f+(m-i)*e]=x/Math.min(m+1,t-1+s-m,s))}function NE(e){Ot.call(this,null,e)}DE.Definition={type:"Isocontour",metadata:{generates:!0},params:[{name:"field",type:"field"},{name:"thresholds",type:"number",array:!0},{name:"levels",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"zero",type:"boolean",default:!0},{name:"smooth",type:"boolean",default:!0},{name:"scale",type:"number",expr:!0},{name:"translate",type:"number",array:!0,expr:!0},{name:"as",type:"string",null:!0,default:"contour"}]},Object(xe.z)(DE,Ot,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=t.materialize(t.SOURCE).source,i=e.field||xe.y,s=kS().smooth(e.smooth!==!1),f=e.thresholds||function(O,T,M){const q=ES(M.levels||10,M.nice,M.zero!==!1);return M.resolve!=="shared"?q:q(O.map(Q=>$n(T(Q).values)))}(r,i,e),m=e.as===null?null:e.as||"contour",x=[];return r.forEach(O=>{const T=i(O),M=s.size([T.width,T.height])(T.values,Object(xe.B)(f)?f:f(T.values));(function(q,Q,se,le){let Fe=le.scale||Q.scale,Le=le.translate||Q.translate;if(Object(xe.E)(Fe)&&(Fe=Fe(se,le)),Object(xe.E)(Le)&&(Le=Le(se,le)),(Fe===1||Fe==null)&&!Le)return;const ze=(Object(xe.G)(Fe)?Fe:Fe[0])||1,nt=(Object(xe.G)(Fe)?Fe:Fe[1])||1,it=Le&&Le[0]||0,ut=Le&&Le[1]||0;q.forEach(CS(Q,ze,nt,it,ut))})(M,T,O,e),M.forEach(q=>{x.push(xr(O,Dn(m!=null?{[m]:q}:q)))})}),this.value&&(n.rem=this.value),this.value=n.source=n.add=x,n}}),NE.Definition={type:"KDE2D",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"weight",type:"field"},{name:"groupby",type:"field",array:!0},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number",array:!0,length:2},{name:"counts",type:"boolean",default:!1},{name:"as",type:"string",default:"grid"}]};const lM=["x","y","weight","size","cellSize","bandwidth"];function _S(e,t){return lM.forEach(n=>t[n]!=null?e[n](t[n]):0),e}function IE(e){Ot.call(this,null,e)}Object(xe.z)(NE,Ot,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n,r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=function(x,O){var T,M,q,Q,se,le,Fe=[],Le=ze=>ze(Q);if(O==null)Fe.push(x);else for(T={},M=0,q=x.length;M<q;++M)Q=x[M],se=O.map(Le),(le=T[se])||(T[se]=le=[],le.dims=se,Fe.push(le)),le.push(Q);return Fe}(t.materialize(t.SOURCE).source,e.groupby),s=(e.groupby||[]).map(xe.h),f=_S(AS(),e),m=e.as||"grid";return n=i.map(x=>Dn(function(O,T){for(let M=0;M<s.length;++M)O[s[M]]=T[M];return O}({[m]:f(x,e.counts)},x.dims))),this.value&&(r.rem=this.value),this.value=r.source=r.add=n,r}}),IE.Definition={type:"Contour",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"values",type:"number",array:!0},{name:"x",type:"field"},{name:"y",type:"field"},{name:"weight",type:"field"},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number"},{name:"count",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"thresholds",type:"number",array:!0},{name:"smooth",type:"boolean",default:!0}]},Object(xe.z)(IE,Ot,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n,r,i=t.fork(t.NO_SOURCE|t.NO_FIELDS),s=kS().smooth(e.smooth!==!1),f=e.values,m=e.thresholds||ES(e.count||10,e.nice,!!f),x=e.size;return f||(f=t.materialize(t.SOURCE).source,r=CS(n=_S(AS(),e)(f,!0),n.scale||1,n.scale||1,0,0),x=[n.width,n.height],f=n.values),m=Object(xe.B)(m)?m:m(f),f=s.size(x)(f,m),r&&f.forEach(r),this.value&&(i.rem=this.value),this.value=i.source=i.add=(f||[]).map(Dn),i}});const FE="Feature",RE="FeatureCollection";function ME(e){Ot.call(this,null,e)}function jE(e){Ot.call(this,null,e)}function BE(e){Ot.call(this,null,e)}function PE(e){Ot.call(this,null,e)}function LE(e){Ot.call(this,[],e),this.generator=aM()}function zE(e){Ot.call(this,null,e)}function SS(e){if(!Object(xe.E)(e))return!1;const t=Object(xe.Fa)(Object(xe.g)(e));return t.$x||t.$y||t.$value||t.$max}function DS(e){Ot.call(this,null,e),this.modified(!0)}function TS(e,t,n){Object(xe.E)(e[t])&&e[t](n)}ME.Definition={type:"GeoJSON",metadata:{},params:[{name:"fields",type:"field",array:!0,length:2},{name:"geojson",type:"field"}]},Object(xe.z)(ME,Ot,{transform(e,t){var n,r=this._features,i=this._points,s=e.fields,f=s&&s[0],m=s&&s[1],x=e.geojson||!s&&xe.y,O=t.ADD;n=e.modified()||t.changed(t.REM)||t.modified(Object(xe.g)(x))||f&&t.modified(Object(xe.g)(f))||m&&t.modified(Object(xe.g)(m)),this.value&&!n||(O=t.SOURCE,this._features=r=[],this._points=i=[]),x&&t.visit(O,T=>r.push(x(T))),f&&m&&(t.visit(O,T=>{var M=f(T),q=m(T);M!=null&&q!=null&&(M=+M)===M&&(q=+q)===q&&i.push([M,q])}),r=r.concat({type:FE,geometry:{type:"MultiPoint",coordinates:i}})),this.value={type:RE,features:r}}}),jE.Definition={type:"GeoPath",metadata:{modifies:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"path"}]},Object(xe.z)(jE,Ot,{transform(e,t){var n=t.fork(t.ALL),r=this.value,i=e.field||xe.y,s=e.as||"path",f=n.SOURCE;!r||e.modified()?(this.value=r=bS(e.projection),n.materialize().reflow()):f=i===xe.y||t.modified(i.fields)?n.ADD_MOD:n.ADD;const m=function(x,O){const T=x.pointRadius();return x.context(null),O!=null&&x.pointRadius(O),T}(r,e.pointRadius);return n.visit(f,x=>x[s]=r(i(x))),r.pointRadius(m),n.modifies(s)}}),BE.Definition={type:"GeoPoint",metadata:{modifies:!0},params:[{name:"projection",type:"projection",required:!0},{name:"fields",type:"field",array:!0,required:!0,length:2},{name:"as",type:"string",array:!0,length:2,default:["x","y"]}]},Object(xe.z)(BE,Ot,{transform(e,t){var n,r=e.projection,i=e.fields[0],s=e.fields[1],f=e.as||["x","y"],m=f[0],x=f[1];function O(T){const M=r([i(T),s(T)]);M?(T[m]=M[0],T[x]=M[1]):(T[m]=void 0,T[x]=void 0)}return e.modified()?t=t.materialize().reflow(!0).visit(t.SOURCE,O):(n=t.modified(i.fields)||t.modified(s.fields),t.visit(n?t.ADD_MOD:t.ADD,O)),t.modifies(f)}}),PE.Definition={type:"GeoShape",metadata:{modifies:!0,nomod:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field",default:"datum"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"shape"}]},Object(xe.z)(PE,Ot,{transform(e,t){var n=t.fork(t.ALL),r=this.value,i=e.as||"shape",s=n.ADD;return r&&!e.modified()||(this.value=r=function(f,m,x){const O=x==null?T=>f(m(T)):T=>{var M=f.pointRadius(),q=f.pointRadius(x)(m(T));return f.pointRadius(M),q};return O.context=T=>(f.context(T),O),O}(bS(e.projection),e.field||Object(xe.u)("datum"),e.pointRadius),n.materialize().reflow(),s=n.SOURCE),n.visit(s,f=>f[i]=r),n.modifies(i)}}),LE.Definition={type:"Graticule",metadata:{changes:!0,generates:!0},params:[{name:"extent",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMajor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMinor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"step",type:"number",array:!0,length:2},{name:"stepMajor",type:"number",array:!0,length:2,default:[90,360]},{name:"stepMinor",type:"number",array:!0,length:2,default:[10,10]},{name:"precision",type:"number",default:2.5}]},Object(xe.z)(LE,Ot,{transform(e,t){var n,r=this.value,i=this.generator;if(!r.length||e.modified())for(const s in e)Object(xe.E)(i[s])&&i[s](e[s]);return n=i(),r.length?t.mod.push(gr(r[0],n)):t.add.push(Dn(n)),r[0]=n,t}}),zE.Definition={type:"heatmap",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"color",type:"string",expr:!0},{name:"opacity",type:"number",expr:!0},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"as",type:"string",default:"image"}]},Object(xe.z)(zE,Ot,{transform(e,t){if(!t.changed()&&!e.modified())return t.StopPropagation;var n=t.materialize(t.SOURCE).source,r=e.resolve==="shared",i=e.field||xe.y,s=function(O,T){let M;return Object(xe.E)(O)?(M=q=>O(q,T)).dep=SS(O):O?M=Object(xe.m)(O):(M=q=>q.$value/q.$max||0).dep=!0,M}(e.opacity,e),f=function(O,T){let M;return Object(xe.E)(O)?(M=q=>Ut(O(q,T))).dep=SS(O):M=Object(xe.m)(Ut(O||"#888")),M}(e.color,e),m=e.as||"image",x={$x:0,$y:0,$value:0,$max:r?$n(n.map(O=>$n(i(O).values))):0};return n.forEach(O=>{const T=i(O),M=Object(xe.p)({},O,x);r||(M.$max=$n(T.values||[])),O[m]=function(q,Q,se,le){const Fe=q.width,Le=q.height,ze=q.x1||0,nt=q.y1||0,it=q.x2||Fe,ut=q.y2||Le,st=q.values,pt=st?Rn=>st[Rn]:xe.Ma,dt=qs(it-ze,ut-nt),Qt=dt.getContext("2d"),mn=Qt.getImageData(0,0,it-ze,ut-nt),on=mn.data;for(let Rn=nt,Fn=0;Rn<ut;++Rn){Q.$y=Rn-nt;for(let zn=ze,Vn=Rn*Fe;zn<it;++zn,Fn+=4){Q.$x=zn-ze,Q.$value=pt(zn+Vn);const Qn=se(Q);on[Fn+0]=Qn.r,on[Fn+1]=Qn.g,on[Fn+2]=Qn.b,on[Fn+3]=~~(255*le(Q))}}return Qt.putImageData(mn,0,0),dt}(T,M,f.dep?f:Object(xe.m)(f(M)),s.dep?s:Object(xe.m)(s(M)))}),t.reflow(!0).modifies(m)}}),Object(xe.z)(DS,Ot,{transform(e,t){let n=this.value;return!n||e.modified("type")?(this.value=n=function(r){const i=SE((r||"mercator").toLowerCase());return i||Object(xe.o)("Unrecognized projection type: "+r),i()}(e.type),_E.forEach(r=>{e[r]!=null&&TS(n,r,e[r])})):_E.forEach(r=>{e.modified(r)&&TS(n,r,e[r])}),e.pointRadius!=null&&n.path.pointRadius(e.pointRadius),e.fit&&function(r,i){const s=function(f){return(f=Object(xe.i)(f)).length===1?f[0]:{type:RE,features:f.reduce((m,x)=>m.concat(function(O){return O.type===RE?O.features:Object(xe.i)(O).filter(T=>T!=null).map(T=>T.type===FE?T:{type:FE,geometry:T})}(x)),[])}}(i.fit);i.extent?r.fitExtent(i.extent,s):i.size&&r.fitSize(i.size,s)}(n,e),t.fork(t.NO_SOURCE|t.NO_FIELDS)}});function NS(e,t,n,r){if(isNaN(t)||isNaN(n))return e;var i,s,f,m,x,O,T,M,q,Q=e._root,se={data:r},le=e._x0,Fe=e._y0,Le=e._x1,ze=e._y1;if(!Q)return e._root=se,e;for(;Q.length;)if((O=t>=(s=(le+Le)/2))?le=s:Le=s,(T=n>=(f=(Fe+ze)/2))?Fe=f:ze=f,i=Q,!(Q=Q[M=T<<1|O]))return i[M]=se,e;if(m=+e._x.call(null,Q.data),x=+e._y.call(null,Q.data),t===m&&n===x)return se.next=Q,i?i[M]=se:e._root=se,e;do i=i?i[M]=new Array(4):e._root=new Array(4),(O=t>=(s=(le+Le)/2))?le=s:Le=s,(T=n>=(f=(Fe+ze)/2))?Fe=f:ze=f;while((M=T<<1|O)==(q=(x>=f)<<1|m>=s));return i[q]=Q,i[M]=se,e}var fh=function(e,t,n,r,i){this.node=e,this.x0=t,this.y0=n,this.x1=r,this.y1=i};function fM(e){return e[0]}function hM(e){return e[1]}function UE(e,t,n){var r=new WE(t??fM,n??hM,NaN,NaN,NaN,NaN);return e==null?r:r.addAll(e)}function WE(e,t,n,r,i,s){this._x=e,this._y=t,this._x0=n,this._y0=r,this._x1=i,this._y1=s,this._root=void 0}function IS(e){for(var t={data:e.data},n=t;e=e.next;)n=n.next={data:e.data};return t}var hh=UE.prototype=WE.prototype;hh.copy=function(){var e,t,n=new WE(this._x,this._y,this._x0,this._y0,this._x1,this._y1),r=this._root;if(!r)return n;if(!r.length)return n._root=IS(r),n;for(e=[{source:r,target:n._root=new Array(4)}];r=e.pop();)for(var i=0;i<4;++i)(t=r.source[i])&&(t.length?e.push({source:t,target:r.target[i]=new Array(4)}):r.target[i]=IS(t));return n},hh.add=function(e){const t=+this._x.call(null,e),n=+this._y.call(null,e);return NS(this.cover(t,n),t,n,e)},hh.addAll=function(e){var t,n,r,i,s=e.length,f=new Array(s),m=new Array(s),x=1/0,O=1/0,T=-1/0,M=-1/0;for(n=0;n<s;++n)isNaN(r=+this._x.call(null,t=e[n]))||isNaN(i=+this._y.call(null,t))||(f[n]=r,m[n]=i,r<x&&(x=r),r>T&&(T=r),i<O&&(O=i),i>M&&(M=i));if(x>T||O>M)return this;for(this.cover(x,O).cover(T,M),n=0;n<s;++n)NS(this,f[n],m[n],e[n]);return this},hh.cover=function(e,t){if(isNaN(e=+e)||isNaN(t=+t))return this;var n=this._x0,r=this._y0,i=this._x1,s=this._y1;if(isNaN(n))i=(n=Math.floor(e))+1,s=(r=Math.floor(t))+1;else{for(var f,m,x=i-n||1,O=this._root;n>e||e>=i||r>t||t>=s;)switch(m=(t<r)<<1|e<n,(f=new Array(4))[m]=O,O=f,x*=2,m){case 0:i=n+x,s=r+x;break;case 1:n=i-x,s=r+x;break;case 2:i=n+x,r=s-x;break;case 3:n=i-x,r=s-x}this._root&&this._root.length&&(this._root=O)}return this._x0=n,this._y0=r,this._x1=i,this._y1=s,this},hh.data=function(){var e=[];return this.visit(function(t){if(!t.length)do e.push(t.data);while(t=t.next)}),e},hh.extent=function(e){return arguments.length?this.cover(+e[0][0],+e[0][1]).cover(+e[1][0],+e[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},hh.find=function(e,t,n){var r,i,s,f,m,x,O,T=this._x0,M=this._y0,q=this._x1,Q=this._y1,se=[],le=this._root;for(le&&se.push(new fh(le,T,M,q,Q)),n==null?n=1/0:(T=e-n,M=t-n,q=e+n,Q=t+n,n*=n);x=se.pop();)if(!(!(le=x.node)||(i=x.x0)>q||(s=x.y0)>Q||(f=x.x1)<T||(m=x.y1)<M))if(le.length){var Fe=(i+f)/2,Le=(s+m)/2;se.push(new fh(le[3],Fe,Le,f,m),new fh(le[2],i,Le,Fe,m),new fh(le[1],Fe,s,f,Le),new fh(le[0],i,s,Fe,Le)),(O=(t>=Le)<<1|e>=Fe)&&(x=se[se.length-1],se[se.length-1]=se[se.length-1-O],se[se.length-1-O]=x)}else{var ze=e-+this._x.call(null,le.data),nt=t-+this._y.call(null,le.data),it=ze*ze+nt*nt;if(it<n){var ut=Math.sqrt(n=it);T=e-ut,M=t-ut,q=e+ut,Q=t+ut,r=le.data}}return r},hh.remove=function(e){if(isNaN(s=+this._x.call(null,e))||isNaN(f=+this._y.call(null,e)))return this;var t,n,r,i,s,f,m,x,O,T,M,q,Q=this._root,se=this._x0,le=this._y0,Fe=this._x1,Le=this._y1;if(!Q)return this;if(Q.length)for(;;){if((O=s>=(m=(se+Fe)/2))?se=m:Fe=m,(T=f>=(x=(le+Le)/2))?le=x:Le=x,t=Q,!(Q=Q[M=T<<1|O]))return this;if(!Q.length)break;(t[M+1&3]||t[M+2&3]||t[M+3&3])&&(n=t,q=M)}for(;Q.data!==e;)if(r=Q,!(Q=Q.next))return this;return(i=Q.next)&&delete Q.next,r?(i?r.next=i:delete r.next,this):t?(i?t[M]=i:delete t[M],(Q=t[0]||t[1]||t[2]||t[3])&&Q===(t[3]||t[2]||t[1]||t[0])&&!Q.length&&(n?n[q]=Q:this._root=Q),this):(this._root=i,this)},hh.removeAll=function(e){for(var t=0,n=e.length;t<n;++t)this.remove(e[t]);return this},hh.root=function(){return this._root},hh.size=function(){var e=0;return this.visit(function(t){if(!t.length)do++e;while(t=t.next)}),e},hh.visit=function(e){var t,n,r,i,s,f,m=[],x=this._root;for(x&&m.push(new fh(x,this._x0,this._y0,this._x1,this._y1));t=m.pop();)if(!e(x=t.node,r=t.x0,i=t.y0,s=t.x1,f=t.y1)&&x.length){var O=(r+s)/2,T=(i+f)/2;(n=x[3])&&m.push(new fh(n,O,T,s,f)),(n=x[2])&&m.push(new fh(n,r,T,O,f)),(n=x[1])&&m.push(new fh(n,O,i,s,T)),(n=x[0])&&m.push(new fh(n,r,i,O,T))}return this},hh.visitAfter=function(e){var t,n=[],r=[];for(this._root&&n.push(new fh(this._root,this._x0,this._y0,this._x1,this._y1));t=n.pop();){var i=t.node;if(i.length){var s,f=t.x0,m=t.y0,x=t.x1,O=t.y1,T=(f+x)/2,M=(m+O)/2;(s=i[0])&&n.push(new fh(s,f,m,T,M)),(s=i[1])&&n.push(new fh(s,T,m,x,M)),(s=i[2])&&n.push(new fh(s,f,M,T,O)),(s=i[3])&&n.push(new fh(s,T,M,x,O))}r.push(t)}for(;t=r.pop();)e(t.node,t.x0,t.y0,t.x1,t.y1);return this},hh.x=function(e){return arguments.length?(this._x=e,this):this._x},hh.y=function(e){return arguments.length?(this._y=e,this):this._y};var dh=function(e){return function(){return e}},F0=function(e){return 1e-6*(e()-.5)};function dM(e){return e.x+e.vx}function pM(e){return e.y+e.vy}var mM={value:()=>{}};function FS(){for(var e,t=0,n=arguments.length,r={};t<n;++t){if(!(e=arguments[t]+"")||e in r||/[\s.]/.test(e))throw new Error("illegal type: "+e);r[e]=[]}return new d2(r)}function d2(e){this._=e}function gM(e,t){for(var n,r=0,i=e.length;r<i;++r)if((n=e[r]).name===t)return n.value}function RS(e,t,n){for(var r=0,i=e.length;r<i;++r)if(e[r].name===t){e[r]=mM,e=e.slice(0,r).concat(e.slice(r+1));break}return n!=null&&e.push({name:t,value:n}),e}d2.prototype=FS.prototype={constructor:d2,on:function(e,t){var n,r=this._,i=function(m,x){return m.trim().split(/^|\s+/).map(function(O){var T="",M=O.indexOf(".");if(M>=0&&(T=O.slice(M+1),O=O.slice(0,M)),O&&!x.hasOwnProperty(O))throw new Error("unknown type: "+O);return{type:O,name:T}})}(e+"",r),s=-1,f=i.length;if(!(arguments.length<2)){if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++s<f;)if(n=(e=i[s]).type)r[n]=RS(r[n],e.name,t);else if(t==null)for(n in r)r[n]=RS(r[n],e.name,null);return this}for(;++s<f;)if((n=(e=i[s]).type)&&(n=gM(r[n],e.name)))return n},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new d2(e)},call:function(e,t){if((n=arguments.length-2)>0)for(var n,r,i=new Array(n),s=0;s<n;++s)i[s]=arguments[s+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(s=0,n=(r=this._[e]).length;s<n;++s)r[s].value.apply(t,i)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var r=this._[e],i=0,s=r.length;i<s;++i)r[i].value.apply(t,n)}};var p2,o1,vM=FS,fb=0,s1=0,u1=0,MS=1e3,m2=0,hy=0,g2=0,c1=typeof performance=="object"&&performance.now?performance:Date,jS=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function VE(){return hy||(jS(yM),hy=c1.now()+g2)}function yM(){hy=0}function v2(){this._call=this._time=this._next=null}function BS(e,t,n){var r=new v2;return r.restart(e,t,n),r}function PS(){hy=(m2=c1.now())+g2,fb=s1=0;try{(function(){VE(),++fb;for(var e,t=p2;t;)(e=hy-t._time)>=0&&t._call.call(null,e),t=t._next;--fb})()}finally{fb=0,function(){for(var e,t,n=p2,r=1/0;n;)n._call?(r>n._time&&(r=n._time),e=n,n=n._next):(t=n._next,n._next=null,n=e?e._next=t:p2=t);o1=e,qE(r)}(),hy=0}}function bM(){var e=c1.now(),t=e-m2;t>MS&&(g2-=t,m2=e)}function qE(e){fb||(s1&&(s1=clearTimeout(s1)),e-hy>24?(e<1/0&&(s1=setTimeout(PS,e-c1.now()-g2)),u1&&(u1=clearInterval(u1))):(u1||(m2=c1.now(),u1=setInterval(bM,MS)),fb=1,jS(PS)))}v2.prototype=BS.prototype={constructor:v2,restart:function(e,t,n){if(typeof e!="function")throw new TypeError("callback is not a function");n=(n==null?VE():+n)+(t==null?0:+t),this._next||o1===this||(o1?o1._next=this:p2=this,o1=this),this._call=e,this._time=n,qE()},stop:function(){this._call&&(this._call=null,this._time=1/0,qE())}};function xM(e){return e.x}function wM(e){return e.y}var kM=10,EM=Math.PI*(3-Math.sqrt(5)),CM=function(e){var t,n=1,r=.001,i=1-Math.pow(r,1/300),s=0,f=.6,m=new Map,x=BS(M),O=vM("tick","end"),T=function(){let le=1;return()=>(le=(1664525*le+1013904223)%4294967296)/4294967296}();function M(){q(),O.call("tick",t),n<r&&(x.stop(),O.call("end",t))}function q(le){var Fe,Le,ze=e.length;le===void 0&&(le=1);for(var nt=0;nt<le;++nt)for(n+=(s-n)*i,m.forEach(function(it){it(n)}),Fe=0;Fe<ze;++Fe)(Le=e[Fe]).fx==null?Le.x+=Le.vx*=f:(Le.x=Le.fx,Le.vx=0),Le.fy==null?Le.y+=Le.vy*=f:(Le.y=Le.fy,Le.vy=0);return t}function Q(){for(var le,Fe=0,Le=e.length;Fe<Le;++Fe){if((le=e[Fe]).index=Fe,le.fx!=null&&(le.x=le.fx),le.fy!=null&&(le.y=le.fy),isNaN(le.x)||isNaN(le.y)){var ze=kM*Math.sqrt(.5+Fe),nt=Fe*EM;le.x=ze*Math.cos(nt),le.y=ze*Math.sin(nt)}(isNaN(le.vx)||isNaN(le.vy))&&(le.vx=le.vy=0)}}function se(le){return le.initialize&&le.initialize(e,T),le}return e==null&&(e=[]),Q(),t={tick:q,restart:function(){return x.restart(M),t},stop:function(){return x.stop(),t},nodes:function(le){return arguments.length?(e=le,Q(),m.forEach(se),t):e},alpha:function(le){return arguments.length?(n=+le,t):n},alphaMin:function(le){return arguments.length?(r=+le,t):r},alphaDecay:function(le){return arguments.length?(i=+le,t):+i},alphaTarget:function(le){return arguments.length?(s=+le,t):s},velocityDecay:function(le){return arguments.length?(f=1-le,t):1-f},randomSource:function(le){return arguments.length?(T=le,m.forEach(se),t):T},force:function(le,Fe){return arguments.length>1?(Fe==null?m.delete(le):m.set(le,se(Fe)),t):m.get(le)},find:function(le,Fe,Le){var ze,nt,it,ut,st,pt=0,dt=e.length;for(Le==null?Le=1/0:Le*=Le,pt=0;pt<dt;++pt)(it=(ze=le-(ut=e[pt]).x)*ze+(nt=Fe-ut.y)*nt)<Le&&(st=ut,Le=it);return st},on:function(le,Fe){return arguments.length>1?(O.on(le,Fe),t):O.on(le)}}};function OM(e){return e.index}function LS(e,t){var n=e.get(t);if(!n)throw new Error("node not found: "+t);return n}const zS={center:function(e,t){var n,r=1;function i(){var s,f,m=n.length,x=0,O=0;for(s=0;s<m;++s)x+=(f=n[s]).x,O+=f.y;for(x=(x/m-e)*r,O=(O/m-t)*r,s=0;s<m;++s)(f=n[s]).x-=x,f.y-=O}return e==null&&(e=0),t==null&&(t=0),i.initialize=function(s){n=s},i.x=function(s){return arguments.length?(e=+s,i):e},i.y=function(s){return arguments.length?(t=+s,i):t},i.strength=function(s){return arguments.length?(r=+s,i):r},i},collide:function(e){var t,n,r,i=1,s=1;function f(){for(var O,T,M,q,Q,se,le,Fe=t.length,Le=0;Le<s;++Le)for(T=UE(t,dM,pM).visitAfter(m),O=0;O<Fe;++O)M=t[O],se=n[M.index],le=se*se,q=M.x+M.vx,Q=M.y+M.vy,T.visit(ze);function ze(nt,it,ut,st,pt){var dt=nt.data,Qt=nt.r,mn=se+Qt;if(!dt)return it>q+mn||st<q-mn||ut>Q+mn||pt<Q-mn;if(dt.index>M.index){var on=q-dt.x-dt.vx,Rn=Q-dt.y-dt.vy,Fn=on*on+Rn*Rn;Fn<mn*mn&&(on===0&&(Fn+=(on=F0(r))*on),Rn===0&&(Fn+=(Rn=F0(r))*Rn),Fn=(mn-(Fn=Math.sqrt(Fn)))/Fn*i,M.vx+=(on*=Fn)*(mn=(Qt*=Qt)/(le+Qt)),M.vy+=(Rn*=Fn)*mn,dt.vx-=on*(mn=1-mn),dt.vy-=Rn*mn)}}}function m(O){if(O.data)return O.r=n[O.data.index];for(var T=O.r=0;T<4;++T)O[T]&&O[T].r>O.r&&(O.r=O[T].r)}function x(){if(t){var O,T,M=t.length;for(n=new Array(M),O=0;O<M;++O)T=t[O],n[T.index]=+e(T,O,t)}}return typeof e!="function"&&(e=dh(e==null?1:+e)),f.initialize=function(O,T){t=O,r=T,x()},f.iterations=function(O){return arguments.length?(s=+O,f):s},f.strength=function(O){return arguments.length?(i=+O,f):i},f.radius=function(O){return arguments.length?(e=typeof O=="function"?O:dh(+O),x(),f):e},f},nbody:function(){var e,t,n,r,i,s=dh(-30),f=1,m=1/0,x=.81;function O(Q){var se,le=e.length,Fe=UE(e,xM,wM).visitAfter(M);for(r=Q,se=0;se<le;++se)t=e[se],Fe.visit(q)}function T(){if(e){var Q,se,le=e.length;for(i=new Array(le),Q=0;Q<le;++Q)se=e[Q],i[se.index]=+s(se,Q,e)}}function M(Q){var se,le,Fe,Le,ze,nt=0,it=0;if(Q.length){for(Fe=Le=ze=0;ze<4;++ze)(se=Q[ze])&&(le=Math.abs(se.value))&&(nt+=se.value,it+=le,Fe+=le*se.x,Le+=le*se.y);Q.x=Fe/it,Q.y=Le/it}else{(se=Q).x=se.data.x,se.y=se.data.y;do nt+=i[se.data.index];while(se=se.next)}Q.value=nt}function q(Q,se,le,Fe){if(!Q.value)return!0;var Le=Q.x-t.x,ze=Q.y-t.y,nt=Fe-se,it=Le*Le+ze*ze;if(nt*nt/x<it)return it<m&&(Le===0&&(it+=(Le=F0(n))*Le),ze===0&&(it+=(ze=F0(n))*ze),it<f&&(it=Math.sqrt(f*it)),t.vx+=Le*Q.value*r/it,t.vy+=ze*Q.value*r/it),!0;if(!(Q.length||it>=m)){(Q.data!==t||Q.next)&&(Le===0&&(it+=(Le=F0(n))*Le),ze===0&&(it+=(ze=F0(n))*ze),it<f&&(it=Math.sqrt(f*it)));do Q.data!==t&&(nt=i[Q.data.index]*r/it,t.vx+=Le*nt,t.vy+=ze*nt);while(Q=Q.next)}}return O.initialize=function(Q,se){e=Q,n=se,T()},O.strength=function(Q){return arguments.length?(s=typeof Q=="function"?Q:dh(+Q),T(),O):s},O.distanceMin=function(Q){return arguments.length?(f=Q*Q,O):Math.sqrt(f)},O.distanceMax=function(Q){return arguments.length?(m=Q*Q,O):Math.sqrt(m)},O.theta=function(Q){return arguments.length?(x=Q*Q,O):Math.sqrt(x)},O},link:function(e){var t,n,r,i,s,f,m=OM,x=function(le){return 1/Math.min(i[le.source.index],i[le.target.index])},O=dh(30),T=1;function M(le){for(var Fe=0,Le=e.length;Fe<T;++Fe)for(var ze,nt,it,ut,st,pt,dt,Qt=0;Qt<Le;++Qt)nt=(ze=e[Qt]).source,ut=(it=ze.target).x+it.vx-nt.x-nt.vx||F0(f),st=it.y+it.vy-nt.y-nt.vy||F0(f),ut*=pt=((pt=Math.sqrt(ut*ut+st*st))-n[Qt])/pt*le*t[Qt],st*=pt,it.vx-=ut*(dt=s[Qt]),it.vy-=st*dt,nt.vx+=ut*(dt=1-dt),nt.vy+=st*dt}function q(){if(r){var le,Fe,Le=r.length,ze=e.length,nt=new Map(r.map((it,ut)=>[m(it,ut,r),it]));for(le=0,i=new Array(Le);le<ze;++le)(Fe=e[le]).index=le,typeof Fe.source!="object"&&(Fe.source=LS(nt,Fe.source)),typeof Fe.target!="object"&&(Fe.target=LS(nt,Fe.target)),i[Fe.source.index]=(i[Fe.source.index]||0)+1,i[Fe.target.index]=(i[Fe.target.index]||0)+1;for(le=0,s=new Array(ze);le<ze;++le)Fe=e[le],s[le]=i[Fe.source.index]/(i[Fe.source.index]+i[Fe.target.index]);t=new Array(ze),Q(),n=new Array(ze),se()}}function Q(){if(r)for(var le=0,Fe=e.length;le<Fe;++le)t[le]=+x(e[le],le,e)}function se(){if(r)for(var le=0,Fe=e.length;le<Fe;++le)n[le]=+O(e[le],le,e)}return e==null&&(e=[]),M.initialize=function(le,Fe){r=le,f=Fe,q()},M.links=function(le){return arguments.length?(e=le,q(),M):e},M.id=function(le){return arguments.length?(m=le,M):m},M.iterations=function(le){return arguments.length?(T=+le,M):T},M.strength=function(le){return arguments.length?(x=typeof le=="function"?le:dh(+le),Q(),M):x},M.distance=function(le){return arguments.length?(O=typeof le=="function"?le:dh(+le),se(),M):O},M},x:function(e){var t,n,r,i=dh(.1);function s(m){for(var x,O=0,T=t.length;O<T;++O)(x=t[O]).vx+=(r[O]-x.x)*n[O]*m}function f(){if(t){var m,x=t.length;for(n=new Array(x),r=new Array(x),m=0;m<x;++m)n[m]=isNaN(r[m]=+e(t[m],m,t))?0:+i(t[m],m,t)}}return typeof e!="function"&&(e=dh(e==null?0:+e)),s.initialize=function(m){t=m,f()},s.strength=function(m){return arguments.length?(i=typeof m=="function"?m:dh(+m),f(),s):i},s.x=function(m){return arguments.length?(e=typeof m=="function"?m:dh(+m),f(),s):e},s},y:function(e){var t,n,r,i=dh(.1);function s(m){for(var x,O=0,T=t.length;O<T;++O)(x=t[O]).vy+=(r[O]-x.y)*n[O]*m}function f(){if(t){var m,x=t.length;for(n=new Array(x),r=new Array(x),m=0;m<x;++m)n[m]=isNaN(r[m]=+e(t[m],m,t))?0:+i(t[m],m,t)}}return typeof e!="function"&&(e=dh(e==null?0:+e)),s.initialize=function(m){t=m,f()},s.strength=function(m){return arguments.length?(i=typeof m=="function"?m:dh(+m),f(),s):i},s.y=function(m){return arguments.length?(e=typeof m=="function"?m:dh(+m),f(),s):e},s}},l1="forces",HE=["alpha","alphaMin","alphaTarget","velocityDecay","forces"],AM=["static","iterations"],US=["x","y","vx","vy"];function $E(e){Ot.call(this,null,e)}function WS(e,t,n,r){var i,s,f,m,x=Object(xe.i)(t.forces);for(i=0,s=HE.length;i<s;++i)(f=HE[i])!==l1&&t.modified(f)&&e[f](t[f]);for(i=0,s=x.length;i<s;++i)m=l1+i,(f=n||t.modified(l1,i)?SM(x[i]):r&&_M(x[i],r)?e.force(m):null)&&e.force(m,f);for(s=e.numForces||0;i<s;++i)e.force(l1+i,null);return e.numForces=x.length,e}function _M(e,t){var n,r;for(n in e)if(Object(xe.E)(r=e[n])&&t.modified(Object(xe.g)(r)))return 1;return 0}function SM(e){var t,n;for(n in Object(xe.w)(zS,e.force)||Object(xe.o)("Unrecognized force: "+e.force),t=zS[e.force](),e)Object(xe.E)(t[n])&&DM(t[n],e[n],e);return t}function DM(e,t,n){e(Object(xe.E)(t)?r=>t(r,n):t)}function TM(e){var t=0,n=e.children,r=n&&n.length;if(r)for(;--r>=0;)t+=n[r].value;else t=1;e.value=t}$E.Definition={type:"Force",metadata:{modifies:!0},params:[{name:"static",type:"boolean",default:!1},{name:"restart",type:"boolean",default:!1},{name:"iterations",type:"number",default:300},{name:"alpha",type:"number",default:1},{name:"alphaMin",type:"number",default:.001},{name:"alphaTarget",type:"number",default:0},{name:"velocityDecay",type:"number",default:.4},{name:"forces",type:"param",array:!0,params:[{key:{force:"center"},params:[{name:"x",type:"number",default:0},{name:"y",type:"number",default:0}]},{key:{force:"collide"},params:[{name:"radius",type:"number",expr:!0},{name:"strength",type:"number",default:.7},{name:"iterations",type:"number",default:1}]},{key:{force:"nbody"},params:[{name:"strength",type:"number",default:-30},{name:"theta",type:"number",default:.9},{name:"distanceMin",type:"number",default:1},{name:"distanceMax",type:"number"}]},{key:{force:"link"},params:[{name:"links",type:"data"},{name:"id",type:"field"},{name:"distance",type:"number",default:30,expr:!0},{name:"strength",type:"number",expr:!0},{name:"iterations",type:"number",default:1}]},{key:{force:"x"},params:[{name:"strength",type:"number",default:.1},{name:"x",type:"field"}]},{key:{force:"y"},params:[{name:"strength",type:"number",default:.1},{name:"y",type:"field"}]}]},{name:"as",type:"string",array:!0,modify:!1,default:US}]},Object(xe.z)($E,Ot,{transform(e,t){var n=this.value,r=t.changed(t.ADD_REM),i=e.modified(HE),s=e.iterations||300;if(n?(r&&(t.modifies("index"),n.nodes(t.source)),(i||t.changed(t.MOD))&&WS(n,e,0,t)):(this.value=n=function(f,m){const x=CM(f),O=x.stop,T=x.restart;let M=!1;return x.stopped=()=>M,x.restart=()=>(M=!1,T()),x.stop=()=>(M=!0,O()),WS(x,m,!0).on("end",()=>M=!0)}(t.source,e),n.on("tick",function(f,m){return()=>f.touch(m).run()}(t.dataflow,this)),e.static||(r=!0,n.tick()),t.modifies("index")),i||r||e.modified(AM)||t.changed()&&e.restart){if(n.alpha(Math.max(n.alpha(),e.alpha||1)).alphaDecay(1-Math.pow(n.alphaMin(),1/s)),e.static)for(n.stop();--s>=0;)n.tick();else if(n.stopped()&&n.restart(),!r)return t.StopPropagation}return this.finish(e,t)},finish(e,t){const n=t.dataflow;for(let m,x=this._argops,O=0,T=x.length;O<T;++O)if((m=x[O]).name===l1&&m.op._argval.force==="link"){for(var r,i=m.op._argops,s=0,f=i.length;s<f;++s)if(i[s].name==="links"&&(r=i[s].op.source)){n.pulse(r,n.changeset().reflow());break}}return t.reflow(e.modified()).modifies(US)}});function GE(e,t){e instanceof Map?(e=[void 0,e],t===void 0&&(t=IM)):t===void 0&&(t=NM);for(var n,r,i,s,f,m=new hb(e),x=[m];n=x.pop();)if((i=t(n.data))&&(f=(i=Array.from(i)).length))for(n.children=i,s=f-1;s>=0;--s)x.push(r=i[s]=new hb(i[s])),r.parent=n,r.depth=n.depth+1;return m.eachBefore(VS)}function NM(e){return e.children}function IM(e){return Array.isArray(e)?e[1]:null}function FM(e){e.data.value!==void 0&&(e.value=e.data.value),e.data=e.data.data}function VS(e){var t=0;do e.height=t;while((e=e.parent)&&e.height<++t)}function hb(e){this.data=e,this.depth=this.height=0,this.parent=null}hb.prototype=GE.prototype={constructor:hb,count:function(){return this.eachAfter(TM)},each:function(e,t){let n=-1;for(const r of this)e.call(t,r,++n,this);return this},eachAfter:function(e,t){for(var n,r,i,s=this,f=[s],m=[],x=-1;s=f.pop();)if(m.push(s),n=s.children)for(r=0,i=n.length;r<i;++r)f.push(n[r]);for(;s=m.pop();)e.call(t,s,++x,this);return this},eachBefore:function(e,t){for(var n,r,i=this,s=[i],f=-1;i=s.pop();)if(e.call(t,i,++f,this),n=i.children)for(r=n.length-1;r>=0;--r)s.push(n[r]);return this},find:function(e,t){let n=-1;for(const r of this)if(e.call(t,r,++n,this))return r},sum:function(e){return this.eachAfter(function(t){for(var n=+e(t.data)||0,r=t.children,i=r&&r.length;--i>=0;)n+=r[i].value;t.value=n})},sort:function(e){return this.eachBefore(function(t){t.children&&t.children.sort(e)})},path:function(e){for(var t=this,n=function(s,f){if(s===f)return s;var m=s.ancestors(),x=f.ancestors(),O=null;for(s=m.pop(),f=x.pop();s===f;)O=s,s=m.pop(),f=x.pop();return O}(t,e),r=[t];t!==n;)t=t.parent,r.push(t);for(var i=r.length;e!==n;)r.splice(i,0,e),e=e.parent;return r},ancestors:function(){for(var e=this,t=[e];e=e.parent;)t.push(e);return t},descendants:function(){return Array.from(this)},leaves:function(){var e=[];return this.eachBefore(function(t){t.children||e.push(t)}),e},links:function(){var e=this,t=[];return e.each(function(n){n!==e&&t.push({source:n.parent,target:n})}),t},copy:function(){return GE(this).eachBefore(FM)},[Symbol.iterator]:function*(){var e,t,n,r,i=this,s=[i];do for(e=s.reverse(),s=[];i=e.pop();)if(yield i,t=i.children)for(n=0,r=t.length;n<r;++n)s.push(t[n]);while(s.length)}};var RM=function(e){return typeof e=="object"&&"length"in e?e:Array.from(e)},MM=function(e){for(var t,n,r=0,i=(e=function(f){for(var m,x,O=f.length;O;)x=Math.random()*O--|0,m=f[O],f[O]=f[x],f[x]=m;return f}(Array.from(e))).length,s=[];r<i;)t=e[r],n&&qS(n,t)?++r:(n=BM(s=jM(s,t)),r=0);return n};function jM(e,t){var n,r;if(KE(t,e))return[t];for(n=0;n<e.length;++n)if(y2(t,e[n])&&KE(f1(e[n],t),e))return[e[n],t];for(n=0;n<e.length-1;++n)for(r=n+1;r<e.length;++r)if(y2(f1(e[n],e[r]),t)&&y2(f1(e[n],t),e[r])&&y2(f1(e[r],t),e[n])&&KE(HS(e[n],e[r],t),e))return[e[n],e[r],t];throw new Error}function y2(e,t){var n=e.r-t.r,r=t.x-e.x,i=t.y-e.y;return n<0||n*n<r*r+i*i}function qS(e,t){var n=e.r-t.r+1e-9*Math.max(e.r,t.r,1),r=t.x-e.x,i=t.y-e.y;return n>0&&n*n>r*r+i*i}function KE(e,t){for(var n=0;n<t.length;++n)if(!qS(e,t[n]))return!1;return!0}function BM(e){switch(e.length){case 1:return function(t){return{x:t.x,y:t.y,r:t.r}}(e[0]);case 2:return f1(e[0],e[1]);case 3:return HS(e[0],e[1],e[2])}}function f1(e,t){var n=e.x,r=e.y,i=e.r,s=t.x,f=t.y,m=t.r,x=s-n,O=f-r,T=m-i,M=Math.sqrt(x*x+O*O);return{x:(n+s+x/M*T)/2,y:(r+f+O/M*T)/2,r:(M+i+m)/2}}function HS(e,t,n){var r=e.x,i=e.y,s=e.r,f=t.x,m=t.y,x=t.r,O=n.x,T=n.y,M=n.r,q=r-f,Q=r-O,se=i-m,le=i-T,Fe=x-s,Le=M-s,ze=r*r+i*i-s*s,nt=ze-f*f-m*m+x*x,it=ze-O*O-T*T+M*M,ut=Q*se-q*le,st=(se*it-le*nt)/(2*ut)-r,pt=(le*Fe-se*Le)/ut,dt=(Q*nt-q*it)/(2*ut)-i,Qt=(q*Le-Q*Fe)/ut,mn=pt*pt+Qt*Qt-1,on=2*(s+st*pt+dt*Qt),Rn=st*st+dt*dt-s*s,Fn=-(mn?(on+Math.sqrt(on*on-4*mn*Rn))/(2*mn):Rn/on);return{x:r+st+pt*Fn,y:i+dt+Qt*Fn,r:Fn}}function $S(e,t,n){var r,i,s,f,m=e.x-t.x,x=e.y-t.y,O=m*m+x*x;O?(i=t.r+n.r,i*=i,f=e.r+n.r,i>(f*=f)?(r=(O+f-i)/(2*O),s=Math.sqrt(Math.max(0,f/O-r*r)),n.x=e.x-r*m-s*x,n.y=e.y-r*x+s*m):(r=(O+i-f)/(2*O),s=Math.sqrt(Math.max(0,i/O-r*r)),n.x=t.x+r*m-s*x,n.y=t.y+r*x+s*m)):(n.x=t.x+n.r,n.y=t.y)}function GS(e,t){var n=e.r+t.r-1e-6,r=t.x-e.x,i=t.y-e.y;return n>0&&n*n>r*r+i*i}function KS(e){var t=e._,n=e.next._,r=t.r+n.r,i=(t.x*n.r+n.x*t.r)/r,s=(t.y*n.r+n.y*t.r)/r;return i*i+s*s}function b2(e){this._=e,this.next=null,this.previous=null}function PM(e){if(!(i=(e=RM(e)).length))return 0;var t,n,r,i,s,f,m,x,O,T,M;if((t=e[0]).x=0,t.y=0,!(i>1))return t.r;if(n=e[1],t.x=-n.r,n.x=t.r,n.y=0,!(i>2))return t.r+n.r;$S(n,t,r=e[2]),t=new b2(t),n=new b2(n),r=new b2(r),t.next=r.previous=n,n.next=t.previous=r,r.next=n.previous=t;e:for(m=3;m<i;++m){$S(t._,n._,r=e[m]),r=new b2(r),x=n.next,O=t.previous,T=n._.r,M=t._.r;do if(T<=M){if(GS(x._,r._)){n=x,t.next=n,n.previous=t,--m;continue e}T+=x._.r,x=x.next}else{if(GS(O._,r._)){(t=O).next=n,n.previous=t,--m;continue e}M+=O._.r,O=O.previous}while(x!==O.next);for(r.previous=t,r.next=n,t.next=n.previous=n=r,s=KS(t);(r=r.next)!==n;)(f=KS(r))<s&&(t=r,s=f);n=t.next}for(t=[n._],r=n;(r=r.next)!==n;)t.push(r._);for(r=MM(t),m=0;m<i;++m)(t=e[m]).x-=r.x,t.y-=r.y;return r.r}function x2(e){if(typeof e!="function")throw new Error;return e}function dy(){return 0}var db=function(e){return function(){return e}};function LM(e){return Math.sqrt(e.value)}function XS(e){return function(t){t.children||(t.r=Math.max(0,+e(t)||0))}}function XE(e,t){return function(n){if(r=n.children){var r,i,s,f=r.length,m=e(n)*t||0;if(m)for(i=0;i<f;++i)r[i].r+=m;if(s=PM(r),m)for(i=0;i<f;++i)r[i].r-=m;n.r=s+m}}}function YS(e){return function(t){var n=t.parent;t.r*=e,n&&(t.x=n.x+e*t.x,t.y=n.y+e*t.y)}}var JS=function(e){e.x0=Math.round(e.x0),e.y0=Math.round(e.y0),e.x1=Math.round(e.x1),e.y1=Math.round(e.y1)},h1=function(e,t,n,r,i){for(var s,f=e.children,m=-1,x=f.length,O=e.value&&(r-t)/e.value;++m<x;)(s=f[m]).y0=n,s.y1=i,s.x0=t,s.x1=t+=s.value*O},zM={depth:-1},QS={};function UM(e){return e.id}function WM(e){return e.parentId}var ZS=function(){var e=UM,t=WM;function n(r){var i,s,f,m,x,O,T,M=Array.from(r),q=M.length,Q=new Map;for(s=0;s<q;++s)i=M[s],x=M[s]=new hb(i),(O=e(i,s,r))!=null&&(O+="")&&(T=x.id=O,Q.set(T,Q.has(T)?QS:x)),(O=t(i,s,r))!=null&&(O+="")&&(x.parent=O);for(s=0;s<q;++s)if(O=(x=M[s]).parent){if(!(m=Q.get(O)))throw new Error("missing: "+O);if(m===QS)throw new Error("ambiguous: "+O);m.children?m.children.push(x):m.children=[x],x.parent=m}else{if(f)throw new Error("multiple roots");f=x}if(!f)throw new Error("no root");if(f.parent=zM,f.eachBefore(function(se){se.depth=se.parent.depth+1,--q}).eachBefore(VS),f.parent=null,q>0)throw new Error("cycle");return f}return n.id=function(r){return arguments.length?(e=x2(r),n):e},n.parentId=function(r){return arguments.length?(t=x2(r),n):t},n};function VM(e,t){return e.parent===t.parent?1:2}function YE(e){var t=e.children;return t?t[0]:e.t}function JE(e){var t=e.children;return t?t[t.length-1]:e.t}function qM(e,t,n){var r=n/(t.i-e.i);t.c-=r,t.s+=n,e.c+=r,t.z+=n,t.m+=n}function HM(e,t,n){return e.a.parent===t.parent?e.a:n}function w2(e,t){this._=e,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=t}w2.prototype=Object.create(hb.prototype);function $M(e,t){return e.parent===t.parent?1:2}function GM(e,t){return e+t.x}function KM(e,t){return Math.max(e,t.y)}var k2=function(e,t,n,r,i){for(var s,f=e.children,m=-1,x=f.length,O=e.value&&(i-n)/e.value;++m<x;)(s=f[m]).x0=t,s.x1=r,s.y0=n,s.y1=n+=s.value*O},e4=(1+Math.sqrt(5))/2;function t4(e,t,n,r,i,s){for(var f,m,x,O,T,M,q,Q,se,le,Fe,Le=[],ze=t.children,nt=0,it=0,ut=ze.length,st=t.value;nt<ut;){x=i-n,O=s-r;do T=ze[it++].value;while(!T&&it<ut);for(M=q=T,Fe=T*T*(le=Math.max(O/x,x/O)/(st*e)),se=Math.max(q/Fe,Fe/M);it<ut;++it){if(T+=m=ze[it].value,m<M&&(M=m),m>q&&(q=m),Fe=T*T*le,(Q=Math.max(q/Fe,Fe/M))>se){T-=m;break}se=Q}Le.push(f={value:T,dice:x<O,children:ze.slice(nt,it)}),f.dice?h1(f,n,r,i,st?r+=O*T/st:s):k2(f,n,r,st?n+=x*T/st:i,s),st-=T,nt=it}return Le}var n4=function e(t){function n(r,i,s,f,m){t4(t,r,i,s,f,m)}return n.ratio=function(r){return e((r=+r)>1?r:1)},n}(e4),XM=function e(t){function n(r,i,s,f,m){if((x=r._squarify)&&x.ratio===t)for(var x,O,T,M,q,Q=-1,se=x.length,le=r.value;++Q<se;){for(T=(O=x[Q]).children,M=O.value=0,q=T.length;M<q;++M)O.value+=T[M].value;O.dice?h1(O,i,s,f,le?s+=(m-s)*O.value/le:m):k2(O,i,s,le?i+=(f-i)*O.value/le:f,m),le-=O.value}else r._squarify=x=t4(t,r,i,s,f,m),x.ratio=t}return n.ratio=function(r){return e((r=+r)>1?r:1)},n}(e4);function QE(e,t,n){const r={};return e.each(i=>{const s=i.data;n(s)&&(r[t(s)]=i)}),e.lookup=r,e}function ZE(e){Ot.call(this,null,e)}ZE.Definition={type:"Nest",metadata:{treesource:!0,changes:!0},params:[{name:"keys",type:"field",array:!0},{name:"generate",type:"boolean"}]};const YM=e=>e.values;function Hv(e){Ot.call(this,null,e)}Object(xe.z)(ZE,Ot,{transform(e,t){t.source||Object(xe.o)("Nest transform requires an upstream data source.");var n=e.generate,r=e.modified(),i=t.clone(),s=this.value;return(!s||r||t.changed())&&(s&&s.each(f=>{f.children&&Xt(f.data)&&i.rem.push(f.data)}),this.value=s=GE({values:Object(xe.i)(e.keys).reduce((f,m)=>(f.key(m),f),function(){const f=[],m={entries:x=>function O(T,M){if(++M>f.length)return T;const q=[];for(const Q in T)q.push({key:Q,values:O(T[Q],M)});return q}(function O(T,M){if(M>=f.length)return T;const q=T.length,Q=f[M++],se={},le={};let Fe,Le,ze,nt=-1;for(;++nt<q;)Fe=Q(Le=T[nt])+"",(ze=se[Fe])?ze.push(Le):se[Fe]=[Le];for(Fe in se)le[Fe]=O(se[Fe],M);return le}(x,0),0),key:x=>(f.push(x),m)};return m}()).entries(i.source)},YM),n&&s.each(f=>{f.children&&(f=Dn(f.data),i.add.push(f),i.source.push(f))}),QE(s,nn,nn)),i.source.root=s,i}});const JM=(e,t)=>e.parent===t.parent?1:2;Object(xe.z)(Hv,Ot,{transform(e,t){t.source&&t.source.root||Object(xe.o)(this.constructor.name+" transform requires a backing tree data source.");const n=this.layout(e.method),r=this.fields,i=t.source.root,s=e.as||r;e.field?i.sum(e.field):i.count(),e.sort&&i.sort(Qr(e.sort,f=>f.data)),function(f,m,x){for(let O,T=0,M=m.length;T<M;++T)(O=m[T])in x&&f[O](x[O])}(n,this.params,e),n.separation&&n.separation(e.separation!==!1?JM:xe.Q);try{this.value=n(i)}catch(f){Object(xe.o)(f)}return i.each(f=>function(m,x,O){const T=m.data,M=x.length-1;for(let q=0;q<M;++q)T[O[q]]=m[x[q]];T[O[M]]=m.children?m.children.length:0}(f,r,s)),t.reflow(e.modified()).modifies(s).modifies("leaf")}});const eC=["x","y","r","depth","children"];function tC(e){Hv.call(this,e)}tC.Definition={type:"Pack",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"radius",type:"field",default:null},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:eC.length,default:eC}]},Object(xe.z)(tC,Hv,{layout:function(){var e=null,t=1,n=1,r=dy;function i(s){return s.x=t/2,s.y=n/2,e?s.eachBefore(XS(e)).eachAfter(XE(r,.5)).eachBefore(YS(1)):s.eachBefore(XS(LM)).eachAfter(XE(dy,1)).eachAfter(XE(r,s.r/Math.min(t,n))).eachBefore(YS(Math.min(t,n)/(2*s.r))),s}return i.radius=function(s){return arguments.length?(e=function(f){return f==null?null:x2(f)}(s),i):e},i.size=function(s){return arguments.length?(t=+s[0],n=+s[1],i):[t,n]},i.padding=function(s){return arguments.length?(r=typeof s=="function"?s:db(+s),i):r},i},params:["radius","size","padding"],fields:eC});const nC=["x0","y0","x1","y1","depth","children"];function rC(e){Hv.call(this,e)}function iC(e){Ot.call(this,null,e)}rC.Definition={type:"Partition",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:nC.length,default:nC}]},Object(xe.z)(rC,Hv,{layout:function(){var e=1,t=1,n=0,r=!1;function i(s){var f=s.height+1;return s.x0=s.y0=n,s.x1=e,s.y1=t/f,s.eachBefore(function(m,x){return function(O){O.children&&h1(O,O.x0,m*(O.depth+1)/x,O.x1,m*(O.depth+2)/x);var T=O.x0,M=O.y0,q=O.x1-n,Q=O.y1-n;q<T&&(T=q=(T+q)/2),Q<M&&(M=Q=(M+Q)/2),O.x0=T,O.y0=M,O.x1=q,O.y1=Q}}(t,f)),r&&s.eachBefore(JS),s}return i.round=function(s){return arguments.length?(r=!!s,i):r},i.size=function(s){return arguments.length?(e=+s[0],t=+s[1],i):[e,t]},i.padding=function(s){return arguments.length?(n=+s,i):n},i},params:["size","round","padding"],fields:nC}),iC.Definition={type:"Stratify",metadata:{treesource:!0},params:[{name:"key",type:"field",required:!0},{name:"parentKey",type:"field",required:!0}]},Object(xe.z)(iC,Ot,{transform(e,t){t.source||Object(xe.o)("Stratify transform requires an upstream data source.");let n=this.value;const r=e.modified(),i=t.fork(t.ALL).materialize(t.SOURCE),s=!n||r||t.changed(t.ADD_REM)||t.modified(e.key.fields)||t.modified(e.parentKey.fields);return i.source=i.source.slice(),s&&(n=i.source.length?QE(ZS().id(e.key).parentId(e.parentKey)(i.source),e.key,xe.Ia):QE(ZS()([{}]),e.key,e.key)),i.source.root=this.value=n,i}});const r4={tidy:function(){var e=VM,t=1,n=1,r=null;function i(x){var O=function(Le){for(var ze,nt,it,ut,st,pt=new w2(Le,0),dt=[pt];ze=dt.pop();)if(it=ze._.children)for(ze.children=new Array(st=it.length),ut=st-1;ut>=0;--ut)dt.push(nt=ze.children[ut]=new w2(it[ut],ut)),nt.parent=ze;return(pt.parent=new w2(null,0)).children=[pt],pt}(x);if(O.eachAfter(s),O.parent.m=-O.z,O.eachBefore(f),r)x.eachBefore(m);else{var T=x,M=x,q=x;x.eachBefore(function(Le){Le.x<T.x&&(T=Le),Le.x>M.x&&(M=Le),Le.depth>q.depth&&(q=Le)});var Q=T===M?1:e(T,M)/2,se=Q-T.x,le=t/(M.x+Q+se),Fe=n/(q.depth||1);x.eachBefore(function(Le){Le.x=(Le.x+se)*le,Le.y=Le.depth*Fe})}return x}function s(x){var O=x.children,T=x.parent.children,M=x.i?T[x.i-1]:null;if(O){(function(Q){for(var se,le=0,Fe=0,Le=Q.children,ze=Le.length;--ze>=0;)(se=Le[ze]).z+=le,se.m+=le,le+=se.s+(Fe+=se.c)})(x);var q=(O[0].z+O[O.length-1].z)/2;M?(x.z=M.z+e(x._,M._),x.m=x.z-q):x.z=q}else M&&(x.z=M.z+e(x._,M._));x.parent.A=function(Q,se,le){if(se){for(var Fe,Le=Q,ze=Q,nt=se,it=Le.parent.children[0],ut=Le.m,st=ze.m,pt=nt.m,dt=it.m;nt=JE(nt),Le=YE(Le),nt&&Le;)it=YE(it),(ze=JE(ze)).a=Q,(Fe=nt.z+pt-Le.z-ut+e(nt._,Le._))>0&&(qM(HM(nt,Q,le),Q,Fe),ut+=Fe,st+=Fe),pt+=nt.m,ut+=Le.m,dt+=it.m,st+=ze.m;nt&&!JE(ze)&&(ze.t=nt,ze.m+=pt-st),Le&&!YE(it)&&(it.t=Le,it.m+=ut-dt,le=Q)}return le}(x,M,x.parent.A||T[0])}function f(x){x._.x=x.z+x.parent.m,x.m+=x.parent.m}function m(x){x.x*=t,x.y=x.depth*n}return i.separation=function(x){return arguments.length?(e=x,i):e},i.size=function(x){return arguments.length?(r=!1,t=+x[0],n=+x[1],i):r?null:[t,n]},i.nodeSize=function(x){return arguments.length?(r=!0,t=+x[0],n=+x[1],i):r?[t,n]:null},i},cluster:function(){var e=$M,t=1,n=1,r=!1;function i(s){var f,m=0;s.eachAfter(function(q){var Q=q.children;Q?(q.x=function(se){return se.reduce(GM,0)/se.length}(Q),q.y=function(se){return 1+se.reduce(KM,0)}(Q)):(q.x=f?m+=e(q,f):0,q.y=0,f=q)});var x=function(q){for(var Q;Q=q.children;)q=Q[0];return q}(s),O=function(q){for(var Q;Q=q.children;)q=Q[Q.length-1];return q}(s),T=x.x-e(x,O)/2,M=O.x+e(O,x)/2;return s.eachAfter(r?function(q){q.x=(q.x-s.x)*t,q.y=(s.y-q.y)*n}:function(q){q.x=(q.x-T)/(M-T)*t,q.y=(1-(s.y?q.y/s.y:1))*n})}return i.separation=function(s){return arguments.length?(e=s,i):e},i.size=function(s){return arguments.length?(r=!1,t=+s[0],n=+s[1],i):r?null:[t,n]},i.nodeSize=function(s){return arguments.length?(r=!0,t=+s[0],n=+s[1],i):r?[t,n]:null},i}},aC=["x","y","depth","children"];function oC(e){Hv.call(this,e)}function sC(e){Ot.call(this,[],e)}oC.Definition={type:"Tree",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"tidy",values:["tidy","cluster"]},{name:"size",type:"number",array:!0,length:2},{name:"nodeSize",type:"number",array:!0,length:2},{name:"separation",type:"boolean",default:!0},{name:"as",type:"string",array:!0,length:aC.length,default:aC}]},Object(xe.z)(oC,Hv,{layout(e){const t=e||"tidy";if(Object(xe.w)(r4,t))return r4[t]();Object(xe.o)("Unrecognized Tree layout method: "+t)},params:["size","nodeSize"],fields:aC}),sC.Definition={type:"TreeLinks",metadata:{tree:!0,generates:!0,changes:!0},params:[]},Object(xe.z)(sC,Ot,{transform(e,t){const n=this.value,r=t.source&&t.source.root,i=t.fork(t.NO_SOURCE),s={};return r||Object(xe.o)("TreeLinks transform requires a tree data source."),t.changed(t.ADD_REM)?(i.rem=n,t.visit(t.SOURCE,f=>s[nn(f)]=1),r.each(f=>{const m=f.data,x=f.parent&&f.parent.data;x&&s[nn(m)]&&s[nn(x)]&&i.add.push(Dn({source:x,target:m}))}),this.value=i.add):t.changed(t.MOD)&&(t.visit(t.MOD,f=>s[nn(f)]=1),n.forEach(f=>{(s[nn(f.source)]||s[nn(f.target)])&&i.mod.push(f)})),i}});const i4={binary:function(e,t,n,r,i){var s,f,m=e.children,x=m.length,O=new Array(x+1);for(O[0]=f=s=0;s<x;++s)O[s+1]=f+=m[s].value;(function T(M,q,Q,se,le,Fe,Le){if(M>=q-1){var ze=m[M];return ze.x0=se,ze.y0=le,ze.x1=Fe,void(ze.y1=Le)}for(var nt=O[M],it=Q/2+nt,ut=M+1,st=q-1;ut<st;){var pt=ut+st>>>1;O[pt]<it?ut=pt+1:st=pt}it-O[ut-1]<O[ut]-it&&M+1<ut&&--ut;var dt=O[ut]-nt,Qt=Q-dt;if(Fe-se>Le-le){var mn=Q?(se*Qt+Fe*dt)/Q:Fe;T(M,ut,dt,se,le,mn,Le),T(ut,q,Qt,mn,le,Fe,Le)}else{var on=Q?(le*Qt+Le*dt)/Q:Le;T(M,ut,dt,se,le,Fe,on),T(ut,q,Qt,se,on,Fe,Le)}})(0,x,e.value,t,n,r,i)},dice:h1,slice:k2,slicedice:function(e,t,n,r,i){(1&e.depth?k2:h1)(e,t,n,r,i)},squarify:n4,resquarify:XM},uC=["x0","y0","x1","y1","depth","children"];function cC(e){Hv.call(this,e)}cC.Definition={type:"Treemap",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"squarify",values:["squarify","resquarify","binary","dice","slice","slicedice"]},{name:"padding",type:"number",default:0},{name:"paddingInner",type:"number",default:0},{name:"paddingOuter",type:"number",default:0},{name:"paddingTop",type:"number",default:0},{name:"paddingRight",type:"number",default:0},{name:"paddingBottom",type:"number",default:0},{name:"paddingLeft",type:"number",default:0},{name:"ratio",type:"number",default:1.618033988749895},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:uC.length,default:uC}]},Object(xe.z)(cC,Hv,{layout(){const e=function(){var t=n4,n=!1,r=1,i=1,s=[0],f=dy,m=dy,x=dy,O=dy,T=dy;function M(Q){return Q.x0=Q.y0=0,Q.x1=r,Q.y1=i,Q.eachBefore(q),s=[0],n&&Q.eachBefore(JS),Q}function q(Q){var se=s[Q.depth],le=Q.x0+se,Fe=Q.y0+se,Le=Q.x1-se,ze=Q.y1-se;Le<le&&(le=Le=(le+Le)/2),ze<Fe&&(Fe=ze=(Fe+ze)/2),Q.x0=le,Q.y0=Fe,Q.x1=Le,Q.y1=ze,Q.children&&(se=s[Q.depth+1]=f(Q)/2,le+=T(Q)-se,Fe+=m(Q)-se,Le-=x(Q)-se,ze-=O(Q)-se,Le<le&&(le=Le=(le+Le)/2),ze<Fe&&(Fe=ze=(Fe+ze)/2),t(Q,le,Fe,Le,ze))}return M.round=function(Q){return arguments.length?(n=!!Q,M):n},M.size=function(Q){return arguments.length?(r=+Q[0],i=+Q[1],M):[r,i]},M.tile=function(Q){return arguments.length?(t=x2(Q),M):t},M.padding=function(Q){return arguments.length?M.paddingInner(Q).paddingOuter(Q):M.paddingInner()},M.paddingInner=function(Q){return arguments.length?(f=typeof Q=="function"?Q:db(+Q),M):f},M.paddingOuter=function(Q){return arguments.length?M.paddingTop(Q).paddingRight(Q).paddingBottom(Q).paddingLeft(Q):M.paddingTop()},M.paddingTop=function(Q){return arguments.length?(m=typeof Q=="function"?Q:db(+Q),M):m},M.paddingRight=function(Q){return arguments.length?(x=typeof Q=="function"?Q:db(+Q),M):x},M.paddingBottom=function(Q){return arguments.length?(O=typeof Q=="function"?Q:db(+Q),M):O},M.paddingLeft=function(Q){return arguments.length?(T=typeof Q=="function"?Q:db(+Q),M):T},M}();return e.ratio=t=>{const n=e.tile();n.ratio&&e.tile(n.ratio(t))},e.method=t=>{Object(xe.w)(i4,t)?e.tile(i4[t]):Object(xe.o)("Unrecognized Treemap layout method: "+t)},e},params:["method","ratio","size","round","padding","paddingInner","paddingOuter","paddingTop","paddingRight","paddingBottom","paddingLeft"],fields:uC});const QM=4278190080,ZM=268435456,e6=.0625;function t6(e,t,n,r){const i=e.width,s=e.height,f=n||r,m=qs(i,s).getContext("2d");t.forEach(Fe=>function Le(ze,nt,it){if(!nt.length)return;const ut=nt[0].mark.marktype;ut==="group"?nt.forEach(st=>{st.items.forEach(pt=>Le(ze,pt.items,it))}):gl[ut].draw(ze,{items:it?nt.map(n6):nt})}(m,Fe,f));const x=new Uint32Array(m.getImageData(0,0,i,s).data.buffer),O=e.bitmap(),T=f&&e.bitmap();let M,q,Q,se,le;for(q=0;q<s;++q)for(M=0;M<i;++M)(le=x[q*i+M]&QM)&&(Q=e(M),se=e(q),r||O.set(Q,se),f&&le^ZM&&T.set(Q,se));return[O,T]}function n6(e){const t=xr(e,{});return t.stroke&&(t.strokeOpacity=1),t.fill&&(t.fillOpacity=e6,t.stroke="#000",t.strokeOpacity=1,t.strokeWidth=2),t}const $v=5,ph=31,d1=32,R0=new Uint32Array(d1+1),eg=new Uint32Array(d1+1);eg[0]=0,R0[0]=~eg[0];for(let e=1;e<=d1;++e)eg[e]=eg[e-1]<<1|1,R0[e]=~eg[e];function r6(e,t,n){const r=Math.max(1,Math.sqrt(e*t/1e6)),i=~~((e+2*n+r)/r),s=~~((t+2*n+r)/r),f=m=>~~((m+n)/r);return f.invert=m=>m*r-n,f.bitmap=()=>function(m,x){const O=new Uint32Array(~~((m*x+d1)/d1));function T(q,Q){O[q]|=Q}function M(q,Q){O[q]&=Q}return{array:O,get:(q,Q)=>{const se=Q*m+q;return O[se>>>$v]&1<<(se&ph)},set:(q,Q)=>{const se=Q*m+q;T(se>>>$v,1<<(se&ph))},clear:(q,Q)=>{const se=Q*m+q;M(se>>>$v,~(1<<(se&ph)))},getRange:(q,Q,se,le)=>{let Fe,Le,ze,nt,it=le;for(;it>=Q;--it)if((ze=(Fe=it*m+q)>>>$v)==(nt=(Le=it*m+se)>>>$v)){if(O[ze]&R0[Fe&ph]&eg[1+(Le&ph)])return!0}else{if(O[ze]&R0[Fe&ph]||O[nt]&eg[1+(Le&ph)])return!0;for(let ut=ze+1;ut<nt;++ut)if(O[ut])return!0}return!1},setRange:(q,Q,se,le)=>{let Fe,Le,ze,nt,it;for(;Q<=le;++Q)if((ze=(Fe=Q*m+q)>>>$v)==(nt=(Le=Q*m+se)>>>$v))T(ze,R0[Fe&ph]&eg[1+(Le&ph)]);else for(T(ze,R0[Fe&ph]),T(nt,eg[1+(Le&ph)]),it=ze+1;it<nt;++it)T(it,4294967295)},clearRange:(q,Q,se,le)=>{let Fe,Le,ze,nt,it;for(;Q<=le;++Q)if((ze=(Fe=Q*m+q)>>>$v)==(nt=(Le=Q*m+se)>>>$v))M(ze,eg[Fe&ph]|R0[1+(Le&ph)]);else for(M(ze,eg[Fe&ph]),M(nt,R0[1+(Le&ph)]),it=ze+1;it<nt;++it)M(it,0)},outOfBounds:(q,Q,se,le)=>q<0||Q<0||le>=x||se>=m}}(i,s),f.ratio=r,f.padding=n,f.width=e,f.height=t,f}function E2(e,t,n,r,i,s){let f=n/2;return e-f<0||e+f>i||t-(f=r/2)<0||t+f>s}function M0(e,t,n,r,i,s,f,m){const x=i*s/(2*r),O=e(t-x),T=e(t+x),M=e(n-(s/=2)),q=e(n+s);return f.outOfBounds(O,M,T,q)||f.getRange(O,M,T,q)||m&&m.getRange(O,M,T,q)}const i6=[-1,-1,1,1],a6=[-1,1,-1,1],o6=["right","center","left"],s6=["bottom","middle","top"];function a4(e,t,n,r,i,s,f,m,x,O,T,M){return!(i.outOfBounds(e,n,t,r)||(M&&s?s.getRange(e,n,t,r)||!function(q,Q,se,le,Fe){return Fe[0]<=q&&se<=Fe[2]&&Fe[3]<=Q&&le<=Fe[5]}(f,x,m,O,T):i.getRange(e,n,t,r)))}const u6={"top-left":0,top:1,"top-right":2,left:4,middle:5,right:6,"bottom-left":8,bottom:9,"bottom-right":10},c6={naive:function(e,t,n,r){const i=e.width,s=e.height;return function(f){const m=f.datum.datum.items[r].items,x=m.length,O=f.datum.fontSize,T=ds.width(f.datum,f.datum.text);let M,q,Q,se,le,Fe,Le,ze=0;for(let nt=0;nt<x;++nt)M=m[nt].x,Q=m[nt].y,le=(M+(q=m[nt].x2===void 0?M:m[nt].x2))/2,Fe=(Q+(se=m[nt].y2===void 0?Q:m[nt].y2))/2,(Le=Math.abs(q-M+se-Q))>=ze&&(ze=Le,f.x=le,f.y=Fe);return le=T/2,Fe=O/2,M=f.x-le,q=f.x+le,Q=f.y-Fe,se=f.y+Fe,f.align="center",M<0&&q<=i?f.align="left":0<=M&&i<q&&(f.align="right"),f.baseline="middle",Q<0&&se<=s?f.baseline="top":0<=Q&&s<se&&(f.baseline="bottom"),!0}},"reduced-search":function(e,t,n,r){const i=e.width,s=e.height,f=t[0],m=t[1];function x(O,T,M,q,Q){const se=e.invert(O),le=e.invert(T);let Fe,Le=M,ze=s;if(!E2(se,le,q,Q,i,s)&&!M0(e,se,le,Q,q,Le,f,m)&&!M0(e,se,le,Q,q,Q,f,null)){for(;ze-Le>=1;)M0(e,se,le,Q,q,Fe=(Le+ze)/2,f,m)?ze=Fe:Le=Fe;if(Le>M)return[se,le,Le,!0]}}return function(O){const T=O.datum.datum.items[r].items,M=T.length,q=O.datum.fontSize,Q=ds.width(O.datum,O.datum.text);let se,le,Fe,Le,ze,nt,it,ut,st,pt,dt,Qt,mn,on,Rn,Fn,zn,Vn=n?q:0,Qn=!1,pr=!1,Pr=0;for(let Ar=0;Ar<M;++Ar){for(se=T[Ar].x,Fe=T[Ar].y,le=T[Ar].x2===void 0?se:T[Ar].x2,Le=T[Ar].y2===void 0?Fe:T[Ar].y2,se>le&&(zn=se,se=le,le=zn),Fe>Le&&(zn=Fe,Fe=Le,Le=zn),pt=~~(((st=e(se))+(dt=e(le)))/2),mn=~~(((Qt=e(Fe))+(on=e(Le)))/2),it=pt;it>=st;--it)for(ut=mn;ut>=Qt;--ut)(Fn=x(it,ut,Vn,Q,q))&&([O.x,O.y,Vn,Qn]=Fn);for(it=pt;it<=dt;++it)for(ut=mn;ut<=on;++ut)(Fn=x(it,ut,Vn,Q,q))&&([O.x,O.y,Vn,Qn]=Fn);Qn||n||(ze=(se+le)/2,nt=(Fe+Le)/2,(Rn=Math.abs(le-se+Le-Fe))>=Pr&&!E2(ze,nt,Q,q,i,s)&&!M0(e,ze,nt,q,Q,q,f,null)&&(Pr=Rn,O.x=ze,O.y=nt,pr=!0))}return!(!Qn&&!pr||(ze=Q/2,nt=q/2,f.setRange(e(O.x-ze),e(O.y-nt),e(O.x+ze),e(O.y+nt)),O.align="center",O.baseline="middle",0))}},floodfill:function(e,t,n,r){const i=e.width,s=e.height,f=t[0],m=t[1],x=e.bitmap();return function(O){const T=O.datum.datum.items[r].items,M=T.length,q=O.datum.fontSize,Q=ds.width(O.datum,O.datum.text),se=[];let le,Fe,Le,ze,nt,it,ut,st,pt,dt,Qt,mn,on=n?q:0,Rn=!1,Fn=!1,zn=0;for(let Vn=0;Vn<M;++Vn){for(le=T[Vn].x,Le=T[Vn].y,Fe=T[Vn].x2===void 0?le:T[Vn].x2,ze=T[Vn].y2===void 0?Le:T[Vn].y2,se.push([e((le+Fe)/2),e((Le+ze)/2)]);se.length;)if([ut,st]=se.pop(),!(f.get(ut,st)||m.get(ut,st)||x.get(ut,st))){x.set(ut,st);for(let Qn=0;Qn<4;++Qn)nt=ut+i6[Qn],it=st+a6[Qn],x.outOfBounds(nt,it,nt,it)||se.push([nt,it]);if(nt=e.invert(ut),it=e.invert(st),pt=on,dt=s,!E2(nt,it,Q,q,i,s)&&!M0(e,nt,it,q,Q,pt,f,m)&&!M0(e,nt,it,q,Q,q,f,null)){for(;dt-pt>=1;)M0(e,nt,it,q,Q,Qt=(pt+dt)/2,f,m)?dt=Qt:pt=Qt;pt>on&&(O.x=nt,O.y=it,on=pt,Rn=!0)}}Rn||n||(nt=(le+Fe)/2,it=(Le+ze)/2,(mn=Math.abs(Fe-le+ze-Le))>=zn&&!E2(nt,it,Q,q,i,s)&&!M0(e,nt,it,q,Q,q,f,null)&&(zn=mn,O.x=nt,O.y=it,Fn=!0))}return!(!Rn&&!Fn||(nt=Q/2,it=q/2,f.setRange(e(O.x-nt),e(O.y-it),e(O.x+nt),e(O.y+it)),O.align="center",O.baseline="middle",0))}}};function l6(e,t,n,r,i,s,f,m,x,O,T){if(!e.length)return e;const M=Math.max(r.length,i.length),q=function(pt,dt){const Qt=new Float64Array(dt),mn=pt.length;for(let on=0;on<mn;++on)Qt[on]=pt[on]||0;for(let on=mn;on<dt;++on)Qt[on]=Qt[mn-1];return Qt}(r,M),Q=function(pt,dt){const Qt=new Int8Array(dt),mn=pt.length;for(let on=0;on<mn;++on)Qt[on]|=u6[pt[on]];for(let on=mn;on<dt;++on)Qt[on]=Qt[mn-1];return Qt}(i,M),se=function(pt){return pt&&pt.mark&&pt.mark.marktype}(e[0].datum),le=se==="group"&&e[0].datum.items[x].marktype,Fe=le==="area",Le=function(pt,dt,Qt,mn){const on=Rn=>[Rn.x,Rn.x,Rn.x,Rn.y,Rn.y,Rn.y];return pt?pt==="line"||pt==="area"?Rn=>on(Rn.datum):dt==="line"?Rn=>{const Fn=Rn.datum.items[mn].items;return on(Fn.length?Fn[Qt==="start"?0:Fn.length-1]:{x:NaN,y:NaN})}:Rn=>{const Fn=Rn.datum.bounds;return[Fn.x1,(Fn.x1+Fn.x2)/2,Fn.x2,Fn.y1,(Fn.y1+Fn.y2)/2,Fn.y2]}:on}(se,le,m,x),ze=r6(t[0],t[1],O),nt=Fe&&T==="naive",it=e.map(pt=>({datum:pt,opacity:0,x:void 0,y:void 0,align:void 0,baseline:void 0,boundary:Le(pt)}));let ut;if(!nt){n&&it.sort((dt,Qt)=>n(dt.datum,Qt.datum));let pt=!1;for(let dt=0;dt<Q.length&&!pt;++dt)pt=Q[dt]===5||q[dt]<0;se&&(f||Fe)&&(s=[e.map(dt=>dt.datum)].concat(s)),ut=s.length?t6(ze,s,pt,Fe):function(dt,Qt){const mn=dt.bitmap();return(Qt||[]).forEach(on=>mn.set(dt(on.boundary[0]),dt(on.boundary[3]))),[mn,void 0]}(ze,f&&it)}const st=Fe?c6[T](ze,ut,f,x):function(pt,dt,Qt,mn){const on=pt.width,Rn=pt.height,Fn=dt[0],zn=dt[1],Vn=mn.length;return function(Qn){const pr=Qn.boundary,Pr=Qn.datum.fontSize;if(pr[2]<0||pr[5]<0||pr[0]>on||pr[3]>Rn)return!1;let Ar,Jr,gi,vi,Li,wi,yi,Si,xa,no,zi,vo,Lo,co,Is,Fs=0;for(let gs=0;gs<Vn;++gs){if(Ar=(3&Qt[gs])-1,Jr=(Qt[gs]>>>2&3)-1,gi=Ar===0&&Jr===0||mn[gs]<0,vi=Ar&&Jr?Math.SQRT1_2:1,Li=mn[gs]<0?-1:1,wi=pr[1+Ar]+mn[gs]*Ar*vi,Si=(zi=pr[4+Jr]+Li*Pr*Jr/2+mn[gs]*Jr*vi)-Pr/2,xa=zi+Pr/2,vo=pt(wi),co=pt(Si),Is=pt(xa),!Fs){if(!a4(vo,vo,co,Is,Fn,zn,wi,wi,Si,xa,pr,gi))continue;Fs=ds.width(Qn.datum,Qn.datum.text)}if(yi=(no=wi+Li*Fs*Ar/2)+Fs/2,a4(vo=pt(wi=no-Fs/2),Lo=pt(yi),co,Is,Fn,zn,wi,yi,Si,xa,pr,gi))return Qn.x=Ar?Ar*Li<0?yi:wi:no,Qn.y=Jr?Jr*Li<0?xa:Si:zi,Qn.align=o6[Ar*Li+1],Qn.baseline=s6[Jr*Li+1],Fn.setRange(vo,co,Lo,Is),!0}return!1}}(ze,ut,Q,q);return it.forEach(pt=>pt.opacity=+st(pt)),it}const lC=["x","y","opacity","align","baseline"],o4=["top-left","left","bottom-left","top","bottom","top-right","right","bottom-right"];function fC(e){Ot.call(this,null,e)}function s4(e,t){var n,r,i,s,f,m,x=[],O=function(T){return T(s)};if(t==null)x.push(e);else for(n={},r=0,i=e.length;r<i;++r)s=e[r],(m=n[f=t.map(O)])||(n[f]=m=[],m.dims=f,x.push(m)),m.push(s);return x}function hC(e){Ot.call(this,null,e)}fC.Definition={type:"Label",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"sort",type:"compare"},{name:"anchor",type:"string",array:!0,default:o4},{name:"offset",type:"number",array:!0,default:[1]},{name:"padding",type:"number",default:0},{name:"lineAnchor",type:"string",values:["start","end"],default:"end"},{name:"markIndex",type:"number",default:0},{name:"avoidBaseMark",type:"boolean",default:!0},{name:"avoidMarks",type:"data",array:!0},{name:"method",type:"string",default:"naive"},{name:"as",type:"string",array:!0,length:lC.length,default:lC}]},Object(xe.z)(fC,Ot,{transform(e,t){const n=e.modified();if(!(n||t.changed(t.ADD_REM)||function(i){const s=e[i];return Object(xe.E)(s)&&t.modified(s.fields)}("sort")))return;e.size&&e.size.length===2||Object(xe.o)("Size parameter should be specified as a [width, height] array.");const r=e.as||lC;return l6(t.materialize(t.SOURCE).source,e.size,e.sort,Object(xe.i)(e.offset||1),Object(xe.i)(e.anchor||o4),e.avoidMarks||[],e.avoidBaseMark!==!1,e.lineAnchor||"end",e.markIndex||0,e.padding||0,e.method||"naive").forEach(i=>{const s=i.datum;s[r[0]]=i.x,s[r[1]]=i.y,s[r[2]]=i.opacity,s[r[3]]=i.align,s[r[4]]=i.baseline}),t.reflow(n).modifies(r)}}),hC.Definition={type:"Loess",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"bandwidth",type:"number",default:.3},{name:"as",type:"string",array:!0}]},Object(xe.z)(hC,Ot,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const r=s4(t.materialize(t.SOURCE).source,e.groupby),i=(e.groupby||[]).map(xe.h),s=i.length,f=e.as||[Object(xe.h)(e.x),Object(xe.h)(e.y)],m=[];r.forEach(x=>{xf(x,e.x,e.y,e.bandwidth||.3).forEach(O=>{const T={};for(let M=0;M<s;++M)T[i[M]]=x.dims[M];T[f[0]]=O[0],T[f[1]]=O[1],m.push(Dn(T))})}),this.value&&(n.rem=this.value),this.value=n.add=n.source=m}return n}});const dC={linear:ss,log:Eo,exp:nc,pow:Cl,quad:rc,poly:su};function pC(e){Ot.call(this,null,e)}pC.Definition={type:"Regression",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"string",default:"linear",values:Object.keys(dC)},{name:"order",type:"number",default:3},{name:"extent",type:"number",array:!0,length:2},{name:"params",type:"boolean",default:!1},{name:"as",type:"string",array:!0}]},Object(xe.z)(pC,Ot,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const r=s4(t.materialize(t.SOURCE).source,e.groupby),i=(e.groupby||[]).map(xe.h),s=e.method||"linear",f=e.order||3,m=((q,Q)=>q==="poly"?Q:q==="quad"?2:1)(s,f),x=e.as||[Object(xe.h)(e.x),Object(xe.h)(e.y)],O=dC[s],T=[];let M=e.extent;Object(xe.w)(dC,s)||Object(xe.o)("Invalid regression method: "+s),M!=null&&s==="log"&&M[0]<=0&&(t.dataflow.warn("Ignoring extent with values <= 0 for log regression."),M=null),r.forEach(q=>{if(q.length<=m)return void t.dataflow.warn("Skipping regression with more parameters than data points.");const Q=O(q,e.x,e.y,f);if(e.params)return void T.push(Dn({keys:q.dims,coef:Q.coef,rSquared:Q.rSquared}));const se=M||Object(xe.q)(q,e.x),le=Fe=>{const Le={};for(let ze=0;ze<i.length;++ze)Le[i[ze]]=q.dims[ze];Le[x[0]]=Fe[0],Le[x[1]]=Fe[1],T.push(Dn(Le))};s==="linear"?se.forEach(Fe=>le([Fe,Q.predict(Fe)])):wf(Q.predict,se,25,200).forEach(le)}),this.value&&(n.rem=this.value),this.value=n.add=n.source=T}return n}});const u4=Math.pow(2,-52),C2=new Uint32Array(512);class O2{static from(t,n=function(i){return i[0]},r=function(i){return i[1]}){const i=t.length,s=new Float64Array(2*i);for(let f=0;f<i;f++){const m=t[f];s[2*f]=n(m),s[2*f+1]=r(m)}return new O2(s)}constructor(t){const n=t.length>>1;if(n>0&&typeof t[0]!="number")throw new Error("Expected coords to contain numbers.");this.coords=t;const r=Math.max(2*n-5,0);this._triangles=new Uint32Array(3*r),this._halfedges=new Int32Array(3*r),this._hashSize=Math.ceil(Math.sqrt(n)),this._hullPrev=new Uint32Array(n),this._hullNext=new Uint32Array(n),this._hullTri=new Uint32Array(n),this._hullHash=new Int32Array(this._hashSize).fill(-1),this._ids=new Uint32Array(n),this._dists=new Float64Array(n),this.update()}update(){const{coords:t,_hullPrev:n,_hullNext:r,_hullTri:i,_hullHash:s}=this,f=t.length>>1;let m=1/0,x=1/0,O=-1/0,T=-1/0;for(let mn=0;mn<f;mn++){const on=t[2*mn],Rn=t[2*mn+1];on<m&&(m=on),Rn<x&&(x=Rn),on>O&&(O=on),Rn>T&&(T=Rn),this._ids[mn]=mn}const M=(m+O)/2,q=(x+T)/2;let Q,se,le,Fe=1/0;for(let mn=0;mn<f;mn++){const on=mC(M,q,t[2*mn],t[2*mn+1]);on<Fe&&(Q=mn,Fe=on)}const Le=t[2*Q],ze=t[2*Q+1];Fe=1/0;for(let mn=0;mn<f;mn++){if(mn===Q)continue;const on=mC(Le,ze,t[2*mn],t[2*mn+1]);on<Fe&&on>0&&(se=mn,Fe=on)}let nt=t[2*se],it=t[2*se+1],ut=1/0;for(let mn=0;mn<f;mn++){if(mn===Q||mn===se)continue;const on=h6(Le,ze,nt,it,t[2*mn],t[2*mn+1]);on<ut&&(le=mn,ut=on)}let st=t[2*le],pt=t[2*le+1];if(ut===1/0){for(let Rn=0;Rn<f;Rn++)this._dists[Rn]=t[2*Rn]-t[0]||t[2*Rn+1]-t[1];pb(this._ids,this._dists,0,f-1);const mn=new Uint32Array(f);let on=0;for(let Rn=0,Fn=-1/0;Rn<f;Rn++){const zn=this._ids[Rn];this._dists[zn]>Fn&&(mn[on++]=zn,Fn=this._dists[zn])}return this.hull=mn.subarray(0,on),this.triangles=new Uint32Array(0),void(this.halfedges=new Uint32Array(0))}if(A2(Le,ze,nt,it,st,pt)){const mn=se,on=nt,Rn=it;se=le,nt=st,it=pt,le=mn,st=on,pt=Rn}const dt=function(mn,on,Rn,Fn,zn,Vn){const Qn=Rn-mn,pr=Fn-on,Pr=zn-mn,Ar=Vn-on,Jr=Qn*Qn+pr*pr,gi=Pr*Pr+Ar*Ar,vi=.5/(Qn*Ar-pr*Pr);return{x:mn+(Ar*Jr-pr*gi)*vi,y:on+(Qn*gi-Pr*Jr)*vi}}(Le,ze,nt,it,st,pt);this._cx=dt.x,this._cy=dt.y;for(let mn=0;mn<f;mn++)this._dists[mn]=mC(t[2*mn],t[2*mn+1],dt.x,dt.y);pb(this._ids,this._dists,0,f-1),this._hullStart=Q;let Qt=3;r[Q]=n[le]=se,r[se]=n[Q]=le,r[le]=n[se]=Q,i[Q]=0,i[se]=1,i[le]=2,s.fill(-1),s[this._hashKey(Le,ze)]=Q,s[this._hashKey(nt,it)]=se,s[this._hashKey(st,pt)]=le,this.trianglesLen=0,this._addTriangle(Q,se,le,-1,-1,-1);for(let mn,on,Rn=0;Rn<this._ids.length;Rn++){const Fn=this._ids[Rn],zn=t[2*Fn],Vn=t[2*Fn+1];if(Rn>0&&Math.abs(zn-mn)<=u4&&Math.abs(Vn-on)<=u4||(mn=zn,on=Vn,Fn===Q||Fn===se||Fn===le))continue;let Qn=0;for(let gi=0,vi=this._hashKey(zn,Vn);gi<this._hashSize&&((Qn=s[(vi+gi)%this._hashSize])===-1||Qn===r[Qn]);gi++);let pr,Pr=Qn=n[Qn];for(;pr=r[Pr],!A2(zn,Vn,t[2*Pr],t[2*Pr+1],t[2*pr],t[2*pr+1]);)if((Pr=pr)===Qn){Pr=-1;break}if(Pr===-1)continue;let Ar=this._addTriangle(Pr,Fn,r[Pr],-1,-1,i[Pr]);i[Fn]=this._legalize(Ar+2),i[Pr]=Ar,Qt++;let Jr=r[Pr];for(;pr=r[Jr],A2(zn,Vn,t[2*Jr],t[2*Jr+1],t[2*pr],t[2*pr+1]);)Ar=this._addTriangle(Jr,Fn,pr,i[Fn],-1,i[Jr]),i[Fn]=this._legalize(Ar+2),r[Jr]=Jr,Qt--,Jr=pr;if(Pr===Qn)for(;A2(zn,Vn,t[2*(pr=n[Pr])],t[2*pr+1],t[2*Pr],t[2*Pr+1]);)Ar=this._addTriangle(pr,Fn,Pr,-1,i[Pr],i[pr]),this._legalize(Ar+2),i[pr]=Ar,r[Pr]=Pr,Qt--,Pr=pr;this._hullStart=n[Fn]=Pr,r[Pr]=n[Jr]=Fn,r[Fn]=Jr,s[this._hashKey(zn,Vn)]=Fn,s[this._hashKey(t[2*Pr],t[2*Pr+1])]=Pr}this.hull=new Uint32Array(Qt);for(let mn=0,on=this._hullStart;mn<Qt;mn++)this.hull[mn]=on,on=r[on];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(t,n){return Math.floor(function(r,i){const s=r/(Math.abs(r)+Math.abs(i));return(i>0?3-s:1+s)/4}(t-this._cx,n-this._cy)*this._hashSize)%this._hashSize}_legalize(t){const{_triangles:n,_halfedges:r,coords:i}=this;let s=0,f=0;for(;;){const m=r[t],x=t-t%3;if(f=x+(t+2)%3,m===-1){if(s===0)break;t=C2[--s];continue}const O=m-m%3,T=x+(t+1)%3,M=O+(m+2)%3,q=n[f],Q=n[t],se=n[T],le=n[M];if(f6(i[2*q],i[2*q+1],i[2*Q],i[2*Q+1],i[2*se],i[2*se+1],i[2*le],i[2*le+1])){n[t]=le,n[m]=q;const Fe=r[M];if(Fe===-1){let ze=this._hullStart;do{if(this._hullTri[ze]===M){this._hullTri[ze]=t;break}ze=this._hullPrev[ze]}while(ze!==this._hullStart)}this._link(t,Fe),this._link(m,r[f]),this._link(f,M);const Le=O+(m+1)%3;s<C2.length&&(C2[s++]=Le)}else{if(s===0)break;t=C2[--s]}}return f}_link(t,n){this._halfedges[t]=n,n!==-1&&(this._halfedges[n]=t)}_addTriangle(t,n,r,i,s,f){const m=this.trianglesLen;return this._triangles[m]=t,this._triangles[m+1]=n,this._triangles[m+2]=r,this._link(m,i),this._link(m+1,s),this._link(m+2,f),this.trianglesLen+=3,m}}function mC(e,t,n,r){const i=e-n,s=t-r;return i*i+s*s}function gC(e,t,n,r,i,s){const f=(r-t)*(i-e),m=(n-e)*(s-t);return Math.abs(f-m)>=33306690738754716e-32*Math.abs(f+m)?f-m:0}function A2(e,t,n,r,i,s){return(gC(i,s,e,t,n,r)||gC(e,t,n,r,i,s)||gC(n,r,i,s,e,t))<0}function f6(e,t,n,r,i,s,f,m){const x=e-f,O=t-m,T=n-f,M=r-m,q=i-f,Q=s-m,se=T*T+M*M,le=q*q+Q*Q;return x*(M*le-se*Q)-O*(T*le-se*q)+(x*x+O*O)*(T*Q-M*q)<0}function h6(e,t,n,r,i,s){const f=n-e,m=r-t,x=i-e,O=s-t,T=f*f+m*m,M=x*x+O*O,q=.5/(f*O-m*x),Q=(O*T-m*M)*q,se=(f*M-x*T)*q;return Q*Q+se*se}function pb(e,t,n,r){if(r-n<=20)for(let i=n+1;i<=r;i++){const s=e[i],f=t[s];let m=i-1;for(;m>=n&&t[e[m]]>f;)e[m+1]=e[m--];e[m+1]=s}else{let i=n+1,s=r;p1(e,n+r>>1,i),t[e[n]]>t[e[r]]&&p1(e,n,r),t[e[i]]>t[e[r]]&&p1(e,i,r),t[e[n]]>t[e[i]]&&p1(e,n,i);const f=e[i],m=t[f];for(;;){do i++;while(t[e[i]]<m);do s--;while(t[e[s]]>m);if(s<i)break;p1(e,i,s)}e[n+1]=e[s],e[s]=f,r-i+1>=s-n?(pb(e,t,i,r),pb(e,t,n,s-1)):(pb(e,t,n,s-1),pb(e,t,i,r))}}function p1(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}const c4=1e-6;class py{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(t,n){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(t,n){this._+=`L${this._x1=+t},${this._y1=+n}`}arc(t,n,r){const i=(t=+t)+(r=+r),s=n=+n;if(r<0)throw new Error("negative radius");this._x1===null?this._+=`M${i},${s}`:(Math.abs(this._x1-i)>c4||Math.abs(this._y1-s)>c4)&&(this._+="L"+i+","+s),r&&(this._+=`A${r},${r},0,1,1,${t-r},${n}A${r},${r},0,1,1,${this._x1=i},${this._y1=s}`)}rect(t,n,r,i){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}h${+r}v${+i}h${-r}Z`}value(){return this._||null}}class vC{constructor(){this._=[]}moveTo(t,n){this._.push([t,n])}closePath(){this._.push(this._[0].slice())}lineTo(t,n){this._.push([t,n])}value(){return this._.length?this._:null}}class d6{constructor(t,[n,r,i,s]=[0,0,960,500]){if(!((i=+i)>=(n=+n)&&(s=+s)>=(r=+r)))throw new Error("invalid bounds");this.delaunay=t,this._circumcenters=new Float64Array(2*t.points.length),this.vectors=new Float64Array(2*t.points.length),this.xmax=i,this.xmin=n,this.ymax=s,this.ymin=r,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:t,hull:n,triangles:r},vectors:i}=this,s=this.circumcenters=this._circumcenters.subarray(0,r.length/3*2);for(let Q,se,le=0,Fe=0,Le=r.length;le<Le;le+=3,Fe+=2){const ze=2*r[le],nt=2*r[le+1],it=2*r[le+2],ut=t[ze],st=t[ze+1],pt=t[nt],dt=t[nt+1],Qt=t[it],mn=t[it+1],on=pt-ut,Rn=dt-st,Fn=Qt-ut,zn=mn-st,Vn=on*on+Rn*Rn,Qn=Fn*Fn+zn*zn,pr=2*(on*zn-Rn*Fn);if(pr)if(Math.abs(pr)<1e-8)Q=(ut+Qt)/2,se=(st+mn)/2;else{const Pr=1/pr;Q=ut+(zn*Vn-Rn*Qn)*Pr,se=st+(on*Qn-Fn*Vn)*Pr}else Q=(ut+Qt)/2-1e8*zn,se=(st+mn)/2+1e8*Fn;s[Fe]=Q,s[Fe+1]=se}let f,m,x,O=n[n.length-1],T=4*O,M=t[2*O],q=t[2*O+1];i.fill(0);for(let Q=0;Q<n.length;++Q)f=T,m=M,x=q,T=4*(O=n[Q]),M=t[2*O],q=t[2*O+1],i[f+2]=i[T]=x-q,i[f+3]=i[T+1]=M-m}render(t){const n=t==null?t=new py:void 0,{delaunay:{halfedges:r,inedges:i,hull:s},circumcenters:f,vectors:m}=this;if(s.length<=1)return null;for(let T=0,M=r.length;T<M;++T){const q=r[T];if(q<T)continue;const Q=2*Math.floor(T/3),se=2*Math.floor(q/3),le=f[Q],Fe=f[Q+1],Le=f[se],ze=f[se+1];this._renderSegment(le,Fe,Le,ze,t)}let x,O=s[s.length-1];for(let T=0;T<s.length;++T){x=O,O=s[T];const M=2*Math.floor(i[O]/3),q=f[M],Q=f[M+1],se=4*x,le=this._project(q,Q,m[se+2],m[se+3]);le&&this._renderSegment(q,Q,le[0],le[1],t)}return n&&n.value()}renderBounds(t){const n=t==null?t=new py:void 0;return t.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),n&&n.value()}renderCell(t,n){const r=n==null?n=new py:void 0,i=this._clip(t);if(i===null||!i.length)return;n.moveTo(i[0],i[1]);let s=i.length;for(;i[0]===i[s-2]&&i[1]===i[s-1]&&s>1;)s-=2;for(let f=2;f<s;f+=2)i[f]===i[f-2]&&i[f+1]===i[f-1]||n.lineTo(i[f],i[f+1]);return n.closePath(),r&&r.value()}*cellPolygons(){const{delaunay:{points:t}}=this;for(let n=0,r=t.length/2;n<r;++n){const i=this.cellPolygon(n);i&&(i.index=n,yield i)}}cellPolygon(t){const n=new vC;return this.renderCell(t,n),n.value()}_renderSegment(t,n,r,i,s){let f;const m=this._regioncode(t,n),x=this._regioncode(r,i);m===0&&x===0?(s.moveTo(t,n),s.lineTo(r,i)):(f=this._clipSegment(t,n,r,i,m,x))&&(s.moveTo(f[0],f[1]),s.lineTo(f[2],f[3]))}contains(t,n,r){return(n=+n)==n&&(r=+r)==r&&this.delaunay._step(t,n,r)===t}*neighbors(t){const n=this._clip(t);if(n)for(const r of this.delaunay.neighbors(t)){const i=this._clip(r);if(i){e:for(let s=0,f=n.length;s<f;s+=2)for(let m=0,x=i.length;m<x;m+=2)if(n[s]==i[m]&&n[s+1]==i[m+1]&&n[(s+2)%f]==i[(m+x-2)%x]&&n[(s+3)%f]==i[(m+x-1)%x]){yield r;break e}}}}_cell(t){const{circumcenters:n,delaunay:{inedges:r,halfedges:i,triangles:s}}=this,f=r[t];if(f===-1)return null;const m=[];let x=f;do{const O=Math.floor(x/3);if(m.push(n[2*O],n[2*O+1]),s[x=x%3==2?x-2:x+1]!==t)break;x=i[x]}while(x!==f&&x!==-1);return m}_clip(t){if(t===0&&this.delaunay.hull.length===1)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const n=this._cell(t);if(n===null)return null;const{vectors:r}=this,i=4*t;return r[i]||r[i+1]?this._clipInfinite(t,n,r[i],r[i+1],r[i+2],r[i+3]):this._clipFinite(t,n)}_clipFinite(t,n){const r=n.length;let i,s,f,m,x,O=null,T=n[r-2],M=n[r-1],q=this._regioncode(T,M);for(let Q=0;Q<r;Q+=2)if(i=T,s=M,T=n[Q],M=n[Q+1],f=q,q=this._regioncode(T,M),f===0&&q===0)m=x,x=0,O?O.push(T,M):O=[T,M];else{let se,le,Fe,Le,ze;if(f===0){if((se=this._clipSegment(i,s,T,M,f,q))===null)continue;[le,Fe,Le,ze]=se}else{if((se=this._clipSegment(T,M,i,s,q,f))===null)continue;[Le,ze,le,Fe]=se,m=x,x=this._edgecode(le,Fe),m&&x&&this._edge(t,m,x,O,O.length),O?O.push(le,Fe):O=[le,Fe]}m=x,x=this._edgecode(Le,ze),m&&x&&this._edge(t,m,x,O,O.length),O?O.push(Le,ze):O=[Le,ze]}if(O)m=x,x=this._edgecode(O[0],O[1]),m&&x&&this._edge(t,m,x,O,O.length);else if(this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return O}_clipSegment(t,n,r,i,s,f){for(;;){if(s===0&&f===0)return[t,n,r,i];if(s&f)return null;let m,x,O=s||f;8&O?(m=t+(r-t)*(this.ymax-n)/(i-n),x=this.ymax):4&O?(m=t+(r-t)*(this.ymin-n)/(i-n),x=this.ymin):2&O?(x=n+(i-n)*(this.xmax-t)/(r-t),m=this.xmax):(x=n+(i-n)*(this.xmin-t)/(r-t),m=this.xmin),s?(t=m,n=x,s=this._regioncode(t,n)):(r=m,i=x,f=this._regioncode(r,i))}}_clipInfinite(t,n,r,i,s,f){let m,x=Array.from(n);if((m=this._project(x[0],x[1],r,i))&&x.unshift(m[0],m[1]),(m=this._project(x[x.length-2],x[x.length-1],s,f))&&x.push(m[0],m[1]),x=this._clipFinite(t,x))for(let O,T=0,M=x.length,q=this._edgecode(x[M-2],x[M-1]);T<M;T+=2)O=q,q=this._edgecode(x[T],x[T+1]),O&&q&&(T=this._edge(t,O,q,x,T),M=x.length);else this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(x=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return x}_edge(t,n,r,i,s){for(;n!==r;){let f,m;switch(n){case 5:n=4;continue;case 4:n=6,f=this.xmax,m=this.ymin;break;case 6:n=2;continue;case 2:n=10,f=this.xmax,m=this.ymax;break;case 10:n=8;continue;case 8:n=9,f=this.xmin,m=this.ymax;break;case 9:n=1;continue;case 1:n=5,f=this.xmin,m=this.ymin}i[s]===f&&i[s+1]===m||!this.contains(t,f,m)||(i.splice(s,0,f,m),s+=2)}if(i.length>4)for(let f=0;f<i.length;f+=2){const m=(f+2)%i.length,x=(f+4)%i.length;(i[f]===i[m]&&i[m]===i[x]||i[f+1]===i[m+1]&&i[m+1]===i[x+1])&&(i.splice(m,2),f-=2)}return s}_project(t,n,r,i){let s,f,m,x=1/0;if(i<0){if(n<=this.ymin)return null;(s=(this.ymin-n)/i)<x&&(m=this.ymin,f=t+(x=s)*r)}else if(i>0){if(n>=this.ymax)return null;(s=(this.ymax-n)/i)<x&&(m=this.ymax,f=t+(x=s)*r)}if(r>0){if(t>=this.xmax)return null;(s=(this.xmax-t)/r)<x&&(f=this.xmax,m=n+(x=s)*i)}else if(r<0){if(t<=this.xmin)return null;(s=(this.xmin-t)/r)<x&&(f=this.xmin,m=n+(x=s)*i)}return[f,m]}_edgecode(t,n){return(t===this.xmin?1:t===this.xmax?2:0)|(n===this.ymin?4:n===this.ymax?8:0)}_regioncode(t,n){return(t<this.xmin?1:t>this.xmax?2:0)|(n<this.ymin?4:n>this.ymax?8:0)}}const p6=2*Math.PI,mb=Math.pow;function m6(e,t,n){return[e+Math.sin(e+t)*n,t+Math.cos(e-t)*n]}class yC{static from(t,n=function(s){return s[0]},r=function(s){return s[1]},i){return new yC("length"in t?function(s,f,m,x){const O=s.length,T=new Float64Array(2*O);for(let M=0;M<O;++M){const q=s[M];T[2*M]=f.call(x,q,M,s),T[2*M+1]=m.call(x,q,M,s)}return T}(t,n,r,i):Float64Array.from(function*(s,f,m,x){let O=0;for(const T of s)yield f.call(x,T,O,s),yield m.call(x,T,O,s),++O}(t,n,r,i)))}constructor(t){this._delaunator=new O2(t),this.inedges=new Int32Array(t.length/2),this._hullIndex=new Int32Array(t.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const t=this._delaunator,n=this.points;if(t.hull&&t.hull.length>2&&function(x){const{triangles:O,coords:T}=x;for(let M=0;M<O.length;M+=3){const q=2*O[M],Q=2*O[M+1],se=2*O[M+2];if((T[se]-T[q])*(T[Q+1]-T[q+1])-(T[Q]-T[q])*(T[se+1]-T[q+1])>1e-10)return!1}return!0}(t)){this.collinear=Int32Array.from({length:n.length/2},(q,Q)=>Q).sort((q,Q)=>n[2*q]-n[2*Q]||n[2*q+1]-n[2*Q+1]);const x=this.collinear[0],O=this.collinear[this.collinear.length-1],T=[n[2*x],n[2*x+1],n[2*O],n[2*O+1]],M=1e-8*Math.hypot(T[3]-T[1],T[2]-T[0]);for(let q=0,Q=n.length/2;q<Q;++q){const se=m6(n[2*q],n[2*q+1],M);n[2*q]=se[0],n[2*q+1]=se[1]}this._delaunator=new O2(n)}else delete this.collinear;const r=this.halfedges=this._delaunator.halfedges,i=this.hull=this._delaunator.hull,s=this.triangles=this._delaunator.triangles,f=this.inedges.fill(-1),m=this._hullIndex.fill(-1);for(let x=0,O=r.length;x<O;++x){const T=s[x%3==2?x-2:x+1];r[x]!==-1&&f[T]!==-1||(f[T]=x)}for(let x=0,O=i.length;x<O;++x)m[i[x]]=x;i.length<=2&&i.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=i[0],this.triangles[1]=i[1],this.triangles[2]=i[1],f[i[0]]=1,i.length===2&&(f[i[1]]=0))}voronoi(t){return new d6(this,t)}*neighbors(t){const{inedges:n,hull:r,_hullIndex:i,halfedges:s,triangles:f,collinear:m}=this;if(m){const M=m.indexOf(t);return M>0&&(yield m[M-1]),void(M<m.length-1&&(yield m[M+1]))}const x=n[t];if(x===-1)return;let O=x,T=-1;do{if(yield T=f[O],f[O=O%3==2?O-2:O+1]!==t)return;if((O=s[O])===-1){const M=r[(i[t]+1)%r.length];return void(M!==T&&(yield M))}}while(O!==x)}find(t,n,r=0){if((t=+t)!=t||(n=+n)!=n)return-1;const i=r;let s;for(;(s=this._step(r,t,n))>=0&&s!==r&&s!==i;)r=s;return s}_step(t,n,r){const{inedges:i,hull:s,_hullIndex:f,halfedges:m,triangles:x,points:O}=this;if(i[t]===-1||!O.length)return(t+1)%(O.length>>1);let T=t,M=mb(n-O[2*t],2)+mb(r-O[2*t+1],2);const q=i[t];let Q=q;do{let se=x[Q];const le=mb(n-O[2*se],2)+mb(r-O[2*se+1],2);if(le<M&&(M=le,T=se),x[Q=Q%3==2?Q-2:Q+1]!==t)break;if((Q=m[Q])===-1){if((Q=s[(f[t]+1)%s.length])!==se&&mb(n-O[2*Q],2)+mb(r-O[2*Q+1],2)<M)return Q;break}}while(Q!==q);return T}render(t){const n=t==null?t=new py:void 0,{points:r,halfedges:i,triangles:s}=this;for(let f=0,m=i.length;f<m;++f){const x=i[f];if(x<f)continue;const O=2*s[f],T=2*s[x];t.moveTo(r[O],r[O+1]),t.lineTo(r[T],r[T+1])}return this.renderHull(t),n&&n.value()}renderPoints(t,n=2){const r=t==null?t=new py:void 0,{points:i}=this;for(let s=0,f=i.length;s<f;s+=2){const m=i[s],x=i[s+1];t.moveTo(m+n,x),t.arc(m,x,n,0,p6)}return r&&r.value()}renderHull(t){const n=t==null?t=new py:void 0,{hull:r,points:i}=this,s=2*r[0],f=r.length;t.moveTo(i[s],i[s+1]);for(let m=1;m<f;++m){const x=2*r[m];t.lineTo(i[x],i[x+1])}return t.closePath(),n&&n.value()}hullPolygon(){const t=new vC;return this.renderHull(t),t.value()}renderTriangle(t,n){const r=n==null?n=new py:void 0,{points:i,triangles:s}=this,f=2*s[t*=3],m=2*s[t+1],x=2*s[t+2];return n.moveTo(i[f],i[f+1]),n.lineTo(i[m],i[m+1]),n.lineTo(i[x],i[x+1]),n.closePath(),r&&r.value()}*trianglePolygons(){const{triangles:t}=this;for(let n=0,r=t.length/3;n<r;++n)yield this.trianglePolygon(n)}trianglePolygon(t){const n=new vC;return this.renderTriangle(t,n),n.value()}}function bC(e){Ot.call(this,null,e)}bC.Definition={type:"Voronoi",metadata:{modifies:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"size",type:"number",array:!0,length:2},{name:"extent",type:"array",array:!0,length:2,default:[[-1e5,-1e5],[1e5,1e5]],content:{type:"number",array:!0,length:2}},{name:"as",type:"string",default:"path"}]};const g6=[-1e5,-1e5,1e5,1e5];function v6(e){const t=e[0][0],n=e[0][1];let r=e.length-1;for(;e[r][0]===t&&e[r][1]===n;--r);return"M"+e.slice(0,r+1).join("L")+"Z"}Object(xe.z)(bC,Ot,{transform(e,t){const n=e.as||"path",r=t.source;if(!r||!r.length)return t;let i=e.size;i=i?[0,0,i[0],i[1]]:(i=e.extent)?[i[0][0],i[0][1],i[1][0],i[1][1]]:g6;const s=this.value=yC.from(r,e.x,e.y).voronoi(i);for(let f=0,m=r.length;f<m;++f){const x=s.cellPolygon(f);r[f][n]=x?v6(x):null}return t.reflow(e.modified()).modifies(n)}});var xC=Math.PI/180,m1=64,_2=2048;function y6(){var e,t,n,r,i,s,f,m=[256,256],x=l4,O=[],T=Math.random,M={};function q(Q,se,le){for(var Fe,Le,ze,nt=se.x,it=se.y,ut=Math.sqrt(m[0]*m[0]+m[1]*m[1]),st=x(m),pt=T()<.5?1:-1,dt=-pt;(Fe=st(dt+=pt))&&(Le=~~Fe[0],ze=~~Fe[1],!(Math.min(Math.abs(Le),Math.abs(ze))>=ut));)if(se.x=nt+Le,se.y=it+ze,!(se.x+se.x0<0||se.y+se.y0<0||se.x+se.x1>m[0]||se.y+se.y1>m[1])&&(!le||!x6(se,Q,m[0]))&&(!le||k6(se,le))){for(var Qt,mn=se.sprite,on=se.width>>5,Rn=m[0]>>5,Fn=se.x-(on<<4),zn=127&Fn,Vn=32-zn,Qn=se.y1-se.y0,pr=(se.y+se.y0)*Rn+(Fn>>5),Pr=0;Pr<Qn;Pr++){Qt=0;for(var Ar=0;Ar<=on;Ar++)Q[pr+Ar]|=Qt<<Vn|(Ar<on?(Qt=mn[Pr*on+Ar])>>>zn:0);pr+=Rn}return se.sprite=null,!0}return!1}return M.layout=function(){for(var Q=function(ut){ut.width=ut.height=1;var st=Math.sqrt(ut.getContext("2d").getImageData(0,0,1,1).data.length>>2);ut.width=(m1<<5)/st,ut.height=_2/st;var pt=ut.getContext("2d");return pt.fillStyle=pt.strokeStyle="red",pt.textAlign="center",{context:pt,ratio:st}}(qs()),se=function(ut){for(var st=[],pt=-1;++pt<ut;)st[pt]=0;return st}((m[0]>>5)*m[1]),le=null,Fe=O.length,Le=-1,ze=[],nt=O.map(ut=>({text:e(ut),font:t(ut),style:r(ut),weight:i(ut),rotate:s(ut),size:~~(n(ut)+1e-14),padding:f(ut),xoff:0,yoff:0,x1:0,y1:0,x0:0,y0:0,hasText:!1,sprite:null,datum:ut})).sort((ut,st)=>st.size-ut.size);++Le<Fe;){var it=nt[Le];it.x=m[0]*(T()+.5)>>1,it.y=m[1]*(T()+.5)>>1,b6(Q,it,nt,Le),it.hasText&&q(se,it,le)&&(ze.push(it),le?w6(le,it):le=[{x:it.x+it.x0,y:it.y+it.y0},{x:it.x+it.x1,y:it.y+it.y1}],it.x-=m[0]>>1,it.y-=m[1]>>1)}return ze},M.words=function(Q){return arguments.length?(O=Q,M):O},M.size=function(Q){return arguments.length?(m=[+Q[0],+Q[1]],M):m},M.font=function(Q){return arguments.length?(t=my(Q),M):t},M.fontStyle=function(Q){return arguments.length?(r=my(Q),M):r},M.fontWeight=function(Q){return arguments.length?(i=my(Q),M):i},M.rotate=function(Q){return arguments.length?(s=my(Q),M):s},M.text=function(Q){return arguments.length?(e=my(Q),M):e},M.spiral=function(Q){return arguments.length?(x=E6[Q]||Q,M):x},M.fontSize=function(Q){return arguments.length?(n=my(Q),M):n},M.padding=function(Q){return arguments.length?(f=my(Q),M):f},M.random=function(Q){return arguments.length?(T=Q,M):T},M}function b6(e,t,n,r){if(!t.sprite){var i=e.context,s=e.ratio;i.clearRect(0,0,(m1<<5)/s,_2/s);var f,m,x,O,T,M=0,q=0,Q=0,se=n.length;for(--r;++r<se;){if(t=n[r],i.save(),i.font=t.style+" "+t.weight+" "+~~((t.size+1)/s)+"px "+t.font,f=i.measureText(t.text+"m").width*s,x=t.size<<1,t.rotate){var le=Math.sin(t.rotate*xC),Fe=Math.cos(t.rotate*xC),Le=f*Fe,ze=f*le,nt=x*Fe,it=x*le;f=Math.max(Math.abs(Le+it),Math.abs(Le-it))+31>>5<<5,x=~~Math.max(Math.abs(ze+nt),Math.abs(ze-nt))}else f=f+31>>5<<5;if(x>Q&&(Q=x),M+f>=m1<<5&&(M=0,q+=Q,Q=0),q+x>=_2)break;i.translate((M+(f>>1))/s,(q+(x>>1))/s),t.rotate&&i.rotate(t.rotate*xC),i.fillText(t.text,0,0),t.padding&&(i.lineWidth=2*t.padding,i.strokeText(t.text,0,0)),i.restore(),t.width=f,t.height=x,t.xoff=M,t.yoff=q,t.x1=f>>1,t.y1=x>>1,t.x0=-t.x1,t.y0=-t.y1,t.hasText=!0,M+=f}for(var ut=i.getImageData(0,0,(m1<<5)/s,_2/s).data,st=[];--r>=0;)if((t=n[r]).hasText){for(m=(f=t.width)>>5,x=t.y1-t.y0,O=0;O<x*m;O++)st[O]=0;if((M=t.xoff)==null)return;q=t.yoff;var pt=0,dt=-1;for(T=0;T<x;T++){for(O=0;O<f;O++){var Qt=m*T+(O>>5),mn=ut[(q+T)*(m1<<5)+(M+O)<<2]?1<<31-O%32:0;st[Qt]|=mn,pt|=mn}pt?dt=T:(t.y0++,x--,T--,q++)}t.y1=t.y0+dt,t.sprite=st.slice(0,(t.y1-t.y0)*m)}}}function x6(e,t,n){n>>=5;for(var r,i=e.sprite,s=e.width>>5,f=e.x-(s<<4),m=127&f,x=32-m,O=e.y1-e.y0,T=(e.y+e.y0)*n+(f>>5),M=0;M<O;M++){r=0;for(var q=0;q<=s;q++)if((r<<x|(q<s?(r=i[M*s+q])>>>m:0))&t[T+q])return!0;T+=n}return!1}function w6(e,t){var n=e[0],r=e[1];t.x+t.x0<n.x&&(n.x=t.x+t.x0),t.y+t.y0<n.y&&(n.y=t.y+t.y0),t.x+t.x1>r.x&&(r.x=t.x+t.x1),t.y+t.y1>r.y&&(r.y=t.y+t.y1)}function k6(e,t){return e.x+e.x1>t[0].x&&e.x+e.x0<t[1].x&&e.y+e.y1>t[0].y&&e.y+e.y0<t[1].y}function l4(e){var t=e[0]/e[1];return function(n){return[t*(n*=.1)*Math.cos(n),n*Math.sin(n)]}}function my(e){return typeof e=="function"?e:function(){return e}}var E6={archimedean:l4,rectangular:function(e){var t=4*e[0]/e[1],n=0,r=0;return function(i){var s=i<0?-1:1;switch(Math.sqrt(1+4*s*i)-s&3){case 0:n+=t;break;case 1:r+=4;break;case 2:n-=t;break;default:r-=4}return[n,r]}}};const f4=["x","y","font","fontSize","fontStyle","fontWeight","angle"],C6=["text","font","rotate","fontSize","fontStyle","fontWeight"];function wC(e){Ot.call(this,y6(),e)}wC.Definition={type:"Wordcloud",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2},{name:"font",type:"string",expr:!0,default:"sans-serif"},{name:"fontStyle",type:"string",expr:!0,default:"normal"},{name:"fontWeight",type:"string",expr:!0,default:"normal"},{name:"fontSize",type:"number",expr:!0,default:14},{name:"fontSizeRange",type:"number",array:"nullable",default:[10,50]},{name:"rotate",type:"number",expr:!0,default:0},{name:"text",type:"field"},{name:"spiral",type:"string",values:["archimedean","rectangular"]},{name:"padding",type:"number",expr:!0},{name:"as",type:"string",array:!0,length:7,default:f4}]},Object(xe.z)(wC,Ot,{transform(e,t){!e.size||e.size[0]&&e.size[1]||Object(xe.o)("Wordcloud size dimensions must be non-zero.");const n=e.modified();if(!(n||t.changed(t.ADD_REM)||C6.some(function(Q){const se=e[Q];return Object(xe.E)(se)&&t.modified(se.fields)})))return;const r=t.materialize(t.SOURCE).source,i=this.value,s=e.as||f4;let f,m=e.fontSize||14;if(Object(xe.E)(m)?f=e.fontSizeRange:m=Object(xe.m)(m),f){const Q=m,se=Fa("sqrt")().domain(Object(xe.q)(r,Q)).range(f);m=le=>se(Q(le))}r.forEach(Q=>{Q[s[0]]=NaN,Q[s[1]]=NaN,Q[s[3]]=0});const x=i.words(r).text(e.text).size(e.size||[500,500]).padding(e.padding||1).spiral(e.spiral||"archimedean").rotate(e.rotate||0).font(e.font||"sans-serif").fontStyle(e.fontStyle||"normal").fontWeight(e.fontWeight||"normal").fontSize(m).random(Bn).layout(),O=i.size(),T=O[0]>>1,M=O[1]>>1,q=x.length;for(let Q,se,le=0;le<q;++le)(se=(Q=x[le]).datum)[s[0]]=Q.x+T,se[s[1]]=Q.y+M,se[s[2]]=Q.font,se[s[3]]=Q.size,se[s[4]]=Q.style,se[s[5]]=Q.weight,se[s[6]]=Q.rotate;return t.reflow(n).modifies(s)}});var O6=function(e,t){return Array.from(t,n=>e[n])};const A6=e=>new Uint8Array(e),_6=e=>new Uint16Array(e),g1=e=>new Uint32Array(e);function S2(e,t,n){const r=(t<257?A6:t<65537?_6:g1)(e);return n&&r.set(n),r}function h4(e,t,n){const r=1<<t;return{one:r,zero:~r,range:n.slice(),bisect:e.bisect,index:e.index,size:e.size,onAdd(i,s){const f=this.bisect(this.range,i.value),m=i.index,x=f[0],O=f[1],T=m.length;let M;for(M=0;M<x;++M)s[m[M]]|=r;for(M=O;M<T;++M)s[m[M]]|=r;return this}}}function d4(){let e=g1(0),t=[],n=0;return{insert:function(r,i,s){if(!i.length)return[];const f=n,m=i.length,x=g1(m);let O,T,M,q=Array(m);for(M=0;M<m;++M)q[M]=r(i[M]),x[M]=M;if(q=function(Q,se){return Q.sort.call(se,(le,Fe)=>{const Le=Q[le],ze=Q[Fe];return Le<ze?-1:Le>ze?1:0}),O6(Q,se)}(q,x),f)O=t,T=e,t=Array(f+m),e=g1(f+m),function(Q,se,le,Fe,Le,ze,nt,it,ut){let st,pt=0,dt=0;for(st=0;pt<Fe&&dt<nt;++st)se[pt]<Le[dt]?(it[st]=se[pt],ut[st]=le[pt++]):(it[st]=Le[dt],ut[st]=ze[dt++]+Q);for(;pt<Fe;++pt,++st)it[st]=se[pt],ut[st]=le[pt];for(;dt<nt;++dt,++st)it[st]=Le[dt],ut[st]=ze[dt]+Q}(s,O,T,f,q,x,m,t,e);else{if(s>0)for(M=0;M<m;++M)x[M]+=s;t=q,e=x}return n=f+m,{index:x,value:q}},remove:function(r,i){const s=n;let f,m,x;for(m=0;!i[e[m]]&&m<s;++m);for(x=m;m<s;++m)i[f=e[m]]||(e[x]=f,t[x]=t[m],++x);n=s-r},bisect:function(r,i){let s;return i?s=i.length:(i=t,s=n),[ls(i,r[0],0,s),_o(i,r[1],0,s)]},reindex:function(r){for(let i=0,s=n;i<s;++i)e[i]=r[e[i]]},index:()=>e,size:()=>n}}function kC(e){Ot.call(this,function(){let t=8,n=[],r=g1(0),i=S2(0,t),s=S2(0,t);return{data:()=>n,seen:()=>r=function(f,m,x){return f.length>=m?f:((x=x||new f.constructor(m)).set(f),x)}(r,n.length),add(f){for(let m,x=0,O=n.length,T=f.length;x<T;++x)(m=f[x])._index=O++,n.push(m)},remove(f,m){const x=n.length,O=Array(x-f),T=n;let M,q,Q;for(q=0;!m[q]&&q<x;++q)O[q]=n[q],T[q]=q;for(Q=q;q<x;++q)M=n[q],m[q]?T[q]=-1:(T[q]=Q,i[Q]=i[q],s[Q]=s[q],O[Q]=M,M._index=Q++),i[q]=0;return n=O,T},size:()=>n.length,curr:()=>i,prev:()=>s,reset:f=>s[f]=i[f],all:()=>t<257?255:t<65537?65535:4294967295,set(f,m){i[f]|=m},clear(f,m){i[f]&=~m},resize(f,m){(f>i.length||m>t)&&(t=Math.max(m,t),i=S2(f,t,i),s=S2(f,t))}}}(),e),this._indices=null,this._dims=null}function EC(e){Ot.call(this,null,e)}kC.Definition={type:"CrossFilter",metadata:{},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"query",type:"array",array:!0,required:!0,content:{type:"number",array:!0,length:2}}]},Object(xe.z)(kC,Ot,{transform(e,t){return this._dims?e.modified("fields")||e.fields.some(n=>t.modified(n.fields))?this.reinit(e,t):this.eval(e,t):this.init(e,t)},init(e,t){const n=e.fields,r=e.query,i=this._indices={},s=this._dims=[],f=r.length;let m,x,O=0;for(;O<f;++O)x=i[m=n[O].fname]||(i[m]=d4()),s.push(h4(x,O,r[O]));return this.eval(e,t)},reinit(e,t){const n=t.materialize().fork(),r=e.fields,i=e.query,s=this._indices,f=this._dims,m=this.value,x=m.curr(),O=m.prev(),T=m.all(),M=n.rem=n.add,q=n.mod,Q=i.length,se={};let le,Fe,Le,ze,nt,it,ut,st,pt;if(O.set(x),t.rem.length&&(nt=this.remove(e,t,n)),t.add.length&&m.add(t.add),t.mod.length)for(it={},ut=0,st=(ze=t.mod).length;ut<st;++ut)it[ze[ut]._index]=1;for(ut=0;ut<Q;++ut)pt=r[ut],(!f[ut]||e.modified("fields",ut)||t.modified(pt.fields))&&((le=se[Le=pt.fname])||(s[Le]=Fe=d4(),se[Le]=le=Fe.insert(pt,t.source,0)),f[ut]=h4(Fe,ut,i[ut]).onAdd(le,x));for(ut=0,st=m.data().length;ut<st;++ut)nt[ut]||(O[ut]!==x[ut]?M.push(ut):it[ut]&&x[ut]!==T&&q.push(ut));return m.mask=(1<<Q)-1,n},eval(e,t){const n=t.materialize().fork(),r=this._dims.length;let i=0;return t.rem.length&&(this.remove(e,t,n),i|=(1<<r)-1),e.modified("query")&&!e.modified("fields")&&(i|=this.update(e,t,n)),t.add.length&&(this.insert(e,t,n),i|=(1<<r)-1),t.mod.length&&(this.modify(t,n),i|=(1<<r)-1),this.value.mask=i,n},insert(e,t,n){const r=t.add,i=this.value,s=this._dims,f=this._indices,m=e.fields,x={},O=n.add,T=i.size()+r.length,M=s.length;let q,Q,se,le=i.size();i.resize(T,M),i.add(r);const Fe=i.curr(),Le=i.prev(),ze=i.all();for(q=0;q<M;++q)se=x[Q=m[q].fname]||(x[Q]=f[Q].insert(m[q],r,le)),s[q].onAdd(se,Fe);for(;le<T;++le)Le[le]=ze,Fe[le]!==ze&&O.push(le)},modify(e,t){const n=t.mod,r=this.value,i=r.curr(),s=r.all(),f=e.mod;let m,x,O;for(m=0,x=f.length;m<x;++m)i[O=f[m]._index]!==s&&n.push(O)},remove(e,t,n){const r=this._indices,i=this.value,s=i.curr(),f=i.prev(),m=i.all(),x={},O=n.rem,T=t.rem;let M,q,Q,se;for(M=0,q=T.length;M<q;++M)x[Q=T[M]._index]=1,f[Q]=se=s[Q],s[Q]=m,se!==m&&O.push(Q);for(Q in r)r[Q].remove(q,x);return this.reindex(t,q,x),x},reindex(e,t,n){const r=this._indices,i=this.value;e.runAfter(()=>{const s=i.remove(t,n);for(const f in r)r[f].reindex(s)})},update(e,t,n){const r=this._dims,i=e.query,s=t.stamp,f=r.length;let m,x,O=0;for(n.filters=0,x=0;x<f;++x)e.modified("query",x)&&(m=x,++O);if(O===1)O=r[m].one,this.incrementOne(r[m],i[m],n.add,n.rem);else for(x=0,O=0;x<f;++x)e.modified("query",x)&&(O|=r[x].one,this.incrementAll(r[x],i[x],s,n.add),n.rem=n.add);return O},incrementAll(e,t,n,r){const i=this.value,s=i.seen(),f=i.curr(),m=i.prev(),x=e.index(),O=e.bisect(e.range),T=e.bisect(t),M=T[0],q=T[1],Q=O[0],se=O[1],le=e.one;let Fe,Le,ze;if(M<Q)for(Fe=M,Le=Math.min(Q,q);Fe<Le;++Fe)s[ze=x[Fe]]!==n&&(m[ze]=f[ze],s[ze]=n,r.push(ze)),f[ze]^=le;else if(M>Q)for(Fe=Q,Le=Math.min(M,se);Fe<Le;++Fe)s[ze=x[Fe]]!==n&&(m[ze]=f[ze],s[ze]=n,r.push(ze)),f[ze]^=le;if(q>se)for(Fe=Math.max(M,se),Le=q;Fe<Le;++Fe)s[ze=x[Fe]]!==n&&(m[ze]=f[ze],s[ze]=n,r.push(ze)),f[ze]^=le;else if(q<se)for(Fe=Math.max(Q,q),Le=se;Fe<Le;++Fe)s[ze=x[Fe]]!==n&&(m[ze]=f[ze],s[ze]=n,r.push(ze)),f[ze]^=le;e.range=t.slice()},incrementOne(e,t,n,r){const i=this.value.curr(),s=e.index(),f=e.bisect(e.range),m=e.bisect(t),x=m[0],O=m[1],T=f[0],M=f[1],q=e.one;let Q,se,le;if(x<T)for(Q=x,se=Math.min(T,O);Q<se;++Q)i[le=s[Q]]^=q,n.push(le);else if(x>T)for(Q=T,se=Math.min(x,M);Q<se;++Q)i[le=s[Q]]^=q,r.push(le);if(O>M)for(Q=Math.max(x,M),se=O;Q<se;++Q)i[le=s[Q]]^=q,n.push(le);else if(O<M)for(Q=Math.max(T,O),se=M;Q<se;++Q)i[le=s[Q]]^=q,r.push(le);e.range=t.slice()}}),EC.Definition={type:"ResolveFilter",metadata:{},params:[{name:"ignore",type:"number",required:!0,description:"A bit mask indicating which filters to ignore."},{name:"filter",type:"object",required:!0,description:"Per-tuple filter bitmaps from a CrossFilter transform."}]},Object(xe.z)(EC,Ot,{transform(e,t){const n=~(e.ignore||0),r=e.filter,i=r.mask;if((i&n)==0)return t.StopPropagation;const s=t.fork(t.ALL),f=r.data(),m=r.curr(),x=r.prev(),O=T=>m[T]&n?null:f[T];return s.filter(s.MOD,O),i&i-1?(s.filter(s.ADD,T=>{const M=m[T]&n;return!M&&M^x[T]&n?f[T]:null}),s.filter(s.REM,T=>{const M=m[T]&n;return M&&!(M^M^x[T]&n)?f[T]:null})):(s.filter(s.ADD,O),s.filter(s.REM,T=>(m[T]&n)===i?f[T]:null)),s.filter(s.SOURCE,T=>O(T._index))}});const S6="RawCode",gb="Literal",D6="Property",T6="Identifier",N6="ArrayExpression",I6="BinaryExpression",p4="CallExpression",F6="ConditionalExpression",R6="LogicalExpression",M6="MemberExpression",j6="ObjectExpression",B6="UnaryExpression";function tg(e){this.type=e}var Gv,Oi,Sr,sf,Jo;tg.prototype.visit=function(e){let t,n,r;if(e(this))return 1;for(n=0,r=(t=function(i){switch(i.type){case N6:return i.elements;case I6:case R6:return[i.left,i.right];case p4:return[i.callee].concat(i.arguments);case F6:return[i.test,i.consequent,i.alternate];case M6:return[i.object,i.property];case j6:return i.properties;case D6:return[i.key,i.value];case B6:return[i.argument];case T6:case gb:case S6:default:return[]}}(this)).length;n<r;++n)if(t[n].visit(e))return 1};var D2=1,v1=2,gy=3,j0=4,T2=5,vy=6,vd=7,y1=8;(Gv={})[D2]="Boolean",Gv[v1]="<end>",Gv[gy]="Identifier",Gv[j0]="Keyword",Gv[T2]="Null",Gv[vy]="Numeric",Gv[vd]="Punctuator",Gv[y1]="String",Gv[9]="RegularExpression";var P6="ArrayExpression",L6="BinaryExpression",z6="CallExpression",U6="ConditionalExpression",m4="Identifier",W6="Literal",V6="LogicalExpression",q6="MemberExpression",H6="ObjectExpression",$6="Property",G6="UnaryExpression",Bc="Unexpected token %0",K6="Unexpected number",X6="Unexpected string",Y6="Unexpected identifier",J6="Unexpected reserved word",Q6="Unexpected end of input",CC="Invalid regular expression",OC="Invalid regular expression: missing /",g4="Octal literals are not allowed in strict mode.",Z6="Duplicate data property in object literal not allowed in strict mode",yl="ILLEGAL",b1="Disabled.",ej=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),tj=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function N2(e,t){if(!e)throw new Error("ASSERT: "+t)}function Kv(e){return e>=48&&e<=57}function AC(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function x1(e){return"01234567".indexOf(e)>=0}function nj(e){return e===32||e===9||e===11||e===12||e===160||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function w1(e){return e===10||e===13||e===8232||e===8233}function k1(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e===92||e>=128&&ej.test(String.fromCharCode(e))}function I2(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||e===92||e>=128&&tj.test(String.fromCharCode(e))}const rj={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function v4(){for(;Sr<sf;){const e=Oi.charCodeAt(Sr);if(!nj(e)&&!w1(e))break;++Sr}}function _C(e){var t,n,r,i=0;for(n=e==="u"?4:2,t=0;t<n;++t)Sr<sf&&AC(Oi[Sr])?(r=Oi[Sr++],i=16*i+"0123456789abcdef".indexOf(r.toLowerCase())):Do({},Bc,yl);return String.fromCharCode(i)}function ij(){var e,t,n,r;for(t=0,(e=Oi[Sr])==="}"&&Do({},Bc,yl);Sr<sf&&AC(e=Oi[Sr++]);)t=16*t+"0123456789abcdef".indexOf(e.toLowerCase());return(t>1114111||e!=="}")&&Do({},Bc,yl),t<=65535?String.fromCharCode(t):(n=55296+(t-65536>>10),r=56320+(t-65536&1023),String.fromCharCode(n,r))}function y4(){var e,t;for(e=Oi.charCodeAt(Sr++),t=String.fromCharCode(e),e===92&&(Oi.charCodeAt(Sr)!==117&&Do({},Bc,yl),++Sr,(e=_C("u"))&&e!=="\\"&&k1(e.charCodeAt(0))||Do({},Bc,yl),t=e);Sr<sf&&I2(e=Oi.charCodeAt(Sr));)++Sr,t+=String.fromCharCode(e),e===92&&(t=t.substr(0,t.length-1),Oi.charCodeAt(Sr)!==117&&Do({},Bc,yl),++Sr,(e=_C("u"))&&e!=="\\"&&I2(e.charCodeAt(0))||Do({},Bc,yl),t+=e);return t}function aj(){var e,t;return e=Sr,{type:(t=Oi.charCodeAt(Sr)===92?y4():function(){var n,r;for(n=Sr++;Sr<sf;){if((r=Oi.charCodeAt(Sr))===92)return Sr=n,y4();if(!I2(r))break;++Sr}return Oi.slice(n,Sr)}()).length===1?gy:rj.hasOwnProperty(t)?j0:t==="null"?T2:t==="true"||t==="false"?D2:gy,value:t,start:e,end:Sr}}function SC(){var e,t,n,r,i=Sr,s=Oi.charCodeAt(Sr),f=Oi[Sr];switch(s){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++Sr,{type:vd,value:String.fromCharCode(s),start:i,end:Sr};default:if((e=Oi.charCodeAt(Sr+1))===61)switch(s){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return Sr+=2,{type:vd,value:String.fromCharCode(s)+String.fromCharCode(e),start:i,end:Sr};case 33:case 61:return Sr+=2,Oi.charCodeAt(Sr)===61&&++Sr,{type:vd,value:Oi.slice(i,Sr),start:i,end:Sr}}}return(r=Oi.substr(Sr,4))===">>>="?{type:vd,value:r,start:i,end:Sr+=4}:(n=r.substr(0,3))===">>>"||n==="<<="||n===">>="?{type:vd,value:n,start:i,end:Sr+=3}:f===(t=n.substr(0,2))[1]&&"+-<>&|".indexOf(f)>=0||t==="=>"?{type:vd,value:t,start:i,end:Sr+=2}:(t==="//"&&Do({},Bc,yl),"<>=!+-*%&|^/".indexOf(f)>=0?{type:vd,value:f,start:i,end:++Sr}:void Do({},Bc,yl))}function b4(){var e,t,n;if(N2(Kv((n=Oi[Sr]).charCodeAt(0))||n===".","Numeric literal must start with a decimal digit or a decimal point"),t=Sr,e="",n!=="."){if(e=Oi[Sr++],n=Oi[Sr],e==="0"){if(n==="x"||n==="X")return++Sr,function(r){let i="";for(;Sr<sf&&AC(Oi[Sr]);)i+=Oi[Sr++];return i.length===0&&Do({},Bc,yl),k1(Oi.charCodeAt(Sr))&&Do({},Bc,yl),{type:vy,value:parseInt("0x"+i,16),start:r,end:Sr}}(t);if(x1(n))return function(r){let i="0"+Oi[Sr++];for(;Sr<sf&&x1(Oi[Sr]);)i+=Oi[Sr++];return(k1(Oi.charCodeAt(Sr))||Kv(Oi.charCodeAt(Sr)))&&Do({},Bc,yl),{type:vy,value:parseInt(i,8),octal:!0,start:r,end:Sr}}(t);n&&Kv(n.charCodeAt(0))&&Do({},Bc,yl)}for(;Kv(Oi.charCodeAt(Sr));)e+=Oi[Sr++];n=Oi[Sr]}if(n==="."){for(e+=Oi[Sr++];Kv(Oi.charCodeAt(Sr));)e+=Oi[Sr++];n=Oi[Sr]}if(n==="e"||n==="E")if(e+=Oi[Sr++],(n=Oi[Sr])!=="+"&&n!=="-"||(e+=Oi[Sr++]),Kv(Oi.charCodeAt(Sr)))for(;Kv(Oi.charCodeAt(Sr));)e+=Oi[Sr++];else Do({},Bc,yl);return k1(Oi.charCodeAt(Sr))&&Do({},Bc,yl),{type:vy,value:parseFloat(e),start:t,end:Sr}}function oj(){var e,t,n,r;return Jo=null,v4(),e=Sr,t=function(){var i,s,f,m;for(N2((i=Oi[Sr])==="/","Regular expression literal must start with a slash"),s=Oi[Sr++],f=!1,m=!1;Sr<sf;)if(s+=i=Oi[Sr++],i==="\\")w1((i=Oi[Sr++]).charCodeAt(0))&&Do({},OC),s+=i;else if(w1(i.charCodeAt(0)))Do({},OC);else if(f)i==="]"&&(f=!1);else{if(i==="/"){m=!0;break}i==="["&&(f=!0)}return m||Do({},OC),{value:s.substr(1,s.length-2),literal:s}}(),n=function(){var i,s,f;for(s="",f="";Sr<sf&&I2((i=Oi[Sr]).charCodeAt(0));)++Sr,i==="\\"&&Sr<sf?Do({},Bc,yl):(f+=i,s+=i);return f.search(/[^gimuy]/g)>=0&&Do({},CC,f),{value:f,literal:s}}(),r=function(i,s){let f=i;s.indexOf("u")>=0&&(f=f.replace(/\\u\{([0-9a-fA-F]+)\}/g,(m,x)=>{if(parseInt(x,16)<=1114111)return"x";Do({},CC)}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(f)}catch{Do({},CC)}try{return new RegExp(i,s)}catch{return null}}(t.value,n.value),{literal:t.literal+n.literal,value:r,regex:{pattern:t.value,flags:n.value},start:e,end:Sr}}function x4(){if(v4(),Sr>=sf)return{type:v1,start:Sr,end:Sr};const e=Oi.charCodeAt(Sr);return k1(e)?aj():e===40||e===41||e===59?SC():e===39||e===34?function(){var t,n,r,i,s="",f=!1;for(N2((t=Oi[Sr])==="'"||t==='"',"String literal must starts with a quote"),n=Sr,++Sr;Sr<sf;){if((r=Oi[Sr++])===t){t="";break}if(r==="\\")if((r=Oi[Sr++])&&w1(r.charCodeAt(0)))r==="\r"&&Oi[Sr]===`
`&&++Sr;else switch(r){case"u":case"x":Oi[Sr]==="{"?(++Sr,s+=ij()):s+=_C(r);break;case"n":s+=`
`;break;case"r":s+="\r";break;case"t":s+="	";break;case"b":s+="\b";break;case"f":s+="\f";break;case"v":s+="\v";break;default:x1(r)?((i="01234567".indexOf(r))!==0&&(f=!0),Sr<sf&&x1(Oi[Sr])&&(f=!0,i=8*i+"01234567".indexOf(Oi[Sr++]),"0123".indexOf(r)>=0&&Sr<sf&&x1(Oi[Sr])&&(i=8*i+"01234567".indexOf(Oi[Sr++]))),s+=String.fromCharCode(i)):s+=r}else{if(w1(r.charCodeAt(0)))break;s+=r}}return t!==""&&Do({},Bc,yl),{type:y1,value:s,octal:f,start:n,end:Sr}}():e===46?Kv(Oi.charCodeAt(Sr+1))?b4():SC():Kv(e)?b4():SC()}function yd(){const e=Jo;return Sr=e.end,Jo=x4(),Sr=e.end,e}function w4(){const e=Sr;Jo=x4(),Sr=e}function k4(e,t,n){const r=new tg(e==="||"||e==="&&"?V6:L6);return r.operator=e,r.left=t,r.right=n,r}function sj(e,t){const n=new tg(z6);return n.callee=e,n.arguments=t,n}function DC(e){const t=new tg(m4);return t.name=e,t}function E1(e){const t=new tg(W6);return t.value=e.value,t.raw=Oi.slice(e.start,e.end),e.regex&&(t.raw==="//"&&(t.raw="/(?:)/"),t.regex=e.regex),t}function E4(e,t,n){const r=new tg(q6);return r.computed=e==="[",r.object=t,r.property=n,r.computed||(n.member=!0),r}function C4(e,t,n){const r=new tg($6);return r.key=t,r.value=n,r.kind=e,r}function Do(e,t){var n,r=Array.prototype.slice.call(arguments,2),i=t.replace(/%(\d)/g,(s,f)=>(N2(f<r.length,"Message reference must be in range"),r[f]));throw(n=new Error(i)).index=Sr,n.description=i,n}function F2(e){e.type===v1&&Do(e,Q6),e.type===vy&&Do(e,K6),e.type===y1&&Do(e,X6),e.type===gy&&Do(e,Y6),e.type===j0&&Do(e,J6),Do(e,Bc,e.value)}function uf(e){const t=yd();t.type===vd&&t.value===e||F2(t)}function Bs(e){return Jo.type===vd&&Jo.value===e}function TC(e){return Jo.type===j0&&Jo.value===e}function uj(){const e=[];for(Sr=Jo.start,uf("[");!Bs("]");)Bs(",")?(yd(),e.push(null)):(e.push(yy()),Bs("]")||uf(","));return yd(),function(t){const n=new tg(P6);return n.elements=t,n}(e)}function O4(){Sr=Jo.start;const e=yd();return e.type===y1||e.type===vy?(e.octal&&Do(e,g4),E1(e)):DC(e.value)}function cj(){var e,t,n;return Sr=Jo.start,(e=Jo).type===gy?(n=O4(),uf(":"),C4("init",n,yy())):e.type!==v1&&e.type!==vd?(t=O4(),uf(":"),C4("init",t,yy())):void F2(e)}function lj(){var e,t,n=[],r={},i=String;for(Sr=Jo.start,uf("{");!Bs("}");)t="$"+((e=cj()).key.type===m4?e.key.name:i(e.key.value)),Object.prototype.hasOwnProperty.call(r,t)?Do({},Z6):r[t]=!0,n.push(e),Bs("}")||uf(",");return uf("}"),function(s){const f=new tg(H6);return f.properties=s,f}(n)}const fj={if:1};function hj(){var e,t,n;if(Bs("("))return function(){uf("(");const r=NC();return uf(")"),r}();if(Bs("["))return uj();if(Bs("{"))return lj();if(e=Jo.type,Sr=Jo.start,e===gy||fj[Jo.value])n=DC(yd().value);else if(e===y1||e===vy)Jo.octal&&Do(Jo,g4),n=E1(yd());else{if(e===j0)throw new Error(b1);e===D2?((t=yd()).value=t.value==="true",n=E1(t)):e===T2?((t=yd()).value=null,n=E1(t)):Bs("/")||Bs("/=")?(n=E1(oj()),w4()):F2(yd())}return n}function dj(){const e=[];if(uf("("),!Bs(")"))for(;Sr<sf&&(e.push(yy()),!Bs(")"));)uf(",");return uf(")"),e}function pj(){Sr=Jo.start;const e=yd();return function(t){return t.type===gy||t.type===j0||t.type===D2||t.type===T2}(e)||F2(e),DC(e.value)}function mj(){uf("[");const e=NC();return uf("]"),e}function A4(){const e=function(){var t;for(t=hj();;)if(Bs("."))uf("."),t=E4(".",t,pj());else if(Bs("("))t=sj(t,dj());else{if(!Bs("["))break;t=E4("[",t,mj())}return t}();if(Jo.type===vd&&(Bs("++")||Bs("--")))throw new Error(b1);return e}function R2(){var e,t;if(Jo.type!==vd&&Jo.type!==j0)t=A4();else{if(Bs("++")||Bs("--"))throw new Error(b1);if(Bs("+")||Bs("-")||Bs("~")||Bs("!"))e=yd(),t=R2(),t=function(n,r){const i=new tg(G6);return i.operator=n,i.argument=r,i.prefix=!0,i}(e.value,t);else{if(TC("delete")||TC("void")||TC("typeof"))throw new Error(b1);t=A4()}}return t}function _4(e){let t=0;if(e.type!==vd&&e.type!==j0)return 0;switch(e.value){case"||":t=1;break;case"&&":t=2;break;case"|":t=3;break;case"^":t=4;break;case"&":t=5;break;case"==":case"!=":case"===":case"!==":t=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":t=7;break;case"<<":case">>":case">>>":t=8;break;case"+":case"-":t=9;break;case"*":case"/":case"%":t=11}return t}function yy(){var e,t;return e=function(){var n,r,i,s,f,m,x,O,T,M;if(n=Jo,T=R2(),(f=_4(s=Jo))===0)return T;for(s.prec=f,yd(),r=[n,Jo],m=[T,s,x=R2()];(f=_4(Jo))>0;){for(;m.length>2&&f<=m[m.length-2].prec;)x=m.pop(),O=m.pop().value,T=m.pop(),r.pop(),i=k4(O,T,x),m.push(i);(s=yd()).prec=f,m.push(s),r.push(Jo),i=R2(),m.push(i)}for(i=m[M=m.length-1],r.pop();M>1;)r.pop(),i=k4(m[M-1].value,m[M-2],i),M-=2;return i}(),Bs("?")&&(yd(),t=yy(),uf(":"),e=function(n,r,i){const s=new tg(U6);return s.test=n,s.consequent=r,s.alternate=i,s}(e,t,yy())),e}function NC(){const e=yy();if(Bs(","))throw new Error(b1);return e}var S4={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2",MIN_VALUE:"Number.MIN_VALUE",MAX_VALUE:"Number.MAX_VALUE"};function D4(e){function t(r,i,s){return f=>function(m,x,O,T){let M=e(x[0]);return O&&(M=O+"("+M+")",O.lastIndexOf("new ",0)===0&&(M="("+M+")")),M+"."+m+(T<0?"":T===0?"()":"("+x.slice(1).map(e).join(",")+")")}(r,f,i,s)}const n="new Date";return{isNaN:"Number.isNaN",isFinite:"Number.isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",clamp:function(r){r.length<3&&Object(xe.o)("Missing arguments to clamp function."),r.length>3&&Object(xe.o)("Too many arguments to clamp function.");const i=r.map(e);return"Math.max("+i[1]+", Math.min("+i[2]+","+i[0]+"))"},now:"Date.now",utc:"Date.UTC",datetime:n,date:t("getDate",n,0),day:t("getDay",n,0),year:t("getFullYear",n,0),month:t("getMonth",n,0),hours:t("getHours",n,0),minutes:t("getMinutes",n,0),seconds:t("getSeconds",n,0),milliseconds:t("getMilliseconds",n,0),time:t("getTime",n,0),timezoneoffset:t("getTimezoneOffset",n,0),utcdate:t("getUTCDate",n,0),utcday:t("getUTCDay",n,0),utcyear:t("getUTCFullYear",n,0),utcmonth:t("getUTCMonth",n,0),utchours:t("getUTCHours",n,0),utcminutes:t("getUTCMinutes",n,0),utcseconds:t("getUTCSeconds",n,0),utcmilliseconds:t("getUTCMilliseconds",n,0),length:t("length",null,-1),parseFloat:"parseFloat",parseInt:"parseInt",upper:t("toUpperCase","String",0),lower:t("toLowerCase","String",0),substring:t("substring","String"),split:t("split","String"),trim:t("trim","String",0),regexp:"RegExp",test:t("test","RegExp"),if:function(r){r.length<3&&Object(xe.o)("Missing arguments to if function."),r.length>3&&Object(xe.o)("Too many arguments to if function.");const i=r.map(e);return"("+i[0]+"?"+i[1]+":"+i[2]+")"}}}var T4,N4,IC,FC,RC,M2=new uh,j2=new uh,lv={point:vl,lineStart:vl,lineEnd:vl,polygonStart:function(){M2=new uh,lv.lineStart=gj,lv.lineEnd=vj},polygonEnd:function(){var e=+M2;j2.add(e<0?ch+e:e),this.lineStart=this.lineEnd=this.point=vl},sphere:function(){j2.add(ch)}};function gj(){lv.point=yj}function vj(){I4(T4,N4)}function yj(e,t){lv.point=I4,T4=e,N4=t,IC=e*=qa,FC=Yi(t=(t*=qa)/2+Wx),RC=ji(t)}function I4(e,t){t=(t*=qa)/2+Wx;var n=(e*=qa)-IC,r=n>=0?1:-1,i=r*n,s=Yi(t),f=ji(t),m=RC*f,x=FC*s+m*Yi(i),O=m*r*ji(i);M2.add(cm(O,x)),IC=e,FC=s,RC=f}var au,bd,vu,Cp,by,F4,R4,vb,C1,B0,Xv,Yv={point:MC,lineStart:j4,lineEnd:B4,polygonStart:function(){Yv.point=P4,Yv.lineStart=bj,Yv.lineEnd=xj,C1=new uh,lv.polygonStart()},polygonEnd:function(){lv.polygonEnd(),Yv.point=MC,Yv.lineStart=j4,Yv.lineEnd=B4,M2<0?(au=-(vu=180),bd=-(Cp=90)):C1>$i?Cp=90:C1<-$i&&(bd=-90),Xv[0]=au,Xv[1]=vu},sphere:function(){au=-(vu=180),bd=-(Cp=90)}};function MC(e,t){B0.push(Xv=[au=e,vu=e]),t<bd&&(bd=t),t>Cp&&(Cp=t)}function M4(e,t){var n=fy([e*qa,t*qa]);if(vb){var r=ub(vb,n),i=ub([r[1],-r[0],0],r);n2(i),i=Zx(i);var s,f=e-by,m=f>0?1:-1,x=i[0]*Ru*m,O=po(f)>180;O^(m*by<x&&x<m*e)?(s=i[1]*Ru)>Cp&&(Cp=s):O^(m*by<(x=(x+360)%360-180)&&x<m*e)?(s=-i[1]*Ru)<bd&&(bd=s):(t<bd&&(bd=t),t>Cp&&(Cp=t)),O?e<by?Op(au,e)>Op(au,vu)&&(vu=e):Op(e,vu)>Op(au,vu)&&(au=e):vu>=au?(e<au&&(au=e),e>vu&&(vu=e)):e>by?Op(au,e)>Op(au,vu)&&(vu=e):Op(e,vu)>Op(au,vu)&&(au=e)}else B0.push(Xv=[au=e,vu=e]);t<bd&&(bd=t),t>Cp&&(Cp=t),vb=n,by=e}function j4(){Yv.point=M4}function B4(){Xv[0]=au,Xv[1]=vu,Yv.point=MC,vb=null}function P4(e,t){if(vb){var n=e-by;C1.add(po(n)>180?n+(n>0?360:-360):n)}else F4=e,R4=t;lv.point(e,t),M4(e,t)}function bj(){lv.lineStart()}function xj(){P4(F4,R4),lv.lineEnd(),po(C1)>$i&&(au=-(vu=180)),Xv[0]=au,Xv[1]=vu,vb=null}function Op(e,t){return(t-=e)<0?t+360:t}function wj(e,t){return e[0]-t[0]}function L4(e,t){return e[0]<=e[1]?e[0]<=t&&t<=e[1]:t<e[0]||e[1]<t}var B2,P2,L2,z2,U2,W2,V2,q2,jC,BC,PC,z4,U4,mh,gh,vh,ng={sphere:vl,point:LC,lineStart:W4,lineEnd:V4,polygonStart:function(){ng.lineStart=Cj,ng.lineEnd=Oj},polygonEnd:function(){ng.lineStart=W4,ng.lineEnd=V4}};function LC(e,t){e*=qa;var n=Yi(t*=qa);O1(n*Yi(e),n*ji(e),ji(t))}function O1(e,t,n){L2+=(e-L2)/++B2,z2+=(t-z2)/B2,U2+=(n-U2)/B2}function W4(){ng.point=kj}function kj(e,t){e*=qa;var n=Yi(t*=qa);mh=n*Yi(e),gh=n*ji(e),vh=ji(t),ng.point=Ej,O1(mh,gh,vh)}function Ej(e,t){e*=qa;var n=Yi(t*=qa),r=n*Yi(e),i=n*ji(e),s=ji(t),f=cm(lh((f=gh*s-vh*i)*f+(f=vh*r-mh*s)*f+(f=mh*i-gh*r)*f),mh*r+gh*i+vh*s);P2+=f,W2+=f*(mh+(mh=r)),V2+=f*(gh+(gh=i)),q2+=f*(vh+(vh=s)),O1(mh,gh,vh)}function V4(){ng.point=LC}function Cj(){ng.point=Aj}function Oj(){q4(z4,U4),ng.point=LC}function Aj(e,t){z4=e,U4=t,e*=qa,t*=qa,ng.point=q4;var n=Yi(t);mh=n*Yi(e),gh=n*ji(e),vh=ji(t),O1(mh,gh,vh)}function q4(e,t){e*=qa;var n=Yi(t*=qa),r=n*Yi(e),i=n*ji(e),s=ji(t),f=gh*s-vh*i,m=vh*r-mh*s,x=mh*i-gh*r,O=nE(f,m,x),T=gd(O),M=O&&-T/O;jC.add(M*f),BC.add(M*m),PC.add(M*x),P2+=T,W2+=T*(mh+(mh=r)),V2+=T*(gh+(gh=i)),q2+=T*(vh+(vh=s)),O1(mh,gh,vh)}const _j="Literal";var Jv,Sj=1,Dj=2,Tj=3,Nj=4,Ij=5,Fj=6,Rj=7,Mj=8;(Jv={})[Sj]="Boolean",Jv[Dj]="<end>",Jv[Tj]="Identifier",Jv[Nj]="Keyword",Jv[Ij]="Null",Jv[Fj]="Numeric",Jv[Rj]="Punctuator",Jv[Mj]="String",Jv[9]="RegularExpression";const zC="intersect",H4="union",jj="vlMulti",Bj="vlPoint",$4="or",Pj="and",Lj="E",zj="R",Uj="R-E",Wj="R-LE",Vj="R-RE",H2="index:unit";function G4(e,t){for(var n,r,i=t.fields,s=t.values,f=i.length,m=0;m<f;++m)if((r=i[m]).getter=xe.u.getter||Object(xe.u)(r.field),n=r.getter(e),Object(xe.D)(n)&&(n=Object(xe.Ea)(n)),Object(xe.D)(s[m])&&(s[m]=Object(xe.Ea)(s[m])),Object(xe.D)(s[m][0])&&(s[m]=s[m].map(xe.Ea)),r.type===Lj){if(Object(xe.B)(s[m])?s[m].indexOf(n)<0:n!==s[m])return!1}else if(r.type===zj){if(!Object(xe.A)(n,s[m]))return!1}else if(r.type===Vj){if(!Object(xe.A)(n,s[m],!0,!1))return!1}else if(r.type===Uj){if(!Object(xe.A)(n,s[m],!1,!1))return!1}else if(r.type===Wj&&!Object(xe.A)(n,s[m],!1,!0))return!1;return!0}const UC=Object(xe.u)("_vgsid_"),K4=function(e){let t=e,n=e;function r(i,s,f,m){for(f==null&&(f=0),m==null&&(m=i.length);f<m;){const x=f+m>>>1;n(i[x],s)<0?f=x+1:m=x}return f}return e.length===1&&(t=(i,s)=>e(i)-s,n=function(i){return(s,f)=>function(m,x){return m<x?-1:m>x?1:m>=x?0:NaN}(i(s),f)}(e)),{left:r,center:function(i,s,f,m){f==null&&(f=0),m==null&&(m=i.length);const x=r(i,s,f,m-1);return x>f&&t(i[x-1],s)>-t(i[x],s)?x-1:x},right:function(i,s,f,m){for(f==null&&(f=0),m==null&&(m=i.length);f<m;){const x=f+m>>>1;n(i[x],s)>0?m=x:f=x+1}return f}}}(UC),qj=K4.left,Hj=K4.right;var X4={E_union:function(e,t){if(!e.length)return t;for(var n=0,r=t.length;n<r;++n)e.indexOf(t[n])<0&&e.push(t[n]);return e},E_intersect:function(e,t){return e.length?e.filter(n=>t.indexOf(n)>=0):t},R_union:function(e,t){var n=Object(xe.Ea)(t[0]),r=Object(xe.Ea)(t[1]);return n>r&&(n=t[1],r=t[0]),e.length?(e[0]>n&&(e[0]=n),e[1]<r&&(e[1]=r),e):[n,r]},R_intersect:function(e,t){var n=Object(xe.Ea)(t[0]),r=Object(xe.Ea)(t[1]);return n>r&&(n=t[1],r=t[0]),e.length?r<e[0]||e[1]<n?[]:(e[0]<n&&(e[0]=n),e[1]>r&&(e[1]=r),e):[n,r]}};const $j=":",Gj="@";function WC(e,t,n,r){t[0].type!==_j&&Object(xe.o)("First argument to selection functions must be a string literal.");const i=t[0].value,s=t.length>=2&&Object(xe.W)(t).value,f=Gj+"unit",m=$j+i;s!==zC||Object(xe.w)(r,f)||(r[f]=n.getData(i).indataRef(n,"unit")),Object(xe.w)(r,m)||(r[m]=n.getData(i).tuplesRef())}function Y4(e){const t=this.context.data[e];return t?t.values.value:[]}const A1=e=>function(t,n){return this.context.dataflow.locale()[e](n)(t)},Kj=A1("format"),J4=A1("timeFormat"),Xj=A1("utcFormat"),Yj=A1("timeParse"),Jj=A1("utcParse"),$2=new Date(2e3,0,1);function G2(e,t,n){return Number.isInteger(e)&&Number.isInteger(t)?($2.setYear(2e3),$2.setMonth(e),$2.setDate(t),J4.call(this,$2,n)):""}const Qj=":",Zj="@",VC="%",Q4="$";function qC(e,t,n,r){t[0].type!==gb&&Object(xe.o)("First argument to data functions must be a string literal.");const i=t[0].value,s=Qj+i;if(!Object(xe.w)(s,r))try{r[s]=n.getData(i).tuplesRef()}catch{}}function xd(e,t,n,r){if(t[0].type===gb)Z4(n,r,t[0].value);else for(e in n.scales)Z4(n,r,e)}function Z4(e,t,n){const r=VC+n;if(!Object(xe.w)(t,r))try{t[r]=e.scaleRef(n)}catch{}}function Qv(e,t){let n;return Object(xe.E)(e)?e:Object(xe.J)(e)?(n=t.scales[e])&&n.value:void 0}function HC(e,t){return function(n,r,i){if(n){const s=Qv(n,(i||this).context);return s&&s.path[e](r)}return t(r)}}const e9=HC("area",function(e){return j2=new uh,Vv(e,lv),2*j2}),t9=HC("bounds",function(e){var t,n,r,i,s,f,m;if(Cp=vu=-(au=bd=1/0),B0=[],Vv(e,Yv),n=B0.length){for(B0.sort(wj),t=1,s=[r=B0[0]];t<n;++t)L4(r,(i=B0[t])[0])||L4(r,i[1])?(Op(r[0],i[1])>Op(r[0],r[1])&&(r[1]=i[1]),Op(i[0],r[1])>Op(r[0],r[1])&&(r[0]=i[0])):s.push(r=i);for(f=-1/0,t=0,r=s[n=s.length-1];t<=n;r=i,++t)i=s[t],(m=Op(r[1],i[0]))>f&&(f=m,au=i[0],vu=r[1])}return B0=Xv=null,au===1/0||bd===1/0?[[NaN,NaN],[NaN,NaN]]:[[au,bd],[vu,Cp]]}),n9=HC("centroid",function(e){B2=P2=L2=z2=U2=W2=V2=q2=0,jC=new uh,BC=new uh,PC=new uh,Vv(e,ng);var t=+jC,n=+BC,r=+PC,i=nE(t,n,r);return i<1e-12&&(t=W2,n=V2,r=q2,P2<$i&&(t=L2,n=z2,r=U2),(i=nE(t,n,r))<1e-12)?[NaN,NaN]:[cm(n,t)*Ru,gd(r/i)*Ru]});function $C(e,t,n){try{e[t].apply(e,["EXPRESSION"].concat([].slice.call(n)))}catch(r){e.warn(r)}return n[n.length-1]}function GC(e){const t=e/255;return t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4)}function KC(e){const t=Ut(e);return .2126*GC(t.r)+.7152*GC(t.g)+.0722*GC(t.b)}function eD(e,t){return e===t||e!=e&&t!=t||(Object(xe.B)(e)?!(!Object(xe.B)(t)||e.length!==t.length)&&function(n,r){for(let i=0,s=n.length;i<s;++i)if(!eD(n[i],r[i]))return!1;return!0}(e,t):!(!Object(xe.H)(e)||!Object(xe.H)(t))&&tD(e,t))}function tD(e,t){for(const n in e)if(!eD(e[n],t[n]))return!1;return!0}function nD(e){return t=>tD(e,t)}const rD={};function XC(e){return Object(xe.B)(e)||ArrayBuffer.isView(e)?e:null}function YC(e){return XC(e)||(Object(xe.J)(e)?e:null)}const iD=e=>e.data;function aD(e,t){const n=Y4.call(t,e);return n.root&&n.root.lookup||{}}const oD=()=>typeof window<"u"&&window||null,_1={random:()=>Bn(),cumulativeNormal:qi,cumulativeLogNormal:Dd,cumulativeUniform:Ch,densityNormal:Eh,densityLogNormal:xc,densityUniform:yf,quantileNormal:ec,quantileLogNormal:os,quantileUniform:wc,sampleNormal:vs,sampleLogNormal:Bu,sampleUniform:Pu,isArray:xe.B,isBoolean:xe.C,isDate:xe.D,isDefined:e=>e!==void 0,isNumber:xe.G,isObject:xe.H,isRegExp:xe.I,isString:xe.J,isTuple:Xt,isValid:e=>e!=null&&e==e,toBoolean:xe.Ca,toDate:xe.Da,toNumber:xe.Ea,toString:xe.Ga,indexof:function(e,...t){return YC(e).indexOf(...t)},join:function(e,...t){return XC(e).join(...t)},lastindexof:function(e,...t){return YC(e).lastIndexOf(...t)},replace:function(e,t,n){return Object(xe.E)(n)&&Object(xe.o)("Function argument passed to replace."),String(e).replace(t,n)},reverse:function(e){return XC(e).slice().reverse()},slice:function(e,...t){return YC(e).slice(...t)},flush:xe.v,lerp:xe.L,merge:function(){const e=[].slice.call(arguments);return e.unshift({}),Object(xe.p)(...e)},pad:xe.R,peek:xe.W,pluck:function(e,t){const n=rD[t]||(rD[t]=Object(xe.u)(t));return Object(xe.B)(e)?e.map(n):n(e)},span:xe.Z,inrange:xe.A,truncate:xe.Ha,rgb:Ut,lab:il,hcl:Du,hsl:tr,luminance:KC,contrast:function(e,t){const n=KC(e),r=KC(t);return(Math.max(n,r)+.05)/(Math.min(n,r)+.05)},sequence:ys,format:Kj,utcFormat:Xj,utcParse:Jj,utcOffset:or.w,utcSequence:or.x,timeFormat:J4,timeParse:Yj,timeOffset:or.q,timeSequence:or.r,timeUnitSpecifier:or.s,monthFormat:function(e){return G2.call(this,e,1,"%B")},monthAbbrevFormat:function(e){return G2.call(this,e,1,"%b")},dayFormat:function(e){return G2.call(this,0,2+e,"%A")},dayAbbrevFormat:function(e){return G2.call(this,0,2+e,"%a")},quarter:xe.X,utcquarter:xe.Ja,week:or.A,utcweek:or.z,dayofyear:or.m,utcdayofyear:or.y,warn:function(){return $C(this.context.dataflow,"warn",arguments)},info:function(){return $C(this.context.dataflow,"info",arguments)},debug:function(){return $C(this.context.dataflow,"debug",arguments)},extent:xe.q,inScope:function(e){const t=this.context.group;let n=!1;if(t)for(;e;){if(e===t){n=!0;break}e=e.mark.group}return n},intersect:function(e,t,n){if(!e)return[];const[r,i]=e,s=new Xo().set(r[0],r[1],i[0],i[1]);return Er(n||this.context.dataflow.scenegraph().root,s,function(f){let m=null;if(f){const x=Object(xe.i)(f.marktype),O=Object(xe.i)(f.markname);m=T=>(!x.length||x.some(M=>T.marktype===M))&&(!O.length||O.some(M=>T.name===M))}return m}(t))},clampRange:xe.k,pinchDistance:function(e){const t=e.touches,n=t[0].clientX-t[1].clientX,r=t[0].clientY-t[1].clientY;return Math.sqrt(n*n+r*r)},pinchAngle:function(e){const t=e.touches;return Math.atan2(t[0].clientY-t[1].clientY,t[0].clientX-t[1].clientX)},screen:function(){const e=oD();return e?e.screen:{}},containerSize:function(){const e=this.context.dataflow,t=e.container&&e.container();return t?[t.clientWidth,t.clientHeight]:[void 0,void 0]},windowSize:function(){const e=oD();return e?[e.innerWidth,e.innerHeight]:[void 0,void 0]},bandspace:function(e,t,n){return zp(e||0,t||0,n||0)},setdata:function(e,t){const n=this.context.dataflow,r=this.context.data[e].input;return n.pulse(r,n.changeset().remove(xe.Ia).insert(t)),1},pathShape:function(e){let t=null;return function(n){return n?rd(n,t=t||td(e)):e}},panLinear:xe.S,panLog:xe.T,panPow:xe.U,panSymlog:xe.V,zoomLinear:xe.Na,zoomLog:xe.Oa,zoomPow:xe.Pa,zoomSymlog:xe.Qa,encode:function(e,t,n){if(e){const r=this.context.dataflow,i=e.mark.source;r.pulse(i,r.changeset().encode(e,t))}return n!==void 0?n:e},modify:function(e,t,n,r,i,s){const f=this.context.dataflow,m=this.context.data[e],x=m.input,O=f.stamp();let T,M,q=m.changes;if(f._trigger===!1||!(x.value.length||t||r))return 0;if((!q||q.stamp<O)&&(m.changes=q=f.changeset(),q.stamp=O,f.runAfter(()=>{m.modified=!0,f.pulse(x,q).run()},!0,1)),n&&(T=n===!0?xe.Ia:Object(xe.B)(n)||Xt(n)?n:nD(n),q.remove(T)),t&&q.insert(t),r&&(T=nD(r),x.value.some(T)?q.remove(T):q.insert(r)),i)for(M in s)q.modify(i,M,s[M]);return 1}},r9=["view","item","group","xy","x","y"],i9="event.vega.",sD="this.",JC={},uD={forbidden:["_"],allowed:["datum","event","item"],fieldvar:"datum",globalvar:e=>`_[${Object(xe.Ba)(Q4+e)}]`,functions:function(e){const t=D4(e);r9.forEach(n=>t[n]=i9+n);for(const n in _1)t[n]=sD+n;return Object(xe.p)(t,function(n,r,i){r.__bandwidth=f=>f&&f.bandwidth?f.bandwidth():0,i._bandwidth=xd,i._range=xd,i._scale=xd;const s=f=>"_["+(f.type===gb?Object(xe.Ba)(VC+f.value):Object(xe.Ba)(VC)+"+"+n(f))+"]";return{_bandwidth:f=>`this.__bandwidth(${s(f[0])})`,_range:f=>`${s(f[0])}.range()`,_scale:f=>`${s(f[0])}(${n(f[1])})`}}(e,_1,JC)),t},constants:S4,visitors:JC},QC=function(e){const t=(e=e||{}).allowed?Object(xe.Fa)(e.allowed):{},n=e.forbidden?Object(xe.Fa)(e.forbidden):{},r=e.constants||S4,i=(e.functions||D4)(M),s=e.globalvar,f=e.fieldvar,m=Object(xe.E)(s)?s:se=>`${s}["${se}"]`;let x={},O={},T=0;function M(se){if(Object(xe.J)(se))return se;const le=q[se.type];return le==null&&Object(xe.o)("Unsupported type: "+se.type),le(se)}const q={Literal:se=>se.raw,Identifier:se=>{const le=se.name;return T>0?le:Object(xe.w)(n,le)?Object(xe.o)("Illegal identifier: "+le):Object(xe.w)(r,le)?r[le]:Object(xe.w)(t,le)?le:(x[le]=1,m(le))},MemberExpression:se=>{const le=!se.computed,Fe=M(se.object);le&&(T+=1);const Le=M(se.property);return Fe===f&&(O[function(ze){const nt=ze&&ze.length-1;return nt&&(ze[0]==='"'&&ze[nt]==='"'||ze[0]==="'"&&ze[nt]==="'")?ze.slice(1,-1):ze}(Le)]=1),le&&(T-=1),Fe+(le?"."+Le:"["+Le+"]")},CallExpression:se=>{se.callee.type!=="Identifier"&&Object(xe.o)("Illegal callee type: "+se.callee.type);const le=se.callee.name,Fe=se.arguments,Le=Object(xe.w)(i,le)&&i[le];return Le||Object(xe.o)("Unrecognized function: "+le),Object(xe.E)(Le)?Le(Fe):Le+"("+Fe.map(M).join(",")+")"},ArrayExpression:se=>"["+se.elements.map(M).join(",")+"]",BinaryExpression:se=>"("+M(se.left)+" "+se.operator+" "+M(se.right)+")",UnaryExpression:se=>"("+se.operator+M(se.argument)+")",ConditionalExpression:se=>"("+M(se.test)+"?"+M(se.consequent)+":"+M(se.alternate)+")",LogicalExpression:se=>"("+M(se.left)+se.operator+M(se.right)+")",ObjectExpression:se=>"{"+se.properties.map(M).join(",")+"}",Property:se=>{T+=1;const le=M(se.key);return T-=1,le+":"+M(se.value)}};function Q(se){const le={code:M(se),globals:Object.keys(x),fields:Object.keys(O)};return x={},O={},le}return Q.functions=i,Q.constants=r,Q}(uD);function Yu(e,t,n){return arguments.length===1?_1[e]:(_1[e]=t,n&&(JC[e]=n),QC&&(QC.functions[e]=sD+e),this)}function fv(e,t){const n={};let r;try{r=function(s){Sr=0,sf=(Oi=s).length,Jo=null,w4();const f=NC();if(Jo.type!==v1)throw new Error("Unexpect token after expression.");return f}(e=Object(xe.J)(e)?e:Object(xe.Ba)(e)+"")}catch{Object(xe.o)("Expression parse error: "+e)}r.visit(s=>{if(s.type!==p4)return;const f=s.callee.name,m=uD.visitors[f];m&&m(f,s.arguments,t,n)});const i=QC(r);return i.globals.forEach(s=>{const f=Q4+s;!Object(xe.w)(n,f)&&t.getSignal(s)&&(n[f]=t.signalRef(s))}),{$expr:Object(xe.p)({code:i.code},t.options.ast?{ast:r}:null),$fields:i.fields,$params:n}}Yu("bandwidth",function(e,t){const n=Qv(e,(t||this).context);return n&&n.bandwidth?n.bandwidth():0},xd),Yu("copy",function(e,t){const n=Qv(e,(t||this).context);return n?n.copy():void 0},xd),Yu("domain",function(e,t){const n=Qv(e,(t||this).context);return n?n.domain():[]},xd),Yu("range",function(e,t){const n=Qv(e,(t||this).context);return n&&n.range?n.range():[]},xd),Yu("invert",function(e,t,n){const r=Qv(e,(n||this).context);return r?Object(xe.B)(t)?(r.invertRange||r.invert)(t):(r.invert||r.invertExtent)(t):void 0},xd),Yu("scale",function(e,t,n){const r=Qv(e,(n||this).context);return r?r(t):void 0},xd),Yu("gradient",function(e,t,n,r,i){e=Qv(e,(i||this).context);const s=qm(t,n);let f=e.domain(),m=f[0],x=Object(xe.W)(f),O=xe.y;return x-m?O=Zh(e,m,x):e=(e.interpolator?Fa("sequential")().interpolator(e.interpolator()):Fa("linear")().interpolate(e.interpolate()).range(e.range())).domain([m=0,x=1]),e.ticks&&(m!==(f=e.ticks(+r||15))[0]&&f.unshift(m),x!==Object(xe.W)(f)&&f.push(x)),f.forEach(T=>s.stop(O(T),e(T))),s},xd),Yu("geoArea",e9,xd),Yu("geoBounds",t9,xd),Yu("geoCentroid",n9,xd),Yu("geoShape",function(e,t,n){const r=Qv(e,(n||this).context);return function(i){return r?r.path.context(i)(t):""}},xd),Yu("indata",function(e,t,n){const r=this.context.data[e]["index:"+t],i=r?r.value.get(n):void 0;return i&&i.count},function(e,t,n,r){t[0].type!==gb&&Object(xe.o)("First argument to indata must be a string literal."),t[1].type!==gb&&Object(xe.o)("Second argument to indata must be a string literal.");const i=t[0].value,s=t[1].value,f=Zj+s;Object(xe.w)(f,r)||(r[f]=n.getData(i).indataRef(n,s))}),Yu("data",Y4,qC),Yu("treePath",function(e,t,n){const r=aD(e,this),i=r[t],s=r[n];return i&&s?i.path(s).map(iD):void 0},qC),Yu("treeAncestors",function(e,t){const n=aD(e,this)[t];return n?n.ancestors().map(iD):void 0},qC),Yu("vlSelectionTest",function(e,t,n){for(var r,i,s,f,m,x=this.context.data[e],O=x?x.values.value:[],T=x?x[H2]&&x[H2].value:void 0,M=n===zC,q=O.length,Q=0;Q<q;++Q)if(r=O[Q],T&&M){if((s=(i=i||{})[f=r.unit]||0)===-1)continue;if(m=G4(t,r),i[f]=m?-1:++s,m&&T.size===1)return!0;if(!m&&s===T.get(f).count)return!1}else if(M^(m=G4(t,r)))return m;return q&&M},WC),Yu("vlSelectionIdTest",function(e,t,n){const r=this.context.data[e],i=r?r.values.value:[],s=r?r[H2]&&r[H2].value:void 0,f=n===zC,m=UC(t),x=qj(i,m);if(x===i.length||UC(i[x])!==m)return!1;if(s&&f){if(s.size===1)return!0;if(Hj(i,m)-x<s.size)return!1}return!0},WC),Yu("vlSelectionResolve",function(e,t,n,r){for(var i,s,f,m,x,O,T,M,q,Q,se,le=this.context.data[e],Fe=le?le.values.value:[],Le={},ze={},nt={},it=Fe.length,ut=0;ut<it;++ut){for(m=(i=Fe[ut]).unit,s=i.fields,f=i.values,Q=0,se=s.length;Q<se;++Q)x=s[Q],T=(O=Le[x.field]||(Le[x.field]={}))[m]||(O[m]=[]),nt[x.field]=M=x.type.charAt(0),q=X4[M+"_union"],O[m]=q(T,Object(xe.i)(f[Q]));n&&(T=ze[m]||(ze[m]=[])).push(Object(xe.i)(f).reduce((st,pt,dt)=>(st[s[dt].field]=pt,st),{}))}return t=t||H4,Object.keys(Le).forEach(st=>{Le[st]=Object.keys(Le[st]).map(pt=>Le[st][pt]).reduce((pt,dt)=>pt===void 0?dt:X4[nt[st]+"_"+t](pt,dt))}),Fe=Object.keys(ze),n&&Fe.length&&(Le[r?Bj:jj]=t===H4?{[$4]:Fe.reduce((st,pt)=>(st.push(...ze[pt]),st),[])}:{[Pj]:Fe.map(st=>({[$4]:ze[st]}))}),Le},WC),Yu("vlSelectionTuples",function(e,t){return e.map(n=>Object(xe.p)({values:t.fields.map(r=>(r.getter||(r.getter=Object(xe.u)(r.field)))(n.datum))},t))});const a9=Object(xe.Fa)(["rule"]),cD=Object(xe.Fa)(["group","image","rect"]);function ZC(e){return(e+"").toLowerCase()}function S1(e,t,n){n[n.length-1]!==";"&&(n="return("+n+");");const r=Function(...t.concat(n));return e&&e.functions?r.bind(e.functions):r}var o9={operator:(e,t)=>S1(e,["_"],t.code),parameter:(e,t)=>S1(e,["datum","_"],t.code),event:(e,t)=>S1(e,["event"],t.code),handler:(e,t)=>S1(e,["_","event"],"var datum=event.item&&event.item.datum;return ".concat(t.code,";")),encode:(e,t)=>{const{marktype:n,channels:r}=t;let i="var o=item,datum=o.datum,m=0,$;";for(const s in r){const f="o["+Object(xe.Ba)(s)+"]";i+="$=".concat(r[s].code,";if(").concat(f,"!==$)").concat(f,"=$,m=1;")}return i+=function(s,f){let m="";return a9[f]||(s.x2&&(s.x?(cD[f]&&(m+="if(o.x>o.x2)$=o.x,o.x=o.x2,o.x2=$;"),m+="o.width=o.x2-o.x;"):m+="o.x=o.x2-(o.width||0);"),s.xc&&(m+="o.x=o.xc-(o.width||0)/2;"),s.y2&&(s.y?(cD[f]&&(m+="if(o.y>o.y2)$=o.y,o.y=o.y2,o.y2=$;"),m+="o.height=o.y2-o.y;"):m+="o.y=o.y2-(o.height||0);"),s.yc&&(m+="o.y=o.yc-(o.height||0)/2;")),m}(r,n),S1(e,["item","_"],i+="return m;")},codegen:{get(e){const t="[".concat(e.map(xe.Ba).join("]["),"]"),n=Function("_","return _".concat(t,";"));return n.path=t,n},comparator(e,t){let n;const r=Function("a","b","var u, v; return "+e.map((i,s)=>{const f=t[s];let m,x;return i.path?(m="a".concat(i.path),x="b".concat(i.path)):((n=n||{})["f"+s]=i,m="this.f".concat(s,"(a)"),x="this.f".concat(s,"(b)")),function(O,T,M,q){return"((u = ".concat(O,") < (v = ").concat(T,") || u == null) && v != null ? ").concat(M,`
  : (u > v || v == null) && u != null ? `).concat(q,`
  : ((v = v instanceof Date ? +v : v), (u = u instanceof Date ? +u : u)) !== u && v === v ? `).concat(M,`
  : v !== v && u === u ? `).concat(q," : ")}(m,x,-f,f)}).join("")+"0;");return n?r.bind(n):r}}};function lD(e,t,n){if(!e||!Object(xe.H)(e))return e;for(let r,i=0,s=fD.length;i<s;++i)if(r=fD[i],Object(xe.w)(e,r.key))return r.parse(e,t,n);return e}var fD=[{key:"$ref",parse:function(e,t){return t.get(e.$ref)||Object(xe.o)("Operator not defined: "+e.$ref)}},{key:"$key",parse:function(e,t){const n="k:"+e.$key+"_"+!!e.$flat;return t.fn[n]||(t.fn[n]=Object(xe.K)(e.$key,e.$flat,t.expr.codegen))}},{key:"$expr",parse:function(e,t,n){e.$params&&t.parseParameters(e.$params,n);const r="e:"+e.$expr.code+"_"+e.$name;return t.fn[r]||(t.fn[r]=Object(xe.f)(t.parameterExpression(e.$expr),e.$fields,e.$name))}},{key:"$field",parse:function(e,t){if(!e.$field)return null;const n="f:"+e.$field+"_"+e.$name;return t.fn[n]||(t.fn[n]=Object(xe.u)(e.$field,e.$name,t.expr.codegen))}},{key:"$encode",parse:function(e,t){const n=e.$encode,r={};for(const i in n){const s=n[i];r[i]=Object(xe.f)(t.encodeExpression(s.$expr),s.$fields),r[i].output=s.$output}return r}},{key:"$compare",parse:function(e,t){const n="c:"+e.$compare+"_"+e.$order,r=Object(xe.i)(e.$compare).map(i=>i&&i.$tupleid?nn:i);return t.fn[n]||(t.fn[n]=Object(xe.l)(r,e.$order,t.expr.codegen))}},{key:"$context",parse:function(e,t){return t}},{key:"$subflow",parse:function(e,t){const n=e.$subflow;return function(r,i,s){const f=t.fork().parse(n),m=f.get(n.operators[0].id),x=f.signals.parent;return x&&x.set(s),m.detachSubflow=()=>t.detach(f),m}}},{key:"$tupleid",parse:function(){return nn}}];const s9={skip:!0};function hD(e,t,n,r){return new dD(e,t,n,r)}function dD(e,t,n,r){this.dataflow=e,this.transforms=t,this.events=e.events.bind(e),this.expr=r||o9,this.signals={},this.scales={},this.nodes={},this.data={},this.fn={},n&&(this.functions=Object.create(n),this.functions.context=this)}function pD(e){this.dataflow=e.dataflow,this.transforms=e.transforms,this.events=e.events,this.expr=e.expr,this.signals=Object.create(e.signals),this.scales=Object.create(e.scales),this.nodes=Object.create(e.nodes),this.data=Object.create(e.data),this.fn=Object.create(e.fn),e.functions&&(this.functions=Object.create(e.functions),this.functions.context=this)}dD.prototype=pD.prototype={fork(){const e=new pD(this);return(this.subcontext||(this.subcontext=[])).push(e),e},detach(e){this.subcontext=this.subcontext.filter(n=>n!==e);const t=Object.keys(e.nodes);for(const n of t)e.nodes[n]._targets=null;for(const n of t)e.nodes[n].detach();e.nodes=null},get(e){return this.nodes[e]},set(e,t){return this.nodes[e]=t},add(e,t){const n=this,r=n.dataflow,i=e.value;if(n.set(e.id,t),function(s){return ZC(s)==="collect"}(e.type)&&i&&(i.$ingest?r.ingest(t,i.$ingest,i.$format):i.$request?r.preload(t,i.$request,i.$format):r.pulse(t,r.changeset().insert(i))),e.root&&(n.root=t),e.parent){let s=n.get(e.parent.$ref);s?(r.connect(s,[t]),t.targets().add(s)):(n.unresolved=n.unresolved||[]).push(()=>{s=n.get(e.parent.$ref),r.connect(s,[t]),t.targets().add(s)})}if(e.signal&&(n.signals[e.signal]=t),e.scale&&(n.scales[e.scale]=t),e.data)for(const s in e.data){const f=n.data[s]||(n.data[s]={});e.data[s].forEach(m=>f[m]=t)}},resolve(){return(this.unresolved||[]).forEach(e=>e()),delete this.unresolved,this},operator(e,t){this.add(e,this.dataflow.add(e.value,t))},transform(e,t){this.add(e,this.dataflow.add(this.transforms[ZC(t)]))},stream(e,t){this.set(e.id,t)},update(e,t,n,r,i){this.dataflow.on(t,n,r,i,e.options)},operatorExpression(e){return this.expr.operator(this,e)},parameterExpression(e){return this.expr.parameter(this,e)},eventExpression(e){return this.expr.event(this,e)},handlerExpression(e){return this.expr.handler(this,e)},encodeExpression(e){return this.expr.encode(this,e)},parse:function(e){const t=this,n=e.operators||[];return e.background&&(t.background=e.background),e.eventConfig&&(t.eventConfig=e.eventConfig),e.locale&&(t.locale=e.locale),n.forEach(r=>t.parseOperator(r)),n.forEach(r=>t.parseOperatorParameters(r)),(e.streams||[]).forEach(r=>t.parseStream(r)),(e.updates||[]).forEach(r=>t.parseUpdate(r)),t.resolve()},parseOperator:function(e){const t=this;!function(n){return ZC(n)==="operator"}(e.type)&&e.type?t.transform(e,e.type):t.operator(e,e.update?t.operatorExpression(e.update):null)},parseOperatorParameters:function(e){const t=this;if(e.params){const n=t.get(e.id);n||Object(xe.o)("Invalid operator id: "+e.id),t.dataflow.connect(n,n.parameters(t.parseParameters(e.params),e.react,e.initonly))}},parseParameters:function(e,t){t=t||{};const n=this;for(const r in e){const i=e[r];t[r]=Object(xe.B)(i)?i.map(s=>lD(s,n,t)):lD(i,n,t)}return t},parseStream:function(e){var t,n=this,r=e.filter!=null?n.eventExpression(e.filter):void 0,i=e.stream!=null?n.get(e.stream):void 0;e.source?i=n.events(e.source,e.type,r):e.merge&&(i=(t=e.merge.map(s=>n.get(s)))[0].merge.apply(t[0],t.slice(1))),e.between&&(t=e.between.map(s=>n.get(s)),i=i.between(t[0],t[1])),e.filter&&(i=i.filter(r)),e.throttle!=null&&(i=i.throttle(+e.throttle)),e.debounce!=null&&(i=i.debounce(+e.debounce)),i==null&&Object(xe.o)("Invalid stream definition: "+JSON.stringify(e)),e.consume&&i.consume(!0),n.stream(e,i)},parseUpdate:function(e){var t,n=Object(xe.H)(n=e.source)?n.$ref:n,r=this.get(n),i=e.update,s=void 0;r||Object(xe.o)("Source not defined: "+e.source),t=e.target&&e.target.$expr?this.eventExpression(e.target.$expr):this.get(e.target),i&&i.$expr&&(i.$params&&(s=this.parseParameters(i.$params)),i=this.handlerExpression(i.$expr)),this.update(e,r,t,i,s)},getState:function(e){var t=this,n={};if(e.signals){var r=n.signals={};Object.keys(t.signals).forEach(s=>{const f=t.signals[s];e.signals(s,f)&&(r[s]=f.value)})}if(e.data){var i=n.data={};Object.keys(t.data).forEach(s=>{const f=t.data[s];e.data(s,f)&&(i[s]=f.input.value)})}return t.subcontext&&e.recurse!==!1&&(n.subcontext=t.subcontext.map(s=>s.getState(e))),n},setState:function(e){var t=this,n=t.dataflow,r=e.data,i=e.signals;Object.keys(i||{}).forEach(s=>{n.update(t.signals[s],i[s],s9)}),Object.keys(r||{}).forEach(s=>{n.pulse(t.data[s].input,n.changeset().remove(xe.Ia).insert(r[s]))}),(e.subcontext||[]).forEach((s,f)=>{const m=t.subcontext[f];m&&m.setState(s)})}};var u9=function(e,t,n){var r=new v2,i=t;return t==null?(r.restart(e,t,n),r):(r._restart=r.restart,r.restart=function(s,f,m){f=+f,m=m==null?VE():+m,r._restart(function x(O){O+=i,r._restart(x,i+=f,m),s(O)},f,m)},r.restart(e,t,n),r)};function mD(e,t){e&&(t==null?e.removeAttribute("aria-label"):e.setAttribute("aria-label",t))}const e3="default";function t3(e,t){const n=e.globalCursor()?typeof document<"u"&&document.body:e.container();if(n)return t==null?n.style.removeProperty("cursor"):n.style.cursor=t}function K2(e,t){var n=e._runtime.data;return Object(xe.w)(n,t)||Object(xe.o)("Unrecognized data set: "+t),n[t]}function X2(e,t){ni(t)||Object(xe.o)("Second argument to changes must be a changeset.");const n=K2(this,e);return n.modified=!0,this.pulse(n.input,t)}function gD(e){var t=e.padding();return Math.max(0,e._viewWidth+t.left+t.right)}function vD(e){var t=e.padding();return Math.max(0,e._viewHeight+t.top+t.bottom)}function Y2(e){var t=e.padding(),n=e._origin;return[t.left+n[0],t.top+n[1]]}function c9(e,t,n){var r,i,s=e._renderer,f=s&&s.canvas();return f&&(i=Y2(e),(r=h(t.changedTouches?t.changedTouches[0]:t,f))[0]-=i[0],r[1]-=i[1]),t.dataflow=e,t.item=n,t.vega=function(m,x,O){const T=x?x.mark.marktype==="group"?x:x.mark.group:null;function M(Q){var se,le=T;if(Q){for(se=x;se;se=se.mark.group)if(se.mark.name===Q){le=se;break}}return le&&le.mark&&le.mark.interactive?le:{}}function q(Q){if(!Q)return O;Object(xe.J)(Q)&&(Q=M(Q));const se=O.slice();for(;Q;)se[0]-=Q.x||0,se[1]-=Q.y||0,Q=Q.mark&&Q.mark.group;return se}return{view:Object(xe.m)(m),item:Object(xe.m)(x||{}),group:M,xy:q,x:Q=>q(Q)[0],y:Q=>q(Q)[1]}}(e,n,r),t}const yD="view",l9="timer",f9="window",h9={trap:!1};function bD(e,t,n,r){e._eventListeners.push({type:n,sources:Object(xe.i)(t),handler:r})}function J2(e,t,n){const r=e._eventConfig&&e._eventConfig[t];return!(r===!1||Object(xe.H)(r)&&!r[n])||(e.warn(`Blocked ${t} ${n} event listener.`),!1)}function xD(e){return e.item}function wD(e){return e.item.mark.source}function kD(e){return function(t,n){return n.vega.view().changeset().encode(n.item,e)}}function Ap(e,t,n){const r=document.createElement(e);for(const i in t)r.setAttribute(i,t[i]);return n!=null&&(r.textContent=n),r}const d9="vega-bind",p9="vega-bind-name",m9="vega-bind-radio";function g9(e,t,n,r){const i=n.event||"input",s=()=>e.update(t.value);r.signal(n.signal,t.value),t.addEventListener(i,s),bD(r,t,i,s),e.set=f=>{t.value=f,t.dispatchEvent(function(m){return typeof Event<"u"?new Event(m):{type:m}}(i))}}function v9(e,t,n,r){const i=r.signal(n.signal),s=Ap("div",{class:d9}),f=n.input==="radio"?s:s.appendChild(Ap("label"));f.appendChild(Ap("span",{class:p9},n.name||n.signal)),t.appendChild(s);let m=y9;switch(n.input){case"checkbox":m=b9;break;case"select":m=x9;break;case"radio":m=w9;break;case"range":m=k9}m(e,f,n,i)}function y9(e,t,n,r){const i=Ap("input");for(const s in n)s!=="signal"&&s!=="element"&&i.setAttribute(s==="input"?"type":s,n[s]);i.setAttribute("name",n.signal),i.value=r,t.appendChild(i),i.addEventListener("input",()=>e.update(i.value)),e.elements=[i],e.set=s=>i.value=s}function b9(e,t,n,r){const i={type:"checkbox",name:n.signal};r&&(i.checked=!0);const s=Ap("input",i);t.appendChild(s),s.addEventListener("change",()=>e.update(s.checked)),e.elements=[s],e.set=f=>s.checked=!!f||null}function x9(e,t,n,r){const i=Ap("select",{name:n.signal}),s=n.labels||[];n.options.forEach((f,m)=>{const x={value:f};Q2(f,r)&&(x.selected=!0),i.appendChild(Ap("option",x,(s[m]||f)+""))}),t.appendChild(i),i.addEventListener("change",()=>{e.update(n.options[i.selectedIndex])}),e.elements=[i],e.set=f=>{for(let m=0,x=n.options.length;m<x;++m)if(Q2(n.options[m],f))return void(i.selectedIndex=m)}}function w9(e,t,n,r){const i=Ap("span",{class:m9}),s=n.labels||[];t.appendChild(i),e.elements=n.options.map((f,m)=>{const x={type:"radio",name:n.signal,value:f};Q2(f,r)&&(x.checked=!0);const O=Ap("input",x);O.addEventListener("change",()=>e.update(f));const T=Ap("label",{},(s[m]||f)+"");return T.prepend(O),i.appendChild(T),O}),e.set=f=>{const m=e.elements,x=m.length;for(let O=0;O<x;++O)Q2(m[O].value,f)&&(m[O].checked=!0)}}function k9(e,t,n,r){r=r!==void 0?r:(+n.max+ +n.min)/2;const i=n.max!=null?n.max:Math.max(100,+r)||100,s=n.min||Math.min(0,i,+r)||0,f=n.step||Object(Cu.c)(s,i,100),m=Ap("input",{type:"range",name:n.signal,min:s,max:i,step:f});m.value=r;const x=Ap("span",{},+r);t.appendChild(m),t.appendChild(x);const O=()=>{x.textContent=m.value,e.update(+m.value)};m.addEventListener("input",O),m.addEventListener("change",O),e.elements=[m],e.set=T=>{m.value=T,x.textContent=T}}function Q2(e,t){return e===t||e+""==t+""}function ED(e,t,n,r,i,s){return(t=t||new r(e.loader())).initialize(n,gD(e),vD(e),Y2(e),i,s).background(e.background())}function n3(e,t){return t?function(){try{t.apply(this,arguments)}catch(n){e.error(n)}}:null}function r3(e,t,n){if(typeof t=="string"){if(typeof document>"u")return e.error("DOM document instance not found."),null;if(!(t=document.querySelector(t)))return e.error("Signal bind element not found: "+t),null}if(t&&n)try{t.innerHTML=""}catch(r){t=null,e.error(r)}return t}const D1=e=>+e||0,E9=e=>({top:e,bottom:e,left:e,right:e});function CD(e){return Object(xe.H)(e)?{top:D1(e.top),bottom:D1(e.bottom),left:D1(e.left),right:D1(e.right)}:E9(D1(e))}async function i3(e,t,n,r){const i=Or(t),s=i&&i.headless;return s||Object(xe.o)("Unrecognized renderer type: "+t),await e.runAsync(),ED(e,null,null,s,n,r).renderAsync(e._scenegraph.root)}var OD="width",AD="height",a3="padding",_D={skip:!0};function SD(e,t){var n=e.autosize(),r=e.padding();return t-(n&&n.contains===a3?r.left+r.right:0)}function DD(e,t){var n=e.autosize(),r=e.padding();return t-(n&&n.contains===a3?r.top+r.bottom:0)}function C9(e,t){return t.modified&&Object(xe.B)(t.input.value)&&e.indexOf("_:vega:_")}function O9(e,t){return!(e==="parent"||t instanceof pn.proxy)}function A9(e,t,n,r){const i=e.element();i&&i.setAttribute("title",function(s){return s==null?"":Object(xe.B)(s)?TD(s):Object(xe.H)(s)&&!Object(xe.D)(s)?function(f){return Object.keys(f).map(m=>{const x=f[m];return m+": "+(Object(xe.B)(x)?TD(x):ND(x))}).join(`
`)}(s):s+""}(r))}function TD(e){return"["+e.map(ND).join(", ")+"]"}function ND(e){return Object(xe.B)(e)?"[]":Object(xe.H)(e)&&!Object(xe.D)(e)?"{}":e}function ID(e,t){const n=this;if(t=t||{},Hn.call(n),t.loader&&n.loader(t.loader),t.logger&&n.logger(t.logger),t.logLevel!=null&&n.logLevel(t.logLevel),t.locale||e.locale){const s=Object(xe.p)({},e.locale,t.locale);n.locale(Object(br.b)(s.number,s.time))}n._el=null,n._elBind=null,n._renderType=t.renderer||ur.Canvas,n._scenegraph=new iv;const r=n._scenegraph.root;n._renderer=null,n._tooltip=t.tooltip||A9,n._redraw=!0,n._handler=new qe().scene(r),n._globalCursor=!1,n._preventDefault=!1,n._timers=[],n._eventListeners=[],n._resizeListeners=[],n._eventConfig=function(s){const f=Object(xe.p)({defaults:{}},s),m=(x,O)=>{O.forEach(T=>{Object(xe.B)(x[T])&&(x[T]=Object(xe.Fa)(x[T]))})};return m(f.defaults,["prevent","allow"]),m(f,["view","window","selector"]),f}(e.eventConfig),n.globalCursor(n._eventConfig.globalCursor);const i=function(s,f,m){return hD(s,pn,_1,m).parse(f)}(n,e,t.expr);n._runtime=i,n._signals=i.signals,n._bind=(e.bindings||[]).map(s=>({state:null,param:Object(xe.p)({},s)})),i.root&&i.root.set(r),r.source=i.data.root.input,n.pulse(i.data.root.input,n.changeset().insert(r.items)),n._width=n.width(),n._height=n.height(),n._viewWidth=SD(n,n._width),n._viewHeight=DD(n,n._height),n._origin=[0,0],n._resize=0,n._autosize=1,function(s){var f=s._signals,m=f[OD],x=f[AD],O=f[a3];function T(){s._autosize=s._resize=1}s._resizeWidth=s.add(null,q=>{s._width=q.size,s._viewWidth=SD(s,q.size),T()},{size:m}),s._resizeHeight=s.add(null,q=>{s._height=q.size,s._viewHeight=DD(s,q.size),T()},{size:x});const M=s.add(null,T,{pad:O});s._resizeWidth.rank=m.rank+1,s._resizeHeight.rank=x.rank+1,M.rank=O.rank+1}(n),function(s){s.add(null,f=>(s._background=f.bg,s._resize=1,f.bg),{bg:s._signals.background})}(n),function(s){const f=s._signals.cursor||(s._signals.cursor=s.add({user:e3,item:null}));s.on(s.events("view","mousemove"),f,(m,x)=>{const O=f.value,T=O?Object(xe.J)(O)?O:O.user:e3,M=x.item&&x.item.cursor||null;return O&&T===O.user&&M==O.item?O:{user:T,item:M}}),s.add(null,function(m){let x=m.cursor,O=this.value;return Object(xe.J)(x)||(O=x.item,x=x.user),t3(s,x&&x!==e3?x:O||x),O},{cursor:f})}(n),n.description(e.description),t.hover&&n.hover(),t.container&&n.initialize(t.container,t.bind)}function Z2(e,t){return Object(xe.w)(e._signals,t)?e._signals[t]:Object(xe.o)("Unrecognized signal name: "+Object(xe.Ba)(t))}function FD(e,t){const n=(e._targets||[]).filter(r=>r._update&&r._update.handler===t);return n.length?n[0]:null}function RD(e,t,n,r){let i=FD(n,r);return i||((i=n3(e,()=>r(t,n.value))).handler=r,e.on(n,null,i)),e}function MD(e,t,n){const r=FD(t,n);return r&&t._targets.remove(r),e}Object(xe.z)(ID,Hn,{async evaluate(e,t,n){if(await Hn.prototype.evaluate.call(this,e,t),this._redraw||this._resize)try{this._renderer&&(this._resize&&(this._resize=0,function(r){var i=Y2(r),s=gD(r),f=vD(r);r._renderer.background(r.background()),r._renderer.resize(s,f,i),r._handler.origin(i),r._resizeListeners.forEach(m=>{try{m(s,f)}catch(x){r.error(x)}})}(this)),await this._renderer.renderAsync(this._scenegraph.root)),this._redraw=!1}catch(r){this.error(r)}return n&&dr(this,n),this},dirty(e){this._redraw=!0,this._renderer&&this._renderer.dirty(e)},description(e){if(arguments.length){const t=e!=null?e+"":null;return t!==this._desc&&mD(this._el,this._desc=t),this}return this._desc},container(){return this._el},scenegraph(){return this._scenegraph},origin(){return this._origin.slice()},signal(e,t,n){const r=Z2(this,e);return arguments.length===1?r.value:this.update(r,t,n)},width(e){return arguments.length?this.signal("width",e):this.signal("width")},height(e){return arguments.length?this.signal("height",e):this.signal("height")},padding(e){return arguments.length?this.signal("padding",CD(e)):CD(this.signal("padding"))},autosize(e){return arguments.length?this.signal("autosize",e):this.signal("autosize")},background(e){return arguments.length?this.signal("background",e):this.signal("background")},renderer(e){return arguments.length?(Or(e)||Object(xe.o)("Unrecognized renderer type: "+e),e!==this._renderType&&(this._renderType=e,this._resetRenderer()),this):this._renderType},tooltip(e){return arguments.length?(e!==this._tooltip&&(this._tooltip=e,this._resetRenderer()),this):this._tooltip},loader(e){return arguments.length?(e!==this._loader&&(Hn.prototype.loader.call(this,e),this._resetRenderer()),this):this._loader},resize(){return this._autosize=1,this.touch(Z2(this,"autosize"))},_resetRenderer(){this._renderer&&(this._renderer=null,this.initialize(this._el,this._elBind))},_resizeView:function(e,t,n,r,i,s){this.runAfter(f=>{let m=0;f._autosize=0,f.width()!==n&&(m=1,f.signal(OD,n,_D),f._resizeWidth.skip(!0)),f.height()!==r&&(m=1,f.signal(AD,r,_D),f._resizeHeight.skip(!0)),f._viewWidth!==e&&(f._resize=1,f._viewWidth=e),f._viewHeight!==t&&(f._resize=1,f._viewHeight=t),f._origin[0]===i[0]&&f._origin[1]===i[1]||(f._resize=1,f._origin=i),m&&f.run("enter"),s&&f.runAfter(x=>x.resize())},!1,1)},addEventListener(e,t,n){let r=t;return n&&n.trap===!1||((r=n3(this,t)).raw=t),this._handler.on(e,r),this},removeEventListener(e,t){for(var n,r,i=this._handler.handlers(e),s=i.length;--s>=0;)if(r=i[s].type,n=i[s].handler,e===r&&(t===n||t===n.raw)){this._handler.off(r,n);break}return this},addResizeListener(e){const t=this._resizeListeners;return t.indexOf(e)<0&&t.push(e),this},removeResizeListener(e){var t=this._resizeListeners,n=t.indexOf(e);return n>=0&&t.splice(n,1),this},addSignalListener(e,t){return RD(this,e,Z2(this,e),t)},removeSignalListener(e,t){return MD(this,Z2(this,e),t)},addDataListener(e,t){return RD(this,e,K2(this,e).values,t)},removeDataListener(e,t){return MD(this,K2(this,e).values,t)},globalCursor(e){if(arguments.length){if(this._globalCursor!==!!e){const t=t3(this,null);this._globalCursor=!!e,t&&t3(this,t)}return this}return this._globalCursor},preventDefault(e){return arguments.length?(this._preventDefault=e,this):this._preventDefault},timer:function(e,t){this._timers.push(u9(function(n){e({timestamp:Date.now(),elapsed:n})},t))},events:function(e,t,n){var r,i=this,s=new Ci(n),f=function(O,T){i.runAsync(null,()=>{e===yD&&function(M,q){var Q=M._eventConfig.defaults,se=Q.prevent,le=Q.allow;return se!==!1&&le!==!0&&(se===!0||le===!1||(se?se[q]:le?!le[q]:M.preventDefault()))}(i,t)&&O.preventDefault(),s.receive(c9(i,O,T))})};if(e===l9)J2(i,"timer",t)&&i.timer(f,t);else if(e===yD)J2(i,"view",t)&&i.addEventListener(t,f,h9);else if(e===f9?J2(i,"window",t)&&typeof window<"u"&&(r=[window]):typeof document<"u"&&J2(i,"selector",t)&&(r=document.querySelectorAll(e)),r){for(var m=0,x=r.length;m<x;++m)r[m].addEventListener(t,f);bD(i,r,t,f)}else i.warn("Can not resolve event source: "+e);return s},finalize:function(){var e,t,n,r=this._tooltip,i=this._timers,s=this._eventListeners;for(e=i.length;--e>=0;)i[e].stop();for(e=s.length;--e>=0;)for(t=(n=s[e]).sources.length;--t>=0;)n.sources[t].removeEventListener(n.type,n.handler);return r&&r.call(this,this._handler,null,null,null),this},hover:function(e,t){return e=[e||"hover"],t=[t||"update",e[0]],this.on(this.events("view","mouseover",xD),wD,kD(e)),this.on(this.events("view","mouseout",xD),wD,kD(t)),this},data:function(e,t){return arguments.length<2?K2(this,e).values.value:X2.call(this,e,Mr().remove(xe.Ia).insert(t))},change:X2,insert:function(e,t){return X2.call(this,e,Mr().insert(t))},remove:function(e,t){return X2.call(this,e,Mr().remove(t))},scale:function(e){var t=this._runtime.scales;return Object(xe.w)(t,e)||Object(xe.o)("Unrecognized scale or projection: "+e),t[e].value},initialize:function(e,t){const n=this,r=n._renderType,i=n._eventConfig.bind,s=Or(r);e=n._el=e?r3(n,e,!0):null,function(x){const O=x.container();O&&(O.setAttribute("role","graphics-document"),O.setAttribute("aria-roleDescription","visualization"),mD(O,x.description()))}(n),s||n.error("Unrecognized renderer type: "+r);const f=s.handler||qe,m=e?s.renderer:s.headless;return n._renderer=m?ED(n,n._renderer,e,m):null,n._handler=function(x,O,T,M){const q=new M(x.loader(),n3(x,x.tooltip())).scene(x.scenegraph().root).initialize(T,Y2(x),x);return O&&O.handlers().forEach(Q=>{q.on(Q.type,Q.handler)}),q}(n,n._handler,e,f),n._redraw=!0,e&&i!=="none"&&(t=t?n._elBind=r3(n,t,!0):e.appendChild(Ap("form",{class:"vega-bindings"})),n._bind.forEach(x=>{x.param.element&&i!=="container"&&(x.element=r3(n,x.param.element,!!x.param.input))}),n._bind.forEach(x=>{(function(O,T,M){if(!T)return;const q=M.param;let Q=M.state;Q||(Q=M.state={elements:null,active:!1,set:null,update:se=>{se!=O.signal(q.signal)&&O.runAsync(null,()=>{Q.source=!0,O.signal(q.signal,se)})}},q.debounce&&(Q.update=Object(xe.n)(q.debounce,Q.update))),(q.input==null&&q.element?g9:v9)(Q,T,q,O),Q.active||(O.on(O._signals[q.signal],null,()=>{Q.source?Q.source=!1:Q.set(O.signal(q.signal))}),Q.active=!0)})(n,x.element||t,x)})),n},toImageURL:async function(e,t){e!==ur.Canvas&&e!==ur.SVG&&e!==ur.PNG&&Object(xe.o)("Unrecognized image type: "+e);const n=await i3(this,e,t);return e===ur.SVG?function(r,i){const s=new Blob([r],{type:i});return window.URL.createObjectURL(s)}(n.svg(),"image/svg+xml"):n.canvas().toDataURL("image/png")},toCanvas:async function(e,t){return(await i3(this,ur.Canvas,e,t)).canvas()},toSVG:async function(e){return(await i3(this,ur.SVG,e)).svg()},getState:function(e){return this._runtime.getState(e||{data:C9,signals:O9,recurse:!0})},setState:function(e){return this.runAsync(null,t=>{t._trigger=!1,t._runtime.setState(e)},t=>{t._trigger=!0}),this}});const ew="[",tw="]",jD="{",BD="}",_9=":",PD=",",S9="@",D9=">",T9=/[[\]{}]/,N9={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};let LD,zD;function T1(e,t,n,r,i){const s=e.length;let f,m=0;for(;t<s;++t){if(f=e[t],!m&&f===n)return t;i&&i.indexOf(f)>=0?--m:r&&r.indexOf(f)>=0&&++m}return t}function UD(e){const t=[],n=e.length;let r=0,i=0;for(;i<n;)i=T1(e,i,PD,ew+jD,tw+BD),t.push(e.substring(r,i).trim()),r=++i;if(t.length===0)throw"Empty event selector: "+e;return t}function o3(e){return e[0]==="["?function(t){const n=t.length;let r,i=1;if((i=T1(t,i,tw,ew,tw))===n)throw"Empty between selector: "+t;if((r=UD(t.substring(1,i))).length!==2)throw"Between selector must have two elements: "+t;if((t=t.slice(i+1).trim())[0]!==D9)throw"Expected '>' after between selector: "+t;r=r.map(o3);const s=o3(t.slice(1).trim());return s.between?{between:r,stream:s}:(s.between=r,s)}(e):function(t){const n={source:LD},r=[];let i,s,f=[0,0],m=0,x=0,O=t.length,T=0;if(t[O-1]===BD){if(!((T=t.lastIndexOf(jD))>=0))throw"Unmatched right brace: "+t;try{f=function(M){const q=M.split(PD);if(!M.length||q.length>2)throw M;return q.map(Q=>{const se=+Q;if(se!=se)throw M;return se})}(t.substring(T+1,O-1))}catch{throw"Invalid throttle specification: "+t}t=t.slice(0,T).trim(),O=t.length,T=0}if(!O)throw t;if(t[0]===S9&&(m=++T),(i=T1(t,T,_9))<O&&(r.push(t.substring(x,i).trim()),x=T=++i),(T=T1(t,T,ew))===O)r.push(t.substring(x,O).trim());else if(r.push(t.substring(x,T).trim()),s=[],(x=++T)===O)throw"Unmatched left bracket: "+t;for(;T<O;){if((T=T1(t,T,tw))===O)throw"Unmatched left bracket: "+t;if(s.push(t.substring(x,T).trim()),T<O-1&&t[++T]!==ew)throw"Expected left bracket: "+t;x=++T}if(!(O=r.length)||T9.test(r[O-1]))throw"Invalid event selector: "+t;return O>1?(n.type=r[1],m?n.markname=r[0].slice(1):function(M){return zD[M]}(r[0])?n.marktype=r[0]:n.source=r[0]):n.type=r[0],n.type.slice(-1)==="!"&&(n.consume=!0,n.type=n.type.slice(0,-1)),s!=null&&(n.filter=s),f[0]&&(n.throttle=f[0]),f[1]&&(n.debounce=f[1]),n}(e)}const N1=e=>+e||0,I9=e=>({top:e,bottom:e,left:e,right:e}),Pc=e=>Object(xe.H)(e)&&!Object(xe.B)(e)?Object(xe.p)({},e):{value:e};function WD(e,t,n,r){return n!=null?(Object(xe.H)(n)&&!Object(xe.B)(n)||Object(xe.B)(n)&&n.length&&Object(xe.H)(n[0])?e.update[t]=n:e[r||"enter"][t]={value:n},1):0}function bl(e,t,n){for(const r in t)WD(e,r,t[r]);for(const r in n)WD(e,r,n[r],"update")}function yb(e,t,n){for(const r in t)n&&Object(xe.w)(n,r)||(e[r]=Object(xe.p)(e[r]||{},t[r]));return e}function bb(e,t){return t&&(t.enter&&t.enter[e]||t.update&&t.update[e])}const s3="mark",u3="frame",c3="scope",F9="axis",R9="axis-domain",M9="axis-grid",j9="axis-label",B9="axis-tick",P9="axis-title",L9="legend",z9="legend-band",U9="legend-entry",W9="legend-gradient",VD="legend-label",V9="legend-symbol",q9="legend-title",H9="title",$9="title-text",G9="title-subtitle";function l3(e,t,n){e[t]=n&&n.signal?{signal:n.signal}:{value:n}}const qD=e=>Object(xe.J)(e)?Object(xe.Ba)(e):e.signal?`(${e.signal})`:HD(e);function nw(e){if(e.gradient!=null)return function(n){const r=[n.start,n.stop,n.count].map(i=>i==null?null:Object(xe.Ba)(i));for(;r.length&&Object(xe.W)(r)==null;)r.pop();return r.unshift(qD(n.gradient)),`gradient(${r.join(",")})`}(e);let t=e.signal?`(${e.signal})`:e.color?function(n){return n.c?rw("hcl",n.h,n.c,n.l):n.h||n.s?rw("hsl",n.h,n.s,n.l):n.l||n.a?rw("lab",n.l,n.a,n.b):n.r||n.g||n.b?rw("rgb",n.r,n.g,n.b):null}(e.color):e.field!=null?HD(e.field):e.value!==void 0?Object(xe.Ba)(e.value):void 0;return e.scale!=null&&(t=function(n,r){const i=qD(n.scale);return n.range!=null?r=`lerp(_range(${i}), ${+n.range})`:(r!==void 0&&(r=`_scale(${i}, ${r})`),n.band&&(r=(r?r+"+":"")+`_bandwidth(${i})`+(+n.band==1?"":"*"+iw(n.band)),n.extra&&(r=`(datum.extra ? _scale(${i}, datum.extra.value) : ${r})`)),r==null&&(r="0")),r}(e,t)),t===void 0&&(t=null),e.exponent!=null&&(t=`pow(${t},${iw(e.exponent)})`),e.mult!=null&&(t+=`*${iw(e.mult)}`),e.offset!=null&&(t+=`+${iw(e.offset)}`),e.round&&(t=`round(${t})`),t}const rw=(e,t,n,r)=>`(${e}(${[t,n,r].map(nw).join(",")})+'')`;function iw(e){return Object(xe.H)(e)?"("+nw(e)+")":e}function HD(e){return function t(n){let r,i,s;if(n.signal)r="datum",s=n.signal;else if(n.group||n.parent){for(i=Math.max(1,n.level||1),r="item";i-- >0;)r+=".mark.group";n.parent?(s=n.parent,r+=".datum"):s=n.group}else n.datum?(r="datum",s=n.datum):Object(xe.o)("Invalid field reference: "+Object(xe.Ba)(n));return n.signal||(s=Object(xe.J)(s)?Object(xe.Aa)(s).map(xe.Ba).join("]["):t(s)),r+"["+s+"]"}(Object(xe.H)(e)?e:{datum:e})}function $D(e,t,n,r,i,s){const f={};(s=s||{}).encoders={$encode:f},e=function(m,x,O,T,M){const q={},Q={};let se,le,Fe;for(le in le="lineBreak",x!=="text"||M[le]==null||bb(le,m)||l3(q,le,M[le]),(O=="legend"||String(O).startsWith("axis"))&&(O=null),Fe=O===u3?M.group:O===s3?Object(xe.p)({},M.mark,M[x]):null)bb(le,m)||(le==="fill"||le==="stroke")&&(bb("fill",m)||bb("stroke",m))||l3(q,le,Fe[le]);for(le in Object(xe.i)(T).forEach(Le=>{const ze=M.style&&M.style[Le];for(const nt in ze)bb(nt,m)||l3(q,nt,ze[nt])}),m=Object(xe.p)({},m),q)(Fe=q[le]).signal?(se=se||{})[le]=Fe:Q[le]=Fe;return m.enter=Object(xe.p)(Q,m.enter),se&&(m.update=Object(xe.p)(se,m.update)),m}(e,t,n,r,i.config);for(const m in e)f[m]=K9(e[m],t,s,i);return s}function K9(e,t,n,r){const i={},s={};for(const f in e)e[f]!=null&&(i[f]=Y9(X9(e[f]),r,n,s));return{$expr:{marktype:t,channels:i},$fields:Object.keys(s),$output:Object.keys(e)}}function X9(e){return Object(xe.B)(e)?function(t){let n="";return t.forEach(r=>{const i=nw(r);n+=r.test?`(${r.test})?${i}:`:i}),Object(xe.W)(n)===":"&&(n+="null"),n}(e):nw(e)}function Y9(e,t,n,r){const i=fv(e,t);return i.$fields.forEach(s=>r[s]=1),Object(xe.p)(n,i.$params),i.$expr}const J9="outer",Q9=["value","update","init","react","bind"];function GD(e,t){Object(xe.o)(e+' for "outer" push: '+Object(xe.Ba)(t))}function KD(e,t){const n=e.name;if(e.push===J9)t.signals[n]||GD("No prior signal definition",n),Q9.forEach(r=>{e[r]!==void 0&&GD("Invalid property ",r)});else{const r=t.addSignal(n,e.value);e.react===!1&&(r.react=!1),e.bind&&t.addBinding(n,e.bind)}}function f3(e,t,n,r){this.id=-1,this.type=e,this.value=t,this.params=n,r&&(this.parent=r)}function aw(e,t,n,r){return new f3(e,t,n,r)}function ow(e,t){return aw("operator",e,t)}function Bi(e){const t={$ref:e.id};return e.id<0&&(e.refs=e.refs||[]).push(t),t}function I1(e,t){return t?{$field:e,$name:t}:{$field:e}}const h3=I1("key");function XD(e,t){return{$compare:e,$order:t}}const Z9="descending";function sw(e,t){return(e&&e.signal?"$"+e.signal:e||"")+(e&&t?"_":"")+(t&&t.signal?"$"+t.signal:t||"")}const d3="scope",p3="view";function gc(e){return e&&e.signal}function uw(e){if(gc(e))return!0;if(Object(xe.H)(e)){for(const t in e)if(uw(e[t]))return!0}return!1}function rg(e,t){return e??t}function xy(e){return e&&e.signal||e}const YD="timer";function F1(e,t){return(e.merge?e8:e.stream?t8:e.type?n8:Object(xe.o)("Invalid stream specification: "+Object(xe.Ba)(e)))(e,t)}function e8(e,t){const n=m3({merge:e.merge.map(r=>F1(r,t))},e,t);return t.addStream(n).id}function t8(e,t){const n=m3({stream:F1(e.stream,t)},e,t);return t.addStream(n).id}function n8(e,t){let n;e.type===YD?(n=t.event(YD,e.throttle),e={between:e.between,filter:e.filter}):n=t.event(function(i){return i===d3?p3:i||p3}(e.source),e.type);const r=m3({stream:n},e,t);return Object.keys(r).length===1?n:t.addStream(r).id}function m3(e,t,n){let r=t.between;return r&&(r.length!==2&&Object(xe.o)('Stream "between" parameter must have 2 entries: '+Object(xe.Ba)(t)),e.between=[F1(r[0],n),F1(r[1],n)]),r=t.filter?[].concat(t.filter):[],(t.marktype||t.markname||t.markrole)&&r.push(function(i,s,f){const m="event.item";return m+(i&&i!=="*"?"&&"+m+".mark.marktype==='"+i+"'":"")+(f?"&&"+m+".mark.role==='"+f+"'":"")+(s?"&&"+m+".mark.name==='"+s+"'":"")}(t.marktype,t.markname,t.markrole)),t.source===d3&&r.push("inScope(event.item)"),r.length&&(e.filter=fv("("+r.join(")&&(")+")",n).$expr),(r=t.throttle)!=null&&(e.throttle=+r),(r=t.debounce)!=null&&(e.debounce=+r),t.consume&&(e.consume=!0),e}const r8={code:"_.$value",ast:{type:"Identifier",value:"value"}};function i8(e,t,n){const r=e.encode,i={target:n};let s=e.events,f=e.update,m=[];s||Object(xe.o)("Signal update missing events specification."),Object(xe.J)(s)&&(s=function(x,O,T){return LD=O,zD=N9,UD(x.trim()).map(o3)}(s,t.isSubscope()?d3:p3)),s=Object(xe.i)(s).filter(x=>x.signal||x.scale?(m.push(x),0):1),m.length>1&&(m=[function(x){return{signal:"["+x.map(O=>O.scale?'scale("'+O.scale+'")':O.signal)+"]"}}(m)]),s.length&&m.push(s.length>1?{merge:s}:s[0]),r!=null&&(f&&Object(xe.o)("Signal encode and update are mutually exclusive."),f="encode(item(),"+Object(xe.Ba)(r)+")"),i.update=Object(xe.J)(f)?fv(f,t):f.expr!=null?fv(f.expr,t):f.value!=null?f.value:f.signal!=null?{$expr:r8,$params:{$value:t.signalRef(f.signal)}}:Object(xe.o)("Invalid signal update specification."),e.force&&(i.options={force:!0}),m.forEach(x=>t.addUpdate(Object(xe.p)(function(O,T){return{source:O.signal?T.signalRef(O.signal):O.scale?T.scaleRef(O.scale):F1(O,T)}}(x,t),i)))}const is=e=>(t,n,r)=>aw(e,n,t||void 0,r),JD=is("aggregate"),a8=is("axisticks"),QD=is("bound"),ig=is("collect"),ZD=is("compare"),o8=is("datajoin"),eT=is("encode"),s8=is("expression"),u8=is("facet"),c8=is("field"),l8=is("key"),f8=is("legendentries"),h8=is("load"),d8=is("mark"),p8=is("multiextent"),m8=is("multivalues"),g8=is("overlap"),v8=is("params"),tT=is("prefacet"),y8=is("projection"),b8=is("proxy"),x8=is("relay"),nT=is("render"),w8=is("scale"),wy=is("sieve"),k8=is("sortitems"),rT=is("viewlayout"),E8=is("values");let C8=0;const iT={min:"min",max:"max",count:"sum"};function O8(e,t){const n=t.getScale(e.name).params;let r;for(r in n.domain=aT(e.domain,e,t),e.range!=null&&(n.range=function i(s,f,m){const x=f.config.range;let O=s.range;if(O.signal)return f.signalRef(O.signal);if(Object(xe.J)(O)){if(x&&Object(xe.w)(x,O))return s=Object(xe.p)({},s,{range:x[O]}),i(s,f,m);O==="width"?O=[0,{signal:"width"}]:O==="height"?O=Yf(s.type)?[0,{signal:"height"}]:[{signal:"height"},0]:Object(xe.o)("Unrecognized scale range value: "+Object(xe.Ba)(O))}else{if(O.scheme)return m.scheme=Object(xe.B)(O.scheme)?cw(O.scheme,f):fm(O.scheme,f),O.extent&&(m.schemeExtent=cw(O.extent,f)),void(O.count&&(m.schemeCount=fm(O.count,f)));if(O.step)return void(m.rangeStep=fm(O.step,f));if(Yf(s.type)&&!Object(xe.B)(O))return aT(O,s,f);Object(xe.B)(O)||Object(xe.o)("Unsupported range type: "+Object(xe.Ba)(O))}return O.map(T=>(Object(xe.B)(T)?cw:fm)(T,f))}(e,t,n)),e.interpolate!=null&&function(i,s){s.interpolate=fm(i.type||i),i.gamma!=null&&(s.interpolateGamma=fm(i.gamma))}(e.interpolate,n),e.nice!=null&&(n.nice=function(i){return Object(xe.H)(i)?{interval:fm(i.interval),step:fm(i.step)}:fm(i)}(e.nice)),e.bins!=null&&(n.bins=function(i,s){return i.signal||Object(xe.B)(i)?cw(i,s):s.objectProperty(i)}(e.bins,t)),e)Object(xe.w)(n,r)||r==="name"||(n[r]=fm(e[r],t))}function fm(e,t){return Object(xe.H)(e)?e.signal?t.signalRef(e.signal):Object(xe.o)("Unsupported object: "+Object(xe.Ba)(e)):e}function cw(e,t){return e.signal?t.signalRef(e.signal):e.map(n=>fm(n,t))}function lw(e){Object(xe.o)("Can not find data set: "+Object(xe.Ba)(e))}function aT(e,t,n){if(e)return e.signal?n.signalRef(e.signal):(Object(xe.B)(e)?function(r,i,s){return r.map(f=>fm(f,s))}:e.fields?function(r,i,s){const f=r.data,m=r.fields.reduce((x,O)=>(O=Object(xe.J)(O)?{data:f,field:O}:Object(xe.B)(O)||O.signal?function(T,M){const q="_:vega:_"+C8++,Q=ig({});if(Object(xe.B)(T))Q.value={$ingest:T};else if(T.signal){const se="setdata("+Object(xe.Ba)(q)+","+T.signal+")";Q.params.input=M.signalRef(se)}return M.addDataPipeline(q,[Q,wy({})]),{data:q,field:"data"}}(O,s):O,x.push(O),x),[]);return(Yf(i.type)?function(x,O,T){const M=oT(x.sort,!0);let q,Q;const se=T.map(Le=>{const ze=O.getData(Le.data);return ze||lw(Le.data),ze.countsRef(O,Le.field,M)}),le={groupby:h3,pulse:se};M&&(q=M.op||"count",Q=M.field?sw(q,M.field):"count",le.ops=[iT[q]],le.fields=[O.fieldRef(Q)],le.as=[Q]),q=O.add(JD(le));const Fe=O.add(ig({pulse:Bi(q)}));return Bi(Q=O.add(E8({field:h3,sort:O.sortRef(M),pulse:Bi(Fe)})))}:Hp(i.type)?function(x,O,T){const M=T.map(q=>{const Q=O.getData(q.data);return Q||lw(q.data),Q.domainRef(O,q.field)});return Bi(O.add(m8({values:M})))}:function(x,O,T){const M=T.map(q=>{const Q=O.getData(q.data);return Q||lw(q.data),Q.extentRef(O,q.field)});return Bi(O.add(p8({extents:M})))})(r,s,m)}:function(r,i,s){const f=s.getData(r.data);return f||lw(r.data),Yf(i.type)?f.valuesRef(s,r.field,oT(r.sort,!1)):Hp(i.type)?f.domainRef(s,r.field):f.extentRef(s,r.field)})(e,t,n);t.domainMin==null&&t.domainMax==null||Object(xe.o)("No scale domain defined for domainMin/domainMax to override.")}function oT(e,t){return e&&(e.field||e.op?e.field||e.op==="count"?t&&e.field&&e.op&&!iT[e.op]&&Object(xe.o)("Multiple domain scales can not be sorted using "+e.op):Object(xe.o)("No field provided for sort aggregate op: "+e.op):Object(xe.H)(e)?e.field="key":e={field:"key"}),e}function g3(e,t,n){return Object(xe.B)(e)?e.map(r=>g3(r,t,n)):Object(xe.H)(e)?e.signal?n.signalRef(e.signal):t==="fit"?e:Object(xe.o)("Unsupported parameter object: "+Object(xe.Ba)(e)):e}const ag="top",P0="bottom",A8="vertical",_8="start",S8="end",v3="index",y3="label",D8="offset",xb="perc",T8="perc2",hm="value",R1="guide-label",b3="guide-title",N8="group-title",I8="group-subtitle",sT="symbol",fw="gradient",x3="discrete",w3="size",k3=[w3,"shape","fill","stroke","strokeWidth","strokeDash","opacity"],M1={name:1,style:1,interactive:1},mo={value:0},dm={value:1},hw="group",uT="rect",E3="rule",F8="symbol",ky="text";function j1(e){return e.type=hw,e.interactive=e.interactive||!1,e}function wd(e,t){const n=(r,i)=>rg(e[r],rg(t[r],i));return n.isVertical=r=>A8===rg(e.direction,t.direction||(r?t.symbolDirection:t.gradientDirection)),n.gradientLength=()=>rg(e.gradientLength,t.gradientLength||t.gradientWidth),n.gradientThickness=()=>rg(e.gradientThickness,t.gradientThickness||t.gradientHeight),n.entryColumns=()=>rg(e.columns,rg(t.columns,+n.isVertical(!0))),n}function cT(e,t){const n=t&&(t.update&&t.update[e]||t.enter&&t.enter[e]);return n&&n.signal?n:n?n.value:null}function dw(e,t,n){return`item.anchor === '${_8}' ? ${e} : item.anchor === '${S8}' ? ${t} : ${n}`}const C3=dw(Object(xe.Ba)("left"),Object(xe.Ba)("right"),Object(xe.Ba)("center"));function _p(e,t){return t?(e.name=t.name,e.style=t.style||e.style,e.interactive=!!t.interactive,e.encode=yb(e.encode,t,M1)):e.interactive=!1,e}const R8=`datum.${xb}<=0?"left":datum.${xb}>=1?"right":"center"`,M8=`datum.${xb}<=0?"${P0}":datum.${xb}>=1?"${ag}":"middle"`;function lT(e,t,n,r){const i=wd(e,t),s=i.isVertical(),f=Pc(i.gradientThickness()),m=i.gradientLength();let x,O,T,M,q=i("labelOverlap"),Q="";const se={enter:x={opacity:mo},update:O={opacity:dm,text:{field:y3}},exit:{opacity:mo}};return bl(se,{fill:i("labelColor"),fillOpacity:i("labelOpacity"),font:i("labelFont"),fontSize:i("labelFontSize"),fontStyle:i("labelFontStyle"),fontWeight:i("labelFontWeight"),limit:rg(e.labelLimit,t.gradientLabelLimit)}),s?(x.align={value:"left"},x.baseline=O.baseline={signal:M8},T="y",M="x",Q="1-"):(x.align=O.align={signal:R8},x.baseline={value:"top"},T="x",M="y"),x[T]=O[T]={signal:Q+"datum."+xb,mult:m},x[M]=O[M]=f,f.offset=rg(e.labelOffset,t.gradientLabelOffset)||0,q=q?{separation:i("labelSeparation"),method:q,order:"datum."+v3}:void 0,_p({type:ky,role:VD,style:R1,key:hm,from:r,encode:se,overlap:q},n)}const pw='(item.orient === "left" || item.orient === "right")',j8=`datum.vgrad && ${pw}`,B8=dw('"top"','"bottom"','"middle"'),P8=`datum.vgrad && item.orient === "right" ? (${dw('"right"','"left"','"center"')}) : (${pw} && !(datum.vgrad && item.orient === "left")) ? "left" : ${C3}`,L8=`item._anchor || (${pw} ? "middle" : "start")`,z8=`${j8} ? (item.orient === "left" ? -90 : 90) : 0`,U8=`${pw} ? (datum.vgrad ? (item.orient === "right" ? "bottom" : "top") : ${B8}) : "top"`;function fT(e){return Object(xe.H)(e)&&e.signal?e.signal:Object(xe.Ba)(e)}function hT(e){const t=e.role||"";return t.indexOf("axis")&&t.indexOf("legend")&&t.indexOf("title")?e.type===hw?c3:t||s3:t}function O3(e,t){const n=qt(e.type);n||Object(xe.o)("Unrecognized transform type: "+Object(xe.Ba)(e.type));const r=aw(n.type.toLowerCase(),null,dT(n,e,t));return e.signal&&t.addSignal(e.signal,t.proxy(r)),r.metadata=n.metadata||{},r}function dT(e,t,n){const r={},i=e.params.length;for(let s=0;s<i;++s){const f=e.params[s];r[f.name]=W8(f,t,n)}return r}function W8(e,t,n){const r=e.type,i=t[e.name];return r==="index"?function(s,f,m){return Object(xe.J)(f.from)||Object(xe.o)('Lookup "from" parameter must be a string literal.'),m.getData(f.from).lookupRef(m,f.key)}(0,t,n):i!==void 0?r==="param"?function(s,f,m){const x=f[s.name];return s.array?(Object(xe.B)(x)||Object(xe.o)("Expected an array of sub-parameters. Instead: "+Object(xe.Ba)(x)),x.map(O=>mT(s,O,m))):mT(s,x,m)}(e,t,n):r==="projection"?n.projectionRef(t[e.name]):e.array&&!gc(i)?i.map(s=>pT(e,s,n)):pT(e,i,n):void(e.required&&Object(xe.o)("Missing required "+Object(xe.Ba)(t.type)+" parameter: "+Object(xe.Ba)(e.name)))}function pT(e,t,n){const r=e.type;if(gc(t))return gT(r)?Object(xe.o)("Expression references can not be signals."):A3(r)?n.fieldRef(t):vT(r)?n.compareRef(t):n.signalRef(t.signal);{const i=e.expr||A3(r);return i&&V8(t)?n.exprRef(t.expr,t.as):i&&q8(t)?I1(t.field,t.as):gT(r)?fv(t,n):H8(r)?Bi(n.getData(t).values):A3(r)?I1(t):vT(r)?n.compareRef(t):t}}function mT(e,t,n){const r=e.params.length;let i;for(let f=0;f<r;++f){i=e.params[f];for(const m in i.key)if(i.key[m]!==t[m]){i=null;break}if(i)break}i||Object(xe.o)("Unsupported parameter: "+Object(xe.Ba)(t));const s=Object(xe.p)(dT(i,t,n),i.key);return Bi(n.add(v8(s)))}const V8=e=>e&&e.expr,q8=e=>e&&e.field,H8=e=>e==="data",gT=e=>e==="expr",A3=e=>e==="field",vT=e=>e==="compare";function mw(e,t){return e.$ref?e:e.data&&e.data.$ref?e.data:Bi(t.getData(e.data).output)}function Ey(e,t,n,r,i){this.scope=e,this.input=t,this.output=n,this.values=r,this.aggregate=i,this.index={}}function yT(e){return Object(xe.J)(e)?e:null}function bT(e,t,n){const r=sw(n.op,n.field);let i;if(t.ops){for(let s=0,f=t.as.length;s<f;++s)if(t.as[s]===r)return}else t.ops=["count"],t.fields=[null],t.as=["count"];n.op&&(t.ops.push((i=n.op.signal)?e.signalRef(i):n.op),t.fields.push(e.fieldRef(n.field)),t.as.push(r))}function B1(e,t,n,r,i,s,f){const m=t[n]||(t[n]={}),x=function(q){return Object(xe.H)(q)?(q.order===Z9?"-":"+")+sw(q.op,q.field):""}(s);let O,T,M=yT(i);if(M!=null&&(e=t.scope,O=m[M+=x?"|"+x:""]),!O){const q=s?{field:h3,pulse:t.countsRef(e,i,s)}:{field:e.fieldRef(i),pulse:Bi(t.output)};x&&(q.sort=e.sortRef(s)),T=e.add(aw(r,void 0,q)),f&&(t.index[i]=T),O=Bi(T),M!=null&&(m[M]=O)}return O}function xT(e,t,n){const r=e.remove,i=e.insert,s=e.toggle,f=e.modify,m=e.values,x=t.add(ow()),O=fv("if("+e.trigger+',modify("'+n+'",'+[i,r,s,f,m].map(T=>T??"null").join(",")+"),0)",t);x.update=O.$expr,x.params=O.$params}function gw(e,t){const n=hT(e),r=e.type===hw,i=e.from&&e.from.facet,s=e.overlap;let f,m,x,O,T,M,q,Q=e.layout||n===c3||n===u3;const se=n===s3||Q||i,le=function(st,pt,dt){let Qt,mn,on,Rn,Fn;return st?(Qt=st.facet)&&(pt||Object(xe.o)("Only group marks can be faceted."),Qt.field!=null?Rn=Fn=mw(Qt,dt):(st.data?Fn=Bi(dt.getData(st.data).aggregate):((on=O3(Object(xe.p)({type:"aggregate",groupby:Object(xe.i)(Qt.groupby)},Qt.aggregate),dt)).params.key=dt.keyRef(Qt.groupby),on.params.pulse=mw(Qt,dt),Rn=Fn=Bi(dt.add(on))),mn=dt.keyRef(Qt.groupby,!0))):Rn=Bi(dt.add(ig(null,[{}]))),Rn||(Rn=mw(st,dt)),{key:mn,pulse:Rn,parent:Fn}}(e.from,r,t),Fe=Bi(m=t.add(o8({key:le.key||(e.key?I1(e.key):void 0),pulse:le.pulse,clean:!r})));m=x=t.add(ig({pulse:Fe}));const Le=Bi(m=t.add(d8({markdef:function(st){return{marktype:st.type,name:st.name||void 0,role:st.role||hT(st),zindex:+st.zindex||void 0,aria:st.aria,description:st.description}}(e),interactive:function(st,pt){return st&&st.signal?pt.signalRef(st.signal):st!==!1}(e.interactive,t),clip:function(st,pt){let dt;return Object(xe.H)(st)&&(st.signal?dt=st.signal:st.path?dt="pathShape("+fT(st.path)+")":st.sphere&&(dt="geoShape("+fT(st.sphere)+', {type: "Sphere"})')),dt?pt.signalRef(dt):!!st}(e.clip,t),context:{$context:!0},groups:t.lookup(),parent:t.signals.parent?t.signalRef("parent"):null,index:t.markpath(),pulse:Bi(m)})));(m=O=t.add(eT($D(e.encode,e.type,n,e.style,t,{mod:!1,pulse:Le})))).params.parent=t.encode(),e.transform&&e.transform.forEach(st=>{const pt=O3(st,t),dt=pt.metadata;(dt.generates||dt.changes)&&Object(xe.o)("Mark transforms should not generate new data."),dt.nomod||(O.params.mod=!0),pt.params.pulse=Bi(m),t.add(m=pt)}),e.sort&&(m=t.add(k8({sort:t.compareRef(e.sort),pulse:Bi(m)})));const ze=Bi(m);(i||Q)&&(M=Bi(Q=t.add(rT({layout:t.objectProperty(e.layout),legends:t.legends,mark:Le,pulse:ze}))));const nt=t.add(QD({mark:Le,pulse:M||ze}));q=Bi(nt),r&&(se&&((f=t.operators).pop(),Q&&f.pop()),t.pushState(ze,M||q,Fe),i?function(st,pt,dt){const Qt=st.from.facet,mn=Qt.name,on=mw(Qt,pt);let Rn;Qt.name||Object(xe.o)("Facet must have a name: "+Object(xe.Ba)(Qt)),Qt.data||Object(xe.o)("Facet must reference a data set: "+Object(xe.Ba)(Qt)),Qt.field?Rn=pt.add(tT({field:pt.fieldRef(Qt.field),pulse:on})):Qt.groupby?Rn=pt.add(u8({key:pt.keyRef(Qt.groupby),group:Bi(pt.proxy(dt.parent)),pulse:on})):Object(xe.o)("Facet must specify groupby or field: "+Object(xe.Ba)(Qt));const Fn=pt.fork(),zn=Fn.add(ig()),Vn=Fn.add(wy({pulse:Bi(zn)}));Fn.addData(mn,new Ey(Fn,zn,zn,Vn)),Fn.addSignal("parent",null),Rn.params.subflow={$subflow:Fn.parse(st).toRuntime()}}(e,t,le):se?function(st,pt,dt){const Qt=pt.add(tT({pulse:dt.pulse})),mn=pt.fork();mn.add(wy()),mn.addSignal("parent",null),Qt.params.subflow={$subflow:mn.parse(st).toRuntime()}}(e,t,le):t.parse(e),t.popState(),se&&(Q&&f.push(Q),f.push(nt))),s&&(q=function(st,pt,dt){const Qt=st.method,mn=st.bound,on=st.separation,Rn={separation:gc(on)?dt.signalRef(on.signal):on,method:gc(Qt)?dt.signalRef(Qt.signal):Qt,pulse:pt};if(st.order&&(Rn.sort=dt.compareRef({field:st.order})),mn){const Fn=mn.tolerance;Rn.boundTolerance=gc(Fn)?dt.signalRef(Fn.signal):+Fn,Rn.boundScale=dt.scaleRef(mn.scale),Rn.boundOrient=mn.orient}return Bi(dt.add(g8(Rn)))}(s,q,t));const it=t.add(nT({pulse:q})),ut=t.add(wy({pulse:Bi(it)},void 0,t.parent()));e.name!=null&&(T=e.name,t.addData(T,new Ey(t,x,it,ut)),e.on&&e.on.forEach(st=>{(st.insert||st.remove||st.toggle)&&Object(xe.o)("Marks only support modify triggers."),xT(st,t,T)}))}function $8(e,t){const n=t.config.legend,r=e.encode||{},i=wd(e,n),s=r.legend||{},f=s.name||void 0,m=s.interactive,x=s.style,O={};let T,M,q,Q=0;k3.forEach(ze=>e[ze]?(O[ze]=e[ze],Q=Q||e[ze]):0),Q||Object(xe.o)("Missing valid scale for legend.");const se=function(ze,nt){let it=ze.type||sT;return ze.type||function(ut){return k3.reduce((st,pt)=>st+(ut[pt]?1:0),0)}(ze)!==1||!ze.fill&&!ze.stroke||(it=Xf(nt)?fw:op(nt)?x3:sT),it!==fw?it:op(nt)?x3:fw}(e,t.scaleType(Q)),le={title:e.title!=null,scales:O,type:se,vgrad:se!=="symbol"&&i.isVertical()},Fe=Bi(t.add(ig(null,[le]))),Le=Bi(t.add(f8(M={type:se,scale:t.scaleRef(Q),count:t.objectProperty(i("tickCount")),limit:t.property(i("symbolLimit")),values:t.objectProperty(e.values),minstep:t.property(e.tickMinStep),formatType:t.property(e.formatType),formatSpecifier:t.property(e.format)})));return se===fw?(q=[function(ze,nt,it,ut){const st=wd(ze,it),pt=st.isVertical(),dt=st.gradientThickness(),Qt=st.gradientLength();let mn,on,Rn,Fn,zn;pt?(on=[0,1],Rn=[0,0],Fn=dt,zn=Qt):(on=[0,0],Rn=[1,0],Fn=Qt,zn=dt);const Vn={enter:mn={opacity:mo,x:mo,y:mo,width:Pc(Fn),height:Pc(zn)},update:Object(xe.p)({},mn,{opacity:dm,fill:{gradient:nt,start:on,stop:Rn}}),exit:{opacity:mo}};return bl(Vn,{stroke:st("gradientStrokeColor"),strokeWidth:st("gradientStrokeWidth")},{opacity:st("gradientOpacity")}),_p({type:uT,role:W9,encode:Vn},ut)}(e,Q,n,r.gradient),lT(e,n,r.labels,Le)],M.count=M.count||t.signalRef(`max(2,2*floor((${xy(i.gradientLength())})/100))`)):se===x3?q=[function(ze,nt,it,ut,st){const pt=wd(ze,it),dt=pt.isVertical(),Qt=pt.gradientThickness(),mn=pt.gradientLength();let on,Rn,Fn,zn,Vn="";dt?(on="y",Fn="y2",Rn="x",zn="width",Vn="1-"):(on="x",Fn="x2",Rn="y",zn="height");const Qn={opacity:mo,fill:{scale:nt,field:hm}};Qn[on]={signal:Vn+"datum."+xb,mult:mn},Qn[Rn]=mo,Qn[Fn]={signal:Vn+"datum."+T8,mult:mn},Qn[zn]=Pc(Qt);const pr={enter:Qn,update:Object(xe.p)({},Qn,{opacity:dm}),exit:{opacity:mo}};return bl(pr,{stroke:pt("gradientStrokeColor"),strokeWidth:pt("gradientStrokeWidth")},{opacity:pt("gradientOpacity")}),_p({type:uT,role:z9,key:hm,from:st,encode:pr},ut)}(e,Q,n,r.gradient,Le),lT(e,n,r.labels,Le)]:(T=function(ze,nt){const it=wd(ze,nt);return{align:it("gridAlign"),columns:it.entryColumns(),center:{row:!0,column:!1},padding:{row:it("rowPadding"),column:it("columnPadding")}}}(e,n),q=[function(ze,nt,it,ut,st){const pt=wd(ze,nt),dt=it.entries,Qt=!(!dt||!dt.interactive),mn=dt?dt.name:void 0,on=pt("clipHeight"),Rn=pt("symbolOffset"),Fn={data:"value"},zn=`(${st}) ? datum.${D8} : datum.${w3}`,Vn=on?Pc(on):{field:w3},Qn=`datum.${v3}`,pr=`max(1, ${st})`;let Pr,Ar,Jr,gi,vi;Vn.mult=.5,Pr={enter:Ar={opacity:mo,x:{signal:zn,mult:.5,offset:Rn},y:Vn},update:Jr={opacity:dm,x:Ar.x,y:Ar.y},exit:{opacity:mo}};let Li=null,wi=null;ze.fill||(Li=nt.symbolBaseFillColor,wi=nt.symbolBaseStrokeColor),bl(Pr,{fill:pt("symbolFillColor",Li),shape:pt("symbolType"),size:pt("symbolSize"),stroke:pt("symbolStrokeColor",wi),strokeDash:pt("symbolDash"),strokeDashOffset:pt("symbolDashOffset"),strokeWidth:pt("symbolStrokeWidth")},{opacity:pt("symbolOpacity")}),k3.forEach(no=>{ze[no]&&(Jr[no]=Ar[no]={scale:ze[no],field:hm})});const yi=_p({type:F8,role:V9,key:hm,from:Fn,clip:!!on||void 0,encode:Pr},it.symbols),Si=Pc(Rn);Si.offset=pt("labelOffset"),bl(Pr={enter:Ar={opacity:mo,x:{signal:zn,offset:Si},y:Vn},update:Jr={opacity:dm,text:{field:y3},x:Ar.x,y:Ar.y},exit:{opacity:mo}},{align:pt("labelAlign"),baseline:pt("labelBaseline"),fill:pt("labelColor"),fillOpacity:pt("labelOpacity"),font:pt("labelFont"),fontSize:pt("labelFontSize"),fontStyle:pt("labelFontStyle"),fontWeight:pt("labelFontWeight"),limit:pt("labelLimit")});const xa=_p({type:ky,role:VD,style:R1,key:hm,from:Fn,encode:Pr},it.labels);return Pr={enter:{noBound:{value:!on},width:mo,height:on?Pc(on):mo,opacity:mo},exit:{opacity:mo},update:Jr={opacity:dm,row:{signal:null},column:{signal:null}}},pt.isVertical(!0)?(gi=`ceil(item.mark.items.length / ${pr})`,Jr.row.signal=`${Qn}%${gi}`,Jr.column.signal=`floor(${Qn} / ${gi})`,vi={field:["row",Qn]}):(Jr.row.signal=`floor(${Qn} / ${pr})`,Jr.column.signal=`${Qn} % ${pr}`,vi={field:Qn}),Jr.column.signal=`(${st})?${Jr.column.signal}:${Qn}`,j1({role:c3,from:ut={facet:{data:ut,name:"value",groupby:v3}},encode:yb(Pr,dt,M1),marks:[yi,xa],name:mn,interactive:Qt,sort:vi})}(e,n,r,Le,xy(T.columns))],M.size=function(ze,nt,it){const ut=xy(wT("size",ze,it)),st=xy(wT("strokeWidth",ze,it)),pt=xy(function(dt,Qt,mn){return cT("fontSize",dt)||function(on,Rn,Fn){const zn=Rn.config.style[Fn];return zn&&zn[on]}("fontSize",Qt,mn)}(it[1].encode,nt,R1));return fv(`max(ceil(sqrt(${ut})+${st}),${pt})`,nt)}(e,t,q[0].marks)),q=[j1({role:U9,from:Fe,encode:{enter:{x:{value:0},y:{value:0}}},marks:q,layout:T,interactive:m})],le.title&&q.push(function(ze,nt,it,ut){const st=wd(ze,nt),pt={enter:{opacity:mo},update:{opacity:dm,x:{field:{group:"padding"}},y:{field:{group:"padding"}}},exit:{opacity:mo}};return bl(pt,{orient:st("titleOrient"),_anchor:st("titleAnchor"),anchor:{signal:L8},angle:{signal:z8},align:{signal:P8},baseline:{signal:U8},text:ze.title,fill:st("titleColor"),fillOpacity:st("titleOpacity"),font:st("titleFont"),fontSize:st("titleFontSize"),fontStyle:st("titleFontStyle"),fontWeight:st("titleFontWeight"),limit:st("titleLimit"),lineHeight:st("titleLineHeight")},{align:st("titleAlign"),baseline:st("titleBaseline")}),_p({type:ky,role:q9,style:b3,from:ut,encode:pt},it)}(e,n,r.title,Fe)),gw(j1({role:L9,from:Fe,encode:yb(function(ze,nt,it){const ut={enter:{},update:{}};return bl(ut,{orient:ze("orient"),offset:ze("offset"),padding:ze("padding"),titlePadding:ze("titlePadding"),cornerRadius:ze("cornerRadius"),fill:ze("fillColor"),stroke:ze("strokeColor"),strokeWidth:it.strokeWidth,strokeDash:it.strokeDash,x:ze("legendX"),y:ze("legendY"),format:nt.format,formatType:nt.formatType}),ut}(i,e,n),s,M1),marks:q,aria:i("aria"),description:i("description"),zindex:i("zindex"),name:f,interactive:m,style:x}),t)}function wT(e,t,n){return t[e]?`scale("${t[e]}",datum)`:cT(e,n[0].encode)}Ey.fromEntries=function(e,t){const n=t.length,r=t[n-1],i=t[n-2];let s=t[0],f=null,m=1;for(s&&s.type==="load"&&(s=t[1]),e.add(t[0]);m<n;++m)t[m].params.pulse=Bi(t[m-1]),e.add(t[m]),t[m].type==="aggregate"&&(f=t[m]);return new Ey(e,s,i,r,f)},Ey.prototype={countsRef(e,t,n){const r=this,i=r.counts||(r.counts={}),s=yT(t);let f,m,x;return s!=null&&(e=r.scope,f=i[s]),f?n&&n.field&&bT(e,f.agg.params,n):(x={groupby:e.fieldRef(t,"key"),pulse:Bi(r.output)},n&&n.field&&bT(e,x,n),f={agg:m=e.add(JD(x)),ref:Bi(f=e.add(ig({pulse:Bi(m)})))},s!=null&&(i[s]=f)),f.ref},tuplesRef(){return Bi(this.values)},extentRef(e,t){return B1(e,this,"extent","extent",t,!1)},domainRef(e,t){return B1(e,this,"domain","values",t,!1)},valuesRef(e,t,n){return B1(e,this,"vals","values",t,n||!0)},lookupRef(e,t){return B1(e,this,"lookup","tupleindex",t,!1)},indataRef(e,t){return B1(e,this,"indata","tupleindex",t,!0,!0)}};const G8='item.orient==="left"?-90:item.orient==="right"?90:0';function K8(e,t){const n=wd(e=Object(xe.J)(e)?{text:e}:e,t.config.title),r=e.encode||{},i=r.group||{},s=i.name||void 0,f=i.interactive,m=i.style,x=[],O=Bi(t.add(ig(null,[{}])));return x.push(function(T,M,q,Q){const se={value:0},le=T.text,Fe={enter:{opacity:se},update:{opacity:{value:1}},exit:{opacity:se}};return bl(Fe,{text:le,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:M("dx"),dy:M("dy"),fill:M("color"),font:M("font"),fontSize:M("fontSize"),fontStyle:M("fontStyle"),fontWeight:M("fontWeight"),lineHeight:M("lineHeight")},{align:M("align"),angle:M("angle"),baseline:M("baseline")}),_p({type:ky,role:$9,style:N8,from:Q,encode:Fe},q)}(e,n,function(T){const M=T.encode;return M&&M.title||Object(xe.p)({name:T.name,interactive:T.interactive,style:T.style},M)}(e),O)),e.subtitle&&x.push(function(T,M,q,Q){const se={value:0},le=T.subtitle,Fe={enter:{opacity:se},update:{opacity:{value:1}},exit:{opacity:se}};return bl(Fe,{text:le,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:M("dx"),dy:M("dy"),fill:M("subtitleColor"),font:M("subtitleFont"),fontSize:M("subtitleFontSize"),fontStyle:M("subtitleFontStyle"),fontWeight:M("subtitleFontWeight"),lineHeight:M("subtitleLineHeight")},{align:M("align"),angle:M("angle"),baseline:M("baseline")}),_p({type:ky,role:G9,style:I8,from:Q,encode:Fe},q)}(e,n,r.subtitle,O)),gw(j1({role:H9,from:O,encode:function(T,M){const q={enter:{},update:{}};return bl(q,{orient:T("orient"),anchor:T("anchor"),align:{signal:C3},angle:{signal:G8},limit:T("limit"),frame:T("frame"),offset:T("offset")||0,padding:T("subtitlePadding")}),yb(q,M,M1)}(n,i),marks:x,aria:n("aria"),description:n("description"),zindex:n("zindex"),name:s,interactive:f,style:m}),t)}function X8(e,t){const n=[];e.transform&&e.transform.forEach(r=>{n.push(O3(r,t))}),e.on&&e.on.forEach(r=>{xT(r,t,e.name)}),t.addDataPipeline(e.name,function(r,i,s){const f=[];let m,x,O,T,M,q=null,Q=!1,se=!1;for(r.values?gc(r.values)||uw(r.format)?(f.push(kT(i,r)),f.push(q=Cy())):f.push(q=Cy({$ingest:r.values,$format:r.format})):r.url?uw(r.url)||uw(r.format)?(f.push(kT(i,r)),f.push(q=Cy())):f.push(q=Cy({$request:r.url,$format:r.format})):r.source&&(q=m=Object(xe.i)(r.source).map(le=>Bi(i.getData(le).output)),f.push(null)),x=0,O=s.length;x<O;++x)T=s[x],M=T.metadata,q||M.source||f.push(q=Cy()),f.push(T),M.generates&&(se=!0),M.modifies&&!se&&(Q=!0),M.source?q=T:M.changes&&(q=null);return m&&(O=m.length-1,f[0]=x8({derive:Q,pulse:O?m:m[0]}),(Q||O)&&f.splice(1,0,Cy())),q||f.push(Cy()),f.push(wy({})),f}(e,t,n))}function Cy(e){const t=ig({},e);return t.metadata={source:!0},t}function kT(e,t){return h8({url:t.url?e.property(t.url):void 0,async:t.async?e.property(t.async):void 0,values:t.values?e.property(t.values):void 0,format:e.objectProperty(t.format)})}const ET=e=>e===P0||e===ag,vw=(e,t,n)=>gc(e)?Z8(e.signal,t,n):e==="left"||e===ag?t:n,Lc=(e,t,n)=>gc(e)?J8(e.signal,t,n):ET(e)?t:n,og=(e,t,n)=>gc(e)?Q8(e.signal,t,n):ET(e)?n:t,CT=(e,t,n)=>gc(e)?eB(e.signal,t,n):e===ag?{value:t}:{value:n},Y8=(e,t,n)=>gc(e)?tB(e.signal,t,n):e==="right"?{value:t}:{value:n},J8=(e,t,n)=>OT(`${e} === '${ag}' || ${e} === '${P0}'`,t,n),Q8=(e,t,n)=>OT(`${e} !== '${ag}' && ${e} !== '${P0}'`,t,n),Z8=(e,t,n)=>_3(`${e} === 'left' || ${e} === '${ag}'`,t,n),eB=(e,t,n)=>_3(`${e} === '${ag}'`,t,n),tB=(e,t,n)=>_3(`${e} === 'right'`,t,n),OT=(e,t,n)=>(t=t!=null?Pc(t):t,n=n!=null?Pc(n):n,AT(t)&&AT(n)?{signal:`${e} ? (${t=t?t.signal||Object(xe.Ba)(t.value):null}) : (${n=n?n.signal||Object(xe.Ba)(n.value):null})`}:[Object(xe.p)({test:e},t)].concat(n||[])),AT=e=>e==null||Object.keys(e).length===1,_3=(e,t,n)=>({signal:`${e} ? (${wb(t)}) : (${wb(n)})`}),nB=(e,t,n,r,i)=>({signal:(r!=null?`${e} === 'left' ? (${wb(r)}) : `:"")+(n!=null?`${e} === '${P0}' ? (${wb(n)}) : `:"")+(i!=null?`${e} === 'right' ? (${wb(i)}) : `:"")+(t!=null?`${e} === '${ag}' ? (${wb(t)}) : `:"")+"(null)"}),wb=e=>gc(e)?e.signal:e==null?null:Object(xe.Ba)(e),rB=(e,t)=>t===0?0:gc(e)?{signal:`(${e.signal}) * ${t}`}:{value:e*t},kb=(e,t)=>{const n=e.signal;return n&&n.endsWith("(null)")?{signal:n.slice(0,-6)+t.signal}:e};function Eb(e,t,n,r){let i;if(t&&Object(xe.w)(t,e))return t[e];if(Object(xe.w)(n,e))return n[e];if(e.startsWith("title")){switch(e){case"titleColor":i="fill";break;case"titleFont":case"titleFontSize":case"titleFontWeight":i=e[5].toLowerCase()+e.slice(6)}return r[b3][i]}if(e.startsWith("label")){switch(e){case"labelColor":i="fill";break;case"labelFont":case"labelFontSize":i=e[5].toLowerCase()+e.slice(6)}return r[R1][i]}return null}function _T(e){const t={};for(const n of e)if(n)for(const r in n)t[r]=1;return Object.keys(t)}function ST(e,t){return{scale:e.scale,range:t}}function iB(e,t,n,r,i){const s=wd(e,t),f=e.orient,m=e.gridScale,x=vw(f,1,-1),O=function(ze,nt){if(nt!==1)if(Object(xe.H)(ze)){let it=ze=Object(xe.p)({},ze);for(;it.mult!=null;){if(!Object(xe.H)(it.mult))return it.mult=gc(nt)?{signal:`(${it.mult}) * (${nt.signal})`}:it.mult*nt,ze;it=it.mult=Object(xe.p)({},it.mult)}it.mult=nt}else ze=gc(nt)?{signal:`(${nt.signal}) * (${ze||0})`}:nt*(ze||0);return ze}(e.offset,x);let T,M,q;const Q={enter:T={opacity:mo},update:q={opacity:dm},exit:M={opacity:mo}};bl(Q,{stroke:s("gridColor"),strokeCap:s("gridCap"),strokeDash:s("gridDash"),strokeDashOffset:s("gridDashOffset"),strokeOpacity:s("gridOpacity"),strokeWidth:s("gridWidth")});const se={scale:e.scale,field:hm,band:i.band,extra:i.extra,offset:i.offset,round:s("tickRound")},le=Lc(f,{signal:"height"},{signal:"width"}),Fe=m?{scale:m,range:0,mult:x,offset:O}:{value:0,offset:O},Le=m?{scale:m,range:1,mult:x,offset:O}:Object(xe.p)(le,{mult:x,offset:O});return T.x=q.x=Lc(f,se,Fe),T.y=q.y=og(f,se,Fe),T.x2=q.x2=og(f,Le),T.y2=q.y2=Lc(f,Le),M.x=Lc(f,se),M.y=og(f,se),_p({type:E3,role:M9,key:hm,from:r,encode:Q},n)}function S3(e,t,n,r,i){return{signal:'flush(range("'+e+'"), scale("'+e+'", datum.value), '+t+","+n+","+r+","+i+")"}}function aB(e,t,n,r,i,s){const f=wd(e,t),m=e.orient,x=e.scale,O=vw(m,-1,1),T=xy(f("labelFlush")),M=xy(f("labelFlushOffset")),q=f("labelAlign"),Q=f("labelBaseline");let se,le=T===0||!!T;const Fe=Pc(i);Fe.mult=O,Fe.offset=Pc(f("labelPadding")||0),Fe.offset.mult=O;const Le={scale:x,field:hm,band:.5,offset:function Qt(mn,on){return on?mn?Object(xe.H)(mn)?Object.assign({},mn,{offset:Qt(mn.offset,on)}):{value:mn,offset:on}:on:mn}(s.offset,f("labelOffset"))},ze=Lc(m,le?S3(x,T,'"left"','"right"','"center"'):{value:"center"},Y8(m,"left","right")),nt=Lc(m,CT(m,"bottom","top"),le?S3(x,T,'"top"','"bottom"','"middle"'):{value:"middle"}),it=S3(x,T,`-(${M})`,M,0);le=le&&M;const ut={opacity:mo,x:Lc(m,Le,Fe),y:og(m,Le,Fe)},st={enter:ut,update:se={opacity:dm,text:{field:y3},x:ut.x,y:ut.y,align:ze,baseline:nt},exit:{opacity:mo,x:ut.x,y:ut.y}};bl(st,{dx:!q&&le?Lc(m,it):null,dy:!Q&&le?og(m,it):null}),bl(st,{angle:f("labelAngle"),fill:f("labelColor"),fillOpacity:f("labelOpacity"),font:f("labelFont"),fontSize:f("labelFontSize"),fontWeight:f("labelFontWeight"),fontStyle:f("labelFontStyle"),limit:f("labelLimit"),lineHeight:f("labelLineHeight")},{align:q,baseline:Q});const pt=f("labelBound");let dt=f("labelOverlap");return dt=dt||pt?{separation:f("labelSeparation"),method:dt,order:"datum.index",bound:pt?{scale:x,orient:m,tolerance:pt}:null}:void 0,se.align!==ze&&(se.align=kb(se.align,ze)),se.baseline!==nt&&(se.baseline=kb(se.baseline,nt)),_p({type:ky,role:j9,style:R1,key:hm,from:r,encode:st,overlap:dt},n)}function oB(e,t,n,r){const i=wd(e,t),s=e.orient,f=vw(s,-1,1);let m,x;const O={enter:m={opacity:mo,anchor:Pc(i("titleAnchor",null)),align:{signal:C3}},update:x=Object(xe.p)({},m,{opacity:dm,text:Pc(e.title)}),exit:{opacity:mo}},T={signal:`lerp(range("${e.scale}"), ${dw(0,1,.5)})`};return x.x=Lc(s,T),x.y=og(s,T),m.angle=Lc(s,mo,rB(f,90)),m.baseline=Lc(s,CT(s,P0,ag),{value:P0}),x.angle=m.angle,x.baseline=m.baseline,bl(O,{fill:i("titleColor"),fillOpacity:i("titleOpacity"),font:i("titleFont"),fontSize:i("titleFontSize"),fontStyle:i("titleFontStyle"),fontWeight:i("titleFontWeight"),limit:i("titleLimit"),lineHeight:i("titleLineHeight")},{align:i("titleAlign"),angle:i("titleAngle"),baseline:i("titleBaseline")}),function(M,q,Q,se){const le=(ze,nt)=>ze!=null?(Q.update[nt]=kb(Pc(ze),Q.update[nt]),!1):!bb(nt,se),Fe=le(M("titleX"),"x"),Le=le(M("titleY"),"y");Q.enter.auto=Le===Fe?Pc(Le):Lc(q,Pc(Le),Pc(Fe))}(i,s,O,n),O.update.align=kb(O.update.align,m.align),O.update.angle=kb(O.update.angle,m.angle),O.update.baseline=kb(O.update.baseline,m.baseline),_p({type:ky,role:P9,style:b3,from:r,encode:O},n)}function sB(e,t){const n=function(le,Fe){var Le,ze,nt,it=Fe.config,ut=it.style,st=it.axis,pt=Fe.scaleType(le.scale)==="band"&&it.axisBand,dt=le.orient;if(gc(dt)){const Qt=_T([it.axisX,it.axisY]),mn=_T([it.axisTop,it.axisBottom,it.axisLeft,it.axisRight]);for(nt of(Le={},Qt))Le[nt]=Lc(dt,Eb(nt,it.axisX,st,ut),Eb(nt,it.axisY,st,ut));for(nt of(ze={},mn))ze[nt]=nB(dt.signal,Eb(nt,it.axisTop,st,ut),Eb(nt,it.axisBottom,st,ut),Eb(nt,it.axisLeft,st,ut),Eb(nt,it.axisRight,st,ut))}else Le=dt===ag||dt===P0?it.axisX:it.axisY,ze=it["axis"+dt[0].toUpperCase()+dt.slice(1)];return Le||ze||pt?Object(xe.p)({},st,Le,ze,pt):st}(e,t),r=e.encode||{},i=r.axis||{},s=i.name||void 0,f=i.interactive,m=i.style,x=wd(e,n),O=function(le){const Fe=le("tickBand");let Le,ze,nt=le("tickOffset");return Fe?Fe.signal?(Le={signal:`(${Fe.signal}) === 'extent' ? 1 : 0.5`},ze={signal:`(${Fe.signal}) === 'extent'`},Object(xe.H)(nt)||(nt={signal:`(${Fe.signal}) === 'extent' ? 0 : ${nt}`})):Fe==="extent"?(Le=1,ze=!0,nt=0):(Le=.5,ze=!1):(Le=le("bandPosition"),ze=le("tickExtra")),{extra:ze,band:Le,offset:nt}}(x),T={scale:e.scale,ticks:!!x("ticks"),labels:!!x("labels"),grid:!!x("grid"),domain:!!x("domain"),title:e.title!=null},M=Bi(t.add(ig({},[T]))),q=Bi(t.add(a8({scale:t.scaleRef(e.scale),extra:t.property(O.extra),count:t.objectProperty(e.tickCount),values:t.objectProperty(e.values),minstep:t.property(e.tickMinStep),formatType:t.property(e.formatType),formatSpecifier:t.property(e.format)}))),Q=[];let se;return T.grid&&Q.push(iB(e,n,r.grid,q,O)),T.ticks&&(se=x("tickSize"),Q.push(function(le,Fe,Le,ze,nt,it){const ut=wd(le,Fe),st=le.orient,pt=vw(st,-1,1);let dt,Qt,mn;const on={enter:dt={opacity:mo},update:mn={opacity:dm},exit:Qt={opacity:mo}};bl(on,{stroke:ut("tickColor"),strokeCap:ut("tickCap"),strokeDash:ut("tickDash"),strokeDashOffset:ut("tickDashOffset"),strokeOpacity:ut("tickOpacity"),strokeWidth:ut("tickWidth")});const Rn=Pc(nt);Rn.mult=pt;const Fn={scale:le.scale,field:hm,band:it.band,extra:it.extra,offset:it.offset,round:ut("tickRound")};return mn.y=dt.y=Lc(st,mo,Fn),mn.y2=dt.y2=Lc(st,Rn),Qt.x=Lc(st,Fn),mn.x=dt.x=og(st,mo,Fn),mn.x2=dt.x2=og(st,Rn),Qt.y=og(st,Fn),_p({type:E3,role:B9,key:hm,from:ze,encode:on},Le)}(e,n,r.ticks,q,se,O))),T.labels&&(se=T.ticks?se:0,Q.push(aB(e,n,r.labels,q,se,O))),T.domain&&Q.push(function(le,Fe,Le,ze){const nt=wd(le,Fe),it=le.orient;let ut,st;const pt={enter:ut={opacity:mo},update:st={opacity:dm},exit:{opacity:mo}};bl(pt,{stroke:nt("domainColor"),strokeCap:nt("domainCap"),strokeDash:nt("domainDash"),strokeDashOffset:nt("domainDashOffset"),strokeWidth:nt("domainWidth"),strokeOpacity:nt("domainOpacity")});const dt=ST(le,0),Qt=ST(le,1);return ut.x=st.x=Lc(it,dt,mo),ut.x2=st.x2=Lc(it,Qt),ut.y=st.y=og(it,dt,mo),ut.y2=st.y2=og(it,Qt),_p({type:E3,role:R9,from:ze,encode:pt},Le)}(e,n,r.domain,M)),T.title&&Q.push(oB(e,n,r.title,M)),gw(j1({role:F9,from:M,encode:yb(function(le,Fe){const Le={enter:{},update:{}};return bl(Le,{orient:le("orient"),offset:le("offset")||0,position:rg(Fe.position,0),titlePadding:le("titlePadding"),minExtent:le("minExtent"),maxExtent:le("maxExtent"),range:{signal:`abs(span(range("${Fe.scale}")))`},translate:le("translate"),format:Fe.format,formatType:Fe.formatType}),Le}(x,e),i,M1),marks:Q,aria:x("aria"),description:x("description"),zindex:x("zindex"),name:s,interactive:f,style:m}),t)}function DT(e,t,n){const r=Object(xe.i)(e.signals),i=Object(xe.i)(e.scales);return n||r.forEach(s=>KD(s,t)),Object(xe.i)(e.projections).forEach(s=>function(f,m){const x=m.config.projection||{},O={};for(const T in f)T!=="name"&&(O[T]=g3(f[T],T,m));for(const T in x)O[T]==null&&(O[T]=g3(x[T],T,m));m.addProjection(f.name,O)}(s,t)),i.forEach(s=>function(f,m){const x=f.type||"linear";ap(x)||Object(xe.o)("Unrecognized scale type: "+Object(xe.Ba)(x)),m.addScale(f.name,{type:x,domain:void 0})}(s,t)),Object(xe.i)(e.data).forEach(s=>X8(s,t)),i.forEach(s=>O8(s,t)),(n||r).forEach(s=>function(f,m){const x=m.getSignal(f.name);let O=f.update;f.init&&(O?Object(xe.o)("Signals can not include both init and update expressions."):(O=f.init,x.initonly=!0)),O&&(O=fv(O,m),x.update=O.$expr,x.params=O.$params),f.on&&f.on.forEach(T=>i8(T,m,x.id))}(s,t)),Object(xe.i)(e.axes).forEach(s=>sB(s,t)),Object(xe.i)(e.marks).forEach(s=>gw(s,t)),Object(xe.i)(e.legends).forEach(s=>$8(s,t)),e.title&&K8(e.title,t),t.parseLambdas(),t}const uB=e=>yb({enter:{x:{value:0},y:{value:0}},update:{width:{signal:"width"},height:{signal:"height"}}},e);function cB(e,t){const n=t.config,r=Bi(t.root=t.add(ow())),i=function(O,T){const M=le=>rg(O[le],T[le]),q=[P1("background",M("background")),P1("autosize",function(le){return Object(xe.H)(le)?le:{type:le||"pad"}}(M("autosize"))),P1("padding",function(le){return Object(xe.H)(le)?le.signal?le:{top:N1(le.top),bottom:N1(le.bottom),left:N1(le.left),right:N1(le.right)}:I9(N1(le))}(M("padding"))),P1("width",M("width")||0),P1("height",M("height")||0)],Q=q.reduce((le,Fe)=>(le[Fe.name]=Fe,le),{}),se={};return Object(xe.i)(O.signals).forEach(le=>{Object(xe.w)(Q,le.name)?le=Object(xe.p)(Q[le.name],le):q.push(le),se[le.name]=le}),Object(xe.i)(T.signals).forEach(le=>{Object(xe.w)(se,le.name)||Object(xe.w)(Q,le.name)||q.push(le)}),q}(e,n);i.forEach(O=>KD(O,t)),t.description=e.description||n.description,t.eventConfig=n.events,t.legends=t.objectProperty(n.legend&&n.legend.layout),t.locale=n.locale;const s=t.add(ig()),f=t.add(eT($D(uB(e.encode),hw,u3,e.style,t,{pulse:Bi(s)}))),m=t.add(rT({layout:t.objectProperty(e.layout),legends:t.legends,autosize:t.signalRef("autosize"),mark:r,pulse:Bi(f)}));t.operators.pop(),t.pushState(Bi(f),Bi(m),null),DT(e,t,i),t.operators.push(m);let x=t.add(QD({mark:r,pulse:Bi(m)}));return x=t.add(nT({pulse:Bi(x)})),x=t.add(wy({pulse:Bi(x)})),t.addData("root",new Ey(t,s,s,x)),t}function P1(e,t){return t&&t.signal?{name:e,update:t.signal}:{name:e,value:t}}function TT(e,t){this.config=e||{},this.options=t||{},this.bindings=[],this.field={},this.signals={},this.lambdas={},this.scales={},this.events={},this.data={},this.streams=[],this.updates=[],this.operators=[],this.eventConfig=null,this.locale=null,this._id=0,this._subid=0,this._nextsub=[0],this._parent=[],this._encode=[],this._lookup=[],this._markpath=[]}function NT(e){this.config=e.config,this.options=e.options,this.legends=e.legends,this.field=Object.create(e.field),this.signals=Object.create(e.signals),this.lambdas=Object.create(e.lambdas),this.scales=Object.create(e.scales),this.events=Object.create(e.events),this.data=Object.create(e.data),this.streams=[],this.updates=[],this.operators=[],this._id=0,this._subid=++e._nextsub[0],this._nextsub=e._nextsub,this._parent=e._parent.slice(),this._encode=e._encode.slice(),this._lookup=e._lookup.slice(),this._markpath=e._markpath}function D3(e){return(Object(xe.B)(e)?function(t){const n=t.length;let r="[";for(let i=0;i<n;++i){const s=t[i];r+=(i>0?",":"")+(Object(xe.H)(s)?s.signal||D3(s):Object(xe.Ba)(s))}return r+"]"}:function(t){let n,r,i="{",s=0;for(n in t)r=t[n],i+=(++s>1?",":"")+Object(xe.Ba)(n)+":"+(Object(xe.H)(r)?r.signal||D3(r):Object(xe.Ba)(r));return i+"}"})(e)}function lB(e,t,n){return Object(xe.H)(e)||Object(xe.o)("Input Vega specification must be an object."),cB(e,new TT(t=Object(xe.P)({description:"Vega visualization",padding:0,autosize:"pad",background:null,events:{defaults:{allow:["wheel"]}},group:null,mark:null,arc:{fill:"#4c78a8"},area:{fill:"#4c78a8"},image:null,line:{stroke:"#4c78a8",strokeWidth:2},path:{stroke:"#4c78a8"},rect:{fill:"#4c78a8"},rule:{stroke:"#000"},shape:{stroke:"#4c78a8"},symbol:{fill:"#4c78a8",size:64},text:{fill:"#000",font:"sans-serif",fontSize:11},trail:{fill:"#4c78a8",size:2},style:{"guide-label":{fill:"#000",font:"sans-serif",fontSize:10},"guide-title":{fill:"#000",font:"sans-serif",fontSize:11,fontWeight:"bold"},"group-title":{fill:"#000",font:"sans-serif",fontSize:13,fontWeight:"bold"},"group-subtitle":{fill:"#000",font:"sans-serif",fontSize:12},point:{size:30,strokeWidth:2,shape:"circle"},circle:{size:30,strokeWidth:2},square:{size:30,strokeWidth:2,shape:"square"},cell:{fill:"transparent",stroke:"#ddd"}},title:{orient:"top",anchor:"middle",offset:4,subtitlePadding:3},axis:{minExtent:0,maxExtent:200,bandPosition:.5,domain:!0,domainWidth:1,domainColor:"#888",grid:!1,gridWidth:1,gridColor:"#ddd",labels:!0,labelAngle:0,labelLimit:180,labelOffset:0,labelPadding:2,ticks:!0,tickColor:"#888",tickOffset:0,tickRound:!0,tickSize:5,tickWidth:1,titlePadding:4},axisBand:{tickOffset:-.5},projection:{type:"mercator"},legend:{orient:"right",padding:0,gridAlign:"each",columnPadding:10,rowPadding:2,symbolDirection:"vertical",gradientDirection:"vertical",gradientLength:200,gradientThickness:16,gradientStrokeColor:"#ddd",gradientStrokeWidth:0,gradientLabelOffset:2,labelAlign:"left",labelBaseline:"middle",labelLimit:160,labelOffset:4,labelOverlap:!0,symbolLimit:30,symbolType:"circle",symbolSize:100,symbolOffset:0,symbolStrokeWidth:1.5,symbolBaseFillColor:"transparent",symbolBaseStrokeColor:"#888",titleLimit:180,titleOrient:"top",titlePadding:5,layout:{offset:18,direction:"horizontal",left:{direction:"vertical"},right:{direction:"vertical"}}},range:{category:{scheme:"tableau10"},ordinal:{scheme:"blues"},heatmap:{scheme:"yellowgreenblue"},ramp:{scheme:"blues"},diverging:{scheme:"blueorange",extent:[1,0]},symbol:["circle","square","triangle-up","cross","diamond","triangle-right","triangle-down","triangle-left"]}},t,e.config),n)).toRuntime()}TT.prototype=NT.prototype={parse(e){return DT(e,this)},fork(){return new NT(this)},isSubscope(){return this._subid>0},toRuntime(){return this.finish(),{description:this.description,operators:this.operators,streams:this.streams,updates:this.updates,bindings:this.bindings,eventConfig:this.eventConfig,locale:this.locale}},id(){return(this._subid?this._subid+":":0)+this._id++},add(e){return this.operators.push(e),e.id=this.id(),e.refs&&(e.refs.forEach(t=>{t.$ref=e.id}),e.refs=null),e},proxy(e){const t=e instanceof f3?Bi(e):e;return this.add(b8({value:t}))},addStream(e){return this.streams.push(e),e.id=this.id(),e},addUpdate(e){return this.updates.push(e),e},finish(){let e,t;for(e in this.root&&(this.root.root=!0),this.signals)this.signals[e].signal=e;for(e in this.scales)this.scales[e].scale=e;function n(r,i,s){let f;r&&((f=r.data||(r.data={}))[i]||(f[i]=[])).push(s)}for(e in this.data){n((t=this.data[e]).input,e,"input"),n(t.output,e,"output"),n(t.values,e,"values");for(const r in t.index)n(t.index[r],e,"index:"+r)}return this},pushState(e,t,n){this._encode.push(Bi(this.add(wy({pulse:e})))),this._parent.push(t),this._lookup.push(n?Bi(this.proxy(n)):null),this._markpath.push(-1)},popState(){this._encode.pop(),this._parent.pop(),this._lookup.pop(),this._markpath.pop()},parent(){return Object(xe.W)(this._parent)},encode(){return Object(xe.W)(this._encode)},lookup(){return Object(xe.W)(this._lookup)},markpath(){const e=this._markpath;return++e[e.length-1]},fieldRef(e,t){if(Object(xe.J)(e))return I1(e,t);e.signal||Object(xe.o)("Unsupported field reference: "+Object(xe.Ba)(e));const n=e.signal;let r=this.field[n];if(!r){const i={name:this.signalRef(n)};t&&(i.as=t),this.field[n]=r=Bi(this.add(c8(i)))}return r},compareRef(e){let t=!1;const n=s=>gc(s)?(t=!0,this.signalRef(s.signal)):function(f){return f&&f.expr}(s)?(t=!0,this.exprRef(s.expr)):s,r=Object(xe.i)(e.field).map(n),i=Object(xe.i)(e.order).map(n);return t?Bi(this.add(ZD({fields:r,orders:i}))):XD(r,i)},keyRef(e,t){let n=!1;const r=this.signals;return e=Object(xe.i)(e).map(i=>gc(i)?(n=!0,Bi(r[i.signal])):i),n?Bi(this.add(l8({fields:e,flat:t}))):function(i,s){const f={$key:i};return s&&(f.$flat=!0),f}(e,t)},sortRef(e){if(!e)return e;const t=sw(e.op,e.field),n=e.order||"ascending";return n.signal?Bi(this.add(ZD({fields:t,orders:this.signalRef(n.signal)}))):XD(t,n)},event(e,t){const n=e+":"+t;if(!this.events[n]){const r=this.id();this.streams.push({id:r,source:e,type:t}),this.events[n]=r}return this.events[n]},hasOwnSignal(e){return Object(xe.w)(this.signals,e)},addSignal(e,t){this.hasOwnSignal(e)&&Object(xe.o)("Duplicate signal name: "+Object(xe.Ba)(e));const n=t instanceof f3?t:this.add(ow(t));return this.signals[e]=n},getSignal(e){return this.signals[e]||Object(xe.o)("Unrecognized signal name: "+Object(xe.Ba)(e)),this.signals[e]},signalRef(e){return this.signals[e]?Bi(this.signals[e]):(Object(xe.w)(this.lambdas,e)||(this.lambdas[e]=this.add(ow(null))),Bi(this.lambdas[e]))},parseLambdas(){const e=Object.keys(this.lambdas);for(let t=0,n=e.length;t<n;++t){const r=e[t],i=fv(r,this),s=this.lambdas[r];s.params=i.$params,s.update=i.$expr}},property(e){return e&&e.signal?this.signalRef(e.signal):e},objectProperty(e){return e&&Object(xe.H)(e)?this.signalRef(e.signal||D3(e)):e},exprRef(e,t){const n={expr:fv(e,this)};return t&&(n.expr.$name=t),Bi(this.add(s8(n)))},addBinding(e,t){this.bindings||Object(xe.o)("Nested signals do not support binding: "+Object(xe.Ba)(e)),this.bindings.push(Object(xe.p)({signal:e},t))},addScaleProj(e,t){Object(xe.w)(this.scales,e)&&Object(xe.o)("Duplicate scale or projection name: "+Object(xe.Ba)(e)),this.scales[e]=this.add(t)},addScale(e,t){this.addScaleProj(e,w8(t))},addProjection(e,t){this.addScaleProj(e,y8(t))},getScale(e){return this.scales[e]||Object(xe.o)("Unrecognized scale name: "+Object(xe.Ba)(e)),this.scales[e]},scaleRef(e){return Bi(this.getScale(e))},scaleType(e){return this.getScale(e).params.type},projectionRef(e){return this.scaleRef(e)},projectionType(e){return this.scaleType(e)},addData(e,t){return Object(xe.w)(this.data,e)&&Object(xe.o)("Duplicate data set name: "+Object(xe.Ba)(e)),this.data[e]=t},getData(e){return this.data[e]||Object(xe.o)("Undefined data set name: "+Object(xe.Ba)(e)),this.data[e]},addDataPipeline(e,t){return Object(xe.w)(this.data,e)&&Object(xe.o)("Duplicate data set name: "+Object(xe.Ba)(e)),this.addData(e,Ey.fromEntries(this,t))}};const fB="RawCode",hB="Literal",dB="Property",pB="Identifier",mB="ArrayExpression",gB="BinaryExpression",vB="CallExpression",yB="ConditionalExpression",bB="LogicalExpression",xB="MemberExpression",wB="ObjectExpression",kB="UnaryExpression";function sg(e){this.type=e}var Zv,Ai,Dr,cf,Qo;sg.prototype.visit=function(e){let t,n,r;if(e(this))return 1;for(n=0,r=(t=function(i){switch(i.type){case mB:return i.elements;case gB:case bB:return[i.left,i.right];case vB:return[i.callee].concat(i.arguments);case yB:return[i.test,i.consequent,i.alternate];case xB:return[i.object,i.property];case wB:return i.properties;case dB:return[i.key,i.value];case kB:return[i.argument];case pB:case hB:case fB:default:return[]}}(this)).length;n<r;++n)if(t[n].visit(e))return 1};var yw=1,L1=2,Oy=3,L0=4,bw=5,Ay=6,kd=7,z1=8;(Zv={})[yw]="Boolean",Zv[L1]="<end>",Zv[Oy]="Identifier",Zv[L0]="Keyword",Zv[bw]="Null",Zv[Ay]="Numeric",Zv[kd]="Punctuator",Zv[z1]="String",Zv[9]="RegularExpression";var EB="ArrayExpression",CB="BinaryExpression",OB="CallExpression",AB="ConditionalExpression",IT="Identifier",_B="Literal",SB="LogicalExpression",DB="MemberExpression",TB="ObjectExpression",NB="Property",IB="UnaryExpression",zc="Unexpected token %0",FB="Unexpected number",RB="Unexpected string",MB="Unexpected identifier",jB="Unexpected reserved word",BB="Unexpected end of input",T3="Invalid regular expression",N3="Invalid regular expression: missing /",FT="Octal literals are not allowed in strict mode.",PB="Duplicate data property in object literal not allowed in strict mode",xl="ILLEGAL",U1="Disabled.",LB=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),zB=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function xw(e,t){if(!e)throw new Error("ASSERT: "+t)}function e0(e){return e>=48&&e<=57}function I3(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function W1(e){return"01234567".indexOf(e)>=0}function UB(e){return e===32||e===9||e===11||e===12||e===160||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function V1(e){return e===10||e===13||e===8232||e===8233}function q1(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e===92||e>=128&&LB.test(String.fromCharCode(e))}function ww(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||e===92||e>=128&&zB.test(String.fromCharCode(e))}const WB={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function RT(){for(;Dr<cf;){const e=Ai.charCodeAt(Dr);if(!UB(e)&&!V1(e))break;++Dr}}function F3(e){var t,n,r,i=0;for(n=e==="u"?4:2,t=0;t<n;++t)Dr<cf&&I3(Ai[Dr])?(r=Ai[Dr++],i=16*i+"0123456789abcdef".indexOf(r.toLowerCase())):To({},zc,xl);return String.fromCharCode(i)}function VB(){var e,t,n,r;for(t=0,(e=Ai[Dr])==="}"&&To({},zc,xl);Dr<cf&&I3(e=Ai[Dr++]);)t=16*t+"0123456789abcdef".indexOf(e.toLowerCase());return(t>1114111||e!=="}")&&To({},zc,xl),t<=65535?String.fromCharCode(t):(n=55296+(t-65536>>10),r=56320+(t-65536&1023),String.fromCharCode(n,r))}function MT(){var e,t;for(e=Ai.charCodeAt(Dr++),t=String.fromCharCode(e),e===92&&(Ai.charCodeAt(Dr)!==117&&To({},zc,xl),++Dr,(e=F3("u"))&&e!=="\\"&&q1(e.charCodeAt(0))||To({},zc,xl),t=e);Dr<cf&&ww(e=Ai.charCodeAt(Dr));)++Dr,t+=String.fromCharCode(e),e===92&&(t=t.substr(0,t.length-1),Ai.charCodeAt(Dr)!==117&&To({},zc,xl),++Dr,(e=F3("u"))&&e!=="\\"&&ww(e.charCodeAt(0))||To({},zc,xl),t+=e);return t}function qB(){var e,t;return e=Dr,{type:(t=Ai.charCodeAt(Dr)===92?MT():function(){var n,r;for(n=Dr++;Dr<cf;){if((r=Ai.charCodeAt(Dr))===92)return Dr=n,MT();if(!ww(r))break;++Dr}return Ai.slice(n,Dr)}()).length===1?Oy:WB.hasOwnProperty(t)?L0:t==="null"?bw:t==="true"||t==="false"?yw:Oy,value:t,start:e,end:Dr}}function R3(){var e,t,n,r,i=Dr,s=Ai.charCodeAt(Dr),f=Ai[Dr];switch(s){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++Dr,{type:kd,value:String.fromCharCode(s),start:i,end:Dr};default:if((e=Ai.charCodeAt(Dr+1))===61)switch(s){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return Dr+=2,{type:kd,value:String.fromCharCode(s)+String.fromCharCode(e),start:i,end:Dr};case 33:case 61:return Dr+=2,Ai.charCodeAt(Dr)===61&&++Dr,{type:kd,value:Ai.slice(i,Dr),start:i,end:Dr}}}return(r=Ai.substr(Dr,4))===">>>="?{type:kd,value:r,start:i,end:Dr+=4}:(n=r.substr(0,3))===">>>"||n==="<<="||n===">>="?{type:kd,value:n,start:i,end:Dr+=3}:f===(t=n.substr(0,2))[1]&&"+-<>&|".indexOf(f)>=0||t==="=>"?{type:kd,value:t,start:i,end:Dr+=2}:(t==="//"&&To({},zc,xl),"<>=!+-*%&|^/".indexOf(f)>=0?{type:kd,value:f,start:i,end:++Dr}:void To({},zc,xl))}function jT(){var e,t,n;if(xw(e0((n=Ai[Dr]).charCodeAt(0))||n===".","Numeric literal must start with a decimal digit or a decimal point"),t=Dr,e="",n!=="."){if(e=Ai[Dr++],n=Ai[Dr],e==="0"){if(n==="x"||n==="X")return++Dr,function(r){let i="";for(;Dr<cf&&I3(Ai[Dr]);)i+=Ai[Dr++];return i.length===0&&To({},zc,xl),q1(Ai.charCodeAt(Dr))&&To({},zc,xl),{type:Ay,value:parseInt("0x"+i,16),start:r,end:Dr}}(t);if(W1(n))return function(r){let i="0"+Ai[Dr++];for(;Dr<cf&&W1(Ai[Dr]);)i+=Ai[Dr++];return(q1(Ai.charCodeAt(Dr))||e0(Ai.charCodeAt(Dr)))&&To({},zc,xl),{type:Ay,value:parseInt(i,8),octal:!0,start:r,end:Dr}}(t);n&&e0(n.charCodeAt(0))&&To({},zc,xl)}for(;e0(Ai.charCodeAt(Dr));)e+=Ai[Dr++];n=Ai[Dr]}if(n==="."){for(e+=Ai[Dr++];e0(Ai.charCodeAt(Dr));)e+=Ai[Dr++];n=Ai[Dr]}if(n==="e"||n==="E")if(e+=Ai[Dr++],(n=Ai[Dr])!=="+"&&n!=="-"||(e+=Ai[Dr++]),e0(Ai.charCodeAt(Dr)))for(;e0(Ai.charCodeAt(Dr));)e+=Ai[Dr++];else To({},zc,xl);return q1(Ai.charCodeAt(Dr))&&To({},zc,xl),{type:Ay,value:parseFloat(e),start:t,end:Dr}}function HB(){var e,t,n,r;return Qo=null,RT(),e=Dr,t=function(){var i,s,f,m;for(xw((i=Ai[Dr])==="/","Regular expression literal must start with a slash"),s=Ai[Dr++],f=!1,m=!1;Dr<cf;)if(s+=i=Ai[Dr++],i==="\\")V1((i=Ai[Dr++]).charCodeAt(0))&&To({},N3),s+=i;else if(V1(i.charCodeAt(0)))To({},N3);else if(f)i==="]"&&(f=!1);else{if(i==="/"){m=!0;break}i==="["&&(f=!0)}return m||To({},N3),{value:s.substr(1,s.length-2),literal:s}}(),n=function(){var i,s,f;for(s="",f="";Dr<cf&&ww((i=Ai[Dr]).charCodeAt(0));)++Dr,i==="\\"&&Dr<cf?To({},zc,xl):(f+=i,s+=i);return f.search(/[^gimuy]/g)>=0&&To({},T3,f),{value:f,literal:s}}(),r=function(i,s){let f=i;s.indexOf("u")>=0&&(f=f.replace(/\\u\{([0-9a-fA-F]+)\}/g,(m,x)=>{if(parseInt(x,16)<=1114111)return"x";To({},T3)}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(f)}catch{To({},T3)}try{return new RegExp(i,s)}catch{return null}}(t.value,n.value),{literal:t.literal+n.literal,value:r,regex:{pattern:t.value,flags:n.value},start:e,end:Dr}}function BT(){if(RT(),Dr>=cf)return{type:L1,start:Dr,end:Dr};const e=Ai.charCodeAt(Dr);return q1(e)?qB():e===40||e===41||e===59?R3():e===39||e===34?function(){var t,n,r,i,s="",f=!1;for(xw((t=Ai[Dr])==="'"||t==='"',"String literal must starts with a quote"),n=Dr,++Dr;Dr<cf;){if((r=Ai[Dr++])===t){t="";break}if(r==="\\")if((r=Ai[Dr++])&&V1(r.charCodeAt(0)))r==="\r"&&Ai[Dr]===`
`&&++Dr;else switch(r){case"u":case"x":Ai[Dr]==="{"?(++Dr,s+=VB()):s+=F3(r);break;case"n":s+=`
`;break;case"r":s+="\r";break;case"t":s+="	";break;case"b":s+="\b";break;case"f":s+="\f";break;case"v":s+="\v";break;default:W1(r)?((i="01234567".indexOf(r))!==0&&(f=!0),Dr<cf&&W1(Ai[Dr])&&(f=!0,i=8*i+"01234567".indexOf(Ai[Dr++]),"0123".indexOf(r)>=0&&Dr<cf&&W1(Ai[Dr])&&(i=8*i+"01234567".indexOf(Ai[Dr++]))),s+=String.fromCharCode(i)):s+=r}else{if(V1(r.charCodeAt(0)))break;s+=r}}return t!==""&&To({},zc,xl),{type:z1,value:s,octal:f,start:n,end:Dr}}():e===46?e0(Ai.charCodeAt(Dr+1))?jT():R3():e0(e)?jT():R3()}function Ed(){const e=Qo;return Dr=e.end,Qo=BT(),Dr=e.end,e}function PT(){const e=Dr;Qo=BT(),Dr=e}function LT(e,t,n){const r=new sg(e==="||"||e==="&&"?SB:CB);return r.operator=e,r.left=t,r.right=n,r}function $B(e,t){const n=new sg(OB);return n.callee=e,n.arguments=t,n}function M3(e){const t=new sg(IT);return t.name=e,t}function H1(e){const t=new sg(_B);return t.value=e.value,t.raw=Ai.slice(e.start,e.end),e.regex&&(t.raw==="//"&&(t.raw="/(?:)/"),t.regex=e.regex),t}function zT(e,t,n){const r=new sg(DB);return r.computed=e==="[",r.object=t,r.property=n,r.computed||(n.member=!0),r}function UT(e,t,n){const r=new sg(NB);return r.key=t,r.value=n,r.kind=e,r}function To(e,t){var n,r=Array.prototype.slice.call(arguments,2),i=t.replace(/%(\d)/g,(s,f)=>(xw(f<r.length,"Message reference must be in range"),r[f]));throw(n=new Error(i)).index=Dr,n.description=i,n}function kw(e){e.type===L1&&To(e,BB),e.type===Ay&&To(e,FB),e.type===z1&&To(e,RB),e.type===Oy&&To(e,MB),e.type===L0&&To(e,jB),To(e,zc,e.value)}function lf(e){const t=Ed();t.type===kd&&t.value===e||kw(t)}function Ps(e){return Qo.type===kd&&Qo.value===e}function j3(e){return Qo.type===L0&&Qo.value===e}function GB(){const e=[];for(Dr=Qo.start,lf("[");!Ps("]");)Ps(",")?(Ed(),e.push(null)):(e.push(_y()),Ps("]")||lf(","));return Ed(),function(t){const n=new sg(EB);return n.elements=t,n}(e)}function WT(){Dr=Qo.start;const e=Ed();return e.type===z1||e.type===Ay?(e.octal&&To(e,FT),H1(e)):M3(e.value)}function KB(){var e,t,n;return Dr=Qo.start,(e=Qo).type===Oy?(n=WT(),lf(":"),UT("init",n,_y())):e.type!==L1&&e.type!==kd?(t=WT(),lf(":"),UT("init",t,_y())):void kw(e)}function XB(){var e,t,n=[],r={},i=String;for(Dr=Qo.start,lf("{");!Ps("}");)t="$"+((e=KB()).key.type===IT?e.key.name:i(e.key.value)),Object.prototype.hasOwnProperty.call(r,t)?To({},PB):r[t]=!0,n.push(e),Ps("}")||lf(",");return lf("}"),function(s){const f=new sg(TB);return f.properties=s,f}(n)}const YB={if:1};function JB(){var e,t,n;if(Ps("("))return function(){lf("(");const r=B3();return lf(")"),r}();if(Ps("["))return GB();if(Ps("{"))return XB();if(e=Qo.type,Dr=Qo.start,e===Oy||YB[Qo.value])n=M3(Ed().value);else if(e===z1||e===Ay)Qo.octal&&To(Qo,FT),n=H1(Ed());else{if(e===L0)throw new Error(U1);e===yw?((t=Ed()).value=t.value==="true",n=H1(t)):e===bw?((t=Ed()).value=null,n=H1(t)):Ps("/")||Ps("/=")?(n=H1(HB()),PT()):kw(Ed())}return n}function QB(){const e=[];if(lf("("),!Ps(")"))for(;Dr<cf&&(e.push(_y()),!Ps(")"));)lf(",");return lf(")"),e}function ZB(){Dr=Qo.start;const e=Ed();return function(t){return t.type===Oy||t.type===L0||t.type===yw||t.type===bw}(e)||kw(e),M3(e.value)}function e7(){lf("[");const e=B3();return lf("]"),e}function VT(){const e=function(){var t;for(t=JB();;)if(Ps("."))lf("."),t=zT(".",t,ZB());else if(Ps("("))t=$B(t,QB());else{if(!Ps("["))break;t=zT("[",t,e7())}return t}();if(Qo.type===kd&&(Ps("++")||Ps("--")))throw new Error(U1);return e}function Ew(){var e,t;if(Qo.type!==kd&&Qo.type!==L0)t=VT();else{if(Ps("++")||Ps("--"))throw new Error(U1);if(Ps("+")||Ps("-")||Ps("~")||Ps("!"))e=Ed(),t=Ew(),t=function(n,r){const i=new sg(IB);return i.operator=n,i.argument=r,i.prefix=!0,i}(e.value,t);else{if(j3("delete")||j3("void")||j3("typeof"))throw new Error(U1);t=VT()}}return t}function qT(e){let t=0;if(e.type!==kd&&e.type!==L0)return 0;switch(e.value){case"||":t=1;break;case"&&":t=2;break;case"|":t=3;break;case"^":t=4;break;case"&":t=5;break;case"==":case"!=":case"===":case"!==":t=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":t=7;break;case"<<":case">>":case">>>":t=8;break;case"+":case"-":t=9;break;case"*":case"/":case"%":t=11}return t}function _y(){var e,t;return e=function(){var n,r,i,s,f,m,x,O,T,M;if(n=Qo,T=Ew(),(f=qT(s=Qo))===0)return T;for(s.prec=f,Ed(),r=[n,Qo],m=[T,s,x=Ew()];(f=qT(Qo))>0;){for(;m.length>2&&f<=m[m.length-2].prec;)x=m.pop(),O=m.pop().value,T=m.pop(),r.pop(),i=LT(O,T,x),m.push(i);(s=Ed()).prec=f,m.push(s),r.push(Qo),i=Ew(),m.push(i)}for(i=m[M=m.length-1],r.pop();M>1;)r.pop(),i=LT(m[M-1].value,m[M-2],i),M-=2;return i}(),Ps("?")&&(Ed(),t=_y(),lf(":"),e=function(n,r,i){const s=new sg(AB);return s.test=n,s.consequent=r,s.alternate=i,s}(e,t,_y())),e}function B3(){const e=_y();if(Ps(","))throw new Error(U1);return e}function t7(e){Dr=0,cf=(Ai=e).length,Qo=null,PT();const t=B3();if(Qo.type!==L1)throw new Error("Unexpect token after expression.");return t}var n7={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2",MIN_VALUE:"Number.MIN_VALUE",MAX_VALUE:"Number.MAX_VALUE"};function r7(e){function t(r,i,s){return f=>function(m,x,O,T){let M=e(x[0]);return O&&(M=O+"("+M+")",O.lastIndexOf("new ",0)===0&&(M="("+M+")")),M+"."+m+(T<0?"":T===0?"()":"("+x.slice(1).map(e).join(",")+")")}(r,f,i,s)}const n="new Date";return{isNaN:"Number.isNaN",isFinite:"Number.isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",clamp:function(r){r.length<3&&Object(xe.o)("Missing arguments to clamp function."),r.length>3&&Object(xe.o)("Too many arguments to clamp function.");const i=r.map(e);return"Math.max("+i[1]+", Math.min("+i[2]+","+i[0]+"))"},now:"Date.now",utc:"Date.UTC",datetime:n,date:t("getDate",n,0),day:t("getDay",n,0),year:t("getFullYear",n,0),month:t("getMonth",n,0),hours:t("getHours",n,0),minutes:t("getMinutes",n,0),seconds:t("getSeconds",n,0),milliseconds:t("getMilliseconds",n,0),time:t("getTime",n,0),timezoneoffset:t("getTimezoneOffset",n,0),utcdate:t("getUTCDate",n,0),utcday:t("getUTCDay",n,0),utcyear:t("getUTCFullYear",n,0),utcmonth:t("getUTCMonth",n,0),utchours:t("getUTCHours",n,0),utcminutes:t("getUTCMinutes",n,0),utcseconds:t("getUTCSeconds",n,0),utcmilliseconds:t("getUTCMilliseconds",n,0),length:t("length",null,-1),parseFloat:"parseFloat",parseInt:"parseInt",upper:t("toUpperCase","String",0),lower:t("toLowerCase","String",0),substring:t("substring","String"),split:t("split","String"),trim:t("trim","String",0),regexp:"RegExp",test:t("test","RegExp"),if:function(r){r.length<3&&Object(xe.o)("Missing arguments to if function."),r.length>3&&Object(xe.o)("Too many arguments to if function.");const i=r.map(e);return"("+i[0]+"?"+i[1]+":"+i[2]+")"}}}function i7(e){const t=(e=e||{}).allowed?Object(xe.Fa)(e.allowed):{},n=e.forbidden?Object(xe.Fa)(e.forbidden):{},r=e.constants||n7,i=(e.functions||r7)(M),s=e.globalvar,f=e.fieldvar,m=Object(xe.E)(s)?s:se=>"".concat(s,'["').concat(se,'"]');let x={},O={},T=0;function M(se){if(Object(xe.J)(se))return se;const le=q[se.type];return le==null&&Object(xe.o)("Unsupported type: "+se.type),le(se)}const q={Literal:se=>se.raw,Identifier:se=>{const le=se.name;return T>0?le:Object(xe.w)(n,le)?Object(xe.o)("Illegal identifier: "+le):Object(xe.w)(r,le)?r[le]:Object(xe.w)(t,le)?le:(x[le]=1,m(le))},MemberExpression:se=>{const le=!se.computed,Fe=M(se.object);le&&(T+=1);const Le=M(se.property);return Fe===f&&(O[function(ze){const nt=ze&&ze.length-1;return nt&&(ze[0]==='"'&&ze[nt]==='"'||ze[0]==="'"&&ze[nt]==="'")?ze.slice(1,-1):ze}(Le)]=1),le&&(T-=1),Fe+(le?"."+Le:"["+Le+"]")},CallExpression:se=>{se.callee.type!=="Identifier"&&Object(xe.o)("Illegal callee type: "+se.callee.type);const le=se.callee.name,Fe=se.arguments,Le=Object(xe.w)(i,le)&&i[le];return Le||Object(xe.o)("Unrecognized function: "+le),Object(xe.E)(Le)?Le(Fe):Le+"("+Fe.map(M).join(",")+")"},ArrayExpression:se=>"["+se.elements.map(M).join(",")+"]",BinaryExpression:se=>"("+M(se.left)+" "+se.operator+" "+M(se.right)+")",UnaryExpression:se=>"("+se.operator+M(se.argument)+")",ConditionalExpression:se=>"("+M(se.test)+"?"+M(se.consequent)+":"+M(se.alternate)+")",LogicalExpression:se=>"("+M(se.left)+se.operator+M(se.right)+")",ObjectExpression:se=>"{"+se.properties.map(M).join(",")+"}",Property:se=>{T+=1;const le=M(se.key);return T-=1,le+":"+M(se.value)}};function Q(se){const le={code:M(se),globals:Object.keys(x),fields:Object.keys(O)};return x={},O={},le}return Q.functions=i,Q.constants=r,Q}const a7="view",Cw="[",Ow="]",HT="{",$T="}",o7=":",GT=",",s7="@",u7=">",c7=/[[\]{}]/,l7={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};let KT,XT;function Sy(e,t,n){return KT=t||a7,XT=n||l7,YT(e.trim()).map(P3)}function $1(e,t,n,r,i){const s=e.length;let f,m=0;for(;t<s;++t){if(f=e[t],!m&&f===n)return t;i&&i.indexOf(f)>=0?--m:r&&r.indexOf(f)>=0&&++m}return t}function YT(e){const t=[],n=e.length;let r=0,i=0;for(;i<n;)i=$1(e,i,GT,Cw+HT,Ow+$T),t.push(e.substring(r,i).trim()),r=++i;if(t.length===0)throw"Empty event selector: "+e;return t}function P3(e){return e[0]==="["?function(t){const n=t.length;let r,i=1;if((i=$1(t,i,Ow,Cw,Ow))===n)throw"Empty between selector: "+t;if((r=YT(t.substring(1,i))).length!==2)throw"Between selector must have two elements: "+t;if((t=t.slice(i+1).trim())[0]!==u7)throw"Expected '>' after between selector: "+t;r=r.map(P3);const s=P3(t.slice(1).trim());return s.between?{between:r,stream:s}:(s.between=r,s)}(e):function(t){const n={source:KT},r=[];let i,s,f=[0,0],m=0,x=0,O=t.length,T=0;if(t[O-1]===$T){if(!((T=t.lastIndexOf(HT))>=0))throw"Unmatched right brace: "+t;try{f=function(M){const q=M.split(GT);if(!M.length||q.length>2)throw M;return q.map(Q=>{const se=+Q;if(se!=se)throw M;return se})}(t.substring(T+1,O-1))}catch{throw"Invalid throttle specification: "+t}t=t.slice(0,T).trim(),O=t.length,T=0}if(!O)throw t;if(t[0]===s7&&(m=++T),(i=$1(t,T,o7))<O&&(r.push(t.substring(x,i).trim()),x=T=++i),(T=$1(t,T,Cw))===O)r.push(t.substring(x,O).trim());else if(r.push(t.substring(x,T).trim()),s=[],(x=++T)===O)throw"Unmatched left bracket: "+t;for(;T<O;){if((T=$1(t,T,Ow))===O)throw"Unmatched left bracket: "+t;if(s.push(t.substring(x,T).trim()),T<O-1&&t[++T]!==Cw)throw"Expected left bracket: "+t;x=++T}if(!(O=r.length)||c7.test(r[O-1]))throw"Invalid event selector: "+t;return O>1?(n.type=r[1],m?n.markname=r[0].slice(1):function(M){return XT[M]}(r[0])?n.marktype=r[0]:n.source=r[0]):n.type=r[0],n.type.slice(-1)==="!"&&(n.consume=!0,n.type=n.type.slice(0,-1)),s!=null&&(n.filter=s),f[0]&&(n.throttle=f[0]),f[1]&&(n.debounce=f[1]),n}(e)}var f7="5.20.0";Object(xe.p)(pn,U,re,J,R,P,L,$,ee,F,ue,ie);const h7=f7;var d7=o(245),Cb=function(e,t,n){return e.fields=t||[],e.fname=n,e},p7=function(e){return e.length===1?m7(e[0]):g7(e)};const m7=e=>function(t){return t[e]},g7=e=>{const t=e.length;return function(n){for(let r=0;r<t;++r)n=n[e[r]];return n}};var L3=function(e){throw Error(e)},Dy=function(e){var t,n,r,i=[],s=null,f=0,m=e.length,x="";function O(){i.push(x+e.substring(t,n)),x="",t=n+1}for(e+="",t=n=0;n<m;++n)if((r=e[n])==="\\")x+=e.substring(t,n),x+=e.substring(++n,++n),t=n;else if(r===s)O(),s=null,f=-1;else{if(s)continue;t===f&&r==='"'||t===f&&r==="'"?(t=n+1,s=r):r!=="."||f?r==="["?(n>t&&O(),f=t=n+1):r==="]"&&(f||L3("Access path missing open bracket: "+e),f>0&&O(),f=0,t=n+1):n>t?O():t=n+1}return f&&L3("Access path missing closing bracket: "+e),s&&L3("Access path missing closing quote: "+e),n>t&&(n++,O()),i},v7=function(e,t,n){const r=Dy(e);return e=r.length===1?r[0]:e,Cb(p7(r),[e],e)},G1=[],y7=(v7("id"),Cb(function(e){return e},G1,"identity"));Cb(function(){return 0},G1,"zero"),Cb(function(){return 1},G1,"one"),Cb(function(){return!0},G1,"true"),Cb(function(){return!1},G1,"false");function Aw(e,t,n){var r=[t].concat([].slice.call(n));console[e].apply(console,r)}var Gi=Array.isArray,Uc=function(e){return e===Object(e)};const JT=e=>e!=="__proto__";function QT(...e){return e.reduce((t,n)=>{for(var r in n)if(r==="signals")t.signals=b7(t.signals,n.signals);else{var i=r==="legend"?{layout:1}:r==="style"||null;z3(t,r,n[r],i)}return t},{})}function z3(e,t,n,r){var i,s;if(JT(t))if(Uc(n)&&!Gi(n))for(i in s=Uc(e[t])?e[t]:e[t]={},n)r&&(r===!0||r[i])?z3(s,i,n[i]):JT(i)&&(s[i]=n[i]);else e[t]=n}function b7(e,t){if(e==null)return t;const n={},r=[];function i(s){n[s.name]||(n[s.name]=1,r.push(s))}return t.forEach(i),e.forEach(i),r}var Mu=function(e){return e!=null?Gi(e)?e:[e]:[]},x7=function(e){return typeof e=="function"};const w7=Object.prototype.hasOwnProperty;var Ty=function(e,t){return w7.call(e,t)},K1=function(e){return typeof e=="boolean"},Ju=function(e){return typeof e=="number"},Ha=function(e){return typeof e=="string"};function go(e){return Gi(e)?"["+e.map(go)+"]":Uc(e)||Ha(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}var Ny=function(e){for(var t={},n=0,r=e.length;n<r;++n)t[e[n]]=!0;return t};function Pi(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function"){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}Array.prototype.flat||Object.defineProperty(Array.prototype,"flat",{configurable:!0,value:function e(){var t=isNaN(arguments[0])?1:Number(arguments[0]);return t?Array.prototype.reduce.call(this,function(n,r){return Array.isArray(r)?n.push.apply(n,e.call(r,t-1)):n.push(r),n},[]):Array.prototype.slice.call(this)},writable:!0}),Array.prototype.flatMap||Object.defineProperty(Array.prototype,"flatMap",{configurable:!0,value:function(e){return Array.prototype.map.apply(this,arguments).flat()},writable:!0});var k7=o(244),E7=o.n(k7),C7=o(243),O7=o.n(C7),A7=o(86),X1=o.n(A7);function U3(e){return!!e.or}function W3(e){return!!e.and}function V3(e){return!!e.not}const Y1=O7.a,$a=E7.a;function J1(e,t){const n={};for(const r of t)Ty(e,r)&&(n[r]=e[r]);return n}function t0(e,t){const n=Object.assign({},e);for(const r of t)delete n[r];return n}Set.prototype.toJSON=function(){return`Set(${[...this].map(e=>X1()(e)).join(",")})`};const Js=X1.a;function ko(e){if(Ju(e))return e;const t=Ha(e)?e:X1()(e);if(t.length<250)return t;let n=0;for(let r=0;r<t.length;r++)n=(n<<5)-n+t.charCodeAt(r),n&=n;return n}function ZT(e){return e===!1||e===null}function Ji(e,t){return e.indexOf(t)>-1}function Q1(e,t){let n=0;for(const[r,i]of e.entries())if(t(i,r,n++))return!0;return!1}function eN(e,t){let n=0;for(const[r,i]of e.entries())if(!t(i,r,n++))return!1;return!0}function _7(e,t){for(const n of Kr(t))z3(e,n,t[n],!0)}function z0(e,t){const n=[],r={};let i;for(const s of e)(i=t(s))in r||(r[i]=1,n.push(s));return n}function tN(e,t){for(const n of e)if(t.has(n))return!0;return!1}function nN(e){const t=new Set;for(const n of e){const r=Dy(n).map((s,f)=>f===0?s:`[${s}]`),i=r.map((s,f)=>r.slice(0,f+1).join(""));for(const s of i)t.add(s)}return t}function rN(e,t){return e===void 0||t===void 0||tN(nN(e),nN(t))}function ms(e){return Kr(e).length===0}const Kr=Object.keys,U0=Object.values;function iN(e){const t=[];for(const n in e)Ty(e,n)&&t.push({key:n,value:e[n]});return t}function _w(e){return e===!0||e===!1}function Qs(e){const t=e.replace(/\W/g,"_");return(e.match(/^\d+/)?"_":"")+t}function Z1(e,t){return V3(e)?"!("+Z1(e.not,t)+")":W3(e)?"("+e.and.map(n=>Z1(n,t)).join(") && (")+")":U3(e)?"("+e.or.map(n=>Z1(n,t)).join(") || (")+")":t(e)}function q3(e,t){if(t.length===0)return!0;const n=t.shift();return n in e&&q3(e[n],t)&&delete e[n],ms(e)}function Sw(e){return e.charAt(0).toUpperCase()+e.substr(1)}function aN(e,t="datum"){const n=Dy(e),r=[];for(let i=1;i<=n.length;i++){const s=`[${n.slice(0,i).map(go).join("][")}]`;r.push(`${t}${s}`)}return r.join(" && ")}function S7(e){return e.replace(/(\[|\]|\.|'|")/g,"\\$1")}function W0(e){return`${Dy(e).map(S7).join("\\.")}`}function Ob(e,t,n){return e.replace(new RegExp(t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),"g"),n)}function oN(e){return`${Dy(e).join(".")}`}function ex(e){return e?Dy(e).length:0}function Qu(...e){for(const t of e)if(t!==void 0)return t}let D7=42;function T7(e){const t=++D7;return e?String(e)+t:t}function Dw(e){if(e!==void 0)return(e%360+360)%360}function H3(e){return!!Ju(e)||!isNaN(e)&&!isNaN(parseFloat(e))}const sN={domainColor:{part:"domain",vgProp:"stroke"},labelAlign:{part:"labels",vgProp:"align"},labelBaseline:{part:"labels",vgProp:"baseline"},labelColor:{part:"labels",vgProp:"fill"},labelFont:{part:"labels",vgProp:"font"},labelFontSize:{part:"labels",vgProp:"fontSize"},labelFontStyle:{part:"labels",vgProp:"fontStyle"},labelFontWeight:{part:"labels",vgProp:"fontWeight"},labelOpacity:{part:"labels",vgProp:"opacity"},labelOffset:null,labelPadding:null,gridColor:{part:"grid",vgProp:"stroke"},gridDash:{part:"grid",vgProp:"strokeDash"},gridDashOffset:{part:"grid",vgProp:"strokeDash"},gridOpacity:{part:"grid",vgProp:"opacity"},gridWidth:{part:"grid",vgProp:"strokeWidth"},tickColor:{part:"ticks",vgProp:"stroke"},tickDash:{part:"ticks",vgProp:"strokeDash"},tickDashOffset:{part:"ticks",vgProp:"strokeDash"},tickOpacity:{part:"ticks",vgProp:"opacity"},tickSize:null,tickWidth:{part:"ticks",vgProp:"strokeWidth"},titleColor:{part:"title",vgProp:"fill"},title:null};function $3(e){return e&&e.condition}const uN=["domain","grid","labels","ticks","title"],N7={grid:"grid",gridCap:"grid",gridColor:"grid",gridDash:"grid",gridDashOffset:"grid",gridOpacity:"grid",gridScale:"grid",gridWidth:"grid",orient:"main",bandPosition:"both",aria:"main",description:"main",domain:"main",domainCap:"main",domainColor:"main",domainDash:"main",domainDashOffset:"main",domainOpacity:"main",domainWidth:"main",format:"main",formatType:"main",labelAlign:"main",labelAngle:"main",labelBaseline:"main",labelBound:"main",labelColor:"main",labelFlush:"main",labelFlushOffset:"main",labelFont:"main",labelFontSize:"main",labelFontStyle:"main",labelFontWeight:"main",labelLimit:"main",labelLineHeight:"main",labelOffset:"main",labelOpacity:"main",labelOverlap:"main",labelPadding:"main",labels:"main",labelSeparation:"main",maxExtent:"main",minExtent:"main",offset:"both",position:"main",tickCap:"main",tickColor:"main",tickDash:"main",tickDashOffset:"main",tickMinStep:"main",tickOffset:"both",tickOpacity:"main",tickRound:"both",ticks:"main",tickSize:"main",tickWidth:"both",title:"main",titleAlign:"main",titleAnchor:"main",titleAngle:"main",titleBaseline:"main",titleColor:"main",titleFont:"main",titleFontSize:"main",titleFontStyle:"main",titleFontWeight:"main",titleLimit:"main",titleLineHeight:"main",titleOpacity:"main",titlePadding:"main",titleX:"main",titleY:"main",encode:"both",scale:"both",tickBand:"both",tickCount:"both",tickExtra:"both",translate:"both",values:"both",zindex:"both"},cN={orient:1,aria:1,bandPosition:1,description:1,domain:1,domainCap:1,domainColor:1,domainDash:1,domainDashOffset:1,domainOpacity:1,domainWidth:1,format:1,formatType:1,grid:1,gridCap:1,gridColor:1,gridDash:1,gridDashOffset:1,gridOpacity:1,gridWidth:1,labelAlign:1,labelAngle:1,labelBaseline:1,labelBound:1,labelColor:1,labelFlush:1,labelFlushOffset:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelLineHeight:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labels:1,labelSeparation:1,maxExtent:1,minExtent:1,offset:1,position:1,tickBand:1,tickCap:1,tickColor:1,tickCount:1,tickDash:1,tickDashOffset:1,tickExtra:1,tickMinStep:1,tickOffset:1,tickOpacity:1,tickRound:1,ticks:1,tickSize:1,tickWidth:1,title:1,titleAlign:1,titleAnchor:1,titleAngle:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titlePadding:1,titleX:1,titleY:1,translate:1,values:1,zindex:1},I7=Object.assign(Object.assign({},cN),{style:1,labelExpr:1,encoding:1});function lN(e){return!!I7[e]}const yh={arc:"arc",area:"area",bar:"bar",image:"image",line:"line",point:"point",rect:"rect",rule:"rule",text:"text",tick:"tick",trail:"trail",circle:"circle",square:"square",geoshape:"geoshape"},fN=yh.arc,Tw=yh.area,Nw=yh.bar,F7=yh.image,Iw=yh.line,Fw=yh.point,R7=yh.rect,Rw=yh.rule,hN=yh.text,G3=yh.tick,M7=yh.trail,K3=yh.circle,X3=yh.square,dN=yh.geoshape;function Iy(e){return Ji(["line","area","trail"],e)}function pN(e){return Ji(["rect","bar","image","arc"],e)}const mN=Kr(yh);function hv(e){return e.type}Ny(mN);const j7=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity","strokeJoin","strokeMiterLimit","fill","fillOpacity"],gN=Kr({color:1,filled:1,invalid:1,order:1,radius2:1,theta2:1,timeUnitBand:1,timeUnitBandPosition:1}),B7={horizontal:["cornerRadiusTopRight","cornerRadiusBottomRight"],vertical:["cornerRadiusTopLeft","cornerRadiusTopRight"]},P7={binSpacing:1,continuousBandSize:5,timeUnitBandPosition:.5},L7={binSpacing:0,continuousBandSize:5,timeUnitBandPosition:.5};function n0(e){return"mark"in e}class Mw{constructor(t,n){this.name=t,this.run=n}hasMatchingType(t){return!!n0(t)&&function(n){return hv(n)?n.type:n}(t.mark)===this.name}}const z7={argmax:1,argmin:1,average:1,count:1,distinct:1,product:1,max:1,mean:1,median:1,min:1,missing:1,q1:1,q3:1,ci0:1,ci1:1,stderr:1,stdev:1,stdevp:1,sum:1,valid:1,values:1,variance:1,variancep:1},U7={count:1,min:1,max:1};function V0(e){return!!e&&!!e.argmin}function Fy(e){return!!e&&!!e.argmax}function Y3(e){return Ha(e)&&!!z7[e]}const W7=["count","valid","missing","distinct"];function vN(e){return Ha(e)&&Ji(W7,e)}const V7=["count","sum","distinct","valid","missing"],q7=Ny(["mean","average","median","q1","q3","min","max"]),r0="row",i0="column",jw="facet",ou="x",vc="y",ug="x2",dv="y2",pv="radius",a0="radius2",cg="theta",o0="theta2",mv="latitude",gv="longitude",lg="latitude2",pm="longitude2",Cd="color",vv="fill",yv="stroke",Od="shape",s0="size",Ry="angle",u0="opacity",q0="fillOpacity",H0="strokeOpacity",$0="strokeWidth",G0="strokeDash",tx="text",nx="order",rx="detail",Bw="key",My="tooltip",Pw="href",Lw="url",zw="description",yN={theta:1,theta2:1,radius:1,radius2:1};function bN(e){return e in yN}const J3={longitude:1,longitude2:1,latitude:1,latitude2:1},H7=Kr(J3),Q3=Object.assign(Object.assign(Object.assign(Object.assign({},{x:1,y:1,x2:1,y2:1}),yN),J3),{color:1,fill:1,stroke:1,opacity:1,fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeDash:1,size:1,angle:1,shape:1,order:1,text:1,detail:1,key:1,tooltip:1,href:1,url:1,description:1});function Ab(e){return e===Cd||e===vv||e===yv}const xN={row:1,column:1,facet:1},mm=Kr(xN),Uw=Object.assign(Object.assign({},Q3),xN),wN=Kr(Uw),{order:bV,detail:xV,tooltip:wV}=Uw,kN=Pi(Uw,["order","detail","tooltip"]),{row:kV,column:EV,facet:CV}=kN,$7=Pi(kN,["row","column","facet"]);function G7(e){return!!$7[e]}function EN(e){return!!Uw[e]}const K7=[ug,dv,lg,pm,o0,a0];function CN(e){return jy(e)!==e}function jy(e){switch(e){case ug:return ou;case dv:return vc;case lg:return mv;case pm:return gv;case o0:return cg;case a0:return pv}return e}function K0(e){if(bN(e))switch(e){case cg:return"startAngle";case o0:return"endAngle";case pv:return"outerRadius";case a0:return"innerRadius"}return e}function bv(e){switch(e){case ou:return ug;case vc:return dv;case mv:return lg;case gv:return pm;case cg:return o0;case pv:return a0}}function xv(e){switch(e){case ou:case ug:return"width";case vc:case dv:return"height"}}const{x:OV,y:AV,x2:_V,y2:SV,latitude:DV,longitude:TV,latitude2:NV,longitude2:IV,theta:FV,theta2:RV,radius:MV,radius2:jV}=Q3,Ww=Pi(Q3,["x","y","x2","y2","latitude","longitude","latitude2","longitude2","theta","theta2","radius","radius2"]),X7=Kr(Ww),X0={x:1,y:1},gm=Kr(X0);function wv(e){return e in X0}const Z3={theta:1,radius:1},Y7=Kr(Z3);function Vw(e){return e==="width"?ou:vc}const{text:BV,tooltip:PV,href:LV,url:zV,description:UV,detail:WV,key:VV,order:qV}=Ww,ON=Pi(Ww,["text","tooltip","href","url","description","detail","key","order"]),J7=Kr(ON),AN=Object.assign(Object.assign(Object.assign({},X0),Z3),ON),qw=Kr(AN);function Y0(e){return!!AN[e]}function Q7(e,t){return function(n){switch(n){case Cd:case vv:case yv:case zw:case rx:case Bw:case My:case Pw:case nx:case u0:case q0:case H0:case $0:case jw:case r0:case i0:return eO;case ou:case vc:case mv:case gv:return Z7;case ug:case dv:case lg:case pm:return{area:"always",bar:"always",image:"always",rect:"always",rule:"always",circle:"binned",point:"binned",square:"binned",tick:"binned",line:"binned",trail:"binned"};case s0:return{point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",text:"always",line:"always",trail:"always"};case G0:return{line:"always",point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",geoshape:"always"};case Od:return{point:"always",geoshape:"always"};case tx:return{text:"always"};case Ry:return{point:"always",square:"always",text:"always"};case Lw:return{image:"always"};case cg:case pv:return{text:"always",arc:"always"};case o0:case a0:return{arc:"always"}}}(e)[t]}const eO={arc:"always",area:"always",bar:"always",circle:"always",geoshape:"always",image:"always",line:"always",rule:"always",point:"always",rect:"always",square:"always",trail:"always",text:"always",tick:"always"},{geoshape:HV}=eO,Z7=Pi(eO,["geoshape"]);function Hw(e){switch(e){case ou:case vc:case cg:case pv:case s0:case Ry:case $0:case u0:case q0:case H0:case ug:case dv:case o0:case a0:return;case jw:case r0:case i0:case Od:case G0:case tx:case My:case Pw:case Lw:case zw:return"discrete";case Cd:case vv:case yv:return"flexible";case mv:case gv:case lg:case pm:case rx:case Bw:case nx:return}}function _N(e){return K1(e)&&(e=nk(e,void 0)),"bin"+Kr(e).map(t=>$w(e[t])?Qs(`_${t}_${Object.entries(e[t])}`):Qs(`_${t}_${e[t]}`)).join("")}function Ns(e){return e===!0||ix(e)&&!e.binned}function bh(e){return e==="binned"||ix(e)&&e.binned===!0}function ix(e){return Uc(e)}function $w(e){return e?.selection}function SN(e){switch(e){case r0:case i0:case s0:case Cd:case vv:case yv:case $0:case u0:case q0:case H0:case Od:return 6;case G0:return 4;default:return 10}}function eP(e){return`Invalid specification ${JSON.stringify(e)}. Make sure the specification includes at least one of the following properties: "mark", "layer", "facet", "hconcat", "vconcat", "concat", or "repeat".`}const tP='Autosize "fit" only works for single views and layered views.';function nP(e){return`${e=="width"?"Width":"Height"} "container" only works for single views and layered views.`}function rP(e){return`${e=="width"?"Width":"Height"} "container" only works well with autosize "fit" or "fit-${e=="width"?"x":"y"}".`}function iP(e){return e?`Dropping "fit-${e}" because spec has discrete ${xv(e)}.`:'Dropping "fit" because spec has discrete size.'}function aP(e){return`Cannot project a selection on encoding channel "${e}", which has no field.`}function oP(e,t){return`Cannot project a selection on encoding channel "${e}" as it uses an aggregate function ("${t}").`}function sP(e){return`The "nearest" transform is not supported for ${e} marks.`}function uP(e){return`Selection not supported for ${e} yet.`}function cP(e){return`Cannot find a selection named "${e}".`}const lP="Scale bindings are currently only supported for scales with unbinned, continuous domains.",fP="Legend bindings are only supported for selections over an individual field or encoding channel.";function hP(e){return`Cannot define and lookup the "${e}" selection in the same view. Try moving the lookup into a second, layered view?`}function dP(e){return`Unknown repeated value "${e}".`}function pP(e){return`The "columns" property cannot be used when "${e}" has nested row/column.`}const mP="Axes cannot be shared in concatenated or repeated views yet (https://github.com/vega/vega-lite/issues/2415).";function gP(e){return`Unrecognized parse "${e}".`}function vP(e,t,n){return`An ancestor parsed field "${e}" as ${n} but a child wants to parse the field as ${t}.`}function yP(e){return`Ignoring an invalid transform: ${Js(e)}.`}const bP='If "from.fields" is not specified, "as" has to be a string that specifies the key to be used for the data from the secondary source.';function xP(e){return`Config.customFormatTypes is not true, thus custom format type and format for channel ${e} are dropped.`}function wP(e){return`Layer's shared ${e.join(",")} channel ${e.length===1?"is":"are"} overriden.`}function kP(e){const{parentProjection:t,projection:n}=e;return`Layer's shared projection ${Js(t)} is overridden by a child projection ${Js(n)}.`}const EP="Arc marks uses theta channel rather than angle, replacing angle with theta.";function CP(e,t,n){return`Channel ${e} is a ${t}. Converted to {value: ${Js(n)}}.`}function OP(e){return`Invalid field type "${e}".`}function AP(e,t){return`Invalid field type "${e}" for aggregate: "${t}", using "quantitative" instead.`}function _P(e){return`Invalid aggregation operator "${e}".`}function SP(e,t){return`Missing type for channel "${e}", using "${t}" instead.`}function DP(e,t){const{fill:n,stroke:r}=t;return`Dropping color ${e} as the plot also has ${n&&r?"fill and stroke":n?"fill":"stroke"}.`}function TP(e,t){return`Dropping ${Js(e)} from channel "${t}" since it does not contain any data field, datum, value, or signal.`}function NP(e,t,n){return`${e}-encoding with type ${t} is deprecated. Replacing with ${n}-encoding.`}const IP="Line marks cannot encode size with a non-groupby field. You may want to use trail marks instead.";function FP(e,t,n){return`${e} dropped as it is incompatible with "${t}"${n?` when ${n}`:""}.`}function RP(e){return`${e}-encoding is dropped as ${e} is not a valid encoding channel.`}function MP(e){return`${e} encoding should be discrete (ordinal / nominal / binned).`}function jP(e){return`Facet encoding dropped as ${e.join(" and ")} ${e.length>1?"are":"is"} also specified.`}function BP(e,t){return`Using discrete channel "${e}" to encode "${t}" field can be misleading as it does not encode ${t==="ordinal"?"order":"magnitude"}.`}function PP(e,t){return`Line mark is for continuous lines and thus cannot be used with ${e&&t?"x2 and y2":e?"x2":"y2"}. We will use the rule mark (line segments) instead.`}function LP(e,t){return`Specified orient "${e}" overridden with "${t}".`}const zP="Custom domain scale cannot be unioned with default field-based domain.",UP=`Scale's "rangeStep" is deprecated and will be removed in Vega-Lite 5.0. Please use "width"/"height": {"step": ...} instead. See https://vega.github.io/vega-lite/docs/size.html.`;function WP(e){return`Cannot use the scale property "${e}" with non-color channel.`}function VP(e){return`Using unaggregated domain with raw field has no effect (${Js(e)}).`}function qP(e){return`Unaggregated domain not applicable for "${e}" since it produces values outside the origin domain of the source data.`}function HP(e){return`Unaggregated domain is currently unsupported for log scale (${Js(e)}).`}function $P(e){return`Cannot apply size to non-oriented mark "${e}".`}function GP(e,t,n){return`Channel "${e}" does not work with "${t}" scale. We are using "${n}" scale instead.`}function KP(e,t){return`FieldDef does not work with "${e}" scale. We are using "${t}" scale instead.`}function XP(e,t,n){return`${n}-scale's "${t}" is dropped as it does not work with ${e} scale.`}function YP(e,t){return`Scale type "${t}" does not work with mark "${e}".`}function JP(e){return`The step for "${e}" is dropped because the ${e==="width"?"x":"y"} is continuous.`}function QP(e,t,n,r){return`Conflicting ${t.toString()} property "${e.toString()}" (${Js(n)} and ${Js(r)}). Using ${Js(n)}.`}function ZP(e,t,n,r){return`Conflicting ${t.toString()} property "${e.toString()}" (${Js(n)} and ${Js(r)}). Using the union of the two domains.`}function eL(e){return`Setting the scale to be independent for "${e}" means we also have to set the guide (axis or legend) to be independent.`}function tL(e){return`Dropping sort property ${Js(e)} as unioned domains only support boolean or op "count", "min", and "max".`}const nL="Domains that should be unioned has conflicting sort properties. Sort will be set to true.",rL="Detected faceted independent scales that union domain of multiple fields from different data sources. We will use the first field. The result view size may be incorrect.",iL="Detected faceted independent scales that union domain of the same fields from different source. We will assume that this is the same field from a different fork of the same data source. However, if this is not the case, the result view size may be incorrect.",aL="Detected faceted independent scales that union domain of multiple fields from the same data source. We will use the first field. The result view size may be incorrect.",oL="Invalid channel for axis.";function sL(e){return`Cannot stack "${e}" if there is already "${e}2".`}function uL(e){return`Cannot stack non-linear scale (${e}).`}function cL(e){return`Stacking is applied even though the aggregate function is non-summative ("${e}").`}function lL(e,t){return`Invalid ${e}: ${Js(t)}.`}function fL(e){return`Dropping day from datetime ${Js(e)} as day cannot be combined with other units.`}function hL(e,t){return`${t?"extent ":""}${t&&e?"and ":""}${e?"center ":""}${t&&e?"are ":"is "}not needed when data are aggregated.`}function dL(e,t,n){return`${e} is not usually used with ${t} for ${n}.`}function pL(e,t){return`Continuous axis should not have customized aggregation function ${e}; ${t} already agregates the axis.`}function mL(e,t){return`Center is not needed to be specified in ${t} when extent is ${e}.`}function gL(e){return`1D error band does not support ${e}.`}function vL(e){return`Channel ${e} is required for "binned" bin.`}function yL(e){return`Domain for ${e} is required for threshold scale.`}const DN=function(e,t){var n=e;return{level:function(r){return arguments.length?(n=+r,this):n},error:function(){return n>=1&&Aw("error","ERROR",arguments),this},warn:function(){return n>=2&&Aw("warn","WARN",arguments),this},info:function(){return n>=3&&Aw("log","INFO",arguments),this},debug:function(){return n>=4&&Aw("log","DEBUG",arguments),this}}}(2);let Gw=DN;function bL(){return Gw=DN}function Gr(...e){Gw.warn(...e)}function _b(e){if(e&&Uc(e)){for(const t of nO)if(t in e)return!0}return!1}const TN=["january","february","march","april","may","june","july","august","september","october","november","december"],xL=TN.map(e=>e.substr(0,3)),NN=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],wL=NN.map(e=>e.substr(0,3));function tO(e,t){const n=[];if(t&&e.day!==void 0&&Kr(e).length>1&&(Gr(he.droppedDay(e)),delete(e=$a(e)).day),e.year!==void 0?n.push(e.year):n.push(2012),e.month!==void 0){const r=t?function(i){if(H3(i)&&(i=+i),Ju(i))return i-1;{const s=i.toLowerCase(),f=TN.indexOf(s);if(f!==-1)return f;const m=s.substr(0,3),x=xL.indexOf(m);if(x!==-1)return x;throw new Error(he.invalidTimeUnit("month",i))}}(e.month):e.month;n.push(r)}else if(e.quarter!==void 0){const r=t?function(i){if(H3(i)&&(i=+i),Ju(i))return i>4&&Gr(he.invalidTimeUnit("quarter",i)),i-1;throw new Error(he.invalidTimeUnit("quarter",i))}(e.quarter):e.quarter;n.push(Ju(r)?3*r:r+"*3")}else n.push(0);if(e.date!==void 0)n.push(e.date);else if(e.day!==void 0){const r=t?function(i){if(H3(i)&&(i=+i),Ju(i))return i%7;{const s=i.toLowerCase(),f=NN.indexOf(s);if(f!==-1)return f;const m=s.substr(0,3),x=wL.indexOf(m);if(x!==-1)return x;throw new Error(he.invalidTimeUnit("day",i))}}(e.day):e.day;n.push(Ju(r)?r+1:r+"+1")}else n.push(1);for(const r of["hours","minutes","seconds","milliseconds"]){const i=e[r];n.push(i===void 0?0:i)}return n}function ax(e){const t=tO(e,!0).join(", ");return e.utc?`utc(${t})`:`datetime(${t})`}const IN={year:1,quarter:1,month:1,week:1,day:1,dayofyear:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1},nO=Kr(IN);function rO(e){return e.startsWith("utc")}const kL={"year-month":"%b %Y ","year-month-date":"%b %d, %Y "};function iO(e){const t=[];for(const n of nO)FN(e,n)&&t.push(n);return t}function FN(e,t){const n=e.indexOf(t);return!(n<0)&&!(n>0&&t==="seconds"&&e.charAt(n-1)==="i")&&!(e.length>n+3&&t==="day"&&e.charAt(n+3)==="o")&&!(n>0&&t==="year"&&e.charAt(n-1)==="f")}function EL(e,t,{end:n}={end:!1}){const r=aN(t),i=rO(e)?"utc":"";function s(x){return x==="quarter"?`(${i}quarter(${r})-1)`:`${i}${x}(${r})`}let f;const m={};for(const x of nO)FN(e,x)&&(m[x]=s(x),f=x);return n&&(m[f]+="+1"),function(x){const O=tO(x,!1).join(", ");return x.utc?`utc(${O})`:`datetime(${O})`}(m)}function RN(e){if(!e)return;const t=iO(e);return`timeUnitSpecifier(${X1()(t)}, ${X1()(kL)})`}function xh(e){if(!e)return;let t;return Ha(e)?t={unit:e}:Uc(e)&&(t=Object.assign(Object.assign({},e),e.unit?{unit:e.unit}:{})),rO(t.unit)&&(t.utc=!0,t.unit=function(n){return n.substr(3)}(t.unit)),t}function da(e){return e&&!!e.signal}function J0(e){return!!e.step}function Q0(e){return!Gi(e)&&"field"in e&&"data"in e}const CL=Kr({aria:1,description:1,ariaRole:1,ariaRoleDescription:1,blend:1,opacity:1,fill:1,fillOpacity:1,stroke:1,strokeCap:1,strokeWidth:1,strokeOpacity:1,strokeDash:1,strokeDashOffset:1,strokeJoin:1,strokeOffset:1,strokeMiterLimit:1,startAngle:1,endAngle:1,padAngle:1,innerRadius:1,outerRadius:1,size:1,shape:1,interpolate:1,tension:1,orient:1,align:1,baseline:1,text:1,dir:1,dx:1,dy:1,ellipsis:1,limit:1,radius:1,theta:1,angle:1,font:1,fontSize:1,fontWeight:1,fontStyle:1,lineBreak:1,lineHeight:1,cursor:1,href:1,tooltip:1,cornerRadius:1,cornerRadiusTopLeft:1,cornerRadiusTopRight:1,cornerRadiusBottomLeft:1,cornerRadiusBottomRight:1,aspect:1,width:1,height:1}),OL={arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1},aO=["cornerRadius","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight"];function oO(e){return e&&!!e.field&&e.equal!==void 0}function MN(e){return e&&!!e.field&&e.lt!==void 0}function jN(e){return e&&!!e.field&&e.lte!==void 0}function BN(e){return e&&!!e.field&&e.gt!==void 0}function PN(e){return e&&!!e.field&&e.gte!==void 0}function sO(e){return!!(e&&e.field&&(Gi(e.range)&&e.range.length===2||da(e.range)))}function uO(e){return e&&!!e.field&&(Gi(e.oneOf)||Gi(e.in))}function LN(e){return uO(e)||oO(e)||sO(e)||MN(e)||BN(e)||jN(e)||PN(e)}function kv(e,t){return AO(e,{timeUnit:t,wrapTime:!0})}function zN(e,t=!0){var n;const{field:r}=e,i=(n=xh(e.timeUnit))===null||n===void 0?void 0:n.unit,s=i?"time("+EL(i,r)+")":ti(e,{expr:"datum"});if(oO(e))return s+"==="+kv(e.equal,i);if(MN(e))return`${s}<${kv(e.lt,i)}`;if(BN(e))return`${s}>${kv(e.gt,i)}`;if(jN(e))return`${s}<=${kv(e.lte,i)}`;if(PN(e))return`${s}>=${kv(e.gte,i)}`;if(uO(e))return`indexof([${function(f,m){return f.map(x=>kv(x,m))}(e.oneOf,i).join(",")}], ${s}) !== -1`;if(function(f){return f&&!!f.field&&f.valid!==void 0}(e))return cO(s,e.valid);if(sO(e)){const{range:f}=e,m=da(f)?{signal:`${f.signal}[0]`}:f[0],x=da(f)?{signal:`${f.signal}[1]`}:f[1];if(m!==null&&x!==null&&t)return"inrange("+s+", ["+kv(m,i)+", "+kv(x,i)+"])";const O=[];return m!==null&&O.push(`${s} >= ${kv(m,i)}`),x!==null&&O.push(`${s} <= ${kv(x,i)}`),O.length>0?O.join(" && "):"true"}throw new Error(`Invalid field predicate: ${JSON.stringify(e)}`)}function cO(e,t=!0){return t?`isValid(${e}) && isFinite(+${e})`:`!isValid(${e}) || !isFinite(+${e})`}function AL(e){var t;return LN(e)&&e.timeUnit?Object.assign(Object.assign({},e),{timeUnit:(t=xh(e.timeUnit))===null||t===void 0?void 0:t.unit}):e}const Sb={quantitative:"quantitative",ordinal:"ordinal",temporal:"temporal",nominal:"nominal",geojson:"geojson"},By=Sb.quantitative,lO=Sb.ordinal,Db=Sb.temporal,fO=Sb.nominal,Tb=Sb.geojson,_L=Kr(Sb),Zu={LINEAR:"linear",LOG:"log",POW:"pow",SQRT:"sqrt",SYMLOG:"symlog",TIME:"time",UTC:"utc",QUANTILE:"quantile",QUANTIZE:"quantize",THRESHOLD:"threshold",POINT:"point",BAND:"band"},hO={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric",symlog:"numeric",identity:"numeric",sequential:"numeric",time:"time",utc:"time",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position",quantile:"discretizing",quantize:"discretizing",threshold:"discretizing"},SL=Kr(hO);function DL(e,t){const n=hO[e],r=hO[t];return n===r||n==="ordinal-position"&&r==="time"||r==="ordinal-position"&&n==="time"}const TL={linear:0,log:1,pow:1,sqrt:1,symlog:1,identity:1,sequential:1,time:0,utc:0,point:10,band:11,ordinal:0,"bin-ordinal":0,quantile:0,quantize:0,threshold:0};function UN(e){return TL[e]}const WN=["linear","log","pow","sqrt","symlog","time","utc"],NL=Ny(WN),IL=Ny(["linear","log","pow","sqrt","symlog"]),FL=Ny(["quantile","quantize","threshold"]),RL=Ny(WN.concat(["quantile","quantize","threshold","sequential","identity"])),ML=Ny(["ordinal","bin-ordinal","point","band"]);function Ad(e){return e in ML}function vm(e){return e in RL}function fg(e){return e in NL}function Kw(e){return e in FL}function VN(e){return e?.selection}const qN={type:1,domain:1,domainMid:1,align:1,range:1,scheme:1,bins:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,constant:1,interpolate:1,zero:1,padding:1,paddingInner:1,paddingOuter:1},{type:$V,domain:GV,range:KV,scheme:XV}=qN,jL=Pi(qN,["type","domain","range","scheme"]),BL=Kr(jL);(function(){var e;const t={};for(const n of wN)for(const r of _L)for(const i of SL){const s=PL(n,r);KN(n,i)&&GN(i,r)&&(t[s]=(e=t[s])!==null&&e!==void 0?e:[],t[s].push(i))}})();function HN(e,t){switch(t){case"type":case"domain":case"reverse":case"range":return!0;case"scheme":case"interpolate":return!Ji(["point","band","identity"],e);case"bins":return!Ji(["point","band","identity","ordinal"],e);case"round":return fg(e)||e==="band"||e==="point";case"padding":return fg(e)||Ji(["point","band"],e);case"paddingOuter":case"align":return Ji(["point","band"],e);case"paddingInner":return e==="band";case"domainMid":case"clamp":return fg(e);case"nice":return fg(e)||e==="quantize"||e==="threshold";case"exponent":return e==="pow";case"base":return e==="log";case"constant":return e==="symlog";case"zero":return vm(e)&&!Ji(["log","time","utc","threshold","quantile"],e)}}function $N(e,t){switch(t){case"interpolate":case"scheme":case"domainMid":return Ab(e)?void 0:he.cannotUseScalePropertyWithNonColor(e);case"align":case"type":case"bins":case"domain":case"range":case"base":case"exponent":case"constant":case"nice":case"padding":case"paddingInner":case"paddingOuter":case"reverse":case"round":case"clamp":case"zero":return}}function GN(e,t){return Ji([lO,fO],t)?e===void 0||Ad(e):t===Db?Ji([Zu.TIME,Zu.UTC,void 0],e):t!==By||Ji([Zu.LOG,Zu.POW,Zu.SQRT,Zu.SYMLOG,Zu.QUANTILE,Zu.QUANTIZE,Zu.THRESHOLD,Zu.LINEAR,void 0],e)}function KN(e,t){if(!Y0(e))return!1;switch(e){case ou:case vc:case cg:case pv:return fg(t)||Ji(["band","point"],t);case s0:case $0:case u0:case q0:case H0:case Ry:return fg(t)||Kw(t)||Ji(["band","point","ordinal"],t);case Cd:case vv:case yv:return t!=="band";case G0:return t==="ordinal"||Kw(t);case Od:return t==="ordinal"}}function PL(e,t){return e+"_"+t}function dO(e){const{channel:t,channelDef:n,markDef:r,scale:i,config:s}=e,f=YN(e);return si(n)&&!vN(n.aggregate)&&i&&fg(i.get("type"))&&i.get("zero")===!1?XN({fieldDef:n,channel:t,markDef:r,ref:f,config:s}):f}function XN({fieldDef:e,channel:t,markDef:n,ref:r,config:i}){return Iy(n.type)||$o("invalid",n,i)===null?r:[function(s,f){const m=pO(s,!0),x=jy(f)==="y"?{field:{group:"height"}}:{value:0};return Object.assign({test:m},x)}(e,t),r]}function pO(e,t=!0){return cO(Ha(e)?e:ti(e,{expr:"datum"}),!t)}function Py(e,t,n,r){const i={};if(t&&(i.scale=t),ey(e)){const{datum:s}=e;_b(s)?i.signal=ax(s):da(s)?i.signal=s.signal:i.value=s}else i.field=ti(e,n);if(r){const{offset:s,band:f}=r;s&&(i.offset=s),f&&(i.band=f)}return i}function Xw({scaleName:e,fieldOrDatumDef:t,fieldOrDatumDef2:n,offset:r,startSuffix:i,band:s=.5}){const f=0<s&&s<1?"datum":void 0,m=ti(t,{expr:f,suffix:i}),x=n!==void 0?ti(n,{expr:f}):ti(t,{suffix:"end",expr:f}),O={};if(s===0||s===1){O.scale=e;const T=s===0?m:x;O.field=T}else{const T=`${s} * ${m} + ${1-s} * ${x}`;O.signal=`scale("${e}", ${T})`}return r&&(O.offset=r),O}function YN({channel:e,channelDef:t,channel2Def:n,markDef:r,config:i,scaleName:s,scale:f,stack:m,offset:x,defaultRef:O,band:T}){var M;if(t){if(Ca(t)){if(Sp(t)){T=T??ux({channel:e,fieldDef:t,fieldDef2:n,markDef:r,stack:m,config:i,isMidPoint:!0});const{bin:Q,timeUnit:se,type:le}=t;if(Ns(Q)||T&&se&&le===Db)return m&&m.impute?Py(t,s,{binSuffix:"mid"},{offset:x}):T?Xw({scaleName:s,fieldOrDatumDef:t,band:T,offset:x}):Py(t,s,cx(t,e)?{binSuffix:"range"}:{},{offset:x});if(bh(Q)){if(si(n))return Xw({scaleName:s,fieldOrDatumDef:t,fieldOrDatumDef2:n,band:T,offset:x});{const Fe=e===ou?ug:dv;Gr(he.channelRequiredForBinned(Fe))}}}const q=f?.get("type");return Py(t,s,Ad(q)?{binSuffix:"range"}:{},{offset:x,band:q==="band"?(M=T??t.band)!==null&&M!==void 0?M:.5:void 0})}if(c0(t)){const q=t.value,Q=x?{offset:x}:{};return Object.assign(Object.assign({},ox(e,q)),Q)}}return x7(O)&&(O=O()),O&&Object.assign(Object.assign({},O),x?{offset:x}:{})}function ox(e,t){return Ji(["x","x2"],e)&&t==="width"?{field:{group:"width"}}:Ji(["y","y2"],e)&&t==="height"?{field:{group:"height"}}:ju(t)}function Ly(e){return e&&e!=="number"&&e!=="time"}function JN(e,t,n){return`${e}(${t}${n?`, ${JSON.stringify(n)}`:""})`}const LL="  ";function mO({fieldOrDatumDef:e,format:t,formatType:n,expr:r,normalizeStack:i,config:s}){var f,m;if(Ly(n))return gO({fieldOrDatumDef:e,format:t,formatType:n,expr:r,config:s});const x=QN(e,r,i);if(rk(e)){const O=function(T,M,q,Q,se){return!M||q?(q=Ha(q)?q:Q,`${se?"utc":"time"}Format(${T}, '${q}')`):function(le,Fe,Le){if(!le)return;const ze=RN(le);return`${Le||rO(le)?"utc":"time"}Format(${Fe}, ${ze})`}(M,T,se)}(x,si(e)?(f=xh(e.timeUnit))===null||f===void 0?void 0:f.unit:void 0,t,s.timeFormat,kO(e)&&((m=e.scale)===null||m===void 0?void 0:m.type)===Zu.UTC);return O?{signal:O}:void 0}return t=tI(Z0(e),t,s),si(e)&&Ns(e.bin)?{signal:Yw(x,ti(e,{expr:r,binSuffix:"end"}),t,n,s)}:t||Z0(e)==="quantitative"?{signal:`${nI(x,t)}`}:{signal:`isValid(${x}) ? ${x} : ""+${x}`}}function QN(e,t,n){return si(e)?n?`${ti(e,{expr:t,suffix:"end"})}-${ti(e,{expr:t,suffix:"start"})}`:ti(e,{expr:t}):function(r){const{datum:i}=r;return _b(i)?ax(i):`${JSON.stringify(i)}`}(e)}function gO({fieldOrDatumDef:e,format:t,formatType:n,expr:r,normalizeStack:i,config:s,field:f}){return f=f??QN(e,r,i),si(e)&&Ns(e.bin)?{signal:Yw(f,ti(e,{expr:r,binSuffix:"end"}),t,n,s)}:{signal:JN(n,f,t)}}function ZN(e,t,n,r,i,s){var f;if(!Ly(r))return rk(e)?function(m,x,O,T){return m||(x?{signal:RN(x)}:T?void 0:O.timeFormat)}(n,si(e)?(f=xh(e.timeUnit))===null||f===void 0?void 0:f.unit:void 0,i,s):tI(t,n,i)}function eI(e,t,n){return e&&(da(e)||e==="number"||e==="time")?e:rk(t)&&n!=="time"&&n!=="utc"?"time":void 0}function tI(e,t,n){return Ha(t)?t:e===By?n.numberFormat:void 0}function nI(e,t){return`format(${e}, "${t||""}")`}function rI(e,t,n,r){var i;return Ly(n)?JN(n,e,t):nI(e,(i=Ha(t)?t:void 0)!==null&&i!==void 0?i:r.numberFormat)}function Yw(e,t,n,r,i){const s=rI(e,n,r,i),f=rI(t,n,r,i);return`${cO(e,!1)} ? "null" : ${s} + "${LL}" + ${f}`}const Jw="min",zL={x:1,y:1,color:1,fill:1,stroke:1,strokeWidth:1,size:1,shape:1,fillOpacity:1,strokeOpacity:1,opacity:1,text:1};function iI(e){return e in zL}function aI(e){return!!e&&!!e.encoding}function Ev(e){return!(!e||e.op!=="count"&&!e.field)}function oI(e){return!!e&&Gi(e)}function sx(e){return"row"in e||"column"in e}function vO(e){return!!e&&"header"in e}function Qw(e){return"facet"in e}function sI(e){const{field:t,timeUnit:n,bin:r,aggregate:i}=e;return Object.assign(Object.assign(Object.assign(Object.assign({},n?{timeUnit:n}:{}),r?{bin:r}:{}),i?{aggregate:i}:{}),{field:t})}function uI(e){return Sp(e)&&"sort"in e}function ux({channel:e,fieldDef:t,fieldDef2:n,markDef:r,stack:i,config:s,isMidPoint:f}){if(Ca(t)&&t.band!==void 0)return t.band;if(si(t)){const{timeUnit:m,bin:x}=t;if(m&&!n)return f?Wy("timeUnitBandPosition",r,s):pN(r.type)?Wy("timeUnitBand",r,s):0;if(Ns(x))return pN(r.type)&&!f?1:.5}return i?.fieldChannel===e&&f?.5:void 0}function yO(e,t,n,r,i,s){return!!(Ns(t.bin)||t.timeUnit&&Sp(t)&&t.type==="temporal")&&!!ux({channel:e,fieldDef:t,fieldDef2:n,stack:r,markDef:i,config:s})}function bO(e){return!!e&&"condition"in e}function Zw(e){const t=e&&e.condition;return!!t&&!Gi(t)&&si(t)}function xO(e){const t=e&&e.condition;return!!t&&!Gi(t)&&Ca(t)}function si(e){return!(!e||!e.field&&e.aggregate!=="count")}function Z0(e){return e&&e.type}function ey(e){return!!e&&"datum"in e}function Cv(e){return Sp(e)&&hI(e)||wO(e)}function wO(e){return ey(e)&&Ju(e.datum)}function Ca(e){return si(e)||ey(e)}function Sp(e){return!!e&&("field"in e&&"type"in e||e.aggregate==="count")}function c0(e){return e&&"value"in e&&"value"in e}function kO(e){return!!e&&("scale"in e||"sort"in e)}function EO(e){return e&&("axis"in e||"stack"in e||"impute"in e)}function cI(e){return!!e&&"legend"in e}function lI(e){return!!e&&("format"in e||"formatType"in e)}function ti(e,t={}){var n,r,i;let s=e.field;const f=t.prefix;let m=t.suffix,x="";if(function(O){return O.aggregate==="count"}(e))s=function(O){return function(T){return T.indexOf("__")===0}(O)?O:`__${O}`}("count");else{let O;if(!t.nofn)if(function(T){return"op"in T}(e))O=e.op;else{const{bin:T,aggregate:M,timeUnit:q}=e;Ns(T)?(O=_N(T),m=((n=t.binSuffix)!==null&&n!==void 0?n:"")+((r=t.suffix)!==null&&r!==void 0?r:"")):M?Fy(M)?(x=`["${s}"]`,s=`argmax_${M.argmax}`):V0(M)?(x=`["${s}"]`,s=`argmin_${M.argmin}`):O=String(M):q&&(O=function(Q){const se=xh(Q),{utc:le}=se,Fe=Pi(se,["utc"]);return Fe.unit?(le?"utc":"")+Kr(Fe).map(Le=>Qs(`${Le==="unit"?"":`_${Le}_`}${Fe[Le]}`)).join(""):(le?"utc":"")+"timeunit"+Kr(Fe).map(Le=>Qs(`_${Le}_${Fe[Le]}`)).join("")}(q),m=(!Ji(["range","mid"],t.binSuffix)&&t.binSuffix||"")+((i=t.suffix)!==null&&i!==void 0?i:""))}O&&(s=s?`${O}_${s}`:O)}return m&&(s=`${s}_${m}`),f&&(s=`${f}_${s}`),t.forAs?oN(s):t.expr?function(O,T="datum"){return`${T}[${go(Dy(O).join("."))}]`}(s,t.expr)+x:W0(s)+x}function fI(e){switch(e.type){case"nominal":case"ordinal":case"geojson":return!0;case"quantitative":return si(e)&&!!e.bin;case"temporal":return!1}throw new Error(he.invalidFieldType(e.type))}function hI(e){return!fI(e)}const dI=(e,t)=>{switch(t.fieldTitle){case"plain":return e.field;case"functional":return function(n){const{aggregate:r,bin:i,timeUnit:s,field:f}=n;if(Fy(r))return`${f} for argmax(${r.argmax})`;if(V0(r))return`${f} for argmin(${r.argmin})`;const m=xh(s),x=r||m?.unit||m?.maxbins&&"timeunit"||Ns(i)&&"bin";return x?x.toUpperCase()+"("+f+")":f}(e);default:return function(n,r){var i;const{field:s,bin:f,timeUnit:m,aggregate:x}=n;if(x==="count")return r.countTitle;if(Ns(f))return`${s} (binned)`;if(m){const O=(i=xh(m))===null||i===void 0?void 0:i.unit;if(O)return`${s} (${iO(O).join("-")})`}else if(x)return Fy(x)?`${s} for max ${x.argmax}`:V0(x)?`${s} for min ${x.argmin}`:`${Sw(x)} of ${s}`;return s}(e,t)}};let pI=dI;function mI(e){pI=e}function zy(e,t,{allowDisabling:n,includeDefault:r=!0}){var i,s;const f=((i=CO(e))!==null&&i!==void 0?i:{}).title;if(!si(e))return f;const m=e,x=r?gI(m,t):void 0;return n?Qu(f,m.title,x):(s=f??m.title)!==null&&s!==void 0?s:x}function CO(e){return EO(e)&&e.axis?e.axis:cI(e)&&e.legend?e.legend:vO(e)&&e.header?e.header:void 0}function gI(e,t){return pI(e,t)}function ek(e){var t;if(lI(e)){const{format:n,formatType:r}=e;return{format:n,formatType:r}}{const n=(t=CO(e))!==null&&t!==void 0?t:{},{format:r,formatType:i}=n;return{format:r,formatType:i}}}function Ov(e){return si(e)?e:Zw(e)?e.condition:void 0}function yc(e){return Ca(e)?e:xO(e)?e.condition:void 0}function OO(e,t,n){if(Ha(e)||Ju(e)||K1(e)){const r=Ha(e)?"string":Ju(e)?"number":"boolean";return Gr(he.primitiveChannelDef(t,r,e)),{value:e}}return Ca(e)?tk(e,t,n):xO(e)?Object.assign(Object.assign({},e),{condition:tk(e.condition,t,n)}):e}function tk(e,t,n){if(lI(e)){const{format:r,formatType:i}=e,s=Pi(e,["format","formatType"]);if(Ly(i)&&!n.customFormatTypes)return Gr(he.customFormatTypeNotAllowed(t)),tk(s,t,n)}else{const r=EO(e)?"axis":cI(e)?"legend":vO(e)?"header":null;if(r&&e[r]){const i=e[r],{format:s,formatType:f}=i,m=Pi(i,["format","formatType"]);if(Ly(f)&&!n.customFormatTypes)return Gr(he.customFormatTypeNotAllowed(t)),tk(Object.assign(Object.assign({},e),{[r]:m}),t,n)}}return si(e)?vI(e,t):function(r){let i=r.type;if(i)return r;const{datum:s}=r;return i=Ju(s)?"quantitative":Ha(s)?"nominal":_b(s)?"temporal":void 0,Object.assign(Object.assign({},r),{type:i})}(e)}function vI(e,t){const{aggregate:n,timeUnit:r,bin:i,field:s}=e,f=Object.assign({},e);if(!n||Y3(n)||Fy(n)||V0(n)||(Gr(he.invalidAggregate(n)),delete f.aggregate),r&&(f.timeUnit=xh(r)),s&&(f.field=`${s}`),Ns(i)&&(f.bin=nk(i,t)),bh(i)&&!wv(t)&&Gr(`Channel ${t} should not be used with "binned" bin.`),Sp(f)){const{type:m}=f,x=function(O){if(O)switch(O=O.toLowerCase()){case"q":case By:return"quantitative";case"t":case Db:return"temporal";case"o":case lO:return"ordinal";case"n":case fO:return"nominal";case Tb:return"geojson"}}(m);m!==x&&(f.type=x),m!=="quantitative"&&vN(n)&&(Gr(he.invalidFieldTypeForCountAggregate(m,n)),f.type="quantitative")}else if(!CN(t)){const m=function(x,O){if(x.timeUnit)return"temporal";if(Ns(x.bin))return"quantitative";switch(Hw(O)){case"continuous":return"quantitative";case"discrete":case"flexible":return"nominal";default:return"quantitative"}}(f,t);Gr(he.missingFieldType(t,m)),f.type=m}if(Sp(f)){const{compatible:m,warning:x}=function(O,T){const M=O.type;if(M==="geojson"&&T!=="shape")return{compatible:!1,warning:`Channel ${T} should not be used with a geojson data.`};switch(T){case r0:case i0:case jw:return hI(O)?{compatible:!1,warning:he.facetChannelShouldBeDiscrete(T)}:Uy;case ou:case vc:case Cd:case vv:case yv:case tx:case rx:case Bw:case My:case Pw:case Lw:case Ry:case cg:case pv:case zw:return Uy;case gv:case pm:case mv:case lg:return M!==By?{compatible:!1,warning:`Channel ${T} should be used with a quantitative field only, not ${O.type} field.`}:Uy;case u0:case q0:case H0:case $0:case s0:case o0:case a0:case ug:case dv:return M!=="nominal"||O.sort?Uy:{compatible:!1,warning:`Channel ${T} should not be used with an unsorted discrete field.`};case G0:return Ji(["ordinal","nominal"],O.type)?Uy:{compatible:!1,warning:"StrokeDash channel should be used with only discrete data."};case Od:return Ji(["ordinal","nominal","geojson"],O.type)?Uy:{compatible:!1,warning:"Shape channel should be used with only either discrete or geojson data."};case nx:return O.type!=="nominal"||"sort"in O?Uy:{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}}}(f,t);m||Gr(x)}if(uI(f)&&Ha(f.sort)){const{sort:m}=f;if(iI(m))return Object.assign(Object.assign({},f),{sort:{encoding:m}});const x=m.substr(1);if(m.charAt(0)==="-"&&iI(x))return Object.assign(Object.assign({},f),{sort:{encoding:x,order:"descending"}})}if(vO(f)){const{header:m}=f,{orient:x}=m,O=Pi(m,["orient"]);if(x)return Object.assign(Object.assign({},f),{header:Object.assign(Object.assign({},O),{labelOrient:m.labelOrient||x,titleOrient:m.titleOrient||x})})}return f}function nk(e,t){return K1(e)?{maxbins:SN(t)}:e==="binned"?{binned:!0}:e.maxbins||e.step?e:Object.assign(Object.assign({},e),{maxbins:SN(t)})}const Uy={compatible:!0};function rk(e){const{formatType:t}=ek(e);return t==="time"||!t&&function(n){return n&&(n.type==="temporal"||si(n)&&!!n.timeUnit)}(e)}function AO(e,{timeUnit:t,type:n,wrapTime:r,undefinedIfExprNotRequired:i}){var s;const f=t&&((s=xh(t))===null||s===void 0?void 0:s.unit);let m,x=f||n==="temporal";return da(e)?m=e.signal:_b(e)?(x=!0,m=ax(e)):(Ha(e)||Ju(e))&&x&&(m=`datetime(${JSON.stringify(e)})`,function(O){return!!IN[O]}(f)&&(Ju(e)&&e<1e4||Ha(e)&&isNaN(Date.parse(e)))&&(m=ax({[f]:e}))),m?r&&x?`time(${m})`:m:i?void 0:JSON.stringify(e)}function yI(e,t){const{type:n}=e;return t.map(r=>{const i=AO(r,{timeUnit:si(e)?e.timeUnit:void 0,type:n,undefinedIfExprNotRequired:!0});return i!==void 0?{signal:i}:r})}function cx(e,t){return Ns(e.bin)?Y0(t)&&Ji(["ordinal","nominal"],e.type):(console.warn("Only call this method for binned field defs."),!1)}function bI(e){const{anchor:t,frame:n,offset:r,orient:i,color:s,subtitleColor:f,subtitleFont:m,subtitleFontSize:x,subtitleFontStyle:O,subtitleFontWeight:T,subtitleLineHeight:M,subtitlePadding:q}=e,Q=Pi(e,["anchor","frame","offset","orient","color","subtitleColor","subtitleFont","subtitleFontSize","subtitleFontStyle","subtitleFontWeight","subtitleLineHeight","subtitlePadding"]),se=Object.assign(Object.assign({},Q),s?{fill:s}:{}),le=Object.assign(Object.assign(Object.assign(Object.assign({},t?{anchor:t}:{}),n?{frame:n}:{}),r?{offset:r}:{}),i?{orient:i}:{}),Fe=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},f?{subtitleColor:f}:{}),m?{subtitleFont:m}:{}),x?{subtitleFontSize:x}:{}),O?{subtitleFontStyle:O}:{}),T?{subtitleFontWeight:T}:{}),M?{subtitleLineHeight:M}:{}),q?{subtitlePadding:q}:{});return{titleMarkConfig:se,subtitleMarkConfig:J1(se,["align","baseline","dx","dy","limit"]),nonMark:le,subtitle:Fe}}function ty(e){return Ha(e)||Gi(e)&&Ha(e[0])}function ju(e){return da(e)?e:e!==void 0?{value:e}:void 0}function xI(e){return da(e)?e.signal:go(e.value)}function lx(e){return da(e)?e.signal:e==null?null:go(e)}function wI(e){var t;return[].concat(e.type,(t=e.style)!==null&&t!==void 0?t:[])}function $o(e,t,n,r={}){const{vgChannel:i,ignoreVgConfig:s}=r;return i&&t[i]!==void 0?t[i]:t[e]!==void 0?t[e]:!s||i&&i!==e?Wy(e,t,n,r):void 0}function Wy(e,t,n,{vgChannel:r}={}){return Qu(r?ik(e,t,n.style):void 0,ik(e,t,n.style),r?n[t.type][r]:void 0,n[t.type][e],r?n.mark[r]:n.mark[e])}function ik(e,t,n){return kI(e,wI(t),n)}function kI(e,t,n){let r;t=Mu(t);for(const i of t){const s=n[i];s&&s[e]!==void 0&&(r=s[e])}return r}function EI(e,t){return Mu(e).reduce((n,r)=>{var i;return n.field.push(ti(r,t)),n.order.push((i=r.sort)!==null&&i!==void 0?i:"ascending"),n},{field:[],order:[]})}function CI(e,t){const n=[...e];return t.forEach(r=>{for(const i of n)if(Y1(i,r))return;n.push(r)}),n}function OI(e,t){return Y1(e,t)||!t?e:e?[...Mu(e),...Mu(t)].join(", "):t}function AI(e,t){const n=e.value,r=t.value;if(n==null||r===null)return{explicit:e.explicit,value:null};if((ty(n)||da(n))&&(ty(r)||da(r)))return{explicit:e.explicit,value:OI(n,r)};if(ty(n)||da(n))return{explicit:e.explicit,value:n};if(ty(r)||da(r))return{explicit:e.explicit,value:r};if(!(ty(n)||da(n)||ty(r)||da(r)))return{explicit:e.explicit,value:CI(n,r)};throw new Error("It should never reach here")}function Vy(e,t){const n=e&&e[t];return!!n&&(Gi(n)?Q1(n,r=>!!r.field):si(n)||Zw(n))}function _O(e){return Q1(wN,t=>{if(Vy(e,t)){const n=e[t];if(Gi(n))return Q1(n,r=>!!r.aggregate);{const r=Ov(n);return r&&!!r.aggregate}}return!1})}function SO(e,t){const n=[],r=[],i=[],s=[],f={};return DO(e,(m,x)=>{if(si(m)){const{field:O,aggregate:T,bin:M,timeUnit:q}=m,Q=Pi(m,["field","aggregate","bin","timeUnit"]);if(T||q||M){const se=CO(m),le=se&&se.title;let Fe=ti(m,{forAs:!0});const Le=Object.assign(Object.assign(Object.assign({},le?[]:{title:zy(m,t,{allowDisabling:!0})}),Q),{field:Fe});if(T){let ze;if(Fy(T)?(ze="argmax",Fe=ti({op:"argmax",field:T.argmax},{forAs:!0}),Le.field=`${Fe}.${O}`):V0(T)?(ze="argmin",Fe=ti({op:"argmin",field:T.argmin},{forAs:!0}),Le.field=`${Fe}.${O}`):T!=="boxplot"&&T!=="errorbar"&&T!=="errorband"&&(ze=T),ze){const nt={op:ze,as:Fe};O&&(nt.field=O),s.push(nt)}}else if(n.push(Fe),Sp(m)&&Ns(M)){if(r.push({bin:M,field:O,as:Fe}),n.push(ti(m,{binSuffix:"end"})),cx(m,x)&&n.push(ti(m,{binSuffix:"range"})),wv(x)){const ze={field:Fe+"_end"};f[x+"2"]=ze}Le.bin="binned",CN(x)||(Le.type=By)}else if(q){i.push({timeUnit:q,field:O,as:Fe});const ze=Sp(m)&&m.type!==Db&&"time";ze&&(x===tx||x===My?Le.formatType=ze:function(nt){return!!Ww[nt]}(x)?Le.legend=Object.assign({formatType:ze},Le.legend):wv(x)&&(Le.axis=Object.assign({formatType:ze},Le.axis)))}f[x]=Le}else n.push(O),f[x]=e[x]}else f[x]=e[x]}),{bins:r,timeUnits:i,aggregate:s,groupby:n,encoding:f}}function UL(e,t,n){const r=t.type;return Kr(e).reduce((i,s)=>{if(!EN(s))return Gr(he.invalidEncodingChannel(s)),i;const f=e[s];if(s!=="angle"||r!=="arc"||e.theta||(Gr(he.REPLACE_ANGLE_WITH_THETA),s=cg),!function(m,x,O){const T=Q7(x,O);if(!T)return!1;if(T==="binned"){const M=m[x===ug?ou:vc];return!!(si(M)&&si(m[x])&&bh(M.bin))}return!0}(e,s,r))return Gr(he.incompatibleChannel(s,r)),i;if(s===s0&&r==="line"){const m=Ov(e[s]);if(m?.aggregate)return Gr(he.LINE_WITH_VARYING_SIZE),i}if(s===Cd&&(t.filled?"fill"in e:"stroke"in e))return Gr(he.droppingColor("encoding",{fill:"fill"in e,stroke:"stroke"in e})),i;if(s===rx||s===nx&&!Gi(f)&&!c0(f)||s===My&&Gi(f))f&&(i[s]=Mu(f).reduce((m,x)=>(si(x)?m.push(vI(x,s)):Gr(he.emptyFieldDef(x,s)),m),[]));else{if(s===My&&f===null)i[s]=null;else if(!(si(f)||ey(f)||c0(f)||bO(f)||da(f)))return Gr(he.emptyFieldDef(f,s)),i;i[s]=OO(f,s,n)}return i},{})}function DO(e,t,n){if(e)for(const r of Kr(e)){const i=e[r];if(Gi(i))for(const s of i)t.call(n,s,r);else t.call(n,i,r)}}function _I(e,t,n,r){return e?Kr(e).reduce((i,s)=>{const f=e[s];return Gi(f)?f.reduce((m,x)=>t.call(r,m,x,s),i):t.call(r,i,f,s)},n):n}function SI(e,t){return Kr(t).reduce((n,r)=>{switch(r){case ou:case vc:case Pw:case zw:case Lw:case ug:case dv:case cg:case o0:case pv:case a0:case mv:case gv:case lg:case pm:case tx:case Od:case Ry:case My:return n;case nx:if(e==="line"||e==="trail")return n;case rx:case Bw:{const i=t[r];if(Gi(i)||si(i))for(const s of Mu(i))s.aggregate||n.push(ti(s,{}));return n}case s0:if(e==="trail")return n;case Cd:case vv:case yv:case u0:case q0:case H0:case G0:case $0:{const i=Ov(t[r]);return i&&!i.aggregate&&n.push(ti(i,{})),n}}},[])}function TO(e,t,n,r=!0){return"tooltip"in n?{tooltip:n.tooltip}:{tooltip:[...e.map(({fieldPrefix:i,titlePrefix:s})=>{const f=r?` of ${t.field}`:"";return{field:i+t.field,type:t.type,title:da(s)?{signal:s+`"${escape(f)}"`}:s+f}}),...function(i){const s=[];for(const f of Kr(i))if(Vy(i,f)){const m=i[f],x=Mu(m);for(const O of x)si(O)?s.push(O):Zw(O)&&s.push(O.condition)}return s}(n)]}}function DI(e){const{axis:t,title:n,field:r}=e;return t&&t.title!==void 0?void 0:Qu(n,r)}function NO(e,t,n,r,i){const{scale:s,axis:f}=n;return({partName:m,mark:x,positionPrefix:O,endPositionPrefix:T,aria:M,extraEncoding:q={}})=>{const Q=DI(n);return TI(e,m,i,M,{mark:x,encoding:Object.assign(Object.assign(Object.assign({[t]:Object.assign(Object.assign(Object.assign({field:O+"_"+n.field,type:n.type},Q!==void 0?{title:Q}:{}),s!==void 0?{scale:s}:{}),f!==void 0?{axis:f}:{})},Ha(T)?{[t+"2"]:{field:T+"_"+n.field}}:{}),r),q)})}}function TI(e,t,n,r,i){const{clip:s,color:f,opacity:m}=e,x=e.type;return e[t]||e[t]===void 0&&n[t]?[Object.assign(Object.assign({},i),{mark:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},n[t]),s?{clip:s}:{}),f?{color:f}:{}),m?{opacity:m}:{}),hv(i.mark)?i.mark:{type:i.mark}),{style:`${x}-${t}`}),K1(e[t])?{}:e[t]),r===!1?{aria:r}:{})})]:[]}function NI(e,t,n){const{encoding:r}=e,i=t==="vertical"?"y":"x",s=r[i],f=r[i+"2"],m=r[i+"Error"],x=r[i+"Error2"];return{continuousAxisChannelDef:ak(s,n),continuousAxisChannelDef2:ak(f,n),continuousAxisChannelDefError:ak(m,n),continuousAxisChannelDefError2:ak(x,n),continuousAxis:i}}function ak(e,t){if(e&&e.aggregate){const{aggregate:n}=e,r=Pi(e,["aggregate"]);return n!==t&&Gr(he.errorBarContinuousAxisHasCustomizedAggregate(n,t)),r}return e}function II(e,t){const{mark:n,encoding:r}=e,{x:i,y:s}=r;if(Cv(i)){if(Cv(s)){const f=si(i)&&i.aggregate,m=si(s)&&s.aggregate;if(f||m!==t){if(m||f!==t){if(f===t&&m===t)throw new Error("Both x and y cannot have aggregate");return hv(n)&&n.orient?n.orient:"vertical"}return"horizontal"}return"vertical"}return"horizontal"}if(Cv(s))return"vertical";throw new Error("Need a valid continuous axis for "+t+"s")}const ok="boxplot",WL=new Mw(ok,RI);function FI(e){return Ju(e)?"tukey":e}function RI(e,{config:t}){var n,r;const{mark:i,encoding:s,selection:f,projection:m}=e,x=Pi(e,["mark","encoding","selection","projection"]),O=hv(i)?i:{type:i};f&&Gr(he.selectionNotSupported("boxplot"));const T=(n=O.extent)!==null&&n!==void 0?n:t.boxplot.extent,M=$o("size",O,t),q=FI(T),{transform:Q,continuousAxisChannelDef:se,continuousAxis:le,groupby:Fe,aggregate:Le,encodingWithoutContinuousAxis:ze,ticksOrient:nt,boxOrient:it,customTooltipWithoutAggregatedField:ut}=function(Ar,Jr,gi){const vi=II(Ar,ok),{continuousAxisChannelDef:Li,continuousAxis:wi}=NI(Ar,vi,ok),yi=Li.field,Si=FI(Jr),xa=[...MI(yi),{op:"median",field:yi,as:"mid_box_"+yi},{op:"min",field:yi,as:(Si==="min-max"?"lower_whisker_":"min_")+yi},{op:"max",field:yi,as:(Si==="min-max"?"upper_whisker_":"max_")+yi}],no=Si==="min-max"||Si==="tukey"?[]:[{calculate:`datum["upper_box_${yi}"] - datum["lower_box_${yi}"]`,as:"iqr_"+yi},{calculate:`min(datum["upper_box_${yi}"] + datum["iqr_${yi}"] * ${Jr}, datum["max_${yi}"])`,as:"upper_whisker_"+yi},{calculate:`max(datum["lower_box_${yi}"] - datum["iqr_${yi}"] * ${Jr}, datum["min_${yi}"])`,as:"lower_whisker_"+yi}],zi=Ar.encoding,vo=wi,Lo=(zi[vo],Pi(zi,[typeof vo=="symbol"?vo:vo+""])),{customTooltipWithoutAggregatedField:co,filteredEncoding:Is}=function(qb){const{tooltip:y0}=qb,Hb=Pi(qb,["tooltip"]);if(!y0)return{filteredEncoding:qb};let cy,kh;if(Gi(y0)){for(const PA of y0)PA.aggregate?(cy||(cy=[]),cy.push(PA)):(kh||(kh=[]),kh.push(PA));cy&&(Hb.tooltip=cy)}else y0.aggregate?Hb.tooltip=y0:kh=y0;return Gi(kh)&&kh.length===1&&(kh=kh[0]),{customTooltipWithoutAggregatedField:kh,filteredEncoding:Hb}}(Lo),{bins:Fs,timeUnits:gs,aggregate:kl,groupby:$k,encoding:BA}=SO(Is,gi);return{transform:[...Fs,...gs,{aggregate:[...kl,...xa],groupby:$k},...no],groupby:$k,aggregate:kl,continuousAxisChannelDef:Li,continuousAxis:wi,encodingWithoutContinuousAxis:BA,ticksOrient:vi==="vertical"?"horizontal":"vertical",boxOrient:vi,customTooltipWithoutAggregatedField:co}}(e,T,t),{color:st,size:pt}=ze,dt=Pi(ze,["color","size"]),Qt=Ar=>NO(O,le,se,Ar,t.boxplot),mn=Qt(dt),on=Qt(ze),Rn=Qt(Object.assign(Object.assign({},dt),pt?{size:pt}:{})),Fn=TO([{fieldPrefix:q==="min-max"?"upper_whisker_":"max_",titlePrefix:"Max"},{fieldPrefix:"upper_box_",titlePrefix:"Q3"},{fieldPrefix:"mid_box_",titlePrefix:"Median"},{fieldPrefix:"lower_box_",titlePrefix:"Q1"},{fieldPrefix:q==="min-max"?"lower_whisker_":"min_",titlePrefix:"Min"}],se,ze),zn={type:"tick",color:"black",opacity:1,orient:nt,invalid:null},Vn=q==="min-max"?Fn:TO([{fieldPrefix:"upper_whisker_",titlePrefix:"Upper Whisker"},{fieldPrefix:"lower_whisker_",titlePrefix:"Lower Whisker"}],se,ze),Qn=[...mn({partName:"rule",mark:{type:"rule",invalid:null},positionPrefix:"lower_whisker",endPositionPrefix:"lower_box",aria:!1,extraEncoding:Vn}),...mn({partName:"rule",mark:{type:"rule",invalid:null},positionPrefix:"upper_box",endPositionPrefix:"upper_whisker",aria:!1,extraEncoding:Vn}),...mn({partName:"ticks",mark:zn,positionPrefix:"lower_whisker",aria:!1,extraEncoding:Vn}),...mn({partName:"ticks",mark:zn,positionPrefix:"upper_whisker",aria:!1,extraEncoding:Vn})],pr=[...q!=="tukey"?Qn:[],...on({partName:"box",mark:Object.assign(Object.assign({type:"bar"},M?{size:M}:{}),{orient:it,invalid:null}),positionPrefix:"lower_box",endPositionPrefix:"upper_box",aria:!1,extraEncoding:Fn}),...Rn({partName:"median",mark:Object.assign(Object.assign(Object.assign({type:"tick",invalid:null},Uc(t.boxplot.median)&&t.boxplot.median.color?{color:t.boxplot.median.color}:{}),M?{size:M}:{}),{orient:nt,ariaRoleDescription:"box"}),positionPrefix:"mid_box",extraEncoding:Fn})];let Pr;if(q!=="min-max"){const Ar=`datum["lower_box_${se.field}"]`,Jr=`datum["upper_box_${se.field}"]`,gi=`(${Jr} - ${Ar})`,vi=`${Ar} - ${T} * ${gi}`,Li=`${Jr} + ${T} * ${gi}`,wi=`datum["${se.field}"]`,yi={joinaggregate:MI(se.field),groupby:Fe};let Si;q==="tukey"&&(Si={transform:[{filter:`(${vi} <= ${wi}) && (${wi} <= ${Li})`},{aggregate:[{op:"min",field:se.field,as:"lower_whisker_"+se.field},{op:"max",field:se.field,as:"upper_whisker_"+se.field},{op:"min",field:"lower_box_"+se.field,as:"lower_box_"+se.field},{op:"max",field:"upper_box_"+se.field,as:"upper_box_"+se.field},...Le],groupby:Fe}],layer:Qn});const{tooltip:xa}=dt,no=Pi(dt,["tooltip"]),{scale:zi,axis:vo}=se,Lo=DI(se),co=TI(O,"outliers",t.boxplot,!0,{transform:[{filter:`(${wi} < ${vi}) || (${wi} > ${Li})`}],mark:"point",encoding:Object.assign(Object.assign({[le]:Object.assign(Object.assign(Object.assign({field:se.field,type:se.type},Lo!==void 0?{title:Lo}:{}),zi!==void 0?{scale:zi}:{}),vo!==void 0?{axis:vo}:{})},no),ut?{tooltip:ut}:{})})[0];co&&Si?Pr={transform:[yi],layer:[co,Si]}:co?(Pr=co).transform.unshift(yi):Si&&(Pr=Si).transform.unshift(yi)}return Pr?Object.assign(Object.assign({},x),{layer:[Pr,{transform:Q,layer:pr}]}):Object.assign(Object.assign({},x),{transform:((r=x.transform)!==null&&r!==void 0?r:[]).concat(Q),layer:pr})}function MI(e){return[{op:"q1",field:e,as:"lower_box_"+e},{op:"q3",field:e,as:"upper_box_"+e}]}const IO="errorbar",VL=new Mw(IO,jI);function jI(e,{config:t}){const{transform:n,continuousAxisChannelDef:r,continuousAxis:i,encodingWithoutContinuousAxis:s,ticksOrient:f,markDef:m,outerSpec:x,tooltipEncoding:O}=BI(e,IO,t),T=NO(m,i,r,s,t.errorbar),M={type:"tick",orient:f},q=[...T({partName:"ticks",mark:M,positionPrefix:"lower",aria:!1,extraEncoding:O}),...T({partName:"ticks",mark:M,positionPrefix:"upper",aria:!1,extraEncoding:O}),...T({partName:"rule",mark:{type:"rule",ariaRoleDescription:"errorbar"},positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:O})];return Object.assign(Object.assign(Object.assign({},x),{transform:n}),q.length>1?{layer:q}:Object.assign({},q[0]))}function qL(e,t){const{encoding:n}=e;if(function(m){return(Ca(m.x)||Ca(m.y))&&!Ca(m.x2)&&!Ca(m.y2)&&!Ca(m.xError)&&!Ca(m.xError2)&&!Ca(m.yError)&&!Ca(m.yError2)}(n))return{orient:II(e,t),inputType:"raw"};const r=function(m){return Ca(m.x2)||Ca(m.y2)}(n),i=function(m){return Ca(m.xError)||Ca(m.xError2)||Ca(m.yError)||Ca(m.yError2)}(n),s=n.x,f=n.y;if(r){if(i)throw new Error(`${t} cannot be both type aggregated-upper-lower and aggregated-error`);const m=n.x2,x=n.y2;if(Ca(m)&&Ca(x))throw new Error(`${t} cannot have both x2 and y2`);if(Ca(m)){if(Cv(s))return{orient:"horizontal",inputType:"aggregated-upper-lower"};throw new Error(`Both x and x2 have to be quantitative in ${t}`)}if(Ca(x)){if(Cv(f))return{orient:"vertical",inputType:"aggregated-upper-lower"};throw new Error(`Both y and y2 have to be quantitative in ${t}`)}throw new Error("No ranged axis")}{const m=n.xError,x=n.xError2,O=n.yError,T=n.yError2;if(Ca(x)&&!Ca(m))throw new Error(`${t} cannot have xError2 without xError`);if(Ca(T)&&!Ca(O))throw new Error(`${t} cannot have yError2 without yError`);if(Ca(m)&&Ca(O))throw new Error(`${t} cannot have both xError and yError with both are quantiative`);if(Ca(m)){if(Cv(s))return{orient:"horizontal",inputType:"aggregated-error"};throw new Error("All x, xError, and xError2 (if exist) have to be quantitative")}if(Ca(O)){if(Cv(f))return{orient:"vertical",inputType:"aggregated-error"};throw new Error("All y, yError, and yError2 (if exist) have to be quantitative")}throw new Error("No ranged axis")}}function BI(e,t,n){var r;const{mark:i,encoding:s,selection:f,projection:m}=e,x=Pi(e,["mark","encoding","selection","projection"]),O=hv(i)?i:{type:i};f&&Gr(he.selectionNotSupported(t));const{orient:T,inputType:M}=qL(e,t),{continuousAxisChannelDef:q,continuousAxisChannelDef2:Q,continuousAxisChannelDefError:se,continuousAxisChannelDefError2:le,continuousAxis:Fe}=NI(e,T,t),{errorBarSpecificAggregate:Le,postAggregateCalculates:ze,tooltipSummary:nt,tooltipTitleWithFieldName:it}=function(Ar,Jr,gi,vi,Li,wi,yi,Si){let xa=[],no=[];const zi=Jr.field;let vo,Lo=!1;if(wi==="raw"){const co=Ar.center?Ar.center:Ar.extent?Ar.extent==="iqr"?"median":"mean":Si.errorbar.center,Is=Ar.extent?Ar.extent:co==="mean"?"stderr":"iqr";if(co==="median"!=(Is==="iqr")&&Gr(he.errorBarCenterIsUsedWithWrongExtent(co,Is,yi)),Is==="stderr"||Is==="stdev")xa=[{op:Is,field:zi,as:"extent_"+zi},{op:co,field:zi,as:"center_"+zi}],no=[{calculate:`datum["center_${zi}"] + datum["extent_${zi}"]`,as:"upper_"+zi},{calculate:`datum["center_${zi}"] - datum["extent_${zi}"]`,as:"lower_"+zi}],vo=[{fieldPrefix:"center_",titlePrefix:Sw(co)},{fieldPrefix:"upper_",titlePrefix:PI(co,Is,"+")},{fieldPrefix:"lower_",titlePrefix:PI(co,Is,"-")}],Lo=!0;else{let Fs,gs,kl;Ar.center&&Ar.extent&&Gr(he.errorBarCenterIsNotNeeded(Ar.extent,yi)),Is==="ci"?(Fs="mean",gs="ci0",kl="ci1"):(Fs="median",gs="q1",kl="q3"),xa=[{op:gs,field:zi,as:"lower_"+zi},{op:kl,field:zi,as:"upper_"+zi},{op:Fs,field:zi,as:"center_"+zi}],vo=[{fieldPrefix:"upper_",titlePrefix:zy({field:zi,aggregate:kl,type:"quantitative"},Si,{allowDisabling:!1})},{fieldPrefix:"lower_",titlePrefix:zy({field:zi,aggregate:gs,type:"quantitative"},Si,{allowDisabling:!1})},{fieldPrefix:"center_",titlePrefix:zy({field:zi,aggregate:Fs,type:"quantitative"},Si,{allowDisabling:!1})}]}}else{(Ar.center||Ar.extent)&&Gr(he.errorBarCenterAndExtentAreNotNeeded(Ar.center,Ar.extent)),wi==="aggregated-upper-lower"?(vo=[],no=[{calculate:`datum["${gi.field}"]`,as:"upper_"+zi},{calculate:`datum["${zi}"]`,as:"lower_"+zi}]):wi==="aggregated-error"&&(vo=[{fieldPrefix:"",titlePrefix:zi}],no=[{calculate:`datum["${zi}"] + datum["${vi.field}"]`,as:"upper_"+zi}],Li?no.push({calculate:`datum["${zi}"] + datum["${Li.field}"]`,as:"lower_"+zi}):no.push({calculate:`datum["${zi}"] - datum["${vi.field}"]`,as:"lower_"+zi}));for(const co of no)vo.push({fieldPrefix:co.as.substring(0,6),titlePrefix:Ob(Ob(co.calculate,'datum["',""),'"]',"")})}return{postAggregateCalculates:no,errorBarSpecificAggregate:xa,tooltipSummary:vo,tooltipTitleWithFieldName:Lo}}(O,q,Q,se,le,M,t,n),ut=s,st=Fe,pt=(ut[st],Fe==="x"?"x2":"y2"),dt=(ut[pt],Fe==="x"?"xError":"yError"),Qt=(ut[dt],Fe==="x"?"xError2":"yError2"),mn=(ut[Qt],Pi(ut,[typeof st=="symbol"?st:st+"",typeof pt=="symbol"?pt:pt+"",typeof dt=="symbol"?dt:dt+"",typeof Qt=="symbol"?Qt:Qt+""])),{bins:on,timeUnits:Rn,aggregate:Fn,groupby:zn,encoding:Vn}=SO(mn,n),Qn=[...Fn,...Le],pr=M!=="raw"?[]:zn,Pr=TO(nt,q,Vn,it);return{transform:[...(r=x.transform)!==null&&r!==void 0?r:[],...on,...Rn,...Qn.length===0?[]:[{aggregate:Qn,groupby:pr}],...ze],groupby:pr,continuousAxisChannelDef:q,continuousAxis:Fe,encodingWithoutContinuousAxis:Vn,ticksOrient:T==="vertical"?"horizontal":"vertical",markDef:O,outerSpec:x,tooltipEncoding:Pr}}function PI(e,t,n){return Sw(e)+" "+n+" "+t}const FO="errorband",HL=new Mw(FO,LI);function LI(e,{config:t}){const{transform:n,continuousAxisChannelDef:r,continuousAxis:i,encodingWithoutContinuousAxis:s,markDef:f,outerSpec:m,tooltipEncoding:x}=BI(e,FO,t),O=f,T=NO(O,i,r,s,t.errorband),M=e.encoding.x!==void 0&&e.encoding.y!==void 0;let q={type:M?"area":"rect"},Q={type:M?"line":"rule"};const se=Object.assign(Object.assign({},O.interpolate?{interpolate:O.interpolate}:{}),O.tension&&O.interpolate?{tension:O.tension}:{});return M?(q=Object.assign(Object.assign(Object.assign({},q),se),{ariaRoleDescription:"errorband"}),Q=Object.assign(Object.assign({},Q),se)):O.interpolate?Gr(he.errorBand1DNotSupport("interpolate")):O.tension&&Gr(he.errorBand1DNotSupport("tension")),Object.assign(Object.assign({},m),{transform:n,layer:[...T({partName:"band",mark:q,positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:x}),...T({partName:"borders",mark:Q,positionPrefix:"lower",aria:!1,extraEncoding:x}),...T({partName:"borders",mark:Q,positionPrefix:"upper",aria:!1,extraEncoding:x})]})}const zI={};function RO(e,t,n){const r=new Mw(e,t);zI[e]={normalizer:r,parts:n}}RO(ok,RI,["box","median","outliers","rule","ticks"]),RO(IO,jI,["ticks","rule"]),RO(FO,LI,["band","borders"]);const $L=["gradientHorizontalMaxLength","gradientHorizontalMinLength","gradientVerticalMaxLength","gradientVerticalMinLength","unselectedOpacity"],UI=["size","shape","fill","stroke","strokeDash","strokeWidth","opacity"],GL={fillColor:{part:"legend",vgProp:"fill"},gradientStrokeColor:{part:"gradient",vgProp:"stroke"},labelColor:{part:"labels",vgProp:"fill"},strokeColor:{part:"legend",vgProp:"stroke"},symbolFillColor:{part:"symbols",vgProp:"fill"},symbolStrokeColor:{part:"symbols",vgProp:"stroke"},titleColor:{part:"title",vgProp:"fill"}},KL={aria:1,clipHeight:1,columnPadding:1,columns:1,cornerRadius:1,description:1,direction:1,fillColor:1,format:1,formatType:1,gradientLength:1,gradientOpacity:1,gradientStrokeColor:1,gradientStrokeWidth:1,gradientThickness:1,gridAlign:1,labelAlign:1,labelBaseline:1,labelColor:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labelSeparation:1,legendX:1,legendY:1,offset:1,orient:1,padding:1,rowPadding:1,strokeColor:1,symbolDash:1,symbolDashOffset:1,symbolFillColor:1,symbolLimit:1,symbolOffset:1,symbolOpacity:1,symbolSize:1,symbolStrokeColor:1,symbolStrokeWidth:1,symbolType:1,tickCount:1,tickMinStep:1,title:1,titleAlign:1,titleAnchor:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titleOrient:1,titlePadding:1,type:1,values:1,zindex:1},Nb="_vgsid_",XL={single:{on:"click",fields:[Nb],resolve:"global",empty:"all",clear:"dblclick"},multi:{on:"click",fields:[Nb],toggle:"event.shiftKey",resolve:"global",empty:"all",clear:"dblclick"},interval:{on:"[mousedown, window:mouseup] > window:mousemove!",encodings:["x","y"],translate:"[mousedown, window:mouseup] > window:mousemove!",zoom:"wheel!",mark:{fill:"#333",fillOpacity:.125,stroke:"white"},resolve:"global",clear:"dblclick"}};function MO(e){return!(!e||e!=="legend"&&!e.legend)}function jO(e){return MO(e)&&Uc(e)}function BO(e){return"concat"in e}function sk(e){return"vconcat"in e}function PO(e){return"hconcat"in e}function Av(e){return Uc(e)&&e.step!==void 0}function WI(e){return e.view||e.width||e.height}const YL=Kr({align:1,bounds:1,center:1,columns:1,spacing:1});function LO(e,t){var n;return(n=e[t])!==null&&n!==void 0?n:e[t==="width"?"continuousWidth":"continuousHeight"]}function uk(e,t){const n=fx(e,t);return Av(n)?n.step:zO}function fx(e,t){var n;return Qu((n=e[t])!==null&&n!==void 0?n:e[t==="width"?"discreteWidth":"discreteHeight"],{step:e.step})}const zO=20,JL={background:"white",padding:5,timeFormat:"%b %d, %Y",countTitle:"Count of Records",view:{continuousWidth:200,continuousHeight:200,step:zO},mark:{color:"#4c78a8",invalid:"filter",timeUnitBand:1},arc:{},area:{},bar:P7,circle:{},geoshape:{},image:{},line:{},point:{},rect:L7,rule:{color:"black"},square:{},text:{color:"black"},tick:{thickness:1},trail:{},boxplot:{size:14,extent:1.5,box:{},median:{color:"white"},outliers:{},rule:{},ticks:null},errorbar:{center:"mean",rule:!0,ticks:!1},errorband:{band:{opacity:.3},borders:!1},scale:{pointPadding:.5,barBandPaddingInner:.1,rectBandPaddingInner:0,minBandSize:2,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4,quantileCount:4,quantizeCount:4},projection:{},legend:{gradientHorizontalMaxLength:200,gradientHorizontalMinLength:100,gradientVerticalMaxLength:200,gradientVerticalMinLength:64,unselectedOpacity:.35},header:{titlePadding:10,labelPadding:10},headerColumn:{},headerRow:{},headerFacet:{},selection:XL,style:{},title:{},facet:{spacing:20},concat:{spacing:20}},l0=["#4c78a8","#f58518","#e45756","#72b7b2","#54a24b","#eeca3b","#b279a2","#ff9da6","#9d755d","#bab0ac"],VI={text:11,guideLabel:10,guideTitle:11,groupTitle:13,groupSubtitle:12},qI={blue:l0[0],orange:l0[1],red:l0[2],teal:l0[3],green:l0[4],yellow:l0[5],purple:l0[6],pink:l0[7],brown:l0[8],gray0:"#000",gray1:"#111",gray2:"#222",gray3:"#333",gray4:"#444",gray5:"#555",gray6:"#666",gray7:"#777",gray8:"#888",gray9:"#999",gray10:"#aaa",gray11:"#bbb",gray12:"#ccc",gray13:"#ddd",gray14:"#eee",gray15:"#fff"};function HI(e={}){const{color:t,font:n,fontSize:r}=e,i=Pi(e,["color","font","fontSize"]);return QT({},JL,n?function(s){return{text:{font:s},style:{"guide-label":{font:s},"guide-title":{font:s},"group-title":{font:s},"group-subtitle":{font:s}}}}(n):{},t?function(s={}){return{signals:[{name:"color",value:Uc(s)?Object.assign(Object.assign({},qI),s):qI}],mark:{color:{signal:"color.blue"}},rule:{color:{signal:"color.gray0"}},text:{color:{signal:"color.gray0"}},style:{"guide-label":{fill:{signal:"color.gray0"}},"guide-title":{fill:{signal:"color.gray0"}},"group-title":{fill:{signal:"color.gray0"}},"group-subtitle":{fill:{signal:"color.gray0"}},cell:{stroke:{signal:"color.gray8"}}},axis:{domainColor:{signal:"color.gray13"},gridColor:{signal:"color.gray8"},tickColor:{signal:"color.gray13"}},range:{category:[{signal:"color.blue"},{signal:"color.orange"},{signal:"color.red"},{signal:"color.teal"},{signal:"color.green"},{signal:"color.yellow"},{signal:"color.purple"},{signal:"color.pink"},{signal:"color.brown"},{signal:"color.grey8"}]}}}(t):{},r?function(s){return{signals:[{name:"fontSize",value:Uc(s)?Object.assign(Object.assign({},VI),s):VI}],text:{fontSize:{signal:"fontSize.text"}},style:{"guide-label":{fontSize:{signal:"fontSize.guideLabel"}},"guide-title":{fontSize:{signal:"fontSize.guideTitle"}},"group-title":{fontSize:{signal:"fontSize.groupTitle"}},"group-subtitle":{fontSize:{signal:"fontSize.groupSubtitle"}}}}}(r):{},i||{})}const QL=["view",...mN],ZL=["color","fontSize","background","padding","facet","concat","numberFormat","timeFormat","countTitle","header","axisQuantitative","axisTemporal","axisDiscrete","axisPoint","axisXBand","axisXPoint","axisXDiscrete","axisXQuantitative","axisXTemporal","axisYBand","axisYPoint","axisYDiscrete","axisYQuantitative","axisYTemporal","scale","selection","overlay"],ez=Object.assign({view:["continuousWidth","continuousHeight","discreteWidth","discreteHeight","step"]},{area:["line","point"],bar:["binSpacing","continuousBandSize","discreteBandSize"],rect:["binSpacing","continuousBandSize","discreteBandSize"],line:["point"],tick:["bandSize","thickness"]});function tz(e){e=$a(e);for(const t of ZL)delete e[t];if(e.axis)for(const t in e.axis)$3(e.axis[t])&&delete e.axis[t];if(e.legend)for(const t of $L)delete e.legend[t];if(e.mark){for(const t of gN)delete e.mark[t];e.mark.tooltip&&Uc(e.mark.tooltip)&&delete e.mark.tooltip}for(const t of QL){for(const r of gN)delete e[t][r];const n=ez[t];if(n)for(const r of n)delete e[t][r];nz(e,t)}for(const t of Kr(zI))delete e[t];(function(t){const{titleMarkConfig:n,subtitleMarkConfig:r,subtitle:i}=bI(t.title);ms(n)||(t.style["group-title"]=Object.assign(Object.assign({},t.style["group-title"]),n)),ms(r)||(t.style["group-subtitle"]=Object.assign(Object.assign({},t.style["group-subtitle"]),r)),ms(i)?delete t.title:t.title=i})(e);for(const t in e)Uc(e[t])&&ms(e[t])&&delete e[t];return ms(e)?void 0:e}function nz(e,t,n,r){const i=e[t];t==="view"&&(n="cell");const s=Object.assign(Object.assign({},i),e.style[n??t]);ms(s)||(e.style[n??t]=s),delete e[t]}function ck(e){return"layer"in e}class $I{map(t,n){return Qw(t)?this.mapFacet(t,n):function(r){return"repeat"in r}(t)?this.mapRepeat(t,n):PO(t)?this.mapHConcat(t,n):sk(t)?this.mapVConcat(t,n):BO(t)?this.mapConcat(t,n):this.mapLayerOrUnit(t,n)}mapLayerOrUnit(t,n){if(ck(t))return this.mapLayer(t,n);if(n0(t))return this.mapUnit(t,n);throw new Error(he.invalidSpec(t))}mapLayer(t,n){return Object.assign(Object.assign({},t),{layer:t.layer.map(r=>this.mapLayerOrUnit(r,n))})}mapHConcat(t,n){return Object.assign(Object.assign({},t),{hconcat:t.hconcat.map(r=>this.map(r,n))})}mapVConcat(t,n){return Object.assign(Object.assign({},t),{vconcat:t.vconcat.map(r=>this.map(r,n))})}mapConcat(t,n){const{concat:r}=t,i=Pi(t,["concat"]);return Object.assign(Object.assign({},i),{concat:r.map(s=>this.map(s,n))})}mapFacet(t,n){return Object.assign(Object.assign({},t),{spec:this.map(t.spec,n)})}mapRepeat(t,n){return Object.assign(Object.assign({},t),{spec:this.map(t.spec,n)})}}const rz={zero:1,center:1,normalize:1},iz=new Set([fN,Nw,Tw,Rw,Fw,K3,X3,Iw,hN,G3]),az=new Set([Nw,Tw,fN]);function GI(e,t){var n,r;const i=t==="x"?"y":"radius",s=e[t],f=e[i];if(si(s)&&si(f))if(Z0(s)==="quantitative"&&Z0(f)==="quantitative"){if(s.stack)return t;if(f.stack)return i;const m=si(s)&&!!s.aggregate;if(m!==(si(f)&&!!f.aggregate))return m?t:i;{const x=(n=s.scale)===null||n===void 0?void 0:n.type,O=(r=f.scale)===null||r===void 0?void 0:r.type;if(x&&x!=="linear")return i;if(O&&O!=="linear")return t}}else{if(Z0(s)==="quantitative")return t;if(Z0(f)==="quantitative")return i}else{if(Z0(s)==="quantitative")return t;if(Z0(f)==="quantitative")return i}}function KI(e,t,n={}){const r=hv(e)?e.type:e;if(!iz.has(r))return null;const i=GI(t,"x")||GI(t,"theta");if(!i)return null;const s=t[i],f=si(s)?ti(s,{}):void 0;let m=function(q){switch(q){case"x":return"y";case"y":return"x";case"theta":return"radius";case"radius":return"theta"}}(i),x=t[m],O=si(x)?ti(x,{}):void 0;O===f&&(O=void 0,x=void 0,m=void 0);const T=X7.reduce((q,Q)=>{if(Q!=="tooltip"&&Vy(t,Q)){const se=t[Q];for(const le of Mu(se)){const Fe=Ov(le);if(Fe.aggregate)continue;const Le=ti(Fe,{});Le&&Le===O||q.push({channel:Q,fieldDef:Fe})}}return q},[]);let M;if(s.stack!==void 0?M=K1(s.stack)?s.stack?"zero":null:s.stack:T.length>0&&az.has(r)&&(M="zero"),!M||!function(q){return q in rz}(M)||_O(t)&&T.length===0)return null;if(s.scale&&s.scale.type&&s.scale.type!==Zu.LINEAR){if(n.disallowNonLinearStack)return null;Gr(he.cannotStackNonLinearScale(s.scale.type))}return Ca(t[bv(i)])?(s.stack!==void 0&&Gr(he.cannotStackRangedMark(i)),null):(si(s)&&s.aggregate&&!Ji(V7,s.aggregate)&&Gr(he.stackNonSummativeAggregate(s.aggregate)),{groupbyChannel:x?m:void 0,groupbyField:O,fieldChannel:i,impute:s.impute!==null&&Iy(r),stackBy:T,offset:M})}function UO(e,t={},n){return e.point==="transparent"?{opacity:0}:e.point?Uc(e.point)?e.point:{}:e.point!==void 0?null:t.point||n.shape?Uc(t.point)?t.point:{}:void 0}function XI(e,t={}){return e.line?e.line===!0?{}:e.line:e.line!==void 0?null:t.line?t.line===!0?{}:t.line:void 0}class oz{constructor(){this.name="path-overlay"}hasMatchingType(t,n){if(n0(t)){const{mark:r,encoding:i}=t,s=hv(r)?r:{type:r};switch(s.type){case"line":case"rule":case"trail":return!!UO(s,n[s.type],i);case"area":return!!UO(s,n[s.type],i)||!!XI(s,n[s.type])}}return!1}run(t,n,r){const{config:i}=n,{selection:s,projection:f,encoding:m,mark:x}=t,O=Pi(t,["selection","projection","encoding","mark"]),T=hv(x)?x:{type:x},M=UO(T,i[T.type],m),q=T.type==="area"&&XI(T,i[T.type]),Q=[Object.assign(Object.assign({},s?{selection:s}:{}),{mark:function(Fe){const{point:Le,line:ze}=Fe,nt=Pi(Fe,["point","line"]);return Kr(nt).length>1?nt:nt.type}(Object.assign(Object.assign({},T.type==="area"&&T.opacity===void 0&&T.fillOpacity===void 0?{opacity:.7}:{}),T)),encoding:t0(m,["shape"])})],se=KI(T,m);let le=m;if(se){const{fieldChannel:Fe,offset:Le}=se;le=Object.assign(Object.assign({},m),{[Fe]:Object.assign(Object.assign({},m[Fe]),Le?{stack:Le}:{})})}return q&&Q.push(Object.assign(Object.assign({},f?{projection:f}:{}),{mark:Object.assign(Object.assign({type:"line"},J1(T,["clip","interpolate","tension","tooltip"])),q),encoding:le})),M&&Q.push(Object.assign(Object.assign({},f?{projection:f}:{}),{mark:Object.assign(Object.assign({type:"point",opacity:1,filled:!0},J1(T,["clip","tooltip"])),M),encoding:le})),r(Object.assign(Object.assign({},O),{layer:Q}),Object.assign(Object.assign({},n),{config:function(Fe){for(const Le of["line","area","rule","trail"])Fe[Le]&&(Fe=Object.assign(Object.assign({},Fe),{[Le]:t0(Fe[Le],["point","line"])}));return Fe}(i)}))}}class sz{constructor(){this.name="RangeStep"}hasMatchingType(t){var n;if(n0(t)&&t.encoding)for(const r of gm){const i=t.encoding[r];if(i&&Ca(i)&&(!((n=i?.scale)===null||n===void 0)&&n.rangeStep))return!0}return!1}run(t){var n;const r={};let i=Object.assign({},t.encoding);for(const s of gm){const f=xv(s),m=i[s];if(m&&Ca(m)&&(!((n=m?.scale)===null||n===void 0)&&n.rangeStep)){const{scale:x}=m,O=Pi(m,["scale"]),T=x,{rangeStep:M}=T,q=Pi(T,["rangeStep"]);r[f]={step:x.rangeStep},Gr(he.RANGE_STEP_DEPRECATED),i=Object.assign(Object.assign({},i),{[s]:Object.assign(Object.assign({},O),ms(q)?{}:{scale:q})})}}return Object.assign(Object.assign(Object.assign({},r),t),{encoding:i})}}function WO(e,t){return t?ZI(e,t):e}function VO(e,t,n){const r=t[e];return function(i){return i&&!Ha(i)&&"repeat"in i}(r)?r.repeat in n?Object.assign(Object.assign({},t),{[e]:n[r.repeat]}):void Gr(he.noSuchRepeatedValue(r.repeat)):t}function YI(e,t){if((e=VO("field",e,t))!==void 0){if(e===null)return null;if(uI(e)&&Ev(e.sort)){const n=VO("field",e.sort,t);e=Object.assign(Object.assign({},e),n?{sort:n}:{})}return e}}function JI(e,t){if(si(e))return YI(e,t);{const n=VO("datum",e,t);return n===e||n.type||(n.type="nominal"),n}}function QI(e,t){if(!Ca(e)){if(xO(e)){const n=JI(e.condition,t);if(n)return Object.assign(Object.assign({},e),{condition:n});{const{condition:r}=e;return Pi(e,["condition"])}}return e}{const n=JI(e,t);if(n)return n;if(bO(e))return{condition:e.condition}}}function ZI(e,t){const n={};for(const r in e)if(Ty(e,r)){const i=e[r];if(Gi(i))n[r]=i.map(s=>QI(s,t)).filter(s=>s);else{const s=QI(i,t);s!==void 0&&(n[r]=s)}}return n}class uz{constructor(){this.name="RuleForRangedLine"}hasMatchingType(t){if(n0(t)){const{encoding:n,mark:r}=t;if(r==="line")for(const i of K7){const s=n[jy(i)];if(n[i]&&(si(s)&&!bh(s.bin)||ey(s)))return!0}}return!1}run(t,n,r){const{encoding:i}=t;return Gr(he.lineWithRange(!!i.x2,!!i.y2)),r(Object.assign(Object.assign({},t),{mark:"rule"}),n)}}function eF(e){const{parentEncoding:t,encoding:n}=e;if(t&&n){const i=Kr(t).reduce((s,f)=>(n[f]&&s.push(f),s),[]);i.length>0&&Gr(he.encodingOverridden(i))}const r=Object.assign(Object.assign({},t??{}),n??{});return ms(r)?void 0:r}function tF(e){const{parentProjection:t,projection:n}=e;return t&&n&&Gr(he.projectionOverridden({parentProjection:t,projection:n})),n??t}function nF(e,t){t===void 0&&(t=HI(e.config));const n=function(f,m={}){return cz.map(f,{config:m})}(e,t),{width:r,height:i}=e,s=function(f,m,x){let{width:O,height:T}=m;const M=n0(f)||ck(f),q={};M?O=="container"&&T=="container"?(q.type="fit",q.contains="padding"):O=="container"?(q.type="fit-x",q.contains="padding"):T=="container"&&(q.type="fit-y",q.contains="padding"):(O=="container"&&(Gr(he.containerSizeNonSingle("width")),O=void 0),T=="container"&&(Gr(he.containerSizeNonSingle("height")),T=void 0));const Q=Object.assign(Object.assign(Object.assign({type:"pad"},q),x?rF(x.autosize):{}),rF(f.autosize));if(Q.type!=="fit"||M||(Gr(he.FIT_NON_SINGLE),Q.type="pad"),O=="container"&&Q.type!="fit"&&Q.type!="fit-x"&&Gr(he.containerSizeNotCompatibleWithAutosize("width")),T=="container"&&Q.type!="fit"&&Q.type!="fit-y"&&Gr(he.containerSizeNotCompatibleWithAutosize("height")),!Y1(Q,{type:"pad"}))return Q}(n,{width:r,height:i,autosize:e.autosize},t);return Object.assign(Object.assign({},n),s?{autosize:s}:{})}const cz=new class extends $I{constructor(){super(...arguments),this.nonFacetUnitNormalizers=[WL,VL,HL,new oz,new uz,new sz]}map(e,t){if(n0(e)){const n=Vy(e.encoding,r0),r=Vy(e.encoding,i0),i=Vy(e.encoding,jw);if(n||r||i)return this.mapFacetedUnit(e,t)}return super.map(e,t)}mapUnit(e,t){const{parentEncoding:n,parentProjection:r}=t,i=Object.assign(Object.assign({},e),{encoding:WO(e.encoding,t.repeater)});if(n||r)return this.mapUnitWithParentEncodingOrProjection(i,t);const s=this.mapLayerOrUnit.bind(this);for(const f of this.nonFacetUnitNormalizers)if(f.hasMatchingType(i,t.config))return f.run(i,t,s);return i}mapRepeat(e,t){return function(n){return!Gi(n.repeat)&&n.repeat.layer}(e)?this.mapLayerRepeat(e,t):this.mapNonLayerRepeat(e,t)}mapLayerRepeat(e,t){const{repeat:n,spec:r}=e,i=Pi(e,["repeat","spec"]),{row:s,column:f,layer:m}=n,{repeater:x={},repeaterPrefix:O=""}=t;return s||f?this.mapRepeat(Object.assign(Object.assign({},e),{repeat:Object.assign(Object.assign({},s?{row:s}:{}),f?{column:f}:{}),spec:{repeat:{layer:m},spec:r}}),t):Object.assign(Object.assign({},i),{layer:m.map(T=>{const M=Object.assign(Object.assign({},x),{layer:T}),q=(r.name||"")+O+`child__layer_${Qs(T)}`,Q=this.mapLayerOrUnit(r,Object.assign(Object.assign({},t),{repeater:M,repeaterPrefix:q}));return Q.name=q,Q})})}mapNonLayerRepeat(e,t){var n;const{repeat:r,spec:i,data:s}=e,f=Pi(e,["repeat","spec","data"]);!Gi(r)&&e.columns&&(e=t0(e,["columns"]),Gr(he.columnsNotSupportByRowCol("repeat")));const m=[],{repeater:x={},repeaterPrefix:O=""}=t,T=!Gi(r)&&r.row||[x?x.row:null],M=!Gi(r)&&r.column||[x?x.column:null],q=Gi(r)&&r||[x?x.repeat:null];for(const se of q)for(const le of T)for(const Fe of M){const Le={repeat:se,row:le,column:Fe,layer:x.layer},ze=(i.name||"")+O+"child__"+(Gi(r)?`${Qs(se)}`:(r.row?`row_${Qs(le)}`:"")+(r.column?`column_${Qs(Fe)}`:"")),nt=this.map(i,Object.assign(Object.assign({},t),{repeater:Le,repeaterPrefix:ze}));nt.name=ze,m.push(t0(nt,["data"]))}const Q=Gi(r)?e.columns:r.column?r.column.length:1;return Object.assign(Object.assign({data:(n=i.data)!==null&&n!==void 0?n:s,align:"all"},f),{columns:Q,concat:m})}mapFacet(e,t){const{facet:n}=e;return sx(n)&&e.columns&&(e=t0(e,["columns"]),Gr(he.columnsNotSupportByRowCol("facet"))),super.mapFacet(e,t)}mapUnitWithParentEncodingOrProjection(e,t){const{encoding:n,projection:r}=e,{parentEncoding:i,parentProjection:s,config:f}=t,m=tF({parentProjection:s,projection:r}),x=eF({parentEncoding:i,encoding:WO(n,t.repeater)});return this.mapUnit(Object.assign(Object.assign(Object.assign({},e),m?{projection:m}:{}),x?{encoding:x}:{}),{config:f})}mapFacetedUnit(e,t){const n=e.encoding,{row:r,column:i,facet:s}=n,f=Pi(n,["row","column","facet"]),{mark:m,width:x,projection:O,height:T,view:M,selection:q,encoding:Q}=e,se=Pi(e,["mark","width","projection","height","view","selection","encoding"]),{facetMapping:le,layout:Fe}=this.getFacetMappingAndLayout({row:r,column:i,facet:s},t),Le=WO(f,t.repeater);return this.mapFacet(Object.assign(Object.assign(Object.assign({},se),Fe),{facet:le,spec:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},x?{width:x}:{}),T?{height:T}:{}),M?{view:M}:{}),O?{projection:O}:{}),{mark:m,encoding:Le}),q?{selection:q}:{})}),t)}getFacetMappingAndLayout(e,t){var n;const{row:r,column:i,facet:s}=e;if(r||i){s&&Gr(he.facetChannelDropped([...r?[r0]:[],...i?[i0]:[]]));const f={},m={};for(const x of[r0,i0]){const O=e[x];if(O){const{align:T,center:M,spacing:q,columns:Q}=O,se=Pi(O,["align","center","spacing","columns"]);f[x]=se;for(const le of["align","center","spacing"])O[le]!==void 0&&(m[le]=(n=m[le])!==null&&n!==void 0?n:{},m[le][x]=O[le])}}return{facetMapping:f,layout:m}}{const{align:f,center:m,spacing:x,columns:O}=s;return{facetMapping:function(T,M){return M?sx(T)?ZI(T,M):YI(T,M):T}(Pi(s,["align","center","spacing","columns"]),t.repeater),layout:Object.assign(Object.assign(Object.assign(Object.assign({},f?{align:f}:{}),m?{center:m}:{}),x?{spacing:x}:{}),O?{columns:O}:{})}}}mapLayer(e,t){var{parentEncoding:n,parentProjection:r}=t,i=Pi(t,["parentEncoding","parentProjection"]);const{encoding:s,projection:f}=e,m=Pi(e,["encoding","projection"]),x=Object.assign(Object.assign({},i),{parentEncoding:eF({parentEncoding:n,encoding:s}),parentProjection:tF({parentProjection:r,projection:f})});return super.mapLayer(m,x)}};function rF(e){return Ha(e)?{type:e}:e??{}}const lz=["background","padding"];function iF(e){return lz.reduce((t,n)=>(e&&e[n]!==void 0&&(t[n]=e[n]),t),{})}class f0{constructor(t={},n={}){this.explicit=t,this.implicit=n}clone(){return new f0($a(this.explicit),$a(this.implicit))}combine(){return Object.assign(Object.assign({},this.explicit),this.implicit)}get(t){return Qu(this.explicit[t],this.implicit[t])}getWithExplicit(t){return this.explicit[t]!==void 0?{explicit:!0,value:this.explicit[t]}:this.implicit[t]!==void 0?{explicit:!1,value:this.implicit[t]}:{explicit:!1,value:void 0}}setWithExplicit(t,n){n.value!==void 0&&this.set(t,n.value,n.explicit)}set(t,n,r){return delete this[r?"implicit":"explicit"][t],this[r?"explicit":"implicit"][t]=n,this}copyKeyFromSplit(t,n){n.explicit[t]!==void 0?this.set(t,n.explicit[t],!0):n.implicit[t]!==void 0&&this.set(t,n.implicit[t],!1)}copyKeyFromObject(t,n){n[t]!==void 0&&this.set(t,n[t],!0)}copyAll(t){for(const n of Kr(t.combine())){const r=t.getWithExplicit(n);this.setWithExplicit(n,r)}}}function qy(e){return{explicit:!0,value:e}}function hg(e){return{explicit:!1,value:e}}function aF(e){return(t,n,r,i)=>{const s=e(t.value,n.value);return s>0?t:s<0?n:lk(t,n,r,i)}}function lk(e,t,n,r){return e.explicit&&t.explicit&&Gr(he.mergeConflictingProperty(n,r,e.value,t.value)),e}function ny(e,t,n,r,i=lk){return e===void 0||e.value===void 0?t:e.explicit&&!t.explicit?e:t.explicit&&!e.explicit?t:Y1(e.value,t.value)?e:i(e,t,n,r)}class fz extends f0{constructor(t={},n={},r=!1){super(t,n),this.explicit=t,this.implicit=n,this.parseNothing=r}clone(){const t=super.clone();return t.parseNothing=this.parseNothing,t}}function hx(e){return"url"in e}function fk(e){return"values"in e}function oF(e){return"name"in e&&!hx(e)&&!fk(e)&&!Hy(e)}function Hy(e){return e&&(sF(e)||uF(e)||qO(e))}function sF(e){return"sequence"in e}function uF(e){return"sphere"in e}function qO(e){return"graticule"in e}const ff="main",hk="raw";function cF(e){return"filter"in e}function hz(e){return"lookup"in e}function dz(e){return"pivot"in e}function pz(e){return"density"in e}function mz(e){return"quantile"in e}function gz(e){return"regression"in e}function vz(e){return"loess"in e}function yz(e){return"sample"in e}function bz(e){return"window"in e}function xz(e){return"joinaggregate"in e}function wz(e){return"flatten"in e}function kz(e){return"calculate"in e}function Ez(e){return"bin"in e}function Cz(e){return"impute"in e}function Oz(e){return"timeUnit"in e}function Az(e){return"aggregate"in e}function _z(e){return"stack"in e}function Sz(e){return"fold"in e}function Dz(e){return e.map(t=>cF(t)?{filter:function n(r,i){return V3(r)?{not:n(r.not,i)}:W3(r)?{and:r.and.map(s=>n(s,i))}:U3(r)?{or:r.or.map(s=>n(s,i))}:i(r)}(t.filter,AL)}:t)}function dx(e,t,n,r){const i=bO(t)&&t.condition,s=r(t);return i?{[n]:[...Mu(i).map(f=>{const m=r(f),x=function(O){return O.selection}(f)?GF(e,f.selection):Ck(e,f.test);return Object.assign({test:x},m)}),...s!==void 0?[s]:[]]}:s!==void 0?{[n]:s}:{}}function HO(e,t="text"){const n=e.encoding[t];return dx(e,n,t,r=>dk(r,e.config))}function dk(e,t,n="datum"){if(e){if(c0(e))return ju(e.value);if(Ca(e)){const{format:r,formatType:i}=ek(e);return mO({fieldOrDatumDef:e,format:r,formatType:i,expr:n,config:t})}}}function lF(e,t={}){const{encoding:n,markDef:r,config:i,stack:s}=e,f=n.tooltip;if(Gi(f))return{tooltip:hF({tooltip:f},s,i,t)};{const m=t.reactiveGeom?"datum.datum":"datum";return dx(e,f,"tooltip",x=>{const O=dk(x,i,m);if(O)return O;if(x===null)return;let T=$o("tooltip",r,i);return T===!0&&(T={content:"encoding"}),Ha(T)?{value:T}:Uc(T)?T.content==="encoding"?hF(n,s,i,t):{signal:m}:void 0})}}function fF(e,t,n,{reactiveGeom:r}={}){const i={},s=r?"datum.datum":"datum",f=[];function m(O,T){const M=jy(T),q=Sp(O)?O:Object.assign(Object.assign({},O),{type:e[M].type}),Q=Mu(zy(q,n,{allowDisabling:!1})).join(", ");let se;if(wv(T)){const le=T==="x"?"x2":"y2",Fe=Ov(e[le]);if(bh(q.bin)&&Fe){const Le=ti(q,{expr:s}),ze=ti(Fe,{expr:s}),{format:nt,formatType:it}=ek(q);se=Yw(Le,ze,nt,it,n),i[le]=!0}else if(t&&t.fieldChannel===T&&t.offset==="normalize"){const{format:Le,formatType:ze}=ek(q);se=mO({fieldOrDatumDef:q,format:Le,formatType:ze,expr:s,config:n,normalizeStack:!0}).signal}}se=se??dk(q,n,s).signal,f.push({channel:T,key:Q,value:se})}DO(e,(O,T)=>{si(O)?m(O,T):Zw(O)&&m(O.condition,T)});const x={};for(const{channel:O,key:T,value:M}of f)i[O]||x[T]||(x[go(T)]=M);return x}function hF(e,t,n,{reactiveGeom:r}={}){const i=iN(fF(e,t,n,{reactiveGeom:r})).map(({key:s,value:f})=>`${s}: ${f}`);return i.length>0?{signal:`{${i.join(", ")}}`}:void 0}function Tz(e){const{markDef:t,config:n}=e,r=$o("aria",t,n);return r===!1?{}:Object.assign(Object.assign(Object.assign({},r?{aria:r}:{}),function(i){const{mark:s,markDef:f,config:m}=i;if(m.aria===!1)return{};const x=$o("ariaRoleDescription",f,m);return x!=null?{ariaRoleDescription:{value:x}}:s in OL?{}:{ariaRoleDescription:{value:s}}}(e)),function(i){const{encoding:s,markDef:f,config:m,stack:x}=i,O=s.description;if(O)return dx(i,O,"description",q=>dk(q,i.config));const T=$o("description",f,m);if(T!=null)return{description:ju(T)};if(m.aria===!1)return{};const M=fF(s,x,m);if(!ms(M))return{description:{signal:iN(M).map(({key:q,value:Q})=>`${q} + ": " + (${Q})`).join(' + "; " + ')}}}(e))}function Wc(e,t,n={}){const{markDef:r,encoding:i,config:s}=t,{vgChannel:f}=n;let{defaultRef:m,defaultValue:x}=n;m===void 0&&(x=x??$o(e,r,s,{vgChannel:f,ignoreVgConfig:!0}))!==void 0&&(m=ju(x));const O=i[e];return dx(t,O,f??e,T=>YN({channel:e,channelDef:T,markDef:r,config:s,scaleName:t.scaleName(e),scale:t.getScaleComponent(e),stack:null,defaultRef:m}))}function dF(e,t={filled:void 0}){var n,r,i,s;const{markDef:f,encoding:m,config:x}=e,{type:O}=f,T=(n=t.filled)!==null&&n!==void 0?n:$o("filled",f,x),M=Ji(["bar","point","circle","square","geoshape"],O)?"transparent":void 0,q=(i=(r=$o(T===!0?"color":void 0,f,x,{vgChannel:"fill"}))!==null&&r!==void 0?r:x.mark[T===!0&&"color"])!==null&&i!==void 0?i:M,Q=(s=$o(T===!1?"color":void 0,f,x,{vgChannel:"stroke"}))!==null&&s!==void 0?s:x.mark[T===!1&&"color"],se=T?"fill":"stroke",le=Object.assign(Object.assign({},q?{fill:ju(q)}:{}),Q?{stroke:ju(Q)}:{});return f.color&&(T?f.fill:f.stroke)&&Gr(he.droppingColor("property",{fill:"fill"in f,stroke:"stroke"in f})),Object.assign(Object.assign(Object.assign(Object.assign({},le),Wc("color",e,{vgChannel:se,defaultValue:T?q:Q})),Wc("fill",e,{defaultValue:m.fill?q:void 0})),Wc("stroke",e,{defaultValue:m.stroke?Q:void 0}))}function pk(e,t){const n=t[function(r){switch(r){case ou:return"xOffset";case vc:return"yOffset";case ug:return"x2Offset";case dv:return"y2Offset";case cg:return"thetaOffset";case pv:return"radiusOffset";case o0:return"theta2Offset";case a0:return"radius2Offset"}}(e)];if(n)return n}function hf(e,t,{defaultPos:n,vgChannel:r,isMidPoint:i}){const{encoding:s,markDef:f,config:m,stack:x}=t,O=s[e],T=s[bv(e)],M=t.scaleName(e),q=t.getScaleComponent(e),Q=pk(e,f),se=$O({model:t,defaultPos:n,channel:e,scaleName:M,scale:q}),le=!O&&wv(e)&&(s.latitude||s.longitude)?{field:t.getName(e)}:function(Fe){const{channel:Le,channelDef:ze,isMidPoint:nt,scaleName:it,stack:ut,offset:st,markDef:pt,config:dt}=Fe;if(Ca(ze)&&ut&&Le===ut.fieldChannel){if(si(ze)){const Qt=ux({channel:Le,fieldDef:ze,isMidPoint:nt,markDef:pt,stack:ut,config:dt});if(Qt!==void 0)return Xw({scaleName:it,fieldOrDatumDef:ze,startSuffix:"start",band:Qt,offset:st})}return Py(ze,it,{suffix:"end"},{offset:st})}return dO(Fe)}({channel:e,channelDef:O,channel2Def:T,markDef:f,config:m,isMidPoint:i,scaleName:M,scale:q,stack:x,offset:Q,defaultRef:se});return le?{[r||e]:le}:void 0}function $O({model:e,defaultPos:t,channel:n,scaleName:r,scale:i}){const{markDef:s,config:f}=e;return()=>{const m=jy(n),x=K0(n),O=$o(n,s,f,{vgChannel:x});if(O!==void 0)return ox(n,O);switch(t){case"zeroOrMin":case"zeroOrMax":if(r){const T=i.get("type");if(!Ji([Zu.LOG,Zu.TIME,Zu.UTC],T)){if(i.domainDefinitelyIncludesZero())return{scale:r,value:0}}}if(t==="zeroOrMin")return m==="y"?{field:{group:"height"}}:{value:0};switch(m){case"radius":return{signal:`min(${e.width.signal},${e.height.signal})/2`};case"theta":return{signal:"2*PI"};case"x":return{field:{group:"width"}};case"y":return{value:0}}break;case"mid":{const T=e[xv(n)];return Object.assign(Object.assign({},T),{mult:.5})}}}}const Nz={left:"x",center:"xc",right:"x2"},Iz={top:"y",middle:"yc",bottom:"y2"};function pF(e,t,n,r="middle"){if(e==="radius"||e==="theta")return K0(e);const i=$o(e==="x"?"align":"baseline",t,n);return e==="x"?Nz[i||(r==="top"?"left":"center")]:Iz[i||r]}function mk(e,t,{defaultPos:n,defaultPos2:r,range:i}){return i?mF(e,t,{defaultPos:n,defaultPos2:r}):hf(e,t,{defaultPos:n})}function mF(e,t,{defaultPos:n,defaultPos2:r}){const{markDef:i,config:s}=t,f=bv(e),m=xv(e),x=function(T,M,q){const{encoding:Q,mark:se,markDef:le,stack:Fe,config:Le}=T,ze=jy(q),nt=xv(q),it=K0(q),ut=Q[ze],st=T.scaleName(ze),pt=T.getScaleComponent(ze),dt=pk(q in Q||q in le?q:ze,T.markDef);if(!ut&&(q==="x2"||q==="y2")&&(Q.latitude||Q.longitude))return{[it]:{field:T.getName(q)}};const Qt=function({channel:mn,channelDef:on,channel2Def:Rn,markDef:Fn,config:zn,scaleName:Vn,scale:Qn,stack:pr,offset:Pr,defaultRef:Ar}){return Ca(on)&&pr&&mn.charAt(0)===pr.fieldChannel.charAt(0)?Py(on,Vn,{suffix:"start"},{offset:Pr}):dO({channel:mn,channelDef:Rn,scaleName:Vn,scale:Qn,stack:pr,markDef:Fn,config:zn,offset:Pr,defaultRef:Ar})}({channel:q,channelDef:ut,channel2Def:Q[q],markDef:le,config:Le,scaleName:st,scale:pt,stack:Fe,offset:dt,defaultRef:void 0});return Qt!==void 0?{[it]:Qt}:gk(q,le)||gk(q,{[q]:ik(q,le,Le.style),[nt]:ik(nt,le,Le.style)})||gk(q,Le[se])||gk(q,Le.mark)||{[it]:$O({model:T,defaultPos:M,channel:q,scaleName:st,scale:pt})()}}(t,r,f),O=x[m]?pF(e,i,s):K0(e);return Object.assign(Object.assign({},hf(e,t,{defaultPos:n,vgChannel:O})),x)}function gk(e,t){const n=xv(e),r=K0(e);return t[r]!==void 0?{[r]:ox(e,t[r])}:t[e]!==void 0?{[r]:ox(e,t[e])}:t[n]?{[n]:ox(e,t[n])}:void 0}function ry(e,t,n){var r,i,s,f;const{config:m,encoding:x,markDef:O,stack:T}=e,M=bv(t),q=xv(t),Q=x[t],se=x[M],le=e.getScaleComponent(t),Fe=le?le.get("type"):void 0,Le=e.scaleName(t),ze=O.orient,nt=(i=(r=x[q])!==null&&r!==void 0?r:x.size)!==null&&i!==void 0?i:$o("size",O,m,{vgChannel:q}),it=n==="bar"&&(t==="x"?ze==="vertical":ze==="horizontal");if(si(Q)&&(Ns(Q.bin)||bh(Q.bin)||Q.timeUnit&&!se)&&!nt&&!Ad(Fe)){const ut=ux({channel:t,fieldDef:Q,stack:T,markDef:O,config:m}),st=(s=e.component.axes[t])===null||s===void 0?void 0:s[0];return function({fieldDef:pt,fieldDef2:dt,channel:Qt,band:mn,scaleName:on,markDef:Rn,spacing:Fn=0,axisTranslate:zn,reverse:Vn,config:Qn}){const pr=bv(Qt),Pr=K0(Qt),Ar=K0(pr),Jr=pk(Qt,Rn);if(Ns(pt.bin)||pt.timeUnit)return{[Ar]:gF({channel:Qt,fieldDef:pt,scaleName:on,markDef:Rn,band:(1-mn)/2,offset:px(pr,Fn,Vn,zn,Jr),config:Qn}),[Pr]:gF({channel:Qt,fieldDef:pt,scaleName:on,markDef:Rn,band:1-(1-mn)/2,offset:px(Qt,Fn,Vn,zn,Jr),config:Qn})};if(bh(pt.bin)){const gi=Py(pt,on,{},{offset:px(pr,Fn,Vn,zn,Jr)});if(si(dt))return{[Ar]:gi,[Pr]:Py(dt,on,{},{offset:px(Qt,Fn,Vn,zn,Jr)})};if(ix(pt.bin)&&pt.bin.step)return{[Ar]:gi,[Pr]:{signal:`scale("${on}", ${ti(pt,{expr:"datum"})} + ${pt.bin.step})`,offset:px(Qt,Fn,Vn,zn,Jr)}}}return void Gr(he.channelRequiredForBinned(pr))}({fieldDef:Q,fieldDef2:se,channel:t,markDef:O,scaleName:Le,band:ut,axisTranslate:(f=st?.get("translate"))!==null&&f!==void 0?f:.5,spacing:wv(t)?$o("binSpacing",O,m):void 0,reverse:le.get("reverse"),config:m})}return(Ca(Q)&&Ad(Fe)||it)&&!se?function(ut,st,pt,dt){var Qt;const{markDef:mn,encoding:on,config:Rn,stack:Fn}=dt,zn=mn.orient,Vn=dt.scaleName(pt),Qn=dt.getScaleComponent(pt),pr=xv(pt),Pr=bv(pt),Ar=zn==="horizontal"&&pt==="y"||zn==="vertical"&&pt==="x",Jr=$o(Ar?"size":pr,mn,Rn,{vgChannel:pr});let gi;(on.size||Jr!==void 0)&&(Ar?gi=Wc("size",dt,{vgChannel:pr,defaultValue:Jr}):Gr(he.cannotApplySizeToNonOrientedMark(mn.type)));const vi=(Qt=Ca(st)?ux({channel:pt,fieldDef:st,markDef:mn,stack:Fn,config:Rn}):void 0)!==null&&Qt!==void 0?Qt:1;gi=gi||{[pr]:function(xa,no,zi,vo,Lo,co){if(vo){const gs=vo.get("type");if(gs==="point"||gs==="band"){if(Lo[xa].discreteBandSize!==void 0)return{value:Lo[xa].discreteBandSize};if(gs===Zu.POINT){const kl=vo.get("range");return J0(kl)&&Ju(kl.step)?{value:kl.step-2}:{value:zO-2}}return{scale:zi,band:co}}return{value:Lo[xa].continuousBandSize}}const Is=uk(Lo.view,no),Fs=Qu(Lo[xa].discreteBandSize,Is-2);return Fs!==void 0?{value:Fs}:void 0}(ut,pr,Vn,Qn,Rn,vi)};const Li=Qn?.get("type")!=="band"||!("band"in gi[pr]),wi=pF(pt,mn,Rn,Li?"middle":"top"),yi=pk(pt,mn),Si=dO({channel:pt,channelDef:st,markDef:mn,config:Rn,scaleName:Vn,scale:Qn,stack:Fn,offset:yi,defaultRef:$O({model:dt,defaultPos:"mid",channel:pt,scaleName:Vn,scale:Qn}),band:Li?.5:(1-vi)/2});if(pr)return Object.assign({[wi]:Si},gi);{const xa=K0(Pr),no=gi[pr],zi=yi?Object.assign(Object.assign({},no),{offset:yi}):no;return{[wi]:Si,[xa]:Gi(Si)?[Si[0],Object.assign(Object.assign({},Si[1]),{offset:zi})]:Object.assign(Object.assign({},Si),{offset:zi})}}}(n,Q,t,e):mF(t,e,{defaultPos:"zeroOrMax",defaultPos2:"zeroOrMin"})}function px(e,t,n,r,i){if(bN(e))return 0;const s=e==="x"||e==="y2"?-t/2:t/2;if(da(n)){const f=lx(i);return{signal:`${n.signal} ? ${r-s}${f?"-"+f:""} : ${r+s}${f?"+"+f:""}`}}if(da(i)){const f=r+(n?-s:s);return{signal:`${f||""}${n?" - ":f?" + ":""}${i.signal}`}}return i=i||0,r+(n?-i-s:+i+s)}function gF({channel:e,fieldDef:t,scaleName:n,markDef:r,band:i,offset:s,config:f}){return XN({fieldDef:t,channel:e,markDef:r,ref:Xw({scaleName:n,fieldOrDatumDef:t,band:i,offset:s}),config:f})}const Fz=new Set(["aria"]);function ym(e,t){const{fill:n,stroke:r}=t.color==="include"?dF(e):{};return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},function(i,s){return CL.reduce((f,m)=>(Fz.has(m)||i[m]===void 0||s[m]==="ignore"||(f[m]=ju(i[m])),f),{})}(e.markDef,t)),vF(e,"fill",n)),vF(e,"stroke",r)),Wc("opacity",e)),Wc("fillOpacity",e)),Wc("strokeOpacity",e)),Wc("strokeWidth",e)),Wc("strokeDash",e)),lF(e)),HO(e,"href")),Tz(e))}function vF(e,t,n){const{config:r,mark:i,markDef:s}=e;if($o("invalid",s,r)==="hide"&&n&&!Iy(i)){const f=function(m,{invalid:x=!1,channels:O}){const T=O.reduce((q,Q)=>{const se=m.getScaleComponent(Q);if(se){const le=se.get("type"),Fe=m.vgField(Q,{expr:"datum"});Fe&&vm(le)&&(q[Fe]=!0)}return q},{}),M=Kr(T);if(M.length>0){const q=x?"||":"&&";return M.map(Q=>pO(Q,x)).join(` ${q} `)}}(e,{invalid:!0,channels:qw});if(f)return{[t]:[{test:f,value:null},...Mu(n)]}}return n?{[t]:n}:{}}function GO(e){const{config:t,markDef:n}=e;if($o("invalid",n,t)){const r=function(i,{invalid:s=!1,channels:f}){const m=f.reduce((O,T)=>{const M=i.getScaleComponent(T);if(M){const q=M.get("type"),Q=i.vgField(T,{expr:"datum"});Q&&vm(q)&&(O[Q]=!0)}return O},{}),x=Kr(m);if(x.length>0){const O=s?"||":"&&";return x.map(T=>pO(T,s)).join(` ${O} `)}}(e,{channels:gm});if(r)return{defined:{signal:r}}}return{}}function yF(e,t){if(t!==void 0)return{[e]:ju(t)}}var bF={has:e=>e.type!=="interval"&&e.nearest,parse:(e,t)=>{if(t.events)for(const n of t.events)n.markname=e.getName("voronoi")},marks:(e,t,n)=>{const{x:r,y:i}=t.project.hasChannel,s=e.mark;if(Iy(s))return Gr(he.nearestNotSupportForContinuous(s)),n;const f={name:e.getName("voronoi"),type:"path",interactive:!0,from:{data:e.getName("marks")},encode:{update:Object.assign({fill:{value:"transparent"},strokeWidth:{value:.35},stroke:{value:"transparent"},isVoronoi:{value:!0}},lF(e,{reactiveGeom:!0}))},transform:[{type:"voronoi",x:{expr:r||!i?"datum.datum.x || 0":"0"},y:{expr:i||!r?"datum.datum.y || 0":"0"},size:[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]}]};let m=0,x=!1;return n.forEach((O,T)=>{var M;const q=(M=O.name)!==null&&M!==void 0?M:"";q===e.component.mark[0].name?m=T:q.indexOf("voronoi")>=0&&(x=!0)}),x||n.splice(m+1,0,f),n}};class as{constructor(t,n){this.debugName=n,this._children=[],this._parent=null,t&&(this.parent=t)}clone(){throw new Error("Cannot clone node")}get parent(){return this._parent}set parent(t){this._parent=t,t&&t.addChild(this)}get children(){return this._children}numChildren(){return this._children.length}addChild(t,n){this._children.indexOf(t)>-1?console.warn("Attempt to add the same child twice."):n!==void 0?this._children.splice(n,0,t):this._children.push(t)}removeChild(t){const n=this._children.indexOf(t);return this._children.splice(n,1),n}remove(){let t=this._parent.removeChild(this);for(const n of this._children)n._parent=this._parent,this._parent.addChild(n,t++)}insertAsParentOf(t){const n=t.parent;n.removeChild(this),this.parent=n,t.parent=this}swapWithParent(){const t=this._parent,n=t.parent;for(const r of this._children)r.parent=t;this._children=[],t.removeChild(this),t.parent.removeChild(t),this.parent=n,t.parent=this}}class wh extends as{constructor(t,n,r,i){super(t,n),this.type=r,this.refCounts=i,this._source=this._name=n,!this.refCounts||this._name in this.refCounts||(this.refCounts[this._name]=0)}clone(){const t=new this.constructor;return t.debugName="clone_"+this.debugName,t._source=this._source,t._name="clone_"+this._name,t.type=this.type,t.refCounts=this.refCounts,t.refCounts[t._name]=0,t}dependentFields(){return new Set}producedFields(){return new Set}hash(){return this._hash===void 0&&(this._hash=`Output ${T7()}`),this._hash}getSource(){return this.refCounts[this._name]++,this._source}isRequired(){return!!this.refCounts[this._name]}setSource(t){this._source=t}}class _v extends as{constructor(t,n){super(t),this.formula=n}clone(){return new _v(null,$a(this.formula))}static makeFromEncoding(t,n){const r=n.reduceFieldDef((i,s,f)=>{const{field:m,timeUnit:x}=s,O=yu(n)?n.encoding[bv(f)]:void 0,T=yu(n)&&yO(f,s,O,n.stack,n.markDef,n.config);if(x){const M=ti(s,{forAs:!0});i[ko({as:M,field:m,timeUnit:x})]=Object.assign({as:M,field:m,timeUnit:x},T?{band:!0}:{})}return i},{});return ms(r)?null:new _v(t,r)}static makeFromTransform(t,n){const r=Object.assign({},n),{timeUnit:i}=r,s=Pi(r,["timeUnit"]),f=xh(i),m=Object.assign(Object.assign({},s),{timeUnit:f});return new _v(t,{[ko(m)]:m})}merge(t){this.formula=Object.assign({},this.formula);for(const n in t.formula)this.formula[n]&&!t.formula[n].band||(this.formula[n]=t.formula[n]);for(const n of t.children)t.removeChild(n),n.parent=this;t.remove()}producedFields(){return new Set(U0(this.formula).map(t=>t.as))}dependentFields(){return new Set(U0(this.formula).map(t=>t.field))}hash(){return`TimeUnit ${ko(this.formula)}`}assemble(){const t=[];for(const n of U0(this.formula)){const{field:r,as:i,timeUnit:s}=n,f=xh(s),{unit:m,utc:x}=f,O=Pi(f,["unit","utc"]);t.push(Object.assign(Object.assign(Object.assign(Object.assign({field:W0(r),type:"timeunit"},m?{units:iO(m)}:{}),x?{timezone:"utc"}:{}),O),{as:[i,`${i}_end`]}))}return t}}const mx="_tuple_fields";var xF={has:e=>e.type==="single"&&e.resolve==="global"&&e.bind&&e.bind!=="scales"&&!MO(e.bind),parse:(e,t,n,r)=>{r.on||delete t.events,r.clear||delete t.clear},topLevelSignals:(e,t,n)=>{const r=t.name,i=t.project,s=t.bind,f=t.init&&t.init[0],m=bF.has(t)?"(item().isVoronoi ? datum.datum : datum)":"datum";return i.items.forEach((x,O)=>{var T,M;const q=Qs(`${r}_${x.field}`);n.filter(Q=>Q.name===q).length||n.unshift(Object.assign(Object.assign({name:q},f?{init:Ib(f[O])}:{value:null}),{on:t.events?[{events:t.events,update:`datum && item().mark.marktype !== 'group' ? ${m}[${go(x.field)}] : null`}]:[],bind:(M=(T=s[x.field])!==null&&T!==void 0?T:s[x.channel])!==null&&M!==void 0?M:s}))}),n},signals:(e,t,n)=>{const r=t.name,i=t.project,s=n.filter(O=>O.name===r+Sv)[0],f=r+mx,m=i.items.map(O=>Qs(`${r}_${O.field}`)),x=m.map(O=>`${O} !== null`).join(" && ");return m.length&&(s.update=`${x} ? {fields: ${f}, values: [${m.join(", ")}]} : null`),delete s.value,delete s.on,n}},wF={has:e=>e.type==="multi"&&!!e.toggle,signals:(e,t,n)=>n.concat({name:t.name+"_toggle",value:!1,on:[{events:t.events,update:t.toggle}]}),modifyExpr:(e,t)=>{const n=t.name+Sv,r=t.name+"_toggle";return`${r} ? null : ${n}, `+(t.resolve==="global"?`${r} ? null : true, `:`${r} ? null : {unit: ${h0(e)}}, `)+`${r} ? ${n} : null`}},iy={has:e=>e.type==="interval"&&e.resolve==="global"&&e.bind&&e.bind==="scales",parse:(e,t)=>{const n=t.scales=[];for(const r of t.project.items){const i=r.channel;if(!Y0(i))continue;const s=e.getScaleComponent(i),f=s?s.get("type"):void 0;if(!s||!vm(f)){Gr(he.SCALE_BINDINGS_CONTINUOUS);continue}const m={selection:t.name,field:r.field};s.set("selectionExtent",m,!0),n.push(r)}},topLevelSignals:(e,t,n)=>{const r=t.scales.filter(f=>n.filter(m=>m.name===f.signals.data).length===0);if(!e.parent||XO(e)||r.length===0)return n;const i=n.filter(f=>f.name===t.name)[0];let s=i.update;if(s.indexOf(IF)>=0)i.update=`{${r.map(f=>`${go(f.field)}: ${f.signals.data}`).join(", ")}}`;else{for(const f of r){const m=`${go(f.field)}: ${f.signals.data}`;s.indexOf(m)<0&&(s=`${s.substring(0,s.length-1)}, ${m}}`)}i.update=s}return n.concat(r.map(f=>({name:f.signals.data})))},signals:(e,t,n)=>{if(e.parent&&!XO(e))for(const r of t.scales){const i=n.filter(s=>s.name===r.signals.data)[0];i.push="outer",delete i.value,delete i.update}return n}};function KO(e,t){return`domain(${go(e.scaleName(t))})`}function XO(e){var t;return e.parent&&Ub(e.parent)&&((t=!e.parent.parent)!==null&&t!==void 0?t:XO(e.parent.parent))}const kF={has:e=>{const t=e.resolve==="global"&&e.bind&&MO(e.bind),n=e.project.items.length===1&&e.project.items[0].field!==Nb;return t&&!n&&Gr(he.LEGEND_BINDINGS_PROJECT_LENGTH),t&&n},parse:(e,t,n,r)=>{var i;if(r.on||delete t.events,r.clear||delete t.clear,r.on||r.clear){const m='event.item && indexof(event.item.mark.role, "legend") < 0';for(const x of t.events)x.filter=Mu((i=x.filter)!==null&&i!==void 0?i:[]),x.filter.indexOf(m)<0&&x.filter.push(m)}const s=jO(t.bind)?t.bind.legend:"click",f=Ha(s)?Sy(s,"view"):Mu(s);t.bind={legend:{merge:f}}},topLevelSignals:(e,t,n)=>{const r=t.name,i=jO(t.bind)&&t.bind.legend,s=f=>m=>{const x=$a(m);return x.markname=f,x};for(const f of t.project.items){if(!f.hasLegend)continue;const m=`${Qs(f.field)}_legend`,x=`${r}_${m}`;if(n.filter(O=>O.name===x).length===0){const O=i.merge.map(s(`${m}_symbols`)).concat(i.merge.map(s(`${m}_labels`))).concat(i.merge.map(s(`${m}_entries`)));n.unshift(Object.assign(Object.assign({name:x},t.init?{}:{value:null}),{on:[{events:O,update:"datum.value || item().items[0].items[0].datum.value",force:!0},{events:i.merge,update:`!event.item || !datum ? null : ${x}`,force:!0}]}))}}return n},signals:(e,t,n)=>{const r=t.name,i=t.project,s=n.find(M=>M.name===r+Sv),f=r+mx,m=i.items.filter(M=>M.hasLegend).map(M=>Qs(`${r}_${Qs(M.field)}_legend`)),x=`${m.map(M=>`${M} !== null`).join(" && ")} ? {fields: ${f}, values: [${m.join(", ")}]} : null`;t.events&&m.length>0?s.on.push({events:m.map(M=>({signal:M})),update:x}):m.length>0&&(s.update=x,delete s.value,delete s.on);const O=n.find(M=>M.name===r+"_toggle"),T=jO(t.bind)&&t.bind.legend;return O&&(t.events?O.on.push(Object.assign(Object.assign({},O.on[0]),{events:T})):O.on[0].events=T),n}},EF="_translate_anchor",CF="_translate_delta";function OF(e,t,n,r,i){var s;const f=t.name,m=f+EF,x=f+CF,O=n.channel,T=iy.has(t),M=i.filter(Le=>Le.name===n.signals[T?"data":"visual"])[0],q=e.getSizeSignalRef(r).signal,Q=e.getScaleComponent(O),se=Q.get("type"),le=`${m}.extent_${O}`,Fe=`${T?se==="log"?"panLog":se==="pow"?"panPow":"panLinear":"panLinear"}(${le}, ${`${T&&O===ou?"-":""}${x}.${O} / `+(T?`${q}`:`span(${le})`)}`+(T&&se==="pow"?`, ${(s=Q.get("exponent"))!==null&&s!==void 0?s:1}`:"")+")";M.on.push({events:{signal:x},update:T?Fe:`clampRange(${Fe}, 0, ${q})`})}const AF="_zoom_anchor",_F="_zoom_delta";function SF(e,t,n,r,i){var s;const f=t.name,m=n.channel,x=iy.has(t),O=i.filter(Fe=>Fe.name===n.signals[x?"data":"visual"])[0],T=e.getSizeSignalRef(r).signal,M=e.getScaleComponent(m),q=M.get("type"),Q=x?KO(e,m):O.name,se=f+_F,le=`${x?q==="log"?"zoomLog":q==="pow"?"zoomPow":"zoomLinear":"zoomLinear"}(${Q}, ${`${f}${AF}.${m}`}, ${se}`+(x&&q==="pow"?`, ${(s=M.get("exponent"))!==null&&s!==void 0?s:1}`:"")+")";O.on.push({events:{signal:se},update:x?le:`clampRange(${le}, 0, ${T})`})}const Rz=[{has:()=>!0,parse:(e,t,n)=>{var r,i,s;const f=t.name,m=(r=t.project)!==null&&r!==void 0?r:t.project=new class{constructor(...q){this.items=q,this.hasChannel={},this.hasField={}}},x={},O={},T=new Set,M=(q,Q)=>{const se=Q==="visual"?q.channel:q.field;let le=Qs(`${f}_${se}`);for(let Fe=1;T.has(le);Fe++)le=Qs(`${f}_${se}_${Fe}`);return T.add(le),{[Q]:le}};if(!n.fields&&!n.encodings){const q=e.config.selection[n.type];if(n.init)for(const Q of Mu(n.init))for(const se of Kr(Q))G7(se)?(n.encodings||(n.encodings=[])).push(se):n.type==="interval"?(Gr('Interval selections should be initialized using "x" and/or "y" keys.'),n.encodings=q.encodings):(n.fields||(n.fields=[])).push(se);else n.encodings=q.encodings,n.fields=q.fields}for(const q of(i=n.fields)!==null&&i!==void 0?i:[]){const Q={type:"E",field:q};Q.signals=Object.assign({},M(Q,"data")),m.items.push(Q),m.hasField[q]=Q}for(const q of(s=n.encodings)!==null&&s!==void 0?s:[]){const Q=e.fieldDef(q);if(Q){let se=Q.field;if(Q.aggregate){Gr(he.cannotProjectAggregate(q,Q.aggregate));continue}if(!se){Gr(he.cannotProjectOnChannelWithoutField(q));continue}if(Q.timeUnit){se=e.vgField(q);const le={timeUnit:Q.timeUnit,as:se,field:Q.field};O[ko(le)]=le}if(!x[se]){let le="E";t.type==="interval"?vm(e.getScaleComponent(q).get("type"))&&(le="R"):Q.bin&&(le="R-RE");const Fe={field:se,channel:q,type:le};Fe.signals=Object.assign(Object.assign({},M(Fe,"data")),M(Fe,"visual")),m.items.push(x[se]=Fe),m.hasField[se]=m.hasChannel[q]=x[se]}}else Gr(he.cannotProjectOnChannelWithoutField(q))}if(n.init){const q=Q=>m.items.map(se=>Q[se.channel]!==void 0?Q[se.channel]:Q[se.field]);if(n.type==="interval")t.init=q(n.init);else{const Q=Mu(n.init);t.init=Q.map(q)}}ms(O)||(m.timeUnit=new _v(null,O))},signals:(e,t,n)=>{const r=t.name+mx;return n.filter(i=>i.name===r).length>0?n:n.concat({name:r,value:t.project.items.map(i=>{const{signals:s,hasLegend:f}=i,m=Pi(i,["signals","hasLegend"]);return m.field=W0(m.field),m})})}},wF,iy,kF,{has:e=>e.type==="interval"&&e.translate,signals:(e,t,n)=>{const r=t.name,i=iy.has(t),s=r+EF,{x:f,y:m}=t.project.hasChannel;let x=Sy(t.translate,"scope");return i||(x=x.map(O=>(O.between[0].markname=r+gx,O))),n.push({name:s,value:{},on:[{events:x.map(O=>O.between[0]),update:"{x: x(unit), y: y(unit)"+(f!==void 0?", extent_x: "+(i?KO(e,ou):`slice(${f.signals.visual})`):"")+(m!==void 0?", extent_y: "+(i?KO(e,vc):`slice(${m.signals.visual})`):"")+"}"}]},{name:r+CF,value:{},on:[{events:x,update:`{x: ${s}.x - x(unit), y: ${s}.y - y(unit)}`}]}),f!==void 0&&OF(e,t,f,"width",n),m!==void 0&&OF(e,t,m,"height",n),n}},{has:e=>e.type==="interval"&&e.zoom,signals:(e,t,n)=>{const r=t.name,i=iy.has(t),s=r+_F,{x:f,y:m}=t.project.hasChannel,x=go(e.scaleName(ou)),O=go(e.scaleName(vc));let T=Sy(t.zoom,"scope");return i||(T=T.map(M=>(M.markname=r+gx,M))),n.push({name:r+AF,on:[{events:T,update:i?"{"+[x?`x: invert(${x}, x(unit))`:"",O?`y: invert(${O}, y(unit))`:""].filter(M=>!!M).join(", ")+"}":"{x: x(unit), y: y(unit)}"}]},{name:s,on:[{events:T,force:!0,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"}]}),f!==void 0&&SF(e,t,f,"width",n),m!==void 0&&SF(e,t,m,"height",n),n}},xF,bF,{has:e=>e.clear!==void 0&&e.clear!==!1,parse:(e,t,n)=>{n.clear&&(t.clear=Ha(n.clear)?Sy(n.clear,"scope"):n.clear)},topLevelSignals:(e,t,n)=>{if(xF.has(t))for(const r of t.project.items){const i=n.findIndex(s=>s.name===Qs(`${t.name}_${r.field}`));i!==-1&&n[i].on.push({events:t.clear,update:"null"})}return n},signals:(e,t,n)=>{function r(i,s){i!==-1&&n[i].on&&n[i].on.push({events:t.clear,update:s})}if(t.type==="interval")for(const i of t.project.items){const s=n.findIndex(f=>f.name===i.signals.visual);r(s,"[0, 0]"),s===-1&&r(n.findIndex(f=>f.name===i.signals.data),"null")}else{let i=n.findIndex(s=>s.name===t.name+Sv);r(i,"null"),wF.has(t)&&r(i=n.findIndex(s=>s.name===t.name+"_toggle"),"false")}return n}}];function vk(e,t){for(const n of Rz)n.has(e)&&t(n)}function Ib(e,t=!0,n=y7){if(Gi(e)){const r=e.map(i=>Ib(i,t,n));return t?`[${r.join(", ")}]`:r}return _b(e)?n(t?ax(e):function(r){const i=tO(r,!0);return r.utc?+new Date(Date.UTC(...i)):+new Date(...i)}(e)):t?n(JSON.stringify(e)):e}function DF(e,t){return Gy(e,(n,r)=>{t=r.marks?r.marks(e,n,t):t,vk(n,i=>{i.marks&&(t=i.marks(e,n,t))})}),t}function YO(e){return e.map(t=>(t.on&&!t.on.length&&delete t.on,t))}const gx="_brush",JO="_scale_trigger",Mz={signals:(e,t)=>{const n=t.name,r=n+mx,i=iy.has(t),s=[],f=[],m=[];if(t.translate&&!i){const T=`!event.item || event.item.mark.name !== ${go(n+gx)}`;TF(t,(M,q)=>{var Q;const se=Mu((Q=q.between[0].filter)!==null&&Q!==void 0?Q:q.between[0].filter=[]);return se.indexOf(T)<0&&se.push(T),M})}t.project.items.forEach((T,M)=>{const q=T.channel;if(q!==ou&&q!==vc)return void Gr("Interval selections only support x and y encoding channels.");const Q=t.init?t.init[M]:null,se=function(nt,it,ut,st){const pt=ut.channel,dt=ut.signals.visual,Qt=ut.signals.data,mn=iy.has(it),on=go(nt.scaleName(pt)),Rn=nt.getScaleComponent(pt),Fn=Rn?Rn.get("type"):void 0,zn=Pr=>`scale(${on}, ${Pr})`,Vn=nt.getSizeSignalRef(pt===ou?"width":"height").signal,Qn=`${pt}(unit)`,pr=TF(it,(Pr,Ar)=>[...Pr,{events:Ar.between[0],update:`[${Qn}, ${Qn}]`},{events:Ar,update:`[${dt}[0], clamp(${Qn}, 0, ${Vn})]`}]);return pr.push({events:{signal:it.name+JO},update:vm(Fn)?`[${zn(`${Qt}[0]`)}, ${zn(`${Qt}[1]`)}]`:"[0, 0]"}),mn?[{name:Qt,on:[]}]:[Object.assign(Object.assign({name:dt},st?{init:Ib(st,!0,zn)}:{value:[]}),{on:pr}),Object.assign(Object.assign({name:Qt},st?{init:Ib(st)}:{}),{on:[{events:{signal:dt},update:`${dt}[0] === ${dt}[1] ? null : invert(${on}, ${dt})`}]})]}(e,t,T,Q),le=T.signals.data,Fe=T.signals.visual,Le=go(e.scaleName(q)),ze=vm(e.getScaleComponent(q).get("type"))?"+":"";s.push(...se),f.push(le),m.push({scaleName:e.scaleName(q),expr:`(!isArray(${le}) || (${ze}invert(${Le}, ${Fe})[0] === ${ze}${le}[0] && ${ze}invert(${Le}, ${Fe})[1] === ${ze}${le}[1]))`})}),i||s.push({name:n+JO,value:{},on:[{events:m.map(T=>({scale:T.scaleName})),update:m.map(T=>T.expr).join(" && ")+` ? ${n+JO} : {}`}]});const x=t.init,O=`unit: ${h0(e)}, fields: ${r}, values`;return s.concat(Object.assign(Object.assign({name:n+Sv},x?{init:`{${O}: ${Ib(x)}}`}:{}),{on:[{events:[{signal:f.join(" || ")}],update:f.join(" && ")+` ? {${O}: [${f}]} : null`}]}))},modifyExpr:(e,t)=>t.name+Sv+", "+(t.resolve==="global"?"true":`{unit: ${h0(e)}}`),marks:(e,t,n)=>{const r=t.name,{x:i,y:s}=t.project.hasChannel,f=i&&i.signals.visual,m=s&&s.signals.visual,x=`data(${go(t.name+$y)})`;if(iy.has(t))return n;const O={x:i!==void 0?{signal:`${f}[0]`}:{value:0},y:s!==void 0?{signal:`${m}[0]`}:{value:0},x2:i!==void 0?{signal:`${f}[1]`}:{field:{group:"width"}},y2:s!==void 0?{signal:`${m}[1]`}:{field:{group:"height"}}};if(t.resolve==="global")for(const Fe of Kr(O))O[Fe]=[Object.assign({test:`${x}.length && ${x}[0].unit === ${h0(e)}`},O[Fe]),{value:0}];const T=t.mark,{fill:M,fillOpacity:q,cursor:Q}=T,se=Pi(T,["fill","fillOpacity","cursor"]),le=Kr(se).reduce((Fe,Le)=>(Fe[Le]=[{test:[i!==void 0&&`${f}[0] !== ${f}[1]`,s!==void 0&&`${m}[0] !== ${m}[1]`].filter(ze=>ze).join(" && "),value:se[Le]},{value:null}],Fe),{});return[{name:r+gx+"_bg",type:"rect",clip:!0,encode:{enter:{fill:{value:M},fillOpacity:{value:q}},update:O}},...n,{name:r+gx,type:"rect",clip:!0,encode:{enter:Object.assign(Object.assign({},Q?{cursor:{value:Q}}:{}),{fill:{value:"transparent"}}),update:Object.assign(Object.assign({},O),le)}}]}};function TF(e,t){return e.events.reduce((n,r)=>r.between?t(n,r):(Gr(`${r} is not an ordered event stream for interval selections.`),n),[])}function NF(e,t){const n=t.name,r=n+mx,i="(item().isVoronoi ? datum.datum : datum)",s=t.project.items.map(x=>{const O=e.fieldDef(x.channel);return O&&O.bin?`[${i}[${go(e.vgField(x.channel,{}))}], ${i}[${go(e.vgField(x.channel,{binSuffix:"end"}))}]]`:`${i}[${go(x.field)}]`}).join(", "),f=`unit: ${h0(e)}, fields: ${r}, values`,m=t.events;return[{name:n+Sv,on:m?[{events:m,update:`datum && item().mark.marktype !== 'group' ? {${f}: [${s}]} : null`,force:!0}]:[]}]}const jz={signals:NF,modifyExpr:(e,t)=>t.name+Sv+", "+(t.resolve==="global"?"null":`{unit: ${h0(e)}}`)},Bz={signals:NF,modifyExpr:(e,t)=>t.name+Sv+", "+(t.resolve==="global"?"true":`{unit: ${h0(e)}}`)},$y="_store",Sv="_tuple",Pz="_modify",IF="vlSelectionResolve",Lz={single:Bz,multi:jz,interval:Mz};function Gy(e,t){const n=e.component.selection;if(n){for(const r of U0(n))if(t(r,Lz[r.type])===!0)break}}function h0(e,{escape:t}={escape:!0}){let n=t?go(e.name):e.name;const r=function(i){let s=i.parent;for(;s&&!gg(s);)s=s.parent;return s}(e);if(r){const{facet:i}=r;for(const s of mm)i[s]&&(n+=` + '__facet_${s}_' + (facet[${go(r.vgField(s))}])`)}return n}function QO(e){let t=!1;return Gy(e,n=>{t=t||n.project.items.some(r=>r.field===Nb)}),t}const zz="RawCode",Uz="Literal",Wz="Property",Vz="Identifier",qz="ArrayExpression",Hz="BinaryExpression",$z="CallExpression",Gz="ConditionalExpression",Kz="LogicalExpression",Xz="MemberExpression",Yz="ObjectExpression",Jz="UnaryExpression";function dg(e){this.type=e}var d0,_i,Tr,df,Zo;dg.prototype.visit=function(e){let t,n,r;if(e(this))return 1;for(n=0,r=(t=function(i){switch(i.type){case qz:return i.elements;case Hz:case Kz:return[i.left,i.right];case $z:return[i.callee].concat(i.arguments);case Gz:return[i.test,i.consequent,i.alternate];case Xz:return[i.object,i.property];case Yz:return i.properties;case Wz:return[i.key,i.value];case Jz:return[i.argument];case Vz:case Uz:case zz:default:return[]}}(this)).length;n<r;++n)if(t[n].visit(e))return 1};var yk=1,vx=2,Ky=3,ay=4,bk=5,Xy=6,_d=7,yx=8;(d0={})[yk]="Boolean",d0[vx]="<end>",d0[Ky]="Identifier",d0[ay]="Keyword",d0[bk]="Null",d0[Xy]="Numeric",d0[_d]="Punctuator",d0[yx]="String",d0[9]="RegularExpression";var Qz="ArrayExpression",Zz="BinaryExpression",eU="CallExpression",tU="ConditionalExpression",FF="Identifier",nU="Literal",rU="LogicalExpression",iU="MemberExpression",aU="ObjectExpression",oU="Property",sU="UnaryExpression",wl="Unexpected token %0",uU="Unexpected number",cU="Unexpected string",lU="Unexpected identifier",fU="Unexpected reserved word",hU="Unexpected end of input",ZO="Invalid regular expression",eA="Invalid regular expression: missing /",RF="Octal literals are not allowed in strict mode.",dU="Duplicate data property in object literal not allowed in strict mode",pf="ILLEGAL",bx="Disabled.",pU=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),mU=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function xk(e,t){if(!e)throw new Error("ASSERT: "+t)}function p0(e){return e>=48&&e<=57}function tA(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function xx(e){return"01234567".indexOf(e)>=0}function gU(e){return e===32||e===9||e===11||e===12||e===160||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function wx(e){return e===10||e===13||e===8232||e===8233}function kx(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e===92||e>=128&&pU.test(String.fromCharCode(e))}function wk(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||e===92||e>=128&&mU.test(String.fromCharCode(e))}var vU={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function MF(){for(var e;Tr<df&&(gU(e=_i.charCodeAt(Tr))||wx(e));)++Tr}function nA(e){var t,n,r,i=0;for(n=e==="u"?4:2,t=0;t<n;++t)Tr<df&&tA(_i[Tr])?(r=_i[Tr++],i=16*i+"0123456789abcdef".indexOf(r.toLowerCase())):Po({},wl,pf);return String.fromCharCode(i)}function yU(){var e,t,n,r;for(t=0,(e=_i[Tr])==="}"&&Po({},wl,pf);Tr<df&&tA(e=_i[Tr++]);)t=16*t+"0123456789abcdef".indexOf(e.toLowerCase());return(t>1114111||e!=="}")&&Po({},wl,pf),t<=65535?String.fromCharCode(t):(n=55296+(t-65536>>10),r=56320+(t-65536&1023),String.fromCharCode(n,r))}function jF(){var e,t;for(e=_i.charCodeAt(Tr++),t=String.fromCharCode(e),e===92&&(_i.charCodeAt(Tr)!==117&&Po({},wl,pf),++Tr,(e=nA("u"))&&e!=="\\"&&kx(e.charCodeAt(0))||Po({},wl,pf),t=e);Tr<df&&wk(e=_i.charCodeAt(Tr));)++Tr,t+=String.fromCharCode(e),e===92&&(t=t.substr(0,t.length-1),_i.charCodeAt(Tr)!==117&&Po({},wl,pf),++Tr,(e=nA("u"))&&e!=="\\"&&wk(e.charCodeAt(0))||Po({},wl,pf),t+=e);return t}function bU(){var e,t;return e=Tr,{type:(t=_i.charCodeAt(Tr)===92?jF():function(){var n,r;for(n=Tr++;Tr<df;){if((r=_i.charCodeAt(Tr))===92)return Tr=n,jF();if(!wk(r))break;++Tr}return _i.slice(n,Tr)}()).length===1?Ky:vU.hasOwnProperty(t)?ay:t==="null"?bk:t==="true"||t==="false"?yk:Ky,value:t,start:e,end:Tr}}function rA(){var e,t,n,r,i=Tr,s=_i.charCodeAt(Tr),f=_i[Tr];switch(s){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++Tr,{type:_d,value:String.fromCharCode(s),start:i,end:Tr};default:if((e=_i.charCodeAt(Tr+1))===61)switch(s){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return Tr+=2,{type:_d,value:String.fromCharCode(s)+String.fromCharCode(e),start:i,end:Tr};case 33:case 61:return Tr+=2,_i.charCodeAt(Tr)===61&&++Tr,{type:_d,value:_i.slice(i,Tr),start:i,end:Tr}}}return(r=_i.substr(Tr,4))===">>>="?{type:_d,value:r,start:i,end:Tr+=4}:(n=r.substr(0,3))===">>>"||n==="<<="||n===">>="?{type:_d,value:n,start:i,end:Tr+=3}:f===(t=n.substr(0,2))[1]&&"+-<>&|".indexOf(f)>=0||t==="=>"?{type:_d,value:t,start:i,end:Tr+=2}:"<>=!+-*%&|^/".indexOf(f)>=0?{type:_d,value:f,start:i,end:++Tr}:void Po({},wl,pf)}function BF(){var e,t,n;if(xk(p0((n=_i[Tr]).charCodeAt(0))||n===".","Numeric literal must start with a decimal digit or a decimal point"),t=Tr,e="",n!=="."){if(e=_i[Tr++],n=_i[Tr],e==="0"){if(n==="x"||n==="X")return++Tr,function(r){for(var i="";Tr<df&&tA(_i[Tr]);)i+=_i[Tr++];return i.length===0&&Po({},wl,pf),kx(_i.charCodeAt(Tr))&&Po({},wl,pf),{type:Xy,value:parseInt("0x"+i,16),start:r,end:Tr}}(t);if(xx(n))return function(r){for(var i="0"+_i[Tr++];Tr<df&&xx(_i[Tr]);)i+=_i[Tr++];return(kx(_i.charCodeAt(Tr))||p0(_i.charCodeAt(Tr)))&&Po({},wl,pf),{type:Xy,value:parseInt(i,8),octal:!0,start:r,end:Tr}}(t);n&&p0(n.charCodeAt(0))&&Po({},wl,pf)}for(;p0(_i.charCodeAt(Tr));)e+=_i[Tr++];n=_i[Tr]}if(n==="."){for(e+=_i[Tr++];p0(_i.charCodeAt(Tr));)e+=_i[Tr++];n=_i[Tr]}if(n==="e"||n==="E")if(e+=_i[Tr++],(n=_i[Tr])!=="+"&&n!=="-"||(e+=_i[Tr++]),p0(_i.charCodeAt(Tr)))for(;p0(_i.charCodeAt(Tr));)e+=_i[Tr++];else Po({},wl,pf);return kx(_i.charCodeAt(Tr))&&Po({},wl,pf),{type:Xy,value:parseFloat(e),start:t,end:Tr}}function xU(){var e,t,n,r;return Zo=null,MF(),e=Tr,t=function(){var i,s,f,m;for(xk((i=_i[Tr])==="/","Regular expression literal must start with a slash"),s=_i[Tr++],f=!1,m=!1;Tr<df;)if(s+=i=_i[Tr++],i==="\\")wx((i=_i[Tr++]).charCodeAt(0))&&Po({},eA),s+=i;else if(wx(i.charCodeAt(0)))Po({},eA);else if(f)i==="]"&&(f=!1);else{if(i==="/"){m=!0;break}i==="["&&(f=!0)}return m||Po({},eA),{value:s.substr(1,s.length-2),literal:s}}(),n=function(){var i,s,f;for(s="",f="";Tr<df&&wk((i=_i[Tr]).charCodeAt(0));)++Tr,i==="\\"&&Tr<df?Po({},wl,pf):(f+=i,s+=i);return f.search(/[^gimuy]/g)>=0&&Po({},ZO,f),{value:f,literal:s}}(),r=function(i,s){var f=i;s.indexOf("u")>=0&&(f=f.replace(/\\u\{([0-9a-fA-F]+)\}/g,function(m,x){if(parseInt(x,16)<=1114111)return"x";Po({},ZO)}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(f)}catch{Po({},ZO)}try{return new RegExp(i,s)}catch{return null}}(t.value,n.value),{literal:t.literal+n.literal,value:r,regex:{pattern:t.value,flags:n.value},start:e,end:Tr}}function PF(){var e;return MF(),Tr>=df?{type:vx,start:Tr,end:Tr}:kx(e=_i.charCodeAt(Tr))?bU():e===40||e===41||e===59?rA():e===39||e===34?function(){var t,n,r,i,s="",f=!1;for(xk((t=_i[Tr])==="'"||t==='"',"String literal must starts with a quote"),n=Tr,++Tr;Tr<df;){if((r=_i[Tr++])===t){t="";break}if(r==="\\")if((r=_i[Tr++])&&wx(r.charCodeAt(0)))r==="\r"&&_i[Tr]===`
`&&++Tr;else switch(r){case"u":case"x":_i[Tr]==="{"?(++Tr,s+=yU()):s+=nA(r);break;case"n":s+=`
`;break;case"r":s+="\r";break;case"t":s+="	";break;case"b":s+="\b";break;case"f":s+="\f";break;case"v":s+="\v";break;default:xx(r)?((i="01234567".indexOf(r))!==0&&(f=!0),Tr<df&&xx(_i[Tr])&&(f=!0,i=8*i+"01234567".indexOf(_i[Tr++]),"0123".indexOf(r)>=0&&Tr<df&&xx(_i[Tr])&&(i=8*i+"01234567".indexOf(_i[Tr++]))),s+=String.fromCharCode(i)):s+=r}else{if(wx(r.charCodeAt(0)))break;s+=r}}return t!==""&&Po({},wl,pf),{type:yx,value:s,octal:f,start:n,end:Tr}}():e===46?p0(_i.charCodeAt(Tr+1))?BF():rA():p0(e)?BF():rA()}function Sd(){var e;return Tr=(e=Zo).end,Zo=PF(),Tr=e.end,e}function LF(){var e;e=Tr,Zo=PF(),Tr=e}function zF(e,t,n){var r=new dg(e==="||"||e==="&&"?rU:Zz);return r.operator=e,r.left=t,r.right=n,r}function wU(e,t){var n=new dg(eU);return n.callee=e,n.arguments=t,n}function iA(e){var t=new dg(FF);return t.name=e,t}function Ex(e){var t=new dg(nU);return t.value=e.value,t.raw=_i.slice(e.start,e.end),e.regex&&(t.raw==="//"&&(t.raw="/(?:)/"),t.regex=e.regex),t}function UF(e,t,n){var r=new dg(iU);return r.computed=e==="[",r.object=t,r.property=n,r.computed||(n.member=!0),r}function WF(e,t,n){var r=new dg(oU);return r.key=t,r.value=n,r.kind=e,r}function Po(e,t){var n,r=Array.prototype.slice.call(arguments,2),i=t.replace(/%(\d)/g,function(s,f){return xk(f<r.length,"Message reference must be in range"),r[f]});throw(n=new Error(i)).index=Tr,n.description=i,n}function kk(e){e.type===vx&&Po(e,hU),e.type===Xy&&Po(e,uU),e.type===yx&&Po(e,cU),e.type===Ky&&Po(e,lU),e.type===ay&&Po(e,fU),Po(e,wl,e.value)}function mf(e){var t=Sd();t.type===_d&&t.value===e||kk(t)}function Ls(e){return Zo.type===_d&&Zo.value===e}function aA(e){return Zo.type===ay&&Zo.value===e}function kU(){var e=[];for(Tr=Zo.start,mf("[");!Ls("]");)Ls(",")?(Sd(),e.push(null)):(e.push(Yy()),Ls("]")||mf(","));return Sd(),function(t){var n=new dg(Qz);return n.elements=t,n}(e)}function VF(){var e;return Tr=Zo.start,(e=Sd()).type===yx||e.type===Xy?(e.octal&&Po(e,RF),Ex(e)):iA(e.value)}function EU(){var e,t,n;return Tr=Zo.start,(e=Zo).type===Ky?(n=VF(),mf(":"),WF("init",n,Yy())):e.type!==vx&&e.type!==_d?(t=VF(),mf(":"),WF("init",t,Yy())):void kk(e)}function CU(){var e,t,n=[],r={},i=String;for(Tr=Zo.start,mf("{");!Ls("}");)t="$"+((e=EU()).key.type===FF?e.key.name:i(e.key.value)),Object.prototype.hasOwnProperty.call(r,t)?Po({},dU):r[t]=!0,n.push(e),Ls("}")||mf(",");return mf("}"),function(s){var f=new dg(aU);return f.properties=s,f}(n)}var OU={if:1};function AU(){var e,t,n;if(Ls("("))return function(){var r;return mf("("),r=oA(),mf(")"),r}();if(Ls("["))return kU();if(Ls("{"))return CU();if(e=Zo.type,Tr=Zo.start,e===Ky||OU[Zo.value])n=iA(Sd().value);else if(e===yx||e===Xy)Zo.octal&&Po(Zo,RF),n=Ex(Sd());else{if(e===ay)throw new Error(bx);e===yk?((t=Sd()).value=t.value==="true",n=Ex(t)):e===bk?((t=Sd()).value=null,n=Ex(t)):Ls("/")||Ls("/=")?(n=Ex(xU()),LF()):kk(Sd())}return n}function _U(){var e=[];if(mf("("),!Ls(")"))for(;Tr<df&&(e.push(Yy()),!Ls(")"));)mf(",");return mf(")"),e}function SU(){var e;return Tr=Zo.start,function(t){return t.type===Ky||t.type===ay||t.type===yk||t.type===bk}(e=Sd())||kk(e),iA(e.value)}function DU(){var e;return mf("["),e=oA(),mf("]"),e}function qF(){var e=function(){var t;for(t=AU();;)if(Ls("."))mf("."),t=UF(".",t,SU());else if(Ls("("))t=wU(t,_U());else{if(!Ls("["))break;t=UF("[",t,DU())}return t}();if(Zo.type===_d&&(Ls("++")||Ls("--")))throw new Error(bx);return e}function Ek(){var e,t;if(Zo.type!==_d&&Zo.type!==ay)t=qF();else{if(Ls("++")||Ls("--"))throw new Error(bx);if(Ls("+")||Ls("-")||Ls("~")||Ls("!"))e=Sd(),t=Ek(),t=function(n,r){var i=new dg(sU);return i.operator=n,i.argument=r,i.prefix=!0,i}(e.value,t);else{if(aA("delete")||aA("void")||aA("typeof"))throw new Error(bx);t=qF()}}return t}function HF(e){var t=0;if(e.type!==_d&&e.type!==ay)return 0;switch(e.value){case"||":t=1;break;case"&&":t=2;break;case"|":t=3;break;case"^":t=4;break;case"&":t=5;break;case"==":case"!=":case"===":case"!==":t=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":t=7;break;case"<<":case">>":case">>>":t=8;break;case"+":case"-":t=9;break;case"*":case"/":case"%":t=11}return t}function Yy(){var e,t;return e=function(){var n,r,i,s,f,m,x,O,T,M;if(n=Zo,T=Ek(),(f=HF(s=Zo))===0)return T;for(s.prec=f,Sd(),r=[n,Zo],m=[T,s,x=Ek()];(f=HF(Zo))>0;){for(;m.length>2&&f<=m[m.length-2].prec;)x=m.pop(),O=m.pop().value,T=m.pop(),r.pop(),i=zF(O,T,x),m.push(i);(s=Sd()).prec=f,m.push(s),r.push(Zo),i=Ek(),m.push(i)}for(i=m[M=m.length-1],r.pop();M>1;)r.pop(),i=zF(m[M-1].value,m[M-2],i),M-=2;return i}(),Ls("?")&&(Sd(),t=Yy(),mf(":"),e=function(n,r,i){var s=new dg(tU);return s.test=n,s.consequent=r,s.alternate=i,s}(e,t,Yy())),e}function oA(){var e=Yy();if(Ls(","))throw new Error(bx);return e}var TU=function(e){Tr=0,df=(_i=e).length,Zo=null,LF();var t=oA();if(Zo.type!==vx)throw new Error("Unexpect token after expression.");return t};function Fb(e,t,n){return e.fields=t||[],e.fname=n,e}function NU(e){return e.length===1?IU(e[0]):FU(e)}const IU=e=>function(t){return t[e]},FU=e=>{const t=e.length;return function(n){for(let r=0;r<t;++r)n=n[e[r]];return n}};function sA(e){throw Error(e)}function RU(e){const t=[],n=e.length;let r,i,s,f=null,m=0,x="";function O(){t.push(x+e.substring(r,i)),x="",r=i+1}for(e+="",r=i=0;i<n;++i)if((s=e[i])==="\\")x+=e.substring(r,i),x+=e.substring(++i,++i),r=i;else if(s===f)O(),f=null,m=-1;else{if(f)continue;r===m&&s==='"'||r===m&&s==="'"?(r=i+1,f=s):s!=="."||m?s==="["?(i>r&&O(),m=r=i+1):s==="]"&&(m||sA("Access path missing open bracket: "+e),m>0&&O(),m=0,r=i+1):i>r?O():r=i+1}return m&&sA("Access path missing closing bracket: "+e),f&&sA("Access path missing closing quote: "+e),i>r&&(i++,O()),t}function MU(e,t,n){const r=RU(e);return e=r.length===1?r[0]:e,Fb(NU(r),[e],e)}MU("id"),Fb(e=>e,[],"identity"),Fb(()=>0,[],"zero"),Fb(()=>1,[],"one"),Fb(()=>!0,[],"true"),Fb(()=>!1,[],"false");function $F(e){const t=TU(e),n=new Set;return t.visit(r=>{r.type==="MemberExpression"&&function i(s){return s.object.type==="MemberExpression"?i(s.object):s.object.name==="datum"}(r)&&n.add(function i(s){const f=[];return s.type==="Identifier"?[s.name]:s.type==="Literal"?[s.value]:(s.type==="MemberExpression"&&(f.push(...i(s.object)),f.push(...i(s.property))),f)}(r).slice(1).join("."))}),n}class Rb extends as{constructor(t,n,r){super(t),this.model=n,this.filter=r,this.expr=Ck(this.model,this.filter,this),this._dependentFields=$F(this.expr)}clone(){return new Rb(null,this.model,$a(this.filter))}dependentFields(){return this._dependentFields}producedFields(){return new Set}assemble(){return{type:"filter",expr:this.expr}}hash(){return`Filter ${this.expr}`}}function GF(e,t,n,r="datum"){const i=[],s=Z1(t,function(f){const m=Qs(f),x=e.getSelectionComponent(m,f),O=go(m+$y);if(x.project.timeUnit){const T=n??e.component.data.raw,M=x.project.timeUnit.clone();T.parent?M.insertAsParentOf(T):T.parent=M}return x.empty!=="none"&&i.push(O),`vlSelectionTest(${O}, ${r}`+(x.resolve==="global"?")":`, ${go(x.resolve)})`)});return(i.length?"!("+i.map(f=>`length(data(${f}))`).join(" || ")+") || ":"")+`(${s})`}function KF(e,t){const n=t.encoding;let r=t.field;if(n||r){if(n&&!r){const i=e.project.items.filter(s=>s.channel===n);!i.length||i.length>1?(r=e.project.items[0].field,Gr((i.length?"Multiple ":"No ")+`matching ${go(n)} encoding found for selection ${go(t.selection)}. Using "field": ${go(r)}.`)):r=i[0].field}}else r=e.project.items[0].field,e.project.items.length>1&&Gr(`A "field" or "encoding" must be specified when using a selection as a scale domain. Using "field": ${go(r)}.`);return`${e.name}[${go(r)}]`}function Ck(e,t,n){return Z1(t,r=>Ha(r)?r:function(i){return i?.selection}(r)?GF(e,r.selection,n):zN(r))}function uA(e,t,n,r){var i,s,f;e.encode=(i=e.encode)!==null&&i!==void 0?i:{},e.encode[t]=(s=e.encode[t])!==null&&s!==void 0?s:{},e.encode[t].update=(f=e.encode[t].update)!==null&&f!==void 0?f:{},e.encode[t].update[n]=r}function Cx(e,t,n,r={header:!1}){var i,s;const f=e.combine(),{disable:m,orient:x,scale:O,labelExpr:T,title:M,zindex:q}=f,Q=Pi(f,["disable","orient","scale","labelExpr","title","zindex"]);if(!m){for(const se in Q){const le=N7[se],Fe=Q[se];if(le&&le!==t&&le!=="both")delete Q[se];else if($3(Fe)){const{condition:Le}=Fe,ze=Pi(Fe,["condition"]),nt=Mu(Le),it=sN[se];if(it){const{vgProp:ut,part:st}=it;uA(Q,st,ut,[...nt.map(pt=>{const{test:dt}=pt,Qt=Pi(pt,["test"]);return Object.assign({test:Ck(null,dt)},Qt)}),ze]),delete Q[se]}else if(it===null){const ut={signal:nt.map(st=>{const{test:pt}=st,dt=Pi(st,["test"]);return`${Ck(null,pt)} ? ${xI(dt)} : `}).join("")+xI(ze)};Q[se]=ut}}else if(da(Fe)){const Le=sN[se];if(Le){const{vgProp:ze,part:nt}=Le;uA(Q,nt,ze,Fe),delete Q[se]}}}if(t==="grid"){if(!Q.grid)return;if(Q.encode){const{grid:se}=Q.encode;Q.encode=Object.assign({},se?{grid:se}:{}),ms(Q.encode)&&delete Q.encode}return Object.assign(Object.assign({scale:O,orient:x},Q),{domain:!1,labels:!1,aria:!1,maxExtent:0,minExtent:0,ticks:!1,zindex:Qu(q,0)})}{if(!r.header&&e.mainExtracted)return;if(T!==void 0){let le=T;!((s=(i=Q.encode)===null||i===void 0?void 0:i.labels)===null||s===void 0)&&s.update&&da(Q.encode.labels.update.text)&&(le=Ob(T,"datum.label",Q.encode.labels.update.text.signal)),uA(Q,"labels","text",{signal:le})}if(Q.labelAlign===null&&delete Q.labelAlign,Q.encode){for(const le of uN)e.hasAxisPart(le)||delete Q.encode[le];ms(Q.encode)&&delete Q.encode}const se=function(le,Fe){if(le)return Gi(le)&&!ty(le)?le.map(Le=>gI(Le,Fe)).join(", "):le}(M,n);return Object.assign(Object.assign(Object.assign(Object.assign({scale:O,orient:x,grid:!1},se?{title:se}:{}),Q),n.aria===!1?{aria:!1}:{}),{zindex:Qu(q,0)})}}}function XF(e){const{axes:t}=e.component,n=[];for(const r of gm)if(t[r]){for(const i of t[r])if(!i.get("disable")&&!i.get("gridScale")){const s=r==="x"?"height":"width",f=e.getSizeSignalRef(s).signal;s!==f&&n.push({name:s,update:f})}}return n}const YF={titleAlign:"align",titleAnchor:"anchor",titleAngle:"angle",titleBaseline:"baseline",titleColor:"color",titleFont:"font",titleFontSize:"fontSize",titleFontStyle:"fontStyle",titleFontWeight:"fontWeight",titleLimit:"limit",titleLineHeight:"lineHeight",titleOrient:"orient",titlePadding:"offset"},JF={labelAlign:"align",labelAnchor:"anchor",labelAngle:"angle",labelBaseline:"baseline",labelColor:"color",labelFont:"font",labelFontSize:"fontSize",labelFontStyle:"fontStyle",labelFontWeight:"fontWeight",labelLimit:"limit",labelLineHeight:"lineHeight",labelOrient:"orient",labelPadding:"offset"},jU=Kr(YF),BU=Kr(JF);function QF(e,t,n,r){return Object.assign.apply(null,[{},...e.map(i=>{if(i==="axisOrient"){const s=n==="x"?"bottom":"left",f=t[n==="x"?"axisBottom":"axisLeft"]||{},m=t[n==="x"?"axisTop":"axisRight"]||{},x=new Set([...Kr(f),...Kr(m)]),O={};for(const T of x.values())O[T]={signal:`${r.signal} === "${s}" ? ${lx(f[T])} : ${lx(m[T])}`};return O}return t[i]})])}function PU(e,t,n,r){const i=t==="band"?["axisDiscrete","axisBand"]:t==="point"?["axisDiscrete","axisPoint"]:function(O){return O in IL}(t)?["axisQuantitative"]:t==="time"||t==="utc"?["axisTemporal"]:[],s=e==="x"?"axisX":"axisY",f=da(n)?"axisOrient":"axis"+Sw(n),m=[...i,...i.map(O=>s+O.substr(4))],x=["axis",f,s];return{vlOnlyAxisConfig:QF(m,r,e,n),vgAxisConfig:QF(x,r,e,n),axisConfigStyle:function(O,T){var M;const q=[{}];for(const Q of O){let se=(M=T[Q])===null||M===void 0?void 0:M.style;if(se){se=Mu(se);for(const le of se)q.push(T.style[le])}}return Object.assign.apply(null,q)}([...x,...m],r)}}function cA(e,t,n,r={}){var i;const s=kI(e,n,t.style);if(s!==void 0)return{configFrom:"style",configValue:s};for(const f of["vlOnlyAxisConfig","vgAxisConfig","axisConfigStyle"])if(((i=r[f])===null||i===void 0?void 0:i[e])!==void 0)return{configFrom:f,configValue:r[f][e]};return{}}const ZF={scale:({model:e,channel:t})=>e.scaleName(t),format:({fieldOrDatumDef:e,config:t,axis:n})=>{const{format:r,formatType:i}=n;return ZN(e,e.type,r,i,t,!0)},formatType:({axis:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:r}=e;return eI(r,t,n)},grid:({fieldOrDatumDef:e,axis:t,scaleType:n})=>{var r;return(!si(e)||!bh(e.bin))&&((r=t.grid)!==null&&r!==void 0?r:function(i,s){return!Ad(i)&&si(s)&&!Ns(s?.bin)}(n,e))},gridScale:({model:e,channel:t})=>function(n,r){const i=r==="x"?"y":"x";if(n.getScaleComponent(i))return n.scaleName(i)}(e,t),labelAlign:({axis:e,labelAngle:t,orient:n,channel:r})=>e.labelAlign||tR(t,n,r),labelAngle:({labelAngle:e})=>e,labelBaseline:({axis:e,labelAngle:t,orient:n,channel:r})=>e.labelBaseline||eR(t,n,r),labelFlush:({axis:e,fieldOrDatumDef:t,channel:n})=>{var r;return(r=e.labelFlush)!==null&&r!==void 0?r:function(i,s){if(s==="x"&&Ji(["quantitative","temporal"],i))return!0}(t.type,n)},labelOverlap:({axis:e,fieldOrDatumDef:t,scaleType:n})=>{var r;return(r=e.labelOverlap)!==null&&r!==void 0?r:function(i,s){if(i!=="nominal")return s!=="log"||"greedy"}(t.type,n)},orient:({orient:e})=>e,tickCount:({channel:e,model:t,axis:n,fieldOrDatumDef:r,scaleType:i})=>{var s;const f=e==="x"?"width":e==="y"?"height":void 0,m=f?t.getSizeSignalRef(f):void 0;return(s=n.tickCount)!==null&&s!==void 0?s:function({fieldOrDatumDef:x,scaleType:O,size:T,values:M}){var q;if(!M&&!Ad(O)&&O!=="log"){if(si(x)){if(Ns(x.bin))return{signal:`ceil(${T.signal}/10)`};if(x.timeUnit&&Ji(["month","hours","day","quarter"],(q=xh(x.timeUnit))===null||q===void 0?void 0:q.unit))return}return{signal:`ceil(${T.signal}/40)`}}}({fieldOrDatumDef:r,scaleType:i,size:m,values:n.values})},title:({axis:e,model:t,channel:n})=>{if(e.title!==void 0)return e.title;const r=nR(t,n);if(r!==void 0)return r;const i=t.typedFieldDef(n),s=n==="x"?"x2":"y2",f=t.fieldDef(s);return CI(i?[sI(i)]:[],si(f)?[sI(f)]:[])},values:({axis:e,fieldOrDatumDef:t})=>function(n,r){const i=n.values;if(Gi(i))return yI(r,i);if(da(i))return i}(e,t),zindex:({axis:e,fieldOrDatumDef:t,mark:n})=>{var r;return(r=e.zindex)!==null&&r!==void 0?r:function(i,s){return i==="rect"&&fI(s)?1:0}(n,t)}};function lA(e){return`(((${e.signal} % 360) + 360) % 360)`}function eR(e,t,n,r){if(e!==void 0){if(n==="x"){if(da(e)){const i=lA(e);return{signal:`(45 < ${i} && ${i} < 135) || (225 < ${i} && ${i} < 315) ? "middle" :(${i} <= 45 || 315 <= ${i}) === ${da(t)?`(${t.signal} === "top")`:t==="top"} ? "bottom" : "top"`}}if(45<e&&e<135||225<e&&e<315)return"middle";if(da(t)){const i=e<=45||315<=e?"===":"!==";return{signal:`${t.signal} ${i} "top" ? "bottom" : "top"`}}return(e<=45||315<=e)==(t==="top")?"bottom":"top"}if(da(e)){const i=lA(e),s=da(t)?`(${t.signal} === "left")`:t==="left";return{signal:`${i} <= 45 || 315 <= ${i} || (135 <= ${i} && ${i} <= 225) ? ${r?'"middle"':"null"} : (45 <= ${i} && ${i} <= 135) === ${s} ? "top" : "bottom"`}}if(e<=45||315<=e||135<=e&&e<=225)return r?"middle":null;if(da(t)){const i=45<=e&&e<=135?"===":"!==";return{signal:`${t.signal} ${i} "left" ? "top" : "bottom"`}}return(45<=e&&e<=135)==(t==="left")?"top":"bottom"}}function tR(e,t,n){if(e===void 0)return;const r=n==="x",i=r?0:90,s=r?"bottom":"left";if(da(e)){const f=lA(e),m=da(t)?`(${t.signal} === "${s}")`:t===s;return{signal:`(${i?"("+f+" + 90)":f} % 180 === 0) ? ${r?null:'"center"'} :(${i} < ${f} && ${f} < ${180+i}) === ${m} ? "left" : "right"`}}if((e+i)%180==0)return r?null:"center";if(da(t)){const f=i<e&&e<180+i?"===":"!==";return{signal:`${`${t.signal} ${f} "${s}"`} ? "left" : "right"`}}return(i<e&&e<180+i)==(t===s)?"left":"right"}function nR(e,t){const n=t==="x"?"x2":"y2",r=e.fieldDef(t),i=e.fieldDef(n),s=r?r.title:void 0,f=i?i.title:void 0;return s&&f?OI(s,f):s||f||(s!==void 0?s:f!==void 0?f:void 0)}class Mb extends as{constructor(t,n){super(t),this.transform=n,this._dependentFields=$F(this.transform.calculate)}clone(){return new Mb(null,$a(this.transform))}static parseAllForSortIndex(t,n){return n.forEachFieldDef((r,i)=>{if(kO(r)&&oI(r.sort)){const{field:s,timeUnit:f}=r,m=r.sort,x=m.map((O,T)=>`${zN({field:s,timeUnit:f,equal:O})} ? ${T} : `).join("")+m.length;t=new Mb(t,{calculate:x,as:jb(r,i,{forAs:!0})})}}),t}producedFields(){return new Set([this.transform.as])}dependentFields(){return this._dependentFields}assemble(){return{type:"formula",expr:this.transform.calculate,as:this.transform.as}}hash(){return`Calculate ${ko(this.transform)}`}}function jb(e,t,n){return ti(e,Object.assign({prefix:t,suffix:"sort_index"},n??{}))}function Ok(e,t){return Ji(["top","bottom"],t)?"column":Ji(["left","right"],t)||e==="row"?"row":"column"}function Bb(e,t,n,r){const i=r==="row"?n.headerRow:r==="column"?n.headerColumn:n.headerFacet;return Qu((t?.header||{})[e],i[e],n.header[e])}function Ak(e,t,n,r){const i={};for(const s of e){const f=Bb(s,t,n,r);f!==void 0&&(i[s]=f)}return i}const fA=["row","column"],hA=["header","footer"];function LU(e,t){const n=e.component.layoutHeaders[t].title,r=e.config?e.config:void 0,i=e.component.layoutHeaders[t].facetFieldDef?e.component.layoutHeaders[t].facetFieldDef:void 0,{titleAnchor:s,titleAngle:f,titleOrient:m}=Ak(["titleAnchor","titleAngle","titleOrient"],i,r,t),x=Ok(t,m),O=Dw(f);return{name:`${t}-title`,type:"group",role:`${x}-title`,title:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:n},t==="row"?{orient:"left"}:{}),{style:"guide-title"}),iR(O,x)),rR(x,O,s)),aR(r,i,t,jU,YF))}}function rR(e,t,n="middle"){switch(n){case"start":return{align:"left"};case"end":return{align:"right"}}const r=tR(t,e==="row"?"left":"top",e==="row"?"y":"x");return r?{align:r}:{}}function iR(e,t){const n=eR(e,t==="row"?"left":"top",t==="row"?"y":"x",!0);return n?{baseline:n}:{}}function zU(e,t){const n=e.component.layoutHeaders[t],r=[];for(const i of hA)if(n[i])for(const s of n[i]){const f=UU(e,t,i,n,s);f!=null&&r.push(f)}return r}function dA(e,t,n){const{format:r,formatType:i,labelAngle:s,labelAnchor:f,labelOrient:m,labelExpr:x}=Ak(["format","formatType","labelAngle","labelAnchor","labelOrient","labelExpr"],e,n,t),O=mO({fieldOrDatumDef:e,format:r,formatType:i,expr:"parent",config:n}).signal,T=Ok(t,m);return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:{signal:x?Ob(Ob(x,"datum.label",O),"datum.value",ti(e,{expr:"parent"})):O}},t==="row"?{orient:"left"}:{}),{style:"guide-label",frame:"group"}),iR(s,T)),rR(T,s,f)),aR(n,e,t,BU,JF))}function UU(e,t,n,r,i){if(i){let s=null;const{facetFieldDef:f}=r,m=e.config?e.config:void 0;if(f&&i.labels){const{labelOrient:M}=Ak(["labelOrient"],f,m,t);(t==="row"&&!Ji(["top","bottom"],M)||t==="column"&&!Ji(["left","right"],M))&&(s=dA(f,t,m))}const x=gg(e)&&!sx(e.facet),O=i.axes,T=O?.length>0;if(s||T){const M=t==="row"?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:e.getName(`${t}_${n}`),type:"group",role:`${t}-${n}`},r.facetFieldDef?{from:{data:e.getName(t+"_domain")},sort:function(q,Q){var se;const{sort:le}=q;return Ev(le)?{field:ti(le,{expr:"datum"}),order:(se=le.order)!==null&&se!==void 0?se:"ascending"}:Gi(le)?{field:jb(q,Q,{expr:"datum"}),order:"ascending"}:{field:ti(q,{expr:"datum"}),order:le??"ascending"}}(f,t)}:{}),T&&x?{from:{data:e.getName(`facet_domain_${t}`)}}:{}),s?{title:s}:{}),i.sizeSignal?{encode:{update:{[M]:i.sizeSignal}}}:{}),T?{axes:O}:{})}}return null}const WU={column:{start:0,end:1},row:{start:1,end:0}};function VU(e,t){return WU[t][e]}function aR(e,t,n,r,i){const s={};for(const f of r){if(!i[f])continue;const m=Bb(f,t,e,n);m!==void 0&&(s[i[f]]=m)}return s}function pA(e){return[..._k(e,"width"),..._k(e,"height"),..._k(e,"childWidth"),..._k(e,"childHeight")]}function _k(e,t){const n=t==="width"?"x":"y",r=e.component.layoutSize.get(t);if(!r||r==="merged")return[];const i=e.getSizeSignalRef(t).signal;if(r==="step"){const s=e.getScaleComponent(n);if(s){const f=s.get("type"),m=s.get("range");if(Ad(f)&&J0(m)){const x=e.scaleName(n);return gg(e.parent)&&e.parent.component.resolve.scale[n]==="independent"?[oR(x,m)]:[oR(x,m),{name:i,update:sR(x,s,`domain('${x}').length`)}]}}throw new Error("layout size is step although width/height is not step.")}if(r=="container"){const s=i.endsWith("width"),f=s?"containerSize()[0]":"containerSize()[1]",m=`isFinite(${f}) ? ${f} : ${LO(e.config.view,s?"width":"height")}`;return[{name:i,init:m,on:[{update:m,events:"window:resize"}]}]}return[{name:i,value:r}]}function oR(e,t){return{name:e+"_step",value:t.step}}function sR(e,t,n){const r=t.get("type"),i=t.get("padding"),s=Qu(t.get("paddingOuter"),i);let f=t.get("paddingInner");return`bandspace(${n}, ${f=r==="band"?f!==void 0?f:i:1}, ${s}) * ${e}_step`}function uR(e){return e==="childWidth"?"width":e==="childHeight"?"height":e}function cR(e,t){return Kr(e).reduce((n,r)=>{const i=e[r];return Object.assign(Object.assign({},n),dx(t,i,r,s=>da(s)?s:{value:s.value}))},{})}function qU(e,t){if(Ub(t)||gg(t))return"shared";if(_A(t))return wv(e)?"independent":"shared";throw new Error("invalid model type for resolve")}function mA(e,t){const n=e.scale[t],r=wv(t)?"axis":"legend";return n==="independent"?(e[r][t]==="shared"&&Gr(he.independentScaleMeansIndependentGuide(t)),"independent"):e[r][t]||"shared"}const HU=Object.assign(Object.assign({},KL),{disable:1,labelExpr:1,selections:1,opacity:1,shape:1,stroke:1,fill:1,size:1,strokeWidth:1,strokeDash:1,encode:1}),lR=Kr(HU);class $U extends f0{}const fR={symbols:function(e,{fieldOrDatumDef:t,model:n,channel:r,legendCmpt:i,legendType:s}){var f,m,x,O,T;if(s!=="symbol")return;const{markDef:M,encoding:q,config:Q,mark:se}=n,le=M.filled&&se!=="trail";let Fe=Object.assign(Object.assign({},function(ze,nt,it){for(const ut of it){const st=Wy(ut,nt.markDef,nt.config);st!==void 0&&(ze[ut]=ju(st))}return ze}({},n,j7)),dF(n,{filled:le}));const Le=(f=hR(q.opacity))!==null&&f!==void 0?f:M.opacity;if(Fe.fill){if(r==="fill"||le&&r===Cd)delete Fe.fill;else if(Fe.fill.field)i.get("symbolFillColor")?delete Fe.fill:(Fe.fill=ju((m=Q.legend.symbolBaseFillColor)!==null&&m!==void 0?m:"black"),Fe.fillOpacity=ju(Le??1));else if(Gi(Fe.fill)){const ze=(T=(O=gA((x=q.fill)!==null&&x!==void 0?x:q.color))!==null&&O!==void 0?O:M.fill)!==null&&T!==void 0?T:le&&M.color;ze&&(Fe.fill=ju(ze))}}if(Fe.stroke){if(r==="stroke"||!le&&r===Cd)delete Fe.stroke;else if(Fe.stroke.field)delete Fe.stroke;else if(Gi(Fe.stroke)){const ze=Qu(gA(q.stroke||q.color),M.stroke,le?M.color:void 0);ze&&(Fe.stroke={value:ze})}}if(r!==u0){const ze=si(t)&&pR(n,i,t);ze?Fe.opacity=[Object.assign({test:ze},ju(Le??1)),ju(Q.legend.unselectedOpacity)]:Le&&(Fe.opacity=ju(Le))}return ms(Fe=Object.assign(Object.assign({},Fe),e))?void 0:Fe},gradient:function(e,{model:t,legendType:n}){if(n!=="gradient")return;let r={};const i=hR(t.encoding.opacity)||t.markDef.opacity;return i&&(r.opacity=ju(i)),ms(r=Object.assign(Object.assign({},r),e))?void 0:r},labels:function(e,{fieldOrDatumDef:t,model:n,channel:r,legendCmpt:i}){const s=n.legend(r)||{},f=n.config,m=si(t)?pR(n,i,t):void 0,x=m?[{test:m,value:1},{value:f.legend.unselectedOpacity}]:void 0,{format:O,formatType:T}=s,M=Ly(T)?gO({fieldOrDatumDef:t,field:"datum.value",format:O,formatType:T,config:f}):void 0,q=Object.assign(Object.assign(Object.assign({},x?{opacity:x}:{}),M?{text:M}:{}),e);return ms(q)?void 0:q},entries:function(e,{legendCmpt:t}){const n=t.get("selections");return n?.length?Object.assign(Object.assign({},e),{fill:{value:"transparent"}}):e}};function hR(e){return dR(e,(t,n)=>Math.max(t,n.value))}function gA(e){return dR(e,(t,n)=>Qu(t,n.value))}function dR(e,t){return function(n){const r=n&&n.condition;return!!r&&(Gi(r)||c0(r))}(e)?Mu(e.condition).reduce(t,e.value):c0(e)?e.value:void 0}function pR(e,t,n){const r=t.get("selections");if(!r?.length)return;const i=go(n.field);return r.map(s=>`(!length(data(${go(Qs(s)+$y)})) || (${s}[${i}] && indexof(${s}[${i}], datum.value) >= 0))`).join(" || ")}const mR={direction:({direction:e})=>e,format:({fieldOrDatumDef:e,legend:t,config:n})=>{const{format:r,formatType:i}=t;return ZN(e,e.type,r,i,n,!1)},formatType:({legend:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:r}=e;return eI(r,t,n)},gradientLength:e=>{var t,n;const{legend:r,legendConfig:i}=e;return(n=(t=r.gradientLength)!==null&&t!==void 0?t:i.gradientLength)!==null&&n!==void 0?n:function({legendConfig:s,model:f,direction:m,orient:x,scaleType:O}){const{gradientHorizontalMaxLength:T,gradientHorizontalMinLength:M,gradientVerticalMaxLength:q,gradientVerticalMinLength:Q}=s;if(fg(O))return m==="horizontal"?x==="top"||x==="bottom"?gR(f,"width",M,T):M:gR(f,"height",Q,q)}(e)},labelOverlap:({legend:e,legendConfig:t,scaleType:n})=>{var r,i;return(i=(r=e.labelOverlap)!==null&&r!==void 0?r:t.labelOverlap)!==null&&i!==void 0?i:function(s){if(Ji(["quantile","threshold","log"],s))return"greedy"}(n)},symbolType:({legend:e,markDef:t,channel:n,encoding:r})=>{var i;return(i=e.symbolType)!==null&&i!==void 0?i:function(s,f,m,x){var O;if(f!=="shape"){const T=(O=gA(m))!==null&&O!==void 0?O:x;if(T)return T}switch(s){case"bar":case"rect":case"image":case"square":return"square";case"line":case"trail":case"rule":return"stroke";case"arc":case"point":case"circle":case"tick":case"geoshape":case"area":case"text":return"circle"}}(t.type,n,r.shape,t.shape)},title:({fieldOrDatumDef:e,config:t})=>zy(e,t,{allowDisabling:!0}),type:({legendType:e,scaleType:t,channel:n})=>{if(Ab(n)&&fg(t)){if(e==="gradient")return}else if(e==="symbol")return;return e},values:({fieldOrDatumDef:e,legend:t})=>function(n,r){const i=n.values;if(Gi(i))return yI(r,i);if(da(i))return i}(t,e)};function GU(e){const{legend:t}=e;return Qu(t.type,function({channel:n,timeUnit:r,scaleType:i}){if(Ab(n)){if(Ji(["quarter","month","day"],r))return"symbol";if(fg(i))return"gradient"}return"symbol"}(e))}function KU({legendConfig:e,legendType:t,orient:n,legend:r}){var i,s;return(s=(i=r.direction)!==null&&i!==void 0?i:e[t?"gradientDirection":"symbolDirection"])!==null&&s!==void 0?s:function(f,m){switch(f){case"top":case"bottom":return"horizontal";case"left":case"right":case"none":case void 0:return;default:return m==="gradient"?"horizontal":void 0}}(n,t)}function gR(e,t,n,r){return{signal:`clamp(${e.getSizeSignalRef(t).signal}, ${n}, ${r})`}}function vR(e){const t=yu(e)?function(n){const{encoding:r}=n,i={};for(const s of[Cd,...UI]){const f=yc(r[s]);f&&n.getScaleComponent(s)&&(s===Od&&si(f)&&f.type===Tb||(i[s]=YU(n,s)))}return i}(e):function(n){const{legends:r,resolve:i}=n.component;for(const s of n.children){vR(s);for(const f of Kr(s.component.legends))i.legend[f]=mA(n.component.resolve,f),i.legend[f]==="shared"&&(r[f]=yR(r[f],s.component.legends[f]),r[f]||(i.legend[f]="independent",delete r[f]))}for(const s of Kr(r))for(const f of n.children)f.component.legends[s]&&i.legend[s]==="shared"&&delete f.component.legends[s];return r}(e);return e.component.legends=t,t}function XU(e,t,n,r){switch(t){case"disable":return n!==void 0;case"values":return!!n?.values;case"title":if(t==="title"&&e===r?.title)return!0}return e===(n||{})[t]}function YU(e,t){var n,r,i;let s=e.legend(t);const{markDef:f,encoding:m,config:x}=e,O=x.legend,T=new $U({},function(st,pt){const dt=st.scaleName(pt);if(st.mark==="trail"){if(pt==="color")return{stroke:dt};if(pt==="size")return{strokeWidth:dt}}return pt==="color"?st.markDef.filled?{fill:dt}:{stroke:dt}:{[pt]:dt}}(e,t));(function(st,pt,dt){var Qt;const mn=(Qt=st.fieldDef(pt))===null||Qt===void 0?void 0:Qt.field;Gy(st,on=>{var Rn,Fn;const zn=(Rn=on.project.hasField[mn])!==null&&Rn!==void 0?Rn:on.project.hasChannel[pt];if(zn&&kF.has(on)){const Vn=(Fn=dt.get("selections"))!==null&&Fn!==void 0?Fn:[];Vn.push(on.name),dt.set("selections",Vn,!1),zn.hasLegend=!0}})})(e,t,T);const M=s!==void 0?!s:O.disable;if(T.set("disable",M,s!==void 0),M)return T;s=s||{};const q=e.getScaleComponent(t).get("type"),Q=yc(m[t]),se=si(Q)?(n=xh(Q.timeUnit))===null||n===void 0?void 0:n.unit:void 0,le=s.orient||x.legend.orient||"right",Fe=GU({legend:s,channel:t,timeUnit:se,scaleType:q}),Le={legend:s,channel:t,model:e,markDef:f,encoding:m,fieldOrDatumDef:Q,legendConfig:O,config:x,scaleType:q,orient:le,legendType:Fe,direction:KU({legend:s,legendType:Fe,orient:le,legendConfig:O})};for(const st of lR){const pt=st in mR?mR[st](Le):s[st];if(pt!==void 0){const dt=XU(pt,st,s,e.fieldDef(t));(dt||x.legend[st]===void 0)&&T.set(st,pt,dt)}}const ze=(r=s?.encoding)!==null&&r!==void 0?r:{},nt=T.get("selections"),it={},ut={fieldOrDatumDef:Q,model:e,channel:t,legendCmpt:T,legendType:Fe};for(const st of["labels","legend","title","symbols","gradient","entries"]){const pt=cR((i=ze[st])!==null&&i!==void 0?i:{},e),dt=st in fR?fR[st](pt,ut):pt;dt===void 0||ms(dt)||(it[st]=Object.assign(Object.assign(Object.assign({},nt?.length&&si(Q)?{name:`${Qs(Q.field)}_legend_${st}`}:{}),nt?.length?{interactive:!!nt}:{}),{update:dt}))}return ms(it)||T.set("encode",it,!!s?.encoding),T}function yR(e,t){var n,r,i,s;if(!e)return t.clone();const f=e.getWithExplicit("orient"),m=t.getWithExplicit("orient");if(f.explicit&&m.explicit&&f.value!==m.value)return;let x=!1;for(const O of lR){const T=ny(e.getWithExplicit(O),t.getWithExplicit(O),O,"legend",(M,q)=>{switch(O){case"symbolType":return JU(M,q);case"title":return AI(M,q);case"type":return x=!0,hg("symbol")}return lk(M,q,O,"legend")});e.setWithExplicit(O,T)}return x&&(!((r=(n=e.implicit)===null||n===void 0?void 0:n.encode)===null||r===void 0)&&r.gradient&&q3(e.implicit,["encode","gradient"]),!((s=(i=e.explicit)===null||i===void 0?void 0:i.encode)===null||s===void 0)&&s.gradient&&q3(e.explicit,["encode","gradient"])),e}function JU(e,t){return t.value==="circle"?t:e}function bR(e,t,n,r){var i,s,f;e.encode=(i=e.encode)!==null&&i!==void 0?i:{},e.encode[t]=(s=e.encode[t])!==null&&s!==void 0?s:{},e.encode[t].update=(f=e.encode[t].update)!==null&&f!==void 0?f:{},e.encode[t].update[n]=r}function xR(e){const t=e.component.legends,n={};for(const r of Kr(t)){const i=e.getScaleComponent(r),s=Js(i.get("domains"));if(n[s])for(const f of n[s])yR(f,t[r])||n[s].push(t[r]);else n[s]=[t[r].clone()]}return U0(n).flat().map(r=>function(i,s){var f,m,x;const O=i.combine(),{disable:T,labelExpr:M,selections:q}=O,Q=Pi(O,["disable","labelExpr","selections"]);if(!T){if(s.aria===!1&&Q.aria==null&&(Q.aria=!1),!((f=Q.encode)===null||f===void 0)&&f.symbols){const se=Q.encode.symbols.update;!se.fill||se.fill.value==="transparent"||se.stroke||Q.stroke||(se.stroke={value:"transparent"});for(const le of UI)Q[le]&&delete se[le]}if(Q.title||delete Q.title,M!==void 0){let se=M;!((x=(m=Q.encode)===null||m===void 0?void 0:m.labels)===null||x===void 0)&&x.update&&da(Q.encode.labels.update.text)&&(se=Ob(M,"datum.label",Q.encode.labels.update.text.signal)),bR(Q,"labels","text",{signal:se})}for(const se in Q){const le=Q[se];if(da(le)){const Fe=GL[se];if(Fe){const{vgProp:Le,part:ze}=Fe;bR(Q,ze,Le,le),delete Q[se]}}}return Q}}(r,e.config)).filter(r=>r!==void 0)}function QU(e){return Ub(e)||_A(e)?function(t){return t.children.reduce((n,r)=>n.concat(r.assembleProjections()),wR(t))}(e):wR(e)}function wR(e){const t=e.component.projection;if(!t||t.merged)return[];const n=t.combine(),{name:r}=n;if(t.data){const i={signal:`[${t.size.map(f=>f.signal).join(", ")}]`},s=t.data.reduce((f,m)=>{const x=da(m)?m.signal:`data('${e.lookupDataSource(m)}')`;return Ji(f,x)||f.push(x),f},[]);if(s.length<=0)throw new Error("Projection's fit didn't find any data sources");return[Object.assign({name:r,size:i,fit:{signal:s.length>1?`[${s.join(", ")}]`:s[0]}},n)]}return[Object.assign(Object.assign({name:r},{translate:{signal:"[width / 2, height / 2]"}}),n)]}const ZU=["type","clipAngle","clipExtent","center","rotate","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];class kR extends f0{constructor(t,n,r,i){super(Object.assign({},n),{name:t}),this.specifiedProjection=n,this.size=r,this.data=i,this.merged=!1}get isFit(){return!!this.data}}function ER(e){e.component.projection=yu(e)?function(t){var n;if(t.hasProjection){const r=t.specifiedProjection,i=!(r&&(r.scale!=null||r.translate!=null)),s=i?[t.getSizeSignalRef("width"),t.getSizeSignalRef("height")]:void 0,f=i?function(m){const x=[],{encoding:O}=m;for(const T of[[gv,mv],[pm,lg]])(yc(O[T[0]])||yc(O[T[1]]))&&x.push({signal:m.getName(`geojson_${x.length}`)});return m.channelHasField(Od)&&m.typedFieldDef(Od).type===Tb&&x.push({signal:m.getName(`geojson_${x.length}`)}),x.length===0&&x.push(m.requestDataName(ff)),x}(t):void 0;return new kR(t.projectionName(!0),Object.assign(Object.assign({},(n=t.config.projection)!==null&&n!==void 0?n:{}),r??{}),s,f)}}(e):function(t){if(t.children.length===0)return;let n;for(const i of t.children)ER(i);const r=eN(t.children,i=>{const s=i.component.projection;if(s){if(n){const f=function(m,x){const O=eN(ZU,T=>!Ty(m.explicit,T)&&!Ty(x.explicit,T)||!(!Ty(m.explicit,T)||!Ty(x.explicit,T)||Js(m.get(T))!==Js(x.get(T))));if(Js(m.size)===Js(x.size)){if(O)return m;if(Js(m.explicit)===Js({}))return x;if(Js(x.explicit)===Js({}))return m}return null}(n,s);return f&&(n=f),!!f}return n=s,!0}return!0});if(n&&r){const i=t.projectionName(!0),s=new kR(i,n.specifiedProjection,n.size,$a(n.data));for(const f of t.children){const m=f.component.projection;m&&(m.isFit&&s.data.push(...f.component.projection.data),f.renameProjection(m.get("name"),i),m.merged=!0)}return s}}(e)}function CR(e,t){return`${_N(e)}_${t}`}function vA(e,t,n){var r;const i=CR((r=nk(n,void 0))!==null&&r!==void 0?r:{},t);return e.getName(`${i}_bins`)}function OR(e,t,n){let r,i;r=function(O){return"as"in O}(e)?Ha(e.as)?[e.as,`${e.as}_end`]:[e.as[0],e.as[1]]:[ti(e,{forAs:!0}),ti(e,{binSuffix:"end",forAs:!0})];const s=Object.assign({},nk(t,void 0)),f=CR(s,e.field),{signal:m,extentSignal:x}=function(O,T){return{signal:O.getName(`${T}_bins`),extentSignal:O.getName(`${T}_extent`)}}(n,f);if($w(s.extent)){const O=s.extent,T=O.selection;i=KF(n.getSelectionComponent(Qs(T),T),O),delete s.extent}return{key:f,binComponent:Object.assign(Object.assign(Object.assign({bin:s,field:e.field,as:[r]},m?{signal:m}:{}),x?{extentSignal:x}:{}),i?{span:i}:{})}}class Dv extends as{constructor(t,n){super(t),this.bins=n}clone(){return new Dv(null,$a(this.bins))}static makeFromEncoding(t,n){const r=n.reduceFieldDef((i,s,f)=>{if(Sp(s)&&Ns(s.bin)){const{key:m,binComponent:x}=OR(s,s.bin,n);i[m]=Object.assign(Object.assign(Object.assign({},x),i[m]),function(O,T,M,q){var Q,se;if(cx(T,M)){const le=yu(O)&&(se=(Q=O.axis(M))!==null&&Q!==void 0?Q:O.legend(M))!==null&&se!==void 0?se:{},Fe=ti(T,{expr:"datum"}),Le=ti(T,{expr:"datum",binSuffix:"end"});return{formulaAs:ti(T,{binSuffix:"range",forAs:!0}),formula:Yw(Fe,Le,le.format,le.formatType,q)}}return{}}(n,s,f,n.config))}return i},{});return ms(r)?null:new Dv(t,r)}static makeFromTransform(t,n,r){const{key:i,binComponent:s}=OR(n,n.bin,r);return new Dv(t,{[i]:s})}merge(t,n){for(const r of Kr(t.bins))r in this.bins?(n(t.bins[r].signal,this.bins[r].signal),this.bins[r].as=z0([...this.bins[r].as,...t.bins[r].as],ko)):this.bins[r]=t.bins[r];for(const r of t.children)t.removeChild(r),r.parent=this;t.remove()}producedFields(){return new Set(U0(this.bins).map(t=>t.as).flat(2))}dependentFields(){return new Set(U0(this.bins).map(t=>t.field))}hash(){return`Bin ${ko(this.bins)}`}assemble(){return U0(this.bins).flatMap(t=>{const n=[],[r,...i]=t.as,s=t.bin,{extent:f}=s,m=Pi(s,["extent"]),x=Object.assign(Object.assign(Object.assign({type:"bin",field:W0(t.field),as:r,signal:t.signal},$w(f)?{extent:null}:{extent:f}),t.span?{span:{signal:`span(${t.span})`}}:{}),m);!f&&t.extentSignal&&(n.push({type:"extent",field:W0(t.field),signal:t.extentSignal}),x.extent={signal:t.extentSignal}),n.push(x);for(const O of i)for(let T=0;T<2;T++)n.push({type:"formula",expr:ti({field:r[T]},{expr:"datum"}),as:O[T]});return t.formula&&n.push({type:"formula",expr:t.formula,as:t.formulaAs}),n})}}class Pb extends as{constructor(t){let n;if(super(null),Hy(t=t??{name:"source"})||(n=t.format?Object.assign({},t0(t.format,["parse"])):{}),fk(t))this._data={values:t.values};else if(hx(t)){if(this._data={url:t.url},!n.type){let r=/(?:\.([^.]+))?$/.exec(t.url)[1];Ji(["json","csv","tsv","dsv","topojson"],r)||(r="json"),n.type=r}}else uF(t)?this._data={values:[{type:"Sphere"}]}:(oF(t)||Hy(t))&&(this._data={});this._generator=Hy(t),t.name&&(this._name=t.name),n&&!ms(n)&&(this._data.format=n)}dependentFields(){return new Set}producedFields(){}get data(){return this._data}hasName(){return!!this._name}get isGenerator(){return this._generator}get dataName(){return this._name}set dataName(t){this._name=t}set parent(t){throw new Error("Source nodes have to be roots.")}remove(){throw new Error("Source nodes are roots and cannot be removed.")}hash(){throw new Error("Cannot hash sources")}assemble(){return Object.assign(Object.assign({name:this._name},this._data),{transform:[]})}}function yA(e){for(const t of e){for(const n of t.children)if(n.parent!==t)return console.error("Dataflow graph is inconsistent.",t,n),!1;if(!yA(t.children))return!1}return!0}class Ox extends as{constructor(t,n){super(t),this.params=n}clone(){return new Ox(null,this.params)}dependentFields(){return new Set}producedFields(){}hash(){return`Graticule ${ko(this.params)}`}assemble(){return Object.assign({type:"graticule"},this.params===!0?{}:this.params)}}class Ax extends as{constructor(t,n){super(t),this.params=n}clone(){return new Ax(null,this.params)}dependentFields(){return new Set}producedFields(){var t;return new Set([(t=this.params.as)!==null&&t!==void 0?t:"data"])}hash(){return`Hash ${ko(this.params)}`}assemble(){return Object.assign({type:"sequence"},this.params)}}function Sk(e){return e instanceof Pb||e instanceof Ox||e instanceof Ax}class AR{constructor(){this._mutated=!1}setMutated(){this._mutated=!0}get mutatedFlag(){return this._mutated}}class m0 extends AR{constructor(){super(),this._continue=!1}setContinue(){this._continue=!0}get continueFlag(){return this._continue}get flags(){return{continueFlag:this.continueFlag,mutatedFlag:this.mutatedFlag}}set flags({continueFlag:t,mutatedFlag:n}){t&&this.setContinue(),n&&this.setMutated()}reset(){}optimizeNextFromLeaves(t){if(Sk(t))return!1;const n=t.parent,{continueFlag:r}=this.run(t);return r&&this.optimizeNextFromLeaves(n),this.mutatedFlag}}class bA extends AR{}function eW(e,t,n,r){const i=yu(r)?r.encoding[bv(t)]:void 0;if(Sp(n)&&yu(r)&&yO(t,n,i,r.stack,r.markDef,r.config))e.add(ti(n,{})),e.add(ti(n,{suffix:"end"})),n.bin&&cx(n,t)&&e.add(ti(n,{binSuffix:"range"}));else if(function(s){return s in J3}(t)){const s=function(f){switch(f){case mv:return"y";case lg:return"y2";case gv:return"x";case pm:return"x2"}}(t);e.add(r.getName(s))}else e.add(ti(n));return e}class pg extends as{constructor(t,n,r){super(t),this.dimensions=n,this.measures=r}clone(){return new pg(null,new Set(this.dimensions),$a(this.measures))}get groupBy(){return this.dimensions}static makeFromEncoding(t,n){let r=!1;n.forEachFieldDef(f=>{f.aggregate&&(r=!0)});const i={},s=new Set;return r?(n.forEachFieldDef((f,m)=>{var x,O,T,M;const{aggregate:q,field:Q}=f;if(q)if(q==="count")i["*"]=(x=i["*"])!==null&&x!==void 0?x:{},i["*"].count=new Set([ti(f,{forAs:!0})]);else{if(V0(q)||Fy(q)){const se=V0(q)?"argmin":"argmax",le=q[se];i[le]=(O=i[le])!==null&&O!==void 0?O:{},i[le][se]=new Set([ti({op:se,field:le},{forAs:!0})])}else i[Q]=(T=i[Q])!==null&&T!==void 0?T:{},i[Q][q]=new Set([ti(f,{forAs:!0})]);Y0(m)&&n.scaleDomain(m)==="unaggregated"&&(i[Q]=(M=i[Q])!==null&&M!==void 0?M:{},i[Q].min=new Set([ti({field:Q,aggregate:"min"},{forAs:!0})]),i[Q].max=new Set([ti({field:Q,aggregate:"max"},{forAs:!0})]))}else eW(s,m,f,n)}),s.size+Kr(i).length===0?null:new pg(t,s,i)):null}static makeFromTransform(t,n){var r,i,s;const f=new Set,m={};for(const x of n.aggregate){const{op:O,field:T,as:M}=x;O&&(O==="count"?(m["*"]=(r=m["*"])!==null&&r!==void 0?r:{},m["*"].count=new Set([M||ti(x,{forAs:!0})])):(m[T]=(i=m[T])!==null&&i!==void 0?i:{},m[T][O]=new Set([M||ti(x,{forAs:!0})])))}for(const x of(s=n.groupby)!==null&&s!==void 0?s:[])f.add(x);return f.size+Kr(m).length===0?null:new pg(t,f,m)}merge(t){return function(n,r){if(n.size!==r.size)return!1;for(const i of n)if(!r.has(i))return!1;return!0}(this.dimensions,t.dimensions)?(function(n,r){var i;for(const s of Kr(r)){const f=r[s];for(const m of Kr(f))s in n?n[s][m]=new Set([...(i=n[s][m])!==null&&i!==void 0?i:[],...f[m]]):n[s]={[m]:f[m]}}}(this.measures,t.measures),!0):(function(...n){Gw.debug(...n)}("different dimensions, cannot merge"),!1)}addDimensions(t){t.forEach(this.dimensions.add,this.dimensions)}dependentFields(){return new Set([...this.dimensions,...Kr(this.measures)])}producedFields(){const t=new Set;for(const n of Kr(this.measures))for(const r of Kr(this.measures[n])){const i=this.measures[n][r];i.size===0?t.add(`${r}_${n}`):i.forEach(t.add,t)}return t}hash(){return`Aggregate ${ko({dimensions:this.dimensions,measures:this.measures})}`}assemble(){const t=[],n=[],r=[];for(const i of Kr(this.measures))for(const s of Kr(this.measures[i]))for(const f of this.measures[i][s])r.push(f),t.push(s),n.push(i==="*"?null:W0(i));return{type:"aggregate",groupby:[...this.dimensions].map(W0),ops:t,fields:n,as:r}}}class Lb extends as{constructor(t,n,r,i){super(t),this.model=n,this.name=r,this.data=i;for(const s of mm){const f=n.facet[s];if(f){const{bin:m,sort:x}=f;this[s]=Object.assign({name:n.getName(`${s}_domain`),fields:[ti(f),...Ns(m)?[ti(f,{binSuffix:"end"})]:[]]},Ev(x)?{sortField:x}:Gi(x)?{sortIndexField:jb(f,s)}:{})}}this.childModel=n.child}hash(){let t="Facet";for(const n of mm)this[n]&&(t+=` ${n.charAt(0)}:${ko(this[n])}`);return t}get fields(){var t;const n=[];for(const r of mm)!((t=this[r])===null||t===void 0)&&t.fields&&n.push(...this[r].fields);return n}dependentFields(){const t=new Set(this.fields);for(const n of mm)this[n]&&(this[n].sortField&&t.add(this[n].sortField.field),this[n].sortIndexField&&t.add(this[n].sortIndexField));return t}producedFields(){return new Set}getSource(){return this.name}getChildIndependentFieldsWithStep(){const t={};for(const n of gm){const r=this.childModel.component.scales[n];if(r&&!r.merged){const i=r.get("type"),s=r.get("range");if(Ad(i)&&J0(s)){const f=OA(Tk(this.childModel,n));f?t[n]=f:Gr(`Unknown field for ${n}. Cannot calculate view size.`)}}}return t}assembleRowColumnHeaderData(t,n,r){const i={row:"y",column:"x"}[t],s=[],f=[],m=[];r&&r[i]&&(n?(s.push(`distinct_${r[i]}`),f.push("max")):(s.push(r[i]),f.push("distinct")),m.push(`distinct_${r[i]}`));const{sortField:x,sortIndexField:O}=this[t];if(x){const{op:T=Jw,field:M}=x;s.push(M),f.push(T),m.push(ti(x,{forAs:!0}))}else O&&(s.push(O),f.push("max"),m.push(O));return{name:this[t].name,source:n??this.data,transform:[Object.assign({type:"aggregate",groupby:this[t].fields},s.length?{fields:s,ops:f,as:m}:{})]}}assembleFacetHeaderData(t){var n,r;const{columns:i}=this.model.layout,{layoutHeaders:s}=this.model.component,f=[],m={};for(const T of fA){for(const M of hA){const q=(n=s[T]&&s[T][M])!==null&&n!==void 0?n:[];for(const Q of q)if(((r=Q.axes)===null||r===void 0?void 0:r.length)>0){m[T]=!0;break}}if(m[T]){const M=`length(data("${this.facet.name}"))`,q=T==="row"?i?{signal:`ceil(${M} / ${i})`}:1:i?{signal:`min(${M}, ${i})`}:{signal:M};f.push({name:`${this.facet.name}_${T}`,transform:[{type:"sequence",start:0,stop:q}]})}}const{row:x,column:O}=m;return(x||O)&&f.unshift(this.assembleRowColumnHeaderData("facet",null,t)),f}assemble(){var t,n;const r=[];let i=null;const s=this.getChildIndependentFieldsWithStep(),{column:f,row:m,facet:x}=this;if(f&&m&&(s.x||s.y)){i=`cross_${this.column.name}_${this.row.name}`;const O=[].concat((t=s.x)!==null&&t!==void 0?t:[],(n=s.y)!==null&&n!==void 0?n:[]),T=O.map(()=>"distinct");r.push({name:i,source:this.data,transform:[{type:"aggregate",groupby:this.fields,fields:O,ops:T}]})}for(const O of[i0,r0])this[O]&&r.push(this.assembleRowColumnHeaderData(O,i,s));if(x){const O=this.assembleFacetHeaderData(s);O&&r.push(...O)}return r}}function _R(e){return e[0]==="'"&&e[e.length-1]==="'"||e[0]==='"'&&e[e.length-1]==='"'?e.slice(1,-1):e}function tW(e){const t={};return function n(r,i){if(V3(r))n(r.not,i);else if(W3(r))for(const s of r.and)n(s,i);else if(U3(r))for(const s of r.or)n(s,i);else i(r)}(e.filter,n=>{var r;if(LN(n)){let i=null;oO(n)?i=n.equal:sO(n)?i=n.range[0]:uO(n)&&(i=((r=n.oneOf)!==null&&r!==void 0?r:n.in)[0]),i&&(_b(i)?t[n.field]="date":Ju(i)?t[n.field]="number":Ha(i)&&(t[n.field]="string")),n.timeUnit&&(t[n.field]="date")}}),t}function nW(e){const t={};function n(r){rk(r)?t[r.field]="date":r.type==="quantitative"&&function(i){return Ha(i)&&Ji(["min","max"],i)}(r.aggregate)?t[r.field]="number":ex(r.field)>1?r.field in t||(t[r.field]="flatten"):kO(r)&&Ev(r.sort)&&ex(r.sort.field)>1&&(r.sort.field in t||(t[r.sort.field]="flatten"))}if((yu(e)||gg(e))&&e.forEachFieldDef((r,i)=>{if(Sp(r))n(r);else{const s=jy(i),f=e.fieldDef(s);n(Object.assign(Object.assign({},r),{type:f.type}))}}),yu(e)){const{mark:r,markDef:i,encoding:s}=e;if(Iy(r)&&!e.encoding.order){const f=s[i.orient==="horizontal"?"y":"x"];!si(f)||f.type!=="quantitative"||f.field in t||(t[f.field]="number")}}return t}class gf extends as{constructor(t,n){super(t),this._parse=n}clone(){return new gf(null,$a(this._parse))}hash(){return`Parse ${ko(this._parse)}`}static makeExplicit(t,n,r){let i={};const s=n.data;return!Hy(s)&&s&&s.format&&s.format.parse&&(i=s.format.parse),this.makeWithAncestors(t,i,{},r)}static makeWithAncestors(t,n,r,i){for(const m of Kr(r)){const x=i.getWithExplicit(m);x.value!==void 0&&(x.explicit||x.value===r[m]||x.value==="derived"||r[m]==="flatten"?delete r[m]:Gr(he.differentParse(m,r[m],x.value)))}for(const m of Kr(n)){const x=i.get(m);x!==void 0&&(x===n[m]?delete n[m]:Gr(he.differentParse(m,n[m],x)))}const s=new f0(n,r);i.copyAll(s);const f={};for(const m of Kr(s.combine())){const x=s.get(m);x!==null&&(f[m]=x)}return Kr(f).length===0||i.parseNothing?null:new gf(t,f)}get parse(){return this._parse}merge(t){this._parse=Object.assign(Object.assign({},this._parse),t.parse),t.remove()}assembleFormatParse(){const t={};for(const n of Kr(this._parse)){const r=this._parse[n];ex(n)===1&&(t[n]=r)}return t}producedFields(){return new Set(Kr(this._parse))}dependentFields(){return new Set(Kr(this._parse))}assembleTransforms(t=!1){return Kr(this._parse).filter(n=>!t||ex(n)>1).map(n=>{const r=function(i,s){const f=aN(i);return s==="number"?`toNumber(${f})`:s==="boolean"?`toBoolean(${f})`:s==="string"?`toString(${f})`:s==="date"?`toDate(${f})`:s==="flatten"?f:s.indexOf("date:")===0?`timeParse(${f},'${_R(s.slice(5,s.length))}')`:s.indexOf("utc:")===0?`utcParse(${f},'${_R(s.slice(4,s.length))}')`:(Gr(he.unrecognizedParse(s)),null)}(n,this._parse[n]);return r?{type:"formula",expr:r,as:oN(n)}:null}).filter(n=>n!==null)}}class oy extends as{clone(){return new oy(null)}constructor(t){super(t)}dependentFields(){return new Set}producedFields(){return new Set([Nb])}hash(){return"Identifier"}assemble(){return{type:"identifier",as:Nb}}}class Jy extends as{constructor(t,n){super(t),this.transform=n}clone(){return new Jy(null,$a(this.transform))}addDimensions(t){this.transform.groupby=z0(this.transform.groupby.concat(t),n=>n)}dependentFields(){const t=new Set;return this.transform.groupby&&this.transform.groupby.forEach(t.add,t),this.transform.joinaggregate.map(n=>n.field).filter(n=>n!==void 0).forEach(t.add,t),t}producedFields(){return new Set(this.transform.joinaggregate.map(this.getDefaultName))}getDefaultName(t){var n;return(n=t.as)!==null&&n!==void 0?n:ti(t)}hash(){return`JoinAggregateTransform ${ko(this.transform)}`}assemble(){const t=[],n=[],r=[];for(const s of this.transform.joinaggregate)n.push(s.op),r.push(this.getDefaultName(s)),t.push(s.field===void 0?null:s.field);const i=this.transform.groupby;return Object.assign({type:"joinaggregate",as:r,ops:n,fields:t},i!==void 0?{groupby:i}:{})}}class g0 extends as{constructor(t,n){super(t),this._stack=n}clone(){return new g0(null,$a(this._stack))}static makeFromTransform(t,n){const{stack:r,groupby:i,as:s,offset:f="zero"}=n,m=[],x=[];if(n.sort!==void 0)for(const M of n.sort)m.push(M.field),x.push(Qu(M.order,"ascending"));const O={field:m,order:x};let T;return T=function(M){return Gi(M)&&M.every(q=>Ha(q))&&M.length>1}(s)?s:Ha(s)?[s,s+"_end"]:[n.stack+"_start",n.stack+"_end"],new g0(t,{stackField:r,groupby:i,offset:f,sort:O,facetby:[],as:T})}static makeFromEncoding(t,n){const r=n.stack,{encoding:i}=n;if(!r)return null;const{groupbyChannel:s,fieldChannel:f,offset:m,impute:x}=r;let O;s&&(O=Ov(i[s]));const T=function(Q){return Q.stack.stackBy.reduce((se,le)=>{const Fe=ti(le.fieldDef);return Fe&&se.push(Fe),se},[])}(n),M=n.encoding.order;let q;return q=Gi(M)||si(M)?EI(M):T.reduce((Q,se)=>(Q.field.push(se),Q.order.push(f==="y"?"descending":"ascending"),Q),{field:[],order:[]}),new g0(t,{dimensionFieldDef:O,stackField:n.vgField(f),facetby:[],stackby:T,sort:q,offset:m,impute:x,as:[n.vgField(f,{suffix:"start",forAs:!0}),n.vgField(f,{suffix:"end",forAs:!0})]})}get stack(){return this._stack}addDimensions(t){this._stack.facetby.push(...t)}dependentFields(){const t=new Set;return t.add(this._stack.stackField),this.getGroupbyFields().forEach(t.add,t),this._stack.facetby.forEach(t.add,t),this._stack.sort.field.forEach(t.add,t),t}producedFields(){return new Set(this._stack.as)}hash(){return`Stack ${ko(this._stack)}`}getGroupbyFields(){const{dimensionFieldDef:t,impute:n,groupby:r}=this._stack;return t?t.bin?n?[ti(t,{binSuffix:"mid"})]:[ti(t,{}),ti(t,{binSuffix:"end"})]:[ti(t)]:r??[]}assemble(){const t=[],{facetby:n,dimensionFieldDef:r,stackField:i,stackby:s,sort:f,offset:m,impute:x,as:O}=this._stack;if(x&&r){const{band:T=.5,bin:M}=r;M&&t.push({type:"formula",expr:`${T}*`+ti(r,{expr:"datum"})+`+${1-T}*`+ti(r,{expr:"datum",binSuffix:"end"}),as:ti(r,{binSuffix:"mid",forAs:!0})}),t.push({type:"impute",field:i,groupby:[...s,...n],key:ti(r,{binSuffix:"mid"}),method:"value",value:0})}return t.push({type:"stack",groupby:[...this.getGroupbyFields(),...n],field:i,sort:f,as:O,offset:m}),t}}class zb extends as{constructor(t,n){super(t),this.transform=n}clone(){return new zb(null,$a(this.transform))}addDimensions(t){this.transform.groupby=z0(this.transform.groupby.concat(t),n=>n)}dependentFields(){var t,n;const r=new Set;return((t=this.transform.groupby)!==null&&t!==void 0?t:[]).forEach(r.add,r),((n=this.transform.sort)!==null&&n!==void 0?n:[]).forEach(i=>r.add(i.field)),this.transform.window.map(i=>i.field).filter(i=>i!==void 0).forEach(r.add,r),r}producedFields(){return new Set(this.transform.window.map(this.getDefaultName))}getDefaultName(t){var n;return(n=t.as)!==null&&n!==void 0?n:ti(t)}hash(){return`WindowTransform ${ko(this.transform)}`}assemble(){var t;const n=[],r=[],i=[],s=[];for(const q of this.transform.window)r.push(q.op),i.push(this.getDefaultName(q)),s.push(q.param===void 0?null:q.param),n.push(q.field===void 0?null:q.field);const f=this.transform.frame,m=this.transform.groupby;if(f&&f[0]===null&&f[1]===null&&r.every(q=>Y3(q)))return Object.assign({type:"joinaggregate",as:i,ops:r,fields:n},m!==void 0?{groupby:m}:{});const x=[],O=[];if(this.transform.sort!==void 0)for(const q of this.transform.sort)x.push(q.field),O.push((t=q.order)!==null&&t!==void 0?t:"ascending");const T={field:x,order:O},M=this.transform.ignorePeers;return Object.assign(Object.assign(Object.assign({type:"window",params:s,as:i,ops:r,fields:n,sort:T},M!==void 0?{ignorePeers:M}:{}),m!==void 0?{groupby:m}:{}),f!==void 0?{frame:f}:{})}}class rW extends m0{run(t){const n=t.parent;if(t instanceof gf){if(Sk(n))return this.flags;if(n.numChildren()>1)return this.setContinue(),this.flags;if(n instanceof gf)this.setMutated(),n.merge(t);else{if(rN(n.producedFields(),t.dependentFields()))return this.setContinue(),this.flags;this.setMutated(),t.swapWithParent()}}return this.setContinue(),this.flags}}class iW extends bA{mergeNodes(t,n){const r=n.shift();for(const i of n)t.removeChild(i),i.parent=r,i.remove()}run(t){const n=t.children.map(i=>i.hash()),r={};for(let i=0;i<n.length;i++)r[n[i]]===void 0?r[n[i]]=[t.children[i]]:r[n[i]].push(t.children[i]);for(const i of Kr(r))r[i].length>1&&(this.setMutated(),this.mergeNodes(t,r[i]));for(const i of t.children)this.run(i);return this.mutatedFlag}}class aW extends m0{run(t){return t instanceof wh||t.numChildren()>0||t instanceof Lb?this.flags:(this.setMutated(),t.remove(),this.flags)}}class oW extends m0{constructor(){super(...arguments),this.fields=new Set,this.prev=null}run(t){if(this.setContinue(),t instanceof _v){const n=t.producedFields();tN(n,this.fields)?(this.setMutated(),this.prev.remove()):this.fields=new Set([...this.fields,...n]),this.prev=t}return this.flags}reset(){this.fields.clear()}}class sW extends m0{run(t){this.setContinue();const n=t.parent.children.filter(i=>i instanceof _v),r=n.pop();for(const i of n)this.setMutated(),r.merge(i);return this.flags}}function xA(e){if(e instanceof Lb)if(e.numChildren()!==1||e.children[0]instanceof wh){const t=e.model.component.data.main;(function i(s){if(s instanceof wh&&s.type===ff&&s.numChildren()===1){const f=s.children[0];f instanceof Lb||(f.swapWithParent(),i(s))}})(t);const n=function(i){return function s(f){if(!(f instanceof Lb)){const m=f.clone();if(m instanceof wh){const x=wA+m.getSource();m.setSource(x),i.model.component.data.outputNodes[x]=m}else(m instanceof pg||m instanceof g0||m instanceof zb||m instanceof Jy)&&m.addDimensions(i.fields);for(const x of f.children.flatMap(s))x.parent=m;return[m]}return f.children.flatMap(s)}}(e),r=e.children.map(n).flat();for(const i of r)i.parent=t}else{const t=e.children[0];(t instanceof pg||t instanceof g0||t instanceof zb||t instanceof Jy)&&t.addDimensions(e.fields),t.swapWithParent(),xA(e)}else e.children.map(xA)}class uW extends bA{constructor(){super()}run(t){t instanceof wh&&!t.isRequired()&&(this.setMutated(),t.remove());for(const n of t.children)this.run(n);return this.mutatedFlag}}class cW extends bA{constructor(t){super(),this.requiresSelectionId=t&&QO(t)}run(t){t instanceof oy&&(this.requiresSelectionId&&(Sk(t.parent)||t.parent instanceof pg||t.parent instanceof gf)||(this.setMutated(),t.remove()));for(const n of t.children)this.run(n);return this.mutatedFlag}}class lW extends m0{run(t){const n=t.parent,r=[...n.children],i=n.children.filter(s=>s instanceof gf);if(n.numChildren()>1&&i.length>=1){const s={},f=new Set;for(const m of i){const x=m.parse;for(const O of Kr(x))O in s?s[O]!==x[O]&&f.add(O):s[O]=x[O]}for(const m of f)delete s[m];if(!ms(s)){this.setMutated();const m=new gf(n,s);for(const x of r){if(x instanceof gf)for(const O of Kr(s))delete x.parse[O];n.removeChild(x),x.parent=m,x instanceof gf&&Kr(x.parse).length===0&&x.remove()}}}return this.setContinue(),this.flags}}class fW extends m0{run(t){const n=t.parent,r=n.children.filter(s=>s instanceof pg),i={};for(const s of r){const f=ko(s.groupBy);f in i||(i[f]=[]),i[f].push(s)}for(const s of Kr(i)){const f=i[s];if(f.length>1){const m=f.pop();for(const x of f)m.merge(x)&&(n.removeChild(x),x.parent=m,x.remove(),this.setMutated())}}return this.setContinue(),this.flags}}class hW extends m0{constructor(t){super(),this.model=t}run(t){const n=t.parent,r=!(Sk(n)||n instanceof Rb||n instanceof gf||n instanceof oy),i=[],s=[];for(const f of n.children)f instanceof Dv&&(r&&!rN(n.producedFields(),f.dependentFields())?i.push(f):s.push(f));if(i.length>0){const f=i.pop();for(const m of i)f.merge(m,this.model.renameSignal.bind(this.model));this.setMutated(),n instanceof Dv?n.merge(f,this.model.renameSignal.bind(this.model)):f.swapWithParent()}if(s.length>1){const f=s.pop();for(const m of s)f.merge(m,this.model.renameSignal.bind(this.model));this.setMutated()}return this.setContinue(),this.flags}}class dW extends m0{run(t){const n=t.parent,r=[...n.children];if(!Q1(r,f=>f instanceof wh)||n.numChildren()<=1)return this.setContinue(),this.flags;const i=[];let s;for(const f of r)if(f instanceof wh){let m=f;for(;m.numChildren()===1;){const x=m.children[0];if(!(x instanceof wh))break;m=x}i.push(...m.children),s?(n.removeChild(f),f.parent=s.parent,s.parent.removeChild(s),s.parent=m,this.setMutated()):s=m}else i.push(f);if(i.length){this.setMutated();for(const f of i)f.parent.removeChild(f),f.parent=s}return this.setContinue(),this.flags}}const wA="scale_",Dk=5;function sy(e){const t=[];function n(r){if(r.numChildren()===0)t.push(r);else for(const i of r.children)n(i)}for(const r of e)n(r);return t}function pW(e){return e}function mg(e,t){return t.map(n=>{if(e instanceof m0){const r=e.optimizeNextFromLeaves(n);return e.reset(),r}return e.run(n)}).some(pW)}function SR(e,t){let n=e.sources;const r=new Set;return r.add(mg(new uW,n)),r.add(mg(new cW(t),n)),n=n.filter(i=>i.numChildren()>0),r.add(mg(new aW,sy(n))),n=n.filter(i=>i.numChildren()>0),r.add(mg(new rW,sy(n))),r.add(mg(new hW(t),sy(n))),r.add(mg(new oW,sy(n))),r.add(mg(new lW,sy(n))),r.add(mg(new fW,sy(n))),r.add(mg(new sW,sy(n))),r.add(mg(new iW,n)),r.add(mg(new dW,sy(n))),e.sources=n,r.has(!0)}class Dp{constructor(t){Object.defineProperty(this,"signal",{enumerable:!0,get:t})}static fromName(t,n){return new Dp(()=>t(n))}}function DR(e){yu(e)?function(t){const n=t.component.scales;for(const r of Kr(n)){const i=mW(t,r);if(n[r].setWithExplicit("domains",i),gW(t,r),t.component.data.isFaceted){let f=t;for(;!gg(f)&&f.parent;)f=f.parent;if(f.component.resolve.scale[r]==="shared")for(const x of i.value)Q0(x)&&(x.data=wA+x.data.replace(wA,""))}}}(e):function(t){for(const r of t.children)DR(r);const n=t.component.scales;for(const r of Kr(n)){let i,s=null;for(const f of t.children){const m=f.component.scales[r];if(m){i=i===void 0?m.getWithExplicit("domains"):ny(i,m.getWithExplicit("domains"),"domains","scale",CA);const x=m.get("selectionExtent");s&&x&&s.selection!==x.selection&&Gr("The same selection must be used to override scale domains in a layered view."),s=x}}n[r].setWithExplicit("domains",i),s&&n[r].set("selectionExtent",s,!0)}}(e)}function mW(e,t){const n=e.getScaleComponent(t).get("type"),{encoding:r}=e,i=function(s,f,m,x){if(s==="unaggregated"){const{valid:O,reason:T}=TR(f,m);if(!O)return void Gr(T)}else if(s===void 0&&x.useUnaggregatedDomain){const{valid:O}=TR(f,m);if(O)return"unaggregated"}return s}(e.scaleDomain(t),e.typedFieldDef(t),n,e.config.scale);return i!==e.scaleDomain(t)&&(e.specifiedScales[t]=Object.assign(Object.assign({},e.specifiedScales[t]),{domain:i})),t==="x"&&yc(r.x2)?yc(r.x)?ny(uy(n,i,e,"x"),uy(n,i,e,"x2"),"domain","scale",CA):uy(n,i,e,"x2"):t==="y"&&yc(r.y2)?yc(r.y)?ny(uy(n,i,e,"y"),uy(n,i,e,"y2"),"domain","scale",CA):uy(n,i,e,"y2"):uy(n,i,e,t)}function kA(e,t,n){var r;const i=(r=xh(n))===null||r===void 0?void 0:r.unit;return t==="temporal"||i?function(s,f,m){return s.map(x=>({signal:`{data: ${AO(x,{timeUnit:m,type:f})}}`}))}(e,t,i):[e]}function uy(e,t,n,r){const{encoding:i}=n,s=yc(i[r]),{type:f}=s,m=s.timeUnit;if(function(M){return M&&M.unionWith}(t)){const M=uy(e,void 0,n,r),q=kA(t.unionWith,f,m);return qy([...M.value,...q])}if(da(t))return qy([t]);if(t&&t!=="unaggregated"&&!VN(t))return qy(kA(t,f,m));const x=n.stack;if(x&&r===x.fieldChannel){if(x.offset==="normalize")return hg([[0,1]]);const M=n.requestDataName(ff);return hg([{data:M,field:n.vgField(r,{suffix:"start"})},{data:M,field:n.vgField(r,{suffix:"end"})}])}const O=Y0(r)&&si(s)?function(M,q,Q){if(!Ad(Q))return;const se=M.fieldDef(q),le=se.sort;if(oI(le))return{op:"min",field:jb(se,q),order:"ascending"};const{stack:Fe}=M,Le=Fe?[...Fe.groupbyField?[Fe.groupbyField]:[],...Fe.stackBy.map(ze=>ze.fieldDef.field)]:void 0;if(Ev(le)){const ze=Fe&&!Ji(Le,le.field);return EA(le,ze)}if(aI(le)){const{encoding:ze,order:nt}=le,it=M.fieldDef(ze),{aggregate:ut,field:st}=it,pt=Fe&&!Ji(Le,st);if(V0(ut)||Fy(ut))return EA({field:ti(it),order:nt},pt);if(Y3(ut)||!ut)return EA({op:ut,field:st,order:nt},pt)}else{if(le==="descending")return{op:"min",field:M.vgField(q),order:"descending"};if(Ji(["ascending",void 0],le))return!0}}(n,r,e):void 0;if(ey(s))return hg(kA([s.datum],f,m));const T=s;if(t==="unaggregated"){const M=n.requestDataName(ff),{field:q}=s;return hg([{data:M,field:ti({field:q,aggregate:"min"})},{data:M,field:ti({field:q,aggregate:"max"})}])}if(Ns(T.bin)){if(Ad(e))return hg(e==="bin-ordinal"?[]:[{data:_w(O)?n.requestDataName(ff):n.requestDataName(hk),field:n.vgField(r,cx(T,r)?{binSuffix:"range"}:{}),sort:O!==!0&&Uc(O)?O:{field:n.vgField(r,{}),op:"min"}}]);{const{bin:M}=T;if(Ns(M)){const q=vA(n,T.field,M);return hg([new Dp(()=>{const Q=n.getSignalName(q);return`[${Q}.start, ${Q}.stop]`})])}return hg([{data:n.requestDataName(ff),field:n.vgField(r,{})}])}}if(T.timeUnit&&Ji(["time","utc"],e)&&yO(r,T,yu(n)?n.encoding[bv(r)]:void 0,n.stack,n.markDef,n.config)){const M=n.requestDataName(ff);return hg([{data:M,field:n.vgField(r)},{data:M,field:n.vgField(r,{suffix:"end"})}])}return hg(O?[{data:_w(O)?n.requestDataName(ff):n.requestDataName(hk),field:n.vgField(r),sort:O}]:[{data:n.requestDataName(ff),field:n.vgField(r)}])}function EA(e,t){const{op:n,field:r,order:i}=e;return Object.assign(Object.assign({op:n??(t?"sum":Jw)},r?{field:W0(r)}:{}),i?{order:i}:{})}function gW(e,t){var n;const r=e.component.scales[t],i=e.specifiedScales[t].domain,s=(n=e.fieldDef(t))===null||n===void 0?void 0:n.bin,f=VN(i)&&i,m=ix(s)&&$w(s.extent)&&s.extent;(f||m)&&r.set("selectionExtent",f??m,!0)}function TR(e,t){const{aggregate:n,type:r}=e;return n?Ha(n)&&!q7[n]?{valid:!1,reason:he.unaggregateDomainWithNonSharedDomainOp(n)}:r==="quantitative"&&t==="log"?{valid:!1,reason:he.unaggregatedDomainWithLogScale(e)}:{valid:!0}:{valid:!1,reason:he.unaggregateDomainHasNoEffectForRawField(e)}}function CA(e,t,n,r){return e.explicit&&t.explicit&&Gr(he.mergeConflictingDomainProperty(n,r,e.value,t.value)),{explicit:e.explicit,value:[...e.value,...t.value]}}function OA(e){if(Q0(e)&&Ha(e.field))return e.field;if(function(t){return!Gi(t)&&"fields"in t&&!("data"in t)}(e)){let t;for(const n of e.fields)if(Q0(n)&&Ha(n.field))if(t){if(t!==n.field)return Gr(he.FACETED_INDEPENDENT_DIFFERENT_SOURCES),t}else t=n.field;return Gr(he.FACETED_INDEPENDENT_SAME_FIELDS_DIFFERENT_SOURCES),t}if(function(t){return!Gi(t)&&"fields"in t&&"data"in t}(e)){Gr(he.FACETED_INDEPENDENT_SAME_SOURCE);const t=e.fields[0];return Ha(t)?t:void 0}}function Tk(e,t){return function(n){const r=z0(n.map(x=>{if(Q0(x)){const{sort:O}=x;return Pi(x,["sort"])}return x}),ko),i=z0(n.map(x=>{if(Q0(x)){const O=x.sort;return O===void 0||_w(O)||("op"in O&&O.op==="count"&&delete O.field,O.order==="ascending"&&delete O.order),O}}).filter(x=>x!==void 0),ko);if(r.length===0)return;if(r.length===1){const x=n[0];if(Q0(x)&&i.length>0){let O=i[0];if(i.length>1)Gr(he.MORE_THAN_ONE_SORT),O=!0;else if(Uc(O)&&"field"in O){const T=O.field;x.field===T&&(O=!O.order||{order:O.order})}return Object.assign(Object.assign({},x),{sort:O})}return x}const s=z0(i.map(x=>_w(x)||!("op"in x)||x.op in U7?x:(Gr(he.domainSortDropped(x)),!0)),ko);let f;s.length===1?f=s[0]:s.length>1&&(Gr(he.MORE_THAN_ONE_SORT),f=!0);const m=z0(n.map(x=>Q0(x)?x.data:null),x=>x);return m.length===1&&m[0]!==null?Object.assign({data:m[0],fields:r.map(x=>x.field)},f?{sort:f}:{}):Object.assign({fields:r},f?{sort:f}:{})}(e.component.scales[t].get("domains").map(n=>(Q0(n)&&(n.data=e.lookupDataSource(n.data)),n)))}function NR(e){return Kr(e.component.scales).reduce((t,n)=>{const r=e.component.scales[n];if(r.merged)return t;const i=r.combine(),{name:s,type:f,selectionExtent:m,domains:x,range:O,reverse:T}=i,M=Pi(i,["name","type","selectionExtent","domains","range","reverse"]),q=function(le,Fe,Le){return wv(Le)&&J0(le)?{step:{signal:Fe+"_step"}}:le}(i.range,s,n);let Q;m&&(Q=function(le,Fe){const Le=Fe.selection;return{signal:KF(le.getSelectionComponent(Le,Qs(Le)),Fe)}}(e,m));const se=Tk(e,n);return t.push(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:s,type:f},se?{domain:se}:{}),Q?{domainRaw:Q}:{}),{range:q}),T!==void 0?{reverse:T}:{}),M)),t},[])}class IR extends f0{constructor(t,n){super({},{name:t}),this.merged=!1,this.setWithExplicit("type",n)}domainDefinitelyIncludesZero(){return this.get("zero")!==!1||Q1(this.get("domains"),t=>Gi(t)&&t.length===2&&t[0]<=0&&t[1]>=0)}}const vW=["range","scheme"];function FR(e){return e==="x"?"width":e==="y"?"height":void 0}function RR(e,t){const n=e.fieldDef(t);if(n&&n.bin&&Ns(n.bin)){const r=vA(e,n.field,n.bin),i=FR(t),s=e.getName(i);return new Dp(()=>{const f=e.getSignalName(r),m=`(${f}.stop - ${f}.start) / ${f}.step`;return`${e.getSignalName(s)} / (${m})`})}}function yW(e,t){const n=t.specifiedScales[e],{size:r}=t,i=t.getScaleComponent(e).get("type");for(const s of vW)if(n[s]!==void 0){const f=HN(i,s),m=$N(e,s);if(f)if(m)Gr(m);else switch(s){case"range":return Gi(n.range)&&wv(e)?qy(n.range.map(x=>{if(x==="width"||x==="height"){const O=t.getName(x),T=t.getSignalName.bind(t);return Dp.fromName(T,O)}return x})):qy(n.range);case"scheme":return qy(bW(n[s]))}else Gr(he.scalePropertyNotWorkWithScaleType(i,s,e))}if(e===ou||e===vc){const s=e===ou?"width":"height",f=r[s];if(Av(f)){if(Ad(i))return qy({step:f.step});Gr(he.stepDropped(s))}}return hg(function(s,f){const{size:m,config:x,mark:O,encoding:T}=f,M=f.getSignalName.bind(f),{type:q}=yc(T[s]),Q=f.getScaleComponent(s).get("type"),{domain:se,domainMid:le}=f.specifiedScales[s];switch(s){case ou:case vc:{if(Ji(["point","band"],Q))if(s!==ou||m.width){if(s===vc&&!m.height){const ze=fx(x.view,"height");if(Av(ze))return ze}}else{const ze=fx(x.view,"width");if(Av(ze))return ze}const Fe=FR(s),Le=f.getName(Fe);return s===vc&&vm(Q)?[Dp.fromName(M,Le),0]:[0,Dp.fromName(M,Le)]}case s0:{const Fe=f.component.scales[s].get("zero"),Le=function nt(it,ut,st){if(ut)return da(ut)?{signal:`${ut.signal} ? 0 : ${nt(it,!1,st)}`}:0;switch(it){case"bar":case"tick":return st.scale.minBandSize;case"line":case"trail":case"rule":return st.scale.minStrokeWidth;case"text":return st.scale.minFontSize;case"point":case"square":case"circle":return st.scale.minSize}throw new Error(he.incompatibleChannel("size",it))}(O,Fe,x),ze=function(nt,it,ut,st){const pt={x:RR(ut,"x"),y:RR(ut,"y")};switch(nt){case"bar":case"tick":{if(st.scale.maxBandSize!==void 0)return st.scale.maxBandSize;const dt=jR(it,pt,st.view);return Ju(dt)?dt-1:new Dp(()=>`${dt.signal} - 1`)}case"line":case"trail":case"rule":return st.scale.maxStrokeWidth;case"text":return st.scale.maxFontSize;case"point":case"square":case"circle":{if(st.scale.maxSize)return st.scale.maxSize;const dt=jR(it,pt,st.view);return Ju(dt)?Math.pow(MR*dt,2):new Dp(()=>`pow(${MR} * ${dt.signal}, 2)`)}}throw new Error(he.incompatibleChannel("size",nt))}(O,m,f,x);return Kw(Q)?function(nt,it,ut){const st=()=>{const pt=lx(it),dt=lx(nt),Qt=`(${pt} - ${dt}) / (${ut} - 1)`;return`sequence(${dt}, ${pt} + ${Qt}, ${Qt})`};return da(it)?new Dp(st):{signal:st()}}(Le,ze,function(nt,it,ut,st){switch(nt){case"quantile":return it.scale.quantileCount;case"quantize":return it.scale.quantizeCount;case"threshold":return ut!==void 0&&Gi(ut)?ut.length+1:(Gr(he.domainRequiredForThresholdScale(st)),3)}}(Q,x,se,s)):[Le,ze]}case cg:return[0,2*Math.PI];case Ry:return[0,360];case pv:return[0,new Dp(()=>{const Fe=f.getSignalName("width"),Le=f.getSignalName("height");return`min(${Fe},${Le})/2`})];case $0:return[x.scale.minStrokeWidth,x.scale.maxStrokeWidth];case G0:return[[1,0],[4,2],[2,1],[1,1],[1,2,4,2]];case Od:return"symbol";case Cd:case vv:case yv:return Q==="ordinal"?q==="nominal"?"category":"ordinal":le!==void 0?"diverging":O==="rect"||O==="geoshape"?"heatmap":"ramp";case u0:case q0:case H0:return[x.scale.minOpacity,x.scale.maxOpacity]}throw new Error(`Scale range undefined for channel ${s}`)}(e,t))}function bW(e){return function(t){return!Ha(t)&&!!t.name}(e)?Object.assign({scheme:e.name},t0(e,["name"])):{scheme:e}}const MR=.95;function jR(e,t,n){const r=Av(e.width)?e.width.step:uk(n,"width"),i=Av(e.height)?e.height.step:uk(n,"height");return t.x||t.y?new Dp(()=>`min(${[t.x?t.x.signal:r,t.y?t.y.signal:i].join(", ")})`):Math.min(r,i)}function BR(e,t){yu(e)?function(n,r){const i=n.component.scales,{config:s,encoding:f,markDef:m,specifiedScales:x}=n;for(const O of Kr(i)){const T=x[O],M=i[O],q=n.getScaleComponent(O),Q=yc(f[O]),se=T[r],le=q.get("type"),Fe=q.get("padding"),Le=q.get("paddingInner"),ze=HN(le,r),nt=$N(O,r);if(se!==void 0&&(ze?nt&&Gr(nt):Gr(he.scalePropertyNotWorkWithScaleType(le,r,O))),ze&&nt===void 0)if(se!==void 0)M.copyKeyFromObject(r,T);else{const it=r in PR?PR[r]({model:n,channel:O,fieldOrDatumDef:Q,scaleType:le,scalePadding:Fe,scalePaddingInner:Le,domain:T.domain,markDef:m,config:s}):s.scale[r];it!==void 0&&M.set(r,it,!1)}}}(e,t):zR(e,t)}const PR={bins:({model:e,fieldOrDatumDef:t})=>si(t)?function(n,r){const i=r.bin;if(Ns(i)){const s=vA(n,r.field,i);return new Dp(()=>n.getSignalName(s))}if(bh(i)&&ix(i)&&i.step!==void 0)return{step:i.step}}(e,t):void 0,interpolate:({channel:e,fieldOrDatumDef:t})=>function(n,r){if(Ji([Cd,vv,yv],n)&&r!=="nominal")return"hcl"}(e,t.type),nice:({scaleType:e,channel:t,fieldOrDatumDef:n})=>function(r,i,s){var f;if(!(!((f=Ov(s))===null||f===void 0)&&f.bin||Ji([Zu.TIME,Zu.UTC],r)))return i in X0||void 0}(e,t,n),padding:({channel:e,scaleType:t,fieldOrDatumDef:n,markDef:r,config:i})=>function(s,f,m,x,O,T){if(s in X0){if(fg(f)){if(m.continuousPadding!==void 0)return m.continuousPadding;const{type:M,orient:q}=O;if(M==="bar"&&(!si(x)||!x.bin&&!x.timeUnit)&&(q==="vertical"&&s==="x"||q==="horizontal"&&s==="y"))return T.continuousBandSize}if(f===Zu.POINT)return m.pointPadding}}(e,t,i.scale,n,r,i.bar),paddingInner:({scalePadding:e,channel:t,markDef:n,config:r})=>function(i,s,f,m){if(i===void 0&&s in X0){const{bandPaddingInner:x,barBandPaddingInner:O,rectBandPaddingInner:T}=m;return Qu(x,f==="bar"?O:T)}}(e,t,n.type,r.scale),paddingOuter:({scalePadding:e,channel:t,scaleType:n,markDef:r,scalePaddingInner:i,config:s})=>function(f,m,x,O,T,M){if(f===void 0&&m in X0&&x===Zu.BAND){const{bandPaddingOuter:q}=M;return Qu(q,da(T)?{signal:`${T.signal}/2`}:T/2)}}(e,t,n,r.type,i,s.scale),reverse:({fieldOrDatumDef:e,scaleType:t,channel:n,config:r})=>function(i,s,f,m){if(f==="x"&&m.xReverse!==void 0)return vm(i)&&s==="descending"?da(m.xReverse)?{signal:`!${m.xReverse.signal}`}:!m.xReverse:m.xReverse;if(vm(i)&&s==="descending")return!0}(t,si(e)?e.sort:void 0,n,r.scale),zero:({channel:e,fieldOrDatumDef:t,domain:n,markDef:r,scaleType:i})=>function(s,f,m,x,O){if(m&&m!=="unaggregated"&&vm(O)){if(Gi(m)){const T=m[0],M=m[m.length-1];if(T<=0&&M>=0)return!0}return!1}if(s==="size"&&f.type==="quantitative"&&!Kw(O))return!0;if((!si(f)||!f.bin)&&Ji([...gm,...Y7],s)){const{orient:T,type:M}=x;return!Ji(["bar","area","line","trail"],M)||!(T==="horizontal"&&s==="y"||T==="vertical"&&s==="x")}return!1}(e,t,n,r,i)};function LR(e){yu(e)?function(t){const n=t.component.scales;for(const r of qw){const i=n[r];if(!i)continue;const s=yW(r,t);i.setWithExplicit("range",s)}}(e):zR(e,"range")}function zR(e,t){const n=e.component.scales;for(const r of e.children)t==="range"?LR(r):BR(r,t);for(const r of Kr(n)){let i;for(const s of e.children){const f=s.component.scales[r];f&&(i=ny(i,f.getWithExplicit(t),t,"scale",aF((m,x)=>{switch(t){case"range":return m.step&&x.step?m.step-x.step:0}return 0})))}n[r].setWithExplicit(t,i)}}function xW(e,t,n,r){const i=function(f,m,x){var O;switch(m.type){case"nominal":case"ordinal":if(Ab(f)||Hw(f)==="discrete")return f==="shape"&&m.type==="ordinal"&&Gr(he.discreteChannelCannotEncode(f,"ordinal")),"ordinal";if(f in X0){if(Ji(["rect","bar","image","rule"],x))return"band"}else if(x==="arc"&&f in Z3)return"band";return m.band!==void 0||EO(m)&&(!((O=m.axis)===null||O===void 0)&&O.tickBand)?"band":"point";case"temporal":return Ab(f)?"time":Hw(f)==="discrete"?(Gr(he.discreteChannelCannotEncode(f,"temporal")),"ordinal"):si(m)&&m.timeUnit&&xh(m.timeUnit).utc?"utc":"time";case"quantitative":return Ab(f)?si(m)&&Ns(m.bin)?"bin-ordinal":"linear":Hw(f)==="discrete"?(Gr(he.discreteChannelCannotEncode(f,"quantitative")),"ordinal"):"linear";case"geojson":return}throw new Error(he.invalidFieldType(m.type))}(t,n,r),{type:s}=e;return Y0(t)?s!==void 0?KN(t,s)?si(n)&&!GN(s,n.type)?(Gr(he.scaleTypeNotWorkWithFieldDef(s,i)),i):s:(Gr(he.scaleTypeNotWorkWithChannel(t,s,i)),i):i:null}function UR(e){yu(e)?e.component.scales=function(t){const{encoding:n,mark:r}=t;return qw.reduce((i,s)=>{const f=yc(n[s]);if(f&&r===dN&&s===Od&&f.type===Tb)return i;let m=f&&f.scale;if(f&&m!==null&&m!==!1){const x=xW(m=m??{},s,f,r);i[s]=new IR(t.scaleName(s+"",!0),{value:x,explicit:m.type===x})}return i},{})}(e):e.component.scales=function(t){var n;const r=t.component.scales={},i={},s=t.component.resolve;for(const f of t.children){UR(f);for(const m of Kr(f.component.scales))if(s.scale[m]=(n=s.scale[m])!==null&&n!==void 0?n:qU(m,t),s.scale[m]==="shared"){const x=i[m],O=f.component.scales[m].getWithExplicit("type");x?DL(x.value,O.value)?i[m]=ny(x,O,"type","scale",wW):(s.scale[m]="independent",delete i[m]):i[m]=O}}for(const f of Kr(i)){const m=t.scaleName(f,!0),x=i[f];r[f]=new IR(m,x);for(const O of t.children){const T=O.component.scales[f];T&&(O.renameScale(T.get("name"),m),T.merged=!0)}}return r}(e)}const wW=aF((e,t)=>UN(e)-UN(t));class AA{constructor(){this.nameMap={}}rename(t,n){this.nameMap[t]=n}has(t){return this.nameMap[t]!==void 0}get(t){for(;this.nameMap[t]&&t!==this.nameMap[t];)t=this.nameMap[t];return t}}function yu(e){return e?.type==="unit"}function gg(e){return e?.type==="facet"}function _A(e){return e?.type==="concat"}function Ub(e){return e?.type==="layer"}class SA{constructor(t,n,r,i,s,f,m){var x,O;this.type=n,this.parent=r,this.config=s,this.view=m,this.children=[],this.correctDataNames=T=>(T.from&&T.from.data&&(T.from.data=this.lookupDataSource(T.from.data)),T.from&&T.from.facet&&T.from.facet.data&&(T.from.facet.data=this.lookupDataSource(T.from.facet.data)),T),this.parent=r,this.config=s,this.name=(x=t.name)!==null&&x!==void 0?x:i,this.title=ty(t.title)?{text:t.title}:t.title,this.scaleNameMap=r?r.scaleNameMap:new AA,this.projectionNameMap=r?r.projectionNameMap:new AA,this.signalNameMap=r?r.signalNameMap:new AA,this.data=t.data,this.description=t.description,this.transforms=Dz((O=t.transform)!==null&&O!==void 0?O:[]),this.layout=n==="layer"||n==="unit"?{}:function(T,M,q){var Q,se;const le=q[M],Fe={},{spacing:Le,columns:ze}=le;Le!==void 0&&(Fe.spacing=Le),ze!==void 0&&(Qw(T)&&!sx(T.facet)||BO(T))&&(Fe.columns=ze),sk(T)&&(Fe.columns=1);for(const nt of YL)if(T[nt]!==void 0)if(nt==="spacing"){const it=T[nt];Fe[nt]=Ju(it)?it:{row:(Q=it.row)!==null&&Q!==void 0?Q:Le,column:(se=it.column)!==null&&se!==void 0?se:Le}}else Fe[nt]=T[nt];return Fe}(t,n,s),this.component={data:{sources:r?r.component.data.sources:[],outputNodes:r?r.component.data.outputNodes:{},outputNodeRefCounts:r?r.component.data.outputNodeRefCounts:{},isFaceted:Qw(t)||r&&r.component.data.isFaceted&&t.data===void 0},layoutSize:new f0,layoutHeaders:{row:{},column:{},facet:{}},mark:null,resolve:Object.assign({scale:{},axis:{},legend:{}},f?$a(f):{}),selection:null,scales:null,projection:null,axes:{},legends:{}}}get width(){return this.getSizeSignalRef("width")}get height(){return this.getSizeSignalRef("height")}parse(){this.parseScale(),this.parseLayoutSize(),this.renameTopLevelLayoutSizeSignal(),this.parseSelections(),this.parseProjection(),this.parseData(),this.parseAxesAndHeaders(),this.parseLegends(),this.parseMarkGroup()}parseScale(){(function(t,{ignoreRange:n}={}){UR(t),DR(t);for(const r of BL)BR(t,r);n||LR(t)})(this)}parseProjection(){ER(this)}renameTopLevelLayoutSizeSignal(){this.getName("width")!=="width"&&this.renameSignal(this.getName("width"),"width"),this.getName("height")!=="height"&&this.renameSignal(this.getName("height"),"height")}parseLegends(){vR(this)}assembleGroupStyle(){var t,n;if(this.type==="unit"||this.type==="layer")return(n=(t=this.view)===null||t===void 0?void 0:t.style)!==null&&n!==void 0?n:"cell"}assembleEncodeFromView(t){const{style:n}=t,r=Pi(t,["style"]),i={};for(const s of Kr(r)){const f=r[s];f!==void 0&&(i[s]=ju(f))}return i}assembleGroupEncodeEntry(t){let n={};return this.view&&(n=this.assembleEncodeFromView(this.view)),t||(this.description&&(n.description=ju(this.description)),this.type!=="unit"&&this.type!=="layer")?ms(n)?void 0:n:Object.assign({width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height")},n??{})}assembleLayout(){if(!this.layout)return;const t=this.layout,{spacing:n}=t,r=Pi(t,["spacing"]),{component:i,config:s}=this,f=function(m,x){const O={};for(const T of mm){const M=m[T];if(M?.facetFieldDef){const{titleAnchor:q,titleOrient:Q}=Ak(["titleAnchor","titleOrient"],M.facetFieldDef,x,T),se=Ok(T,Q),le=VU(q,se);le!==void 0&&(O[se]=le)}}return ms(O)?void 0:O}(i.layoutHeaders,s);return Object.assign(Object.assign(Object.assign({padding:n},this.assembleDefaultLayout()),r),f?{titleBand:f}:{})}assembleDefaultLayout(){return{}}assembleHeaderMarks(){const{layoutHeaders:t}=this.component;let n=[];for(const r of mm)t[r].title&&n.push(LU(this,r));for(const r of fA)n=n.concat(zU(this,r));return n}assembleAxes(){return function(t,n){const{x:r=[],y:i=[]}=t;return[...r.map(s=>Cx(s,"grid",n)),...i.map(s=>Cx(s,"grid",n)),...r.map(s=>Cx(s,"main",n)),...i.map(s=>Cx(s,"main",n))].filter(s=>s)}(this.component.axes,this.config)}assembleLegends(){return xR(this)}assembleProjections(){return QU(this)}assembleTitle(){var t,n,r;const i=(t=this.title)!==null&&t!==void 0?t:{},{encoding:s}=i,f=Pi(i,["encoding"]),m=Object.assign(Object.assign(Object.assign({},bI(this.config.title).nonMark),f),s?{encode:{update:s}}:{});if(m.text)return Ji(["unit","layer"],this.type)?Ji(["middle",void 0],m.anchor)&&(m.frame=(n=m.frame)!==null&&n!==void 0?n:"group"):m.anchor=(r=m.anchor)!==null&&r!==void 0?r:"start",ms(m)?void 0:m}assembleGroup(t=[]){const n={};(t=t.concat(this.assembleSignals())).length>0&&(n.signals=t);const r=this.assembleLayout();r&&(n.layout=r),n.marks=[].concat(this.assembleHeaderMarks(),this.assembleMarks());const i=!this.parent||gg(this.parent)?function m(x){return Ub(x)||_A(x)?x.children.reduce((O,T)=>O.concat(m(T)),NR(x)):NR(x)}(this):[];i.length>0&&(n.scales=i);const s=this.assembleAxes();s.length>0&&(n.axes=s);const f=this.assembleLegends();return f.length>0&&(n.legends=f),n}getName(t){return Qs((this.name?this.name+"_":"")+t)}requestDataName(t){var n;const r=this.getName(t),i=this.component.data.outputNodeRefCounts;return i[r]=((n=i[r])!==null&&n!==void 0?n:0)+1,r}getSizeSignalRef(t){if(gg(this.parent)){const n=Vw(uR(t)),r=this.component.scales[n];if(r&&!r.merged){const i=r.get("type"),s=r.get("range");if(Ad(i)&&J0(s)){const f=r.get("name"),m=OA(Tk(this,n));return m?{signal:sR(f,r,ti({aggregate:"distinct",field:m},{expr:"datum"}))}:(Gr(`Unknown field for ${n}. Cannot calculate view size.`),null)}}}return{signal:this.signalNameMap.get(this.getName(t))}}lookupDataSource(t){const n=this.component.data.outputNodes[t];return n?n.getSource():t}getSignalName(t){return this.signalNameMap.get(t)}renameSignal(t,n){this.signalNameMap.rename(t,n)}renameScale(t,n){this.scaleNameMap.rename(t,n)}renameProjection(t,n){this.projectionNameMap.rename(t,n)}scaleName(t,n){return n?this.getName(t):EN(t)&&Y0(t)&&this.component.scales[t]||this.scaleNameMap.has(this.getName(t))?this.scaleNameMap.get(this.getName(t)):void 0}projectionName(t){return t?this.getName("projection"):this.component.projection&&!this.component.projection.merged||this.projectionNameMap.has(this.getName("projection"))?this.projectionNameMap.get(this.getName("projection")):void 0}getScaleComponent(t){if(!this.component.scales)throw new Error("getScaleComponent cannot be called before parseScale(). Make sure you have called parseScale or use parseUnitModelWithScale().");const n=this.component.scales[t];return n&&!n.merged?n:this.parent?this.parent.getScaleComponent(t):void 0}getSelectionComponent(t,n){let r=this.component.selection[t];if(!r&&this.parent&&(r=this.parent.getSelectionComponent(t,n)),!r)throw new Error(he.selectionNotFound(n));return r}hasAxisOrientSignalRef(){var t,n;return((t=this.component.axes.x)===null||t===void 0?void 0:t.some(r=>r.hasOrientSignalRef()))||((n=this.component.axes.y)===null||n===void 0?void 0:n.some(r=>r.hasOrientSignalRef()))}}class WR extends SA{vgField(t,n={}){const r=this.fieldDef(t);if(r)return ti(r,n)}reduceFieldDef(t,n){return _I(this.getMapping(),(r,i,s)=>{const f=Ov(i);return f?t(r,f,s):r},n)}forEachFieldDef(t,n){DO(this.getMapping(),(r,i)=>{const s=Ov(r);s&&t(s,i)},n)}}class Nk extends as{constructor(t,n){var r,i,s;super(t),this.transform=n,this.transform=$a(n);const f=(r=this.transform.as)!==null&&r!==void 0?r:[void 0,void 0];this.transform.as=[(i=f[0])!==null&&i!==void 0?i:"value",(s=f[1])!==null&&s!==void 0?s:"density"]}clone(){return new Nk(null,$a(this.transform))}dependentFields(){var t;return new Set([this.transform.density,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`DensityTransform ${ko(this.transform)}`}assemble(){const t=this.transform,{density:n}=t,r=Pi(t,["density"]);return Object.assign({type:"kde",field:n},r)}}class _x extends as{constructor(t,n){super(t),this.filter=n}clone(){return new _x(null,Object.assign({},this.filter))}static make(t,n){const{config:r,mark:i,markDef:s}=n;if($o("invalid",s,r)!=="filter")return null;const f=n.reduceFieldDef((m,x,O)=>{const T=Y0(O)&&n.getScaleComponent(O);return T&&vm(T.get("type"))&&x.aggregate!=="count"&&!Iy(i)&&(m[x.field]=x),m},{});return Kr(f).length?new _x(t,f):null}dependentFields(){return new Set(Kr(this.filter))}producedFields(){return new Set}hash(){return`FilterInvalid ${ko(this.filter)}`}assemble(){const t=Kr(this.filter).reduce((n,r)=>{const i=this.filter[r],s=ti(i,{expr:"datum"});return i!==null&&(i.type==="temporal"?n.push(`(isDate(${s}) || (isValid(${s}) && isFinite(+${s})))`):i.type==="quantitative"&&(n.push(`isValid(${s})`),n.push(`isFinite(+${s})`))),n},[]);return t.length>0?{type:"filter",expr:t.join(" && ")}:null}}class Ik extends as{constructor(t,n){super(t),this.transform=n,this.transform=$a(n);const{flatten:r,as:i=[]}=this.transform;this.transform.as=r.map((s,f)=>{var m;return(m=i[f])!==null&&m!==void 0?m:s})}clone(){return new Ik(this.parent,$a(this.transform))}dependentFields(){return new Set(this.transform.flatten)}producedFields(){return new Set(this.transform.as)}hash(){return`FlattenTransform ${ko(this.transform)}`}assemble(){const{flatten:t,as:n}=this.transform;return{type:"flatten",fields:t,as:n}}}class Fk extends as{constructor(t,n){var r,i,s;super(t),this.transform=n,this.transform=$a(n);const f=(r=this.transform.as)!==null&&r!==void 0?r:[void 0,void 0];this.transform.as=[(i=f[0])!==null&&i!==void 0?i:"key",(s=f[1])!==null&&s!==void 0?s:"value"]}clone(){return new Fk(null,$a(this.transform))}dependentFields(){return new Set(this.transform.fold)}producedFields(){return new Set(this.transform.as)}hash(){return`FoldTransform ${ko(this.transform)}`}assemble(){const{fold:t,as:n}=this.transform;return{type:"fold",fields:t,as:n}}}class Wb extends as{constructor(t,n,r,i){super(t),this.fields=n,this.geojson=r,this.signal=i}clone(){return new Wb(null,$a(this.fields),this.geojson,this.signal)}static parseAll(t,n){if(n.component.projection&&!n.component.projection.isFit)return t;let r=0;for(const i of[[gv,mv],[pm,lg]]){const s=i.map(f=>{const m=yc(n.encoding[f]);return si(m)?m.field:ey(m)?{expr:`${m.datum}`}:c0(m)?{expr:`${m.value}`}:void 0});(s[0]||s[1])&&(t=new Wb(t,s,null,n.getName(`geojson_${r++}`)))}if(n.channelHasField(Od)){const i=n.typedFieldDef(Od);i.type===Tb&&(t=new Wb(t,null,i.field,n.getName(`geojson_${r++}`)))}return t}dependentFields(){var t;const n=((t=this.fields)!==null&&t!==void 0?t:[]).filter(Ha);return new Set([...this.geojson?[this.geojson]:[],...n])}producedFields(){return new Set}hash(){return`GeoJSON ${this.geojson} ${this.signal} ${ko(this.fields)}`}assemble(){return Object.assign(Object.assign(Object.assign({type:"geojson"},this.fields?{fields:this.fields}:{}),this.geojson?{geojson:this.geojson}:{}),{signal:this.signal})}}class Sx extends as{constructor(t,n,r,i){super(t),this.projection=n,this.fields=r,this.as=i}clone(){return new Sx(null,this.projection,$a(this.fields),$a(this.as))}static parseAll(t,n){if(!n.projectionName())return t;for(const r of[[gv,mv],[pm,lg]]){const i=r.map(f=>{const m=yc(n.encoding[f]);return si(m)?m.field:ey(m)?{expr:`${m.datum}`}:c0(m)?{expr:`${m.value}`}:void 0}),s=r[0]===pm?"2":"";(i[0]||i[1])&&(t=new Sx(t,n.projectionName(),i,[n.getName("x"+s),n.getName("y"+s)]))}return t}dependentFields(){return new Set(this.fields.filter(Ha))}producedFields(){return new Set(this.as)}hash(){return`Geopoint ${this.projection} ${ko(this.fields)} ${ko(this.as)}`}assemble(){return{type:"geopoint",projection:this.projection,fields:this.fields,as:this.as}}}class Qy extends as{constructor(t,n){super(t),this.transform=n}clone(){return new Qy(null,$a(this.transform))}dependentFields(){var t;return new Set([this.transform.impute,this.transform.key,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set([this.transform.impute])}processSequence(t){const{start:n=0,stop:r,step:i}=t;return{signal:`sequence(${[n,r,...i?[i]:[]].join(",")})`}}static makeFromTransform(t,n){return new Qy(t,n)}static makeFromEncoding(t,n){const r=n.encoding,i=r.x,s=r.y;if(si(i)&&si(s)){const f=i.impute?i:s.impute?s:void 0;if(f===void 0)return;const m=i.impute?s:s.impute?i:void 0,{method:x,value:O,frame:T,keyvals:M}=f.impute,q=SI(n.mark,r);return new Qy(t,Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({impute:f.field,key:m.field},x?{method:x}:{}),O!==void 0?{value:O}:{}),T?{frame:T}:{}),M!==void 0?{keyvals:M}:{}),q.length?{groupby:q}:{}))}return null}hash(){return`Impute ${ko(this.transform)}`}assemble(){const{impute:t,key:n,keyvals:r,method:i,groupby:s,value:f,frame:m=[null,null]}=this.transform,x=Object.assign(Object.assign(Object.assign(Object.assign({type:"impute",field:t,key:n},r?{keyvals:function(O){return O?.stop!==void 0}(r)?this.processSequence(r):r}:{}),{method:"value"}),s?{groupby:s}:{}),{value:i&&i!=="value"?null:f});return i&&i!=="value"?[x,Object.assign({type:"window",as:[`imputed_${t}_value`],ops:[i],fields:[t],frame:m,ignorePeers:!1},s?{groupby:s}:{}),{type:"formula",expr:`datum.${t} === null ? datum.imputed_${t}_value : datum.${t}`,as:t}]:[x]}}class Rk extends as{constructor(t,n){var r,i,s;super(t),this.transform=n,this.transform=$a(n);const f=(r=this.transform.as)!==null&&r!==void 0?r:[void 0,void 0];this.transform.as=[(i=f[0])!==null&&i!==void 0?i:n.on,(s=f[1])!==null&&s!==void 0?s:n.loess]}clone(){return new Rk(null,$a(this.transform))}dependentFields(){var t;return new Set([this.transform.loess,this.transform.on,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`LoessTransform ${ko(this.transform)}`}assemble(){const t=this.transform,{loess:n,on:r}=t,i=Pi(t,["loess","on"]);return Object.assign({type:"loess",x:r,y:n},i)}}class Dx extends as{constructor(t,n,r){super(t),this.transform=n,this.secondary=r}clone(){return new Dx(null,$a(this.transform),this.secondary)}static make(t,n,r,i){const s=n.component.data.sources,{from:f}=r;let m=null;if(function(x){return"data"in x}(f)){let x=$R(f.data,s);x||(x=new Pb(f.data),s.push(x));const O=n.getName(`lookup_${i}`);m=new wh(x,O,"lookup",n.component.data.outputNodeRefCounts),n.component.data.outputNodes[O]=m}else if(function(x){return"selection"in x}(f)){const x=f.selection;if(r=Object.assign({as:x},r),!(m=n.getSelectionComponent(Qs(x),x).materialized))throw new Error(he.noSameUnitLookup(x))}return new Dx(t,r,m.getSource())}dependentFields(){return new Set([this.transform.lookup])}producedFields(){return new Set(this.transform.as?Mu(this.transform.as):this.transform.from.fields)}hash(){return`Lookup ${ko({transform:this.transform,secondary:this.secondary})}`}assemble(){let t;if(this.transform.from.fields)t=Object.assign({values:this.transform.from.fields},this.transform.as?{as:Mu(this.transform.as)}:{});else{let n=this.transform.as;Ha(n)||(Gr(he.NO_FIELDS_NEEDS_AS),n="_lookup"),t={as:[n]}}return Object.assign(Object.assign({type:"lookup",from:this.secondary,key:this.transform.from.key,fields:[this.transform.lookup]},t),this.transform.default?{default:this.transform.default}:{})}}class Mk extends as{constructor(t,n){var r,i,s;super(t),this.transform=n,this.transform=$a(n);const f=(r=this.transform.as)!==null&&r!==void 0?r:[void 0,void 0];this.transform.as=[(i=f[0])!==null&&i!==void 0?i:"prob",(s=f[1])!==null&&s!==void 0?s:"value"]}clone(){return new Mk(null,$a(this.transform))}dependentFields(){var t;return new Set([this.transform.quantile,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`QuantileTransform ${ko(this.transform)}`}assemble(){const t=this.transform,{quantile:n}=t,r=Pi(t,["quantile"]);return Object.assign({type:"quantile",field:n},r)}}class jk extends as{constructor(t,n){var r,i,s;super(t),this.transform=n,this.transform=$a(n);const f=(r=this.transform.as)!==null&&r!==void 0?r:[void 0,void 0];this.transform.as=[(i=f[0])!==null&&i!==void 0?i:n.on,(s=f[1])!==null&&s!==void 0?s:n.regression]}clone(){return new jk(null,$a(this.transform))}dependentFields(){var t;return new Set([this.transform.regression,this.transform.on,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`RegressionTransform ${ko(this.transform)}`}assemble(){const t=this.transform,{regression:n,on:r}=t,i=Pi(t,["regression","on"]);return Object.assign({type:"regression",x:r,y:n},i)}}class Bk extends as{constructor(t,n){super(t),this.transform=n}clone(){return new Bk(null,$a(this.transform))}addDimensions(t){var n;this.transform.groupby=z0(((n=this.transform.groupby)!==null&&n!==void 0?n:[]).concat(t),r=>r)}producedFields(){}dependentFields(){var t;return new Set([this.transform.pivot,this.transform.value,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}hash(){return`PivotTransform ${ko(this.transform)}`}assemble(){const{pivot:t,value:n,groupby:r,limit:i,op:s}=this.transform;return Object.assign(Object.assign(Object.assign({type:"pivot",field:t,value:n},i!==void 0?{limit:i}:{}),s!==void 0?{op:s}:{}),r!==void 0?{groupby:r}:{})}}class Pk extends as{constructor(t,n){super(t),this.transform=n}clone(){return new Pk(null,$a(this.transform))}dependentFields(){return new Set}producedFields(){return new Set}hash(){return`SampleTransform ${ko(this.transform)}`}assemble(){return{type:"sample",size:this.transform.sample}}}function VR(e){let t=0;return function n(r,i){var s;if(r instanceof Pb&&!r.isGenerator&&!hx(r.data)&&(e.push(i),i={name:null,source:i.name,transform:[]}),r instanceof gf&&(r.parent instanceof Pb&&!i.source?(i.format=Object.assign(Object.assign({},(s=i.format)!==null&&s!==void 0?s:{}),{parse:r.assembleFormatParse()}),i.transform.push(...r.assembleTransforms(!0))):i.transform.push(...r.assembleTransforms())),r instanceof Lb){i.name||(i.name=`data_${t++}`),!i.source||i.transform.length>0?(e.push(i),r.data=i.name):r.data=i.source;for(const f of r.assemble())e.push(f)}else switch((r instanceof Ox||r instanceof Ax||r instanceof _x||r instanceof Rb||r instanceof Mb||r instanceof Sx||r instanceof Wb||r instanceof pg||r instanceof Dx||r instanceof zb||r instanceof Jy||r instanceof Fk||r instanceof Ik||r instanceof Nk||r instanceof Rk||r instanceof Mk||r instanceof jk||r instanceof oy||r instanceof Pk||r instanceof Bk)&&i.transform.push(r.assemble()),(r instanceof Dv||r instanceof _v||r instanceof Qy||r instanceof g0)&&i.transform.push(...r.assemble()),r instanceof wh&&(i.source&&i.transform.length===0?r.setSource(i.source):r.parent instanceof wh?r.setSource(i.name):(i.name||(i.name=`data_${t++}`),r.setSource(i.name),r.numChildren()===1&&(e.push(i),i={name:null,source:i.name,transform:[]}))),r.numChildren()){case 0:r instanceof wh&&(!i.source||i.transform.length>0)&&e.push(i);break;case 1:n(r.children[0],i);break;default:{i.name||(i.name=`data_${t++}`);let f=i.name;!i.source||i.transform.length>0?e.push(i):f=i.source;for(const m of r.children)n(m,{name:null,source:f,transform:[]});break}}}}function kW(e){return e==="top"||e==="left"||da(e)?"header":"footer"}function EW(e,t){var n;const{facet:r,config:i,child:s,component:f}=e;if(e.channelHasField(t)){const m=r[t],x=Bb("title",null,i,t);let O=zy(m,i,{allowDisabling:!0,includeDefault:x===void 0||!!x});s.component.layoutHeaders[t].title&&(O=Gi(O)?O.join(", "):O,O+=" / "+s.component.layoutHeaders[t].title,s.component.layoutHeaders[t].title=null);const T=Bb("labelOrient",m,i,t),M=Qu(((n=m.header)!==null&&n!==void 0?n:{}).labels,i.header.labels,!0),q=Ji(["bottom","right"],T)?"footer":"header";f.layoutHeaders[t]={title:O,facetFieldDef:m,[q]:t==="facet"?[]:[qR(e,t,M)]}}}function qR(e,t,n){const r=t==="row"?"height":"width";return{labels:n,sizeSignal:e.child.component.layoutSize.get(r)?e.child.getSizeSignalRef(r):void 0,axes:[]}}function HR(e,t){var n;const{child:r}=e;if(r.component.axes[t]){const{layoutHeaders:i,resolve:s}=e.component;if(s.axis[t]=mA(s,t),s.axis[t]==="shared"){const f=t==="x"?"column":"row",m=i[f];for(const x of r.component.axes[t]){const O=kW(x.get("orient"));m[O]=(n=m[O])!==null&&n!==void 0?n:[qR(e,f,!1)];const T=Cx(x,"main",e.config,{header:!0});T&&m[O][0].axes.push(T),x.mainExtracted=!0}}}}function CW(e){DA(e);const t=e.layout.columns===1?"width":"childWidth",n=e.layout.columns===void 0?"height":"childHeight";Lk(e,t),Lk(e,n)}function DA(e){for(const t of e.children)t.parseLayoutSize()}function Lk(e,t){const n=uR(t),r=Vw(n),i=e.component.resolve,s=e.component.layoutSize;let f;for(const m of e.children){const x=m.component.layoutSize.getWithExplicit(n),O=i.scale[r];if(O==="independent"&&x.value==="step"){f=void 0;break}if(f){if(O==="independent"&&f.value!==x.value){f=void 0;break}f=ny(f,x,n,"")}else f=x}if(f){for(const m of e.children)e.renameSignal(m.getName(n),e.getName(t)),m.component.layoutSize.set(n,"merged",!1);s.setWithExplicit(t,f)}else s.setWithExplicit(t,{explicit:!1,value:void 0})}function OW(e,t){const n=t==="width"?"x":"y",r=e.config,i=e.getScaleComponent(n);if(i){const s=i.get("type"),f=i.get("range");if(Ad(s)){const m=fx(r.view,t);return J0(f)||Av(m)?"step":m}return LO(r.view,t)}if(e.hasProjection||e.mark==="arc")return LO(r.view,t);{const s=fx(r.view,t);return Av(s)?s.step:s}}function TA(e,t,n){return ti(t,Object.assign({suffix:`by_${ti(e)}`},n??{}))}class Tx extends WR{constructor(t,n,r,i){super(t,"facet",n,r,i,t.resolve),this.child=RA(t.spec,this,this.getName("child"),void 0,i),this.children=[this.child],this.facet=this.initFacet(t.facet,i)}initFacet(t,n){return sx(t)?_I(t,(r,i,s)=>Ji([r0,i0],s)?i.field===void 0?(Gr(he.emptyFieldDef(i,s)),r):(r[s]=OO(i,s,n),r):(Gr(he.incompatibleChannel(s,"facet")),r),{}):{facet:OO(t,"facet",n)}}channelHasField(t){return!!this.facet[t]}fieldDef(t){return this.facet[t]}parseData(){this.component.data=zk(this),this.child.parseData()}parseLayoutSize(){DA(this)}parseSelections(){this.child.parseSelections(),this.component.selection=this.child.component.selection}parseMarkGroup(){this.child.parseMarkGroup()}parseAxesAndHeaders(){this.child.parseAxesAndHeaders(),function(t){for(const n of mm)EW(t,n);HR(t,"x"),HR(t,"y")}(this)}assembleSelectionTopLevelSignals(t){return this.child.assembleSelectionTopLevelSignals(t)}assembleSignals(){return this.child.assembleSignals(),[]}assembleSelectionData(t){return this.child.assembleSelectionData(t)}getHeaderLayoutMixins(){var t,n,r;const i={};for(const s of mm)for(const f of hA){const m=this.component.layoutHeaders[s],x=m[f],{facetFieldDef:O}=m;if(O){const T=Bb("titleOrient",O,this.config,s);if(Ji(["right","bottom"],T)){const M=Ok(s,T);i.titleAnchor=(t=i.titleAnchor)!==null&&t!==void 0?t:{},i.titleAnchor[M]="end"}}if(x?.[0]){const T=s==="row"?"height":"width",M=f==="header"?"headerBand":"footerBand";s==="facet"||this.child.component.layoutSize.get(T)||(i[M]=(n=i[M])!==null&&n!==void 0?n:{},i[M][s]=.5),m.title&&(i.offset=(r=i.offset)!==null&&r!==void 0?r:{},i.offset[s==="row"?"rowTitle":"columnTitle"]=10)}}return i}assembleDefaultLayout(){const{column:t,row:n}=this.facet,r=t?this.columnDistinctSignal():n?1:void 0;let i="all";return(n||this.component.resolve.scale.x!=="independent")&&(t||this.component.resolve.scale.y!=="independent")||(i="none"),Object.assign(Object.assign(Object.assign({},this.getHeaderLayoutMixins()),r?{columns:r}:{}),{bounds:"full",align:i})}assembleLayoutSignals(){return this.child.assembleLayoutSignals()}columnDistinctSignal(){if(!(this.parent&&this.parent instanceof Tx))return{signal:`length(data('${this.getName("column_domain")}'))`}}assembleGroup(t){return this.parent&&this.parent instanceof Tx?Object.assign(Object.assign({},this.channelHasField("column")?{encode:{update:{columns:{field:ti(this.facet.column,{prefix:"distinct"})}}}}:{}),super.assembleGroup(t)):super.assembleGroup(t)}getCardinalityAggregateForChild(){const t=[],n=[],r=[];if(this.child instanceof Tx){if(this.child.channelHasField("column")){const i=ti(this.child.facet.column);t.push(i),n.push("distinct"),r.push(`distinct_${i}`)}}else for(const i of gm){const s=this.child.component.scales[i];if(s&&!s.merged){const f=s.get("type"),m=s.get("range");if(Ad(f)&&J0(m)){const x=OA(Tk(this.child,i));x?(t.push(x),n.push("distinct"),r.push(`distinct_${x}`)):Gr(`Unknown field for ${i}. Cannot calculate view size.`)}}}return{fields:t,ops:n,as:r}}assembleFacet(){const{name:t,data:n}=this.component.data.facetRoot,{row:r,column:i}=this.facet,{fields:s,ops:f,as:m}=this.getCardinalityAggregateForChild(),x=[];for(const T of mm){const M=this.facet[T];if(M){x.push(ti(M));const{bin:q,sort:Q}=M;if(Ns(q)&&x.push(ti(M,{binSuffix:"end"})),Ev(Q)){const{field:se,op:le=Jw}=Q,Fe=TA(M,Q);r&&i?(s.push(Fe),f.push("max"),m.push(Fe)):(s.push(se),f.push(le),m.push(Fe))}else if(Gi(Q)){const se=jb(M,T);s.push(se),f.push("max"),m.push(se)}}}const O=!!r&&!!i;return Object.assign({name:t,data:n,groupby:x},O||s.length>0?{aggregate:Object.assign(Object.assign({},O?{cross:O}:{}),s.length?{fields:s,ops:f,as:m}:{})}:{})}facetSortFields(t){const{facet:n}=this,r=n[t];return r?Ev(r.sort)?[TA(r,r.sort,{expr:"datum"})]:Gi(r.sort)?[jb(r,t,{expr:"datum"})]:[ti(r,{expr:"datum"})]:[]}facetSortOrder(t){const{facet:n}=this,r=n[t];if(r){const{sort:i}=r;return[(Ev(i)?i.order:!Gi(i)&&i)||"ascending"]}return[]}assembleLabelTitle(){const{facet:t,config:n}=this;if(t.facet)return dA(t.facet,"facet",n);const r={row:["top","bottom"],column:["left","right"]};for(const i of fA)if(t[i]){const s=Bb("labelOrient",t[i],n,i);if(Ji(r[i],s))return dA(t[i],i,n)}}assembleMarks(){const{child:t}=this,n=function(f){const m=[],x=VR(m);for(const O of f.children)x(O,{source:f.name,name:null,transform:[]});return m}(this.component.data.facetRoot),r=t.assembleGroupEncodeEntry(!1),i=this.assembleLabelTitle()||t.assembleTitle(),s=t.assembleGroupStyle();return[Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:this.getName("cell"),type:"group"},i?{title:i}:{}),s?{style:s}:{}),{from:{facet:this.assembleFacet()},sort:{field:mm.map(f=>this.facetSortFields(f)).flat(),order:mm.map(f=>this.facetSortOrder(f)).flat()}}),n.length>0?{data:n}:{}),r?{encode:{update:r}}:{}),t.assembleGroup(function(f,m){if(f.component.selection&&Kr(f.component.selection).length){const x=go(f.getName("cell"));m.unshift({name:"facet",value:{},on:[{events:Sy("mousemove","scope"),update:`isTuple(facet) ? facet : group(${x}).datum`}]})}return YO(m)}(this,[])))]}getMapping(){return this.facet}}function $R(e,t){var n,r,i,s,f,m,x,O,T,M;for(const q of t){const Q=q.data;if((!e.name||!q.hasName()||e.name===q.dataName)&&!(!((n=e.format)===null||n===void 0)&&n.mesh&&(!((r=Q.format)===null||r===void 0)&&r.feature)||(!((i=e.format)===null||i===void 0)&&i.feature||!((s=Q.format)===null||s===void 0)&&s.feature)&&((f=e.format)===null||f===void 0?void 0:f.feature)!==((m=Q.format)===null||m===void 0?void 0:m.feature)||(!((x=e.format)===null||x===void 0)&&x.mesh||!((O=Q.format)===null||O===void 0)&&O.mesh)&&((T=e.format)===null||T===void 0?void 0:T.mesh)!==((M=Q.format)===null||M===void 0?void 0:M.mesh))){if(fk(e)&&fk(Q)){if(Y1(e.values,Q.values))return q}else if(hx(e)&&hx(Q)){if(e.url===Q.url)return q}else if(oF(e)&&e.name===q.dataName)return q}}return null}function AW(e,t){if(e.data||!e.parent){if(e.data===null){const r=new Pb({values:[]});return t.push(r),r}const n=$R(e.data,t);if(n)return Hy(e.data)||(n.data.format=function(r,...i){for(const s of i)_7(r,s??{});return r}({},e.data.format,n.data.format)),!n.hasName()&&e.data.name&&(n.dataName=e.data.name),n;{const r=new Pb(e.data);return t.push(r),r}}return e.parent.component.data.facetRoot?e.parent.component.data.facetRoot:e.parent.component.data.main}function zk(e){var t,n,r,i,s,f,m,x,O,T;let M=AW(e,e.component.data.sources);const{outputNodes:q,outputNodeRefCounts:Q}=e.component.data,se=e.parent?e.parent.component.data.ancestorParse.clone():new fz,le=e.data;Hy(le)?(sF(le)?M=new Ax(M,le.sequence):qO(le)&&(M=new Ox(M,le.graticule)),se.parseNothing=!0):((t=le?.format)===null||t===void 0?void 0:t.parse)===null&&(se.parseNothing=!0),M=(n=gf.makeExplicit(M,e,se))!==null&&n!==void 0?n:M,M=new oy(M);const Fe=e.parent&&Ub(e.parent);(yu(e)||gg(e))&&Fe&&(M=(r=Dv.makeFromEncoding(M,e))!==null&&r!==void 0?r:M),e.transforms.length>0&&(M=function(dt,Qt,mn){var on,Rn;let Fn=0;for(const zn of Qt.transforms){let Vn,Qn;if(kz(zn))Vn=dt=new Mb(dt,zn),Qn="derived";else if(cF(zn)){const pr=tW(zn);Vn=dt=(on=gf.makeWithAncestors(dt,{},pr,mn))!==null&&on!==void 0?on:dt,dt=new Rb(dt,Qt,zn.filter)}else if(Ez(zn))Vn=dt=Dv.makeFromTransform(dt,zn,Qt),Qn="number";else if(Oz(zn))Qn="date",mn.getWithExplicit(zn.field).value===void 0&&(dt=new gf(dt,{[zn.field]:Qn}),mn.set(zn.field,Qn,!1)),Vn=dt=_v.makeFromTransform(dt,zn);else if(Az(zn))Vn=dt=pg.makeFromTransform(dt,zn),Qn="number",QO(Qt)&&(dt=new oy(dt));else if(hz(zn))Vn=dt=Dx.make(dt,Qt,zn,Fn++),Qn="derived";else if(bz(zn))Vn=dt=new zb(dt,zn),Qn="number";else if(xz(zn))Vn=dt=new Jy(dt,zn),Qn="number";else if(_z(zn))Vn=dt=g0.makeFromTransform(dt,zn),Qn="derived";else if(Sz(zn))Vn=dt=new Fk(dt,zn),Qn="derived";else if(wz(zn))Vn=dt=new Ik(dt,zn),Qn="derived";else if(dz(zn))Vn=dt=new Bk(dt,zn),Qn="derived";else if(yz(zn))dt=new Pk(dt,zn);else if(Cz(zn))Vn=dt=Qy.makeFromTransform(dt,zn),Qn="derived";else if(pz(zn))Vn=dt=new Nk(dt,zn),Qn="derived";else if(mz(zn))Vn=dt=new Mk(dt,zn),Qn="derived";else if(gz(zn))Vn=dt=new jk(dt,zn),Qn="derived";else{if(!vz(zn)){Gr(he.invalidTransformIgnored(zn));continue}Vn=dt=new Rk(dt,zn),Qn="derived"}if(Vn&&Qn!==void 0)for(const pr of(Rn=Vn.producedFields())!==null&&Rn!==void 0?Rn:[])mn.set(pr,Qn,!1)}return dt}(M,e,se));const Le=function(dt){const Qt={};if(yu(dt)&&dt.component.selection)for(const mn of Kr(dt.component.selection)){const on=dt.component.selection[mn];for(const Rn of on.project.items)!Rn.channel&&ex(Rn.field)>1&&(Qt[Rn.field]="flatten")}return Qt}(e),ze=nW(e);M=(i=gf.makeWithAncestors(M,{},Object.assign(Object.assign({},Le),ze),se))!==null&&i!==void 0?i:M,yu(e)&&(M=Wb.parseAll(M,e),M=Sx.parseAll(M,e)),(yu(e)||gg(e))&&(Fe||(M=(s=Dv.makeFromEncoding(M,e))!==null&&s!==void 0?s:M),M=(f=_v.makeFromEncoding(M,e))!==null&&f!==void 0?f:M,M=Mb.parseAllForSortIndex(M,e));const nt=e.getName(hk),it=new wh(M,nt,hk,Q);if(q[nt]=it,M=it,yu(e)){const dt=pg.makeFromEncoding(M,e);dt&&(M=dt,QO(e)&&(M=new oy(M))),M=(m=Qy.makeFromEncoding(M,e))!==null&&m!==void 0?m:M,M=(x=g0.makeFromEncoding(M,e))!==null&&x!==void 0?x:M}yu(e)&&(M=(O=_x.make(M,e))!==null&&O!==void 0?O:M);const ut=e.getName(ff),st=new wh(M,ut,ff,Q);q[ut]=st,M=st,yu(e)&&function(dt,Qt){Gy(dt,mn=>{const on=mn.name,Rn=dt.getName(`lookup_${on}`);dt.component.data.outputNodes[Rn]=mn.materialized=new wh(new Rb(Qt,dt,{selection:on}),Rn,"lookup",dt.component.data.outputNodeRefCounts)})}(e,st);let pt=null;if(gg(e)){const dt=e.getName("facet");M=(T=function(Qt,mn){const{row:on,column:Rn}=mn;if(on&&Rn){let Fn=null;for(const zn of[on,Rn])if(Ev(zn.sort)){const{field:Vn,op:Qn=Jw}=zn.sort;Qt=Fn=new Jy(Qt,{joinaggregate:[{op:Qn,field:Vn,as:TA(zn,zn.sort,{forAs:!0})}],groupby:[ti(zn)]})}return Fn}return null}(M,e.facet))!==null&&T!==void 0?T:M,pt=new Lb(M,e,dt,st.getSource()),q[dt]=pt}return Object.assign(Object.assign({},e.component.data),{outputNodes:q,outputNodeRefCounts:Q,raw:it,main:st,facetRoot:pt,ancestorParse:se})}class _W extends SA{constructor(t,n,r,i){var s,f,m,x;super(t,"concat",n,r,i,t.resolve),((f=(s=t.resolve)===null||s===void 0?void 0:s.axis)===null||f===void 0?void 0:f.x)!=="shared"&&((x=(m=t.resolve)===null||m===void 0?void 0:m.axis)===null||x===void 0?void 0:x.y)!=="shared"||Gr(he.CONCAT_CANNOT_SHARE_AXIS),this.children=this.getChildren(t).map((O,T)=>RA(O,this,this.getName("concat_"+T),void 0,i))}parseData(){this.component.data=zk(this);for(const t of this.children)t.parseData()}parseSelections(){this.component.selection={};for(const t of this.children){t.parseSelections();for(const n of Kr(t.component.selection))this.component.selection[n]=t.component.selection[n]}}parseMarkGroup(){for(const t of this.children)t.parseMarkGroup()}parseAxesAndHeaders(){for(const t of this.children)t.parseAxesAndHeaders()}getChildren(t){return sk(t)?t.vconcat:PO(t)?t.hconcat:t.concat}parseLayoutSize(){CW(this)}parseAxisGroup(){return null}assembleSelectionTopLevelSignals(t){return this.children.reduce((n,r)=>r.assembleSelectionTopLevelSignals(n),t)}assembleSignals(){return this.children.forEach(t=>t.assembleSignals()),[]}assembleLayoutSignals(){const t=pA(this);for(const n of this.children)t.push(...n.assembleLayoutSignals());return t}assembleSelectionData(t){return this.children.reduce((n,r)=>r.assembleSelectionData(n),t)}assembleMarks(){return this.children.map(t=>{const n=t.assembleTitle(),r=t.assembleGroupStyle(),i=t.assembleGroupEncodeEntry(!1);return Object.assign(Object.assign(Object.assign(Object.assign({type:"group",name:t.getName("group")},n?{title:n}:{}),r?{style:r}:{}),i?{encode:{update:i}}:{}),t.assembleGroup())})}assembleDefaultLayout(){const t=this.layout.columns;return Object.assign(Object.assign({},t!=null?{columns:t}:{}),{bounds:"full",align:"each"})}}const SW=Object.assign(Object.assign({disable:1,gridScale:1,scale:1},cN),{labelExpr:1,encode:1}),GR=Kr(SW);class NA extends f0{constructor(t={},n={},r=!1){super(),this.explicit=t,this.implicit=n,this.mainExtracted=r}clone(){return new NA($a(this.explicit),$a(this.implicit),this.mainExtracted)}hasAxisPart(t){return t==="axis"||(t==="grid"||t==="title"?!!this.get(t):!function(n){return n===!1||n===null}(this.get(t)))}hasOrientSignalRef(){return da(this.explicit.orient)}}function DW(e){return gm.reduce((t,n)=>(e.component.scales[n]&&(t[n]=[function(r,i){var s,f,m;let x=i.axis(r);const O=new NA,T=yc(i.encoding[r]),{mark:M,config:q}=i,Q=x?.orient||((s=q[r==="x"?"axisX":"axisY"])===null||s===void 0?void 0:s.orient)||((f=q.axis)===null||f===void 0?void 0:f.orient)||function(ut){return ut==="x"?"bottom":"left"}(r),se=i.getScaleComponent(r).get("type"),le=PU(r,se,Q,i.config),Fe=x!==void 0?!x:cA("disable",q,x?.style,le).configValue;if(O.set("disable",Fe,x!==void 0),Fe)return O;const Le=function(ut,st,pt,dt,Qt){const mn=st?.labelAngle;if(mn!==void 0)return da(mn)?mn:Dw(mn);{const{configValue:on}=cA("labelAngle",ut.config,st?.style,Qt);return on!==void 0?Dw(on):pt===ou&&Ji([fO,lO],dt.type)?270:void 0}}(i,x=x||{},r,T,le),ze={fieldOrDatumDef:T,axis:x,channel:r,model:i,scaleType:se,orient:Q,labelAngle:Le,mark:M,config:q};for(const ut of GR){const st=ut in ZF?ZF[ut](ze):lN(ut)?x[ut]:void 0,pt=st!==void 0,dt=FW(st,ut,x,i,r);if(pt&&dt)O.set(ut,st,dt);else{const{configValue:Qt,configFrom:mn}=lN(ut)&&ut!=="values"?cA(ut,i.config,x.style,le):{},on=Qt!==void 0;pt&&!on?O.set(ut,st,dt):(mn!=="vgAxisConfig"||RW.has(ut)&&on||$3(Qt)||da(Qt))&&O.set(ut,Qt,!1)}}const nt=(m=x.encoding)!==null&&m!==void 0?m:{},it=uN.reduce((ut,st)=>{var pt;if(!O.hasAxisPart(st))return ut;const dt=cR((pt=nt[st])!==null&&pt!==void 0?pt:{},i),Qt=st==="labels"?function(mn,on,Rn){var Fn;const{encoding:zn,config:Vn}=mn,Qn=(Fn=yc(zn[on]))!==null&&Fn!==void 0?Fn:yc(zn[bv(on)]),pr=mn.axis(on)||{},{format:Pr,formatType:Ar}=pr;return Ly(Ar)?Object.assign({text:gO({fieldOrDatumDef:Qn,field:"datum.value",format:Pr,formatType:Ar,config:Vn})},Rn):Rn}(i,r,dt):dt;return Qt===void 0||ms(Qt)||(ut[st]={update:Qt}),ut},{});return ms(it)||O.set("encode",it,!!x.encoding||x.labelAngle!==void 0),O}(n,e)]),t),{})}const TW={bottom:"top",top:"bottom",left:"right",right:"left"};function NW(e,t){if(!e)return t.map(n=>n.clone());{if(e.length!==t.length)return;const n=e.length;for(let r=0;r<n;r++){const i=e[r],s=t[r];if(!!i!=!!s)return;if(i&&s){const f=i.getWithExplicit("orient"),m=s.getWithExplicit("orient");if(f.explicit&&m.explicit&&f.value!==m.value)return;e[r]=IW(i,s)}}}return e}function IW(e,t){for(const n of GR){const r=ny(e.getWithExplicit(n),t.getWithExplicit(n),n,"axis",(i,s)=>{switch(n){case"title":return AI(i,s);case"gridScale":return{explicit:i.explicit,value:Qu(i.value,s.value)}}return lk(i,s,n,"axis")});e.setWithExplicit(n,r)}return e}function FW(e,t,n,r,i){if(t==="disable")return n!==void 0;switch(n=n||{},t){case"titleAngle":case"labelAngle":return e===(da(n.labelAngle)?n.labelAngle:Dw(n.labelAngle));case"values":return!!n.values;case"encode":return!!n.encoding||!!n.labelAngle;case"title":if(e===nR(r,i))return!0}return e===n[t]}const RW=new Set(["grid","translate","format","formatType","orient","labelExpr","tickCount","position","tickMinStep"]);function MW(e,t,n,{graticule:r}){const i=hv(e)?Object.assign({},e):{type:e},s=$o("orient",i,n);if(i.orient=function(f,m,x){switch(f){case Fw:case K3:case X3:case hN:case R7:case F7:return}const{x:O,y:T,x2:M,y2:q}=m;switch(f){case Nw:if(si(O)&&(bh(O.bin)||si(T)&&T.aggregate&&!O.aggregate))return"vertical";if(si(T)&&(bh(T.bin)||si(O)&&O.aggregate&&!T.aggregate))return"horizontal";if(q||M){if(x)return x;if(!M&&(si(O)&&O.type===By&&!Ns(O.bin)||wO(O)))return"horizontal";if(!q&&(si(T)&&T.type===By&&!Ns(T.bin)||wO(T)))return"vertical"}case Rw:if(M&&(!si(O)||!bh(O.bin))&&q&&(!si(T)||!bh(T.bin)))return;case Tw:if(q)return si(T)&&bh(T.bin)?"horizontal":"vertical";if(M)return si(O)&&bh(O.bin)?"vertical":"horizontal";if(f===Rw){if(O&&!T)return"vertical";if(T&&!O)return"horizontal"}case Iw:case G3:{const Q=Cv(O),se=Cv(T);if(Q&&!se)return f!=="tick"?"horizontal":"vertical";if(!Q&&se)return f!=="tick"?"vertical":"horizontal";if(Q&&se){const le=O,Fe=T,Le=le.type===Db,ze=Fe.type===Db;return Le&&!ze?f!=="tick"?"vertical":"horizontal":!Le&&ze?f!=="tick"?"horizontal":"vertical":!le.aggregate&&Fe.aggregate?f!=="tick"?"vertical":"horizontal":le.aggregate&&!Fe.aggregate?f!=="tick"?"horizontal":"vertical":x||"vertical"}return x||void 0}}return"vertical"}(i.type,t,s),s!==void 0&&s!==i.orient&&Gr(he.orientOverridden(i.orient,s)),i.type==="bar"&&i.orient){const f=$o("cornerRadiusEnd",i,n);if(f!==void 0){const m=i.orient==="horizontal"&&t.x2||i.orient==="vertical"&&t.y2?["cornerRadius"]:B7[i.orient];for(const x of m)i[x]=f;i.cornerRadiusEnd!==void 0&&delete i.cornerRadiusEnd}}return $o("opacity",i,n)===void 0&&(i.opacity=function(f,m){if(Ji([Fw,G3,K3,X3],f)&&!_O(m))return .7}(i.type,t)),i.filled===void 0&&(i.filled=!r&&function(f,m){const x=Wy("filled",f,m),O=f.type;return Qu(x,O!==Fw&&O!==Iw&&O!==Rw)}(i,n)),$o("cursor",i,n)===void 0&&(i.cursor=function(f,m,x){return m.href||f.href||$o("href",f,x)?"pointer":f.cursor}(i,t,n)),i}function IA(e,t){const{config:n}=e;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},ym(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),hf("x",e,{defaultPos:"mid"})),hf("y",e,{defaultPos:"mid"})),Wc("size",e)),Wc("angle",e)),function(r,i,s){return s?{shape:{value:s}}:Wc("shape",r)}(e,0,t))}const Uk={arc:{vgMark:"arc",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},ym(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),hf("x",e,{defaultPos:"mid"})),hf("y",e,{defaultPos:"mid"})),ry(e,"radius","arc")),ry(e,"theta","arc"))},area:{vgMark:"area",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign({},ym(e,{align:"ignore",baseline:"ignore",color:"include",orient:"include",size:"ignore",theta:"ignore"})),mk("x",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:e.markDef.orient==="horizontal"})),mk("y",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:e.markDef.orient==="vertical"})),GO(e))},bar:{vgMark:"rect",encodeEntry:e=>Object.assign(Object.assign(Object.assign({},ym(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),ry(e,"x","bar")),ry(e,"y","bar"))},circle:{vgMark:"symbol",encodeEntry:e=>IA(e,"circle")},geoshape:{vgMark:"shape",encodeEntry:e=>Object.assign({},ym(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),postEncodingTransform:e=>{const{encoding:t}=e,n=t.shape;return[Object.assign({type:"geoshape",projection:e.projectionName()},n&&si(n)&&n.type===Tb?{field:ti(n,{expr:"datum"})}:{})]}},image:{vgMark:"image",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign({},ym(e,{align:"ignore",baseline:"ignore",color:"ignore",orient:"ignore",size:"ignore",theta:"ignore"})),ry(e,"x","image")),ry(e,"y","image")),HO(e,"url"))},line:{vgMark:"line",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},ym(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),hf("x",e,{defaultPos:"mid"})),hf("y",e,{defaultPos:"mid"})),Wc("size",e,{vgChannel:"strokeWidth"})),GO(e))},point:{vgMark:"symbol",encodeEntry:e=>IA(e)},rect:{vgMark:"rect",encodeEntry:e=>Object.assign(Object.assign(Object.assign({},ym(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),ry(e,"x","rect")),ry(e,"y","rect"))},rule:{vgMark:"rule",encodeEntry:e=>{const{markDef:t}=e,n=t.orient;return e.encoding.x||e.encoding.y||e.encoding.latitude||e.encoding.longitude?Object.assign(Object.assign(Object.assign(Object.assign({},ym(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),mk("x",e,{defaultPos:n==="horizontal"?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:n!=="vertical"})),mk("y",e,{defaultPos:n==="vertical"?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:n!=="horizontal"})),Wc("size",e,{vgChannel:"strokeWidth"})):{}}},square:{vgMark:"symbol",encodeEntry:e=>IA(e,"square")},text:{vgMark:"text",encodeEntry:e=>{const{config:t,encoding:n}=e;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},ym(e,{align:"include",baseline:"include",color:"include",size:"ignore",orient:"ignore",theta:"include"})),hf("x",e,{defaultPos:"mid"})),hf("y",e,{defaultPos:"mid"})),HO(e)),Wc("size",e,{vgChannel:"fontSize"})),Wc("angle",e)),yF("align",function(r,i,s){if($o("align",r,s)===void 0)return"center"}(e.markDef,0,t))),yF("baseline",function(r,i,s){if($o("baseline",r,s)===void 0)return"middle"}(e.markDef,0,t))),hf("radius",e,{defaultPos:null,isMidPoint:!0})),hf("theta",e,{defaultPos:null,isMidPoint:!0}))}},tick:{vgMark:"rect",encodeEntry:e=>{const{config:t,markDef:n}=e,r=n.orient,i=r==="horizontal"?"width":"height",s=r==="horizontal"?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},ym(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),hf("x",e,{defaultPos:"mid",vgChannel:"xc"})),hf("y",e,{defaultPos:"mid",vgChannel:"yc"})),Wc("size",e,{defaultValue:function(f){var m;const{config:x,markDef:O}=f,{orient:T}=O,M=T==="horizontal"?"width":"height",q=f.getScaleComponent(T==="horizontal"?"x":"y"),Q=(m=$o("size",O,x,{vgChannel:M}))!==null&&m!==void 0?m:x.tick.bandSize;if(Q!==void 0)return Q;{const se=q?q.get("range"):void 0;return se&&J0(se)&&Ju(se.step)?3*se.step/4:3*uk(x.view,M)/4}}(e),vgChannel:i})),{[s]:ju($o("thickness",n,t))})}},trail:{vgMark:"trail",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},ym(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),hf("x",e,{defaultPos:"mid"})),hf("y",e,{defaultPos:"mid"})),Wc("size",e)),GO(e))}};function jW(e){return Ji([Iw,Tw,M7],e.mark)?function(t){const n=SI(t.mark,t.encoding),r=Wk(t,{fromPrefix:n.length>0?KR:""});return n.length>0?[{name:t.getName("pathgroup"),type:"group",from:{facet:{name:KR+t.requestDataName(ff),data:t.requestDataName(ff),groupby:n}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:r}]:r}(e):Ji([Nw],e.mark)?function(t){const n=aO.some(r=>$o(r,t.markDef,t.config));if(t.stack&&!t.fieldDef("size")&&n){const[r]=Wk(t,{fromPrefix:XR}),i=t.scaleName(t.stack.fieldChannel),s=(q={})=>t.vgField(t.stack.fieldChannel,q),f=(q,Q)=>{const se=[s({prefix:"min",suffix:"start",expr:Q}),s({prefix:"max",suffix:"start",expr:Q}),s({prefix:"min",suffix:"end",expr:Q}),s({prefix:"max",suffix:"end",expr:Q})];return`${q}(${se.map(le=>`scale('${i}',${le})`).join(",")})`};let m,x;t.stack.fieldChannel==="x"?(m=Object.assign(Object.assign({},J1(r.encode.update,["y","yc","y2","height",...aO])),{x:{signal:f("min","datum")},x2:{signal:f("max","datum")},clip:{value:!0}}),x={x:{field:{group:"x"},mult:-1},height:{field:{group:"height"}}},r.encode.update=Object.assign(Object.assign({},t0(r.encode.update,["y","yc","y2"])),{height:{field:{group:"height"}}})):(m=Object.assign(Object.assign({},J1(r.encode.update,["x","xc","x2","width"])),{y:{signal:f("min","datum")},y2:{signal:f("max","datum")},clip:{value:!0}}),x={y:{field:{group:"y"},mult:-1},width:{field:{group:"width"}}},r.encode.update=Object.assign(Object.assign({},t0(r.encode.update,["x","xc","x2"])),{width:{field:{group:"width"}}}));for(const q of aO){const Q=Wy(q,t.markDef,t.config);r.encode.update[q]?(m[q]=r.encode.update[q],delete r.encode.update[q]):Q&&(m[q]=ju(Q)),Q&&(r.encode.update[q]={value:0})}const O=t.fieldDef(t.stack.groupbyChannel),T=ti(O)?[ti(O)]:[];return(O?.bin||O?.timeUnit)&&T.push(ti(O,{binSuffix:"end"})),(m=["stroke","strokeWidth","strokeJoin","strokeCap","strokeDash","strokeDashOffset","strokeMiterLimit","strokeOpacity"].reduce((q,Q)=>{if(r.encode.update[Q])return Object.assign(Object.assign({},q),{[Q]:r.encode.update[Q]});{const se=Wy(Q,t.markDef,t.config);return se!==void 0?Object.assign(Object.assign({},q),{[Q]:ju(se)}):q}},m)).stroke&&(m.strokeForeground={value:!0},m.strokeOffset={value:0}),[{type:"group",from:{facet:{data:t.requestDataName(ff),name:XR+t.requestDataName(ff),groupby:T,aggregate:{fields:[s({suffix:"start"}),s({suffix:"start"}),s({suffix:"end"}),s({suffix:"end"})],ops:["min","max","min","max"]}}},encode:{update:m},marks:[{type:"group",encode:{update:x},marks:[r]}]}]}return Wk(t)}(e):Wk(e)}const KR="faceted_path_",XR="stack_group_";function Wk(e,t={fromPrefix:""}){const{mark:n,markDef:r,config:i}=e,s=Qu(r.clip,function(q){const Q=q.getScaleComponent("x"),se=q.getScaleComponent("y");return!!(Q&&Q.get("selectionExtent")||se&&se.get("selectionExtent"))||void 0}(e),function(q){const Q=q.component.projection;return!(!Q||Q.isFit)||void 0}(e)),f=wI(r),m=e.encoding.key,x=function(q){const{encoding:Q,stack:se,mark:le,markDef:Fe,config:Le}=q,ze=Q.order;if(!(!Gi(ze)&&c0(ze)&&ZT(ze.value)||!ze&&ZT($o("order",Fe,Le)))){if((Gi(ze)||si(ze))&&!se)return EI(ze,{expr:"datum"});if(Iy(le)){const nt=Fe.orient==="horizontal"?"y":"x",it=Q[nt];if(si(it)){const ut=it.sort;return Gi(ut)?{field:ti(it,{prefix:nt,suffix:"sort_index",expr:"datum"})}:Ev(ut)?{field:ti({aggregate:_O(q.encoding)?ut.op:void 0,field:ut.field},{expr:"datum"})}:aI(ut)?{field:ti(q.fieldDef(ut.encoding),{expr:"datum"}),order:ut.order}:ut===null?void 0:{field:ti(it,{binSuffix:q.stack&&q.stack.impute?"mid":void 0,expr:"datum"})}}}}}(e),O=function(q){if(!q.component.selection)return null;const Q=Kr(q.component.selection).length;let se=Q,le=q.parent;for(;le&&se===0;)se=Kr(le.component.selection).length,le=le.parent;return se?{interactive:Q>0}:null}(e),T=$o("aria",r,i),M=Uk[n].postEncodingTransform?Uk[n].postEncodingTransform(e):null;return[Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:e.getName("marks"),type:Uk[n].vgMark},s?{clip:!0}:{}),f?{style:f}:{}),m?{key:m.field}:{}),x?{sort:x}:{}),O||{}),T===!1?{aria:T}:{}),{from:{data:t.fromPrefix+e.requestDataName(ff)},encode:{update:Uk[n].encodeEntry(e)}}),M?{transform:M}:{})]}class YR extends WR{constructor(t,n,r,i={},s){var f,m;super(t,"unit",n,r,s,void 0,WI(t)?t.view:void 0),this.specifiedScales={},this.specifiedAxes={},this.specifiedLegends={},this.specifiedProjection={},this.selection={},this.children=[];const x=hv(t.mark)?t.mark.type:t.mark;this.markDef=MW(t.mark,(f=t.encoding)!==null&&f!==void 0?f:{},s,{graticule:t.data&&qO(t.data)});const O=this.encoding=UL((m=t.encoding)!==null&&m!==void 0?m:{},this.markDef,s);this.size=function({encoding:T,size:M}){for(const q of gm){const Q=xv(q);Av(M[Q])&&Cv(T[q])&&(delete M[Q],Gr(he.stepDropped(Q)))}return M}({encoding:O,size:WI(t)?Object.assign(Object.assign(Object.assign({},i),t.width?{width:t.width}:{}),t.height?{height:t.height}:{}):i}),this.stack=KI(x,O),this.specifiedScales=this.initScales(x,O),this.specifiedAxes=this.initAxes(O),this.specifiedLegends=this.initLegend(O),this.specifiedProjection=t.projection,this.selection=t.selection}get hasProjection(){const{encoding:t}=this,n=this.mark===dN,r=t&&H7.some(i=>Ca(t[i]));return n||r}scaleDomain(t){const n=this.specifiedScales[t];return n?n.domain:void 0}axis(t){return this.specifiedAxes[t]}legend(t){return this.specifiedLegends[t]}initScales(t,n){return qw.reduce((r,i)=>{var s;const f=yc(n[i]);return f&&(r[i]=(s=f.scale)!==null&&s!==void 0?s:{}),r},{})}initAxes(t){return gm.reduce((n,r)=>{const i=t[r];if(Ca(i)||r===ou&&Ca(t.x2)||r===vc&&Ca(t.y2)){const s=Ca(i)?i.axis:void 0;n[r]=s&&Object.assign({},s)}return n},{})}initLegend(t){return J7.reduce((n,r)=>{const i=yc(t[r]);if(i&&function(s){switch(s){case Cd:case vv:case yv:case s0:case Od:case u0:case $0:case G0:return!0;case q0:case H0:case Ry:return!1}}(r)){const s=i.legend;n[r]=s&&Object.assign({},s)}return n},{})}parseData(){this.component.data=zk(this)}parseLayoutSize(){(function(t){const{size:n,component:r}=t;for(const i of gm){const s=xv(i);if(n[s]){const f=n[s];r.layoutSize.set(s,Av(f)?"step":f,!0)}else{const f=OW(t,s);r.layoutSize.set(s,f,!1)}}})(this)}parseSelections(){this.component.selection=function(t,n){var r;const i={},s=t.config.selection;for(const f of Kr(n??{})){const m=$a(n[f]),x=s[m.type],{fields:O,encodings:T}=x,M=Pi(x,["fields","encodings"]);for(const se in M)se==="encodings"&&m.fields||se==="fields"&&m.encodings||(se==="mark"&&(m[se]=Object.assign(Object.assign({},M[se]),m[se])),m[se]!==void 0&&m[se]!==!0||(m[se]=(r=M[se])!==null&&r!==void 0?r:m[se]));const q=Qs(f),Q=i[q]=Object.assign(Object.assign({},m),{name:q,events:Ha(m.on)?Sy(m.on,"scope"):$a(m.on)});vk(Q,se=>{se.has(Q)&&se.parse&&se.parse(t,Q,m,n[f])})}return i}(this,this.selection)}parseMarkGroup(){this.component.mark=jW(this)}parseAxesAndHeaders(){this.component.axes=DW(this)}assembleSelectionTopLevelSignals(t){return function(n,r){let i=!1;return Gy(n,(s,f)=>{const m=s.name,x=go(m+$y);if(r.filter(O=>O.name===m).length===0){const O=s.resolve==="global"?"union":s.resolve,T=s.type==="multi"?", true)":")";r.push({name:s.name,update:`${IF}(${x}, ${go(O)}${T}`})}i=!0,f.topLevelSignals&&(r=f.topLevelSignals(n,s,r)),vk(s,O=>{O.topLevelSignals&&(r=O.topLevelSignals(n,s,r))})}),i&&r.filter(s=>s.name==="unit").length===0&&r.unshift({name:"unit",value:{},on:[{events:"mousemove",update:"isTuple(group()) ? group() : unit"}]}),YO(r)}(this,t)}assembleSignals(){return[...XF(this),...function(t,n){return Gy(t,(r,i)=>{const s=r.name;let f=i.modifyExpr(t,r);n.push(...i.signals(t,r)),vk(r,m=>{m.signals&&(n=m.signals(t,r,n)),m.modifyExpr&&(f=m.modifyExpr(t,r,f))}),n.push({name:s+Pz,on:[{events:{signal:r.name+Sv},update:`modify(${go(r.name+$y)}, ${f})`}]})}),YO(n)}(this,[])]}assembleSelectionData(t){return function(n,r){const i=[...r];return Gy(n,s=>{const f={name:s.name+$y};if(s.init){const m=s.project.items.map(O=>{const{signals:T}=O;return Pi(O,["signals"])}),x=s.init.map(O=>Ib(O,!1));f.values=s.type==="interval"?[{unit:h0(n,{escape:!1}),fields:m,values:x}]:x.map(O=>({unit:h0(n,{escape:!1}),fields:m,values:O}))}i.filter(m=>m.name===s.name+$y).length||i.push(f)}),i}(this,t)}assembleLayout(){return null}assembleLayoutSignals(){return pA(this)}assembleMarks(){var t;let n=(t=this.component.mark)!==null&&t!==void 0?t:[];return this.parent&&Ub(this.parent)||(n=DF(this,n)),n.map(this.correctDataNames)}getMapping(){return this.encoding}get mark(){return this.markDef.type}channelHasField(t){return Vy(this.encoding,t)}fieldDef(t){return Ov(this.encoding[t])}typedFieldDef(t){const n=this.fieldDef(t);return Sp(n)?n:null}}class FA extends SA{constructor(t,n,r,i,s){super(t,"layer",n,r,s,t.resolve,t.view);const f=Object.assign(Object.assign(Object.assign({},i),t.width?{width:t.width}:{}),t.height?{height:t.height}:{});this.children=t.layer.map((m,x)=>{if(ck(m))return new FA(m,this,this.getName("layer_"+x),f,s);if(n0(m))return new YR(m,this,this.getName("layer_"+x),f,s);throw new Error(he.invalidSpec(m))})}parseData(){this.component.data=zk(this);for(const t of this.children)t.parseData()}parseLayoutSize(){(function(t){DA(t),Lk(t,"width"),Lk(t,"height")})(this)}parseSelections(){this.component.selection={};for(const t of this.children){t.parseSelections();for(const n of Kr(t.component.selection))this.component.selection[n]=t.component.selection[n]}}parseMarkGroup(){for(const t of this.children)t.parseMarkGroup()}parseAxesAndHeaders(){(function(t){var n;const{axes:r,resolve:i}=t.component,s={top:0,bottom:0,right:0,left:0};for(const f of t.children){f.parseAxesAndHeaders();for(const m of Kr(f.component.axes))i.axis[m]=mA(t.component.resolve,m),i.axis[m]==="shared"&&(r[m]=NW(r[m],f.component.axes[m]),r[m]||(i.axis[m]="independent",delete r[m]))}for(const f of gm){for(const m of t.children)if(m.component.axes[f]){if(i.axis[f]==="independent"){r[f]=((n=r[f])!==null&&n!==void 0?n:[]).concat(m.component.axes[f]);for(const x of m.component.axes[f]){const{value:O,explicit:T}=x.getWithExplicit("orient");if(!da(O)){if(s[O]>0&&!T){const M=TW[O];s[O]>s[M]&&x.set("orient",M,!1)}s[O]++}}}delete m.component.axes[f]}if(i.axis[f]==="independent"&&r[f]&&r[f].length>1)for(const m of r[f])m.get("grid")&&!m.explicit.grid&&(m.implicit.grid=!1)}})(this)}assembleSelectionTopLevelSignals(t){return this.children.reduce((n,r)=>r.assembleSelectionTopLevelSignals(n),t)}assembleSignals(){return this.children.reduce((t,n)=>t.concat(n.assembleSignals()),XF(this))}assembleLayoutSignals(){return this.children.reduce((t,n)=>t.concat(n.assembleLayoutSignals()),pA(this))}assembleSelectionData(t){return this.children.reduce((n,r)=>r.assembleSelectionData(n),t)}assembleTitle(){let t=super.assembleTitle();if(t)return t;for(const n of this.children)if(t=n.assembleTitle())return t}assembleLayout(){return null}assembleMarks(){return function(t,n){for(const r of t.children)yu(r)&&(n=DF(r,n));return n}(this,this.children.flatMap(t=>t.assembleMarks()))}assembleLegends(){return this.children.reduce((t,n)=>t.concat(n.assembleLegends()),xR(this))}}function RA(e,t,n,r,i){if(Qw(e))return new Tx(e,t,n,i);if(ck(e))return new FA(e,t,n,r,i);if(n0(e))return new YR(e,t,n,r,i);if(function(s){return sk(s)||PO(s)||BO(s)}(e))return new _W(e,t,n,i);throw new Error(he.invalidSpec(e))}function BW(e,t={}){t.logger&&function(n){Gw=n}(t.logger),t.fieldTitle&&mI(t.fieldTitle);try{const n=HI(QT(t.config,e.config)),r=nF(e,n),i=RA(r,null,"",void 0,n);return i.parse(),function(s,f){yA(s.sources);let m=0,x=0;for(let O=0;O<Dk&&SR(s,f);O++)m++;s.sources.map(xA);for(let O=0;O<Dk&&SR(s,f);O++)x++;yA(s.sources),Math.max(m,x)===Dk&&Gr(`Maximum optimization runs(${Dk}) reached.`)}(i.component.data,i),{spec:function(s,f,m={},x){const O=s.config?tz(s.config):void 0,T=[].concat(s.assembleSelectionData([]),function(Fe,Le){var ze,nt;const it=[],ut=VR(it);let st=0;for(const dt of Fe.sources)dt.hasName()||(dt.dataName=`source_${st++}`),ut(dt,dt.assemble());for(const dt of it)dt.transform.length===0&&delete dt.transform;let pt=0;for(const[dt,Qt]of it.entries())((ze=Qt.transform)!==null&&ze!==void 0?ze:[]).length!==0||Qt.source||it.splice(pt++,0,it.splice(dt,1)[0]);for(const dt of it)for(const Qt of(nt=dt.transform)!==null&&nt!==void 0?nt:[])Qt.type==="lookup"&&(Qt.from=Fe.outputNodes[Qt.from].getSource());for(const dt of it)dt.name in Le&&(dt.values=Le[dt.name]);return it}(s.component.data,m)),M=s.assembleProjections(),q=s.assembleTitle(),Q=s.assembleGroupStyle(),se=s.assembleGroupEncodeEntry(!0);let le=s.assembleLayoutSignals();return le=le.filter(Fe=>Fe.name!=="width"&&Fe.name!=="height"||Fe.value===void 0||(f[Fe.name]=+Fe.value,!1)),Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({$schema:"https://vega.github.io/schema/vega/v5.json"},s.description?{description:s.description}:{}),f),q?{title:q}:{}),Q?{style:Q}:{}),se?{encode:{update:se}}:{}),{data:T}),M.length>0?{projections:M}:{}),s.assembleGroup([...le,...s.assembleSelectionTopLevelSignals([])])),O?{config:O}:{}),x?{usermeta:x}:{})}(i,function(s,f,m,x){const O=x.component.layoutSize.get("width"),T=x.component.layoutSize.get("height");if(f===void 0?(f={type:"pad"},x.hasAxisOrientSignalRef()&&(f.resize=!0)):Ha(f)&&(f={type:f}),O&&T&&function(M){return M==="fit"||M==="fit-x"||M==="fit-y"}(f.type)){if(O==="step"&&T==="step")Gr(he.droppingFit()),f.type="pad";else if(O==="step"||T==="step"){const M=O==="step"?"width":"height";Gr(he.droppingFit(Vw(M)));const q=M==="width"?"height":"width";f.type=function(Q){return Q?`fit-${Vw(Q)}`:"fit"}(q)}}return Object.assign(Object.assign(Object.assign({},Kr(f).length===1&&f.type?f.type==="pad"?{}:{autosize:f.type}:{autosize:f}),iF(m)),iF(s))}(e,r.autosize,n,i),e.datasets,e.usermeta),normalized:r}}finally{t.logger&&bL(),t.fieldTitle&&mI(dI)}}const PW=new class extends $I{mapUnit(e,{config:t}){if(e.encoding){const{encoding:n,transform:r}=e,{bins:i,timeUnits:s,aggregate:f,groupby:m,encoding:x}=SO(n,t),O=[...r||[],...i,...s,...f.length===0?[]:[{aggregate:f,groupby:m}]];return Object.assign(Object.assign(Object.assign({},e),O.length>0?{transform:O}:{}),{encoding:x})}return e}};function LW(e,t){return PW.map(e,{config:t})}const zW=d7.version;var JR=function(e){const[t,n]=/schema\/([\w-]+)\/([\w\.\-]+)\.json$/g.exec(e).slice(1,3);return{library:t,version:n}};const UW={background:"#333",title:{color:"#fff",subtitleColor:"#fff"},style:{"guide-label":{fill:"#fff"},"guide-title":{fill:"#fff"}},axis:{domainColor:"#fff",gridColor:"#888",tickColor:"#fff"}},WW={background:"#fff",arc:{fill:"#4572a7"},area:{fill:"#4572a7"},line:{stroke:"#4572a7",strokeWidth:2},path:{stroke:"#4572a7"},rect:{fill:"#4572a7"},shape:{stroke:"#4572a7"},symbol:{fill:"#4572a7",strokeWidth:1.5,size:50},axis:{bandPosition:.5,grid:!0,gridColor:"#000000",gridOpacity:1,gridWidth:.5,labelPadding:10,tickSize:5,tickWidth:.5},axisBand:{grid:!1,tickExtra:!0},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:50,symbolType:"square"},range:{category:["#4572a7","#aa4643","#8aa453","#71598e","#4598ae","#d98445","#94aace","#d09393","#b9cc98","#a99cbc"]}},VW={arc:{fill:"#30a2da"},area:{fill:"#30a2da"},axis:{domainColor:"#cbcbcb",grid:!0,gridColor:"#cbcbcb",gridWidth:1,labelColor:"#999",labelFontSize:10,titleColor:"#333",tickColor:"#cbcbcb",tickSize:10,titleFontSize:14,titlePadding:10,labelPadding:4},axisBand:{grid:!1},background:"#f0f0f0",group:{fill:"#f0f0f0"},legend:{labelColor:"#333",labelFontSize:11,padding:1,symbolSize:30,symbolType:"square",titleColor:"#333",titleFontSize:14,titlePadding:10},line:{stroke:"#30a2da",strokeWidth:2},path:{stroke:"#30a2da",strokeWidth:.5},rect:{fill:"#30a2da"},range:{category:["#30a2da","#fc4f30","#e5ae38","#6d904f","#8b8b8b","#b96db8","#ff9e27","#56cc60","#52d2ca","#52689e","#545454","#9fe4f8"],diverging:["#cc0020","#e77866","#f6e7e1","#d6e8ed","#91bfd9","#1d78b5"],heatmap:["#d6e8ed","#cee0e5","#91bfd9","#549cc6","#1d78b5"]},point:{filled:!0,shape:"circle"},shape:{stroke:"#30a2da"},bar:{binSpacing:2,fill:"#30a2da",stroke:null},title:{anchor:"start",fontSize:24,fontWeight:600,offset:20}},qW={group:{fill:"#e5e5e5"},arc:{fill:"#000"},area:{fill:"#000"},line:{stroke:"#000"},path:{stroke:"#000"},rect:{fill:"#000"},shape:{stroke:"#000"},symbol:{fill:"#000",size:40},axis:{domain:!1,grid:!0,gridColor:"#FFFFFF",gridOpacity:1,labelColor:"#7F7F7F",labelPadding:4,tickColor:"#7F7F7F",tickSize:5.67,titleFontSize:16,titleFontWeight:"normal"},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:40},range:{category:["#000000","#7F7F7F","#1A1A1A","#999999","#333333","#B0B0B0","#4D4D4D","#C9C9C9","#666666","#DCDCDC"]}},MA="Benton Gothic Bold, sans-serif",Nx={"category-6":["#ec8431","#829eb1","#c89d29","#3580b1","#adc839","#ab7fb4"],"fire-7":["#fbf2c7","#f9e39c","#f8d36e","#f4bb6a","#e68a4f","#d15a40","#ab4232"],"fireandice-6":["#e68a4f","#f4bb6a","#f9e39c","#dadfe2","#a6b7c6","#849eae"]},HW={background:"#ffffff",title:{anchor:"start",color:"#000000",font:MA,fontSize:22,fontWeight:"normal"},arc:{fill:"#82c6df"},area:{fill:"#82c6df"},line:{stroke:"#82c6df",strokeWidth:2},path:{stroke:"#82c6df"},rect:{fill:"#82c6df"},shape:{stroke:"#82c6df"},symbol:{fill:"#82c6df",size:30},axis:{labelFont:"Benton Gothic, sans-serif",labelFontSize:11.5,labelFontWeight:"normal",titleFont:MA,titleFontSize:13,titleFontWeight:"normal"},axisX:{labelAngle:0,labelPadding:4,tickSize:3},axisY:{labelBaseline:"middle",maxExtent:45,minExtent:45,tickSize:2,titleAlign:"left",titleAngle:0,titleX:-45,titleY:-11},legend:{labelFont:"Benton Gothic, sans-serif",labelFontSize:11.5,symbolType:"square",titleFont:MA,titleFontSize:13,titleFontWeight:"normal"},range:{category:Nx["category-6"],diverging:Nx["fireandice-6"],heatmap:Nx["fire-7"],ordinal:Nx["fire-7"],ramp:Nx["fire-7"]}},$W={background:"#f9f9f9",arc:{fill:"#ab5787"},area:{fill:"#ab5787"},line:{stroke:"#ab5787"},path:{stroke:"#ab5787"},rect:{fill:"#ab5787"},shape:{stroke:"#ab5787"},symbol:{fill:"#ab5787",size:30},axis:{domainColor:"#979797",domainWidth:.5,gridWidth:.2,labelColor:"#979797",tickColor:"#979797",tickWidth:.2,titleColor:"#979797"},axisBand:{grid:!1},axisX:{grid:!0,tickSize:10},axisY:{domain:!1,grid:!0,tickSize:0},legend:{labelFontSize:11,padding:1,symbolSize:30,symbolType:"square"},range:{category:["#ab5787","#51b2e5","#703c5c","#168dd9","#d190b6","#00609f","#d365ba","#154866","#666666","#c4c4c4"]}},GW={background:"#fff",arc:{fill:"#3e5c69"},area:{fill:"#3e5c69"},line:{stroke:"#3e5c69"},path:{stroke:"#3e5c69"},rect:{fill:"#3e5c69"},shape:{stroke:"#3e5c69"},symbol:{fill:"#3e5c69"},axis:{domainWidth:.5,grid:!0,labelPadding:2,tickSize:5,tickWidth:.5,titleFontWeight:"normal"},axisBand:{grid:!1},axisX:{gridWidth:.2},axisY:{gridDash:[3],gridWidth:.4},legend:{labelFontSize:11,padding:1,symbolType:"square"},range:{category:["#3e5c69","#6793a6","#182429","#0570b0","#3690c0","#74a9cf","#a6bddb","#e2ddf2"]}},Ix={"shades-blue":["#CFE8F3","#A2D4EC","#73BFE2","#46ABDB","#1696D2","#12719E","#0A4C6A","#062635"],"six-groups-cat-1":["#1696d2","#ec008b","#fdbf11","#000000","#d2d2d2","#55b748"],"six-groups-seq":["#cfe8f3","#a2d4ec","#73bfe2","#46abdb","#1696d2","#12719e"],"diverging-colors":["#ca5800","#fdbf11","#fdd870","#fff2cf","#cfe8f3","#73bfe2","#1696d2","#0a4c6a"]},KW={background:"#FFFFFF",title:{anchor:"start",fontSize:18,font:"Lato"},axisX:{domain:!0,domainColor:"#000000",domainWidth:1,grid:!1,labelFontSize:12,labelFont:"Lato",labelAngle:0,tickColor:"#000000",tickSize:5,titleFontSize:12,titlePadding:10,titleFont:"Lato"},axisY:{domain:!1,domainWidth:1,grid:!0,gridColor:"#DEDDDD",gridWidth:1,labelFontSize:12,labelFont:"Lato",labelPadding:8,ticks:!1,titleFontSize:12,titlePadding:10,titleFont:"Lato",titleAngle:0,titleY:-10,titleX:18},legend:{labelFontSize:12,labelFont:"Lato",symbolSize:100,titleFontSize:12,titlePadding:10,titleFont:"Lato",orient:"right",offset:10},view:{stroke:"transparent"},range:{category:Ix["six-groups-cat-1"],diverging:Ix["diverging-colors"],heatmap:Ix["diverging-colors"],ordinal:Ix["six-groups-seq"],ramp:Ix["shades-blue"]},area:{fill:"#1696d2"},rect:{fill:"#1696d2"},line:{color:"#1696d2",stroke:"#1696d2",strokeWidth:5},trail:{color:"#1696d2",stroke:"#1696d2",strokeWidth:0,size:1},path:{stroke:"#1696d2",strokeWidth:.5},point:{filled:!0},text:{font:"Lato",color:"#1696d2",fontSize:11,align:"center",fontWeight:400,size:11},style:{bar:{fill:"#1696d2",stroke:null}},arc:{fill:"#1696d2"},shape:{stroke:"#1696d2"},symbol:{fill:"#1696d2",size:30}},XW={arc:{fill:"#3366CC"},area:{fill:"#3366CC"},path:{stroke:"#3366CC"},rect:{fill:"#3366CC"},shape:{stroke:"#3366CC"},symbol:{stroke:"#3366CC"},circle:{fill:"#3366CC"},background:"#fff",padding:{top:10,right:10,bottom:10,left:10},style:{"guide-label":{font:"Arial, sans-serif",fontSize:12},"guide-title":{font:"Arial, sans-serif",fontSize:12},"group-title":{font:"Arial, sans-serif",fontSize:12}},title:{font:"Arial, sans-serif",fontSize:14,fontWeight:"bold",dy:-3,anchor:"start"},axis:{gridColor:"#ccc",tickColor:"#ccc",domain:!1,grid:!0},range:{category:["#4285F4","#DB4437","#F4B400","#0F9D58","#AB47BC","#00ACC1","#FF7043","#9E9D24","#5C6BC0","#F06292","#00796B","#C2185B"],heatmap:["#c6dafc","#5e97f6","#2a56c6"]}},YW="2.10.0";var JW=`#vg-tooltip-element {
  visibility: hidden;
  padding: 8px;
  position: fixed;
  z-index: 1000;
  font-family: sans-serif;
  font-size: 11px;
  border-radius: 3px;
  box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
  /* The default theme is the light theme. */
  background-color: rgba(255, 255, 255, 0.95);
  border: 1px solid #d9d9d9;
  color: black; }
  #vg-tooltip-element.visible {
    visibility: visible; }
  #vg-tooltip-element h2 {
    margin-top: 0;
    margin-bottom: 10px;
    font-size: 13px; }
  #vg-tooltip-element img {
    max-width: 200px;
    max-height: 200px; }
  #vg-tooltip-element table {
    border-spacing: 0; }
    #vg-tooltip-element table tr {
      border: none; }
      #vg-tooltip-element table tr td {
        overflow: hidden;
        text-overflow: ellipsis;
        padding-top: 2px;
        padding-bottom: 2px; }
        #vg-tooltip-element table tr td.key {
          color: #808080;
          max-width: 150px;
          text-align: right;
          padding-right: 4px; }
        #vg-tooltip-element table tr td.value {
          display: block;
          max-width: 300px;
          max-height: 7em;
          text-align: left; }
  #vg-tooltip-element.dark-theme {
    background-color: rgba(32, 32, 32, 0.9);
    border: 1px solid #f5f5f5;
    color: white; }
    #vg-tooltip-element.dark-theme td.key {
      color: #bfbfbf; }
`;const QR="vg-tooltip-element",QW={offsetX:10,offsetY:10,id:QR,styleId:"vega-tooltip-style",theme:"light",disableDefaultStyle:!1,sanitize:function(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;")},maxDepth:2};function ZW(e,t,n){if(Object(xe.B)(e))return`[${e.map(r=>t(Object(xe.J)(r)?r:ZR(r,n))).join(", ")}]`;if(Object(xe.H)(e)){let r="";const i=e,{title:s,image:f}=i,m=function(O,T){var M={};for(var q in O)Object.prototype.hasOwnProperty.call(O,q)&&T.indexOf(q)<0&&(M[q]=O[q]);if(O!=null&&typeof Object.getOwnPropertySymbols=="function"){var Q=0;for(q=Object.getOwnPropertySymbols(O);Q<q.length;Q++)T.indexOf(q[Q])<0&&Object.prototype.propertyIsEnumerable.call(O,q[Q])&&(M[q[Q]]=O[q[Q]])}return M}(i,["title","image"]);s&&(r+=`<h2>${t(s)}</h2>`),f&&(r+=`<img src="${t(f)}">`);const x=Object.keys(m);if(x.length>0){r+="<table>";for(const O of x){let T=m[O];T!==void 0&&(Object(xe.H)(T)&&(T=ZR(T,n)),r+=`<tr><td class="key">${t(O)}:</td><td class="value">${t(T)}</td></tr>`)}r+="</table>"}return r||"{}"}return t(e)}function ZR(e,t){return JSON.stringify(e,function(n){const r=[];return function(i,s){if(typeof s!="object"||s===null)return s;const f=r.indexOf(this)+1;return r.length=f,r.length>n?"[Object]":r.indexOf(s)>=0?"[Circular]":(r.push(s),s)}}(t))}class eV{constructor(t){this.options=Object.assign(Object.assign({},QW),t);const n=this.options.id;if(this.el=null,this.call=this.tooltipHandler.bind(this),!this.options.disableDefaultStyle&&!document.getElementById(this.options.styleId)){const r=document.createElement("style");r.setAttribute("id",this.options.styleId),r.innerHTML=function(s){if(!/^[A-Za-z]+[-:.\w]*$/.test(s))throw new Error("Invalid HTML ID");return JW.toString().replace(QR,s)}(n);const i=document.head;i.childNodes.length>0?i.insertBefore(r,i.childNodes[0]):i.appendChild(r)}}tooltipHandler(t,n,r,i){if(this.el=document.getElementById(this.options.id),this.el||(this.el=document.createElement("div"),this.el.setAttribute("id",this.options.id),this.el.classList.add("vg-tooltip"),document.body.appendChild(this.el)),(document.fullscreenElement!=null?document.fullscreenElement:document.body).appendChild(this.el),i==null||i==="")return void this.el.classList.remove("visible",`${this.options.theme}-theme`);this.el.innerHTML=ZW(i,this.options.sanitize,this.options.maxDepth),this.el.classList.add("visible",`${this.options.theme}-theme`);const{x:s,y:f}=function(m,x,O,T){let M=m.clientX+O;M+x.width>window.innerWidth&&(M=+m.clientX-O-x.width);let q=m.clientY+T;return q+x.height>window.innerHeight&&(q=+m.clientY-T-x.height),{x:M,y:q}}(n,this.el.getBoundingClientRect(),this.options.offsetX,this.options.offsetY);this.el.setAttribute("style",`top: ${f}px; left: ${s}px`)}}/*! *****************************************************************************
		Copyright (c) Microsoft Corporation.

		Permission to use, copy, modify, and/or distribute this software for any
		purpose with or without fee is hereby granted.

		THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
		REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
		AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
		INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
		LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
		OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
		PERFORMANCE OF THIS SOFTWARE.
		***************************************************************************** */function Vk(e,t,n,r){return new(n||(n=Promise))(function(i,s){function f(O){try{x(r.next(O))}catch(T){s(T)}}function m(O){try{x(r.throw(O))}catch(T){s(T)}}function x(O){O.done?i(O.value):function(T){return T instanceof n?T:new n(function(M){M(T)})}(O.value).then(f,m)}x((r=r.apply(e,[])).next())})}o.d(A,"DEFAULT_ACTIONS",function(){return t5}),o.d(A,"guessMode",function(){return r5}),o.d(A,"vega",function(){return v0}),o.d(A,"vegaLite",function(){return Vb});var jA,tV=`.vega-embed {
  position: relative;
  display: inline-block;
  box-sizing: border-box; }
  .vega-embed.has-actions {
    padding-right: 38px; }
  .vega-embed details:not([open]) > :not(summary) {
    display: none !important; }
  .vega-embed summary {
    list-style: none;
    position: absolute;
    top: 0;
    right: 0;
    padding: 6px;
    z-index: 1000;
    background: white;
    box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);
    color: #1b1e23;
    border: 1px solid #aaa;
    border-radius: 999px;
    opacity: 0.2;
    transition: opacity 0.4s ease-in;
    outline: none;
    cursor: pointer;
    line-height: 0px; }
    .vega-embed summary::-webkit-details-marker {
      display: none; }
    .vega-embed summary:active {
      box-shadow: #aaa 0px 0px 0px 1px inset; }
    .vega-embed summary svg {
      width: 14px;
      height: 14px; }
  .vega-embed details[open] summary {
    opacity: 0.7; }
  .vega-embed:hover summary,
  .vega-embed:focus summary {
    opacity: 1 !important;
    transition: opacity 0.2s ease; }
  .vega-embed .vega-actions {
    position: absolute;
    z-index: 1001;
    top: 35px;
    right: -9px;
    display: flex;
    flex-direction: column;
    padding-bottom: 8px;
    padding-top: 8px;
    border-radius: 4px;
    box-shadow: 0 2px 8px 0 rgba(0, 0, 0, 0.2);
    border: 1px solid #d9d9d9;
    background: white;
    animation-duration: 0.15s;
    animation-name: scale-in;
    animation-timing-function: cubic-bezier(0.2, 0, 0.13, 1.5);
    text-align: left; }
    .vega-embed .vega-actions a {
      padding: 8px 16px;
      font-family: sans-serif;
      font-size: 14px;
      font-weight: 600;
      white-space: nowrap;
      color: #434a56;
      text-decoration: none; }
      .vega-embed .vega-actions a:hover {
        background-color: #f7f7f9;
        color: black; }
    .vega-embed .vega-actions::before, .vega-embed .vega-actions::after {
      content: "";
      display: inline-block;
      position: absolute; }
    .vega-embed .vega-actions::before {
      left: auto;
      right: 14px;
      top: -16px;
      border: 8px solid #0000;
      border-bottom-color: #d9d9d9; }
    .vega-embed .vega-actions::after {
      left: auto;
      right: 15px;
      top: -14px;
      border: 7px solid #0000;
      border-bottom-color: #fff; }
  .vega-embed .chart-wrapper {
    width: 100%;
    height: 100%; }

.vega-embed-wrapper {
  max-width: 100%;
  overflow: auto;
  padding-right: 14px; }

@keyframes scale-in {
  from {
    opacity: 0;
    transform: scale(0.6); }
  to {
    opacity: 1;
    transform: scale(1); } }
`;function e5(e,...t){for(const n of t)nV(e,n);return e}function nV(e,t){for(const n of Object.keys(t))Object(xe.La)(e,n,t[n],!0)}String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return this.substr(!t||t<0?0:+t,e.length)===e});const v0=K;let Vb=pe;const qk=typeof window<"u"?window:void 0;Vb===void 0&&(!((jA=qk?.vl)===null||jA===void 0)&&jA.compile)&&(Vb=qk.vl);const t5={export:{svg:!0,png:!0},source:!0,compiled:!0,editor:!0},rV={CLICK_TO_VIEW_ACTIONS:"Click to view actions",COMPILED_ACTION:"View Compiled Vega",EDITOR_ACTION:"Open in Vega Editor",PNG_ACTION:"Save as PNG",SOURCE_ACTION:"View Source",SVG_ACTION:"Save as SVG"},Fx={vega:"Vega","vega-lite":"Vega-Lite"},Hk={vega:v0.version,"vega-lite":Vb?Vb.version:"not available"},iV={vega:e=>e,"vega-lite":(e,t)=>Vb.compile(e,{config:t}).spec},aV=`
<svg viewBox="0 0 16 16" fill="currentColor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
  <circle r="2" cy="8" cx="2"></circle>
  <circle r="2" cy="8" cx="8"></circle>
  <circle r="2" cy="8" cx="14"></circle>
</svg>`,oV="chart-wrapper";function n5(e,t,n,r){const i=`<html><head>${t}</head><body><pre><code class="json">`,s=`</code></pre>${n}</body></html>`,f=window.open("");f.document.write(i+e+s),f.document.title=`${Fx[r]} JSON Source`}function r5(e,t){var n;if(e.$schema){const r=JR(e.$schema);t&&t!==r.library&&console.warn(`The given visualization spec is written in ${Fx[r.library]}, but mode argument sets ${(n=Fx[t])!==null&&n!==void 0?n:t}.`);const i=r.library;return Object(qn.satisfies)(Hk[i],`^${r.version.slice(1)}`)||console.warn(`The input spec uses ${Fx[i]} ${r.version}, but the current version of ${Fx[i]} is v${Hk[i]}.`),i}return"mark"in e||"encoding"in e||"layer"in e||"hconcat"in e||"vconcat"in e||"facet"in e||"repeat"in e?"vega-lite":"marks"in e||"signals"in e||"scales"in e||"axes"in e?"vega":t??"vega"}function i5(e){return function(t){return!!(t&&"load"in t)}(e)?e:v0.loader(e)}function a5(e){var t;return(t=e.usermeta&&e.usermeta.embedOptions)!==null&&t!==void 0?t:{}}function o5(e,t){var n;return Vk(this,void 0,void 0,function*(){const r=Object(xe.J)(e.config)?JSON.parse(yield t.load(e.config)):(n=e.config)!==null&&n!==void 0?n:{},i=Object(xe.J)(e.patch)?JSON.parse(yield t.load(e.patch)):e.patch;return Object.assign(Object.assign(Object.assign({},e),i?{patch:i}:{}),r?{config:r}:{})})}A.default=function(e,t,n={}){var r,i,s;return Vk(this,void 0,void 0,function*(){let f,m;Object(xe.J)(t)?(m=i5(n.loader),f=JSON.parse(yield m.load(t))):f=t;const x=a5(f).loader;m&&!x||(m=i5((r=n.loader)!==null&&r!==void 0?r:x));const O=yield o5(a5(f),m),T=yield o5(n,m),M=Object.assign(Object.assign({},e5(T,O)),{config:Object(xe.P)((i=T.config)!==null&&i!==void 0?i:{},(s=O.config)!==null&&s!==void 0?s:{})});return yield function(q,Q,se={},le){var Fe,Le,ze,nt,it,ut;return Vk(this,void 0,void 0,function*(){const st=se.theme?Object(xe.P)(Ae[se.theme],(Fe=se.config)!==null&&Fe!==void 0?Fe:{}):se.config,pt=Object(xe.C)(se.actions)?se.actions:e5({},t5,(Le=se.actions)!==null&&Le!==void 0?Le:{}),dt=Object.assign(Object.assign({},rV),se.i18n),Qt=(ze=se.renderer)!==null&&ze!==void 0?ze:"canvas",mn=(nt=se.logLevel)!==null&&nt!==void 0?nt:v0.Warn,on=(it=se.downloadFileName)!==null&&it!==void 0?it:"visualization",Rn=typeof q=="string"?document.querySelector(q):q;if(!Rn)throw new Error(`${q} does not exist`);if(se.defaultStyle!==!1){const vi="vega-embed-style",{root:Li,rootContainer:wi}=function(yi){var Si;const xa=yi.getRootNode?yi.getRootNode():document;return xa instanceof ShadowRoot?{root:xa,rootContainer:xa}:{root:document,rootContainer:(Si=document.head)!==null&&Si!==void 0?Si:document.body}}(Rn);if(!Li.getElementById(vi)){const yi=document.createElement("style");yi.id=vi,yi.innerText=se.defaultStyle===void 0||se.defaultStyle===!0?tV.toString():se.defaultStyle,wi.appendChild(yi)}}const Fn=r5(Q,se.mode);let zn=iV[Fn](Q,st);if(Fn==="vega-lite"&&zn.$schema){const vi=JR(zn.$schema);Object(qn.satisfies)(Hk.vega,`^${vi.version.slice(1)}`)||console.warn(`The compiled spec uses Vega ${vi.version}, but current version is v${Hk.vega}.`)}Rn.classList.add("vega-embed"),pt&&Rn.classList.add("has-actions"),Rn.innerHTML="";let Vn=Rn;if(pt){const vi=document.createElement("div");vi.classList.add(oV),Rn.appendChild(vi),Vn=vi}const Qn=se.patch;Qn&&(zn=Qn instanceof Function?Qn(zn):bn(zn,Qn,!0,!1).newDocument),se.formatLocale&&v0.formatLocale(se.formatLocale),se.timeFormatLocale&&v0.timeFormatLocale(se.timeFormatLocale);const{ast:pr}=se,Pr=v0.parse(zn,Fn==="vega-lite"?{}:st,{ast:pr}),Ar=new(se.viewClass||v0.View)(Pr,Object.assign({loader:le,logLevel:mn,renderer:Qt},pr?{expr:v0.expressionInterpreter}:{}));if(se.tooltip!==!1){let vi;vi=function(Li){return typeof Li=="function"}(se.tooltip)?se.tooltip:new eV(se.tooltip===!0?{}:se.tooltip).call,Ar.tooltip(vi)}let Jr,{hover:gi}=se;if(gi===void 0&&(gi=Fn==="vega"),gi){const{hoverSet:vi,updateSet:Li}=typeof gi=="boolean"?{}:gi;Ar.hover(vi,Li)}if(se&&(se.width!=null&&Ar.width(se.width),se.height!=null&&Ar.height(se.height),se.padding!=null&&Ar.padding(se.padding)),yield Ar.initialize(Vn,se.bind).runAsync(),pt!==!1){let vi=Rn;if(se.defaultStyle!==!1){const wi=document.createElement("details");wi.title=dt.CLICK_TO_VIEW_ACTIONS,Rn.append(wi),vi=wi;const yi=document.createElement("summary");yi.innerHTML=aV,wi.append(yi),Jr=Si=>{wi.contains(Si.target)||wi.removeAttribute("open")},document.addEventListener("click",Jr)}const Li=document.createElement("div");if(vi.append(Li),Li.classList.add("vega-actions"),pt===!0||pt.export!==!1){for(const wi of["svg","png"])if(pt===!0||pt.export===!0||pt.export[wi]){const yi=dt[`${wi.toUpperCase()}_ACTION`],Si=document.createElement("a");Si.text=yi,Si.href="#",Si.target="_blank",Si.download=`${on}.${wi}`,Si.addEventListener("mousedown",function(xa){return Vk(this,void 0,void 0,function*(){xa.preventDefault();const no=yield Ar.toImageURL(wi,se.scaleFactor);this.href=no})}),Li.append(Si)}}if(pt===!0||pt.source!==!1){const wi=document.createElement("a");wi.text=dt.SOURCE_ACTION,wi.href="#",wi.addEventListener("click",function(yi){var Si,xa;n5(kn()(Q),(Si=se.sourceHeader)!==null&&Si!==void 0?Si:"",(xa=se.sourceFooter)!==null&&xa!==void 0?xa:"",Fn),yi.preventDefault()}),Li.append(wi)}if(Fn==="vega-lite"&&(pt===!0||pt.compiled!==!1)){const wi=document.createElement("a");wi.text=dt.COMPILED_ACTION,wi.href="#",wi.addEventListener("click",function(yi){var Si,xa;n5(kn()(zn),(Si=se.sourceHeader)!==null&&Si!==void 0?Si:"",(xa=se.sourceFooter)!==null&&xa!==void 0?xa:"","vega"),yi.preventDefault()}),Li.append(wi)}if(pt===!0||pt.editor!==!1){const wi=(ut=se.editorUrl)!==null&&ut!==void 0?ut:"https://vega.github.io/editor/",yi=document.createElement("a");yi.text=dt.EDITOR_ACTION,yi.href="#",yi.addEventListener("click",function(Si){(function(xa,no,zi){const vo=xa.open(no),Lo=250,{origin:co}=new URL(no);let Is=40;xa.addEventListener("message",function Fs(gs){gs.source===vo&&(Is=0,xa.removeEventListener("message",Fs,!1))},!1),setTimeout(function Fs(){Is<=0||(vo.postMessage(zi,co),setTimeout(Fs,Lo),Is-=1)},Lo)})(window,wi,{config:st,mode:Fn,renderer:Qt,spec:kn()(Q)}),Si.preventDefault()}),Li.append(yi)}}return{view:Ar,spec:Q,vgSpec:zn,finalize:function(){Jr&&document.removeEventListener("click",Jr),Ar.finalize()}}})}(e,f,M,m)})}},function(Oe,A,o){const{MAX_LENGTH:b}=o(117),{re:H,t:U}=o(90),B=o(32),re=o(115);Oe.exports=(J,R)=>{if(R=re(R),J instanceof B)return J;if(typeof J!="string"||J.length>b||!(R.loose?H[U.LOOSE]:H[U.FULL]).test(J))return null;try{return new B(J,R)}catch{return null}}},function(Oe,A,o){const{MAX_SAFE_COMPONENT_LENGTH:b}=o(117),H=o(116),U=(A=Oe.exports={}).re=[],B=A.src=[],re=A.t={};let J=0;const R=(P,$,L)=>{const ee=J++;H(ee,$),re[P]=ee,B[ee]=$,U[ee]=new RegExp($,L?"g":void 0)};R("NUMERICIDENTIFIER","0|[1-9]\\d*"),R("NUMERICIDENTIFIERLOOSE","[0-9]+"),R("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*"),R("MAINVERSION",`(${B[re.NUMERICIDENTIFIER]})\\.(${B[re.NUMERICIDENTIFIER]})\\.(${B[re.NUMERICIDENTIFIER]})`),R("MAINVERSIONLOOSE",`(${B[re.NUMERICIDENTIFIERLOOSE]})\\.(${B[re.NUMERICIDENTIFIERLOOSE]})\\.(${B[re.NUMERICIDENTIFIERLOOSE]})`),R("PRERELEASEIDENTIFIER",`(?:${B[re.NUMERICIDENTIFIER]}|${B[re.NONNUMERICIDENTIFIER]})`),R("PRERELEASEIDENTIFIERLOOSE",`(?:${B[re.NUMERICIDENTIFIERLOOSE]}|${B[re.NONNUMERICIDENTIFIER]})`),R("PRERELEASE",`(?:-(${B[re.PRERELEASEIDENTIFIER]}(?:\\.${B[re.PRERELEASEIDENTIFIER]})*))`),R("PRERELEASELOOSE",`(?:-?(${B[re.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${B[re.PRERELEASEIDENTIFIERLOOSE]})*))`),R("BUILDIDENTIFIER","[0-9A-Za-z-]+"),R("BUILD",`(?:\\+(${B[re.BUILDIDENTIFIER]}(?:\\.${B[re.BUILDIDENTIFIER]})*))`),R("FULLPLAIN",`v?${B[re.MAINVERSION]}${B[re.PRERELEASE]}?${B[re.BUILD]}?`),R("FULL",`^${B[re.FULLPLAIN]}$`),R("LOOSEPLAIN",`[v=\\s]*${B[re.MAINVERSIONLOOSE]}${B[re.PRERELEASELOOSE]}?${B[re.BUILD]}?`),R("LOOSE",`^${B[re.LOOSEPLAIN]}$`),R("GTLT","((?:<|>)?=?)"),R("XRANGEIDENTIFIERLOOSE",`${B[re.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),R("XRANGEIDENTIFIER",`${B[re.NUMERICIDENTIFIER]}|x|X|\\*`),R("XRANGEPLAIN",`[v=\\s]*(${B[re.XRANGEIDENTIFIER]})(?:\\.(${B[re.XRANGEIDENTIFIER]})(?:\\.(${B[re.XRANGEIDENTIFIER]})(?:${B[re.PRERELEASE]})?${B[re.BUILD]}?)?)?`),R("XRANGEPLAINLOOSE",`[v=\\s]*(${B[re.XRANGEIDENTIFIERLOOSE]})(?:\\.(${B[re.XRANGEIDENTIFIERLOOSE]})(?:\\.(${B[re.XRANGEIDENTIFIERLOOSE]})(?:${B[re.PRERELEASELOOSE]})?${B[re.BUILD]}?)?)?`),R("XRANGE",`^${B[re.GTLT]}\\s*${B[re.XRANGEPLAIN]}$`),R("XRANGELOOSE",`^${B[re.GTLT]}\\s*${B[re.XRANGEPLAINLOOSE]}$`),R("COERCE",`(^|[^\\d])(\\d{1,${b}})(?:\\.(\\d{1,${b}}))?(?:\\.(\\d{1,${b}}))?(?:$|[^\\d])`),R("COERCERTL",B[re.COERCE],!0),R("LONETILDE","(?:~>?)"),R("TILDETRIM",`(\\s*)${B[re.LONETILDE]}\\s+`,!0),A.tildeTrimReplace="$1~",R("TILDE",`^${B[re.LONETILDE]}${B[re.XRANGEPLAIN]}$`),R("TILDELOOSE",`^${B[re.LONETILDE]}${B[re.XRANGEPLAINLOOSE]}$`),R("LONECARET","(?:\\^)"),R("CARETTRIM",`(\\s*)${B[re.LONECARET]}\\s+`,!0),A.caretTrimReplace="$1^",R("CARET",`^${B[re.LONECARET]}${B[re.XRANGEPLAIN]}$`),R("CARETLOOSE",`^${B[re.LONECARET]}${B[re.XRANGEPLAINLOOSE]}$`),R("COMPARATORLOOSE",`^${B[re.GTLT]}\\s*(${B[re.LOOSEPLAIN]})$|^$`),R("COMPARATOR",`^${B[re.GTLT]}\\s*(${B[re.FULLPLAIN]})$|^$`),R("COMPARATORTRIM",`(\\s*)${B[re.GTLT]}\\s*(${B[re.LOOSEPLAIN]}|${B[re.XRANGEPLAIN]})`,!0),A.comparatorTrimReplace="$1$2$3",R("HYPHENRANGE",`^\\s*(${B[re.XRANGEPLAIN]})\\s+-\\s+(${B[re.XRANGEPLAIN]})\\s*$`),R("HYPHENRANGELOOSE",`^\\s*(${B[re.XRANGEPLAINLOOSE]})\\s+-\\s+(${B[re.XRANGEPLAINLOOSE]})\\s*$`),R("STAR","(<|>)?=?\\s*\\*"),R("GTE0","^\\s*>=\\s*0.0.0\\s*$"),R("GTE0PRE","^\\s*>=\\s*0.0.0-0\\s*$")},function(Oe,A,o){/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});var b=o(25),H=o(103),U=o(29),B=o(21),re=o(373),J=o(28);function R(L,ee,F,ue){if(ue==null&&(ue=B.inferDtype(L)),ue==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!B.isTypedArray(L)&&!Array.isArray(L)&&typeof L!="number"&&typeof L!="boolean"&&typeof L!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(ee!=null){B.assertNonNegativeIntegerDimensions(ee);var ie=B.sizeFromShape(ee),K=B.sizeFromShape(F);B.assert(ie===K,function(){return"Based on the provided shape, ["+ee+"], the tensor should have "+ie+" values but has "+K});for(var he=0;he<F.length;++he){var pe=F[he],Ae=he!==F.length-1||pe!==B.sizeFromShape(ee.slice(he));B.assert(F[he]===ee[he]||!Ae,function(){return"Error creating a new Tensor. Inferred shape ("+F+") does not match the provided shape ("+ee+"). "})}}return B.isTypedArray(L)||Array.isArray(L)||(L=[L]),ee=ee||F,L=ue!=="string"?B.toTypedArray(L,ue,H.env().getBool("DEBUG")):B.flatten(L,[],!0),b.ENGINE.makeTensor(L,ee,ue)}function P(L,ee){B.assertNonNull(L);var F=U.inferShape(L,ee);if(F.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return R(L,null,F,ee)}function $(L,ee){if(ee===void 0&&(ee="float32"),ee==="complex64"){var F=$(L,"float32"),ue=$(L,"float32");return re.complex(F,ue)}var ie=B.makeZerosTypedArray(B.sizeFromShape(L),ee);return b.ENGINE.makeTensor(ie,L,ee)}A.tensor=function(L,ee,F){return R(L,ee,U.inferShape(L,F),F)},A.scalar=function(L,ee){if((B.isTypedArray(L)&&ee!=="string"||Array.isArray(L))&&ee!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(ee==="string"&&B.isTypedArray(L)&&!(L instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return R(L,[],[],ee)},A.tensor1d=P,A.tensor2d=function(L,ee,F){if(B.assertNonNull(L),ee!=null&&ee.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var ue=U.inferShape(L,F);if(ue.length!==2&&ue.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(ue.length===1&&ee==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return R(L,ee,ue,F)},A.tensor3d=function(L,ee,F){if(B.assertNonNull(L),ee!=null&&ee.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var ue=U.inferShape(L,F);if(ue.length!==3&&ue.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(ue.length===1&&ee==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return R(L,ee,ue,F)},A.tensor4d=function(L,ee,F){if(B.assertNonNull(L),ee!=null&&ee.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var ue=U.inferShape(L,F);if(ue.length!==4&&ue.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(ue.length===1&&ee==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return R(L,ee,ue,F)},A.tensor5d=function(L,ee,F){if(B.assertNonNull(L),ee!=null&&ee.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var ue=U.inferShape(L,F);if(ue.length!==5&&ue.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(ue.length===1&&ee==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return R(L,ee,ue,F)},A.tensor6d=function(L,ee,F){if(B.assertNonNull(L),ee!=null&&ee.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var ue=U.inferShape(L,F);if(ue.length!==6&&ue.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(ue.length===1&&ee==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return R(L,ee=ee||ue,ue,F)},A.variable=function(L,ee,F,ue){return ee===void 0&&(ee=!0),b.ENGINE.makeVariable(L,ee,F,ue)},A.ones=function L(ee,F){if(F===void 0&&(F="float32"),F==="complex64"){var ue=L(ee,"float32"),ie=$(ee,"float32");return re.complex(ue,ie)}var K=B.makeOnesTypedArray(B.sizeFromShape(ee),F);return b.ENGINE.makeTensor(K,ee,F)},A.zeros=$,A.fill=function(L,ee,F){return b.ENGINE.runKernelFunc(function(ue){return ue.fill(L,ee,F)},{})},A.linspace=function(L,ee,F){if(F<=0)throw new Error("The number of values should be positive.");return b.ENGINE.runKernelFunc(function(ue){return ue.linspace(L,ee,F)},{})},A.range=function(L,ee,F,ue){if(F===void 0&&(F=1),ue===void 0&&(ue="float32"),F===0)throw new Error("Cannot have a step of zero");if(L===ee||L<ee&&F<0||ee<L&&F>1)return $([0],ue);var ie=Math.abs(Math.ceil((ee-L)/F)),K=B.makeZerosTypedArray(ie,ue);ee<L&&F===1&&(F=-1),K[0]=L;for(var he=1;he<K.length;he++)K[he]=K[he-1]+F;return P(K,ue)},A.onesLike=J.op({onesLike_:function(L){var ee=U.convertToTensor(L,"x","onesLike");if(ee.dtype==="complex64"){var F=A.onesLike(re.real(ee)),ue=A.zerosLike(re.imag(ee));return re.complex(F,ue)}return b.ENGINE.runKernelFunc(function(ie){return ie.onesLike(ee)},{x:ee},function(ie,K){return{x:function(){return A.zerosLike(ie)}}},"OnesLike")}}),A.zerosLike=J.op({zerosLike_:function(L){var ee=U.convertToTensor(L,"x","zerosLike");return b.ENGINE.runKernelFunc(function(F){return F.zerosLike(ee)},{x:ee},function(F,ue){return{x:function(){return A.zerosLike(F)}}},"ZerosLike")}})},function(Oe,A,o){(function(b){/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <http://feross.org>
 * @license  MIT
 */var H=o(394),U=o(393),B=o(392);function re(){return R.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function J(We,Pe){if(re()<Pe)throw new RangeError("Invalid typed array length");return R.TYPED_ARRAY_SUPPORT?(We=new Uint8Array(Pe)).__proto__=R.prototype:(We===null&&(We=new R(Pe)),We.length=Pe),We}function R(We,Pe,rt){if(!(R.TYPED_ARRAY_SUPPORT||this instanceof R))return new R(We,Pe,rt);if(typeof We=="number"){if(typeof Pe=="string")throw new Error("If encoding is specified then the first argument must be a string");return L(this,We)}return P(this,We,Pe,rt)}function P(We,Pe,rt,Et){if(typeof Pe=="number")throw new TypeError('"value" argument must not be a number');return typeof ArrayBuffer<"u"&&Pe instanceof ArrayBuffer?function(Lt,rn,Sn,kn){if(rn.byteLength,Sn<0||rn.byteLength<Sn)throw new RangeError("'offset' is out of bounds");if(rn.byteLength<Sn+(kn||0))throw new RangeError("'length' is out of bounds");return rn=Sn===void 0&&kn===void 0?new Uint8Array(rn):kn===void 0?new Uint8Array(rn,Sn):new Uint8Array(rn,Sn,kn),R.TYPED_ARRAY_SUPPORT?(Lt=rn).__proto__=R.prototype:Lt=ee(Lt,rn),Lt}(We,Pe,rt,Et):typeof Pe=="string"?function(Lt,rn,Sn){if(typeof Sn=="string"&&Sn!==""||(Sn="utf8"),!R.isEncoding(Sn))throw new TypeError('"encoding" must be a valid string encoding');var kn=0|ue(rn,Sn),qn=(Lt=J(Lt,kn)).write(rn,Sn);return qn!==kn&&(Lt=Lt.slice(0,qn)),Lt}(We,Pe,rt):function(Lt,rn){if(R.isBuffer(rn)){var Sn=0|F(rn.length);return(Lt=J(Lt,Sn)).length===0||rn.copy(Lt,0,0,Sn),Lt}if(rn){if(typeof ArrayBuffer<"u"&&rn.buffer instanceof ArrayBuffer||"length"in rn)return typeof rn.length!="number"||function(kn){return kn!=kn}(rn.length)?J(Lt,0):ee(Lt,rn);if(rn.type==="Buffer"&&B(rn.data))return ee(Lt,rn.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(We,Pe)}function $(We){if(typeof We!="number")throw new TypeError('"size" argument must be a number');if(We<0)throw new RangeError('"size" argument must not be negative')}function L(We,Pe){if($(Pe),We=J(We,Pe<0?0:0|F(Pe)),!R.TYPED_ARRAY_SUPPORT)for(var rt=0;rt<Pe;++rt)We[rt]=0;return We}function ee(We,Pe){var rt=Pe.length<0?0:0|F(Pe.length);We=J(We,rt);for(var Et=0;Et<rt;Et+=1)We[Et]=255&Pe[Et];return We}function F(We){if(We>=re())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+re().toString(16)+" bytes");return 0|We}function ue(We,Pe){if(R.isBuffer(We))return We.length;if(typeof ArrayBuffer<"u"&&typeof ArrayBuffer.isView=="function"&&(ArrayBuffer.isView(We)||We instanceof ArrayBuffer))return We.byteLength;typeof We!="string"&&(We=""+We);var rt=We.length;if(rt===0)return 0;for(var Et=!1;;)switch(Pe){case"ascii":case"latin1":case"binary":return rt;case"utf8":case"utf-8":case void 0:return In(We).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*rt;case"hex":return rt>>>1;case"base64":return Yn(We).length;default:if(Et)return In(We).length;Pe=(""+Pe).toLowerCase(),Et=!0}}function ie(We,Pe,rt){var Et=We[Pe];We[Pe]=We[rt],We[rt]=Et}function K(We,Pe,rt,Et,Lt){if(We.length===0)return-1;if(typeof rt=="string"?(Et=rt,rt=0):rt>2147483647?rt=2147483647:rt<-2147483648&&(rt=-2147483648),rt=+rt,isNaN(rt)&&(rt=Lt?0:We.length-1),rt<0&&(rt=We.length+rt),rt>=We.length){if(Lt)return-1;rt=We.length-1}else if(rt<0){if(!Lt)return-1;rt=0}if(typeof Pe=="string"&&(Pe=R.from(Pe,Et)),R.isBuffer(Pe))return Pe.length===0?-1:he(We,Pe,rt,Et,Lt);if(typeof Pe=="number")return Pe&=255,R.TYPED_ARRAY_SUPPORT&&typeof Uint8Array.prototype.indexOf=="function"?Lt?Uint8Array.prototype.indexOf.call(We,Pe,rt):Uint8Array.prototype.lastIndexOf.call(We,Pe,rt):he(We,[Pe],rt,Et,Lt);throw new TypeError("val must be string, number or Buffer")}function he(We,Pe,rt,Et,Lt){var rn,Sn=1,kn=We.length,qn=Pe.length;if(Et!==void 0&&((Et=String(Et).toLowerCase())==="ucs2"||Et==="ucs-2"||Et==="utf16le"||Et==="utf-16le")){if(We.length<2||Pe.length<2)return-1;Sn=2,kn/=2,qn/=2,rt/=2}function xe(dr,Rr){return Sn===1?dr[Rr]:dr.readUInt16BE(Rr*Sn)}if(Lt){var Xn=-1;for(rn=rt;rn<kn;rn++)if(xe(We,rn)===xe(Pe,Xn===-1?0:rn-Xn)){if(Xn===-1&&(Xn=rn),rn-Xn+1===qn)return Xn*Sn}else Xn!==-1&&(rn-=rn-Xn),Xn=-1}else for(rt+qn>kn&&(rt=kn-qn),rn=rt;rn>=0;rn--){for(var br=!0,Cr=0;Cr<qn;Cr++)if(xe(We,rn+Cr)!==xe(Pe,Cr)){br=!1;break}if(br)return rn}return-1}function pe(We,Pe,rt,Et){rt=Number(rt)||0;var Lt=We.length-rt;Et?(Et=Number(Et))>Lt&&(Et=Lt):Et=Lt;var rn=Pe.length;if(rn%2!=0)throw new TypeError("Invalid hex string");Et>rn/2&&(Et=rn/2);for(var Sn=0;Sn<Et;++Sn){var kn=parseInt(Pe.substr(2*Sn,2),16);if(isNaN(kn))return Sn;We[rt+Sn]=kn}return Sn}function Ae(We,Pe,rt,Et){return fn(In(Pe,We.length-rt),We,rt,Et)}function Te(We,Pe,rt,Et){return fn(function(Lt){for(var rn=[],Sn=0;Sn<Lt.length;++Sn)rn.push(255&Lt.charCodeAt(Sn));return rn}(Pe),We,rt,Et)}function je(We,Pe,rt,Et){return Te(We,Pe,rt,Et)}function ke(We,Pe,rt,Et){return fn(Yn(Pe),We,rt,Et)}function at(We,Pe,rt,Et){return fn(function(Lt,rn){for(var Sn,kn,qn,xe=[],Xn=0;Xn<Lt.length&&!((rn-=2)<0);++Xn)Sn=Lt.charCodeAt(Xn),kn=Sn>>8,qn=Sn%256,xe.push(qn),xe.push(kn);return xe}(Pe,We.length-rt),We,rt,Et)}function St(We,Pe,rt){return Pe===0&&rt===We.length?H.fromByteArray(We):H.fromByteArray(We.slice(Pe,rt))}function zt(We,Pe,rt){rt=Math.min(We.length,rt);for(var Et=[],Lt=Pe;Lt<rt;){var rn,Sn,kn,qn,xe=We[Lt],Xn=null,br=xe>239?4:xe>223?3:xe>191?2:1;if(Lt+br<=rt)switch(br){case 1:xe<128&&(Xn=xe);break;case 2:(192&(rn=We[Lt+1]))==128&&(qn=(31&xe)<<6|63&rn)>127&&(Xn=qn);break;case 3:rn=We[Lt+1],Sn=We[Lt+2],(192&rn)==128&&(192&Sn)==128&&(qn=(15&xe)<<12|(63&rn)<<6|63&Sn)>2047&&(qn<55296||qn>57343)&&(Xn=qn);break;case 4:rn=We[Lt+1],Sn=We[Lt+2],kn=We[Lt+3],(192&rn)==128&&(192&Sn)==128&&(192&kn)==128&&(qn=(15&xe)<<18|(63&rn)<<12|(63&Sn)<<6|63&kn)>65535&&qn<1114112&&(Xn=qn)}Xn===null?(Xn=65533,br=1):Xn>65535&&(Xn-=65536,Et.push(Xn>>>10&1023|55296),Xn=56320|1023&Xn),Et.push(Xn),Lt+=br}return function(Cr){var dr=Cr.length;if(dr<=$t)return String.fromCharCode.apply(String,Cr);for(var Rr="",hn=0;hn<dr;)Rr+=String.fromCharCode.apply(String,Cr.slice(hn,hn+=$t));return Rr}(Et)}A.Buffer=R,A.SlowBuffer=function(We){return+We!=We&&(We=0),R.alloc(+We)},A.INSPECT_MAX_BYTES=50,R.TYPED_ARRAY_SUPPORT=b.TYPED_ARRAY_SUPPORT!==void 0?b.TYPED_ARRAY_SUPPORT:function(){try{var We=new Uint8Array(1);return We.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},We.foo()===42&&typeof We.subarray=="function"&&We.subarray(1,1).byteLength===0}catch{return!1}}(),A.kMaxLength=re(),R.poolSize=8192,R._augment=function(We){return We.__proto__=R.prototype,We},R.from=function(We,Pe,rt){return P(null,We,Pe,rt)},R.TYPED_ARRAY_SUPPORT&&(R.prototype.__proto__=Uint8Array.prototype,R.__proto__=Uint8Array,typeof Symbol<"u"&&Symbol.species&&R[Symbol.species]===R&&Object.defineProperty(R,Symbol.species,{value:null,configurable:!0})),R.alloc=function(We,Pe,rt){return function(Et,Lt,rn,Sn){return $(Lt),Lt<=0?J(Et,Lt):rn!==void 0?typeof Sn=="string"?J(Et,Lt).fill(rn,Sn):J(Et,Lt).fill(rn):J(Et,Lt)}(null,We,Pe,rt)},R.allocUnsafe=function(We){return L(null,We)},R.allocUnsafeSlow=function(We){return L(null,We)},R.isBuffer=function(We){return!(We==null||!We._isBuffer)},R.compare=function(We,Pe){if(!R.isBuffer(We)||!R.isBuffer(Pe))throw new TypeError("Arguments must be Buffers");if(We===Pe)return 0;for(var rt=We.length,Et=Pe.length,Lt=0,rn=Math.min(rt,Et);Lt<rn;++Lt)if(We[Lt]!==Pe[Lt]){rt=We[Lt],Et=Pe[Lt];break}return rt<Et?-1:Et<rt?1:0},R.isEncoding=function(We){switch(String(We).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},R.concat=function(We,Pe){if(!B(We))throw new TypeError('"list" argument must be an Array of Buffers');if(We.length===0)return R.alloc(0);var rt;if(Pe===void 0)for(Pe=0,rt=0;rt<We.length;++rt)Pe+=We[rt].length;var Et=R.allocUnsafe(Pe),Lt=0;for(rt=0;rt<We.length;++rt){var rn=We[rt];if(!R.isBuffer(rn))throw new TypeError('"list" argument must be an Array of Buffers');rn.copy(Et,Lt),Lt+=rn.length}return Et},R.byteLength=ue,R.prototype._isBuffer=!0,R.prototype.swap16=function(){var We=this.length;if(We%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var Pe=0;Pe<We;Pe+=2)ie(this,Pe,Pe+1);return this},R.prototype.swap32=function(){var We=this.length;if(We%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var Pe=0;Pe<We;Pe+=4)ie(this,Pe,Pe+3),ie(this,Pe+1,Pe+2);return this},R.prototype.swap64=function(){var We=this.length;if(We%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var Pe=0;Pe<We;Pe+=8)ie(this,Pe,Pe+7),ie(this,Pe+1,Pe+6),ie(this,Pe+2,Pe+5),ie(this,Pe+3,Pe+4);return this},R.prototype.toString=function(){var We=0|this.length;return We===0?"":arguments.length===0?zt(this,0,We):(function(Pe,rt,Et){var Lt=!1;if((rt===void 0||rt<0)&&(rt=0),rt>this.length||((Et===void 0||Et>this.length)&&(Et=this.length),Et<=0)||(Et>>>=0)<=(rt>>>=0))return"";for(Pe||(Pe="utf8");;)switch(Pe){case"hex":return Gt(this,rt,Et);case"utf8":case"utf-8":return zt(this,rt,Et);case"ascii":return we(this,rt,Et);case"latin1":case"binary":return Tt(this,rt,Et);case"base64":return St(this,rt,Et);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Pt(this,rt,Et);default:if(Lt)throw new TypeError("Unknown encoding: "+Pe);Pe=(Pe+"").toLowerCase(),Lt=!0}}).apply(this,arguments)},R.prototype.equals=function(We){if(!R.isBuffer(We))throw new TypeError("Argument must be a Buffer");return this===We||R.compare(this,We)===0},R.prototype.inspect=function(){var We="",Pe=A.INSPECT_MAX_BYTES;return this.length>0&&(We=this.toString("hex",0,Pe).match(/.{2}/g).join(" "),this.length>Pe&&(We+=" ... ")),"<Buffer "+We+">"},R.prototype.compare=function(We,Pe,rt,Et,Lt){if(!R.isBuffer(We))throw new TypeError("Argument must be a Buffer");if(Pe===void 0&&(Pe=0),rt===void 0&&(rt=We?We.length:0),Et===void 0&&(Et=0),Lt===void 0&&(Lt=this.length),Pe<0||rt>We.length||Et<0||Lt>this.length)throw new RangeError("out of range index");if(Et>=Lt&&Pe>=rt)return 0;if(Et>=Lt)return-1;if(Pe>=rt)return 1;if(Pe>>>=0,rt>>>=0,Et>>>=0,Lt>>>=0,this===We)return 0;for(var rn=Lt-Et,Sn=rt-Pe,kn=Math.min(rn,Sn),qn=this.slice(Et,Lt),xe=We.slice(Pe,rt),Xn=0;Xn<kn;++Xn)if(qn[Xn]!==xe[Xn]){rn=qn[Xn],Sn=xe[Xn];break}return rn<Sn?-1:Sn<rn?1:0},R.prototype.includes=function(We,Pe,rt){return this.indexOf(We,Pe,rt)!==-1},R.prototype.indexOf=function(We,Pe,rt){return K(this,We,Pe,rt,!0)},R.prototype.lastIndexOf=function(We,Pe,rt){return K(this,We,Pe,rt,!1)},R.prototype.write=function(We,Pe,rt,Et){if(Pe===void 0)Et="utf8",rt=this.length,Pe=0;else if(rt===void 0&&typeof Pe=="string")Et=Pe,rt=this.length,Pe=0;else{if(!isFinite(Pe))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");Pe|=0,isFinite(rt)?(rt|=0,Et===void 0&&(Et="utf8")):(Et=rt,rt=void 0)}var Lt=this.length-Pe;if((rt===void 0||rt>Lt)&&(rt=Lt),We.length>0&&(rt<0||Pe<0)||Pe>this.length)throw new RangeError("Attempt to write outside buffer bounds");Et||(Et="utf8");for(var rn=!1;;)switch(Et){case"hex":return pe(this,We,Pe,rt);case"utf8":case"utf-8":return Ae(this,We,Pe,rt);case"ascii":return Te(this,We,Pe,rt);case"latin1":case"binary":return je(this,We,Pe,rt);case"base64":return ke(this,We,Pe,rt);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return at(this,We,Pe,rt);default:if(rn)throw new TypeError("Unknown encoding: "+Et);Et=(""+Et).toLowerCase(),rn=!0}},R.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var $t=4096;function we(We,Pe,rt){var Et="";rt=Math.min(We.length,rt);for(var Lt=Pe;Lt<rt;++Lt)Et+=String.fromCharCode(127&We[Lt]);return Et}function Tt(We,Pe,rt){var Et="";rt=Math.min(We.length,rt);for(var Lt=Pe;Lt<rt;++Lt)Et+=String.fromCharCode(We[Lt]);return Et}function Gt(We,Pe,rt){var Et=We.length;(!Pe||Pe<0)&&(Pe=0),(!rt||rt<0||rt>Et)&&(rt=Et);for(var Lt="",rn=Pe;rn<rt;++rn)Lt+=xn(We[rn]);return Lt}function Pt(We,Pe,rt){for(var Et=We.slice(Pe,rt),Lt="",rn=0;rn<Et.length;rn+=2)Lt+=String.fromCharCode(Et[rn]+256*Et[rn+1]);return Lt}function Ye(We,Pe,rt){if(We%1!=0||We<0)throw new RangeError("offset is not uint");if(We+Pe>rt)throw new RangeError("Trying to access beyond buffer length")}function ln(We,Pe,rt,Et,Lt,rn){if(!R.isBuffer(We))throw new TypeError('"buffer" argument must be a Buffer instance');if(Pe>Lt||Pe<rn)throw new RangeError('"value" argument is out of bounds');if(rt+Et>We.length)throw new RangeError("Index out of range")}function Zt(We,Pe,rt,Et){Pe<0&&(Pe=65535+Pe+1);for(var Lt=0,rn=Math.min(We.length-rt,2);Lt<rn;++Lt)We[rt+Lt]=(Pe&255<<8*(Et?Lt:1-Lt))>>>8*(Et?Lt:1-Lt)}function Bt(We,Pe,rt,Et){Pe<0&&(Pe=4294967295+Pe+1);for(var Lt=0,rn=Math.min(We.length-rt,4);Lt<rn;++Lt)We[rt+Lt]=Pe>>>8*(Et?Lt:3-Lt)&255}function Mt(We,Pe,rt,Et,Lt,rn){if(rt+Et>We.length)throw new RangeError("Index out of range");if(rt<0)throw new RangeError("Index out of range")}function bn(We,Pe,rt,Et,Lt){return Lt||Mt(We,0,rt,4),U.write(We,Pe,rt,Et,23,4),rt+4}function Dt(We,Pe,rt,Et,Lt){return Lt||Mt(We,0,rt,8),U.write(We,Pe,rt,Et,52,8),rt+8}R.prototype.slice=function(We,Pe){var rt,Et=this.length;if(We=~~We,Pe=Pe===void 0?Et:~~Pe,We<0?(We+=Et)<0&&(We=0):We>Et&&(We=Et),Pe<0?(Pe+=Et)<0&&(Pe=0):Pe>Et&&(Pe=Et),Pe<We&&(Pe=We),R.TYPED_ARRAY_SUPPORT)(rt=this.subarray(We,Pe)).__proto__=R.prototype;else{var Lt=Pe-We;rt=new R(Lt,void 0);for(var rn=0;rn<Lt;++rn)rt[rn]=this[rn+We]}return rt},R.prototype.readUIntLE=function(We,Pe,rt){We|=0,Pe|=0,rt||Ye(We,Pe,this.length);for(var Et=this[We],Lt=1,rn=0;++rn<Pe&&(Lt*=256);)Et+=this[We+rn]*Lt;return Et},R.prototype.readUIntBE=function(We,Pe,rt){We|=0,Pe|=0,rt||Ye(We,Pe,this.length);for(var Et=this[We+--Pe],Lt=1;Pe>0&&(Lt*=256);)Et+=this[We+--Pe]*Lt;return Et},R.prototype.readUInt8=function(We,Pe){return Pe||Ye(We,1,this.length),this[We]},R.prototype.readUInt16LE=function(We,Pe){return Pe||Ye(We,2,this.length),this[We]|this[We+1]<<8},R.prototype.readUInt16BE=function(We,Pe){return Pe||Ye(We,2,this.length),this[We]<<8|this[We+1]},R.prototype.readUInt32LE=function(We,Pe){return Pe||Ye(We,4,this.length),(this[We]|this[We+1]<<8|this[We+2]<<16)+16777216*this[We+3]},R.prototype.readUInt32BE=function(We,Pe){return Pe||Ye(We,4,this.length),16777216*this[We]+(this[We+1]<<16|this[We+2]<<8|this[We+3])},R.prototype.readIntLE=function(We,Pe,rt){We|=0,Pe|=0,rt||Ye(We,Pe,this.length);for(var Et=this[We],Lt=1,rn=0;++rn<Pe&&(Lt*=256);)Et+=this[We+rn]*Lt;return Et>=(Lt*=128)&&(Et-=Math.pow(2,8*Pe)),Et},R.prototype.readIntBE=function(We,Pe,rt){We|=0,Pe|=0,rt||Ye(We,Pe,this.length);for(var Et=Pe,Lt=1,rn=this[We+--Et];Et>0&&(Lt*=256);)rn+=this[We+--Et]*Lt;return rn>=(Lt*=128)&&(rn-=Math.pow(2,8*Pe)),rn},R.prototype.readInt8=function(We,Pe){return Pe||Ye(We,1,this.length),128&this[We]?-1*(255-this[We]+1):this[We]},R.prototype.readInt16LE=function(We,Pe){Pe||Ye(We,2,this.length);var rt=this[We]|this[We+1]<<8;return 32768&rt?4294901760|rt:rt},R.prototype.readInt16BE=function(We,Pe){Pe||Ye(We,2,this.length);var rt=this[We+1]|this[We]<<8;return 32768&rt?4294901760|rt:rt},R.prototype.readInt32LE=function(We,Pe){return Pe||Ye(We,4,this.length),this[We]|this[We+1]<<8|this[We+2]<<16|this[We+3]<<24},R.prototype.readInt32BE=function(We,Pe){return Pe||Ye(We,4,this.length),this[We]<<24|this[We+1]<<16|this[We+2]<<8|this[We+3]},R.prototype.readFloatLE=function(We,Pe){return Pe||Ye(We,4,this.length),U.read(this,We,!0,23,4)},R.prototype.readFloatBE=function(We,Pe){return Pe||Ye(We,4,this.length),U.read(this,We,!1,23,4)},R.prototype.readDoubleLE=function(We,Pe){return Pe||Ye(We,8,this.length),U.read(this,We,!0,52,8)},R.prototype.readDoubleBE=function(We,Pe){return Pe||Ye(We,8,this.length),U.read(this,We,!1,52,8)},R.prototype.writeUIntLE=function(We,Pe,rt,Et){We=+We,Pe|=0,rt|=0,Et||ln(this,We,Pe,rt,Math.pow(2,8*rt)-1,0);var Lt=1,rn=0;for(this[Pe]=255&We;++rn<rt&&(Lt*=256);)this[Pe+rn]=We/Lt&255;return Pe+rt},R.prototype.writeUIntBE=function(We,Pe,rt,Et){We=+We,Pe|=0,rt|=0,Et||ln(this,We,Pe,rt,Math.pow(2,8*rt)-1,0);var Lt=rt-1,rn=1;for(this[Pe+Lt]=255&We;--Lt>=0&&(rn*=256);)this[Pe+Lt]=We/rn&255;return Pe+rt},R.prototype.writeUInt8=function(We,Pe,rt){return We=+We,Pe|=0,rt||ln(this,We,Pe,1,255,0),R.TYPED_ARRAY_SUPPORT||(We=Math.floor(We)),this[Pe]=255&We,Pe+1},R.prototype.writeUInt16LE=function(We,Pe,rt){return We=+We,Pe|=0,rt||ln(this,We,Pe,2,65535,0),R.TYPED_ARRAY_SUPPORT?(this[Pe]=255&We,this[Pe+1]=We>>>8):Zt(this,We,Pe,!0),Pe+2},R.prototype.writeUInt16BE=function(We,Pe,rt){return We=+We,Pe|=0,rt||ln(this,We,Pe,2,65535,0),R.TYPED_ARRAY_SUPPORT?(this[Pe]=We>>>8,this[Pe+1]=255&We):Zt(this,We,Pe,!1),Pe+2},R.prototype.writeUInt32LE=function(We,Pe,rt){return We=+We,Pe|=0,rt||ln(this,We,Pe,4,4294967295,0),R.TYPED_ARRAY_SUPPORT?(this[Pe+3]=We>>>24,this[Pe+2]=We>>>16,this[Pe+1]=We>>>8,this[Pe]=255&We):Bt(this,We,Pe,!0),Pe+4},R.prototype.writeUInt32BE=function(We,Pe,rt){return We=+We,Pe|=0,rt||ln(this,We,Pe,4,4294967295,0),R.TYPED_ARRAY_SUPPORT?(this[Pe]=We>>>24,this[Pe+1]=We>>>16,this[Pe+2]=We>>>8,this[Pe+3]=255&We):Bt(this,We,Pe,!1),Pe+4},R.prototype.writeIntLE=function(We,Pe,rt,Et){if(We=+We,Pe|=0,!Et){var Lt=Math.pow(2,8*rt-1);ln(this,We,Pe,rt,Lt-1,-Lt)}var rn=0,Sn=1,kn=0;for(this[Pe]=255&We;++rn<rt&&(Sn*=256);)We<0&&kn===0&&this[Pe+rn-1]!==0&&(kn=1),this[Pe+rn]=(We/Sn>>0)-kn&255;return Pe+rt},R.prototype.writeIntBE=function(We,Pe,rt,Et){if(We=+We,Pe|=0,!Et){var Lt=Math.pow(2,8*rt-1);ln(this,We,Pe,rt,Lt-1,-Lt)}var rn=rt-1,Sn=1,kn=0;for(this[Pe+rn]=255&We;--rn>=0&&(Sn*=256);)We<0&&kn===0&&this[Pe+rn+1]!==0&&(kn=1),this[Pe+rn]=(We/Sn>>0)-kn&255;return Pe+rt},R.prototype.writeInt8=function(We,Pe,rt){return We=+We,Pe|=0,rt||ln(this,We,Pe,1,127,-128),R.TYPED_ARRAY_SUPPORT||(We=Math.floor(We)),We<0&&(We=255+We+1),this[Pe]=255&We,Pe+1},R.prototype.writeInt16LE=function(We,Pe,rt){return We=+We,Pe|=0,rt||ln(this,We,Pe,2,32767,-32768),R.TYPED_ARRAY_SUPPORT?(this[Pe]=255&We,this[Pe+1]=We>>>8):Zt(this,We,Pe,!0),Pe+2},R.prototype.writeInt16BE=function(We,Pe,rt){return We=+We,Pe|=0,rt||ln(this,We,Pe,2,32767,-32768),R.TYPED_ARRAY_SUPPORT?(this[Pe]=We>>>8,this[Pe+1]=255&We):Zt(this,We,Pe,!1),Pe+2},R.prototype.writeInt32LE=function(We,Pe,rt){return We=+We,Pe|=0,rt||ln(this,We,Pe,4,2147483647,-2147483648),R.TYPED_ARRAY_SUPPORT?(this[Pe]=255&We,this[Pe+1]=We>>>8,this[Pe+2]=We>>>16,this[Pe+3]=We>>>24):Bt(this,We,Pe,!0),Pe+4},R.prototype.writeInt32BE=function(We,Pe,rt){return We=+We,Pe|=0,rt||ln(this,We,Pe,4,2147483647,-2147483648),We<0&&(We=4294967295+We+1),R.TYPED_ARRAY_SUPPORT?(this[Pe]=We>>>24,this[Pe+1]=We>>>16,this[Pe+2]=We>>>8,this[Pe+3]=255&We):Bt(this,We,Pe,!1),Pe+4},R.prototype.writeFloatLE=function(We,Pe,rt){return bn(this,We,Pe,!0,rt)},R.prototype.writeFloatBE=function(We,Pe,rt){return bn(this,We,Pe,!1,rt)},R.prototype.writeDoubleLE=function(We,Pe,rt){return Dt(this,We,Pe,!0,rt)},R.prototype.writeDoubleBE=function(We,Pe,rt){return Dt(this,We,Pe,!1,rt)},R.prototype.copy=function(We,Pe,rt,Et){if(rt||(rt=0),Et||Et===0||(Et=this.length),Pe>=We.length&&(Pe=We.length),Pe||(Pe=0),Et>0&&Et<rt&&(Et=rt),Et===rt||We.length===0||this.length===0)return 0;if(Pe<0)throw new RangeError("targetStart out of bounds");if(rt<0||rt>=this.length)throw new RangeError("sourceStart out of bounds");if(Et<0)throw new RangeError("sourceEnd out of bounds");Et>this.length&&(Et=this.length),We.length-Pe<Et-rt&&(Et=We.length-Pe+rt);var Lt,rn=Et-rt;if(this===We&&rt<Pe&&Pe<Et)for(Lt=rn-1;Lt>=0;--Lt)We[Lt+Pe]=this[Lt+rt];else if(rn<1e3||!R.TYPED_ARRAY_SUPPORT)for(Lt=0;Lt<rn;++Lt)We[Lt+Pe]=this[Lt+rt];else Uint8Array.prototype.set.call(We,this.subarray(rt,rt+rn),Pe);return rn},R.prototype.fill=function(We,Pe,rt,Et){if(typeof We=="string"){if(typeof Pe=="string"?(Et=Pe,Pe=0,rt=this.length):typeof rt=="string"&&(Et=rt,rt=this.length),We.length===1){var Lt=We.charCodeAt(0);Lt<256&&(We=Lt)}if(Et!==void 0&&typeof Et!="string")throw new TypeError("encoding must be a string");if(typeof Et=="string"&&!R.isEncoding(Et))throw new TypeError("Unknown encoding: "+Et)}else typeof We=="number"&&(We&=255);if(Pe<0||this.length<Pe||this.length<rt)throw new RangeError("Out of range index");if(rt<=Pe)return this;var rn;if(Pe>>>=0,rt=rt===void 0?this.length:rt>>>0,We||(We=0),typeof We=="number")for(rn=Pe;rn<rt;++rn)this[rn]=We;else{var Sn=R.isBuffer(We)?We:In(new R(We,Et).toString()),kn=Sn.length;for(rn=0;rn<rt-Pe;++rn)this[rn+Pe]=Sn[rn%kn]}return this};var _t=/[^+\/0-9A-Za-z-_]/g;function xn(We){return We<16?"0"+We.toString(16):We.toString(16)}function In(We,Pe){var rt;Pe=Pe||1/0;for(var Et=We.length,Lt=null,rn=[],Sn=0;Sn<Et;++Sn){if((rt=We.charCodeAt(Sn))>55295&&rt<57344){if(!Lt){if(rt>56319){(Pe-=3)>-1&&rn.push(239,191,189);continue}if(Sn+1===Et){(Pe-=3)>-1&&rn.push(239,191,189);continue}Lt=rt;continue}if(rt<56320){(Pe-=3)>-1&&rn.push(239,191,189),Lt=rt;continue}rt=65536+(Lt-55296<<10|rt-56320)}else Lt&&(Pe-=3)>-1&&rn.push(239,191,189);if(Lt=null,rt<128){if((Pe-=1)<0)break;rn.push(rt)}else if(rt<2048){if((Pe-=2)<0)break;rn.push(rt>>6|192,63&rt|128)}else if(rt<65536){if((Pe-=3)<0)break;rn.push(rt>>12|224,rt>>6&63|128,63&rt|128)}else{if(!(rt<1114112))throw new Error("Invalid code point");if((Pe-=4)<0)break;rn.push(rt>>18|240,rt>>12&63|128,rt>>6&63|128,63&rt|128)}}return rn}function Yn(We){return H.toByteArray(function(Pe){if((Pe=function(rt){return rt.trim?rt.trim():rt.replace(/^\s+|\s+$/g,"")}(Pe).replace(_t,"")).length<2)return"";for(;Pe.length%4!=0;)Pe+="=";return Pe}(We))}function fn(We,Pe,rt,Et){for(var Lt=0;Lt<Et&&!(Lt+rt>=Pe.length||Lt>=We.length);++Lt)Pe[Lt+rt]=We[Lt];return Lt}}).call(this,o(59))},function(Oe,A,o){var b=o(38);Oe.exports=function(H,U,B){for(var re in U)b(H,re,U[re],B);return H}},function(Oe,A){Oe.exports=function(o,b,H,U){if(!(o instanceof b)||U!==void 0&&U in o)throw TypeError(H+": incorrect invocation!");return o}},function(Oe,A,o){var b=o(16),H=o(26),U=o(27),B=o(19)("species");Oe.exports=function(re){var J=b[re];U&&J&&!J[B]&&H.f(J,B,{configurable:!0,get:function(){return this}})}},function(Oe,A){Oe.exports={}},function(Oe,A,o){var b=o(8),H=o(61),U=o(15),B=o(169),re="["+B+"]",J=RegExp("^"+re+re+"*"),R=RegExp(re+re+"*$"),P=function(L,ee,F){var ue={},ie=U(function(){return!!B[L]()||""[L]()!=""}),K=ue[L]=ie?ee($):B[L];F&&(ue[F]=K),b(b.P+b.F*ie,"String",ue)},$=P.trim=function(L,ee){return L=String(H(L)),1&ee&&(L=L.replace(J,"")),2&ee&&(L=L.replace(R,"")),L};Oe.exports=P},function(Oe,A,o){var b=o(26).f,H=o(43),U=o(19)("toStringTag");Oe.exports=function(B,re,J){B&&!H(B=J?B:B.prototype,U)&&b(B,U,{configurable:!0,value:re})}},function(Oe,A,o){var b,H=typeof Reflect=="object"?Reflect:null,U=H&&typeof H.apply=="function"?H.apply:function(K,he,pe){return Function.prototype.apply.call(K,he,pe)};b=H&&typeof H.ownKeys=="function"?H.ownKeys:Object.getOwnPropertySymbols?function(K){return Object.getOwnPropertyNames(K).concat(Object.getOwnPropertySymbols(K))}:function(K){return Object.getOwnPropertyNames(K)};var B=Number.isNaN||function(K){return K!=K};function re(){re.init.call(this)}Oe.exports=re,Oe.exports.once=function(K,he){return new Promise(function(pe,Ae){function Te(ke){K.removeListener(he,je),Ae(ke)}function je(){typeof K.removeListener=="function"&&K.removeListener("error",Te),pe([].slice.call(arguments))}ie(K,he,je,{once:!0}),he!=="error"&&function(ke,at,St){typeof ke.on=="function"&&ie(ke,"error",at,St)}(K,Te,{once:!0})})},re.EventEmitter=re,re.prototype._events=void 0,re.prototype._eventsCount=0,re.prototype._maxListeners=void 0;var J=10;function R(K){if(typeof K!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof K)}function P(K){return K._maxListeners===void 0?re.defaultMaxListeners:K._maxListeners}function $(K,he,pe,Ae){var Te,je,ke;if(R(pe),(je=K._events)===void 0?(je=K._events=Object.create(null),K._eventsCount=0):(je.newListener!==void 0&&(K.emit("newListener",he,pe.listener?pe.listener:pe),je=K._events),ke=je[he]),ke===void 0)ke=je[he]=pe,++K._eventsCount;else if(typeof ke=="function"?ke=je[he]=Ae?[pe,ke]:[ke,pe]:Ae?ke.unshift(pe):ke.push(pe),(Te=P(K))>0&&ke.length>Te&&!ke.warned){ke.warned=!0;var at=new Error("Possible EventEmitter memory leak detected. "+ke.length+" "+String(he)+" listeners added. Use emitter.setMaxListeners() to increase limit");at.name="MaxListenersExceededWarning",at.emitter=K,at.type=he,at.count=ke.length,function(St){console&&console.warn&&console.warn(St)}(at)}return K}function L(K,he,pe){var Ae={fired:!1,wrapFn:void 0,target:K,type:he,listener:pe},Te=(function(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}).bind(Ae);return Te.listener=pe,Ae.wrapFn=Te,Te}function ee(K,he,pe){var Ae=K._events;if(Ae===void 0)return[];var Te=Ae[he];return Te===void 0?[]:typeof Te=="function"?pe?[Te.listener||Te]:[Te]:pe?function(je){for(var ke=new Array(je.length),at=0;at<ke.length;++at)ke[at]=je[at].listener||je[at];return ke}(Te):ue(Te,Te.length)}function F(K){var he=this._events;if(he!==void 0){var pe=he[K];if(typeof pe=="function")return 1;if(pe!==void 0)return pe.length}return 0}function ue(K,he){for(var pe=new Array(he),Ae=0;Ae<he;++Ae)pe[Ae]=K[Ae];return pe}function ie(K,he,pe,Ae){if(typeof K.on=="function")Ae.once?K.once(he,pe):K.on(he,pe);else{if(typeof K.addEventListener!="function")throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof K);K.addEventListener(he,function Te(je){Ae.once&&K.removeEventListener(he,Te),pe(je)})}}Object.defineProperty(re,"defaultMaxListeners",{enumerable:!0,get:function(){return J},set:function(K){if(typeof K!="number"||K<0||B(K))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+K+".");J=K}}),re.init=function(){this._events!==void 0&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},re.prototype.setMaxListeners=function(K){if(typeof K!="number"||K<0||B(K))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+K+".");return this._maxListeners=K,this},re.prototype.getMaxListeners=function(){return P(this)},re.prototype.emit=function(K){for(var he=[],pe=1;pe<arguments.length;pe++)he.push(arguments[pe]);var Ae=K==="error",Te=this._events;if(Te!==void 0)Ae=Ae&&Te.error===void 0;else if(!Ae)return!1;if(Ae){var je;if(he.length>0&&(je=he[0]),je instanceof Error)throw je;var ke=new Error("Unhandled error."+(je?" ("+je.message+")":""));throw ke.context=je,ke}var at=Te[K];if(at===void 0)return!1;if(typeof at=="function")U(at,this,he);else{var St=at.length,zt=ue(at,St);for(pe=0;pe<St;++pe)U(zt[pe],this,he)}return!0},re.prototype.addListener=function(K,he){return $(this,K,he,!1)},re.prototype.on=re.prototype.addListener,re.prototype.prependListener=function(K,he){return $(this,K,he,!0)},re.prototype.once=function(K,he){return R(he),this.on(K,L(this,K,he)),this},re.prototype.prependOnceListener=function(K,he){return R(he),this.prependListener(K,L(this,K,he)),this},re.prototype.removeListener=function(K,he){var pe,Ae,Te,je,ke;if(R(he),(Ae=this._events)===void 0)return this;if((pe=Ae[K])===void 0)return this;if(pe===he||pe.listener===he)--this._eventsCount==0?this._events=Object.create(null):(delete Ae[K],Ae.removeListener&&this.emit("removeListener",K,pe.listener||he));else if(typeof pe!="function"){for(Te=-1,je=pe.length-1;je>=0;je--)if(pe[je]===he||pe[je].listener===he){ke=pe[je].listener,Te=je;break}if(Te<0)return this;Te===0?pe.shift():function(at,St){for(;St+1<at.length;St++)at[St]=at[St+1];at.pop()}(pe,Te),pe.length===1&&(Ae[K]=pe[0]),Ae.removeListener!==void 0&&this.emit("removeListener",K,ke||he)}return this},re.prototype.off=re.prototype.removeListener,re.prototype.removeAllListeners=function(K){var he,pe,Ae;if((pe=this._events)===void 0)return this;if(pe.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):pe[K]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete pe[K]),this;if(arguments.length===0){var Te,je=Object.keys(pe);for(Ae=0;Ae<je.length;++Ae)(Te=je[Ae])!=="removeListener"&&this.removeAllListeners(Te);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(typeof(he=pe[K])=="function")this.removeListener(K,he);else if(he!==void 0)for(Ae=he.length-1;Ae>=0;Ae--)this.removeListener(K,he[Ae]);return this},re.prototype.listeners=function(K){return ee(this,K,!0)},re.prototype.rawListeners=function(K){return ee(this,K,!1)},re.listenerCount=function(K,he){return typeof K.listenerCount=="function"?K.listenerCount(he):F.call(K,he)},re.prototype.listenerCount=F,re.prototype.eventNames=function(){return this._eventsCount>0?b(this._events):[]}},function(Oe,A,o){o.d(A,"a",function(){return H}),o.d(A,"b",function(){return U}),o.d(A,"c",function(){return B}),o.d(A,"d",function(){return re});var b,H,U,B,re,J=o(246);(function(R){b=Object(J.a)(R),H=b.format,U=b.parse,B=b.utcFormat,re=b.utcParse})({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]})},function(Oe,A,o){Object.defineProperty(A,"__esModule",{value:!0}),A.default=function(H){return typeof H=="string"&&b.test(H)};var b=/-webkit-|-moz-|-ms-/;Oe.exports=A.default},function(Oe,A,o){Object.defineProperty(A,"__esModule",{value:!0}),A.compose=A.merge=A.$=A.style=A.presets=A.keyframes=A.fontFace=A.insertGlobal=A.insertRule=A.plugins=A.styleSheet=void 0,A.speedy=function(Pe){return $.speedy(Pe)},A.simulations=function(){var Pe=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];ue=!!Pe},A.simulate=function(){for(var Pe=arguments.length,rt=Array(Pe),Et=0;Et<Pe;Et++)rt[Et]=arguments[Et];return(rt=(0,B.default)(rt))?ue?rt.reduce(function(Lt,rn){return Lt["data-simulate-"+pe(rn)]="",Lt},{}):(ie||(console.warn("can't simulate without once calling simulations(true)"),ie=!0),K||(console.warn("don't use simulation outside dev"),K=!0),{}):{}},A.cssLabels=function(Pe){he=!!Pe},A.isLikeRule=Te,A.idFor=je,A.css=In,A.rehydrate=function(Pe){(0,b.default)(Tt,Pe.reduce(function(rt,Et){return rt[Et]=!0,rt},{}))},A.flush=function(){Tt=$.inserted={},Gt=$.registered={},Ye={},$.flush(),$.inject()},A.select=fn,A.parent=function(Pe){for(var rt=arguments.length,Et=Array(rt>1?rt-1:0),Lt=1;Lt<rt;Lt++)Et[Lt-1]=arguments[Lt];return In(P({},Pe+" &",Et))},A.media=function(Pe){for(var rt=arguments.length,Et=Array(rt>1?rt-1:0),Lt=1;Lt<rt;Lt++)Et[Lt-1]=arguments[Lt];return In(P({},"@media "+Pe,Et))},A.pseudo=We,A.active=function(Pe){return We(":active",Pe)},A.any=function(Pe){return We(":any",Pe)},A.checked=function(Pe){return We(":checked",Pe)},A.disabled=function(Pe){return We(":disabled",Pe)},A.empty=function(Pe){return We(":empty",Pe)},A.enabled=function(Pe){return We(":enabled",Pe)},A._default=function(Pe){return We(":default",Pe)},A.first=function(Pe){return We(":first",Pe)},A.firstChild=function(Pe){return We(":first-child",Pe)},A.firstOfType=function(Pe){return We(":first-of-type",Pe)},A.fullscreen=function(Pe){return We(":fullscreen",Pe)},A.focus=function(Pe){return We(":focus",Pe)},A.hover=function(Pe){return We(":hover",Pe)},A.indeterminate=function(Pe){return We(":indeterminate",Pe)},A.inRange=function(Pe){return We(":in-range",Pe)},A.invalid=function(Pe){return We(":invalid",Pe)},A.lastChild=function(Pe){return We(":last-child",Pe)},A.lastOfType=function(Pe){return We(":last-of-type",Pe)},A.left=function(Pe){return We(":left",Pe)},A.link=function(Pe){return We(":link",Pe)},A.onlyChild=function(Pe){return We(":only-child",Pe)},A.onlyOfType=function(Pe){return We(":only-of-type",Pe)},A.optional=function(Pe){return We(":optional",Pe)},A.outOfRange=function(Pe){return We(":out-of-range",Pe)},A.readOnly=function(Pe){return We(":read-only",Pe)},A.readWrite=function(Pe){return We(":read-write",Pe)},A.required=function(Pe){return We(":required",Pe)},A.right=function(Pe){return We(":right",Pe)},A.root=function(Pe){return We(":root",Pe)},A.scope=function(Pe){return We(":scope",Pe)},A.target=function(Pe){return We(":target",Pe)},A.valid=function(Pe){return We(":valid",Pe)},A.visited=function(Pe){return We(":visited",Pe)},A.dir=function(Pe,rt){return We(":dir("+Pe+")",rt)},A.lang=function(Pe,rt){return We(":lang("+Pe+")",rt)},A.not=function(Pe,rt){var Et=Pe.split(",").map(function(Lt){return Lt.trim()}).map(function(Lt){return":not("+Lt+")"});return Et.length===1?We(":not("+Pe+")",rt):fn(Et.join(""),rt)},A.nthChild=function(Pe,rt){return We(":nth-child("+Pe+")",rt)},A.nthLastChild=function(Pe,rt){return We(":nth-last-child("+Pe+")",rt)},A.nthLastOfType=function(Pe,rt){return We(":nth-last-of-type("+Pe+")",rt)},A.nthOfType=function(Pe,rt){return We(":nth-of-type("+Pe+")",rt)},A.after=function(Pe){return We("::after",Pe)},A.before=function(Pe){return We("::before",Pe)},A.firstLetter=function(Pe){return We("::first-letter",Pe)},A.firstLine=function(Pe){return We("::first-line",Pe)},A.selection=function(Pe){return We("::selection",Pe)},A.backdrop=function(Pe){return We("::backdrop",Pe)},A.placeholder=function(Pe){return In({"::placeholder":Pe})},A.cssFor=function(){for(var Pe=arguments.length,rt=Array(Pe),Et=0;Et<Pe;Et++)rt[Et]=arguments[Et];return(rt=(0,B.default)(rt))?rt.map(function(Lt){var rn={label:[]};return Mt(rn,{src:Lt}),we(Ae(rn),$t(rn)).join("")}).join(""):""},A.attribsFor=function(){for(var Pe=arguments.length,rt=Array(Pe),Et=0;Et<Pe;Et++)rt[Et]=arguments[Et];return(rt=(0,B.default)(rt))?rt.map(function(Lt){je(Lt);var rn=Object.keys(Lt)[0],Sn=Lt[rn];return rn+'="'+(Sn||"")+'"'}).join(" "):""};var b=R(o(139)),H=o(320),U=o(201),B=R(o(311)),re=o(310),J=R(o(293));function R(Pe){return Pe&&Pe.__esModule?Pe:{default:Pe}}function P(Pe,rt,Et){return rt in Pe?Object.defineProperty(Pe,rt,{value:Et,enumerable:!0,configurable:!0,writable:!0}):Pe[rt]=Et,Pe}var $=A.styleSheet=new H.StyleSheet;$.inject();var L=A.plugins=$.plugins=new re.PluginSet([re.prefixes,re.contentWrap,re.fallbacks]);L.media=new re.PluginSet,L.fontFace=new re.PluginSet,L.keyframes=new re.PluginSet([re.prefixes,re.fallbacks]);var ee=!1,F=typeof window<"u",ue=ee,ie=!1,K=!1,he=ee;function pe(Pe){var rt=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";return Pe.toLowerCase().replace(/[^a-z0-9]/g,rt)}function Ae(Pe){var rt=JSON.stringify(Pe),Et=(0,J.default)(rt).toString(36);return Pe.label&&Pe.label.length>0&&ee?pe(Pe.label.join("."),"-")+"-"+Et:Et}function Te(Pe){var rt=Object.keys(Pe).filter(function(Et){return Et!=="toString"});return rt.length===1&&!!/data\-css\-([a-zA-Z0-9\-_]+)/.exec(rt[0])}function je(Pe){var rt=Object.keys(Pe).filter(function(Lt){return Lt!=="toString"});if(rt.length!==1)throw new Error("not a rule");var Et=/data\-css\-([a-zA-Z0-9\-_]+)/.exec(rt[0]);if(!Et)throw new Error("not a rule");return Et[1]}var ke=/[(),]|"(?:\\.|[^"\n])*"|'(?:\\.|[^'\n])*'|\/\*[\s\S]*?\*\//g;function at(Pe){if(Pe.indexOf(",")===-1)return[Pe];for(var rt,Et=[],Lt=[],rn=0;rt=ke.exec(Pe);)switch(rt[0]){case"(":rn++;break;case")":rn--;break;case",":if(rn)break;Et.push(rt.index)}for(rt=Et.length;rt--;)Lt.unshift(Pe.slice(Et[rt]+1)),Pe=Pe.slice(0,Et[rt]);return Lt.unshift(Pe),Lt}function St(Pe,rt){if(!Pe)return rt.replace(/\&/g,"");if(!rt)return".css-"+Pe+",[data-css-"+Pe+"]";var Et=at(rt).map(function(Lt){return Lt.indexOf("&")>=0?[Lt.replace(/\&/gm,".css-"+Pe),Lt.replace(/\&/gm,"[data-css-"+Pe+"]")].join(","):".css-"+Pe+Lt+",[data-css-"+Pe+"]"+Lt}).join(",");return ue&&/^\&\:/.exec(rt)&&!/\s/.exec(rt)&&(Et+=",.css-"+Pe+"[data-simulate-"+pe(rt)+"],[data-css-"+Pe+"][data-simulate-"+pe(rt)+"]"),Et}function zt(Pe){var rt=Pe.selector,Et=Pe.style,Lt=L.transform({selector:rt,style:Et});return Lt.selector+"{"+(0,U.createMarkupForStyles)(Lt.style)+"}"}function $t(Pe){var rt=void 0,Et=void 0,Lt=void 0,rn=void 0;return Object.keys(Pe).forEach(function(Sn){Sn.indexOf("&")>=0?(Et=Et||{})[Sn]=Pe[Sn]:Sn.indexOf("@media")===0?(Lt=Lt||{})[Sn]=$t(Pe[Sn]):Sn.indexOf("@supports")===0?(rn=rn||{})[Sn]=$t(Pe[Sn]):Sn==="label"?Pe.label.length>0&&((rt=rt||{}).label=he?Pe.label.join("."):""):(rt=rt||{})[Sn]=Pe[Sn]}),{plain:rt,selects:Et,medias:Lt,supports:rn}}function we(Pe,rt){var Et=[],Lt=rt.plain,rn=rt.selects,Sn=rt.medias,kn=rt.supports;return Lt&&Et.push(zt({style:Lt,selector:St(Pe)})),rn&&Object.keys(rn).forEach(function(qn){return Et.push(zt({style:rn[qn],selector:St(Pe,qn)}))}),Sn&&Object.keys(Sn).forEach(function(qn){return Et.push(qn+"{"+we(Pe,Sn[qn]).join("")+"}")}),kn&&Object.keys(kn).forEach(function(qn){return Et.push(qn+"{"+we(Pe,kn[qn]).join("")+"}")}),Et}var Tt=$.inserted={},Gt=$.registered={};function Pt(Pe){Gt[Pe.id]||(Gt[Pe.id]=Pe)}var Ye={};function ln(Pe){if(Pt(Pe),function(Et){if(!Tt[Et.id]){Tt[Et.id]=!0;var Lt=$t(Et.style),rn=we(Et.id,Lt);Tt[Et.id]=!!F||rn,rn.forEach(function(Sn){return $.insert(Sn)})}}(Pe),Ye[Pe.id])return Ye[Pe.id];var rt=P({},"data-css-"+Pe.id,he&&Pe.label||"");return Object.defineProperty(rt,"toString",{enumerable:!1,value:function(){return"css-"+Pe.id}}),Ye[Pe.id]=rt,rt}function Zt(Pe,rt){var Et=at(Pe).map(function(Lt){return Lt.indexOf("&")>=0?Lt:"&"+Lt});return at(rt).map(function(Lt){return Lt.indexOf("&")>=0?Lt:"&"+Lt}).reduce(function(Lt,rn){return Lt.concat(Et.map(function(Sn){return rn.replace(/\&/g,Sn)}))},[]).join(",")}var Bt={"::placeholder":["::-webkit-input-placeholder","::-moz-placeholder","::-ms-input-placeholder"],":fullscreen":[":-webkit-full-screen",":-moz-full-screen",":-ms-fullscreen"]};function Mt(Pe,rt){var Et=rt.selector,Lt=Et===void 0?"":Et,rn=rt.mq,Sn=rn===void 0?"":rn,kn=rt.supp,qn=kn===void 0?"":kn,xe=rt.src,Xn=xe===void 0?{}:xe;Array.isArray(Xn)||(Xn=[Xn]),(Xn=function br(Cr){for(var dr=[],Rr=0;Rr<Cr.length;Rr++)dr=Array.isArray(Cr[Rr])?dr.concat(br(Cr[Rr])):dr.concat(Cr[Rr]);return dr}(Xn)).forEach(function(br){if(Te(br)){var Cr=function(dr){if(Te(dr)){var Rr=Gt[je(dr)];if(Rr==null)throw new Error("[glamor] an unexpected rule cache miss occurred. This is probably a sign of multiple glamor instances in your app. See https://github.com/threepointone/glamor/issues/79");return Rr}return dr}(br);if(Cr.type!=="css")throw new Error("cannot merge this rule");br=Cr.style}(br=(0,B.default)(br))&&br.composes&&Mt(Pe,{selector:Lt,mq:Sn,supp:qn,src:br.composes}),Object.keys(br||{}).forEach(function(dr){if(function(hn){for(var Xt=[":",".","[",">"," "],nn=!1,Gn=hn.charAt(0),Dn=0;Dn<Xt.length;Dn++)if(Gn===Xt[Dn]){nn=!0;break}return nn||hn.indexOf("&")>=0}(dr))Bt[dr]&&Bt[dr].forEach(function(hn){return Mt(Pe,{selector:Zt(Lt,hn),mq:Sn,supp:qn,src:br[dr]})}),Mt(Pe,{selector:Zt(Lt,dr),mq:Sn,supp:qn,src:br[dr]});else if(function(hn){return hn.indexOf("@media")===0}(dr))Mt(Pe,{selector:Lt,mq:function(hn,Xt){return hn?"@media "+hn.substring(6)+" and "+Xt.substring(6):Xt}(Sn,dr),supp:qn,src:br[dr]});else if(function(hn){return hn.indexOf("@supports")===0}(dr))Mt(Pe,{selector:Lt,mq:Sn,supp:function(hn,Xt){return hn?"@supports "+hn.substring(9)+" and "+Xt.substring(9):Xt}(qn,dr),src:br[dr]});else if(dr!=="composes"){var Rr=Pe;qn&&(Rr[qn]=Rr[qn]||{},Rr=Rr[qn]),Sn&&(Rr[Sn]=Rr[Sn]||{},Rr=Rr[Sn]),Lt&&(Rr[Lt]=Rr[Lt]||{},Rr=Rr[Lt]),dr==="label"?he&&(Pe.label=Pe.label.concat(br.label)):Rr[dr]=br[dr]}})})}function bn(Pe){var rt={label:[]};return Mt(rt,{src:Pe}),ln({id:Ae(rt),style:rt,label:he?rt.label.join("."):"",type:"css"})}var Dt={};Object.defineProperty(Dt,"toString",{enumerable:!1,value:function(){return"css-nil"}});var _t=typeof WeakMap<"u"?[Dt,new WeakMap,new WeakMap,new WeakMap]:[Dt],xn=typeof WeakMap<"u"?function(Pe){return function(rt){if(_t[rt.length]){for(var Et=_t[rt.length],Lt=0;Lt<rt.length-1;)Et.has(rt[Lt])||Et.set(rt[Lt],new WeakMap),Et=Et.get(rt[Lt]),Lt++;if(Et.has(rt[rt.length-1])){var rn=Et.get(rt[Lt]);if(Gt[rn.toString().substring(4)])return rn}}var Sn=Pe(rt);if(_t[rt.length]){for(var kn=0,qn=_t[rt.length];kn<rt.length-1;)qn=qn.get(rt[kn]),kn++;try{qn.set(rt[kn],Sn)}catch{}}return Sn}}(bn):bn;function In(){for(var Pe=arguments.length,rt=Array(Pe),Et=0;Et<Pe;Et++)rt[Et]=arguments[Et];if(rt[0]&&rt[0].length&&rt[0].raw)throw new Error("you forgot to include glamor/babel in your babel plugins.");return(rt=(0,B.default)(rt))?xn(rt):Dt}In.insert=function(Pe){var rt={id:Ae(Pe),css:Pe,type:"raw"};Pt(rt),Tt[rt.id]||($.insert(rt.css),Tt[rt.id]=!!F||[rt.css])},A.insertRule=In.insert,In.global=function(Pe,rt){if(rt=(0,B.default)(rt))return In.insert(zt({selector:Pe,style:rt}))},A.insertGlobal=In.global,In.keyframes=function(Pe,rt){rt||(rt=Pe,Pe="animation");var Et={id:Ae({name:Pe,kfs:rt=(0,B.default)(rt)||{}}),type:"keyframes",name:Pe,keyframes:rt};return Pt(Et),function(Lt){if(!Tt[Lt.id]){var rn=Object.keys(Lt.keyframes).map(function(kn){var qn=L.keyframes.transform({id:Lt.id,name:kn,style:Lt.keyframes[kn]});return qn.name+"{"+(0,U.createMarkupForStyles)(qn.style)+"}"}).join(""),Sn=["-webkit-","-moz-","-o-",""].map(function(kn){return"@"+kn+"keyframes "+Lt.name+"_"+Lt.id+"{"+rn+"}"});Sn.forEach(function(kn){return $.insert(kn)}),Tt[Lt.id]=!!F||Sn}}(Et),Pe+"_"+Et.id},In.fontFace=function(Pe){var rt={id:Ae(Pe=(0,B.default)(Pe)),type:"font-face",font:Pe};return Pt(rt),function(Et){if(!Tt[Et.id]){var Lt="@font-face{"+(0,U.createMarkupForStyles)(Et.font)+"}";$.insert(Lt),Tt[Et.id]=!!F||[Lt]}}(rt),Pe.fontFamily},A.fontFace=In.fontFace,A.keyframes=In.keyframes,A.presets={mobile:"(min-width: 400px)",Mobile:"@media (min-width: 400px)",phablet:"(min-width: 550px)",Phablet:"@media (min-width: 550px)",tablet:"(min-width: 750px)",Tablet:"@media (min-width: 750px)",desktop:"(min-width: 1000px)",Desktop:"@media (min-width: 1000px)",hd:"(min-width: 1200px)",Hd:"@media (min-width: 1200px)"};var Yn=A.style=In;function fn(Pe){for(var rt=arguments.length,Et=Array(rt>1?rt-1:0),Lt=1;Lt<rt;Lt++)Et[Lt-1]=arguments[Lt];return Pe?In(P({},Pe,Et)):Yn(Et)}A.$=fn,A.merge=In,A.compose=In;function We(Pe){for(var rt=arguments.length,Et=Array(rt>1?rt-1:0),Lt=1;Lt<rt;Lt++)Et[Lt-1]=arguments[Lt];return In(P({},Pe,Et))}},function(Oe,A,o){/**
* @license
* Copyright 2017 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});var b=function(){function U(B){this.global=B,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return U.prototype.setPlatform=function(B,re){this.platform!=null&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+re+"."),this.platformName=B,this.platform=re},U.prototype.registerFlag=function(B,re,J){if(this.flagRegistry[B]={evaluationFn:re,setHook:J},this.urlFlags[B]!=null){var R=this.urlFlags[B];console.warn("Setting feature override from URL "+B+": "+R+"."),this.set(B,R)}},U.prototype.get=function(B){return B in this.flags?this.flags[B]:(this.flags[B]=this.evaluateFlag(B),this.flags[B])},U.prototype.getNumber=function(B){return this.get(B)},U.prototype.getBool=function(B){return this.get(B)},U.prototype.getFlags=function(){return this.flags},Object.defineProperty(U.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),U.prototype.set=function(B,re){if(this.flagRegistry[B]==null)throw new Error("Cannot set flag "+B+" as it has not been registered.");this.flags[B]=re,this.flagRegistry[B].setHook!=null&&this.flagRegistry[B].setHook(re)},U.prototype.evaluateFlag=function(B){if(this.flagRegistry[B]==null)throw new Error("Cannot evaluate flag '"+B+"': no evaluation function found.");return this.flagRegistry[B].evaluationFn()},U.prototype.setFlags=function(B){this.flags=Object.assign({},B)},U.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},U.prototype.populateURLFlags=function(){var B=this;if(this.global!==void 0&&this.global.location!==void 0&&this.global.location.search!==void 0){var re=H(this.global.location.search);"tfjsflags"in re&&re.tfjsflags.split(",").forEach(function(J){var R=J.split(":"),P=R[0],$=R[1];B.urlFlags[P]=function(L,ee){if((ee=ee.toLowerCase())==="true"||ee==="false")return ee==="true";if(""+ +ee===ee)return+ee;throw new Error("Could not parse value flag value "+ee+" for flag "+L+".")}(P,$)})}},U}();function H(U){var B={};return U.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(re){for(var J=[],R=1;R<arguments.length;R++)J[R-1]=arguments[R];return function(P,$,L){P[decodeURIComponent($)]=decodeURIComponent(L||"")}(B,J[0],J[1]),J.join("=")}),B}A.Environment=b,A.getQueryParams=H,A.env=function(){return A.ENV},A.ENV=null,A.setEnvironmentGlobal=function(U){A.ENV=U}},function(Oe,A,o){var b=o(14),H=o(55),U=o(19)("species");Oe.exports=function(B,re){var J,R=b(B).constructor;return R===void 0||(J=b(R)[U])==null?re:H(J)}},function(Oe,A,o){var b=o(62),H=o(19)("toStringTag"),U=b(function(){return arguments}())=="Arguments";Oe.exports=function(B){var re,J,R;return B===void 0?"Undefined":B===null?"Null":typeof(J=function(P,$){try{return P[$]}catch{}}(re=Object(B),H))=="string"?J:U?b(re):(R=b(re))=="Object"&&typeof re.callee=="function"?"Arguments":R}},function(Oe,A){A.f={}.propertyIsEnumerable},function(Oe,A,o){var b=o(62);Oe.exports=Object("z").propertyIsEnumerable(0)?Object:function(H){return b(H)=="String"?H.split(""):Object(H)}},function(Oe,A,o){var b=o(87);A.a=function(H){let U=H,B=H;function re(J,R,P,$){for(P==null&&(P=0),$==null&&($=J.length);P<$;){const L=P+$>>>1;B(J[L],R)<0?P=L+1:$=L}return P}return H.length===1&&(U=(J,R)=>H(J)-R,B=function(J){return(R,P)=>Object(b.a)(J(R),P)}(H)),{left:re,center:function(J,R,P,$){P==null&&(P=0),$==null&&($=J.length);const L=re(J,R,P,$-1);return L>P&&U(J[L-1],R)>-U(J[L],R)?L-1:L},right:function(J,R,P,$){for(P==null&&(P=0),$==null&&($=J.length);P<$;){const L=P+$>>>1;B(J[L],R)>0?$=L:P=L+1}return P}}}},function(Oe,A,o){/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});const b=o(50),H=o(247),U=o(102),B=o(46);A.table=function(J,R,P={}){if(R&&R.headers==null)throw new Error('Data to render must have a "headers" property');if(R&&R.values==null)throw new Error('Data to render must have a "values" property');const $=B.getDrawArea(J),L=Object.assign({},re,P);let ee=H.select($).select("table.tf-table");const F=U.css({fontSize:L.fontSize||".875rem",width:"100%",maxWidth:"64rem",marginRight:"auto",marginLeft:"auto"});if(ee.size()===0&&((ee=H.select($).append("table")).attr("class",` ${F} tf-table`),ee.append("thead").append("tr"),ee.append("tbody")),ee.size()!==1)throw new Error("Error inserting table");const ue=U.css({fontWeight:"600",borderBottomStyle:"solid",borderBottomWidth:"1px",borderColor:"rgba( 0, 0, 0, .2 )",textAlign:"left",paddingBottom:"1rem",paddingRight:"1rem",backgroundColor:"#fff"}),ie=ee.select("thead").select("tr").selectAll("th").data(R.headers),K=ie.enter().append("th").attr("class",`${ue}`);ie.merge(K).html(at=>at),ie.exit().remove();const he=b.format(",.4~f"),pe=ee.select("tbody").selectAll("tr").data(R.values),Ae=pe.enter().append("tr"),Te=U.css({padding:"0.25rem",borderBottomStyle:"solid",borderBottomWidth:"1px",borderColor:"rgba( 0, 0, 0, .2 )"}),je=pe.merge(Ae).selectAll("td").data(at=>at),ke=je.enter().append("td").attr("class",`${Te}`);je.merge(ke).html(at=>typeof at=="number"?he(at):at),je.exit().remove(),pe.exit().remove()};const re={fontSize:14}},function(Oe,A,o){/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/var b=this&&this.__awaiter||function(B,re,J,R){return new(J||(J=Promise))(function(P,$){function L(ue){try{F(R.next(ue))}catch(ie){$(ie)}}function ee(ue){try{F(R.throw(ue))}catch(ie){$(ie)}}function F(ue){ue.done?P(ue.value):new J(function(ie){ie(ue.value)}).then(L,ee)}F((R=R.apply(B,re||[])).next())})};Object.defineProperty(A,"__esModule",{value:!0});const H=o(0),U=o(111);A.arrayStats=function(B){if(!Array.isArray(B))throw new Error("input must be an array");if(B.length===0)return{numVals:0,numNans:0,numZeros:0,max:void 0,min:void 0};const re=B.length;let J=-1/0,R=1/0,P=0,$=0,L=0;for(let F=0;F<re;F++){const ue=B[F];ue>J&&(J=ue),ue<R&&(R=ue),ue===0&&(P+=1),isNaN(ue)?$+=1:isFinite(ue)||(L+=1)}const ee={numVals:re,numZeros:P,numNans:$,max:J,min:R,numInfs:L};return ee.max===-1/0&&(ee.max=NaN),ee.min===1/0&&(ee.min=NaN),ee},A.tensorStats=function(B){return b(this,void 0,void 0,function*(){const[re,J,R]=H.tidy(()=>{const P=H.scalar(0,B.dtype);return[B.min(),B.max(),B.equal(P).sum()]});return Promise.all([B.data(),re.data(),J.data(),R.data()]).then(([P,$,L,ee])=>{const F=P.length;let ue=0,ie=0;for(let pe=0;pe<F;pe++){const Ae=P[pe];isNaN(Ae)?ue+=1:isFinite(Ae)||(ie+=1)}let K=$[0],he=L[0];return ue===F&&(K=NaN,he=NaN),{numVals:F,numZeros:ee[0],numNans:ue,min:K,max:he,numInfs:ie}})})},A.confusionMatrix=function(B,re,J,R){return b(this,void 0,void 0,function*(){U.assert(B.rank===1,"labels must be a 1D tensor"),U.assert(re.rank===1,"predictions must be a 1D tensor"),U.assert(B.size===re.size,"labels and predictions must be the same length"),R!=null&&U.assert(R.size===re.size,"labels and predictions must be the same length");const P=B.cast("int32"),$=re.cast("int32");J==null&&(J=H.tidy(()=>H.maximum(P.max(),$.max()).cast("int32").dataSync()[0]+1));let L=Promise.resolve(null);return R!=null&&(L=R.data()),Promise.all([P.data(),$.data(),L]).then(([ee,F,ue])=>{const ie=Array(J).fill(0);for(let K=0;K<J;K++)ie[K]=Array(J).fill(0);for(let K=0;K<ee.length;K++){const he=ee[K],pe=F[K];ie[he][pe]+=ue!=null?ue[K]:1}return ie})})},A.accuracy=function(B,re){return b(this,void 0,void 0,function*(){U.assertShapesMatch(B.shape,re.shape,"Error computing accuracy.");const J=B.equal(re),R=J.mean(),P=(yield R.data())[0];return H.dispose([J,R]),P})},A.perClassAccuracy=function(B,re,J){return b(this,void 0,void 0,function*(){return U.assert(B.rank===1,"labels must be a 1D tensor"),U.assert(re.rank===1,"predictions must be a 1D tensor"),U.assert(B.size===re.size,"labels and predictions must be the same length"),J==null&&(J=H.tidy(()=>H.maximum(B.max(),re.max()).dataSync()[0]+1)),Promise.all([B.data(),re.data()]).then(([R,P])=>{const $=Array(J).fill(0),L=Array(J).fill(0);for(let F=0;F<R.length;F++){const ue=R[F],ie=P[F];$[ue]+=1,ue===ie&&(L[ue]+=1)}const ee=[];for(let F=0;F<$.length;F++)ee.push({count:$[F],accuracy:$[F]===0?0:L[F]/$[F]});return ee})})}},function(Oe,A,o){/*
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function b(U,B){if(!U)throw new Error(typeof B=="string"?B:B())}function H(U,B){if(U.length!==B.length)return!1;for(let re=0;re<U.length;re++)if(U[re]!==B[re])return!1;return!0}Object.defineProperty(A,"__esModule",{value:!0}),A.assert=b,A.assertShapesMatch=function(U,B,re=""){b(H(U,B),re+` Shapes ${U} and ${B} must match`)},A.arraysEqual=H,A.DECIMAL_PLACES_TO_CHECK=4},function(Oe,A,o){const b=o(47);Oe.exports=(H,U,B)=>{try{U=new b(U,B)}catch{return!1}return U.test(H)}},function(Oe,A,o){const b=Symbol("SemVer ANY");class H{static get ANY(){return b}constructor(ee,F){if(F=U(F),ee instanceof H){if(ee.loose===!!F.loose)return ee;ee=ee.value}R("comparator",ee,F),this.options=F,this.loose=!!F.loose,this.parse(ee),this.semver===b?this.value="":this.value=this.operator+this.semver.version,R("comp",this)}parse(ee){const F=this.options.loose?B[re.COMPARATORLOOSE]:B[re.COMPARATOR],ue=ee.match(F);if(!ue)throw new TypeError(`Invalid comparator: ${ee}`);this.operator=ue[1]!==void 0?ue[1]:"",this.operator==="="&&(this.operator=""),ue[2]?this.semver=new P(ue[2],this.options.loose):this.semver=b}toString(){return this.value}test(ee){if(R("Comparator.test",ee,this.options.loose),this.semver===b||ee===b)return!0;if(typeof ee=="string")try{ee=new P(ee,this.options)}catch{return!1}return J(ee,this.operator,this.semver,this.options)}intersects(ee,F){if(!(ee instanceof H))throw new TypeError("a Comparator is required");if(F&&typeof F=="object"||(F={loose:!!F,includePrerelease:!1}),this.operator==="")return this.value===""||new $(ee.value,F).test(this.value);if(ee.operator==="")return ee.value===""||new $(this.value,F).test(ee.semver);const ue=!(this.operator!==">="&&this.operator!==">"||ee.operator!==">="&&ee.operator!==">"),ie=!(this.operator!=="<="&&this.operator!=="<"||ee.operator!=="<="&&ee.operator!=="<"),K=this.semver.version===ee.semver.version,he=!(this.operator!==">="&&this.operator!=="<="||ee.operator!==">="&&ee.operator!=="<="),pe=J(this.semver,"<",ee.semver,F)&&(this.operator===">="||this.operator===">")&&(ee.operator==="<="||ee.operator==="<"),Ae=J(this.semver,">",ee.semver,F)&&(this.operator==="<="||this.operator==="<")&&(ee.operator===">="||ee.operator===">");return ue||ie||K&&he||pe||Ae}}Oe.exports=H;const U=o(115),{re:B,t:re}=o(90),J=o(203),R=o(116),P=o(32),$=o(47)},function(Oe,A,o){const b=o(48);Oe.exports=(H,U,B)=>b(H,U,B)>0},function(Oe,A){const o=["includePrerelease","loose","rtl"];Oe.exports=b=>b?typeof b!="object"?{loose:!0}:o.filter(H=>b[H]).reduce((H,U)=>(H[U]=!0,H),{}):{}},function(Oe,A,o){(function(b){const H=typeof b=="object"&&b.env&&b.env.NODE_DEBUG&&/\bsemver\b/i.test(b.env.NODE_DEBUG)?(...U)=>console.error("SEMVER",...U):()=>{};Oe.exports=H}).call(this,o(75))},function(Oe,A){const o=Number.MAX_SAFE_INTEGER||9007199254740991;Oe.exports={SEMVER_SPEC_VERSION:"2.0.0",MAX_LENGTH:256,MAX_SAFE_INTEGER:o,MAX_SAFE_COMPONENT_LENGTH:16}},function(Oe,A,o){for(var b,H=o(16),U=o(42),B=o(84),re=B("typed_array"),J=B("view"),R=!(!H.ArrayBuffer||!H.DataView),P=R,$=0,L="Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(",");$<9;)(b=H[L[$++]])?(U(b.prototype,re,!0),U(b.prototype,J,!0)):P=!1;Oe.exports={ABV:R,CONSTR:P,TYPED:re,VIEW:J}},function(Oe,A,o){var b=o(16),H=o(8),U=o(38),B=o(93),re=o(65),J=o(121),R=o(94),P=o(13),$=o(15),L=o(125),ee=o(98),F=o(168);Oe.exports=function(ue,ie,K,he,pe,Ae){var Te=b[ue],je=Te,ke=pe?"set":"add",at=je&&je.prototype,St={},zt=function(Ye){var ln=at[Ye];U(at,Ye,Ye=="delete"?function(Zt){return!(Ae&&!P(Zt))&&ln.call(this,Zt===0?0:Zt)}:Ye=="has"?function(Zt){return!(Ae&&!P(Zt))&&ln.call(this,Zt===0?0:Zt)}:Ye=="get"?function(Zt){return Ae&&!P(Zt)?void 0:ln.call(this,Zt===0?0:Zt)}:Ye=="add"?function(Zt){return ln.call(this,Zt===0?0:Zt),this}:function(Zt,Bt){return ln.call(this,Zt===0?0:Zt,Bt),this})};if(typeof je=="function"&&(Ae||at.forEach&&!$(function(){new je().entries().next()}))){var $t=new je,we=$t[ke](Ae?{}:-0,1)!=$t,Tt=$(function(){$t.has(1)}),Gt=L(function(Ye){new je(Ye)}),Pt=!Ae&&$(function(){for(var Ye=new je,ln=5;ln--;)Ye[ke](ln,ln);return!Ye.has(-0)});Gt||((je=ie(function(Ye,ln){R(Ye,je,ue);var Zt=F(new Te,Ye,je);return ln!=null&&J(ln,pe,Zt[ke],Zt),Zt})).prototype=at,at.constructor=je),(Tt||Pt)&&(zt("delete"),zt("has"),pe&&zt("get")),(Pt||we)&&zt(ke),Ae&&at.clear&&delete at.clear}else je=he.getConstructor(ie,ue,pe,ke),B(je.prototype,K),re.NEED=!0;return ee(je,ue),St[ue]=je,H(H.G+H.W+H.F*(je!=Te),St),Ae||he.setStrong(je,ue,pe),je}},function(Oe,A,o){var b=o(16).navigator;Oe.exports=b&&b.userAgent||""},function(Oe,A,o){var b=o(56),H=o(225),U=o(159),B=o(14),re=o(22),J=o(157),R={},P={};(A=Oe.exports=function($,L,ee,F,ue){var ie,K,he,pe,Ae=ue?function(){return $}:J($),Te=b(ee,F,L?2:1),je=0;if(typeof Ae!="function")throw TypeError($+" is not iterable!");if(U(Ae)){for(ie=re($.length);ie>je;je++)if((pe=L?Te(B(K=$[je])[0],K[1]):Te($[je]))===R||pe===P)return pe}else for(he=Ae.call($);!(K=he.next()).done;)if((pe=H(he,Te,K.value,L))===R||pe===P)return pe}).BREAK=R,A.RETURN=P},function(Oe,A,o){o(220);var b=o(38),H=o(42),U=o(15),B=o(61),re=o(19),J=o(154),R=re("species"),P=!U(function(){var L=/./;return L.exec=function(){var ee=[];return ee.groups={a:"7"},ee},"".replace(L,"$<a>")!=="7"}),$=function(){var L=/(?:)/,ee=L.exec;L.exec=function(){return ee.apply(this,arguments)};var F="ab".split(L);return F.length===2&&F[0]==="a"&&F[1]==="b"}();Oe.exports=function(L,ee,F){var ue=re(L),ie=!U(function(){var je={};return je[ue]=function(){return 7},""[L](je)!=7}),K=ie?!U(function(){var je=!1,ke=/a/;return ke.exec=function(){return je=!0,null},L==="split"&&(ke.constructor={},ke.constructor[R]=function(){return ke}),ke[ue](""),!je}):void 0;if(!ie||!K||L==="replace"&&!P||L==="split"&&!$){var he=/./[ue],pe=F(B,ue,""[L],function(je,ke,at,St,zt){return ke.exec===J?ie&&!zt?{done:!0,value:he.call(ke,at,St)}:{done:!0,value:je.call(at,ke,St)}:{done:!1}}),Ae=pe[0],Te=pe[1];b(String.prototype,L,Ae),H(RegExp.prototype,ue,ee==2?function(je,ke){return Te.call(je,this,ke)}:function(je){return Te.call(je,this)})}}},function(Oe,A,o){var b=o(105),H=RegExp.prototype.exec;Oe.exports=function(U,B){var re=U.exec;if(typeof re=="function"){var J=re.call(U,B);if(typeof J!="object")throw new TypeError("RegExp exec method returned something other than an Object or null");return J}if(b(U)!=="RegExp")throw new TypeError("RegExp#exec called on incompatible receiver");return H.call(U,B)}},function(Oe,A,o){var b=o(14);Oe.exports=function(){var H=b(this),U="";return H.global&&(U+="g"),H.ignoreCase&&(U+="i"),H.multiline&&(U+="m"),H.unicode&&(U+="u"),H.sticky&&(U+="y"),U}},function(Oe,A,o){var b=o(19)("iterator"),H=!1;try{var U=[7][b]();U.return=function(){H=!0},Array.from(U,function(){throw 2})}catch{}Oe.exports=function(B,re){if(!re&&!H)return!1;var J=!1;try{var R=[7],P=R[b]();P.next=function(){return{done:J=!0}},R[b]=function(){return P},B(R)}catch{}return J}},function(Oe,A,o){var b=o(62);Oe.exports=Array.isArray||function(H){return b(H)=="Array"}},function(Oe,A){A.f=Object.getOwnPropertySymbols},function(Oe,A,o){var b=o(41),H=o(22),U=o(81);Oe.exports=function(B){return function(re,J,R){var P,$=b(re),L=H($.length),ee=U(R,L);if(B&&J!=J){for(;L>ee;)if((P=$[ee++])!=P)return!0}else for(;L>ee;ee++)if((B||ee in $)&&$[ee]===J)return B||ee||0;return!B&&-1}}},function(Oe,A,o){var b=o(24),H=o(16),U=H["__core-js_shared__"]||(H["__core-js_shared__"]={});(Oe.exports=function(B,re){return U[B]||(U[B]=re!==void 0?re:{})})("versions",[]).push({version:b.version,mode:o(83)?"pure":"global",copyright:" 2020 Denis Pushkarev (zloirock.ru)"})},function(Oe,A,o){o.r(A),(function(b,H){o.d(A,"array",function(){return Sn}),o.d(A,"Dataset",function(){return Lt}),o.d(A,"zip",function(){return kn}),o.d(A,"CSVDataset",function(){return hn}),o.d(A,"TextLineDataset",function(){return xe}),o.d(A,"csv",function(){return ai}),o.d(A,"func",function(){return Oa}),o.d(A,"generator",function(){return Wi}),o.d(A,"microphone",function(){return yt}),o.d(A,"webcam",function(){return Ci}),o.d(A,"FileDataSource",function(){return Xr}),o.d(A,"URLDataSource",function(){return fi}),o.d(A,"version_data",function(){return Lr});var U=o(0),B=function(jt,ge){return(B=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(fe,ye){fe.__proto__=ye}||function(fe,ye){for(var Se in ye)ye.hasOwnProperty(Se)&&(fe[Se]=ye[Se])})(jt,ge)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function re(jt,ge){function fe(){this.constructor=jt}B(jt,ge),jt.prototype=ge===null?Object.create(ge):(fe.prototype=ge.prototype,new fe)}function J(jt,ge,fe,ye){return new(fe||(fe=Promise))(function(Se,Ze){function mt(Jn){try{cn(ye.next(Jn))}catch(An){Ze(An)}}function Rt(Jn){try{cn(ye.throw(Jn))}catch(An){Ze(An)}}function cn(Jn){Jn.done?Se(Jn.value):new fe(function(An){An(Jn.value)}).then(mt,Rt)}cn((ye=ye.apply(jt,[])).next())})}function R(jt,ge){var fe,ye,Se,Ze,mt={label:0,sent:function(){if(1&Se[0])throw Se[1];return Se[1]},trys:[],ops:[]};return Ze={next:Rt(0),throw:Rt(1),return:Rt(2)},typeof Symbol=="function"&&(Ze[Symbol.iterator]=function(){return this}),Ze;function Rt(cn){return function(Jn){return function(An){if(fe)throw new TypeError("Generator is already executing.");for(;mt;)try{if(fe=1,ye&&(Se=2&An[0]?ye.return:An[0]?ye.throw||((Se=ye.return)&&Se.call(ye),0):ye.next)&&!(Se=Se.call(ye,An[1])).done)return Se;switch(ye=0,Se&&(An=[2&An[0],Se.value]),An[0]){case 0:case 1:Se=An;break;case 4:return mt.label++,{value:An[1],done:!1};case 5:mt.label++,ye=An[1],An=[0];continue;case 7:An=mt.ops.pop(),mt.trys.pop();continue;default:if(!(Se=(Se=mt.trys).length>0&&Se[Se.length-1])&&(An[0]===6||An[0]===2)){mt=0;continue}if(An[0]===3&&(!Se||An[1]>Se[0]&&An[1]<Se[3])){mt.label=An[1];break}if(An[0]===6&&mt.label<Se[1]){mt.label=Se[1],Se=An;break}if(Se&&mt.label<Se[2]){mt.label=Se[2],mt.ops.push(An);break}Se[2]&&mt.ops.pop(),mt.trys.pop();continue}An=ge.call(jt,mt)}catch(Ln){An=[6,Ln],ye=0}finally{fe=Se=0}if(5&An[0])throw An[1];return{value:An[0]?An[1]:void 0,done:!0}}([cn,Jn])}}}function P(jt,ge){return jt(ge={exports:{}},ge.exports),ge.exports}var $=P(function(jt){(function(ge,fe,ye){function Se(mt,Rt){return Rt.c=mt.c,Rt.s0=mt.s0,Rt.s1=mt.s1,Rt.s2=mt.s2,Rt}function Ze(mt,Rt){var cn=new function(Ln){var Hn,It=this,Ot=(Hn=4022871197,function(pn){pn=pn.toString();for(var qt=0;qt<pn.length;qt++){var Ve=.02519603282416938*(Hn+=pn.charCodeAt(qt));Ve-=Hn=Ve>>>0,Hn=(Ve*=Hn)>>>0,Hn+=4294967296*(Ve-=Hn)}return 23283064365386963e-26*(Hn>>>0)});It.next=function(){var pn=2091639*It.s0+23283064365386963e-26*It.c;return It.s0=It.s1,It.s1=It.s2,It.s2=pn-(It.c=0|pn)},It.c=1,It.s0=Ot(" "),It.s1=Ot(" "),It.s2=Ot(" "),It.s0-=Ot(Ln),It.s0<0&&(It.s0+=1),It.s1-=Ot(Ln),It.s1<0&&(It.s1+=1),It.s2-=Ot(Ln),It.s2<0&&(It.s2+=1),Ot=null}(mt),Jn=Rt&&Rt.state,An=cn.next;return An.int32=function(){return 4294967296*cn.next()|0},An.double=function(){return An()+11102230246251565e-32*(2097152*An()|0)},An.quick=An,Jn&&(typeof Jn=="object"&&Se(Jn,cn),An.state=function(){return Se(cn,{})}),An}fe&&fe.exports?fe.exports=Ze:this.alea=Ze})(0,jt)}),L=P(function(jt){(function(ge,fe,ye){function Se(mt,Rt){return Rt.x=mt.x,Rt.y=mt.y,Rt.z=mt.z,Rt.w=mt.w,Rt}function Ze(mt,Rt){var cn=new function(Ln){var Hn=this,It="";Hn.x=0,Hn.y=0,Hn.z=0,Hn.w=0,Hn.next=function(){var pn=Hn.x^Hn.x<<11;return Hn.x=Hn.y,Hn.y=Hn.z,Hn.z=Hn.w,Hn.w^=Hn.w>>>19^pn^pn>>>8},Ln===(0|Ln)?Hn.x=Ln:It+=Ln;for(var Ot=0;Ot<It.length+64;Ot++)Hn.x^=0|It.charCodeAt(Ot),Hn.next()}(mt),Jn=Rt&&Rt.state,An=function(){return(cn.next()>>>0)/4294967296};return An.double=function(){do var Ln=((cn.next()>>>11)+(cn.next()>>>0)/4294967296)/2097152;while(Ln===0);return Ln},An.int32=cn.next,An.quick=An,Jn&&(typeof Jn=="object"&&Se(Jn,cn),An.state=function(){return Se(cn,{})}),An}fe&&fe.exports?fe.exports=Ze:this.xor128=Ze})(0,jt)}),ee=P(function(jt){(function(ge,fe,ye){function Se(mt,Rt){return Rt.x=mt.x,Rt.y=mt.y,Rt.z=mt.z,Rt.w=mt.w,Rt.v=mt.v,Rt.d=mt.d,Rt}function Ze(mt,Rt){var cn=new function(Ln){var Hn=this,It="";Hn.next=function(){var pn=Hn.x^Hn.x>>>2;return Hn.x=Hn.y,Hn.y=Hn.z,Hn.z=Hn.w,Hn.w=Hn.v,(Hn.d=Hn.d+362437|0)+(Hn.v=Hn.v^Hn.v<<4^pn^pn<<1)|0},Hn.x=0,Hn.y=0,Hn.z=0,Hn.w=0,Hn.v=0,Ln===(0|Ln)?Hn.x=Ln:It+=Ln;for(var Ot=0;Ot<It.length+64;Ot++)Hn.x^=0|It.charCodeAt(Ot),Ot==It.length&&(Hn.d=Hn.x<<10^Hn.x>>>4),Hn.next()}(mt),Jn=Rt&&Rt.state,An=function(){return(cn.next()>>>0)/4294967296};return An.double=function(){do var Ln=((cn.next()>>>11)+(cn.next()>>>0)/4294967296)/2097152;while(Ln===0);return Ln},An.int32=cn.next,An.quick=An,Jn&&(typeof Jn=="object"&&Se(Jn,cn),An.state=function(){return Se(cn,{})}),An}fe&&fe.exports?fe.exports=Ze:this.xorwow=Ze})(0,jt)}),F=P(function(jt){(function(ge,fe,ye){function Se(mt,Rt){return Rt.x=mt.x.slice(),Rt.i=mt.i,Rt}function Ze(mt,Rt){mt==null&&(mt=+new Date);var cn=new function(Ln){var Hn=this;Hn.next=function(){var It,Ot,pn=Hn.x,qt=Hn.i;return It=pn[qt],Ot=(It^=It>>>7)^It<<24,Ot^=(It=pn[qt+1&7])^It>>>10,Ot^=(It=pn[qt+3&7])^It>>>3,Ot^=(It=pn[qt+4&7])^It<<7,It=pn[qt+7&7],Ot^=(It^=It<<13)^It<<9,pn[qt]=Ot,Hn.i=qt+1&7,Ot},function(It,Ot){var pn,qt=[];if(Ot===(0|Ot))qt[0]=Ot;else for(Ot=""+Ot,pn=0;pn<Ot.length;++pn)qt[7&pn]=qt[7&pn]<<15^Ot.charCodeAt(pn)+qt[pn+1&7]<<13;for(;qt.length<8;)qt.push(0);for(pn=0;pn<8&&qt[pn]===0;++pn);for(pn==8?qt[7]=-1:qt[pn],It.x=qt,It.i=0,pn=256;pn>0;--pn)It.next()}(Hn,Ln)}(mt),Jn=Rt&&Rt.state,An=function(){return(cn.next()>>>0)/4294967296};return An.double=function(){do var Ln=((cn.next()>>>11)+(cn.next()>>>0)/4294967296)/2097152;while(Ln===0);return Ln},An.int32=cn.next,An.quick=An,Jn&&(Jn.x&&Se(Jn,cn),An.state=function(){return Se(cn,{})}),An}fe&&fe.exports?fe.exports=Ze:this.xorshift7=Ze})(0,jt)}),ue=P(function(jt){(function(ge,fe,ye){function Se(mt,Rt){return Rt.i=mt.i,Rt.w=mt.w,Rt.X=mt.X.slice(),Rt}function Ze(mt,Rt){mt==null&&(mt=+new Date);var cn=new function(Ln){var Hn=this;Hn.next=function(){var It,Ot,pn=Hn.w,qt=Hn.X,Ve=Hn.i;return Hn.w=pn=pn+1640531527|0,Ot=qt[Ve+34&127],It=qt[Ve=Ve+1&127],Ot^=Ot<<13,It^=It<<17,Ot^=Ot>>>15,It^=It>>>12,Ot=qt[Ve]=Ot^It,Hn.i=Ve,Ot+(pn^pn>>>16)|0},function(It,Ot){var pn,qt,Ve,jn,$n,Zn=[],ir=128;for(Ot===(0|Ot)?(qt=Ot,Ot=null):(Ot+="\0",qt=0,ir=Math.max(ir,Ot.length)),Ve=0,jn=-32;jn<ir;++jn)Ot&&(qt^=Ot.charCodeAt((jn+32)%Ot.length)),jn===0&&($n=qt),qt^=qt<<10,qt^=qt>>>15,qt^=qt<<4,qt^=qt>>>13,jn>=0&&($n=$n+1640531527|0,Ve=(pn=Zn[127&jn]^=qt+$n)==0?Ve+1:0);for(Ve>=128&&(Zn[127&(Ot&&Ot.length||0)]=-1),Ve=127,jn=512;jn>0;--jn)qt=Zn[Ve+34&127],pn=Zn[Ve=Ve+1&127],qt^=qt<<13,pn^=pn<<17,qt^=qt>>>15,pn^=pn>>>12,Zn[Ve]=qt^pn;It.w=$n,It.X=Zn,It.i=Ve}(Hn,Ln)}(mt),Jn=Rt&&Rt.state,An=function(){return(cn.next()>>>0)/4294967296};return An.double=function(){do var Ln=((cn.next()>>>11)+(cn.next()>>>0)/4294967296)/2097152;while(Ln===0);return Ln},An.int32=cn.next,An.quick=An,Jn&&(Jn.X&&Se(Jn,cn),An.state=function(){return Se(cn,{})}),An}fe&&fe.exports?fe.exports=Ze:this.xor4096=Ze})(0,jt)}),ie=P(function(jt){(function(ge,fe,ye){function Se(mt,Rt){return Rt.a=mt.a,Rt.b=mt.b,Rt.c=mt.c,Rt.d=mt.d,Rt}function Ze(mt,Rt){var cn=new function(Ln){var Hn=this,It="";Hn.next=function(){var pn=Hn.b,qt=Hn.c,Ve=Hn.d,jn=Hn.a;return pn=pn<<25^pn>>>7^qt,qt=qt-Ve|0,Ve=Ve<<24^Ve>>>8^jn,jn=jn-pn|0,Hn.b=pn=pn<<20^pn>>>12^qt,Hn.c=qt=qt-Ve|0,Hn.d=Ve<<16^qt>>>16^jn,Hn.a=jn-pn|0},Hn.a=0,Hn.b=0,Hn.c=-1640531527,Hn.d=1367130551,Ln===Math.floor(Ln)?(Hn.a=Ln/4294967296|0,Hn.b=0|Ln):It+=Ln;for(var Ot=0;Ot<It.length+20;Ot++)Hn.b^=0|It.charCodeAt(Ot),Hn.next()}(mt),Jn=Rt&&Rt.state,An=function(){return(cn.next()>>>0)/4294967296};return An.double=function(){do var Ln=((cn.next()>>>11)+(cn.next()>>>0)/4294967296)/2097152;while(Ln===0);return Ln},An.int32=cn.next,An.quick=An,Jn&&(typeof Jn=="object"&&Se(Jn,cn),An.state=function(){return Se(cn,{})}),An}fe&&fe.exports?fe.exports=Ze:this.tychei=Ze})(0,jt)}),K=P(function(jt){(function(ge,fe){var ye,Se=this,Ze=256,mt=6,Rt="random",cn=fe.pow(Ze,mt),Jn=fe.pow(2,52),An=2*Jn,Ln=Ze-1;function Hn(qt,Ve,jn){var $n=[],Zn=Ot(function vr(pi,la){var ui,Qi=[],Di=typeof pi;if(la&&Di=="object")for(ui in pi)try{Qi.push(vr(pi[ui],la-1))}catch{}return Qi.length?Qi:Di=="string"?pi:pi+"\0"}((Ve=Ve==1?{entropy:!0}:Ve||{}).entropy?[qt,pn(ge)]:qt??function(){try{var vr;return ye&&(vr=ye.randomBytes)?vr=vr(Ze):(vr=new Uint8Array(Ze),(Se.crypto||Se.msCrypto).getRandomValues(vr)),pn(vr)}catch{var pi=Se.navigator,la=pi&&pi.plugins;return[+new Date,Se,la,Se.screen,pn(ge)]}}(),3),$n),ir=new function(vr){var pi,la=vr.length,ui=this,Qi=0,Di=ui.i=ui.j=0,qr=ui.S=[];for(la||(vr=[la++]);Qi<Ze;)qr[Qi]=Qi++;for(Qi=0;Qi<Ze;Qi++)qr[Qi]=qr[Di=Ln&Di+vr[Qi%la]+(pi=qr[Qi])],qr[Di]=pi;(ui.g=function(jr){for(var Bn,ri=0,Vi=ui.i,Fr=ui.j,aa=ui.S;jr--;)Bn=aa[Vi=Ln&Vi+1],ri=ri*Ze+aa[Ln&(aa[Vi]=aa[Fr=Ln&Fr+Bn])+(aa[Fr]=Bn)];return ui.i=Vi,ui.j=Fr,ri})(Ze)}($n),zr=function(){for(var vr=ir.g(mt),pi=cn,la=0;vr<Jn;)vr=(vr+la)*Ze,pi*=Ze,la=ir.g(1);for(;vr>=An;)vr/=2,pi/=2,la>>>=1;return(vr+la)/pi};return zr.int32=function(){return 0|ir.g(4)},zr.quick=function(){return ir.g(4)/4294967296},zr.double=zr,Ot(pn(ir.S),ge),(Ve.pass||jn||function(vr,pi,la,ui){return ui&&(ui.S&&It(ui,ir),vr.state=function(){return It(ir,{})}),la?(fe[Rt]=vr,pi):vr})(zr,Zn,"global"in Ve?Ve.global:this==fe,Ve.state)}function It(qt,Ve){return Ve.i=qt.i,Ve.j=qt.j,Ve.S=qt.S.slice(),Ve}function Ot(qt,Ve){for(var jn,$n=qt+"",Zn=0;Zn<$n.length;)Ve[Ln&Zn]=Ln&(jn^=19*Ve[Ln&Zn])+$n.charCodeAt(Zn++);return pn(Ve)}function pn(qt){return String.fromCharCode.apply(0,qt)}if(fe["seed"+Rt]=Hn,Ot(fe.random(),ge),jt.exports){jt.exports=Hn;try{ye=o(387)}catch{}}})([],Math)});K.alea=$,K.xor128=L,K.xorwow=ee,K.xorshift7=F,K.xor4096=ue,K.tychei=ie;var he=K.alea;function pe(jt,ge,fe,ye){if(fe===void 0&&(fe=new Map),ye===void 0&&(ye=new Set),jt==null)return null;if(ye.has(jt))throw new Error("Circular references are not supported.");if(fe.has(jt))return fe.get(jt);var Se=ge(jt);if(Se.recurse&&Se.value!==null)throw new Error("A deep map function may not return both a value and recurse=true.");if(Se.recurse){if(ke(jt)){var Ze=Array.isArray(jt)?[]:{};for(var mt in ye.add(jt),jt){var Rt=pe(jt[mt],ge,fe,ye);Ze[mt]=Rt}return ye.delete(jt),Ze}throw new Error("Can't recurse into non-iterable type: "+jt)}return fe.set(jt,Se.value),Se.value}function Ae(jt,ge){return ge===void 0&&(ge=Te),function fe(ye,Se,Ze){Ze===void 0&&(Ze=new Set);var mt=ye[0];if(Ze.has(mt))throw new Error("Circular references are not supported.");var Rt=Se(ye);if(Rt.recurse&&Rt.value!==null)throw new Error("A deep zip function may not return both a value and recurse=true.");if(Rt.recurse){if(ke(mt)){var cn=Array.isArray(mt)?[]:{};Ze.add(mt);var Jn=function(Ln){var Hn=fe(ye.map(function(It){return It[Ln]}),Se,Ze);cn[Ln]=Hn};for(var An in mt)Jn(An);return Ze.delete(mt),cn}throw new Error("Can't recurse into non-iterable type: "+mt)}return Rt.value}(jt,ge)}function Te(jt){return jt===null?null:ke(jt[0])?{value:null,recurse:!0}:{value:jt,recurse:!1}}function je(jt,ge){return J(this,void 0,void 0,function(){var fe,ye,Se,Ze,mt,Rt;return R(this,function(cn){switch(cn.label){case 0:fe=new Map,pe(jt,ge,fe),ye=0,Se=Array.from(fe.keys()),cn.label=1;case 1:return ye<Se.length?(Ze=Se[ye],(mt=fe.get(Ze))instanceof Promise?[4,mt]:[3,3]):[3,4];case 2:Rt=cn.sent(),fe.set(Ze,Rt),cn.label=3;case 3:return ye++,[3,1];case 4:return[2,pe(jt,ge,fe)]}})})}function ke(jt){return jt!=null&&!ArrayBuffer.isView(jt)&&(Array.isArray(jt)||typeof jt=="object"&&!(jt instanceof U.Tensor))}function at(jt){return function(ge,fe){return pe(ge,fe)}(jt,St)}function St(jt){return jt instanceof U.Tensor?{value:jt.clone(),recurse:!1}:ke(jt)?{value:null,recurse:!0}:{value:jt,recurse:!1}}var zt=function(){function jt(ge){if(this.capacity=ge,this.begin=0,this.end=0,ge==null)throw new RangeError("Can't create a ring buffer of unknown capacity.");if(ge<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(ge),this.doubledCapacity=2*ge}return jt.prototype.wrap=function(ge){for(;ge<0;)ge+=this.doubledCapacity;return ge%this.doubledCapacity},jt.prototype.get=function(ge){if(ge<0)throw new RangeError("Can't get item at a negative index.");return this.data[ge%this.capacity]},jt.prototype.set=function(ge,fe){if(ge<0)throw new RangeError("Can't set item at a negative index.");this.data[ge%this.capacity]=fe},jt.prototype.length=function(){var ge=this.end-this.begin;return ge<0&&(ge=this.doubledCapacity+ge),ge},jt.prototype.isFull=function(){return this.length()===this.capacity},jt.prototype.isEmpty=function(){return this.length()===0},jt.prototype.push=function(ge){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,ge),this.end=this.wrap(this.end+1)},jt.prototype.pushAll=function(ge){for(var fe=0,ye=ge;fe<ye.length;fe++){var Se=ye[fe];this.push(Se)}},jt.prototype.pop=function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);var ge=this.get(this.end);return this.set(this.end,void 0),ge},jt.prototype.unshift=function(ge){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,ge)},jt.prototype.shift=function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var ge=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),ge},jt.prototype.shuffleExcise=function(ge){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var fe=this.wrap(this.begin+ge),ye=this.get(fe);return this.set(fe,this.pop()),ye},jt}(),$t=function(jt){function ge(){return jt.call(this,ge.INITIAL_CAPACITY)||this}return re(ge,jt),ge.prototype.isFull=function(){return!1},ge.prototype.push=function(fe){jt.prototype.isFull.call(this)&&this.expand(),jt.prototype.push.call(this,fe)},ge.prototype.unshift=function(fe){jt.prototype.isFull.call(this)&&this.expand(),jt.prototype.unshift.call(this,fe)},ge.prototype.expand=function(){for(var fe=2*this.capacity,ye=new Array(fe),Se=this.length(),Ze=0;Ze<Se;Ze++)ye[Ze]=this.get(this.wrap(this.begin+Ze));this.data=ye,this.capacity=fe,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=Se},ge.INITIAL_CAPACITY=32,ge}(zt);function we(jt){return new Ye(jt)}function Tt(jt){return new ln(jt)}var Gt,Pt=function(){function jt(){}return jt.prototype.toArray=function(){return J(this,void 0,void 0,function(){var ge,fe;return R(this,function(ye){switch(ye.label){case 0:return ge=[],[4,this.next()];case 1:fe=ye.sent(),ye.label=2;case 2:return fe.done?[3,4]:(ge.push(fe.value),[4,this.next()]);case 3:return fe=ye.sent(),[3,2];case 4:return[2,ge]}})})},jt.prototype.toArrayForTest=function(){return J(this,void 0,void 0,function(){var ge,fe,ye;return R(this,function(Se){switch(Se.label){case 0:return ge=this.prefetch(100),fe=[],[4,ge.next()];case 1:ye=Se.sent(),Se.label=2;case 2:return ye.done?[3,4]:(fe.push(ye.value),[4,ge.next()]);case 3:return ye=Se.sent(),[3,2];case 4:return[2,fe]}})})},jt.prototype.resolveFully=function(){return J(this,void 0,void 0,function(){var ge;return R(this,function(fe){switch(fe.label){case 0:return[4,this.next()];case 1:ge=fe.sent(),fe.label=2;case 2:return ge.done?[3,4]:[4,this.next()];case 3:return ge=fe.sent(),[3,2];case 4:return[2]}})})},jt.prototype.resolveWhile=function(ge){return J(this,void 0,void 0,function(){var fe,ye;return R(this,function(Se){switch(Se.label){case 0:return[4,this.next()];case 1:fe=Se.sent(),ye=ge(fe.value),Se.label=2;case 2:return fe.done||!ye?[3,4]:[4,this.next()];case 3:return fe=Se.sent(),ye=ge(fe.value),[3,2];case 4:return[2]}})})},jt.prototype.handleErrors=function(ge){return new xn(this,ge)},jt.prototype.filter=function(ge){return new Dt(this,ge)},jt.prototype.map=function(ge){return new _t(this,ge)},jt.prototype.mapAsync=function(ge){return new In(this,ge)},jt.prototype.serialMapAsync=function(ge){return new In(this,ge).serial()},jt.prototype.flatmap=function(ge){return new fn(this,ge)},jt.prototype.forEachAsync=function(ge){return J(this,void 0,void 0,function(){return R(this,function(fe){return[2,this.map(ge).resolveFully()]})})},jt.prototype.serialForEach=function(ge){return J(this,void 0,void 0,function(){return R(this,function(fe){return[2,this.serialMapAsync(ge).resolveWhile(function(ye){return ye===!0})]})})},jt.prototype.rowMajorBatch=function(ge,fe){return fe===void 0&&(fe=!0),new bn(this,ge,fe)},jt.prototype.columnMajorBatch=function(ge,fe,ye){return fe===void 0&&(fe=!0),ye===void 0&&(ye=Te),this.rowMajorBatch(ge,fe).map(function(Se){return Ae(Se,ye)})},jt.prototype.concatenate=function(ge,fe){return new We(we([this,ge]),fe)},jt.prototype.take=function(ge){return ge<0||ge==null?this:new Mt(this,ge)},jt.prototype.skip=function(ge){return ge<0||ge==null?this:new Bt(this,ge)},jt.prototype.prefetch=function(ge){return new rt(this,ge)},jt.prototype.shuffle=function(ge,fe){return new Et(this,ge,fe)},jt.prototype.serial=function(){return new Zt(this)},jt}(),Ye=function(jt){function ge(fe){var ye=jt.call(this)||this;return ye.items=fe,ye.trav=0,ye}return re(ge,jt),ge.prototype.summary=function(){return"Array of "+this.items.length+" items"},ge.prototype.next=function(){return J(this,void 0,void 0,function(){var fe;return R(this,function(ye){return this.trav>=this.items.length?[2,{value:null,done:!0}]:(fe=this.items[this.trav],this.trav++,[2,{value:at(fe),done:!1}])})})},ge}(Pt),ln=function(jt){function ge(fe){var ye=jt.call(this)||this;return ye.nextFn=fe,ye}return re(ge,jt),ge.prototype.summary=function(){return"Function call"},ge.prototype.next=function(){return J(this,void 0,void 0,function(){return R(this,function(fe){try{return[2,this.nextFn()]}catch(ye){throw ye.message="Error thrown while iterating through a dataset: "+ye.message,ye}return[2]})})},ge}(Pt),Zt=function(jt){function ge(fe){var ye=jt.call(this)||this;return ye.upstream=fe,ye.lastRead=Promise.resolve({value:null,done:!1}),ye}return re(ge,jt),ge.prototype.summary=function(){return this.upstream.summary()+" -> Serial"},ge.prototype.next=function(){return J(this,void 0,void 0,function(){var fe=this;return R(this,function(ye){return this.lastRead=this.lastRead.then(function(){return fe.serialNext()}),[2,this.lastRead]})})},ge.prototype.serialNext=function(){return J(this,void 0,void 0,function(){return R(this,function(fe){return[2,this.upstream.next()]})})},ge}(Pt),Bt=function(jt){function ge(fe,ye){var Se=jt.call(this)||this;return Se.upstream=fe,Se.maxCount=ye,Se.count=0,Se.lastRead=Promise.resolve({value:null,done:!1}),Se}return re(ge,jt),ge.prototype.summary=function(){return this.upstream.summary()+" -> Skip"},ge.prototype.next=function(){return J(this,void 0,void 0,function(){var fe=this;return R(this,function(ye){return this.lastRead=this.lastRead.then(function(){return fe.serialNext()}),[2,this.lastRead]})})},ge.prototype.serialNext=function(){return J(this,void 0,void 0,function(){var fe;return R(this,function(ye){switch(ye.label){case 0:return this.count++<this.maxCount?[4,this.upstream.next()]:[3,2];case 1:return(fe=ye.sent()).done?[2,fe]:(Object(U.dispose)(fe.value),[3,0]);case 2:return[2,this.upstream.next()]}})})},ge}(Pt),Mt=function(jt){function ge(fe,ye){var Se=jt.call(this)||this;return Se.upstream=fe,Se.maxCount=ye,Se.count=0,Se}return re(ge,jt),ge.prototype.summary=function(){return this.upstream.summary()+" -> Take"},ge.prototype.next=function(){return J(this,void 0,void 0,function(){return R(this,function(fe){return this.count++>=this.maxCount?[2,{value:null,done:!0}]:[2,this.upstream.next()]})})},ge}(Pt),bn=function(jt){function ge(fe,ye,Se){Se===void 0&&(Se=!0);var Ze=jt.call(this)||this;return Ze.upstream=fe,Ze.batchSize=ye,Ze.enableSmallLastBatch=Se,Ze.lastRead=Promise.resolve({value:null,done:!1}),Ze}return re(ge,jt),ge.prototype.summary=function(){return this.upstream.summary()+" -> RowMajorBatch"},ge.prototype.next=function(){return J(this,void 0,void 0,function(){var fe=this;return R(this,function(ye){return this.lastRead=this.lastRead.then(function(){return fe.serialNext()}),[2,this.lastRead]})})},ge.prototype.serialNext=function(){return J(this,void 0,void 0,function(){var fe,ye;return R(this,function(Se){switch(Se.label){case 0:fe=[],Se.label=1;case 1:return fe.length<this.batchSize?[4,this.upstream.next()]:[3,3];case 2:return(ye=Se.sent()).done?this.enableSmallLastBatch&&fe.length>0?[2,{value:fe,done:!1}]:[2,{value:null,done:!0}]:(fe.push(ye.value),[3,1]);case 3:return[2,{value:fe,done:!1}]}})})},ge}(Pt),Dt=function(jt){function ge(fe,ye){var Se=jt.call(this)||this;return Se.upstream=fe,Se.predicate=ye,Se.lastRead=Promise.resolve({value:null,done:!1}),Se}return re(ge,jt),ge.prototype.summary=function(){return this.upstream.summary()+" -> Filter"},ge.prototype.next=function(){return J(this,void 0,void 0,function(){var fe=this;return R(this,function(ye){return this.lastRead=this.lastRead.then(function(){return fe.serialNext()}),[2,this.lastRead]})})},ge.prototype.serialNext=function(){return J(this,void 0,void 0,function(){var fe;return R(this,function(ye){switch(ye.label){case 0:return[4,this.upstream.next()];case 1:return(fe=ye.sent()).done||this.predicate(fe.value)?[2,fe]:(Object(U.dispose)(fe.value),[3,0]);case 2:return[2]}})})},ge}(Pt),_t=function(jt){function ge(fe,ye){var Se=jt.call(this)||this;return Se.upstream=fe,Se.transform=ye,Se}return re(ge,jt),ge.prototype.summary=function(){return this.upstream.summary()+" -> Map"},ge.prototype.next=function(){return J(this,void 0,void 0,function(){var fe,ye,Se,Ze,mt,Rt,cn;return R(this,function(Jn){switch(Jn.label){case 0:return[4,this.upstream.next()];case 1:if((fe=Jn.sent()).done)return[2,{value:null,done:!0}];for(ye=U.tensor_util.getTensorsInContainer(fe.value),Se=this.transform(fe.value),Ze=U.tensor_util.getTensorsInContainer(Se),mt=0,Rt=ye;mt<Rt.length;mt++)cn=Rt[mt],U.tensor_util.isTensorInList(cn,Ze)||cn.dispose();return[2,{value:Se,done:!1}]}})})},ge}(Pt),xn=function(jt){function ge(fe,ye){var Se=jt.call(this)||this;return Se.upstream=fe,Se.handler=ye,Se.count=0,Se.lastRead=Promise.resolve({value:null,done:!1}),Se}return re(ge,jt),ge.prototype.summary=function(){return this.upstream.summary()+" -> handleErrors"},ge.prototype.next=function(){return J(this,void 0,void 0,function(){var fe=this;return R(this,function(ye){return this.lastRead=this.lastRead.then(function(){return fe.serialNext()}),[2,this.lastRead]})})},ge.prototype.serialNext=function(){return J(this,void 0,void 0,function(){var fe;return R(this,function(ye){switch(ye.label){case 0:ye.label=1;case 1:return ye.trys.push([1,3,,4]),[4,this.upstream.next()];case 2:return[2,ye.sent()];case 3:return fe=ye.sent(),this.handler(fe)?[3,4]:[2,{value:null,done:!0}];case 4:return[3,0];case 5:return[2]}})})},ge}(Pt),In=function(jt){function ge(fe,ye){var Se=jt.call(this)||this;return Se.upstream=fe,Se.transform=ye,Se}return re(ge,jt),ge.prototype.summary=function(){return this.upstream.summary()+" -> AsyncMap"},ge.prototype.next=function(){return J(this,void 0,void 0,function(){var fe,ye,Se,Ze,mt,Rt,cn;return R(this,function(Jn){switch(Jn.label){case 0:return[4,this.upstream.next()];case 1:return(fe=Jn.sent()).done?[2,{value:null,done:!0}]:(ye=U.tensor_util.getTensorsInContainer(fe.value),[4,this.transform(fe.value)]);case 2:for(Se=Jn.sent(),Ze=U.tensor_util.getTensorsInContainer(Se),mt=0,Rt=ye;mt<Rt.length;mt++)cn=Rt[mt],U.tensor_util.isTensorInList(cn,Ze)||cn.dispose();return[2,{value:Se,done:!1}]}})})},ge}(Pt),Yn=function(jt){function ge(){var fe=jt.call(this)||this;return fe.outputQueue=new $t,fe.lastRead=Promise.resolve({value:null,done:!1}),fe}return re(ge,jt),ge.prototype.next=function(){return J(this,void 0,void 0,function(){var fe=this;return R(this,function(ye){return this.lastRead=this.lastRead.then(function(){return fe.serialNext()}),[2,this.lastRead]})})},ge.prototype.serialNext=function(){return J(this,void 0,void 0,function(){return R(this,function(fe){switch(fe.label){case 0:return this.outputQueue.length()!==0?[3,2]:[4,this.pump()];case 1:return fe.sent()?[3,0]:[2,{value:null,done:!0}];case 2:return[2,{value:this.outputQueue.shift(),done:!1}]}})})},ge}(Pt),fn=function(jt){function ge(fe,ye){var Se=jt.call(this)||this;return Se.upstream=fe,Se.transform=ye,Se}return re(ge,jt),ge.prototype.summary=function(){return this.upstream.summary()+" -> Flatmap"},ge.prototype.pump=function(){return J(this,void 0,void 0,function(){var fe,ye,Se,Ze,mt,Rt,cn;return R(this,function(Jn){switch(Jn.label){case 0:return[4,this.upstream.next()];case 1:if((fe=Jn.sent()).done)return[2,!1];for(ye=U.tensor_util.getTensorsInContainer(fe.value),Se=this.transform(fe.value),Ze=U.tensor_util.getTensorsInContainer(Se),this.outputQueue.pushAll(Se),mt=0,Rt=ye;mt<Rt.length;mt++)cn=Rt[mt],U.tensor_util.isTensorInList(cn,Ze)||cn.dispose();return[2,!0]}})})},ge}(Yn),We=function(jt){function ge(fe,ye){var Se=jt.call(this)||this;return Se.baseErrorHandler=ye,Se.lastRead=null,Se.iterator=null,Se.moreIterators=fe,Se}return re(ge,jt),ge.prototype.summary=function(){return"TODO: fill in upstream of chained summaries -> Chained"},ge.prototype.next=function(){return J(this,void 0,void 0,function(){return R(this,function(fe){return this.lastRead=this.readFromChain(this.lastRead),[2,this.lastRead]})})},ge.prototype.readFromChain=function(fe){return J(this,void 0,void 0,function(){var ye,Se;return R(this,function(Ze){switch(Ze.label){case 0:return[4,fe];case 1:return Ze.sent(),this.iterator!=null?[3,3]:[4,this.moreIterators.next()];case 2:if((ye=Ze.sent()).done)return[2,{value:null,done:!0}];this.iterator=ye.value,this.baseErrorHandler!=null&&(this.iterator=this.iterator.handleErrors(this.baseErrorHandler)),Ze.label=3;case 3:return[4,this.iterator.next()];case 4:return(Se=Ze.sent()).done?(this.iterator=null,[2,this.readFromChain(fe)]):[2,Se]}})})},ge}(Pt);(function(jt){jt[jt.FAIL=0]="FAIL",jt[jt.SHORTEST=1]="SHORTEST",jt[jt.LONGEST=2]="LONGEST"})(Gt||(Gt={}));var Pe=function(jt){function ge(fe,ye){ye===void 0&&(ye=Gt.FAIL);var Se=jt.call(this)||this;return Se.iterators=fe,Se.mismatchMode=ye,Se.count=0,Se.currentPromise=null,Se}return re(ge,jt),ge.prototype.summary=function(){return"{TODO: fill in upstream of zip summaries} -> Zip"},ge.prototype.nextState=function(fe){return J(this,void 0,void 0,function(){function ye(Rt){return Rt instanceof Pt?{value:Rt.next().then(function(cn){return Se++,cn.done&&Ze++,cn.value}),recurse:!1}:{value:null,recurse:!0}}var Se,Ze,mt;return R(this,function(Rt){switch(Rt.label){case 0:return[4,fe];case 1:return Rt.sent(),Se=0,Ze=0,[4,je(this.iterators,ye)];case 2:if(mt=Rt.sent(),Se===Ze)return[2,{value:null,done:!0}];if(Ze>0)switch(this.mismatchMode){case Gt.FAIL:throw new Error("Zipped streams should have the same length. Mismatched at element "+this.count+".");case Gt.SHORTEST:return[2,{value:null,done:!0}];case Gt.LONGEST:}return this.count++,[2,{value:mt,done:!1}]}})})},ge.prototype.next=function(){return J(this,void 0,void 0,function(){return R(this,function(fe){return this.currentPromise=this.nextState(this.currentPromise),[2,this.currentPromise]})})},ge}(Pt),rt=function(jt){function ge(fe,ye){var Se=jt.call(this)||this;return Se.upstream=fe,Se.bufferSize=ye,Se.buffer=new zt(ye),Se}return re(ge,jt),ge.prototype.summary=function(){return this.upstream.summary()+" -> Prefetch"},ge.prototype.refill=function(){for(;!this.buffer.isFull();){var fe=this.upstream.next();this.buffer.push(fe)}},ge.prototype.next=function(){return this.refill(),this.buffer.shift()},ge}(Pt),Et=function(jt){function ge(fe,ye,Se){var Ze=jt.call(this,fe,ye)||this;return Ze.upstream=fe,Ze.windowSize=ye,Ze.upstreamExhausted=!1,Ze.random=he(Se||U.util.now().toString()),Ze.lastRead=Promise.resolve({value:null,done:!1}),Ze}return re(ge,jt),ge.prototype.next=function(){return J(this,void 0,void 0,function(){var fe=this;return R(this,function(ye){return this.lastRead=this.lastRead.then(function(){return fe.serialNext()}),[2,this.lastRead]})})},ge.prototype.randomInt=function(fe){return Math.floor(this.random()*fe)},ge.prototype.chooseIndex=function(){return this.randomInt(this.buffer.length())},ge.prototype.serialNext=function(){return J(this,void 0,void 0,function(){var fe,ye;return R(this,function(Se){switch(Se.label){case 0:this.upstreamExhausted||this.refill(),Se.label=1;case 1:return this.buffer.isEmpty()?[3,3]:(fe=this.chooseIndex(),[4,this.buffer.shuffleExcise(fe)]);case 2:return(ye=Se.sent()).done?(this.upstreamExhausted=!0,[3,1]):(this.refill(),[2,ye]);case 3:return[2,{value:null,done:!0}]}})})},ge}(rt),Lt=function(){function jt(){this.size=null}return jt.prototype.batch=function(ge,fe){var ye=this;fe===void 0&&(fe=!0);var Se=this;return U.util.assert(ge>0,function(){return`batchSize needs to be positive, but it is
      `+ge}),rn(function(){return J(ye,void 0,void 0,function(){return R(this,function(Ze){switch(Ze.label){case 0:return[4,Se.iterator()];case 1:return[2,Ze.sent().columnMajorBatch(ge,fe,qn)]}})})},this.size===1/0||this.size==null?this.size:fe?Math.ceil(this.size/ge):Math.floor(this.size/ge))},jt.prototype.concatenate=function(ge){var fe=this,ye=this;return rn(function(){return J(fe,void 0,void 0,function(){var Se,Ze;return R(this,function(mt){switch(mt.label){case 0:return[4,ye.iterator()];case 1:return Ze=(Se=mt.sent()).concatenate,[4,ge.iterator()];case 2:return[2,Ze.apply(Se,[mt.sent()])]}})})},this.size===1/0||ge.size===1/0?1/0:this.size!=null&&ge.size!=null?this.size+ge.size:null)},jt.prototype.filter=function(ge){var fe=this,ye=this;return rn(function(){return J(fe,void 0,void 0,function(){return R(this,function(Se){switch(Se.label){case 0:return[4,ye.iterator()];case 1:return[2,Se.sent().filter(function(Ze){return Object(U.tidy)(function(){return ge(Ze)})})]}})})},this.size===1/0?1/0:null)},jt.prototype.forEachAsync=function(ge){return J(this,void 0,void 0,function(){return R(this,function(fe){switch(fe.label){case 0:return[4,this.iterator()];case 1:return[2,fe.sent().forEachAsync(ge)]}})})},jt.prototype.forEach=function(ge){return J(this,void 0,void 0,function(){return R(this,function(fe){return Object(U.deprecationWarn)("dataset.forEach() is deprecated and will be removed. Please use dataset.forEachAsync() instead"),[2,this.forEachAsync(ge)]})})},jt.prototype.map=function(ge){var fe=this,ye=this;return rn(function(){return J(fe,void 0,void 0,function(){return R(this,function(Se){switch(Se.label){case 0:return[4,ye.iterator()];case 1:return[2,Se.sent().map(function(Ze){return Object(U.tidy)(function(){return ge(Ze)})})]}})})},this.size)},jt.prototype.mapAsync=function(ge){var fe=this,ye=this;return rn(function(){return J(fe,void 0,void 0,function(){return R(this,function(Se){switch(Se.label){case 0:return[4,ye.iterator()];case 1:return[2,Se.sent().mapAsync(ge)]}})})},this.size)},jt.prototype.prefetch=function(ge){var fe=this;if(ge==null)throw new RangeError("`Dataset.prefetch()` requires bufferSize to be specified.");var ye=this;return rn(function(){return J(fe,void 0,void 0,function(){return R(this,function(Se){switch(Se.label){case 0:return[4,ye.iterator()];case 1:return[2,Se.sent().prefetch(ge)]}})})},this.size)},jt.prototype.repeat=function(ge){var fe=this,ye=this;return rn(function(){return J(fe,void 0,void 0,function(){var Se=this;return R(this,function(Ze){return[2,function(mt,Rt){return new We(mt,Rt)}(Tt(function(){return J(Se,void 0,void 0,function(){var mt;return R(this,function(Rt){switch(Rt.label){case 0:return mt={},[4,ye.iterator()];case 1:return[2,(mt.value=Rt.sent(),mt.done=!1,mt)]}})})}).take(ge))]})})},this.size!=null&&ge>0?this.size*ge:ge===0?0:this.size!=null&&(ge===void 0||ge<0)?1/0:null)},jt.prototype.skip=function(ge){var fe=this,ye=this;return rn(function(){return J(fe,void 0,void 0,function(){return R(this,function(Se){switch(Se.label){case 0:return[4,ye.iterator()];case 1:return[2,Se.sent().skip(ge)]}})})},this.size!=null&&ge>=0&&this.size>=ge?this.size-ge:this.size!=null&&(this.size<ge||ge===void 0||ge<0)?0:null)},jt.prototype.shuffle=function(ge,fe,ye){var Se=this;if(ye===void 0&&(ye=!0),ge==null||ge<0)throw this.size==null?new RangeError("`Dataset.shuffle()` requires bufferSize to be specified."):new RangeError("`Dataset.shuffle()` requires bufferSize to be specified.  If your data fits in main memory (for regular JS objects), and/or GPU memory (for `tf.Tensor`s), consider setting bufferSize to the dataset size ("+this.size+" elements)");var Ze=this,mt=he(fe||U.util.now().toString());return rn(function(){return J(Se,void 0,void 0,function(){var Rt;return R(this,function(cn){switch(cn.label){case 0:return Rt=mt.int32(),ye&&(Rt+=mt.int32()),[4,Ze.iterator()];case 1:return[2,cn.sent().shuffle(ge,Rt.toString())]}})})},this.size)},jt.prototype.take=function(ge){var fe=this,ye=this;return rn(function(){return J(fe,void 0,void 0,function(){return R(this,function(Se){switch(Se.label){case 0:return[4,ye.iterator()];case 1:return[2,Se.sent().take(ge)]}})})},this.size!=null&&this.size>ge?ge:this.size!=null&&this.size<=ge?this.size:null)},jt.prototype.toArray=function(){return J(this,void 0,void 0,function(){return R(this,function(ge){switch(ge.label){case 0:if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return[4,this.iterator()];case 1:return[2,ge.sent().toArray()]}})})},jt.prototype.toArrayForTest=function(){return J(this,void 0,void 0,function(){return R(this,function(ge){switch(ge.label){case 0:if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return[4,this.iterator()];case 1:return[2,ge.sent().toArrayForTest()]}})})},jt.MAX_BUFFER_SIZE=1e4,jt}();function rn(jt,ge){return ge===void 0&&(ge=null),new(function(fe){function ye(){var Se=fe!==null&&fe.apply(this,arguments)||this;return Se.size=ge,Se}return re(ye,fe),ye.prototype.iterator=function(){return J(this,void 0,void 0,function(){return R(this,function(Se){return[2,jt()]})})},ye}(Lt))}function Sn(jt){var ge=this;return rn(function(){return J(ge,void 0,void 0,function(){return R(this,function(fe){return[2,we(jt)]})})},jt.length)}function kn(jt){var ge,fe=this;if(!ke(jt))throw new Error("The argument to zip() must be an object or array.");if(Array.isArray(jt))for(var ye=0;ye<jt.length;ye++)ge=ge==null?jt[ye].size:Math.min(ge,jt[ye].size);else if(jt instanceof Object)for(var Se in jt)ge=ge==null?jt[Se].size:Math.min(ge,jt[Se].size);return rn(function(){return J(fe,void 0,void 0,function(){return R(this,function(Ze){switch(Ze.label){case 0:return[4,je(jt,function(mt){if(mt instanceof Lt)return{value:mt.iterator(),recurse:!1};if(ke(mt))return{value:null,recurse:!0};throw new Error("Leaves of the structure passed to zip() must be Datasets, not primitives.")})];case 1:return[2,function(mt,Rt){return Rt===void 0&&(Rt=Gt.FAIL),new Pe(mt,Rt)}(Ze.sent(),Gt.SHORTEST)]}})})},ge)}function qn(jt){return jt===null?null:function(ge){return ge==null||function(fe){return fe===null||typeof fe!="object"&&typeof fe!="function"}(ge)||Array.isArray(ge)||typeof ge=="object"&&ge instanceof U.Tensor||U.util.isTypedArray(ge)}(jt[0])?{value:function(ge){if(ge.length===0)throw new Error("Can't make a batch of zero elements.");return ge[0]instanceof U.Tensor?Object(U.stack)(ge):Object(U.tensor)(ge)}(jt),recurse:!1}:{value:null,recurse:!0}}var xe=function(jt){function ge(fe){var ye=jt.call(this)||this;return ye.input=fe,ye}return re(ge,jt),ge.prototype.iterator=function(){return J(this,void 0,void 0,function(){var fe;return R(this,function(ye){switch(ye.label){case 0:return[4,this.input.iterator()];case 1:return fe=ye.sent(),[2,fe.decodeUTF8().split(`
`).map(function(Se){return Se.endsWith("\r")&&(Se=Se.slice(0,-1)),Se})]}})})},ge}(Lt),Xn=Symbol("out"),br=Symbol("field"),Cr=Symbol("quote"),dr=Symbol("quoteafterquote"),Rr=Symbol("quoteinquote"),hn=function(jt){function ge(fe,ye){var Se=jt.call(this)||this;return Se.input=fe,Se.hasHeader=!0,Se.fullColumnNames=null,Se.columnNamesValidated=!1,Se.columnConfigs=null,Se.configuredColumnsOnly=!1,Se.delimiter=",",Se.delimWhitespace=!1,Se.base=new xe(fe),ye||(ye={}),Se.hasHeader=ye.hasHeader!==!1,Se.fullColumnNames=ye.columnNames,Se.columnConfigs=ye.columnConfigs,Se.configuredColumnsOnly=ye.configuredColumnsOnly,ye.delimWhitespace?(U.util.assert(ye.delimiter==null,function(){return"Delimiter should not be provided when delimWhitespace is true."}),Se.delimWhitespace=!0,Se.delimiter=" "):Se.delimiter=ye.delimiter?ye.delimiter:",",Se}return re(ge,jt),ge.prototype.columnNames=function(){return J(this,void 0,void 0,function(){return R(this,function(fe){switch(fe.label){case 0:return this.columnNamesValidated?[3,2]:[4,this.setColumnNames()];case 1:fe.sent(),fe.label=2;case 2:return[2,this.configuredColumnsOnly?Object.keys(this.columnConfigs):this.fullColumnNames]}})})},ge.prototype.setColumnNames=function(){return J(this,void 0,void 0,function(){var fe,ye,Se,Ze,mt,Rt,cn=this;return R(this,function(Jn){switch(Jn.label){case 0:return[4,this.maybeReadHeaderLine()];case 1:if(fe=Jn.sent(),!this.fullColumnNames&&!fe)throw new Error("Column names must be provided if there is no header line.");if(this.fullColumnNames&&fe&&U.util.assert(fe.length===this.fullColumnNames.length,function(){return"The length of provided columnNames ("+cn.fullColumnNames.length.toString()+") does not match the length of the header line read from file ("+fe.length.toString()+")."}),this.fullColumnNames||(this.fullColumnNames=fe),ye=this.fullColumnNames.reduce(function(An,Ln){return An[Ln]=An[Ln]+1||1,An},{}),Se=Object.keys(ye).filter(function(An){return ye[An]>1}),U.util.assert(Se.length===0,function(){return"Duplicate column names found: "+Se.toString()}),this.columnConfigs){for(Ze=0,mt=Object.keys(this.columnConfigs);Ze<mt.length;Ze++)if(Rt=mt[Ze],this.fullColumnNames.indexOf(Rt)===-1)throw new Error('The key "'+Rt+'" provided in columnConfigs does not match any of the column names ('+this.fullColumnNames.toString()+").")}return this.columnNamesValidated=!0,[2]}})})},ge.prototype.maybeReadHeaderLine=function(){return J(this,void 0,void 0,function(){var fe,ye;return R(this,function(Se){switch(Se.label){case 0:return this.hasHeader?[4,this.base.iterator()]:[3,3];case 1:return[4,Se.sent().next()];case 2:if((fe=Se.sent()).done)throw new Error("No data was found for CSV parsing.");return ye=fe.value,[2,this.parseRow(ye,!1)];case 3:return[2,null]}})})},ge.prototype.iterator=function(){return J(this,void 0,void 0,function(){var fe,ye=this;return R(this,function(Se){switch(Se.label){case 0:return this.columnNamesValidated?[3,2]:[4,this.setColumnNames()];case 1:Se.sent(),Se.label=2;case 2:return[4,this.base.iterator()];case 3:return fe=Se.sent(),this.hasHeader&&(fe=fe.skip(1)),[2,fe.map(function(Ze){return ye.makeDataElement(Ze)})]}})})},ge.prototype.makeDataElement=function(fe){for(var ye=this.parseRow(fe),Se={},Ze={},mt=0;mt<this.fullColumnNames.length;mt++){var Rt=this.fullColumnNames[mt],cn=this.columnConfigs?this.columnConfigs[Rt]:null;if(!this.configuredColumnsOnly||cn){var Jn=ye[mt],An=null;if(Jn==="")if(cn&&cn.default!==void 0)An=cn.default;else{if(cn&&(cn.required||cn.isLabel))throw new Error("Required column "+Rt+" is empty in this line: "+fe);An=void 0}else{var Ln=Number(Jn);if(isNaN(Ln))An=cn&&cn.dtype==="bool"?this.getBoolean(Jn):Jn;else if(cn&&cn.dtype)switch(cn.dtype){case"float32":An=Ln;break;case"int32":An=Math.floor(Ln);break;case"bool":An=this.getBoolean(Jn);break;default:An=Ln}else An=Ln}cn&&cn.isLabel?Ze[Rt]=An:Se[Rt]=An}}return Object.keys(Ze).length===0?Se:{xs:Se,ys:Ze}},ge.prototype.getBoolean=function(fe){return fe==="1"||fe.toLowerCase()==="true"?1:0},ge.prototype.parseRow=function(fe,ye){ye===void 0&&(ye=!0);for(var Se=[],Ze=0,mt=fe.length,Rt=Xn,cn=0;cn<mt;cn++)switch(Rt){case Xn:switch(fe.charAt(cn)){case'"':Ze=cn+1,Rt=Cr;break;case this.delimiter:if(Ze=cn+1,this.delimiter===" "&&this.delimWhitespace)break;Se.push(""),Rt=Xn;break;default:Rt=br,Ze=cn}break;case br:switch(fe.charAt(cn)){case this.delimiter:Se.push(fe.substring(Ze,cn)),Rt=Xn,Ze=cn+1}break;case Cr:switch(fe.charAt(cn)){case'"':Rt=dr}break;case dr:switch(fe.charAt(cn)){case this.delimiter:Se.push(fe.substring(Ze,cn-1)),Rt=Xn,Ze=cn+1;break;case'"':Rt=Cr;break;default:Rt=Rr}break;case Rr:switch(fe.charAt(cn)){case'"':Rt=Cr}}if(Rt===dr?Se.push(fe.substring(Ze,mt-1)):Se.push(fe.substring(Ze)),ye&&Se.length!==this.fullColumnNames.length)throw new Error("Invalid row in csv file. Should have "+this.fullColumnNames.length+" elements in a row, but got "+Se);return Se},ge}(Lt),Xt=function(jt){function ge(fe){var ye=jt.call(this)||this;ye.microphoneConfig=fe,ye.isClosed=!1,ye.fftSize=fe.fftSize||1024;var Se=Math.log2(ye.fftSize);if(ye.fftSize<0||Se<4||Se>14||!Number.isInteger(Se))throw new Error("Invalid fftSize: it must be a power of 2 between 2 to 4 and 2 to 14, but got "+ye.fftSize);if(ye.numFrames=fe.numFramesPerSpectrogram||43,ye.sampleRateHz=fe.sampleRateHz,ye.columnTruncateLength=fe.columnTruncateLength||ye.fftSize,ye.audioTrackConstraints=fe.audioTrackConstraints,ye.smoothingTimeConstant=fe.smoothingTimeConstant||0,ye.includeSpectrogram=fe.includeSpectrogram!==!1,ye.includeWaveform=fe.includeWaveform===!0,!ye.includeSpectrogram&&!ye.includeWaveform)throw new Error("Both includeSpectrogram and includeWaveform are false. At least one type of data should be returned.");return ye}return re(ge,jt),ge.prototype.summary=function(){return"microphone"},ge.create=function(fe){return fe===void 0&&(fe={}),J(this,void 0,void 0,function(){var ye;return R(this,function(Se){switch(Se.label){case 0:if(Object(U.env)().get("IS_NODE"))throw new Error("microphone API is only supported in browser environment.");return[4,(ye=new ge(fe)).start()];case 1:return Se.sent(),[2,ye]}})})},ge.prototype.start=function(){return J(this,void 0,void 0,function(){var fe,ye,Se,Ze;return R(this,function(mt){switch(mt.label){case 0:return mt.trys.push([0,2,,3]),fe=this,[4,navigator.mediaDevices.getUserMedia({audio:this.audioTrackConstraints==null||this.audioTrackConstraints,video:!1})];case 1:return fe.stream=mt.sent(),[3,3];case 2:throw ye=mt.sent(),new Error("Error thrown while initializing video stream: "+ye.message);case 3:if(!this.stream)throw new Error("Could not obtain audio from microphone.");if(Se=window.AudioContext||window.webkitAudioContext,this.audioContext=new Se,this.sampleRateHz){if(this.audioContext.sampleRate!==this.sampleRateHz)throw new Error("Mismatch in sampling rate: Expected: "+this.sampleRateHz+"; Actual: "+this.audioContext.sampleRate)}else this.sampleRateHz=this.audioContext.sampleRate;return Ze=this.audioContext.createMediaStreamSource(this.stream),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=2*this.fftSize,this.analyser.smoothingTimeConstant=this.smoothingTimeConstant,Ze.connect(this.analyser),this.freqData=new Float32Array(this.fftSize),this.timeData=new Float32Array(this.fftSize),[2]}})})},ge.prototype.next=function(){return J(this,void 0,void 0,function(){var fe,ye,Se,Ze,mt;return R(this,function(Rt){switch(Rt.label){case 0:return this.isClosed?[2,{value:null,done:!0}]:[4,this.getAudioData()];case 1:return Se=Rt.sent(),this.includeSpectrogram&&(Ze=this.flattenQueue(Se.freqDataQueue),fe=this.getTensorFromAudioDataArray(Ze,[this.numFrames,this.columnTruncateLength,1])),this.includeWaveform&&(mt=this.flattenQueue(Se.timeDataQueue),ye=this.getTensorFromAudioDataArray(mt,[this.numFrames*this.fftSize,1])),[2,{value:{spectrogram:fe,waveform:ye},done:!1}]}})})},ge.prototype.capture=function(){return J(this,void 0,void 0,function(){return R(this,function(fe){switch(fe.label){case 0:return[4,this.next()];case 1:return[2,fe.sent().value]}})})},ge.prototype.getAudioData=function(){return J(this,void 0,void 0,function(){var fe,ye,Se,Ze=this;return R(this,function(mt){return fe=[],ye=[],Se=0,[2,new Promise(function(Rt){var cn=setInterval(function(){Ze.includeSpectrogram&&(Ze.analyser.getFloatFrequencyData(Ze.freqData),Ze.freqData[0]===-1/0&&Rt({freqDataQueue:fe,timeDataQueue:ye}),fe.push(Ze.freqData.slice(0,Ze.columnTruncateLength))),Ze.includeWaveform&&(Ze.analyser.getFloatTimeDomainData(Ze.timeData),ye.push(Ze.timeData.slice())),++Se===Ze.numFrames&&(clearInterval(cn),Rt({freqDataQueue:fe,timeDataQueue:ye}))},Ze.fftSize/Ze.sampleRateHz*1e3)})]})})},ge.prototype.stop=function(){this.isClosed||(this.isClosed=!0,this.analyser.disconnect(),this.audioContext.close(),this.stream!=null&&this.stream.getTracks().length>0&&this.stream.getTracks()[0].stop())},ge.prototype.toArray=function(){throw new Error("Can not convert infinite audio stream to array.")},ge.prototype.getSampleRate=function(){return this.sampleRateHz},ge.prototype.flattenQueue=function(fe){var ye=fe[0].length,Se=new Float32Array(fe.length*ye);return fe.forEach(function(Ze,mt){return Se.set(Ze,mt*ye)}),Se},ge.prototype.getTensorFromAudioDataArray=function(fe,ye){var Se=new Float32Array(U.util.sizeFromShape(ye));return Se.set(fe,Se.length-fe.length),Object(U.tensor)(Se,ye)},ge}(Pt),nn=function(jt){function ge(fe,ye){var Se=jt.call(this)||this;if(Se.webcamVideoElement=fe,Se.webcamConfig=ye,Se.isClosed=!0,Se.resize=!1,Se.needToResize())if(Se.resize=!0,Se.cropSize=[Se.webcamConfig.resizeHeight,Se.webcamConfig.resizeWidth],Se.cropBoxInd=Object(U.tensor1d)([0],"int32"),Se.webcamConfig.centerCrop){var Ze=1*Se.webcamConfig.resizeWidth/Se.webcamVideoElement.width,mt=1*Se.webcamConfig.resizeHeight/Se.webcamVideoElement.height,Rt=(1-Ze)/2,cn=(1-mt)/2,Jn=Rt+Ze,An=mt+cn;Se.cropBox=Object(U.tensor2d)([cn,Rt,An,Jn],[1,4])}else Se.cropBox=Object(U.tensor2d)([0,0,1,1],[1,4]);return Se}return re(ge,jt),ge.prototype.summary=function(){return"webcam"},ge.create=function(fe,ye){return ye===void 0&&(ye={}),J(this,void 0,void 0,function(){var Se;return R(this,function(Ze){switch(Ze.label){case 0:if(Object(U.env)().get("IS_NODE"))throw new Error("tf.data.webcam is only supported in browser environment.");if(!fe){if(fe=document.createElement("video"),!ye.resizeWidth||!ye.resizeHeight)throw new Error("Please provide webcam video element, or resizeWidth and resizeHeight to create a hidden video element.");fe.width=ye.resizeWidth,fe.height=ye.resizeHeight}return[4,(Se=new ge(fe,ye)).start()];case 1:return Ze.sent(),[2,Se]}})})},ge.prototype.start=function(){return J(this,void 0,void 0,function(){var fe,ye,Se=this;return R(this,function(Ze){switch(Ze.label){case 0:this.webcamConfig.facingMode&&U.util.assert(this.webcamConfig.facingMode==="user"||this.webcamConfig.facingMode==="environment",function(){return"Invalid webcam facing mode: "+Se.webcamConfig.facingMode+". Please provide 'user' or 'environment'"}),Ze.label=1;case 1:return Ze.trys.push([1,3,,4]),fe=this,[4,navigator.mediaDevices.getUserMedia({video:{deviceId:this.webcamConfig.deviceId,facingMode:this.webcamConfig.facingMode?this.webcamConfig.facingMode:"user",width:this.webcamVideoElement.width,height:this.webcamVideoElement.height}})];case 2:return fe.stream=Ze.sent(),[3,4];case 3:throw(ye=Ze.sent()).message="Error thrown while initializing video stream: "+ye.message,ye;case 4:if(!this.stream)throw new Error("Could not obtain video from webcam.");try{this.webcamVideoElement.srcObject=this.stream}catch(mt){console.log(mt),this.webcamVideoElement.src=window.URL.createObjectURL(this.stream)}return this.webcamVideoElement.play(),this.isClosed=!1,[2,new Promise(function(mt){Se.webcamVideoElement.onloadedmetadata=function(){mt()}})]}})})},ge.prototype.next=function(){return J(this,void 0,void 0,function(){var fe;return R(this,function(ye){if(this.isClosed)return[2,{value:null,done:!0}];try{fe=U.browser.fromPixels(this.webcamVideoElement)}catch(Se){throw new Error("Error thrown converting video to pixels: "+JSON.stringify(Se))}if(!this.resize)return[2,{value:fe,done:!1}];try{return[2,{value:this.cropAndResizeFrame(fe),done:!1}]}catch(Se){throw new Error("Error thrown cropping the video: "+Se.message)}finally{fe.dispose()}return[2]})})},ge.prototype.needToResize=function(){return!(!this.webcamConfig.resizeWidth||!this.webcamConfig.resizeHeight||this.webcamVideoElement.width===this.webcamConfig.resizeWidth&&this.webcamVideoElement.height===this.webcamConfig.resizeHeight)},ge.prototype.cropAndResizeFrame=function(fe){var ye=this;return Object(U.tidy)(function(){var Se,Ze=fe.toFloat().expandDims(0),mt=(Se=U.image.cropAndResize(Ze,ye.cropBox,ye.cropBoxInd,ye.cropSize,"bilinear")).shape;return Se.reshape(mt.slice(1))})},ge.prototype.capture=function(){return J(this,void 0,void 0,function(){return R(this,function(fe){switch(fe.label){case 0:return[4,this.next()];case 1:return[2,fe.sent().value]}})})},ge.prototype.stop=function(){this.stream.getTracks().forEach(function(fe){return fe.stop()});try{this.webcamVideoElement.srcObject=null}catch(fe){console.log(fe),this.webcamVideoElement.src=null}this.isClosed=!0},ge.prototype.toArray=function(){throw new Error("Can not convert infinite video stream to array.")},ge}(Pt),Gn=function(){},Dn=function(jt){function ge(){return jt!==null&&jt.apply(this,arguments)||this}return re(ge,jt),ge.prototype.split=function(fe){return new mr(this,fe)},ge}(Pt),mr=function(jt){function ge(fe,ye){var Se=jt.call(this)||this;return Se.upstream=fe,Se.impl=new xr(fe,ye),Se}return re(ge,jt),ge.prototype.summary=function(){return this.impl.summary()},ge.prototype.next=function(){return J(this,void 0,void 0,function(){return R(this,function(fe){return[2,this.impl.next()]})})},ge}(Dn),xr=function(jt){function ge(fe,ye){var Se=jt.call(this)||this;return Se.upstream=fe,Se.separator=ye,Se.carryover="",Se}return re(ge,jt),ge.prototype.summary=function(){return this.upstream.summary()+" -> Split('"+this.separator+"')"},ge.prototype.pump=function(){return J(this,void 0,void 0,function(){var fe,ye,Se,Ze,mt;return R(this,function(Rt){switch(Rt.label){case 0:return[4,this.upstream.next()];case 1:if((fe=Rt.sent()).done)return this.carryover===""?[2,!1]:(this.outputQueue.push(this.carryover),this.carryover="",[2,!0]);for((ye=fe.value.split(this.separator))[0]=this.carryover+ye[0],Se=0,Ze=ye.slice(0,-1);Se<Ze.length;Se++)mt=Ze[Se],this.outputQueue.push(mt);return this.carryover=ye[ye.length-1],[2,!0]}})})},ge}(Yn),gr=function(jt){function ge(){return jt!==null&&jt.apply(this,arguments)||this}return re(ge,jt),ge.prototype.decodeUTF8=function(){return new Qr(this)},ge}(Pt),Qr=function(jt){function ge(fe){var ye=jt.call(this)||this;return ye.upstream=fe,ye.impl=new ni(fe),ye}return re(ge,jt),ge.prototype.summary=function(){return this.impl.summary()},ge.prototype.next=function(){return J(this,void 0,void 0,function(){return R(this,function(fe){return[2,this.impl.next()]})})},ge}(Dn),ni=function(jt){function ge(fe){var ye=jt.call(this)||this;if(ye.upstream=fe,Object(U.env)().get("IS_BROWSER"))ye.decoder=new TextDecoder("utf-8");else{var Se=o(386).StringDecoder;ye.decoder=new Se("utf8")}return ye}return re(ge,jt),ge.prototype.summary=function(){return this.upstream.summary()+" -> Utf8"},ge.prototype.pump=function(){return J(this,void 0,void 0,function(){var fe,ye,Se;return R(this,function(Ze){switch(Ze.label){case 0:return[4,this.upstream.next()];case 1:return(fe=Ze.sent()).done?[2,!1]:(ye=fe.value,Se=Object(U.env)().get("IS_BROWSER")?this.decoder.decode(ye,{stream:!0}):this.decoder.write(H.from(ye.buffer)),this.outputQueue.push(Se),[2,!0])}})})},ge}(Yn),Mr=function(jt){function ge(fe,ye){ye===void 0&&(ye={});var Se=jt.call(this)||this;return Se.file=fe,Se.options=ye,U.util.assert(fe instanceof Uint8Array||!!Object(U.env)().get("IS_BROWSER")&&(fe instanceof File||fe instanceof Blob),function(){return"FileChunkIterator only supports File, Blob and Uint8Array right now."}),Se.offset=ye.offset||0,Se.chunkSize=ye.chunkSize||1048576,Se}return re(ge,jt),ge.prototype.summary=function(){return"FileChunks "+this.file},ge.prototype.next=function(){return J(this,void 0,void 0,function(){var fe,ye,Se=this;return R(this,function(Ze){switch(Ze.label){case 0:return this.offset>=(this.file instanceof Uint8Array?this.file.byteLength:this.file.size)?[2,{value:null,done:!0}]:(fe=new Promise(function(mt,Rt){var cn=Se.offset+Se.chunkSize;if(Se.file instanceof Uint8Array)mt(new Uint8Array(Se.file.slice(Se.offset,cn)));else{var Jn=new FileReader;Jn.onload=function(Ln){var Hn=Jn.result;if(Hn instanceof ArrayBuffer&&(Hn=new Uint8Array(Hn)),!(Hn instanceof Uint8Array))return Rt(new TypeError("FileReader returned unknown type."));mt(Hn)},Jn.onabort=function(Ln){return Rt(new Error("Aborted"))},Jn.onerror=function(Ln){return Rt(new Error(Ln.type))};var An=Se.file.slice(Se.offset,cn);Jn.readAsArrayBuffer(An)}Se.offset=cn}),ye={},[4,fe]);case 1:return[2,(ye.value=Ze.sent(),ye.done=!1,ye)]}})})},ge}(gr),di=function(jt){return{method:jt.method,headers:jt.headers,body:jt.body,mode:jt.mode,credentials:jt.credentials,cache:jt.cache,redirect:jt.redirect,referrer:jt.referrer,integrity:jt.integrity}};function Yr(jt){return typeof jt=="string"&&jt.substr(0,7)==="file://"}var Xr=function(jt){function ge(fe,ye){ye===void 0&&(ye={});var Se=jt.call(this)||this;return Se.input=fe,Se.options=ye,Se}return re(ge,jt),ge.prototype.iterator=function(){return J(this,void 0,void 0,function(){var fe;return R(this,function(ye){return Yr(this.input)&&Object(U.env)().get("IS_NODE")&&(fe=o(385),this.input=fe.readFileSync(this.input.substr(7))),[2,new Mr(this.input,this.options)]})})},ge}(Gn),fi=function(jt){function ge(fe,ye){ye===void 0&&(ye={});var Se=jt.call(this)||this;return Se.url=fe,Se.fileOptions=ye,Se}return re(ge,jt),ge.prototype.iterator=function(){return J(this,void 0,void 0,function(){return R(this,function(fe){return Yr(this.url)?[2,new Xr(this.url,this.fileOptions).iterator()]:[2,function(ye,Se){return Se===void 0&&(Se={}),J(this,void 0,void 0,function(){var Ze,mt,Rt,cn,Jn;return R(this,function(An){switch(An.label){case 0:return typeof ye=="string"?Ze=ye:(Ze=ye.url,mt=di(ye)),[4,U.util.fetch(Ze,mt)];case 1:return(Rt=An.sent()).ok?(Jn=Uint8Array.bind,[4,Rt.arrayBuffer()]):[3,3];case 2:return cn=new(Jn.apply(Uint8Array,[void 0,An.sent()])),[2,new Mr(cn,Se)];case 3:throw new Error(Rt.statusText)}})})}(this.url,this.fileOptions)]})})},ge}(Gn);function ai(jt,ge){return ge===void 0&&(ge={}),new hn(new fi(jt),ge)}function Oa(jt){var ge=this,fe=Tt(jt);return rn(function(){return J(ge,void 0,void 0,function(){return R(this,function(ye){return[2,fe]})})})}function Wi(jt){var ge=this;return rn(function(){return J(ge,void 0,void 0,function(){var fe;return R(this,function(ye){switch(ye.label){case 0:return[4,jt()];case 1:return fe=ye.sent(),[2,Tt(function(){return fe.next()})]}})})})}function Ci(jt,ge){return J(this,void 0,void 0,function(){return R(this,function(fe){return[2,nn.create(jt,ge)]})})}function yt(jt){return J(this,void 0,void 0,function(){return R(this,function(ge){return[2,Xt.create(jt)]})})}var Lr="1.7.4"}).call(this,o(59),o(92).Buffer)},function(Oe,A,o){function b(H){var U="";if(!H)try{H=o(185)}catch(B){U=B.toString()}return{readFile:H?function(B){return new Promise(function(re,J){H.readFile(B,function(R,P){return R?J(R):re(P)})})}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+U)}}}o.d(A,"a",function(){return b})},function(Oe){Oe.exports={a:"0.12.2"}},function(Oe,A,o){var b=/("(?:[^\\"]|\\.)*")|[:,]/g;Oe.exports=function(H,U){var B,re,J;return U=U||{},B=JSON.stringify([1],void 0,U.indent===void 0?2:U.indent).slice(2,-3),re=B===""?1/0:U.maxLength===void 0?80:U.maxLength,J=U.replacer,function R(P,$,L){var ee,F,ue,ie,K,he,pe,Ae,Te,je,ke,at;if(P&&typeof P.toJSON=="function"&&(P=P.toJSON()),(ke=JSON.stringify(P,J))===void 0)return ke;if(pe=re-$.length-L,ke.length<=pe&&(Te=ke.replace(b,function(St,zt){return zt||St+" "})).length<=pe)return Te;if(J!=null&&(P=JSON.parse(ke),J=void 0),typeof P=="object"&&P!==null){if(Ae=$+B,ue=[],F=0,Array.isArray(P))for(je="[",ee="]",pe=P.length;F<pe;F++)ue.push(R(P[F],Ae,F===pe-1?0:1)||"null");else for(je="{",ee="}",pe=(he=Object.keys(P)).length;F<pe;F++)ie=he[F],K=JSON.stringify(ie)+": ",(at=R(P[ie],Ae,K.length+(F===pe-1?0:1)))!==void 0&&ue.push(K+at);if(ue.length>0)return[je,B+ue.join(`,
`+Ae),ee].join(`
`+$)}return ke}(H,"",0)}},function(Oe,A,o){var b=o(31),H=Object(b.a)(function(U){U.setUTCDate(1),U.setUTCHours(0,0,0,0)},function(U,B){U.setUTCMonth(U.getUTCMonth()+B)},function(U,B){return B.getUTCMonth()-U.getUTCMonth()+12*(B.getUTCFullYear()-U.getUTCFullYear())},function(U){return U.getUTCMonth()});A.a=H,H.range},function(Oe,A,o){var b=o(31),H=Object(b.a)(function(U){U.setDate(1),U.setHours(0,0,0,0)},function(U,B){U.setMonth(U.getMonth()+B)},function(U,B){return B.getMonth()-U.getMonth()+12*(B.getFullYear()-U.getFullYear())},function(U){return U.getMonth()});A.a=H,H.range},function(Oe,A,o){(function(b){var H=o(36),U=o(275),B=o(193),re={"Content-Type":"application/x-www-form-urlencoded"};function J(P,$){!H.isUndefined(P)&&H.isUndefined(P["Content-Type"])&&(P["Content-Type"]=$)}var R={transitional:{silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},adapter:function(){var P;return(typeof XMLHttpRequest<"u"||b!==void 0&&Object.prototype.toString.call(b)==="[object process]")&&(P=o(192)),P}(),transformRequest:[function(P,$){return U($,"Accept"),U($,"Content-Type"),H.isFormData(P)||H.isArrayBuffer(P)||H.isBuffer(P)||H.isStream(P)||H.isFile(P)||H.isBlob(P)?P:H.isArrayBufferView(P)?P.buffer:H.isURLSearchParams(P)?(J($,"application/x-www-form-urlencoded;charset=utf-8"),P.toString()):H.isObject(P)||$&&$["Content-Type"]==="application/json"?(J($,"application/json"),function(L,ee,F){if(H.isString(L))try{return(ee||JSON.parse)(L),H.trim(L)}catch(ue){if(ue.name!=="SyntaxError")throw ue}return(F||JSON.stringify)(L)}(P)):P}],transformResponse:[function(P){var $=this.transitional,L=$&&$.silentJSONParsing,ee=$&&$.forcedJSONParsing,F=!L&&this.responseType==="json";if(F||ee&&H.isString(P)&&P.length)try{return JSON.parse(P)}catch(ue){if(F)throw ue.name==="SyntaxError"?B(ue,this,"E_JSON_PARSE"):ue}return P}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(P){return P>=200&&P<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};H.forEach(["delete","get","head"],function(P){R.headers[P]={}}),H.forEach(["post","put","patch"],function(P){R.headers[P]=H.merge(re)}),Oe.exports=R}).call(this,o(75))},function(Oe,A,o){/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/var b=this&&this.__awaiter||function($,L,ee,F){return new(ee||(ee=Promise))(function(ue,ie){function K(Ae){try{pe(F.next(Ae))}catch(Te){ie(Te)}}function he(Ae){try{pe(F.throw(Ae))}catch(Te){ie(Te)}}function pe(Ae){Ae.done?ue(Ae.value):new ee(function(Te){Te(Ae.value)}).then(K,he)}pe((F=F.apply($,L||[])).next())})},H=this&&this.__importDefault||function($){return $&&$.__esModule?$:{default:$}};Object.defineProperty(A,"__esModule",{value:!0});const U=o(50),B=H(o(88)),re=o(64),J=o(110),R=o(109),P={maxBins:12,fontSize:11};A.histogram=function($,L,ee={}){return b(this,void 0,void 0,function*(){const F=function(pe){if(pe.length==null)throw new Error("input data must be an array");if(pe.length===0)return[];if(typeof pe[0]=="object"){if(pe[0].value==null)throw new Error("input data must have a value field");return pe}{const Ae=Array(pe.length);for(let Te=0;Te<pe.length;Te++)Ae[Te]={value:pe[Te]};return Ae}}(L),ue=Object.assign({},P,ee),ie=re.subSurface($,"histogram");if(ee.stats!==!1){const pe=re.subSurface($,"stats",{prepend:!0});(function(Ae,Te,je){const ke=U.format(",.4~f"),at=U.format(".4~p"),St=[],zt=[];if(Ae.numVals!=null&&(St.push("Num Vals"),zt.push(ke(Ae.numVals))),Ae.min!=null&&(St.push("Min"),zt.push(ke(Ae.min))),Ae.max!=null&&(St.push("Max"),zt.push(ke(Ae.max))),Ae.numZeros!=null){St.push("# Zeros");let $t="";Ae.numVals&&($t=Ae.numZeros>0?`(${at(Ae.numZeros/Ae.numVals)})`:""),zt.push(`${ke(Ae.numZeros)} ${$t}`)}if(Ae.numNans!=null){St.push("# NaNs");let $t="";Ae.numVals&&($t=Ae.numNans>0?`(${at(Ae.numNans/Ae.numVals)})`:""),zt.push(`${ke(Ae.numNans)} ${$t}`)}if(Ae.numInfs!=null){St.push("# Infinity");let $t="";Ae.numVals&&($t=Ae.numInfs>0?`(${at(Ae.numInfs/Ae.numVals)})`:""),zt.push(`${ke(Ae.numInfs)} ${$t}`)}R.table(Te,{headers:St,values:[zt]},je)})(ee.stats?ee.stats:J.arrayStats(F.map(Ae=>Ae.value)),pe,{fontSize:ue.fontSize})}if(F.length===0)return;const K=[];for(let pe=0;pe<F.length;pe++){const Ae=F[pe].value;Ae!=null&&isFinite(Ae)&&K.push(F[pe])}const he={width:ue.width||re.getDefaultWidth(ie),height:ue.height||re.getDefaultHeight(ie),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},data:{values:K},mark:{type:"bar",tooltip:!0},config:{axis:{labelFontSize:ue.fontSize,titleFontSize:ue.fontSize},text:{fontSize:ue.fontSize},legend:{labelFontSize:ue.fontSize,titleFontSize:ue.fontSize}},encoding:{x:{bin:{maxbins:ue.maxBins},field:"value",type:"quantitative"},y:{aggregate:"count",type:"quantitative"},color:{value:ue.color||"#001B44"}}};return B.default(ie,he,{actions:!1,mode:"vega-lite",defaultStyle:!1})})}},function(Oe,A,o){o.r(A),o.d(A,"h",function(){return B}),o.d(A,"createElement",function(){return B}),o.d(A,"cloneElement",function(){return R}),o.d(A,"Component",function(){return Bt}),o.d(A,"render",function(){return Mt}),o.d(A,"rerender",function(){return ee}),o.d(A,"options",function(){return b});var b={},H=[],U=[];function B(Dt,_t){var xn,In,Yn,fn,We=U;for(fn=arguments.length;fn-- >2;)H.push(arguments[fn]);for(_t&&_t.children!=null&&(H.length||H.push(_t.children),delete _t.children);H.length;)if((In=H.pop())&&In.pop!==void 0)for(fn=In.length;fn--;)H.push(In[fn]);else typeof In=="boolean"&&(In=null),(Yn=typeof Dt!="function")&&(In==null?In="":typeof In=="number"?In=String(In):typeof In!="string"&&(Yn=!1)),Yn&&xn?We[We.length-1]+=In:We===U?We=[In]:We.push(In),xn=Yn;var Pe=new function(){};return Pe.nodeName=Dt,Pe.children=We,Pe.attributes=_t??void 0,Pe.key=_t?.key,b.vnode!==void 0&&b.vnode(Pe),Pe}function re(Dt,_t){for(var xn in _t)Dt[xn]=_t[xn];return Dt}var J=typeof Promise=="function"?Promise.resolve().then.bind(Promise.resolve()):setTimeout;function R(Dt,_t){return B(Dt.nodeName,re(re({},Dt.attributes),_t),arguments.length>2?[].slice.call(arguments,2):Dt.children)}var P=/acit|ex(?:s|g|n|p|$)|rph|ows|mnc|ntw|ine[ch]|zoo|^ord/i,$=[];function L(Dt){!Dt._dirty&&(Dt._dirty=!0)&&$.push(Dt)==1&&(b.debounceRendering||J)(ee)}function ee(){var Dt,_t=$;for($=[];Dt=_t.pop();)Dt._dirty&&ln(Dt)}function F(Dt,_t,xn){return typeof _t=="string"||typeof _t=="number"?Dt.splitText!==void 0:typeof _t.nodeName=="string"?!Dt._componentConstructor&&ue(Dt,_t.nodeName):xn||Dt._componentConstructor===_t.nodeName}function ue(Dt,_t){return Dt.normalizedNodeName===_t||Dt.nodeName.toLowerCase()===_t.toLowerCase()}function ie(Dt){var _t=re({},Dt.attributes);_t.children=Dt.children;var xn=Dt.nodeName.defaultProps;if(xn!==void 0)for(var In in xn)_t[In]===void 0&&(_t[In]=xn[In]);return _t}function K(Dt){var _t=Dt.parentNode;_t&&_t.removeChild(Dt)}function he(Dt,_t,xn,In,Yn){if(_t==="className"&&(_t="class"),_t!=="key")if(_t==="ref")xn&&xn(null),In&&In(Dt);else if(_t!=="class"||Yn)if(_t==="style"){if(In&&typeof In!="string"&&typeof xn!="string"||(Dt.style.cssText=In||""),In&&typeof In=="object"){if(typeof xn!="string")for(var fn in xn)fn in In||(Dt.style[fn]="");for(var fn in In)Dt.style[fn]=typeof In[fn]=="number"&&P.test(fn)===!1?In[fn]+"px":In[fn]}}else if(_t==="dangerouslySetInnerHTML")In&&(Dt.innerHTML=In.__html||"");else if(_t[0]=="o"&&_t[1]=="n"){var We=_t!==(_t=_t.replace(/Capture$/,""));_t=_t.toLowerCase().substring(2),In?xn||Dt.addEventListener(_t,pe,We):Dt.removeEventListener(_t,pe,We),(Dt._listeners||(Dt._listeners={}))[_t]=In}else if(_t!=="list"&&_t!=="type"&&!Yn&&_t in Dt)(function(rt,Et,Lt){try{rt[Et]=Lt}catch{}})(Dt,_t,In??""),In!=null&&In!==!1||Dt.removeAttribute(_t);else{var Pe=Yn&&_t!==(_t=_t.replace(/^xlink:?/,""));In==null||In===!1?Pe?Dt.removeAttributeNS("http://www.w3.org/1999/xlink",_t.toLowerCase()):Dt.removeAttribute(_t):typeof In!="function"&&(Pe?Dt.setAttributeNS("http://www.w3.org/1999/xlink",_t.toLowerCase(),In):Dt.setAttribute(_t,In))}else Dt.className=In||""}function pe(Dt){return this._listeners[Dt.type](b.event&&b.event(Dt)||Dt)}var Ae=[],Te=0,je=!1,ke=!1;function at(){for(var Dt;Dt=Ae.pop();)b.afterMount&&b.afterMount(Dt),Dt.componentDidMount&&Dt.componentDidMount()}function St(Dt,_t,xn,In,Yn,fn){Te++||(je=Yn!=null&&Yn.ownerSVGElement!==void 0,ke=Dt!=null&&!("__preactattr_"in Dt));var We=zt(Dt,_t,xn,In,fn);return Yn&&We.parentNode!==Yn&&Yn.appendChild(We),--Te||(ke=!1,fn||at()),We}function zt(Dt,_t,xn,In,Yn){var fn=Dt,We=je;if(_t!=null&&typeof _t!="boolean"||(_t=""),typeof _t=="string"||typeof _t=="number")return Dt&&Dt.splitText!==void 0&&Dt.parentNode&&(!Dt._component||Yn)?Dt.nodeValue!=_t&&(Dt.nodeValue=_t):(fn=document.createTextNode(_t),Dt&&(Dt.parentNode&&Dt.parentNode.replaceChild(fn,Dt),$t(Dt,!0))),fn.__preactattr_=!0,fn;var Pe=_t.nodeName;if(typeof Pe=="function")return function(kn,qn,xe,Xn){for(var br=kn&&kn._component,Cr=br,dr=kn,Rr=br&&kn._componentConstructor===qn.nodeName,hn=Rr,Xt=ie(qn);br&&!hn&&(br=br._parentComponent);)hn=br.constructor===qn.nodeName;return br&&hn&&(!Xn||br._component)?(Ye(br,Xt,3,xe,Xn),kn=br.base):(Cr&&!Rr&&(Zt(Cr),kn=dr=null),br=Gt(qn.nodeName,Xt,xe),kn&&!br.nextBase&&(br.nextBase=kn,dr=null),Ye(br,Xt,1,xe,Xn),kn=br.base,dr&&kn!==dr&&(dr._component=null,$t(dr,!1))),kn}(Dt,_t,xn,In);if(je=Pe==="svg"||Pe!=="foreignObject"&&je,Pe=String(Pe),(!Dt||!ue(Dt,Pe))&&(fn=function(kn,qn){var xe=qn?document.createElementNS("http://www.w3.org/2000/svg",kn):document.createElement(kn);return xe.normalizedNodeName=kn,xe}(Pe,je),Dt)){for(;Dt.firstChild;)fn.appendChild(Dt.firstChild);Dt.parentNode&&Dt.parentNode.replaceChild(fn,Dt),$t(Dt,!0)}var rt=fn.firstChild,Et=fn.__preactattr_,Lt=_t.children;if(Et==null){Et=fn.__preactattr_={};for(var rn=fn.attributes,Sn=rn.length;Sn--;)Et[rn[Sn].name]=rn[Sn].value}return!ke&&Lt&&Lt.length===1&&typeof Lt[0]=="string"&&rt!=null&&rt.splitText!==void 0&&rt.nextSibling==null?rt.nodeValue!=Lt[0]&&(rt.nodeValue=Lt[0]):(Lt&&Lt.length||rt!=null)&&function(kn,qn,xe,Xn,br){var Cr,dr,Rr,hn,Xt,nn=kn.childNodes,Gn=[],Dn={},mr=0,xr=0,gr=nn.length,Qr=0,ni=qn?qn.length:0;if(gr!==0)for(var Mr=0;Mr<gr;Mr++){var di=nn[Mr],Yr=di.__preactattr_,Xr=ni&&Yr?di._component?di._component.__key:Yr.key:null;Xr!=null?(mr++,Dn[Xr]=di):(Yr||(di.splitText!==void 0?!br||di.nodeValue.trim():br))&&(Gn[Qr++]=di)}if(ni!==0)for(var Mr=0;Mr<ni;Mr++){hn=qn[Mr],Xt=null;var Xr=hn.key;if(Xr!=null)mr&&Dn[Xr]!==void 0&&(Xt=Dn[Xr],Dn[Xr]=void 0,mr--);else if(!Xt&&xr<Qr){for(Cr=xr;Cr<Qr;Cr++)if(Gn[Cr]!==void 0&&F(dr=Gn[Cr],hn,br)){Xt=dr,Gn[Cr]=void 0,Cr===Qr-1&&Qr--,Cr===xr&&xr++;break}}Xt=zt(Xt,hn,xe,Xn),Rr=nn[Mr],Xt&&Xt!==kn&&Xt!==Rr&&(Rr==null?kn.appendChild(Xt):Xt===Rr.nextSibling?K(Rr):kn.insertBefore(Xt,Rr))}if(mr)for(var Mr in Dn)Dn[Mr]!==void 0&&$t(Dn[Mr],!1);for(;xr<=Qr;)(Xt=Gn[Qr--])!==void 0&&$t(Xt,!1)}(fn,Lt,xn,In,ke||Et.dangerouslySetInnerHTML!=null),function(kn,qn,xe){var Xn;for(Xn in xe)qn&&qn[Xn]!=null||xe[Xn]==null||he(kn,Xn,xe[Xn],xe[Xn]=void 0,je);for(Xn in qn)Xn==="children"||Xn==="innerHTML"||Xn in xe&&qn[Xn]===(Xn==="value"||Xn==="checked"?kn[Xn]:xe[Xn])||he(kn,Xn,xe[Xn],xe[Xn]=qn[Xn],je)}(fn,_t.attributes,Et),je=We,fn}function $t(Dt,_t){var xn=Dt._component;xn?Zt(xn):(Dt.__preactattr_!=null&&Dt.__preactattr_.ref&&Dt.__preactattr_.ref(null),_t!==!1&&Dt.__preactattr_!=null||K(Dt),we(Dt))}function we(Dt){for(Dt=Dt.lastChild;Dt;){var _t=Dt.previousSibling;$t(Dt,!0),Dt=_t}}var Tt={};function Gt(Dt,_t,xn){var In,Yn=Tt[Dt.name];if(Dt.prototype&&Dt.prototype.render?(In=new Dt(_t,xn),Bt.call(In,_t,xn)):((In=new Bt(_t,xn)).constructor=Dt,In.render=Pt),Yn){for(var fn=Yn.length;fn--;)if(Yn[fn].constructor===Dt){In.nextBase=Yn[fn].nextBase,Yn.splice(fn,1);break}}return In}function Pt(Dt,_t,xn){return this.constructor(Dt,xn)}function Ye(Dt,_t,xn,In,Yn){Dt._disable||(Dt._disable=!0,(Dt.__ref=_t.ref)&&delete _t.ref,(Dt.__key=_t.key)&&delete _t.key,!Dt.base||Yn?Dt.componentWillMount&&Dt.componentWillMount():Dt.componentWillReceiveProps&&Dt.componentWillReceiveProps(_t,In),In&&In!==Dt.context&&(Dt.prevContext||(Dt.prevContext=Dt.context),Dt.context=In),Dt.prevProps||(Dt.prevProps=Dt.props),Dt.props=_t,Dt._disable=!1,xn!==0&&(xn!==1&&b.syncComponentUpdates===!1&&Dt.base?L(Dt):ln(Dt,1,Yn)),Dt.__ref&&Dt.__ref(Dt))}function ln(Dt,_t,xn,In){if(!Dt._disable){var Yn,fn,We,Pe=Dt.props,rt=Dt.state,Et=Dt.context,Lt=Dt.prevProps||Pe,rn=Dt.prevState||rt,Sn=Dt.prevContext||Et,kn=Dt.base,qn=Dt.nextBase,xe=kn||qn,Xn=Dt._component,br=!1;if(kn&&(Dt.props=Lt,Dt.state=rn,Dt.context=Sn,_t!==2&&Dt.shouldComponentUpdate&&Dt.shouldComponentUpdate(Pe,rt,Et)===!1?br=!0:Dt.componentWillUpdate&&Dt.componentWillUpdate(Pe,rt,Et),Dt.props=Pe,Dt.state=rt,Dt.context=Et),Dt.prevProps=Dt.prevState=Dt.prevContext=Dt.nextBase=null,Dt._dirty=!1,!br){Yn=Dt.render(Pe,rt,Et),Dt.getChildContext&&(Et=re(re({},Et),Dt.getChildContext()));var Cr,dr,Rr=Yn&&Yn.nodeName;if(typeof Rr=="function"){var hn=ie(Yn);(fn=Xn)&&fn.constructor===Rr&&hn.key==fn.__key?Ye(fn,hn,1,Et,!1):(Cr=fn,Dt._component=fn=Gt(Rr,hn,Et),fn.nextBase=fn.nextBase||qn,fn._parentComponent=Dt,Ye(fn,hn,0,Et,!1),ln(fn,1,xn,!0)),dr=fn.base}else We=xe,(Cr=Xn)&&(We=Dt._component=null),(xe||_t===1)&&(We&&(We._component=null),dr=St(We,Yn,Et,xn||!kn,xe&&xe.parentNode,!0));if(xe&&dr!==xe&&fn!==Xn){var Xt=xe.parentNode;Xt&&dr!==Xt&&(Xt.replaceChild(dr,xe),Cr||(xe._component=null,$t(xe,!1)))}if(Cr&&Zt(Cr),Dt.base=dr,dr&&!In){for(var nn=Dt,Gn=Dt;Gn=Gn._parentComponent;)(nn=Gn).base=dr;dr._component=nn,dr._componentConstructor=nn.constructor}}if(!kn||xn?Ae.unshift(Dt):br||(Dt.componentDidUpdate&&Dt.componentDidUpdate(Lt,rn,Sn),b.afterUpdate&&b.afterUpdate(Dt)),Dt._renderCallbacks!=null)for(;Dt._renderCallbacks.length;)Dt._renderCallbacks.pop().call(Dt);Te||In||at()}}function Zt(Dt){b.beforeUnmount&&b.beforeUnmount(Dt);var _t=Dt.base;Dt._disable=!0,Dt.componentWillUnmount&&Dt.componentWillUnmount(),Dt.base=null;var xn=Dt._component;xn?Zt(xn):_t&&(_t.__preactattr_&&_t.__preactattr_.ref&&_t.__preactattr_.ref(null),Dt.nextBase=_t,K(_t),function(In){var Yn=In.constructor.name;(Tt[Yn]||(Tt[Yn]=[])).push(In)}(Dt),we(_t)),Dt.__ref&&Dt.__ref(null)}function Bt(Dt,_t){this._dirty=!0,this.context=_t,this.props=Dt,this.state=this.state||{}}function Mt(Dt,_t,xn){return St(xn,Dt,{},!1,_t,!1)}re(Bt.prototype,{setState:function(Dt,_t){var xn=this.state;this.prevState||(this.prevState=re({},xn)),re(xn,typeof Dt=="function"?Dt(xn,this.props):Dt),_t&&(this._renderCallbacks=this._renderCallbacks||[]).push(_t),L(this)},forceUpdate:function(Dt){Dt&&(this._renderCallbacks=this._renderCallbacks||[]).push(Dt),ln(this,2)},render:function(){}});var bn={h:B,createElement:B,cloneElement:R,Component:Bt,render:Mt,rerender:ee,options:b};A.default=bn},function(Oe,A,o){/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var b=Object.getOwnPropertySymbols,H=Object.prototype.hasOwnProperty,U=Object.prototype.propertyIsEnumerable;Oe.exports=function(){try{if(!Object.assign)return!1;var B=new String("abc");if(B[5]="de",Object.getOwnPropertyNames(B)[0]==="5")return!1;for(var re={},J=0;J<10;J++)re["_"+String.fromCharCode(J)]=J;if(Object.getOwnPropertyNames(re).map(function(P){return re[P]}).join("")!=="0123456789")return!1;var R={};return"abcdefghijklmnopqrst".split("").forEach(function(P){R[P]=P}),Object.keys(Object.assign({},R)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}()?Object.assign:function(B,re){for(var J,R,P=function(F){if(F==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(F)}(B),$=1;$<arguments.length;$++){for(var L in J=Object(arguments[$]))H.call(J,L)&&(P[L]=J[L]);if(b){R=b(J);for(var ee=0;ee<R.length;ee++)U.call(J,R[ee])&&(P[R[ee]]=J[R[ee]])}}return P}},function(Oe,A,o){const b=o(32),H=o(113),{ANY:U}=H,B=o(47),re=o(112),J=o(114),R=o(143),P=o(141),$=o(142);Oe.exports=(L,ee,F,ue)=>{let ie,K,he,pe,Ae;switch(L=new b(L,ue),ee=new B(ee,ue),F){case">":ie=J,K=P,he=R,pe=">",Ae=">=";break;case"<":ie=R,K=$,he=J,pe="<",Ae="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(re(L,ee,ue))return!1;for(let Te=0;Te<ee.set.length;++Te){let je=null,ke=null;if(ee.set[Te].forEach(at=>{at.semver===U&&(at=new H(">=0.0.0")),je=je||at,ke=ke||at,ie(at.semver,je.semver,ue)?je=at:he(at.semver,ke.semver,ue)&&(ke=at)}),je.operator===pe||je.operator===Ae||(!ke.operator||ke.operator===pe)&&K(L,ke.semver)||ke.operator===Ae&&he(L,ke.semver))return!1}return!0}},function(Oe,A,o){const b=o(48);Oe.exports=(H,U,B)=>b(H,U,B)<=0},function(Oe,A,o){const b=o(48);Oe.exports=(H,U,B)=>b(H,U,B)>=0},function(Oe,A,o){const b=o(48);Oe.exports=(H,U,B)=>b(H,U,B)<0},function(Oe,A,o){const b=o(32);Oe.exports=(H,U,B)=>{const re=new b(H,B),J=new b(U,B);return re.compare(J)||re.compareBuild(J)}},function(Oe,A,o){const b=o(48);Oe.exports=(H,U,B)=>b(H,U,B)===0},function(Oe,A){const o=/^[0-9]+$/,b=(H,U)=>{const B=o.test(H),re=o.test(U);return B&&re&&(H=+H,U=+U),H===U?0:B&&!re?-1:re&&!B?1:H<U?-1:1};Oe.exports={compareIdentifiers:b,rcompareIdentifiers:(H,U)=>b(U,H)}},function(Oe,A,o){/**
* @license
* Copyright 2017 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0}),A.getBroadcastDims=function(b,H){for(var U=b.length,B=[],re=0;re<U;re++){var J=U-1-re,R=b[J]||1;(H[H.length-1-re]||1)>1&&R===1&&B.unshift(J)}return B},A.getReductionAxes=function(b,H){for(var U=[],B=0;B<H.length;B++){var re=b[b.length-B-1],J=H.length-B-1,R=H[J];(re==null||re===1&&R>1)&&U.unshift(J)}return U},A.assertAndGetBroadcastShape=function(b,H){for(var U=[],B=Math.max(b.length,H.length),re=0;re<B;re++){var J=b[b.length-re-1];J==null&&(J=1);var R=H[H.length-re-1];if(R==null&&(R=1),J===1)U.unshift(R);else if(R===1)U.unshift(J);else{if(J!==R)throw Error("Operands could not be broadcast together with shapes "+b+" and "+H+".");U.unshift(J)}}return U}},function(Oe,A,o){Oe.exports=!o(208)(function(){return Object.defineProperty({},"a",{get:function(){return 7}}).a!=7})},function(Oe,A){Oe.exports=function(o){return typeof o=="object"?o!==null:typeof o=="function"}},function(Oe,A){var o=Oe.exports=typeof window<"u"&&window.Math==Math?window:typeof self<"u"&&self.Math==Math?self:Function("return this")();typeof __g=="number"&&(__g=o)},function(Oe,A,o){var b=o(16),H=o(27),U=o(83),B=o(118),re=o(42),J=o(93),R=o(15),P=o(94),$=o(54),L=o(22),ee=o(213),F=o(79).f,ue=o(26).f,ie=o(156),K=o(98),he="prototype",pe="Wrong index!",Ae=b.ArrayBuffer,Te=b.DataView,je=b.Math,ke=b.RangeError,at=b.Infinity,St=Ae,zt=je.abs,$t=je.pow,we=je.floor,Tt=je.log,Gt=je.LN2,Pt=H?"_b":"buffer",Ye=H?"_l":"byteLength",ln=H?"_o":"byteOffset";function Zt(kn,qn,xe){var Xn,br,Cr,dr=new Array(xe),Rr=8*xe-qn-1,hn=(1<<Rr)-1,Xt=hn>>1,nn=qn===23?$t(2,-24)-$t(2,-77):0,Gn=0,Dn=kn<0||kn===0&&1/kn<0?1:0;for((kn=zt(kn))!=kn||kn===at?(br=kn!=kn?1:0,Xn=hn):(Xn=we(Tt(kn)/Gt),kn*(Cr=$t(2,-Xn))<1&&(Xn--,Cr*=2),(kn+=Xn+Xt>=1?nn/Cr:nn*$t(2,1-Xt))*Cr>=2&&(Xn++,Cr/=2),Xn+Xt>=hn?(br=0,Xn=hn):Xn+Xt>=1?(br=(kn*Cr-1)*$t(2,qn),Xn+=Xt):(br=kn*$t(2,Xt-1)*$t(2,qn),Xn=0));qn>=8;dr[Gn++]=255&br,br/=256,qn-=8);for(Xn=Xn<<qn|br,Rr+=qn;Rr>0;dr[Gn++]=255&Xn,Xn/=256,Rr-=8);return dr[--Gn]|=128*Dn,dr}function Bt(kn,qn,xe){var Xn,br=8*xe-qn-1,Cr=(1<<br)-1,dr=Cr>>1,Rr=br-7,hn=xe-1,Xt=kn[hn--],nn=127&Xt;for(Xt>>=7;Rr>0;nn=256*nn+kn[hn],hn--,Rr-=8);for(Xn=nn&(1<<-Rr)-1,nn>>=-Rr,Rr+=qn;Rr>0;Xn=256*Xn+kn[hn],hn--,Rr-=8);if(nn===0)nn=1-dr;else{if(nn===Cr)return Xn?NaN:Xt?-at:at;Xn+=$t(2,qn),nn-=dr}return(Xt?-1:1)*Xn*$t(2,nn-qn)}function Mt(kn){return kn[3]<<24|kn[2]<<16|kn[1]<<8|kn[0]}function bn(kn){return[255&kn]}function Dt(kn){return[255&kn,kn>>8&255]}function _t(kn){return[255&kn,kn>>8&255,kn>>16&255,kn>>24&255]}function xn(kn){return Zt(kn,52,8)}function In(kn){return Zt(kn,23,4)}function Yn(kn,qn,xe){ue(kn[he],qn,{get:function(){return this[xe]}})}function fn(kn,qn,xe,Xn){var br=ee(+xe);if(br+qn>kn[Ye])throw ke(pe);var Cr=kn[Pt]._b,dr=br+kn[ln],Rr=Cr.slice(dr,dr+qn);return Xn?Rr:Rr.reverse()}function We(kn,qn,xe,Xn,br,Cr){var dr=ee(+xe);if(dr+qn>kn[Ye])throw ke(pe);for(var Rr=kn[Pt]._b,hn=dr+kn[ln],Xt=Xn(+br),nn=0;nn<qn;nn++)Rr[hn+nn]=Xt[Cr?nn:qn-nn-1]}if(B.ABV){if(!R(function(){Ae(1)})||!R(function(){new Ae(-1)})||R(function(){return new Ae,new Ae(1.5),new Ae(NaN),Ae.name!="ArrayBuffer"})){for(var Pe,rt=(Ae=function(kn){return P(this,Ae),new St(ee(kn))})[he]=St[he],Et=F(St),Lt=0;Et.length>Lt;)(Pe=Et[Lt++])in Ae||re(Ae,Pe,St[Pe]);U||(rt.constructor=Ae)}var rn=new Te(new Ae(2)),Sn=Te[he].setInt8;rn.setInt8(0,2147483648),rn.setInt8(1,2147483649),!rn.getInt8(0)&&rn.getInt8(1)||J(Te[he],{setInt8:function(kn,qn){Sn.call(this,kn,qn<<24>>24)},setUint8:function(kn,qn){Sn.call(this,kn,qn<<24>>24)}},!0)}else Ae=function(kn){P(this,Ae,"ArrayBuffer");var qn=ee(kn);this._b=ie.call(new Array(qn),0),this[Ye]=qn},Te=function(kn,qn,xe){P(this,Te,"DataView"),P(kn,Ae,"DataView");var Xn=kn[Ye],br=$(qn);if(br<0||br>Xn)throw ke("Wrong offset!");if(br+(xe=xe===void 0?Xn-br:L(xe))>Xn)throw ke("Wrong length!");this[Pt]=kn,this[ln]=br,this[Ye]=xe},H&&(Yn(Ae,"byteLength","_l"),Yn(Te,"buffer","_b"),Yn(Te,"byteLength","_l"),Yn(Te,"byteOffset","_o")),J(Te[he],{getInt8:function(kn){return fn(this,1,kn)[0]<<24>>24},getUint8:function(kn){return fn(this,1,kn)[0]},getInt16:function(kn){var qn=fn(this,2,kn,arguments[1]);return(qn[1]<<8|qn[0])<<16>>16},getUint16:function(kn){var qn=fn(this,2,kn,arguments[1]);return qn[1]<<8|qn[0]},getInt32:function(kn){return Mt(fn(this,4,kn,arguments[1]))},getUint32:function(kn){return Mt(fn(this,4,kn,arguments[1]))>>>0},getFloat32:function(kn){return Bt(fn(this,4,kn,arguments[1]),23,4)},getFloat64:function(kn){return Bt(fn(this,8,kn,arguments[1]),52,8)},setInt8:function(kn,qn){We(this,1,kn,bn,qn)},setUint8:function(kn,qn){We(this,1,kn,bn,qn)},setInt16:function(kn,qn){We(this,2,kn,Dt,qn,arguments[2])},setUint16:function(kn,qn){We(this,2,kn,Dt,qn,arguments[2])},setInt32:function(kn,qn){We(this,4,kn,_t,qn,arguments[2])},setUint32:function(kn,qn){We(this,4,kn,_t,qn,arguments[2])},setFloat32:function(kn,qn){We(this,4,kn,In,qn,arguments[2])},setFloat64:function(kn,qn){We(this,8,kn,xn,qn,arguments[2])}});K(Ae,"ArrayBuffer"),K(Te,"DataView"),re(Te[he],B.VIEW,!0),A.ArrayBuffer=Ae,A.DataView=Te},function(Oe,A,o){var b,H,U,B=o(56),re=o(232),J=o(171),R=o(175),P=o(16),$=P.process,L=P.setImmediate,ee=P.clearImmediate,F=P.MessageChannel,ue=P.Dispatch,ie=0,K={},he=function(){var Ae=+this;if(K.hasOwnProperty(Ae)){var Te=K[Ae];delete K[Ae],Te()}},pe=function(Ae){he.call(Ae.data)};L&&ee||(L=function(Ae){for(var Te=[],je=1;arguments.length>je;)Te.push(arguments[je++]);return K[++ie]=function(){re(typeof Ae=="function"?Ae:Function(Ae),Te)},b(ie),ie},ee=function(Ae){delete K[Ae]},o(62)($)=="process"?b=function(Ae){$.nextTick(B(he,Ae,1))}:ue&&ue.now?b=function(Ae){ue.now(B(he,Ae,1))}:F?(U=(H=new F).port2,H.port1.onmessage=pe,b=B(U.postMessage,U,1)):P.addEventListener&&typeof postMessage=="function"&&!P.importScripts?(b=function(Ae){P.postMessage(Ae+"","*")},P.addEventListener("message",pe,!1)):b="onreadystatechange"in R("script")?function(Ae){J.appendChild(R("script")).onreadystatechange=function(){J.removeChild(this),he.call(Ae)}}:function(Ae){setTimeout(B(he,Ae,1),0)}),Oe.exports={set:L,clear:ee}},function(Oe,A,o){var b=o(164)(!0);Oe.exports=function(H,U,B){return U+(B?b(H,U).length:1)}},function(Oe,A,o){var b=o(124),H=RegExp.prototype.exec,U=String.prototype.replace,B=H,re=function(){var R=/a/,P=/b*/g;return H.call(R,"a"),H.call(P,"a"),R.lastIndex!==0||P.lastIndex!==0}(),J=/()??/.exec("")[1]!==void 0;(re||J)&&(B=function(R){var P,$,L,ee,F=this;return J&&($=new RegExp("^"+F.source+"$(?!\\s)",b.call(F))),re&&(P=F.lastIndex),L=H.call(F,R),re&&L&&(F.lastIndex=F.global?L.index+L[0].length:P),J&&L&&L.length>1&&U.call(L[0],$,function(){for(ee=1;ee<arguments.length-2;ee++)arguments[ee]===void 0&&(L[ee]=void 0)}),L}),Oe.exports=B},function(Oe,A,o){var b=o(77),H=o(221),U=o(96),B=o(41);Oe.exports=o(163)(Array,"Array",function(re,J){this._t=B(re),this._i=0,this._k=J},function(){var re=this._t,J=this._k,R=this._i++;return!re||R>=re.length?(this._t=void 0,H(1)):H(0,J=="keys"?R:J=="values"?re[R]:[R,re[R]])},"values"),U.Arguments=U.Array,b("keys"),b("values"),b("entries")},function(Oe,A,o){var b=o(34),H=o(81),U=o(22);Oe.exports=function(B){for(var re=b(this),J=U(re.length),R=arguments.length,P=H(R>1?arguments[1]:void 0,J),$=R>2?arguments[2]:void 0,L=$===void 0?J:H($,J);L>P;)re[P++]=B;return re}},function(Oe,A,o){var b=o(105),H=o(19)("iterator"),U=o(96);Oe.exports=o(24).getIteratorMethod=function(B){if(B!=null)return B[H]||B["@@iterator"]||U[b(B)]}},function(Oe,A,o){var b=o(26),H=o(85);Oe.exports=function(U,B,re){B in U?b.f(U,B,H(0,re)):U[B]=re}},function(Oe,A,o){var b=o(96),H=o(19)("iterator"),U=Array.prototype;Oe.exports=function(B){return B!==void 0&&(b.Array===B||U[H]===B)}},function(Oe,A,o){var b=o(19)("match");Oe.exports=function(H){var U=/./;try{"/./"[H](U)}catch{try{return U[b]=!1,!"/./"[H](U)}catch{}}return!0}},function(Oe,A,o){var b=o(13),H=o(62),U=o(19)("match");Oe.exports=function(B){var re;return b(B)&&((re=B[U])!==void 0?!!re:H(B)=="RegExp")}},function(Oe,A,o){var b=o(161),H=o(61);Oe.exports=function(U,B,re){if(b(B))throw TypeError("String#"+re+" doesn't accept regex!");return String(H(U))}},function(Oe,A,o){var b=o(83),H=o(8),U=o(38),B=o(42),re=o(96),J=o(226),R=o(98),P=o(78),$=o(19)("iterator"),L=!([].keys&&"next"in[].keys()),ee=function(){return this};Oe.exports=function(F,ue,ie,K,he,pe,Ae){J(ie,ue,K);var Te,je,ke,at=function(ln){if(!L&&ln in we)return we[ln];switch(ln){case"keys":case"values":return function(){return new ie(this,ln)}}return function(){return new ie(this,ln)}},St=ue+" Iterator",zt=he=="values",$t=!1,we=F.prototype,Tt=we[$]||we["@@iterator"]||he&&we[he],Gt=Tt||at(he),Pt=he?zt?at("entries"):Gt:void 0,Ye=ue=="Array"&&we.entries||Tt;if(Ye&&(ke=P(Ye.call(new F)))!==Object.prototype&&ke.next&&(R(ke,St,!0),b||typeof ke[$]=="function"||B(ke,$,ee)),zt&&Tt&&Tt.name!=="values"&&($t=!0,Gt=function(){return Tt.call(this)}),b&&!Ae||!L&&!$t&&we[$]||B(we,$,Gt),re[ue]=Gt,re[St]=ee,he)if(Te={values:zt?Gt:at("values"),keys:pe?Gt:at("keys"),entries:Pt},Ae)for(je in Te)je in we||U(we,je,Te[je]);else H(H.P+H.F*(L||$t),ue,Te);return Te}},function(Oe,A,o){var b=o(54),H=o(61);Oe.exports=function(U){return function(B,re){var J,R,P=String(H(B)),$=b(re),L=P.length;return $<0||$>=L?U?"":void 0:(J=P.charCodeAt($))<55296||J>56319||$+1===L||(R=P.charCodeAt($+1))<56320||R>57343?U?P.charAt($):J:U?P.slice($,$+2):R-56320+(J-55296<<10)+65536}}},function(Oe,A){var o=Math.expm1;Oe.exports=!o||o(10)>22025.465794806718||o(10)<22025.465794806718||o(-2e-17)!=-2e-17?function(b){return(b=+b)==0?b:b>-1e-6&&b<1e-6?b+b*b/2:Math.exp(b)-1}:o},function(Oe,A){Oe.exports=Math.sign||function(o){return(o=+o)==0||o!=o?o:o<0?-1:1}},function(Oe,A,o){var b=o(54),H=o(61);Oe.exports=function(U){var B=String(H(this)),re="",J=b(U);if(J<0||J==1/0)throw RangeError("Count can't be negative");for(;J>0;(J>>>=1)&&(B+=B))1&J&&(re+=B);return re}},function(Oe,A,o){var b=o(13),H=o(170).set;Oe.exports=function(U,B,re){var J,R=B.constructor;return R!==re&&typeof R=="function"&&(J=R.prototype)!==re.prototype&&b(J)&&H&&H(U,J),U}},function(Oe,A){Oe.exports=`	
\v\f\r \u2028\u2029\uFEFF`},function(Oe,A,o){var b=o(13),H=o(14),U=function(B,re){if(H(B),!b(re)&&re!==null)throw TypeError(re+": can't set as prototype!")};Oe.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(B,re,J){try{(J=o(56)(Function.call,o(53).f(Object.prototype,"__proto__").set,2))(B,[]),re=!(B instanceof Array)}catch{re=!0}return function(R,P){return U(R,P),re?R.__proto__=P:J(R,P),R}}({},!1):void 0),check:U}},function(Oe,A,o){var b=o(16).document;Oe.exports=b&&b.documentElement},function(Oe,A){Oe.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(Oe,A,o){var b=o(129)("keys"),H=o(84);Oe.exports=function(U){return b[U]||(b[U]=H(U))}},function(Oe,A,o){A.f=o(19)},function(Oe,A,o){var b=o(13),H=o(16).document,U=b(H)&&b(H.createElement);Oe.exports=function(B){return U?H.createElement(B):{}}},function(Oe,A,o){var b=function(pe){return pe},H=function(pe){if(pe==null)return b;var Ae,Te,je=pe.scale[0],ke=pe.scale[1],at=pe.translate[0],St=pe.translate[1];return function(zt,$t){$t||(Ae=Te=0);var we=2,Tt=zt.length,Gt=new Array(Tt);for(Gt[0]=(Ae+=zt[0])*je+at,Gt[1]=(Te+=zt[1])*ke+St;we<Tt;)Gt[we]=zt[we],++we;return Gt}},U=function(pe){var Ae,Te=H(pe.transform),je=1/0,ke=je,at=-je,St=-je;function zt(we){(we=Te(we))[0]<je&&(je=we[0]),we[0]>at&&(at=we[0]),we[1]<ke&&(ke=we[1]),we[1]>St&&(St=we[1])}function $t(we){switch(we.type){case"GeometryCollection":we.geometries.forEach($t);break;case"Point":zt(we.coordinates);break;case"MultiPoint":we.coordinates.forEach(zt)}}for(Ae in pe.arcs.forEach(function(we){for(var Tt,Gt=-1,Pt=we.length;++Gt<Pt;)(Tt=Te(we[Gt],Gt))[0]<je&&(je=Tt[0]),Tt[0]>at&&(at=Tt[0]),Tt[1]<ke&&(ke=Tt[1]),Tt[1]>St&&(St=Tt[1])}),pe.objects)$t(pe.objects[Ae]);return[je,ke,at,St]},B=function(pe,Ae){for(var Te,je=pe.length,ke=je-Ae;ke<--je;)Te=pe[ke],pe[ke++]=pe[je],pe[je]=Te},re=function(pe,Ae){return typeof Ae=="string"&&(Ae=pe.objects[Ae]),Ae.type==="GeometryCollection"?{type:"FeatureCollection",features:Ae.geometries.map(function(Te){return J(pe,Te)})}:J(pe,Ae)};function J(pe,Ae){var Te=Ae.id,je=Ae.bbox,ke=Ae.properties==null?{}:Ae.properties,at=R(pe,Ae);return Te==null&&je==null?{type:"Feature",properties:ke,geometry:at}:je==null?{type:"Feature",id:Te,properties:ke,geometry:at}:{type:"Feature",id:Te,bbox:je,properties:ke,geometry:at}}function R(pe,Ae){var Te=H(pe.transform),je=pe.arcs;function ke(we,Tt){Tt.length&&Tt.pop();for(var Gt=je[we<0?~we:we],Pt=0,Ye=Gt.length;Pt<Ye;++Pt)Tt.push(Te(Gt[Pt],Pt));we<0&&B(Tt,Ye)}function at(we){return Te(we)}function St(we){for(var Tt=[],Gt=0,Pt=we.length;Gt<Pt;++Gt)ke(we[Gt],Tt);return Tt.length<2&&Tt.push(Tt[0]),Tt}function zt(we){for(var Tt=St(we);Tt.length<4;)Tt.push(Tt[0]);return Tt}function $t(we){return we.map(zt)}return function we(Tt){var Gt,Pt=Tt.type;switch(Pt){case"GeometryCollection":return{type:Pt,geometries:Tt.geometries.map(we)};case"Point":Gt=at(Tt.coordinates);break;case"MultiPoint":Gt=Tt.coordinates.map(at);break;case"LineString":Gt=St(Tt.arcs);break;case"MultiLineString":Gt=Tt.arcs.map(St);break;case"Polygon":Gt=$t(Tt.arcs);break;case"MultiPolygon":Gt=Tt.arcs.map($t);break;default:return null}return{type:Pt,coordinates:Gt}}(Ae)}var P=function(pe,Ae){var Te={},je={},ke={},at=[],St=-1;function zt($t,we){for(var Tt in $t){var Gt=$t[Tt];delete we[Gt.start],delete Gt.start,delete Gt.end,Gt.forEach(function(Pt){Te[Pt<0?~Pt:Pt]=1}),at.push(Gt)}}return Ae.forEach(function($t,we){var Tt,Gt=pe.arcs[$t<0?~$t:$t];Gt.length<3&&!Gt[1][0]&&!Gt[1][1]&&(Tt=Ae[++St],Ae[St]=$t,Ae[we]=Tt)}),Ae.forEach(function($t){var we,Tt,Gt=function(Bt){var Mt,bn=pe.arcs[Bt<0?~Bt:Bt],Dt=bn[0];return pe.transform?(Mt=[0,0],bn.forEach(function(_t){Mt[0]+=_t[0],Mt[1]+=_t[1]})):Mt=bn[bn.length-1],Bt<0?[Mt,Dt]:[Dt,Mt]}($t),Pt=Gt[0],Ye=Gt[1];if(we=ke[Pt])if(delete ke[we.end],we.push($t),we.end=Ye,Tt=je[Ye]){delete je[Tt.start];var ln=Tt===we?we:we.concat(Tt);je[ln.start=we.start]=ke[ln.end=Tt.end]=ln}else je[we.start]=ke[we.end]=we;else if(we=je[Ye])if(delete je[we.start],we.unshift($t),we.start=Pt,Tt=ke[Pt]){delete ke[Tt.end];var Zt=Tt===we?we:Tt.concat(we);je[Zt.start=Tt.start]=ke[Zt.end=we.end]=Zt}else je[we.start]=ke[we.end]=we;else je[(we=[$t]).start=Pt]=ke[we.end=Ye]=we}),zt(ke,je),zt(je,ke),Ae.forEach(function($t){Te[$t<0?~$t:$t]||at.push([$t])}),at},$=function(pe){return R(pe,L.apply(this,arguments))};function L(pe,Ae,Te){var je,ke,at;if(arguments.length>1)je=function(St,zt,$t){var we,Tt=[],Gt=[];function Pt(Zt){var Bt=Zt<0?~Zt:Zt;(Gt[Bt]||(Gt[Bt]=[])).push({i:Zt,g:we})}function Ye(Zt){Zt.forEach(Pt)}function ln(Zt){Zt.forEach(Ye)}return function Zt(Bt){switch(we=Bt,Bt.type){case"GeometryCollection":Bt.geometries.forEach(Zt);break;case"LineString":Ye(Bt.arcs);break;case"MultiLineString":case"Polygon":ln(Bt.arcs);break;case"MultiPolygon":(function(Mt){Mt.forEach(ln)})(Bt.arcs)}}(zt),Gt.forEach($t==null?function(Zt){Tt.push(Zt[0].i)}:function(Zt){$t(Zt[0].g,Zt[Zt.length-1].g)&&Tt.push(Zt[0].i)}),Tt}(0,Ae,Te);else for(ke=0,je=new Array(at=pe.arcs.length);ke<at;++ke)je[ke]=ke;return{type:"MultiLineString",arcs:P(pe,je)}}var ee=function(pe){return R(pe,F.apply(this,arguments))};function F(pe,Ae){var Te={},je=[],ke=[];function at(zt){zt.forEach(function($t){$t.forEach(function(we){(Te[we=we<0?~we:we]||(Te[we]=[])).push(zt)})}),je.push(zt)}function St(zt){return function($t){for(var we,Tt=-1,Gt=$t.length,Pt=$t[Gt-1],Ye=0;++Tt<Gt;)we=Pt,Pt=$t[Tt],Ye+=we[0]*Pt[1]-we[1]*Pt[0];return Math.abs(Ye)}(R(pe,{type:"Polygon",arcs:[zt]}).coordinates[0])}return Ae.forEach(function zt($t){switch($t.type){case"GeometryCollection":$t.geometries.forEach(zt);break;case"Polygon":at($t.arcs);break;case"MultiPolygon":$t.arcs.forEach(at)}}),je.forEach(function(zt){if(!zt._){var $t=[],we=[zt];for(zt._=1,ke.push($t);zt=we.pop();)$t.push(zt),zt.forEach(function(Tt){Tt.forEach(function(Gt){Te[Gt<0?~Gt:Gt].forEach(function(Pt){Pt._||(Pt._=1,we.push(Pt))})})})}}),je.forEach(function(zt){delete zt._}),{type:"MultiPolygon",arcs:ke.map(function(zt){var $t,we=[];if(zt.forEach(function(ln){ln.forEach(function(Zt){Zt.forEach(function(Bt){Te[Bt<0?~Bt:Bt].length<2&&we.push(Bt)})})}),($t=(we=P(pe,we)).length)>1)for(var Tt,Gt,Pt=1,Ye=St(we[0]);Pt<$t;++Pt)(Tt=St(we[Pt]))>Ye&&(Gt=we[0],we[0]=we[Pt],we[Pt]=Gt,Ye=Tt);return we}).filter(function(zt){return zt.length>0})}}var ue=function(pe,Ae){for(var Te=0,je=pe.length;Te<je;){var ke=Te+je>>>1;pe[ke]<Ae?Te=ke+1:je=ke}return Te},ie=function(pe){var Ae={},Te=pe.map(function(){return[]});function je(ln,Zt){ln.forEach(function(Bt){Bt<0&&(Bt=~Bt);var Mt=Ae[Bt];Mt?Mt.push(Zt):Ae[Bt]=[Zt]})}function ke(ln,Zt){ln.forEach(function(Bt){je(Bt,Zt)})}var at={LineString:je,MultiLineString:ke,Polygon:ke,MultiPolygon:function(ln,Zt){ln.forEach(function(Bt){ke(Bt,Zt)})}};for(var St in pe.forEach(function ln(Zt,Bt){Zt.type==="GeometryCollection"?Zt.geometries.forEach(function(Mt){ln(Mt,Bt)}):Zt.type in at&&at[Zt.type](Zt.arcs,Bt)}),Ae)for(var zt=Ae[St],$t=zt.length,we=0;we<$t;++we)for(var Tt=we+1;Tt<$t;++Tt){var Gt,Pt=zt[we],Ye=zt[Tt];(Gt=Te[Pt])[St=ue(Gt,Ye)]!==Ye&&Gt.splice(St,0,Ye),(Gt=Te[Ye])[St=ue(Gt,Pt)]!==Pt&&Gt.splice(St,0,Pt)}return Te},K=function(pe){if(pe==null)return b;var Ae,Te,je=pe.scale[0],ke=pe.scale[1],at=pe.translate[0],St=pe.translate[1];return function(zt,$t){$t||(Ae=Te=0);var we=2,Tt=zt.length,Gt=new Array(Tt),Pt=Math.round((zt[0]-at)/je),Ye=Math.round((zt[1]-St)/ke);for(Gt[0]=Pt-Ae,Ae=Pt,Gt[1]=Ye-Te,Te=Ye;we<Tt;)Gt[we]=zt[we],++we;return Gt}},he=function(pe,Ae){if(pe.transform)throw new Error("already quantized");if(Ae&&Ae.scale)zt=pe.bbox;else{if(!((Te=Math.floor(Ae))>=2))throw new Error("n must be 2");var Te,je=(zt=pe.bbox||U(pe))[0],ke=zt[1],at=zt[2],St=zt[3];Ae={scale:[at-je?(at-je)/(Te-1):1,St-ke?(St-ke)/(Te-1):1],translate:[je,ke]}}var zt,$t,we=K(Ae),Tt=pe.objects,Gt={};function Pt(ln){return we(ln)}function Ye(ln){var Zt;switch(ln.type){case"GeometryCollection":Zt={type:"GeometryCollection",geometries:ln.geometries.map(Ye)};break;case"Point":Zt={type:"Point",coordinates:Pt(ln.coordinates)};break;case"MultiPoint":Zt={type:"MultiPoint",coordinates:ln.coordinates.map(Pt)};break;default:return ln}return ln.id!=null&&(Zt.id=ln.id),ln.bbox!=null&&(Zt.bbox=ln.bbox),ln.properties!=null&&(Zt.properties=ln.properties),Zt}for($t in Tt)Gt[$t]=Ye(Tt[$t]);return{type:"Topology",bbox:zt,transform:Ae,objects:Gt,arcs:pe.arcs.map(function(ln){var Zt,Bt=0,Mt=1,bn=ln.length,Dt=new Array(bn);for(Dt[0]=we(ln[0],0);++Bt<bn;)((Zt=we(ln[Bt],Bt))[0]||Zt[1])&&(Dt[Mt++]=Zt);return Mt===1&&(Dt[Mt++]=[0,0]),Dt.length=Mt,Dt})}};o.d(A,!1,function(){return U}),o.d(A,"a",function(){return re}),o.d(A,"b",function(){return $}),o.d(A,!1,function(){return L}),o.d(A,!1,function(){return ee}),o.d(A,!1,function(){return F}),o.d(A,!1,function(){return ie}),o.d(A,!1,function(){return he}),o.d(A,!1,function(){return H}),o.d(A,!1,function(){return K})},function(Oe,A,o){(function(b,H){function U(){return typeof b=="object"&&Oe!==void 0&&H!==void 0&&!!H.version}o.d(A,"a",function(){return U})}).call(this,o(59),o(75))},function(Oe,A,o){(function(b){o.d(A,"a",function(){return B});var H=o(5),U=o(131);function B(){var re=b.Canvas||b.HTMLCanvasElement,J=b.Image||b.HTMLImageElement,R=b.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},P=Object(U.a)();return Object(H.a)({Canvas:re||function(){return function(){}}(),CanvasRenderingContext2D:b.CanvasRenderingContext2D||function(){return function(){}}(),Image:J||function(){return function(){}}(),ImageData:b.ImageData||function(){return function(){}}(),Video:b.HTMLVideoElement||function(){return function(){}}(),createCanvasElement:function(){if(re)return new re;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},createImageElement:function(){if(J)return new J;throw new Error("createImageElement - missing Image implementation for nodejs environment")},fetch:R},P)}}).call(this,o(59))},function(Oe,A,o){const b=o(90);Oe.exports={re:b.re,src:b.src,tokens:b.t,SEMVER_SPEC_VERSION:o(117).SEMVER_SPEC_VERSION,SemVer:o(32),compareIdentifiers:o(146).compareIdentifiers,rcompareIdentifiers:o(146).rcompareIdentifiers,parse:o(89),valid:o(348),clean:o(347),inc:o(346),diff:o(345),major:o(344),minor:o(343),patch:o(342),prerelease:o(341),compare:o(48),rcompare:o(340),compareLoose:o(339),compareBuild:o(144),sort:o(338),rsort:o(337),gt:o(114),lt:o(143),eq:o(145),neq:o(204),gte:o(142),lte:o(141),cmp:o(203),coerce:o(336),Comparator:o(113),Range:o(47),satisfies:o(112),toComparators:o(332),maxSatisfying:o(331),minSatisfying:o(330),minVersion:o(329),validRange:o(328),outside:o(140),gtr:o(327),ltr:o(326),intersects:o(325),simplifyRange:o(324),subset:o(323)}},function(Oe,A,o){var b=o(31),H=o(12),U=Object(b.a)(function(B){B.setUTCSeconds(0,0)},function(B,re){B.setTime(+B+re*H.c)},function(B,re){return(re-B)/H.c},function(B){return B.getUTCMinutes()});A.a=U,U.range},function(Oe,A,o){var b=o(31),H=o(12),U=Object(b.a)(function(B){B.setUTCMinutes(0,0,0)},function(B,re){B.setTime(+B+re*H.b)},function(B,re){return(re-B)/H.b},function(B){return B.getUTCHours()});A.a=U,U.range},function(Oe,A,o){var b=o(31),H=Object(b.a)(function(){},function(U,B){U.setTime(+U+B)},function(U,B){return B-U});H.every=function(U){return U=Math.floor(U),isFinite(U)&&U>0?U>1?Object(b.a)(function(B){B.setTime(Math.floor(B/U)*U)},function(B,re){B.setTime(+B+re*U)},function(B,re){return(re-B)/U}):H:null},A.a=H,H.range},function(Oe,A,o){var b=o(31),H=o(12),U=Object(b.a)(function(B){B.setTime(B-B.getMilliseconds()-B.getSeconds()*H.e)},function(B,re){B.setTime(+B+re*H.c)},function(B,re){return(re-B)/H.c},function(B){return B.getMinutes()});A.a=U,U.range},function(Oe,A,o){var b=o(31),H=o(12),U=Object(b.a)(function(B){B.setTime(B-B.getMilliseconds()-B.getSeconds()*H.e-B.getMinutes()*H.c)},function(B,re){B.setTime(+B+re*H.b)},function(B,re){return(re-B)/H.b},function(B){return B.getHours()});A.a=U,U.range},function(Oe,A){},function(Oe,A){Oe.exports=function(o,b){(b==null||b>o.length)&&(b=o.length);for(var H=0,U=new Array(b);H<b;H++)U[H]=o[H];return U},Oe.exports.__esModule=!0,Oe.exports.default=Oe.exports},function(Oe,A,o){var b=o(186);Oe.exports=function(H,U){if(H){if(typeof H=="string")return b(H,U);var B=Object.prototype.toString.call(H).slice(8,-1);return B==="Object"&&H.constructor&&(B=H.constructor.name),B==="Map"||B==="Set"?Array.from(H):B==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(B)?b(H,U):void 0}},Oe.exports.__esModule=!0,Oe.exports.default=Oe.exports},function(Oe,A,o){function b(H){this.message=H}b.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},b.prototype.__CANCEL__=!0,Oe.exports=b},function(Oe,A,o){var b=o(36);Oe.exports=function(H,U){U=U||{};var B={},re=["url","method","data"],J=["headers","auth","proxy","params"],R=["baseURL","transformRequest","transformResponse","paramsSerializer","timeout","timeoutMessage","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","decompress","maxContentLength","maxBodyLength","maxRedirects","transport","httpAgent","httpsAgent","cancelToken","socketPath","responseEncoding"],P=["validateStatus"];function $(ue,ie){return b.isPlainObject(ue)&&b.isPlainObject(ie)?b.merge(ue,ie):b.isPlainObject(ie)?b.merge({},ie):b.isArray(ie)?ie.slice():ie}function L(ue){b.isUndefined(U[ue])?b.isUndefined(H[ue])||(B[ue]=$(void 0,H[ue])):B[ue]=$(H[ue],U[ue])}b.forEach(re,function(ue){b.isUndefined(U[ue])||(B[ue]=$(void 0,U[ue]))}),b.forEach(J,L),b.forEach(R,function(ue){b.isUndefined(U[ue])?b.isUndefined(H[ue])||(B[ue]=$(void 0,H[ue])):B[ue]=$(void 0,U[ue])}),b.forEach(P,function(ue){ue in U?B[ue]=$(H[ue],U[ue]):ue in H&&(B[ue]=$(void 0,H[ue]))});var ee=re.concat(J).concat(R).concat(P),F=Object.keys(H).concat(Object.keys(U)).filter(function(ue){return ee.indexOf(ue)===-1});return b.forEach(F,L),B}},function(Oe,A,o){Oe.exports=function(b){return!(!b||!b.__CANCEL__)}},function(Oe,A,o){var b=o(193);Oe.exports=function(H,U,B,re,J){var R=new Error(H);return b(R,U,B,re,J)}},function(Oe,A,o){var b=o(36),H=o(274),U=o(273),B=o(194),re=o(272),J=o(269),R=o(268),P=o(191);Oe.exports=function($){return new Promise(function(L,ee){var F=$.data,ue=$.headers,ie=$.responseType;b.isFormData(F)&&delete ue["Content-Type"];var K=new XMLHttpRequest;if($.auth){var he=$.auth.username||"",pe=$.auth.password?unescape(encodeURIComponent($.auth.password)):"";ue.Authorization="Basic "+btoa(he+":"+pe)}var Ae=re($.baseURL,$.url);function Te(){if(K){var ke="getAllResponseHeaders"in K?J(K.getAllResponseHeaders()):null,at={data:ie&&ie!=="text"&&ie!=="json"?K.response:K.responseText,status:K.status,statusText:K.statusText,headers:ke,config:$,request:K};H(L,ee,at),K=null}}if(K.open($.method.toUpperCase(),B(Ae,$.params,$.paramsSerializer),!0),K.timeout=$.timeout,"onloadend"in K?K.onloadend=Te:K.onreadystatechange=function(){K&&K.readyState===4&&(K.status!==0||K.responseURL&&K.responseURL.indexOf("file:")===0)&&setTimeout(Te)},K.onabort=function(){K&&(ee(P("Request aborted",$,"ECONNABORTED",K)),K=null)},K.onerror=function(){ee(P("Network Error",$,null,K)),K=null},K.ontimeout=function(){var ke="timeout of "+$.timeout+"ms exceeded";$.timeoutErrorMessage&&(ke=$.timeoutErrorMessage),ee(P(ke,$,$.transitional&&$.transitional.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",K)),K=null},b.isStandardBrowserEnv()){var je=($.withCredentials||R(Ae))&&$.xsrfCookieName?U.read($.xsrfCookieName):void 0;je&&(ue[$.xsrfHeaderName]=je)}"setRequestHeader"in K&&b.forEach(ue,function(ke,at){F===void 0&&at.toLowerCase()==="content-type"?delete ue[at]:K.setRequestHeader(at,ke)}),b.isUndefined($.withCredentials)||(K.withCredentials=!!$.withCredentials),ie&&ie!=="json"&&(K.responseType=$.responseType),typeof $.onDownloadProgress=="function"&&K.addEventListener("progress",$.onDownloadProgress),typeof $.onUploadProgress=="function"&&K.upload&&K.upload.addEventListener("progress",$.onUploadProgress),$.cancelToken&&$.cancelToken.promise.then(function(ke){K&&(K.abort(),ee(ke),K=null)}),F||(F=null),K.send(F)})}},function(Oe,A,o){Oe.exports=function(b,H,U,B,re){return b.config=H,U&&(b.code=U),b.request=B,b.response=re,b.isAxiosError=!0,b.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},b}},function(Oe,A,o){var b=o(36);function H(U){return encodeURIComponent(U).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}Oe.exports=function(U,B,re){if(!B)return U;var J;if(re)J=re(B);else if(b.isURLSearchParams(B))J=B.toString();else{var R=[];b.forEach(B,function($,L){$!=null&&(b.isArray($)?L+="[]":$=[$],b.forEach($,function(ee){b.isDate(ee)?ee=ee.toISOString():b.isObject(ee)&&(ee=JSON.stringify(ee)),R.push(H(L)+"="+H(ee))}))}),J=R.join("&")}if(J){var P=U.indexOf("#");P!==-1&&(U=U.slice(0,P)),U+=(U.indexOf("?")===-1?"?":"&")+J}return U}},function(Oe,A,o){Oe.exports=function(b,H){return function(){for(var U=new Array(arguments.length),B=0;B<U.length;B++)U[B]=arguments[B];return b.apply(H,U)}}},function(Oe,A,o){/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/var b=this&&this.__awaiter||function(P,$,L,ee){return new(L||(L=Promise))(function(F,ue){function ie(pe){try{he(ee.next(pe))}catch(Ae){ue(Ae)}}function K(pe){try{he(ee.throw(pe))}catch(Ae){ue(Ae)}}function he(pe){pe.done?F(pe.value):new L(function(Ae){Ae(pe.value)}).then(ie,K)}he((ee=ee.apply(P,$||[])).next())})},H=this&&this.__importDefault||function(P){return P&&P.__esModule?P:{default:P}};Object.defineProperty(A,"__esModule",{value:!0});const U=H(o(88)),B=o(64),re=o(111),J=o(46);A.linechart=function(P,$,L={}){return b(this,void 0,void 0,function*(){const ee=Array.isArray($.values[0])?$.values:[$.values],F=ee[0].length,ue=$.series?$.series:ee.map((je,ke)=>`Series ${ke+1}`);re.assert(ue.length===ee.length,"Must have an equal number of series labels as there are data series"),L.seriesColors!=null&&re.assert(L.seriesColors.length===ee.length,"Must have an equal number of series colors as there are data series");const ie=[];for(let je=0;je<F;je++){const ke={x:je};ue.forEach((at,St)=>{const zt=ee[St][je].y;ke[at]=zt,ke[`${at}-name`]=at}),ie.push(ke)}const K=Object.assign({},R,L),he={x:{field:"x",type:K.xType,title:K.xLabel},tooltip:[{field:"x",type:"quantitative"},...ue.map(je=>({field:je,type:"quantitative"}))]},pe=ue.map(je=>({data:void 0,mark:{type:"line",clip:!0},encoding:{y:{field:je,type:K.yType,title:K.yLabel,scale:K.zoomToFit?{zero:!1}:K.yAxisDomain!=null?{domain:K.yAxisDomain}:void 0},color:{field:`${je}-name`,type:"nominal",legend:{values:ue,title:null},scale:{range:K.seriesColors}}}})),Ae=J.getDrawArea(P),Te={width:K.width||B.getDefaultWidth(Ae),height:K.height||B.getDefaultHeight(Ae),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:K.fontSize,titleFontSize:K.fontSize},text:{fontSize:K.fontSize},legend:{labelFontSize:K.fontSize,titleFontSize:K.fontSize}},data:{values:ie},encoding:he,layer:[...pe,{mark:"rule",selection:{hover:{type:"single",on:"mouseover",nearest:!0,clear:"mouseout"}},encoding:{color:{value:"grey",condition:{selection:{not:"hover"},value:"transparent"}}}}]};return yield U.default(Ae,Te,{actions:!1,mode:"vega-lite",defaultStyle:!1}),Promise.resolve()})};const R={xLabel:"x",yLabel:"y",xType:"quantitative",yType:"quantitative",zoomToFit:!1,fontSize:11}},function(Oe,A,o){/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});const b=o(292);let H;const U="Visor",B="tfjs-visor-container";A.visor=function(){if(typeof document>"u")throw new Error("No document defined. This library needs a browser/dom to work");if(document.getElementById(B)&&H!=null)return H;let J,R=document.getElementById(B);function P(ee,F){let ue=null;return J=b.VisorComponent.render(ee,J,{ref:ie=>ue=ie,surfaceList:Array.from(F.values())}),ue}R==null&&((R=document.createElement("div")).id=B,document.body.appendChild(R));const $=new Map,L=P(R,$);return H=new re(L,R,$,P)};class re{constructor(R,P,$,L){this.visorComponent=R,this.el=P,this.surfaceList=$,this.renderVisor=L}surface(R){const{name:P}=R,$=R.tab==null?U:R.tab;if(P==null||!(typeof P=="string"||P instanceof String))throw new Error("You must pass a config object with a 'name' property to create or retrieve a surface");const L=Object.assign({},R,{tab:$}),ee=`${P}-${$}`;return this.surfaceList.has(ee)||this.surfaceList.set(ee,L),this.renderVisor(this.el,this.surfaceList),this.visorComponent.getSurface(P,$)}isFullscreen(){return this.visorComponent.isFullscreen()}isOpen(){return this.visorComponent.isOpen()}close(){return this.visorComponent.close()}open(){return this.visorComponent.open()}toggle(){return this.visorComponent.toggle()}toggleFullScreen(){return this.visorComponent.toggleFullScreen()}bindKeys(){return this.visorComponent.bindKeys()}unbindKeys(){return this.visorComponent.unbindKeys()}setActiveTab(R){if(!this.visorComponent.state.tabs.has(R))throw new Error(`Tab '${R}' does not exist`);this.visorComponent.setState({activeTab:R})}}A.Visor=re},function(Oe,A,o){Object.defineProperty(A,"__esModule",{value:!0}),A.isSurfaceInfo=function(b){return b.name!=null},A.isSurface=function(b){return b.drawArea instanceof HTMLElement}},function(Oe,A,o){Object.defineProperty(A,"__esModule",{value:!0}),A.default=function(b){return b.charAt(0).toUpperCase()+b.slice(1)},Oe.exports=A.default},function(Oe,A,o){var b=o(315);Oe.exports=b},function(Oe,A,o){Object.defineProperty(A,"__esModule",{value:!0}),A.processStyleName=void 0,A.createMarkupForStyles=function(J,R){var P="";for(var $ in J){var L=$.indexOf("--")===0;if(J.hasOwnProperty($)&&$!=="label"){var ee=J[$];ee!=null&&(L?P+=$+":"+ee+";":(P+=re($)+":",P+=(0,b.default)($,ee,R)+";"))}}return P||null},B(o(319));var b=B(o(317)),H=B(o(314)),U=B(o(312));B(o(200));function B(J){return J&&J.__esModule?J:{default:J}}var re=A.processStyleName=(0,U.default)(H.default)},function(Oe,A,o){o.r(A),o.d(A,"default",function(){return B}),o.d(A,"point",function(){return re});var b=o(null),H=o(null),U=o(null);function B(){var J,R,P=Object(U.a)().unknown(void 0),$=P.domain,L=P.range,ee=0,F=1,ue=!1,ie=0,K=0,he=.5;function pe(){var Ae=$().length,Te=F<ee,je=Te?F:ee,ke=Te?ee:F;J=(ke-je)/Math.max(1,Ae-ie+2*K),ue&&(J=Math.floor(J)),je+=(ke-je-J*(Ae-ie))*he,R=J*(1-ie),ue&&(je=Math.round(je),R=Math.round(R));var at=Object(b.a)(Ae).map(function(St){return je+J*St});return L(Te?at.reverse():at)}return delete P.unknown,P.domain=function(Ae){return arguments.length?($(Ae),pe()):$()},P.range=function(Ae){return arguments.length?([ee,F]=Ae,ee=+ee,F=+F,pe()):[ee,F]},P.rangeRound=function(Ae){return[ee,F]=Ae,ee=+ee,F=+F,ue=!0,pe()},P.bandwidth=function(){return R},P.step=function(){return J},P.round=function(Ae){return arguments.length?(ue=!!Ae,pe()):ue},P.padding=function(Ae){return arguments.length?(ie=Math.min(1,K=+Ae),pe()):ie},P.paddingInner=function(Ae){return arguments.length?(ie=Math.min(1,Ae),pe()):ie},P.paddingOuter=function(Ae){return arguments.length?(K=+Ae,pe()):K},P.align=function(Ae){return arguments.length?(he=Math.max(0,Math.min(1,Ae)),pe()):he},P.copy=function(){return B($(),[ee,F]).round(ue).paddingInner(ie).paddingOuter(K).align(he)},H.a.apply(pe(),arguments)}function re(){return function J(R){var P=R.copy;return R.padding=R.paddingOuter,delete R.paddingInner,delete R.paddingOuter,R.copy=function(){return J(P())},R}(B.apply(null,arguments).paddingInner(1))}},function(Oe,A,o){const b=o(145),H=o(204),U=o(114),B=o(142),re=o(143),J=o(141);Oe.exports=(R,P,$,L)=>{switch(P){case"===":return typeof R=="object"&&(R=R.version),typeof $=="object"&&($=$.version),R===$;case"!==":return typeof R=="object"&&(R=R.version),typeof $=="object"&&($=$.version),R!==$;case"":case"=":case"==":return b(R,$,L);case"!=":return H(R,$,L);case">":return U(R,$,L);case">=":return B(R,$,L);case"<":return re(R,$,L);case"<=":return J(R,$,L);default:throw new TypeError(`Invalid operator: ${P}`)}}},function(Oe,A,o){const b=o(48);Oe.exports=(H,U,B)=>b(H,U,B)!==0},function(Oe,A,o){/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});var b=o(25),H=o(73),U=o(74),B=o(29),re=o(374),J=o(28);A.div=J.op({div_:function(R,P){var $,L=B.convertToTensor(R,"a","div"),ee=B.convertToTensor(P,"b","div");if($=U.makeTypesMatch(L,ee),L=$[0],ee=$[1],L.dtype==="int32"&&ee.dtype==="int32")return re.floorDiv(L,ee);var F={a:L,b:ee};return b.ENGINE.runKernelFunc(function(ue,ie){var K=ue.realDivide(L,ee);return ie([L,ee]),K},F,null,H.Div,{})}})},function(Oe,A,o){Object.defineProperty(A,"__esModule",{value:!0});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var b=o(25),H=o(73),U=o(74),B=o(29),re=o(28);A.add=re.op({add_:function(J,R){var P,$=B.convertToTensor(J,"a","add"),L=B.convertToTensor(R,"b","add");P=U.makeTypesMatch($,L),$=P[0],L=P[1];var ee={a:$,b:L};return b.ENGINE.runKernelFunc(function(F,ue){var ie=F.add($,L);return ue([$,L]),ie},ee,null,H.Add)}})},function(Oe,A,o){(function(b){var H=b!==void 0&&b||typeof self<"u"&&self||window,U=Function.prototype.apply;function B(re,J){this._id=re,this._clearFn=J}A.setTimeout=function(){return new B(U.call(setTimeout,H,arguments),clearTimeout)},A.setInterval=function(){return new B(U.call(setInterval,H,arguments),clearInterval)},A.clearTimeout=A.clearInterval=function(re){re&&re.close()},B.prototype.unref=B.prototype.ref=function(){},B.prototype.close=function(){this._clearFn.call(H,this._id)},A.enroll=function(re,J){clearTimeout(re._idleTimeoutId),re._idleTimeout=J},A.unenroll=function(re){clearTimeout(re._idleTimeoutId),re._idleTimeout=-1},A._unrefActive=A.active=function(re){clearTimeout(re._idleTimeoutId);var J=re._idleTimeout;J>=0&&(re._idleTimeoutId=setTimeout(function(){re._onTimeout&&re._onTimeout()},J))},o(391),A.setImmediate=typeof self<"u"&&self.setImmediate||b!==void 0&&b.setImmediate||this&&this.setImmediate,A.clearImmediate=typeof self<"u"&&self.clearImmediate||b!==void 0&&b.clearImmediate||this&&this.clearImmediate}).call(this,o(59))},function(Oe,A){Oe.exports=function(o){try{return!!o()}catch{return!0}}},function(Oe,A){var o=Oe.exports={version:"2.6.12"};typeof __e=="number"&&(__e=o)},function(Oe,A,o){var b=o(27),H=o(82),U=o(41),B=o(106).f;Oe.exports=function(re){return function(J){for(var R,P=U(J),$=H(P),L=$.length,ee=0,F=[];L>ee;)R=$[ee++],b&&!B.call(P,R)||F.push(re?[R,P[R]]:P[R]);return F}}},function(Oe,A,o){var b=o(22),H=o(167),U=o(61);Oe.exports=function(B,re,J,R){var P=String(U(B)),$=P.length,L=J===void 0?" ":String(J),ee=b(re);if(ee<=$||L=="")return P;var F=ee-$,ue=H.call(L,Math.ceil(F/L.length));return ue.length>F&&(ue=ue.slice(0,F)),R?ue+P:P+ue}},function(Oe,A,o){var b=o(79),H=o(127),U=o(14),B=o(16).Reflect;Oe.exports=B&&B.ownKeys||function(re){var J=b.f(U(re)),R=H.f;return R?J.concat(R(re)):J}},function(Oe,A,o){var b=o(54),H=o(22);Oe.exports=function(U){if(U===void 0)return 0;var B=b(U),re=H(B);if(B!==re)throw RangeError("Wrong length!");return re}},function(Oe,A,o){var b=o(93),H=o(65).getWeak,U=o(14),B=o(13),re=o(94),J=o(121),R=o(51),P=o(43),$=o(76),L=R(5),ee=R(6),F=0,ue=function(he){return he._l||(he._l=new ie)},ie=function(){this.a=[]},K=function(he,pe){return L(he.a,function(Ae){return Ae[0]===pe})};ie.prototype={get:function(he){var pe=K(this,he);if(pe)return pe[1]},has:function(he){return!!K(this,he)},set:function(he,pe){var Ae=K(this,he);Ae?Ae[1]=pe:this.a.push([he,pe])},delete:function(he){var pe=ee(this.a,function(Ae){return Ae[0]===he});return~pe&&this.a.splice(pe,1),!!~pe}},Oe.exports={getConstructor:function(he,pe,Ae,Te){var je=he(function(ke,at){re(ke,je,pe,"_i"),ke._t=pe,ke._i=F++,ke._l=void 0,at!=null&&J(at,Ae,ke[Te],ke)});return b(je.prototype,{delete:function(ke){if(!B(ke))return!1;var at=H(ke);return at===!0?ue($(this,pe)).delete(ke):at&&P(at,this._i)&&delete at[this._i]},has:function(ke){if(!B(ke))return!1;var at=H(ke);return at===!0?ue($(this,pe)).has(ke):at&&P(at,this._i)}}),je},def:function(he,pe,Ae){var Te=H(U(pe),!0);return Te===!0?ue(he).set(pe,Ae):Te[he._i]=Ae,he},ufstore:ue}},function(Oe,A,o){var b=o(26).f,H=o(80),U=o(93),B=o(56),re=o(94),J=o(121),R=o(163),P=o(221),$=o(95),L=o(27),ee=o(65).fastKey,F=o(76),ue=L?"_s":"size",ie=function(K,he){var pe,Ae=ee(he);if(Ae!=="F")return K._i[Ae];for(pe=K._f;pe;pe=pe.n)if(pe.k==he)return pe};Oe.exports={getConstructor:function(K,he,pe,Ae){var Te=K(function(je,ke){re(je,Te,he,"_i"),je._t=he,je._i=H(null),je._f=void 0,je._l=void 0,je[ue]=0,ke!=null&&J(ke,pe,je[Ae],je)});return U(Te.prototype,{clear:function(){for(var je=F(this,he),ke=je._i,at=je._f;at;at=at.n)at.r=!0,at.p&&(at.p=at.p.n=void 0),delete ke[at.i];je._f=je._l=void 0,je[ue]=0},delete:function(je){var ke=F(this,he),at=ie(ke,je);if(at){var St=at.n,zt=at.p;delete ke._i[at.i],at.r=!0,zt&&(zt.n=St),St&&(St.p=zt),ke._f==at&&(ke._f=St),ke._l==at&&(ke._l=zt),ke[ue]--}return!!at},forEach:function(je){F(this,he);for(var ke,at=B(je,arguments.length>1?arguments[1]:void 0,3);ke=ke?ke.n:this._f;)for(at(ke.v,ke.k,this);ke&&ke.r;)ke=ke.p},has:function(je){return!!ie(F(this,he),je)}}),L&&b(Te.prototype,"size",{get:function(){return F(this,he)[ue]}}),Te},def:function(K,he,pe){var Ae,Te,je=ie(K,he);return je?je.v=pe:(K._l=je={i:Te=ee(he,!0),k:he,v:pe,p:Ae=K._l,n:void 0,r:!1},K._f||(K._f=je),Ae&&(Ae.n=je),K[ue]++,Te!=="F"&&(K._i[Te]=je)),K},getEntry:ie,setStrong:function(K,he,pe){R(K,he,function(Ae,Te){this._t=F(Ae,he),this._k=Te,this._l=void 0},function(){for(var Ae=this._k,Te=this._l;Te&&Te.r;)Te=Te.p;return this._t&&(this._l=Te=Te?Te.n:this._t._f)?P(0,Ae=="keys"?Te.k:Ae=="values"?Te.v:[Te.k,Te.v]):(this._t=void 0,P(1))},pe?"entries":"values",!pe,!0),$(he)}}},function(Oe,A,o){var b=o(14),H=o(13),U=o(217);Oe.exports=function(B,re){if(b(B),H(re)&&re.constructor===B)return re;var J=U.f(B);return(0,J.resolve)(re),J.promise}},function(Oe,A,o){var b=o(55);Oe.exports.f=function(H){return new function(U){var B,re;this.promise=new U(function(J,R){if(B!==void 0||re!==void 0)throw TypeError("Bad Promise constructor");B=J,re=R}),this.resolve=b(B),this.reject=b(re)}(H)}},function(Oe,A,o){var b,H,U,B,re=o(83),J=o(16),R=o(56),P=o(105),$=o(8),L=o(13),ee=o(55),F=o(94),ue=o(121),ie=o(104),K=o(152).set,he=o(466)(),pe=o(217),Ae=o(465),Te=o(120),je=o(216),ke=J.TypeError,at=J.process,St=at&&at.versions,zt=St&&St.v8||"",$t=J.Promise,we=P(at)=="process",Tt=function(){},Gt=H=pe.f,Pt=!!function(){try{var _t=$t.resolve(1),xn=(_t.constructor={})[o(19)("species")]=function(In){In(Tt,Tt)};return(we||typeof PromiseRejectionEvent=="function")&&_t.then(Tt)instanceof xn&&zt.indexOf("6.6")!==0&&Te.indexOf("Chrome/66")===-1}catch{}}(),Ye=function(_t){var xn;return!(!L(_t)||typeof(xn=_t.then)!="function")&&xn},ln=function(_t,xn){if(!_t._n){_t._n=!0;var In=_t._c;he(function(){for(var Yn=_t._v,fn=_t._s==1,We=0,Pe=function(rt){var Et,Lt,rn,Sn=fn?rt.ok:rt.fail,kn=rt.resolve,qn=rt.reject,xe=rt.domain;try{Sn?(fn||(_t._h==2&&Mt(_t),_t._h=1),Sn===!0?Et=Yn:(xe&&xe.enter(),Et=Sn(Yn),xe&&(xe.exit(),rn=!0)),Et===rt.promise?qn(ke("Promise-chain cycle")):(Lt=Ye(Et))?Lt.call(Et,kn,qn):kn(Et)):qn(Yn)}catch(Xn){xe&&!rn&&xe.exit(),qn(Xn)}};In.length>We;)Pe(In[We++]);_t._c=[],_t._n=!1,xn&&!_t._h&&Zt(_t)})}},Zt=function(_t){K.call(J,function(){var xn,In,Yn,fn=_t._v,We=Bt(_t);if(We&&(xn=Ae(function(){we?at.emit("unhandledRejection",fn,_t):(In=J.onunhandledrejection)?In({promise:_t,reason:fn}):(Yn=J.console)&&Yn.error&&Yn.error("Unhandled promise rejection",fn)}),_t._h=we||Bt(_t)?2:1),_t._a=void 0,We&&xn.e)throw xn.v})},Bt=function(_t){return _t._h!==1&&(_t._a||_t._c).length===0},Mt=function(_t){K.call(J,function(){var xn;we?at.emit("rejectionHandled",_t):(xn=J.onrejectionhandled)&&xn({promise:_t,reason:_t._v})})},bn=function(_t){var xn=this;xn._d||(xn._d=!0,(xn=xn._w||xn)._v=_t,xn._s=2,xn._a||(xn._a=xn._c.slice()),ln(xn,!0))},Dt=function(_t){var xn,In=this;if(!In._d){In._d=!0,In=In._w||In;try{if(In===_t)throw ke("Promise can't be resolved itself");(xn=Ye(_t))?he(function(){var Yn={_w:In,_d:!1};try{xn.call(_t,R(Dt,Yn,1),R(bn,Yn,1))}catch(fn){bn.call(Yn,fn)}}):(In._v=_t,In._s=1,ln(In,!1))}catch(Yn){bn.call({_w:In,_d:!1},Yn)}}};Pt||($t=function(_t){F(this,$t,"Promise","_h"),ee(_t),b.call(this);try{_t(R(Dt,this,1),R(bn,this,1))}catch(xn){bn.call(this,xn)}},(b=function(_t){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=o(93)($t.prototype,{then:function(_t,xn){var In=Gt(ie(this,$t));return In.ok=typeof _t!="function"||_t,In.fail=typeof xn=="function"&&xn,In.domain=we?at.domain:void 0,this._c.push(In),this._a&&this._a.push(In),this._s&&ln(this,!1),In.promise},catch:function(_t){return this.then(void 0,_t)}}),U=function(){var _t=new b;this.promise=_t,this.resolve=R(Dt,_t,1),this.reject=R(bn,_t,1)},pe.f=Gt=function(_t){return _t===$t||_t===B?new U(_t):H(_t)}),$($.G+$.W+$.F*!Pt,{Promise:$t}),o(98)($t,"Promise"),o(95)("Promise"),B=o(24).Promise,$($.S+$.F*!Pt,"Promise",{reject:function(_t){var xn=Gt(this);return(0,xn.reject)(_t),xn.promise}}),$($.S+$.F*(re||!Pt),"Promise",{resolve:function(_t){return je(re&&this===B?$t:this,_t)}}),$($.S+$.F*!(Pt&&o(125)(function(_t){$t.all(_t).catch(Tt)})),"Promise",{all:function(_t){var xn=this,In=Gt(xn),Yn=In.resolve,fn=In.reject,We=Ae(function(){var Pe=[],rt=0,Et=1;ue(_t,!1,function(Lt){var rn=rt++,Sn=!1;Pe.push(void 0),Et++,xn.resolve(Lt).then(function(kn){Sn||(Sn=!0,Pe[rn]=kn,--Et||Yn(Pe))},fn)}),--Et||Yn(Pe)});return We.e&&fn(We.v),In.promise},race:function(_t){var xn=this,In=Gt(xn),Yn=In.reject,fn=Ae(function(){ue(_t,!1,function(We){xn.resolve(We).then(In.resolve,Yn)})});return fn.e&&Yn(fn.v),In.promise}})},function(Oe,A,o){o(27)&&/./g.flags!="g"&&o(26).f(RegExp.prototype,"flags",{configurable:!0,get:o(124)})},function(Oe,A,o){var b=o(154);o(8)({target:"RegExp",proto:!0,forced:b!==/./.exec},{exec:b})},function(Oe,A){Oe.exports=function(o,b){return{value:b,done:!!o}}},function(Oe,A,o){var b=o(34),H=o(81),U=o(22);Oe.exports=[].copyWithin||function(B,re){var J=b(this),R=U(J.length),P=H(B,R),$=H(re,R),L=arguments.length>2?arguments[2]:void 0,ee=Math.min((L===void 0?R:H(L,R))-$,R-P),F=1;for($<P&&P<$+ee&&(F=-1,$+=ee-1,P+=ee-1);ee-- >0;)$ in J?J[P]=J[$]:delete J[P],P+=F,$+=F;return J}},function(Oe,A,o){var b=o(55),H=o(34),U=o(107),B=o(22);Oe.exports=function(re,J,R,P,$){b(J);var L=H(re),ee=U(L),F=B(L.length),ue=$?F-1:0,ie=$?-1:1;if(R<2)for(;;){if(ue in ee){P=ee[ue],ue+=ie;break}if(ue+=ie,$?ue<0:F<=ue)throw TypeError("Reduce of empty array with no initial value")}for(;$?ue>=0:F>ue;ue+=ie)ue in ee&&(P=J(P,ee[ue],ue,L));return P}},function(Oe,A,o){var b=o(486);Oe.exports=function(H,U){return new(b(H))(U)}},function(Oe,A,o){var b=o(14);Oe.exports=function(H,U,B,re){try{return re?U(b(B)[0],B[1]):U(B)}catch(R){var J=H.return;throw J!==void 0&&b(J.call(H)),R}}},function(Oe,A,o){var b=o(80),H=o(85),U=o(98),B={};o(42)(B,o(19)("iterator"),function(){return this}),Oe.exports=function(re,J,R){re.prototype=b(B,{next:H(1,R)}),U(re,J+" Iterator")}},function(Oe,A){Oe.exports=Math.log1p||function(o){return(o=+o)>-1e-8&&o<1e-8?o-o*o/2:Math.log(1+o)}},function(Oe,A,o){var b=o(13),H=Math.floor;Oe.exports=function(U){return!b(U)&&isFinite(U)&&H(U)===U}},function(Oe,A,o){var b=o(62);Oe.exports=function(H,U){if(typeof H!="number"&&b(H)!="Number")throw TypeError(U);return+H}},function(Oe,A,o){var b=o(16).parseFloat,H=o(97).trim;Oe.exports=1/b(o(169)+"-0")!=-1/0?function(U){var B=H(String(U),3),re=b(B);return re===0&&B.charAt(0)=="-"?-0:re}:b},function(Oe,A,o){var b=o(16).parseInt,H=o(97).trim,U=o(169),B=/^[-+]?0[xX]/;Oe.exports=b(U+"08")!==8||b(U+"0x16")!==22?function(re,J){var R=H(String(re),3);return b(R,J>>>0||(B.test(R)?16:10))}:b},function(Oe,A){Oe.exports=function(o,b,H){var U=H===void 0;switch(b.length){case 0:return U?o():o.call(H);case 1:return U?o(b[0]):o.call(H,b[0]);case 2:return U?o(b[0],b[1]):o.call(H,b[0],b[1]);case 3:return U?o(b[0],b[1],b[2]):o.call(H,b[0],b[1],b[2]);case 4:return U?o(b[0],b[1],b[2],b[3]):o.call(H,b[0],b[1],b[2],b[3])}return o.apply(H,b)}},function(Oe,A,o){var b=o(55),H=o(13),U=o(232),B=[].slice,re={};Oe.exports=Function.bind||function(J){var R=b(this),P=B.call(arguments,1),$=function(){var L=P.concat(B.call(arguments));return this instanceof $?function(ee,F,ue){if(!(F in re)){for(var ie=[],K=0;K<F;K++)ie[K]="a["+K+"]";re[F]=Function("F,a","return new F("+ie.join(",")+")")}return re[F](ee,ue)}(R,L.length,L):U(R,L,J)};return H(R.prototype)&&($.prototype=R.prototype),$}},function(Oe,A){Oe.exports=Object.is||function(o,b){return o===b?o!==0||1/o==1/b:o!=o&&b!=b}},function(Oe,A,o){var b=o(27),H=o(82),U=o(127),B=o(106),re=o(34),J=o(107),R=Object.assign;Oe.exports=!R||o(15)(function(){var P={},$={},L=Symbol(),ee="abcdefghijklmnopqrst";return P[L]=7,ee.split("").forEach(function(F){$[F]=F}),R({},P)[L]!=7||Object.keys(R({},$)).join("")!=ee})?function(P,$){for(var L=re(P),ee=arguments.length,F=1,ue=U.f,ie=B.f;ee>F;)for(var K,he=J(arguments[F++]),pe=ue?H(he).concat(ue(he)):H(he),Ae=pe.length,Te=0;Ae>Te;)K=pe[Te++],b&&!ie.call(he,K)||(L[K]=he[K]);return L}:R},function(Oe,A,o){var b=o(41),H=o(79).f,U={}.toString,B=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];Oe.exports.f=function(re){return B&&U.call(re)=="[object Window]"?function(J){try{return H(J)}catch{return B.slice()}}(re):H(b(re))}},function(Oe,A,o){var b=o(26),H=o(14),U=o(82);Oe.exports=o(27)?Object.defineProperties:function(B,re){H(B);for(var J,R=U(re),P=R.length,$=0;P>$;)b.f(B,J=R[$++],re[J]);return B}},function(Oe,A,o){var b=o(43),H=o(41),U=o(128)(!1),B=o(173)("IE_PROTO");Oe.exports=function(re,J){var R,P=H(re),$=0,L=[];for(R in P)R!=B&&b(P,R)&&L.push(R);for(;J.length>$;)b(P,R=J[$++])&&(~U(L,R)||L.push(R));return L}},function(Oe,A,o){var b=o(16),H=o(24),U=o(83),B=o(174),re=o(26).f;Oe.exports=function(J){var R=H.Symbol||(H.Symbol=U?{}:b.Symbol||{});J.charAt(0)=="_"||J in R||re(R,J,{value:B.f(J)})}},function(Oe,A,o){Oe.exports=!o(27)&&!o(15)(function(){return Object.defineProperty(o(175)("div"),"a",{get:function(){return 7}}).a!=7})},function(Oe,A,o){Object.defineProperty(A,"__esModule",{value:!0});var b=o(2);A.tf=b,function(H){for(var U in H)A.hasOwnProperty(U)||(A[U]=H[U])}(o(257))},function(Oe,A,o){/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(function(b,H,U){const B={1:{name:"/m/01g317",id:1,displayName:"person"},2:{name:"/m/0199g",id:2,displayName:"bicycle"},3:{name:"/m/0k4j",id:3,displayName:"car"},4:{name:"/m/04_sv",id:4,displayName:"motorcycle"},5:{name:"/m/05czz6l",id:5,displayName:"airplane"},6:{name:"/m/01bjv",id:6,displayName:"bus"},7:{name:"/m/07jdr",id:7,displayName:"train"},8:{name:"/m/07r04",id:8,displayName:"truck"},9:{name:"/m/019jd",id:9,displayName:"boat"},10:{name:"/m/015qff",id:10,displayName:"traffic light"},11:{name:"/m/01pns0",id:11,displayName:"fire hydrant"},13:{name:"/m/02pv19",id:13,displayName:"stop sign"},14:{name:"/m/015qbp",id:14,displayName:"parking meter"},15:{name:"/m/0cvnqh",id:15,displayName:"bench"},16:{name:"/m/015p6",id:16,displayName:"bird"},17:{name:"/m/01yrx",id:17,displayName:"cat"},18:{name:"/m/0bt9lr",id:18,displayName:"dog"},19:{name:"/m/03k3r",id:19,displayName:"horse"},20:{name:"/m/07bgp",id:20,displayName:"sheep"},21:{name:"/m/01xq0k1",id:21,displayName:"cow"},22:{name:"/m/0bwd_0j",id:22,displayName:"elephant"},23:{name:"/m/01dws",id:23,displayName:"bear"},24:{name:"/m/0898b",id:24,displayName:"zebra"},25:{name:"/m/03bk1",id:25,displayName:"giraffe"},27:{name:"/m/01940j",id:27,displayName:"backpack"},28:{name:"/m/0hnnb",id:28,displayName:"umbrella"},31:{name:"/m/080hkjn",id:31,displayName:"handbag"},32:{name:"/m/01rkbr",id:32,displayName:"tie"},33:{name:"/m/01s55n",id:33,displayName:"suitcase"},34:{name:"/m/02wmf",id:34,displayName:"frisbee"},35:{name:"/m/071p9",id:35,displayName:"skis"},36:{name:"/m/06__v",id:36,displayName:"snowboard"},37:{name:"/m/018xm",id:37,displayName:"sports ball"},38:{name:"/m/02zt3",id:38,displayName:"kite"},39:{name:"/m/03g8mr",id:39,displayName:"baseball bat"},40:{name:"/m/03grzl",id:40,displayName:"baseball glove"},41:{name:"/m/06_fw",id:41,displayName:"skateboard"},42:{name:"/m/019w40",id:42,displayName:"surfboard"},43:{name:"/m/0dv9c",id:43,displayName:"tennis racket"},44:{name:"/m/04dr76w",id:44,displayName:"bottle"},46:{name:"/m/09tvcd",id:46,displayName:"wine glass"},47:{name:"/m/08gqpm",id:47,displayName:"cup"},48:{name:"/m/0dt3t",id:48,displayName:"fork"},49:{name:"/m/04ctx",id:49,displayName:"knife"},50:{name:"/m/0cmx8",id:50,displayName:"spoon"},51:{name:"/m/04kkgm",id:51,displayName:"bowl"},52:{name:"/m/09qck",id:52,displayName:"banana"},53:{name:"/m/014j1m",id:53,displayName:"apple"},54:{name:"/m/0l515",id:54,displayName:"sandwich"},55:{name:"/m/0cyhj_",id:55,displayName:"orange"},56:{name:"/m/0hkxq",id:56,displayName:"broccoli"},57:{name:"/m/0fj52s",id:57,displayName:"carrot"},58:{name:"/m/01b9xk",id:58,displayName:"hot dog"},59:{name:"/m/0663v",id:59,displayName:"pizza"},60:{name:"/m/0jy4k",id:60,displayName:"donut"},61:{name:"/m/0fszt",id:61,displayName:"cake"},62:{name:"/m/01mzpv",id:62,displayName:"chair"},63:{name:"/m/02crq1",id:63,displayName:"couch"},64:{name:"/m/03fp41",id:64,displayName:"potted plant"},65:{name:"/m/03ssj5",id:65,displayName:"bed"},67:{name:"/m/04bcr3",id:67,displayName:"dining table"},70:{name:"/m/09g1w",id:70,displayName:"toilet"},72:{name:"/m/07c52",id:72,displayName:"tv"},73:{name:"/m/01c648",id:73,displayName:"laptop"},74:{name:"/m/020lf",id:74,displayName:"mouse"},75:{name:"/m/0qjjc",id:75,displayName:"remote"},76:{name:"/m/01m2v",id:76,displayName:"keyboard"},77:{name:"/m/050k8",id:77,displayName:"cell phone"},78:{name:"/m/0fx9l",id:78,displayName:"microwave"},79:{name:"/m/029bxz",id:79,displayName:"oven"},80:{name:"/m/01k6s3",id:80,displayName:"toaster"},81:{name:"/m/0130jx",id:81,displayName:"sink"},82:{name:"/m/040b_t",id:82,displayName:"refrigerator"},84:{name:"/m/0bt_c3",id:84,displayName:"book"},85:{name:"/m/01x3z",id:85,displayName:"clock"},86:{name:"/m/02s195",id:86,displayName:"vase"},87:{name:"/m/01lsmm",id:87,displayName:"scissors"},88:{name:"/m/0kmg4",id:88,displayName:"teddy bear"},89:{name:"/m/03wvsk",id:89,displayName:"hair drier"},90:{name:"/m/012xff",id:90,displayName:"toothbrush"}};class re{constructor(R,P){this.modelPath=P||`https://storage.googleapis.com/tfjs-models/savedmodel/${this.getPrefix(R)}/model.json`}getPrefix(R){return R==="lite_mobilenet_v2"?`ssd${R}`:`ssd_${R}`}async load(){this.model=await H.loadGraphModel(this.modelPath);const R=U.zeros([1,300,300,3],"int32"),P=await this.model.executeAsync(R);await Promise.all(P.map($=>$.data())),P.map($=>$.dispose()),R.dispose()}async infer(R,P,$){const L=U.tidy(()=>(R instanceof U.Tensor||(R=U.browser.fromPixels(R)),U.expandDims(R))),ee=L.shape[1],F=L.shape[2],ue=await this.model.executeAsync(L),ie=ue[0].dataSync(),K=ue[1].dataSync();L.dispose(),U.dispose(ue);const[he,pe]=this.calculateMaxScores(ie,ue[0].shape[1],ue[0].shape[2]),Ae=U.getBackend();U.getBackend()==="webgl"&&U.setBackend("cpu");const Te=U.tidy(()=>{const ke=U.tensor2d(K,[ue[1].shape[1],ue[1].shape[3]]);return U.image.nonMaxSuppression(ke,he,P,$,$)}),je=Te.dataSync();return Te.dispose(),Ae!==U.getBackend()&&U.setBackend(Ae),this.buildDetectedObjects(F,ee,K,he,je,pe)}buildDetectedObjects(R,P,$,L,ee,F){const ue=ee.length,ie=[];for(let K=0;K<ue;K++){const he=[];for(let ke=0;ke<4;ke++)he[ke]=$[4*ee[K]+ke];const pe=he[0]*P,Ae=he[1]*R,Te=he[2]*P,je=he[3]*R;he[0]=Ae,he[1]=pe,he[2]=je-Ae,he[3]=Te-pe,ie.push({bbox:he,class:B[F[ee[K]]+1].displayName,score:L[ee[K]]})}return ie}calculateMaxScores(R,P,$){const L=[],ee=[];for(let F=0;F<P;F++){let ue=Number.MIN_VALUE,ie=-1;for(let K=0;K<$;K++)R[F*$+K]>ue&&(ue=R[F*$+K],ie=K);L[F]=ue,ee[F]=ie}return[L,ee]}async detect(R,P=20,$=.5){return this.infer(R,P,$)}dispose(){this.model!=null&&this.model.dispose()}}b.ObjectDetection=re,b.load=async function(J={}){if(U==null)throw new Error("Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this model.");const R=J.base||"lite_mobilenet_v2",P=J.modelUrl;if(["mobilenet_v1","mobilenet_v2","lite_mobilenet_v2"].indexOf(R)===-1)throw new Error(`ObjectDetection constructed with invalid base model ${R}. Valid names are 'mobilenet_v1', 'mobilenet_v2' and 'lite_mobilenet_v2'.`);const $=new re(R,P);return await $.load(),$},b.version="2.2.2",Object.defineProperty(b,"__esModule",{value:!0})})(A,o(20),o(0))},function(Oe,A,o){Oe.exports=function b(H,U){if(H===U)return!0;if(H&&U&&typeof H=="object"&&typeof U=="object"){if(H.constructor!==U.constructor)return!1;var B,re,J;if(Array.isArray(H)){if((B=H.length)!=U.length)return!1;for(re=B;re--!=0;)if(!b(H[re],U[re]))return!1;return!0}if(H.constructor===RegExp)return H.source===U.source&&H.flags===U.flags;if(H.valueOf!==Object.prototype.valueOf)return H.valueOf()===U.valueOf();if(H.toString!==Object.prototype.toString)return H.toString()===U.toString();if((B=(J=Object.keys(H)).length)!==Object.keys(U).length)return!1;for(re=B;re--!=0;)if(!Object.prototype.hasOwnProperty.call(U,J[re]))return!1;for(re=B;re--!=0;){var R=J[re];if(!b(H[R],U[R]))return!1}return!0}return H!=H&&U!=U}},function(Oe,A,o){(function(b){var H=function(){function U(L,ee){return ee!=null&&L instanceof ee}var B,re,J;try{B=Map}catch{B=function(){}}try{re=Set}catch{re=function(){}}try{J=Promise}catch{J=function(){}}function R(L,ee,F,ue,ie){typeof ee=="object"&&(F=ee.depth,ue=ee.prototype,ie=ee.includeNonEnumerable,ee=ee.circular);var K=[],he=[],pe=b!==void 0;return ee===void 0&&(ee=!0),F===void 0&&(F=1/0),function Ae(Te,je){if(Te===null)return null;if(je===0)return Te;var ke,at;if(typeof Te!="object")return Te;if(U(Te,B))ke=new B;else if(U(Te,re))ke=new re;else if(U(Te,J))ke=new J(function(ln,Zt){Te.then(function(Bt){ln(Ae(Bt,je-1))},function(Bt){Zt(Ae(Bt,je-1))})});else if(R.__isArray(Te))ke=[];else if(R.__isRegExp(Te))ke=new RegExp(Te.source,$(Te)),Te.lastIndex&&(ke.lastIndex=Te.lastIndex);else if(R.__isDate(Te))ke=new Date(Te.getTime());else{if(pe&&b.isBuffer(Te))return ke=b.allocUnsafe?b.allocUnsafe(Te.length):new b(Te.length),Te.copy(ke),ke;U(Te,Error)?ke=Object.create(Te):ue===void 0?(at=Object.getPrototypeOf(Te),ke=Object.create(at)):(ke=Object.create(ue),at=ue)}if(ee){var St=K.indexOf(Te);if(St!=-1)return he[St];K.push(Te),he.push(ke)}for(var zt in U(Te,B)&&Te.forEach(function(ln,Zt){var Bt=Ae(Zt,je-1),Mt=Ae(ln,je-1);ke.set(Bt,Mt)}),U(Te,re)&&Te.forEach(function(ln){var Zt=Ae(ln,je-1);ke.add(Zt)}),Te){var $t;at&&($t=Object.getOwnPropertyDescriptor(at,zt)),$t&&$t.set==null||(ke[zt]=Ae(Te[zt],je-1))}if(Object.getOwnPropertySymbols){var we=Object.getOwnPropertySymbols(Te);for(zt=0;zt<we.length;zt++){var Tt=we[zt];(!(Pt=Object.getOwnPropertyDescriptor(Te,Tt))||Pt.enumerable||ie)&&(ke[Tt]=Ae(Te[Tt],je-1),Pt.enumerable||Object.defineProperty(ke,Tt,{enumerable:!1}))}}if(ie){var Gt=Object.getOwnPropertyNames(Te);for(zt=0;zt<Gt.length;zt++){var Pt,Ye=Gt[zt];(Pt=Object.getOwnPropertyDescriptor(Te,Ye))&&Pt.enumerable||(ke[Ye]=Ae(Te[Ye],je-1),Object.defineProperty(ke,Ye,{enumerable:!1}))}}return ke}(L,F)}function P(L){return Object.prototype.toString.call(L)}function $(L){var ee="";return L.global&&(ee+="g"),L.ignoreCase&&(ee+="i"),L.multiline&&(ee+="m"),ee}return R.clonePrototype=function(L){if(L===null)return null;var ee=function(){};return ee.prototype=L,new ee},R.__objToStr=P,R.__isDate=function(L){return typeof L=="object"&&P(L)==="[object Date]"},R.__isArray=function(L){return typeof L=="object"&&P(L)==="[object Array]"},R.__isRegExp=function(L){return typeof L=="object"&&P(L)==="[object RegExp]"},R.__getRegExpFlags=$,R}();typeof Oe=="object"&&Oe.exports&&(Oe.exports=H)}).call(this,o(92).Buffer)},function(Oe){Oe.exports={name:"vega-lite",author:'Dominik Moritz, Kanit "Ham" Wongsuphasawat, Arvind Satyanarayan, Jeffrey Heer',version:"4.13.1",collaborators:["Kanit Wongsuphasawat (http://kanitw.yellowpigz.com)","Dominik Moritz (https://www.domoritz.de)","Arvind Satyanarayan (https://arvindsatya.com)","Jeffrey Heer (https://jheer.org)"],homepage:"https://vega.github.io/vega-lite/",description:"Vega-Lite is a concise high-level language for interactive visualization.",main:"build/vega-lite.js",unpkg:"build/vega-lite.min.js",jsdelivr:"build/vega-lite.min.js",module:"build/src/index",types:"build/src/index.d.ts",bin:{vl2png:"./bin/vl2png",vl2svg:"./bin/vl2svg",vl2pdf:"./bin/vl2pdf",vl2vg:"./bin/vl2vg"},directories:{test:"test"},scripts:{changelog:"conventional-changelog -p angular -r 2",build:"yarn build:only","build:only":"yarn tsc:src && rollup -c",postbuild:"terser build/vega-lite.js -cm --source-map content=build/vega-lite.js.map,filename=build/vega-lite.min.js.map -o build/vega-lite.min.js && yarn schema && babel build/vega-lite.js --out-dir build-es5 --config-file ./babel.config.js","prebuild:examples":"yarn build:only","build:examples":"yarn data && TZ=America/Los_Angeles scripts/build-examples.sh","prebuild:examples-full":"yarn build:only","build:examples-full":"TZ=America/Los_Angeles scripts/build-examples.sh 1","build:example":"TZ=America/Los_Angeles scripts/build-example.sh","build:toc":"yarn build:jekyll && scripts/generate-toc","build:site":"yarn tsc:site && rollup -c site/rollup.config.js","build:jekyll":"pushd site && bundle exec jekyll build -q && popd","build:versions":"scripts/update-version.sh",clean:"find build ! -name 'vega-lite-schema.json' -type f -delete && rm -rf site/data/* && rm -f examples/compiled/*.png && find site/examples ! -name 'index.md' ! -name 'data' -type f -delete","predeploy:site":"yarn presite","deploy:site":"gh-pages -d site",data:"rsync -r node_modules/vega-datasets/data/* site/data",schema:"mkdir -p build && ts-json-schema-generator -f tsconfig.json -p src/index.ts -t TopLevelSpec --no-type-check --no-ref-encode > build/vega-lite-schema.json && yarn renameschema && cp build/vega-lite-schema.json site/_data/",renameschema:"scripts/rename-schema.sh",presite:"yarn data && yarn schema && yarn build:site && yarn build:versions && scripts/create-example-pages.sh",site:"pushd site && bundle exec jekyll serve -I -l && popd","tsc:src":"tsc -b src/tsconfig.src.json","tsc:site":"tsc -b site/tsconfig.site.json",prettierbase:"prettier '**/*.{md,css,yml}'",eslintbase:"eslint .",format:"yarn eslintbase --fix && yarn prettierbase --write",lint:"yarn eslintbase && yarn prettierbase --check",test:"jest test/ && yarn lint && yarn schema && jest examples/ && yarn test:runtime","test:inspect":"node --inspect-brk ./node_modules/.bin/jest --runInBand test","test:runtime":"TZ=America/Los_Angeles jest test-runtime/","test:runtime:generate":"yarn build:only && rm -Rf test-runtime/resources && VL_GENERATE_TESTS=true yarn test:runtime","watch:build":"yarn build:only && concurrently --kill-others -n Typescript,Rollup 'yarn tsc:src -w' 'rollup -c -w'","watch:site":"concurrently --kill-others -n Typescript,Rollup 'yarn tsc:site -w' 'rollup -c site/rollup.config.js -w'","watch:test":"jest --watch"},repository:{type:"git",url:"https://github.com/vega/vega-lite.git"},license:"BSD-3-Clause",bugs:{url:"https://github.com/vega/vega-lite/issues"},devDependencies:{"@babel/cli":"^7.10.1","@babel/core":"^7.10.1","@babel/preset-env":"^7.10.1","@rollup/plugin-commonjs":"12.0.0","@rollup/plugin-json":"^4.0.3","@rollup/plugin-node-resolve":"^8.0.0","@types/chai":"^4.2.11","@types/d3":"^5.7.2","@types/jest":"^25.2.3","@types/mkdirp":"^1.0.0","@types/puppeteer":"^3.0.0","@typescript-eslint/eslint-plugin":"^3.0.2","@typescript-eslint/parser":"^3.0.2",ajv:"^6.12.2",chai:"^4.2.0",cheerio:"^1.0.0-rc.3",codecov:"^3.7.0",concurrently:"^5.2.0","conventional-changelog-cli":"^2.0.34",d3:"^5.16.0",eslint:"^7.1.0","eslint-config-prettier":"^6.11.0","eslint-plugin-jest":"^23.13.2","eslint-plugin-prettier":"^3.1.3","gh-pages":"^2.2.0","highlight.js":"^10.0.3","http-server":"^0.12.3",jest:"^26.0.1","jest-puppeteer":"^4.4.0",mkdirp:"^1.0.4",prettier:"^2.0.5",puppeteer:"^3.1.0",rollup:"^2.11.0","rollup-plugin-sourcemaps":"^0.6.2","rollup-plugin-terser":"^6.1.0","svg2png-many":"^0.0.7",terser:"^4.7.0","ts-jest":"^26.0.0","ts-json-schema-generator":"^0.68.1",typescript:"~3.9.3","vega-cli":"^5.12.1","vega-datasets":"^1.30.2","vega-embed":"^6.8.0","vega-tooltip":"^0.23.0","vega-typings":"^0.17.0","yaml-front-matter":"^4.1.0"},dependencies:{"@types/clone":"~0.1.30","@types/fast-json-stable-stringify":"^2.0.0","array-flat-polyfill":"^1.0.1",clone:"~2.1.2","fast-deep-equal":"~3.1.1","fast-json-stable-stringify":"~2.1.0","json-stringify-pretty-compact":"~2.0.0",tslib:"~2.0.0","vega-event-selector":"~2.0.3","vega-expression":"~2.6.5","vega-util":"~1.14.0",yargs:"~15.3.1"},peerDependencies:{vega:"^5.12.1"},jest:{preset:"jest-puppeteer",transform:{"^.+\\.tsx?$":"ts-jest"},testRegex:"(/__tests__/.*|(\\.|/)(test|spec))\\.(jsx?|tsx?)$",moduleFileExtensions:["ts","tsx","js","jsx","json","node"],testPathIgnorePatterns:["<rootDir>/node_modules","<rootDir>/build","<rootDir>/_site","<rootDir>/src"],coverageDirectory:"./coverage/",collectCoverage:!1}}},function(Oe,A,o){o.d(A,"a",function(){return L});var b=o(39),H=o(71),U=o(40),B=o(72),re=o(70),J=o(68);function R(Se){if(0<=Se.y&&Se.y<100){var Ze=new Date(-1,Se.m,Se.d,Se.H,Se.M,Se.S,Se.L);return Ze.setFullYear(Se.y),Ze}return new Date(Se.y,Se.m,Se.d,Se.H,Se.M,Se.S,Se.L)}function P(Se){if(0<=Se.y&&Se.y<100){var Ze=new Date(Date.UTC(-1,Se.m,Se.d,Se.H,Se.M,Se.S,Se.L));return Ze.setUTCFullYear(Se.y),Ze}return new Date(Date.UTC(Se.y,Se.m,Se.d,Se.H,Se.M,Se.S,Se.L))}function $(Se,Ze,mt){return{y:Se,m:Ze,d:mt,H:0,M:0,S:0,L:0}}function L(Se){var Ze=Se.dateTime,mt=Se.date,Rt=Se.time,cn=Se.periods,Jn=Se.days,An=Se.shortDays,Ln=Se.months,Hn=Se.shortMonths,It=pe(cn),Ot=Ae(cn),pn=pe(Jn),qt=Ae(Jn),Ve=pe(An),jn=Ae(An),$n=pe(Ln),Zn=Ae(Ln),ir=pe(Hn),zr=Ae(Hn),vr={a:function(qr){return An[qr.getDay()]},A:function(qr){return Jn[qr.getDay()]},b:function(qr){return Hn[qr.getMonth()]},B:function(qr){return Ln[qr.getMonth()]},c:null,d:In,e:In,f:rt,g:dr,G:hn,H:Yn,I:fn,j:We,L:Pe,m:Et,M:Lt,p:function(qr){return cn[+(qr.getHours()>=12)]},q:function(qr){return 1+~~(qr.getMonth()/3)},Q:fe,s:ye,S:rn,u:Sn,U:kn,V:xe,w:Xn,W:br,x:null,X:null,y:Cr,Y:Rr,Z:Xt,"%":ge},pi={a:function(qr){return An[qr.getUTCDay()]},A:function(qr){return Jn[qr.getUTCDay()]},b:function(qr){return Hn[qr.getUTCMonth()]},B:function(qr){return Ln[qr.getUTCMonth()]},c:null,d:nn,e:nn,f:gr,g:Ci,G:Lr,H:Gn,I:Dn,j:mr,L:xr,m:Qr,M:ni,p:function(qr){return cn[+(qr.getUTCHours()>=12)]},q:function(qr){return 1+~~(qr.getUTCMonth()/3)},Q:fe,s:ye,S:Mr,u:di,U:Yr,V:fi,w:ai,W:Oa,x:null,X:null,y:Wi,Y:yt,Z:jt,"%":ge},la={a:function(qr,jr,Bn){var ri=Ve.exec(jr.slice(Bn));return ri?(qr.w=jn.get(ri[0].toLowerCase()),Bn+ri[0].length):-1},A:function(qr,jr,Bn){var ri=pn.exec(jr.slice(Bn));return ri?(qr.w=qt.get(ri[0].toLowerCase()),Bn+ri[0].length):-1},b:function(qr,jr,Bn){var ri=ir.exec(jr.slice(Bn));return ri?(qr.m=zr.get(ri[0].toLowerCase()),Bn+ri[0].length):-1},B:function(qr,jr,Bn){var ri=$n.exec(jr.slice(Bn));return ri?(qr.m=Zn.get(ri[0].toLowerCase()),Bn+ri[0].length):-1},c:function(qr,jr,Bn){return Di(qr,Ze,jr,Bn)},d:Pt,e:Pt,f:bn,g:$t,G:zt,H:ln,I:ln,j:Ye,L:Mt,m:Gt,M:Zt,p:function(qr,jr,Bn){var ri=It.exec(jr.slice(Bn));return ri?(qr.p=Ot.get(ri[0].toLowerCase()),Bn+ri[0].length):-1},q:Tt,Q:_t,s:xn,S:Bt,u:je,U:ke,V:at,w:Te,W:St,x:function(qr,jr,Bn){return Di(qr,mt,jr,Bn)},X:function(qr,jr,Bn){return Di(qr,Rt,jr,Bn)},y:$t,Y:zt,Z:we,"%":Dt};function ui(qr,jr){return function(Bn){var ri,Vi,Fr,aa=[],ma=-1,Zi=0,ga=qr.length;for(Bn instanceof Date||(Bn=new Date(+Bn));++ma<ga;)qr.charCodeAt(ma)===37&&(aa.push(qr.slice(Zi,ma)),(Vi=ee[ri=qr.charAt(++ma)])!=null?ri=qr.charAt(++ma):Vi=ri==="e"?" ":"0",(Fr=jr[ri])&&(ri=Fr(Bn,Vi)),aa.push(ri),Zi=ma+1);return aa.push(qr.slice(Zi,ma)),aa.join("")}}function Qi(qr,jr){return function(Bn){var ri,Vi,Fr=$(1900,void 0,1);if(Di(Fr,qr,Bn+="",0)!=Bn.length)return null;if("Q"in Fr)return new Date(Fr.Q);if("s"in Fr)return new Date(1e3*Fr.s+("L"in Fr?Fr.L:0));if(!jr||"Z"in Fr||(Fr.Z=0),"p"in Fr&&(Fr.H=Fr.H%12+12*Fr.p),Fr.m===void 0&&(Fr.m="q"in Fr?Fr.q:0),"V"in Fr){if(Fr.V<1||Fr.V>53)return null;"w"in Fr||(Fr.w=1),"Z"in Fr?(ri=(Vi=(ri=P($(Fr.y,0,1))).getUTCDay())>4||Vi===0?b.a.ceil(ri):Object(b.a)(ri),ri=H.a.offset(ri,7*(Fr.V-1)),Fr.y=ri.getUTCFullYear(),Fr.m=ri.getUTCMonth(),Fr.d=ri.getUTCDate()+(Fr.w+6)%7):(ri=(Vi=(ri=R($(Fr.y,0,1))).getDay())>4||Vi===0?U.a.ceil(ri):Object(U.a)(ri),ri=B.a.offset(ri,7*(Fr.V-1)),Fr.y=ri.getFullYear(),Fr.m=ri.getMonth(),Fr.d=ri.getDate()+(Fr.w+6)%7)}else("W"in Fr||"U"in Fr)&&("w"in Fr||(Fr.w="u"in Fr?Fr.u%7:"W"in Fr?1:0),Vi="Z"in Fr?P($(Fr.y,0,1)).getUTCDay():R($(Fr.y,0,1)).getDay(),Fr.m=0,Fr.d="W"in Fr?(Fr.w+6)%7+7*Fr.W-(Vi+5)%7:Fr.w+7*Fr.U-(Vi+6)%7);return"Z"in Fr?(Fr.H+=Fr.Z/100|0,Fr.M+=Fr.Z%100,P(Fr)):R(Fr)}}function Di(qr,jr,Bn,ri){for(var Vi,Fr,aa=0,ma=jr.length,Zi=Bn.length;aa<ma;){if(ri>=Zi)return-1;if((Vi=jr.charCodeAt(aa++))===37){if(Vi=jr.charAt(aa++),!(Fr=la[Vi in ee?jr.charAt(aa++):Vi])||(ri=Fr(qr,Bn,ri))<0)return-1}else if(Vi!=Bn.charCodeAt(ri++))return-1}return ri}return vr.x=ui(mt,vr),vr.X=ui(Rt,vr),vr.c=ui(Ze,vr),pi.x=ui(mt,pi),pi.X=ui(Rt,pi),pi.c=ui(Ze,pi),{format:function(qr){var jr=ui(qr+="",vr);return jr.toString=function(){return qr},jr},parse:function(qr){var jr=Qi(qr+="",!1);return jr.toString=function(){return qr},jr},utcFormat:function(qr){var jr=ui(qr+="",pi);return jr.toString=function(){return qr},jr},utcParse:function(qr){var jr=Qi(qr+="",!0);return jr.toString=function(){return qr},jr}}}var ee={"-":"",_:" ",0:"0"},F=/^\s*\d+/,ue=/^%/,ie=/[\\^$*+?|[\]().{}]/g;function K(Se,Ze,mt){var Rt=Se<0?"-":"",cn=(Rt?-Se:Se)+"",Jn=cn.length;return Rt+(Jn<mt?new Array(mt-Jn+1).join(Ze)+cn:cn)}function he(Se){return Se.replace(ie,"\\$&")}function pe(Se){return new RegExp("^(?:"+Se.map(he).join("|")+")","i")}function Ae(Se){return new Map(Se.map((Ze,mt)=>[Ze.toLowerCase(),mt]))}function Te(Se,Ze,mt){var Rt=F.exec(Ze.slice(mt,mt+1));return Rt?(Se.w=+Rt[0],mt+Rt[0].length):-1}function je(Se,Ze,mt){var Rt=F.exec(Ze.slice(mt,mt+1));return Rt?(Se.u=+Rt[0],mt+Rt[0].length):-1}function ke(Se,Ze,mt){var Rt=F.exec(Ze.slice(mt,mt+2));return Rt?(Se.U=+Rt[0],mt+Rt[0].length):-1}function at(Se,Ze,mt){var Rt=F.exec(Ze.slice(mt,mt+2));return Rt?(Se.V=+Rt[0],mt+Rt[0].length):-1}function St(Se,Ze,mt){var Rt=F.exec(Ze.slice(mt,mt+2));return Rt?(Se.W=+Rt[0],mt+Rt[0].length):-1}function zt(Se,Ze,mt){var Rt=F.exec(Ze.slice(mt,mt+4));return Rt?(Se.y=+Rt[0],mt+Rt[0].length):-1}function $t(Se,Ze,mt){var Rt=F.exec(Ze.slice(mt,mt+2));return Rt?(Se.y=+Rt[0]+(+Rt[0]>68?1900:2e3),mt+Rt[0].length):-1}function we(Se,Ze,mt){var Rt=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(Ze.slice(mt,mt+6));return Rt?(Se.Z=Rt[1]?0:-(Rt[2]+(Rt[3]||"00")),mt+Rt[0].length):-1}function Tt(Se,Ze,mt){var Rt=F.exec(Ze.slice(mt,mt+1));return Rt?(Se.q=3*Rt[0]-3,mt+Rt[0].length):-1}function Gt(Se,Ze,mt){var Rt=F.exec(Ze.slice(mt,mt+2));return Rt?(Se.m=Rt[0]-1,mt+Rt[0].length):-1}function Pt(Se,Ze,mt){var Rt=F.exec(Ze.slice(mt,mt+2));return Rt?(Se.d=+Rt[0],mt+Rt[0].length):-1}function Ye(Se,Ze,mt){var Rt=F.exec(Ze.slice(mt,mt+3));return Rt?(Se.m=0,Se.d=+Rt[0],mt+Rt[0].length):-1}function ln(Se,Ze,mt){var Rt=F.exec(Ze.slice(mt,mt+2));return Rt?(Se.H=+Rt[0],mt+Rt[0].length):-1}function Zt(Se,Ze,mt){var Rt=F.exec(Ze.slice(mt,mt+2));return Rt?(Se.M=+Rt[0],mt+Rt[0].length):-1}function Bt(Se,Ze,mt){var Rt=F.exec(Ze.slice(mt,mt+2));return Rt?(Se.S=+Rt[0],mt+Rt[0].length):-1}function Mt(Se,Ze,mt){var Rt=F.exec(Ze.slice(mt,mt+3));return Rt?(Se.L=+Rt[0],mt+Rt[0].length):-1}function bn(Se,Ze,mt){var Rt=F.exec(Ze.slice(mt,mt+6));return Rt?(Se.L=Math.floor(Rt[0]/1e3),mt+Rt[0].length):-1}function Dt(Se,Ze,mt){var Rt=ue.exec(Ze.slice(mt,mt+1));return Rt?mt+Rt[0].length:-1}function _t(Se,Ze,mt){var Rt=F.exec(Ze.slice(mt));return Rt?(Se.Q=+Rt[0],mt+Rt[0].length):-1}function xn(Se,Ze,mt){var Rt=F.exec(Ze.slice(mt));return Rt?(Se.s=+Rt[0],mt+Rt[0].length):-1}function In(Se,Ze){return K(Se.getDate(),Ze,2)}function Yn(Se,Ze){return K(Se.getHours(),Ze,2)}function fn(Se,Ze){return K(Se.getHours()%12||12,Ze,2)}function We(Se,Ze){return K(1+B.a.count(Object(re.a)(Se),Se),Ze,3)}function Pe(Se,Ze){return K(Se.getMilliseconds(),Ze,3)}function rt(Se,Ze){return Pe(Se,Ze)+"000"}function Et(Se,Ze){return K(Se.getMonth()+1,Ze,2)}function Lt(Se,Ze){return K(Se.getMinutes(),Ze,2)}function rn(Se,Ze){return K(Se.getSeconds(),Ze,2)}function Sn(Se){var Ze=Se.getDay();return Ze===0?7:Ze}function kn(Se,Ze){return K(U.b.count(Object(re.a)(Se)-1,Se),Ze,2)}function qn(Se){var Ze=Se.getDay();return Ze>=4||Ze===0?Object(U.c)(Se):U.c.ceil(Se)}function xe(Se,Ze){return Se=qn(Se),K(U.c.count(Object(re.a)(Se),Se)+(Object(re.a)(Se).getDay()===4),Ze,2)}function Xn(Se){return Se.getDay()}function br(Se,Ze){return K(U.a.count(Object(re.a)(Se)-1,Se),Ze,2)}function Cr(Se,Ze){return K(Se.getFullYear()%100,Ze,2)}function dr(Se,Ze){return K((Se=qn(Se)).getFullYear()%100,Ze,2)}function Rr(Se,Ze){return K(Se.getFullYear()%1e4,Ze,4)}function hn(Se,Ze){var mt=Se.getDay();return K((Se=mt>=4||mt===0?Object(U.c)(Se):U.c.ceil(Se)).getFullYear()%1e4,Ze,4)}function Xt(Se){var Ze=Se.getTimezoneOffset();return(Ze>0?"-":(Ze*=-1,"+"))+K(Ze/60|0,"0",2)+K(Ze%60,"0",2)}function nn(Se,Ze){return K(Se.getUTCDate(),Ze,2)}function Gn(Se,Ze){return K(Se.getUTCHours(),Ze,2)}function Dn(Se,Ze){return K(Se.getUTCHours()%12||12,Ze,2)}function mr(Se,Ze){return K(1+H.a.count(Object(J.a)(Se),Se),Ze,3)}function xr(Se,Ze){return K(Se.getUTCMilliseconds(),Ze,3)}function gr(Se,Ze){return xr(Se,Ze)+"000"}function Qr(Se,Ze){return K(Se.getUTCMonth()+1,Ze,2)}function ni(Se,Ze){return K(Se.getUTCMinutes(),Ze,2)}function Mr(Se,Ze){return K(Se.getUTCSeconds(),Ze,2)}function di(Se){var Ze=Se.getUTCDay();return Ze===0?7:Ze}function Yr(Se,Ze){return K(b.b.count(Object(J.a)(Se)-1,Se),Ze,2)}function Xr(Se){var Ze=Se.getUTCDay();return Ze>=4||Ze===0?Object(b.c)(Se):b.c.ceil(Se)}function fi(Se,Ze){return Se=Xr(Se),K(b.c.count(Object(J.a)(Se),Se)+(Object(J.a)(Se).getUTCDay()===4),Ze,2)}function ai(Se){return Se.getUTCDay()}function Oa(Se,Ze){return K(b.a.count(Object(J.a)(Se)-1,Se),Ze,2)}function Wi(Se,Ze){return K(Se.getUTCFullYear()%100,Ze,2)}function Ci(Se,Ze){return K((Se=Xr(Se)).getUTCFullYear()%100,Ze,2)}function yt(Se,Ze){return K(Se.getUTCFullYear()%1e4,Ze,4)}function Lr(Se,Ze){var mt=Se.getUTCDay();return K((Se=mt>=4||mt===0?Object(b.c)(Se):b.c.ceil(Se)).getUTCFullYear()%1e4,Ze,4)}function jt(){return"+0000"}function ge(){return"%"}function fe(Se){return+Se}function ye(Se){return Math.floor(+Se/1e3)}},function(Oe,A,o){o.r(A);var b="http://www.w3.org/1999/xhtml",H={svg:"http://www.w3.org/2000/svg",xhtml:b,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},U=function(hn){var Xt=hn+="",nn=Xt.indexOf(":");return nn>=0&&(Xt=hn.slice(0,nn))!=="xmlns"&&(hn=hn.slice(nn+1)),H.hasOwnProperty(Xt)?{space:H[Xt],local:hn}:hn},B=function(hn){var Xt=U(hn);return(Xt.local?function(nn){return function(){return this.ownerDocument.createElementNS(nn.space,nn.local)}}:function(nn){return function(){var Gn=this.ownerDocument,Dn=this.namespaceURI;return Dn===b&&Gn.documentElement.namespaceURI===b?Gn.createElement(nn):Gn.createElementNS(Dn,nn)}})(Xt)};function re(){}var J=function(hn){return hn==null?re:function(){return this.querySelector(hn)}};function R(){return[]}var P=function(hn){return hn==null?R:function(){return this.querySelectorAll(hn)}},$=function(hn){return function(){return this.matches(hn)}};if(typeof document<"u"){var L=document.documentElement;if(!L.matches){var ee=L.webkitMatchesSelector||L.msMatchesSelector||L.mozMatchesSelector||L.oMatchesSelector;$=function(hn){return function(){return ee.call(this,hn)}}}}var F=$,ue=function(hn){return new Array(hn.length)};function ie(hn,Xt){this.ownerDocument=hn.ownerDocument,this.namespaceURI=hn.namespaceURI,this._next=null,this._parent=hn,this.__data__=Xt}ie.prototype={constructor:ie,appendChild:function(hn){return this._parent.insertBefore(hn,this._next)},insertBefore:function(hn,Xt){return this._parent.insertBefore(hn,Xt)},querySelector:function(hn){return this._parent.querySelector(hn)},querySelectorAll:function(hn){return this._parent.querySelectorAll(hn)}};var K="$";function he(hn,Xt,nn,Gn,Dn,mr){for(var xr,gr=0,Qr=Xt.length,ni=mr.length;gr<ni;++gr)(xr=Xt[gr])?(xr.__data__=mr[gr],Gn[gr]=xr):nn[gr]=new ie(hn,mr[gr]);for(;gr<Qr;++gr)(xr=Xt[gr])&&(Dn[gr]=xr)}function pe(hn,Xt,nn,Gn,Dn,mr,xr){var gr,Qr,ni,Mr={},di=Xt.length,Yr=mr.length,Xr=new Array(di);for(gr=0;gr<di;++gr)(Qr=Xt[gr])&&(Xr[gr]=ni=K+xr.call(Qr,Qr.__data__,gr,Xt),ni in Mr?Dn[gr]=Qr:Mr[ni]=Qr);for(gr=0;gr<Yr;++gr)(Qr=Mr[ni=K+xr.call(hn,mr[gr],gr,mr)])?(Gn[gr]=Qr,Qr.__data__=mr[gr],Mr[ni]=null):nn[gr]=new ie(hn,mr[gr]);for(gr=0;gr<di;++gr)(Qr=Xt[gr])&&Mr[Xr[gr]]===Qr&&(Dn[gr]=Qr)}function Ae(hn,Xt){return hn<Xt?-1:hn>Xt?1:hn>=Xt?0:NaN}var Te=function(hn){return hn.ownerDocument&&hn.ownerDocument.defaultView||hn.document&&hn||hn.defaultView};function je(hn,Xt){return hn.style.getPropertyValue(Xt)||Te(hn).getComputedStyle(hn,null).getPropertyValue(Xt)}function ke(hn){return hn.trim().split(/^|\s+/)}function at(hn){return hn.classList||new St(hn)}function St(hn){this._node=hn,this._names=ke(hn.getAttribute("class")||"")}function zt(hn,Xt){for(var nn=at(hn),Gn=-1,Dn=Xt.length;++Gn<Dn;)nn.add(Xt[Gn])}function $t(hn,Xt){for(var nn=at(hn),Gn=-1,Dn=Xt.length;++Gn<Dn;)nn.remove(Xt[Gn])}St.prototype={add:function(hn){this._names.indexOf(hn)<0&&(this._names.push(hn),this._node.setAttribute("class",this._names.join(" ")))},remove:function(hn){var Xt=this._names.indexOf(hn);Xt>=0&&(this._names.splice(Xt,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(hn){return this._names.indexOf(hn)>=0}};function we(){this.textContent=""}function Tt(){this.innerHTML=""}function Gt(){this.nextSibling&&this.parentNode.appendChild(this)}function Pt(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Ye(){return null}function ln(){var hn=this.parentNode;hn&&hn.removeChild(this)}function Zt(){return this.parentNode.insertBefore(this.cloneNode(!1),this.nextSibling)}function Bt(){return this.parentNode.insertBefore(this.cloneNode(!0),this.nextSibling)}var Mt={},bn=null;typeof document<"u"&&("onmouseenter"in document.documentElement||(Mt={mouseenter:"mouseover",mouseleave:"mouseout"}));function Dt(hn,Xt,nn){return hn=_t(hn,Xt,nn),function(Gn){var Dn=Gn.relatedTarget;Dn&&(Dn===this||8&Dn.compareDocumentPosition(this))||hn.call(this,Gn)}}function _t(hn,Xt,nn){return function(Gn){var Dn=bn;bn=Gn;try{hn.call(this,this.__data__,Xt,nn)}finally{bn=Dn}}}function xn(hn){return function(){var Xt=this.__on;if(Xt){for(var nn,Gn=0,Dn=-1,mr=Xt.length;Gn<mr;++Gn)nn=Xt[Gn],hn.type&&nn.type!==hn.type||nn.name!==hn.name?Xt[++Dn]=nn:this.removeEventListener(nn.type,nn.listener,nn.capture);++Dn?Xt.length=Dn:delete this.__on}}}function In(hn,Xt,nn){var Gn=Mt.hasOwnProperty(hn.type)?Dt:_t;return function(Dn,mr,xr){var gr,Qr=this.__on,ni=Gn(Xt,mr,xr);if(Qr){for(var Mr=0,di=Qr.length;Mr<di;++Mr)if((gr=Qr[Mr]).type===hn.type&&gr.name===hn.name)return this.removeEventListener(gr.type,gr.listener,gr.capture),this.addEventListener(gr.type,gr.listener=ni,gr.capture=nn),void(gr.value=Xt)}this.addEventListener(hn.type,ni,nn),gr={type:hn.type,name:hn.name,value:Xt,listener:ni,capture:nn},Qr?Qr.push(gr):this.__on=[gr]}}function Yn(hn,Xt,nn,Gn){var Dn=bn;hn.sourceEvent=bn,bn=hn;try{return Xt.apply(nn,Gn)}finally{bn=Dn}}function fn(hn,Xt,nn){var Gn=Te(hn),Dn=Gn.CustomEvent;typeof Dn=="function"?Dn=new Dn(Xt,nn):(Dn=Gn.document.createEvent("Event"),nn?(Dn.initEvent(Xt,nn.bubbles,nn.cancelable),Dn.detail=nn.detail):Dn.initEvent(Xt,!1,!1)),hn.dispatchEvent(Dn)}var We=[null];function Pe(hn,Xt){this._groups=hn,this._parents=Xt}function rt(){return new Pe([[document.documentElement]],We)}Pe.prototype=rt.prototype={constructor:Pe,select:function(hn){typeof hn!="function"&&(hn=J(hn));for(var Xt=this._groups,nn=Xt.length,Gn=new Array(nn),Dn=0;Dn<nn;++Dn)for(var mr,xr,gr=Xt[Dn],Qr=gr.length,ni=Gn[Dn]=new Array(Qr),Mr=0;Mr<Qr;++Mr)(mr=gr[Mr])&&(xr=hn.call(mr,mr.__data__,Mr,gr))&&("__data__"in mr&&(xr.__data__=mr.__data__),ni[Mr]=xr);return new Pe(Gn,this._parents)},selectAll:function(hn){typeof hn!="function"&&(hn=P(hn));for(var Xt=this._groups,nn=Xt.length,Gn=[],Dn=[],mr=0;mr<nn;++mr)for(var xr,gr=Xt[mr],Qr=gr.length,ni=0;ni<Qr;++ni)(xr=gr[ni])&&(Gn.push(hn.call(xr,xr.__data__,ni,gr)),Dn.push(xr));return new Pe(Gn,Dn)},filter:function(hn){typeof hn!="function"&&(hn=F(hn));for(var Xt=this._groups,nn=Xt.length,Gn=new Array(nn),Dn=0;Dn<nn;++Dn)for(var mr,xr=Xt[Dn],gr=xr.length,Qr=Gn[Dn]=[],ni=0;ni<gr;++ni)(mr=xr[ni])&&hn.call(mr,mr.__data__,ni,xr)&&Qr.push(mr);return new Pe(Gn,this._parents)},data:function(hn,Xt){if(!hn)return Xr=new Array(this.size()),ni=-1,this.each(function(jt){Xr[++ni]=jt}),Xr;var nn=Xt?pe:he,Gn=this._parents,Dn=this._groups;typeof hn!="function"&&(hn=function(jt){return function(){return jt}}(hn));for(var mr=Dn.length,xr=new Array(mr),gr=new Array(mr),Qr=new Array(mr),ni=0;ni<mr;++ni){var Mr=Gn[ni],di=Dn[ni],Yr=di.length,Xr=hn.call(Mr,Mr&&Mr.__data__,ni,Gn),fi=Xr.length,ai=gr[ni]=new Array(fi),Oa=xr[ni]=new Array(fi);nn(Mr,di,ai,Oa,Qr[ni]=new Array(Yr),Xr,Xt);for(var Wi,Ci,yt=0,Lr=0;yt<fi;++yt)if(Wi=ai[yt]){for(yt>=Lr&&(Lr=yt+1);!(Ci=Oa[Lr])&&++Lr<fi;);Wi._next=Ci||null}}return(xr=new Pe(xr,Gn))._enter=gr,xr._exit=Qr,xr},enter:function(){return new Pe(this._enter||this._groups.map(ue),this._parents)},exit:function(){return new Pe(this._exit||this._groups.map(ue),this._parents)},merge:function(hn){for(var Xt=this._groups,nn=hn._groups,Gn=Xt.length,Dn=nn.length,mr=Math.min(Gn,Dn),xr=new Array(Gn),gr=0;gr<mr;++gr)for(var Qr,ni=Xt[gr],Mr=nn[gr],di=ni.length,Yr=xr[gr]=new Array(di),Xr=0;Xr<di;++Xr)(Qr=ni[Xr]||Mr[Xr])&&(Yr[Xr]=Qr);for(;gr<Gn;++gr)xr[gr]=Xt[gr];return new Pe(xr,this._parents)},order:function(){for(var hn=this._groups,Xt=-1,nn=hn.length;++Xt<nn;)for(var Gn,Dn=hn[Xt],mr=Dn.length-1,xr=Dn[mr];--mr>=0;)(Gn=Dn[mr])&&(xr&&xr!==Gn.nextSibling&&xr.parentNode.insertBefore(Gn,xr),xr=Gn);return this},sort:function(hn){function Xt(di,Yr){return di&&Yr?hn(di.__data__,Yr.__data__):!di-!Yr}hn||(hn=Ae);for(var nn=this._groups,Gn=nn.length,Dn=new Array(Gn),mr=0;mr<Gn;++mr){for(var xr,gr=nn[mr],Qr=gr.length,ni=Dn[mr]=new Array(Qr),Mr=0;Mr<Qr;++Mr)(xr=gr[Mr])&&(ni[Mr]=xr);ni.sort(Xt)}return new Pe(Dn,this._parents).order()},call:function(){var hn=arguments[0];return arguments[0]=this,hn.apply(null,arguments),this},nodes:function(){var hn=new Array(this.size()),Xt=-1;return this.each(function(){hn[++Xt]=this}),hn},node:function(){for(var hn=this._groups,Xt=0,nn=hn.length;Xt<nn;++Xt)for(var Gn=hn[Xt],Dn=0,mr=Gn.length;Dn<mr;++Dn){var xr=Gn[Dn];if(xr)return xr}return null},size:function(){var hn=0;return this.each(function(){++hn}),hn},empty:function(){return!this.node()},each:function(hn){for(var Xt=this._groups,nn=0,Gn=Xt.length;nn<Gn;++nn)for(var Dn,mr=Xt[nn],xr=0,gr=mr.length;xr<gr;++xr)(Dn=mr[xr])&&hn.call(Dn,Dn.__data__,xr,mr);return this},attr:function(hn,Xt){var nn=U(hn);if(arguments.length<2){var Gn=this.node();return nn.local?Gn.getAttributeNS(nn.space,nn.local):Gn.getAttribute(nn)}return this.each((Xt==null?nn.local?function(Dn){return function(){this.removeAttributeNS(Dn.space,Dn.local)}}:function(Dn){return function(){this.removeAttribute(Dn)}}:typeof Xt=="function"?nn.local?function(Dn,mr){return function(){var xr=mr.apply(this,arguments);xr==null?this.removeAttributeNS(Dn.space,Dn.local):this.setAttributeNS(Dn.space,Dn.local,xr)}}:function(Dn,mr){return function(){var xr=mr.apply(this,arguments);xr==null?this.removeAttribute(Dn):this.setAttribute(Dn,xr)}}:nn.local?function(Dn,mr){return function(){this.setAttributeNS(Dn.space,Dn.local,mr)}}:function(Dn,mr){return function(){this.setAttribute(Dn,mr)}})(nn,Xt))},style:function(hn,Xt,nn){return arguments.length>1?this.each((Xt==null?function(Gn){return function(){this.style.removeProperty(Gn)}}:typeof Xt=="function"?function(Gn,Dn,mr){return function(){var xr=Dn.apply(this,arguments);xr==null?this.style.removeProperty(Gn):this.style.setProperty(Gn,xr,mr)}}:function(Gn,Dn,mr){return function(){this.style.setProperty(Gn,Dn,mr)}})(hn,Xt,nn??"")):je(this.node(),hn)},property:function(hn,Xt){return arguments.length>1?this.each((Xt==null?function(nn){return function(){delete this[nn]}}:typeof Xt=="function"?function(nn,Gn){return function(){var Dn=Gn.apply(this,arguments);Dn==null?delete this[nn]:this[nn]=Dn}}:function(nn,Gn){return function(){this[nn]=Gn}})(hn,Xt)):this.node()[hn]},classed:function(hn,Xt){var nn=ke(hn+"");if(arguments.length<2){for(var Gn=at(this.node()),Dn=-1,mr=nn.length;++Dn<mr;)if(!Gn.contains(nn[Dn]))return!1;return!0}return this.each((typeof Xt=="function"?function(xr,gr){return function(){(gr.apply(this,arguments)?zt:$t)(this,xr)}}:Xt?function(xr){return function(){zt(this,xr)}}:function(xr){return function(){$t(this,xr)}})(nn,Xt))},text:function(hn){return arguments.length?this.each(hn==null?we:(typeof hn=="function"?function(Xt){return function(){var nn=Xt.apply(this,arguments);this.textContent=nn??""}}:function(Xt){return function(){this.textContent=Xt}})(hn)):this.node().textContent},html:function(hn){return arguments.length?this.each(hn==null?Tt:(typeof hn=="function"?function(Xt){return function(){var nn=Xt.apply(this,arguments);this.innerHTML=nn??""}}:function(Xt){return function(){this.innerHTML=Xt}})(hn)):this.node().innerHTML},raise:function(){return this.each(Gt)},lower:function(){return this.each(Pt)},append:function(hn){var Xt=typeof hn=="function"?hn:B(hn);return this.select(function(){return this.appendChild(Xt.apply(this,arguments))})},insert:function(hn,Xt){var nn=typeof hn=="function"?hn:B(hn),Gn=Xt==null?Ye:typeof Xt=="function"?Xt:J(Xt);return this.select(function(){return this.insertBefore(nn.apply(this,arguments),Gn.apply(this,arguments)||null)})},remove:function(){return this.each(ln)},clone:function(hn){return this.select(hn?Bt:Zt)},datum:function(hn){return arguments.length?this.property("__data__",hn):this.node().__data__},on:function(hn,Xt,nn){var Gn,Dn,mr=function(di){return di.trim().split(/^|\s+/).map(function(Yr){var Xr="",fi=Yr.indexOf(".");return fi>=0&&(Xr=Yr.slice(fi+1),Yr=Yr.slice(0,fi)),{type:Yr,name:Xr}})}(hn+""),xr=mr.length;if(!(arguments.length<2)){for(gr=Xt?In:xn,nn==null&&(nn=!1),Gn=0;Gn<xr;++Gn)this.each(gr(mr[Gn],Xt,nn));return this}var gr=this.node().__on;if(gr){for(var Qr,ni=0,Mr=gr.length;ni<Mr;++ni)for(Gn=0,Qr=gr[ni];Gn<xr;++Gn)if((Dn=mr[Gn]).type===Qr.type&&Dn.name===Qr.name)return Qr.value}},dispatch:function(hn,Xt){return this.each((typeof Xt=="function"?function(nn,Gn){return function(){return fn(this,nn,Gn.apply(this,arguments))}}:function(nn,Gn){return function(){return fn(this,nn,Gn)}})(hn,Xt))}};var Et=rt,Lt=function(hn){return typeof hn=="string"?new Pe([[document.querySelector(hn)]],[document.documentElement]):new Pe([[hn]],We)},rn=function(hn){return Lt(B(hn).call(document.documentElement))},Sn=0;function kn(){return new qn}function qn(){this._="@"+(++Sn).toString(36)}qn.prototype=kn.prototype={constructor:qn,get:function(hn){for(var Xt=this._;!(Xt in hn);)if(!(hn=hn.parentNode))return;return hn[Xt]},set:function(hn,Xt){return hn[this._]=Xt},remove:function(hn){return this._ in hn&&delete hn[this._]},toString:function(){return this._}};var xe=function(){for(var hn,Xt=bn;hn=Xt.sourceEvent;)Xt=hn;return Xt},Xn=function(hn,Xt){var nn=hn.ownerSVGElement||hn;if(nn.createSVGPoint){var Gn=nn.createSVGPoint();return Gn.x=Xt.clientX,Gn.y=Xt.clientY,[(Gn=Gn.matrixTransform(hn.getScreenCTM().inverse())).x,Gn.y]}var Dn=hn.getBoundingClientRect();return[Xt.clientX-Dn.left-hn.clientLeft,Xt.clientY-Dn.top-hn.clientTop]},br=function(hn){var Xt=xe();return Xt.changedTouches&&(Xt=Xt.changedTouches[0]),Xn(hn,Xt)},Cr=function(hn){return typeof hn=="string"?new Pe([document.querySelectorAll(hn)],[document.documentElement]):new Pe([hn??[]],We)},dr=function(hn,Xt,nn){arguments.length<3&&(nn=Xt,Xt=xe().changedTouches);for(var Gn,Dn=0,mr=Xt?Xt.length:0;Dn<mr;++Dn)if((Gn=Xt[Dn]).identifier===nn)return Xn(hn,Gn);return null},Rr=function(hn,Xt){Xt==null&&(Xt=xe().touches);for(var nn=0,Gn=Xt?Xt.length:0,Dn=new Array(Gn);nn<Gn;++nn)Dn[nn]=Xn(hn,Xt[nn]);return Dn};o.d(A,"create",function(){return rn}),o.d(A,"creator",function(){return B}),o.d(A,"local",function(){return kn}),o.d(A,"matcher",function(){return F}),o.d(A,"mouse",function(){return br}),o.d(A,"namespace",function(){return U}),o.d(A,"namespaces",function(){return H}),o.d(A,"clientPoint",function(){return Xn}),o.d(A,"select",function(){return Lt}),o.d(A,"selectAll",function(){return Cr}),o.d(A,"selection",function(){return Et}),o.d(A,"selector",function(){return J}),o.d(A,"selectorAll",function(){return P}),o.d(A,"style",function(){return je}),o.d(A,"touch",function(){return dr}),o.d(A,"touches",function(){return Rr}),o.d(A,"window",function(){return Te}),o.d(A,"event",function(){return bn}),o.d(A,"customEvent",function(){return Yn})},function(Oe,A,o){o.r(A);var b={};o.d(b,"load",function(){return Dt});var H={};o.d(H,"Darknet",function(){return rt}),o.d(H,"load",function(){return Et});var U={};o.d(U,"Doodlenet",function(){return Xn}),o.d(U,"load",function(){return br});var B={};o.d(B,"array3DToImage",function(){return hn}),o.d(B,"processVideo",function(){return Rr}),o.d(B,"cropImage",function(){return Xt}),o.d(B,"imgToTensor",function(){return Gn}),o.d(B,"isInstanceOfSupportedElement",function(){return Dn}),o.d(B,"flipImage",function(){return nn}),o.d(B,"imgToPixelArray",function(){return mr});var re={};o.d(re,"SpeechCommands",function(){return ir}),o.d(re,"load",function(){return zr});var J={};o.d(J,"isTensor",function(){return na}),o.d(J,"isTensor1D",function(){return Bl}),o.d(J,"isTensor2D",function(){return Rf}),o.d(J,"isTensor3D",function(){return nr}),o.d(J,"isTensor4D",function(){return Go}),o.d(J,"isFloat",function(){return bo}),o.d(J,"isEven",function(){return Hi}),o.d(J,"round",function(){return ku}),o.d(J,"isDimensions",function(){return oc}),o.d(J,"computeReshapedDimensions",function(){return Vs}),o.d(J,"getCenterPoint",function(){return sc}),o.d(J,"range",function(){return Ka}),o.d(J,"isValidNumber",function(){return Vu}),o.d(J,"isValidProbablitiy",function(){return qs});var R={};o.d(R,"drawContour",function(){return Ws}),o.d(R,"drawDetections",function(){return tr}),o.d(R,"drawFaceExpressions",function(){return Gs}),o.d(R,"DrawBoxOptions",function(){return Wn}),o.d(R,"DrawBox",function(){return Mn}),o.d(R,"DrawFaceLandmarksOptions",function(){return es}),o.d(R,"DrawFaceLandmarks",function(){return Mo}),o.d(R,"drawFaceLandmarks",function(){return lc}),o.d(R,"AnchorPosition",function(){return Nt}),o.d(R,"DrawTextFieldOptions",function(){return _n}),o.d(R,"DrawTextField",function(){return Nn});var P={};o.d(P,"draw",function(){return R}),o.d(P,"utils",function(){return J}),o.d(P,"tf",function(){return en}),o.d(P,"env",function(){return Ut}),o.d(P,"FaceLandmarkNet",function(){return xg}),o.d(P,"createFaceRecognitionNet",function(){return _m}),o.d(P,"createMtcnn",function(){return zm}),o.d(P,"sigmoid",function(){return Qc}),o.d(P,"inverseSigmoid",function(){return Wh}),o.d(P,"createSsdMobilenetv1",function(){return Cg}),o.d(P,"createFaceDetectionNet",function(){return Og}),o.d(P,"FaceDetectionNet",function(){return b0}),o.d(P,"createTinyFaceDetector",function(){return Xp}),o.d(P,"TinyYolov2",function(){return Gh}),o.d(P,"createTinyYolov2",function(){return w0}),o.d(P,"euclideanDistance",function(){return Lm}),o.d(P,"NeuralNetwork",function(){return Ui}),o.d(P,"resizeResults",function(){return Mg}),o.d(P,"AgeGenderNet",function(){return yg}),o.d(P,"Gender",function(){return Ll}),o.d(P,"BoundingBox",function(){return _o}),o.d(P,"Box",function(){return cs}),o.d(P,"Dimensions",function(){return Os}),o.d(P,"FaceDetection",function(){return Xa}),o.d(P,"FaceLandmarks",function(){return $s}),o.d(P,"FaceLandmarks5",function(){return Ou}),o.d(P,"FaceLandmarks68",function(){return Au}),o.d(P,"FaceMatch",function(){return nu}),o.d(P,"LabeledBox",function(){return Vh}),o.d(P,"LabeledFaceDescriptors",function(){return Mf}),o.d(P,"ObjectDetection",function(){return ls}),o.d(P,"Point",function(){return oa}),o.d(P,"PredictedBox",function(){return jf}),o.d(P,"Rect",function(){return Zc}),o.d(P,"awaitMediaLoaded",function(){return hr}),o.d(P,"bufferToImage",function(){return Nr}),o.d(P,"createCanvas",function(){return wr}),o.d(P,"createCanvasFromMedia",function(){return Hr}),o.d(P,"extractFaces",function(){return pa}),o.d(P,"extractFaceTensors",function(){return ea}),o.d(P,"fetchImage",function(){return Ii}),o.d(P,"fetchJson",function(){return ra}),o.d(P,"fetchNetWeights",function(){return Ya}),o.d(P,"fetchOrThrow",function(){return La}),o.d(P,"getContext2dOrThrow",function(){return yn}),o.d(P,"getMediaDimensions",function(){return Vr}),o.d(P,"imageTensorToCanvas",function(){return Wr}),o.d(P,"imageToSquare",function(){return li}),o.d(P,"isMediaElement",function(){return oi}),o.d(P,"isMediaLoaded",function(){return rr}),o.d(P,"loadWeightMap",function(){return xo}),o.d(P,"matchDimensions",function(){return ki}),o.d(P,"NetInput",function(){return $r}),o.d(P,"resolveInput",function(){return ct}),o.d(P,"toNetInput",function(){return Zr}),o.d(P,"FaceExpressionNet",function(){return ia}),o.d(P,"FACE_EXPRESSION_LABELS",function(){return _s}),o.d(P,"FaceExpressions",function(){return hs}),o.d(P,"FaceLandmark68Net",function(){return Om}),o.d(P,"FaceLandmark68TinyNet",function(){return Am}),o.d(P,"FaceRecognitionNet",function(){return Jd}),o.d(P,"extendWithFaceDescriptor",function(){return Sm}),o.d(P,"isWithFaceDetection",function(){return Pl}),o.d(P,"extendWithFaceDetection",function(){return Bf}),o.d(P,"isWithFaceExpressions",function(){return Ss}),o.d(P,"extendWithFaceExpressions",function(){return Ko}),o.d(P,"isWithFaceLandmarks",function(){return _c}),o.d(P,"extendWithFaceLandmarks",function(){return za}),o.d(P,"isWithAge",function(){return Tv}),o.d(P,"extendWithAge",function(){return Dm}),o.d(P,"isWithGender",function(){return qh}),o.d(P,"extendWithGender",function(){return zf}),o.d(P,"allFacesSsdMobilenetv1",function(){return Gp}),o.d(P,"allFacesTinyYolov2",function(){return Zh}),o.d(P,"allFacesMtcnn",function(){return Kp}),o.d(P,"allFaces",function(){return Pm}),o.d(P,"ComposableTask",function(){return il}),o.d(P,"ComputeFaceDescriptorsTaskBase",function(){return ap}),o.d(P,"ComputeAllFaceDescriptorsTask",function(){return hc}),o.d(P,"ComputeSingleFaceDescriptorTask",function(){return Xf}),o.d(P,"detectSingleFace",function(){return $p}),o.d(P,"detectAllFaces",function(){return Kl}),o.d(P,"DetectFacesTaskBase",function(){return qp}),o.d(P,"DetectAllFacesTask",function(){return Hp}),o.d(P,"DetectSingleFaceTask",function(){return Rg}),o.d(P,"DetectFaceLandmarksTaskBase",function(){return Yf}),o.d(P,"DetectAllFaceLandmarksTask",function(){return op}),o.d(P,"DetectSingleFaceLandmarksTask",function(){return Vp}),o.d(P,"FaceMatcher",function(){return sp}),o.d(P,"nets",function(){return ta}),o.d(P,"ssdMobilenetv1",function(){return ql}),o.d(P,"tinyFaceDetector",function(){return Xh}),o.d(P,"tinyYolov2",function(){return Fv}),o.d(P,"mtcnn",function(){return Rv}),o.d(P,"detectFaceLandmarks",function(){return zp}),o.d(P,"detectFaceLandmarksTiny",function(){return Hl}),o.d(P,"computeFaceDescriptor",function(){return al}),o.d(P,"recognizeFaceExpressions",function(){return rp}),o.d(P,"predictAgeAndGender",function(){return Yh}),o.d(P,"loadSsdMobilenetv1Model",function(){return Hf}),o.d(P,"loadTinyFaceDetectorModel",function(){return $l}),o.d(P,"loadMtcnnModel",function(){return Gl}),o.d(P,"loadTinyYolov2Model",function(){return Tu}),o.d(P,"loadFaceLandmarkModel",function(){return Jh}),o.d(P,"loadFaceLandmarkTinyModel",function(){return $f}),o.d(P,"loadFaceRecognitionModel",function(){return ol}),o.d(P,"loadFaceExpressionModel",function(){return Nc}),o.d(P,"loadAgeGenderModel",function(){return Gf}),o.d(P,"loadFaceDetectionModel",function(){return Up}),o.d(P,"locateFaces",function(){return Kf}),o.d(P,"detectLandmarks",function(){return Ic}),o.d(P,"Mtcnn",function(){return Wf}),o.d(P,"MtcnnOptions",function(){return Dc}),o.d(P,"iou",function(){return Hs}),o.d(P,"minBbox",function(){return Eu}),o.d(P,"nonMaxSuppression",function(){return qu}),o.d(P,"normalize",function(){return uc}),o.d(P,"padToSquare",function(){return Cu}),o.d(P,"shuffleArray",function(){return Jc}),o.d(P,"SsdMobilenetv1",function(){return ep}),o.d(P,"SsdMobilenetv1Options",function(){return Tc}),o.d(P,"TinyFaceDetector",function(){return qf}),o.d(P,"TinyFaceDetectorOptions",function(){return Pp}),o.d(P,"TinyYolov2SizeType",function(){return Fm}),o.d(P,"TinyYolov2Options",function(){return $h}),o.d(P,"validateConfig",function(){return Sg});var $={};o.d($,"getRobin",function(){return bp}),o.d($,"getImageData",function(){return zv});var L=o(18),ee=o.n(L),F=o(2),ue=o(67),ie=o(6),K=o.n(ie),he=o(10),pe=o.n(he),Ae=o(9),Te=o.n(Ae),je=o(4),ke=o.n(je);function at(I,E){return E?new Promise(function(k,w){I.then(function(S){E(void 0,S),k(S)}).catch(function(S){E(S),w(S)})}):I}var St=function(){function I(E,k,w,S){pe()(this,I),this.model=E,this.audioContext=k,this.stream=w,this.frequency=null,this.ready=at(this.loadModel(E),S)}return Te()(I,[{key:"loadModel",value:function(){var E=K()(ke.a.mark(function k(w){return ke.a.wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return S.next=2,F.loadLayersModel("".concat(w,"/model.json"));case 2:if(this.model=S.sent,!this.audioContext){S.next=8;break}return S.next=6,this.processStream();case 6:S.next=9;break;case 8:throw new Error("Could not access microphone - getUserMedia not available");case 9:return S.abrupt("return",this);case 10:case"end":return S.stop()}},k,this)}));return function(k){return E.apply(this,arguments)}}()},{key:"processStream",value:function(){var E=K()(ke.a.mark(function k(){var w,S,z,Y,ce;return ke.a.wrap(function(ve){for(;;)switch(ve.prev=ve.next){case 0:return ve.next=2,F.nextFrame();case 2:for(w=this.audioContext.createMediaStreamSource(this.stream),S=this.audioContext.sampleRate/16e3*1024,z=4;z<S;)z*=2;(Y=this.audioContext.createScriptProcessor(z,1,1)).onaudioprocess=this.processMicrophoneBuffer.bind(this),(ce=this.audioContext.createGain()).gain.setValueAtTime(0,this.audioContext.currentTime),w.connect(Y),Y.connect(ce),ce.connect(this.audioContext.destination),this.audioContext.state!=="running"&&console.warn("User gesture needed to start AudioContext, please click");case 14:case"end":return ve.stop()}},k,this)}));return function(){return E.apply(this,arguments)}}()},{key:"processMicrophoneBuffer",value:function(){var E=K()(ke.a.mark(function k(w){var S=this;return ke.a.wrap(function(z){for(;;)switch(z.prev=z.next){case 0:return z.next=2,F.nextFrame();case 2:this.results={},I.resample(w.inputBuffer,function(Y){F.tidy(function(){var ce=F.add(F.linspace(0,7180,360),F.tensor(1997.379408437619));S.running=!0;var ve=F.tensor(Y.slice(0,1024)),De=F.sub(ve,F.mean(ve)),Ce=F.tensor(F.norm(De).dataSync()/Math.sqrt(1024)),Xe=F.div(De,Ce).reshape([1,1024]),tt=S.model.predict([Xe]).reshape([360]),kt=tt.max().dataSync()[0],At=tt.argMax().dataSync()[0];S.results.confidence=kt.toFixed(3);var tn=Math.max(0,At-4),sn=Math.min(360,At+5),wn=tt.slice([tn],[sn-tn]),En=ce.slice([tn],[sn-tn]),Tn=F.mul(wn,En).dataSync().reduce(function(cr,kr){return cr+kr},0)/wn.dataSync().reduce(function(cr,kr){return cr+kr},0),Pn=10*Math.pow(2,Tn/1200),dn=kt>.5?Pn:null;S.frequency=dn})});case 4:case"end":return z.stop()}},k,this)}));return function(k){return E.apply(this,arguments)}}()},{key:"getPitch",value:function(){var E=K()(ke.a.mark(function k(w){var S;return ke.a.wrap(function(z){for(;;)switch(z.prev=z.next){case 0:return z.next=2,this.ready;case 2:return z.next=4,F.nextFrame();case 4:return S=this.frequency,w&&w(void 0,S),z.abrupt("return",S);case 7:case"end":return z.stop()}},k,this)}));return function(k){return E.apply(this,arguments)}}()}],[{key:"resample",value:function(E,k){for(var w=E.sampleRate%16e3!=0,S=E.sampleRate/16e3,z=E.getChannelData(0),Y=new Float32Array(1024),ce=0;ce<1024;ce+=1)if(w){var ve=Math.floor(ce*S),De=ve+1,Ce=ce*S-ve;Y[ce]=(1-Ce)*z[ve]+Ce*z[De]}else Y[ce]=z[ce*S];k(Y)}}]),I}(),zt=function(){var I=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"./",E=arguments.length>1?arguments[1]:void 0,k=arguments.length>2?arguments[2]:void 0,w=arguments.length>3?arguments[3]:void 0;return new St(I,E,k,w)},$t=o(7),we=o.n($t),Tt=o(17),Gt=o.n(Tt),Pt=o(20),Ye=o(0);/**
    * @license
    * Copyright 2019 Google LLC. All Rights Reserved.
    * Licensed under the Apache License, Version 2.0 (the "License");
    * you may not use this file except in compliance with the License.
    * You may obtain a copy of the License at
    *
    * http://www.apache.org/licenses/LICENSE-2.0
    *
    * Unless required by applicable law or agreed to in writing, software
    * distributed under the License is distributed on an "AS IS" BASIS,
    * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    * See the License for the specific language governing permissions and
    * limitations under the License.
    * =============================================================================
    */function ln(I,E,k,w){return new(k||(k=Promise))(function(S,z){function Y(De){try{ve(w.next(De))}catch(Ce){z(Ce)}}function ce(De){try{ve(w.throw(De))}catch(Ce){z(Ce)}}function ve(De){De.done?S(De.value):new k(function(Ce){Ce(De.value)}).then(Y,ce)}ve((w=w.apply(I,[])).next())})}function Zt(I,E){var k,w,S,z,Y={label:0,sent:function(){if(1&S[0])throw S[1];return S[1]},trys:[],ops:[]};return z={next:ce(0),throw:ce(1),return:ce(2)},typeof Symbol=="function"&&(z[Symbol.iterator]=function(){return this}),z;function ce(ve){return function(De){return function(Ce){if(k)throw new TypeError("Generator is already executing.");for(;Y;)try{if(k=1,w&&(S=2&Ce[0]?w.return:Ce[0]?w.throw||((S=w.return)&&S.call(w),0):w.next)&&!(S=S.call(w,Ce[1])).done)return S;switch(w=0,S&&(Ce=[2&Ce[0],S.value]),Ce[0]){case 0:case 1:S=Ce;break;case 4:return Y.label++,{value:Ce[1],done:!1};case 5:Y.label++,w=Ce[1],Ce=[0];continue;case 7:Ce=Y.ops.pop(),Y.trys.pop();continue;default:if(!(S=(S=Y.trys).length>0&&S[S.length-1])&&(Ce[0]===6||Ce[0]===2)){Y=0;continue}if(Ce[0]===3&&(!S||Ce[1]>S[0]&&Ce[1]<S[3])){Y.label=Ce[1];break}if(Ce[0]===6&&Y.label<S[1]){Y.label=S[1],S=Ce;break}if(S&&Y.label<S[2]){Y.label=S[2],Y.ops.push(Ce);break}S[2]&&Y.ops.pop(),Y.trys.pop();continue}Ce=E.call(I,Y)}catch(Xe){Ce=[6,Xe],w=0}finally{k=S=0}if(5&Ce[0])throw Ce[1];return{value:Ce[0]?Ce[1]:void 0,done:!0}}([ve,De])}}}var Bt={0:"tench, Tinca tinca",1:"goldfish, Carassius auratus",2:"great white shark, white shark, man-eater, man-eating shark, Carcharodon carcharias",3:"tiger shark, Galeocerdo cuvieri",4:"hammerhead, hammerhead shark",5:"electric ray, crampfish, numbfish, torpedo",6:"stingray",7:"cock",8:"hen",9:"ostrich, Struthio camelus",10:"brambling, Fringilla montifringilla",11:"goldfinch, Carduelis carduelis",12:"house finch, linnet, Carpodacus mexicanus",13:"junco, snowbird",14:"indigo bunting, indigo finch, indigo bird, Passerina cyanea",15:"robin, American robin, Turdus migratorius",16:"bulbul",17:"jay",18:"magpie",19:"chickadee",20:"water ouzel, dipper",21:"kite",22:"bald eagle, American eagle, Haliaeetus leucocephalus",23:"vulture",24:"great grey owl, great gray owl, Strix nebulosa",25:"European fire salamander, Salamandra salamandra",26:"common newt, Triturus vulgaris",27:"eft",28:"spotted salamander, Ambystoma maculatum",29:"axolotl, mud puppy, Ambystoma mexicanum",30:"bullfrog, Rana catesbeiana",31:"tree frog, tree-frog",32:"tailed frog, bell toad, ribbed toad, tailed toad, Ascaphus trui",33:"loggerhead, loggerhead turtle, Caretta caretta",34:"leatherback turtle, leatherback, leathery turtle, Dermochelys coriacea",35:"mud turtle",36:"terrapin",37:"box turtle, box tortoise",38:"banded gecko",39:"common iguana, iguana, Iguana iguana",40:"American chameleon, anole, Anolis carolinensis",41:"whiptail, whiptail lizard",42:"agama",43:"frilled lizard, Chlamydosaurus kingi",44:"alligator lizard",45:"Gila monster, Heloderma suspectum",46:"green lizard, Lacerta viridis",47:"African chameleon, Chamaeleo chamaeleon",48:"Komodo dragon, Komodo lizard, dragon lizard, giant lizard, Varanus komodoensis",49:"African crocodile, Nile crocodile, Crocodylus niloticus",50:"American alligator, Alligator mississipiensis",51:"triceratops",52:"thunder snake, worm snake, Carphophis amoenus",53:"ringneck snake, ring-necked snake, ring snake",54:"hognose snake, puff adder, sand viper",55:"green snake, grass snake",56:"king snake, kingsnake",57:"garter snake, grass snake",58:"water snake",59:"vine snake",60:"night snake, Hypsiglena torquata",61:"boa constrictor, Constrictor constrictor",62:"rock python, rock snake, Python sebae",63:"Indian cobra, Naja naja",64:"green mamba",65:"sea snake",66:"horned viper, cerastes, sand viper, horned asp, Cerastes cornutus",67:"diamondback, diamondback rattlesnake, Crotalus adamanteus",68:"sidewinder, horned rattlesnake, Crotalus cerastes",69:"trilobite",70:"harvestman, daddy longlegs, Phalangium opilio",71:"scorpion",72:"black and gold garden spider, Argiope aurantia",73:"barn spider, Araneus cavaticus",74:"garden spider, Aranea diademata",75:"black widow, Latrodectus mactans",76:"tarantula",77:"wolf spider, hunting spider",78:"tick",79:"centipede",80:"black grouse",81:"ptarmigan",82:"ruffed grouse, partridge, Bonasa umbellus",83:"prairie chicken, prairie grouse, prairie fowl",84:"peacock",85:"quail",86:"partridge",87:"African grey, African gray, Psittacus erithacus",88:"macaw",89:"sulphur-crested cockatoo, Kakatoe galerita, Cacatua galerita",90:"lorikeet",91:"coucal",92:"bee eater",93:"hornbill",94:"hummingbird",95:"jacamar",96:"toucan",97:"drake",98:"red-breasted merganser, Mergus serrator",99:"goose",100:"black swan, Cygnus atratus",101:"tusker",102:"echidna, spiny anteater, anteater",103:"platypus, duckbill, duckbilled platypus, duck-billed platypus, Ornithorhynchus anatinus",104:"wallaby, brush kangaroo",105:"koala, koala bear, kangaroo bear, native bear, Phascolarctos cinereus",106:"wombat",107:"jelly fish",108:"sea anemone, anemone",109:"brain coral",110:"flatworm, platyhelminth",111:"nematode, nematode worm, roundworm",112:"conch",113:"snail",114:"slug",115:"sea slug, nudibranch",116:"chiton, coat-of-mail shell, sea cradle, polyplacophore",117:"chambered nautilus, pearly nautilus, nautilus",118:"Dungeness crab, Cancer magister",119:"rock crab, Cancer irroratus",120:"fiddler crab",121:"king crab, Alaska crab, Alaskan king crab, Alaska king crab, Paralithodes camtschatica",122:"American lobster, Northern lobster, Maine lobster, Homarus americanus",123:"spiny lobster, langouste, rock lobster, crawfish, crayfish, sea crawfish",124:"crayfish, crawfish, crawdad, crawdaddy",125:"hermit crab",126:"isopod",127:"white stork, Ciconia ciconia",128:"black stork, Ciconia nigra",129:"spoonbill",130:"flamingo",131:"little blue heron, Egretta caerulea",132:"American egret, great white heron, Egretta albus",133:"bittern",134:"crane",135:"limpkin, Aramus pictus",136:"European gallinule, Porphyrio porphyrio",137:"American coot, marsh hen, mud hen, water hen, Fulica americana",138:"bustard",139:"ruddy turnstone, Arenaria interpres",140:"red-backed sandpiper, dunlin, Erolia alpina",141:"redshank, Tringa totanus",142:"dowitcher",143:"oystercatcher, oyster catcher",144:"pelican",145:"king penguin, Aptenodytes patagonica",146:"albatross, mollymawk",147:"grey whale, gray whale, devilfish, Eschrichtius gibbosus, Eschrichtius robustus",148:"killer whale, killer, orca, grampus, sea wolf, Orcinus orca",149:"dugong, Dugong dugon",150:"sea lion",151:"Chihuahua",152:"Japanese spaniel",153:"Maltese dog, Maltese terrier, Maltese",154:"Pekinese, Pekingese, Peke",155:"Shih-Tzu",156:"Blenheim spaniel",157:"papillon",158:"toy terrier",159:"Rhodesian ridgeback",160:"Afghan hound, Afghan",161:"basset, basset hound",162:"beagle",163:"bloodhound, sleuthhound",164:"bluetick",165:"black-and-tan coonhound",166:"Walker hound, Walker foxhound",167:"English foxhound",168:"redbone",169:"borzoi, Russian wolfhound",170:"Irish wolfhound",171:"Italian greyhound",172:"whippet",173:"Ibizan hound, Ibizan Podenco",174:"Norwegian elkhound, elkhound",175:"otterhound, otter hound",176:"Saluki, gazelle hound",177:"Scottish deerhound, deerhound",178:"Weimaraner",179:"Staffordshire bullterrier, Staffordshire bull terrier",180:"American Staffordshire terrier, Staffordshire terrier, American pit bull terrier, pit bull terrier",181:"Bedlington terrier",182:"Border terrier",183:"Kerry blue terrier",184:"Irish terrier",185:"Norfolk terrier",186:"Norwich terrier",187:"Yorkshire terrier",188:"wire-haired fox terrier",189:"Lakeland terrier",190:"Sealyham terrier, Sealyham",191:"Airedale, Airedale terrier",192:"cairn, cairn terrier",193:"Australian terrier",194:"Dandie Dinmont, Dandie Dinmont terrier",195:"Boston bull, Boston terrier",196:"miniature schnauzer",197:"giant schnauzer",198:"standard schnauzer",199:"Scotch terrier, Scottish terrier, Scottie",200:"Tibetan terrier, chrysanthemum dog",201:"silky terrier, Sydney silky",202:"soft-coated wheaten terrier",203:"West Highland white terrier",204:"Lhasa, Lhasa apso",205:"flat-coated retriever",206:"curly-coated retriever",207:"golden retriever",208:"Labrador retriever",209:"Chesapeake Bay retriever",210:"German short-haired pointer",211:"vizsla, Hungarian pointer",212:"English setter",213:"Irish setter, red setter",214:"Gordon setter",215:"Brittany spaniel",216:"clumber, clumber spaniel",217:"English springer, English springer spaniel",218:"Welsh springer spaniel",219:"cocker spaniel, English cocker spaniel, cocker",220:"Sussex spaniel",221:"Irish water spaniel",222:"kuvasz",223:"schipperke",224:"groenendael",225:"malinois",226:"briard",227:"kelpie",228:"komondor",229:"Old English sheepdog, bobtail",230:"Shetland sheepdog, Shetland sheep dog, Shetland",231:"collie",232:"Border collie",233:"Bouvier des Flandres, Bouviers des Flandres",234:"Rottweiler",235:"German shepherd, German shepherd dog, German police dog, alsatian",236:"Doberman, Doberman pinscher",237:"miniature pinscher",238:"Greater Swiss Mountain dog",239:"Bernese mountain dog",240:"Appenzeller",241:"EntleBucher",242:"boxer",243:"bull mastiff",244:"Tibetan mastiff",245:"French bulldog",246:"Great Dane",247:"Saint Bernard, St Bernard",248:"Eskimo dog, husky",249:"malamute, malemute, Alaskan malamute",250:"Siberian husky",251:"dalmatian, coach dog, carriage dog",252:"affenpinscher, monkey pinscher, monkey dog",253:"basenji",254:"pug, pug-dog",255:"Leonberg",256:"Newfoundland, Newfoundland dog",257:"Great Pyrenees",258:"Samoyed, Samoyede",259:"Pomeranian",260:"chow, chow chow",261:"keeshond",262:"Brabancon griffon",263:"Pembroke, Pembroke Welsh corgi",264:"Cardigan, Cardigan Welsh corgi",265:"toy poodle",266:"miniature poodle",267:"standard poodle",268:"Mexican hairless",269:"timber wolf, grey wolf, gray wolf, Canis lupus",270:"white wolf, Arctic wolf, Canis lupus tundrarum",271:"red wolf, maned wolf, Canis rufus, Canis niger",272:"coyote, prairie wolf, brush wolf, Canis latrans",273:"dingo, warrigal, warragal, Canis dingo",274:"dhole, Cuon alpinus",275:"African hunting dog, hyena dog, Cape hunting dog, Lycaon pictus",276:"hyena, hyaena",277:"red fox, Vulpes vulpes",278:"kit fox, Vulpes macrotis",279:"Arctic fox, white fox, Alopex lagopus",280:"grey fox, gray fox, Urocyon cinereoargenteus",281:"tabby, tabby cat",282:"tiger cat",283:"Persian cat",284:"Siamese cat, Siamese",285:"Egyptian cat",286:"cougar, puma, catamount, mountain lion, painter, panther, Felis concolor",287:"lynx, catamount",288:"leopard, Panthera pardus",289:"snow leopard, ounce, Panthera uncia",290:"jaguar, panther, Panthera onca, Felis onca",291:"lion, king of beasts, Panthera leo",292:"tiger, Panthera tigris",293:"cheetah, chetah, Acinonyx jubatus",294:"brown bear, bruin, Ursus arctos",295:"American black bear, black bear, Ursus americanus, Euarctos americanus",296:"ice bear, polar bear, Ursus Maritimus, Thalarctos maritimus",297:"sloth bear, Melursus ursinus, Ursus ursinus",298:"mongoose",299:"meerkat, mierkat",300:"tiger beetle",301:"ladybug, ladybeetle, lady beetle, ladybird, ladybird beetle",302:"ground beetle, carabid beetle",303:"long-horned beetle, longicorn, longicorn beetle",304:"leaf beetle, chrysomelid",305:"dung beetle",306:"rhinoceros beetle",307:"weevil",308:"fly",309:"bee",310:"ant, emmet, pismire",311:"grasshopper, hopper",312:"cricket",313:"walking stick, walkingstick, stick insect",314:"cockroach, roach",315:"mantis, mantid",316:"cicada, cicala",317:"leafhopper",318:"lacewing, lacewing fly",319:"dragonfly, darning needle, devil's darning needle, sewing needle, snake feeder, snake doctor, mosquito hawk, skeeter hawk",320:"damselfly",321:"admiral",322:"ringlet, ringlet butterfly",323:"monarch, monarch butterfly, milkweed butterfly, Danaus plexippus",324:"cabbage butterfly",325:"sulphur butterfly, sulfur butterfly",326:"lycaenid, lycaenid butterfly",327:"starfish, sea star",328:"sea urchin",329:"sea cucumber, holothurian",330:"wood rabbit, cottontail, cottontail rabbit",331:"hare",332:"Angora, Angora rabbit",333:"hamster",334:"porcupine, hedgehog",335:"fox squirrel, eastern fox squirrel, Sciurus niger",336:"marmot",337:"beaver",338:"guinea pig, Cavia cobaya",339:"sorrel",340:"zebra",341:"hog, pig, grunter, squealer, Sus scrofa",342:"wild boar, boar, Sus scrofa",343:"warthog",344:"hippopotamus, hippo, river horse, Hippopotamus amphibius",345:"ox",346:"water buffalo, water ox, Asiatic buffalo, Bubalus bubalis",347:"bison",348:"ram, tup",349:"bighorn, bighorn sheep, cimarron, Rocky Mountain bighorn, Rocky Mountain sheep, Ovis canadensis",350:"ibex, Capra ibex",351:"hartebeest",352:"impala, Aepyceros melampus",353:"gazelle",354:"Arabian camel, dromedary, Camelus dromedarius",355:"llama",356:"weasel",357:"mink",358:"polecat, fitch, foulmart, foumart, Mustela putorius",359:"black-footed ferret, ferret, Mustela nigripes",360:"otter",361:"skunk, polecat, wood pussy",362:"badger",363:"armadillo",364:"three-toed sloth, ai, Bradypus tridactylus",365:"orangutan, orang, orangutang, Pongo pygmaeus",366:"gorilla, Gorilla gorilla",367:"chimpanzee, chimp, Pan troglodytes",368:"gibbon, Hylobates lar",369:"siamang, Hylobates syndactylus, Symphalangus syndactylus",370:"guenon, guenon monkey",371:"patas, hussar monkey, Erythrocebus patas",372:"baboon",373:"macaque",374:"langur",375:"colobus, colobus monkey",376:"proboscis monkey, Nasalis larvatus",377:"marmoset",378:"capuchin, ringtail, Cebus capucinus",379:"howler monkey, howler",380:"titi, titi monkey",381:"spider monkey, Ateles geoffroyi",382:"squirrel monkey, Saimiri sciureus",383:"Madagascar cat, ring-tailed lemur, Lemur catta",384:"indri, indris, Indri indri, Indri brevicaudatus",385:"Indian elephant, Elephas maximus",386:"African elephant, Loxodonta africana",387:"lesser panda, red panda, panda, bear cat, cat bear, Ailurus fulgens",388:"giant panda, panda, panda bear, coon bear, Ailuropoda melanoleuca",389:"barracouta, snoek",390:"eel",391:"coho, cohoe, coho salmon, blue jack, silver salmon, Oncorhynchus kisutch",392:"rock beauty, Holocanthus tricolor",393:"anemone fish",394:"sturgeon",395:"gar, garfish, garpike, billfish, Lepisosteus osseus",396:"lionfish",397:"puffer, pufferfish, blowfish, globefish",398:"abacus",399:"abaya",400:"academic gown, academic robe, judge's robe",401:"accordion, piano accordion, squeeze box",402:"acoustic guitar",403:"aircraft carrier, carrier, flattop, attack aircraft carrier",404:"airliner",405:"airship, dirigible",406:"altar",407:"ambulance",408:"amphibian, amphibious vehicle",409:"analog clock",410:"apiary, bee house",411:"apron",412:"ashcan, trash can, garbage can, wastebin, ash bin, ash-bin, ashbin, dustbin, trash barrel, trash bin",413:"assault rifle, assault gun",414:"backpack, back pack, knapsack, packsack, rucksack, haversack",415:"bakery, bakeshop, bakehouse",416:"balance beam, beam",417:"balloon",418:"ballpoint, ballpoint pen, ballpen, Biro",419:"Band Aid",420:"banjo",421:"bannister, banister, balustrade, balusters, handrail",422:"barbell",423:"barber chair",424:"barbershop",425:"barn",426:"barometer",427:"barrel, cask",428:"barrow, garden cart, lawn cart, wheelbarrow",429:"baseball",430:"basketball",431:"bassinet",432:"bassoon",433:"bathing cap, swimming cap",434:"bath towel",435:"bathtub, bathing tub, bath, tub",436:"beach wagon, station wagon, wagon, estate car, beach waggon, station waggon, waggon",437:"beacon, lighthouse, beacon light, pharos",438:"beaker",439:"bearskin, busby, shako",440:"beer bottle",441:"beer glass",442:"bell cote, bell cot",443:"bib",444:"bicycle-built-for-two, tandem bicycle, tandem",445:"bikini, two-piece",446:"binder, ring-binder",447:"binoculars, field glasses, opera glasses",448:"birdhouse",449:"boathouse",450:"bobsled, bobsleigh, bob",451:"bolo tie, bolo, bola tie, bola",452:"bonnet, poke bonnet",453:"bookcase",454:"bookshop, bookstore, bookstall",455:"bottlecap",456:"bow",457:"bow tie, bow-tie, bowtie",458:"brass, memorial tablet, plaque",459:"brassiere, bra, bandeau",460:"breakwater, groin, groyne, mole, bulwark, seawall, jetty",461:"breastplate, aegis, egis",462:"broom",463:"bucket, pail",464:"buckle",465:"bulletproof vest",466:"bullet train, bullet",467:"butcher shop, meat market",468:"cab, hack, taxi, taxicab",469:"caldron, cauldron",470:"candle, taper, wax light",471:"cannon",472:"canoe",473:"can opener, tin opener",474:"cardigan",475:"car mirror",476:"carousel, carrousel, merry-go-round, roundabout, whirligig",477:"carpenter's kit, tool kit",478:"carton",479:"car wheel",480:"cash machine, cash dispenser, automated teller machine, automatic teller machine, automated teller, automatic teller, ATM",481:"cassette",482:"cassette player",483:"castle",484:"catamaran",485:"CD player",486:"cello, violoncello",487:"cellular telephone, cellular phone, cellphone, cell, mobile phone",488:"chain",489:"chainlink fence",490:"chain mail, ring mail, mail, chain armor, chain armour, ring armor, ring armour",491:"chain saw, chainsaw",492:"chest",493:"chiffonier, commode",494:"chime, bell, gong",495:"china cabinet, china closet",496:"Christmas stocking",497:"church, church building",498:"cinema, movie theater, movie theatre, movie house, picture palace",499:"cleaver, meat cleaver, chopper",500:"cliff dwelling",501:"cloak",502:"clog, geta, patten, sabot",503:"cocktail shaker",504:"coffee mug",505:"coffeepot",506:"coil, spiral, volute, whorl, helix",507:"combination lock",508:"computer keyboard, keypad",509:"confectionery, confectionary, candy store",510:"container ship, containership, container vessel",511:"convertible",512:"corkscrew, bottle screw",513:"cornet, horn, trumpet, trump",514:"cowboy boot",515:"cowboy hat, ten-gallon hat",516:"cradle",517:"crane",518:"crash helmet",519:"crate",520:"crib, cot",521:"Crock Pot",522:"croquet ball",523:"crutch",524:"cuirass",525:"dam, dike, dyke",526:"desk",527:"desktop computer",528:"dial telephone, dial phone",529:"diaper, nappy, napkin",530:"digital clock",531:"digital watch",532:"dining table, board",533:"dishrag, dishcloth",534:"dishwasher, dish washer, dishwashing machine",535:"disk brake, disc brake",536:"dock, dockage, docking facility",537:"dogsled, dog sled, dog sleigh",538:"dome",539:"doormat, welcome mat",540:"drilling platform, offshore rig",541:"drum, membranophone, tympan",542:"drumstick",543:"dumbbell",544:"Dutch oven",545:"electric fan, blower",546:"electric guitar",547:"electric locomotive",548:"entertainment center",549:"envelope",550:"espresso maker",551:"face powder",552:"feather boa, boa",553:"file, file cabinet, filing cabinet",554:"fireboat",555:"fire engine, fire truck",556:"fire screen, fireguard",557:"flagpole, flagstaff",558:"flute, transverse flute",559:"folding chair",560:"football helmet",561:"forklift",562:"fountain",563:"fountain pen",564:"four-poster",565:"freight car",566:"French horn, horn",567:"frying pan, frypan, skillet",568:"fur coat",569:"garbage truck, dustcart",570:"gasmask, respirator, gas helmet",571:"gas pump, gasoline pump, petrol pump, island dispenser",572:"goblet",573:"go-kart",574:"golf ball",575:"golfcart, golf cart",576:"gondola",577:"gong, tam-tam",578:"gown",579:"grand piano, grand",580:"greenhouse, nursery, glasshouse",581:"grille, radiator grille",582:"grocery store, grocery, food market, market",583:"guillotine",584:"hair slide",585:"hair spray",586:"half track",587:"hammer",588:"hamper",589:"hand blower, blow dryer, blow drier, hair dryer, hair drier",590:"hand-held computer, hand-held microcomputer",591:"handkerchief, hankie, hanky, hankey",592:"hard disc, hard disk, fixed disk",593:"harmonica, mouth organ, harp, mouth harp",594:"harp",595:"harvester, reaper",596:"hatchet",597:"holster",598:"home theater, home theatre",599:"honeycomb",600:"hook, claw",601:"hoopskirt, crinoline",602:"horizontal bar, high bar",603:"horse cart, horse-cart",604:"hourglass",605:"iPod",606:"iron, smoothing iron",607:"jack-o'-lantern",608:"jean, blue jean, denim",609:"jeep, landrover",610:"jersey, T-shirt, tee shirt",611:"jigsaw puzzle",612:"jinrikisha, ricksha, rickshaw",613:"joystick",614:"kimono",615:"knee pad",616:"knot",617:"lab coat, laboratory coat",618:"ladle",619:"lampshade, lamp shade",620:"laptop, laptop computer",621:"lawn mower, mower",622:"lens cap, lens cover",623:"letter opener, paper knife, paperknife",624:"library",625:"lifeboat",626:"lighter, light, igniter, ignitor",627:"limousine, limo",628:"liner, ocean liner",629:"lipstick, lip rouge",630:"Loafer",631:"lotion",632:"loudspeaker, speaker, speaker unit, loudspeaker system, speaker system",633:"loupe, jeweler's loupe",634:"lumbermill, sawmill",635:"magnetic compass",636:"mailbag, postbag",637:"mailbox, letter box",638:"maillot",639:"maillot, tank suit",640:"manhole cover",641:"maraca",642:"marimba, xylophone",643:"mask",644:"matchstick",645:"maypole",646:"maze, labyrinth",647:"measuring cup",648:"medicine chest, medicine cabinet",649:"megalith, megalithic structure",650:"microphone, mike",651:"microwave, microwave oven",652:"military uniform",653:"milk can",654:"minibus",655:"miniskirt, mini",656:"minivan",657:"missile",658:"mitten",659:"mixing bowl",660:"mobile home, manufactured home",661:"Model T",662:"modem",663:"monastery",664:"monitor",665:"moped",666:"mortar",667:"mortarboard",668:"mosque",669:"mosquito net",670:"motor scooter, scooter",671:"mountain bike, all-terrain bike, off-roader",672:"mountain tent",673:"mouse, computer mouse",674:"mousetrap",675:"moving van",676:"muzzle",677:"nail",678:"neck brace",679:"necklace",680:"nipple",681:"notebook, notebook computer",682:"obelisk",683:"oboe, hautboy, hautbois",684:"ocarina, sweet potato",685:"odometer, hodometer, mileometer, milometer",686:"oil filter",687:"organ, pipe organ",688:"oscilloscope, scope, cathode-ray oscilloscope, CRO",689:"overskirt",690:"oxcart",691:"oxygen mask",692:"packet",693:"paddle, boat paddle",694:"paddlewheel, paddle wheel",695:"padlock",696:"paintbrush",697:"pajama, pyjama, pj's, jammies",698:"palace",699:"panpipe, pandean pipe, syrinx",700:"paper towel",701:"parachute, chute",702:"parallel bars, bars",703:"park bench",704:"parking meter",705:"passenger car, coach, carriage",706:"patio, terrace",707:"pay-phone, pay-station",708:"pedestal, plinth, footstall",709:"pencil box, pencil case",710:"pencil sharpener",711:"perfume, essence",712:"Petri dish",713:"photocopier",714:"pick, plectrum, plectron",715:"pickelhaube",716:"picket fence, paling",717:"pickup, pickup truck",718:"pier",719:"piggy bank, penny bank",720:"pill bottle",721:"pillow",722:"ping-pong ball",723:"pinwheel",724:"pirate, pirate ship",725:"pitcher, ewer",726:"plane, carpenter's plane, woodworking plane",727:"planetarium",728:"plastic bag",729:"plate rack",730:"plow, plough",731:"plunger, plumber's helper",732:"Polaroid camera, Polaroid Land camera",733:"pole",734:"police van, police wagon, paddy wagon, patrol wagon, wagon, black Maria",735:"poncho",736:"pool table, billiard table, snooker table",737:"pop bottle, soda bottle",738:"pot, flowerpot",739:"potter's wheel",740:"power drill",741:"prayer rug, prayer mat",742:"printer",743:"prison, prison house",744:"projectile, missile",745:"projector",746:"puck, hockey puck",747:"punching bag, punch bag, punching ball, punchball",748:"purse",749:"quill, quill pen",750:"quilt, comforter, comfort, puff",751:"racer, race car, racing car",752:"racket, racquet",753:"radiator",754:"radio, wireless",755:"radio telescope, radio reflector",756:"rain barrel",757:"recreational vehicle, RV, R.V.",758:"reel",759:"reflex camera",760:"refrigerator, icebox",761:"remote control, remote",762:"restaurant, eating house, eating place, eatery",763:"revolver, six-gun, six-shooter",764:"rifle",765:"rocking chair, rocker",766:"rotisserie",767:"rubber eraser, rubber, pencil eraser",768:"rugby ball",769:"rule, ruler",770:"running shoe",771:"safe",772:"safety pin",773:"saltshaker, salt shaker",774:"sandal",775:"sarong",776:"sax, saxophone",777:"scabbard",778:"scale, weighing machine",779:"school bus",780:"schooner",781:"scoreboard",782:"screen, CRT screen",783:"screw",784:"screwdriver",785:"seat belt, seatbelt",786:"sewing machine",787:"shield, buckler",788:"shoe shop, shoe-shop, shoe store",789:"shoji",790:"shopping basket",791:"shopping cart",792:"shovel",793:"shower cap",794:"shower curtain",795:"ski",796:"ski mask",797:"sleeping bag",798:"slide rule, slipstick",799:"sliding door",800:"slot, one-armed bandit",801:"snorkel",802:"snowmobile",803:"snowplow, snowplough",804:"soap dispenser",805:"soccer ball",806:"sock",807:"solar dish, solar collector, solar furnace",808:"sombrero",809:"soup bowl",810:"space bar",811:"space heater",812:"space shuttle",813:"spatula",814:"speedboat",815:"spider web, spider's web",816:"spindle",817:"sports car, sport car",818:"spotlight, spot",819:"stage",820:"steam locomotive",821:"steel arch bridge",822:"steel drum",823:"stethoscope",824:"stole",825:"stone wall",826:"stopwatch, stop watch",827:"stove",828:"strainer",829:"streetcar, tram, tramcar, trolley, trolley car",830:"stretcher",831:"studio couch, day bed",832:"stupa, tope",833:"submarine, pigboat, sub, U-boat",834:"suit, suit of clothes",835:"sundial",836:"sunglass",837:"sunglasses, dark glasses, shades",838:"sunscreen, sunblock, sun blocker",839:"suspension bridge",840:"swab, swob, mop",841:"sweatshirt",842:"swimming trunks, bathing trunks",843:"swing",844:"switch, electric switch, electrical switch",845:"syringe",846:"table lamp",847:"tank, army tank, armored combat vehicle, armoured combat vehicle",848:"tape player",849:"teapot",850:"teddy, teddy bear",851:"television, television system",852:"tennis ball",853:"thatch, thatched roof",854:"theater curtain, theatre curtain",855:"thimble",856:"thresher, thrasher, threshing machine",857:"throne",858:"tile roof",859:"toaster",860:"tobacco shop, tobacconist shop, tobacconist",861:"toilet seat",862:"torch",863:"totem pole",864:"tow truck, tow car, wrecker",865:"toyshop",866:"tractor",867:"trailer truck, tractor trailer, trucking rig, rig, articulated lorry, semi",868:"tray",869:"trench coat",870:"tricycle, trike, velocipede",871:"trimaran",872:"tripod",873:"triumphal arch",874:"trolleybus, trolley coach, trackless trolley",875:"trombone",876:"tub, vat",877:"turnstile",878:"typewriter keyboard",879:"umbrella",880:"unicycle, monocycle",881:"upright, upright piano",882:"vacuum, vacuum cleaner",883:"vase",884:"vault",885:"velvet",886:"vending machine",887:"vestment",888:"viaduct",889:"violin, fiddle",890:"volleyball",891:"waffle iron",892:"wall clock",893:"wallet, billfold, notecase, pocketbook",894:"wardrobe, closet, press",895:"warplane, military plane",896:"washbasin, handbasin, washbowl, lavabo, wash-hand basin",897:"washer, automatic washer, washing machine",898:"water bottle",899:"water jug",900:"water tower",901:"whiskey jug",902:"whistle",903:"wig",904:"window screen",905:"window shade",906:"Windsor tie",907:"wine bottle",908:"wing",909:"wok",910:"wooden spoon",911:"wool, woolen, woollen",912:"worm fence, snake fence, snake-rail fence, Virginia fence",913:"wreck",914:"yawl",915:"yurt",916:"web site, website, internet site, site",917:"comic book",918:"crossword puzzle, crossword",919:"street sign",920:"traffic light, traffic signal, stoplight",921:"book jacket, dust cover, dust jacket, dust wrapper",922:"menu",923:"plate",924:"guacamole",925:"consomme",926:"hot pot, hotpot",927:"trifle",928:"ice cream, icecream",929:"ice lolly, lolly, lollipop, popsicle",930:"French loaf",931:"bagel, beigel",932:"pretzel",933:"cheeseburger",934:"hotdog, hot dog, red hot",935:"mashed potato",936:"head cabbage",937:"broccoli",938:"cauliflower",939:"zucchini, courgette",940:"spaghetti squash",941:"acorn squash",942:"butternut squash",943:"cucumber, cuke",944:"artichoke, globe artichoke",945:"bell pepper",946:"cardoon",947:"mushroom",948:"Granny Smith",949:"strawberry",950:"orange",951:"lemon",952:"fig",953:"pineapple, ananas",954:"banana",955:"jackfruit, jak, jack",956:"custard apple",957:"pomegranate",958:"hay",959:"carbonara",960:"chocolate sauce, chocolate syrup",961:"dough",962:"meat loaf, meatloaf",963:"pizza, pizza pie",964:"potpie",965:"burrito",966:"red wine",967:"espresso",968:"cup",969:"eggnog",970:"alp",971:"bubble",972:"cliff, drop, drop-off",973:"coral reef",974:"geyser",975:"lakeside, lakeshore",976:"promontory, headland, head, foreland",977:"sandbar, sand bar",978:"seashore, coast, seacoast, sea-coast",979:"valley, vale",980:"volcano",981:"ballplayer, baseball player",982:"groom, bridegroom",983:"scuba diver",984:"rapeseed",985:"daisy",986:"yellow lady's slipper, yellow lady-slipper, Cypripedium calceolus, Cypripedium parviflorum",987:"corn",988:"acorn",989:"hip, rose hip, rosehip",990:"buckeye, horse chestnut, conker",991:"coral fungus",992:"agaric",993:"gyromitra",994:"stinkhorn, carrion fungus",995:"earthstar",996:"hen-of-the-woods, hen of the woods, Polyporus frondosus, Grifola frondosa",997:"bolete",998:"ear, spike, capitulum",999:"toilet tissue, toilet paper, bathroom tissue"},Mt={"1.00":"module_apply_default/MobilenetV1/Logits/global_pool","2.00":"module_apply_default/MobilenetV2/Logits/AvgPool"},bn={"1.00":{.25:{url:"https://tfhub.dev/google/imagenet/mobilenet_v1_025_224/classification/1",inputRange:[0,1]},"0.50":{url:"https://tfhub.dev/google/imagenet/mobilenet_v1_050_224/classification/1",inputRange:[0,1]},.75:{url:"https://tfhub.dev/google/imagenet/mobilenet_v1_075_224/classification/1",inputRange:[0,1]},"1.00":{url:"https://tfhub.dev/google/imagenet/mobilenet_v1_100_224/classification/1",inputRange:[0,1]}},"2.00":{"0.50":{url:"https://tfhub.dev/google/imagenet/mobilenet_v2_050_224/classification/2",inputRange:[0,1]},.75:{url:"https://tfhub.dev/google/imagenet/mobilenet_v2_075_224/classification/2",inputRange:[0,1]},"1.00":{url:"https://tfhub.dev/google/imagenet/mobilenet_v2_100_224/classification/2",inputRange:[0,1]}}};function Dt(I){return I===void 0&&(I={version:1,alpha:1}),ln(this,void 0,void 0,function(){var E,k,w,S,z,Y;return Zt(this,function(ce){switch(ce.label){case 0:if(Ye==null)throw new Error("Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this model.");if(k=I.version.toFixed(2),w=I.alpha?I.alpha.toFixed(2):"",S=-1,z=1,I.modelUrl==null){if(!(k in bn))throw new Error("Invalid version of MobileNet. Valid versions are: "+Object.keys(bn));if(!(w in bn[k]))throw new Error("MobileNet constructed with invalid alpha "+I.alpha+". Valid multipliers for this version are: "+Object.keys(bn[k])+".");E=bn[k][w].inputRange,S=E[0],z=E[1]}return[4,(Y=new _t(k,w,I.modelUrl,S,z)).load()];case 1:return ce.sent(),[2,Y]}})})}var _t=function(){function I(E,k,w,S,z){S===void 0&&(S=-1),z===void 0&&(z=1),this.version=E,this.alpha=k,this.modelUrl=w,this.inputMin=S,this.inputMax=z,this.inputRange=z-S}return I.prototype.load=function(){return ln(this,void 0,void 0,function(){var E,k,w,S,z=this;return Zt(this,function(Y){switch(Y.label){case 0:return this.modelUrl?(E=this,[4,Object(Pt.loadGraphModel)(this.modelUrl)]):[3,2];case 1:return E.model=Y.sent(),[3,4];case 2:return k=bn[this.version][this.alpha].url,w=this,[4,Object(Pt.loadGraphModel)(k,{fromTFHub:!0})];case 3:w.model=Y.sent(),Y.label=4;case 4:return[4,(S=Object(Ye.tidy)(function(){return z.model.predict(Object(Ye.zeros)([1,224,224,3]))})).data()];case 5:return Y.sent(),S.dispose(),[2]}})})},I.prototype.infer=function(E,k){var w=this;return k===void 0&&(k=!1),Object(Ye.tidy)(function(){E instanceof Ye.Tensor||(E=Ye.browser.fromPixels(E));var S=E.toFloat().mul(w.inputRange).add(w.inputMin),z=S;E.shape[0]===224&&E.shape[1]===224||(z=Ye.image.resizeBilinear(S,[224,224],!0));var Y,ce=z.reshape([-1,224,224,3]);if(k){var ve=Mt[w.version];Y=w.model.execute(ce,ve).squeeze([1,2])}else Y=w.model.predict(ce).slice([0,1],[-1,1e3]);return Y})},I.prototype.classify=function(E,k){return k===void 0&&(k=3),ln(this,void 0,void 0,function(){var w,S;return Zt(this,function(z){switch(z.label){case 0:return[4,function(Y,ce){return ln(this,void 0,void 0,function(){var ve,De,Ce,Xe,tt,kt,At;return Zt(this,function(tn){switch(tn.label){case 0:return[4,(ve=Y.softmax()).data()];case 1:for(De=tn.sent(),ve.dispose(),Ce=[],At=0;At<De.length;At++)Ce.push({value:De[At],index:At});for(Ce.sort(function(sn,wn){return wn.value-sn.value}),Xe=new Float32Array(ce),tt=new Int32Array(ce),At=0;At<ce;At++)Xe[At]=Ce[At].value,tt[At]=Ce[At].index;for(kt=[],At=0;At<tt.length;At++)kt.push({className:Bt[tt[At]],probability:Xe[At]});return[2,kt]}})})}(w=this.infer(E),k)];case 1:return S=z.sent(),w.dispose(),[2,S]}})})},I}();function xn(I,E,k){for(var w=[],S=0;S<I.length;S+=1)w.push({value:I[S],index:S});w.sort(function(Ce,Xe){return Xe.value-Ce.value});for(var z=new Float32Array(E),Y=new Int32Array(E),ce=0;ce<E;ce+=1)z[ce]=w[ce].value,Y[ce]=w[ce].index;for(var ve=[],De=0;De<Y.length;De+=1)ve.push({className:k[Y[De]],probability:z[De]});return ve}function In(I,E,k){return Yn.apply(this,arguments)}function Yn(){return(Yn=K()(ke.a.mark(function I(E,k,w){var S;return ke.a.wrap(function(z){for(;;)switch(z.prev=z.next){case 0:return z.next=2,E.data();case 2:return S=z.sent,z.abrupt("return",xn(S,k,w));case 4:case"end":return z.stop()}},I)}))).apply(this,arguments)}var fn=["kit fox","English setter","Siberian husky","Australian terrier","English springer","grey whale","lesser panda","Egyptian cat","ibex","Persian cat","cougar","gazelle","porcupine","sea lion","malamute","badger","Great Dane","Walker hound","Welsh springer spaniel","whippet","Scottish deerhound","killer whale","mink","African elephant","Weimaraner","soft-coated wheaten terrier","Dandie Dinmont","red wolf","Old English sheepdog","jaguar","otterhound","bloodhound","Airedale","hyena","meerkat","giant schnauzer","titi","three-toed sloth","sorrel","black-footed ferret","dalmatian","black-and-tan coonhound","papillon","skunk","Staffordshire bullterrier","Mexican hairless","Bouvier des Flandres","weasel","miniature poodle","Cardigan","malinois","bighorn","fox squirrel","colobus","tiger cat","Lhasa","impala","coyote","Yorkshire terrier","Newfoundland","brown bear","red fox","Norwegian elkhound","Rottweiler","hartebeest","Saluki","grey fox","schipperke","Pekinese","Brabancon griffon","West Highland white terrier","Sealyham terrier","guenon","mongoose","indri","tiger","Irish wolfhound","wild boar","EntleBucher","zebra","ram","French bulldog","orangutan","basenji","leopard","Bernese mountain dog","Maltese dog","Norfolk terrier","toy terrier","vizsla","cairn","squirrel monkey","groenendael","clumber","Siamese cat","chimpanzee","komondor","Afghan hound","Japanese spaniel","proboscis monkey","guinea pig","white wolf","ice bear","gorilla","borzoi","toy poodle","Kerry blue terrier","ox","Scotch terrier","Tibetan mastiff","spider monkey","Doberman","Boston bull","Greater Swiss Mountain dog","Appenzeller","Shih-Tzu","Irish water spaniel","Pomeranian","Bedlington terrier","warthog","Arabian camel","siamang","miniature schnauzer","collie","golden retriever","Irish terrier","affenpinscher","Border collie","hare","boxer","silky terrier","beagle","Leonberg","German short-haired pointer","patas","dhole","baboon","macaque","Chesapeake Bay retriever","bull mastiff","kuvasz","capuchin","pug","curly-coated retriever","Norwich terrier","flat-coated retriever","hog","keeshond","Eskimo dog","Brittany spaniel","standard poodle","Lakeland terrier","snow leopard","Gordon setter","dingo","standard schnauzer","hamster","Tibetan terrier","Arctic fox","wire-haired fox terrier","basset","water buffalo","American black bear","Angora","bison","howler monkey","hippopotamus","chow","giant panda","American Staffordshire terrier","Shetland sheepdog","Great Pyrenees","Chihuahua","tabby","marmoset","Labrador retriever","Saint Bernard","armadillo","Samoyed","bluetick","redbone","polecat","marmot","kelpie","gibbon","llama","miniature pinscher","wood rabbit","Italian greyhound","lion","cocker spaniel","Irish setter","dugong","Indian elephant","beaver","Sussex spaniel","Pembroke","Blenheim spaniel","Madagascar cat","Rhodesian ridgeback","lynx","African hunting dog","langur","Ibizan hound","timber wolf","cheetah","English foxhound","briard","sloth bear","Border terrier","German shepherd","otter","koala","tusker","echidna","wallaby","platypus","wombat","revolver","umbrella","schooner","soccer ball","accordion","ant","starfish","chambered nautilus","grand piano","laptop","strawberry","airliner","warplane","airship","balloon","space shuttle","fireboat","gondola","speedboat","lifeboat","canoe","yawl","catamaran","trimaran","container ship","liner","pirate","aircraft carrier","submarine","wreck","half track","tank","missile","bobsled","dogsled","bicycle-built-for-two","mountain bike","freight car","passenger car","barrow","shopping cart","motor scooter","forklift","electric locomotive","steam locomotive","amphibian","ambulance","beach wagon","cab","convertible","jeep","limousine","minivan","Model T","racer","sports car","go-kart","golfcart","moped","snowplow","fire engine","garbage truck","pickup","tow truck","trailer truck","moving van","police van","recreational vehicle","streetcar","snowmobile","tractor","mobile home","tricycle","unicycle","horse cart","jinrikisha","oxcart","bassinet","cradle","crib","four-poster","bookcase","china cabinet","medicine chest","chiffonier","table lamp","file","park bench","barber chair","throne","folding chair","rocking chair","studio couch","toilet seat","desk","pool table","dining table","entertainment center","wardrobe","Granny Smith","orange","lemon","fig","pineapple","banana","jackfruit","custard apple","pomegranate","acorn","hip","ear","rapeseed","corn","buckeye","organ","upright","chime","drum","gong","maraca","marimba","steel drum","banjo","cello","violin","harp","acoustic guitar","electric guitar","cornet","French horn","trombone","harmonica","ocarina","panpipe","bassoon","oboe","sax","flute","daisy","yellow lady's slipper","cliff","valley","alp","volcano","promontory","sandbar","coral reef","lakeside","seashore","geyser","hatchet","cleaver","letter opener","plane","power drill","lawn mower","hammer","corkscrew","can opener","plunger","screwdriver","shovel","plow","chain saw","cock","hen","ostrich","brambling","goldfinch","house finch","junco","indigo bunting","robin","bulbul","jay","magpie","chickadee","water ouzel","kite","bald eagle","vulture","great grey owl","black grouse","ptarmigan","ruffed grouse","prairie chicken","peacock","quail","partridge","African grey","macaw","sulphur-crested cockatoo","lorikeet","coucal","bee eater","hornbill","hummingbird","jacamar","toucan","drake","red-breasted merganser","goose","black swan","white stork","black stork","spoonbill","flamingo","American egret","little blue heron","bittern","crane","limpkin","American coot","bustard","ruddy turnstone","red-backed sandpiper","redshank","dowitcher","oystercatcher","European gallinule","pelican","king penguin","albatross","great white shark","tiger shark","hammerhead","electric ray","stingray","barracouta","coho","tench","goldfish","eel","rock beauty","anemone fish","lionfish","puffer","sturgeon","gar","loggerhead","leatherback turtle","mud turtle","terrapin","box turtle","banded gecko","common iguana","American chameleon","whiptail","agama","frilled lizard","alligator lizard","Gila monster","green lizard","African chameleon","Komodo dragon","triceratops","African crocodile","American alligator","thunder snake","ringneck snake","hognose snake","green snake","king snake","garter snake","water snake","vine snake","night snake","boa constrictor","rock python","Indian cobra","green mamba","sea snake","horned viper","diamondback","sidewinder","European fire salamander","common newt","eft","spotted salamander","axolotl","bullfrog","tree frog","tailed frog","whistle","wing","paintbrush","hand blower","oxygen mask","snorkel","loudspeaker","microphone","screen","mouse","electric fan","oil filter","strainer","space heater","stove","guillotine","barometer","rule","odometer","scale","analog clock","digital clock","wall clock","hourglass","sundial","parking meter","stopwatch","digital watch","stethoscope","syringe","magnetic compass","binoculars","projector","sunglasses","loupe","radio telescope","bow","cannon","assault rifle","rifle","projectile","computer keyboard","typewriter keyboard","crane","lighter","abacus","cash machine","slide rule","desktop computer","hand-held computer","notebook","web site","harvester","thresher","printer","slot","vending machine","sewing machine","joystick","switch","hook","car wheel","paddlewheel","pinwheel","potter's wheel","gas pump","carousel","swing","reel","radiator","puck","hard disc","sunglass","pick","car mirror","solar dish","remote control","disk brake","buckle","hair slide","knot","combination lock","padlock","nail","safety pin","screw","muzzle","seat belt","ski","candle","jack-o'-lantern","spotlight","torch","neck brace","pier","tripod","maypole","mousetrap","spider web","trilobite","harvestman","scorpion","black and gold garden spider","barn spider","garden spider","black widow","tarantula","wolf spider","tick","centipede","isopod","Dungeness crab","rock crab","fiddler crab","king crab","American lobster","spiny lobster","crayfish","hermit crab","tiger beetle","ladybug","ground beetle","long-horned beetle","leaf beetle","dung beetle","rhinoceros beetle","weevil","fly","bee","grasshopper","cricket","walking stick","cockroach","mantis","cicada","leafhopper","lacewing","dragonfly","damselfly","admiral","ringlet","monarch","cabbage butterfly","sulphur butterfly","lycaenid","jellyfish","sea anemone","brain coral","flatworm","nematode","conch","snail","slug","sea slug","chiton","sea urchin","sea cucumber","iron","espresso maker","microwave","Dutch oven","rotisserie","toaster","waffle iron","vacuum","dishwasher","refrigerator","washer","Crock Pot","frying pan","wok","caldron","coffeepot","teapot","spatula","altar","triumphal arch","patio","steel arch bridge","suspension bridge","viaduct","barn","greenhouse","palace","monastery","library","apiary","boathouse","church","mosque","stupa","planetarium","restaurant","cinema","home theater","lumbermill","coil","obelisk","totem pole","castle","prison","grocery store","bakery","barbershop","bookshop","butcher shop","confectionery","shoe shop","tobacco shop","toyshop","fountain","cliff dwelling","yurt","dock","brass","megalith","bannister","breakwater","dam","chainlink fence","picket fence","worm fence","stone wall","grille","sliding door","turnstile","mountain tent","scoreboard","honeycomb","plate rack","pedestal","beacon","mashed potato","bell pepper","head cabbage","broccoli","cauliflower","zucchini","spaghetti squash","acorn squash","butternut squash","cucumber","artichoke","cardoon","mushroom","shower curtain","jean","carton","handkerchief","sandal","ashcan","safe","plate","necklace","croquet ball","fur coat","thimble","pajama","running shoe","cocktail shaker","chest","manhole cover","modem","tub","tray","balance beam","bagel","prayer rug","kimono","hot pot","whiskey jug","knee pad","book jacket","spindle","ski mask","beer bottle","crash helmet","bottlecap","tile roof","mask","maillot","Petri dish","football helmet","bathing cap","teddy","holster","pop bottle","photocopier","vestment","crossword puzzle","golf ball","trifle","suit","water tower","feather boa","cloak","red wine","drumstick","shield","Christmas stocking","hoopskirt","menu","stage","bonnet","meat loaf","baseball","face powder","scabbard","sunscreen","beer glass","hen-of-the-woods","guacamole","lampshade","wool","hay","bow tie","mailbag","water jug","bucket","dishrag","soup bowl","eggnog","mortar","trench coat","paddle","chain","swab","mixing bowl","potpie","wine bottle","shoji","bulletproof vest","drilling platform","binder","cardigan","sweatshirt","pot","birdhouse","hamper","ping-pong ball","pencil box","pay-phone","consomme","apron","punching bag","backpack","groom","bearskin","pencil sharpener","broom","mosquito net","abaya","mortarboard","poncho","crutch","Polaroid camera","space bar","cup","racket","traffic light","quill","radio","dough","cuirass","military uniform","lipstick","shower cap","monitor","oscilloscope","mitten","brassiere","French loaf","vase","milk can","rugby ball","paper towel","earthstar","envelope","miniskirt","cowboy hat","trolleybus","perfume","bathtub","hotdog","coral fungus","bullet train","pillow","toilet tissue","cassette","carpenter's kit","ladle","stinkhorn","lotion","hair spray","academic gown","dome","crate","wig","burrito","pill bottle","chain mail","theater curtain","window shade","barrel","washbasin","ballpoint","basketball","bath towel","cowboy boot","gown","window screen","agaric","cellular telephone","nipple","barbell","mailbox","lab coat","fire screen","minibus","packet","maze","pole","horizontal bar","sombrero","pickelhaube","rain barrel","wallet","cassette player","comic book","piggy bank","street sign","bell cote","fountain pen","Windsor tie","volleyball","overskirt","sarong","purse","bolo tie","bib","parachute","sleeping bag","television","swimming trunks","measuring cup","espresso","pizza","breastplate","shopping basket","wooden spoon","saltshaker","chocolate sauce","ballplayer","goblet","gyromitra","stretcher","water bottle","dial telephone","soap dispenser","jersey","school bus","jigsaw puzzle","plastic bag","reflex camera","diaper","Band Aid","ice lolly","velvet","tennis ball","gasmask","doormat","Loafer","ice cream","pretzel","quilt","maillot","tape player","clog","iPod","bolete","scuba diver","pitcher","matchstick","bikini","sock","CD player","lens cap","thatch","vault","beaker","bubble","cheeseburger","parallel bars","flagpole","coffee mug","rubber eraser","stole","carbonara","dumbbell"],We={DARKNET_URL:"https://cdn.jsdelivr.net/gh/ml5js/ml5-data-and-models@master/models/darknetclassifier/darknetreference/model.json",DARKNET_TINY_URL:"https://cdn.jsdelivr.net/gh/ml5js/ml5-data-and-models@master/models/darknetclassifier/darknettiny/model.json",IMAGE_SIZE_DARKNET:256,IMAGE_SIZE_DARKNET_TINY:224};function Pe(I,E){var k;I instanceof F.Tensor?k=I:I instanceof HTMLImageElement||I instanceof HTMLVideoElement||I instanceof HTMLCanvasElement||I instanceof ImageData?k=F.browser.fromPixels(I):we()(I)==="object"&&(I.elt instanceof HTMLImageElement||I.elt instanceof HTMLVideoElement||I.elt instanceof HTMLCanvasElement||I.elt instanceof ImageData)&&(k=F.browser.fromPixels(I.elt));var w=k.toFloat().div(F.scalar(255)),S=w;return(w.shape[0]!==E||w.shape[1]!==E)&&(S=F.image.resizeBilinear(w,[E,E],!0)),S.reshape([1,E,E,3])}var rt=function(){function I(E){switch(pe()(this,I),this.version=E,this.version){case"reference":this.imgSize=We.IMAGE_SIZE_DARKNET;break;case"tiny":this.imgSize=We.IMAGE_SIZE_DARKNET_TINY}}return Te()(I,[{key:"load",value:function(){var E=K()(ke.a.mark(function k(){var w,S=this;return ke.a.wrap(function(z){for(;;)switch(z.prev=z.next){case 0:z.t0=this.version,z.next=z.t0==="reference"?3:z.t0==="tiny"?7:11;break;case 3:return z.next=5,F.loadLayersModel(We.DARKNET_URL);case 5:return this.model=z.sent,z.abrupt("break",12);case 7:return z.next=9,F.loadLayersModel(We.DARKNET_TINY_URL);case 9:return this.model=z.sent,z.abrupt("break",12);case 11:return z.abrupt("break",12);case 12:return w=F.tidy(function(){return S.model.predict(F.zeros([1,S.imgSize,S.imgSize,3]))}),z.next=15,w.data();case 15:w.dispose();case 16:case"end":return z.stop()}},k,this)}));return function(){return E.apply(this,arguments)}}()},{key:"classify",value:function(){var E=K()(ke.a.mark(function k(w){var S,z,Y,ce=this,ve=arguments;return ke.a.wrap(function(De){for(;;)switch(De.prev=De.next){case 0:return S=ve.length>1&&ve[1]!==void 0?ve[1]:3,z=F.tidy(function(){var Ce=Pe(w,ce.imgSize),Xe=ce.model.predict(Ce);return F.softmax(Xe)}),De.next=4,In(z,S,fn);case 4:return Y=De.sent,z.dispose(),De.abrupt("return",Y);case 7:case"end":return De.stop()}},k)}));return function(k){return E.apply(this,arguments)}}()}]),I}();function Et(I){return Lt.apply(this,arguments)}function Lt(){return(Lt=K()(ke.a.mark(function I(E){var k,w;return ke.a.wrap(function(S){for(;;)switch(S.prev=S.next){case 0:if((k=E.version)==="reference"||k==="tiny"){S.next=3;break}throw new Error("Please select a version: darknet-reference or darknet-tiny");case 3:return w=new rt(k),S.next=6,w.load();case 6:return S.abrupt("return",w);case 7:case"end":return S.stop()}},I)}))).apply(this,arguments)}var rn=o(23),Sn=o.n(rn),kn=["flashlight","belt","mushroom","pond","strawberry","pineapple","sun","cow","ear","bush","pliers","watermelon","apple","baseball","feather","shoe","leaf","lollipop","crown","ocean","horse","mountain","mosquito","mug","hospital","saw","castle","angel","underwear","traffic_light","cruise_ship","marker","blueberry","flamingo","face","hockey_stick","bucket","campfire","asparagus","skateboard","door","suitcase","skull","cloud","paint_can","hockey_puck","steak","house_plant","sleeping_bag","bench","snowman","arm","crayon","fan","shovel","leg","washing_machine","harp","toothbrush","tree","bear","rake","megaphone","knee","guitar","calculator","hurricane","grapes","paintbrush","couch","nose","square","wristwatch","penguin","bridge","octagon","submarine","screwdriver","rollerskates","ladder","wine_bottle","cake","bracelet","broom","yoga","finger","fish","line","truck","snake","bus","stitches","snorkel","shorts","bowtie","pickup_truck","tooth","snail","foot","crab","school_bus","train","dresser","sock","tractor","map","hedgehog","coffee_cup","computer","matches","beard","frog","crocodile","bathtub","rain","moon","bee","knife","boomerang","lighthouse","chandelier","jail","pool","stethoscope","frying_pan","cell_phone","binoculars","purse","lantern","birthday_cake","clarinet","palm_tree","aircraft_carrier","vase","eraser","shark","skyscraper","bicycle","sink","teapot","circle","tornado","bird","stereo","mouth","key","hot_dog","spoon","laptop","cup","bottlecap","The_Great_Wall_of_China","The_Mona_Lisa","smiley_face","waterslide","eyeglasses","ceiling_fan","lobster","moustache","carrot","garden","police_car","postcard","necklace","helmet","blackberry","beach","golf_club","car","panda","alarm_clock","t-shirt","dog","bread","wine_glass","lighter","flower","bandage","drill","butterfly","swan","owl","raccoon","squiggle","calendar","giraffe","elephant","trumpet","rabbit","trombone","sheep","onion","church","flip_flops","spreadsheet","pear","clock","roller_coaster","parachute","kangaroo","duck","remote_control","compass","monkey","rainbow","tennis_racquet","lion","pencil","string_bean","oven","star","cat","pizza","soccer_ball","syringe","flying_saucer","eye","cookie","floor_lamp","mouse","toilet","toaster","The_Eiffel_Tower","airplane","stove","cello","stop_sign","tent","diving_board","light_bulb","hammer","scorpion","headphones","basket","spider","paper_clip","sweater","ice_cream","envelope","sea_turtle","donut","hat","hourglass","broccoli","jacket","backpack","book","lightning","drums","snowflake","radio","banana","camel","canoe","toothpaste","chair","picture_frame","parrot","sandwich","lipstick","pants","violin","brain","power_outlet","triangle","hamburger","dragon","bulldozer","cannon","dolphin","zebra","animal_migration","camouflage","scissors","basketball","elbow","umbrella","windmill","table","rifle","hexagon","potato","anvil","sword","peanut","axe","television","rhinoceros","baseball_bat","speedboat","sailboat","zigzag","garden_hose","river","house","pillow","ant","tiger","stairs","cooler","see_saw","piano","fireplace","popsicle","dumbbell","mailbox","barn","hot_tub","teddy-bear","fork","dishwasher","peas","hot_air_balloon","keyboard","microwave","wheel","fire_hydrant","van","camera","whale","candle","octopus","pig","swing_set","helicopter","saxophone","passport","bat","ambulance","diamond","goatee","fence","grass","mermaid","motorbike","microphone","toe","cactus","nail","telephone","hand","squirrel","streetlight","bed","firetruck"],qn={DOODLENET_URL:"https://cdn.jsdelivr.net/gh/ml5js/ml5-data-and-models@master/models/doodlenet/model.json",IMAGE_SIZE_DOODLENET:28};function xe(I,E){var k;I instanceof F.Tensor?k=I:I instanceof HTMLImageElement||I instanceof HTMLVideoElement||I instanceof HTMLCanvasElement||I instanceof ImageData?k=F.browser.fromPixels(I):we()(I)==="object"&&(I.elt instanceof HTMLImageElement||I.elt instanceof HTMLVideoElement||I.elt instanceof HTMLCanvasElement||I.elt instanceof ImageData)&&(k=F.browser.fromPixels(I.elt));var w=F.scalar(1).sub(k.toFloat().div(F.scalar(255))),S=w;w.shape[0]===E&&w.shape[1]===E||(S=F.image.resizeBilinear(w,[E,E]));var z=F.split(S,3,3),Y=Sn()(z,3),ce=Y[0],ve=Y[1],De=Y[2];return ce.add(ve).add(De).div(F.scalar(3)).floor().reshape([1,E,E,1])}var Xn=function(){function I(){pe()(this,I),this.imgSize=qn.IMAGE_SIZE_DOODLENET}return Te()(I,[{key:"load",value:function(){var E=K()(ke.a.mark(function k(){var w,S=this;return ke.a.wrap(function(z){for(;;)switch(z.prev=z.next){case 0:return z.next=2,F.loadLayersModel(qn.DOODLENET_URL);case 2:return this.model=z.sent,w=F.tidy(function(){return S.model.predict(F.zeros([1,S.imgSize,S.imgSize,1]))}),z.next=6,w.data();case 6:w.dispose();case 7:case"end":return z.stop()}},k,this)}));return function(){return E.apply(this,arguments)}}()},{key:"classify",value:function(){var E=K()(ke.a.mark(function k(w){var S,z,Y,ce=this,ve=arguments;return ke.a.wrap(function(De){for(;;)switch(De.prev=De.next){case 0:return S=ve.length>1&&ve[1]!==void 0?ve[1]:10,z=F.tidy(function(){var Ce=xe(w,ce.imgSize);return ce.model.predict(Ce)}),De.next=4,In(z,S,kn);case 4:return Y=De.sent,z.dispose(),De.abrupt("return",Y);case 7:case"end":return De.stop()}},k)}));return function(k){return E.apply(this,arguments)}}()}]),I}();function br(){return Cr.apply(this,arguments)}function Cr(){return(Cr=K()(ke.a.mark(function I(){var E;return ke.a.wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return E=new Xn,k.next=3,E.load();case 3:return k.abrupt("return",E);case 4:case"end":return k.stop()}},I)}))).apply(this,arguments)}var dr=new(function(){function I(){pe()(this,I),typeof window<"u"&&(this.m_p5Instance=window)}return Te()(I,[{key:"setP5Instance",value:function(E){this.m_p5Instance=E}},{key:"p5Instance",get:function(){return this.m_p5Instance!==void 0&&typeof this.m_p5Instance.loadImage=="function"?this.m_p5Instance:this.m_p5Instance.p5!==void 0&&this.m_p5Instance.p5.Image!==void 0&&typeof this.m_p5Instance.p5.Image=="function"?this.m_p5Instance.p5:void 0}},{key:"checkP5",value:function(){return!!this.p5Instance}},{key:"getBlob",value:function(E){return new Promise(function(k,w){E.toBlob(function(S){S?k(S):w(new Error("Canvas could not be converted to Blob."))})})}},{key:"loadAsync",value:function(E){var k=this;return new Promise(function(w,S){k.p5Instance.loadImage(E,function(z){w(z)},function(){S(new Error("Could not load image from url ".concat(E)))})})}},{key:"rawToBlob",value:function(){var E=K()(ke.a.mark(function k(w,S,z){var Y,ce,ve,De,Ce,Xe;return ke.a.wrap(function(tt){for(;;)switch(tt.prev=tt.next){case 0:for(Y=Array.from(w),ce=document.createElement("canvas"),ve=ce.getContext("2d"),ce.width=S,ce.height=z,De=ve.createImageData(S,z),Ce=De.data,Xe=0;Xe<S*z*4;Xe+=1)Ce[Xe]=Y[Xe];return ve.putImageData(De,0,0),tt.abrupt("return",this.getBlob(ce));case 10:case"end":return tt.stop()}},k,this)}));return function(k,w,S){return E.apply(this,arguments)}}()},{key:"blobToP5Image",value:function(){var E=K()(ke.a.mark(function k(w){return ke.a.wrap(function(S){for(;;)switch(S.prev=S.next){case 0:if(!this.checkP5()||typeof URL>"u"){S.next=2;break}return S.abrupt("return",this.loadAsync(URL.createObjectURL(w)));case 2:return S.abrupt("return",null);case 3:case"end":return S.stop()}},k,this)}));return function(k){return E.apply(this,arguments)}}()}]),I}()),Rr=function(I,E){var k=arguments.length>2&&arguments[2]!==void 0?arguments[2]:function(){},w=I,S=document.createElement("video");return w.onplay=function(){var z=w.captureStream();S.srcObject=z,S.width=E,S.height=E,S.autoplay=!0,S.playsinline=!0,S.muted=!0,k()},S},hn=function(I){var E=Sn()(I.shape,2),k=E[0],w=E[1],S=I.dataSync(),z=document.createElement("canvas");z.width=w,z.height=k;for(var Y=z.getContext("2d"),ce=Y.getImageData(0,0,z.width,z.height),ve=0;ve<w*k;ve+=1){var De=4*ve,Ce=3*ve;ce.data[De+0]=Math.floor(256*S[Ce+0]),ce.data[De+1]=Math.floor(256*S[Ce+1]),ce.data[De+2]=Math.floor(256*S[Ce+2]),ce.data[De+3]=255}Y.putImageData(ce,0,0);var Xe=z.toDataURL(),tt=document.createElement("img");return tt.src=Xe,tt.style.width=w,tt.style.height=k,I.dispose(),tt},Xt=function(I){var E=Math.min(I.shape[0],I.shape[1]),k=I.shape[0]/2-E/2,w=I.shape[1]/2-E/2;return I.slice([k,w,0],[E,E,3])},nn=function(I){var E,k,w;if(w=I instanceof HTMLImageElement||I instanceof HTMLCanvasElement||I instanceof HTMLVideoElement||I instanceof ImageData?I:we()(I)==="object"&&(I.elt instanceof HTMLImageElement||I.elt instanceof HTMLCanvasElement||I.elt instanceof HTMLVideoElement||I.elt instanceof ImageData)?I.elt:we()(I)==="object"&&I.canvas instanceof HTMLCanvasElement?I.canvas:I,E=w.width,k=w.height,dr.checkP5()){var S=dr.p5Instance.createGraphics(E,k);return S.push(),S.translate(E,0),S.scale(-1,1),S.image(I,0,0,E,k),S.pop(),S}var z=document.createElement("canvas");z.width=E,z.height=k;var Y=z.getContext("2d");return Y.drawImage(w,0,0,E,k),Y.translate(E,0),Y.scale(-1,1),Y.drawImage(z,-1*E,0,E,k),z};function Gn(I){var E=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return F.tidy(function(){var k=F.browser.fromPixels(I);return E&&(k=F.image.resizeBilinear(k,E)),Xt(k).expandDims(0).toFloat().div(F.scalar(127)).sub(F.scalar(1))})}function Dn(I){return I instanceof HTMLVideoElement||I instanceof HTMLImageElement||I instanceof HTMLCanvasElement||I instanceof ImageData}function mr(I){var E,k,w;w=I instanceof HTMLImageElement||I instanceof HTMLCanvasElement||I instanceof HTMLVideoElement||I instanceof ImageData?I:we()(I)==="object"&&(I.elt instanceof HTMLImageElement||I.elt instanceof HTMLCanvasElement||I.elt instanceof HTMLVideoElement||I.elt instanceof ImageData)?I.elt:we()(I)==="object"&&I.canvas instanceof HTMLCanvasElement?I.canvas:I,E=w.width,k=w.height;var S=document.createElement("canvas");S.width=E,S.height=k;var z=S.getContext("2d");z.drawImage(w,0,0,E,k);var Y=z.getImageData(0,0,E,k);return Array.from(Y.data)}var xr={mobilenet:{version:2,alpha:1,topk:3}},gr=["mobilenet","darknet","darknet-tiny","doodlenet"],Qr=function(){function I(E,k,w,S){if(pe()(this,I),this.video=k,this.model=null,this.mapStringToIndex=[],typeof E=="string")if(gr.includes(E))switch(this.modelName=E,this.modelUrl=null,this.modelName){case"mobilenet":this.modelToUse=b,this.version=w.version||xr.mobilenet.version,this.alpha=w.alpha||xr.mobilenet.alpha,this.topk=w.topk||xr.mobilenet.topk;break;case"darknet":this.version="reference",this.modelToUse=H;break;case"darknet-tiny":this.version="tiny",this.modelToUse=H;break;case"doodlenet":this.modelToUse=U;break;default:this.modelToUse=null}else this.modelUrl=E,this.modelUrl.endsWith("/")&&(this.modelUrl+="model.json");this.ready=at(this.loadModel(this.modelUrl),S)}return Te()(I,[{key:"loadModel",value:function(){var E=K()(ke.a.mark(function k(w){return ke.a.wrap(function(S){for(;;)switch(S.prev=S.next){case 0:if(!w){S.next=6;break}return S.next=3,this.loadModelFrom(w);case 3:this.model=S.sent,S.next=9;break;case 6:return S.next=8,this.modelToUse.load({version:this.version,alpha:this.alpha});case 8:this.model=S.sent;case 9:return S.abrupt("return",this);case 10:case"end":return S.stop()}},k,this)}));return function(k){return E.apply(this,arguments)}}()},{key:"loadModelFrom",value:function(){var E=K()(ke.a.mark(function k(){var w,S,z,Y,ce,ve,De,Ce,Xe=arguments;return ke.a.wrap(function(tt){for(;;)switch(tt.prev=tt.next){case 0:if(w=Xe.length>0&&Xe[0]!==void 0?Xe[0]:null,tt.prev=1,w===null){tt.next=7;break}return tt.next=5,Gt.a.get(w);case 5:z=tt.sent,S=z.data;case 7:if(S.ml5Specs&&(this.mapStringToIndex=S.ml5Specs.mapStringToIndex),this.mapStringToIndex.length!==0){tt.next=16;break}return Y=w.split("/"),ce=Y.slice(0,Y.length-1).join("/"),ve="".concat(ce,"/metadata.json"),tt.next=14,Gt.a.get(ve).catch(function(kt){console.log("Tried to fetch metadata.json, but it seems to be missing.",kt)});case 14:(De=tt.sent)&&(Ce=De.data).labels&&(this.mapStringToIndex=Ce.labels);case 16:return tt.next=18,F.loadLayersModel(w);case 18:return this.model=tt.sent,tt.abrupt("return",this.model);case 22:return tt.prev=22,tt.t0=tt.catch(1),console.error(tt.t0),tt.abrupt("return",tt.t0);case 26:case"end":return tt.stop()}},k,this,[[1,22]])}));return function(){return E.apply(this,arguments)}}()},{key:"classifyInternal",value:function(){var E=K()(ke.a.mark(function k(w,S){var z,Y,ce,ve,De,Ce,Xe=this;return ke.a.wrap(function(tt){for(;;)switch(tt.prev=tt.next){case 0:return tt.next=2,this.ready;case 2:return tt.next=4,F.nextFrame();case 4:if(!(w instanceof HTMLVideoElement&&w.readyState===0)){tt.next=8;break}return z=w,tt.next=8,new Promise(function(kt){z.onloadeddata=function(){return kt()}});case 8:if(!this.video||this.video.readyState!==0){tt.next=11;break}return tt.next=11,new Promise(function(kt){Xe.video.onloadeddata=function(){return kt()}});case 11:if(Y=[224,224],!this.modelUrl){tt.next=20;break}return tt.next=15,F.nextFrame();case 15:return ce=F.tidy(function(){var kt=Gn(w,Y),At=Xe.model.predict(kt);return Array.from(At.as1D().dataSync())}),tt.next=18,ce.map(function(kt,At){return{label:Xe.mapStringToIndex.length>0&&Xe.mapStringToIndex[At]?Xe.mapStringToIndex[At]:At,confidence:kt}}).sort(function(kt,At){return At.confidence-kt.confidence});case 18:return ve=tt.sent,tt.abrupt("return",ve);case 20:return De=Gn(w,Y),Ce=this.model.classify(De,S).then(function(kt){return kt.map(function(At){return{label:At.className,confidence:At.probability}})}),De.dispose(),tt.abrupt("return",Ce);case 24:case"end":return tt.stop()}},k,this)}));return function(k,w){return E.apply(this,arguments)}}()},{key:"classify",value:function(){var E=K()(ke.a.mark(function k(w){var S,z,Y,ce,ve,De=arguments;return ke.a.wrap(function(Ce){for(;;)switch(Ce.prev=Ce.next){case 0:if(S=De.length>1&&De[1]!==void 0?De[1]:null,z=De.length>2?De[2]:void 0,Y=this.video,ce=this.topk,typeof w!="function"){Ce.next=9;break}Y=this.video,ve=w,Ce.next=28;break;case 9:if(typeof w!="number"){Ce.next=14;break}Y=this.video,ce=w,Ce.next=28;break;case 14:if(!(w instanceof HTMLVideoElement||w instanceof HTMLImageElement||w instanceof HTMLCanvasElement||w instanceof ImageData)){Ce.next=18;break}Y=w,Ce.next=28;break;case 18:if(we()(w)!=="object"||!(w.elt instanceof HTMLVideoElement||w.elt instanceof HTMLImageElement||w.elt instanceof HTMLCanvasElement||w.elt instanceof ImageData)){Ce.next=22;break}Y=w.elt,Ce.next=28;break;case 22:if(!(we()(w)==="object"&&w.canvas instanceof HTMLCanvasElement)){Ce.next=26;break}Y=w.canvas,Ce.next=28;break;case 26:if(this.video instanceof HTMLVideoElement){Ce.next=28;break}throw new Error("No input image provided. If you want to classify a video, pass the video element in the constructor. ");case 28:return typeof S=="number"?ce=S:typeof S=="function"&&(ve=S),typeof z=="function"&&(ve=z),Ce.abrupt("return",at(this.classifyInternal(Y,ce),ve));case 31:case"end":return Ce.stop()}},k,this)}));return function(k){return E.apply(this,arguments)}}()},{key:"predict",value:function(){var E=K()(ke.a.mark(function k(w,S,z){return ke.a.wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:return Y.abrupt("return",this.classify(w,S||null,z));case 1:case"end":return Y.stop()}},k,this)}));return function(k,w,S){return E.apply(this,arguments)}}()}]),I}(),ni=function(I,E,k,w){var S,z={},Y=w,ce=I;if(typeof ce!="string")throw new Error('Please specify a model to use. E.g: "MobileNet"');ce.indexOf("http")===-1&&(ce=I.toLowerCase()),E instanceof HTMLVideoElement?S=E:we()(E)==="object"&&E.elt instanceof HTMLVideoElement?S=E.elt:we()(E)==="object"?z=E:typeof E=="function"&&(Y=E),we()(k)==="object"?z=k:typeof k=="function"&&(Y=k);var ve=new Qr(ce,S,z,Y);return Y?ve:ve.ready},Mr=function(I,E){return(Mr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(k,w){k.__proto__=w}||function(k,w){for(var S in w)w.hasOwnProperty(S)&&(k[S]=w[S])})(I,E)},di=function(){return(di=Object.assign||function(I){for(var E,k=1,w=arguments.length;k<w;k++)for(var S in E=arguments[k])Object.prototype.hasOwnProperty.call(E,S)&&(I[S]=E[S]);return I}).apply(this,arguments)};function Yr(I,E,k,w){return new(k||(k=Promise))(function(S,z){function Y(De){try{ve(w.next(De))}catch(Ce){z(Ce)}}function ce(De){try{ve(w.throw(De))}catch(Ce){z(Ce)}}function ve(De){De.done?S(De.value):new k(function(Ce){Ce(De.value)}).then(Y,ce)}ve((w=w.apply(I,[])).next())})}function Xr(I,E){var k,w,S,z,Y={label:0,sent:function(){if(1&S[0])throw S[1];return S[1]},trys:[],ops:[]};return z={next:ce(0),throw:ce(1),return:ce(2)},typeof Symbol=="function"&&(z[Symbol.iterator]=function(){return this}),z;function ce(ve){return function(De){return function(Ce){if(k)throw new TypeError("Generator is already executing.");for(;Y;)try{if(k=1,w&&(S=2&Ce[0]?w.return:Ce[0]?w.throw||((S=w.return)&&S.call(w),0):w.next)&&!(S=S.call(w,Ce[1])).done)return S;switch(w=0,S&&(Ce=[2&Ce[0],S.value]),Ce[0]){case 0:case 1:S=Ce;break;case 4:return Y.label++,{value:Ce[1],done:!1};case 5:Y.label++,w=Ce[1],Ce=[0];continue;case 7:Ce=Y.ops.pop(),Y.trys.pop();continue;default:if(!(S=(S=Y.trys).length>0&&S[S.length-1])&&(Ce[0]===6||Ce[0]===2)){Y=0;continue}if(Ce[0]===3&&(!S||Ce[1]>S[0]&&Ce[1]<S[3])){Y.label=Ce[1];break}if(Ce[0]===6&&Y.label<S[1]){Y.label=S[1],S=Ce;break}if(S&&Y.label<S[2]){Y.label=S[2],Y.ops.push(Ce);break}S[2]&&Y.ops.pop(),Y.trys.pop();continue}Ce=E.call(I,Y)}catch(Xe){Ce=[6,Xe],w=0}finally{k=S=0}if(5&Ce[0])throw Ce[1];return{value:Ce[0]?Ce[1]:void 0,done:!0}}([ve,De])}}}function fi(I){var E=typeof Symbol=="function"&&I[Symbol.iterator],k=0;return E?E.call(I):{next:function(){return I&&k>=I.length&&(I=void 0),{value:I&&I[k++],done:!I}}}}function ai(I,E){var k=typeof Symbol=="function"&&I[Symbol.iterator];if(!k)return I;var w,S,z=k.call(I),Y=[];try{for(;(E===void 0||E-- >0)&&!(w=z.next()).done;)Y.push(w.value)}catch(ce){S={error:ce}}finally{try{w&&!w.done&&(k=z.return)&&k.call(z)}finally{if(S)throw S.error}}return Y}function Oa(){for(var I=[],E=0;E<arguments.length;E++)I=I.concat(ai(arguments[E]));return I}var Wi=null;function Ci(I){return Wi==null&&(Wi=Object(F.backend)().epsilon()),Object(F.tidy)(function(){var E=Object(F.moments)(I),k=E.mean,w=E.variance;return I.sub(k).div(w.sqrt().add(Wi))})}var yt=function(){function I(E){var k=this;if(E==null)throw new Error("Required configuration object is missing for BrowserFftFeatureExtractor constructor");if(E.spectrogramCallback==null)throw new Error("spectrogramCallback cannot be null or undefined");if(!(E.numFramesPerSpectrogram>0))throw new Error("Invalid value in numFramesPerSpectrogram: "+E.numFramesPerSpectrogram);if(E.suppressionTimeMillis<0)throw new Error("Expected suppressionTimeMillis to be >= 0, but got "+E.suppressionTimeMillis);if(this.suppressionTimeMillis=E.suppressionTimeMillis,this.spectrogramCallback=E.spectrogramCallback,this.numFrames=E.numFramesPerSpectrogram,this.sampleRateHz=E.sampleRateHz||44100,this.fftSize=E.fftSize||1024,this.frameDurationMillis=this.fftSize/this.sampleRateHz*1e3,this.columnTruncateLength=E.columnTruncateLength||this.fftSize,this.overlapFactor=E.overlapFactor,this.includeRawAudio=E.includeRawAudio,F.util.assert(this.overlapFactor>=0&&this.overlapFactor<1,function(){return"Expected overlapFactor to be >= 0 and < 1, but got "+k.overlapFactor}),this.columnTruncateLength>this.fftSize)throw new Error("columnTruncateLength "+this.columnTruncateLength+" exceeds fftSize ("+this.fftSize+").");this.audioContextConstructor=window.AudioContext||window.webkitAudioContext}return I.prototype.start=function(E){return Yr(this,void 0,void 0,function(){var k,w,S;return Xr(this,function(z){switch(z.label){case 0:if(this.frameIntervalTask!=null)throw new Error("Cannot start already-started BrowserFftFeatureExtractor");return k=this,[4,function(Y){return Yr(this,void 0,void 0,function(){return Xr(this,function(ce){switch(ce.label){case 0:return[4,navigator.mediaDevices.getUserMedia({audio:Y==null||Y,video:!1})];case 1:return[2,ce.sent()]}})})}(E)];case 1:return k.stream=z.sent(),this.audioContext=new this.audioContextConstructor,this.audioContext.sampleRate!==this.sampleRateHz&&console.warn("Mismatch in sampling rate: Expected: "+this.sampleRateHz+"; Actual: "+this.audioContext.sampleRate),w=this.audioContext.createMediaStreamSource(this.stream),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=2*this.fftSize,this.analyser.smoothingTimeConstant=0,w.connect(this.analyser),this.freqDataQueue=[],this.freqData=new Float32Array(this.fftSize),this.includeRawAudio&&(this.timeDataQueue=[],this.timeData=new Float32Array(this.fftSize)),S=Math.max(1,Math.round(this.numFrames*(1-this.overlapFactor))),this.tracker=new ge(S,Math.round(this.suppressionTimeMillis/this.frameDurationMillis)),this.frameIntervalTask=setInterval(this.onAudioFrame.bind(this),this.fftSize/this.sampleRateHz*1e3),[2]}})})},I.prototype.onAudioFrame=function(){return Yr(this,void 0,void 0,function(){var E,k,w,S;return Xr(this,function(z){switch(z.label){case 0:return this.analyser.getFloatFrequencyData(this.freqData),this.freqData[0]===-1/0?[2]:(this.freqDataQueue.push(this.freqData.slice(0,this.columnTruncateLength)),this.includeRawAudio&&(this.analyser.getFloatTimeDomainData(this.timeData),this.timeDataQueue.push(this.timeData.slice())),this.freqDataQueue.length>this.numFrames&&this.freqDataQueue.shift(),this.tracker.tick()?(E=Lr(this.freqDataQueue),k=jt(E,[1,this.numFrames,this.columnTruncateLength,1]),w=void 0,this.includeRawAudio&&(S=Lr(this.timeDataQueue),w=jt(S,[1,this.numFrames*this.fftSize])),[4,this.spectrogramCallback(k,w)]):[3,2]);case 1:z.sent()&&this.tracker.suppress(),Object(F.dispose)([k,w]),z.label=2;case 2:return[2]}})})},I.prototype.stop=function(){return Yr(this,void 0,void 0,function(){return Xr(this,function(E){if(this.frameIntervalTask==null)throw new Error("Cannot stop because there is no ongoing streaming activity.");return clearInterval(this.frameIntervalTask),this.frameIntervalTask=null,this.analyser.disconnect(),this.audioContext.close(),this.stream!=null&&this.stream.getTracks().length>0&&this.stream.getTracks()[0].stop(),[2]})})},I.prototype.setConfig=function(E){throw new Error("setConfig() is not implemented for BrowserFftFeatureExtractor.")},I.prototype.getFeatures=function(){throw new Error("getFeatures() is not implemented for BrowserFftFeatureExtractor. Use the spectrogramCallback field of the constructor config instead.")},I}();function Lr(I){var E=I[0].length,k=new Float32Array(I.length*E);return I.forEach(function(w,S){return k.set(w,S*E)}),k}function jt(I,E){var k=new Float32Array(F.util.sizeFromShape(E));return k.set(I,k.length-I.length),Object(F.tensor)(k,E)}var ge=function(){function I(E,k){var w=this;this.period=E,this.suppressionTime=k??0,this.counter=0,F.util.assert(this.period>0,function(){return"Expected period to be positive, but got "+w.period})}return I.prototype.tick=function(){return this.counter++,this.counter%this.period==0&&(this.suppressionOnset==null||this.counter-this.suppressionOnset>this.suppressionTime)},I.prototype.suppress=function(){this.suppressionOnset=this.counter},I}();function fe(I){var E=0;I.forEach(function(S){E+=S.byteLength});var k=new Uint8Array(E),w=0;return I.forEach(function(S){k.set(new Uint8Array(S),w),w+=S.byteLength}),k.buffer}function ye(I){var E=0;I.forEach(function(S){return E+=S.length});var k=new Float32Array(E),w=0;return I.forEach(function(S){k.set(S,w),w+=S.length}),k}function Se(I){if(I==null)throw new Error("Received null or undefind string");for(var E=unescape(encodeURIComponent(I)),k=new Uint8Array(E.length),w=0;w<E.length;++w)k[w]=E.charCodeAt(w);return k.buffer}function Ze(I){if(I==null)throw new Error("Received null or undefind buffer");var E=new Uint8Array(I);return decodeURIComponent(escape(String.fromCharCode.apply(String,Oa(E))))}var mt="TFJSSCDS",Rt=1,cn=function(){function I(E){if(this.examples={},this.label2Ids={},E!=null)for(var k=function(ce){F.util.assert(ce!=null,function(){return"Received null or undefined buffer"});var ve=0,De=Ze(ce.slice(ve,mt.length));F.util.assert(De===mt,function(){return"Deserialization error: Invalid descriptor"}),ve+=mt.length,ve+=4;var Ce=new Uint32Array(ce,ve,1),Xe=ve+=4;ve=Xe+Ce[0];var tt=Ze(ce.slice(Xe,ve));return{manifest:JSON.parse(tt),data:ce.slice(ve)}}(E),w=0,S=0;S<k.manifest.length;++S){var z=k.manifest[S],Y=z.spectrogramNumFrames*z.spectrogramFrameSize;z.rawAudioNumSamples!=null&&(Y+=z.rawAudioNumSamples),Y*=4,this.addExample(An({spec:z,data:k.data.slice(w,w+Y)})),w+=Y}}return I.prototype.addExample=function(E){F.util.assert(E!=null,function(){return"Got null or undefined example"}),F.util.assert(E.label!=null&&E.label.length>0,function(){return"Expected label to be a non-empty string, but got "+JSON.stringify(E.label)});var k=function(){function w(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return w()+w()+"-"+w()+"-"+w()+"-"+w()+"-"+w()+w()+w()}();return this.examples[k]=E,E.label in this.label2Ids||(this.label2Ids[E.label]=[]),this.label2Ids[E.label].push(k),k},I.prototype.merge=function(E){var k,w,S,z;F.util.assert(E!==this,function(){return"Cannot merge a dataset into itself"});var Y=E.getVocabulary();try{for(var ce=fi(Y),ve=ce.next();!ve.done;ve=ce.next()){var De=ve.value,Ce=E.getExamples(De);try{for(var Xe=fi(Ce),tt=Xe.next();!tt.done;tt=Xe.next()){var kt=tt.value;this.addExample(kt.example)}}catch(At){S={error:At}}finally{try{tt&&!tt.done&&(z=Xe.return)&&z.call(Xe)}finally{if(S)throw S.error}}}}catch(At){k={error:At}}finally{try{ve&&!ve.done&&(w=ce.return)&&w.call(ce)}finally{if(k)throw k.error}}},I.prototype.getExampleCounts=function(){var E={};for(var k in this.examples){var w=this.examples[k];w.label in E||(E[w.label]=0),E[w.label]++}return E},I.prototype.getExamples=function(E){var k=this;F.util.assert(E!=null,function(){return"Expected label to be a string, but got "+JSON.stringify(E)}),F.util.assert(E in this.label2Ids,function(){return'No example of label "'+E+'" exists in dataset'});var w=[];return this.label2Ids[E].forEach(function(S){w.push({uid:S,example:k.examples[S]})}),w},I.prototype.getData=function(E,k){var w=this;F.util.assert(this.size()>0,function(){return"Cannot get spectrograms as tensors because the dataset is empty"});var S=this.getVocabulary();E!=null?F.util.assert(S.indexOf(E)!==-1,function(){return"Label "+E+" is not in the vocabulary ("+JSON.stringify(S)+")"}):F.util.assert(S.length>1,function(){return"One-hot encoding of labels requires the vocabulary to have at least two words, but it has only "+S.length+" word."}),k==null&&(k={});var z,Y,ce=this.getSortedUniqueNumFrames();ce.length===1?(z=k.numFrames==null?ce[0]:k.numFrames,Y=k.hopFrames==null?1:k.hopFrames):(z=k.numFrames,F.util.assert(z!=null&&Number.isInteger(z)&&z>0,function(){return"There are "+ce.length+" unique lengths among the "+w.size()+" examples of this Dataset, hence numFrames is required. But it is not provided."}),F.util.assert(z<=ce[0],function(){return"numFrames ("+z+") exceeds the minimum numFrames ("+ce[0]+") among the examples of the Dataset."}),Y=k.hopFrames,F.util.assert(Y!=null&&Number.isInteger(Y)&&Y>0,function(){return"There are "+ce.length+" unique lengths among the "+w.size()+" examples of this Dataset, hence hopFrames is required. But it is not provided."}));var ve=k.normalize==null||k.normalize;return Object(F.tidy)(function(){for(var De,Ce,Xe,tt=[],kt=[],At=[],tn=0;tn<S.length;++tn){var sn=S[tn];if(E==null||sn===E){var wn=w.label2Ids[sn],En=function(Ti){var Ho,Yo,Xs=w.examples[Ti].spectrogram,Ds=Xs.frameSize;Xe==null?Xe=Ds:F.util.assert(Ds===Xe,function(){return"Mismatch in frameSize  ("+Ds+" vs "+Xe+")"});var du=Xs.data.length/Ds,Iu=null;sn!=="_background_noise_"&&(Iu=Xs.keyFrameIndex==null?Hn(Xs).dataSync()[0]:Xs.keyFrameIndex);var pu=Object(F.tensor3d)(Xs.data,[du,Ds,1]),od=Ln(du,Iu,z,Y),rh=function(dl){var Gu=Object(F.tidy)(function(){var jo=pu.slice([dl[0],0,0],[dl[1]-dl[0],-1,-1]);return ve?Ci(jo):jo});k.getDataset?kt.push(Gu.dataSync()):tt.push(Gu),E==null&&At.push(tn)};try{for(var hl=fi(od),tf=hl.next();!tf.done;tf=hl.next())rh(tf.value)}catch(dl){Ho={error:dl}}finally{try{tf&&!tf.done&&(Yo=hl.return)&&Yo.call(hl)}finally{if(Ho)throw Ho.error}}Object(F.dispose)(pu)};try{for(var Tn=fi(wn),Pn=Tn.next();!Pn.done;Pn=Tn.next())En(Pn.value)}catch(Ti){De={error:Ti}}finally{try{Pn&&!Pn.done&&(Ce=Tn.return)&&Ce.call(Tn)}finally{if(De)throw De.error}}}}k.augmentByMixingNoiseRatio!=null&&w.augmentByMixingNoise(k.getDataset?kt:tt,At,k.augmentByMixingNoiseRatio);var dn=k.shuffle==null||k.shuffle;if(k.getDataset){var cr=k.datasetBatchSize==null?32:k.datasetBatchSize,kr=k.datasetValidationSplit==null?.15:k.datasetValidationSplit;F.util.assert(kr>0&&kr<1,function(){return"Invalid dataset validation split: "+kr});var yr=kt.map(function(Ti,Ho){return[Ti,At[Ho]]});F.util.shuffle(yr),kt=yr.map(function(Ti){return Ti[0]});var Br=yr.map(function(Ti){return Ti[1]}),_r=function(Ti,Ho,Yo){var Xs,Ds,du,Iu,pu,od,rh,hl;F.util.assert(Yo>0&&Yo<1,function(){return"validationSplit is expected to be >0 and <1, but got "+Yo});for(var tf=!Array.isArray(Ti[0]),dl=Ho,Gu=[],jo=0;jo<dl.length;++jo){var nf=dl[jo];Gu[nf]==null&&(Gu[nf]=[]),Gu[nf].push(jo)}var ih=Gu.length,sd=[],rf=[];for(Gu.map(function(ru){return F.util.shuffle(ru)}),jo=0;jo<ih;++jo)for(var ds=Gu[jo],ah=Math.round(ds.length*(1-Yo)),ud=0;ud<ds.length;++ud)ud<ah?sd.push(ds[ud]):rf.push(ds[ud]);if(tf){var cd=[],jc=[],xp=[],Ku=[];try{for(var Ts=fi(sd),Fu=Ts.next();!Fu.done;Fu=Ts.next()){var ps=Fu.value;cd.push(Ti[ps]),jc.push(Ho[ps])}}catch(ru){Xs={error:ru}}finally{try{Fu&&!Fu.done&&(Ds=Ts.return)&&Ds.call(Ts)}finally{if(Xs)throw Xs.error}}try{for(var pl=fi(rf),oh=pl.next();!oh.done;oh=pl.next())ps=oh.value,xp.push(Ti[ps]),Ku.push(Ho[ps])}catch(ru){du={error:ru}}finally{try{oh&&!oh.done&&(Iu=pl.return)&&Iu.call(pl)}finally{if(du)throw du.error}}return{trainXs:cd,trainYs:jc,valXs:xp,valYs:Ku}}cd=[],jc=[],xp=[],Ku=[];try{for(var ld=fi(sd),sh=ld.next();!sh.done;sh=ld.next())ps=sh.value,cd.push(Ti[ps]),jc.push(Ho[ps])}catch(ru){pu={error:ru}}finally{try{sh&&!sh.done&&(od=ld.return)&&od.call(ld)}finally{if(pu)throw pu.error}}try{for(var wp=fi(rf),ml=wp.next();!ml.done;ml=wp.next())ps=ml.value,xp.push(Ti[ps]),Ku.push(Ho[ps])}catch(ru){rh={error:ru}}finally{try{ml&&!ml.done&&(hl=wp.return)&&hl.call(wp)}finally{if(rh)throw rh.error}}return{trainXs:cd,trainYs:jc,valXs:xp,valYs:Ku}}(kt,Br,kr),hi=_r.trainXs,Ei=_r.trainYs,xi=_r.valXs,ya=_r.valYs,Ua=F.data.array(hi).map(function(Ti){return Object(F.tensor3d)(Ti,[z,Xe,1])}),Ta=F.data.array(Ei).map(function(Ti){return Object(F.oneHot)([Ti],S.length).squeeze([0])}),Da=F.data.zip({xs:Ua,ys:Ta});dn&&(Da=Da.shuffle(kt.length)),Da=Da.batch(cr).prefetch(4);var Ra=F.data.array(xi).map(function(Ti){return Object(F.tensor3d)(Ti,[z,Xe,1])}),Qa=F.data.array(ya).map(function(Ti){return Object(F.oneHot)([Ti],S.length).squeeze([0])}),oo=F.data.zip({xs:Ra,ys:Qa});return[Da,oo=oo.batch(cr).prefetch(4)]}if(dn){var wo=[];tt.forEach(function(Ti,Ho){wo.push({x:Ti,y:At[Ho]})}),F.util.shuffle(wo),tt=wo.map(function(Ti){return Ti.x}),At=wo.map(function(Ti){return Ti.y})}var Ks=E==null?Object(F.oneHot)(Object(F.tensor1d)(At,"int32"),S.length).asType("float32"):void 0;return{xs:Object(F.stack)(tt),ys:Ks}})},I.prototype.augmentByMixingNoise=function(E,k,w){var S,z;if(E==null||E.length===0)throw new Error("Cannot perform augmentation because data is null or empty");for(var Y=E[0]instanceof Float32Array,ce=this.getVocabulary(),ve=[],De=[],Ce=0;Ce<k.length;++Ce)ce[k[Ce]]==="_background_noise_"?ve.push(Ce):De.push(Ce);if(ve.length===0)throw new Error("Cannot perform augmentation by mixing with noise when there is no example with label _background_noise_");var Xe=[],tt=[],kt=function(sn){var wn=ve[function(dn,cr){return Math.floor((cr-dn)*Math.random())+dn}(0,ve.length)],En=Y?Object(F.tensor1d)(E[sn]):E[sn],Tn=Y?Object(F.tensor1d)(E[wn]):E[wn],Pn=Object(F.tidy)(function(){return Ci(En.add(Tn.mul(w)))});Y?Xe.push(Pn.dataSync()):Xe.push(Pn),tt.push(k[sn])};try{for(var At=fi(De),tn=At.next();!tn.done;tn=At.next())kt(tn.value)}catch(sn){S={error:sn}}finally{try{tn&&!tn.done&&(z=At.return)&&z.call(At)}finally{if(S)throw S.error}}console.log("Data augmentation: mixing noise: added "+Xe.length+" examples"),Xe.forEach(function(sn){return E.push(sn)}),k.push.apply(k,Oa(tt))},I.prototype.getSortedUniqueNumFrames=function(){for(var E,k,w=new Set,S=this.getVocabulary(),z=0;z<S.length;++z){var Y=S[z],ce=this.label2Ids[Y];try{for(var ve=fi(ce),De=ve.next();!De.done;De=ve.next()){var Ce=De.value,Xe=this.examples[Ce].spectrogram,tt=Xe.data.length/Xe.frameSize;w.add(tt)}}catch(At){E={error:At}}finally{try{De&&!De.done&&(k=ve.return)&&k.call(ve)}finally{if(E)throw E.error}}}var kt=Oa(w);return kt.sort(),kt},I.prototype.removeExample=function(E){if(!(E in this.examples))throw new Error("Nonexistent example UID: "+E);var k=this.examples[E].label;delete this.examples[E];var w=this.label2Ids[k].indexOf(E);this.label2Ids[k].splice(w,1),this.label2Ids[k].length===0&&delete this.label2Ids[k]},I.prototype.setExampleKeyFrameIndex=function(E,k){if(!(E in this.examples))throw new Error("Nonexistent example UID: "+E);var w=this.examples[E].spectrogram,S=w.data.length/w.frameSize;F.util.assert(k>=0&&k<S&&Number.isInteger(k),function(){return"Invalid keyFrameIndex: "+k+". Must be >= 0, < "+S+", and an integer."}),w.keyFrameIndex=k},I.prototype.size=function(){return Object.keys(this.examples).length},I.prototype.durationMillis=function(){var E=0;for(var k in this.examples){var w=this.examples[k].spectrogram,S=23.22|w.frameDurationMillis;E+=w.data.length/w.frameSize*S}return E},I.prototype.empty=function(){return this.size()===0},I.prototype.clear=function(){this.examples={}},I.prototype.getVocabulary=function(){var E=new Set;for(var k in this.examples){var w=this.examples[k];E.add(w.label)}var S=Oa(E);return S.sort(),S},I.prototype.serialize=function(E){var k,w,S,z,Y=this.getVocabulary();F.util.assert(!this.empty(),function(){return"Cannot serialize empty Dataset"}),E!=null&&(Array.isArray(E)||(E=[E]),E.forEach(function(wn){if(Y.indexOf(wn)===-1)throw new Error('Word label "'+wn+'" does not exist in the vocabulary of this dataset. The vocabulary is: '+JSON.stringify(Y)+".")}));var ce=[],ve=[];try{for(var De=fi(Y),Ce=De.next();!Ce.done;Ce=De.next()){var Xe=Ce.value;if(E==null||E.indexOf(Xe)!==-1){var tt=this.label2Ids[Xe];try{for(var kt=fi(tt),At=kt.next();!At.done;At=kt.next()){var tn=At.value,sn=Jn(this.examples[tn]);ce.push(sn.spec),ve.push(sn.data)}}catch(wn){S={error:wn}}finally{try{At&&!At.done&&(z=kt.return)&&z.call(kt)}finally{if(S)throw S.error}}}}}catch(wn){k={error:wn}}finally{try{Ce&&!Ce.done&&(w=De.return)&&w.call(De)}finally{if(k)throw k.error}}return function(wn){var En=Se(JSON.stringify(wn.manifest)),Tn=Se(mt),Pn=new Uint32Array([Rt]),dn=new Uint32Array([En.byteLength]);return fe([fe([Tn,Pn.buffer,dn.buffer]),En,wn.data])}({manifest:ce,data:fe(ve)})},I}();function Jn(I){var E=I.rawAudio!=null,k={label:I.label,spectrogramNumFrames:I.spectrogram.data.length/I.spectrogram.frameSize,spectrogramFrameSize:I.spectrogram.frameSize};I.spectrogram.keyFrameIndex!=null&&(k.spectrogramKeyFrameIndex=I.spectrogram.keyFrameIndex);var w=I.spectrogram.data.buffer.slice(0);return E&&(k.rawAudioNumSamples=I.rawAudio.data.length,k.rawAudioSampleRateHz=I.rawAudio.sampleRateHz,w=fe([w,I.rawAudio.data.buffer])),{spec:k,data:w}}function An(I){var E={frameSize:I.spec.spectrogramFrameSize,data:new Float32Array(I.data.slice(0,4*I.spec.spectrogramFrameSize*I.spec.spectrogramNumFrames))};I.spec.spectrogramKeyFrameIndex!=null&&(E.keyFrameIndex=I.spec.spectrogramKeyFrameIndex);var k={label:I.spec.label,spectrogram:E};return I.spec.rawAudioNumSamples!=null&&(k.rawAudio={sampleRateHz:I.spec.rawAudioSampleRateHz,data:new Float32Array(I.data.slice(4*I.spec.spectrogramFrameSize*I.spec.spectrogramNumFrames))}),k}function Ln(I,E,k,w){if(F.util.assert(Number.isInteger(I)&&I>0,function(){return"snippetLength must be a positive integer, but got "+I}),E!=null&&F.util.assert(Number.isInteger(E)&&E>=0,function(){return"focusIndex must be a non-negative integer, but got "+E}),F.util.assert(Number.isInteger(k)&&k>0,function(){return"windowLength must be a positive integer, but got "+k}),F.util.assert(Number.isInteger(w)&&w>0,function(){return"windowHop must be a positive integer, but got "+w}),F.util.assert(k<=I,function(){return"windowLength ("+k+") exceeds snippetLength ("+I+")"}),F.util.assert(E<I,function(){return"focusIndex ("+E+") equals or exceeds snippetLength ("+I+")"}),k===I)return[[0,I]];var S=[];if(E==null){for(var z=0;z+k<=I;)S.push([z,z+k]),z+=w;return S}var Y=Math.floor(k/2),ce=E-Y;for(ce<0?ce=0:ce+k>I&&(ce=I-k);!(ce-w<0||E>=ce-w+k);)ce-=w;for(;ce+k<=I&&!(E<ce);)S.push([ce,ce+k]),ce+=w;return S}function Hn(I){return Object(F.tidy)(function(){return function(E){return Object(F.tidy)(function(){var k=E.data.length/E.frameSize;return Object(F.tensor2d)(E.data,[k,E.frameSize]).mean(-1)})}(I).argMax()})}var It="0.3.9",Ot="tfjs-speech-commands-saved-model-metadata",pn="indexeddb://tfjs-speech-commands-model/",qt={localStorage:typeof window>"u"?null:window.localStorage},Ve=function(){function I(E,k,w){this.MODEL_URL_PREFIX="https://storage.googleapis.com/tfjs-models/tfjs/speech-commands/v"+function(S){return S.split(".").slice(0,2).join(".")}(It)+"/browser_fft",this.SAMPLE_RATE_HZ=44100,this.FFT_SIZE=1024,this.DEFAULT_SUPPRESSION_TIME_MILLIS=0,this.streaming=!1,this.transferRecognizers={},F.util.assert(k==null&&w==null||k!=null&&w!=null,function(){return"modelURL and metadataURL must be both provided or both not provided."}),k==null?(E==null?E=I.DEFAULT_VOCABULARY_NAME:F.util.assert(I.VALID_VOCABULARY_NAMES.indexOf(E)!==-1,function(){return"Invalid vocabulary name: '"+E+"'"}),this.vocabulary=E,this.modelArtifactsOrURL=this.MODEL_URL_PREFIX+"/"+this.vocabulary+"/model.json",this.metadataOrURL=this.MODEL_URL_PREFIX+"/"+this.vocabulary+"/metadata.json"):(F.util.assert(E==null,function(){return"vocabulary name must be null or undefined when modelURL is provided"}),this.modelArtifactsOrURL=k,this.metadataOrURL=w),this.parameters={sampleRateHz:this.SAMPLE_RATE_HZ,fftSize:this.FFT_SIZE}}return I.prototype.listen=function(E,k){return Yr(this,void 0,void 0,function(){var w,S,z,Y,ce,ve=this;return Xr(this,function(De){switch(De.label){case 0:if(this.streaming)throw new Error("Cannot start streaming again when streaming is ongoing.");return[4,this.ensureModelLoaded()];case 1:if(De.sent(),k==null&&(k={}),w=k.probabilityThreshold==null?0:k.probabilityThreshold,k.includeEmbedding&&(w=0),F.util.assert(w>=0&&w<=1,function(){return"Invalid probabilityThreshold value: "+w}),S=k.invokeCallbackOnNoiseAndUnknown!=null&&k.invokeCallbackOnNoiseAndUnknown,k.includeEmbedding&&(S=!0),k.suppressionTimeMillis<0)throw new Error("suppressionTimeMillis is expected to be >= 0, but got "+k.suppressionTimeMillis);return z=k.overlapFactor==null?.5:k.overlapFactor,F.util.assert(z>=0&&z<1,function(){return"Expected overlapFactor to be >= 0 and < 1, but got "+z}),Y=function(Ce,Xe){return Yr(ve,void 0,void 0,function(){var tt,kt,At,tn,sn,wn,En,Tn,Pn,dn,cr;return Xr(this,function(kr){switch(kr.label){case 0:return kt=Ci(Ce),k.includeEmbedding?[4,this.ensureModelWithEmbeddingOutputCreated()]:[3,2];case 1:return kr.sent(),tt=ai(this.modelWithEmbeddingOutput.predict(kt),2),At=tt[0],tn=tt[1],[3,3];case 2:At=this.model.predict(kt),kr.label=3;case 3:return[4,At.data()];case 4:return sn=kr.sent(),[4,(wn=At.argMax(-1)).data()];case 5:return En=kr.sent()[0],Tn=Math.max.apply(Math,Oa(sn)),Object(F.dispose)([At,wn,kt]),Tn<w?[2,!1]:[3,6];case 6:return Pn=void 0,k.includeSpectrogram?(dn={},[4,Ce.data()]):[3,8];case 7:dn.data=kr.sent(),dn.frameSize=this.nonBatchInputShape[1],Pn=dn,kr.label=8;case 8:return cr=!0,S||this.words[En]!=="_background_noise_"&&this.words[En]!=="_unknown_"||(cr=!1),cr&&E({scores:sn,spectrogram:Pn,embedding:tn}),[2,cr]}})})},ce=k.suppressionTimeMillis==null?this.DEFAULT_SUPPRESSION_TIME_MILLIS:k.suppressionTimeMillis,this.audioDataExtractor=new yt({sampleRateHz:this.parameters.sampleRateHz,numFramesPerSpectrogram:this.nonBatchInputShape[0],columnTruncateLength:this.nonBatchInputShape[1],suppressionTimeMillis:ce,spectrogramCallback:Y,overlapFactor:z}),[4,this.audioDataExtractor.start(k.audioTrackConstraints)];case 2:return De.sent(),this.streaming=!0,[2]}})})},I.prototype.ensureModelLoaded=function(){return Yr(this,void 0,void 0,function(){var E,k,w,S,z=this;return Xr(this,function(Y){switch(Y.label){case 0:return this.model!=null?[2]:[4,this.ensureMetadataLoaded()];case 1:return Y.sent(),typeof this.modelArtifactsOrURL!="string"?[3,3]:[4,Object(F.loadLayersModel)(this.modelArtifactsOrURL)];case 2:return E=Y.sent(),[3,5];case 3:return[4,Object(F.loadLayersModel)(F.io.fromMemory(this.modelArtifactsOrURL.modelTopology,this.modelArtifactsOrURL.weightSpecs,this.modelArtifactsOrURL.weightData))];case 4:E=Y.sent(),Y.label=5;case 5:if(E.inputs.length!==1)throw new Error("Expected model to have 1 input, but got a model with "+E.inputs.length+" inputs");if(E.inputs[0].shape.length!==4)throw new Error("Expected model to have an input shape of rank 4, but got an input shape of rank "+E.inputs[0].shape.length);if(E.inputs[0].shape[3]!==1)throw new Error("Expected model to have an input shape with 1 as the last dimension, but got input shape"+JSON.stringify(E.inputs[0].shape[3])+"}");if((k=E.outputShape).length!==2)throw new Error("Expected loaded model to have an output shape of rank 2,but received shape "+JSON.stringify(k));if(k[1]!==this.words.length)throw new Error("Mismatch between the last dimension of model's output shape ("+k[1]+") and number of words ("+this.words.length+").");return this.model=E,this.freezeModel(),this.nonBatchInputShape=E.inputs[0].shape.slice(1),this.elementsPerExample=1,E.inputs[0].shape.slice(1).forEach(function(ce){return z.elementsPerExample*=ce}),this.warmUpModel(),w=this.parameters.fftSize/this.parameters.sampleRateHz*1e3,S=E.inputs[0].shape[1],this.parameters.spectrogramDurationMillis=S*w,[2]}})})},I.prototype.ensureModelWithEmbeddingOutputCreated=function(){return Yr(this,void 0,void 0,function(){var E,k;return Xr(this,function(w){switch(w.label){case 0:return this.modelWithEmbeddingOutput!=null?[2]:[4,this.ensureModelLoaded()];case 1:for(w.sent(),k=this.model.layers.length-2;k>=0;--k)if(this.model.layers[k].getClassName()==="Dense"){E=this.model.layers[k];break}if(E==null)throw new Error("Failed to find second last dense layer in the original model.");return this.modelWithEmbeddingOutput=Object(F.model)({inputs:this.model.inputs,outputs:[this.model.outputs[0],E.output]}),[2]}})})},I.prototype.warmUpModel=function(){var E=this;Object(F.tidy)(function(){for(var k=Object(F.zeros)([1].concat(E.nonBatchInputShape)),w=0;w<3;++w)E.model.predict(k)})},I.prototype.ensureMetadataLoaded=function(){return Yr(this,void 0,void 0,function(){var E,k,w;return Xr(this,function(S){switch(S.label){case 0:return this.words!=null?[2]:typeof this.metadataOrURL!="string"?[3,2]:[4,function(z){return Yr(this,void 0,void 0,function(){return Xr(this,function(Y){return[2,new Promise(function(ce,ve){z.indexOf("http://")===0||z.indexOf("https://")===0?fetch(z).then(function(De){De.json().then(function(Ce){return ce(Ce)})}):z.indexOf("file://")===0?o(185).readFile(z.slice(7),{encoding:"utf-8"},function(De,Ce){return ce(JSON.parse(Ce))}):ve(new Error("Unsupported URL scheme in metadata URL: "+z+". Supported schemes are: http://, https://, and (node.js-only) file://"))})]})})}(this.metadataOrURL)];case 1:return k=S.sent(),[3,3];case 2:k=this.metadataOrURL,S.label=3;case 3:if((E=k).wordLabels==null){if((w=E.words)==null)throw new Error('Cannot find field "words" or "wordLabels" in metadata JSON file');this.words=w}else this.words=E.wordLabels;return[2]}})})},I.prototype.stopListening=function(){return Yr(this,void 0,void 0,function(){return Xr(this,function(E){switch(E.label){case 0:if(!this.streaming)throw new Error("Cannot stop streaming when streaming is not ongoing.");return[4,this.audioDataExtractor.stop()];case 1:return E.sent(),this.streaming=!1,[2]}})})},I.prototype.isListening=function(){return this.streaming},I.prototype.wordLabels=function(){return this.words},I.prototype.params=function(){return this.parameters},I.prototype.modelInputShape=function(){if(this.model==null)throw new Error("Model has not been loaded yet. Load model by calling ensureModelLoaded(), recognize(), or listen().");return this.model.inputs[0].shape},I.prototype.recognize=function(E,k){return Yr(this,void 0,void 0,function(){var w,S,z,Y,ce,ve,De,Ce,Xe,tt,kt,At,tn;return Xr(this,function(sn){switch(sn.label){case 0:return k==null&&(k={}),[4,this.ensureModelLoaded()];case 1:return sn.sent(),E!=null?[3,3]:[4,this.recognizeOnline()];case 2:w=sn.sent(),E=w.data,sn.label=3;case 3:if(E instanceof F.Tensor)this.checkInputTensorShape(E),z=E,S=E.shape[0];else{if((E=E).length%this.elementsPerExample)throw new Error("The length of the input Float32Array "+E.length+" is not divisible by the number of tensor elements per per example expected by the model "+this.elementsPerExample+".");S=E.length/this.elementsPerExample,z=Object(F.tensor4d)(E,[S].concat(this.nonBatchInputShape))}return ce={scores:null},k.includeEmbedding?[4,this.ensureModelWithEmbeddingOutputCreated()]:[3,5];case 4:return sn.sent(),ve=this.modelWithEmbeddingOutput.predict(z),Y=ve[0],ce.embedding=ve[1],[3,6];case 5:Y=this.model.predict(z),sn.label=6;case 6:return S!==1?[3,8]:(De=ce,[4,Y.data()]);case 7:return De.scores=sn.sent(),[3,10];case 8:return Ce=Object(F.unstack)(Y),Xe=Ce.map(function(wn){return wn.data()}),tt=ce,[4,Promise.all(Xe)];case 9:tt.scores=sn.sent(),Object(F.dispose)(Ce),sn.label=10;case 10:return k.includeSpectrogram?(kt=ce,At={},E instanceof F.Tensor?[4,E.data()]:[3,12]):[3,14];case 11:return tn=sn.sent(),[3,13];case 12:tn=E,sn.label=13;case 13:kt.spectrogram=(At.data=tn,At.frameSize=this.nonBatchInputShape[1],At),sn.label=14;case 14:return[2,ce]}})})},I.prototype.recognizeOnline=function(){return Yr(this,void 0,void 0,function(){var E=this;return Xr(this,function(k){return[2,new Promise(function(w,S){E.audioDataExtractor=new yt({sampleRateHz:E.parameters.sampleRateHz,numFramesPerSpectrogram:E.nonBatchInputShape[0],columnTruncateLength:E.nonBatchInputShape[1],suppressionTimeMillis:0,spectrogramCallback:function(z){return Yr(E,void 0,void 0,function(){var Y,ce,ve;return Xr(this,function(De){switch(De.label){case 0:return Y=Ci(z),[4,this.audioDataExtractor.stop()];case 1:return De.sent(),ce=w,ve={},[4,Y.data()];case 2:return ce.apply(void 0,[(ve.data=De.sent(),ve.frameSize=this.nonBatchInputShape[1],ve)]),Y.dispose(),[2,!1]}})})},overlapFactor:0}),E.audioDataExtractor.start()})]})})},I.prototype.createTransfer=function(E){if(this.model==null)throw new Error("Model has not been loaded yet. Load model by calling ensureModelLoaded(), recognizer(), or listen().");F.util.assert(E!=null&&typeof E=="string"&&E.length>1,function(){return"Expected the name for a transfer-learning recognized to be a non-empty string, but got "+JSON.stringify(E)}),F.util.assert(this.transferRecognizers[E]==null,function(){return"There is already a transfer-learning model named '"+E+"'"});var k=new jn(E,this.parameters,this.model);return this.transferRecognizers[E]=k,k},I.prototype.freezeModel=function(){var E,k;try{for(var w=fi(this.model.layers),S=w.next();!S.done;S=w.next())S.value.trainable=!1}catch(z){E={error:z}}finally{try{S&&!S.done&&(k=w.return)&&k.call(w)}finally{if(E)throw E.error}}},I.prototype.checkInputTensorShape=function(E){var k=this.model.inputs[0].shape.length;if(E.shape.length!==k)throw new Error("Expected input Tensor to have rank "+k+", but got rank "+E.shape.length+" that differs ");var w=E.shape.slice(1),S=this.model.inputs[0].shape.slice(1);if(!F.util.arraysEqual(w,S))throw new Error("Expected input to have shape [null,"+S+"], but got shape [null,"+w+"]")},I.VALID_VOCABULARY_NAMES=["18w","directional4w"],I.DEFAULT_VOCABULARY_NAME="18w",I}(),jn=function(I){function E(k,w,S){var z=I.call(this)||this;return z.name=k,z.parameters=w,z.baseModel=S,F.util.assert(k!=null&&typeof k=="string"&&k.length>0,function(){return"The name of a transfer model must be a non-empty string, but got "+JSON.stringify(k)}),z.nonBatchInputShape=z.baseModel.inputs[0].shape.slice(1),z.words=null,z.dataset=new cn,z}return function(k,w){function S(){this.constructor=k}Mr(k,w),k.prototype=w===null?Object.create(w):(S.prototype=w.prototype,new S)}(E,I),E.prototype.collectExample=function(k,w){return Yr(this,void 0,void 0,function(){var S,z,Y,ce,ve=this;return Xr(this,function(De){if(F.util.assert(!this.streaming,function(){return"Cannot start collection of transfer-learning example because a streaming recognition or transfer-learning example collection is ongoing"}),F.util.assert(k!=null&&typeof k=="string"&&k.length>0,function(){return"Must provide a non-empty string when collecting transfer-learning example"}),w==null&&(w={}),w.durationMultiplier!=null&&w.durationSec!=null)throw new Error("durationMultiplier and durationSec are mutually exclusive, but are both specified.");return w.durationSec!=null?(F.util.assert(w.durationSec>0,function(){return"Expected durationSec to be > 0, but got "+w.durationSec}),z=this.parameters.fftSize/this.parameters.sampleRateHz,S=Math.ceil(w.durationSec/z)):w.durationMultiplier!=null?(F.util.assert(w.durationMultiplier>=1,function(){return"Expected duration multiplier to be >= 1, but got "+w.durationMultiplier}),S=Math.round(this.nonBatchInputShape[0]*w.durationMultiplier)):S=this.nonBatchInputShape[0],w.snippetDurationSec!=null&&(F.util.assert(w.snippetDurationSec>0,function(){return"snippetDurationSec is expected to be > 0, but got "+w.snippetDurationSec}),F.util.assert(w.onSnippet!=null,function(){return"onSnippet must be provided if snippetDurationSec is provided."})),w.onSnippet!=null&&F.util.assert(w.snippetDurationSec!=null,function(){return"snippetDurationSec must be provided if onSnippet is provided."}),Y=this.parameters.fftSize/this.parameters.sampleRateHz,ce=Y*S,this.streaming=!0,[2,new Promise(function(Ce){var Xe=w.snippetDurationSec==null?1:w.snippetDurationSec/ce,tt=1-Xe,kt=Math.round(1/Xe),At=0,tn=-1,sn=[];ve.audioDataExtractor=new yt({sampleRateHz:ve.parameters.sampleRateHz,numFramesPerSpectrogram:S,columnTruncateLength:ve.nonBatchInputShape[1],suppressionTimeMillis:0,spectrogramCallback:function(wn,En){return Yr(ve,void 0,void 0,function(){var Tn,Pn,dn,cr,kr,yr,Br,_r,hi,Ei,xi,ya,Ua,Ta,Da,Ra,Qa,oo,wo,Ks;return Xr(this,function(Ti){switch(Ti.label){case 0:return w.onSnippet!=null?[3,7]:(Tn=Ci(wn),dn=(Pn=this.dataset).addExample,cr={label:k},kr={},[4,Tn.data()]);case 1:return cr.spectrogram=(kr.data=Ti.sent(),kr.frameSize=this.nonBatchInputShape[1],kr),w.includeRawAudio?(Br={},[4,En.data()]):[3,3];case 2:return Br.data=Ti.sent(),Br.sampleRateHz=this.audioDataExtractor.sampleRateHz,yr=Br,[3,4];case 3:yr=void 0,Ti.label=4;case 4:return dn.apply(Pn,[(cr.rawAudio=yr,cr)]),Tn.dispose(),[4,this.audioDataExtractor.stop()];case 5:return Ti.sent(),this.streaming=!1,this.collateTransferWords(),_r=Ce,hi={},[4,wn.data()];case 6:return _r.apply(void 0,[(hi.data=Ti.sent(),hi.frameSize=this.nonBatchInputShape[1],hi)]),[3,13];case 7:return[4,wn.data()];case 8:for(Ei=Ti.sent(),tn===-1&&(tn=Ei.length),xi=tn-1;Ei[xi]!==0&&xi>=0;)xi--;return ya=tn-xi-1,tn=xi+1,Ua=Ei.slice(Ei.length-ya,Ei.length),sn.push(Ua),w.onSnippet!=null&&w.onSnippet({data:Ua,frameSize:this.nonBatchInputShape[1]}),At++!==kt?[3,13]:[4,this.audioDataExtractor.stop()];case 9:return Ti.sent(),this.streaming=!1,this.collateTransferWords(),Ta=function(Ho){if(Ho.length<2)throw new Error("Cannot normalize a Float32Array with fewer than 2 elements.");return Wi==null&&(Wi=Object(F.backend)().epsilon()),Object(F.tidy)(function(){var Yo=Object(F.moments)(Object(F.tensor1d)(Ho)),Xs=Yo.mean,Ds=Yo.variance,du=Xs.arraySync(),Iu=Math.sqrt(Ds.arraySync()),pu=Array.from(Ho).map(function(od){return(od-du)/(Iu+Wi)});return new Float32Array(pu)})}(ye(sn)),Da={data:Ta,frameSize:this.nonBatchInputShape[1]},Qa=(Ra=this.dataset).addExample,oo={label:k,spectrogram:Da},w.includeRawAudio?(Ks={},[4,En.data()]):[3,11];case 10:return Ks.data=Ti.sent(),Ks.sampleRateHz=this.audioDataExtractor.sampleRateHz,wo=Ks,[3,12];case 11:wo=void 0,Ti.label=12;case 12:Qa.apply(Ra,[(oo.rawAudio=wo,oo)]),Ce(Da),Ti.label=13;case 13:return[2,!1]}})})},overlapFactor:tt,includeRawAudio:w.includeRawAudio}),ve.audioDataExtractor.start(w.audioTrackConstraints)})]})})},E.prototype.clearExamples=function(){var k=this;F.util.assert(this.words!=null&&this.words.length>0&&!this.dataset.empty(),function(){return"No transfer learning examples exist for model name "+k.name}),this.dataset.clear(),this.words=null},E.prototype.countExamples=function(){if(this.dataset.empty())throw new Error("No examples have been collected for transfer-learning model named '"+this.name+"' yet.");return this.dataset.getExampleCounts()},E.prototype.getExamples=function(k){return this.dataset.getExamples(k)},E.prototype.setExampleKeyFrameIndex=function(k,w){this.dataset.setExampleKeyFrameIndex(k,w)},E.prototype.removeExample=function(k){this.dataset.removeExample(k),this.collateTransferWords()},E.prototype.isDatasetEmpty=function(){return this.dataset.empty()},E.prototype.loadExamples=function(k,w){var S,z,Y,ce;w===void 0&&(w=!1);var ve=new cn(k);w&&this.clearExamples();var De=ve.getVocabulary();try{for(var Ce=fi(De),Xe=Ce.next();!Xe.done;Xe=Ce.next()){var tt=Xe.value,kt=ve.getExamples(tt);try{for(var At=fi(kt),tn=At.next();!tn.done;tn=At.next()){var sn=tn.value;this.dataset.addExample(sn.example)}}catch(wn){Y={error:wn}}finally{try{tn&&!tn.done&&(ce=At.return)&&ce.call(At)}finally{if(Y)throw Y.error}}}}catch(wn){S={error:wn}}finally{try{Xe&&!Xe.done&&(z=Ce.return)&&z.call(Ce)}finally{if(S)throw S.error}}this.collateTransferWords()},E.prototype.serializeExamples=function(k){return this.dataset.serialize(k)},E.prototype.collateTransferWords=function(){this.words=this.dataset.getVocabulary()},E.prototype.collectTransferDataAsTensors=function(k,w){var S=this.nonBatchInputShape[0];k=k||.25;var z=Math.round(k*S),Y=this.dataset.getData(null,di({numFrames:S,hopFrames:z},w));return{xs:Y.xs,ys:Y.ys}},E.prototype.collectTransferDataAsTfDataset=function(k,w,S,z){w===void 0&&(w=.15),S===void 0&&(S=32);var Y=this.nonBatchInputShape[0];k=k||.25;var ce=Math.round(k*Y);return this.dataset.getData(null,di({numFrames:Y,hopFrames:ce,getDataset:!0,datasetBatchSize:S,datasetValidationSplit:w},z))},E.prototype.train=function(k){return Yr(this,void 0,void 0,function(){var w,S=this;return Xr(this,function(z){switch(z.label){case 0:return F.util.assert(this.words!=null&&this.words.length>0,function(){return"Cannot train transfer-learning model '"+S.name+"' because no transfer learning example has been collected."}),F.util.assert(this.words.length>1,function(){return"Cannot train transfer-learning model '"+S.name+"' because only 1 word label ('"+JSON.stringify(S.words)+"') has been collected for transfer learning. Requires at least 2."}),k.fineTuningEpochs!=null&&F.util.assert(k.fineTuningEpochs>=0&&Number.isInteger(k.fineTuningEpochs),function(){return"If specified, fineTuningEpochs must be a non-negative integer, but received "+k.fineTuningEpochs}),k==null&&(k={}),this.model==null&&this.createTransferModelFromBaseModel(),this.secondLastBaseDenseLayer.trainable=!1,this.model.compile({loss:"categoricalCrossentropy",optimizer:k.optimizer||"sgd",metrics:["acc"]}),w=k.fitDatasetDurationMillisThreshold==null?6e4:k.fitDatasetDurationMillisThreshold,this.dataset.durationMillis()>w?(console.log("Detected large dataset: total duration = "+this.dataset.durationMillis()+" ms > "+w+" ms. Training transfer model using fitDataset() instead of fit()"),[4,this.trainOnDataset(k)]):[3,2];case 1:return[2,z.sent()];case 2:return[4,this.trainOnTensors(k)];case 3:return[2,z.sent()]}})})},E.prototype.trainOnDataset=function(k){return Yr(this,void 0,void 0,function(){var w,S,z,Y,ce,ve,De,Ce,Xe;return Xr(this,function(tt){switch(tt.label){case 0:return F.util.assert(k.epochs>0,function(){return"Invalid config.epochs"}),w=k.batchSize==null?32:k.batchSize,S=k.windowHopRatio||.25,z=ai(this.collectTransferDataAsTfDataset(S,k.validationSplit,w,{augmentByMixingNoiseRatio:k.augmentByMixingNoiseRatio}),2),Y=z[0],ce=z[1],ve=F.util.now(),[4,this.model.fitDataset(Y,{epochs:k.epochs,validationData:k.validationSplit>0?ce:null,callbacks:k.callback==null?null:[k.callback]})];case 1:return De=tt.sent(),console.log("fitDataset() took "+(F.util.now()-ve).toFixed(2)+" ms"),k.fineTuningEpochs!=null&&k.fineTuningEpochs>0?(Ce=F.util.now(),[4,this.fineTuningUsingTfDatasets(k,Y,ce)]):[3,3];case 2:return Xe=tt.sent(),console.log("fitDataset() (fine-tuning) took "+(F.util.now()-Ce).toFixed(2)+" ms"),[2,[De,Xe]];case 3:return[2,De]}})})},E.prototype.trainOnTensors=function(k){return Yr(this,void 0,void 0,function(){var w,S,z,Y,ce,ve,De,Ce,Xe,tt;return Xr(this,function(kt){switch(kt.label){case 0:w=k.windowHopRatio||.25,S=this.collectTransferDataAsTensors(w,{augmentByMixingNoiseRatio:k.augmentByMixingNoiseRatio}),z=S.xs,Y=S.ys,console.log("Training data: xs.shape = "+z.shape+", ys.shape = "+Y.shape),kt.label=1;case 1:return kt.trys.push([1,,6,7]),k.validationSplit!=null?(Ce=function(At,tn,sn){return F.util.assert(sn>0&&sn<1,function(){return"validationSplit is expected to be >0 and <1, but got "+sn}),Object(F.tidy)(function(){for(var wn=tn.argMax(-1).dataSync(),En=[],Tn=0;Tn<wn.length;++Tn){var Pn=wn[Tn];En[Pn]==null&&(En[Pn]=[]),En[Pn].push(Tn)}var dn=En.length,cr=[],kr=[];for(En.map(function(hi){return F.util.shuffle(hi)}),Tn=0;Tn<dn;++Tn)for(var yr=En[Tn],Br=Math.round(yr.length*(1-sn)),_r=0;_r<yr.length;++_r)_r<Br?cr.push(yr[_r]):kr.push(yr[_r]);return{trainXs:Object(F.gather)(At,cr),trainYs:Object(F.gather)(tn,cr),valXs:Object(F.gather)(At,kr),valYs:Object(F.gather)(tn,kr)}})}(z,Y,k.validationSplit),ce=Ce.trainXs,ve=Ce.trainYs,De=[Ce.valXs,Ce.valYs]):(ce=z,ve=Y),[4,this.model.fit(ce,ve,{epochs:k.epochs==null?20:k.epochs,validationData:De,batchSize:k.batchSize,callbacks:k.callback==null?null:[k.callback]})];case 2:return Xe=kt.sent(),k.fineTuningEpochs!=null&&k.fineTuningEpochs>0?[4,this.fineTuningUsingTensors(k,ce,ve,De)]:[3,4];case 3:return tt=kt.sent(),[2,[Xe,tt]];case 4:return[2,Xe];case 5:return[3,7];case 6:return Object(F.dispose)([z,Y,ce,ve,De]),[7];case 7:return[2]}})})},E.prototype.fineTuningUsingTfDatasets=function(k,w,S){return Yr(this,void 0,void 0,function(){var z,Y,ce;return Xr(this,function(ve){switch(ve.label){case 0:return z=this.secondLastBaseDenseLayer.trainable,this.secondLastBaseDenseLayer.trainable=!0,Y=k.fineTuningOptimizer==null?"sgd":k.fineTuningOptimizer,this.model.compile({loss:"categoricalCrossentropy",optimizer:Y,metrics:["acc"]}),[4,this.model.fitDataset(w,{epochs:k.fineTuningEpochs,validationData:S,callbacks:k.callback==null?null:[k.callback]})];case 1:return ce=ve.sent(),this.secondLastBaseDenseLayer.trainable=z,[2,ce]}})})},E.prototype.fineTuningUsingTensors=function(k,w,S,z){return Yr(this,void 0,void 0,function(){var Y,ce,ve;return Xr(this,function(De){switch(De.label){case 0:return Y=this.secondLastBaseDenseLayer.trainable,this.secondLastBaseDenseLayer.trainable=!0,ce=k.fineTuningOptimizer==null?"sgd":k.fineTuningOptimizer,this.model.compile({loss:"categoricalCrossentropy",optimizer:ce,metrics:["acc"]}),[4,this.model.fit(w,S,{epochs:k.fineTuningEpochs,validationData:z,batchSize:k.batchSize,callbacks:k.fineTuningCallback==null?null:[k.fineTuningCallback]})];case 1:return ve=De.sent(),this.secondLastBaseDenseLayer.trainable=Y,[2,ve]}})})},E.prototype.evaluate=function(k){return Yr(this,void 0,void 0,function(){var w,S=this;return Xr(this,function(z){return F.util.assert(k.wordProbThresholds!=null&&k.wordProbThresholds.length>0,function(){return"Received null or empty wordProbThresholds"}),w=0,F.util.assert(this.words[w]==="_background_noise_",function(){return"Cannot perform evaluation when the first tag is not _background_noise_"}),[2,Object(F.tidy)(function(){for(var Y=[],ce=0,ve=S.collectTransferDataAsTensors(k.windowHopRatio),De=ve.xs,Ce=ve.ys.argMax(-1).dataSync(),Xe=S.model.predict(De),tt=Xe.slice([0,1],[Xe.shape[0],Xe.shape[1]-1]).max(-1),kt=Xe.shape[0],At=0;At<k.wordProbThresholds.length;++At){for(var tn=k.wordProbThresholds[At],sn=tt.greater(Object(F.scalar)(tn)).dataSync(),wn=0,En=0,Tn=0,Pn=0,dn=0;dn<kt;++dn)Ce[dn]===w?(wn++,sn[dn]&&Tn++):(En++,sn[dn]&&Pn++);var cr=Tn/wn,kr=Pn/En;Y.push({probThreshold:tn,fpr:cr,tpr:kr}),console.log("ROC thresh="+tn+": fpr="+cr.toFixed(4)+", tpr="+kr.toFixed(4)),At>0&&(ce+=Math.abs(Y[At-1].fpr-Y[At].fpr)*(Y[At-1].tpr+Y[At].tpr)/2)}return{rocCurve:Y,auc:ce}})]})})},E.prototype.createTransferModelFromBaseModel=function(){var k=this;F.util.assert(this.words!=null,function(){return"No word example is available for tranfer-learning model of name "+k.name});for(var w=this.baseModel.layers,S=w.length-2;S>=0&&w[S].getClassName().toLowerCase()!=="dense";)S--;if(S<0)throw new Error("Cannot find a hidden dense layer in the base model.");this.secondLastBaseDenseLayer=w[S];var z=this.secondLastBaseDenseLayer.output;this.transferHead=Object(F.sequential)(),this.transferHead.add(F.layers.dense({units:this.words.length,activation:"softmax",inputShape:z.shape.slice(1),name:"NewHeadDense"}));var Y=this.transferHead.apply(z);this.model=Object(F.model)({inputs:this.baseModel.inputs,outputs:Y})},E.prototype.modelInputShape=function(){return this.baseModel.inputs[0].shape},E.prototype.getMetadata=function(){return{tfjsSpeechCommandsVersion:It,modelName:this.name,timeStamp:new Date().toISOString(),wordLabels:this.wordLabels()}},E.prototype.save=function(k){return Yr(this,void 0,void 0,function(){var w,S,z;return Xr(this,function(Y){return w=k!=null,k=k||$n(this.name),w||(S=qt.localStorage.getItem(Ot),(z=S==null?{}:JSON.parse(S))[this.name]=this.getMetadata(),qt.localStorage.setItem(Ot,JSON.stringify(z))),console.log("Saving model to "+k),[2,this.model.save(k)]})})},E.prototype.load=function(k){return Yr(this,void 0,void 0,function(){var w,S,z;return Xr(this,function(Y){switch(Y.label){case 0:if(w=k!=null,k=k||$n(this.name),!w){if((S=JSON.parse(qt.localStorage.getItem(Ot)))==null||S[this.name]==null)throw new Error("Cannot find metadata for transfer model named "+this.name+'"');this.words=S[this.name].wordLabels,console.log("Loaded word list for model named "+this.name+": "+this.words)}return z=this,[4,Object(F.loadLayersModel)(k)];case 1:return z.model=Y.sent(),console.log("Loaded model from "+k+":"),this.model.summary(),[2]}})})},E.prototype.createTransfer=function(k){throw new Error("Creating transfer-learned recognizer from a transfer-learned recognizer is not supported.")},E}(Ve);function $n(I){return""+pn+I}function Zn(I,E,k,w){if(F.util.assert(k==null&&w==null||k!=null&&w!=null,function(){return"customModelURL and customMetadataURL must be both provided or both not provided."}),k!=null&&F.util.assert(E==null,function(){return"vocabulary name must be null or undefined when modelURL is provided."}),I==="BROWSER_FFT")return new Ve(E,k,w)}var ir=function(){function I(E){pe()(this,I),this.options=E}return Te()(I,[{key:"load",value:function(){var E=K()(ke.a.mark(function k(w){var S,z,Y;return ke.a.wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:return w?(S=w.split("/"),z=S.slice(0,S.length-1).join("/"),Y="".concat(z,"/metadata.json"),this.model=Zn("BROWSER_FFT",void 0,w,Y)):this.model=Zn("BROWSER_FFT"),ce.next=3,this.model.ensureModelLoaded();case 3:this.allLabels=this.model.wordLabels();case 4:case"end":return ce.stop()}},k,this)}));return function(k){return E.apply(this,arguments)}}()},{key:"classify",value:function(){var E=this,k=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.allLabels.length,w=arguments.length>1?arguments[1]:void 0;return this.model.listen(function(S){if(S.scores){var z=xn(S.scores,k,E.allLabels).map(function(Y){return{label:Y.className,confidence:Y.probability}});return w(null,z)}return w("ERROR: Cannot find scores in result: ".concat(S))},this.options).catch(function(S){return w("ERROR: ".concat(S.message))})}}]),I}();function zr(I,E){return vr.apply(this,arguments)}function vr(){return(vr=K()(ke.a.mark(function I(E,k){var w;return ke.a.wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return w=new ir(E),S.next=3,w.load(k);case 3:return S.abrupt("return",w);case 4:case"end":return S.stop()}},I)}))).apply(this,arguments)}var pi=["speechcommands18w"],la=function(){function I(E,k,w){if(pe()(this,I),this.model=null,this.options=k,typeof E=="string")if(pi.includes(E))switch(this.modelName=E,this.modelUrl=null,this.modelName){case"speechcommands18w":this.modelToUse=re;break;default:this.modelToUse=null}else this.modelToUse=re,this.modelUrl=E;this.ready=at(this.loadModel(k,this.modelUrl),w)}return Te()(I,[{key:"loadModel",value:function(){var E=K()(ke.a.mark(function k(w){return ke.a.wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return S.next=2,this.modelToUse.load(w,this.modelUrl);case 2:return this.model=S.sent,S.abrupt("return",this);case 4:case"end":return S.stop()}},k,this)}));return function(k){return E.apply(this,arguments)}}()},{key:"classifyInternal",value:function(){var E=K()(ke.a.mark(function k(w,S){return ke.a.wrap(function(z){for(;;)switch(z.prev=z.next){case 0:return z.next=2,this.ready;case 2:return z.next=4,F.nextFrame();case 4:return z.abrupt("return",this.model.classify(w,S));case 5:case"end":return z.stop()}},k,this)}));return function(k,w){return E.apply(this,arguments)}}()},{key:"classify",value:function(){var E=K()(ke.a.mark(function k(){var w,S,z,Y,ce=arguments;return ke.a.wrap(function(ve){for(;;)switch(ve.prev=ve.next){case 0:return w=ce.length>0&&ce[0]!==void 0?ce[0]:null,S=ce.length>1?ce[1]:void 0,z=this.topk,typeof w=="number"?z=w:typeof w=="function"&&(Y=w),typeof S=="function"&&(Y=S),ve.abrupt("return",this.classifyInternal(z,Y));case 6:case"end":return ve.stop()}},k,this)}));return function(){return E.apply(this,arguments)}}()}]),I}(),ui=function(I,E,k){var w={},S=k,z=I;if(typeof z!="string")throw new Error('Please specify a model to use. E.g: "SpeechCommands18w"');z.indexOf("http")===-1&&(z=I.toLowerCase()),we()(E)==="object"?w=E:typeof E=="function"&&(S=E);var Y=new la(z,w,S);return S?Y:Y.ready};function Qi(I,E){return I==null&&E==null?null:I==null?E.clone():E===null?I.clone():I.concat(E,0)}function Di(I,E){for(var k=[],w=0;w<I.length;w++)k.push({value:I[w],index:w});k.sort(function(Y,ce){return ce.value-Y.value});var S=new Float32Array(E),z=new Int32Array(E);for(w=0;w<E;w++)S[w]=k[w].value,z[w]=k[w].index;return{values:S,indices:z}}var qr=function(){function I(){this.classDatasetMatrices={},this.classExampleCount={},this.labelToClassId={},this.nextClassId=0}return I.prototype.addExample=function(E,k){var w=this;if(this.exampleShape==null&&(this.exampleShape=E.shape),!Ye.util.arraysEqual(this.exampleShape,E.shape))throw new Error("Example shape provided, "+E.shape+" does not match previously provided example shapes "+this.exampleShape+".");this.clearTrainDatasetMatrix(),k in this.labelToClassId||(this.labelToClassId[k]=this.nextClassId++),Object(Ye.tidy)(function(){var S=w.normalizeVectorToUnitLength(E.flatten()),z=S.shape[0];if(w.classDatasetMatrices[k]==null)w.classDatasetMatrices[k]=S.as2D(1,z);else{var Y=w.classDatasetMatrices[k].as2D(w.classExampleCount[k],z).concat(S.as2D(1,z),0);w.classDatasetMatrices[k].dispose(),w.classDatasetMatrices[k]=Y}Object(Ye.keep)(w.classDatasetMatrices[k]),w.classExampleCount[k]==null&&(w.classExampleCount[k]=0),w.classExampleCount[k]++})},I.prototype.similarities=function(E){var k=this;return Object(Ye.tidy)(function(){var w=k.normalizeVectorToUnitLength(E.flatten()),S=w.shape[0];if(k.trainDatasetMatrix==null){var z=null;for(var Y in k.classDatasetMatrices)z=Qi(z,k.classDatasetMatrices[Y]);k.trainDatasetMatrix=z}if(k.trainDatasetMatrix==null)return console.warn("Cannot predict without providing training examples."),null;Object(Ye.keep)(k.trainDatasetMatrix);var ce=k.getNumExamples();return k.trainDatasetMatrix.as2D(ce,S).matMul(w.as2D(S,1)).as1D()})},I.prototype.predictClass=function(E,k){return k===void 0&&(k=3),function(w,S,z,Y){return new(z||(z=Promise))(function(ce,ve){function De(tt){try{Xe(Y.next(tt))}catch(kt){ve(kt)}}function Ce(tt){try{Xe(Y.throw(tt))}catch(kt){ve(kt)}}function Xe(tt){tt.done?ce(tt.value):new z(function(kt){kt(tt.value)}).then(De,Ce)}Xe((Y=Y.apply(w,[])).next())})}(this,void 0,void 0,function(){var w,S,z,Y,ce=this;return function(ve,De){var Ce,Xe,tt,kt,At={label:0,sent:function(){if(1&tt[0])throw tt[1];return tt[1]},trys:[],ops:[]};return kt={next:tn(0),throw:tn(1),return:tn(2)},typeof Symbol=="function"&&(kt[Symbol.iterator]=function(){return this}),kt;function tn(sn){return function(wn){return function(En){if(Ce)throw new TypeError("Generator is already executing.");for(;At;)try{if(Ce=1,Xe&&(tt=2&En[0]?Xe.return:En[0]?Xe.throw||((tt=Xe.return)&&tt.call(Xe),0):Xe.next)&&!(tt=tt.call(Xe,En[1])).done)return tt;switch(Xe=0,tt&&(En=[2&En[0],tt.value]),En[0]){case 0:case 1:tt=En;break;case 4:return At.label++,{value:En[1],done:!1};case 5:At.label++,Xe=En[1],En=[0];continue;case 7:En=At.ops.pop(),At.trys.pop();continue;default:if(!(tt=(tt=At.trys).length>0&&tt[tt.length-1])&&(En[0]===6||En[0]===2)){At=0;continue}if(En[0]===3&&(!tt||En[1]>tt[0]&&En[1]<tt[3])){At.label=En[1];break}if(En[0]===6&&At.label<tt[1]){At.label=tt[1],tt=En;break}if(tt&&At.label<tt[2]){At.label=tt[2],At.ops.push(En);break}tt[2]&&At.ops.pop(),At.trys.pop();continue}En=De.call(ve,At)}catch(Tn){En=[6,Tn],Xe=0}finally{Ce=tt=0}if(5&En[0])throw En[1];return{value:En[0]?En[1]:void 0,done:!0}}([sn,wn])}}}(this,function(ve){switch(ve.label){case 0:if(k<1)throw new Error("Please provide a positive integer k value to predictClass.");if(this.getNumExamples()===0)throw new Error("You have not added any examples to the KNN classifier. Please add examples before calling predictClass.");return w=Object(Ye.tidy)(function(){return ce.similarities(E).asType("float32")}),S=Math.min(k,this.getNumExamples()),Y=Di,[4,w.data()];case 1:return z=Y.apply(void 0,[ve.sent(),S]).indices,w.dispose(),[2,this.calculateTopClass(z,S)]}})})},I.prototype.clearClass=function(E){if(this.classDatasetMatrices[E]==null)throw new Error("Cannot clear invalid class "+E);delete this.classDatasetMatrices[E],delete this.classExampleCount[E],this.clearTrainDatasetMatrix()},I.prototype.clearAllClasses=function(){for(var E in this.classDatasetMatrices)this.clearClass(E)},I.prototype.getClassExampleCount=function(){return this.classExampleCount},I.prototype.getClassifierDataset=function(){return this.classDatasetMatrices},I.prototype.getNumClasses=function(){return Object.keys(this.classExampleCount).length},I.prototype.setClassifierDataset=function(E){for(var k in this.clearTrainDatasetMatrix(),this.classDatasetMatrices=E,E)this.classExampleCount[k]=E[k].shape[0]},I.prototype.calculateTopClass=function(E,k){var w,S={};if(E==null)return{classIndex:this.labelToClassId[w],label:w,confidences:S};var z={},Y=0;for(var ce in this.classDatasetMatrices)Y+=this.classExampleCount[ce],z[ce]=Y;var ve={};for(var ce in this.classDatasetMatrices)ve[ce]=0;for(var De=0;De<E.length;De++){var Ce=E[De];for(var ce in this.classDatasetMatrices)if(Ce<z[ce]){ve[ce]++;break}}var Xe=0;for(var ce in this.classDatasetMatrices){var tt=ve[ce]/k;tt>Xe&&(Xe=tt,w=ce),S[ce]=tt}return{classIndex:this.labelToClassId[w],label:w,confidences:S}},I.prototype.clearTrainDatasetMatrix=function(){this.trainDatasetMatrix!=null&&(this.trainDatasetMatrix.dispose(),this.trainDatasetMatrix=null)},I.prototype.normalizeVectorToUnitLength=function(E){return Object(Ye.tidy)(function(){var k=E.norm();return Object(Ye.div)(E,k)})},I.prototype.getNumExamples=function(){var E=0;for(var k in this.classDatasetMatrices)E+=this.classExampleCount[k];return E},I.prototype.dispose=function(){for(var E in this.clearTrainDatasetMatrix(),this.classDatasetMatrices)this.classDatasetMatrices[E].dispose()},I}(),jr=function(){var I=K()(ke.a.mark(function E(k,w,S){var z,Y;return ke.a.wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:(z=document.createElement("a")).style.display="none",document.body.appendChild(z),Y=new Blob([k],{type:S}),z.href=URL.createObjectURL(Y),z.download=w,z.click();case 7:case"end":return ce.stop()}},E)}));return function(E,k,w){return I.apply(this,arguments)}}(),Bn=function(){var I=K()(ke.a.mark(function E(k,w){return ke.a.wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return S.abrupt("return",Gt.a.get(k).then(function(z){return z.data}).then(function(z){return w&&w(null,z),z}).catch(function(z){throw w&&w(z),console.error("There has been a problem loading the file: ".concat(z.message)),z}));case 1:case"end":return S.stop()}},E)}));return function(E,k){return I.apply(this,arguments)}}(),ri=function(){function I(){pe()(this,I),this.knnClassifier=new qr,this.mapStringToIndex=[]}return Te()(I,[{key:"addExample",value:function(E,k){var w,S;typeof k=="string"?w=this.mapStringToIndex.includes(k)?this.mapStringToIndex.indexOf(k):this.mapStringToIndex.push(k)-1:typeof k=="number"&&(w=k),S=Array.isArray(E)?F.tensor(E):E,this.knnClassifier.addExample(S,w)}},{key:"classify",value:function(){var E=K()(ke.a.mark(function k(w,S,z){var Y,ce,ve;return ke.a.wrap(function(De){for(;;)switch(De.prev=De.next){case 0:return Y=3,ce=z,typeof S=="number"?Y=S:typeof S=="function"&&(ce=S),ve=Array.isArray(w)?F.tensor(w):w,De.abrupt("return",at(this.classifyInternal(ve,Y),ce));case 5:case"end":return De.stop()}},k,this)}));return function(k,w,S){return E.apply(this,arguments)}}()},{key:"classifyInternal",value:function(){var E=K()(ke.a.mark(function k(w,S){var z,Y,ce,ve=this;return ke.a.wrap(function(De){for(;;)switch(De.prev=De.next){case 0:if(!(this.knnClassifier.getNumClasses()<=0)){De.next=5;break}throw new Error("There is no example in any class");case 5:return De.next=7,this.knnClassifier.predictClass(w,S);case 7:return z=De.sent,this.mapStringToIndex.length>0&&((z.classIndex||z.classIndex===0)&&(Y=this.mapStringToIndex[z.classIndex])&&(z.label=Y),z.confidences&&(z.confidencesByLabel={},ce=z.confidences,Object.keys(ce).forEach(function(Ce){var Xe=ve.mapStringToIndex[Ce];z.confidencesByLabel[Xe]=ce[Ce]}))),De.abrupt("return",z);case 10:case"end":return De.stop()}},k,this)}));return function(k,w){return E.apply(this,arguments)}}()},{key:"clearLabel",value:function(E){var k;typeof E=="string"?this.mapStringToIndex.includes(E)&&(k=this.mapStringToIndex.indexOf(E)):typeof E=="number"&&(k=E),this.knnClassifier.clearClass(k)}},{key:"clearAllLabels",value:function(){this.mapStringToIndex=[],this.knnClassifier.clearAllClasses()}},{key:"getCountByLabel",value:function(){var E=this,k=this.knnClassifier.getClassExampleCount();if(this.mapStringToIndex.length>0){var w={};return Object.keys(k).forEach(function(S){if(E.mapStringToIndex[S]){var z=E.mapStringToIndex[S];w[z]=k[S]}}),w}return k}},{key:"getCount",value:function(){return this.knnClassifier.getClassExampleCount()}},{key:"getClassifierDataset",value:function(){return this.knnClassifier.getClassifierDataset()}},{key:"setClassifierDataset",value:function(E){this.knnClassifier.setClassifierDataset(E)}},{key:"getNumLabels",value:function(){return this.knnClassifier.getNumClasses()}},{key:"dispose",value:function(){this.knnClassifier.dispose()}},{key:"save",value:function(){var E=K()(ke.a.mark(function k(w){var S,z,Y,ce=this;return ke.a.wrap(function(ve){for(;;)switch(ve.prev=ve.next){case 0:return S=this.knnClassifier.getClassifierDataset(),this.mapStringToIndex.length>0&&Object.keys(S).forEach(function(De){ce.mapStringToIndex[De]&&(S[De].label=ce.mapStringToIndex[De])}),z=Object.keys(S).map(function(De){var Ce=S[De];return Ce?Ce.dataSync():null}),Y="myKNN.json",w&&(Y=w.endsWith(".json")?w:"".concat(w,".json")),ve.next=7,jr(JSON.stringify({dataset:S,tensors:z}),Y,"application/octet-stream");case 7:case"end":return ve.stop()}},k,this)}));return function(k){return E.apply(this,arguments)}}()},{key:"load",value:function(){var E=K()(ke.a.mark(function k(w,S){var z,Y,ce,ve,De;return ke.a.wrap(function(Ce){for(;;)switch(Ce.prev=Ce.next){case 0:if(we()(w)!=="object"){Ce.next=4;break}z=w,Ce.next=7;break;case 4:return Ce.next=6,Bn(w);case 6:z=Ce.sent;case 7:z&&(ce=(Y=z).dataset,ve=Y.tensors,this.mapStringToIndex=Object.keys(ce).map(function(Xe){return ce[Xe].label}),De=ve.map(function(Xe,tt){if(Xe){var kt=Object.keys(Xe).map(function(At){return Xe[At]});return F.tensor(kt,ce[tt].shape,ce[tt].dtype)}return null}).reduce(function(Xe,tt,kt){return Xe[kt]=tt,Xe},{}),this.knnClassifier.setClassifierDataset(De),S&&S());case 8:case"end":return Ce.stop()}},k,this)}));return function(k,w){return E.apply(this,arguments)}}()}]),I}(),Vi=function(){return new ri},Fr=function(){function I(E,k){pe()(this,I),this.videoElt=null,this.size=k,this.videoReady=!1,typeof HTMLVideoElement<"u"&&(E instanceof HTMLVideoElement?this.videoElt=E:E!==null&&we()(E)==="object"&&E.elt instanceof HTMLVideoElement&&(this.videoElt=E.elt))}return Te()(I,[{key:"loadVideo",value:function(){var E=K()(ke.a.mark(function k(){var w,S=this;return ke.a.wrap(function(z){for(;;)switch(z.prev=z.next){case 0:return z.abrupt("return",new Promise(function(Y,ce){S.videoElt||ce(new Error("No video was passed to the constructor.")),S.video=document.createElement("video");var ve=navigator.userAgent;w=ve.indexOf("Firefox")>-1?S.videoElt.mozCaptureStream():S.videoElt.captureStream(),S.video.srcObject=w,S.size&&(S.video.width=S.size,S.video.height=S.size),S.video.autoplay=!0,S.video.playsinline=!0,S.video.muted=!0;var De=S.video.play();De!==void 0&&De.then(function(){S.videoReady=!0,Y(S.video)})}));case 1:case"end":return z.stop()}},k)}));return function(){return E.apply(this,arguments)}}()}]),I}(),aa=224,ma=[aa,aa],Zi="https://storage.googleapis.com/tfjs-models/tfjs/mobilenet_v",ga={version:1,alpha:.25,learningRate:1e-4,hiddenUnits:100,epochs:20,numLabels:2,batchSize:.4,layer:"conv_pw_13_relu"},No={1:{.25:"https://tfhub.dev/google/imagenet/mobilenet_v1_025_224/classification/1",.5:"https://tfhub.dev/google/imagenet/mobilenet_v1_050_224/classification/1",.75:"https://tfhub.dev/google/imagenet/mobilenet_v1_075_224/classification/1",1:"https://tfhub.dev/google/imagenet/mobilenet_v1_100_224/classification/1"},2:{.5:"https://tfhub.dev/google/imagenet/mobilenet_v2_050_224/classification/2",.75:"https://tfhub.dev/google/imagenet/mobilenet_v2_075_224/classification/2",1:"https://tfhub.dev/google/imagenet/mobilenet_v2_100_224/classification/2"}},vs={1:"module_apply_default/MobilenetV1/Logits/global_pool",2:"module_apply_default/MobilenetV2/Logits/AvgPool"},Eh=function(){function I(E,k){pe()(this,I),this.mobilenet=null,this.topKPredictions=10,this.hasAnyTrainedClass=!1,this.customModel=null,this.jointModel=null,this.config={epochs:E.epochs||ga.epochs,version:E.version||ga.version,hiddenUnits:E.hiddenUnits||ga.hiddenUnits,numLabels:E.numLabels||ga.numLabels,learningRate:E.learningRate||ga.learningRate,batchSize:E.batchSize||ga.batchSize,layer:E.layer||ga.layer,alpha:E.alpha||ga.alpha},this.model=null,this.url=No[this.config.version][this.config.alpha],this.normalizationOffset=F.scalar(127.5),this.mobilenetURL=E.mobilenetURL||"".concat(Zi).concat(this.config.version,"_").concat(this.config.alpha,"_").concat(aa,"/model.json"),this.graphModelURL=E.graphModelURL||this.url,this.isPredicting=!1,this.mapStringToIndex=[],this.usageType=null,this.ready=at(this.loadModel(),k)}return Te()(I,[{key:"loadModel",value:function(){var E=K()(ke.a.mark(function k(){var w;return ke.a.wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return S.next=2,F.loadLayersModel(this.mobilenetURL);case 2:if(this.mobilenet=S.sent,!this.graphModelURL.includes("https://tfhub.dev/")){S.next=9;break}return S.next=6,F.loadGraphModel(this.graphModelURL,{fromTFHub:!0});case 6:this.model=S.sent,S.next=12;break;case 9:return S.next=11,F.loadGraphModel(this.graphModelURL,{fromTFHub:!1});case 11:this.model=S.sent;case 12:return w=this.mobilenet.getLayer(this.config.layer),S.next=15,F.model({inputs:this.mobilenet.inputs,outputs:w.output});case 15:if(this.mobilenetFeatures=S.sent,!this.video){S.next=19;break}return S.next=19,this.mobilenetFeatures.predict(Gn(this.video,ma));case 19:return S.abrupt("return",this);case 20:case"end":return S.stop()}},k,this)}));return function(){return E.apply(this,arguments)}}()},{key:"classification",value:function(E){var k,w=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,S=arguments.length>2?arguments[2]:void 0;return this.usageType="classifier",we()(w)==="object"?Object.assign(this.config,w):typeof w=="function"&&(k=w),typeof S=="function"&&(k=S),E&&at(this.loadVideo(E),k),this}},{key:"regression",value:function(E,k){return this.usageType="regressor",E&&at(this.loadVideo(E),k),this}},{key:"loadVideo",value:function(){var E=K()(ke.a.mark(function k(w){var S,z;return ke.a.wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:if(S=null,w instanceof HTMLVideoElement?S=w:we()(w)==="object"&&w.elt instanceof HTMLVideoElement&&(S=w.elt),!S){Y.next=7;break}return z=new Fr(S,aa),Y.next=6,z.loadVideo();case 6:this.video=Y.sent;case 7:return Y.abrupt("return",this);case 8:case"end":return Y.stop()}},k,this)}));return function(k){return E.apply(this,arguments)}}()},{key:"addImage",value:function(){var E=K()(ke.a.mark(function k(w,S,z){var Y,ce,ve;return ke.a.wrap(function(De){for(;;)switch(De.prev=De.next){case 0:return ve=z,w instanceof HTMLImageElement||w instanceof HTMLVideoElement||w instanceof HTMLCanvasElement||w.elt instanceof ImageData?Y=w:we()(w)==="object"&&(w.elt instanceof HTMLImageElement||w.elt instanceof HTMLVideoElement||w.elt instanceof HTMLCanvasElement||w.elt instanceof ImageData)?Y=w.elt:typeof w!="string"&&typeof w!="number"||(Y=this.video,ce=w),typeof S=="string"||typeof S=="number"?ce=S:typeof S=="function"&&(ve=S),typeof ce=="string"&&(ce=this.mapStringToIndex.includes(ce)?this.mapStringToIndex.indexOf(ce):this.mapStringToIndex.push(ce)-1),De.abrupt("return",at(this.addImageInternal(Y,ce),ve));case 5:case"end":return De.stop()}},k,this)}));return function(k,w,S){return E.apply(this,arguments)}}()},{key:"addImageInternal",value:function(){var E=K()(ke.a.mark(function k(w,S){var z=this;return ke.a.wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:return Y.next=2,this.ready;case 2:return F.tidy(function(){var ce,ve=Gn(w,ma),De=z.mobilenetFeatures.predict(ve);if(z.usageType==="classifier"?ce=F.tidy(function(){return F.oneHot(F.tensor1d([S],"int32"),z.config.numLabels)}):z.usageType==="regressor"&&(ce=F.tensor2d([[S]])),z.xs==null)z.xs=F.keep(De),z.ys=F.keep(ce),z.hasAnyTrainedClass=!0;else{var Ce=z.xs;z.xs=F.keep(Ce.concat(De,0));var Xe=z.ys;z.ys=F.keep(Xe.concat(ce,0)),Ce.dispose(),Xe.dispose(),ce.dispose()}}),Y.abrupt("return",this);case 4:case"end":return Y.stop()}},k,this)}));return function(k,w){return E.apply(this,arguments)}}()},{key:"train",value:function(){var E=K()(ke.a.mark(function k(w){var S,z;return ke.a.wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:if(this.hasAnyTrainedClass){Y.next=2;break}throw new Error("Add some examples before training!");case 2:if(this.isPredicting=!1,this.usageType==="classifier"?(this.loss="categoricalCrossentropy",this.customModel=F.sequential({layers:[F.layers.flatten({inputShape:[7,7,256]}),F.layers.dense({units:this.config.hiddenUnits,activation:"relu",kernelInitializer:"varianceScaling",useBias:!0}),F.layers.dense({units:this.config.numLabels,kernelInitializer:"varianceScaling",useBias:!1,activation:"softmax"})]})):this.usageType==="regressor"&&(this.loss="meanSquaredError",this.customModel=F.sequential({layers:[F.layers.flatten({inputShape:[7,7,256]}),F.layers.dense({units:this.config.hiddenUnits,activation:"relu",kernelInitializer:"varianceScaling",useBias:!0}),F.layers.dense({units:1,useBias:!1,kernelInitializer:"Zeros",activation:"linear"})]})),this.jointModel=F.sequential(),this.jointModel.add(this.mobilenetFeatures),this.jointModel.add(this.customModel),S=F.train.adam(this.config.learningRate),this.customModel.compile({optimizer:S,loss:this.loss}),(z=Math.floor(this.xs.shape[0]*this.config.batchSize))>0){Y.next=12;break}throw new Error("Batch size is 0 or NaN. Please choose a non-zero fraction.");case 12:return Y.abrupt("return",this.customModel.fit(this.xs,this.ys,{batchSize:z,epochs:this.config.epochs,callbacks:{onBatchEnd:function(){var ce=K()(ke.a.mark(function ve(De,Ce){return ke.a.wrap(function(Xe){for(;;)switch(Xe.prev=Xe.next){case 0:return w(Ce.loss.toFixed(5)),Xe.next=3,F.nextFrame();case 3:case"end":return Xe.stop()}},ve)}));return function(ve,De){return ce.apply(this,arguments)}}(),onTrainEnd:function(){return w(null)}}}));case 13:case"end":return Y.stop()}},k,this)}));return function(k){return E.apply(this,arguments)}}()},{key:"classify",value:function(){var E=K()(ke.a.mark(function k(w,S){var z,Y;return ke.a.wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:return w instanceof HTMLImageElement||w instanceof HTMLVideoElement||w instanceof HTMLCanvasElement||w instanceof ImageData?z=w:we()(w)==="object"&&(w.elt instanceof HTMLImageElement||w.elt instanceof HTMLVideoElement||w.elt instanceof HTMLCanvasElement||w.elt instanceof ImageData)?z=w.elt:typeof w=="function"&&(z=this.video,Y=w),typeof S=="function"&&(Y=S),ce.abrupt("return",at(this.classifyInternal(z),Y));case 3:case"end":return ce.stop()}},k,this)}));return function(k,w){return E.apply(this,arguments)}}()},{key:"classifyInternal",value:function(){var E=K()(ke.a.mark(function k(w){var S,z,Y=this;return ke.a.wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:if(this.usageType==="classifier"){ce.next=2;break}throw new Error("Mobilenet Feature Extraction has not been set to be a classifier.");case 2:return ce.next=4,F.nextFrame();case 4:return this.isPredicting=!0,S=F.tidy(function(){var ve=Gn(w,ma),De=Y.jointModel.predict(ve);return Array.from(De.as1D().dataSync())}),ce.next=8,S.map(function(ve,De){return{label:Y.mapStringToIndex.length>0&&Y.mapStringToIndex[De]?Y.mapStringToIndex[De]:De,confidence:ve}}).sort(function(ve,De){return De.confidence-ve.confidence});case 8:return z=ce.sent,ce.abrupt("return",z);case 10:case"end":return ce.stop()}},k,this)}));return function(k){return E.apply(this,arguments)}}()},{key:"predict",value:function(){var E=K()(ke.a.mark(function k(w,S){var z,Y;return ke.a.wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:return w instanceof HTMLImageElement||w instanceof HTMLVideoElement||w instanceof HTMLCanvasElement||w instanceof ImageData?z=w:we()(w)==="object"&&(w.elt instanceof HTMLImageElement||w.elt instanceof HTMLVideoElement||w.elt instanceof HTMLCanvasElement||w.elt instanceof ImageData)?z=w.elt:typeof w=="function"&&(z=this.video,Y=w),typeof S=="function"&&(Y=S),ce.abrupt("return",at(this.predictInternal(z),Y));case 3:case"end":return ce.stop()}},k,this)}));return function(k,w){return E.apply(this,arguments)}}()},{key:"predictInternal",value:function(){var E=K()(ke.a.mark(function k(w){var S,z,Y=this;return ke.a.wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:if(this.usageType==="regressor"){ce.next=2;break}throw new Error("Mobilenet Feature Extraction has not been set to be a regressor.");case 2:return ce.next=4,F.nextFrame();case 4:return this.isPredicting=!0,S=F.tidy(function(){var ve=Gn(w,ma);return Y.jointModel.predict(ve).as1D()}),ce.next=8,S.data();case 8:return z=ce.sent,S.dispose(),ce.abrupt("return",{value:z[0]});case 11:case"end":return ce.stop()}},k,this)}));return function(k){return E.apply(this,arguments)}}()},{key:"load",value:function(){var E=K()(ke.a.mark(function k(){var w,S,z,Y,ce,ve,De=this,Ce=arguments;return ke.a.wrap(function(Xe){for(;;)switch(Xe.prev=Xe.next){case 0:if(w=Ce.length>0&&Ce[0]!==void 0?Ce[0]:null,S=Ce.length>1?Ce[1]:void 0,typeof w=="string"){Xe.next=11;break}return z=null,Y=null,Array.from(w).forEach(function(tt){if(tt.name.includes(".json")){z=tt;var kt=new FileReader;kt.onload=function(At){JSON.parse(At.target.result).ml5Specs&&(De.mapStringToIndex=JSON.parse(At.target.result).ml5Specs.mapStringToIndex)},kt.readAsText(tt)}else tt.name.includes(".bin")&&(Y=tt)}),Xe.next=8,F.loadLayersModel(F.io.browserFiles([z,Y]));case 8:this.jointModel=Xe.sent,Xe.next=20;break;case 11:return Xe.next=13,Gt.a.get(w);case 13:return ce=Xe.sent,(ve=ce.data).ml5Specs&&(this.mapStringToIndex=ve.ml5Specs.mapStringToIndex),Xe.next=18,F.loadLayersModel(w);case 18:this.jointModel=Xe.sent,S&&S();case 20:return Xe.abrupt("return",this.jointModel);case 21:case"end":return Xe.stop()}},k,this)}));return function(){return E.apply(this,arguments)}}()},{key:"save",value:function(){var E=K()(ke.a.mark(function k(w,S){var z=this;return ke.a.wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:if(this.jointModel){Y.next=2;break}throw new Error("No model found.");case 2:this.jointModel.save(F.io.withSaveHandler(function(){var ce=K()(ke.a.mark(function ve(De){var Ce;return ke.a.wrap(function(Xe){for(;;)switch(Xe.prev=Xe.next){case 0:return Ce="model",S&&(Ce=S),z.weightsManifest={modelTopology:De.modelTopology,weightsManifest:[{paths:["./".concat(Ce,".weights.bin")],weights:De.weightSpecs}],ml5Specs:{mapStringToIndex:z.mapStringToIndex}},Xe.next=5,jr(De.weightData,"".concat(Ce,".weights.bin"),"application/octet-stream");case 5:return Xe.next=7,jr(JSON.stringify(z.weightsManifest),"".concat(Ce,".json"),"text/plain");case 7:w&&w();case 8:case"end":return Xe.stop()}},ve)}));return function(ve){return ce.apply(this,arguments)}}()));case 3:case"end":return Y.stop()}},k,this)}));return function(k,w){return E.apply(this,arguments)}}()},{key:"mobilenetInfer",value:function(E){var k=this,w=arguments.length>1&&arguments[1]!==void 0&&arguments[1],S=E;return S instanceof F.Tensor||S instanceof ImageData||S instanceof HTMLImageElement||S instanceof HTMLCanvasElement||S instanceof HTMLVideoElement?F.tidy(function(){S instanceof F.Tensor||(S=F.browser.fromPixels(S));var z=S.toFloat().sub(k.normalizationOffset).div(k.normalizationOffset),Y=z;(S.shape[0]!==aa||S.shape[1]!==aa)&&(Y=F.image.resizeBilinear(z,ma,!0));var ce,ve=Y.reshape([-1,aa,aa,3]);if(w){var De=vs[k.config.version];ce=k.model.execute(ve,De).squeeze([1,2])}else ce=k.model.predict(ve).slice([0,1],[-1,1e3]);return ce}):null}},{key:"infer",value:function(E,k){var w,S;if(E instanceof HTMLImageElement||E instanceof HTMLVideoElement||E instanceof HTMLCanvasElement||E instanceof ImageData)w=E;else{if(we()(E)!=="object"||!(E.elt instanceof HTMLImageElement||E.elt instanceof HTMLVideoElement||E.elt instanceof HTMLCanvasElement||E.elt instanceof ImageData))throw new Error("No input image found.");w=E.elt}return S=k&&typeof k=="string"?k:"conv_preds",this.mobilenetInfer(w,S)}}]),I}(),qi=function(I,E,k){var w;if(typeof I!="string")throw new Error('Please specify a model to use. E.g: "MobileNet"');w=I.toLowerCase();var S={},z=k;if(we()(E)==="object"?S=E:typeof E=="function"&&(z=E),w==="mobilenet")return new Eh(S,z);throw new Error("".concat(w," is not a valid model."))},ec=function(){console.log("%cword2vec has been disabled","color: #A155FF; font-size: 16px"),console.log("We've intentionally disabled the word2vec function after recognizing it has the potential to produce harmful outputs while using the model files included in our examples. We'll consider reenabling the word2vec function along with changes to address these issues in a future release of ml5.js. You can find further updates about this topic on our Twitter account (https://twitter.com/ml5js/status/1445762321444315147) and GitHub (https://github.com/ml5js/ml5-library/issues/1238).")},bu=o(58),bc=o.n(bu),Bu=o(57),xc=o.n(Bu),Dd=o(35),os=o.n(Dd),vf=["person","bicycle","car","motorbike","aeroplane","bus","train","truck","boat","traffic light","fire hydrant","stop sign","parking meter","bench","bird","cat","dog","horse","sheep","cow","elephant","bear","zebra","giraffe","backpack","umbrella","handbag","tie","suitcase","frisbee","skis","snowboard","sports ball","kite","baseball bat","baseball glove","skateboard","surfboard","tennis racket","bottle","wine glass","cup","fork","knife","spoon","bowl","banana","apple","sandwich","orange","broccoli","carrot","hot dog","pizza","donut","cake","chair","sofa","pottedplant","bed","diningtable","toilet","tvmonitor","laptop","mouse","remote","keyboard","cell phone","microwave","oven","toaster","sink","refrigerator","book","clock","vase","scissors","teddy bear","hair drier","toothbrush"];function Td(I){return new RegExp("^(?:[a-z]+:)?//","i").test(I)}var Pu={isAbsoluteURL:Td,getModelPath:function(I){return Td(I)||typeof window>"u"?I:window.location.pathname+I}},yf=function(I,E){var k=Math.min(I[3],E[3])-Math.max(I[1],E[1]),w=Math.min(I[2],E[2])-Math.max(I[0],E[0]);return k<0||w<0?0:k*w},Ch=function(I,E){return yf(I,E)/function(k,w){var S=yf(k,w);return(k[3]-k[1])*(k[2]-k[0])+(w[3]-w[1])*(w[2]-w[0])-S}(I,E)};function wc(I,E,k,w){return El.apply(this,arguments)}function El(){return(El=K()(ke.a.mark(function I(E,k,w,S){return ke.a.wrap(function(z){for(;;)switch(z.prev=z.next){case 0:return z.abrupt("return",F.tidy(function(){for(var Y=F.mul(k,w),ce=F.argMax(Y,-1),ve=F.max(Y,-1),De=F.greaterEqual(ve,F.scalar(S)).dataSync(),Ce=[],Xe=0;Xe<De.length;Xe+=1)De[Xe]&&Ce.push(Xe);if(Ce.length===0)return[null,null,null];var tt=F.tensor1d(Ce,"int32");return[F.gather(E.reshape([De.length,4]),tt),F.gather(ve.flatten(),tt),F.gather(ce.flatten(),tt)]}));case 1:case"end":return z.stop()}},I)}))).apply(this,arguments)}var Io=function(I,E){return F.tidy(function(){var k=F.tensor1d([2]),w=F.sub(I,F.div(E,k)),S=F.add(I,F.div(E,k)),z=[w.shape[0],w.shape[1],w.shape[2],1];return F.concat([w.slice([0,0,0,1],z),w.slice([0,0,0,0],z),S.slice([0,0,0,1],z),S.slice([0,0,0,0],z)],3)})},Vc=function(I,E,k){return F.tidy(function(){for(var w=[],S=0;S<E.length;S+=1)w.push([E[S],[I[4*S],I[4*S+1],I[4*S+2],I[4*S+3]],S]);var z=[];return w.sort(function(Y,ce){return ce[0]-Y[0]}).forEach(function(Y){for(var ce=!0,ve=0;ve<z.length;ve+=1)if(Ch(Y[1],z[ve][1])>k){ce=!1;break}ce&&z.push(Y)}),[z.map(function(Y){return Y[2]}),z.map(function(Y){return Y[1]}),z.map(function(Y){return Y[0]})]})};function so(I,E,k){return F.tidy(function(){var w=E.shape[0],S=F.reshape(E,[1,1,w,2]),z=I.shape.slice(1,3),Y=z[0],ce=z[1],ve=F.range(0,z[0]),De=F.range(0,z[1]);ve=F.tile(ve,[z[1]]),De=F.tile(F.expandDims(De,0),[z[0],1]),De=F.transpose(De).flatten();var Ce=F.transpose(F.stack([ve,De]));Ce=F.reshape(Ce,[z[0],z[1],1,2]),Ce=F.cast(Ce,I.dtype),I=F.reshape(I,[z[0],z[1],w,k+5]),z=F.cast(F.reshape(F.tensor1d(z),[1,1,1,2]),I.dtype);var Xe=F.sigmoid(I.slice([0,0,0,0],[Y,ce,w,2])),tt=F.exp(I.slice([0,0,0,2],[Y,ce,w,2])),kt=F.sigmoid(I.slice([0,0,0,4],[Y,ce,w,1])),At=F.softmax(I.slice([0,0,0,5],[Y,ce,w,k]));return[Xe=F.div(F.add(Xe,Ce),z),tt=F.div(F.mul(tt,S),z),kt,At]})}function tc(I){var E=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var k,w=os()(I);if(E){var S=os()(this).constructor;k=Reflect.construct(w,arguments,S)}else k=w.apply(this,arguments);return xc()(this,k)}}var ss={modelUrl:"https://raw.githubusercontent.com/ml5js/ml5-data-and-training/master/models/YOLO/model.json",filterBoxesThreshold:.01,IOUThreshold:.4,classProbThreshold:.4},Eo=416,nc=function(I){bc()(k,I);var E=tc(k);function k(w,S,z){var Y;return pe()(this,k),(Y=E.call(this,w,Eo)).modelUrl=S.modelUrl||ss.modelUrl,Y.filterBoxesThreshold=S.filterBoxesThreshold||ss.filterBoxesThreshold,Y.IOUThreshold=S.IOUThreshold||ss.IOUThreshold,Y.classProbThreshold=S.classProbThreshold||ss.classProbThreshold,Y.modelReady=!1,Y.isPredicting=!1,Y.callback=z,Y.ready=at(Y.loadModel(),Y.callback),S.disableDeprecationNotice||console.warn("WARNING! Function YOLO has been deprecated, please use the new ObjectDetector function instead"),Y}return Te()(k,[{key:"loadModel",value:function(){var w=K()(ke.a.mark(function S(){var z;return ke.a.wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:if(!this.videoElt||this.video){Y.next=4;break}return Y.next=3,this.loadVideo();case 3:this.video=Y.sent;case 4:if(Pu.isAbsoluteURL(this.modelUrl)!==!0){Y.next=10;break}return Y.next=7,F.loadLayersModel(this.modelUrl);case 7:this.model=Y.sent,Y.next=15;break;case 10:return z=Pu.getModelPath(this.modelUrl),this.modelUrl="".concat(z,"/model.json"),Y.next=14,F.loadLayersModel(this.modelUrl);case 14:this.model=Y.sent;case 15:return this.modelReady=!0,Y.abrupt("return",this);case 17:case"end":return Y.stop()}},S,this)}));return function(){return w.apply(this,arguments)}}()},{key:"detect",value:function(){var w=K()(ke.a.mark(function S(z,Y){var ce,ve;return ke.a.wrap(function(De){for(;;)switch(De.prev=De.next){case 0:return De.next=2,this.ready;case 2:if(ve=Y,!Dn(z)){De.next=7;break}ce=z,De.next=21;break;case 7:if(we()(z)!=="object"||!Dn(z.elt)){De.next=11;break}ce=z.elt,De.next=21;break;case 11:if(we()(z)!=="object"||!Dn(z.canvas)){De.next=15;break}ce=z.canvas,De.next=21;break;case 15:if(typeof z!="function"){De.next=20;break}ce=this.video,ve=z,De.next=21;break;case 20:throw new Error("Detection subject not supported");case 21:return De.abrupt("return",at(this.detectInternal(ce),ve));case 22:case"end":return De.stop()}},S,this)}));return function(S,z){return w.apply(this,arguments)}}()},{key:"detectInternal",value:function(){var w=K()(ke.a.mark(function S(z){var Y,ce,ve,De,Ce,Xe,tt,kt,At,tn,sn,wn=this;return ke.a.wrap(function(En){for(;;)switch(En.prev=En.next){case 0:return En.next=2,this.ready;case 2:return En.next=4,F.nextFrame();case 4:return Y=F.tensor2d([[.57273,.677385],[1.87446,2.06253],[3.33843,5.47434],[7.88282,3.52778],[9.77052,9.16828]]),this.isPredicting=!0,ce=F.tidy(function(){var Tn=Gn(z,[Eo,Eo]),Pn=so(wn.model.predict(Tn),Y,80),dn=Sn()(Pn,4),cr=dn[0],kr=dn[1],yr=dn[2],Br=dn[3];return[Io(cr,kr),yr,Br]}),ve=Sn()(ce,3),De=ve[0],Ce=ve[1],Xe=ve[2],En.next=9,wc(De,Ce,Xe,this.filterBoxesThreshold);case 9:if(tt=En.sent,kt=Sn()(tt,3),At=kt[0],tn=kt[1],sn=kt[2],De.dispose(),Ce.dispose(),Xe.dispose(),At!=null){En.next=19;break}return En.abrupt("return",[]);case 19:return En.abrupt("return",F.tidy(function(){var Tn=F.scalar(Eo),Pn=F.scalar(Eo),dn=F.stack([Pn,Tn,Pn,Tn]).reshape([1,4]),cr=F.mul(At,dn),kr=cr.dataSync(),yr=tn.dataSync(),Br=Vc(kr,yr,wn.IOUThreshold),_r=Sn()(Br,3),hi=_r[0],Ei=_r[1],xi=_r[2],ya=[];return sn.gather(F.tensor1d(hi,"int32")).dataSync().forEach(function(Ua,Ta){var Da=xi[Ta];if(!(Da<wn.classProbThreshold)){var Ra=vf[Ua],Qa=Sn()(Ei[Ta],4),oo=Qa[0],wo=Qa[1],Ks=Qa[2],Ti=Qa[3];oo=Math.max(0,oo),wo=Math.max(0,wo),Ks=Math.min(Eo,Ks)-oo;var Ho={label:Ra,confidence:Da,x:wo,y:oo,width:Ti=Math.min(Eo,Ti)-wo,height:Ks,normalized:{x:wo/Eo,y:oo/Eo,width:Ti/Eo,height:Ks/Eo}};ya.push(Ho)}}),wn.isPredicting=!1,Tn.dispose(),Pn.dispose(),dn.dispose(),cr.dispose(),At.dispose(),tn.dispose(),sn.dispose(),Y.dispose(),ya}));case 20:case"end":return En.stop()}},S,this)}));return function(S){return w.apply(this,arguments)}}()}]),k}(Fr),Cl=function(I,E,k){var w=null,S={},z=k;return I instanceof HTMLVideoElement?w=I:we()(I)==="object"&&I.elt instanceof HTMLVideoElement?w=I.elt:typeof I=="function"?z=I:we()(I)==="object"&&(S=I),we()(E)==="object"?S=E:typeof E=="function"&&(z=E),new nc(w,S,z)},rc=o(242),su={base:"lite_mobilenet_v2",modelUrl:void 0},Oh=function(){function I(E,k,w){pe()(this,I),this.video=E||null,this.modelReady=!1,this.isPredicting=!1,this.config={base:k.base||su.base,modelUrl:k.modelUrl||su.modelUrl},this.callback=w,this.ready=at(this.loadModel(),this.callback)}return Te()(I,[{key:"loadModel",value:function(){var E=K()(ke.a.mark(function k(){return ke.a.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return w.next=2,rc.load(this.config);case 2:return this.model=w.sent,this.modelReady=!0,w.abrupt("return",this);case 5:case"end":return w.stop()}},k,this)}));return function(){return E.apply(this,arguments)}}()},{key:"detectInternal",value:function(){var E=K()(ke.a.mark(function k(w){var S,z;return ke.a.wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:return this.isPredicting=!0,Y.next=3,this.model.detect(w);case 3:return S=Y.sent,z=S.map(function(ce){return{label:ce.class,confidence:ce.score,x:ce.bbox[0],y:ce.bbox[1],width:ce.bbox[2],height:ce.bbox[3],normalized:{x:ce.bbox[0]/w.width,y:ce.bbox[1]/w.height,width:ce.bbox[2]/w.width,height:ce.bbox[3]/w.height}}}),this.isPredicting=!1,Y.abrupt("return",z);case 7:case"end":return Y.stop()}},k,this)}));return function(k){return E.apply(this,arguments)}}()},{key:"detect",value:function(){var E=K()(ke.a.mark(function k(w,S){var z,Y;return ke.a.wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:return ce.next=2,this.ready;case 2:return ce.next=4,F.nextFrame();case 4:if(Y=S,!Dn(w)){ce.next=9;break}z=w,ce.next=23;break;case 9:if(we()(w)!=="object"||!Dn(w.elt)){ce.next=13;break}z=w.elt,ce.next=23;break;case 13:if(we()(w)!=="object"||!Dn(w.canvas)){ce.next=17;break}z=w.canvas,ce.next=23;break;case 17:if(typeof w!="function"){ce.next=22;break}z=this.video,Y=w,ce.next=23;break;case 22:throw new Error("Detection subject not supported");case 23:return ce.abrupt("return",at(this.detectInternal(z),Y));case 24:case"end":return ce.stop()}},k,this)}));return function(k,w){return E.apply(this,arguments)}}()}]),I}(),bf=function(I,E,k){var w=null,S={},z=k;return I instanceof HTMLVideoElement?w=I:we()(I)==="object"&&I.elt instanceof HTMLVideoElement?w=I.elt:typeof I=="function"?z=I:we()(I)==="object"&&(S=I),we()(E)==="object"?S=E:typeof E=="function"&&(z=E),new Oh(w,S,z)};function xf(I,E){var k=Object.keys(I);if(Object.getOwnPropertySymbols){var w=Object.getOwnPropertySymbols(I);E&&(w=w.filter(function(S){return Object.getOwnPropertyDescriptor(I,S).enumerable})),k.push.apply(k,w)}return k}var lo=Te()(function I(E,k,w,S){switch(pe()(this,I),this.video=k,this.modelNameOrUrl=E,this.options=w||{},this.callback=S,E){case"yolo":return this.model=new Cl(this.video,function(z){for(var Y=1;Y<arguments.length;Y++){var ce=arguments[Y]!=null?arguments[Y]:{};Y%2?xf(Object(ce),!0).forEach(function(ve){ee()(z,ve,ce[ve])}):Object.getOwnPropertyDescriptors?Object.defineProperties(z,Object.getOwnPropertyDescriptors(ce)):xf(Object(ce)).forEach(function(ve){Object.defineProperty(z,ve,Object.getOwnPropertyDescriptor(ce,ve))})}return z}({disableDeprecationNotice:!0},this.options),S),this;case"cocossd":default:return this.model=new bf(this.video,this.options,S),this}}),Ah=function(I,E,k,w){var S,z={},Y=w,ce=I;if(typeof ce!="string")throw new Error('Please specify a model to use. E.g: "YOLO"');ce.indexOf("http")===-1&&(ce=I.toLowerCase()),E instanceof HTMLVideoElement?S=E:we()(E)==="object"&&E.elt instanceof HTMLVideoElement?S=E.elt:we()(E)==="object"?z=E:typeof E=="function"&&(Y=E),we()(k)==="object"?z=k:typeof k=="function"&&(Y=k);var ve=new lo(ce,S,z,Y);return ve.model.callback?ve.model:ve.model.ready},Nd=o(99),wf=o.n(Nd),kf=function(I,E){return(kf=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(k,w){k.__proto__=w}||function(k,w){for(var S in w)w.hasOwnProperty(S)&&(k[S]=w[S])})(I,E)};function ys(I,E){function k(){this.constructor=I}kf(I,E),I.prototype=E===null?Object.create(E):(k.prototype=E.prototype,new k)}var Ef=function(){return(Ef=Object.assign||function(I){for(var E,k=1,w=arguments.length;k<w;k++)for(var S in E=arguments[k])Object.prototype.hasOwnProperty.call(E,S)&&(I[S]=E[S]);return I}).apply(this,arguments)};function or(I,E,k,w){return new(k||(k=Promise))(function(S,z){function Y(De){try{ve(w.next(De))}catch(Ce){z(Ce)}}function ce(De){try{ve(w.throw(De))}catch(Ce){z(Ce)}}function ve(De){De.done?S(De.value):new k(function(Ce){Ce(De.value)}).then(Y,ce)}ve((w=w.apply(I,[])).next())})}function xu(I,E){var k,w,S,z,Y={label:0,sent:function(){if(1&S[0])throw S[1];return S[1]},trys:[],ops:[]};return z={next:ce(0),throw:ce(1),return:ce(2)},typeof Symbol=="function"&&(z[Symbol.iterator]=function(){return this}),z;function ce(ve){return function(De){return function(Ce){if(k)throw new TypeError("Generator is already executing.");for(;Y;)try{if(k=1,w&&(S=2&Ce[0]?w.return:Ce[0]?w.throw||((S=w.return)&&S.call(w),0):w.next)&&!(S=S.call(w,Ce[1])).done)return S;switch(w=0,S&&(Ce=[2&Ce[0],S.value]),Ce[0]){case 0:case 1:S=Ce;break;case 4:return Y.label++,{value:Ce[1],done:!1};case 5:Y.label++,w=Ce[1],Ce=[0];continue;case 7:Ce=Y.ops.pop(),Y.trys.pop();continue;default:if(!(S=(S=Y.trys).length>0&&S[S.length-1])&&(Ce[0]===6||Ce[0]===2)){Y=0;continue}if(Ce[0]===3&&(!S||Ce[1]>S[0]&&Ce[1]<S[3])){Y.label=Ce[1];break}if(Ce[0]===6&&Y.label<S[1]){Y.label=S[1],S=Ce;break}if(S&&Y.label<S[2]){Y.label=S[2],Y.ops.push(Ce);break}S[2]&&Y.ops.pop(),Y.trys.pop();continue}Ce=E.call(I,Y)}catch(Xe){Ce=[6,Xe],w=0}finally{k=S=0}if(5&Ce[0])throw Ce[1];return{value:Ce[0]?Ce[1]:void 0,done:!0}}([ve,De])}}}var Tp=function(){function I(E,k){this.model=E,this.outputStride=k;var w=this.model.inputs[0].shape;Ye.util.assert(w[1]===-1&&w[2]===-1,function(){return"Input shape ["+w[1]+", "+w[2]+"] must both be equal to or -1"})}return I.prototype.predict=function(E){var k=this;return Object(Ye.tidy)(function(){var w=k.preprocessInput(Object(Ye.cast)(E,"float32")),S=Object(Ye.expandDims)(w,0),z=k.model.predict(S).map(function(ce){return Object(Ye.squeeze)(ce,[0])}),Y=k.nameOutputResults(z);return{heatmapScores:Object(Ye.sigmoid)(Y.heatmap),offsets:Y.offsets,displacementFwd:Y.displacementFwd,displacementBwd:Y.displacementBwd}})},I.prototype.dispose=function(){this.model.dispose()},I}(),Np=function(I){function E(){return I!==null&&I.apply(this,arguments)||this}return ys(E,I),E.prototype.preprocessInput=function(k){return Object(Ye.tidy)(function(){return Object(Ye.sub)(Object(Ye.div)(k,127.5),1)})},E.prototype.nameOutputResults=function(k){return{offsets:k[0],heatmap:k[1],displacementFwd:k[2],displacementBwd:k[3]}},E}(Tp);function Cf(I){return Math.floor(I/2)}var Ol=function(){function I(E,k){this.priorityQueue=new Array(E),this.numberOfElements=-1,this.getElementValue=k}return I.prototype.enqueue=function(E){this.priorityQueue[++this.numberOfElements]=E,this.swim(this.numberOfElements)},I.prototype.dequeue=function(){var E=this.priorityQueue[0];return this.exchange(0,this.numberOfElements--),this.sink(0),this.priorityQueue[this.numberOfElements+1]=null,E},I.prototype.empty=function(){return this.numberOfElements===-1},I.prototype.size=function(){return this.numberOfElements+1},I.prototype.all=function(){return this.priorityQueue.slice(0,this.numberOfElements+1)},I.prototype.max=function(){return this.priorityQueue[0]},I.prototype.swim=function(E){for(;E>0&&this.less(Cf(E),E);)this.exchange(E,Cf(E)),E=Cf(E)},I.prototype.sink=function(E){for(;2*E<=this.numberOfElements;){var k=2*E;if(k<this.numberOfElements&&this.less(k,k+1)&&k++,!this.less(E,k))break;this.exchange(E,k),E=k}},I.prototype.getValueAt=function(E){return this.getElementValue(this.priorityQueue[E])},I.prototype.less=function(E,k){return this.getValueAt(E)<this.getValueAt(k)},I.prototype.exchange=function(E,k){var w=this.priorityQueue[E];this.priorityQueue[E]=this.priorityQueue[k],this.priorityQueue[k]=w},I}();function Id(I,E,k,w,S,z){for(var Y=z.shape,ce=Y[0],ve=Y[1],De=!0,Ce=Math.max(k-S,0),Xe=Math.min(k+S+1,ce),tt=Ce;tt<Xe;++tt){for(var kt=Math.max(w-S,0),At=Math.min(w+S+1,ve),tn=kt;tn<At;++tn)if(z.get(tt,tn,I)>E){De=!1;break}if(!De)break}return De}var _h=["nose","leftEye","rightEye","leftEar","rightEar","leftShoulder","rightShoulder","leftElbow","rightElbow","leftWrist","rightWrist","leftHip","rightHip","leftKnee","rightKnee","leftAnkle","rightAnkle"],Sh=_h.length,Fi=_h.reduce(function(I,E,k){return I[E]=k,I},{}),Na=[["leftHip","leftShoulder"],["leftElbow","leftShoulder"],["leftElbow","leftWrist"],["leftHip","leftKnee"],["leftKnee","leftAnkle"],["rightHip","rightShoulder"],["rightElbow","rightShoulder"],["rightElbow","rightWrist"],["rightHip","rightKnee"],["rightKnee","rightAnkle"],["leftShoulder","rightShoulder"],["leftHip","rightHip"]].map(function(I){var E=I[0],k=I[1];return[Fi[E],Fi[k]]});function Dh(I,E,k,w){return{y:w.get(I,E,k),x:w.get(I,E,k+Sh)}}function bm(I,E,k){var w=Dh(I.heatmapY,I.heatmapX,I.id,k),S=w.y,z=w.x;return{x:I.heatmapX*E+z,y:I.heatmapY*E+S}}function Of(I,E,k){return I<E?E:I>k?k:I}function Fd(I,E){return{x:I.x+E.x,y:I.y+E.y}}var bs=[["nose","leftEye"],["leftEye","leftEar"],["nose","rightEye"],["rightEye","rightEar"],["nose","leftShoulder"],["leftShoulder","leftElbow"],["leftElbow","leftWrist"],["leftShoulder","leftHip"],["leftHip","leftKnee"],["leftKnee","leftAnkle"],["nose","rightShoulder"],["rightShoulder","rightElbow"],["rightElbow","rightWrist"],["rightShoulder","rightHip"],["rightHip","rightKnee"],["rightKnee","rightAnkle"]].map(function(I){var E=I[0],k=I[1];return[Fi[E],Fi[k]]}),ic=bs.map(function(I){return I[1]}),Rd=bs.map(function(I){return I[0]});function Ip(I,E,k,w){return{y:Of(Math.round(I.y/E),0,k-1),x:Of(Math.round(I.x/E),0,w-1)}}function Fp(I,E,k,w,S,z,Y,ce){ce===void 0&&(ce=2);for(var ve=w.shape,De=ve[0],Ce=ve[1],Xe=function(En,Tn,Pn){var dn=Pn.shape[2]/2;return{y:Pn.get(Tn.y,Tn.x,En),x:Pn.get(Tn.y,Tn.x,dn+En)}}(I,Ip(E.position,z,De,Ce),Y),tt=Fd(E.position,Xe),kt=0;kt<ce;kt++){var At=Ip(tt,z,De,Ce),tn=Dh(At.y,At.x,k,S);tt=Fd({x:At.x*z,y:At.y*z},{x:tn.x,y:tn.y})}var sn=Ip(tt,z,De,Ce),wn=w.get(sn.y,sn.x,k);return{position:tt,part:_h[k],score:wn}}function xm(I,E,k,w,S,z){var Y=E.shape[2],ce=ic.length,ve=new Array(Y),De=I.part,Ce=I.score,Xe=bm(De,w,k);ve[De.id]={score:Ce,part:_h[De.id],position:Xe};for(var tt=ce-1;tt>=0;--tt){var kt=ic[tt],At=Rd[tt];ve[kt]&&!ve[At]&&(ve[At]=Fp(tt,ve[kt],At,E,k,w,z))}for(tt=0;tt<ce;++tt)kt=Rd[tt],At=ic[tt],ve[kt]&&!ve[At]&&(ve[At]=Fp(tt,ve[kt],At,E,k,w,S));return ve}function wm(I,E,k,w){var S=k.x,z=k.y;return I.some(function(Y){var ce=Y.keypoints[w].position;return function(ve,De,Ce,Xe){var tt=Ce-ve,kt=Xe-De;return tt*tt+kt*kt}(z,S,ce.y,ce.x)<=E})}function qc(I,E,k){return k.reduce(function(w,S,z){var Y=S.position,ce=S.score;return wm(I,E,Y,z)||(w+=ce),w},0)/k.length}var zo=1;function Th(I,E,k,w,S,z,Y,ce){Y===void 0&&(Y=.5),ce===void 0&&(ce=20);for(var ve=[],De=function(At,tn,sn){for(var wn=sn.shape,En=wn[0],Tn=wn[1],Pn=wn[2],dn=new Ol(En*Tn*Pn,function(_r){return _r.score}),cr=0;cr<En;++cr)for(var kr=0;kr<Tn;++kr)for(var yr=0;yr<Pn;++yr){var Br=sn.get(cr,kr,yr);Br<At||Id(yr,Br,cr,kr,tn,sn)&&dn.enqueue({score:Br,part:{heatmapY:cr,heatmapX:kr,id:yr}})}return dn}(Y,zo,I),Ce=ce*ce;ve.length<z&&!De.empty();){var Xe=De.dequeue();if(!wm(ve,Ce,bm(Xe.part,S,E),Xe.part.id)){var tt=xm(Xe,I,E,S,k,w),kt=qc(ve,Ce,tt);ve.push({keypoints:tt,score:kt})}}return ve}function Ke(I){var E=I.shape,k=E[0],w=E[1],S=E[2];return Object(Ye.tidy)(function(){var z=Object(Ye.reshape)(I,[k*w,S]),Y=Object(Ye.argMax)(z,0),ce=Object(Ye.expandDims)(Object(Ye.div)(Y,Object(Ye.scalar)(w,"int32")),1),ve=Object(Ye.expandDims)(function(De,Ce){return Object(Ye.tidy)(function(){var Xe=Object(Ye.div)(De,Object(Ye.scalar)(Ce,"int32"));return Object(Ye.sub)(De,Object(Ye.mul)(Xe,Object(Ye.scalar)(Ce,"int32")))})}(Y,w),1);return Object(Ye.concat)([ce,ve],1)})}function Lu(I,E,k,w){return{y:w.get(I,E,k),x:w.get(I,E,k+Sh)}}function Af(I,E,k){return Object(Ye.tidy)(function(){var w=function(S,z){for(var Y=[],ce=0;ce<Sh;ce++){var ve=Lu(S.get(ce,0).valueOf(),S.get(ce,1).valueOf(),ce,z),De=ve.x,Ce=ve.y;Y.push(Ce),Y.push(De)}return Object(Ye.tensor2d)(Y,[Sh,2])}(I,k);return Object(Ye.add)(Object(Ye.cast)(Object(Ye.mul)(I.toTensor(),Object(Ye.scalar)(E,"int32")),"float32"),w)})}function Md(I,E,k){return or(this,void 0,void 0,function(){var w,S,z,Y,ce,ve,De,Ce,Xe,tt;return xu(this,function(kt){switch(kt.label){case 0:return w=0,S=Ke(I),[4,Promise.all([I.buffer(),E.buffer(),S.buffer()])];case 1:return z=kt.sent(),Y=z[0],ce=z[1],ve=z[2],[4,(De=Af(ve,k,ce)).buffer()];case 2:return Ce=kt.sent(),Xe=Array.from(function(At,tn){for(var sn=tn.shape[0],wn=new Float32Array(sn),En=0;En<sn;En++){var Tn=tn.get(En,0),Pn=tn.get(En,1);wn[En]=At.get(Tn,Pn,En)}return wn}(Y,ve)),tt=Xe.map(function(At,tn){return w+=At,{position:{y:Ce.get(tn,0),x:Ce.get(tn,1)},part:_h[tn],score:At}}),S.dispose(),De.dispose(),[2,{keypoints:tt,score:w/tt.length}]}})})}var Aa="https://storage.googleapis.com/tfjs-models/savedmodel/posenet/mobilenet/",_a="https://storage.googleapis.com/tfjs-models/savedmodel/posenet/resnet50/",Ga=[-123.15,-115.9,-103.06],Co=function(I){function E(){return I!==null&&I.apply(this,arguments)||this}return ys(E,I),E.prototype.preprocessInput=function(k){return Object(Ye.add)(k,Ga)},E.prototype.nameOutputResults=function(k){var w=k[0],S=k[1];return{offsets:k[2],heatmap:k[3],displacementFwd:w,displacementBwd:S}},E}(Tp);function wu(I,E){return xt(I,E)?I:Math.floor(I/E)*E+1}function Oo(I){Ye.util.assert(typeof I=="number"||typeof I=="object",function(){return"Invalid inputResolution "+I+". Should be a number or an object with width and height"}),typeof I=="object"&&(Ye.util.assert(typeof I.width=="number",function(){return"inputResolution.width has a value of "+I.width+" which is invalid; it must be a number"}),Ye.util.assert(typeof I.height=="number",function(){return"inputResolution.height has a value of "+I.height+" which is invalid; it must be a number"}))}function kc(I,E){return Oo(I),typeof I=="object"?[wu(I.height,E),wu(I.width,E)]:[wu(I,E),wu(I,E)]}var Zs=[8,16,32];function xt(I,E){return(I-1)%E==0}function fa(I){return I instanceof Ye.Tensor?[I.shape[0],I.shape[1]]:[I.height,I.width]}function uo(I,E){var k=E[0],w=E[1],S=fa(I),z=S[0],Y=S[1],ce=w/k,ve=[0,0,0,0],De=ve[0],Ce=ve[1],Xe=ve[2],tt=ve[3];return Y/z<ce?(De=0,Ce=0,Xe=Math.round(.5*(ce*z-Y)),tt=Math.round(.5*(ce*z-Y))):(De=Math.round(.5*(1/ce*Y-z)),Ce=Math.round(.5*(1/ce*Y-z)),Xe=0,tt=0),{resized:Object(Ye.tidy)(function(){var kt=function(At){return At instanceof Ye.Tensor?At:Ye.browser.fromPixels(At)}(I);return kt=Object(Ye.pad3d)(kt,[[De,Ce],[Xe,tt],[0,0]]),Ye.image.resizeBilinear(kt,[k,w])}),padding:{top:De,left:Xe,right:tt,bottom:Ce}}}function Uo(I,E,k,w,S){var z=E[0],Y=E[1],ce=k[0],ve=k[1],De=function(Ce,Xe,tt,kt,At){return kt===void 0&&(kt=0),At===void 0&&(At=0),tt===1&&Xe===1&&kt===0&&At===0?Ce:Ce.map(function(tn){return function(sn,wn,En,Tn,Pn){return Tn===void 0&&(Tn=0),Pn===void 0&&(Pn=0),{score:sn.score,keypoints:sn.keypoints.map(function(dn){var cr=dn.score,kr=dn.part,yr=dn.position;return{score:cr,part:kr,position:{x:yr.x*En+Pn,y:yr.y*wn+Tn}}})}}(tn,Xe,tt,kt,At)})}(I,(z+w.top+w.bottom)/ce,(Y+w.left+w.right)/ve,-w.top,-w.left);return S?function(Ce,Xe){return Xe<=0?Ce:Ce.map(function(tt){return function(kt,At){return{score:kt.score,keypoints:kt.keypoints.map(function(tn){var sn=tn.score,wn=tn.part,En=tn.position;return{score:sn,part:wn,position:{x:At-1-En.x,y:En.y}}})}}(tt,Xe)})}(De,Y):De}var wa={architecture:"MobileNetV1",outputStride:16,multiplier:.75,inputResolution:257},xs=["MobileNetV1","ResNet50"],fr={MobileNetV1:[8,16,32],ResNet50:[32,16]},zs={MobileNetV1:[.5,.75,1],ResNet50:[1]},eu=[1,2,4],Hc={flipHorizontal:!1},Us={flipHorizontal:!1,maxDetections:5,scoreThreshold:.5,nmsRadius:20},Nh=function(){function I(E,k){(function(w){Ye.util.assert(typeof w=="number",function(){return"outputStride is not a number"}),Ye.util.assert(Zs.indexOf(w)>=0,function(){return"outputStride of "+w+" is invalid. It must be either 8, 16, or 32"})})(E.outputStride),function(w,S){Ye.util.assert(typeof w[0]=="number"&&typeof w[1]=="number",function(){return"both resolution values must be a number but had values "+w}),Ye.util.assert(xt(w[0],S),function(){return"height of "+w[0]+" is invalid for output stride "+S+"."}),Ye.util.assert(xt(w[1],S),function(){return"width of "+w[1]+" is invalid for output stride "+S+"."})}(k,E.outputStride),this.baseModel=E,this.inputResolution=k}return I.prototype.estimateMultiplePoses=function(E,k){return k===void 0&&(k=Us),or(this,void 0,void 0,function(){var w,S,z,Y,ce,ve,De,Ce,Xe,tt,kt,At,tn,sn,wn,En,Tn,Pn,dn,cr,kr;return xu(this,function(yr){switch(yr.label){case 0:return w=Ef({},Us,k),function(Br){var _r=Br.maxDetections,hi=Br.scoreThreshold,Ei=Br.nmsRadius;if(_r<=0)throw new Error("Invalid maxDetections "+_r+". Should be > 0");if(hi<0||hi>1)throw new Error("Invalid scoreThreshold "+hi+". Should be in range [0.0, 1.0]");if(Ei<=0)throw new Error("Invalid nmsRadius "+Ei+".")}(k),S=this.baseModel.outputStride,z=this.inputResolution,Y=fa(E),ce=Y[0],ve=Y[1],De=uo(E,z),Ce=De.resized,Xe=De.padding,tt=this.baseModel.predict(Ce),kt=tt.heatmapScores,At=tt.offsets,tn=tt.displacementFwd,sn=tt.displacementBwd,[4,function(Br){return or(this,void 0,void 0,function(){return xu(this,function(_r){return[2,Promise.all(Br.map(function(hi){return hi.buffer()}))]})})}([kt,At,tn,sn])];case 1:return wn=yr.sent(),En=wn[0],Tn=wn[1],Pn=wn[2],dn=wn[3],[4,Th(En,Tn,Pn,dn,S,w.maxDetections,w.scoreThreshold,w.nmsRadius)];case 2:return cr=yr.sent(),kr=Uo(cr,[ce,ve],z,Xe,w.flipHorizontal),kt.dispose(),At.dispose(),tn.dispose(),sn.dispose(),Ce.dispose(),[2,kr]}})})},I.prototype.estimateSinglePose=function(E,k){return k===void 0&&(k=Hc),or(this,void 0,void 0,function(){var w,S,z,Y,ce,ve,De,Ce,Xe,tt,kt,At,tn,sn,wn,En;return xu(this,function(Tn){switch(Tn.label){case 0:return w=Ef({},Hc,k),S=this.baseModel.outputStride,z=this.inputResolution,Y=fa(E),ce=Y[0],ve=Y[1],De=uo(E,z),Ce=De.resized,Xe=De.padding,tt=this.baseModel.predict(Ce),kt=tt.heatmapScores,At=tt.offsets,tn=tt.displacementFwd,sn=tt.displacementBwd,[4,Md(kt,At,S)];case 1:return wn=Tn.sent(),En=Uo([wn],[ce,ve],z,Xe,w.flipHorizontal),kt.dispose(),At.dispose(),tn.dispose(),sn.dispose(),Ce.dispose(),[2,En[0]]}})})},I.prototype.estimatePoses=function(E,k){return or(this,void 0,void 0,function(){return xu(this,function(w){switch(w.label){case 0:return k.decodingMethod!=="single-person"?[3,2]:[4,this.estimateSinglePose(E,k)];case 1:return[2,[w.sent()]];case 2:return[2,this.estimateMultiplePoses(E,k)]}})})},I.prototype.dispose=function(){this.baseModel.dispose()},I}();function jd(I){return or(this,void 0,void 0,function(){var E,k,w,S,z,Y,ce;return xu(this,function(ve){switch(ve.label){case 0:if(E=I.outputStride,k=I.quantBytes,w=I.multiplier,Ye==null)throw new Error(`Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this
        model.`);return S=function(De,Ce,Xe){var tt={1:"100",.75:"075",.5:"050"},kt="model-stride"+De+".json";return Xe===4?Aa+"float/"+tt[Ce]+"/"+kt:Aa+"quant"+Xe+"/"+tt[Ce]+"/"+kt}(E,w,k),[4,Object(Pt.loadGraphModel)(I.modelUrl||S)];case 1:return z=ve.sent(),Y=new Np(z,E),ce=kc(I.inputResolution,Y.outputStride),[2,new Nh(Y,ce)]}})})}function Bd(I){return or(this,void 0,void 0,function(){var E,k,w,S,z,Y;return xu(this,function(ce){switch(ce.label){case 0:if(E=I.outputStride,k=I.quantBytes,Ye==null)throw new Error(`Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this
        model.`);return w=function(ve,De){var Ce="model-stride"+ve+".json";return De===4?_a+"float/"+Ce:_a+"quant"+De+"/"+Ce}(E,k),[4,Object(Pt.loadGraphModel)(I.modelUrl||w)];case 1:return S=ce.sent(),z=new Co(S,E),Y=kc(I.inputResolution,z.outputStride),[2,new Nh(z,Y)]}})})}function uu(I){return I===void 0&&(I=wa),or(this,void 0,void 0,function(){return xu(this,function(E){return(I=function(k){if((k=k||wa).architecture==null&&(k.architecture="MobileNetV1"),xs.indexOf(k.architecture)<0)throw new Error("Invalid architecture "+k.architecture+". Should be one of "+xs);if(k.inputResolution==null&&(k.inputResolution=257),Oo(k.inputResolution),k.outputStride==null&&(k.outputStride=16),fr[k.architecture].indexOf(k.outputStride)<0)throw new Error("Invalid outputStride "+k.outputStride+". Should be one of "+fr[k.architecture]+" for architecture "+k.architecture+".");if(k.multiplier==null&&(k.multiplier=1),zs[k.architecture].indexOf(k.multiplier)<0)throw new Error("Invalid multiplier "+k.multiplier+". Should be one of "+zs[k.architecture]+" for architecture "+k.architecture+".");if(k.quantBytes==null&&(k.quantBytes=4),eu.indexOf(k.quantBytes)<0)throw new Error("Invalid quantBytes "+k.quantBytes+". Should be one of "+eu+" for architecture "+k.architecture+".");if(k.architecture==="MobileNetV1"&&k.outputStride===32&&k.multiplier!==1)throw new Error("When using an output stride of 32, you must select 1 as the multiplier.");return k}(I)).architecture==="ResNet50"?[2,Bd(I)]:I.architecture==="MobileNetV1"?[2,jd(I)]:[2,null]})})}function Ki(I){var E=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var k,w=os()(I);if(E){var S=os()(this).constructor;k=Reflect.construct(w,arguments,S)}else k=w.apply(this,arguments);return xc()(this,k)}}var ws={architecture:"MobileNetV1",outputStride:16,flipHorizontal:!1,minConfidence:.5,maxPoseDetections:5,scoreThreshold:.5,nmsRadius:20,detectionType:"multiple",inputResolution:256,multiplier:.75,quantBytes:2},Ih=function(I){bc()(k,I);var E=Ki(k);function k(w,S,z,Y){var ce;return pe()(this,k),(ce=E.call(this)).video=w,ce.modelUrl=S.modelUrl||null,ce.architecture=S.architecture||ws.architecture,ce.detectionType=z||S.detectionType||ws.detectionType,ce.outputStride=S.outputStride||ws.outputStride,ce.flipHorizontal=S.flipHorizontal||ws.flipHorizontal,ce.scoreThreshold=S.scoreThreshold||ws.scoreThreshold,ce.minConfidence=S.minConfidence||ws.minConfidence,ce.maxPoseDetections=S.maxPoseDetections||ws.maxPoseDetections,ce.multiplier=S.multiplier||ws.multiplier,ce.inputResolution=S.inputResolution||ws.inputResolution,ce.quantBytes=S.quantBytes||ws.quantBytes,ce.nmsRadius=S.nmsRadius||ws.nmsRadius,ce.ready=at(ce.load(),Y),ce}return Te()(k,[{key:"load",value:function(){var w=K()(ke.a.mark(function S(){var z,Y=this;return ke.a.wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:return z=this.architecture.toLowerCase()==="mobilenetv1"?{architecture:this.architecture,outputStride:this.outputStride,inputResolution:this.inputResolution,multiplier:this.multiplier,quantBytes:this.quantBytes,modelUrl:this.modelUrl}:{architecture:this.architecture,outputStride:this.outputStride,inputResolution:this.inputResolution,quantBytes:this.quantBytes},ce.next=3,uu(z);case 3:if(this.net=ce.sent,!this.video){ce.next=9;break}if(this.video.readyState!==0){ce.next=8;break}return ce.next=8,new Promise(function(ve){Y.video.onloadeddata=function(){return ve()}});case 8:this.detectionType==="single"?this.singlePose():this.multiPose();case 9:return ce.abrupt("return",this);case 10:case"end":return ce.stop()}},S,this)}));return function(){return w.apply(this,arguments)}}()},{key:"skeleton",value:function(w){return function(S,z){return Na.reduce(function(Y,ce){var ve=ce[0],De=ce[1];return function(Ce,Xe,tt){return Ce<tt||Xe<tt}(S[ve].score,S[De].score,z)||Y.push([S[ve],S[De]]),Y},[])}(w,arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.minConfidence)}},{key:"mapParts",value:function(w){var S=JSON.parse(JSON.stringify(w));return S.keypoints.forEach(function(z){S[z.part]={x:z.position.x,y:z.position.y,confidence:z.score}}),S}},{key:"getInput",value:function(w){return w instanceof HTMLImageElement||w instanceof HTMLVideoElement||w instanceof HTMLCanvasElement||w instanceof ImageData?w:we()(w)==="object"&&(w.elt instanceof HTMLImageElement||w.elt instanceof HTMLVideoElement||w.elt instanceof ImageData)?w.elt:we()(w)==="object"&&w.canvas instanceof HTMLCanvasElement?w.canvas:this.video}},{key:"singlePose",value:function(){var w=K()(ke.a.mark(function S(z,Y){var ce,ve,De,Ce,Xe=this;return ke.a.wrap(function(tt){for(;;)switch(tt.prev=tt.next){case 0:return ce=this.getInput(z),tt.next=3,this.net.estimateSinglePose(ce,{flipHorizontal:this.flipHorizontal});case 3:if(ve=tt.sent,De=this.mapParts(ve),Ce=[{pose:De,skeleton:this.skeleton(ve.keypoints)}],this.emit("pose",Ce),!this.video){tt.next=9;break}return tt.abrupt("return",F.nextFrame().then(function(){return Xe.singlePose()}));case 9:return typeof Y=="function"&&Y(Ce),tt.abrupt("return",Ce);case 11:case"end":return tt.stop()}},S,this)}));return function(S,z){return w.apply(this,arguments)}}()},{key:"multiPose",value:function(){var w=K()(ke.a.mark(function S(z,Y){var ce,ve,De,Ce,Xe=this;return ke.a.wrap(function(tt){for(;;)switch(tt.prev=tt.next){case 0:return ce=this.getInput(z),tt.next=3,this.net.estimateMultiplePoses(ce,{flipHorizontal:this.flipHorizontal,maxDetections:this.maxPoseDetections,scoreThreshold:this.scoreThreshold,nmsRadius:this.nmsRadius});case 3:if(ve=tt.sent,De=ve.map(function(kt){return Xe.mapParts(kt)}),Ce=De.map(function(kt){return{pose:kt,skeleton:Xe.skeleton(kt.keypoints)}}),this.emit("pose",Ce),!this.video){tt.next=9;break}return tt.abrupt("return",F.nextFrame().then(function(){return Xe.multiPose()}));case 9:return typeof Y=="function"&&Y(Ce),tt.abrupt("return",Ce);case 11:case"end":return tt.stop()}},S,this)}));return function(S,z){return w.apply(this,arguments)}}()}]),k}(wf.a),ac=function(I,E,k){var w,S={},z=k,Y=null;return I instanceof HTMLVideoElement?w=I:we()(I)==="object"&&I.elt instanceof HTMLVideoElement?w=I.elt:we()(I)==="object"?S=I:typeof I=="function"&&(z=I),we()(E)==="object"?S=E:typeof E=="string"&&(Y=E),typeof E=="function"&&(z=E),new Ih(w,S,Y,z)},us=function(){function I(E){pe()(this,I),this.urlPath=E.endsWith("/")?E:"".concat(E,"/"),this.variables={}}return Te()(I,[{key:"loadManifest",value:function(){var E=K()(ke.a.mark(function k(){var w;return ke.a.wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return S.prev=0,S.next=3,Gt.a.get(this.urlPath+"manifest.json");case 3:return w=S.sent,S.abrupt("return",w.data);case 7:throw S.prev=7,S.t0=S.catch(0),new Error("".concat("manifest.json"," not found at ").concat(this.urlPath,". ").concat(S.t0));case 10:case"end":return S.stop()}},k,this,[[0,7]])}));return function(){return E.apply(this,arguments)}}()},{key:"loadVariable",value:function(){var E=K()(ke.a.mark(function k(w){var S,z,Y,ce,ve,De,Ce;return ke.a.wrap(function(Xe){for(;;)switch(Xe.prev=Xe.next){case 0:return Xe.next=2,this.getCheckpointManifest();case 2:if(S=Xe.sent,w in S){Xe.next=5;break}throw new Error("Cannot load non-existent variable ".concat(w));case 5:return z=S[w],Y=z.filename,ce=z.shape,ve=this.urlPath+Y,Xe.prev=7,Xe.next=10,Gt.a.get(ve,{responseType:"arraybuffer"});case 10:return De=Xe.sent,Ce=new Float32Array(De.data),Xe.abrupt("return",F.tensor(Ce,ce));case 15:throw Xe.prev=15,Xe.t0=Xe.catch(7),new Error("Error loading variable ".concat(w," from URL ").concat(ve,": ").concat(Xe.t0));case 18:case"end":return Xe.stop()}},k,this,[[7,15]])}));return function(k){return E.apply(this,arguments)}}()},{key:"getCheckpointManifest",value:function(){var E=K()(ke.a.mark(function k(){return ke.a.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:if(this.checkpointManifest){w.next=4;break}return w.next=3,this.loadManifest();case 3:this.checkpointManifest=w.sent;case 4:return w.abrupt("return",this.checkpointManifest);case 5:case"end":return w.stop()}},k,this)}));return function(){return E.apply(this,arguments)}}()},{key:"getKeys",value:function(){var E=K()(ke.a.mark(function k(){var w;return ke.a.wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return S.next=2,this.getCheckpointManifest();case 2:return w=S.sent,S.abrupt("return",Object.keys(w));case 4:case"end":return S.stop()}},k,this)}));return function(){return E.apply(this,arguments)}}()},{key:"getAllVariables",value:function(){var E=K()(ke.a.mark(function k(){var w,S,z=this;return ke.a.wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:return Y.next=2,this.getKeys();case 2:return w=Y.sent,S=w.map(function(ce){return z.getVariable(ce)}),Y.next=6,Promise.all(S);case 6:return Y.abrupt("return",this.variables);case 7:case"end":return Y.stop()}},k,this)}));return function(){return E.apply(this,arguments)}}()},{key:"getVariable",value:function(){var E=K()(ke.a.mark(function k(w){return ke.a.wrap(function(S){for(;;)switch(S.prev=S.next){case 0:if(this.variables[w]){S.next=4;break}return S.next=3,this.loadVariable(w);case 3:this.variables[w]=S.sent;case 4:return S.abrupt("return",this.variables[w]);case 5:case"end":return S.stop()}},k,this)}));return function(k){return E.apply(this,arguments)}}()}]),I}();function ii(I){var E=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var k,w=os()(I);if(E){var S=os()(this).constructor;k=Reflect.construct(w,arguments,S)}else k=w.apply(this,arguments);return xc()(this,k)}}var Ba=200,Fh=function(I){return new Promise(function(E){var k=new Image(Ba,Ba);k.onload=function(){return E(k)},k.src=I.toDataURL()})},Pd=function(I){bc()(k,I);var E=ii(k);function k(w,S,z){var Y;return pe()(this,k),(Y=E.call(this,S,Ba)).ready=!1,Y.variableDictionary={},Y.timesScalar=F.scalar(150),Y.plusScalar=F.scalar(127.5),Y.epsilonScalar=F.scalar(.001),Y.video=null,Y.ready=at(Y.load(w),z),Y}return Te()(k,[{key:"load",value:function(){var w=K()(ke.a.mark(function S(z){return ke.a.wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:if(!this.videoElt){Y.next=3;break}return Y.next=3,this.loadVideo();case 3:return Y.next=5,this.loadCheckpoints(z);case 5:return Y.abrupt("return",this);case 6:case"end":return Y.stop()}},S,this)}));return function(S){return w.apply(this,arguments)}}()},{key:"loadCheckpoints",value:function(){var w=K()(ke.a.mark(function S(z){var Y;return ke.a.wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:return Y=new us(z),ce.next=3,Y.getAllVariables();case 3:this.variables=ce.sent;case 4:case"end":return ce.stop()}},S,this)}));return function(S){return w.apply(this,arguments)}}()},{key:"instanceNorm",value:function(w,S){var z=this;return F.tidy(function(){var Y=Sn()(w.shape,3),ce=Y[0],ve=Y[1],De=Y[2],Ce=F.moments(w,[0,1]),Xe=Ce.mean,tt=Ce.variance,kt=z.variables[k.getVariableName(S)],At=z.variables[k.getVariableName(S+1)],tn=z.epsilonScalar,sn=F.div(F.sub(w.asType("float32"),Xe),F.sqrt(F.add(tt,tn)));return F.add(F.mul(At,sn),kt).as3D(ce,ve,De)})}},{key:"convLayer",value:function(w,S,z,Y){var ce=F.conv2d(w,this.variables[k.getVariableName(Y)],[S,S],"same"),ve=this.instanceNorm(ce,Y+1);return z?F.relu(ve):ve}},{key:"residualBlock",value:function(w,S){var z=this.convLayer(w,1,!0,S),Y=this.convLayer(z,1,!1,S+3);return F.add(Y,w)}},{key:"convTransposeLayer",value:function(w,S,z,Y){var ce=Sn()(w.shape,2),ve=[ce[0]*z,ce[1]*z,S],De=F.conv2dTranspose(w,this.variables[k.getVariableName(Y)],ve,[z,z],"same"),Ce=this.instanceNorm(De,Y+1);return F.relu(Ce)}},{key:"transfer",value:function(){var w=K()(ke.a.mark(function S(z,Y){var ce,ve;return ke.a.wrap(function(De){for(;;)switch(De.prev=De.next){case 0:if(ve=Y,!(z instanceof HTMLVideoElement||z instanceof HTMLImageElement||z instanceof ImageData)){De.next=5;break}ce=z,De.next=18;break;case 5:if(!(z instanceof HTMLCanvasElement)){De.next=11;break}return De.next=8,Fh(z);case 8:ce=De.sent,De.next=18;break;case 11:if(!(we()(z)==="object"&&z.elt instanceof HTMLCanvasElement)){De.next=17;break}return De.next=14,Fh(z.elt);case 14:ce=De.sent,De.next=18;break;case 17:we()(z)==="object"&&(z.elt instanceof HTMLVideoElement||z.elt instanceof HTMLImageElement||z.elt instanceof ImageData)?ce=z.elt:typeof z=="function"&&(ce=this.video,ve=z);case 18:return De.abrupt("return",at(this.transferInternal(ce),ve));case 19:case"end":return De.stop()}},S,this)}));return function(S,z){return w.apply(this,arguments)}}()},{key:"transferInternal",value:function(){var w=K()(ke.a.mark(function S(z){var Y,ce,ve=this;return ke.a.wrap(function(De){for(;;)switch(De.prev=De.next){case 0:return Y=F.browser.fromPixels(z),ce=hn(F.tidy(function(){var Ce=ve.convLayer(Y,1,!0,0),Xe=ve.convLayer(Ce,2,!0,3),tt=ve.convLayer(Xe,2,!0,6),kt=ve.residualBlock(tt,9),At=ve.residualBlock(kt,15),tn=ve.residualBlock(At,21),sn=ve.residualBlock(tn,27),wn=ve.residualBlock(sn,33),En=ve.convTransposeLayer(wn,64,2,39),Tn=ve.convTransposeLayer(En,32,2,42),Pn=ve.convLayer(Tn,1,!1,45),dn=F.tanh(Pn),cr=F.mul(ve.timesScalar,dn),kr=F.add(ve.plusScalar,cr),yr=F.clipByValue(kr,0,255);return F.div(yr,F.scalar(255))})),Y.dispose(),De.next=5,F.nextFrame();case 5:return De.abrupt("return",ce);case 6:case"end":return De.stop()}},S)}));return function(S){return w.apply(this,arguments)}}()}],[{key:"getVariableName",value:function(w){return w===0?"Variable":"Variable_".concat(w)}}]),k}(Fr),Al=function(I,E,k){var w=k;typeof E=="function"&&(w=E);var S=new Pd(I,E,w);return w?S:S.ready},Rh=function(I){for(var E,k=Math.random(),w=0,S=0;S<I.length;S+=1)if(k<(w+=I[S])){E=S;break}return E},Ri=/cell_[0-9]|lstm_[0-9]/gi,bi=/weights|weight|kernel|kernels|w/gi,ro=/softmax/gi,Ld=function(){function I(E,k){pe()(this,I),this.ready=!1,this.model={},this.cellsAmount=0,this.cells=[],this.zeroState={c:[],h:[]},this.state={c:[],h:[]},this.vocab={},this.vocabSize=0,this.probabilities=[],this.defaults={seed:"a",length:20,temperature:.5,stateful:!1},this.ready=at(this.loadCheckpoints(E),k)}return Te()(I,[{key:"resetState",value:function(){this.state=this.zeroState}},{key:"setState",value:function(E){this.state=E}},{key:"getState",value:function(){return this.state}},{key:"loadCheckpoints",value:function(){var E=K()(ke.a.mark(function k(w){var S,z,Y=this;return ke.a.wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:return S=new us(w),ce.next=3,S.getAllVariables();case 3:return z=ce.sent,Object.keys(z).forEach(function(ve){ve.match(Ri)?ve.match(bi)?(Y.model["Kernel_".concat(ve.match(/[0-9]/)[0])]=z[ve],Y.cellsAmount+=1):Y.model["Bias_".concat(ve.match(/[0-9]/)[0])]=z[ve]:ve.match(ro)?ve.match(bi)?Y.model.fullyConnectedWeights=z[ve]:Y.model.fullyConnectedBiases=z[ve]:Y.model[ve]=z[ve]}),ce.next=7,this.loadVocab(w);case 7:return ce.next=9,this.initCells();case 9:return ce.abrupt("return",this);case 10:case"end":return ce.stop()}},k,this)}));return function(k){return E.apply(this,arguments)}}()},{key:"loadVocab",value:function(){var E=K()(ke.a.mark(function k(w){var S,z;return ke.a.wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:return Y.prev=0,Y.next=3,Gt.a.get("".concat(w,"/vocab.json"));case 3:return S=Y.sent,z=S.data,this.vocab=z,this.vocabSize=Object.keys(z).length,Y.abrupt("return",this.vocab);case 10:return Y.prev=10,Y.t0=Y.catch(0),Y.abrupt("return",Y.t0);case 13:case"end":return Y.stop()}},k,this,[[0,10]])}));return function(k){return E.apply(this,arguments)}}()},{key:"initCells",value:function(){var E=K()(ke.a.mark(function k(){var w,S,z,Y=this;return ke.a.wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:for(this.cells=[],this.zeroState={c:[],h:[]},w=F.tensor(1),S=function(ve){return function(De,Ce,Xe){return F.basicLSTMCell(w,Y.model["Kernel_".concat(ve)],Y.model["Bias_".concat(ve)],De,Ce,Xe)}},z=0;z<this.cellsAmount;z+=1)this.zeroState.c.push(F.zeros([1,this.model["Bias_".concat(z)].shape[0]/4])),this.zeroState.h.push(F.zeros([1,this.model["Bias_".concat(z)].shape[0]/4])),this.cells.push(S(z));this.state=this.zeroState;case 6:case"end":return ce.stop()}},k,this)}));return function(){return E.apply(this,arguments)}}()},{key:"generateInternal",value:function(){var E=K()(ke.a.mark(function k(w){var S,z,Y,ce,ve,De,Ce,Xe,tt,kt,At,tn,sn,wn,En,Tn,Pn,dn,cr,kr=this;return ke.a.wrap(function(yr){for(;;)switch(yr.prev=yr.next){case 0:return yr.next=2,this.ready;case 2:S=w.seed||this.defaults.seed,z=+w.length||this.defaults.length,Y=+w.temperature||this.defaults.temperature,w.stateful||this.defaults.stateful||(this.state=this.zeroState),ce=[],ve=Array.from(S),De=[],ve.forEach(function(Br){De.push(kr.vocab[Br])}),Ce=De[0],Xe=[],tt=0;case 14:if(!(tt<ve.length+z+-1)){yr.next=36;break}return yr.next=17,F.buffer([1,this.vocabSize]);case 17:return(kt=yr.sent).set(1,0,Ce),At=kt.toTensor(),tn=void 0,this.model.embedding?(sn=F.matMul(At,this.model.embedding),tn=F.multiRNNCell(this.cells,sn,this.state.c,this.state.h)):tn=F.multiRNNCell(this.cells,At,this.state.c,this.state.h),this.state.c=tn[0],this.state.h=tn[1],wn=this.state.h[1],En=F.matMul(wn,this.model.fullyConnectedWeights),Tn=F.add(En,this.model.fullyConnectedBiases),Pn=F.div(Tn,F.tensor(Y)),dn=F.exp(Pn),yr.next=31,F.div(dn,F.sum(dn)).data();case 31:Xe=yr.sent,tt<ve.length-1?Ce=De[tt+1]:(Ce=Rh(Xe),ce.push(Ce));case 33:tt+=1,yr.next=14;break;case 36:return cr="",ce.forEach(function(Br){var _r=Object.keys(kr.vocab).find(function(hi){return kr.vocab[hi]===Br});_r&&(cr+=_r)}),this.probabilities=Xe,yr.abrupt("return",{sample:cr,state:this.state});case 40:case"end":return yr.stop()}},k,this)}));return function(k){return E.apply(this,arguments)}}()},{key:"reset",value:function(){this.state=this.zeroState}},{key:"generate",value:function(){var E=K()(ke.a.mark(function k(w,S){return ke.a.wrap(function(z){for(;;)switch(z.prev=z.next){case 0:return this.reset(),z.abrupt("return",at(this.generateInternal(w),S));case 2:case"end":return z.stop()}},k,this)}));return function(k,w){return E.apply(this,arguments)}}()},{key:"predict",value:function(){var E=K()(ke.a.mark(function k(w,S){var z,Y,ce,ve,De,Ce,Xe,tt,kt,At,tn=this;return ke.a.wrap(function(sn){for(;;)switch(sn.prev=sn.next){case 0:return z=[],Y=w>0?w:.1,ce=this.state.h[1],ve=F.matMul(ce,this.model.fullyConnectedWeights),De=F.add(ve,this.model.fullyConnectedBiases),Ce=F.div(De,F.tensor(Y)),Xe=F.exp(Ce),sn.next=9,F.div(Xe,F.sum(Xe)).data();case 9:return z=sn.sent,tt=Rh(z),kt=Object.keys(this.vocab).find(function(wn){return tn.vocab[wn]===tt}),this.probabilities=z,S&&S(kt),At=Object.keys(this.vocab).map(function(wn){return{char:wn,probability:tn.probabilities[tn.vocab[wn]]}}),sn.abrupt("return",{sample:kt,probabilities:At});case 16:case"end":return sn.stop()}},k,this)}));return function(k,w){return E.apply(this,arguments)}}()},{key:"feed",value:function(){var E=K()(ke.a.mark(function k(w,S){var z,Y,ce,ve,De,Ce,Xe,tt,kt=this;return ke.a.wrap(function(At){for(;;)switch(At.prev=At.next){case 0:return At.next=2,this.ready;case 2:z=Array.from(w),Y=[],z.forEach(function(tn){Y.push(kt.vocab[tn])}),ce=Y[0],ve=0;case 7:if(!(ve<z.length)){At.next=21;break}return At.next=10,F.buffer([1,this.vocabSize]);case 10:(De=At.sent).set(1,0,ce),Ce=De.toTensor(),Xe=void 0,this.model.embedding?(tt=F.matMul(Ce,this.model.embedding),Xe=F.multiRNNCell(this.cells,tt,this.state.c,this.state.h)):Xe=F.multiRNNCell(this.cells,Ce,this.state.c,this.state.h),this.state.c=Xe[0],this.state.h=Xe[1],ce=Y[ve];case 18:ve+=1,At.next=7;break;case 21:S&&S();case 22:case"end":return At.stop()}},k,this)}));return function(k,w){return E.apply(this,arguments)}}()}]),I}(),zd=function(){var I=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"./",E=arguments.length>1?arguments[1]:void 0;return new Ld(I,E)},Ud=function(){function I(E){pe()(this,I),this.urlPath=E}return Te()(I,[{key:"getAllVariables",value:function(){var E=K()(ke.a.mark(function k(){var w,S,z,Y,ce,ve,De,Ce,Xe,tt;return ke.a.wrap(function(kt){for(;;)switch(kt.prev=kt.next){case 0:return kt.next=2,Gt.a.get(this.urlPath,{responseType:"arraybuffer"}).catch(function(At){throw new Error("No model found. Failed with error ".concat(At))});case 2:for(w=kt.sent,S=w.data,z=[],Y=0;Y<S.byteLength;)ce=new Uint8Array(S.slice(Y,Y+4)),Y+=4,ve=(ce[0]<<24)+(ce[1]<<16)+(ce[2]<<8)+ce[3],z.push(S.slice(Y,Y+ve)),Y+=ve;return De=JSON.parse(new TextDecoder("utf8").decode(z[0])),Ce=new Float32Array(z[1]),Xe=new Uint8Array(z[2]),tt={},Y=0,De.forEach(function(At){var tn=At.shape,sn=At.name,wn=tn.reduce(function(Pn,dn){return Pn*dn}),En=Xe.slice(Y,Y+wn),Tn=new Float32Array(En.length);En.forEach(function(Pn,dn){Tn[dn]=Ce[Pn]}),tt[sn]=F.tensor(Tn,tn,"float32"),Y+=wn}),kt.abrupt("return",tt);case 14:case"end":return kt.stop()}},k,this)}));return function(){return E.apply(this,arguments)}}()}]),I}(),Rp=function(){function I(E,k){pe()(this,I),this.ready=at(this.loadCheckpoints(E),k)}return Te()(I,[{key:"loadCheckpoints",value:function(){var E=K()(ke.a.mark(function k(w){var S;return ke.a.wrap(function(z){for(;;)switch(z.prev=z.next){case 0:return S=new Ud(w),z.next=3,S.getAllVariables();case 3:return this.variables=z.sent,z.abrupt("return",this);case 5:case"end":return z.stop()}},k,this)}));return function(k){return E.apply(this,arguments)}}()},{key:"transfer",value:function(){var E=K()(ke.a.mark(function k(w,S){return ke.a.wrap(function(z){for(;;)switch(z.prev=z.next){case 0:return z.abrupt("return",at(this.transferInternal(w),S));case 1:case"end":return z.stop()}},k,this)}));return function(k,w){return E.apply(this,arguments)}}()},{key:"transferInternal",value:function(){var E=K()(ke.a.mark(function k(w){var S,z=this;return ke.a.wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:return S=hn(F.tidy(function(){var ce=F.browser.fromPixels(w),ve=ce.dataSync(),De=F.tensor3d(ve,ce.shape),Ce=F.div(De,F.scalar(255)),Xe=I.preprocess(Ce),tt=[],kt=z.variables["generator/encoder_1/conv2d/kernel"],At=z.variables["generator/encoder_1/conv2d/bias"],tn=I.conv2d(Xe,kt,At);tt.push(tn);for(var sn=2;sn<=8;sn+=1){var wn="generator/encoder_".concat(sn.toString());kt=z.variables["".concat(wn,"/conv2d/kernel")];var En=z.variables["".concat(wn,"/conv2d/bias")],Tn=tt[tt.length-1],Pn=F.leakyRelu(Tn,.2);tn=I.conv2d(Pn,kt,En);var dn=z.variables["".concat(wn,"/batch_normalization/gamma")],cr=z.variables["".concat(wn,"/batch_normalization/beta")],kr=I.batchnorm(tn,dn,cr);tt.push(kr)}for(var yr=8;yr>=2;yr-=1){var Br=void 0;if(yr===8)Br=tt[tt.length-1];else{var _r=yr-1;Br=F.concat([tt[tt.length-1],tt[_r]],2)}var hi=F.relu(Br),Ei="generator/decoder_".concat(yr.toString());kt=z.variables["".concat(Ei,"/conv2d_transpose/kernel")],At=z.variables["".concat(Ei,"/conv2d_transpose/bias")],tn=I.deconv2d(hi,kt,At);var xi=z.variables["".concat(Ei,"/batch_normalization/gamma")],ya=z.variables["".concat(Ei,"/batch_normalization/beta")],Ua=I.batchnorm(tn,xi,ya);tt.push(Ua)}var Ta=F.concat([tt[tt.length-1],tt[0]],2),Da=F.relu(Ta);kt=z.variables["generator/decoder_1/conv2d_transpose/kernel"];var Ra=z.variables["generator/decoder_1/conv2d_transpose/bias"];tn=I.deconv2d(Da,kt,Ra),Da=F.tanh(tn),tt.push(Da);var Qa=tt[tt.length-1];return I.deprocess(Qa)})),Y.next=3,F.nextFrame();case 3:return Y.abrupt("return",S);case 4:case"end":return Y.stop()}},k)}));return function(k){return E.apply(this,arguments)}}()}],[{key:"preprocess",value:function(E){var k=F.tidy(function(){return F.sub(F.mul(E,F.scalar(2)),F.scalar(1))});return E.dispose(),k}},{key:"deprocess",value:function(E){var k=F.tidy(function(){return F.div(F.add(E,F.scalar(1)),F.scalar(2))});return E.dispose(),k}},{key:"batchnorm",value:function(E,k,w){var S=F.tidy(function(){var z=F.moments(E,[0,1]);return F.batchNorm(E,z.mean,z.variance,w,k,1e-5)});return E.dispose(),S}},{key:"conv2d",value:function(E,k){var w=k.clone(),S=F.tidy(function(){return F.conv2d(E,w,[2,2],"same")});return E.dispose(),w.dispose(),S}},{key:"deconv2d",value:function(E,k,w){var S=F.tidy(function(){var z=F.conv2dTranspose(E,k,[2*E.shape[0],2*E.shape[1],k.shape[2]],[2,2],"same");return F.add(z,w)});return E.dispose(),k.dispose(),w.dispose(),S}}]),I}(),zu=function(I,E){var k=new Rp(I,E);return E?k:k.ready},ks=o(241),$c=new Set(["alarm_clock","ambulance","angel","ant","antyoga","backpack","barn","basket","bear","bee","beeflower","bicycle","bird","book","brain","bridge","bulldozer","bus","butterfly","cactus","calendar","castle","cat","catbus","catpig","chair","couch","crab","crabchair","crabrabbitfacepig","cruise_ship","diving_board","dog","dogbunny","dolphin","duck","elephant","elephantpig","eye","face","fan","fire_hydrant","firetruck","flamingo","flower","floweryoga","frog","frogsofa","garden","hand","hedgeberry","hedgehog","helicopter","kangaroo","key","lantern","lighthouse","lion","lionsheep","lobster","map","mermaid","monapassport","monkey","mosquito","octopus","owl","paintbrush","palm_tree","parrot","passport","peas","penguin","pig","pigsheep","pineapple","pool","postcard","power_outlet","rabbit","rabbitturtle","radio","radioface","rain","rhinoceros","rifle","roller_coaster","sandwich","scorpion","sea_turtle","sheep","skull","snail","snowflake","speedboat","spider","squirrel","steak","stove","strawberry","swan","swing_set","the_mona_lisa","tiger","toothbrush","toothpaste","tractor","trombone","truck","whale","windmill","yoga","yogabicycle","everything"]),Rs={modelPath:"https://storage.googleapis.com/quickdraw-models/sketchRNN/large_models/",modelPath_large:"https://storage.googleapis.com/quickdraw-models/sketchRNN/models/",modelPath_small:"https://storage.googleapis.com/quickdraw-models/sketchRNN/models/",PATH_END:".gen.json"},tu=function(){function I(E,k){var w=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2];pe()(this,I);var S=E;if(this.config={temperature:.65,pixelFactor:3,modelPath:Rs.modelPath,modelPath_small:Rs.modelPath_small,modelPath_large:Rs.modelPath_large,PATH_END:Rs.PATH_END},Pu.isAbsoluteURL(S)===!0){var z=Pu.getModelPath(S);this.config.modelPath=z}else{if(!$c.has(S))return console.log("no model found!"),this;S=(w?this.config.modelPath:this.config.modelPath_small)+S+this.config.PATH_END,this.config.modelPath=S}this.model=new ks.SketchRNN(this.config.modelPath),this.penState=this.model.zeroInput(),this.ready=at(this.model.initialize(),k)}return Te()(I,[{key:"generateInternal",value:function(){var E=K()(ke.a.mark(function k(w,S){var z,Y,ce,ve;return ke.a.wrap(function(De){for(;;)switch(De.prev=De.next){case 0:return z=+w.temperature||this.config.temperature,Y=+w.pixelFactor||this.config.pixelFactor,De.next=4,this.ready;case 4:return this.rnnState||(this.rnnState=this.model.zeroState(),this.model.setPixelFactor(Y)),Array.isArray(S)&&S.length&&(this.rnnState=this.model.updateStrokes(S,this.rnnState)),this.rnnState=this.model.update(this.penState,this.rnnState),ce=this.model.getPDF(this.rnnState,z),this.penState=this.model.sample(ce),ve={dx:this.penState[0],dy:this.penState[1]},this.penState[2]===1?ve.pen="down":this.penState[3]===1?ve.pen="up":this.penState[4]===1&&(ve.pen="end"),De.abrupt("return",ve);case 12:case"end":return De.stop()}},k,this)}));return function(k,w){return E.apply(this,arguments)}}()},{key:"generate",value:function(){var E=K()(ke.a.mark(function k(w,S,z){var Y,ce,ve,De;return ke.a.wrap(function(Ce){for(;;)switch(Ce.prev=Ce.next){case 0:return typeof w=="function"?(ce={},ve=[],Y=w):Array.isArray(w)?(ce={},ve=w,Y=S):typeof S=="function"?(ce=w||{},ve=[],Y=S):(ce=w||{},ve=S||[],Y=z),De=ve.map(function(Xe){var tt=Xe.pen==="up"?1:0,kt=Xe.pen==="down"?1:0,At=Xe.pen==="end"?1:0;return[Xe.dx,Xe.dy,kt,tt,At]}),Ce.abrupt("return",at(this.generateInternal(ce,De),Y));case 3:case"end":return Ce.stop()}},k,this)}));return function(k,w,S){return E.apply(this,arguments)}}()},{key:"reset",value:function(){this.penState=this.model.zeroInput(),this.rnnState&&(this.rnnState=this.model.zeroState())}}]),I}(),Mh=function(I,E){var k=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2];return new tu(I,E,k)},Ni={modelPath:"https://raw.githubusercontent.com/zaidalyafeai/HostedModels/master/unet-128/model.json",imageSize:128,returnTensors:!1},_f=function(){function I(E,k,w){pe()(this,I),this.modelReady=!1,this.isPredicting=!1,this.config={modelPath:k.modelPath!==void 0?k.modelPath:Ni.modelPath,imageSize:k.imageSize!==void 0?k.imageSize:Ni.imageSize,returnTensors:k.returnTensors!==void 0?k.returnTensors:Ni.returnTensors},this.ready=at(this.loadModel(),w)}return Te()(I,[{key:"loadModel",value:function(){var E=K()(ke.a.mark(function k(){return ke.a.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return w.next=2,F.loadLayersModel(this.config.modelPath);case 2:return this.model=w.sent,this.modelReady=!0,w.abrupt("return",this);case 5:case"end":return w.stop()}},k,this)}));return function(){return E.apply(this,arguments)}}()},{key:"segment",value:function(){var E=K()(ke.a.mark(function k(w,S){var z,Y;return ke.a.wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:return ce.next=2,this.ready;case 2:return Y=S,w instanceof HTMLImageElement||w instanceof HTMLVideoElement||w instanceof HTMLCanvasElement||w instanceof ImageData?z=w:we()(w)==="object"&&(w.elt instanceof HTMLImageElement||w.elt instanceof HTMLVideoElement||w.elt instanceof HTMLCanvasElement||w.elt instanceof ImageData)?z=w.elt:typeof w=="function"&&(z=this.video,Y=w),ce.abrupt("return",at(this.segmentInternal(z),Y));case 5:case"end":return ce.stop()}},k,this)}));return function(k,w){return E.apply(this,arguments)}}()},{key:"convertToP5Image",value:function(){var E=K()(ke.a.mark(function k(w){var S,z;return ke.a.wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:return Y.next=2,dr.rawToBlob(w,this.config.imageSize,this.config.imageSize);case 2:return S=Y.sent,Y.next=5,dr.blobToP5Image(S);case 5:return z=Y.sent,Y.abrupt("return",z);case 7:case"end":return Y.stop()}},k,this)}));return function(k){return E.apply(this,arguments)}}()},{key:"segmentInternal",value:function(){var E=K()(ke.a.mark(function k(w){var S,z,Y,ce,ve,De,Ce,Xe,tt,kt,At,tn,sn,wn,En=this;return ke.a.wrap(function(Tn){for(;;)switch(Tn.prev=Tn.next){case 0:return Tn.next=2,this.ready;case 2:if(!(w instanceof HTMLVideoElement)){Tn.next=5;break}return Tn.next=5,F.nextFrame();case 5:return this.isPredicting=!0,S=F.tidy(function(){var Pn=F.browser.fromPixels(w).toFloat(),dn=F.image.resizeBilinear(Pn,[En.config.imageSize,En.config.imageSize]).div(F.scalar(255)),cr=dn.expandDims(0),kr=En.model.predict(cr),yr=F.ones([128,128,1]).tile([1,1,1]);dn=dn.concat(yr,2);var Br=kr.squeeze([0]),_r=(Br=(Br=Br.tile([1,1,4])).sub(.3).sign().relu().neg().add(1)).mul(dn),hi=kr.squeeze([0]),Ei=(hi=(hi=hi.tile([1,1,4])).sub(.3).sign().relu()).mul(dn),xi=F.ones([128,128,1]).tile([1,1,1]).mul(255),ya=kr.squeeze([0]);return{featureMask:_r,backgroundMask:Ei,segmentation:ya=(ya=F.cast(ya.tile([1,1,3]).sub(.3).sign().relu().mul(255),"int32")).concat(xi,2)}}),z=S.featureMask,Y=S.backgroundMask,ce=S.segmentation,this.isPredicting=!1,Tn.next=10,F.browser.toPixels(z);case 10:return ve=Tn.sent,Tn.next=13,F.browser.toPixels(Y);case 13:return De=Tn.sent,Tn.next=16,F.browser.toPixels(ce);case 16:if(Ce=Tn.sent,Xe=hn(z),tt=hn(Y),kt=I.dataURLtoBlob(Xe.src),At=I.dataURLtoBlob(tt.src),!dr.checkP5()){Tn.next=31;break}return Tn.next=24,this.convertToP5Image(ve);case 24:return tn=Tn.sent,Tn.next=27,this.convertToP5Image(De);case 27:return sn=Tn.sent,Tn.next=30,this.convertToP5Image(Ce);case 30:wn=Tn.sent;case 31:return this.config.returnTensors||(z.dispose(),Y.dispose(),ce.dispose()),Tn.abrupt("return",{segmentation:Ce,blob:{featureMask:kt,backgroundMask:At},tensor:{featureMask:z,backgroundMask:Y},raw:{featureMask:ve,backgroundMask:De},featureMask:tn,backgroundMask:sn,mask:wn});case 33:case"end":return Tn.stop()}},k,this)}));return function(k){return E.apply(this,arguments)}}()}],[{key:"dataURLtoBlob",value:function(E){for(var k=E.split(","),w=k[0].match(/:(.*?);/)[1],S=atob(k[1]),z=S.length,Y=new Uint8Array(z);z;)Y[z]=S.charCodeAt(z),z-=1;return new Blob([Y],{type:w})}}]),I}(),Gc=function(I,E,k){var w=null,S={},z=k;return I instanceof HTMLVideoElement?w=I:we()(I)==="object"&&I.elt instanceof HTMLVideoElement?w=I.elt:typeof I=="function"?z=I:we()(I)==="object"&&(S=I),we()(E)==="object"?S=E:typeof E=="function"&&(z=E),new _f(w,S,z)},_l=function(){function I(E,k){var w=this;pe()(this,I),this.ready=!1,this.model={},this.latentDim=F.randomUniform([1,16]);var S=E.split("manifest.json"),z=Sn()(S,1)[0];Gt.a.get(E).then(function(Y){var ce=Y.data;w.ready=at(w.loadCVAEModel(z+ce.model),k),w.labels=ce.labels,w.labelVector=Array(w.labels.length+1).fill(0)})}return Te()(I,[{key:"loadCVAEModel",value:function(){var E=K()(ke.a.mark(function k(w){return ke.a.wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return S.next=2,F.loadLayersModel(w);case 2:return this.model=S.sent,S.abrupt("return",this);case 4:case"end":return S.stop()}},k,this)}));return function(k){return E.apply(this,arguments)}}()},{key:"generate",value:function(){var E=K()(ke.a.mark(function k(w,S){return ke.a.wrap(function(z){for(;;)switch(z.prev=z.next){case 0:return z.abrupt("return",at(this.generateInternal(w),S));case 1:case"end":return z.stop()}},k,this)}));return function(k,w){return E.apply(this,arguments)}}()},{key:"loadAsync",value:function(E){var k=this;return new Promise(function(w,S){k.ready||S(),loadImage(E,function(z){w(z)})})}},{key:"getBlob",value:function(E){var k=this;return new Promise(function(w,S){k.ready||S(),E.toBlob(function(z){w(z)})})}},{key:"generateInternal",value:function(){var E=K()(ke.a.mark(function k(w){var S,z,Y,ce,ve,De,Ce,Xe,tt,kt,At,tn,sn=this;return ke.a.wrap(function(wn){for(;;)switch(wn.prev=wn.next){case 0:return S=F.tidy(function(){sn.latentDim=F.randomUniform([1,16]);var En=sn.labels.indexOf(w);if(En<0)return console.log("Wrong input of the label!"),[void 0,void 0];sn.labelVector=sn.labelVector.map(function(){return 0}),sn.labelVector[En+1]=1;var Tn=F.tensor([sn.labelVector]),Pn=sn.model.predict([sn.latentDim,Tn]);return Pn.reshape([Pn.shape[1],Pn.shape[2],Pn.shape[3]])}),wn.next=3,F.browser.toPixels(S);case 3:for(z=wn.sent,S.dispose(),Y=document.createElement("canvas"),ce=Y.getContext("2d"),ve=Sn()(S.shape,2),De=ve[0],Ce=ve[1],Y.width=De,Y.height=Ce,Xe=ce.createImageData(De,Ce),tt=Xe.data,kt=0;kt<De*Ce*4;kt+=1)tt[kt]=z[kt];return ce.putImageData(Xe,0,0),wn.t0=URL,wn.next=17,this.getBlob(Y);case 17:if(wn.t1=wn.sent,At=wn.t0.createObjectURL.call(wn.t0,wn.t1),!dr.checkP5()){wn.next=23;break}return wn.next=22,this.loadAsync(At);case 22:tn=wn.sent;case 23:return wn.abrupt("return",{src:At,raws:z,image:tn});case 24:case"end":return wn.stop()}},k,this)}));return function(k){return E.apply(this,arguments)}}()}]),I}(),Wd=function(I,E){return new _l(I,E)},Mp=function(){function I(E,k,w){pe()(this,I),this.model={},this.modelPath=E,this.modelInfo={},this.modelPathPrefix="",this.modelReady=!1,this.config={returnTensors:k.returnTensors||!1},this.ready=at(this.loadModel(),w)}return Te()(I,[{key:"loadModel",value:function(){var E=K()(ke.a.mark(function k(){var w,S,z,Y,ce,ve;return ke.a.wrap(function(De){for(;;)switch(De.prev=De.next){case 0:return De.next=2,Gt.a.get(this.modelPath);case 2:return w=De.sent,S=w.data,this.modelInfo=S,z=this.modelPath.split("manifest.json"),Y=Sn()(z,1),ce=Y[0],ve=this.isAbsoluteURL(ce)?this.modelInfo.model:this.modelPathPrefix+this.modelInfo.model,De.next=9,F.loadLayersModel(ve);case 9:return this.model=De.sent,this.modelReady=!0,De.abrupt("return",this);case 12:case"end":return De.stop()}},k,this)}));return function(){return E.apply(this,arguments)}}()},{key:"generate",value:function(){var E=K()(ke.a.mark(function k(w,S){return ke.a.wrap(function(z){for(;;)switch(z.prev=z.next){case 0:return z.next=2,this.ready;case 2:return z.abrupt("return",at(this.generateInternal(S),w));case 3:case"end":return z.stop()}},k,this)}));return function(k,w){return E.apply(this,arguments)}}()},{key:"compute",value:function(){var E=K()(ke.a.mark(function k(w,S){var z,Y=this;return ke.a.wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:return z=F.tidy(function(){var ve;if(Array.isArray(S)===!1)ve=F.randomNormal([1,w]);else{for(var De=F.buffer([1,w]),Ce=0;Ce<w;Ce+=1)De.set(S[Ce],0,Ce);ve=De.toTensor()}return Y.model.predict(ve).squeeze().transpose([1,2,0]).div(F.scalar(2)).add(F.scalar(.5))}),ce.abrupt("return",z);case 2:case"end":return ce.stop()}},k)}));return function(k,w){return E.apply(this,arguments)}}()},{key:"generateInternal",value:function(){var E=K()(ke.a.mark(function k(w){var S,z,Y,ce,ve,De,Ce,Xe,tt;return ke.a.wrap(function(kt){for(;;)switch(kt.prev=kt.next){case 0:return S=this.modelInfo.modelLatentDim,kt.next=3,this.compute(S,w);case 3:return z=kt.sent,kt.next=6,F.browser.toPixels(z);case 6:return Y=kt.sent,ce=Sn()(z.shape,2),ve=ce[0],De=ce[1],kt.next=10,dr.rawToBlob(Y,De,ve);case 10:if(Ce=kt.sent,!dr.checkP5()){kt.next=15;break}return kt.next=14,dr.blobToP5Image(Ce);case 14:Xe=kt.sent;case 15:return(tt={}).blob=Ce,tt.raw=Y,dr.checkP5()&&(tt.image=Xe),this.config.returnTensors?tt.tensor=z:(tt.tensor=null,z.dispose()),kt.abrupt("return",tt);case 21:case"end":return kt.stop()}},k,this)}));return function(k){return E.apply(this,arguments)}}()},{key:"isAbsoluteURL",value:function(E){return!!new RegExp("^(?:[a-z]+:)?//","i").test(E)}}]),I}(),Sl=function(I,E,k){var w,S={};if(typeof I!="string")throw new Error(`Please specify a path to a "manifest.json" file: 

         "models/face/manifest.json" 


         This "manifest.json" file should include:

         {
            "description": "DCGAN, human faces, 64x64",
            "model": "https://raw.githubusercontent.com/viztopia/ml5dcgan/master/model/model.json", // "https://github.com/viztopia/ml5dcgan/blob/master/model/model.json",
            "modelSize": 64,
            "modelLatentDim": 128 
         }
         `);typeof E=="function"?w=E:we()(E)==="object"&&(S=E,w=k);var z=new Mp(I,S,w);return w?z:z.ready},jh=o(30),Pa=o.n(jh),Bh=o(132),Dl=0,Ph=function(){function I(E,k){pe()(this,I),this.ready=at(this.loadModel(E),k)}return Te()(I,[{key:"loadModel",value:function(){var E=K()(ke.a.mark(function k(w){var S,z,Y,ce;return ke.a.wrap(function(ve){for(;;)switch(ve.prev=ve.next){case 0:if(S={model:null,metadata:null},w.toLowerCase()!=="moviereviews"){ve.next=6;break}S.model="https://storage.googleapis.com/tfjs-models/tfjs/sentiment_cnn_v1/model.json",S.metadata="https://storage.googleapis.com/tfjs-models/tfjs/sentiment_cnn_v1/metadata.json",ve.next=14;break;case 6:if(Pu.isAbsoluteURL(w)!==!0){ve.next=12;break}z=Pu.getModelPath(w),S.model="".concat(z,"/model.json"),S.metadata="".concat(z,"/metadata.json"),ve.next=14;break;case 12:return console.error("problem loading model"),ve.abrupt("return",this);case 14:return ve.next=16,F.loadLayersModel(S.model);case 16:return this.model=ve.sent,ve.next=19,Gt.a.get(S.metadata);case 19:return Y=ve.sent,ce=Y.data,this.indexFrom=ce.index_from,this.maxLen=ce.max_len,this.wordIndex=ce.word_index,this.vocabularySize=ce.vocabulary_size,ve.abrupt("return",this);case 26:case"end":return ve.stop()}},k,this)}));return function(k){return E.apply(this,arguments)}}()},{key:"predict",value:function(E){var k=this,w=function(ce,ve){var De=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"pre",Ce=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"pre",Xe=arguments.length>4&&arguments[4]!==void 0?arguments[4]:Dl;return ce.map(function(tt){if(tt.length>ve&&(Ce==="pre"?tt.splice(0,tt.length-ve):tt.splice(ve,tt.length-ve)),tt.length<ve){for(var kt=[],At=0;At<ve-tt.length;At+=1)kt.push(Xe);tt=De==="pre"?kt.concat(tt):tt.concat(kt)}return tt})}([E.trim().toLowerCase().replace(/[.,?!]/g,"").split(" ").map(function(ce){var ve=k.wordIndex[ce]+k.indexFrom;return ve>k.vocabularySize&&(ve=2),ve})],this.maxLen),S=F.tensor2d(w,[1,this.maxLen]),z=this.model.predict(S),Y=z.dataSync()[0];return z.dispose(),S.dispose(),{score:Y}}}]),I}(),Tl=function(I,E){return new Ph(I,E)};/**
    * @license
    * Copyright 2019 Google LLC. All Rights Reserved.
    * Licensed under the Apache License, Version 2.0 (the "License");
    * you may not use this file except in compliance with the License.
    * You may obtain a copy of the License at
    *
    * http://www.apache.org/licenses/LICENSE-2.0
    *
    * Unless required by applicable law or agreed to in writing, software
    * distributed under the License is distributed on an "AS IS" BASIS,
    * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    * See the License for the specific language governing permissions and
    * limitations under the License.
    * =============================================================================
    */function Kc(I,E,k,w){return new(k||(k=Promise))(function(S,z){function Y(De){try{ve(w.next(De))}catch(Ce){z(Ce)}}function ce(De){try{ve(w.throw(De))}catch(Ce){z(Ce)}}function ve(De){De.done?S(De.value):new k(function(Ce){Ce(De.value)}).then(Y,ce)}ve((w=w.apply(I,[])).next())})}function Ec(I,E){var k,w,S,z,Y={label:0,sent:function(){if(1&S[0])throw S[1];return S[1]},trys:[],ops:[]};return z={next:ce(0),throw:ce(1),return:ce(2)},typeof Symbol=="function"&&(z[Symbol.iterator]=function(){return this}),z;function ce(ve){return function(De){return function(Ce){if(k)throw new TypeError("Generator is already executing.");for(;Y;)try{if(k=1,w&&(S=2&Ce[0]?w.return:Ce[0]?w.throw||((S=w.return)&&S.call(w),0):w.next)&&!(S=S.call(w,Ce[1])).done)return S;switch(w=0,S&&(Ce=[2&Ce[0],S.value]),Ce[0]){case 0:case 1:S=Ce;break;case 4:return Y.label++,{value:Ce[1],done:!1};case 5:Y.label++,w=Ce[1],Ce=[0];continue;case 7:Ce=Y.ops.pop(),Y.trys.pop();continue;default:if(!(S=(S=Y.trys).length>0&&S[S.length-1])&&(Ce[0]===6||Ce[0]===2)){Y=0;continue}if(Ce[0]===3&&(!S||Ce[1]>S[0]&&Ce[1]<S[3])){Y.label=Ce[1];break}if(Ce[0]===6&&Y.label<S[1]){Y.label=S[1],S=Ce;break}if(S&&Y.label<S[2]){Y.label=S[2],Y.ops.push(Ce);break}S[2]&&Y.ops.pop(),Y.trys.pop();continue}Ce=E.call(I,Y)}catch(Xe){Ce=[6,Xe],w=0}finally{k=S=0}if(5&Ce[0])throw Ce[1];return{value:Ce[0]?Ce[1]:void 0,done:!0}}([ve,De])}}}var Lh=[["conv2d",2],["separableConv",1],["separableConv",2],["separableConv",1],["separableConv",2],["separableConv",1],["separableConv",2],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",1]],Sf=[8,16,32];function Nl(I){Ye.util.assert(typeof I=="number",function(){return"outputStride is not a number"}),Ye.util.assert(Sf.indexOf(I)>=0,function(){return"outputStride of "+I+" is invalid. It must be either 8, 16, or 32"})}var Cc={100:[["conv2d",2],["separableConv",1],["separableConv",2],["separableConv",1],["separableConv",2],["separableConv",1],["separableConv",2],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",2],["separableConv",1]],75:[["conv2d",2],["separableConv",1],["separableConv",2],["separableConv",1],["separableConv",2],["separableConv",1],["separableConv",2],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",1]],50:Lh,25:Lh},km=function(){function I(E,k){this.PREPROCESS_DIVISOR=Object(Ye.scalar)(127.5),this.ONE=Object(Ye.scalar)(1),this.modelWeights=E,this.convolutionDefinitions=k}return I.prototype.predict=function(E,k){var w=this,S=Object(Ye.div)(E.toFloat(),this.PREPROCESS_DIVISOR),z=Object(Ye.sub)(S,this.ONE);return function(Y,ce){var ve=1,De=1;return Y.map(function(Ce,Xe){var tt,kt,At=Ce[0],tn=Ce[1];return ve===ce?(tt=1,kt=De,De*=tn):(tt=tn,kt=1,ve*=tn),{blockId:Xe,convType:At,stride:tt,rate:kt,outputStride:ve}})}(this.convolutionDefinitions,k).reduce(function(Y,ce){var ve=ce.blockId,De=ce.stride,Ce=ce.convType,Xe=ce.rate;if(Ce==="conv2d")return w.conv(Y,De,ve);if(Ce==="separableConv")return w.separableConv(Y,De,ve,Xe);throw Error("Unknown conv type of "+Ce)},z)},I.prototype.convToOutput=function(E,k){return E.conv2d(this.weights(k),1,"same").add(this.convBias(k,!1))},I.prototype.conv=function(E,k,w){var S=this.weights("Conv2d_"+String(w));return E.conv2d(S,k,"same").add(this.convBias("Conv2d_"+String(w))).clipByValue(0,6)},I.prototype.separableConv=function(E,k,w,S){S===void 0&&(S=1);var z="Conv2d_"+String(w)+"_depthwise",Y="Conv2d_"+String(w)+"_pointwise";return E.depthwiseConv2D(this.depthwiseWeights(z),k,"same","NHWC",S).add(this.depthwiseBias(z)).clipByValue(0,6).conv2d(this.weights(Y),[1,1],"same").add(this.convBias(Y)).clipByValue(0,6)},I.prototype.weights=function(E){return this.modelWeights.weights(E)},I.prototype.convBias=function(E,k){return k===void 0&&(k=!0),this.modelWeights.convBias(E,k)},I.prototype.depthwiseBias=function(E){return this.modelWeights.depthwiseBias(E)},I.prototype.depthwiseWeights=function(E){return this.modelWeights.depthwiseWeights(E)},I.prototype.dispose=function(){this.modelWeights.dispose()},I}(),Il="https://storage.googleapis.com/tfjs-models/savedmodel/",eo={1:{url:Il+"posenet_mobilenet_100_partmap/",architecture:Cc[100]},.75:{url:Il+"posenet_mobilenet_075_partmap/",architecture:Cc[75]},.5:{url:Il+"posenet_mobilenet_050_partmap/",architecture:Cc[50]},.25:{url:Il+"posenet_mobilenet_025_partmap/",architecture:Cc[25]}};function Ao(I,E){return Object(Ye.tidy)(function(){return I.greater(Object(Ye.scalar)(E)).toInt()})}function Fo(I,E){var k=E.shape,w=k[0],S=k[1],z=k[2];return Object(Ye.tidy)(function(){var Y=function(ve){var De=ve.shape[2],Ce=ve.argMax(2).reshape([-1]);return Object(Ye.oneHot)(Ce,De)}(E),ce=Object(Ye.range)(0,z,1,"int32").expandDims(1);return function(ve,De){return ve.mul(De)}(Y.matMul(ce).toInt().reshape([w,S]).add(Object(Ye.scalar)(1,"int32")),I).sub(Object(Ye.scalar)(1,"int32"))})}var Mi=function(){function I(E){this.graphModel=E}return I.prototype.weights=function(E){return this.getVariable("MobilenetV1/"+E+"/weights")},I.prototype.convBias=function(E,k){return this.getVariable("MobilenetV1/"+E+"/Conv2D_bias")},I.prototype.depthwiseBias=function(E){return this.getVariable("MobilenetV1/"+E+"/depthwise_bias")},I.prototype.depthwiseWeights=function(E){return this.getVariable("MobilenetV1/"+E+"/depthwise_weights")},I.prototype.getVariable=function(E){return this.graphModel.weights[""+E][0]},I.prototype.dispose=function(){this.graphModel.dispose()},I}();function Es(I){return I instanceof Ye.Tensor?I:Ye.browser.fromPixels(I)}function Oc(I,E,k){var w=E[0],S=E[1];k===void 0&&(k=!1);var z,Y,ce,ve,De,Ce,Xe=I.shape,tt=Xe[0],kt=Xe[1]/tt;if(kt>S/w){z=S;var At=w-(Y=Math.ceil(z/kt));ce=0,ve=0,De=Math.floor(At/2),Ce=w-(Y+De)}else{Y=w;var tn=S-(z=Math.ceil(w*kt));ce=Math.floor(tn/2),ve=S-(z+ce),De=0,Ce=0}return{resizedAndPadded:Object(Ye.tidy)(function(){var sn;return sn=k?I.reverse(1).resizeBilinear([Y,z]):I.resizeBilinear([Y,z]),Object(Ye.pad3d)(sn,[[De,Ce],[ce,ve],[0,0]])}),paddedBy:[[De,Ce],[ce,ve]]}}function Ro(I,E,k,w){var S=E[0],z=E[1],Y=k[0],ce=k[1],ve=w[0],De=ve[0],Ce=ve[1],Xe=w[1],tt=Xe[0],kt=Xe[1];return Object(Ye.tidy)(function(){return function(At,tn,sn){var wn=tn[0],En=tn[1],Tn=sn[0],Pn=Tn[0],dn=Tn[1],cr=sn[1],kr=cr[0],yr=cr[1],Br=At.shape,_r=Br[0],hi=Br[1],Ei=_r-(Pn+dn),xi=hi-(kr+yr);return Object(Ye.tidy)(function(){return Object(Ye.slice3d)(At,[Pn,kr,0],[Ei,xi,At.shape[2]]).resizeBilinear([wn,En],!0)})}(I.resizeBilinear([Y,ce],!0),[S,z],[[De,Ce],[tt,kt]])})}var Ac=[353,257],Uu=function(){function I(E){this.mobileNet=E}return I.prototype.predictForSegmentation=function(E,k){var w=this;return k===void 0&&(k=16),Nl(k),Object(Ye.tidy)(function(){var S=w.mobileNet.predict(E,k);return w.mobileNet.convToOutput(S,"segment_2").sigmoid()})},I.prototype.predictForPartMap=function(E,k){var w=this;return k===void 0&&(k=16),Nl(k),Object(Ye.tidy)(function(){var S=w.mobileNet.predict(E,k),z=w.mobileNet.convToOutput(S,"segment_2"),Y=w.mobileNet.convToOutput(S,"part_heatmap_2");return{segmentScores:z.sigmoid(),partHeatmapScores:Y.sigmoid()}})},I.prototype.estimatePersonSegmentationActivation=function(E,k,w){var S=this;return k===void 0&&(k=16),w===void 0&&(w=.5),Nl(k),Object(Ye.tidy)(function(){var z=Es(E),Y=Oc(z,Ac),ce=Y.resizedAndPadded,ve=Y.paddedBy,De=S.predictForSegmentation(ce,k),Ce=ce.shape,Xe=Ce[0],tt=Ce[1],kt=z.shape;return Ao(Ro(De,[kt[0],kt[1]],[Xe,tt],ve).squeeze(),w)})},I.prototype.estimatePersonSegmentation=function(E,k,w){return k===void 0&&(k=16),w===void 0&&(w=.5),Kc(this,void 0,void 0,function(){var S,z,Y,ce,ve;return Ec(this,function(De){switch(De.label){case 0:return S=this.estimatePersonSegmentationActivation(E,k,w),z=S.shape,Y=z[0],ce=z[1],[4,S.data()];case 1:return ve=De.sent(),S.dispose(),[2,{height:Y,width:ce,data:ve}]}})})},I.prototype.estimatePartSegmentationActivation=function(E,k,w){var S=this;return k===void 0&&(k=16),w===void 0&&(w=.5),Nl(k),Object(Ye.tidy)(function(){var z=Es(E),Y=Oc(z,Ac),ce=Y.resizedAndPadded,ve=Y.paddedBy,De=S.predictForPartMap(ce,k),Ce=De.segmentScores,Xe=De.partHeatmapScores,tt=ce.shape,kt=tt[0],At=tt[1],tn=z.shape,sn=tn[0],wn=tn[1],En=Ro(Ce,[sn,wn],[kt,At],ve),Tn=Ro(Xe,[sn,wn],[kt,At],ve);return Fo(Ao(En.squeeze(),w),Tn)})},I.prototype.estimatePartSegmentation=function(E,k,w){return k===void 0&&(k=16),w===void 0&&(w=.5),Kc(this,void 0,void 0,function(){var S,z,Y,ce,ve;return Ec(this,function(De){switch(De.label){case 0:return S=this.estimatePartSegmentationActivation(E,k,w),z=S.shape,Y=z[0],ce=z[1],[4,S.data()];case 1:return ve=De.sent(),S.dispose(),[2,{height:Y,width:ce,data:ve}]}})})},I.prototype.dispose=function(){this.mobileNet.dispose()},I}();function Df(I){return I===void 0&&(I=.75),Kc(this,void 0,void 0,function(){var E,k;return Ec(this,function(w){switch(w.label){case 0:if(Ye==null)throw new Error("Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this model.");return E=Object.keys(eo),Ye.util.assert(typeof I=="number",function(){return"got multiplier type of "+typeof I+" when it should be a number."}),Ye.util.assert(E.indexOf(I.toString())>=0,function(){return"invalid multiplier value of "+I+".  No checkpoint exists for that multiplier. Must be one of "+E.join(",")+"."}),[4,Tf.load(I)];case 1:return k=w.sent(),[2,new Uu(k)]}})})}var Tf={load:function(I){return Kc(void 0,void 0,void 0,function(){var E,k,w,S;return Ec(this,function(z){switch(z.label){case 0:return E=eo[I],k=E.url,[4,Object(Pt.loadGraphModel)(k+"model.json")];case 1:return w=z.sent(),S=new Mi(w),[2,new km(S,E.architecture)]}})})}};function Xc(I,E){E===void 0&&(E=!0);for(var k=I.width,w=I.height,S=I.data,z=new Uint8ClampedArray(k*w*4),Y=0;Y<w*k;++Y){var ce=255*(E?1-S[Y]:S[Y]),ve=4*Y;z[ve+0]=0,z[ve+1]=0,z[ve+2]=0,z[ve+3]=Math.round(ce)}return new ImageData(z,k,w)}function Vd(I,E){for(var k=I.width,w=I.height,S=I.data,z=new Uint8ClampedArray(k*w*4),Y=0;Y<w*k;++Y){var ce=Math.round(S[Y]),ve=4*Y;if(ce===-1)z[ve+0]=255,z[ve+1]=255,z[ve+2]=255,z[ve+3]=255;else{var De=E[ce];if(!De)throw new Error("No color could be found for part id "+ce);z[ve+0]=De[0],z[ve+1]=De[1],z[ve+2]=De[2],z[ve+3]=255}}return new ImageData(z,k,w)}var Wu={multiplier:.75,outputStride:16,segmentationThreshold:.5,palette:{leftFace:{id:0,color:[110,64,170]},rightFace:{id:1,color:[106,72,183]},rightUpperLegFront:{id:2,color:[100,81,196]},rightLowerLegBack:{id:3,color:[92,91,206]},rightUpperLegBack:{id:4,color:[84,101,214]},leftLowerLegFront:{id:5,color:[75,113,221]},leftUpperLegFront:{id:6,color:[66,125,224]},leftUpperLegBack:{id:7,color:[56,138,226]},leftLowerLegBack:{id:8,color:[48,150,224]},rightFeet:{id:9,color:[40,163,220]},rightLowerLegFront:{id:10,color:[33,176,214]},leftFeet:{id:11,color:[29,188,205]},torsoFront:{id:12,color:[26,199,194]},torsoBack:{id:13,color:[26,210,182]},rightUpperArmFront:{id:14,color:[28,219,169]},rightUpperArmBack:{id:15,color:[33,227,155]},rightLowerArmBack:{id:16,color:[41,234,141]},leftLowerArmFront:{id:17,color:[51,240,128]},leftUpperArmFront:{id:18,color:[64,243,116]},leftUpperArmBack:{id:19,color:[79,246,105]},leftLowerArmBack:{id:20,color:[96,247,97]},rightHand:{id:21,color:[115,246,91]},rightLowerArmFront:{id:22,color:[134,245,88]},leftHand:{id:23,color:[155,243,88]}},returnTensors:!1},Em=function(){function I(E,k,w){pe()(this,I),this.video=E,this.model=null,this.modelReady=!1,this.modelPath="",this.config={multiplier:k.multiplier||Wu.multiplier,outputStride:k.outputStride||Wu.outputStride,segmentationThreshold:k.segmentationThreshold||Wu.segmentationThreshold,palette:k.palette||Wu.palette,returnTensors:k.returnTensors||Wu.returnTensors},this.ready=at(this.loadModel(),w)}return Te()(I,[{key:"loadModel",value:function(){var E=K()(ke.a.mark(function k(){return ke.a.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return w.next=2,Df(this.config.multiplier);case 2:return this.model=w.sent,this.modelReady=!0,w.abrupt("return",this);case 5:case"end":return w.stop()}},k,this)}));return function(){return E.apply(this,arguments)}}()},{key:"p5Color2RGB",value:function(E){var k=/\(([^)]+)\)/.exec(E.toString("rgb"))[1].split(","),w=Sn()(k,3);return[w[0],w[1],w[2]]}},{key:"convertToP5Image",value:function(){var E=K()(ke.a.mark(function k(w,S,z){var Y,ce;return ke.a.wrap(function(ve){for(;;)switch(ve.prev=ve.next){case 0:return ve.next=2,dr.rawToBlob(w,S,z);case 2:return Y=ve.sent,ve.next=5,dr.blobToP5Image(Y);case 5:return ce=ve.sent,ve.abrupt("return",ce);case 7:case"end":return ve.stop()}},k)}));return function(k,w,S){return E.apply(this,arguments)}}()},{key:"bodyPartsSpec",value:function(E){var k=this,w=E!==void 0||Object.keys(E).length>=24?E:this.config.palette,S=dr.p5Instance;return S&&w!==void 0&&Object.keys(w).length>=24&&Object.keys(w).forEach(function(z){w[z].color instanceof S.Color&&(w[z].color=k.p5Color2RGB(w[z].color))}),w}},{key:"segmentWithPartsInternal",value:function(){var E=K()(ke.a.mark(function k(w,S){var z,Y,ce,ve,De,Ce,Xe,tt,kt,At,tn,sn=this;return ke.a.wrap(function(wn){for(;;)switch(wn.prev=wn.next){case 0:return wn.next=2,this.ready;case 2:return wn.next=4,F.nextFrame();case 4:if(!this.video||this.video.readyState!==0){wn.next=7;break}return wn.next=7,new Promise(function(En){sn.video.onloadeddata=function(){return En()}});case 7:return this.config.palette=S.palette||this.config.palette,this.config.outputStride=S.outputStride||this.config.outputStride,this.config.segmentationThreshold=S.segmentationThreshold||this.config.segmentationThreshold,wn.next=12,this.model.estimatePartSegmentation(w,this.config.outputStride,this.config.segmentationThreshold);case 12:return z=wn.sent,Y=this.bodyPartsSpec(this.config.palette),ce=Object.keys(Y).map(function(En){return Y[En].color}),(ve={segmentation:z,raw:{personMask:null,backgroundMask:null,partMask:null},tensor:{personMask:null,backgroundMask:null,partMask:null},personMask:null,backgroundMask:null,partMask:null,bodyParts:Y}).raw.backgroundMask=Xc(z,!0),ve.raw.personMask=Xc(z,!1),ve.raw.partMask=Vd(z,ce),De=F.tidy(function(){var En=F.browser.fromPixels(w),Tn=F.ones([z.height,z.width,1]).tile([1,1,1]).mul(255);En=En.concat(Tn,2);var Pn=F.tensor(z.data,[z.height,z.width,1]),dn=F.tensor(z.data,[z.height,z.width,1]),cr=F.tensor(Pa()(ve.raw.partMask.data),[z.height,z.width,4]);return{personMask:Pn=F.cast(Pn.add(.2).sign().relu().mul(En),"int32"),backgroundMask:dn=F.cast(dn.add(.2).sign().neg().relu().mul(En),"int32"),partMask:cr=F.cast(cr,"int32")}}),Ce=De.personMask,Xe=De.backgroundMask,tt=De.partMask,wn.next=22,F.browser.toPixels(Ce);case 22:return kt=wn.sent,wn.next=25,F.browser.toPixels(Xe);case 25:return At=wn.sent,wn.next=28,F.browser.toPixels(tt);case 28:if(tn=wn.sent,ve.personMask=kt,ve.backgroundMask=At,ve.partMask=tn,!dr.checkP5()){wn.next=42;break}return wn.next=35,this.convertToP5Image(kt,z.width,z.height);case 35:return ve.personMask=wn.sent,wn.next=38,this.convertToP5Image(At,z.width,z.height);case 38:return ve.backgroundMask=wn.sent,wn.next=41,this.convertToP5Image(tn,z.width,z.height);case 41:ve.partMask=wn.sent;case 42:return this.config.returnTensors?(ve.tensor.personMask=Ce,ve.tensor.backgroundMask=Xe,ve.tensor.partMask=tt):(Ce.dispose(),Xe.dispose(),tt.dispose()),wn.abrupt("return",ve);case 44:case"end":return wn.stop()}},k,this)}));return function(k,w){return E.apply(this,arguments)}}()},{key:"segmentWithParts",value:function(){var E=K()(ke.a.mark(function k(w,S,z){var Y,ce,ve;return ke.a.wrap(function(De){for(;;)switch(De.prev=De.next){case 0:if(Y=this.video,ve=this.config,typeof w!="function"){De.next=7;break}Y=this.video,ce=w,De.next=25;break;case 7:if(!(w instanceof HTMLImageElement||w instanceof HTMLCanvasElement||w instanceof HTMLVideoElement||w instanceof ImageData)){De.next=11;break}Y=w,De.next=25;break;case 11:if(we()(w)!=="object"||!(w.elt instanceof HTMLImageElement||w.elt instanceof HTMLCanvasElement||w.elt instanceof ImageData)){De.next=15;break}Y=w.elt,De.next=25;break;case 15:if(!(we()(w)==="object"&&w.canvas instanceof HTMLCanvasElement)){De.next=19;break}Y=w.canvas,De.next=25;break;case 19:if(!(we()(w)==="object"&&w.elt instanceof HTMLVideoElement)){De.next=23;break}Y=w.elt,De.next=25;break;case 23:if(this.video instanceof HTMLVideoElement){De.next=25;break}throw new Error("No input image provided. If you want to classify a video, pass the video element in the constructor. ");case 25:return we()(S)==="object"?ve=S:typeof S=="function"&&(ce=S),typeof z=="function"&&(ce=z),De.abrupt("return",at(this.segmentWithPartsInternal(Y,ve),ce));case 28:case"end":return De.stop()}},k,this)}));return function(k,w,S){return E.apply(this,arguments)}}()},{key:"segmentInternal",value:function(){var E=K()(ke.a.mark(function k(w,S){var z,Y,ce,ve,De,Ce,Xe,tt=this;return ke.a.wrap(function(kt){for(;;)switch(kt.prev=kt.next){case 0:return kt.next=2,this.ready;case 2:return kt.next=4,F.nextFrame();case 4:if(!this.video||this.video.readyState!==0){kt.next=7;break}return kt.next=7,new Promise(function(At){tt.video.onloadeddata=function(){return At()}});case 7:return this.config.outputStride=S.outputStride||this.config.outputStride,this.config.segmentationThreshold=S.segmentationThreshold||this.config.segmentationThreshold,kt.next=11,this.model.estimatePersonSegmentation(w,this.config.outputStride,this.config.segmentationThreshold);case 11:return z=kt.sent,(Y={segmentation:z,raw:{personMask:null,backgroundMask:null},tensor:{personMask:null,backgroundMask:null},personMask:null,backgroundMask:null}).raw.backgroundMask=Xc(z,!0),Y.raw.personMask=Xc(z,!1),ce=F.tidy(function(){var At=F.browser.fromPixels(w),tn=F.ones([z.height,z.width,1]).tile([1,1,1]).mul(255);At=At.concat(tn,2);var sn=F.tensor(z.data,[z.height,z.width,1]),wn=F.tensor(z.data,[z.height,z.width,1]);return{personMask:sn=F.cast(sn.neg().add(1).mul(At),"int32"),backgroundMask:wn=F.cast(wn.mul(At),"int32")}}),ve=ce.personMask,De=ce.backgroundMask,kt.next=18,F.browser.toPixels(ve);case 18:return Ce=kt.sent,kt.next=21,F.browser.toPixels(De);case 21:if(Xe=kt.sent,!dr.checkP5()){kt.next=31;break}return kt.next=25,this.convertToP5Image(Ce,z.width,z.height);case 25:return Y.personMask=kt.sent,kt.next=28,this.convertToP5Image(Xe,z.width,z.height);case 28:Y.backgroundMask=kt.sent,kt.next=33;break;case 31:Y.personMask=Ce,Y.backgroundMask=Xe;case 33:return this.config.returnTensors?(Y.tensor.personMask=ve,Y.tensor.backgroundMask=De):(ve.dispose(),De.dispose()),kt.abrupt("return",Y);case 35:case"end":return kt.stop()}},k,this)}));return function(k,w){return E.apply(this,arguments)}}()},{key:"segment",value:function(){var E=K()(ke.a.mark(function k(w,S,z){var Y,ce,ve;return ke.a.wrap(function(De){for(;;)switch(De.prev=De.next){case 0:if(Y=this.video,ve=this.config,typeof w!="function"){De.next=7;break}Y=this.video,ce=w,De.next=25;break;case 7:if(!(w instanceof HTMLImageElement||w instanceof HTMLCanvasElement||w instanceof HTMLVideoElement||w instanceof ImageData)){De.next=11;break}Y=w,De.next=25;break;case 11:if(we()(w)!=="object"||!(w.elt instanceof HTMLImageElement||w.elt instanceof HTMLCanvasElement||w.elt instanceof ImageData)){De.next=15;break}Y=w.elt,De.next=25;break;case 15:if(!(we()(w)==="object"&&w.canvas instanceof HTMLCanvasElement)){De.next=19;break}Y=w.canvas,De.next=25;break;case 19:if(!(we()(w)==="object"&&w.elt instanceof HTMLVideoElement)){De.next=23;break}Y=w.elt,De.next=25;break;case 23:if(this.video instanceof HTMLVideoElement){De.next=25;break}throw new Error("No input image provided. If you want to classify a video, pass the video element in the constructor. ");case 25:return we()(S)==="object"?ve=S:typeof S=="function"&&(ce=S),typeof z=="function"&&(ce=z),De.abrupt("return",at(this.segmentInternal(Y,ve),ce));case 28:case"end":return De.stop()}},k,this)}));return function(k,w,S){return E.apply(this,arguments)}}()}]),I}(),qd=function(I,E,k){var w,S={},z=k;I instanceof HTMLVideoElement?w=I:we()(I)==="object"&&I.elt instanceof HTMLVideoElement?w=I.elt:we()(I)==="object"?S=I:typeof I=="function"&&(z=I),we()(E)==="object"?S=E:typeof E=="function"&&(z=E);var Y=new Em(w,S,z);return z?Y:Y.ready},Fl=function(){var I=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,E=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return Math.random()*(E-I)+I},jp=function(){var I,E,k,w,S,z,Y=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,ce=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;if(z)I=E,z=!1;else{do S=(k=Fl(0,2)-1)*k+(w=Fl(0,2)-1)*w;while(S>=1);I=k*(S=Math.sqrt(-2*Math.log(S)/S)),E=w*S,z=!0}return I*ce+Y},Nf=function(I,E){var k;if((arguments.length>2&&arguments[2]!==void 0&&arguments[2])===!0)k=Array.from({length:E},function(){return I[Math.floor(Math.random()*I.length)]});else{if(E>I.length)throw new RangeError("Sample size must be less than or equal to array length when sampling without replacement.");k=I.map(function(w){return[w,Math.random()]}).sort(function(w,S){return w[1]<S[1]?-1:1}).slice(0,E).map(function(w){return w[0]})}return k},Yc=function(){function I(){pe()(this,I),this.isTrained=!1,this.isCompiled=!1,this.isLayered=!1,this.model=null,this.init=this.init.bind(this),this.createModel=this.createModel.bind(this),this.addLayer=this.addLayer.bind(this),this.compile=this.compile.bind(this),this.setOptimizerFunction=this.setOptimizerFunction.bind(this),this.train=this.train.bind(this),this.trainInternal=this.trainInternal.bind(this),this.predict=this.predict.bind(this),this.classify=this.classify.bind(this),this.save=this.save.bind(this),this.load=this.load.bind(this),this.init()}return Te()(I,[{key:"init",value:function(){this.createModel()}},{key:"createModel",value:function(){switch((arguments.length>0&&arguments[0]!==void 0?arguments[0]:"sequential").toLowerCase()){case"sequential":default:return this.model=F.sequential(),this.model}}},{key:"addLayer",value:function(E){var k=E||{};this.model.add(k),this.model.layers.length>=2&&(this.isLayered=!0)}},{key:"compile",value:function(E){this.model.compile(E),this.isCompiled=!0}},{key:"setOptimizerFunction",value:function(E,k){return k.call(this,E)}},{key:"train",value:function(E,k){return at(this.trainInternal(E),k)}},{key:"trainInternal",value:function(){var E=K()(ke.a.mark(function k(w){var S,z,Y,ce,ve,De,Ce,Xe;return ke.a.wrap(function(tt){for(;;)switch(tt.prev=tt.next){case 0:return z=(S=w).inputs,Y=S.outputs,ce=S.batchSize,ve=S.epochs,De=S.shuffle,Ce=S.validationSplit,Xe=S.whileTraining,tt.next=6,this.model.fit(z,Y,{batchSize:ce,epochs:ve,shuffle:De,validationSplit:Ce,callbacks:Xe});case 6:z.dispose(),Y.dispose(),this.isTrained=!0;case 9:case"end":return tt.stop()}},k,this)}));return function(k){return E.apply(this,arguments)}}()},{key:"predictSync",value:function(E){var k=this,w=F.tidy(function(){return k.model.predict(E)}),S=w.arraySync();return w.dispose(),E.dispose(),S}},{key:"predict",value:function(){var E=K()(ke.a.mark(function k(w){var S,z,Y=this;return ke.a.wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:return S=F.tidy(function(){return Y.model.predict(w)}),ce.next=3,S.array();case 3:return z=ce.sent,S.dispose(),w.dispose(),ce.abrupt("return",z);case 7:case"end":return ce.stop()}},k)}));return function(k){return E.apply(this,arguments)}}()},{key:"classify",value:function(){var E=K()(ke.a.mark(function k(w){return ke.a.wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return S.abrupt("return",this.predict(w));case 1:case"end":return S.stop()}},k,this)}));return function(k){return E.apply(this,arguments)}}()},{key:"classifySync",value:function(E){return this.predictSync(E)}},{key:"save",value:function(){var E=K()(ke.a.mark(function k(w,S){var z,Y,ce=this;return ke.a.wrap(function(ve){for(;;)switch(ve.prev=ve.next){case 0:typeof w=="function"?(z="model",Y=w):typeof w=="string"?(z=w,typeof S=="function"&&(Y=S)):z="model",this.model.save(F.io.withSaveHandler(function(){var De=K()(ke.a.mark(function Ce(Xe){return ke.a.wrap(function(tt){for(;;)switch(tt.prev=tt.next){case 0:return ce.weightsManifest={modelTopology:Xe.modelTopology,weightsManifest:[{paths:["./".concat(z,".weights.bin")],weights:Xe.weightSpecs}]},tt.next=3,jr(Xe.weightData,"".concat(z,".weights.bin"),"application/octet-stream");case 3:return tt.next=5,jr(JSON.stringify(ce.weightsManifest),"".concat(z,".json"),"text/plain");case 5:Y&&Y();case 6:case"end":return tt.stop()}},Ce)}));return function(Ce){return De.apply(this,arguments)}}()));case 2:case"end":return ve.stop()}},k,this)}));return function(k,w){return E.apply(this,arguments)}}()},{key:"load",value:function(){var E=K()(ke.a.mark(function k(){var w,S,z,Y,ce,ve,De,Ce,Xe,tt,kt,At=arguments;return ke.a.wrap(function(tn){for(;;)switch(tn.prev=tn.next){case 0:if(w=At.length>0&&At[0]!==void 0?At[0]:null,S=At.length>1?At[1]:void 0,!(w instanceof FileList)){tn.next=13;break}return tn.next=5,Promise.all(Array.from(w).map(function(){var sn=K()(ke.a.mark(function wn(En){var Tn;return ke.a.wrap(function(Pn){for(;;)switch(Pn.prev=Pn.next){case 0:if(!En.name.includes(".json")||En.name.includes("_meta")){Pn.next=4;break}return Pn.abrupt("return",{name:"model",file:En});case 4:if(!En.name.includes(".json")||!En.name.includes("_meta.json")){Pn.next=11;break}return Pn.next=7,En.text();case 7:return Tn=Pn.sent,Pn.abrupt("return",{name:"metadata",file:Tn});case 11:if(!En.name.includes(".bin")){Pn.next=13;break}return Pn.abrupt("return",{name:"weights",file:En});case 13:return Pn.abrupt("return",{name:null,file:null});case 14:case"end":return Pn.stop()}},wn)}));return function(wn){return sn.apply(this,arguments)}}()));case 5:return z=tn.sent,Y=z.find(function(sn){return sn.name==="model"}).file,ce=z.find(function(sn){return sn.name==="weights"}).file,tn.next=10,F.loadLayersModel(F.io.browserFiles([Y,ce]));case 10:this.model=tn.sent,tn.next=32;break;case 13:if(!(w instanceof Object)){tn.next=29;break}return tn.next=16,Gt.a.get(w.model,{responseType:"text"});case 16:return ve=tn.sent,De=JSON.stringify(ve.data),Ce=new File([De],"model.json",{type:"application/json"}),tn.next=21,Gt.a.get(w.weights,{responseType:"blob"});case 21:return Xe=tn.sent,tt=Xe.data,kt=new File([tt],"model.weights.bin",{type:"application/macbinary"}),tn.next=26,F.loadLayersModel(F.io.browserFiles([Ce,kt]));case 26:this.model=tn.sent,tn.next=32;break;case 29:return tn.next=31,F.loadLayersModel(w);case 31:this.model=tn.sent;case 32:return this.isCompiled=!0,this.isLayered=!0,this.isTrained=!0,S&&S(),tn.abrupt("return",this.model);case 37:case"end":return tn.stop()}},k,this)}));return function(){return E.apply(this,arguments)}}()},{key:"dispose",value:function(){this.model.dispose()}},{key:"mutate",value:function(){var E=this,k=arguments.length>0&&arguments[0]!==void 0?arguments[0]:.1,w=arguments.length>1?arguments[1]:void 0;F.tidy(function(){for(var S=E.model.getWeights(),z=[],Y=0;Y<S.length;Y+=1){for(var ce=S[Y],ve=S[Y].shape,De=ce.dataSync().slice(),Ce=0;Ce<De.length;Ce+=1)Math.random()<k&&(De[Ce]=w?w(De[Ce]):Math.min(Math.max(De[Ce]+jp(),-1),1));var Xe=F.tensor(De,ve);z[Y]=Xe}E.model.setWeights(z)})}},{key:"crossover",value:function(E){var k=this;return F.tidy(function(){for(var w=k.model.getWeights(),S=E.model.getWeights(),z=[],Y=0;Y<w.length;Y+=1){for(var ce=w[Y],ve=S[Y],De=w[Y].shape,Ce=ce.dataSync().slice(),Xe=ve.dataSync().slice(),tt=0;tt<Ce.length;tt+=1)Math.random()<.5&&(Ce[tt]=Xe[tt]);var kt=F.tensor(Ce,De);z[Y]=kt}k.model.setWeights(z)})}}]),I}();function Hd(I,E){var k=Object.keys(I);if(Object.getOwnPropertySymbols){var w=Object.getOwnPropertySymbols(I);E&&(w=w.filter(function(S){return Object.getOwnPropertyDescriptor(I,S).enumerable})),k.push.apply(k,w)}return k}function zh(I){for(var E=1;E<arguments.length;E++){var k=arguments[E]!=null?arguments[E]:{};E%2?Hd(Object(k),!0).forEach(function(w){ee()(I,w,k[w])}):Object.getOwnPropertyDescriptors?Object.defineProperties(I,Object.getOwnPropertyDescriptors(k)):Hd(Object(k)).forEach(function(w){Object.defineProperty(I,w,Object.getOwnPropertyDescriptor(k,w))})}return I}var yo=new(function(){function I(E){pe()(this,I),this.options=E||{}}return Te()(I,[{key:"normalizeValue",value:function(E,k,w){return(E-k)/(w-k)}},{key:"unnormalizeValue",value:function(E,k,w){return E*(w-k)+k}},{key:"getMin",value:function(E){return E.reduce(function(k,w){return Math.min(k,w)})}},{key:"getMax",value:function(E){return E.reduce(function(k,w){return Math.max(k,w)})}},{key:"isJsonOrString",value:function(E){try{JSON.parse(E)}catch{return!1}return!0}},{key:"zipArrays",value:function(E,k){return E.length!==k.length?(console.error("arrays do not have the same length"),[]):Pa()(new Array(E.length).fill(null)).map(function(w,S){return zh(zh({},E[S]),k[S])})}},{key:"createLabelsFromArrayValues",value:function(E,k){var w;return Array.isArray(E)&&(w=E.map(function(S,z){return"".concat(k,"_").concat(z)})),w}},{key:"formatDataAsObject",value:function(E,k){var w={};if(Array.isArray(E))return E.forEach(function(S,z){var Y=k[z];w[Y]=S}),w;if(we()(E)==="object")return w=E;throw new Error("input provided is not supported or does not match your output label specifications")}},{key:"getDataType",value:function(E){var k=we()(E);return k==="object"&&Array.isArray(E)&&(k="array"),k}}]),I}());function Rl(I,E){var k=Object.keys(I);if(Object.getOwnPropertySymbols){var w=Object.getOwnPropertySymbols(I);E&&(w=w.filter(function(S){return Object.getOwnPropertyDescriptor(I,S).enumerable})),k.push.apply(k,w)}return k}function Cs(I){for(var E=1;E<arguments.length;E++){var k=arguments[E]!=null?arguments[E]:{};E%2?Rl(Object(k),!0).forEach(function(w){ee()(I,w,k[w])}):Object.getOwnPropertyDescriptors?Object.defineProperties(I,Object.getOwnPropertyDescriptors(k)):Rl(Object(k)).forEach(function(w){Object.defineProperty(I,w,Object.getOwnPropertyDescriptor(k,w))})}return I}var Ml=function(){function I(){pe()(this,I),this.meta={inputUnits:null,outputUnits:null,inputs:{},outputs:{},isNormalized:!1},this.isMetadataReady=!1,this.isWarmedUp=!1,this.data={raw:[]},this.createMetadata=this.createMetadata.bind(this),this.getDataStats=this.getDataStats.bind(this),this.getInputMetaStats=this.getInputMetaStats.bind(this),this.getDataUnits=this.getDataUnits.bind(this),this.getInputMetaUnits=this.getInputMetaUnits.bind(this),this.getDTypesFromData=this.getDTypesFromData.bind(this),this.addData=this.addData.bind(this),this.convertRawToTensors=this.convertRawToTensors.bind(this),this.normalizeDataRaw=this.normalizeDataRaw.bind(this),this.normalizeInputData=this.normalizeInputData.bind(this),this.normalizeArray=this.normalizeArray.bind(this),this.unnormalizeArray=this.unnormalizeArray.bind(this),this.applyOneHotEncodingsToDataRaw=this.applyOneHotEncodingsToDataRaw.bind(this),this.getDataOneHot=this.getDataOneHot.bind(this),this.getInputMetaOneHot=this.getInputMetaOneHot.bind(this),this.createOneHotEncodings=this.createOneHotEncodings.bind(this),this.loadDataFromUrl=this.loadDataFromUrl.bind(this),this.loadJSON=this.loadJSON.bind(this),this.loadCSV=this.loadCSV.bind(this),this.loadBlob=this.loadBlob.bind(this),this.loadData=this.loadData.bind(this),this.saveData=this.saveData.bind(this),this.saveMeta=this.saveMeta.bind(this),this.loadMeta=this.loadMeta.bind(this),this.findEntries=this.findEntries.bind(this),this.formatRawData=this.formatRawData.bind(this),this.csvToJSON=this.csvToJSON.bind(this)}return Te()(I,[{key:"createMetadata",value:function(E){var k=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return this.getDTypesFromData(E),this.getDataStats(E),this.getDataOneHot(E),this.getDataUnits(E,k),this.isMetadataReady=!0,Cs({},this.meta)}},{key:"getDataStats",value:function(E){var k=Object.assign({},this.meta),w=this.getInputMetaStats(E,k.inputs,"xs"),S=this.getInputMetaStats(E,k.outputs,"ys");return k.inputs=w,k.outputs=S,this.meta=Cs(Cs({},this.meta),k),k}},{key:"getInputMetaStats",value:function(E,k,w){var S=Object.assign({},k);return Object.keys(S).forEach(function(z){if(S[z].dtype==="string")S[z].min=0,S[z].max=1;else if(S[z].dtype==="number"){var Y=E.map(function(ve){return ve[w][z]});S[z].min=yo.getMin(Y),S[z].max=yo.getMax(Y)}else if(S[z].dtype==="array"){var ce=E.map(function(ve){return ve[w][z]}).flat();S[z].min=yo.getMin(ce),S[z].max=yo.getMax(ce)}}),S}},{key:"getDataUnits",value:function(E){var k,w=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,S=w!==null?w:void 0,z=Object.assign({},this.meta);k=S||[this.getInputMetaUnits(E,z.inputs)].flat();var Y=this.getInputMetaUnits(E,z.outputs);return z.inputUnits=k,z.outputUnits=Y,this.meta=Cs(Cs({},this.meta),z),z}},{key:"getInputMetaUnits",value:function(E,k){var w=0,S=Object.assign({},k);return Object.entries(S).forEach(function(z){var Y=z[1].dtype;if(Y==="number")w+=1;else if(Y==="string"){var ce=z[1].uniqueValues.length;w+=ce}else Y==="array"&&(w=[])}),w}},{key:"getDTypesFromData",value:function(E){var k=Cs(Cs({},this.meta),{},{inputs:{},outputs:{}}),w=E[0],S=Object.keys(w.xs),z=Object.keys(w.ys);return S.forEach(function(Y){k.inputs[Y]={dtype:yo.getDataType(w.xs[Y])}}),z.forEach(function(Y){k.outputs[Y]={dtype:yo.getDataType(w.ys[Y])}}),this.meta=k,k}},{key:"addData",value:function(E,k){this.data.raw.push({xs:E,ys:k})}},{key:"convertRawToTensors",value:function(E){var k=Object.assign({},this.meta),w=E.length;return F.tidy(function(){var S=[],z=[];return E.forEach(function(Y){var ce=Object.keys(k.inputs).map(function(De){return Y.xs[De]}).flat();S.push(ce);var ve=Object.keys(k.outputs).map(function(De){return Y.ys[De]}).flat();z.push(ve)}),{inputs:F.tensor(S.flat(),[w].concat(Pa()(k.inputUnits))),outputs:F.tensor(z.flat(),[w,k.outputUnits])}})}},{key:"normalizeDataRaw",value:function(E){var k=Object.assign({},this.meta),w=this.normalizeInputData(E,k.inputs,"xs"),S=this.normalizeInputData(E,k.outputs,"ys");return yo.zipArrays(w,S)}},{key:"normalizeInputData",value:function(E,k,w){var S=this,z=E.length,Y=Object.assign({},k),ce={};return Object.keys(Y).forEach(function(ve){var De={min:Y[ve].min,max:Y[ve].max},Ce=E.map(function(Xe){return Xe[w][ve]});Y[ve].dtype==="string"?(De.legend=Y[ve].legend,ce[ve]=S.normalizeArray(Ce,De)):Y[ve].dtype==="number"?ce[ve]=S.normalizeArray(Ce,De):Y[ve].dtype==="array"&&(ce[ve]=Ce.map(function(Xe){return S.normalizeArray(Xe,De)}))}),Pa()(new Array(z).fill(null)).map(function(ve,De){var Ce=ee()({},w,{});return Object.keys(Y).forEach(function(Xe){Ce[w][Xe]=ce[Xe][De]}),Ce})}},{key:"normalizeArray",value:function(E,k){var w=k.min,S=k.max;if(k.legend)return E.map(function(z){return k.legend[z]?k.legend[z]:z});if(E.every(function(z){return typeof z=="number"}))return E.map(function(z){return yo.normalizeValue(z,w,S)});throw new Error("error in inputArray of normalizeArray() function")}},{key:"unnormalizeArray",value:function(E,k){var w=k.min,S=k.max;if(k.legend)return E.map(function(z){var Y;return Object.entries(k.legend).forEach(function(ce){var ve=ce[0],De=ce[1];z.map(function(Ce,Xe){return Ce===De[Xe]}).every(function(Ce){return Ce===!0})&&(Y=ve)}),Y});if(E.every(function(z){return typeof z=="number"}))return E.map(function(z){return yo.unnormalizeValue(z,w,S)});throw new Error("error in inputArray of normalizeArray() function")}},{key:"applyOneHotEncodingsToDataRaw",value:function(E){var k=Object.assign({},this.meta);return E.map(function(w){var S=Cs({},w.xs),z=Cs({},w.ys);return Object.keys(k.inputs).forEach(function(Y){k.inputs[Y].legend&&(S[Y]=k.inputs[Y].legend[w.xs[Y]])}),Object.keys(k.outputs).forEach(function(Y){k.outputs[Y].legend&&(z[Y]=k.outputs[Y].legend[w.ys[Y]])}),{xs:S,ys:z}})}},{key:"getDataOneHot",value:function(E){var k=Object.assign({},this.meta),w=this.getInputMetaOneHot(E,k.inputs,"xs"),S=this.getInputMetaOneHot(E,k.outputs,"ys");return k.inputs=w,k.outputs=S,this.meta=Cs(Cs({},this.meta),k),k}},{key:"getInputMetaOneHot",value:function(E,k,w){var S=this,z=Object.assign({},k);return Object.entries(z).forEach(function(Y){var ce=Y[0];if(Y[1].dtype==="string"){var ve=Pa()(new Set(E.map(function(Ce){return Ce[w][ce]}))),De=S.createOneHotEncodings(ve);z[ce]=Cs(Cs({},z[ce]),De)}}),z}},{key:"createOneHotEncodings",value:function(E){return F.tidy(function(){var k={uniqueValues:E,legend:{}},w=E,S=w.map(function(Y,ce){return ce}),z=F.oneHot(F.tensor1d(S,"int32"),w.length).arraySync();return w.forEach(function(Y,ce){k.legend[Y]=z[ce]}),k})}},{key:"loadDataFromUrl",value:function(){var E=K()(ke.a.mark(function k(w,S,z){var Y;return ke.a.wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:if(ce.prev=0,!w.endsWith(".csv")){ce.next=7;break}return ce.next=4,this.loadCSV(w,S,z);case 4:Y=ce.sent,ce.next=20;break;case 7:if(!w.endsWith(".json")){ce.next=13;break}return ce.next=10,this.loadJSON(w,S,z);case 10:Y=ce.sent,ce.next=20;break;case 13:if(!w.includes("blob")){ce.next=19;break}return ce.next=16,this.loadBlob(w,S,z);case 16:Y=ce.sent,ce.next=20;break;case 19:throw new Error("Not a valid data format. Must be csv or json");case 20:return ce.abrupt("return",Y);case 23:throw ce.prev=23,ce.t0=ce.catch(0),console.error(ce.t0),new Error(ce.t0);case 27:case"end":return ce.stop()}},k,this,[[0,23]])}));return function(k,w,S){return E.apply(this,arguments)}}()},{key:"loadJSON",value:function(){var E=K()(ke.a.mark(function k(w,S,z){var Y,ce,ve,De;return ke.a.wrap(function(Ce){for(;;)switch(Ce.prev=Ce.next){case 0:if(Ce.prev=0,!(w instanceof Object)){Ce.next=5;break}Y=Object.assign({},w),Ce.next=10;break;case 5:return Ce.next=7,Gt.a.get(w);case 7:ce=Ce.sent,ve=ce.data,Y=ve;case 10:return De=this.formatRawData(Y,S,z),Ce.abrupt("return",De);case 14:throw Ce.prev=14,Ce.t0=Ce.catch(0),console.error("error loading json"),new Error(Ce.t0);case 18:case"end":return Ce.stop()}},k,this,[[0,14]])}));return function(k,w,S){return E.apply(this,arguments)}}()},{key:"loadCSV",value:function(){var E=K()(ke.a.mark(function k(w,S,z){var Y,ce,ve,De;return ke.a.wrap(function(Ce){for(;;)switch(Ce.prev=Ce.next){case 0:return Ce.prev=0,Y=F.data.csv(w),Ce.next=4,Y.toArray();case 4:return ce=Ce.sent,ve={entries:ce},De=this.formatRawData(ve,S,z),Ce.abrupt("return",De);case 10:throw Ce.prev=10,Ce.t0=Ce.catch(0),console.error("error loading csv",Ce.t0),new Error(Ce.t0);case 14:case"end":return Ce.stop()}},k,this,[[0,10]])}));return function(k,w,S){return E.apply(this,arguments)}}()},{key:"loadBlob",value:function(){var E=K()(ke.a.mark(function k(w,S,z){var Y,ce,ve,De,Ce,Xe;return ke.a.wrap(function(tt){for(;;)switch(tt.prev=tt.next){case 0:return tt.prev=0,tt.next=3,Gt.a.get(w);case 3:if(Y=tt.sent,ce=Y.data,ve=ce,!yo.isJsonOrString(ve)){tt.next=13;break}return Ce=JSON.parse(ve),tt.next=10,this.loadJSON(Ce,S,z);case 10:De=tt.sent,tt.next=17;break;case 13:return Xe=this.csvToJSON(ve),tt.next=16,this.loadJSON(Xe,S,z);case 16:De=tt.sent;case 17:return tt.abrupt("return",De);case 20:throw tt.prev=20,tt.t0=tt.catch(0),console.log("mmm might be passing in a string or something!",tt.t0),new Error(tt.t0);case 24:case"end":return tt.stop()}},k,this,[[0,20]])}));return function(k,w,S){return E.apply(this,arguments)}}()},{key:"loadData",value:function(){var E=K()(ke.a.mark(function k(){var w,S,z,Y,ce,ve,De=arguments;return ke.a.wrap(function(Ce){for(;;)switch(Ce.prev=Ce.next){case 0:if(w=De.length>0&&De[0]!==void 0?De[0]:null,S=De.length>1?De[1]:void 0,Ce.prev=2,typeof w=="string"){Ce.next=17;break}if(Y=w[0],new FileReader().readAsText(Y),!Y.name.includes(".json")){Ce.next=14;break}return Ce.next=10,Y.text();case 10:ce=Ce.sent,z=JSON.parse(ce),Ce.next=15;break;case 14:console.log('data must be a json object containing an array called "data" or "entries');case 15:Ce.next=22;break;case 17:return Ce.next=19,Gt.a.get(w,{responseType:"text"});case 19:z=Ce.sent,ve=JSON.stringify(z.data),yo.isJsonOrString(ve)?z=JSON.parse(ve):console.log("Whoops! something went wrong. Either this kind of data is not supported yet or there is an issue with .loadData");case 22:this.data.raw=this.findEntries(z),!this.data.raw.length>0&&console.log('data must be a json object containing an array called "data" '),S&&S(),Ce.next=30;break;case 27:throw Ce.prev=27,Ce.t0=Ce.catch(2),new Error(Ce.t0);case 30:case"end":return Ce.stop()}},k,this,[[2,27]])}));return function(){return E.apply(this,arguments)}}()},{key:"saveData",value:function(){var E=K()(ke.a.mark(function k(w){var S,z,Y,ce,ve,De;return ke.a.wrap(function(Ce){for(;;)switch(Ce.prev=Ce.next){case 0:return S=new Date,z="".concat(String(S.getFullYear()),"-").concat(String(S.getMonth()+1),"-").concat(String(S.getDate())),Y="".concat(String(S.getHours()),"-").concat(String(S.getMinutes()),"-").concat(String(S.getSeconds())),ce="".concat(z,"_").concat(Y),ve=ce,w&&(ve=w),De={data:this.data.raw},Ce.next=9,jr(JSON.stringify(De),"".concat(ve,".json"),"text/plain");case 9:case"end":return Ce.stop()}},k,this)}));return function(k){return E.apply(this,arguments)}}()},{key:"saveMeta",value:function(){var E=K()(ke.a.mark(function k(w,S){var z,Y;return ke.a.wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:return typeof w=="function"?(z="model",Y=w):typeof w=="string"?(z=w,typeof S=="function"&&(Y=S)):z="model",ce.next=3,jr(JSON.stringify(this.meta),"".concat(z,"_meta.json"),"text/plain");case 3:Y&&Y();case 4:case"end":return ce.stop()}},k,this)}));return function(k,w){return E.apply(this,arguments)}}()},{key:"loadMeta",value:function(){var E=K()(ke.a.mark(function k(){var w,S,z,Y,ce,ve,De,Ce=arguments;return ke.a.wrap(function(Xe){for(;;)switch(Xe.prev=Xe.next){case 0:if(w=Ce.length>0&&Ce[0]!==void 0?Ce[0]:null,S=Ce.length>1?Ce[1]:void 0,!(w instanceof FileList)){Xe.next=10;break}return Xe.next=5,Promise.all(Array.from(w).map(function(){var tt=K()(ke.a.mark(function kt(At){var tn;return ke.a.wrap(function(sn){for(;;)switch(sn.prev=sn.next){case 0:if(!At.name.includes(".json")||At.name.includes("_meta")){sn.next=4;break}return sn.abrupt("return",{name:"model",file:At});case 4:if(!At.name.includes(".json")||!At.name.includes("_meta.json")){sn.next=11;break}return sn.next=7,At.text();case 7:return tn=sn.sent,sn.abrupt("return",{name:"metadata",file:tn});case 11:if(!At.name.includes(".bin")){sn.next=13;break}return sn.abrupt("return",{name:"weights",file:At});case 13:return sn.abrupt("return",{name:null,file:null});case 14:case"end":return sn.stop()}},kt)}));return function(kt){return tt.apply(this,arguments)}}()));case 5:z=Xe.sent,Y=JSON.parse(z.find(function(tt){return tt.name==="metadata"}).file),this.meta=Y,Xe.next=25;break;case 10:if(!(w instanceof Object)){Xe.next=19;break}return Xe.next=13,Gt.a.get(w.metadata,{responseType:"text"});case 13:ce=Xe.sent,ce=JSON.stringify(ce.data),ce=JSON.parse(ce),this.meta=ce,Xe.next=25;break;case 19:return ve="".concat(w.substring(0,w.lastIndexOf("/")),"/model_meta.json"),Xe.next=22,Gt.a.get(ve);case 22:De=(De=Xe.sent).data,this.meta=De;case 25:return this.isMetadataReady=!0,this.isWarmedUp=!0,S&&S(),Xe.abrupt("return",this.meta);case 29:case"end":return Xe.stop()}},k,this)}));return function(){return E.apply(this,arguments)}}()},{key:"formatRawData",value:function(E,k,w){var S=this.findEntries(E);!S.length>0&&console.log(`your data must be contained in an array in 

        a property called 'entries' or 'data' of your json object`);var z=S.map(function(Y,ce){var ve={xs:{},ys:{}};return k.forEach(function(De){Y[De]!==void 0?ve.xs[De]=Y[De]:console.error("the input label ".concat(De," does not exist at row ").concat(ce))}),w.forEach(function(De){Y[De]!==void 0?ve.ys[De]=Y[De]:console.error("the output label ".concat(De," does not exist at row ").concat(ce))}),ve});return this.data.raw=z,z}},{key:"csvToJSON",value:function(E){for(var k=E.split(`
`),w=[],S=k[0].split(","),z=function(ce){var ve={},De=k[ce].split(",");S.forEach(function(Ce,Xe){ve[Ce]=De[Xe]}),w.push(ve)},Y=1;Y<k.length;Y+=1)z(Y);return{entries:w}}},{key:"findEntries",value:function(E){var k=this,w=Object.assign({},E);return w.entries&&w.entries instanceof Array?w.entries:w.data&&w.data instanceof Array?w.data:(Object.keys(w).forEach(function(S){if(we()(w[S])==="object")return k.findEntries(w[S])}),w)}},{key:"getData",value:function(){return this.data.raw}}]),I}();function If(I,E){var k=Object.keys(I);if(Object.getOwnPropertySymbols){var w=Object.getOwnPropertySymbols(I);E&&(w=w.filter(function(S){return Object.getOwnPropertyDescriptor(I,S).enumerable})),k.push.apply(k,w)}return k}var Uh=function(){function I(){pe()(this,I),this.config={height:300}}return Te()(I,[{key:"modelSummary",value:function(E,k){var w=function(S){for(var z=1;z<arguments.length;z++){var Y=arguments[z]!=null?arguments[z]:{};z%2?If(Object(Y),!0).forEach(function(ce){ee()(S,ce,Y[ce])}):Object.getOwnPropertyDescriptors?Object.defineProperties(S,Object.getOwnPropertyDescriptors(Y)):If(Object(Y)).forEach(function(ce){Object.defineProperty(S,ce,Object.getOwnPropertyDescriptor(Y,ce))})}return S}({},E);ue.show.modelSummary(w,k)}},{key:"scatterplot",value:function(E,k,w){var S=w.map(function(Y){return{x:Y.xs[E],y:Y.ys[k]}}),z={xLabel:"X",yLabel:"Y",height:this.config.height};ue.render.scatterplot({name:"debug mode"},S,z)}},{key:"scatterplotAll",value:function(E,k,w){var S=[];E.forEach(function(Y){k.forEach(function(ce){var ve=w.map(function(De){return{x:De.xs[Y],y:De.ys[ce]}});S=[].concat(Pa()(S),Pa()(ve))})});var z={xLabel:"X",yLabel:"Y",height:this.config.height};ue.render.scatterplot({name:"debug mode"},S,z)}},{key:"barchart",value:function(E,k,w){var S=w.map(function(Y){return{value:Y.xs[E],index:Y.ys[k]}}),z={xLabel:"label",yLabel:"value",height:this.config.height};console.log(z),ue.render.barchart({name:"Bar chart"},S)}},{key:"trainingVis",value:function(){return ue.show.fitCallbacks({name:"Training Performance"},["loss","accuracy"],{height:this.config.height,callbacks:["onEpochEnd"]})}}]),I}();function $d(I,E){var k=Object.keys(I);if(Object.getOwnPropertySymbols){var w=Object.getOwnPropertySymbols(I);E&&(w=w.filter(function(S){return Object.getOwnPropertyDescriptor(I,S).enumerable})),k.push.apply(k,w)}return k}function Ff(I){for(var E=1;E<arguments.length;E++){var k=arguments[E]!=null?arguments[E]:{};E%2?$d(Object(k),!0).forEach(function(w){ee()(I,w,k[w])}):Object.getOwnPropertyDescriptors?Object.defineProperties(I,Object.getOwnPropertyDescriptors(k)):$d(Object(k)).forEach(function(w){Object.defineProperty(I,w,Object.getOwnPropertyDescriptor(k,w))})}return I}var jl={inputs:[],outputs:[],dataUrl:null,modelUrl:null,layers:[],task:null,debug:!1,learningRate:.2,hiddenUnits:16,noTraining:!1},Gd=function(){function I(E,k){pe()(this,I),this.callback=k,E.task==="imageClassification"&&(jl.learningRate=.02),this.options=Ff(Ff({},jl),E)||jl,this.neuralNetwork=new Yc,this.neuralNetworkData=new Ml,this.neuralNetworkVis=new Uh,this.data={training:[]},this.ready=!1,this.init=this.init.bind(this),this.addData=this.addData.bind(this),this.loadDataFromUrl=this.loadDataFromUrl.bind(this),this.loadDataInternal=this.loadDataInternal.bind(this),this.createMetaData=this.createMetaData.bind(this),this.prepareForTraining=this.prepareForTraining.bind(this),this.normalizeData=this.normalizeData.bind(this),this.normalizeInput=this.normalizeInput.bind(this),this.searchAndFormat=this.searchAndFormat.bind(this),this.formatInputItem=this.formatInputItem.bind(this),this.convertTrainingDataToTensors=this.convertTrainingDataToTensors.bind(this),this.formatInputsForPrediction=this.formatInputsForPrediction.bind(this),this.formatInputsForPredictionAll=this.formatInputsForPredictionAll.bind(this),this.isOneHotEncodedOrNormalized=this.isOneHotEncodedOrNormalized.bind(this),this.train=this.train.bind(this),this.trainInternal=this.trainInternal.bind(this),this.addLayer=this.addLayer.bind(this),this.createNetworkLayers=this.createNetworkLayers.bind(this),this.addDefaultLayers=this.addDefaultLayers.bind(this),this.compile=this.compile.bind(this),this.predict=this.predict.bind(this),this.predictMultiple=this.predictMultiple.bind(this),this.classify=this.classify.bind(this),this.classifyMultiple=this.classifyMultiple.bind(this),this.predictInternal=this.predictInternal.bind(this),this.classifyInternal=this.classifyInternal.bind(this),this.saveData=this.saveData.bind(this),this.loadData=this.loadData.bind(this),this.save=this.save.bind(this),this.load=this.load.bind(this),this.dispose=this.dispose.bind(this),this.mutate=this.mutate.bind(this),this.crossover=this.crossover.bind(this),this.init(this.callback)}return Te()(I,[{key:"init",value:function(E){this.options.noTraining===!0&&this.createLayersNoTraining(),this.options.dataUrl!==null?this.ready=this.loadDataFromUrl(this.options,E):this.options.modelUrl!==null?this.ready=this.load(this.options.modelUrl,E):this.ready=!0}},{key:"createLayersNoTraining",value:function(){var E=this.options,k=E.inputs,w=E.outputs;if(E.task==="classification")for(var S=0;S<w.length;S+=1){var z=new Array(k).fill(0);this.addData(z,[w[S]])}else{var Y=new Array(k).fill(0),ce=new Array(w).fill(0);this.addData(Y,ce)}this.neuralNetworkData.createMetadata(this.neuralNetworkData.data.raw),this.addDefaultLayers(this.options.task,this.neuralNetworkData.meta)}},{key:"copy",value:function(){var E=this,k=new I(this.options);return F.tidy(function(){for(var w=E.neuralNetwork.model.getWeights(),S=[],z=0;z<w.length;z+=1)S[z]=w[z].clone();return k.neuralNetwork.model.setWeights(S),k})}},{key:"addData",value:function(E,k){var w,S,z=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,Y=this.options,ce=Y.inputs,ve=Y.outputs;if(z!==null?(w=z.inputLabels,S=z.outputLabels):ce.length>0&&ve.length>0?(ce.every(function(tt){return typeof tt=="string"})&&(w=ce),ve.every(function(tt){return typeof tt=="string"})&&(S=ve)):we()(E)==="object"&&we()(k)==="object"?(w=Object.keys(E),S=Object.keys(k)):(w=yo.createLabelsFromArrayValues(E,"input"),S=yo.createLabelsFromArrayValues(k,"output")),!(w instanceof Array))throw new Error("inputLabels must be an array");if(!(S instanceof Array))throw new Error("outputLabels must be an array");var De=this.searchAndFormat(E),Ce=yo.formatDataAsObject(De,w),Xe=yo.formatDataAsObject(k,S);this.neuralNetworkData.addData(Ce,Xe)}},{key:"loadDataFromUrl",value:function(E,k){return at(this.loadDataInternal(E),k)}},{key:"loadDataInternal",value:function(){var E=K()(ke.a.mark(function k(w){var S,z,Y,ce;return ke.a.wrap(function(ve){for(;;)switch(ve.prev=ve.next){case 0:return S=w.dataUrl,z=w.inputs,Y=w.outputs,ve.next=3,this.neuralNetworkData.loadDataFromUrl(S,z,Y);case 3:ce=ve.sent,this.createMetadata(ce),this.prepareForTraining(ce);case 6:case"end":return ve.stop()}},k,this)}));return function(k){return E.apply(this,arguments)}}()},{key:"createMetaData",value:function(E){var k,w=this.options.inputs;Array.isArray(w)&&w.length>0&&(k=w.every(function(S){return typeof S=="number"})&&w.length>0?w:null),this.neuralNetworkData.createMetadata(E,k)}},{key:"prepareForTraining",value:function(){var E=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,k=E===null?this.neuralNetworkData.data.raw:E,w=this.neuralNetworkData.applyOneHotEncodingsToDataRaw(k);return this.data.training=w,this.neuralNetworkData.isWarmedUp=!0,w}},{key:"normalizeData",value:function(){var E=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,k=E===null?this.neuralNetworkData.data.raw:E;this.neuralNetworkData.isMetadataReady||this.createMetaData(k),this.neuralNetworkData.isWarmedUp||this.prepareForTraining(k);var w=this.neuralNetworkData.normalizeDataRaw(k);return this.data.training=w,this.neuralNetworkData.meta.isNormalized=!0,w}},{key:"normalizeInput",value:function(E,k,w){var S=w[k],z=S.min,Y=S.max;return yo.normalizeValue(E,z,Y)}},{key:"searchAndFormat",value:function(E){var k,w=this;if(Array.isArray(E))k=E.map(function(z){return w.formatInputItem(z)});else if(we()(E)==="object"){var S=Object.assign({},E);Object.keys(E).forEach(function(z){var Y=E[z];S[z]=w.formatInputItem(Y)}),k=S}return k}},{key:"formatInputItem",value:function(E){var k;return Dn(E)?k=E:we()(E)==="object"&&Dn(E.elt)?k=E.elt:we()(E)==="object"&&Dn(E.canvas)&&(k=E.canvas),k?mr(k):E}},{key:"convertTrainingDataToTensors",value:function(){var E=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,k=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,w=E===null?this.data.training:E,S=k===null?this.neuralNetworkData.meta:k;return this.neuralNetworkData.convertRawToTensors(w,S)}},{key:"formatInputsForPrediction",value:function(E,k,w){var S=this,z=[];return E instanceof Array?z=w.map(function(Y,ce){return S.isOneHotEncodedOrNormalized(E[ce],Y,k.inputs)}):E instanceof Object&&(z=w.map(function(Y){return S.isOneHotEncodedOrNormalized(E[Y],Y,k.inputs)})),z=z.flat()}},{key:"formatInputsForPredictionAll",value:function(E,k,w){var S,z=this;return E instanceof Array&&E.every(function(Y){return Array.isArray(Y)})?(S=E.map(function(Y){return z.formatInputsForPrediction(Y,k,w)}),F.tensor(S,[E.length,w.length])):(S=this.formatInputsForPrediction(E,k,w),F.tensor([S]))}},{key:"isOneHotEncodedOrNormalized",value:function(E,k,w){var S,z=E,Y=k;return typeof E!="number"?S=w[Y].legend[z]:(S=E,this.neuralNetworkData.meta.isNormalized&&(S=this.normalizeInput(E,Y,w))),S}},{key:"train",value:function(E,k,w){var S,z,Y;we()(E)==="object"&&typeof k=="function"&&typeof w=="function"?(S=E,z=k,Y=w):we()(E)==="object"&&typeof k=="function"?(S=E,z=null,Y=k):typeof E=="function"&&typeof k=="function"?(S={},z=E,Y=k):(S={},z=null,Y=E),this.trainInternal(S,z,Y)}},{key:"trainInternal",value:function(E,k,w){var S=Ff({epochs:10,batchSize:32,validationSplit:.1,whileTraining:null},E);if(this.options.debug===!0||this.options.debug==="true"?S.whileTraining=[this.neuralNetworkVis.trainingVis(),{onEpochEnd:k}]:S.whileTraining=[{onEpochEnd:k}],this.neuralNetworkData.isMetadataReady||this.createMetaData(this.neuralNetworkData.data.raw),this.neuralNetworkData.isWarmedUp||this.prepareForTraining(this.neuralNetworkData.data.raw),!S.inputs&&!S.outputs){var z=this.convertTrainingDataToTensors(),Y=z.inputs,ce=z.outputs;S.inputs=Y,S.outputs=ce}this.neuralNetwork.isLayered||(this.options.layers=this.createNetworkLayers(this.options.layers,this.neuralNetworkData.meta)),this.neuralNetwork.isLayered||(this.options.layers=this.addDefaultLayers(this.options.task,this.neuralNetworkData.meta)),this.neuralNetwork.isCompiled||this.compile(),this.neuralNetwork.train(S,w)}},{key:"addLayer",value:function(E){this.neuralNetwork.addLayer(E)}},{key:"createNetworkLayers",value:function(E,k){var w=this,S=Pa()(E),z=Object.assign({},k),Y=z.inputUnits,ce=z.outputUnits,ve=S.length;if(!(S.length>=2))return!1;S[0].inputShape=S[0].inputShape?S[0].inputShape:Y;var De=S[ve-1];return De.units=De.units?De.units:ce,S.forEach(function(Ce){w.addLayer(F.layers[Ce.type](Ce))}),S}},{key:"addDefaultLayers",value:function(E,k){var w;switch(E.toLowerCase()){case"classification":return w=[{type:"dense",units:this.options.hiddenUnits,activation:"relu"},{type:"dense",activation:"softmax"}],this.createNetworkLayers(w,k);case"regression":return w=[{type:"dense",units:this.options.hiddenUnits,activation:"relu"},{type:"dense",activation:"sigmoid"}],this.createNetworkLayers(w,k);case"imageclassification":return w=[{type:"conv2d",filters:8,kernelSize:5,strides:1,activation:"relu",kernelInitializer:"varianceScaling"},{type:"maxPooling2d",poolSize:[2,2],strides:[2,2]},{type:"conv2d",filters:16,kernelSize:5,strides:1,activation:"relu",kernelInitializer:"varianceScaling"},{type:"maxPooling2d",poolSize:[2,2],strides:[2,2]},{type:"flatten"},{type:"dense",kernelInitializer:"varianceScaling",activation:"softmax"}],this.createNetworkLayers(w,k);default:return console.log("no imputUnits or outputUnits defined"),w=[{type:"dense",units:this.options.hiddenUnits,activation:"relu"},{type:"dense",activation:"sigmoid"}],this.createNetworkLayers(w,k)}}},{key:"compile",value:function(){var E=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,k=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,w=k===null?this.options.learningRate:k,S={};E!==null?S=Ff({},E):this.options.task==="classification"||this.options.task==="imageClassification"?S={loss:"categoricalCrossentropy",optimizer:F.train.sgd,metrics:["accuracy"]}:this.options.task==="regression"&&(S={loss:"meanSquaredError",optimizer:F.train.adam,metrics:["accuracy"]}),S.optimizer=S.optimizer?this.neuralNetwork.setOptimizerFunction(w,S.optimizer):this.neuralNetwork.setOptimizerFunction(w,F.train.sgd),this.neuralNetwork.compile(S),this.options.debug&&this.neuralNetworkVis.modelSummary({name:"Model Summary"},this.neuralNetwork.model)}},{key:"predictSync",value:function(E){return this.predictSyncInternal(E)}},{key:"predict",value:function(E,k){return at(this.predictInternal(E),k)}},{key:"predictMultiple",value:function(E,k){return at(this.predictInternal(E),k)}},{key:"classifySync",value:function(E){return this.classifySyncInternal(E)}},{key:"classify",value:function(E,k){return at(this.classifyInternal(E),k)}},{key:"classifyMultiple",value:function(E,k){return at(this.classifyInternal(E),k)}},{key:"predictSyncInternal",value:function(E){var k=this.neuralNetworkData.meta,w=Object.keys(k.inputs),S=this.formatInputsForPredictionAll(E,k,w),z=this.neuralNetwork.predictSync(S);if(S.dispose(),k!==null){var Y=Object.keys(k.outputs),ce=z.map(function(ve){return Y.map(function(De,Ce){var Xe,tt,kt;if(k.isNormalized){var At=k.outputs[De],tn=At.min,sn=At.max;tt=yo.unnormalizeValue(ve[Ce],tn,sn),kt=ve[Ce]}else tt=ve[Ce];var wn=(Xe={},ee()(Xe,Y[Ce],tt),ee()(Xe,"label",De),ee()(Xe,"value",tt),Xe);return kt&&(wn.unNormalizedValue=kt),wn})});return ce.length<2?ce[0]:ce}return z}},{key:"predictInternal",value:function(){var E=K()(ke.a.mark(function k(w){var S,z,Y,ce,ve,De;return ke.a.wrap(function(Ce){for(;;)switch(Ce.prev=Ce.next){case 0:return S=this.neuralNetworkData.meta,z=Object.keys(S.inputs),Y=this.formatInputsForPredictionAll(w,S,z),Ce.next=5,this.neuralNetwork.predict(Y);case 5:if(ce=Ce.sent,Y.dispose(),S===null){Ce.next=13;break}if(ve=Object.keys(S.outputs),!((De=ce.map(function(Xe){return ve.map(function(tt,kt){var At,tn,sn;if(S.isNormalized){var wn=S.outputs[tt],En=wn.min,Tn=wn.max;tn=yo.unnormalizeValue(Xe[kt],En,Tn),sn=Xe[kt]}else tn=Xe[kt];var Pn=(At={},ee()(At,ve[kt],tn),ee()(At,"label",tt),ee()(At,"value",tn),At);return sn&&(Pn.unNormalizedValue=sn),Pn})})).length<2)){Ce.next=12;break}return Ce.abrupt("return",De[0]);case 12:return Ce.abrupt("return",De);case 13:return Ce.abrupt("return",ce);case 14:case"end":return Ce.stop()}},k,this)}));return function(k){return E.apply(this,arguments)}}()},{key:"classifySyncInternal",value:function(E){var k,w=this.neuralNetworkData.meta,S=Object.keys(w.inputs);if(this.options.task==="imageClassification"){if(k=this.searchAndFormat(E),k=Array.isArray(k)?k.flat():k[S[0]],w.isNormalized){var z=w.inputs[S[0]],Y=z.min,ce=z.max;k=this.neuralNetworkData.normalizeArray(Array.from(k),{min:Y,max:ce})}else k=Array.from(k);k=F.tensor([k],[1].concat(Pa()(w.inputUnits)))}else k=this.formatInputsForPredictionAll(E,w,S);var ve=this.neuralNetwork.classifySync(k);if(k.dispose(),w!==null){var De=Object.keys(w.outputs)[0],Ce=Object.entries(w.outputs[De].legend),Xe=ve.map(function(tt){return Ce.map(function(kt,At){var tn;return tn={},ee()(tn,kt[0],tt[At]),ee()(tn,"label",kt[0]),ee()(tn,"confidence",tt[At]),tn}).sort(function(kt,At){return At.confidence-kt.confidence})});return Xe.length<2?Xe[0]:Xe}return ve}},{key:"classifyInternal",value:function(){var E=K()(ke.a.mark(function k(w){var S,z,Y,ce,ve,De,Ce,Xe,tt,kt;return ke.a.wrap(function(At){for(;;)switch(At.prev=At.next){case 0:return S=this.neuralNetworkData.meta,z=Object.keys(S.inputs),this.options.task==="imageClassification"?(Y=this.searchAndFormat(w),Y=Array.isArray(Y)?Y.flat():Y[z[0]],S.isNormalized?(ce=S.inputs[z[0]],ve=ce.min,De=ce.max,Y=this.neuralNetworkData.normalizeArray(Array.from(Y),{min:ve,max:De})):Y=Array.from(Y),Y=F.tensor([Y],[1].concat(Pa()(S.inputUnits)))):Y=this.formatInputsForPredictionAll(w,S,z),At.next=5,this.neuralNetwork.classify(Y);case 5:if(Ce=At.sent,Y.dispose(),S===null){At.next=14;break}if(Xe=Object.keys(S.outputs)[0],tt=Object.entries(S.outputs[Xe].legend),!((kt=Ce.map(function(tn){return tt.map(function(sn,wn){var En;return En={},ee()(En,sn[0],tn[wn]),ee()(En,"label",sn[0]),ee()(En,"confidence",tn[wn]),En}).sort(function(sn,wn){return wn.confidence-sn.confidence})})).length<2)){At.next=13;break}return At.abrupt("return",kt[0]);case 13:return At.abrupt("return",kt);case 14:return At.abrupt("return",Ce);case 15:case"end":return At.stop()}},k,this)}));return function(k){return E.apply(this,arguments)}}()},{key:"saveData",value:function(E){this.neuralNetworkData.saveData(E)}},{key:"loadData",value:function(){var E=K()(ke.a.mark(function k(){var w,S,z=arguments;return ke.a.wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:w=z.length>0&&z[0]!==void 0?z[0]:null,S=z.length>1?z[1]:void 0,this.neuralNetworkData.loadData(w,S);case 3:case"end":return Y.stop()}},k,this)}));return function(){return E.apply(this,arguments)}}()},{key:"save",value:function(E,k){var w,S,z=this;typeof E=="function"?(w="model",S=E):typeof E=="string"?(w=E,typeof k=="function"&&(S=k)):w="model",this.neuralNetwork.save(w,function(){z.neuralNetworkData.saveMeta(w,S)})}},{key:"load",value:function(){var E=K()(ke.a.mark(function k(){var w,S,z,Y=this,ce=arguments;return ke.a.wrap(function(ve){for(;;)switch(ve.prev=ve.next){case 0:w=ce.length>0&&ce[0]!==void 0?ce[0]:null,(S=ce.length>1?ce[1]:void 0)&&(z=S),this.neuralNetwork.load(w,function(){return Y.neuralNetworkData.loadMeta(w,z),Y.neuralNetwork.model});case 4:case"end":return ve.stop()}},k,this)}));return function(){return E.apply(this,arguments)}}()},{key:"dispose",value:function(){this.neuralNetwork.dispose()}},{key:"mutate",value:function(E,k){this.neuralNetwork.mutate(E,k)}},{key:"crossover",value:function(E){var k=this.copy();return k.neuralNetwork.crossover(E.neuralNetwork),k}}]),I}(),Kd=function(I,E,k){var w,S;return I instanceof Object?(w=I,S=E):(w={inputs:I,outputs:E},S=k),new Gd(w,S)},en=o(3);function Ws(I,E,k){if(k===void 0&&(k=!1),I.beginPath(),E.slice(1).forEach(function(z,Y){var ce=z.x,ve=z.y,De=E[Y];I.moveTo(De.x,De.y),I.lineTo(ce,ve)}),k){var w=E[E.length-1],S=E[0];if(!w||!S)return;I.moveTo(w.x,w.y),I.lineTo(S.x,S.y)}I.stroke()}var Un=o(5),Os=function(){function I(E,k){if(!Vu(E)||!Vu(k))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:E,height:k}));this._width=E,this._height=k}return Object.defineProperty(I.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),I.prototype.reverse=function(){return new I(1/this.width,1/this.height)},I}();function na(I,E){return I instanceof en.Tensor&&I.shape.length===E}function Bl(I){return na(I,1)}function Rf(I){return na(I,2)}function nr(I){return na(I,3)}function Go(I){return na(I,4)}function bo(I){return I%1!=0}function Hi(I){return I%2==0}function ku(I,E){E===void 0&&(E=2);var k=Math.pow(10,E);return Math.floor(I*k)/k}function oc(I){return I&&I.width&&I.height}function Vs(I,E){var k=I.width,w=I.height,S=E/Math.max(w,k);return new Os(Math.round(k*S),Math.round(w*S))}function sc(I){return I.reduce(function(E,k){return E.add(k)},new oa(0,0)).div(new oa(I.length,I.length))}function Ka(I,E,k){return Array(I).fill(0).map(function(w,S){return E+S*k})}function Vu(I){return!!I&&I!==1/0&&I!==-1/0&&!isNaN(I)||I===0}function qs(I){return Vu(I)&&0<=I&&I<=1}var oa=function(){function I(E,k){this._x=E,this._y=k}return Object.defineProperty(I.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),I.prototype.add=function(E){return new I(this.x+E.x,this.y+E.y)},I.prototype.sub=function(E){return new I(this.x-E.x,this.y-E.y)},I.prototype.mul=function(E){return new I(this.x*E.x,this.y*E.y)},I.prototype.div=function(E){return new I(this.x/E.x,this.y/E.y)},I.prototype.abs=function(){return new I(Math.abs(this.x),Math.abs(this.y))},I.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},I.prototype.floor=function(){return new I(Math.floor(this.x),Math.floor(this.y))},I}(),cs=function(){function I(E,k){k===void 0&&(k=!0);var w=E||{},S=[w.left,w.top,w.right,w.bottom].every(Vu),z=[w.x,w.y,w.width,w.height].every(Vu);if(!z&&!S)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(w));var Y=z?[w.x,w.y,w.width,w.height]:[w.left,w.top,w.right-w.left,w.bottom-w.top],ce=Y[0],ve=Y[1],De=Y[2],Ce=Y[3];I.assertIsValidBox({x:ce,y:ve,width:De,height:Ce},"Box.constructor",k),this._x=ce,this._y=ve,this._width=De,this._height=Ce}return I.isRect=function(E){return!!E&&[E.x,E.y,E.width,E.height].every(Vu)},I.assertIsValidBox=function(E,k,w){if(w===void 0&&(w=!1),!I.isRect(E))throw new Error(k+" - invalid box: "+JSON.stringify(E)+", expected object with properties x, y, width, height");if(!w&&(E.width<0||E.height<0))throw new Error(k+" - width ("+E.width+") and height ("+E.height+") must be positive numbers")},Object.defineProperty(I.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"topLeft",{get:function(){return new oa(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"topRight",{get:function(){return new oa(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"bottomLeft",{get:function(){return new oa(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"bottomRight",{get:function(){return new oa(this.right,this.bottom)},enumerable:!0,configurable:!0}),I.prototype.round=function(){var E=[this.x,this.y,this.width,this.height].map(function(k){return Math.round(k)});return new I({x:E[0],y:E[1],width:E[2],height:E[3]})},I.prototype.floor=function(){var E=[this.x,this.y,this.width,this.height].map(function(k){return Math.floor(k)});return new I({x:E[0],y:E[1],width:E[2],height:E[3]})},I.prototype.toSquare=function(){var E=this.x,k=this.y,w=this.width,S=this.height,z=Math.abs(w-S);return w<S&&(E-=z/2,w+=z),S<w&&(k-=z/2,S+=z),new I({x:E,y:k,width:w,height:S})},I.prototype.rescale=function(E){var k=oc(E)?E.width:E,w=oc(E)?E.height:E;return new I({x:this.x*k,y:this.y*w,width:this.width*k,height:this.height*w})},I.prototype.pad=function(E,k){var w=[this.x-E/2,this.y-k/2,this.width+E,this.height+k];return new I({x:w[0],y:w[1],width:w[2],height:w[3]})},I.prototype.clipAtImageBorders=function(E,k){var w=this.x,S=this.y,z=this.right,Y=this.bottom,ce=Math.max(w,0),ve=Math.max(S,0),De=z-ce,Ce=Y-ve;return new I({x:ce,y:ve,width:Math.min(De,E-ce),height:Math.min(Ce,k-ve)}).floor()},I.prototype.shift=function(E,k){var w=this.width,S=this.height;return new I({x:this.x+E,y:this.y+k,width:w,height:S})},I.prototype.padAtBorders=function(E,k){var w=this.width+1,S=this.height+1,z=w,Y=S,ce=this.left,ve=this.top,De=this.right,Ce=this.bottom;return De>k&&(z=-De+k+w,De=k),Ce>E&&(Y=-Ce+E+S,Ce=E),ce<1&&(Y=2-ce,ce=1),ve<1&&(Y=2-ve,ve=1),{dy:1,edy:Y,dx:1,edx:z,y:ve,ey:Ce,x:ce,ex:De,w,h:S}},I.prototype.calibrate=function(E){return new I({left:this.left+E.left*this.width,top:this.top+E.top*this.height,right:this.right+E.right*this.width,bottom:this.bottom+E.bottom*this.height}).toSquare().round()},I}(),_o=function(I){function E(k,w,S,z,Y){return Y===void 0&&(Y=!1),I.call(this,{left:k,top:w,right:S,bottom:z},Y)||this}return Object(Un.c)(E,I),E}(cs),ls=function(){function I(E,k,w,S,z){this._imageDims=new Os(z.width,z.height),this._score=E,this._classScore=k,this._className=w,this._box=new cs(S).rescale(this._imageDims)}return Object.defineProperty(I.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"relativeBox",{get:function(){return new cs(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),I.prototype.forSize=function(E,k){return new I(this.score,this.classScore,this.className,this.relativeBox,{width:E,height:k})},I}(),Xa=function(I){function E(k,w,S){return I.call(this,k,k,"",w,S)||this}return Object(Un.c)(E,I),E.prototype.forSize=function(k,w){var S=I.prototype.forSize.call(this,k,w);return new E(S.score,S.relativeBox,S.imageDims)},E}(ls);function Hs(I,E,k){k===void 0&&(k=!0);var w=Math.max(0,Math.min(I.right,E.right)-Math.max(I.left,E.left))*Math.max(0,Math.min(I.bottom,E.bottom)-Math.max(I.top,E.top));return k?w/(I.area+E.area-w):w/Math.min(I.area,E.area)}function Eu(I){var E=I.map(function(ce){return ce.x}),k=I.map(function(ce){return ce.y}),w=E.reduce(function(ce,ve){return ve<ce?ve:ce},1/0),S=k.reduce(function(ce,ve){return ve<ce?ve:ce},1/0),z=E.reduce(function(ce,ve){return ce<ve?ve:ce},0),Y=k.reduce(function(ce,ve){return ce<ve?ve:ce},0);return new _o(w,S,z,Y)}function qu(I,E,k,w){w===void 0&&(w=!0);for(var S=E.map(function(ce,ve){return{score:ce,boxIndex:ve}}).sort(function(ce,ve){return ce.score-ve.score}).map(function(ce){return ce.boxIndex}),z=[],Y=function(){var ce=S.pop();z.push(ce);for(var ve=S,De=[],Ce=0;Ce<ve.length;Ce++){var Xe=ve[Ce],tt=I[ce],kt=I[Xe];De.push(Hs(tt,kt,w))}S=S.filter(function(At,tn){return De[tn]<=k})};S.length>0;)Y();return z}function uc(I,E){return en.tidy(function(){var k=E[0],w=E[1],S=E[2],z=en.fill(Object(Un.e)(I.shape.slice(0,3),[1]),k),Y=en.fill(Object(Un.e)(I.shape.slice(0,3),[1]),w),ce=en.fill(Object(Un.e)(I.shape.slice(0,3),[1]),S),ve=en.concat([z,Y,ce],3);return en.sub(I,ve)})}function Cu(I,E){return E===void 0&&(E=!1),en.tidy(function(){var k=I.shape.slice(1),w=k[0],S=k[1];if(w===S)return I;var z=Math.abs(w-S),Y=Math.round(z*(E?.5:1)),ce=w>S?2:1,ve=function(tt){var kt=I.shape.slice();return kt[ce]=tt,en.fill(kt,0)},De=ve(Y),Ce=z-De.shape[ce],Xe=[E&&Ce?ve(Ce):null,I,De].filter(function(tt){return!!tt}).map(function(tt){return tt.toFloat()});return en.concat(Xe,ce)})}function Jc(I){for(var E=I.slice(),k=E.length-1;k>0;k--){var w=Math.floor(Math.random()*(k+1)),S=E[k];E[k]=E[w],E[w]=S}return E}function Qc(I){return 1/(1+Math.exp(-I))}function Wh(I){return Math.log(I/(1-I))}var Zc=function(I){function E(k,w,S,z,Y){return Y===void 0&&(Y=!1),I.call(this,{x:k,y:w,width:S,height:z},Y)||this}return Object(Un.c)(E,I),E}(cs),$s=function(){function I(E,k,w){w===void 0&&(w=new oa(0,0));var S=k.width,z=k.height;this._imgDims=new Os(S,z),this._shift=w,this._positions=E.map(function(Y){return Y.mul(new oa(S,z)).add(w)})}return Object.defineProperty(I.prototype,"shift",{get:function(){return new oa(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"relativePositions",{get:function(){var E=this;return this._positions.map(function(k){return k.sub(E._shift).div(new oa(E.imageWidth,E.imageHeight))})},enumerable:!0,configurable:!0}),I.prototype.forSize=function(E,k){return new this.constructor(this.relativePositions,{width:E,height:k})},I.prototype.shiftBy=function(E,k){return new this.constructor(this.relativePositions,this._imgDims,new oa(E,k))},I.prototype.shiftByPoint=function(E){return this.shiftBy(E.x,E.y)},I.prototype.align=function(E,k){if(k===void 0&&(k={}),E){var w=E instanceof Xa?E.box.floor():new cs(E);return this.shiftBy(w.x,w.y).align(null,k)}var S=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},k),z=S.useDlibAlignment,Y=S.minBoxPadding;return z?this.alignDlib():this.alignMinBbox(Y)},I.prototype.alignDlib=function(){var E=this.getRefPointsForAlignment(),k=E[0],w=E[1],S=E[2],z=function(Xe){return S.sub(Xe).magnitude()},Y=(z(k)+z(w))/2,ce=Math.floor(Y/.45),ve=sc(E),De=Math.floor(Math.max(0,ve.x-.5*ce)),Ce=Math.floor(Math.max(0,ve.y-.43*ce));return new Zc(De,Ce,Math.min(ce,this.imageWidth+De),Math.min(ce,this.imageHeight+Ce))},I.prototype.alignMinBbox=function(E){var k=Eu(this.positions);return k.pad(k.width*E,k.height*E)},I.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},I}(),Ou=function(I){function E(){return I!==null&&I.apply(this,arguments)||this}return Object(Un.c)(E,I),E.prototype.getRefPointsForAlignment=function(){var k=this.positions;return[k[0],k[1],sc([k[3],k[4]])]},E}($s),Au=function(I){function E(){return I!==null&&I.apply(this,arguments)||this}return Object(Un.c)(E,I),E.prototype.getJawOutline=function(){return this.positions.slice(0,17)},E.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},E.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},E.prototype.getNose=function(){return this.positions.slice(27,36)},E.prototype.getLeftEye=function(){return this.positions.slice(36,42)},E.prototype.getRightEye=function(){return this.positions.slice(42,48)},E.prototype.getMouth=function(){return this.positions.slice(48,68)},E.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(sc)},E}($s),nu=function(){function I(E,k){this._label=E,this._distance=k}return Object.defineProperty(I.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),I.prototype.toString=function(E){return E===void 0&&(E=!0),this.label+(E?" ("+ku(this.distance)+")":"")},I}(),Vh=function(I){function E(k,w){var S=I.call(this,k)||this;return S._label=w,S}return Object(Un.c)(E,I),E.assertIsValidLabeledBox=function(k,w){if(cs.assertIsValidBox(k,w),!Vu(k.label))throw new Error(w+" - expected property label ("+k.label+") to be a number")},Object.defineProperty(E.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),E}(cs),Mf=function(){function I(E,k){if(typeof E!="string")throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(k)||k.some(function(w){return!(w instanceof Float32Array)}))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=E,this._descriptors=k}return Object.defineProperty(I.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),I.prototype.toJSON=function(){return{label:this.label,descriptors:this.descriptors.map(function(E){return Array.from(E)})}},I.fromJSON=function(E){var k=E.descriptors.map(function(w){return new Float32Array(w)});return new I(E.label,k)},I}(),jf=function(I){function E(k,w,S,z){var Y=I.call(this,k,w)||this;return Y._score=S,Y._classScore=z,Y}return Object(Un.c)(E,I),E.assertIsValidPredictedBox=function(k,w){if(Vh.assertIsValidLabeledBox(k,w),!qs(k.score)||!qs(k.classScore))throw new Error(w+" - expected properties score ("+k.score+") and ("+k.classScore+") to be a number between [0, 1]")},Object.defineProperty(E.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(E.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),E}(Vh);function Pl(I){return I.detection instanceof Xa}function Bf(I,E){var k={detection:E};return Object.assign({},I,k)}function Z(){var I=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D,Image:HTMLImageElement,ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:I,readFile:function(){throw new Error("readFile - filesystem not available for browser environment")}}}var G=o(131),C=o(178);function N(){return typeof window=="object"&&typeof document<"u"&&typeof HTMLImageElement<"u"&&typeof HTMLCanvasElement<"u"&&typeof HTMLVideoElement<"u"&&typeof ImageData<"u"&&typeof CanvasRenderingContext2D<"u"}var te,Be=o(177);function Ge(I){te=I}function ft(){N()&&Ge(Z()),Object(Be.a)()&&Ge(Object(C.a)())}var Nt,Ut={getEnv:function(){if(!te)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return te},setEnv:Ge,initialize:ft,createBrowserEnv:Z,createFileSystem:G.a,createNodejsEnv:C.a,monkeyPatch:function(I){if(te||ft(),!te)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var E=I.Canvas,k=E===void 0?te.Canvas:E,w=I.Image,S=w===void 0?te.Image:w;te.Canvas=k,te.Image=S,te.createCanvasElement=I.createCanvasElement||function(){return new k},te.createImageElement=I.createImageElement||function(){return new S},te.ImageData=I.ImageData||te.ImageData,te.Video=I.Video||te.Video,te.fetch=I.fetch||te.fetch,te.readFile=I.readFile||te.readFile},isBrowser:N,isNodejs:Be.a};function ct(I){return Ut.isNodejs()||typeof I!="string"?I:document.getElementById(I)}function yn(I){var E=Ut.getEnv(),k=E.Canvas;if(I instanceof E.CanvasRenderingContext2D)return I;var w=ct(I);if(!(w instanceof k))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var S=w.getContext("2d");if(!S)throw new Error("resolveContext2d - canvas 2d context is null");return S}ft(),function(I){I.TOP_LEFT="TOP_LEFT",I.TOP_RIGHT="TOP_RIGHT",I.BOTTOM_LEFT="BOTTOM_LEFT",I.BOTTOM_RIGHT="BOTTOM_RIGHT"}(Nt||(Nt={}));var _n=function(){return function(I){I===void 0&&(I={});var E=I.anchorPosition,k=I.backgroundColor,w=I.fontColor,S=I.fontSize,z=I.fontStyle,Y=I.padding;this.anchorPosition=E||Nt.TOP_LEFT,this.backgroundColor=k||"rgba(0, 0, 0, 0.5)",this.fontColor=w||"rgba(255, 255, 255, 1)",this.fontSize=S||14,this.fontStyle=z||"Georgia",this.padding=Y||4}}(),Nn=function(){function I(E,k,w){w===void 0&&(w={}),this.text=typeof E=="string"?[E]:E instanceof I?E.text:E,this.anchor=k,this.options=new _n(w)}return I.prototype.measureWidth=function(E){var k=this.options.padding;return this.text.map(function(w){return E.measureText(w).width}).reduce(function(w,S){return w<S?S:w},0)+2*k},I.prototype.measureHeight=function(){var E=this.options,k=E.fontSize,w=E.padding;return this.text.length*k+2*w},I.prototype.getUpperLeft=function(E,k){var w=this.options.anchorPosition,S=w===Nt.BOTTOM_RIGHT||w===Nt.TOP_RIGHT,z=w===Nt.BOTTOM_LEFT||w===Nt.BOTTOM_RIGHT,Y=this.measureWidth(E),ce=this.measureHeight(),ve=S?this.anchor.x-Y:this.anchor.x,De=z?this.anchor.y-ce:this.anchor.y;if(k){var Ce=k.width,Xe=k.height;return{x:Math.max(Math.min(ve,Ce-Y),0),y:Math.max(Math.min(De,Xe-ce),0)}}return{x:ve,y:De}},I.prototype.draw=function(E){var k=ct(E),w=yn(k),S=this.options,z=S.backgroundColor,Y=S.fontColor,ce=S.fontSize,ve=S.fontStyle,De=S.padding;w.font=ce+"px "+ve;var Ce=this.measureWidth(w),Xe=this.measureHeight();w.fillStyle=z;var tt=this.getUpperLeft(w,k);w.fillRect(tt.x,tt.y,Ce,Xe),w.fillStyle=Y,this.text.forEach(function(kt,At){var tn=De+tt.x,sn=De+tt.y+(At+1)*ce;w.fillText(kt,tn,sn)})},I}(),Wn=function(){return function(I){I===void 0&&(I={});var E=I.boxColor,k=I.lineWidth,w=I.label,S=I.drawLabelOptions;this.boxColor=E||"rgba(0, 0, 255, 1)",this.lineWidth=k||2,this.label=w;var z={anchorPosition:Nt.BOTTOM_LEFT,backgroundColor:this.boxColor};this.drawLabelOptions=new _n(Object.assign({},z,S))}}(),Mn=function(){function I(E,k){k===void 0&&(k={}),this.box=new cs(E),this.options=new Wn(k)}return I.prototype.draw=function(E){var k=yn(E),w=this.options,S=w.boxColor,z=w.lineWidth,Y=this.box,ce=Y.x,ve=Y.y,De=Y.width,Ce=Y.height;k.strokeStyle=S,k.lineWidth=z,k.strokeRect(ce,ve,De,Ce);var Xe=this.options.label;Xe&&new Nn([Xe],{x:ce-z/2,y:ve},this.options.drawLabelOptions).draw(E)},I}();function tr(I,E){(Array.isArray(E)?E:[E]).forEach(function(k){var w=k instanceof Xa?k.score:Pl(k)?k.detection.score:void 0,S=k instanceof Xa?k.box:Pl(k)?k.detection.box:new cs(k),z=w?""+ku(w):void 0;new Mn(S,{label:z}).draw(I)})}function rr(I){var E=Ut.getEnv(),k=E.Image,w=E.Video;return I instanceof k&&I.complete||I instanceof w&&I.readyState>=3}function hr(I){return new Promise(function(E,k){if(I instanceof Ut.getEnv().Canvas||rr(I))return E();function w(z){z.currentTarget&&(z.currentTarget.removeEventListener("load",w),z.currentTarget.removeEventListener("error",S),E(z))}function S(z){z.currentTarget&&(z.currentTarget.removeEventListener("load",w),z.currentTarget.removeEventListener("error",S),k(z))}I.addEventListener("load",w),I.addEventListener("error",S)})}function Nr(I){return new Promise(function(E,k){if(!(I instanceof Blob))return k("bufferToImage - expected buf to be of type: Blob");var w=new FileReader;w.onload=function(){if(typeof w.result!="string")return k("bufferToImage - expected reader.result to be a string, in onload");var S=Ut.getEnv().createImageElement();S.onload=function(){return E(S)},S.onerror=k,S.src=w.result},w.onerror=k,w.readAsDataURL(I)})}function Vr(I){var E=Ut.getEnv(),k=E.Image,w=E.Video;return I instanceof k?new Os(I.naturalWidth,I.naturalHeight):I instanceof w?new Os(I.videoWidth,I.videoHeight):new Os(I.width,I.height)}function wr(I){var E=I.width,k=I.height,w=(0,Ut.getEnv().createCanvasElement)();return w.width=E,w.height=k,w}function Hr(I,E){var k=Ut.getEnv().ImageData;if(!(I instanceof k||rr(I)))throw new Error("createCanvasFromMedia - media has not finished loading yet");var w=E||Vr(I),S=w.width,z=w.height,Y=wr({width:S,height:z});return I instanceof k?yn(Y).putImageData(I,0,0):yn(Y).drawImage(I,0,0,S,z),Y}function Wr(I,E){return Object(Un.b)(this,void 0,void 0,function(){var k,w,S,z,Y,ce;return Object(Un.d)(this,function(ve){switch(ve.label){case 0:return k=E||Ut.getEnv().createCanvasElement(),w=I.shape.slice(Go(I)?1:0),S=w[0],z=w[1],Y=w[2],ce=en.tidy(function(){return I.as3D(S,z,Y).toInt()}),[4,en.browser.toPixels(ce,k)];case 1:return ve.sent(),ce.dispose(),[2,k]}})})}function oi(I){var E=Ut.getEnv(),k=E.Image,w=E.Canvas,S=E.Video;return I instanceof k||I instanceof w||I instanceof S}function li(I,E,k){k===void 0&&(k=!1);var w=Ut.getEnv(),S=w.Image,z=w.Canvas;if(!(I instanceof S||I instanceof z))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var Y=Vr(I),ce=E/Math.max(Y.height,Y.width),ve=ce*Y.width,De=ce*Y.height,Ce=wr({width:E,height:E}),Xe=I instanceof z?I:Hr(I),tt=Math.abs(ve-De)/2,kt=k&&ve<De?tt:0,At=k&&De<ve?tt:0;return yn(Ce).drawImage(Xe,kt,At,ve,De),Ce}var $r=function(){function I(E,k){var w=this;if(k===void 0&&(k=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(E))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+E);this._treatAsBatchInput=k,this._batchSize=E.length,E.forEach(function(S,z){if(nr(S))return w._imageTensors[z]=S,void(w._inputDimensions[z]=S.shape);if(Go(S)){var Y=S.shape[0];if(Y!==1)throw new Error("NetInput - tf.Tensor4D with batchSize "+Y+" passed, but not supported in input array");return w._imageTensors[z]=S,void(w._inputDimensions[z]=S.shape.slice(1))}var ce=S instanceof Ut.getEnv().Canvas?S:Hr(S);w._canvases[z]=ce,w._inputDimensions[z]=[ce.height,ce.width,3]})}return Object.defineProperty(I.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"reshapedInputDimensions",{get:function(){var E=this;return Ka(this.batchSize,0,1).map(function(k,w){return E.getReshapedInputDimensions(w)})},enumerable:!0,configurable:!0}),I.prototype.getInput=function(E){return this.canvases[E]||this.imageTensors[E]},I.prototype.getInputDimensions=function(E){return this._inputDimensions[E]},I.prototype.getInputHeight=function(E){return this._inputDimensions[E][0]},I.prototype.getInputWidth=function(E){return this._inputDimensions[E][1]},I.prototype.getReshapedInputDimensions=function(E){if(typeof this.inputSize!="number")throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");return Vs({width:this.getInputWidth(E),height:this.getInputHeight(E)},this.inputSize)},I.prototype.toBatchTensor=function(E,k){var w=this;return k===void 0&&(k=!0),this._inputSize=E,en.tidy(function(){var S=Ka(w.batchSize,0,1).map(function(z){var Y=w.getInput(z);if(Y instanceof en.Tensor){var ce=Go(Y)?Y:Y.expandDims();return(ce=Cu(ce,k)).shape[1]===E&&ce.shape[2]===E||(ce=en.image.resizeBilinear(ce,[E,E])),ce.as3D(E,E,3)}if(Y instanceof Ut.getEnv().Canvas)return en.browser.fromPixels(li(Y,E,k));throw new Error("toBatchTensor - at batchIdx "+z+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+Y)});return en.stack(S.map(function(z){return z.toFloat()})).as4D(w.batchSize,E,E,3)})},I}();function Zr(I){return Object(Un.b)(this,void 0,void 0,function(){var E,k,w;return Object(Un.d)(this,function(S){switch(S.label){case 0:if(I instanceof $r)return[2,I];if(!(E=Array.isArray(I)?I:[I]).length)throw new Error("toNetInput - empty array passed as input");return k=function(z){return Array.isArray(I)?" at input index "+z+":":""},(w=E.map(ct)).forEach(function(z,Y){if(!oi(z)&&!nr(z)&&!Go(z))throw typeof E[Y]=="string"?new Error("toNetInput -"+k(Y)+" string passed, but could not resolve HTMLElement for element id "+E[Y]):new Error("toNetInput -"+k(Y)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id");if(Go(z)){var ce=z.shape[0];if(ce!==1)throw new Error("toNetInput -"+k(Y)+" tf.Tensor4D with batchSize "+ce+" passed, but not supported in input array")}}),[4,Promise.all(w.map(function(z){return oi(z)&&hr(z)}))];case 1:return S.sent(),[2,new $r(w,Array.isArray(I))]}})})}function pa(I,E){return Object(Un.b)(this,void 0,void 0,function(){var k,w,S,z,Y,ce;return Object(Un.d)(this,function(ve){switch(ve.label){case 0:return k=Ut.getEnv().Canvas,w=I,I instanceof k?[3,5]:[4,Zr(I)];case 1:if((S=ve.sent()).batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return(z=S.getInput(0))instanceof k?(Y=z,[3,4]):[3,2];case 2:return[4,Wr(z)];case 3:Y=ve.sent(),ve.label=4;case 4:w=Y,ve.label=5;case 5:return ce=yn(w),[2,E.map(function(De){return De instanceof Xa?De.forSize(w.width,w.height).box.floor():De}).map(function(De){return De.clipAtImageBorders(w.width,w.height)}).map(function(De){var Ce=De.x,Xe=De.y,tt=De.width,kt=De.height,At=wr({width:tt,height:kt});return yn(At).putImageData(ce.getImageData(Ce,Xe,tt,kt),0,0),At})]}})})}function ea(I,E){return Object(Un.b)(this,void 0,void 0,function(){return Object(Un.d)(this,function(k){if(!nr(I)&&!Go(I))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(Go(I)&&I.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,en.tidy(function(){var w=I.shape.slice(Go(I)?1:0),S=w[0],z=w[1],Y=w[2];return E.map(function(ce){return ce instanceof Xa?ce.forSize(z,S).box:ce}).map(function(ce){return ce.clipAtImageBorders(z,S)}).map(function(ce){var ve=ce.x,De=ce.y,Ce=ce.width,Xe=ce.height;return en.slice3d(I.as3D(S,z,Y),[De,ve,0],[Xe,Ce,Y])})})]})})}function La(I,E){return Object(Un.b)(this,void 0,void 0,function(){var k;return Object(Un.d)(this,function(w){switch(w.label){case 0:return[4,(0,Ut.getEnv().fetch)(I,E)];case 1:if(!((k=w.sent()).status<400))throw new Error("failed to fetch: ("+k.status+") "+k.statusText+", from url: "+k.url);return[2,k]}})})}function Ii(I){return Object(Un.b)(this,void 0,void 0,function(){var E,k;return Object(Un.d)(this,function(w){switch(w.label){case 0:return[4,La(I)];case 1:return[4,(E=w.sent()).blob()];case 2:if(!(k=w.sent()).type.startsWith("image/"))throw new Error("fetchImage - expected blob type to be of type image/*, instead have: "+k.type+", for url: "+E.url);return[2,Nr(k)]}})})}function ra(I){return Object(Un.b)(this,void 0,void 0,function(){return Object(Un.d)(this,function(E){switch(E.label){case 0:return[4,La(I)];case 1:return[2,E.sent().json()]}})})}function Ya(I){return Object(Un.b)(this,void 0,void 0,function(){var E;return Object(Un.d)(this,function(k){switch(k.label){case 0:return E=Float32Array.bind,[4,La(I)];case 1:return[4,k.sent().arrayBuffer()];case 2:return[2,new(E.apply(Float32Array,[void 0,k.sent()]))]}})})}function Sa(I,E){var k=E+"-weights_manifest.json";if(!I)return{modelBaseUri:"",manifestUri:k};if(I==="/")return{modelBaseUri:"/",manifestUri:"/"+k};var w=I.startsWith("http://")?"http://":I.startsWith("https://")?"https://":"",S=(I=I.replace(w,"")).split("/").filter(function(ce){return ce}),z=I.endsWith(".json")?S[S.length-1]:k,Y=w+(I.endsWith(".json")?S.slice(0,S.length-1):S).join("/");return{modelBaseUri:Y=I.startsWith("/")?"/"+Y:Y,manifestUri:Y==="/"?"/"+z:Y+"/"+z}}function xo(I,E){return Object(Un.b)(this,void 0,void 0,function(){var k,w,S,z;return Object(Un.d)(this,function(Y){switch(Y.label){case 0:return k=Sa(I,E),w=k.manifestUri,S=k.modelBaseUri,[4,ra(w)];case 1:return z=Y.sent(),[2,en.io.loadWeights(z,S)]}})})}function ki(I,E,k){k===void 0&&(k=!1);var w=k?Vr(E):E,S=w.width,z=w.height;return I.width=S,I.height=z,{width:S,height:z}}var Ui=function(){function I(E){this._name=E,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(I.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),I.prototype.getParamFromPath=function(E){var k=this.traversePropertyPath(E);return k.obj[k.objProp]},I.prototype.reassignParamFromPath=function(E,k){var w=this.traversePropertyPath(E),S=w.obj,z=w.objProp;S[z].dispose(),S[z]=k},I.prototype.getParamList=function(){var E=this;return this._paramMappings.map(function(k){var w=k.paramPath;return{path:w,tensor:E.getParamFromPath(w)}})},I.prototype.getTrainableParams=function(){return this.getParamList().filter(function(E){return E.tensor instanceof en.Variable})},I.prototype.getFrozenParams=function(){return this.getParamList().filter(function(E){return!(E.tensor instanceof en.Variable)})},I.prototype.variable=function(){var E=this;this.getFrozenParams().forEach(function(k){var w=k.path,S=k.tensor;E.reassignParamFromPath(w,S.variable())})},I.prototype.freeze=function(){var E=this;this.getTrainableParams().forEach(function(k){var w=k.path,S=k.tensor,z=en.tensor(S.dataSync());S.dispose(),E.reassignParamFromPath(w,z)})},I.prototype.dispose=function(E){E===void 0&&(E=!0),this.getParamList().forEach(function(k){if(E&&k.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+k.path);k.tensor.dispose()}),this._params=void 0},I.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map(function(E){var k=E.tensor;return Array.from(k.dataSync())}).reduce(function(E,k){return E.concat(k)}))},I.prototype.load=function(E){return Object(Un.b)(this,void 0,void 0,function(){return Object(Un.d)(this,function(k){switch(k.label){case 0:return E instanceof Float32Array?(this.extractWeights(E),[2]):[4,this.loadFromUri(E)];case 1:return k.sent(),[2]}})})},I.prototype.loadFromUri=function(E){return Object(Un.b)(this,void 0,void 0,function(){var k;return Object(Un.d)(this,function(w){switch(w.label){case 0:if(E&&typeof E!="string")throw new Error(this._name+".loadFromUri - expected model uri");return[4,xo(E,this.getDefaultModelName())];case 1:return k=w.sent(),this.loadFromWeightMap(k),[2]}})})},I.prototype.loadFromDisk=function(E){return Object(Un.b)(this,void 0,void 0,function(){var k,w,S,z,Y,ce,ve,De,Ce,Xe;return Object(Un.d)(this,function(tt){switch(tt.label){case 0:if(E&&typeof E!="string")throw new Error(this._name+".loadFromDisk - expected model file path");return k=Ut.getEnv().readFile,w=Sa(E,this.getDefaultModelName()),S=w.manifestUri,z=w.modelBaseUri,Y=function(kt){return Promise.all(kt.map(function(At){return k(At).then(function(tn){return tn.buffer})}))},ce=en.io.weightsLoaderFactory(Y),Ce=(De=JSON).parse,[4,k(S)];case 1:return ve=Ce.apply(De,[tt.sent().toString()]),[4,ce(ve,z)];case 2:return Xe=tt.sent(),this.loadFromWeightMap(Xe),[2]}})})},I.prototype.loadFromWeightMap=function(E){var k=this.extractParamsFromWeigthMap(E),w=k.paramMappings,S=k.params;this._paramMappings=w,this._params=S},I.prototype.extractWeights=function(E){var k=this.extractParams(E),w=k.paramMappings,S=k.params;this._paramMappings=w,this._params=S},I.prototype.traversePropertyPath=function(E){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var k=E.split("/").reduce(function(z,Y){if(!z.nextObj.hasOwnProperty(Y))throw new Error("traversePropertyPath - object does not have property "+Y+", for path "+E);return{obj:z.nextObj,objProp:Y,nextObj:z.nextObj[Y]}},{nextObj:this.params}),w=k.obj,S=k.objProp;if(!(w&&S&&w[S]instanceof en.Tensor))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+E);return{obj:w,objProp:S}},I}();function ha(I,E,k){return en.tidy(function(){var w=en.separableConv2d(I,E.depthwise_filter,E.pointwise_filter,k,"same");return w=en.add(w,E.bias)})}function to(I,E,k){return k===void 0&&(k=!1),en.tidy(function(){var w=en.relu(k?en.add(en.conv2d(I,E.conv0.filters,[2,2],"same"),E.conv0.bias):ha(I,E.conv0,[2,2])),S=ha(w,E.conv1,[1,1]),z=ha(en.relu(en.add(w,S)),E.conv2,[1,1]);return en.relu(en.add(w,en.add(S,z)))})}function Wo(I,E,k,w){return k===void 0&&(k=!1),w===void 0&&(w=!0),en.tidy(function(){var S=en.relu(k?en.add(en.conv2d(I,E.conv0.filters,w?[2,2]:[1,1],"same"),E.conv0.bias):ha(I,E.conv0,w?[2,2]:[1,1])),z=ha(S,E.conv1,[1,1]),Y=ha(en.relu(en.add(S,z)),E.conv2,[1,1]),ce=ha(en.relu(en.add(S,en.add(z,Y))),E.conv3,[1,1]);return en.relu(en.add(S,en.add(z,en.add(Y,ce))))})}function io(I,E,k,w){return k===void 0&&(k="same"),w===void 0&&(w=!1),en.tidy(function(){var S=en.add(en.conv2d(I,E.filters,[1,1],k),E.bias);return w?en.relu(S):S})}function Ja(I,E){Object.keys(I).forEach(function(k){E.some(function(w){return w.originalPath===k})||I[k].dispose()})}function fs(I,E){return function(k,w,S,z){var Y=en.tensor4d(I(k*w*S*S),[S,S,k,w]),ce=en.tensor1d(I(w));return E.push({paramPath:z+"/filters"},{paramPath:z+"/bias"}),{filters:Y,bias:ce}}}function fo(I,E){return function(k,w,S){var z=en.tensor2d(I(k*w),[k,w]),Y=en.tensor1d(I(w));return E.push({paramPath:S+"/weights"},{paramPath:S+"/bias"}),{weights:z,bias:Y}}}var va=function(){return function(I,E,k){this.depthwise_filter=I,this.pointwise_filter=E,this.bias=k}}();function ho(I,E){return function(k,w,S){var z=en.tensor4d(I(9*k),[3,3,k,1]),Y=en.tensor4d(I(k*w),[1,1,k,w]),ce=en.tensor1d(I(w));return E.push({paramPath:S+"/depthwise_filter"},{paramPath:S+"/pointwise_filter"},{paramPath:S+"/bias"}),new va(z,Y,ce)}}function cu(I){return function(E){var k=I(E+"/depthwise_filter",4),w=I(E+"/pointwise_filter",4),S=I(E+"/bias",1);return new va(k,w,S)}}function As(I,E){return function(k,w,S){var z=I[k];if(!na(z,w))throw new Error("expected weightMap["+k+"] to be a Tensor"+w+"D, instead have "+z);return E.push({originalPath:k,paramPath:S||k}),z}}function So(I){var E=I;return{extractWeights:function(k){var w=E.slice(0,k);return E=E.slice(k),w},getRemainingWeights:function(){return E}}}function Ma(I,E){var k=fs(I,E),w=ho(I,E);function S(z,Y,ce,ve){return ve===void 0&&(ve=!1),{conv0:ve?k(z,Y,3,ce+"/conv0"):w(z,Y,ce+"/conv0"),conv1:w(Y,Y,ce+"/conv1"),conv2:w(Y,Y,ce+"/conv2")}}return{extractDenseBlock3Params:S,extractDenseBlock4Params:function(z,Y,ce,ve){ve===void 0&&(ve=!1);var De=S(z,Y,ce,ve);return{conv0:De.conv0,conv1:De.conv1,conv2:De.conv2,conv3:w(Y,Y,ce+"/conv3")}}}}function cc(I){return function(E){return{filters:I(E+"/filters",4),bias:I(E+"/bias",1)}}}function Vo(I,E){var k=As(I,E),w=cc(k),S=cu(k);return{extractDenseBlock3Params:function(z,Y){return Y===void 0&&(Y=!1),{conv0:Y?w(z+"/conv0"):S(z+"/conv0"),conv1:S(z+"/conv1"),conv2:S(z+"/conv2")}},extractDenseBlock4Params:function(z,Y){return Y===void 0&&(Y=!1),{conv0:Y?w(z+"/conv0"):S(z+"/conv0"),conv1:S(z+"/conv1"),conv2:S(z+"/conv2"),conv3:S(z+"/conv3")}}}}var lu=function(I){function E(){return I.call(this,"FaceFeatureExtractor")||this}return Object(Un.c)(E,I),E.prototype.forwardInput=function(k){var w=this.params;if(!w)throw new Error("FaceFeatureExtractor - load model before inference");return en.tidy(function(){var S=Wo(uc(k.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(en.scalar(255)),w.dense0,!0);return S=Wo(S=Wo(S=Wo(S,w.dense1),w.dense2),w.dense3),S=en.avgPool(S,[7,7],[2,2],"valid")})},E.prototype.forward=function(k){return Object(Un.b)(this,void 0,void 0,function(){var w;return Object(Un.d)(this,function(S){switch(S.label){case 0:return w=this.forwardInput,[4,Zr(k)];case 1:return[2,w.apply(this,[S.sent()])]}})})},E.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},E.prototype.extractParamsFromWeigthMap=function(k){return function(w){var S=[],z=Vo(w,S).extractDenseBlock4Params,Y={dense0:z("dense0",!0),dense1:z("dense1"),dense2:z("dense2"),dense3:z("dense3")};return Ja(w,S),{params:Y,paramMappings:S}}(k)},E.prototype.extractParams=function(k){return function(w){var S=[],z=So(w),Y=z.extractWeights,ce=z.getRemainingWeights,ve=Ma(Y,S).extractDenseBlock4Params,De=ve(3,32,"dense0",!0),Ce=ve(32,64,"dense1"),Xe=ve(64,128,"dense2"),tt=ve(128,256,"dense3");if(ce().length!==0)throw new Error("weights remaing after extract: "+ce().length);return{paramMappings:S,params:{dense0:De,dense1:Ce,dense2:Xe,dense3:tt}}}(k)},E}(Ui);function ao(I,E){return en.tidy(function(){return en.add(en.matMul(I,E.weights),E.bias)})}function fu(I){var E={},k={};return Object.keys(I).forEach(function(w){(w.startsWith("fc")?k:E)[w]=I[w]}),{featureExtractorMap:E,classifierMap:k}}var Ia=function(I){function E(k,w){var S=I.call(this,k)||this;return S._faceFeatureExtractor=w,S}return Object(Un.c)(E,I),Object.defineProperty(E.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),E.prototype.runNet=function(k){var w=this,S=this.params;if(!S)throw new Error(this._name+" - load model before inference");return en.tidy(function(){var z=k instanceof $r?w.faceFeatureExtractor.forwardInput(k):k;return ao(z.as2D(z.shape[0],-1),S.fc)})},E.prototype.dispose=function(k){k===void 0&&(k=!0),this.faceFeatureExtractor.dispose(k),I.prototype.dispose.call(this,k)},E.prototype.loadClassifierParams=function(k){var w=this.extractClassifierParams(k),S=w.params,z=w.paramMappings;this._params=S,this._paramMappings=z},E.prototype.extractClassifierParams=function(k){return function(w,S,z){var Y=[],ce=So(w),ve=ce.extractWeights,De=ce.getRemainingWeights,Ce=fo(ve,Y)(S,z,"fc");if(De().length!==0)throw new Error("weights remaing after extract: "+De().length);return{paramMappings:Y,params:{fc:Ce}}}(k,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},E.prototype.extractParamsFromWeigthMap=function(k){var w=fu(k),S=w.featureExtractorMap,z=w.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(S),function(Y){var ce=[],ve=As(Y,ce),De={fc:function(Ce){return{weights:ve(Ce+"/weights",2),bias:ve(Ce+"/bias",1)}}("fc")};return Ja(Y,ce),{params:De,paramMappings:ce}}(z)},E.prototype.extractParams=function(k){var w=this.getClassifierChannelsIn(),S=this.getClassifierChannelsOut(),z=S*w+S,Y=k.slice(0,k.length-z),ce=k.slice(k.length-z);return this.faceFeatureExtractor.extractWeights(Y),this.extractClassifierParams(ce)},E}(Ui),_s=["neutral","happy","sad","angry","fearful","disgusted","surprised"],hs=function(){function I(E){var k=this;if(E.length!==7)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+E.length);_s.forEach(function(w,S){k[w]=E[S]})}return I.prototype.asSortedArray=function(){var E=this;return _s.map(function(k){return{expression:k,probability:E[k]}}).sort(function(k,w){return w.probability-k.probability})},I}(),ia=function(I){function E(k){return k===void 0&&(k=new lu),I.call(this,"FaceExpressionNet",k)||this}return Object(Un.c)(E,I),E.prototype.forwardInput=function(k){var w=this;return en.tidy(function(){return en.softmax(w.runNet(k))})},E.prototype.forward=function(k){return Object(Un.b)(this,void 0,void 0,function(){var w;return Object(Un.d)(this,function(S){switch(S.label){case 0:return w=this.forwardInput,[4,Zr(k)];case 1:return[2,w.apply(this,[S.sent()])]}})})},E.prototype.predictExpressions=function(k){return Object(Un.b)(this,void 0,void 0,function(){var w,S,z,Y,ce=this;return Object(Un.d)(this,function(ve){switch(ve.label){case 0:return[4,Zr(k)];case 1:return w=ve.sent(),[4,this.forwardInput(w)];case 2:return S=ve.sent(),[4,Promise.all(en.unstack(S).map(function(De){return Object(Un.b)(ce,void 0,void 0,function(){var Ce;return Object(Un.d)(this,function(Xe){switch(Xe.label){case 0:return[4,De.data()];case 1:return Ce=Xe.sent(),De.dispose(),[2,Ce]}})})}))];case 3:return z=ve.sent(),S.dispose(),Y=z.map(function(De){return new hs(De)}),[2,w.isBatchInput?Y:Y[0]]}})})},E.prototype.getDefaultModelName=function(){return"face_expression_model"},E.prototype.getClassifierChannelsIn=function(){return 256},E.prototype.getClassifierChannelsOut=function(){return 7},E}(Ia);function Ss(I){return I.expressions instanceof hs}function Ko(I,E){var k={expressions:E};return Object.assign({},I,k)}function Gs(I,E,k,w){k===void 0&&(k=.1),(Array.isArray(E)?E:[E]).forEach(function(S){var z=S instanceof hs?S:Ss(S)?S.expressions:void 0;if(!z)throw new Error("drawFaceExpressions - expected faceExpressions to be FaceExpressions | WithFaceExpressions<{}> or array thereof");var Y=z.asSortedArray().filter(function(ve){return ve.probability>k}),ce=Pl(S)?S.detection.box.bottomLeft:w||new oa(0,0);new Nn(Y.map(function(ve){return ve.expression+" ("+ku(ve.probability)+")"}),ce).draw(I)})}function _c(I){return Pl(I)&&I.landmarks instanceof $s&&I.unshiftedLandmarks instanceof $s&&I.alignedRect instanceof Xa}function za(I,E){var k=I.detection.box,w=E.shiftBy(k.x,k.y),S=w.align(),z=I.detection.imageDims,Y={landmarks:w,unshiftedLandmarks:E,alignedRect:new Xa(I.detection.score,S.rescale(z.reverse()),z)};return Object.assign({},I,Y)}var es=function(){return function(I){I===void 0&&(I={});var E=I.drawLines,k=E===void 0||E,w=I.drawPoints,S=w===void 0||w,z=I.lineWidth,Y=I.lineColor,ce=I.pointSize,ve=I.pointColor;this.drawLines=k,this.drawPoints=S,this.lineWidth=z||1,this.pointSize=ce||2,this.lineColor=Y||"rgba(0, 255, 255, 1)",this.pointColor=ve||"rgba(255, 0, 255, 1)"}}(),Mo=function(){function I(E,k){k===void 0&&(k={}),this.faceLandmarks=E,this.options=new es(k)}return I.prototype.draw=function(E){var k=yn(E),w=this.options,S=w.drawLines,z=w.drawPoints,Y=w.lineWidth,ce=w.lineColor,ve=w.pointSize,De=w.pointColor;S&&this.faceLandmarks instanceof Au&&(k.strokeStyle=ce,k.lineWidth=Y,Ws(k,this.faceLandmarks.getJawOutline()),Ws(k,this.faceLandmarks.getLeftEyeBrow()),Ws(k,this.faceLandmarks.getRightEyeBrow()),Ws(k,this.faceLandmarks.getNose()),Ws(k,this.faceLandmarks.getLeftEye(),!0),Ws(k,this.faceLandmarks.getRightEye(),!0),Ws(k,this.faceLandmarks.getMouth(),!0)),z&&(k.strokeStyle=De,k.fillStyle=De,this.faceLandmarks.positions.forEach(function(Ce){k.beginPath(),k.arc(Ce.x,Ce.y,ve,0,2*Math.PI),k.fill()}))},I}();function lc(I,E){(Array.isArray(E)?E:[E]).forEach(function(k){var w=k instanceof $s?k:_c(k)?k.landmarks:void 0;if(!w)throw new Error("drawFaceLandmarks - expected faceExpressions to be FaceLandmarks | WithFaceLandmarks<WithFaceDetection<{}>> or array thereof");new Mo(w).draw(I)})}function el(I,E){var k=[],w=So(I),S=w.extractWeights,z=w.getRemainingWeights,Y=function(At,tn){var sn=fs(At,tn),wn=ho(At,tn);return{extractConvParams:sn,extractSeparableConvParams:wn,extractReductionBlockParams:function(En,Tn,Pn){return{separable_conv0:wn(En,Tn,Pn+"/separable_conv0"),separable_conv1:wn(Tn,Tn,Pn+"/separable_conv1"),expansion_conv:sn(En,Tn,1,Pn+"/expansion_conv")}},extractMainBlockParams:function(En,Tn){return{separable_conv0:wn(En,En,Tn+"/separable_conv0"),separable_conv1:wn(En,En,Tn+"/separable_conv1"),separable_conv2:wn(En,En,Tn+"/separable_conv2")}}}}(S,k),ce=Y.extractConvParams,ve=Y.extractSeparableConvParams,De=Y.extractReductionBlockParams,Ce=Y.extractMainBlockParams,Xe={conv_in:ce(3,32,3,"entry_flow/conv_in"),reduction_block_0:De(32,64,"entry_flow/reduction_block_0"),reduction_block_1:De(64,128,"entry_flow/reduction_block_1")},tt={};Ka(E,0,1).forEach(function(At){tt["main_block_"+At]=Ce(128,"middle_flow/main_block_"+At)});var kt={reduction_block:De(128,256,"exit_flow/reduction_block"),separable_conv:ve(256,512,"exit_flow/separable_conv")};if(z().length!==0)throw new Error("weights remaing after extract: "+z().length);return{paramMappings:k,params:{entry_flow:Xe,middle_flow:tt,exit_flow:kt}}}function ci(I,E){var k=[],w=function(Xe,tt){var kt=As(Xe,tt),At=cc(kt),tn=cu(kt);return{extractConvParams:At,extractSeparableConvParams:tn,extractReductionBlockParams:function(sn){return{separable_conv0:tn(sn+"/separable_conv0"),separable_conv1:tn(sn+"/separable_conv1"),expansion_conv:At(sn+"/expansion_conv")}},extractMainBlockParams:function(sn){return{separable_conv0:tn(sn+"/separable_conv0"),separable_conv1:tn(sn+"/separable_conv1"),separable_conv2:tn(sn+"/separable_conv2")}}}}(I,k),S=w.extractConvParams,z=w.extractSeparableConvParams,Y=w.extractReductionBlockParams,ce=w.extractMainBlockParams,ve={conv_in:S("entry_flow/conv_in"),reduction_block_0:Y("entry_flow/reduction_block_0"),reduction_block_1:Y("entry_flow/reduction_block_1")},De={};Ka(E,0,1).forEach(function(Xe){De["main_block_"+Xe]=ce("middle_flow/main_block_"+Xe)});var Ce={reduction_block:Y("exit_flow/reduction_block"),separable_conv:z("exit_flow/separable_conv")};return Ja(I,k),{params:{entry_flow:ve,middle_flow:De,exit_flow:Ce},paramMappings:k}}function Xd(I,E,k){return en.add(en.conv2d(I,E.filters,k,"same"),E.bias)}function tl(I,E,k){k===void 0&&(k=!0);var w=k?en.relu(I):I;return w=ha(w,E.separable_conv0,[1,1]),w=ha(en.relu(w),E.separable_conv1,[1,1]),w=en.maxPool(w,[3,3],[2,2],"same"),w=en.add(w,Xd(I,E.expansion_conv,[2,2]))}var Ll,vg=function(I){function E(k){var w=I.call(this,"TinyXception")||this;return w._numMainBlocks=k,w}return Object(Un.c)(E,I),E.prototype.forwardInput=function(k){var w=this,S=this.params;if(!S)throw new Error("TinyXception - load model before inference");return en.tidy(function(){var z=uc(k.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(en.scalar(256)),Y=en.relu(Xd(z,S.entry_flow.conv_in,[2,2]));return Y=tl(Y=tl(Y,S.entry_flow.reduction_block_0,!1),S.entry_flow.reduction_block_1),Ka(w._numMainBlocks,0,1).forEach(function(ce){Y=function(ve,De){var Ce=ha(en.relu(ve),De.separable_conv0,[1,1]);return Ce=ha(en.relu(Ce),De.separable_conv1,[1,1]),Ce=ha(en.relu(Ce),De.separable_conv2,[1,1]),Ce=en.add(Ce,ve)}(Y,S.middle_flow["main_block_"+ce])}),Y=tl(Y,S.exit_flow.reduction_block),Y=en.relu(ha(Y,S.exit_flow.separable_conv,[1,1]))})},E.prototype.forward=function(k){return Object(Un.b)(this,void 0,void 0,function(){var w;return Object(Un.d)(this,function(S){switch(S.label){case 0:return w=this.forwardInput,[4,Zr(k)];case 1:return[2,w.apply(this,[S.sent()])]}})})},E.prototype.getDefaultModelName=function(){return"tiny_xception_model"},E.prototype.extractParamsFromWeigthMap=function(k){return ci(k,this._numMainBlocks)},E.prototype.extractParams=function(k){return el(k,this._numMainBlocks)},E}(Ui);(function(I){I.FEMALE="female",I.MALE="male"})(Ll||(Ll={}));var yg=function(I){function E(k){k===void 0&&(k=new vg(2));var w=I.call(this,"AgeGenderNet")||this;return w._faceFeatureExtractor=k,w}return Object(Un.c)(E,I),Object.defineProperty(E.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),E.prototype.runNet=function(k){var w=this,S=this.params;if(!S)throw new Error(this._name+" - load model before inference");return en.tidy(function(){var z=k instanceof $r?w.faceFeatureExtractor.forwardInput(k):k,Y=en.avgPool(z,[7,7],[2,2],"valid").as2D(z.shape[0],-1);return{age:ao(Y,S.fc.age).as1D(),gender:ao(Y,S.fc.gender)}})},E.prototype.forwardInput=function(k){var w=this;return en.tidy(function(){var S=w.runNet(k),z=S.age,Y=S.gender;return{age:z,gender:en.softmax(Y)}})},E.prototype.forward=function(k){return Object(Un.b)(this,void 0,void 0,function(){var w;return Object(Un.d)(this,function(S){switch(S.label){case 0:return w=this.forwardInput,[4,Zr(k)];case 1:return[2,w.apply(this,[S.sent()])]}})})},E.prototype.predictAgeAndGender=function(k){return Object(Un.b)(this,void 0,void 0,function(){var w,S,z,Y,ce,ve,De=this;return Object(Un.d)(this,function(Ce){switch(Ce.label){case 0:return[4,Zr(k)];case 1:return w=Ce.sent(),[4,this.forwardInput(w)];case 2:return S=Ce.sent(),z=en.unstack(S.age),Y=en.unstack(S.gender),ce=z.map(function(Xe,tt){return{ageTensor:Xe,genderTensor:Y[tt]}}),[4,Promise.all(ce.map(function(Xe){var tt=Xe.ageTensor,kt=Xe.genderTensor;return Object(Un.b)(De,void 0,void 0,function(){var At,tn,sn,wn,En;return Object(Un.d)(this,function(Tn){switch(Tn.label){case 0:return[4,tt.data()];case 1:return At=Tn.sent()[0],[4,kt.data()];case 2:return tn=Tn.sent()[0],wn=(sn=tn>.5)?Ll.MALE:Ll.FEMALE,En=sn?tn:1-tn,tt.dispose(),kt.dispose(),[2,{age:At,gender:wn,genderProbability:En}]}})})}))];case 3:return ve=Ce.sent(),S.age.dispose(),S.gender.dispose(),[2,w.isBatchInput?ve:ve[0]]}})})},E.prototype.getDefaultModelName=function(){return"age_gender_model"},E.prototype.dispose=function(k){k===void 0&&(k=!0),this.faceFeatureExtractor.dispose(k),I.prototype.dispose.call(this,k)},E.prototype.loadClassifierParams=function(k){var w=this.extractClassifierParams(k),S=w.params,z=w.paramMappings;this._params=S,this._paramMappings=z},E.prototype.extractClassifierParams=function(k){return function(w){var S=[],z=So(w),Y=z.extractWeights,ce=z.getRemainingWeights,ve=fo(Y,S),De=ve(512,1,"fc/age"),Ce=ve(512,2,"fc/gender");if(ce().length!==0)throw new Error("weights remaing after extract: "+ce().length);return{paramMappings:S,params:{fc:{age:De,gender:Ce}}}}(k)},E.prototype.extractParamsFromWeigthMap=function(k){var w=fu(k),S=w.featureExtractorMap,z=w.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(S),function(Y){var ce=[],ve=As(Y,ce);function De(Xe){return{weights:ve(Xe+"/weights",2),bias:ve(Xe+"/bias",1)}}var Ce={fc:{age:De("fc/age"),gender:De("fc/gender")}};return Ja(Y,ce),{params:Ce,paramMappings:ce}}(z)},E.prototype.extractParams=function(k){var w=k.slice(0,k.length-1539),S=k.slice(k.length-1539);return this.faceFeatureExtractor.extractWeights(w),this.extractClassifierParams(S)},E}(Ui),Cm=function(I){function E(){return I!==null&&I.apply(this,arguments)||this}return Object(Un.c)(E,I),E.prototype.postProcess=function(k,w,S){var z=S.map(function(ce){var ve=ce.width,De=ce.height,Ce=w/Math.max(De,ve);return{width:ve*Ce,height:De*Ce}}),Y=z.length;return en.tidy(function(){var ce=function(De,Ce){return en.stack([en.fill([68],De),en.fill([68],Ce)],1).as2D(1,136).as1D()},ve=function(De,Ce){var Xe=z[De],tt=Xe.width,kt=Xe.height;return Ce(tt,kt)?Math.abs(tt-kt)/2:0};return k.mul(en.fill([Y,136],w)).sub(en.stack(Array.from(Array(Y),function(De,Ce){return ce(function(Xe){return ve(Xe,function(tt,kt){return tt<kt})}(Ce),function(Xe){return ve(Xe,function(tt,kt){return kt<tt})}(Ce))}))).div(en.stack(Array.from(Array(Y),function(De,Ce){return ce(z[Ce].width,z[Ce].height)})))})},E.prototype.forwardInput=function(k){var w=this;return en.tidy(function(){var S=w.runNet(k);return w.postProcess(S,k.inputSize,k.inputDimensions.map(function(z){return{height:z[0],width:z[1]}}))})},E.prototype.forward=function(k){return Object(Un.b)(this,void 0,void 0,function(){var w;return Object(Un.d)(this,function(S){switch(S.label){case 0:return w=this.forwardInput,[4,Zr(k)];case 1:return[2,w.apply(this,[S.sent()])]}})})},E.prototype.detectLandmarks=function(k){return Object(Un.b)(this,void 0,void 0,function(){var w,S,z,Y=this;return Object(Un.d)(this,function(ce){switch(ce.label){case 0:return[4,Zr(k)];case 1:return w=ce.sent(),S=en.tidy(function(){return en.unstack(Y.forwardInput(w))}),[4,Promise.all(S.map(function(ve,De){return Object(Un.b)(Y,void 0,void 0,function(){var Ce,Xe,tt,kt,At;return Object(Un.d)(this,function(tn){switch(tn.label){case 0:return tt=(Xe=Array).from,[4,ve.data()];case 1:return Ce=tt.apply(Xe,[tn.sent()]),kt=Ce.filter(function(sn,wn){return Hi(wn)}),At=Ce.filter(function(sn,wn){return!Hi(wn)}),[2,new Au(Array(68).fill(0).map(function(sn,wn){return new oa(kt[wn],At[wn])}),{height:w.getInputHeight(De),width:w.getInputWidth(De)})]}})})}))];case 2:return z=ce.sent(),S.forEach(function(ve){return ve.dispose()}),[2,w.isBatchInput?z:z[0]]}})})},E.prototype.getClassifierChannelsOut=function(){return 136},E}(Ia),Om=function(I){function E(k){return k===void 0&&(k=new lu),I.call(this,"FaceLandmark68Net",k)||this}return Object(Un.c)(E,I),E.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},E.prototype.getClassifierChannelsIn=function(){return 256},E}(Cm),bg=function(I){function E(){return I.call(this,"TinyFaceFeatureExtractor")||this}return Object(Un.c)(E,I),E.prototype.forwardInput=function(k){var w=this.params;if(!w)throw new Error("TinyFaceFeatureExtractor - load model before inference");return en.tidy(function(){var S=to(uc(k.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(en.scalar(255)),w.dense0,!0);return S=to(S=to(S,w.dense1),w.dense2),S=en.avgPool(S,[14,14],[2,2],"valid")})},E.prototype.forward=function(k){return Object(Un.b)(this,void 0,void 0,function(){var w;return Object(Un.d)(this,function(S){switch(S.label){case 0:return w=this.forwardInput,[4,Zr(k)];case 1:return[2,w.apply(this,[S.sent()])]}})})},E.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},E.prototype.extractParamsFromWeigthMap=function(k){return function(w){var S=[],z=Vo(w,S).extractDenseBlock3Params,Y={dense0:z("dense0",!0),dense1:z("dense1"),dense2:z("dense2")};return Ja(w,S),{params:Y,paramMappings:S}}(k)},E.prototype.extractParams=function(k){return function(w){var S=[],z=So(w),Y=z.extractWeights,ce=z.getRemainingWeights,ve=Ma(Y,S).extractDenseBlock3Params,De=ve(3,32,"dense0",!0),Ce=ve(32,64,"dense1"),Xe=ve(64,128,"dense2");if(ce().length!==0)throw new Error("weights remaing after extract: "+ce().length);return{paramMappings:S,params:{dense0:De,dense1:Ce,dense2:Xe}}}(k)},E}(Ui),Am=function(I){function E(k){return k===void 0&&(k=new bg),I.call(this,"FaceLandmark68TinyNet",k)||this}return Object(Un.c)(E,I),E.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},E.prototype.getClassifierChannelsIn=function(){return 128},E}(Cm),xg=function(I){function E(){return I!==null&&I.apply(this,arguments)||this}return Object(Un.c)(E,I),E}(Om);function Pf(I,E,k,w,S){S===void 0&&(S="same");var z=E.conv,Y=z.filters,ce=z.bias,ve=en.conv2d(I,Y,k,S);return ve=function(De,Ce){return en.add(en.mul(De,Ce.weights),Ce.biases)}(ve=en.add(ve,ce),E.scale),w?en.relu(ve):ve}function Yd(I,E){return Pf(I,E,[1,1],!1)}function wg(I,E){return Pf(I,E,[2,2],!0,"valid")}function kg(I,E){function k(S,z,Y,ce){var ve=function(Ce,Xe,tt){var kt=I(Ce),At=kt.length/(Xe*tt*tt);if(bo(At))throw new Error("depth has to be an integer: "+At+", weights.length: "+kt.length+", numFilters: "+Xe+", filterSize: "+tt);return en.tidy(function(){return en.transpose(en.tensor4d(kt,[Xe,At,tt,tt]),[2,3,1,0])})}(S,z,Y),De=en.tensor1d(I(z));return E.push({paramPath:ce+"/filters"},{paramPath:ce+"/bias"}),{filters:ve,bias:De}}function w(S,z,Y,ce){return{conv:k(S,z,Y,ce+"/conv"),scale:function(ve,De){var Ce=en.tensor1d(I(ve)),Xe=en.tensor1d(I(ve));return E.push({paramPath:De+"/weights"},{paramPath:De+"/biases"}),{weights:Ce,biases:Xe}}(z,ce+"/scale")}}return{extractConvLayerParams:w,extractResidualLayerParams:function(S,z,Y,ce,ve){return ve===void 0&&(ve=!1),{conv1:w((ve?.5:1)*S,z,Y,ce+"/conv1"),conv2:w(S,z,Y,ce+"/conv2")}}}}function Eg(I,E){var k=As(I,E);function w(S){return{conv:{filters:k(S+"/conv/filters",4),bias:k(S+"/conv/bias",1)},scale:function(z){return{weights:k(z+"/scale/weights",1),biases:k(z+"/scale/biases",1)}}(S)}}return{extractConvLayerParams:w,extractResidualLayerParams:function(S){return{conv1:w(S+"/conv1"),conv2:w(S+"/conv2")}}}}function Sc(I,E){var k=function(w,S){return Pf(w,S,[1,1],!0)}(I,E.conv1);return k=Yd(k,E.conv2),k=en.add(k,I),k=en.relu(k)}function Lf(I,E){var k=wg(I,E.conv1);k=Yd(k,E.conv2);var w=en.avgPool(I,2,2,"valid"),S=en.zeros(w.shape),z=w.shape[3]!==k.shape[3];if(w.shape[1]!==k.shape[1]||w.shape[2]!==k.shape[2]){var Y=Object(Un.e)(k.shape);Y[1]=1;var ce=en.zeros(Y);k=en.concat([k,ce],1);var ve=Object(Un.e)(k.shape);ve[2]=1;var De=en.zeros(ve);k=en.concat([k,De],2)}return w=z?en.concat([w,S],3):w,k=en.add(w,k),k=en.relu(k)}var Jd=function(I){function E(){return I.call(this,"FaceRecognitionNet")||this}return Object(Un.c)(E,I),E.prototype.forwardInput=function(k){var w=this.params;if(!w)throw new Error("FaceRecognitionNet - load model before inference");return en.tidy(function(){var S=wg(uc(k.toBatchTensor(150,!0).toFloat(),[122.782,117.001,104.298]).div(en.scalar(256)),w.conv32_down),z=(S=Lf(S=Sc(S=Sc(S=Lf(S=Sc(S=Sc(S=Lf(S=Sc(S=Sc(S=Sc(S=Lf(S=Sc(S=Sc(S=Sc(S=en.maxPool(S,3,2,"valid"),w.conv32_1),w.conv32_2),w.conv32_3),w.conv64_down),w.conv64_1),w.conv64_2),w.conv64_3),w.conv128_down),w.conv128_1),w.conv128_2),w.conv256_down),w.conv256_1),w.conv256_2),w.conv256_down_out)).mean([1,2]);return en.matMul(z,w.fc)})},E.prototype.forward=function(k){return Object(Un.b)(this,void 0,void 0,function(){var w;return Object(Un.d)(this,function(S){switch(S.label){case 0:return w=this.forwardInput,[4,Zr(k)];case 1:return[2,w.apply(this,[S.sent()])]}})})},E.prototype.computeFaceDescriptor=function(k){return Object(Un.b)(this,void 0,void 0,function(){var w,S,z,Y=this;return Object(Un.d)(this,function(ce){switch(ce.label){case 0:return[4,Zr(k)];case 1:return w=ce.sent(),S=en.tidy(function(){return en.unstack(Y.forwardInput(w))}),[4,Promise.all(S.map(function(ve){return ve.data()}))];case 2:return z=ce.sent(),S.forEach(function(ve){return ve.dispose()}),[2,w.isBatchInput?z:z[0]]}})})},E.prototype.getDefaultModelName=function(){return"face_recognition_model"},E.prototype.extractParamsFromWeigthMap=function(k){return function(w){var S=[],z=Eg(w,S),Y=z.extractConvLayerParams,ce=z.extractResidualLayerParams,ve=Y("conv32_down"),De=ce("conv32_1"),Ce=ce("conv32_2"),Xe=ce("conv32_3"),tt=ce("conv64_down"),kt=ce("conv64_1"),At=ce("conv64_2"),tn=ce("conv64_3"),sn=ce("conv128_down"),wn=ce("conv128_1"),En=ce("conv128_2"),Tn=ce("conv256_down"),Pn=ce("conv256_1"),dn=ce("conv256_2"),cr=ce("conv256_down_out"),kr=w.fc;if(S.push({originalPath:"fc",paramPath:"fc"}),!Rf(kr))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+kr);var yr={conv32_down:ve,conv32_1:De,conv32_2:Ce,conv32_3:Xe,conv64_down:tt,conv64_1:kt,conv64_2:At,conv64_3:tn,conv128_down:sn,conv128_1:wn,conv128_2:En,conv256_down:Tn,conv256_1:Pn,conv256_2:dn,conv256_down_out:cr,fc:kr};return Ja(w,S),{params:yr,paramMappings:S}}(k)},E.prototype.extractParams=function(k){return function(w){var S=So(w),z=S.extractWeights,Y=S.getRemainingWeights,ce=[],ve=kg(z,ce),De=ve.extractConvLayerParams,Ce=ve.extractResidualLayerParams,Xe=De(4704,32,7,"conv32_down"),tt=Ce(9216,32,3,"conv32_1"),kt=Ce(9216,32,3,"conv32_2"),At=Ce(9216,32,3,"conv32_3"),tn=Ce(36864,64,3,"conv64_down",!0),sn=Ce(36864,64,3,"conv64_1"),wn=Ce(36864,64,3,"conv64_2"),En=Ce(36864,64,3,"conv64_3"),Tn=Ce(147456,128,3,"conv128_down",!0),Pn=Ce(147456,128,3,"conv128_1"),dn=Ce(147456,128,3,"conv128_2"),cr=Ce(589824,256,3,"conv256_down",!0),kr=Ce(589824,256,3,"conv256_1"),yr=Ce(589824,256,3,"conv256_2"),Br=Ce(589824,256,3,"conv256_down_out"),_r=en.tidy(function(){return en.transpose(en.tensor2d(z(32768),[128,256]),[1,0])});if(ce.push({paramPath:"fc"}),Y().length!==0)throw new Error("weights remaing after extract: "+Y().length);return{params:{conv32_down:Xe,conv32_1:tt,conv32_2:kt,conv32_3:At,conv64_down:tn,conv64_1:sn,conv64_2:wn,conv64_3:En,conv128_down:Tn,conv128_1:Pn,conv128_2:dn,conv256_down:cr,conv256_1:kr,conv256_2:yr,conv256_down_out:Br,fc:_r},paramMappings:ce}}(k)},E}(Ui);function _m(I){var E=new Jd;return E.extractWeights(I),E}function Sm(I,E){var k={descriptor:E};return Object.assign({},I,k)}function Tv(I){return typeof I.age=="number"}function Dm(I,E){var k={age:E};return Object.assign({},I,k)}function qh(I){return(I.gender===Ll.MALE||I.gender===Ll.FEMALE)&&qs(I.genderProbability)}function zf(I,E,k){var w={gender:E,genderProbability:k};return Object.assign({},I,w)}var Dc=function(){function I(E){var k=E===void 0?{}:E,w=k.minFaceSize,S=k.scaleFactor,z=k.maxNumScales,Y=k.scoreThresholds,ce=k.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=w||20,this._scaleFactor=S||.709,this._maxNumScales=z||10,this._scoreThresholds=Y||[.6,.7,.7],this._scaleSteps=ce,typeof this._minFaceSize!="number"||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if(typeof this._scaleFactor!="number"||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if(typeof this._maxNumScales!="number"||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||this._scoreThresholds.length!==3||this._scoreThresholds.some(function(ve){return typeof ve!="number"}))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some(function(ve){return typeof ve!="number"})))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(I.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),I}();function Tm(I,E){function k(z,Y,ce,ve,De){var Ce=en.tensor4d(I(z*Y*ce*ce),[ce,ce,z,Y]),Xe=en.tensor1d(I(Y));return E.push({paramPath:ve+"/filters"},{paramPath:ve+"/"+(De?"batch_norm_offset":"bias")}),{filters:Ce,bias:Xe}}function w(z,Y,ce,ve){var De=k(z,Y,ce,ve,!0);return{filters:De.filters,batch_norm_offset:De.bias}}function S(z,Y,ce){return{depthwise_conv:function(ve,De){var Ce=en.tensor4d(I(9*ve),[3,3,ve,1]),Xe=en.tensor1d(I(ve)),tt=en.tensor1d(I(ve)),kt=en.tensor1d(I(ve)),At=en.tensor1d(I(ve));return E.push({paramPath:De+"/filters"},{paramPath:De+"/batch_norm_scale"},{paramPath:De+"/batch_norm_offset"},{paramPath:De+"/batch_norm_mean"},{paramPath:De+"/batch_norm_variance"}),{filters:Ce,batch_norm_scale:Xe,batch_norm_offset:tt,batch_norm_mean:kt,batch_norm_variance:At}}(z,ce+"/depthwise_conv"),pointwise_conv:w(z,Y,1,ce+"/pointwise_conv")}}return{extractMobilenetV1Params:function(){return{conv_0:w(3,32,3,"mobilenetv1/conv_0"),conv_1:S(32,64,"mobilenetv1/conv_1"),conv_2:S(64,128,"mobilenetv1/conv_2"),conv_3:S(128,128,"mobilenetv1/conv_3"),conv_4:S(128,256,"mobilenetv1/conv_4"),conv_5:S(256,256,"mobilenetv1/conv_5"),conv_6:S(256,512,"mobilenetv1/conv_6"),conv_7:S(512,512,"mobilenetv1/conv_7"),conv_8:S(512,512,"mobilenetv1/conv_8"),conv_9:S(512,512,"mobilenetv1/conv_9"),conv_10:S(512,512,"mobilenetv1/conv_10"),conv_11:S(512,512,"mobilenetv1/conv_11"),conv_12:S(512,1024,"mobilenetv1/conv_12"),conv_13:S(1024,1024,"mobilenetv1/conv_13")}},extractPredictionLayerParams:function(){return{conv_0:w(1024,256,1,"prediction_layer/conv_0"),conv_1:w(256,512,3,"prediction_layer/conv_1"),conv_2:w(512,128,1,"prediction_layer/conv_2"),conv_3:w(128,256,3,"prediction_layer/conv_3"),conv_4:w(256,128,1,"prediction_layer/conv_4"),conv_5:w(128,256,3,"prediction_layer/conv_5"),conv_6:w(256,64,1,"prediction_layer/conv_6"),conv_7:w(64,128,3,"prediction_layer/conv_7"),box_predictor_0:{box_encoding_predictor:k(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),class_predictor:k(512,9,1,"prediction_layer/box_predictor_0/class_predictor")},box_predictor_1:{box_encoding_predictor:k(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),class_predictor:k(1024,18,1,"prediction_layer/box_predictor_1/class_predictor")},box_predictor_2:{box_encoding_predictor:k(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),class_predictor:k(512,18,1,"prediction_layer/box_predictor_2/class_predictor")},box_predictor_3:{box_encoding_predictor:k(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),class_predictor:k(256,18,1,"prediction_layer/box_predictor_3/class_predictor")},box_predictor_4:{box_encoding_predictor:k(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),class_predictor:k(256,18,1,"prediction_layer/box_predictor_4/class_predictor")},box_predictor_5:{box_encoding_predictor:k(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),class_predictor:k(128,18,1,"prediction_layer/box_predictor_5/class_predictor")}}}}}function Nm(I){var E=[],k=function(ce,ve){var De=As(ce,ve);function Ce(At,tn,sn){return{filters:De(At+"/Conv2d_"+tn+"_pointwise/weights",4,sn+"/filters"),batch_norm_offset:De(At+"/Conv2d_"+tn+"_pointwise/convolution_bn_offset",1,sn+"/batch_norm_offset")}}function Xe(At){var tn="mobilenetv1/conv_"+At,sn="MobilenetV1/Conv2d_"+At+"_depthwise",wn=tn+"/depthwise_conv",En=tn+"/pointwise_conv";return{depthwise_conv:{filters:De(sn+"/depthwise_weights",4,wn+"/filters"),batch_norm_scale:De(sn+"/BatchNorm/gamma",1,wn+"/batch_norm_scale"),batch_norm_offset:De(sn+"/BatchNorm/beta",1,wn+"/batch_norm_offset"),batch_norm_mean:De(sn+"/BatchNorm/moving_mean",1,wn+"/batch_norm_mean"),batch_norm_variance:De(sn+"/BatchNorm/moving_variance",1,wn+"/batch_norm_variance")},pointwise_conv:Ce("MobilenetV1",At,En)}}function tt(At,tn){return{filters:De(At+"/weights",4,tn+"/filters"),bias:De(At+"/biases",1,tn+"/bias")}}function kt(At){return{box_encoding_predictor:tt("Prediction/BoxPredictor_"+At+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+At+"/box_encoding_predictor"),class_predictor:tt("Prediction/BoxPredictor_"+At+"/ClassPredictor","prediction_layer/box_predictor_"+At+"/class_predictor")}}return{extractMobilenetV1Params:function(){return{conv_0:Ce("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:Xe(1),conv_2:Xe(2),conv_3:Xe(3),conv_4:Xe(4),conv_5:Xe(5),conv_6:Xe(6),conv_7:Xe(7),conv_8:Xe(8),conv_9:Xe(9),conv_10:Xe(10),conv_11:Xe(11),conv_12:Xe(12),conv_13:Xe(13)}},extractPredictionLayerParams:function(){return{conv_0:Ce("Prediction",0,"prediction_layer/conv_0"),conv_1:Ce("Prediction",1,"prediction_layer/conv_1"),conv_2:Ce("Prediction",2,"prediction_layer/conv_2"),conv_3:Ce("Prediction",3,"prediction_layer/conv_3"),conv_4:Ce("Prediction",4,"prediction_layer/conv_4"),conv_5:Ce("Prediction",5,"prediction_layer/conv_5"),conv_6:Ce("Prediction",6,"prediction_layer/conv_6"),conv_7:Ce("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:kt(0),box_predictor_1:kt(1),box_predictor_2:kt(2),box_predictor_3:kt(3),box_predictor_4:kt(4),box_predictor_5:kt(5)}}}}(I,E),w=k.extractMobilenetV1Params,S=k.extractPredictionLayerParams,z=I["Output/extra_dim"];if(E.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!nr(z))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+z);var Y={mobilenetv1:w(),prediction_layer:S(),output_layer:{extra_dim:z}};return Ja(I,E),{params:Y,paramMappings:E}}function _u(I,E,k){return en.tidy(function(){var w=en.conv2d(I,E.filters,k,"same");return w=en.add(w,E.batch_norm_offset),en.clipByValue(w,0,6)})}var Im=.0010000000474974513;function Hh(I,E){return en.tidy(function(){var k=null,w=_u(I,E.conv_0,[2,2]);if([E.conv_1,E.conv_2,E.conv_3,E.conv_4,E.conv_5,E.conv_6,E.conv_7,E.conv_8,E.conv_9,E.conv_10,E.conv_11,E.conv_12,E.conv_13].forEach(function(S,z){var Y=z+1,ce=function(ve){return[2,4,6,12].some(function(De){return De===ve})?[2,2]:[1,1]}(Y);w=_u(w=function(ve,De,Ce){return en.tidy(function(){var Xe=en.depthwiseConv2d(ve,De.filters,Ce,"same");return Xe=en.batchNorm(Xe,De.batch_norm_mean,De.batch_norm_variance,De.batch_norm_offset,De.batch_norm_scale,Im),en.clipByValue(Xe,0,6)})}(w,S.depthwise_conv,ce),S.pointwise_conv,[1,1]),Y===11&&(k=w)}),k===null)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:w,conv11:k}})}function Qd(I,E,k){var w=I.arraySync(),S=Math.min(w[E][0],w[E][2]),z=Math.min(w[E][1],w[E][3]),Y=Math.max(w[E][0],w[E][2]),ce=Math.max(w[E][1],w[E][3]),ve=Math.min(w[k][0],w[k][2]),De=Math.min(w[k][1],w[k][3]),Ce=Math.max(w[k][0],w[k][2]),Xe=Math.max(w[k][1],w[k][3]),tt=(Y-S)*(ce-z),kt=(Ce-ve)*(Xe-De);if(tt<=0||kt<=0)return 0;var At=Math.max(S,ve),tn=Math.max(z,De),sn=Math.min(Y,Ce),wn=Math.min(ce,Xe),En=Math.max(sn-At,0)*Math.max(wn-tn,0);return En/(tt+kt-En)}function Nv(I,E){var k=function(Ce){var Xe=en.unstack(en.transpose(Ce,[1,0])),tt=[en.sub(Xe[2],Xe[0]),en.sub(Xe[3],Xe[1])];return{sizes:tt,centers:[en.add(Xe[0],en.div(tt[0],en.scalar(2))),en.add(Xe[1],en.div(tt[1],en.scalar(2)))]}}(I),w=k.sizes,S=k.centers,z=en.unstack(en.transpose(E,[1,0])),Y=en.div(en.mul(en.exp(en.div(z[2],en.scalar(5))),w[0]),en.scalar(2)),ce=en.add(en.mul(en.div(z[0],en.scalar(10)),w[0]),S[0]),ve=en.div(en.mul(en.exp(en.div(z[3],en.scalar(5))),w[1]),en.scalar(2)),De=en.add(en.mul(en.div(z[1],en.scalar(10)),w[1]),S[1]);return en.transpose(en.stack([en.sub(ce,Y),en.sub(De,ve),en.add(ce,Y),en.add(De,ve)]),[1,0])}function Zd(I,E){return en.tidy(function(){var k=I.shape[0];return{boxPredictionEncoding:en.reshape(io(I,E.box_encoding_predictor),[k,-1,1,4]),classPrediction:en.reshape(io(I,E.class_predictor),[k,-1,3])}})}var Tc=function(){function I(E){var k=E===void 0?{}:E,w=k.minConfidence,S=k.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=w||.5,this._maxResults=S||100,typeof this._minConfidence!="number"||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if(typeof this._maxResults!="number")throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(I.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),I}(),ep=function(I){function E(){return I.call(this,"SsdMobilenetv1")||this}return Object(Un.c)(E,I),E.prototype.forwardInput=function(k){var w=this.params;if(!w)throw new Error("SsdMobilenetv1 - load model before inference");return en.tidy(function(){var S=k.toBatchTensor(512,!1).toFloat(),z=Hh(en.sub(en.mul(S,en.scalar(.007843137718737125)),en.scalar(1)),w.mobilenetv1),Y=function(ce,ve,De){return en.tidy(function(){var Ce=_u(_u(ce,De.conv_0,[1,1]),De.conv_1,[2,2]),Xe=_u(_u(Ce,De.conv_2,[1,1]),De.conv_3,[2,2]),tt=_u(_u(Xe,De.conv_4,[1,1]),De.conv_5,[2,2]),kt=_u(_u(tt,De.conv_6,[1,1]),De.conv_7,[2,2]),At=Zd(ve,De.box_predictor_0),tn=Zd(ce,De.box_predictor_1),sn=Zd(Ce,De.box_predictor_2),wn=Zd(Xe,De.box_predictor_3),En=Zd(tt,De.box_predictor_4),Tn=Zd(kt,De.box_predictor_5);return{boxPredictions:en.concat([At.boxPredictionEncoding,tn.boxPredictionEncoding,sn.boxPredictionEncoding,wn.boxPredictionEncoding,En.boxPredictionEncoding,Tn.boxPredictionEncoding],1),classPredictions:en.concat([At.classPrediction,tn.classPrediction,sn.classPrediction,wn.classPrediction,En.classPrediction,Tn.classPrediction],1)}})}(z.out,z.conv11,w.prediction_layer);return function(ce,ve,De){return en.tidy(function(){var Ce=ce.shape[0],Xe=Nv(en.reshape(en.tile(De.extra_dim,[Ce,1,1]),[-1,4]),en.reshape(ce,[-1,4]));Xe=en.reshape(Xe,[Ce,Xe.shape[0]/Ce,4]);var tt=en.sigmoid(en.slice(ve,[0,0,1],[-1,-1,-1])),kt=en.slice(tt,[0,0,0],[-1,-1,1]);return kt=en.reshape(kt,[Ce,kt.shape[1]]),{boxes:en.unstack(Xe),scores:en.unstack(kt)}})}(Y.boxPredictions,Y.classPredictions,w.output_layer)})},E.prototype.forward=function(k){return Object(Un.b)(this,void 0,void 0,function(){var w;return Object(Un.d)(this,function(S){switch(S.label){case 0:return w=this.forwardInput,[4,Zr(k)];case 1:return[2,w.apply(this,[S.sent()])]}})})},E.prototype.locateFaces=function(k,w){return w===void 0&&(w={}),Object(Un.b)(this,void 0,void 0,function(){var S,z,Y,ce,ve,De,Ce,Xe,tt,kt,At,tn,sn,wn,En,Tn,Pn,dn,cr,kr;return Object(Un.d)(this,function(yr){switch(yr.label){case 0:return S=new Tc(w),z=S.maxResults,Y=S.minConfidence,[4,Zr(k)];case 1:for(ce=yr.sent(),ve=this.forwardInput(ce),De=ve.boxes,Ce=ve.scores,Xe=De[0],tt=Ce[0],kt=1;kt<De.length;kt++)De[kt].dispose(),Ce[kt].dispose();return sn=(tn=Array).from,[4,tt.data()];case 2:return At=sn.apply(tn,[yr.sent()]),wn=function(Br,_r,hi,Ei,xi){var ya=Br.shape[0],Ua=Math.min(hi,ya),Ta=function(Ra){return Ra<=Ei?1:0},Da=[];return _r.map(function(Ra,Qa){return{score:Ra,boxIndex:Qa}}).filter(function(Ra){return Ra.score>xi}).sort(function(Ra,Qa){return Qa.score-Ra.score}).forEach(function(Ra){if(!(Da.length>=Ua)){for(var Qa=Ra.score,oo=Da.length-1;oo>=0;--oo){var wo=Qd(Br,Ra.boxIndex,Da[oo]);if(wo!==0&&(Ra.score*=Ta(wo),Ra.score<=xi))break}Qa===Ra.score&&Da.push(Ra.boxIndex)}}),Da}(Xe,At,z,.5,Y),En=ce.getReshapedInputDimensions(0),Tn=ce.inputSize,Pn=Tn/En.width,dn=Tn/En.height,cr=Xe.arraySync(),kr=wn.map(function(Br){var _r=[Math.max(0,cr[Br][0]),Math.min(1,cr[Br][2])].map(function(Ta){return Ta*dn}),hi=_r[0],Ei=_r[1],xi=[Math.max(0,cr[Br][1]),Math.min(1,cr[Br][3])].map(function(Ta){return Ta*Pn}),ya=xi[0],Ua=xi[1];return new Xa(At[Br],new Zc(ya,hi,Ua-ya,Ei-hi),{height:ce.getInputHeight(0),width:ce.getInputWidth(0)})}),Xe.dispose(),tt.dispose(),[2,kr]}})})},E.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},E.prototype.extractParamsFromWeigthMap=function(k){return Nm(k)},E.prototype.extractParams=function(k){return function(w){var S=[],z=So(w),Y=z.extractWeights,ce=z.getRemainingWeights,ve=Tm(Y,S),De=ve.extractMobilenetV1Params,Ce=ve.extractPredictionLayerParams,Xe=De(),tt=Ce(),kt={extra_dim:en.tensor3d(Y(20472),[1,5118,4])};if(S.push({paramPath:"output_layer/extra_dim"}),ce().length!==0)throw new Error("weights remaing after extract: "+ce().length);return{params:{mobilenetv1:Xe,prediction_layer:tt,output_layer:kt},paramMappings:S}}(k)},E}(Ui);function Cg(I){var E=new ep;return E.extractWeights(I),E}function Og(I){return Cg(I)}var Fm,b0=function(I){function E(){return I!==null&&I.apply(this,arguments)||this}return Object(Un.c)(E,I),E}(ep),x0=.4,sa=[new oa(.738768,.874946),new oa(2.42204,2.65704),new oa(4.30971,7.04493),new oa(10.246,4.59428),new oa(12.6868,11.8741)],Ag=[new oa(1.603231,2.094468),new oa(6.041143,7.080126),new oa(2.882459,3.518061),new oa(4.266906,5.178857),new oa(9.041765,10.66308)],_g=[117.001,114.697,97.404],Bp=function(I){return typeof I=="number"};function Sg(I){if(!I)throw new Error("invalid config: "+I);if(typeof I.withSeparableConvs!="boolean")throw new Error("config.withSeparableConvs has to be a boolean, have: "+I.withSeparableConvs);if(!Bp(I.iouThreshold)||I.iouThreshold<0||I.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+I.iouThreshold);if(!Array.isArray(I.classes)||!I.classes.length||!I.classes.every(function(E){return typeof E=="string"}))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(I.classes));if(!Array.isArray(I.anchors)||!I.anchors.length||!I.anchors.map(function(E){return E||{}}).every(function(E){return Bp(E.x)&&Bp(E.y)}))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(I.anchors));if(I.meanRgb&&(!Array.isArray(I.meanRgb)||I.meanRgb.length!==3||!I.meanRgb.every(Bp)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(I.meanRgb))}function tp(I){return en.tidy(function(){var E=en.mul(I,en.scalar(.10000000149011612));return en.add(en.relu(en.sub(I,E)),E)})}function nl(I,E){return en.tidy(function(){var k=en.pad(I,[[0,0],[1,1],[1,1],[0,0]]);return k=en.conv2d(k,E.conv.filters,[1,1],"valid"),k=en.sub(k,E.bn.sub),k=en.mul(k,E.bn.truediv),tp(k=en.add(k,E.conv.bias))})}function rl(I,E){return en.tidy(function(){var k=en.pad(I,[[0,0],[1,1],[1,1],[0,0]]);return k=en.separableConv2d(k,E.depthwise_filter,E.pointwise_filter,[1,1],"valid"),tp(k=en.add(k,E.bias))})}function Dg(I,E){var k=fs(I,E),w=ho(I,E);return{extractConvParams:k,extractConvWithBatchNormParams:function(S,z,Y){return{conv:k(S,z,3,Y+"/conv"),bn:function(ce,ve){var De=en.tensor1d(I(ce)),Ce=en.tensor1d(I(ce));return E.push({paramPath:ve+"/sub"},{paramPath:ve+"/truediv"}),{sub:De,truediv:Ce}}(z,Y+"/bn")}},extractSeparableConvParams:w}}function Tg(I,E){var k=As(I,E);function w(S){return{filters:k(S+"/filters",4),bias:k(S+"/bias",1)}}return{extractConvParams:w,extractConvWithBatchNormParams:function(S){return{conv:w(S+"/conv"),bn:function(z){return{sub:k(z+"/sub",1),truediv:k(z+"/truediv",1)}}(S+"/bn")}},extractSeparableConvParams:cu(k)}}(function(I){I[I.XS=224]="XS",I[I.SM=320]="SM",I[I.MD=416]="MD",I[I.LG=608]="LG"})(Fm||(Fm={}));var $h=function(){function I(E){var k=E===void 0?{}:E,w=k.inputSize,S=k.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=w||416,this._scoreThreshold=S||.5,typeof this._inputSize!="number"||this._inputSize%32!=0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if(typeof this._scoreThreshold!="number"||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(I.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),I}(),Uf=function(I){function E(k){var w=I.call(this,"TinyYolov2")||this;return Sg(k),w._config=k,w}return Object(Un.c)(E,I),Object.defineProperty(E.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(E.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(E.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),E.prototype.runTinyYolov2=function(k,w){var S=nl(k,w.conv0);return S=nl(S=en.maxPool(S,[2,2],[2,2],"same"),w.conv1),S=nl(S=en.maxPool(S,[2,2],[2,2],"same"),w.conv2),S=nl(S=en.maxPool(S,[2,2],[2,2],"same"),w.conv3),S=nl(S=en.maxPool(S,[2,2],[2,2],"same"),w.conv4),S=nl(S=en.maxPool(S,[2,2],[2,2],"same"),w.conv5),io(S=nl(S=nl(S=en.maxPool(S,[2,2],[1,1],"same"),w.conv6),w.conv7),w.conv8,"valid",!1)},E.prototype.runMobilenet=function(k,w){var S=this.config.isFirstLayerConv2d?tp(io(k,w.conv0,"valid",!1)):rl(k,w.conv0);return S=rl(S=en.maxPool(S,[2,2],[2,2],"same"),w.conv1),S=rl(S=en.maxPool(S,[2,2],[2,2],"same"),w.conv2),S=rl(S=en.maxPool(S,[2,2],[2,2],"same"),w.conv3),S=rl(S=en.maxPool(S,[2,2],[2,2],"same"),w.conv4),S=rl(S=en.maxPool(S,[2,2],[2,2],"same"),w.conv5),S=en.maxPool(S,[2,2],[1,1],"same"),S=w.conv6?rl(S,w.conv6):S,io(S=w.conv7?rl(S,w.conv7):S,w.conv8,"valid",!1)},E.prototype.forwardInput=function(k,w){var S=this,z=this.params;if(!z)throw new Error("TinyYolov2 - load model before inference");return en.tidy(function(){var Y=k.toBatchTensor(w,!1).toFloat();return Y=(Y=S.config.meanRgb?uc(Y,S.config.meanRgb):Y).div(en.scalar(256)),S.config.withSeparableConvs?S.runMobilenet(Y,z):S.runTinyYolov2(Y,z)})},E.prototype.forward=function(k,w){return Object(Un.b)(this,void 0,void 0,function(){var S;return Object(Un.d)(this,function(z){switch(z.label){case 0:return S=this.forwardInput,[4,Zr(k)];case 1:return[4,S.apply(this,[z.sent(),w])];case 2:return[2,z.sent()]}})})},E.prototype.detect=function(k,w){return w===void 0&&(w={}),Object(Un.b)(this,void 0,void 0,function(){var S,z,Y,ce,ve,De,Ce,Xe,tt,kt,At,tn,sn,wn=this;return Object(Un.d)(this,function(En){switch(En.label){case 0:return S=new $h(w),z=S.inputSize,Y=S.scoreThreshold,[4,Zr(k)];case 1:return ce=En.sent(),[4,this.forwardInput(ce,z)];case 2:return ve=En.sent(),De=en.tidy(function(){return en.unstack(ve)[0].expandDims()}),Ce={width:ce.getInputWidth(0),height:ce.getInputHeight(0)},[4,this.extractBoxes(De,ce.getReshapedInputDimensions(0),Y)];case 3:return Xe=En.sent(),ve.dispose(),De.dispose(),tt=Xe.map(function(Tn){return Tn.box}),kt=Xe.map(function(Tn){return Tn.score}),At=Xe.map(function(Tn){return Tn.classScore}),tn=Xe.map(function(Tn){return wn.config.classes[Tn.label]}),sn=qu(tt.map(function(Tn){return Tn.rescale(z)}),kt,this.config.iouThreshold,!0),[2,sn.map(function(Tn){return new ls(kt[Tn],At[Tn],tn[Tn],tt[Tn],Ce)})]}})})},E.prototype.getDefaultModelName=function(){return""},E.prototype.extractParamsFromWeigthMap=function(k){return function(w,S){var z,Y=[],ce=Tg(w,Y),ve=ce.extractConvParams,De=ce.extractConvWithBatchNormParams,Ce=ce.extractSeparableConvParams;if(S.withSeparableConvs){var Xe=S.filterSizes&&S.filterSizes.length||9;z={conv0:S.isFirstLayerConv2d?ve("conv0"):Ce("conv0"),conv1:Ce("conv1"),conv2:Ce("conv2"),conv3:Ce("conv3"),conv4:Ce("conv4"),conv5:Ce("conv5"),conv6:Xe>7?Ce("conv6"):void 0,conv7:Xe>8?Ce("conv7"):void 0,conv8:ve("conv8")}}else z={conv0:De("conv0"),conv1:De("conv1"),conv2:De("conv2"),conv3:De("conv3"),conv4:De("conv4"),conv5:De("conv5"),conv6:De("conv6"),conv7:De("conv7"),conv8:ve("conv8")};return Ja(w,Y),{params:z,paramMappings:Y}}(k,this.config)},E.prototype.extractParams=function(k){var w=this.config.filterSizes||E.DEFAULT_FILTER_SIZES,S=w?w.length:void 0;if(S!==7&&S!==8&&S!==9)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+S+" filterSizes in config");return function(z,Y,ce,ve){var De,Ce=So(z),Xe=Ce.extractWeights,tt=Ce.getRemainingWeights,kt=[],At=Dg(Xe,kt),tn=At.extractConvParams,sn=At.extractConvWithBatchNormParams,wn=At.extractSeparableConvParams;if(Y.withSeparableConvs){var En=ve[0],Tn=ve[1],Pn=ve[2],dn=ve[3],cr=ve[4],kr=ve[5],yr=ve[6],Br=ve[7],_r=ve[8];De={conv0:Y.isFirstLayerConv2d?tn(En,Tn,3,"conv0"):wn(En,Tn,"conv0"),conv1:wn(Tn,Pn,"conv1"),conv2:wn(Pn,dn,"conv2"),conv3:wn(dn,cr,"conv3"),conv4:wn(cr,kr,"conv4"),conv5:wn(kr,yr,"conv5"),conv6:Br?wn(yr,Br,"conv6"):void 0,conv7:_r?wn(Br,_r,"conv7"):void 0,conv8:tn(_r||Br||yr,5*ce,1,"conv8")}}else En=ve[0],Tn=ve[1],Pn=ve[2],dn=ve[3],cr=ve[4],kr=ve[5],yr=ve[6],Br=ve[7],_r=ve[8],De={conv0:sn(En,Tn,"conv0"),conv1:sn(Tn,Pn,"conv1"),conv2:sn(Pn,dn,"conv2"),conv3:sn(dn,cr,"conv3"),conv4:sn(cr,kr,"conv4"),conv5:sn(kr,yr,"conv5"),conv6:sn(yr,Br,"conv6"),conv7:sn(Br,_r,"conv7"),conv8:tn(_r,5*ce,1,"conv8")};if(tt().length!==0)throw new Error("weights remaing after extract: "+tt().length);return{params:De,paramMappings:kt}}(k,this.config,this.boxEncodingSize,w)},E.prototype.extractBoxes=function(k,w,S){return Object(Un.b)(this,void 0,void 0,function(){var z,Y,ce,ve,De,Ce,Xe,tt,kt,At,tn,sn,wn,En,Tn,Pn,dn,cr,kr,yr,Br,_r,hi,Ei,xi,ya,Ua,Ta,Da,Ra=this;return Object(Un.d)(this,function(Qa){switch(Qa.label){case 0:return z=w.width,Y=w.height,ce=Math.max(z,Y),ve=ce/z,De=ce/Y,Ce=k.shape[1],Xe=this.config.anchors.length,tt=en.tidy(function(){var oo=k.reshape([Ce,Ce,Xe,Ra.boxEncodingSize]);return[oo.slice([0,0,0,0],[Ce,Ce,Xe,4]),oo.slice([0,0,0,4],[Ce,Ce,Xe,1]),Ra.withClassScores?en.softmax(oo.slice([0,0,0,5],[Ce,Ce,Xe,Ra.config.classes.length]),3):en.scalar(0)]}),kt=tt[0],At=tt[1],tn=tt[2],sn=[],[4,At.array()];case 1:return wn=Qa.sent(),[4,kt.array()];case 2:En=Qa.sent(),Tn=0,Qa.label=3;case 3:if(!(Tn<Ce))return[3,12];Pn=0,Qa.label=4;case 4:if(!(Pn<Ce))return[3,11];dn=0,Qa.label=5;case 5:return dn<Xe?(cr=Qc(wn[Tn][Pn][dn][0]),!S||cr>S?(kr=(Pn+Qc(En[Tn][Pn][dn][0]))/Ce*ve,yr=(Tn+Qc(En[Tn][Pn][dn][1]))/Ce*De,Br=Math.exp(En[Tn][Pn][dn][2])*this.config.anchors[dn].x/Ce*ve,_r=Math.exp(En[Tn][Pn][dn][3])*this.config.anchors[dn].y/Ce*De,hi=kr-Br/2,Ei=yr-_r/2,xi={row:Tn,col:Pn,anchor:dn},this.withClassScores?[4,this.extractPredictedClass(tn,xi)]:[3,7]):[3,9]):[3,10];case 6:return Da=Qa.sent(),[3,8];case 7:Da={classScore:1,label:0},Qa.label=8;case 8:Ua=(ya=Da).classScore,Ta=ya.label,sn.push(Object(Un.a)({box:new _o(hi,Ei,hi+Br,Ei+_r),score:cr,classScore:cr*Ua,label:Ta},xi)),Qa.label=9;case 9:return dn++,[3,5];case 10:return Pn++,[3,4];case 11:return Tn++,[3,3];case 12:return kt.dispose(),At.dispose(),tn.dispose(),[2,sn]}})})},E.prototype.extractPredictedClass=function(k,w){return Object(Un.b)(this,void 0,void 0,function(){var S,z,Y,ce;return Object(Un.d)(this,function(ve){switch(ve.label){case 0:return S=w.row,z=w.col,Y=w.anchor,[4,k.array()];case 1:return ce=ve.sent(),[2,Array(this.config.classes.length).fill(0).map(function(De,Ce){return ce[S][z][Y][Ce]}).map(function(De,Ce){return{classScore:De,label:Ce}}).reduce(function(De,Ce){return De.classScore>Ce.classScore?De:Ce})]}})})},E.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],E}(Ui),Gh=function(I){function E(k){k===void 0&&(k=!0);var w=Object.assign({},{withSeparableConvs:k,iouThreshold:x0,classes:["face"]},k?{anchors:Ag,meanRgb:_g}:{anchors:sa,withClassScores:!0});return I.call(this,w)||this}return Object(Un.c)(E,I),Object.defineProperty(E.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(E.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),E.prototype.locateFaces=function(k,w){return Object(Un.b)(this,void 0,void 0,function(){return Object(Un.d)(this,function(S){switch(S.label){case 0:return[4,this.detect(k,w)];case 1:return[2,S.sent().map(function(z){return new Xa(z.score,z.relativeBox,{width:z.imageWidth,height:z.imageHeight})})]}})})},E.prototype.getDefaultModelName=function(){return this.withSeparableConvs?"tiny_yolov2_separable_conv_model":"tiny_yolov2_model"},E.prototype.extractParamsFromWeigthMap=function(k){return I.prototype.extractParamsFromWeigthMap.call(this,k)},E}(Uf);function w0(I,E){E===void 0&&(E=!0);var k=new Gh(E);return k.extractWeights(I),k}var Pp=function(I){function E(){var k=I!==null&&I.apply(this,arguments)||this;return k._name="TinyFaceDetectorOptions",k}return Object(Un.c)(E,I),E}($h),il=function(){function I(){}return I.prototype.then=function(E){return Object(Un.b)(this,void 0,void 0,function(){var k;return Object(Un.d)(this,function(w){switch(w.label){case 0:return k=E,[4,this.run()];case 1:return[2,k.apply(void 0,[w.sent()])]}})})},I.prototype.run=function(){return Object(Un.b)(this,void 0,void 0,function(){return Object(Un.d)(this,function(E){throw new Error("ComposableTask - run is not implemented")})})},I}();function Su(I,E,k,w,S){return S===void 0&&(S=function(z){return z.alignedRect}),Object(Un.b)(this,void 0,void 0,function(){var z,Y,ce,ve,De;return Object(Un.d)(this,function(Ce){switch(Ce.label){case 0:return z=I.map(function(Xe){return _c(Xe)?S(Xe):Xe.detection}),(ce=w)?[3,5]:E instanceof en.Tensor?[4,ea(E,z)]:[3,2];case 1:return ve=Ce.sent(),[3,4];case 2:return[4,pa(E,z)];case 3:ve=Ce.sent(),Ce.label=4;case 4:ce=ve,Ce.label=5;case 5:return[4,k(Y=ce)];case 6:return De=Ce.sent(),Y.forEach(function(Xe){return Xe instanceof en.Tensor&&Xe.dispose()}),[2,De]}})})}function zl(I,E,k,w,S){return Object(Un.b)(this,void 0,void 0,function(){var z=this;return Object(Un.d)(this,function(Y){return[2,Su([I],E,function(ce){return Object(Un.b)(z,void 0,void 0,function(){return Object(Un.d)(this,function(ve){return[2,k(ce[0])]})})},w,S)]})})}var Ul=2,Wl=12;function Ng(I){var E=So(I),k=E.extractWeights,w=E.getRemainingWeights,S=[],z=function(tt,kt){var At=fs(tt,kt),tn=fo(tt,kt);function sn(En,Tn){var Pn=en.tensor1d(tt(En));return kt.push({paramPath:Tn}),Pn}function wn(En,Tn,Pn){return Pn===void 0&&(Pn=!1),{conv1:At(En[0],En[1],3,Tn+"/conv1"),prelu1_alpha:sn(En[1],Tn+"/prelu1_alpha"),conv2:At(En[1],En[2],3,Tn+"/conv2"),prelu2_alpha:sn(En[2],Tn+"/prelu2_alpha"),conv3:At(En[2],En[3],Pn?2:3,Tn+"/conv3"),prelu3_alpha:sn(En[3],Tn+"/prelu3_alpha")}}return{extractPNetParams:function(){var En=wn([3,10,16,32],"pnet"),Tn=At(32,2,1,"pnet/conv4_1"),Pn=At(32,4,1,"pnet/conv4_2");return Object(Un.a)(Object(Un.a)({},En),{conv4_1:Tn,conv4_2:Pn})},extractRNetParams:function(){var En=wn([3,28,48,64],"rnet",!0),Tn=tn(576,128,"rnet/fc1"),Pn=sn(128,"rnet/prelu4_alpha"),dn=tn(128,2,"rnet/fc2_1"),cr=tn(128,4,"rnet/fc2_2");return Object(Un.a)(Object(Un.a)({},En),{fc1:Tn,prelu4_alpha:Pn,fc2_1:dn,fc2_2:cr})},extractONetParams:function(){var En=wn([3,32,64,64],"onet"),Tn=At(64,128,2,"onet/conv4"),Pn=sn(128,"onet/prelu4_alpha"),dn=tn(1152,256,"onet/fc1"),cr=sn(256,"onet/prelu5_alpha"),kr=tn(256,2,"onet/fc2_1"),yr=tn(256,4,"onet/fc2_2"),Br=tn(256,10,"onet/fc2_3");return Object(Un.a)(Object(Un.a)({},En),{conv4:Tn,prelu4_alpha:Pn,fc1:dn,prelu5_alpha:cr,fc2_1:kr,fc2_2:yr,fc2_3:Br})}}}(k,S),Y=z.extractPNetParams,ce=z.extractRNetParams,ve=z.extractONetParams,De=Y(),Ce=ce(),Xe=ve();if(w().length!==0)throw new Error("weights remaing after extract: "+w().length);return{params:{pnet:De,rnet:Ce,onet:Xe},paramMappings:S}}function Lp(I){var E=[],k=function(De,Ce){var Xe=As(De,Ce);function tt(sn){return{filters:Xe(sn+"/weights",4,sn+"/filters"),bias:Xe(sn+"/bias",1)}}function kt(sn){return{weights:Xe(sn+"/weights",2),bias:Xe(sn+"/bias",1)}}function At(sn){return Xe(sn,1)}function tn(sn){return{conv1:tt(sn+"/conv1"),prelu1_alpha:At(sn+"/prelu1_alpha"),conv2:tt(sn+"/conv2"),prelu2_alpha:At(sn+"/prelu2_alpha"),conv3:tt(sn+"/conv3"),prelu3_alpha:At(sn+"/prelu3_alpha")}}return{extractPNetParams:function(){var sn=tn("pnet"),wn=tt("pnet/conv4_1"),En=tt("pnet/conv4_2");return Object(Un.a)(Object(Un.a)({},sn),{conv4_1:wn,conv4_2:En})},extractRNetParams:function(){var sn=tn("rnet"),wn=kt("rnet/fc1"),En=At("rnet/prelu4_alpha"),Tn=kt("rnet/fc2_1"),Pn=kt("rnet/fc2_2");return Object(Un.a)(Object(Un.a)({},sn),{fc1:wn,prelu4_alpha:En,fc2_1:Tn,fc2_2:Pn})},extractONetParams:function(){var sn=tn("onet"),wn=tt("onet/conv4"),En=At("onet/prelu4_alpha"),Tn=kt("onet/fc1"),Pn=At("onet/prelu5_alpha"),dn=kt("onet/fc2_1"),cr=kt("onet/fc2_2"),kr=kt("onet/fc2_3");return Object(Un.a)(Object(Un.a)({},sn),{conv4:wn,prelu4_alpha:En,fc1:Tn,prelu5_alpha:Pn,fc2_1:dn,fc2_2:cr,fc2_3:kr})}}}(I,E),w=k.extractPNetParams,S=k.extractRNetParams,z=k.extractONetParams,Y=w(),ce=S(),ve=z();return Ja(I,E),{params:{pnet:Y,rnet:ce,onet:ve},paramMappings:E}}function Du(I,E){var k=E[0],w=E[1];return{height:Math.floor(k*I),width:Math.floor(w*I)}}var Hu=function(I){function E(k,w,S,z){return I.call(this,{left:k,top:w,right:S,bottom:z},!0)||this}return Object(Un.c)(E,I),E}(cs);function Ig(I){return en.tidy(function(){return en.mul(en.sub(I,en.scalar(127.5)),en.scalar(.0078125))})}function np(I,E){return en.tidy(function(){return en.add(en.relu(I),en.mul(E,en.neg(en.relu(en.neg(I)))))})}function Rm(I,E,k){return k===void 0&&(k=!1),en.tidy(function(){var w=io(I,E.conv1,"valid");return w=np(w,E.prelu1_alpha),w=np(w=io(w=en.maxPool(w,k?[2,2]:[3,3],[2,2],"same"),E.conv2,"valid"),E.prelu2_alpha),w=np(w=io(w=k?w:en.maxPool(w,[3,3],[2,2],"valid"),E.conv3,"valid"),E.prelu3_alpha)})}function k0(I,E,k,w,S){S.stage1=[];var z=E.map(function(Ce){return en.tidy(function(){var Xe={scale:Ce},tt=function(wn,En){return en.tidy(function(){var Tn=Du(En,wn.shape.slice(1)),Pn=Tn.height,dn=Tn.width,cr=Ig(en.image.resizeBilinear(wn,[Pn,dn]));return en.transpose(cr,[0,2,1,3])})}(I,Ce),kt=Date.now(),At=function(wn,En){return en.tidy(function(){var Tn=Rm(wn,En,!0),Pn=io(Tn,En.conv4_1,"valid"),dn=en.expandDims(en.max(Pn,3),3);return{prob:en.softmax(en.sub(Pn,dn),3),regions:io(Tn,En.conv4_2,"valid")}})}(tt,w),tn=At.prob,sn=At.regions;return Xe.pnet=Date.now()-kt,{scoresTensor:en.unstack(en.unstack(tn,3)[1])[0],regionsTensor:en.unstack(sn)[0],scale:Ce,statsForScale:Xe}})}).map(function(Ce){var Xe=Ce.scoresTensor,tt=Ce.regionsTensor,kt=Ce.scale,At=Ce.statsForScale,tn=function(En,Tn,Pn,dn){for(var cr=[],kr=En.arraySync(),yr=0;yr<En.shape[0];yr++)for(var Br=0;Br<En.shape[1];Br++)kr[yr][Br]>=dn&&cr.push(new oa(Br,yr));return cr.map(function(_r){var hi=new _o(Math.round((_r.y*Ul+1)/Pn),Math.round((_r.x*Ul+1)/Pn),Math.round((_r.y*Ul+Wl)/Pn),Math.round((_r.x*Ul+Wl)/Pn)),Ei=kr[_r.y][_r.x],xi=Tn.arraySync();return{cell:hi,score:Ei,region:new Hu(xi[_r.y][_r.x][0],xi[_r.y][_r.x][1],xi[_r.y][_r.x][2],xi[_r.y][_r.x][3])}})}(Xe,tt,kt,k);if(Xe.dispose(),tt.dispose(),!tn.length)return S.stage1.push(At),[];var sn=Date.now(),wn=qu(tn.map(function(En){return En.cell}),tn.map(function(En){return En.score}),.5);return At.nms=Date.now()-sn,At.numBoxes=wn.length,S.stage1.push(At),wn.map(function(En){return tn[En]})}).reduce(function(Ce,Xe){return Ce.concat(Xe)},[]),Y=[],ce=[];if(z.length>0){var ve=Date.now(),De=qu(z.map(function(Ce){return Ce.cell}),z.map(function(Ce){return Ce.score}),.7);S.stage1_nms=Date.now()-ve,ce=De.map(function(Ce){return z[Ce].score}),Y=De.map(function(Ce){return z[Ce]}).map(function(Ce){var Xe=Ce.cell,tt=Ce.region;return new _o(Xe.left+tt.left*Xe.width,Xe.top+tt.top*Xe.height,Xe.right+tt.right*Xe.width,Xe.bottom+tt.bottom*Xe.height).toSquare().round()})}return{boxes:Y,scores:ce}}function Iv(I,E,k){var w=k.width,S=k.height;return Object(Un.b)(this,void 0,void 0,function(){var z,Y,ce,ve=this;return Object(Un.d)(this,function(De){switch(De.label){case 0:return z=yn(I),[4,Promise.all(E.map(function(Ce){return Object(Un.b)(ve,void 0,void 0,function(){var Xe,tt,kt,At,tn,sn,wn,En;return Object(Un.d)(this,function(Tn){return Xe=Ce.padAtBorders(I.height,I.width),tt=Xe.y,kt=Xe.ey,At=Xe.x,tn=Xe.ex,sn=At-1,wn=tt-1,En=z.getImageData(sn,wn,tn-sn,kt-wn),[2,Ut.isNodejs()?Hr(En):createImageBitmap(En)]})})}))];case 1:return Y=De.sent(),ce=[],Y.forEach(function(Ce){var Xe=yn(wr({width:w,height:S}));Xe.drawImage(Ce,0,0,w,S);for(var tt=Xe.getImageData(0,0,w,S).data,kt=[],At=0;At<tt.length;At+=4)kt.push(tt[At+2]),kt.push(tt[At+1]),kt.push(tt[At]);ce.push(kt)}),[2,ce.map(function(Ce){return en.tidy(function(){return Ig(en.transpose(en.tensor4d(Ce,[1,w,S,3]),[0,2,1,3]).toFloat())})})]}})})}function Vl(I,E,k,w,S){return Object(Un.b)(this,void 0,void 0,function(){var z,Y,ce,ve,De,Ce,Xe,tt,kt,At,tn,sn,wn,En;return Object(Un.d)(this,function(Tn){switch(Tn.label){case 0:return z=Date.now(),[4,Iv(I,E,{width:24,height:24})];case 1:return Y=Tn.sent(),S.stage2_extractImagePatches=Date.now()-z,z=Date.now(),ce=Y.map(function(Pn){var dn=function(cr,kr){return en.tidy(function(){var yr=Rm(cr,kr),Br=np(ao(en.reshape(yr,[yr.shape[0],kr.fc1.weights.shape[0]]),kr.fc1),kr.prelu4_alpha),_r=ao(Br,kr.fc2_1),hi=en.expandDims(en.max(_r,1),1),Ei=en.softmax(en.sub(_r,hi),1),xi=ao(Br,kr.fc2_2);return{scores:en.unstack(Ei,1)[1],regions:xi}})}(Pn,w);return Pn.dispose(),dn}),S.stage2_rnet=Date.now()-z,ve=ce.length>1?en.concat(ce.map(function(Pn){return Pn.scores})):ce[0].scores,Xe=(Ce=Array).from,[4,ve.data()];case 2:return De=Xe.apply(Ce,[Tn.sent()]),ve.dispose(),tt=De.map(function(Pn,dn){return{score:Pn,idx:dn}}).filter(function(Pn){return Pn.score>k}).map(function(Pn){return Pn.idx}),kt=tt.map(function(Pn){return E[Pn]}),At=tt.map(function(Pn){return De[Pn]}),tn=[],sn=[],kt.length>0&&(z=Date.now(),wn=qu(kt,At,.7),S.stage2_nms=Date.now()-z,En=wn.map(function(Pn){var dn=ce[tt[Pn]].regions.arraySync();return new Hu(dn[0][0],dn[0][1],dn[0][2],dn[0][3])}),sn=wn.map(function(Pn){return At[Pn]}),tn=wn.map(function(Pn,dn){return kt[Pn].calibrate(En[dn])})),ce.forEach(function(Pn){Pn.regions.dispose(),Pn.scores.dispose()}),[2,{boxes:tn,scores:sn}]}})})}function Kh(I,E,k,w,S){return Object(Un.b)(this,void 0,void 0,function(){var z,Y,ce,ve,De,Ce,Xe,tt,kt,At,tn,sn,wn,En,Tn;return Object(Un.d)(this,function(Pn){switch(Pn.label){case 0:return z=Date.now(),[4,Iv(I,E,{width:48,height:48})];case 1:return Y=Pn.sent(),S.stage3_extractImagePatches=Date.now()-z,z=Date.now(),ce=Y.map(function(dn){var cr=function(kr,yr){return en.tidy(function(){var Br=Rm(kr,yr);Br=np(Br=io(Br=en.maxPool(Br,[2,2],[2,2],"same"),yr.conv4,"valid"),yr.prelu4_alpha);var _r=np(ao(en.reshape(Br,[Br.shape[0],yr.fc1.weights.shape[0]]),yr.fc1),yr.prelu5_alpha),hi=ao(_r,yr.fc2_1),Ei=en.expandDims(en.max(hi,1),1),xi=en.softmax(en.sub(hi,Ei),1),ya=ao(_r,yr.fc2_2),Ua=ao(_r,yr.fc2_3);return{scores:en.unstack(xi,1)[1],regions:ya,points:Ua}})}(dn,w);return dn.dispose(),cr}),S.stage3_onet=Date.now()-z,ve=ce.length>1?en.concat(ce.map(function(dn){return dn.scores})):ce[0].scores,Xe=(Ce=Array).from,[4,ve.data()];case 2:return De=Xe.apply(Ce,[Pn.sent()]),ve.dispose(),tt=De.map(function(dn,cr){return{score:dn,idx:cr}}).filter(function(dn){return dn.score>k}).map(function(dn){return dn.idx}),kt=tt.map(function(dn){var cr=ce[dn].regions.arraySync();return new Hu(cr[0][0],cr[0][1],cr[0][2],cr[0][3])}),At=tt.map(function(dn,cr){return E[dn].calibrate(kt[cr])}),tn=tt.map(function(dn){return De[dn]}),sn=[],wn=[],En=[],At.length>0&&(z=Date.now(),Tn=qu(At,tn,.7,!1),S.stage3_nms=Date.now()-z,sn=Tn.map(function(dn){return At[dn]}),wn=Tn.map(function(dn){return tn[dn]}),En=Tn.map(function(dn,cr){return Array(5).fill(0).map(function(kr,yr){var Br=ce[dn].points.arraySync();return new oa(Br[0][yr]*(sn[cr].width+1)+sn[cr].left,Br[0][yr+5]*(sn[cr].height+1)+sn[cr].top)})})),ce.forEach(function(dn){dn.regions.dispose(),dn.scores.dispose(),dn.points.dispose()}),[2,{boxes:sn,scores:wn,points:En}]}})})}var Wf=function(I){function E(){return I.call(this,"Mtcnn")||this}return Object(Un.c)(E,I),E.prototype.load=function(k){return Object(Un.b)(this,void 0,void 0,function(){return Object(Un.d)(this,function(w){return console.warn("mtcnn is deprecated and will be removed soon"),[2,I.prototype.load.call(this,k)]})})},E.prototype.loadFromDisk=function(k){return Object(Un.b)(this,void 0,void 0,function(){return Object(Un.d)(this,function(w){return console.warn("mtcnn is deprecated and will be removed soon"),[2,I.prototype.loadFromDisk.call(this,k)]})})},E.prototype.forwardInput=function(k,w){return w===void 0&&(w={}),Object(Un.b)(this,void 0,void 0,function(){var S,z,Y,ce,ve,De,Ce,Xe,tt,kt,At,tn,sn,wn,En,Tn,Pn,dn,cr,kr,yr;return Object(Un.d)(this,function(Br){switch(Br.label){case 0:if(!(S=this.params))throw new Error("Mtcnn - load model before inference");if(!(z=k.canvases[0]))throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return Y={},ce=Date.now(),ve=en.tidy(function(){return function(_r){return en.tidy(function(){return en.stack(en.unstack(_r,3).reverse(),3)})}(en.expandDims(en.browser.fromPixels(z)).toFloat())}),De=function(_r){return ve.dispose(),Y.total=Date.now()-ce,_r},Ce=ve.shape.slice(1),Xe=Ce[0],tt=Ce[1],kt=new Dc(w),At=kt.minFaceSize,tn=kt.scaleFactor,sn=kt.maxNumScales,wn=kt.scoreThresholds,En=kt.scaleSteps,Tn=(En||function(_r,hi,Ei){for(var xi=Ei[0],ya=Ei[1],Ua=Wl/_r,Ta=[],Da=Math.min(xi,ya)*Ua,Ra=0;Da>=12;)Ta.push(Ua*Math.pow(hi,Ra)),Da*=hi,Ra+=1;return Ta}(At,tn,[Xe,tt])).filter(function(_r){var hi=Du(_r,[Xe,tt]);return Math.min(hi.width,hi.height)>Wl}).slice(0,sn),Y.scales=Tn,Y.pyramid=Tn.map(function(_r){return Du(_r,[Xe,tt])}),Pn=Date.now(),[4,k0(ve,Tn,wn[0],S.pnet,Y)];case 1:return dn=Br.sent(),Y.total_stage1=Date.now()-Pn,dn.boxes.length?(Y.stage2_numInputBoxes=dn.boxes.length,Pn=Date.now(),[4,Vl(z,dn.boxes,wn[1],S.rnet,Y)]):[2,De({results:[],stats:Y})];case 2:return cr=Br.sent(),Y.total_stage2=Date.now()-Pn,cr.boxes.length?(Y.stage3_numInputBoxes=cr.boxes.length,Pn=Date.now(),[4,Kh(z,cr.boxes,wn[2],S.onet,Y)]):[2,De({results:[],stats:Y})];case 3:return kr=Br.sent(),Y.total_stage3=Date.now()-Pn,yr=kr.boxes.map(function(_r,hi){return za(Bf({},new Xa(kr.scores[hi],new Zc(_r.left/tt,_r.top/Xe,_r.width/tt,_r.height/Xe),{height:Xe,width:tt})),new Ou(kr.points[hi].map(function(Ei){return Ei.sub(new oa(_r.left,_r.top)).div(new oa(_r.width,_r.height))}),{width:_r.width,height:_r.height}))}),[2,De({results:yr,stats:Y})]}})})},E.prototype.forward=function(k,w){return w===void 0&&(w={}),Object(Un.b)(this,void 0,void 0,function(){var S;return Object(Un.d)(this,function(z){switch(z.label){case 0:return S=this.forwardInput,[4,Zr(k)];case 1:return[4,S.apply(this,[z.sent(),w])];case 2:return[2,z.sent().results]}})})},E.prototype.forwardWithStats=function(k,w){return w===void 0&&(w={}),Object(Un.b)(this,void 0,void 0,function(){var S;return Object(Un.d)(this,function(z){switch(z.label){case 0:return S=this.forwardInput,[4,Zr(k)];case 1:return[2,S.apply(this,[z.sent(),w])]}})})},E.prototype.getDefaultModelName=function(){return"mtcnn_model"},E.prototype.extractParamsFromWeigthMap=function(k){return Lp(k)},E.prototype.extractParams=function(k){return Ng(k)},E}(Ui),Vf=.4,Fg=[new oa(1.603231,2.094468),new oa(6.041143,7.080126),new oa(2.882459,3.518061),new oa(4.266906,5.178857),new oa(9.041765,10.66308)],Mm=[117.001,114.697,97.404],qf=function(I){function E(){var k={withSeparableConvs:!0,iouThreshold:Vf,classes:["face"],anchors:Fg,meanRgb:Mm,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};return I.call(this,k)||this}return Object(Un.c)(E,I),Object.defineProperty(E.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),E.prototype.locateFaces=function(k,w){return Object(Un.b)(this,void 0,void 0,function(){return Object(Un.d)(this,function(S){switch(S.label){case 0:return[4,this.detect(k,w)];case 1:return[2,S.sent().map(function(z){return new Xa(z.score,z.relativeBox,{width:z.imageWidth,height:z.imageHeight})})]}})})},E.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},E.prototype.extractParamsFromWeigthMap=function(k){return I.prototype.extractParamsFromWeigthMap.call(this,k)},E}(Uf),ta={ssdMobilenetv1:new ep,tinyFaceDetector:new qf,tinyYolov2:new Gh,mtcnn:new Wf,faceLandmark68Net:new Om,faceLandmark68TinyNet:new Am,faceRecognitionNet:new Jd,faceExpressionNet:new ia,ageGenderNet:new yg},ql=function(I,E){return ta.ssdMobilenetv1.locateFaces(I,E)},Xh=function(I,E){return ta.tinyFaceDetector.locateFaces(I,E)},Fv=function(I,E){return ta.tinyYolov2.locateFaces(I,E)},Rv=function(I,E){return ta.mtcnn.forward(I,E)},zp=function(I){return ta.faceLandmark68Net.detectLandmarks(I)},Hl=function(I){return ta.faceLandmark68TinyNet.detectLandmarks(I)},al=function(I){return ta.faceRecognitionNet.computeFaceDescriptor(I)},rp=function(I){return ta.faceExpressionNet.predictExpressions(I)},Yh=function(I){return ta.ageGenderNet.predictAgeAndGender(I)},Hf=function(I){return ta.ssdMobilenetv1.load(I)},$l=function(I){return ta.tinyFaceDetector.load(I)},Gl=function(I){return ta.mtcnn.load(I)},Tu=function(I){return ta.tinyYolov2.load(I)},Jh=function(I){return ta.faceLandmark68Net.load(I)},$f=function(I){return ta.faceLandmark68TinyNet.load(I)},ol=function(I){return ta.faceRecognitionNet.load(I)},Nc=function(I){return ta.faceExpressionNet.load(I)},Gf=function(I){return ta.ageGenderNet.load(I)},Up=Hf,Kf=ql,Ic=zp,ts=function(I){function E(k,w,S){var z=I.call(this)||this;return z.parentTask=k,z.input=w,z.extractedFaces=S,z}return Object(Un.c)(E,I),E}(il),fc=function(I){function E(){return I!==null&&I.apply(this,arguments)||this}return Object(Un.c)(E,I),E.prototype.run=function(){return Object(Un.b)(this,void 0,void 0,function(){var k,w,S=this;return Object(Un.d)(this,function(z){switch(z.label){case 0:return[4,this.parentTask];case 1:return[4,Su(k=z.sent(),this.input,function(Y){return Object(Un.b)(S,void 0,void 0,function(){return Object(Un.d)(this,function(ce){switch(ce.label){case 0:return[4,Promise.all(Y.map(function(ve){return ta.faceExpressionNet.predictExpressions(ve)}))];case 1:return[2,ce.sent()]}})})},this.extractedFaces)];case 2:return w=z.sent(),[2,k.map(function(Y,ce){return Ko(Y,w[ce])})]}})})},E.prototype.withAgeAndGender=function(){return new jm(this,this.input)},E}(ts),Nu=function(I){function E(){return I!==null&&I.apply(this,arguments)||this}return Object(Un.c)(E,I),E.prototype.run=function(){return Object(Un.b)(this,void 0,void 0,function(){var k,w;return Object(Un.d)(this,function(S){switch(S.label){case 0:return[4,this.parentTask];case 1:return(k=S.sent())?[4,zl(k,this.input,function(z){return ta.faceExpressionNet.predictExpressions(z)},this.extractedFaces)]:[2];case 2:return w=S.sent(),[2,Ko(k,w)]}})})},E.prototype.withAgeAndGender=function(){return new Bm(this,this.input)},E}(ts),hu=function(I){function E(){return I!==null&&I.apply(this,arguments)||this}return Object(Un.c)(E,I),E.prototype.withAgeAndGender=function(){return new ip(this,this.input)},E.prototype.withFaceDescriptors=function(){return new hc(this,this.input)},E}(fc),Qh=function(I){function E(){return I!==null&&I.apply(this,arguments)||this}return Object(Un.c)(E,I),E.prototype.withAgeAndGender=function(){return new Fa(this,this.input)},E.prototype.withFaceDescriptor=function(){return new Xf(this,this.input)},E}(Nu),Wp=function(I){function E(k,w,S){var z=I.call(this)||this;return z.parentTask=k,z.input=w,z.extractedFaces=S,z}return Object(Un.c)(E,I),E}(il),jm=function(I){function E(){return I!==null&&I.apply(this,arguments)||this}return Object(Un.c)(E,I),E.prototype.run=function(){return Object(Un.b)(this,void 0,void 0,function(){var k,w,S=this;return Object(Un.d)(this,function(z){switch(z.label){case 0:return[4,this.parentTask];case 1:return[4,Su(k=z.sent(),this.input,function(Y){return Object(Un.b)(S,void 0,void 0,function(){return Object(Un.d)(this,function(ce){switch(ce.label){case 0:return[4,Promise.all(Y.map(function(ve){return ta.ageGenderNet.predictAgeAndGender(ve)}))];case 1:return[2,ce.sent()]}})})},this.extractedFaces)];case 2:return w=z.sent(),[2,k.map(function(Y,ce){var ve=w[ce],De=ve.age;return Dm(zf(Y,ve.gender,ve.genderProbability),De)})]}})})},E.prototype.withFaceExpressions=function(){return new fc(this,this.input)},E}(Wp),Bm=function(I){function E(){return I!==null&&I.apply(this,arguments)||this}return Object(Un.c)(E,I),E.prototype.run=function(){return Object(Un.b)(this,void 0,void 0,function(){var k,w,S,z,Y;return Object(Un.d)(this,function(ce){switch(ce.label){case 0:return[4,this.parentTask];case 1:return(k=ce.sent())?[4,zl(k,this.input,function(ve){return ta.ageGenderNet.predictAgeAndGender(ve)},this.extractedFaces)]:[2];case 2:return w=ce.sent(),S=w.age,z=w.gender,Y=w.genderProbability,[2,Dm(zf(k,z,Y),S)]}})})},E.prototype.withFaceExpressions=function(){return new Nu(this,this.input)},E}(Wp),ip=function(I){function E(){return I!==null&&I.apply(this,arguments)||this}return Object(Un.c)(E,I),E.prototype.withFaceExpressions=function(){return new hu(this,this.input)},E.prototype.withFaceDescriptors=function(){return new hc(this,this.input)},E}(jm),Fa=function(I){function E(){return I!==null&&I.apply(this,arguments)||this}return Object(Un.c)(E,I),E.prototype.withFaceExpressions=function(){return new Qh(this,this.input)},E.prototype.withFaceDescriptor=function(){return new Xf(this,this.input)},E}(Bm),ap=function(I){function E(k,w){var S=I.call(this)||this;return S.parentTask=k,S.input=w,S}return Object(Un.c)(E,I),E}(il),hc=function(I){function E(){return I!==null&&I.apply(this,arguments)||this}return Object(Un.c)(E,I),E.prototype.run=function(){return Object(Un.b)(this,void 0,void 0,function(){var k;return Object(Un.d)(this,function(w){switch(w.label){case 0:return[4,this.parentTask];case 1:return[4,Su(k=w.sent(),this.input,function(S){return Promise.all(S.map(function(z){return ta.faceRecognitionNet.computeFaceDescriptor(z)}))},null,function(S){return S.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return[2,w.sent().map(function(S,z){return Sm(k[z],S)})]}})})},E.prototype.withFaceExpressions=function(){return new hu(this,this.input)},E.prototype.withAgeAndGender=function(){return new ip(this,this.input)},E}(ap),Xf=function(I){function E(){return I!==null&&I.apply(this,arguments)||this}return Object(Un.c)(E,I),E.prototype.run=function(){return Object(Un.b)(this,void 0,void 0,function(){var k,w;return Object(Un.d)(this,function(S){switch(S.label){case 0:return[4,this.parentTask];case 1:return(k=S.sent())?[4,zl(k,this.input,function(z){return ta.faceRecognitionNet.computeFaceDescriptor(z)},null,function(z){return z.landmarks.align(null,{useDlibAlignment:!0})})]:[2];case 2:return w=S.sent(),[2,Sm(k,w)]}})})},E.prototype.withFaceExpressions=function(){return new Qh(this,this.input)},E.prototype.withAgeAndGender=function(){return new Fa(this,this.input)},E}(ap),Yf=function(I){function E(k,w,S){var z=I.call(this)||this;return z.parentTask=k,z.input=w,z.useTinyLandmarkNet=S,z}return Object(Un.c)(E,I),Object.defineProperty(E.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?ta.faceLandmark68TinyNet:ta.faceLandmark68Net},enumerable:!0,configurable:!0}),E}(il),op=function(I){function E(){return I!==null&&I.apply(this,arguments)||this}return Object(Un.c)(E,I),E.prototype.run=function(){return Object(Un.b)(this,void 0,void 0,function(){var k,w,S,z,Y,ce=this;return Object(Un.d)(this,function(ve){switch(ve.label){case 0:return[4,this.parentTask];case 1:return k=ve.sent(),w=k.map(function(De){return De.detection}),this.input instanceof en.Tensor?[4,ea(this.input,w)]:[3,3];case 2:return z=ve.sent(),[3,5];case 3:return[4,pa(this.input,w)];case 4:z=ve.sent(),ve.label=5;case 5:return S=z,[4,Promise.all(S.map(function(De){return ce.landmarkNet.detectLandmarks(De)}))];case 6:return Y=ve.sent(),S.forEach(function(De){return De instanceof en.Tensor&&De.dispose()}),[2,k.map(function(De,Ce){return za(De,Y[Ce])})]}})})},E.prototype.withFaceExpressions=function(){return new hu(this,this.input)},E.prototype.withAgeAndGender=function(){return new ip(this,this.input)},E.prototype.withFaceDescriptors=function(){return new hc(this,this.input)},E}(Yf),Vp=function(I){function E(){return I!==null&&I.apply(this,arguments)||this}return Object(Un.c)(E,I),E.prototype.run=function(){return Object(Un.b)(this,void 0,void 0,function(){var k,w,S,z,Y;return Object(Un.d)(this,function(ce){switch(ce.label){case 0:return[4,this.parentTask];case 1:return(k=ce.sent())?(w=k.detection,this.input instanceof en.Tensor?[4,ea(this.input,[w])]:[3,3]):[2];case 2:return z=ce.sent(),[3,5];case 3:return[4,pa(this.input,[w])];case 4:z=ce.sent(),ce.label=5;case 5:return S=z,[4,this.landmarkNet.detectLandmarks(S[0])];case 6:return Y=ce.sent(),S.forEach(function(ve){return ve instanceof en.Tensor&&ve.dispose()}),[2,za(k,Y)]}})})},E.prototype.withFaceExpressions=function(){return new Qh(this,this.input)},E.prototype.withAgeAndGender=function(){return new Fa(this,this.input)},E.prototype.withFaceDescriptor=function(){return new Xf(this,this.input)},E}(Yf),qp=function(I){function E(k,w){w===void 0&&(w=new Tc);var S=I.call(this)||this;return S.input=k,S.options=w,S}return Object(Un.c)(E,I),E}(il),Hp=function(I){function E(){return I!==null&&I.apply(this,arguments)||this}return Object(Un.c)(E,I),E.prototype.run=function(){return Object(Un.b)(this,void 0,void 0,function(){var k,w,S,z;return Object(Un.d)(this,function(Y){switch(Y.label){case 0:return w=(k=this).input,(S=k.options)instanceof Dc?[4,ta.mtcnn.forward(w,S)]:[3,2];case 1:return[2,Y.sent().map(function(ce){return ce.detection})];case 2:if(!(z=S instanceof Pp?function(ce){return ta.tinyFaceDetector.locateFaces(ce,S)}:S instanceof Tc?function(ce){return ta.ssdMobilenetv1.locateFaces(ce,S)}:S instanceof $h?function(ce){return ta.tinyYolov2.locateFaces(ce,S)}:null))throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,z(w)]}})})},E.prototype.runAndExtendWithFaceDetections=function(){var k=this;return new Promise(function(w){return Object(Un.b)(k,void 0,void 0,function(){var S;return Object(Un.d)(this,function(z){switch(z.label){case 0:return[4,this.run()];case 1:return S=z.sent(),[2,w(S.map(function(Y){return Bf({},Y)}))]}})})})},E.prototype.withFaceLandmarks=function(k){return k===void 0&&(k=!1),new op(this.runAndExtendWithFaceDetections(),this.input,k)},E.prototype.withFaceExpressions=function(){return new fc(this.runAndExtendWithFaceDetections(),this.input)},E.prototype.withAgeAndGender=function(){return new jm(this.runAndExtendWithFaceDetections(),this.input)},E}(qp),Rg=function(I){function E(){return I!==null&&I.apply(this,arguments)||this}return Object(Un.c)(E,I),E.prototype.run=function(){return Object(Un.b)(this,void 0,void 0,function(){var k,w;return Object(Un.d)(this,function(S){switch(S.label){case 0:return[4,new Hp(this.input,this.options)];case 1:return k=S.sent(),w=k[0],k.forEach(function(z){z.score>w.score&&(w=z)}),[2,w]}})})},E.prototype.runAndExtendWithFaceDetection=function(){var k=this;return new Promise(function(w){return Object(Un.b)(k,void 0,void 0,function(){var S;return Object(Un.d)(this,function(z){switch(z.label){case 0:return[4,this.run()];case 1:return S=z.sent(),[2,w(S?Bf({},S):void 0)]}})})})},E.prototype.withFaceLandmarks=function(k){return k===void 0&&(k=!1),new Vp(this.runAndExtendWithFaceDetection(),this.input,k)},E.prototype.withFaceExpressions=function(){return new Nu(this.runAndExtendWithFaceDetection(),this.input)},E.prototype.withAgeAndGender=function(){return new Bm(this.runAndExtendWithFaceDetection(),this.input)},E}(qp);function $p(I,E){return E===void 0&&(E=new Tc),new Rg(I,E)}function Kl(I,E){return E===void 0&&(E=new Tc),new Hp(I,E)}function Gp(I,E){return Object(Un.b)(this,void 0,void 0,function(){return Object(Un.d)(this,function(k){switch(k.label){case 0:return console.warn("allFacesSsdMobilenetv1 is deprecated and will be removed soon, use the high level api instead"),[4,Kl(I,new Tc(E?{minConfidence:E}:{})).withFaceLandmarks().withFaceDescriptors()];case 1:return[2,k.sent()]}})})}function Zh(I,E){return E===void 0&&(E={}),Object(Un.b)(this,void 0,void 0,function(){return Object(Un.d)(this,function(k){switch(k.label){case 0:return console.warn("allFacesTinyYolov2 is deprecated and will be removed soon, use the high level api instead"),[4,Kl(I,new $h(E)).withFaceLandmarks().withFaceDescriptors()];case 1:return[2,k.sent()]}})})}function Kp(I,E){return E===void 0&&(E={}),Object(Un.b)(this,void 0,void 0,function(){return Object(Un.d)(this,function(k){switch(k.label){case 0:return console.warn("allFacesMtcnn is deprecated and will be removed soon, use the high level api instead"),[4,Kl(I,new Dc(E)).withFaceLandmarks().withFaceDescriptors()];case 1:return[2,k.sent()]}})})}var Pm=Gp;function Lm(I,E){if(I.length!==E.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var k=Array.from(I),w=Array.from(E);return Math.sqrt(k.map(function(S,z){return S-w[z]}).reduce(function(S,z){return S+Math.pow(z,2)},0))}var sp=function(){function I(E,k){k===void 0&&(k=.6),this._distanceThreshold=k;var w=Array.isArray(E)?E:[E];if(!w.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var S=1,z=function(){return"person "+S++};this._labeledDescriptors=w.map(function(Y){if(Y instanceof Mf)return Y;if(Y instanceof Float32Array)return new Mf(z(),[Y]);if(Y.descriptor&&Y.descriptor instanceof Float32Array)return new Mf(z(),[Y.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")})}return Object.defineProperty(I.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),I.prototype.computeMeanDistance=function(E,k){return k.map(function(w){return Lm(w,E)}).reduce(function(w,S){return w+S},0)/(k.length||1)},I.prototype.matchDescriptor=function(E){var k=this;return this.labeledDescriptors.map(function(w){var S=w.descriptors,z=w.label;return new nu(z,k.computeMeanDistance(E,S))}).reduce(function(w,S){return w.distance<S.distance?w:S})},I.prototype.findBestMatch=function(E){var k=this.matchDescriptor(E);return k.distance<this.distanceThreshold?k:new nu("unknown",k.distance)},I.prototype.toJSON=function(){return{distanceThreshold:this.distanceThreshold,labeledDescriptors:this.labeledDescriptors.map(function(E){return E.toJSON()})}},I.fromJSON=function(E){return new I(E.labeledDescriptors.map(function(k){return Mf.fromJSON(k)}),E.distanceThreshold)},I}();function zm(I){var E=new Wf;return E.extractWeights(I),E}function Xp(I){var E=new qf;return E.extractWeights(I),E}function Mg(I,E){var k=new Os(E.width,E.height),w=k.width,S=k.height;if(w<=0||S<=0)throw new Error("resizeResults - invalid dimensions: "+JSON.stringify({width:w,height:S}));if(Array.isArray(I))return I.map(function(ce){return Mg(ce,{width:w,height:S})});if(_c(I)){var z=I.detection.forSize(w,S),Y=I.unshiftedLandmarks.forSize(z.box.width,z.box.height);return za(Bf(I,z),Y)}return Pl(I)?Bf(I,I.detection.forSize(w,S)):I instanceof $s||I instanceof Xa?I.forSize(w,S):I}var sl={withLandmarks:!0,withDescriptors:!0,minConfidence:.5,withTinyNet:!0,MODEL_URLS:{Mobilenetv1Model:"https://raw.githubusercontent.com/ml5js/ml5-data-and-models/main/models/faceapi/ssd_mobilenetv1_model-weights_manifest.json",TinyFaceDetectorModel:"https://raw.githubusercontent.com/ml5js/ml5-data-and-models/main/models/faceapi/tiny_face_detector_model-weights_manifest.json",FaceLandmarkModel:"https://raw.githubusercontent.com/ml5js/ml5-data-and-models/main/models/faceapi/face_landmark_68_model-weights_manifest.json",FaceLandmark68TinyNet:"https://raw.githubusercontent.com/ml5js/ml5-data-and-models/main/models/faceapi/face_landmark_68_tiny_model-weights_manifest.json",FaceRecognitionModel:"https://raw.githubusercontent.com/ml5js/ml5-data-and-models/main/models/faceapi/face_recognition_model-weights_manifest.json"}},Mv=function(){function I(E,k,w){pe()(this,I),this.video=E,this.model=null,this.modelReady=!1,this.detectorOptions=null,this.config={minConfidence:this.checkUndefined(k.minConfidence,sl.minConfidence),withLandmarks:this.checkUndefined(k.withLandmarks,sl.withLandmarks),withDescriptors:this.checkUndefined(k.withDescriptors,sl.withDescriptors),withTinyNet:this.checkUndefined(k.withTinyNet,sl.withTinyNet),MODEL_URLS:{Mobilenetv1Model:this.checkUndefined(k.Mobilenetv1Model,sl.MODEL_URLS.Mobilenetv1Model),TinyFaceDetectorModel:this.checkUndefined(k.TinyFaceDetectorModel,sl.MODEL_URLS.TinyFaceDetectorModel),FaceLandmarkModel:this.checkUndefined(k.FaceLandmarkModel,sl.MODEL_URLS.FaceLandmarkModel),FaceLandmark68TinyNet:this.checkUndefined(k.FaceLandmark68TinyNet,sl.MODEL_URLS.FaceLandmark68TinyNet),FaceRecognitionModel:this.checkUndefined(k.FaceRecognitionModel,sl.MODEL_URLS.FaceRecognitionModel)}},this.ready=at(this.loadModel(),w)}return Te()(I,[{key:"loadModel",value:function(){var E=K()(ke.a.mark(function k(){var w,S,z,Y,ce,ve,De,Ce=this;return ke.a.wrap(function(Xe){for(;;)switch(Xe.prev=Xe.next){case 0:if(w=["Mobilenetv1Model","TinyFaceDetectorModel","FaceLandmarkModel","FaceLandmark68TinyNet","FaceRecognitionModel"],Object.keys(this.config.MODEL_URLS).forEach(function(tt){w.includes(tt)&&(Ce.config.MODEL_URLS[tt]=Pu.getModelPath(Ce.config.MODEL_URLS[tt]))}),S=this.config.MODEL_URLS,z=S.Mobilenetv1Model,Y=S.TinyFaceDetectorModel,ce=S.FaceLandmarkModel,ve=S.FaceRecognitionModel,De=S.FaceLandmark68TinyNet,this.model=P,this.config.withTinyNet===!0?this.detectorOptions=new Pp({minConfidence:this.minConfidence,inputSize:512}):this.detectorOptions=new Tc({minConfidence:this.minConfidence}),this.config.withTinyNet!==!0){Xe.next=12;break}return Xe.next=8,this.model.loadFaceLandmarkTinyModel(De);case 8:return Xe.next=10,this.model.loadTinyFaceDetectorModel(Y);case 10:Xe.next=16;break;case 12:return Xe.next=14,this.model.loadFaceLandmarkModel(ce);case 14:return Xe.next=16,this.model.loadSsdMobilenetv1Model(z);case 16:return Xe.next=18,this.model.loadFaceRecognitionModel(ve);case 18:return this.modelReady=!0,Xe.abrupt("return",this);case 20:case"end":return Xe.stop()}},k,this)}));return function(){return E.apply(this,arguments)}}()},{key:"detect",value:function(){var E=K()(ke.a.mark(function k(w,S,z){var Y,ce,ve;return ke.a.wrap(function(De){for(;;)switch(De.prev=De.next){case 0:if(Y=this.video,ve=this.config,typeof w!="function"){De.next=7;break}Y=this.video,ce=w,De.next=21;break;case 7:if(!(w instanceof HTMLImageElement||w instanceof HTMLCanvasElement||w instanceof HTMLVideoElement||w instanceof ImageData)){De.next=11;break}Y=w,De.next=21;break;case 11:if(we()(w)!=="object"||!(w.elt instanceof HTMLImageElement||w.elt instanceof HTMLCanvasElement||w.elt instanceof HTMLVideoElement||w.elt instanceof ImageData)){De.next=15;break}Y=w.elt,De.next=21;break;case 15:if(!(we()(w)==="object"&&w.canvas instanceof HTMLCanvasElement)){De.next=19;break}Y=w.canvas,De.next=21;break;case 19:if(this.video instanceof HTMLVideoElement){De.next=21;break}throw new Error("No input image provided. If you want to classify a video, pass the video element in the constructor. ");case 21:return we()(S)==="object"?ve=S:typeof S=="function"&&(ce=S),typeof z=="function"&&(ce=z),De.abrupt("return",at(this.detectInternal(Y,ve),ce));case 24:case"end":return De.stop()}},k,this)}));return function(k,w,S){return E.apply(this,arguments)}}()},{key:"detectInternal",value:function(){var E=K()(ke.a.mark(function k(w,S){var z,Y,ce,ve,De=this;return ke.a.wrap(function(Ce){for(;;)switch(Ce.prev=Ce.next){case 0:return Ce.next=2,this.ready;case 2:return Ce.next=4,F.nextFrame();case 4:if(!this.video||this.video.readyState!==0){Ce.next=7;break}return Ce.next=7,new Promise(function(Xe){De.video.onloadeddata=function(){return Xe()}});case 7:if(this.config=this.setReturnOptions(S),z=this.config,Y=z.withLandmarks,ce=z.withDescriptors,!Y){Ce.next=21;break}if(!ce){Ce.next=16;break}return Ce.next=13,this.model.detectAllFaces(w,this.detectorOptions).withFaceLandmarks(this.config.withTinyNet).withFaceDescriptors();case 13:ve=Ce.sent,Ce.next=19;break;case 16:return Ce.next=18,this.model.detectAllFaces(w,this.detectorOptions).withFaceLandmarks(this.config.withTinyNet);case 18:ve=Ce.sent;case 19:Ce.next=30;break;case 21:if(Y){Ce.next=27;break}return Ce.next=24,this.model.detectAllFaces(w);case 24:ve=Ce.sent,Ce.next=30;break;case 27:return Ce.next=29,this.model.detectAllFaces(w,this.detectorOptions).withFaceLandmarks(this.config.withTinyNet).withFaceDescriptors();case 29:ve=Ce.sent;case 30:return ve=this.resizeResults(ve,w.width,w.height),ve=this.landmarkParts(ve),Ce.abrupt("return",ve);case 33:case"end":return Ce.stop()}},k,this)}));return function(k,w){return E.apply(this,arguments)}}()},{key:"detectSingle",value:function(){var E=K()(ke.a.mark(function k(w,S,z){var Y,ce,ve;return ke.a.wrap(function(De){for(;;)switch(De.prev=De.next){case 0:if(Y=this.video,ve=this.config,typeof w!="function"){De.next=7;break}Y=this.video,ce=w,De.next=21;break;case 7:if(!(w instanceof HTMLImageElement||w instanceof HTMLCanvasElement||w instanceof HTMLVideoElement||w instanceof ImageData)){De.next=11;break}Y=w,De.next=21;break;case 11:if(we()(w)!=="object"||!(w.elt instanceof HTMLImageElement||w.elt instanceof HTMLCanvasElement||w.elt instanceof HTMLVideoElement||w.elt instanceof ImageData)){De.next=15;break}Y=w.elt,De.next=21;break;case 15:if(!(we()(w)==="object"&&w.canvas instanceof HTMLCanvasElement)){De.next=19;break}Y=w.canvas,De.next=21;break;case 19:if(this.video instanceof HTMLVideoElement){De.next=21;break}throw new Error("No input image provided. If you want to classify a video, pass the video element in the constructor. ");case 21:return we()(S)==="object"?ve=S:typeof S=="function"&&(ce=S),typeof z=="function"&&(ce=z),De.abrupt("return",at(this.detectSingleInternal(Y,ve),ce));case 24:case"end":return De.stop()}},k,this)}));return function(k,w,S){return E.apply(this,arguments)}}()},{key:"detectSingleInternal",value:function(){var E=K()(ke.a.mark(function k(w,S){var z,Y,ce,ve,De=this;return ke.a.wrap(function(Ce){for(;;)switch(Ce.prev=Ce.next){case 0:return Ce.next=2,this.ready;case 2:return Ce.next=4,F.nextFrame();case 4:if(!this.video||this.video.readyState!==0){Ce.next=7;break}return Ce.next=7,new Promise(function(Xe){De.video.onloadeddata=function(){return Xe()}});case 7:if(this.config=this.setReturnOptions(S),z=this.config,Y=z.withLandmarks,ce=z.withDescriptors,!Y){Ce.next=21;break}if(!ce){Ce.next=16;break}return Ce.next=13,this.model.detectSingleFace(w,this.detectorOptions).withFaceLandmarks(this.config.withTinyNet).withFaceDescriptor();case 13:ve=Ce.sent,Ce.next=19;break;case 16:return Ce.next=18,this.model.detectSingleFace(w,this.detectorOptions).withFaceLandmarks(this.config.withTinyNet);case 18:ve=Ce.sent;case 19:Ce.next=30;break;case 21:if(Y){Ce.next=27;break}return Ce.next=24,this.model.detectSingleFace(w);case 24:ve=Ce.sent,Ce.next=30;break;case 27:return Ce.next=29,this.model.detectSingleFace(w,this.detectorOptions).withFaceLandmarks(this.config.withTinyNet).withFaceDescriptor();case 29:ve=Ce.sent;case 30:return ve=this.resizeResults(ve,w.width,w.height),ve=this.landmarkParts(ve),Ce.abrupt("return",ve);case 33:case"end":return Ce.stop()}},k,this)}));return function(k,w){return E.apply(this,arguments)}}()},{key:"checkUndefined",value:function(E,k){return E!==void 0?E:k}},{key:"setReturnOptions",value:function(E){var k=this,w=Object.assign({},this.config);return["withLandmarks","withDescriptors"].forEach(function(S){E[S]!==void 0?k.config[S]=E[S]:w[S]=k.config[S]}),w}},{key:"resizeResults",value:function(E,k,w){if(k===void 0||w===void 0)throw new Error("width and height must be defined");return this.model.resizeResults(E,{width:k,height:w})}},{key:"landmarkParts",value:function(E){var k;if(Array.isArray(E)===!0)k=E.map(function(S){var z=Object.assign({},S);if(z.landmarks){var Y=z.landmarks;z.parts={mouth:Y.getMouth(),nose:Y.getNose(),leftEye:Y.getLeftEye(),leftEyeBrow:Y.getLeftEyeBrow(),rightEye:Y.getRightEye(),rightEyeBrow:Y.getRightEyeBrow(),jawOutline:Y.getJawOutline()}}else z.parts={mouth:[],nose:[],leftEye:[],leftEyeBrow:[],rightEye:[],rightEyeBrow:[],jawOutline:[]};return z});else if((k=Object.assign({},E)).landmarks){var w=E.landmarks;k.parts={mouth:w.getMouth(),nose:w.getNose(),leftEye:w.getLeftEye(),leftEyeBrow:w.getLeftEyeBrow(),rightEye:w.getRightEye(),rightEyeBrow:w.getRightEyeBrow()}}else k.parts={mouth:[],nose:[],leftEye:[],leftEyeBrow:[],rightEye:[],rightEyeBrow:[]};return k}}]),I}(),jg=function(I,E,k){var w,S={},z=k;I instanceof HTMLVideoElement?w=I:we()(I)==="object"&&I.elt instanceof HTMLVideoElement?w=I.elt:we()(I)==="object"?S=I:typeof I=="function"&&(z=I),we()(E)==="object"?(S=E,console.log(S)):typeof E=="function"&&(z=E);var Y=new Mv(w,S,z);return z?Y:Y.ready},up={k:3,maxIter:5,threshold:.5};function Bg(I){return Xl.apply(this,arguments)}function Xl(){return(Xl=K()(ke.a.mark(function I(E){var k,w;return ke.a.wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return k=F.data.csv(E),S.next=3,k.toArray();case 3:return w=S.sent,S.abrupt("return",w);case 5:case"end":return S.stop()}},I)}))).apply(this,arguments)}function Pg(I){return cp.apply(this,arguments)}function cp(){return(cp=K()(ke.a.mark(function I(E){var k,w;return ke.a.wrap(function(S){for(;;)switch(S.prev=S.next){case 0:if(typeof E!="string"){S.next=6;break}return S.next=3,Bg(E);case 3:k=S.sent,S.next=7;break;case 6:k=E;case 7:return w=k.map(function(z){return Object.values(z)}),S.abrupt("return",w);case 9:case"end":return S.stop()}},I)}))).apply(this,arguments)}var Yp=function(){function I(E,k,w){pe()(this,I),this.config={k:k.k||up.k,maxIter:k.maxIter||up.maxIter,threshold:k.threshold||up.threshold},this.ready=at(this.load(E),w)}return Te()(I,[{key:"load",value:function(){var E=K()(ke.a.mark(function k(w){var S=this;return ke.a.wrap(function(z){for(;;)switch(z.prev=z.next){case 0:return z.next=2,Pg(w);case 2:return this.dataset=z.sent,F.tidy(function(){S.dataTensor=F.tensor2d(S.dataset),S.dataset.forEach(function(Y){var ce=F.tensor1d(Object.values(Y));Y.tensor=ce}),S.centroids=F.tensor2d(Nf(S.dataset,S.config.k,!1)),S.fit()}),z.abrupt("return",this);case 5:case"end":return z.stop()}},k,this)}));return function(k){return E.apply(this,arguments)}}()},{key:"fit",value:function(){this.getClosestCentroids(),this.recenterCentroids();for(var E=I.getEuclidianDistance(this.centroids,this.centroidsOld),k=0;E>this.config.threshold&&k<this.config.maxIter;)this.getClosestCentroids(),this.recenterCentroids(),E=I.getEuclidianDistance(this.centroids,this.centroidsOld),k+=1}},{key:"getClosestCentroids",value:function(){var E=this;this.dataset.forEach(function(k){var w=E.closestCentroid(k.tensor);k.centroid=w})}},{key:"closestCentroid",value:function(E){var k=this;return F.tidy(function(){return k.centroids.squaredDifference(E).sum(1).sqrt().argMin().arraySync()})}},{key:"classify",value:function(E){var k=this;return F.tidy(function(){var w=F.tensor1d(Object.values(E));return k.closestCentroid(w)})}},{key:"recenterCentroids",value:function(){var E=this,k=F.tidy(function(){return E.centroidsOld=E.centroids,F.stack(E.centroids.unstack().map(function(w,S){var z=E.dataset.filter(function(Y){return Y.centroid===S}).map(function(Y){return Y.tensor});return z.length===0?w:z.length===1?z[0]:F.tidy(function(){return F.stack(z).mean(0)})}))});this.centroids=k}}],[{key:"getEuclidianDistance",value:function(E,k){return F.tidy(function(){return F.squaredDifference(E,k).sum().sqrt().dataSync()})[0]}}]),I}(),Lg=function(I,E,k){return new Yp(I,E,k)};function zg(I){return Um.apply(this,arguments)}function Um(){return(Um=K()(ke.a.mark(function I(E){var k,w;return ke.a.wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return k=F.data.csv(E),S.next=3,k.toArray();case 3:return w=S.sent,S.abrupt("return",w);case 5:case"end":return S.stop()}},I)}))).apply(this,arguments)}function Ug(I){return Wg.apply(this,arguments)}function Wg(){return(Wg=K()(ke.a.mark(function I(E){var k,w;return ke.a.wrap(function(S){for(;;)switch(S.prev=S.next){case 0:if(typeof E!="string"){S.next=6;break}return S.next=3,zg(E);case 3:k=S.sent,S.next=7;break;case 6:k=E;case 7:return w=k.map(function(z){return Object.values(z)}),S.abrupt("return",w);case 9:case"end":return S.stop()}},I)}))).apply(this,arguments)}var Jf={eps:50,minPts:3},jv=function(){function I(E,k,w){pe()(this,I),this.config={eps:k.eps||Jf.eps,minPts:k.minPts||Jf.minPts},this.lastClusterId=0,this.status=[],this.ready=at(this.load(E),w)}return Te()(I,[{key:"load",value:function(){var E=K()(ke.a.mark(function k(w){var S=this;return ke.a.wrap(function(z){for(;;)switch(z.prev=z.next){case 0:return z.next=2,Ug(w);case 2:return this.dataset=z.sent,F.tidy(function(){S.dataTensor=F.tensor2d(S.dataset),S.dataset.forEach(function(Y){var ce=F.tensor1d(Object.values(Y));Y.tensor=ce}),S.fit()}),z.abrupt("return",this);case 5:case"end":return z.stop()}},k,this)}));return function(k){return E.apply(this,arguments)}}()},{key:"fit",value:function(){var E=this;this.dataset.forEach(function(k,w){if(k.status===void 0){k.status=0;var S=E.getNeighboursIndices(k);S.length<E.config.minPts?k.status=0:(E.incrementClusterId(),E.extend(w,S))}})}},{key:"extend",value:function(E,k){var w=this;this.dataset[E].clusterid=this.getClusterId(),this.dataset[E].status=this.dataset[E].clusterid,k.forEach(function(S){if(w.dataset[S].status===void 0){w.dataset[S].status=0;var z=w.getNeighboursIndices(w.dataset[S]);z.length>=w.config.minPts&&w.extend(S,z)}w.dataset[S].status<1&&(w.dataset[S].status=w.dataset[E].clusterid,w.dataset[S].clusterid=w.dataset[E].clusterid)})}},{key:"getClusterId",value:function(){return this.lastClusterId}},{key:"incrementClusterId",value:function(){this.lastClusterId+=1}},{key:"getNeighboursIndices",value:function(E){var k=this;try{return F.tidy(function(){var w=F.squaredDifference(E.tensor,k.dataTensor).sum(1).sqrt().topk(k.dataTensor.shape[0],!0),S=w.values,z=w.indices;return F.stack([S.asType("float32"),z.asType("float32")],1).arraySync().filter(function(Y){return Y[0]<=k.config.eps}).reduce(function(Y,ce){return Y.push(ce[1]),Y},[])})||[]}catch(w){console.log("error ".concat(w))}return[]}}]),I}(),Vg=function(I,E,k){return new jv(I,E,k)},ul={miyazaki:"https://raw.githubusercontent.com/Derek-Wds/training_CartoonGAN/master/tfModels/Miyazaki/model.json"},Wm=function(){function I(E,k){pe()(this,I),this.config={modelUrl:E.modelUrl?E.modelUrl:ul.miyazaki,returnTensors:!!E.returnTensors&&E.returnTensors},this.model={},this.ready=!1,this.ready=at(this.loadModel(this.config.modelUrl),k)}return Te()(I,[{key:"loadModel",value:function(){var E=K()(ke.a.mark(function k(w){return ke.a.wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return S.next=2,F.loadGraphModel(w);case 2:return this.model=S.sent,S.abrupt("return",this);case 4:case"end":return S.stop()}},k,this)}));return function(k){return E.apply(this,arguments)}}()},{key:"generate",value:function(){var E=K()(ke.a.mark(function k(w,S){var z,Y;return ke.a.wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:if(Y=S,!Dn(w)){ce.next=5;break}z=w,ce.next=19;break;case 5:if(we()(w)!=="object"||!Dn(w.elt)){ce.next=9;break}z=w.elt,ce.next=19;break;case 9:if(we()(w)!=="object"||!Dn(w.canvas)){ce.next=13;break}z=w.canvas,ce.next=19;break;case 13:if(typeof w!="function"){ce.next=18;break}z=this.video,Y=w,ce.next=19;break;case 18:throw new Error("Detection subject not supported");case 19:return ce.abrupt("return",at(this.generateInternal(z),Y));case 20:case"end":return ce.stop()}},k,this)}));return function(k,w){return E.apply(this,arguments)}}()},{key:"generateInternal",value:function(){var E=K()(ke.a.mark(function k(w){var S,z,Y,ce;return ke.a.wrap(function(ve){for(;;)switch(ve.prev=ve.next){case 0:return ve.next=2,this.ready;case 2:return ve.next=4,F.nextFrame();case 4:if((S=F.browser.fromPixels(w).resizeBilinear([256,256])).shape[0]===256&&S.shape[1]===256){ve.next=9;break}throw new Error("Input size should be ".concat(256,"*").concat(256," but ").concat(S.shape," is found"));case 9:if(S.shape[2]===3){ve.next=11;break}throw new Error("Input color channel number should be 3 but ".concat(S.shape[2]," is found"));case 11:if(S=S.sub(127.5).div(127.5).reshape([1,256,256,3]),z=F.ones([256,256,1]).tile([1,1,1]).mul(255),Y=(Y=(Y=this.model.predict(S)).add(1).mul(127.5).reshape([256,256,3]).floor()).concat(z,2),ce=this.resultFinalize(Y),!this.config.returnTensors){ve.next=19;break}return ve.abrupt("return",ce);case 19:return S.dispose(),Y.dispose(),ve.abrupt("return",ce);case 22:case"end":return ve.stop()}},k,this)}));return function(k){return E.apply(this,arguments)}}()},{key:"resultFinalize",value:function(){var E=K()(ke.a.mark(function k(w){var S,z,Y,ce;return ke.a.wrap(function(ve){for(;;)switch(ve.prev=ve.next){case 0:return S=w,ve.next=3,w.data();case 3:return z=ve.sent,ve.next=6,dr.rawToBlob(z,w.shape[0],w.shape[1]);case 6:return Y=ve.sent,ve.next=9,dr.blobToP5Image(Y);case 9:if(ce=ve.sent,!this.config.returnTensors){ve.next=12;break}return ve.abrupt("return",{tensor:S,raw:z,blob:Y,image:ce});case 12:return ve.abrupt("return",{raw:z,blob:Y,image:ce});case 13:case"end":return ve.stop()}},k,this)}));return function(k){return E.apply(this,arguments)}}()}]),I}(),qg=function(I,E){var k=we()(I)==="object"?I:{},w=typeof I=="function"?I:E;return typeof I=="string"&&(k.modelUrl=I),new Wm(k,w)};/**
    * @license
    * Copyright 2021 Google LLC. All Rights Reserved.
    * Licensed under the Apache License, Version 2.0 (the "License");
    * you may not use this file except in compliance with the License.
    * You may obtain a copy of the License at
    *
    * http://www.apache.org/licenses/LICENSE-2.0
    *
    * Unless required by applicable law or agreed to in writing, software
    * distributed under the License is distributed on an "AS IS" BASIS,
    * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    * See the License for the specific language governing permissions and
    * limitations under the License.
    * =============================================================================
    */function Qf(I,E,k,w){return new(k||(k=Promise))(function(S,z){function Y(De){try{ve(w.next(De))}catch(Ce){z(Ce)}}function ce(De){try{ve(w.throw(De))}catch(Ce){z(Ce)}}function ve(De){var Ce;De.done?S(De.value):(Ce=De.value,Ce instanceof k?Ce:new k(function(Xe){Xe(Ce)})).then(Y,ce)}ve((w=w.apply(I,[])).next())})}function cl(I,E){var k,w,S,z,Y={label:0,sent:function(){if(1&S[0])throw S[1];return S[1]},trys:[],ops:[]};return z={next:ce(0),throw:ce(1),return:ce(2)},typeof Symbol=="function"&&(z[Symbol.iterator]=function(){return this}),z;function ce(ve){return function(De){return function(Ce){if(k)throw new TypeError("Generator is already executing.");for(;Y;)try{if(k=1,w&&(S=2&Ce[0]?w.return:Ce[0]?w.throw||((S=w.return)&&S.call(w),0):w.next)&&!(S=S.call(w,Ce[1])).done)return S;switch(w=0,S&&(Ce=[2&Ce[0],S.value]),Ce[0]){case 0:case 1:S=Ce;break;case 4:return Y.label++,{value:Ce[1],done:!1};case 5:Y.label++,w=Ce[1],Ce=[0];continue;case 7:Ce=Y.ops.pop(),Y.trys.pop();continue;default:if(!(S=(S=Y.trys).length>0&&S[S.length-1])&&(Ce[0]===6||Ce[0]===2)){Y=0;continue}if(Ce[0]===3&&(!S||Ce[1]>S[0]&&Ce[1]<S[3])){Y.label=Ce[1];break}if(Ce[0]===6&&Y.label<S[1]){Y.label=S[1],S=Ce;break}if(S&&Y.label<S[2]){Y.label=S[2],Y.ops.push(Ce);break}S[2]&&Y.ops.pop(),Y.trys.pop();continue}Ce=E.call(I,Y)}catch(Xe){Ce=[6,Xe],w=0}finally{k=S=0}if(5&Ce[0])throw Ce[1];return{value:Ce[0]?Ce[1]:void 0,done:!0}}([ve,De])}}}var Jp=function(I){for(var E=[],k=0,w=I;k<w.length;k++){var S=w[k];E.push(S)}return E},Vm=function(){this.parent=null,this.children={},this.end=!1,this.word=[[],0,0]},dc=function(){function I(){this.root=new Vm}return I.prototype.insert=function(E,k,w){for(var S=this.root,z=Jp(E),Y=0;Y<z.length;Y++)S.children[z[Y]]||(S.children[z[Y]]=new Vm,S.children[z[Y]].parent=S,S.children[z[Y]].word[0]=S.word[0].concat(z[Y])),S=S.children[z[Y]],Y===z.length-1&&(S.end=!0,S.word[1]=k,S.word[2]=w)},I.prototype.commonPrefixSearch=function(E){for(var k=[],w=this.root.children[E[0]],S=0;S<E.length&&w;S++)w.end&&k.push(w.word),w=w.children[E[S+1]];return k.length||k.push([[E[0]],0,0]),k},I}(),qm="",Hg=6,Yl=function(){function I(E,k){k===void 0&&(k=Hg),this.vocabulary=E,this.reservedSymbolsCount=k,this.trie=new dc;for(var w=this.reservedSymbolsCount;w<this.vocabulary.length;w++)this.trie.insert(this.vocabulary[w][0],this.vocabulary[w][1],w)}return I.prototype.encode=function(E){var k=[],w=[],S=[];E=function(dn){var cr=dn.normalize("NFKC");return cr.length>0?qm+cr.replace(/ /g,qm):cr}(E);for(var z=Jp(E),Y=0;Y<=z.length;Y++)k.push({}),w.push(0),S.push(0);for(Y=0;Y<z.length;Y++)for(var ce=this.trie.commonPrefixSearch(z.slice(Y)),ve=0;ve<ce.length;ve++){var De=ce[ve],Ce={key:De[0],score:De[1],index:De[2]};k[Y+(Xe=De[0].length)][Y]==null&&(k[Y+Xe][Y]=[]),k[Y+Xe][Y].push(Ce)}for(var Xe=0;Xe<=z.length;Xe++)for(var tt in k[Xe]){var kt=k[Xe][tt];for(ve=0;ve<kt.length;ve++){var At=kt[ve],tn=At.score+S[Xe-At.key.length];(S[Xe]===0||tn>=S[Xe])&&(S[Xe]=tn,w[Xe]=kt[ve].index)}}for(var sn=[],wn=w.length-1;wn>0;)sn.push(w[wn]),wn-=this.vocabulary[w[wn]][0].length;var En=[],Tn=!1;for(Y=0;Y<sn.length;Y++){var Pn=sn[Y];Tn&&Pn===0||En.push(Pn),Tn=Pn===0}return En.reverse()},I}();function Bv(I){return Qf(this,void 0,void 0,function(){var E;return cl(this,function(k){switch(k.label){case 0:return[4,ed(I)];case 1:return E=k.sent(),[2,new Yl(E)]}})})}function ed(I){return Qf(this,void 0,void 0,function(){return cl(this,function(E){switch(E.label){case 0:return[4,Ye.util.fetch(I)];case 1:return[2,E.sent().json()]}})})}function td(I){return Qf(this,void 0,void 0,function(){var E;return cl(this,function(k){switch(k.label){case 0:return[4,(E=new Jl).load(I)];case 1:return k.sent(),[2,E]}})})}var Jl=function(){function I(){}return I.prototype.loadModel=function(E){return Qf(this,void 0,void 0,function(){return cl(this,function(k){return[2,E?Object(Pt.loadGraphModel)(E):Object(Pt.loadGraphModel)("https://tfhub.dev/tensorflow/tfjs-model/universal-sentence-encoder-lite/1/default/1",{fromTFHub:!0})]})})},I.prototype.load=function(E){return E===void 0&&(E={}),Qf(this,void 0,void 0,function(){var k,w,S;return cl(this,function(z){switch(z.label){case 0:return[4,Promise.all([this.loadModel(E.modelUrl),ed(E.vocabUrl||"https://storage.googleapis.com/tfjs-models/savedmodel/universal_sentence_encoder/vocab.json")])];case 1:return k=z.sent(),w=k[0],S=k[1],this.model=w,this.tokenizer=new Yl(S),[2]}})})},I.prototype.embed=function(E){return Qf(this,void 0,void 0,function(){var k,w,S,z,Y,ce,ve,De,Ce=this;return cl(this,function(Xe){switch(Xe.label){case 0:for(typeof E=="string"&&(E=[E]),k=E.map(function(tt){return Ce.tokenizer.encode(tt)}),w=k.map(function(tt,kt){return tt.map(function(At,tn){return[kt,tn]})}),S=[],z=0;z<w.length;z++)S=S.concat(w[z]);return Y=Object(Ye.tensor2d)(S,[S.length,2],"int32"),ce=Object(Ye.tensor1d)(Ye.util.flatten(k),"int32"),ve={indices:Y,values:ce},[4,this.model.executeAsync(ve)];case 1:return De=Xe.sent(),Y.dispose(),ce.dispose(),[2,De]}})})},I}(),$g={withTokenizer:!1},Zf=function(){function I(E,k){pe()(this,I),this.model=null,this.tokenizer=null,this.config={withTokenizer:E.withTokenizer||$g.withTokenizer},at(this.loadModel(),k)}return Te()(I,[{key:"loadModel",value:function(){var E=K()(ke.a.mark(function k(){return ke.a.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:if(this.config.withTokenizer!==!0){w.next=4;break}return w.next=3,Bv();case 3:this.tokenizer=w.sent;case 4:return w.next=6,td();case 6:return this.model=w.sent,w.abrupt("return",this);case 8:case"end":return w.stop()}},k,this)}));return function(){return E.apply(this,arguments)}}()},{key:"predict",value:function(E,k){return at(this.predictInternal(E),k)}},{key:"predictInternal",value:function(){var E=K()(ke.a.mark(function k(w){var S,z;return ke.a.wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:return Y.prev=0,Y.next=3,this.model.embed(w);case 3:return S=Y.sent,Y.next=6,S.array();case 6:return z=Y.sent,S.dispose(),Y.abrupt("return",z);case 11:return Y.prev=11,Y.t0=Y.catch(0),console.error(Y.t0),Y.abrupt("return",Y.t0);case 15:case"end":return Y.stop()}},k,this,[[0,11]])}));return function(k){return E.apply(this,arguments)}}()},{key:"encode",value:function(E,k){return at(this.encodeInternal(E),k)}},{key:"encodeInternal",value:function(){var E=K()(ke.a.mark(function k(w){return ke.a.wrap(function(S){for(;;)switch(S.prev=S.next){case 0:if(this.config.withTokenizer!==!0){S.next=2;break}return S.abrupt("return",this.tokenizer.encode(w));case 2:return console.error('withTokenizer must be set to true - please pass "withTokenizer:true" as an option in the constructor'),S.abrupt("return",!1);case 4:case"end":return S.stop()}},k,this)}));return function(k){return E.apply(this,arguments)}}()}]),I}(),pc=function(I,E){var k=we()(I)==="object"?I:{};return new Zf(k,typeof I=="function"?I:E)};/**
    * @license
    * Copyright 2020 Google LLC. All Rights Reserved.
    * Licensed under the Apache License, Version 2.0 (the "License");
    * you may not use this file except in compliance with the License.
    * You may obtain a copy of the License at
    *
    * http://www.apache.org/licenses/LICENSE-2.0
    *
    * Unless required by applicable law or agreed to in writing, software
    * distributed under the License is distributed on an "AS IS" BASIS,
    * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    * See the License for the specific language governing permissions and
    * limitations under the License.
    * =============================================================================
    */const nd=I=>{I.startEndTensor.dispose(),I.startPoint.dispose(),I.endPoint.dispose()},lp=I=>({startEndTensor:I,startPoint:Object(Ye.slice)(I,[0,0],[-1,2]),endPoint:Object(Ye.slice)(I,[0,2],[-1,2])}),Qp=(I,E)=>{const k=Object(Ye.mul)(I.startPoint,E),w=Object(Ye.mul)(I.endPoint,E),S=Object(Ye.concat2d)([k,w],1);return lp(S)},Hm={strides:[8,16],anchors:[2,6]},Gg=6;function ns(I,E){let k,w,S;if(I.topLeft instanceof Ye.Tensor&&I.bottomRight instanceof Ye.Tensor){const[Y,ce]=Object(Ye.tidy)(()=>[Object(Ye.concat)([Object(Ye.sub)(E-1,I.topLeft.slice(0,1)),I.topLeft.slice(1,1)]),Object(Ye.concat)([Object(Ye.sub)(E-1,I.bottomRight.slice(0,1)),I.bottomRight.slice(1,1)])]);k=Y,w=ce,I.landmarks!=null&&(S=Object(Ye.tidy)(()=>{const ve=Object(Ye.sub)(Object(Ye.tensor1d)([E-1,0]),I.landmarks),De=Object(Ye.tensor1d)([1,-1]);return Object(Ye.mul)(ve,De)}))}else{const[Y,ce]=I.topLeft,[ve,De]=I.bottomRight;k=[E-1-Y,ce],w=[E-1-ve,De],I.landmarks!=null&&(S=I.landmarks.map(Ce=>[E-1-Ce[0],Ce[1]]))}const z={topLeft:k,bottomRight:w};return S!=null&&(z.landmarks=S),I.probability!=null&&(z.probability=I.probability instanceof Ye.Tensor?I.probability.clone():I.probability),z}function Kg(I,E){return Object(Ye.tidy)(()=>{let k;return k=I.hasOwnProperty("box")?I.box:I,Qp(k,E).startEndTensor.squeeze()})}class rd{constructor(E,k,w,S,z,Y){this.blazeFaceModel=E,this.width=k,this.height=w,this.maxFaces=S,this.anchorsData=function(ce,ve,De){const Ce=[];for(let Xe=0;Xe<De.strides.length;Xe++){const tt=De.strides[Xe],kt=Math.floor((ve+tt-1)/tt),At=Math.floor((ce+tt-1)/tt),tn=De.anchors[Xe];for(let sn=0;sn<kt;sn++){const wn=tt*(sn+.5);for(let En=0;En<At;En++){const Tn=tt*(En+.5);for(let Pn=0;Pn<tn;Pn++)Ce.push([Tn,wn])}}}return Ce}(k,w,Hm),this.anchors=Object(Ye.tensor2d)(this.anchorsData),this.inputSizeData=[k,w],this.inputSize=Object(Ye.tensor1d)([k,w]),this.iouThreshold=z,this.scoreThreshold=Y}async getBoundingBoxes(E,k,w=!0){const[S,z,Y]=Object(Ye.tidy)(()=>{const tn=E.resizeBilinear([this.width,this.height]),sn=Object(Ye.mul)(Object(Ye.sub)(tn.div(255),.5),2),wn=this.blazeFaceModel.predict(sn).squeeze(),En=function(Pn,dn,cr){const kr=Object(Ye.slice)(Pn,[0,1],[-1,2]),yr=Object(Ye.add)(kr,dn),Br=Object(Ye.slice)(Pn,[0,3],[-1,2]),_r=Object(Ye.div)(Br,cr),hi=Object(Ye.div)(yr,cr),Ei=Object(Ye.div)(_r,2),xi=Object(Ye.sub)(hi,Ei),ya=Object(Ye.add)(hi,Ei),Ua=Object(Ye.mul)(xi,cr),Ta=Object(Ye.mul)(ya,cr);return Object(Ye.concat2d)([Ua,Ta],1)}(wn,this.anchors,this.inputSize),Tn=Object(Ye.slice)(wn,[0,0],[-1,1]);return[wn,En,Object(Ye.sigmoid)(Tn).squeeze()]}),ce=console.warn;console.warn=()=>{};const ve=Ye.image.nonMaxSuppression(z,Y,this.maxFaces,this.iouThreshold,this.scoreThreshold);console.warn=ce;const De=await ve.array();ve.dispose();let Ce=De.map(tn=>Object(Ye.slice)(z,[tn,0],[1,-1]));k||(Ce=await Promise.all(Ce.map(async tn=>{const sn=await tn.array();return tn.dispose(),sn})));const Xe=E.shape[1],tt=E.shape[2];let kt;kt=k?Object(Ye.div)([tt,Xe],this.inputSize):[tt/this.inputSizeData[0],Xe/this.inputSizeData[1]];const At=[];for(let tn=0;tn<Ce.length;tn++){const sn=Ce[tn],wn=Object(Ye.tidy)(()=>{const En=lp(sn instanceof Ye.Tensor?sn:Object(Ye.tensor2d)(sn));if(!w)return En;const Tn=De[tn];let Pn;return Pn=k?this.anchors.slice([Tn,0],[1,2]):this.anchorsData[Tn],{box:En,landmarks:Object(Ye.slice)(S,[Tn,Gg-1],[1,-1]).squeeze().reshape([Gg,-1]),probability:Object(Ye.slice)(Y,[Tn],[1]),anchor:Pn}});At.push(wn)}return z.dispose(),Y.dispose(),S.dispose(),{boxes:At,scaleFactor:kt}}async estimateFaces(E,k=!1,w=!1,S=!0){const[,z]=function(De){return De instanceof Ye.Tensor?[De.shape[0],De.shape[1]]:[De.height,De.width]}(E),Y=Object(Ye.tidy)(()=>(E instanceof Ye.Tensor||(E=Ye.browser.fromPixels(E)),E.toFloat().expandDims(0))),{boxes:ce,scaleFactor:ve}=await this.getBoundingBoxes(Y,k,S);return Y.dispose(),k?ce.map(De=>{const Ce=Kg(De,ve);let Xe={topLeft:Ce.slice([0],[2]),bottomRight:Ce.slice([2],[2])};if(S){const{landmarks:tt,probability:kt,anchor:At}=De,tn=tt.add(At).mul(ve);Xe.landmarks=tn,Xe.probability=kt}return w&&(Xe=ns(Xe,z)),Xe}):Promise.all(ce.map(async De=>{const Ce=Kg(De,ve);let Xe;if(S){const[tt,kt,At]=await Promise.all([De.landmarks,Ce,De.probability].map(async Tn=>Tn.array())),tn=De.anchor,[sn,wn]=ve,En=tt.map(Tn=>[(Tn[0]+tn[0])*sn,(Tn[1]+tn[1])*wn]);Xe={topLeft:kt.slice(0,2),bottomRight:kt.slice(2),landmarks:En,probability:At},nd(De.box),De.landmarks.dispose(),De.probability.dispose()}else{const tt=await Ce.array();Xe={topLeft:tt.slice(0,2),bottomRight:tt.slice(2)}}return Ce.dispose(),w&&(Xe=ns(Xe,z)),Xe}))}}const Xg="https://tfhub.dev/tensorflow/tfjs-model/blazeface/1/default/1",Zp={silhouette:[10,338,297,332,284,251,389,356,454,323,361,288,397,365,379,378,400,377,152,148,176,149,150,136,172,58,132,93,234,127,162,21,54,103,67,109],lipsUpperOuter:[61,185,40,39,37,0,267,269,270,409,291],lipsLowerOuter:[146,91,181,84,17,314,405,321,375,291],lipsUpperInner:[78,191,80,81,82,13,312,311,310,415,308],lipsLowerInner:[78,95,88,178,87,14,317,402,318,324,308],rightEyeUpper0:[246,161,160,159,158,157,173],rightEyeLower0:[33,7,163,144,145,153,154,155,133],rightEyeUpper1:[247,30,29,27,28,56,190],rightEyeLower1:[130,25,110,24,23,22,26,112,243],rightEyeUpper2:[113,225,224,223,222,221,189],rightEyeLower2:[226,31,228,229,230,231,232,233,244],rightEyeLower3:[143,111,117,118,119,120,121,128,245],rightEyebrowUpper:[156,70,63,105,66,107,55,193],rightEyebrowLower:[35,124,46,53,52,65],leftEyeUpper0:[466,388,387,386,385,384,398],leftEyeLower0:[263,249,390,373,374,380,381,382,362],leftEyeUpper1:[467,260,259,257,258,286,414],leftEyeLower1:[359,255,339,254,253,252,256,341,463],leftEyeUpper2:[342,445,444,443,442,441,413],leftEyeLower2:[446,261,448,449,450,451,452,453,464],leftEyeLower3:[372,340,346,347,348,349,350,357,465],leftEyebrowUpper:[383,300,293,334,296,336,285,417],leftEyebrowLower:[265,353,276,283,282,295],midwayBetweenEyes:[168],noseTip:[1],noseBottom:[2],noseRightCorner:[98],noseLeftCorner:[327],rightCheek:[205],leftCheek:[425]};function Ql(I){I!=null&&I.startPoint!=null&&(I.startEndTensor.dispose(),I.startPoint.dispose(),I.endPoint.dispose())}function fp(I,E,k){return{startEndTensor:I,startPoint:E??Object(Ye.slice)(I,[0,0],[-1,2]),endPoint:k??Object(Ye.slice)(I,[0,2],[-1,2])}}function ll(I){return Object(Ye.tidy)(()=>{const E=Object(Ye.sub)(I.endPoint,I.startPoint);return Object(Ye.abs)(E)})}function Yg(I,E=1.5){return Object(Ye.tidy)(()=>{const k=function(ce){return Object(Ye.tidy)(()=>{const ve=Object(Ye.div)(Object(Ye.sub)(ce.endPoint,ce.startPoint),2);return Object(Ye.add)(ce.startPoint,ve)})}(I),w=ll(I),S=Object(Ye.mul)(Object(Ye.div)(w,2),E),z=Object(Ye.sub)(k,S),Y=Object(Ye.add)(k,S);return fp(Object(Ye.concat2d)([z,Y],1),z,Y)})}const em=468,tm=.25;class $m{constructor(E,k,w,S,z,Y){this.regionsOfInterest=[],this.runsWithoutFaceDetector=0,this.boundingBoxDetector=E,this.meshDetector=k,this.meshWidth=w,this.meshHeight=S,this.maxContinuousChecks=z,this.maxFaces=Y}async predict(E){if(this.shouldUpdateRegionsOfInterest()){const{boxes:S,scaleFactor:z}=await this.boundingBoxDetector.getBoundingBoxes(E,!0,!1);if(S.length===0)return z.dispose(),this.clearAllRegionsOfInterest(),null;const Y=S.map(ce=>Yg(function(ve,De){const Ce=Object(Ye.mul)(ve.startPoint,De),Xe=Object(Ye.mul)(ve.endPoint,De);return fp(Object(Ye.concat2d)([Ce,Xe],1))}(ce,z)));S.forEach(Ql),this.updateRegionsOfInterest(Y),this.runsWithoutFaceDetector=0}else this.runsWithoutFaceDetector++;return Object(Ye.tidy)(()=>this.regionsOfInterest.map((k,w)=>{const S=function(Xe,tt,kt){const At=tt.shape[1],tn=tt.shape[2],sn=Xe.startEndTensor;return Object(Ye.tidy)(()=>{const wn=Object(Ye.concat2d)([sn.slice([0,1],[-1,1]),sn.slice([0,0],[-1,1]),sn.slice([0,3],[-1,1]),sn.slice([0,2],[-1,1])],0),En=Object(Ye.div)(wn.transpose(),[At,tn,At,tn]);return Ye.image.cropAndResize(tt,En,[0],kt)})}(k,E,[this.meshHeight,this.meshWidth]).div(255),[,z,Y]=this.meshDetector.predict(S),ce=Object(Ye.reshape)(Y,[-1,3]),ve=Object(Ye.div)(ll(k),[this.meshWidth,this.meshHeight]),De=Object(Ye.mul)(ce,ve.concat(Object(Ye.tensor2d)([1],[1,1]),1)).add(k.startPoint.concat(Object(Ye.tensor2d)([0],[1,1]),1)),Ce=this.calculateLandmarksBoundingBox(De);return Ql(this.regionsOfInterest[w]),this.regionsOfInterest[w]=Ce,{coords:ce,scaledCoords:De,box:Ce,flag:z.squeeze()}}))}updateRegionsOfInterest(E){for(let k=0;k<E.length;k++){const w=E[k],S=this.regionsOfInterest[k];let z=0;if(S&&S.startPoint){const[Y,ce,ve,De]=w.startEndTensor.arraySync()[0],[Ce,Xe,tt,kt]=S.startEndTensor.arraySync()[0],At=Math.max(Y,Ce),tn=Math.max(ce,Xe),sn=(Math.min(ve,tt)-At)*(Math.min(De,kt)-tn);z=sn/((ve-Y)*(De-ce)+(tt-Ce)*(kt-ce)-sn)}z>tm?Ql(w):(this.regionsOfInterest[k]=w,Ql(S))}for(let k=E.length;k<this.regionsOfInterest.length;k++)Ql(this.regionsOfInterest[k]);this.regionsOfInterest=this.regionsOfInterest.slice(0,E.length)}clearRegionOfInterest(E){this.regionsOfInterest[E]!=null&&(Ql(this.regionsOfInterest[E]),this.regionsOfInterest=[...this.regionsOfInterest.slice(0,E),...this.regionsOfInterest.slice(E+1)])}clearAllRegionsOfInterest(){for(let E=0;E<this.regionsOfInterest.length;E++)Ql(this.regionsOfInterest[E]);this.regionsOfInterest=[]}shouldUpdateRegionsOfInterest(){const E=this.regionsOfInterest.length,k=E===0;return this.maxFaces===1||k?k:E!==this.maxFaces&&this.runsWithoutFaceDetector>=this.maxContinuousChecks}calculateLandmarksBoundingBox(E){const k=E.slice([0,0],[em,1]),w=E.slice([0,1],[em,1]);return Yg(fp(Object(Ye.stack)([k.min(),w.min(),k.max(),w.max()]).expandDims(0)))}}const Fc=[[.499976992607117,.652534008026123],[.500025987625122,.547487020492554],[.499974012374878,.602371990680695],[.482113003730774,.471979022026062],[.500150978565216,.527155995368958],[.499909996986389,.498252987861633],[.499523013830185,.40106201171875],[.289712011814117,.380764007568359],[.499954998493195,.312398016452789],[.499987006187439,.269918978214264],[.500023007392883,.107050001621246],[.500023007392883,.666234016418457],[.5000159740448,.679224014282227],[.500023007392883,.692348003387451],[.499976992607117,.695277988910675],[.499976992607117,.70593398809433],[.499976992607117,.719385027885437],[.499976992607117,.737019002437592],[.499967992305756,.781370997428894],[.499816000461578,.562981009483337],[.473773002624512,.573909997940063],[.104906998574734,.254140973091125],[.365929991006851,.409575998783112],[.338757991790771,.41302502155304],[.311120003461838,.409460008144379],[.274657994508743,.389131009578705],[.393361985683441,.403706014156342],[.345234006643295,.344011008739471],[.370094001293182,.346076011657715],[.319321990013123,.347265005111694],[.297903001308441,.353591024875641],[.24779200553894,.410809993743896],[.396889001131058,.842755019664764],[.280097991228104,.375599980354309],[.106310002505779,.399955987930298],[.2099249958992,.391353011131287],[.355807989835739,.534406006336212],[.471751004457474,.65040397644043],[.474155008792877,.680191993713379],[.439785003662109,.657229006290436],[.414617002010345,.66654098033905],[.450374007225037,.680860996246338],[.428770989179611,.682690978050232],[.374971002340317,.727805018424988],[.486716985702515,.547628998756409],[.485300987958908,.527395009994507],[.257764995098114,.314490020275116],[.401223003864288,.455172002315521],[.429818987846375,.548614978790283],[.421351999044418,.533740997314453],[.276895999908447,.532056987285614],[.483370006084442,.499586999416351],[.33721199631691,.282882988452911],[.296391993761063,.293242990970612],[.169294998049736,.193813979625702],[.447580009698868,.302609980106354],[.392390012741089,.353887975215912],[.354490011930466,.696784019470215],[.067304998636246,.730105042457581],[.442739009857178,.572826027870178],[.457098007202148,.584792017936707],[.381974011659622,.694710969924927],[.392388999462128,.694203019142151],[.277076005935669,.271932005882263],[.422551989555359,.563233017921448],[.385919004678726,.281364023685455],[.383103013038635,.255840003490448],[.331431001424789,.119714021682739],[.229923993349075,.232002973556519],[.364500999450684,.189113974571228],[.229622006416321,.299540996551514],[.173287004232407,.278747975826263],[.472878992557526,.666198015213013],[.446828007698059,.668527007102966],[.422762006521225,.673889994621277],[.445307999849319,.580065965652466],[.388103008270264,.693961024284363],[.403039008378983,.706539988517761],[.403629004955292,.693953037261963],[.460041999816895,.557139039039612],[.431158006191254,.692366003990173],[.452181994915009,.692366003990173],[.475387006998062,.692366003990173],[.465828001499176,.779190003871918],[.472328990697861,.736225962638855],[.473087012767792,.717857003211975],[.473122000694275,.704625964164734],[.473033010959625,.695277988910675],[.427942007780075,.695277988910675],[.426479011774063,.703539967536926],[.423162013292313,.711845993995667],[.4183090031147,.720062971115112],[.390094995498657,.639572978019714],[.013953999616206,.560034036636353],[.499913990497589,.58014702796936],[.413199990987778,.69539999961853],[.409626007080078,.701822996139526],[.468080013990402,.601534962654114],[.422728985548019,.585985004901886],[.463079988956451,.593783974647522],[.37211999297142,.47341400384903],[.334562003612518,.496073007583618],[.411671012639999,.546965003013611],[.242175996303558,.14767599105835],[.290776997804642,.201445996761322],[.327338010072708,.256527006626129],[.399509996175766,.748921036720276],[.441727995872498,.261676013469696],[.429764986038208,.187834024429321],[.412198007106781,.108901023864746],[.288955003023148,.398952007293701],[.218936994671822,.435410976409912],[.41278201341629,.398970007896423],[.257135003805161,.355440020561218],[.427684992551804,.437960982322693],[.448339998722076,.536936044692993],[.178560003638268,.45755398273468],[.247308000922203,.457193970680237],[.286267012357712,.467674970626831],[.332827985286713,.460712015628815],[.368755996227264,.447206974029541],[.398963987827301,.432654976844788],[.476410001516342,.405806005001068],[.189241006970406,.523923993110657],[.228962004184723,.348950982093811],[.490725994110107,.562400996685028],[.404670000076294,.485132992267609],[.019469000399113,.401564002037048],[.426243007183075,.420431017875671],[.396993011236191,.548797011375427],[.266469985246658,.376977026462555],[.439121007919312,.51895797252655],[.032313998788595,.644356966018677],[.419054001569748,.387154996395111],[.462783008813858,.505746960639954],[.238978996872902,.779744982719421],[.198220998048782,.831938028335571],[.107550002634525,.540755033493042],[.183610007166862,.740257024765015],[.134409993886948,.333683013916016],[.385764002799988,.883153975009918],[.490967005491257,.579378008842468],[.382384985685349,.508572995662689],[.174399003386497,.397670984268188],[.318785011768341,.39623498916626],[.343364000320435,.400596976280212],[.396100014448166,.710216999053955],[.187885001301765,.588537991046906],[.430987000465393,.944064974784851],[.318993002176285,.898285031318665],[.266247987747192,.869701027870178],[.500023007392883,.190576016902924],[.499976992607117,.954452991485596],[.366169989109039,.398822009563446],[.393207013607025,.39553701877594],[.410373002290726,.391080021858215],[.194993004202843,.342101991176605],[.388664990663528,.362284004688263],[.365961998701096,.355970978736877],[.343364000320435,.355356991291046],[.318785011768341,.35834002494812],[.301414996385574,.363156020641327],[.058132998645306,.319076001644135],[.301414996385574,.387449026107788],[.499987989664078,.618434011936188],[.415838003158569,.624195992946625],[.445681989192963,.566076993942261],[.465844005346298,.620640993118286],[.49992299079895,.351523995399475],[.288718998432159,.819945991039276],[.335278987884521,.852819979190826],[.440512001514435,.902418971061707],[.128294005990028,.791940987110138],[.408771991729736,.373893976211548],[.455606997013092,.451801002025604],[.499877005815506,.908990025520325],[.375436991453171,.924192011356354],[.11421000212431,.615022003650665],[.448662012815475,.695277988910675],[.4480200111866,.704632043838501],[.447111994028091,.715808033943176],[.444831997156143,.730794012546539],[.430011987686157,.766808986663818],[.406787008047104,.685672998428345],[.400738000869751,.681069016456604],[.392399996519089,.677703022956848],[.367855995893478,.663918972015381],[.247923001646996,.601333022117615],[.452769994735718,.420849978923798],[.43639200925827,.359887003898621],[.416164010763168,.368713974952698],[.413385987281799,.692366003990173],[.228018000721931,.683571994304657],[.468268007040024,.352671027183533],[.411361992359161,.804327011108398],[.499989002943039,.469825029373169],[.479153990745544,.442654013633728],[.499974012374878,.439637005329132],[.432112008333206,.493588984012604],[.499886006116867,.866917014122009],[.49991300702095,.821729004383087],[.456548988819122,.819200992584229],[.344549000263214,.745438992977142],[.37890899181366,.574010014533997],[.374292999505997,.780184984207153],[.319687992334366,.570737957954407],[.357154995203018,.604269981384277],[.295284003019333,.621580958366394],[.447750002145767,.862477004528046],[.410986006259918,.508723020553589],[.31395098567009,.775308012962341],[.354128003120422,.812552988529205],[.324548006057739,.703992962837219],[.189096003770828,.646299958229065],[.279776990413666,.71465802192688],[.1338230073452,.682700991630554],[.336768001317978,.644733011722565],[.429883986711502,.466521978378296],[.455527991056442,.548622965812683],[.437114000320435,.558896005153656],[.467287987470627,.529924988746643],[.414712011814117,.335219979286194],[.37704598903656,.322777986526489],[.344107985496521,.320150971412659],[.312875986099243,.32233202457428],[.283526003360748,.333190023899078],[.241245999932289,.382785975933075],[.102986000478268,.468762993812561],[.267612010240555,.424560010433197],[.297879010438919,.433175981044769],[.333433985710144,.433878004550934],[.366427004337311,.426115989685059],[.396012008190155,.416696012020111],[.420121014118195,.41022801399231],[.007561000064015,.480777025222778],[.432949006557465,.569517970085144],[.458638995885849,.479089021682739],[.473466008901596,.545744001865387],[.476087987422943,.563830018043518],[.468472003936768,.555056989192963],[.433990985155106,.582361996173859],[.483518004417419,.562983989715576],[.482482999563217,.57784903049469],[.42645001411438,.389798998832703],[.438998997211456,.39649498462677],[.450067013502121,.400434017181396],[.289712011814117,.368252992630005],[.276670008897781,.363372981548309],[.517862021923065,.471948027610779],[.710287988185883,.380764007568359],[.526226997375488,.573909997940063],[.895093023777008,.254140973091125],[.634069979190826,.409575998783112],[.661242008209229,.41302502155304],[.688880026340485,.409460008144379],[.725341975688934,.389131009578705],[.606630027294159,.40370500087738],[.654766023159027,.344011008739471],[.629905998706818,.346076011657715],[.680678009986877,.347265005111694],[.702096998691559,.353591024875641],[.75221198797226,.410804986953735],[.602918028831482,.842862963676453],[.719901978969574,.375599980354309],[.893692970275879,.399959981441498],[.790081977844238,.391354024410248],[.643998026847839,.534487962722778],[.528249025344849,.65040397644043],[.525849997997284,.680191040039062],[.560214996337891,.657229006290436],[.585384011268616,.66654098033905],[.549625992774963,.680860996246338],[.57122802734375,.682691991329193],[.624852001667023,.72809898853302],[.513050019741058,.547281980514526],[.51509702205658,.527251958847046],[.742246985435486,.314507007598877],[.598631024360657,.454979002475739],[.570338010787964,.548575043678284],[.578631997108459,.533622980117798],[.723087012767792,.532054007053375],[.516445994377136,.499638974666595],[.662801027297974,.282917976379395],[.70362401008606,.293271005153656],[.830704987049103,.193813979625702],[.552385985851288,.302568018436432],[.607609987258911,.353887975215912],[.645429015159607,.696707010269165],[.932694971561432,.730105042457581],[.557260990142822,.572826027870178],[.542901992797852,.584792017936707],[.6180260181427,.694710969924927],[.607590973377228,.694203019142151],[.722943007946014,.271963000297546],[.577413976192474,.563166975975037],[.614082992076874,.281386971473694],[.616907000541687,.255886018276215],[.668509006500244,.119913995265961],[.770092010498047,.232020974159241],[.635536015033722,.189248979091644],[.77039098739624,.299556016921997],[.826722025871277,.278755009174347],[.527121007442474,.666198015213013],[.553171992301941,.668527007102966],[.577238023281097,.673889994621277],[.554691970348358,.580065965652466],[.611896991729736,.693961024284363],[.59696102142334,.706539988517761],[.596370995044708,.693953037261963],[.539958000183105,.557139039039612],[.568841993808746,.692366003990173],[.547818005084991,.692366003990173],[.52461302280426,.692366003990173],[.534089982509613,.779141008853912],[.527670979499817,.736225962638855],[.526912987232208,.717857003211975],[.526877999305725,.704625964164734],[.526966989040375,.695277988910675],[.572058022022247,.695277988910675],[.573521018028259,.703539967536926],[.57683801651001,.711845993995667],[.581691026687622,.720062971115112],[.609944999217987,.639909982681274],[.986046016216278,.560034036636353],[.5867999792099,.69539999961853],[.590372025966644,.701822996139526],[.531915009021759,.601536989212036],[.577268004417419,.585934996604919],[.536915004253387,.593786001205444],[.627542972564697,.473352015018463],[.665585994720459,.495950996875763],[.588353991508484,.546862006187439],[.757824003696442,.14767599105835],[.709249973297119,.201507985591888],[.672684013843536,.256581008434296],[.600408971309662,.74900496006012],[.55826598405838,.261672019958496],[.570303976535797,.187870979309082],[.588165998458862,.109044015407562],[.711045026779175,.398952007293701],[.781069993972778,.435405015945435],[.587247014045715,.398931980133057],[.742869973182678,.355445981025696],[.572156012058258,.437651991844177],[.55186802148819,.536570012569427],[.821442008018494,.457556009292603],[.752701997756958,.457181990146637],[.71375697851181,.467626988887787],[.66711300611496,.460672974586487],[.631101012229919,.447153985500336],[.6008620262146,.432473003864288],[.523481011390686,.405627012252808],[.810747981071472,.523926019668579],[.771045982837677,.348959028720856],[.509127020835876,.562718033790588],[.595292985439301,.485023975372314],[.980530977249146,.401564002037048],[.573499977588654,.420000016689301],[.602994978427887,.548687994480133],[.733529984951019,.376977026462555],[.560611009597778,.519016981124878],[.967685997486115,.644356966018677],[.580985009670258,.387160003185272],[.537728011608124,.505385041236877],[.760966002941132,.779752969741821],[.801778972148895,.831938028335571],[.892440974712372,.54076099395752],[.816350996494293,.740260004997253],[.865594983100891,.333687007427216],[.614073991775513,.883246004581451],[.508952975273132,.579437971115112],[.617941975593567,.508316040039062],[.825608015060425,.397674977779388],[.681214988231659,.39623498916626],[.656635999679565,.400596976280212],[.603900015354156,.710216999053955],[.81208598613739,.588539004325867],[.56801301240921,.944564998149872],[.681007981300354,.898285031318665],[.733752012252808,.869701027870178],[.633830010890961,.398822009563446],[.606792986392975,.39553701877594],[.589659988880157,.391062021255493],[.805015981197357,.342108011245728],[.611334979534149,.362284004688263],[.634037971496582,.355970978736877],[.656635999679565,.355356991291046],[.681214988231659,.35834002494812],[.698584973812103,.363156020641327],[.941866993904114,.319076001644135],[.698584973812103,.387449026107788],[.584177017211914,.624107003211975],[.554318010807037,.566076993942261],[.534153997898102,.62064003944397],[.711217999458313,.819975018501282],[.664629995822906,.852871000766754],[.559099972248077,.902631998062134],[.871706008911133,.791940987110138],[.591234028339386,.373893976211548],[.544341027736664,.451583981513977],[.624562978744507,.924192011356354],[.88577002286911,.615028977394104],[.551338016986847,.695277988910675],[.551980018615723,.704632043838501],[.552887976169586,.715808033943176],[.555167973041534,.730794012546539],[.569944024085999,.767035007476807],[.593203008174896,.685675978660583],[.599261999130249,.681069016456604],[.607599973678589,.677703022956848],[.631937980651855,.663500010967255],[.752032995223999,.601315021514893],[.547226011753082,.420395016670227],[.563543975353241,.359827995300293],[.583841025829315,.368713974952698],[.586614012718201,.692366003990173],[.771915018558502,.683578014373779],[.531597018241882,.352482974529266],[.588370978832245,.804440975189209],[.52079701423645,.442565023899078],[.567984998226166,.493479013442993],[.543282985687256,.819254994392395],[.655317008495331,.745514988899231],[.621008992195129,.574018001556396],[.625559985637665,.78031200170517],[.680198013782501,.570719003677368],[.64276397228241,.604337990283966],[.704662978649139,.621529996395111],[.552012026309967,.862591981887817],[.589071989059448,.508637011051178],[.685944974422455,.775357007980347],[.645735025405884,.812640011310577],[.675342977046967,.703978002071381],[.810858011245728,.646304965019226],[.72012197971344,.714666962623596],[.866151988506317,.682704985141754],[.663187026977539,.644596993923187],[.570082008838654,.466325998306274],[.544561982154846,.548375964164734],[.562758982181549,.558784961700439],[.531987011432648,.530140042304993],[.585271000862122,.335177004337311],[.622952997684479,.32277899980545],[.655896008014679,.320163011550903],[.687132000923157,.322345972061157],[.716481983661652,.333200991153717],[.758756995201111,.382786989212036],[.897013008594513,.468769013881683],[.732392013072968,.424547016620636],[.70211398601532,.433162987232208],[.66652500629425,.433866024017334],[.633504986763,.426087975502014],[.603875994682312,.416586995124817],[.579657971858978,.409945011138916],[.992439985275269,.480777025222778],[.567192018032074,.569419980049133],[.54136598110199,.478899002075195],[.526564002037048,.546118021011353],[.523913025856018,.563830018043518],[.531529009342194,.555056989192963],[.566035985946655,.582329034805298],[.51631098985672,.563053965568542],[.5174720287323,.577877044677734],[.573594987392426,.389806985855103],[.560697972774506,.395331978797913],[.549755990505219,.399751007556915],[.710287988185883,.368252992630005],[.723330020904541,.363372981548309]],nm="https://tfhub.dev/mediapipe/tfjs-model/facemesh/1/default/1",Jg=192,fl=192;async function hp({maxContinuousChecks:I=5,detectionConfidence:E=.9,maxFaces:k=10,iouThreshold:w=.3,scoreThreshold:S=.75}={}){const[z,Y]=await Promise.all([async function(ce,ve,De){return async function({maxFaces:Ce=10,inputWidth:Xe=128,inputHeight:tt=128,iouThreshold:kt=.3,scoreThreshold:At=.75}={}){const tn=await Object(Pt.loadGraphModel)(Xg,{fromTFHub:!0});return new rd(tn,Xe,tt,Ce,kt,At)}({maxFaces:ce,iouThreshold:ve,scoreThreshold:De})}(k,w,S),async function(){return Object(Pt.loadGraphModel)(nm,{fromTFHub:!0})}()]);return new dp(z,Y,I,E,k)}function eh(I,E){if(I.mesh instanceof Ye.Tensor){const[k,w,S,z]=Object(Ye.tidy)(()=>{const Y=Object(Ye.tensor1d)([E-1,0,0]),ce=Object(Ye.tensor1d)([1,-1,1]);return Object(Ye.tidy)(()=>[Object(Ye.concat)([Object(Ye.sub)(E-1,I.boundingBox.topLeft.slice(0,1)),I.boundingBox.topLeft.slice(1,1)]),Object(Ye.concat)([Object(Ye.sub)(E-1,I.boundingBox.bottomRight.slice(0,1)),I.boundingBox.bottomRight.slice(1,1)]),Object(Ye.sub)(Y,I.mesh).mul(ce),Object(Ye.sub)(Y,I.scaledMesh).mul(ce)])});return Object.assign({},I,{boundingBox:{topLeft:k,bottomRight:w},mesh:S,scaledMesh:z})}return Object.assign({},I,{boundingBox:{topLeft:[E-1-I.boundingBox.topLeft[0],I.boundingBox.topLeft[1]],bottomRight:[E-1-I.boundingBox.bottomRight[0],I.boundingBox.bottomRight[1]]},mesh:I.mesh.map(k=>{const w=k.slice(0);return w[0]=E-1-k[0],w}),scaledMesh:I.scaledMesh.map(k=>{const w=k.slice(0);return w[0]=E-1-k[0],w})})}class dp{constructor(E,k,w,S,z){this.pipeline=new $m(E,k,Jg,fl,w,z),this.detectionConfidence=S}static getAnnotations(){return Zp}static getUVCoords(){return Fc}async estimateFaces(E,k=!1,w=!1){const[,S]=function(ve){return ve instanceof Ye.Tensor?[ve.shape[0],ve.shape[1]]:[ve.height,ve.width]}(E),z=Object(Ye.tidy)(()=>(E instanceof Ye.Tensor||(E=Ye.browser.fromPixels(E)),E.toFloat().expandDims(0))),Y=Object(Ye.env)().get("WEBGL_PACK_DEPTHWISECONV");Object(Ye.env)().set("WEBGL_PACK_DEPTHWISECONV",!0);const ce=await this.pipeline.predict(z);return Object(Ye.env)().set("WEBGL_PACK_DEPTHWISECONV",Y),z.dispose(),ce!=null&&ce.length>0?Promise.all(ce.map(async(ve,De)=>{const{coords:Ce,scaledCoords:Xe,box:tt,flag:kt}=ve;let At=[kt];k||(At=At.concat([Ce,Xe,tt.startPoint,tt.endPoint]));const tn=await Promise.all(At.map(async kr=>kr.array())),sn=tn[0];if(kt.dispose(),sn<this.detectionConfidence&&this.pipeline.clearRegionOfInterest(De),k){const kr={faceInViewConfidence:sn,mesh:Ce,scaledMesh:Xe,boundingBox:{topLeft:tt.startPoint.squeeze(),bottomRight:tt.endPoint.squeeze()}};return w?eh(kr,S):kr}const[wn,En,Tn,Pn]=tn.slice(1);Xe.dispose(),Ce.dispose();let dn={faceInViewConfidence:sn,boundingBox:{topLeft:Tn,bottomRight:Pn},mesh:wn,scaledMesh:En};w&&(dn=eh(dn,S));const cr={};for(const kr in Zp)cr[kr]=Zp[kr].map(yr=>dn.scaledMesh[yr]);return dn.annotations=cr,dn})):[]}}function rs(I){var E=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var k,w=os()(I);if(E){var S=os()(this).constructor;k=Reflect.construct(w,arguments,S)}else k=w.apply(this,arguments);return xc()(this,k)}}var rm=function(I){bc()(k,I);var E=rs(k);function k(w,S,z){var Y;return pe()(this,k),(Y=E.call(this)).video=w,Y.model=null,Y.modelReady=!1,Y.config=S,Y.ready=at(Y.loadModel(),z),Y}return Te()(k,[{key:"loadModel",value:function(){var w=K()(ke.a.mark(function S(){var z=this;return ke.a.wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:return Y.next=2,hp(this.config);case 2:if(this.model=Y.sent,this.modelReady=!0,!this.video||this.video.readyState!==0){Y.next=7;break}return Y.next=7,new Promise(function(ce){z.video.onloadeddata=function(){ce()}});case 7:return this.video&&this.predict(),Y.abrupt("return",this);case 9:case"end":return Y.stop()}},S,this)}));return function(){return w.apply(this,arguments)}}()},{key:"predict",value:function(){var w=K()(ke.a.mark(function S(z,Y){var ce,ve,De,Ce,Xe=this;return ke.a.wrap(function(tt){for(;;)switch(tt.prev=tt.next){case 0:if(ce=this.getInput(z)){tt.next=3;break}throw new Error("No input image found.");case 3:return ve=this.config.flipHorizontal,tt.next=6,this.model.estimateFaces(ce,ve);case 6:if(De=tt.sent,Ce=De,this.emit("predict",Ce),this.emit("face",Ce),!this.video){tt.next=12;break}return tt.abrupt("return",F.nextFrame().then(function(){return Xe.predict()}));case 12:return typeof Y=="function"&&Y(Ce),tt.abrupt("return",Ce);case 14:case"end":return tt.stop()}},S,this)}));return function(S,z){return w.apply(this,arguments)}}()},{key:"getInput",value:function(w){return w instanceof HTMLImageElement||w instanceof HTMLVideoElement||w instanceof HTMLCanvasElement||w instanceof ImageData?w:we()(w)==="object"&&(w.elt instanceof HTMLImageElement||w.elt instanceof HTMLVideoElement||w.elt instanceof ImageData)?w.elt:we()(w)==="object"&&w.canvas instanceof HTMLCanvasElement?w.canvas:this.video}}]),k}(Nd.EventEmitter),Gm=function(I,E,k){var w,S={},z=k;I instanceof HTMLVideoElement?w=I:we()(I)==="object"&&I.elt instanceof HTMLVideoElement?w=I.elt:we()(I)==="object"?S=I:typeof I=="function"&&(z=I),we()(E)==="object"?S=E:typeof E=="function"&&(z=E);var Y=new rm(w,S,z);return z?Y:Y.ready};/**
    * @license
    * Copyright 2020 Google LLC. All Rights Reserved.
    * Licensed under the Apache License, Version 2.0 (the "License");
    * you may not use this file except in compliance with the License.
    * You may obtain a copy of the License at
    *
    * http://www.apache.org/licenses/LICENSE-2.0
    *
    * Unless required by applicable law or agreed to in writing, software
    * distributed under the License is distributed on an "AS IS" BASIS,
    * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    * See the License for the specific language governing permissions and
    * limitations under the License.
    * =============================================================================
    */function pp(I){return[Math.abs(I.endPoint[0]-I.startPoint[0]),Math.abs(I.endPoint[1]-I.startPoint[1])]}function mp(I){return[I.startPoint[0]+(I.endPoint[0]-I.startPoint[0])/2,I.startPoint[1]+(I.endPoint[1]-I.startPoint[1])/2]}function Km(I,E=1.5){const k=mp(I),w=pp(I),S=[E*w[0]/2,E*w[1]/2];return{startPoint:[k[0]-S[0],k[1]-S[1]],endPoint:[k[0]+S[0],k[1]+S[1]],palmLandmarks:I.palmLandmarks}}function Qg(I){const E=mp(I),k=pp(I),w=Math.max(...k)/2;return{startPoint:[E[0]-w,E[1]-w],endPoint:[E[0]+w,E[1]+w],palmLandmarks:I.palmLandmarks}}function Pv(I,E){const k=[I.endPoint[0]-I.startPoint[0],I.endPoint[1]-I.startPoint[1]],w=[k[0]*E[0],k[1]*E[1]];return{startPoint:[I.startPoint[0]+w[0],I.startPoint[1]+w[1]],endPoint:[I.endPoint[0]+w[0],I.endPoint[1]+w[1]],palmLandmarks:I.palmLandmarks}}class Rc{constructor(E,k,w,S,z,Y){this.model=E,this.width=k,this.height=w,this.iouThreshold=z,this.scoreThreshold=Y,this.anchors=S.map(ce=>[ce.x_center,ce.y_center]),this.anchorsTensor=Object(Ye.tensor2d)(this.anchors),this.inputSizeTensor=Object(Ye.tensor1d)([k,w]),this.doubleInputSizeTensor=Object(Ye.tensor1d)([2*k,2*w])}normalizeBoxes(E){return Object(Ye.tidy)(()=>{const k=Object(Ye.slice)(E,[0,0],[-1,2]),w=Object(Ye.slice)(E,[0,2],[-1,2]),S=Object(Ye.add)(Object(Ye.div)(k,this.inputSizeTensor),this.anchorsTensor),z=Object(Ye.div)(w,this.doubleInputSizeTensor),Y=Object(Ye.mul)(Object(Ye.sub)(S,z),this.inputSizeTensor),ce=Object(Ye.mul)(Object(Ye.add)(S,z),this.inputSizeTensor);return Object(Ye.concat2d)([Y,ce],1)})}normalizeLandmarks(E,k){return Object(Ye.tidy)(()=>{const w=Object(Ye.add)(Object(Ye.div)(E.reshape([-1,7,2]),this.inputSizeTensor),this.anchors[k]);return Object(Ye.mul)(w,this.inputSizeTensor)})}getBoundingBoxes(E){return Object(Ye.tidy)(()=>{const k=Object(Ye.mul)(Object(Ye.sub)(E,.5),2),w=Object(Ye.env)().get("WEBGL_PACK_DEPTHWISECONV");Object(Ye.env)().set("WEBGL_PACK_DEPTHWISECONV",!0);const S=this.model.predict(k).squeeze();Object(Ye.env)().set("WEBGL_PACK_DEPTHWISECONV",w);const z=Object(Ye.sigmoid)(Object(Ye.slice)(S,[0,0],[-1,1])).squeeze(),Y=Object(Ye.slice)(S,[0,1],[-1,4]),ce=this.normalizeBoxes(Y),ve=console.warn;console.warn=()=>{};const De=Ye.image.nonMaxSuppression(ce,z,1,this.iouThreshold,this.scoreThreshold).arraySync();if(console.warn=ve,De.length===0)return null;const Ce=De[0],Xe=Object(Ye.slice)(ce,[Ce,0],[1,-1]),tt=Object(Ye.slice)(S,[Ce,5],[1,14]);return{boxes:Xe,palmLandmarks:this.normalizeLandmarks(tt,Ce).reshape([-1,2])}})}estimateHandBounds(E){const k=E.shape[1],w=E.shape[2],S=Object(Ye.tidy)(()=>E.resizeBilinear([this.width,this.height]).div(255)),z=this.getBoundingBoxes(S);if(z===null)return S.dispose(),null;const Y=z.boxes.arraySync(),ce=Y[0].slice(0,2),ve=Y[0].slice(2,4),De=z.palmLandmarks.arraySync();return S.dispose(),z.boxes.dispose(),z.palmLandmarks.dispose(),function(Ce,Xe){return{startPoint:[Ce.startPoint[0]*Xe[0],Ce.startPoint[1]*Xe[1]],endPoint:[Ce.endPoint[0]*Xe[0],Ce.endPoint[1]*Xe[1]],palmLandmarks:Ce.palmLandmarks.map(tt=>[tt[0]*Xe[0],tt[1]*Xe[1]])}}({startPoint:ce,endPoint:ve,palmLandmarks:De},[w/this.width,k/this.height])}}const th={thumb:[1,2,3,4],indexFinger:[5,6,7,8],middleFinger:[9,10,11,12],ringFinger:[13,14,15,16],pinky:[17,18,19,20],palmBase:[0]};function Lv(I,E){return function(k){return k-2*Math.PI*Math.floor((k+Math.PI)/(2*Math.PI))}(Math.PI/2-Math.atan2(-(E[1]-I[1]),E[0]-I[0]))}const Zg=(I,E)=>[[1,0,I],[0,1,E],[0,0,1]];function Mc(I,E){let k=0;for(let w=0;w<I.length;w++)k+=I[w]*E[w];return k}function Xo(I,E){const k=[];for(let w=0;w<I.length;w++)k.push(I[w][E]);return k}function id(I,E){const k=[],w=I.length;for(let S=0;S<w;S++){k.push([]);for(let z=0;z<w;z++)k[S].push(Mc(I[S],Xo(E,z)))}return k}function gp(I,E){const k=Math.cos(I),w=Math.sin(I),S=[[k,-w,0],[w,k,0],[0,0,1]];return id(id(Zg(E[0],E[1]),S),Zg(-E[0],-E[1]))}function im(I,E){return[Mc(I,E[0]),Mc(I,E[1])]}const ev=.8,am=[0,-.4],Zl=3,E0=[0,-.1],om=1.65,qo=[0,5,9,13,17,1,2],vp=0,nh=2;class sm{constructor(E,k,w,S,z,Y){this.regionsOfInterest=[],this.runsWithoutHandDetector=0,this.boundingBoxDetector=E,this.meshDetector=k,this.maxContinuousChecks=z,this.detectionConfidence=Y,this.meshWidth=w,this.meshHeight=S,this.maxHandsNumber=1}getBoxForPalmLandmarks(E,k){const w=E.map(S=>im([...S,1],k));return Km(Qg(Pv(this.calculateLandmarksBoundingBox(w),am)),Zl)}getBoxForHandLandmarks(E){const k=Km(Qg(Pv(this.calculateLandmarksBoundingBox(E),E0)),om),w=[];for(let S=0;S<qo.length;S++)w.push(E[qo[S]].slice(0,2));return k.palmLandmarks=w,k}transformRawCoords(E,k,w,S){const z=pp(k),Y=[z[0]/this.meshWidth,z[1]/this.meshHeight],ce=E.map(kt=>[Y[0]*(kt[0]-this.meshWidth/2),Y[1]*(kt[1]-this.meshHeight/2),kt[2]]),ve=gp(w,[0,0]),De=ce.map(kt=>[...im(kt,ve),kt[2]]),Ce=function(kt){const At=[[kt[0][0],kt[1][0]],[kt[0][1],kt[1][1]]],tn=[kt[0][2],kt[1][2]],sn=[-Mc(At[0],tn),-Mc(At[1],tn)];return[At[0].concat(sn[0]),At[1].concat(sn[1]),[0,0,1]]}(S),Xe=[...mp(k),1],tt=[Mc(Xe,Ce[0]),Mc(Xe,Ce[1])];return De.map(kt=>[kt[0]+tt[0],kt[1]+tt[1],kt[2]])}async estimateHand(E){const k=this.shouldUpdateRegionsOfInterest();if(k===!0){const dn=this.boundingBoxDetector.estimateHandBounds(E);if(dn===null)return E.dispose(),this.regionsOfInterest=[],null;this.updateRegionsOfInterest(dn,!0),this.runsWithoutHandDetector=0}else this.runsWithoutHandDetector++;const w=this.regionsOfInterest[0],S=Lv(w.palmLandmarks[vp],w.palmLandmarks[nh]),z=mp(w),Y=[z[0]/E.shape[2],z[1]/E.shape[1]];let ce;const ve=Object(Ye.getBackend)();if(ve==="webgl")ce=function(dn,cr,kr,yr){const Br=dn.shape,_r=Br[1],hi=Br[2],Ei=Math.sin(cr),xi=Math.cos(cr),ya=Math.floor(hi*(typeof yr=="number"?yr:yr[0])),Ua=Math.floor(_r*(typeof yr=="number"?yr:yr[1])),Ta={variableNames:["Image"],outputShape:Br,userCode:`
      void main() {
        ivec4 coords = getOutputCoords();
        int x = coords[2];
        int y = coords[1];
        int coordX = int(float(x - ${ya}) * ${xi} -
          float(y - ${Ua}) * ${Ei});
        int coordY = int(float(x - ${ya}) * ${Ei} +
          float(y - ${Ua}) * ${xi});
        coordX = int(coordX + ${ya});
        coordY = int(coordY + ${Ua});

        ${`float outputValue = ${kr.toFixed(2)};`}

        if(coordX > 0 && coordX < ${hi} && coordY > 0 && coordY < ${_r}) {
          outputValue = getImage(coords[0], coordY, coordX, coords[3]);
        }

      setOutput(outputValue);
    }`};return Object(Ye.backend)().compileAndRun(Ta,[dn])}(E,S,0,Y);else{if(ve!=="cpu")throw new Error(`Handpose is not yet supported by the ${ve} backend - rotation kernel is not defined.`);ce=function(dn,cr,kr,yr){const Br=Object(Ye.backend)(),_r=Object(Ye.buffer)(dn.shape,dn.dtype),[hi,Ei,xi,ya]=dn.shape,Ua=xi*(typeof yr=="number"?yr:yr[0]),Ta=Ei*(typeof yr=="number"?yr:yr[1]),Da=Math.sin(-cr),Ra=Math.cos(-cr),Qa=Br.readSync(dn.dataId);for(let oo=0;oo<hi;oo++)for(let wo=0;wo<Ei;wo++)for(let Ks=0;Ks<xi;Ks++)for(let Ti=0;Ti<ya;Ti++){const Ho=[hi,wo,Ks,Ti],Yo=Ho[2],Xs=Ho[1];let Ds=(Yo-Ua)*Ra-(Xs-Ta)*Da,du=(Yo-Ua)*Da+(Xs-Ta)*Ra;Ds=Math.round(Ds+Ua),du=Math.round(du+Ta);let Iu=kr;Ds>=0&&Ds<xi&&du>=0&&du<Ei&&(Iu=Qa[oo*xi*Ei*ya+du*(xi*ya)+Ds*ya+Ti]);const pu=oo*xi*Ei*ya+wo*(xi*ya)+Ks*ya+Ti;_r.values[pu]=Iu}return _r.toTensor()}(E,S,0,Y)}const De=gp(-S,z);let Ce;const Xe=function(dn,cr,kr){const yr=cr.shape[1],Br=cr.shape[2],_r=[[dn.startPoint[1]/yr,dn.startPoint[0]/Br,dn.endPoint[1]/yr,dn.endPoint[0]/Br]];return Ye.image.cropAndResize(cr,_r,[0],kr)}(Ce=k===!0?this.getBoxForPalmLandmarks(w.palmLandmarks,De):w,ce,[this.meshWidth,this.meshHeight]),tt=Xe.div(255);Xe.dispose(),ce.dispose();const kt=Object(Ye.env)().get("WEBGL_PACK_DEPTHWISECONV");Object(Ye.env)().set("WEBGL_PACK_DEPTHWISECONV",!0);const[At,tn]=this.meshDetector.predict(tt);Object(Ye.env)().set("WEBGL_PACK_DEPTHWISECONV",kt),tt.dispose();const sn=At.dataSync()[0];if(At.dispose(),sn<this.detectionConfidence)return tn.dispose(),this.regionsOfInterest=[],null;const wn=Object(Ye.reshape)(tn,[-1,3]),En=wn.arraySync();tn.dispose(),wn.dispose();const Tn=this.transformRawCoords(En,Ce,S,De),Pn=this.getBoxForHandLandmarks(Tn);return this.updateRegionsOfInterest(Pn,!1),{landmarks:Tn,handInViewConfidence:sn,boundingBox:{topLeft:Pn.startPoint,bottomRight:Pn.endPoint}}}calculateLandmarksBoundingBox(E){const k=E.map(S=>S[0]),w=E.map(S=>S[1]);return{startPoint:[Math.min(...k),Math.min(...w)],endPoint:[Math.max(...k),Math.max(...w)]}}updateRegionsOfInterest(E,k){if(k)this.regionsOfInterest=[E];else{const w=this.regionsOfInterest[0];let S=0;if(w!=null&&w.startPoint!=null){const[z,Y]=E.startPoint,[ce,ve]=E.endPoint,[De,Ce]=w.startPoint,[Xe,tt]=w.endPoint,kt=Math.max(z,De),At=Math.max(Y,Ce),tn=(Math.min(ce,Xe)-kt)*(Math.min(ve,tt)-At);S=tn/((ce-z)*(ve-Y)+(Xe-De)*(tt-Y)-tn)}this.regionsOfInterest[0]=S>ev?w:E}}shouldUpdateRegionsOfInterest(){return this.regionsOfInterest.length!==this.maxHandsNumber||this.runsWithoutHandDetector>=this.maxContinuousChecks}}const yp=256,Xm=256;async function Ym({maxContinuousChecks:I=1/0,detectionConfidence:E=.8,iouThreshold:k=.3,scoreThreshold:w=.5}={}){const[S,z,Y]=await Promise.all([async function(){return Ye.util.fetch("https://tfhub.dev/mediapipe/tfjs-model/handskeleton/1/default/1/anchors.json?tfjs-format=file").then(De=>De.json())}(),async function(){return Object(Pt.loadGraphModel)("https://tfhub.dev/mediapipe/tfjs-model/handdetector/1/default/1",{fromTFHub:!0})}(),async function(){return Object(Pt.loadGraphModel)("https://tfhub.dev/mediapipe/tfjs-model/handskeleton/1/default/1",{fromTFHub:!0})}()]),ce=new Rc(z,yp,Xm,S,k,w),ve=new sm(ce,Y,yp,Xm,I,E);return new ef(ve)}class ef{constructor(E){this.pipeline=E}static getAnnotations(){return th}async estimateHands(E,k=!1){const[,w]=function(ve){return ve instanceof Ye.Tensor?[ve.shape[0],ve.shape[1]]:[ve.height,ve.width]}(E),S=Object(Ye.tidy)(()=>(E instanceof Ye.Tensor||(E=Ye.browser.fromPixels(E)),E.toFloat().expandDims(0))),z=await this.pipeline.estimateHand(S);if(S.dispose(),z===null)return[];let Y=z;k===!0&&(Y=function(ve,De){const{handInViewConfidence:Ce,landmarks:Xe,boundingBox:tt}=ve;return{handInViewConfidence:Ce,landmarks:Xe.map(kt=>[De-1-kt[0],kt[1],kt[2]]),boundingBox:{topLeft:[De-1-tt.topLeft[0],tt.topLeft[1]],bottomRight:[De-1-tt.bottomRight[0],tt.bottomRight[1]]}}}(z,w));const ce={};for(const ve of Object.keys(th))ce[ve]=th[ve].map(De=>Y.landmarks[De]);return[{handInViewConfidence:Y.handInViewConfidence,boundingBox:Y.boundingBox,landmarks:Y.landmarks,annotations:ce}]}}function $u(I){var E=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var k,w=os()(I);if(E){var S=os()(this).constructor;k=Reflect.construct(w,arguments,S)}else k=w.apply(this,arguments);return xc()(this,k)}}var tv=function(I){bc()(k,I);var E=$u(k);function k(w,S,z){var Y;return pe()(this,k),(Y=E.call(this)).video=w,Y.model=null,Y.modelReady=!1,Y.config=S,Y.ready=at(Y.loadModel(),z),Y}return Te()(k,[{key:"loadModel",value:function(){var w=K()(ke.a.mark(function S(){var z=this;return ke.a.wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:return Y.next=2,Ym(this.config);case 2:if(this.model=Y.sent,this.modelReady=!0,!this.video||this.video.readyState!==0){Y.next=7;break}return Y.next=7,new Promise(function(ce){z.video.onloadeddata=function(){ce()}});case 7:return this.video&&this.predict(),Y.abrupt("return",this);case 9:case"end":return Y.stop()}},S,this)}));return function(){return w.apply(this,arguments)}}()},{key:"predict",value:function(){var w=K()(ke.a.mark(function S(z,Y){var ce,ve,De,Ce,Xe=this;return ke.a.wrap(function(tt){for(;;)switch(tt.prev=tt.next){case 0:if(ce=this.getInput(z)){tt.next=3;break}throw new Error("No input image found.");case 3:return ve=this.config.flipHorizontal,tt.next=6,this.model.estimateHands(ce,ve);case 6:if(De=tt.sent,Ce=De,this.emit("predict",Ce),this.emit("hand",Ce),!this.video){tt.next=12;break}return tt.abrupt("return",F.nextFrame().then(function(){return Xe.predict()}));case 12:return typeof Y=="function"&&Y(Ce),tt.abrupt("return",Ce);case 14:case"end":return tt.stop()}},S,this)}));return function(S,z){return w.apply(this,arguments)}}()},{key:"getInput",value:function(w){return w instanceof HTMLImageElement||w instanceof HTMLVideoElement||w instanceof HTMLCanvasElement||w instanceof ImageData?w:we()(w)==="object"&&(w.elt instanceof HTMLImageElement||w.elt instanceof HTMLVideoElement||w.elt instanceof ImageData)?w.elt:we()(w)==="object"&&w.canvas instanceof HTMLCanvasElement?w.canvas:this.video}}]),k}(Nd.EventEmitter),nv=function(I,E,k){var w,S={},z=k;I instanceof HTMLVideoElement?w=I:we()(I)==="object"&&I.elt instanceof HTMLVideoElement?w=I.elt:we()(I)==="object"?S=I:typeof I=="function"&&(z=I),we()(E)==="object"?S=E:typeof E=="function"&&(z=E);var Y=new tv(w,S,z);return z?Y:Y.ready},ad=function(){console.log(`

 Thank you for using ml5.js v`.concat(Bh.a,` 

Please read our community statement to ensure 
that the use of this software reflects the values 
of the ml5.js community:
 https://ml5js.org/about

Reporting: 
 https://github.com/ml5js/ml5-library/issues
 Email: info@ml5js.org 
`))},bp=function(){var I=K()(ke.a.mark(function E(){var k;return ke.a.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return(k=new Image).crossOrigin="",k.src="https://cdn.jsdelivr.net/gh/ml5js/ml5-library@main/assets/bird.jpg",w.next=5,new Promise(function(S){k.onload=S});case 5:return w.abrupt("return",k);case 6:case"end":return w.stop()}},E)}));return function(){return I.apply(this,arguments)}}(),zv=function(){var I=K()(ke.a.mark(function E(){var k,w,S;return ke.a.wrap(function(z){for(;;)switch(z.prev=z.next){case 0:for(k=new Uint8ClampedArray(2e4),w=0;w<k.length;w+=4)k[w+0]=0,k[w+1]=190,k[w+2]=0,k[w+3]=255;return S=new ImageData(k,200),z.abrupt("return",S);case 4:case"end":return z.stop()}},E)}));return function(){return I.apply(this,arguments)}}();function Jm(I,E){var k=Object.keys(I);if(Object.getOwnPropertySymbols){var w=Object.getOwnPropertySymbols(I);E&&(w=w.filter(function(S){return Object.getOwnPropertyDescriptor(I,S).enumerable})),k.push.apply(k,w)}return k}function um(I){for(var E=1;E<arguments.length;E++){var k=arguments[E]!=null?arguments[E]:{};E%2?Jm(Object(k),!0).forEach(function(w){ee()(I,w,k[w])}):Object.getOwnPropertyDescriptors?Object.defineProperties(I,Object.getOwnPropertyDescriptors(k)):Jm(Object(k)).forEach(function(w){Object.defineProperty(I,w,Object.getOwnPropertyDescriptor(k,w))})}return I}var Ir={charRNN:zd,CVAE:Wd,cartoon:qg,DCGAN:Sl,featureExtractor:qi,imageClassifier:ni,kmeans:Lg,dbscan:Vg,soundClassifier:ui,pitchDetection:zt,pix2pix:zu,poseNet:ac,sketchRNN:Mh,styleTransfer:Al,word2vec:ec,YOLO:Cl,CocoSsd:bf,objectDetector:Ah,uNet:Gc,sentiment:Tl,bodyPix:qd,faceApi:jg,universalSentenceEncoder:pc,facemesh:Gm,handpose:nv};ad(),A.default=Object.assign({p5Utils:dr},function(I){if(typeof window>"u"||window.p5===void 0||window.p5.prototype===void 0||window.p5.prototype.registerPreloadMethod===void 0)return I;var E=I;return Object.keys(I).forEach(function(k){var w=I[k];E[k]=function(){for(var S=null,z=arguments.length,Y=new Array(z),ce=0;ce<z;ce++)Y[ce]=arguments[ce];var ve=Y.length;return typeof Y[ve-1]=="function"&&(S=Y[ve-1],ve-=1),w.apply(I,[].concat(Pa()(Y.slice(0,ve)),[function(){try{S&&S()}catch(De){console.error(De)}return window._decrementPreload?window._decrementPreload():null}]))},window.p5.prototype.registerPreloadMethod("".concat(k),I)}),I}(Ir),um(um({KNNClassifier:Vi,communityStatement:ad},B),{},{tf:F,tfvis:ue,version:Bh.a,neuralNetwork:Kd,testingUtils:$}))},function(Oe,A){},function(Oe,A){},function(Oe,A){},function(Oe,A){Oe.exports=function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)},Oe.exports.__esModule=!0,Oe.exports.default=Oe.exports},function(Oe,A){Oe.exports=function(o){if(typeof Symbol<"u"&&o[Symbol.iterator]!=null||o["@@iterator"]!=null)return Array.from(o)},Oe.exports.__esModule=!0,Oe.exports.default=Oe.exports},function(Oe,A,o){var b=o(186);Oe.exports=function(H){if(Array.isArray(H))return b(H)},Oe.exports.__esModule=!0,Oe.exports.default=Oe.exports},function(Oe,A,o){function b(P){return new Uint8Array(atob(P).split("").map(function($){return $.charCodeAt(0)}))}Object.defineProperty(A,"__esModule",{value:!0}),A.stringToUint8array=b,A.stringToArray=function(P){var $=b(P);return new Int16Array($.buffer)};var H=!1,U=0;function B(){if(H)return H=!1,U;var P=2*Math.random()-1,$=2*Math.random()-1,L=P*P+$*$;if(L===0||L>1)return B();var ee=Math.sqrt(-2*Math.log(L)/L);return U=$*ee,H=!0,P*ee}function re(P,$){return Math.random()*($-P)+P}function J(P,$){return P+B()*$}function R(P,$){$===void 0&&($=2);var L=$;function ee(zt,$t){return[zt[0]-$t[0],zt[1]-$t[1]]}function F(zt,$t){return zt[0]*$t[0]+zt[1]*$t[1]}function ue(zt){return zt[0]*zt[0]+zt[1]*zt[1]}function ie(zt,$t){return ue(ee(zt,$t))}var K,he,pe,Ae,Te=P.length,je=[],ke=L*L,at=[],St=[];for(at[0]=P[0],K=he=1,Ae=0;K<Te;K++)ie(P[K],P[Ae])<ke||(at[he++]=P[K],Ae=K);for(Ae<Te-1&&(at[he++]=P[Te-1]),St[0]=St[he-1]=1,function zt($t,we,Tt,Gt,Pt){if(!(Gt<=Tt+1)){for(var Ye,ln,Zt,Bt,Mt=Tt,bn=0,Dt=$t*$t,_t=[we[Tt],we[Gt]],xn=ee(_t[1],_t[0]),In=ue(xn),Yn=Tt+1;Yn<Gt;Yn++)(Zt=F(ee(we[Yn],_t[0]),xn))<=0?Bt=ie(we[Yn],_t[0]):In<=Zt?Bt=ie(we[Yn],_t[1]):(ln=Zt/In,Ye=[_t[0][0]+ln*xn[0],_t[0][1]+ln*xn[1]],Bt=ie(we[Yn],Ye)),Bt<=bn||(Mt=Yn,bn=Bt);bn>Dt&&(Pt[Mt]=1,zt($t,we,Tt,Mt,Pt),zt($t,we,Mt,Gt,Pt))}}(L,at,0,he-1,St),K=pe=0;K<he;K++)St[K]&&(je[pe++]=at[K]);return je}A.gaussRandom=B,A.randf=re,A.randi=function(P,$){return Math.floor(Math.random()*($-P)+P)},A.randn=J,A.birandn=function(P,$,L,ee,F){var ue=J(0,1),ie=J(0,1);return[Math.sqrt(1-F*F)*L*ue+F*L*ie+P,ee*ie+$]},A.sampleSoftmax=function(P){var $,L=re(0,1),ee=P.length,F=0;for($=0;$<ee;$++)if((F+=P[$])>=L)return $;return console.log("error sampling pi index"),-1},A.simplifyLine=R,A.simplifyLines=function(P,$){var L=[],ee=2;$&&(ee=$);for(var F=0;F<P.length;F++)L.push(R(P[F],ee));return L},A.linesToStrokes=function(P){var $,L,ee,F,ue,ie,K,he,pe,Ae,Te=0,je=0,ke=[];for(K=0;K<P.length;K++)if((pe=P[K].length)>1)for(he=0;he<pe;he++)$=(Ae=P[K][he])[0],L=Ae[1],he===pe-1?(ie=1,ue=0):(ie=0,ue=1),ee=$-Te,F=L-je,Te=$,je=L,ke.push([ee,F,ue,ie,0]);return ke.push([0,0,0,0,1]),ke.slice(1)},A.lineToStroke=function(P,$){var L,ee,F,ue,ie,K,he,pe,Ae,Te,je,ke=[];if(Ae=$[0],Te=$[1],(F=P.length)>1)for(je=0;je<F;je++)he=(ue=P[je])[0],pe=ue[1],je===F-1?(ee=1,L=0):(ee=0,L=1),ie=he-Ae,K=pe-Te,Ae=he,Te=pe,ke.push([ie,K,L,ee,0]);return ke}},function(Oe,A,o){var b=this&&this.__awaiter||function(J,R,P,$){return new(P||(P=Promise))(function(L,ee){function F(K){try{ie($.next(K))}catch(he){ee(he)}}function ue(K){try{ie($.throw(K))}catch(he){ee(he)}}function ie(K){K.done?L(K.value):new P(function(he){he(K.value)}).then(F,ue)}ie(($=$.apply(J,R||[])).next())})},H=this&&this.__generator||function(J,R){var P,$,L,ee,F={label:0,sent:function(){if(1&L[0])throw L[1];return L[1]},trys:[],ops:[]};return ee={next:ue(0),throw:ue(1),return:ue(2)},typeof Symbol=="function"&&(ee[Symbol.iterator]=function(){return this}),ee;function ue(ie){return function(K){return function(he){if(P)throw new TypeError("Generator is already executing.");for(;F;)try{if(P=1,$&&(L=2&he[0]?$.return:he[0]?$.throw||((L=$.return)&&L.call($),0):$.next)&&!(L=L.call($,he[1])).done)return L;switch($=0,L&&(he=[2&he[0],L.value]),he[0]){case 0:case 1:L=he;break;case 4:return F.label++,{value:he[1],done:!1};case 5:F.label++,$=he[1],he=[0];continue;case 7:he=F.ops.pop(),F.trys.pop();continue;default:if(!(L=(L=F.trys).length>0&&L[L.length-1])&&(he[0]===6||he[0]===2)){F=0;continue}if(he[0]===3&&(!L||he[1]>L[0]&&he[1]<L[3])){F.label=he[1];break}if(he[0]===6&&F.label<L[1]){F.label=L[1],L=he;break}if(L&&F.label<L[2]){F.label=L[2],F.ops.push(he);break}L[2]&&F.ops.pop(),F.trys.pop();continue}he=R.call(J,F)}catch(pe){he=[6,pe],$=0}finally{P=L=0}if(5&he[0])throw he[1];return{value:he[0]?he[1]:void 0,done:!0}}([ie,K])}}};Object.defineProperty(A,"__esModule",{value:!0});var U=o(0),B=o(255),re=function(){function J(R){this.NMIXTURE=20,this.checkpointURL=R,this.initialized=!1}return J.prototype.isInitialized=function(){return this.initialized},J.prototype.instantiateFromJSON=function(R,P,$){var L;this.forgetBias=U.scalar(1),this.info=R,this.setPixelFactor(2),this.weightDims=P,this.numUnits=this.weightDims[0][0],this.weights=[];for(var ee=0;ee<$.length;ee++){for(var F=(L=new Float32Array(B.stringToArray($[ee]))).length,ue=0;ue<F;ue++)L[ue]=10*L[ue]/32767;this.weights.push(L)}this.outputKernel=U.tensor2d(this.weights[0],[this.weightDims[0][0],this.weightDims[0][1]]),this.outputBias=U.tensor1d(this.weights[1]);var ie=U.tensor2d(this.weights[2],[this.weightDims[2][0],this.weightDims[2][1]]),K=U.tensor2d(this.weights[3],[this.weightDims[3][0],this.weightDims[3][1]]);this.lstmKernel=U.concat2d([ie,K],0),this.lstmBias=U.tensor1d(this.weights[4]),this.rawVars=[this.outputKernel,this.outputBias,this.lstmKernel,this.lstmBias]},J.prototype.initialize=function(){return b(this,void 0,void 0,function(){var R;return H(this,function(P){switch(P.label){case 0:return this.dispose(),[4,fetch(this.checkpointURL).then(function($){return $.json()})];case 1:return R=P.sent(),this.instantiateFromJSON(R[0],R[1],R[2]),this.initialized=!0,console.log("Initialized SketchRNN."),[2]}})})},J.prototype.dispose=function(){if(this.rawVars){for(var R=0;R<this.rawVars.length;R++)this.rawVars[R].dispose();this.rawVars=void 0}this.forgetBias&&(this.forgetBias.dispose(),this.forgetBias=void 0),this.initialized=!1},J.prototype.setPixelFactor=function(R){this.pixelFactor=R,this.scaleFactor=this.info.scale_factor/this.pixelFactor},J.prototype.update=function(R,P){var $=this,L=U.tidy(function(){var ie=$.numUnits,K=$.scaleFactor,he=[R[0]/K,R[1]/K,R[2],R[3],R[4]],pe=U.tensor2d(he,[1,5]),Ae=U.tensor2d(P.c,[1,ie]),Te=U.tensor2d(P.h,[1,ie]),je=U.basicLSTMCell($.forgetBias,$.lstmKernel,$.lstmBias,pe,Ae,Te);return U.concat(je,1)}),ee=L.dataSync();L.dispose();var F=ee.slice(0,this.numUnits),ue=ee.slice(this.numUnits,2*this.numUnits);return{c:new Float32Array(F),h:new Float32Array(ue)}},J.prototype.updateStrokes=function(R,P,$){var L=this,ee=U.tidy(function(){var K,he,pe,Ae,Te,je=L.numUnits,ke=L.scaleFactor,at=R.length;$&&(at=$),pe=U.tensor2d(P.c,[1,je]),Ae=U.tensor2d(P.h,[1,je]);for(var St=0;St<at;St++)K=[R[St][0]/ke,R[St][1]/ke,R[St][2],R[St][3],R[St][4]],he=U.tensor2d(K,[1,5]),pe=(Te=U.basicLSTMCell(L.forgetBias,L.lstmKernel,L.lstmBias,he,pe,Ae))[0],Ae=Te[1];return U.concat(Te,1)}),F=ee.dataSync();ee.dispose();var ue=F.slice(0,this.numUnits),ie=F.slice(this.numUnits,2*this.numUnits);return{c:new Float32Array(ue),h:new Float32Array(ie)}},J.prototype.getPDF=function(R,P,$){var L=this;P===void 0&&(P=.65);var ee=P,F=.5+.5*ee;$&&(F=$);var ue=this.NMIXTURE,ie=U.tidy(function(){var he=L.numUnits,pe=U.tensor2d(R.h,[1,he]),Ae=U.scalar(Math.sqrt(ee)),Te=U.scalar(F),je=U.add(U.matMul(pe,L.outputKernel),L.outputBias).squeeze(),ke=U.split(je,[3,6*ue]),at=ke[0],St=ke[1],zt=U.split(St,6),$t=zt[0],we=zt[1],Tt=zt[2],Gt=zt[3],Pt=zt[4],Ye=zt[5],ln=U.softmax(at.div(Te)),Zt=[U.softmax($t.div(Te)),we,Tt,U.exp(Gt).mul(Ae),U.exp(Pt).mul(Ae),U.tanh(Ye),ln];return U.concat(Zt)}),K=ie.dataSync();return ie.dispose(),{pi:new Float32Array(K.slice(0,ue)),muX:new Float32Array(K.slice(1*ue,2*ue)),muY:new Float32Array(K.slice(2*ue,3*ue)),sigmaX:new Float32Array(K.slice(3*ue,4*ue)),sigmaY:new Float32Array(K.slice(4*ue,15*ue)),corr:new Float32Array(K.slice(5*ue,6*ue)),pen:new Float32Array(K.slice(6*ue,6*ue+3))}},J.prototype.zeroState=function(){return{c:new Float32Array(this.numUnits),h:new Float32Array(this.numUnits)}},J.prototype.copyState=function(R){return{c:new Float32Array(R.c),h:new Float32Array(R.h)}},J.prototype.zeroInput=function(){return[0,0,1,0,0]},J.prototype.sample=function(R){var P=B.sampleSoftmax(R.pi),$=R.muX[P],L=R.muY[P],ee=R.sigmaX[P],F=R.sigmaY[P],ue=R.corr[P],ie=[0,0,0];ie[B.sampleSoftmax(R.pen)]=1;var K=B.birandn($,L,ee,F,ue);return[K[0]*this.scaleFactor,K[1]*this.scaleFactor,ie[0],ie[1],ie[2]]},J.prototype.simplifyLine=function(R,P){return B.simplifyLine(R,P)},J.prototype.simplifyLines=function(R,P){return B.simplifyLines(R,P)},J.prototype.linesToStroke=function(R){return B.linesToStrokes(R)},J.prototype.lineToStroke=function(R,P){return B.lineToStroke(R,P)},J}();A.SketchRNN=re},function(Oe,A,o){Object.defineProperty(A,"__esModule",{value:!0});var b=o(256);A.SketchRNN=b.SketchRNN},function(Oe,A){Oe.exports=function(o){if(o===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o},Oe.exports.__esModule=!0,Oe.exports.default=Oe.exports},function(Oe,A){function o(b,H){return Oe.exports=o=Object.setPrototypeOf||function(U,B){return U.__proto__=B,U},Oe.exports.__esModule=!0,Oe.exports.default=Oe.exports,o(b,H)}Oe.exports=o,Oe.exports.__esModule=!0,Oe.exports.default=Oe.exports},function(Oe,A){Oe.exports=function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)},Oe.exports.__esModule=!0,Oe.exports.default=Oe.exports},function(Oe,A){Oe.exports=function(o,b){var H=o==null?null:typeof Symbol<"u"&&o[Symbol.iterator]||o["@@iterator"];if(H!=null){var U,B,re=[],J=!0,R=!1;try{for(H=H.call(o);!(J=(U=H.next()).done)&&(re.push(U.value),!b||re.length!==b);J=!0);}catch(P){R=!0,B=P}finally{try{J||H.return==null||H.return()}finally{if(R)throw B}}return re}},Oe.exports.__esModule=!0,Oe.exports.default=Oe.exports},function(Oe,A){Oe.exports=function(o){if(Array.isArray(o))return o},Oe.exports.__esModule=!0,Oe.exports.default=Oe.exports},function(Oe,A,o){Oe.exports=function(b){return typeof b=="object"&&b.isAxiosError===!0}},function(Oe,A,o){Oe.exports=function(b){return function(H){return b.apply(null,H)}}},function(Oe,A,o){var b=o(188);function H(U){if(typeof U!="function")throw new TypeError("executor must be a function.");var B;this.promise=new Promise(function(J){B=J});var re=this;U(function(J){re.reason||(re.reason=new b(J),B(re.reason))})}H.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},H.source=function(){var U;return{token:new H(function(B){U=B}),cancel:U}},Oe.exports=H},function(Oe){Oe.exports={name:"axios",version:"0.21.4",description:"Promise based HTTP client for the browser and node.js",main:"index.js",scripts:{test:"grunt test",start:"node ./sandbox/server.js",build:"NODE_ENV=production grunt build",preversion:"npm test",version:"npm run build && grunt version && git add -A dist && git add CHANGELOG.md bower.json package.json",postversion:"git push && git push --tags",examples:"node ./examples/server.js",coveralls:"cat coverage/lcov.info | ./node_modules/coveralls/bin/coveralls.js",fix:"eslint --fix lib/**/*.js"},repository:{type:"git",url:"https://github.com/axios/axios.git"},keywords:["xhr","http","ajax","promise","node"],author:"Matt Zabriskie",license:"MIT",bugs:{url:"https://github.com/axios/axios/issues"},homepage:"https://axios-http.com",devDependencies:{coveralls:"^3.0.0","es6-promise":"^4.2.4",grunt:"^1.3.0","grunt-banner":"^0.6.0","grunt-cli":"^1.2.0","grunt-contrib-clean":"^1.1.0","grunt-contrib-watch":"^1.0.0","grunt-eslint":"^23.0.0","grunt-karma":"^4.0.0","grunt-mocha-test":"^0.13.3","grunt-ts":"^6.0.0-beta.19","grunt-webpack":"^4.0.2","istanbul-instrumenter-loader":"^1.0.0","jasmine-core":"^2.4.1",karma:"^6.3.2","karma-chrome-launcher":"^3.1.0","karma-firefox-launcher":"^2.1.0","karma-jasmine":"^1.1.1","karma-jasmine-ajax":"^0.1.13","karma-safari-launcher":"^1.0.0","karma-sauce-launcher":"^4.3.6","karma-sinon":"^1.0.5","karma-sourcemap-loader":"^0.3.8","karma-webpack":"^4.0.2","load-grunt-tasks":"^3.5.2",minimist:"^1.2.0",mocha:"^8.2.1",sinon:"^4.5.0","terser-webpack-plugin":"^4.2.3",typescript:"^4.0.5","url-search-params":"^0.10.0",webpack:"^4.44.2","webpack-dev-server":"^3.11.0"},browser:{"./lib/adapters/http.js":"./lib/adapters/xhr.js"},jsdelivr:"dist/axios.min.js",unpkg:"dist/axios.min.js",typings:"./index.d.ts",dependencies:{"follow-redirects":"^1.14.0"},bundlesize:[{path:"./dist/axios.min.js",threshold:"5kB"}],_resolved:"https://registry.npmjs.org/axios/-/axios-0.21.4.tgz",_integrity:"sha512-ut5vewkiu8jjGBdqpM44XxjuCjq9LAKeHVmoVfHVzy8eHgxxq8SbAVQNovDA8mVi05kP0Ea/n/UzcSHcTJQfNg==",_from:"axios@0.21.4"}},function(Oe,A,o){var b=o(266),H={};["object","boolean","number","function","string","symbol"].forEach(function(J,R){H[J]=function(P){return typeof P===J||"a"+(R<1?"n ":" ")+J}});var U={},B=b.version.split(".");function re(J,R){for(var P=R?R.split("."):B,$=J.split("."),L=0;L<3;L++){if(P[L]>$[L])return!0;if(P[L]<$[L])return!1}return!1}H.transitional=function(J,R,P){var $=R&&re(R);function L(ee,F){return"[Axios v"+b.version+"] Transitional option '"+ee+"'"+F+(P?". "+P:"")}return function(ee,F,ue){if(J===!1)throw new Error(L(F," has been removed in "+R));return $&&!U[F]&&(U[F]=!0,console.warn(L(F," has been deprecated since v"+R+" and will be removed in the near future"))),!J||J(ee,F,ue)}},Oe.exports={isOlderVersion:re,assertOptions:function(J,R,P){if(typeof J!="object")throw new TypeError("options must be an object");for(var $=Object.keys(J),L=$.length;L-- >0;){var ee=$[L],F=R[ee];if(F){var ue=J[ee],ie=ue===void 0||F(ue,ee,J);if(ie!==!0)throw new TypeError("option "+ee+" must be "+ie)}else if(P!==!0)throw Error("Unknown option "+ee)}},validators:H}},function(Oe,A,o){var b=o(36);Oe.exports=b.isStandardBrowserEnv()?function(){var H,U=/(msie|trident)/i.test(navigator.userAgent),B=document.createElement("a");function re(J){var R=J;return U&&(B.setAttribute("href",R),R=B.href),B.setAttribute("href",R),{href:B.href,protocol:B.protocol?B.protocol.replace(/:$/,""):"",host:B.host,search:B.search?B.search.replace(/^\?/,""):"",hash:B.hash?B.hash.replace(/^#/,""):"",hostname:B.hostname,port:B.port,pathname:B.pathname.charAt(0)==="/"?B.pathname:"/"+B.pathname}}return H=re(window.location.href),function(J){var R=b.isString(J)?re(J):J;return R.protocol===H.protocol&&R.host===H.host}}():function(){return!0}},function(Oe,A,o){var b=o(36),H=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];Oe.exports=function(U){var B,re,J,R={};return U&&b.forEach(U.split(`
`),function(P){if(J=P.indexOf(":"),B=b.trim(P.substr(0,J)).toLowerCase(),re=b.trim(P.substr(J+1)),B){if(R[B]&&H.indexOf(B)>=0)return;R[B]=B==="set-cookie"?(R[B]?R[B]:[]).concat([re]):R[B]?R[B]+", "+re:re}}),R}},function(Oe,A,o){Oe.exports=function(b,H){return H?b.replace(/\/+$/,"")+"/"+H.replace(/^\/+/,""):b}},function(Oe,A,o){Oe.exports=function(b){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(b)}},function(Oe,A,o){var b=o(271),H=o(270);Oe.exports=function(U,B){return U&&!b(B)?H(U,B):B}},function(Oe,A,o){var b=o(36);Oe.exports=b.isStandardBrowserEnv()?{write:function(H,U,B,re,J,R){var P=[];P.push(H+"="+encodeURIComponent(U)),b.isNumber(B)&&P.push("expires="+new Date(B).toGMTString()),b.isString(re)&&P.push("path="+re),b.isString(J)&&P.push("domain="+J),R===!0&&P.push("secure"),document.cookie=P.join("; ")},read:function(H){var U=document.cookie.match(new RegExp("(^|;\\s*)("+H+")=([^;]*)"));return U?decodeURIComponent(U[3]):null},remove:function(H){this.write(H,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},function(Oe,A,o){var b=o(191);Oe.exports=function(H,U,B){var re=B.config.validateStatus;B.status&&re&&!re(B.status)?U(b("Request failed with status code "+B.status,B.config,null,B.request,B)):H(B)}},function(Oe,A,o){var b=o(36);Oe.exports=function(H,U){b.forEach(H,function(B,re){re!==U&&re.toUpperCase()===U.toUpperCase()&&(H[U]=B,delete H[re])})}},function(Oe,A,o){var b=o(36),H=o(136);Oe.exports=function(U,B,re){var J=this||H;return b.forEach(re,function(R){U=R.call(J,U,B)}),U}},function(Oe,A,o){var b=o(36),H=o(276),U=o(190),B=o(136);function re(J){J.cancelToken&&J.cancelToken.throwIfRequested()}Oe.exports=function(J){return re(J),J.headers=J.headers||{},J.data=H.call(J,J.data,J.headers,J.transformRequest),J.headers=b.merge(J.headers.common||{},J.headers[J.method]||{},J.headers),b.forEach(["delete","get","head","post","put","patch","common"],function(R){delete J.headers[R]}),(J.adapter||B.adapter)(J).then(function(R){return re(J),R.data=H.call(J,R.data,R.headers,J.transformResponse),R},function(R){return U(R)||(re(J),R&&R.response&&(R.response.data=H.call(J,R.response.data,R.response.headers,J.transformResponse))),Promise.reject(R)})}},function(Oe,A,o){var b=o(36);function H(){this.handlers=[]}H.prototype.use=function(U,B,re){return this.handlers.push({fulfilled:U,rejected:B,synchronous:!!re&&re.synchronous,runWhen:re?re.runWhen:null}),this.handlers.length-1},H.prototype.eject=function(U){this.handlers[U]&&(this.handlers[U]=null)},H.prototype.forEach=function(U){b.forEach(this.handlers,function(B){B!==null&&U(B)})},Oe.exports=H},function(Oe,A,o){var b=o(36),H=o(194),U=o(278),B=o(277),re=o(189),J=o(267),R=J.validators;function P($){this.defaults=$,this.interceptors={request:new U,response:new U}}P.prototype.request=function($){typeof $=="string"?($=arguments[1]||{}).url=arguments[0]:$=$||{},($=re(this.defaults,$)).method?$.method=$.method.toLowerCase():this.defaults.method?$.method=this.defaults.method.toLowerCase():$.method="get";var L=$.transitional;L!==void 0&&J.assertOptions(L,{silentJSONParsing:R.transitional(R.boolean,"1.0.0"),forcedJSONParsing:R.transitional(R.boolean,"1.0.0"),clarifyTimeoutError:R.transitional(R.boolean,"1.0.0")},!1);var ee=[],F=!0;this.interceptors.request.forEach(function(Te){typeof Te.runWhen=="function"&&Te.runWhen($)===!1||(F=F&&Te.synchronous,ee.unshift(Te.fulfilled,Te.rejected))});var ue,ie=[];if(this.interceptors.response.forEach(function(Te){ie.push(Te.fulfilled,Te.rejected)}),!F){var K=[B,void 0];for(Array.prototype.unshift.apply(K,ee),K=K.concat(ie),ue=Promise.resolve($);K.length;)ue=ue.then(K.shift(),K.shift());return ue}for(var he=$;ee.length;){var pe=ee.shift(),Ae=ee.shift();try{he=pe(he)}catch(Te){Ae(Te);break}}try{ue=B(he)}catch(Te){return Promise.reject(Te)}for(;ie.length;)ue=ue.then(ie.shift(),ie.shift());return ue},P.prototype.getUri=function($){return $=re(this.defaults,$),H($.url,$.params,$.paramsSerializer).replace(/^\?/,"")},b.forEach(["delete","get","head","options"],function($){P.prototype[$]=function(L,ee){return this.request(re(ee||{},{method:$,url:L,data:(ee||{}).data}))}}),b.forEach(["post","put","patch"],function($){P.prototype[$]=function(L,ee,F){return this.request(re(F||{},{method:$,url:L,data:ee}))}}),Oe.exports=P},function(Oe,A,o){var b=o(36),H=o(195),U=o(279),B=o(189);function re(R){var P=new U(R),$=H(U.prototype.request,P);return b.extend($,U.prototype,P),b.extend($,P),$}var J=re(o(136));J.Axios=U,J.create=function(R){return re(B(J.defaults,R))},J.Cancel=o(188),J.CancelToken=o(265),J.isCancel=o(190),J.all=function(R){return Promise.all(R)},J.spread=o(264),J.isAxiosError=o(263),Oe.exports=J,Oe.exports.default=J},function(Oe,A,o){var b=function(H){var U,B=Object.prototype,re=B.hasOwnProperty,J=typeof Symbol=="function"?Symbol:{},R=J.iterator||"@@iterator",P=J.asyncIterator||"@@asyncIterator",$=J.toStringTag||"@@toStringTag";function L(Bt,Mt,bn){return Object.defineProperty(Bt,Mt,{value:bn,enumerable:!0,configurable:!0,writable:!0}),Bt[Mt]}try{L({},"")}catch{L=function(Mt,bn,Dt){return Mt[bn]=Dt}}function ee(Bt,Mt,bn,Dt){var _t=Mt&&Mt.prototype instanceof Ae?Mt:Ae,xn=Object.create(_t.prototype),In=new Ye(Dt||[]);return xn._invoke=function(Yn,fn,We){var Pe=ue;return function(rt,Et){if(Pe===K)throw new Error("Generator is already running");if(Pe===he){if(rt==="throw")throw Et;return Zt()}for(We.method=rt,We.arg=Et;;){var Lt=We.delegate;if(Lt){var rn=Tt(Lt,We);if(rn){if(rn===pe)continue;return rn}}if(We.method==="next")We.sent=We._sent=We.arg;else if(We.method==="throw"){if(Pe===ue)throw Pe=he,We.arg;We.dispatchException(We.arg)}else We.method==="return"&&We.abrupt("return",We.arg);Pe=K;var Sn=F(Yn,fn,We);if(Sn.type==="normal"){if(Pe=We.done?he:ie,Sn.arg===pe)continue;return{value:Sn.arg,done:We.done}}Sn.type==="throw"&&(Pe=he,We.method="throw",We.arg=Sn.arg)}}}(Bt,bn,In),xn}function F(Bt,Mt,bn){try{return{type:"normal",arg:Bt.call(Mt,bn)}}catch(Dt){return{type:"throw",arg:Dt}}}H.wrap=ee;var ue="suspendedStart",ie="suspendedYield",K="executing",he="completed",pe={};function Ae(){}function Te(){}function je(){}var ke={};L(ke,R,function(){return this});var at=Object.getPrototypeOf,St=at&&at(at(ln([])));St&&St!==B&&re.call(St,R)&&(ke=St);var zt=je.prototype=Ae.prototype=Object.create(ke);function $t(Bt){["next","throw","return"].forEach(function(Mt){L(Bt,Mt,function(bn){return this._invoke(Mt,bn)})})}function we(Bt,Mt){var bn;this._invoke=function(Dt,_t){function xn(){return new Mt(function(In,Yn){(function fn(We,Pe,rt,Et){var Lt=F(Bt[We],Bt,Pe);if(Lt.type!=="throw"){var rn=Lt.arg,Sn=rn.value;return Sn&&typeof Sn=="object"&&re.call(Sn,"__await")?Mt.resolve(Sn.__await).then(function(kn){fn("next",kn,rt,Et)},function(kn){fn("throw",kn,rt,Et)}):Mt.resolve(Sn).then(function(kn){rn.value=kn,rt(rn)},function(kn){return fn("throw",kn,rt,Et)})}Et(Lt.arg)})(Dt,_t,In,Yn)})}return bn=bn?bn.then(xn,xn):xn()}}function Tt(Bt,Mt){var bn=Bt.iterator[Mt.method];if(bn===U){if(Mt.delegate=null,Mt.method==="throw"){if(Bt.iterator.return&&(Mt.method="return",Mt.arg=U,Tt(Bt,Mt),Mt.method==="throw"))return pe;Mt.method="throw",Mt.arg=new TypeError("The iterator does not provide a 'throw' method")}return pe}var Dt=F(bn,Bt.iterator,Mt.arg);if(Dt.type==="throw")return Mt.method="throw",Mt.arg=Dt.arg,Mt.delegate=null,pe;var _t=Dt.arg;return _t?_t.done?(Mt[Bt.resultName]=_t.value,Mt.next=Bt.nextLoc,Mt.method!=="return"&&(Mt.method="next",Mt.arg=U),Mt.delegate=null,pe):_t:(Mt.method="throw",Mt.arg=new TypeError("iterator result is not an object"),Mt.delegate=null,pe)}function Gt(Bt){var Mt={tryLoc:Bt[0]};1 in Bt&&(Mt.catchLoc=Bt[1]),2 in Bt&&(Mt.finallyLoc=Bt[2],Mt.afterLoc=Bt[3]),this.tryEntries.push(Mt)}function Pt(Bt){var Mt=Bt.completion||{};Mt.type="normal",delete Mt.arg,Bt.completion=Mt}function Ye(Bt){this.tryEntries=[{tryLoc:"root"}],Bt.forEach(Gt,this),this.reset(!0)}function ln(Bt){if(Bt){var Mt=Bt[R];if(Mt)return Mt.call(Bt);if(typeof Bt.next=="function")return Bt;if(!isNaN(Bt.length)){var bn=-1,Dt=function _t(){for(;++bn<Bt.length;)if(re.call(Bt,bn))return _t.value=Bt[bn],_t.done=!1,_t;return _t.value=U,_t.done=!0,_t};return Dt.next=Dt}}return{next:Zt}}function Zt(){return{value:U,done:!0}}return Te.prototype=je,L(zt,"constructor",je),L(je,"constructor",Te),Te.displayName=L(je,$,"GeneratorFunction"),H.isGeneratorFunction=function(Bt){var Mt=typeof Bt=="function"&&Bt.constructor;return!!Mt&&(Mt===Te||(Mt.displayName||Mt.name)==="GeneratorFunction")},H.mark=function(Bt){return Object.setPrototypeOf?Object.setPrototypeOf(Bt,je):(Bt.__proto__=je,L(Bt,$,"GeneratorFunction")),Bt.prototype=Object.create(zt),Bt},H.awrap=function(Bt){return{__await:Bt}},$t(we.prototype),L(we.prototype,P,function(){return this}),H.AsyncIterator=we,H.async=function(Bt,Mt,bn,Dt,_t){_t===void 0&&(_t=Promise);var xn=new we(ee(Bt,Mt,bn,Dt),_t);return H.isGeneratorFunction(Mt)?xn:xn.next().then(function(In){return In.done?In.value:xn.next()})},$t(zt),L(zt,$,"Generator"),L(zt,R,function(){return this}),L(zt,"toString",function(){return"[object Generator]"}),H.keys=function(Bt){var Mt=[];for(var bn in Bt)Mt.push(bn);return Mt.reverse(),function Dt(){for(;Mt.length;){var _t=Mt.pop();if(_t in Bt)return Dt.value=_t,Dt.done=!1,Dt}return Dt.done=!0,Dt}},H.values=ln,Ye.prototype={constructor:Ye,reset:function(Bt){if(this.prev=0,this.next=0,this.sent=this._sent=U,this.done=!1,this.delegate=null,this.method="next",this.arg=U,this.tryEntries.forEach(Pt),!Bt)for(var Mt in this)Mt.charAt(0)==="t"&&re.call(this,Mt)&&!isNaN(+Mt.slice(1))&&(this[Mt]=U)},stop:function(){this.done=!0;var Bt=this.tryEntries[0].completion;if(Bt.type==="throw")throw Bt.arg;return this.rval},dispatchException:function(Bt){if(this.done)throw Bt;var Mt=this;function bn(fn,We){return xn.type="throw",xn.arg=Bt,Mt.next=fn,We&&(Mt.method="next",Mt.arg=U),!!We}for(var Dt=this.tryEntries.length-1;Dt>=0;--Dt){var _t=this.tryEntries[Dt],xn=_t.completion;if(_t.tryLoc==="root")return bn("end");if(_t.tryLoc<=this.prev){var In=re.call(_t,"catchLoc"),Yn=re.call(_t,"finallyLoc");if(In&&Yn){if(this.prev<_t.catchLoc)return bn(_t.catchLoc,!0);if(this.prev<_t.finallyLoc)return bn(_t.finallyLoc)}else if(In){if(this.prev<_t.catchLoc)return bn(_t.catchLoc,!0)}else{if(!Yn)throw new Error("try statement without catch or finally");if(this.prev<_t.finallyLoc)return bn(_t.finallyLoc)}}}},abrupt:function(Bt,Mt){for(var bn=this.tryEntries.length-1;bn>=0;--bn){var Dt=this.tryEntries[bn];if(Dt.tryLoc<=this.prev&&re.call(Dt,"finallyLoc")&&this.prev<Dt.finallyLoc){var _t=Dt;break}}_t&&(Bt==="break"||Bt==="continue")&&_t.tryLoc<=Mt&&Mt<=_t.finallyLoc&&(_t=null);var xn=_t?_t.completion:{};return xn.type=Bt,xn.arg=Mt,_t?(this.method="next",this.next=_t.finallyLoc,pe):this.complete(xn)},complete:function(Bt,Mt){if(Bt.type==="throw")throw Bt.arg;return Bt.type==="break"||Bt.type==="continue"?this.next=Bt.arg:Bt.type==="return"?(this.rval=this.arg=Bt.arg,this.method="return",this.next="end"):Bt.type==="normal"&&Mt&&(this.next=Mt),pe},finish:function(Bt){for(var Mt=this.tryEntries.length-1;Mt>=0;--Mt){var bn=this.tryEntries[Mt];if(bn.finallyLoc===Bt)return this.complete(bn.completion,bn.afterLoc),Pt(bn),pe}},catch:function(Bt){for(var Mt=this.tryEntries.length-1;Mt>=0;--Mt){var bn=this.tryEntries[Mt];if(bn.tryLoc===Bt){var Dt=bn.completion;if(Dt.type==="throw"){var _t=Dt.arg;Pt(bn)}return _t}}throw new Error("illegal catch attempt")},delegateYield:function(Bt,Mt,bn){return this.delegate={iterator:ln(Bt),resultName:Mt,nextLoc:bn},this.method==="next"&&(this.arg=U),pe}},H}(Oe.exports);try{regeneratorRuntime=b}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=b:Function("r","regeneratorRuntime = r")(b)}},function(Oe,A,o){/** @license See the LICENSE file. */Object.defineProperty(A,"__esModule",{value:!0}),A.version="1.5.1"},function(Oe,A,o){/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/var b=this&&this.__awaiter||function(re,J,R,P){return new(R||(R=Promise))(function($,L){function ee(ie){try{ue(P.next(ie))}catch(K){L(K)}}function F(ie){try{ue(P.throw(ie))}catch(K){L(K)}}function ue(ie){ie.done?$(ie.value):new R(function(K){K(ie.value)}).then(ee,F)}ue((P=P.apply(re,J||[])).next())})};Object.defineProperty(A,"__esModule",{value:!0});const H=o(137),U=o(46),B=o(110);A.valuesDistribution=function(re,J){return b(this,void 0,void 0,function*(){const R=U.getDrawArea(re),P=yield B.tensorStats(J),$=yield J.data();H.histogram(R,$,{height:150,stats:P})})}},function(Oe,A,o){/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/var b=this&&this.__awaiter||function(B,re,J,R){return new(J||(J=Promise))(function(P,$){function L(ue){try{F(R.next(ue))}catch(ie){$(ie)}}function ee(ue){try{F(R.throw(ue))}catch(ie){$(ie)}}function F(ue){ue.done?P(ue.value):new J(function(ie){ie(ue.value)}).then(L,ee)}F((R=R.apply(B,re||[])).next())})};Object.defineProperty(A,"__esModule",{value:!0});const H=o(46),U=o(109);A.perClassAccuracy=function(B,re,J){return b(this,void 0,void 0,function*(){const R=H.getDrawArea(B),P=[];for(let $=0;$<re.length;$++){const L=J?J[$]:$.toString(),ee=re[$];P.push([L,ee.accuracy,ee.count])}return U.table(R,{headers:["Class","Accuracy","# Samples"],values:P})})}},function(Oe,A,o){/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/var b=this&&this.__awaiter||function($,L,ee,F){return new(ee||(ee=Promise))(function(ue,ie){function K(Ae){try{pe(F.next(Ae))}catch(Te){ie(Te)}}function he(Ae){try{pe(F.throw(Ae))}catch(Te){ie(Te)}}function pe(Ae){Ae.done?ue(Ae.value):new ee(function(Te){Te(Ae.value)}).then(K,he)}pe((F=F.apply($,L||[])).next())})};Object.defineProperty(A,"__esModule",{value:!0});const H=o(137),U=o(46),B=o(109),re=o(64),J=o(110);function R($){let L;return Array.isArray($.outputShape[0])?L=`[${$.outputShape.map(ee=>P(ee)).join(", ")}]`:L=P($.outputShape),{name:$.name,trainable:$.trainable,parameters:$.countParams(),outputShape:L}}function P($){const L=$.slice();return L.length===0?"Scalar":(L[0]===null&&(L[0]="batch"),`[${L.join(",")}]`)}A.modelSummary=function($,L){return b(this,void 0,void 0,function*(){const ee=U.getDrawArea($),F=function(ue){return{layers:ue.layers.map(R)}}(L).layers.map(ue=>[ue.name,ue.outputShape,ue.parameters,ue.trainable]);B.table(ee,{headers:["Layer Name","Output Shape","# Of Params","Trainable"],values:F})})},A.layer=function($,L){return b(this,void 0,void 0,function*(){const ee=U.getDrawArea($),F=yield function(pe){return b(this,void 0,void 0,function*(){const Ae=pe.getWeights(),Te=pe.weights,je=Ae.map(J.tensorStats),ke=yield Promise.all(je),at=Ae.map(St=>St.shape);return Ae.map((St,zt)=>({name:Te[zt].name,stats:ke[zt],shape:P(at[zt]),weight:St}))})}(L),ue=re.subSurface(ee,"layer-weights-info"),ie=F.map(pe=>[pe.name,pe.shape,pe.stats.min,pe.stats.max,pe.weight.size,pe.stats.numZeros,pe.stats.numNans,pe.stats.numInfs]);B.table(ue,{headers:["Weight Name","Shape","Min","Max","# Params","# Zeros","# NaNs","# Infinity"],values:ie});const K=re.subSurface(ee,"select-layer"),he=re.subSurface(ee,"param-distribution");(function(pe,Ae,Te){const je=`<div><button>Show Values Distribution for:</button>${`
    <select>
      ${pe.map(St=>`<option value=${St}>${St}</option>`)}
    </select>
  `}</div>`;Ae.innerHTML=je;const ke=Ae.querySelector("button"),at=Ae.querySelector("select");ke.addEventListener("click",()=>{Te(at.selectedOptions[0].label)})})(F.map(pe=>pe.name),K,pe=>b(this,void 0,void 0,function*(){const Ae=yield F.filter(Te=>Te.name===pe)[0].weight.data();H.histogram(he,Ae,{height:150,width:460,stats:!1})}))})}},function(Oe,A,o){/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/var b=this&&this.__awaiter||function($,L,ee,F){return new(ee||(ee=Promise))(function(ue,ie){function K(Ae){try{pe(F.next(Ae))}catch(Te){ie(Te)}}function he(Ae){try{pe(F.throw(Ae))}catch(Te){ie(Te)}}function pe(Ae){Ae.done?ue(Ae.value):new ee(function(Te){Te(Ae.value)}).then(K,he)}pe((F=F.apply($,L||[])).next())})};Object.defineProperty(A,"__esModule",{value:!0});const H=o(196),U=o(46),B=o(64);function re($,L,ee,F={}){return b(this,void 0,void 0,function*(){const ue=U.getDrawArea($),ie={};for(const Ae of ee)if(/val_/.test(Ae)){const Te=Ae.replace("val_","");J(ie,Te);const je=R(L,Ae,ee.indexOf(Ae));ie[Te].series.push(Ae),ie[Te].values.push(je)}else{const Te=R(L,Ae,ee.indexOf(Ae));J(ie,Ae),ie[Ae].series.push(Ae),ie[Ae].values.push(Te)}const K=Object.keys(ie),he=Object.assign({},{xLabel:"Iteration",yLabel:"Value"},F),pe=[];for(const Ae of K){const Te=B.subSurface(ue,Ae),je=ie[Ae].series,ke=ie[Ae].values;je.every(St=>!!St.match("acc"))&&(he.zoomToFitAccuracy?he.zoomToFit=!0:(he.yAxisDomain=[0,1],delete he.zoomToFit));const at=H.linechart(Te,{values:ke,series:je},he);pe.push(at)}yield Promise.all(pe)})}function J($,L){$[L]==null&&($[L]={series:[],values:[]})}function R($,L,ee){if(Array.isArray($)){const F=Array.isArray($[0])?$[ee]:$,ue=[];for(let ie=0;ie<F.length;ie++){const K=F[ie];ue.push({x:ie,y:K[L]})}return ue}return $.history[L].map((F,ue)=>({x:ue,y:F}))}function P($,L,ee){return $[L]==null&&($[L]={}),$[L][ee]==null&&($[L][ee]=[]),$[L][ee]}A.history=re,A.fitCallbacks=function($,L,ee={}){const F={},ue=ee.callbacks||["onEpochEnd","onBatchEnd"],ie=U.getDrawArea($),K=Object.assign({},ee);delete K.callbacks;const he={};return ue.forEach(pe=>{he[pe]=function(Ae){return(Te,je)=>b(this,void 0,void 0,function*(){/batch/i.test(Ae)?K.xLabel="Batch":/epoch/i.test(Ae)&&(K.xLabel="Epoch");const ke=[],at=[];for(const St of L)if(je[St]!=null){at.push(St);const zt=P(F,Ae,St);zt.push({[St]:je[St]}),ke.push(zt)}re(B.subSurface(ie,Ae,{title:Ae}),ke,at,K),yield U.nextFrame()})}(pe)}),he}},function(Oe,A,o){/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/var b=this&&this.__awaiter||function(P,$,L,ee){return new(L||(L=Promise))(function(F,ue){function ie(pe){try{he(ee.next(pe))}catch(Ae){ue(Ae)}}function K(pe){try{he(ee.throw(pe))}catch(Ae){ue(Ae)}}function he(pe){pe.done?F(pe.value):new L(function(Ae){Ae(pe.value)}).then(ie,K)}he((ee=ee.apply(P,$||[])).next())})},H=this&&this.__importDefault||function(P){return P&&P.__esModule?P:{default:P}};Object.defineProperty(A,"__esModule",{value:!0});const U=H(o(88)),B=o(64),re=o(111),J=o(46);A.scatterplot=function(P,$,L={}){return b(this,void 0,void 0,function*(){let ee=$.values;const F=$.series==null?[]:$.series,ue=[];(ee=Array.isArray(ee[0])?ee:[ee]).forEach((pe,Ae)=>{const Te=F[Ae]!=null?F[Ae]:`Series ${Ae+1}`,je=pe.map(ke=>Object.assign({},ke,{series:Te}));ue.push(...je)}),L.seriesColors!=null&&re.assert(L.seriesColors.length===ee.length,"Must have an equal number of series colors as there are data series");const ie=J.getDrawArea(P),K=Object.assign({},R,L),he={width:K.width||B.getDefaultWidth(ie),height:K.height||B.getDefaultHeight(ie),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:K.fontSize,titleFontSize:K.fontSize},text:{fontSize:K.fontSize},legend:{labelFontSize:K.fontSize,titleFontSize:K.fontSize}},data:{values:ue},mark:{type:"point",clip:!0,tooltip:{content:"data"}},encoding:{x:{field:"x",type:K.xType,title:K.xLabel,scale:K.zoomToFit?{zero:!1}:K.xAxisDomain!=null?{domain:K.xAxisDomain}:void 0},y:{field:"y",type:K.yType,title:K.yLabel,scale:K.zoomToFit?{zero:!1}:K.yAxisDomain!=null?{domain:K.yAxisDomain}:void 0},color:{field:"series",type:"nominal",scale:{range:K.seriesColors}},shape:{field:"series",type:"nominal"}}};return yield U.default(ie,he,{actions:!1,mode:"vega-lite",defaultStyle:!1}),Promise.resolve()})};const R={xLabel:"x",yLabel:"y",xType:"quantitative",yType:"quantitative",zoomToFit:!1,fontSize:11}},function(Oe,A,o){/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/var b=this&&this.__awaiter||function(ee,F,ue,ie){return new(ue||(ue=Promise))(function(K,he){function pe(je){try{Te(ie.next(je))}catch(ke){he(ke)}}function Ae(je){try{Te(ie.throw(je))}catch(ke){he(ke)}}function Te(je){je.done?K(je.value):new ue(function(ke){ke(je.value)}).then(pe,Ae)}Te((ie=ie.apply(ee,F||[])).next())})},H=this&&this.__importStar||function(ee){if(ee&&ee.__esModule)return ee;var F={};if(ee!=null)for(var ue in ee)Object.hasOwnProperty.call(ee,ue)&&(F[ue]=ee[ue]);return F.default=ee,F},U=this&&this.__importDefault||function(ee){return ee&&ee.__esModule?ee:{default:ee}};Object.defineProperty(A,"__esModule",{value:!0});const B=H(o(0)),re=U(o(88)),J=o(64),R=o(111),P=o(46);function $(ee,F,ue){const ie=ee instanceof B.Tensor?ee.shape:[ee.length,ee[0].length];ue===0?R.assert(ie[0]===F.length,`Length of xTickLabels (${F.length}) must match number of rows (${ie[0]})`):ue===1&&R.assert(ie[1]===F.length,`Length of yTickLabels (${F.length}) must match number of columns (${ie[1]})`)}A.heatmap=function(ee,F,ue={}){return b(this,void 0,void 0,function*(){const ie=Object.assign({},L,ue),K=P.getDrawArea(ee);let he=F.values;ie.rowMajor&&(he=yield function(zt){return b(this,void 0,void 0,function*(){let $t,we;zt instanceof B.Tensor?($t=zt.shape,we=zt.transpose()):($t=[zt.length,zt[0].length],we=B.tidy(()=>B.tensor2d(zt).transpose())),R.assert(we.rank===2,"Input to renderHeatmap must be a 2d array or Tensor2d");const Tt=yield we.array();we.dispose();const Gt=[Tt.length,Tt[0].length];return R.assert($t[0]===Gt[1]&&$t[1]===Gt[0],`Unexpected transposed shape. Original ${$t} : Transposed ${Gt}`),Tt})}(F.values));const{xTickLabels:pe,yTickLabels:Ae}=F;pe!=null&&$(he,pe,0),Ae!=null&&$(he,Ae,1);const Te=[];if(he instanceof B.Tensor){R.assert(he.rank===2,"Input to renderHeatmap must be a 2d array or Tensor2d");const zt=yield he.data(),[$t,we]=he.shape;for(let Tt=0;Tt<$t;Tt++){const Gt=pe?`${pe[Tt]}@tfidx@${Tt}`:Tt;for(let Pt=0;Pt<we;Pt++){const Ye=Ae?`${Ae[Pt]}@tfidx@${Pt}`:Pt,ln=zt[Tt*we+Pt];Te.push({x:Gt,y:Ye,value:ln})}}}else{const zt=he;for(let $t=0;$t<zt.length;$t++){const we=pe?`${pe[$t]}@tfidx@${$t}`:$t;for(let Tt=0;Tt<zt[$t].length;Tt++){const Gt=Ae?`${Ae[Tt]}@tfidx@${Tt}`:Tt,Pt=zt[$t][Tt];Te.push({x:we,y:Gt,value:Pt})}}}const je={actions:!1,mode:"vega-lite",defaultStyle:!1},ke={width:ie.width||J.getDefaultWidth(K),height:ie.height||J.getDefaultHeight(K),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:ie.fontSize,titleFontSize:ie.fontSize},text:{fontSize:ie.fontSize},legend:{labelFontSize:ie.fontSize,titleFontSize:ie.fontSize},scale:{bandPaddingInner:0,bandPaddingOuter:0}},data:{values:Te},mark:{type:"rect",tooltip:!0},encoding:{x:{field:"x",type:ie.xType,title:ie.xLabel,sort:!1},y:{field:"y",type:ie.yType,title:ie.yLabel,sort:!1},fill:{field:"value",type:"quantitative"}}},at=new RegExp("@tfidx@\\d+$");let St;switch(pe&&(ke.encoding.x.axis={labelExpr:"replace(datum.value, regexp(/@tfidx@\\d+$/), '')"}),Ae&&(ke.encoding.y.axis={labelExpr:"replace(datum.value, regexp(/@tfidx@\\d+$/), '')"}),(pe||Ae)&&(je.tooltip={sanitize:zt=>String(zt).replace(at,"")}),ie.colorMap){case"blues":St=["#f7fbff","#4292c6"];break;case"greyscale":St=["#000000","#ffffff"];break;case"viridis":default:St="viridis"}if(St!=="viridis"&&(ke.encoding.fill.scale={range:St}),ie.domain){const zt=ke.encoding.fill;zt.scale!=null?zt.scale=Object.assign({},zt.scale,{domain:ie.domain}):zt.scale={domain:ie.domain}}yield re.default(K,ke,je)})};const L={xLabel:null,yLabel:null,xType:"ordinal",yType:"ordinal",colorMap:"viridis",fontSize:12,domain:null,rowMajor:!1}},function(Oe,A,o){/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/var b=this&&this.__awaiter||function(R,P,$,L){return new($||($=Promise))(function(ee,F){function ue(he){try{K(L.next(he))}catch(pe){F(pe)}}function ie(he){try{K(L.throw(he))}catch(pe){F(pe)}}function K(he){he.done?ee(he.value):new $(function(pe){pe(he.value)}).then(ue,ie)}K((L=L.apply(R,P||[])).next())})},H=this&&this.__importDefault||function(R){return R&&R.__esModule?R:{default:R}};Object.defineProperty(A,"__esModule",{value:!0});const U=H(o(88)),B=o(64),re=o(46);A.confusionMatrix=function(R,P,$={}){return b(this,void 0,void 0,function*(){const L=Object.assign({},J,$),ee=re.getDrawArea(R),F=[],ue=P.values,ie=P.tickLabels||[],K=ie.length===0;let he=!0;for(let Te=0;Te<ue.length;Te++){const je=K?`Class ${Te}`:ie[Te];K&&ie.push(je);for(let ke=0;ke<ue[Te].length;ke++){const at=K?`Class ${ke}`:ie[ke],St=ue[Te][ke];Te!==ke||L.shadeDiagonal?(F.push({label:je,prediction:at,count:St,scaleCount:St}),St!==0&&(he=!1)):F.push({label:je,prediction:at,count:St,noFill:!0})}}if(!L.shadeDiagonal&&he)for(const Te of F)Te.noFill===!0&&(Te.noFill=!1,Te.scaleCount=Te.count);const pe={width:L.width||B.getDefaultWidth(ee),height:L.height||B.getDefaultHeight(ee),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:L.fontSize,titleFontSize:L.fontSize},text:{fontSize:L.fontSize},legend:{labelFontSize:L.fontSize,titleFontSize:L.fontSize}},data:{values:F},encoding:{x:{field:"prediction",type:"ordinal",title:L.xLabel||"prediction",scale:{domain:ie}},y:{field:"label",type:"ordinal",title:L.yLabel||"label",scale:{domain:ie}}},layer:[{transform:[{filter:"datum.noFill != true"}],mark:{type:"rect"},encoding:{color:{field:"scaleCount",type:"quantitative",scale:{range:L.colorMap}},tooltip:[{field:"label",type:"nominal"},{field:"prediction",type:"nominal"},{field:"count",type:"quantitative"}]}}]};L.shadeDiagonal===!1&&pe.layer.push({transform:[{filter:"datum.noFill == true"}],mark:{type:"rect",fill:"white"},encoding:{tooltip:[{field:"label",type:"nominal"},{field:"prediction",type:"nominal"},{field:"count",type:"quantitative"}]}}),L.showTextOverlay&&pe.layer.push({mark:{type:"text",baseline:"middle"},encoding:{text:{field:"count",type:"nominal"}}});const Ae=typeof L.colorMap=="string"?{scheme:L.colorMap}:L.colorMap;pe.layer[0].encoding.color.scale.range=Ae,yield U.default(ee,pe,{actions:!1,mode:"vega-lite",defaultStyle:!1})})};const J={xLabel:null,yLabel:null,xType:"nominal",yType:"nominal",shadeDiagonal:!0,fontSize:12,showTextOverlay:!0,height:400,colorMap:["#f7fbff","#4292c6"]}},function(Oe,A,o){/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});const b=o(138),H=o(102);A.Tabs=class extends b.Component{render(){const{tabNames:B,activeTab:re,handleClick:J}=this.props,R=B.length>0?B.map($=>b.h(U,{key:$,id:$,handleClick:J,isActive:$===re},$)):null,P=H.css({overflowX:"scroll",overflowY:"hidden",whiteSpace:"nowrap",borderBottomStyle:"solid",borderBottomWidth:"1px",borderColor:"#eee",paddingBottom:"1rem",marginTop:"1rem"});return b.h("div",{className:`${P} visor-tabs`},R)}};class U extends b.Component{render(){const{children:re,isActive:J,handleClick:R,id:P}=this.props,$=H.css({borderBottomColor:J?"#357EDD":"#AAAAAA",borderBottomWidth:"1px",borderBottomStyle:"solid",cursor:"pointer",":hover":{color:"#357EDD"},display:"inline-block",marginRight:"1rem",padding:".5rem",fontSize:"1rem",fontWeight:"bold"});return b.h("a",{className:`${$} tf-tab`,"data-isactive":J,onClick:()=>R(P)},re)}}},function(Oe,A,o){/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});const b=o(138),H=o(102);class U extends b.Component{componentDidMount(){const{name:re,tab:J}=this.props;this.props.registerSurface(re,J,this)}componentDidUpdate(){return!1}render(){const{name:re,visible:J,styles:R}=this.props,P=Object.assign({},U.defaultStyles,R),{width:$,height:L}=P;let{maxHeight:ee,maxWidth:F}=P;ee=L===U.defaultStyles.height?ee:L,F=$===U.defaultStyles.width?F:$;const ue=H.css({display:J?"block":"none",backgroundColor:"white",marginTop:"10px",marginBottom:"10px",boxShadow:"0 0 6px -3px #777",padding:"10px !important",height:L,width:$,maxHeight:ee,maxWidth:F,overflow:"auto"}),ie=H.css({backgroundColor:"white",boxSizing:"border-box",borderBottom:"1px solid #357EDD",lineHeight:"2em",marginBottom:"20px",fontWeight:"600",textAlign:"center"}),K=H.css({boxSizing:"border-box"});return b.h("div",{className:`${ue} tf-surface`,ref:he=>this.container=he,"data-visible":J},b.h("div",{className:`${ie} tf-label`,ref:he=>this.label=he},re),b.h("div",{className:`${K} tf-draw-area`,ref:he=>this.drawArea=he}))}}U.defaultStyles={maxWidth:"550px",maxHeight:"580px",height:"auto",width:"auto"},A.SurfaceComponent=U},function(Oe,A,o){/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});const b=o(138),H=o(102),U=o(291),B=o(290);class re extends b.Component{static render(P,$,L){return b.render(b.h(re,Object.assign({},L)),P,$)}constructor(P){super(P),this.surfaces=new Map;const $=P.startOpen==null||P.startOpen;this.state={isOpen:$,isFullscreen:!1,activeTab:null,tabs:new Set},this.keyHandler=this.keyHandler.bind(this)}close(){this.setState({isOpen:!1})}open(){this.setState({isOpen:!0})}toggle(){this.setState({isOpen:!this.state.isOpen})}toggleFullScreen(){this.setState({isFullscreen:!this.state.isFullscreen})}isOpen(){return this.state.isOpen}isFullscreen(){return this.state.isFullscreen}getSurface(P,$){const L=this.surfaceId(P,$);let ee;if(!this.surfaces.has(L))throw Error(`Surface not found with id: ${L}`);return{container:(ee=this.surfaces.get(L)).container,label:ee.label,drawArea:ee.drawArea}}bindKeys(){document.addEventListener("keydown",this.keyHandler,!1)}unbindKeys(){document.removeEventListener("keydown",this.keyHandler)}surfaceId(P,$){return P+$}setTabs(P){const $=P.map(F=>F.tab),L=this.state.tabs;let ee;for(const F of $)L.has(F)||(L.add(F),ee=F);ee!=null&&this.setState({tabs:L,activeTab:ee})}getTabs(){return this.state.tabs}registerSurface(P,$,L){const ee=this.surfaceId(P,$);this.surfaces.set(ee,L)}keyHandler(P){P.keyCode===192&&(P.shiftKey?this.toggleFullScreen():this.toggle())}setActiveTab(P){this.setState({activeTab:P})}componentDidMount(){this.bindKeys()}componentWillMount(){this.setTabs(this.props.surfaceList)}componentWillReceiveProps(P){this.setTabs(P.surfaceList)}render(){const{isOpen:P,isFullscreen:$,activeTab:L}=this.state,{surfaceList:ee}=this.props,F=Array.from(this.getTabs().values()),ue=$?"90vw":"550px",ie=H.css({width:ue,height:"100%",backgroundColor:"#fafafa",boxSizing:"border-box",padding:"10px",position:"fixed",top:"0px",transition:"right 0.5s cubic-bezier(0.645, 0.045, 0.355, 1), width 0.5s cubic-bezier(0.645, 0.045, 0.355, 1)",boxShadow:"0 2px 5px rgba(0, 0, 0, 0.12), 0 2px 5px rgba(0, 0, 0, 0.24)",overflow:"auto",fontFamily:"sans-serif",fontSize:"14px",zIndex:1e3}),K=H.css({right:"0"}),he=H.css({right:`calc(-${ue} - 10px)`}),pe=P?K:he,Ae=H.css({});return b.h("div",{className:`${ie} ${pe} visor`,"data-isopen":P,"data-isfullscreen":$},b.h(J,{fullScreenHandler:this.toggleFullScreen.bind(this),closeHandler:this.close.bind(this),isFullScreen:$}),b.h(B.Tabs,{tabNames:F,activeTab:L,handleClick:this.setActiveTab.bind(this)}),b.h("div",{className:`${Ae} visor-surfaces`},ee.map(Te=>b.h(U.SurfaceComponent,{key:Te.name+Te.tab,name:Te.name,tab:Te.tab,styles:Te.styles,registerSurface:this.registerSurface.bind(this),visible:L===Te.tab}))))}}function J(R){const{isFullScreen:P,fullScreenHandler:$,closeHandler:L}=R,ee=H.css({display:"flex",backgroundColor:"white",border:"1px solid white",padding:"6px",paddingTop:"10px",marginBottom:"10px",borderRadius:"6px",marginTop:"-16px"}),F=H.css({fontSize:".875rem",borderRadius:".25rem",paddingLeft:"1rem",paddingRight:"1rem",paddingTop:".5rem",paddingBottom:".5rem",textDecoration:"none",transition:"color .15s ease-in",color:"#111"}),ue=H.css({marginLeft:"auto"});return b.h("div",{className:`${ee} visor-controls`},b.h("button",{className:`${F}`,onClick:$},P?"Minimize":"Maximize"),b.h("button",{className:`${F} ${ue}`,onClick:L},"Hide"))}A.VisorComponent=re},function(Oe,A,o){function b(B,re){return B.charCodeAt(re++)+(B.charCodeAt(re++)<<8)+(B.charCodeAt(re++)<<16)+(B.charCodeAt(re)<<24)}function H(B,re){return B.charCodeAt(re++)+(B.charCodeAt(re++)<<8)}function U(B,re){return(65535&(B|=0))*(re|=0)+(((B>>>16)*re&65535)<<16)|0}Object.defineProperty(A,"__esModule",{value:!0}),A.default=function(B,re){for(var J=1540483477,R=re^B.length,P=B.length,$=0;P>=4;){var L=b(B,$);L=U(L,J),L=U(L^=L>>>24,J),R=U(R,J),R^=L,$+=4,P-=4}switch(P){case 3:R^=H(B,$),R=U(R^=B.charCodeAt($+2)<<16,J);break;case 2:R=U(R^=H(B,$),J);break;case 1:R=U(R^=B.charCodeAt($),J)}return R=U(R^=R>>>13,J),(R^=R>>>15)>>>0}},function(Oe,A,o){o.r(A);var b=/[A-Z]/g,H=/^ms-/,U={};function B(re){return"-"+re.toLowerCase()}A.default=function(re){if(U.hasOwnProperty(re))return U[re];var J=re.replace(b,B);return U[re]=H.test(J)?"-"+J:J}},function(Oe,A,o){Object.defineProperty(A,"__esModule",{value:!0}),A.default=function(H){return(0,b.default)(H)};var b=function(H){return H&&H.__esModule?H:{default:H}}(o(294));Oe.exports=A.default},function(Oe,A,o){Object.defineProperty(A,"__esModule",{value:!0}),A.default=function(R,P,$,L){if(typeof P=="string"&&re.hasOwnProperty(R)){var ee=function(ie,K){if((0,H.default)(ie))return ie;for(var he=ie.split(/,(?![^()]*(?:\([^()]*\))?\))/g),pe=0,Ae=he.length;pe<Ae;++pe){var Te=he[pe],je=[Te];for(var ke in K){var at=(0,b.default)(ke);if(Te.indexOf(at)>-1&&at!=="order")for(var St=K[ke],zt=0,$t=St.length;zt<$t;++zt)je.unshift(Te.replace(at,J[St[zt]]+at))}he[pe]=je.join(",")}return he.join(",")}(P,L),F=ee.split(/,(?![^()]*(?:\([^()]*\))?\))/g).filter(function(ie){return!/-moz-|-ms-/.test(ie)}).join(",");if(R.indexOf("Webkit")>-1)return F;var ue=ee.split(/,(?![^()]*(?:\([^()]*\))?\))/g).filter(function(ie){return!/-webkit-|-ms-/.test(ie)}).join(",");return R.indexOf("Moz")>-1?ue:($["Webkit"+(0,U.default)(R)]=F,$["Moz"+(0,U.default)(R)]=ue,ee)}};var b=B(o(295)),H=B(o(101)),U=B(o(199));function B(R){return R&&R.__esModule?R:{default:R}}var re={transition:!0,transitionProperty:!0,WebkitTransition:!0,WebkitTransitionProperty:!0,MozTransition:!0,MozTransitionProperty:!0},J={Webkit:"-webkit-",Moz:"-moz-",ms:"-ms-"};Oe.exports=A.default},function(Oe,A,o){Object.defineProperty(A,"__esModule",{value:!0}),A.default=function(B,re){if(H.hasOwnProperty(B)&&U.hasOwnProperty(re))return b.map(function(J){return J+re})};var b=["-webkit-","-moz-",""],H={maxHeight:!0,maxWidth:!0,width:!0,height:!0,columnWidth:!0,minWidth:!0,minHeight:!0},U={"min-content":!0,"max-content":!0,"fill-available":!0,"fit-content":!0,"contain-floats":!0};Oe.exports=A.default},function(Oe,A,o){Object.defineProperty(A,"__esModule",{value:!0}),A.default=function(b,H){if(b==="position"&&H==="sticky")return["-webkit-sticky","sticky"]},Oe.exports=A.default},function(Oe,A,o){Object.defineProperty(A,"__esModule",{value:!0}),A.default=function(U,B){if(typeof B=="string"&&!(0,b.default)(B)&&B.indexOf("image-set(")>-1)return H.map(function(re){return B.replace(/image-set\(/g,re+"image-set(")})};var b=function(U){return U&&U.__esModule?U:{default:U}}(o(101)),H=["-webkit-",""];Oe.exports=A.default},function(Oe,A,o){Object.defineProperty(A,"__esModule",{value:!0}),A.default=function(B,re){if(typeof re=="string"&&!(0,b.default)(re)&&U.test(re))return H.map(function(J){return J+re})};var b=function(B){return B&&B.__esModule?B:{default:B}}(o(101)),H=["-webkit-","-moz-",""],U=/linear-gradient|radial-gradient|repeating-linear-gradient|repeating-radial-gradient/;Oe.exports=A.default},function(Oe,A,o){Object.defineProperty(A,"__esModule",{value:!0}),A.default=function(U,B,re){U==="flexDirection"&&typeof B=="string"&&(B.indexOf("column")>-1?re.WebkitBoxOrient="vertical":re.WebkitBoxOrient="horizontal",B.indexOf("reverse")>-1?re.WebkitBoxDirection="reverse":re.WebkitBoxDirection="normal"),H.hasOwnProperty(U)&&(re[H[U]]=b[B]||B)};var b={"space-around":"justify","space-between":"justify","flex-start":"start","flex-end":"end","wrap-reverse":"multiple",wrap:"multiple"},H={alignItems:"WebkitBoxAlign",justifyContent:"WebkitBoxPack",flexWrap:"WebkitBoxLines"};Oe.exports=A.default},function(Oe,A,o){Object.defineProperty(A,"__esModule",{value:!0}),A.default=function(H,U){if(H==="display"&&b.hasOwnProperty(U))return b[U]};var b={flex:["-webkit-box","-moz-box","-ms-flexbox","-webkit-flex","flex"],"inline-flex":["-webkit-inline-box","-moz-inline-box","-ms-inline-flexbox","-webkit-inline-flex","inline-flex"]};Oe.exports=A.default},function(Oe,A,o){Object.defineProperty(A,"__esModule",{value:!0}),A.default=function(U,B){if(typeof B=="string"&&!(0,b.default)(B)&&B.indexOf("filter(")>-1)return H.map(function(re){return B.replace(/filter\(/g,re+"filter(")})};var b=function(U){return U&&U.__esModule?U:{default:U}}(o(101)),H=["-webkit-",""];Oe.exports=A.default},function(Oe,A,o){Object.defineProperty(A,"__esModule",{value:!0}),A.default=function(U,B){if(typeof B=="string"&&!(0,b.default)(B)&&B.indexOf("cross-fade(")>-1)return H.map(function(re){return B.replace(/cross-fade\(/g,re+"cross-fade(")})};var b=function(U){return U&&U.__esModule?U:{default:U}}(o(101)),H=["-webkit-",""];Oe.exports=A.default},function(Oe,A,o){Object.defineProperty(A,"__esModule",{value:!0}),A.default=function(U,B){if(U==="cursor"&&H.hasOwnProperty(B))return b.map(function(re){return re+B})};var b=["-webkit-","-moz-",""],H={"zoom-in":!0,"zoom-out":!0,grab:!0,grabbing:!0};Oe.exports=A.default},function(Oe,A,o){Object.defineProperty(A,"__esModule",{value:!0}),A.default=function(b,H,U,B,re){for(var J=0,R=b.length;J<R;++J){var P=b[J](H,U,B,re);if(P)return P}},Oe.exports=A.default},function(Oe,A,o){Object.defineProperty(A,"__esModule",{value:!0}),A.default=function(H,U,B){if(H.hasOwnProperty(U))for(var re=H[U],J=0,R=re.length;J<R;++J)B[re[J]+(0,b.default)(U)]=B[U]};var b=function(H){return H&&H.__esModule?H:{default:H}}(o(199));Oe.exports=A.default},function(Oe,A,o){Object.defineProperty(A,"__esModule",{value:!0});var b=["Webkit"],H=["Moz"],U=["ms"],B=["Webkit","Moz"],re=["Webkit","ms"],J=["Webkit","Moz","ms"];A.default={plugins:[],prefixMap:{appearance:B,userSelect:J,textEmphasisPosition:b,textEmphasis:b,textEmphasisStyle:b,textEmphasisColor:b,boxDecorationBreak:b,clipPath:b,maskImage:b,maskMode:b,maskRepeat:b,maskPosition:b,maskClip:b,maskOrigin:b,maskSize:b,maskComposite:b,mask:b,maskBorderSource:b,maskBorderMode:b,maskBorderSlice:b,maskBorderWidth:b,maskBorderOutset:b,maskBorderRepeat:b,maskBorder:b,maskType:b,textDecorationStyle:b,textDecorationSkip:b,textDecorationLine:b,textDecorationColor:b,filter:b,fontFeatureSettings:b,breakAfter:J,breakBefore:J,breakInside:J,columnCount:B,columnFill:B,columnGap:B,columnRule:B,columnRuleColor:B,columnRuleStyle:B,columnRuleWidth:B,columns:B,columnSpan:B,columnWidth:B,writingMode:re,flex:b,flexBasis:b,flexDirection:b,flexGrow:b,flexFlow:b,flexShrink:b,flexWrap:b,alignContent:b,alignItems:b,alignSelf:b,justifyContent:b,order:b,transform:b,transformOrigin:b,transformOriginX:b,transformOriginY:b,backfaceVisibility:b,perspective:b,perspectiveOrigin:b,transformStyle:b,transformOriginZ:b,animation:b,animationDelay:b,animationDirection:b,animationFillMode:b,animationDuration:b,animationIterationCount:b,animationName:b,animationPlayState:b,animationTimingFunction:b,backdropFilter:b,fontKerning:b,scrollSnapType:re,scrollSnapPointsX:re,scrollSnapPointsY:re,scrollSnapDestination:re,scrollSnapCoordinate:re,shapeImageThreshold:b,shapeImageMargin:b,shapeImageOutside:b,hyphens:J,flowInto:re,flowFrom:re,regionFragment:re,textAlignLast:H,tabSize:H,wrapFlow:U,wrapThrough:U,wrapMargin:U,gridTemplateColumns:U,gridTemplateRows:U,gridTemplateAreas:U,gridTemplate:U,gridAutoColumns:U,gridAutoRows:U,gridAutoFlow:U,grid:U,gridRowStart:U,gridColumnStart:U,gridRowEnd:U,gridRow:U,gridColumn:U,gridColumnEnd:U,gridColumnGap:U,gridRowGap:U,gridArea:U,gridGap:U,textSizeAdjust:re,borderImage:b,borderImageOutset:b,borderImageRepeat:b,borderImageSlice:b,borderImageSource:b,borderImageWidth:b,transitionDelay:b,transitionDuration:b,transitionProperty:b,transitionTimingFunction:b}},Oe.exports=A.default},function(Oe,A,o){Object.defineProperty(A,"__esModule",{value:!0}),A.default=function(pe){for(var Ae in pe){var Te=pe[Ae],je=(0,U.default)(K,Ae,Te,pe,he);je&&(pe[Ae]=je),(0,H.default)(he,Ae,pe)}return pe};var b=ie(o(308)),H=ie(o(307)),U=ie(o(306)),B=ie(o(305)),re=ie(o(304)),J=ie(o(303)),R=ie(o(302)),P=ie(o(301)),$=ie(o(300)),L=ie(o(299)),ee=ie(o(298)),F=ie(o(297)),ue=ie(o(296));function ie(pe){return pe&&pe.__esModule?pe:{default:pe}}var K=[re.default,B.default,J.default,P.default,$.default,L.default,ee.default,F.default,ue.default,R.default],he=b.default.prefixMap},function(Oe,A,o){Object.defineProperty(A,"__esModule",{value:!0});var b=Object.assign||function(P){for(var $=1;$<arguments.length;$++){var L=arguments[$];for(var ee in L)Object.prototype.hasOwnProperty.call(L,ee)&&(P[ee]=L[ee])}return P};A.PluginSet=J,A.fallbacks=function(P){if(Object.keys(P.style).map(function(ee){return Array.isArray(P.style[ee])}).indexOf(!0)>=0){var $=P.style,L=Object.keys($).reduce(function(ee,F){return ee[F]=Array.isArray($[F])?$[F].join("; "+(0,U.processStyleName)(F)+": "):$[F],ee},{});return(0,H.default)({},P,{style:L})}return P},A.contentWrap=function(P){if(P.style.content){var $=P.style.content;return R.indexOf($)>=0||/^(attr|calc|counters?|url)\(/.test($)?P:$.charAt(0)!==$.charAt($.length-1)||$.charAt(0)!=='"'&&$.charAt(0)!=="'"?b({},P,{style:b({},P.style,{content:'"'+$+'"'})}):P}return P},A.prefixes=function(P){return(0,H.default)({},P,{style:(0,B.default)(b({},P.style))})};var H=re(o(139)),U=o(201),B=re(o(309));function re(P){return P&&P.__esModule?P:{default:P}}function J(P){this.fns=P||[]}(0,H.default)(J.prototype,{add:function(){for(var P=this,$=arguments.length,L=Array($),ee=0;ee<$;ee++)L[ee]=arguments[ee];L.forEach(function(F){P.fns.indexOf(F)>=0||(P.fns=[F].concat(P.fns))})},remove:function(P){this.fns=this.fns.filter(function($){return $!==P})},clear:function(){this.fns=[]},transform:function(P){return this.fns.reduce(function($,L){return L($)},P)}});var R=["normal","none","counter","open-quote","close-quote","no-open-quote","no-close-quote","initial","inherit"]},function(Oe,A,o){Object.defineProperty(A,"__esModule",{value:!0});var b=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(B){return typeof B}:function(B){return B&&typeof Symbol=="function"&&B.constructor===Symbol&&B!==Symbol.prototype?"symbol":typeof B};function H(B){if(function(ee){return ee==null||ee===!1||(ee===void 0?"undefined":b(ee))==="object"&&Object.keys(ee).length===0}(B))return null;if((B===void 0?"undefined":b(B))!=="object")return B;for(var re={},J=Object.keys(B),R=!1,P=0;P<J.length;P++){var $=B[J[P]],L=U($);L!==null&&L===$||(R=!0),L!==null&&(re[J[P]]=L)}return Object.keys(re).length===0?null:R?re:B}function U(B){return Array.isArray(B)?function(re){var J=!1,R=[];return re.forEach(function(P){var $=U(P);$!==null&&$===P||(J=!0),$!==null&&R.push($)}),R.length==0?null:J?R:re}(B):H(B)}A.default=U},function(Oe,A,o){Oe.exports=function(b){var H={};return function(U){return H.hasOwnProperty(U)||(H[U]=b.call(this,U)),H[U]}}},function(Oe,A,o){var b=/([A-Z])/g;Oe.exports=function(H){return H.replace(b,"-$1").toLowerCase()}},function(Oe,A,o){var b=o(313),H=/^ms-/;Oe.exports=function(U){return b(U).replace(H,"-ms-")}},function(Oe,A,o){function b(U){return function(){return U}}var H=function(){};H.thatReturns=b,H.thatReturnsFalse=b(!1),H.thatReturnsTrue=b(!0),H.thatReturnsNull=b(null),H.thatReturnsThis=function(){return this},H.thatReturnsArgument=function(U){return U},Oe.exports=H},function(Oe,A,o){Object.defineProperty(A,"__esModule",{value:!0});var b={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridRow:!0,gridRowStart:!0,gridRowEnd:!0,gridColumn:!0,gridColumnStart:!0,gridColumnEnd:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},H=["Webkit","ms","Moz","O"];Object.keys(b).forEach(function(B){H.forEach(function(re){b[function(J,R){return J+R.charAt(0).toUpperCase()+R.substring(1)}(re,B)]=b[B]})});var U={isUnitlessNumber:b,shorthandPropertyExpansions:{background:{backgroundAttachment:!0,backgroundColor:!0,backgroundImage:!0,backgroundPositionX:!0,backgroundPositionY:!0,backgroundRepeat:!0},backgroundPosition:{backgroundPositionX:!0,backgroundPositionY:!0},border:{borderWidth:!0,borderStyle:!0,borderColor:!0},borderBottom:{borderBottomWidth:!0,borderBottomStyle:!0,borderBottomColor:!0},borderLeft:{borderLeftWidth:!0,borderLeftStyle:!0,borderLeftColor:!0},borderRight:{borderRightWidth:!0,borderRightStyle:!0,borderRightColor:!0},borderTop:{borderTopWidth:!0,borderTopStyle:!0,borderTopColor:!0},font:{fontStyle:!0,fontVariant:!0,fontWeight:!0,fontSize:!0,lineHeight:!0,fontFamily:!0},outline:{outlineWidth:!0,outlineStyle:!0,outlineColor:!0}}};A.default=U},function(Oe,A,o){Object.defineProperty(A,"__esModule",{value:!0});var b=H(o(316));H(o(200));function H(B){return B&&B.__esModule?B:{default:B}}var U=b.default.isUnitlessNumber;A.default=function(B,re,J){return re==null||typeof re=="boolean"||re===""?"":isNaN(re)||re===0||U.hasOwnProperty(B)&&U[B]?""+re:(typeof re=="string"&&(re=re.trim()),re+"px")}},function(Oe,A,o){var b=/-(.)/g;Oe.exports=function(H){return H.replace(b,function(U,B){return B.toUpperCase()})}},function(Oe,A,o){var b=o(318),H=/^-ms-/;Oe.exports=function(U){return b(U.replace(H,"ms-"))}},function(Oe,A,o){Object.defineProperty(A,"__esModule",{value:!0}),A.StyleSheet=R;var b=function(P){return P&&P.__esModule?P:{default:P}}(o(139));function H(P){return P[P.length-1]}function U(P){if(P.sheet)return P.sheet;for(var $=0;$<document.styleSheets.length;$++)if(document.styleSheets[$].ownerNode===P)return document.styleSheets[$]}var B=typeof window<"u",re=function(){if(B){var P=document.createElement("div");return P.innerHTML="<!--[if lt IE 10]><i></i><![endif]-->",P.getElementsByTagName("i").length===1}}();function J(){var P=document.createElement("style");return P.type="text/css",P.setAttribute("data-glamor",""),P.appendChild(document.createTextNode("")),(document.head||document.getElementsByTagName("head")[0]).appendChild(P),P}function R(){var P=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},$=P.speedy,L=$===void 0?!0:$,ee=P.maxLength,F=ee===void 0?B&&re?4e3:65e3:ee;this.isSpeedy=L,this.sheet=void 0,this.tags=[],this.maxLength=F,this.ctr=0}(0,b.default)(R.prototype,{getSheet:function(){return U(H(this.tags))},inject:function(){var P=this;if(this.injected)throw new Error("already injected stylesheet!");B?this.tags[0]=J():this.sheet={cssRules:[],insertRule:function($){P.sheet.cssRules.push({cssText:$})}},this.injected=!0},speedy:function(P){if(this.ctr!==0)throw new Error("cannot change speedy mode after inserting any rule to sheet. Either call speedy("+P+") earlier in your app, or call flush() before speedy("+P+")");this.isSpeedy=!!P},_insert:function(P){try{var $=this.getSheet();$.insertRule(P,P.indexOf("@import")!==-1?0:$.cssRules.length)}catch{}},insert:function(P){if(B)if(this.isSpeedy&&this.getSheet().insertRule)this._insert(P);else if(P.indexOf("@import")!==-1){var $=H(this.tags);$.insertBefore(document.createTextNode(P),$.firstChild)}else H(this.tags).appendChild(document.createTextNode(P));else this.sheet.insertRule(P,P.indexOf("@import")!==-1?0:this.sheet.cssRules.length);return this.ctr++,B&&this.ctr%this.maxLength==0&&this.tags.push(J()),this.ctr-1},delete:function(P){return this.replace(P,"")},flush:function(){B?(this.tags.forEach(function(P){return P.parentNode.removeChild(P)}),this.tags=[],this.sheet=null,this.ctr=0):this.sheet.cssRules=[],this.injected=!1},rules:function(){if(!B)return this.sheet.cssRules;var P=[];return this.tags.forEach(function($){return P.splice.apply(P,[P.length,0].concat(function(L){if(Array.isArray(L)){for(var ee=0,F=Array(L.length);ee<L.length;ee++)F[ee]=L[ee];return F}return Array.from(L)}(Array.from(U($).cssRules))))}),P}})},function(Oe,A,o){o.r(A),o.d(A,"default",function(){return J});var b=o(null),H=o(87),U=o(null),B=o(null),re=o(null);function J(){var R=[],P=B.c;function $(L){if(L!=null&&!isNaN(L=+L))return P((Object(b.c)(R,L,1)-1)/(R.length-1))}return $.domain=function(L){if(!arguments.length)return R.slice();R=[];for(let ee of L)ee==null||isNaN(ee=+ee)||R.push(ee);return R.sort(H.a),$},$.interpolator=function(L){return arguments.length?(P=L,$):P},$.range=function(){return R.map((L,ee)=>P(ee/(R.length-1)))},$.quantiles=function(L){return Array.from({length:L+1},(ee,F)=>Object(U.b)(R,F/L))},$.copy=function(){return J(P).domain(R)},re.b.apply($,arguments)}},function(Oe,A,o){o.r(A),o.d(A,"default",function(){return J});var b=o(null),H=o(null),U=o(null),B=o(null);function re(R){return Math.sign(R)*R*R}function J(){var R,P=Object(b.a)(),$=[0,1],L=!1;function ee(F){var ue=function(ie){return Math.sign(ie)*Math.sqrt(Math.abs(ie))}(P(F));return isNaN(ue)?R:L?Math.round(ue):ue}return ee.invert=function(F){return P.invert(re(F))},ee.domain=function(F){return arguments.length?(P.domain(F),ee):P.domain()},ee.range=function(F){return arguments.length?(P.range(($=Array.from(F,B.a)).map(re)),ee):$.slice()},ee.rangeRound=function(F){return ee.range(F).round(!0)},ee.round=function(F){return arguments.length?(L=!!F,ee):L},ee.clamp=function(F){return arguments.length?(P.clamp(F),ee):P.clamp()},ee.unknown=function(F){return arguments.length?(R=F,ee):R},ee.copy=function(){return J(P.domain(),$).round(L).clamp(P.clamp()).unknown(R)},H.a.apply(ee,arguments),Object(U.b)(ee)}},function(Oe,A,o){const b=o(47),H=o(113),{ANY:U}=H,B=o(112),re=o(48),J=($,L,ee)=>{if($===L)return!0;if($.length===1&&$[0].semver===U){if(L.length===1&&L[0].semver===U)return!0;$=ee.includePrerelease?[new H(">=0.0.0-0")]:[new H(">=0.0.0")]}if(L.length===1&&L[0].semver===U){if(ee.includePrerelease)return!0;L=[new H(">=0.0.0")]}const F=new Set;let ue,ie,K,he,pe,Ae,Te;for(const at of $)at.operator===">"||at.operator===">="?ue=R(ue,at,ee):at.operator==="<"||at.operator==="<="?ie=P(ie,at,ee):F.add(at.semver);if(F.size>1||ue&&ie&&((K=re(ue.semver,ie.semver,ee))>0||K===0&&(ue.operator!==">="||ie.operator!=="<=")))return null;for(const at of F){if(ue&&!B(at,String(ue),ee)||ie&&!B(at,String(ie),ee))return null;for(const St of L)if(!B(at,String(St),ee))return!1;return!0}let je=!(!ie||ee.includePrerelease||!ie.semver.prerelease.length)&&ie.semver,ke=!(!ue||ee.includePrerelease||!ue.semver.prerelease.length)&&ue.semver;je&&je.prerelease.length===1&&ie.operator==="<"&&je.prerelease[0]===0&&(je=!1);for(const at of L){if(Te=Te||at.operator===">"||at.operator===">=",Ae=Ae||at.operator==="<"||at.operator==="<=",ue){if(ke&&at.semver.prerelease&&at.semver.prerelease.length&&at.semver.major===ke.major&&at.semver.minor===ke.minor&&at.semver.patch===ke.patch&&(ke=!1),at.operator===">"||at.operator===">="){if((he=R(ue,at,ee))===at&&he!==ue)return!1}else if(ue.operator===">="&&!B(ue.semver,String(at),ee))return!1}if(ie){if(je&&at.semver.prerelease&&at.semver.prerelease.length&&at.semver.major===je.major&&at.semver.minor===je.minor&&at.semver.patch===je.patch&&(je=!1),at.operator==="<"||at.operator==="<="){if((pe=P(ie,at,ee))===at&&pe!==ie)return!1}else if(ie.operator==="<="&&!B(ie.semver,String(at),ee))return!1}if(!at.operator&&(ie||ue)&&K!==0)return!1}return!(ue&&Ae&&!ie&&K!==0)&&!(ie&&Te&&!ue&&K!==0)&&!ke&&!je},R=($,L,ee)=>{if(!$)return L;const F=re($.semver,L.semver,ee);return F>0?$:F<0||L.operator===">"&&$.operator===">="?L:$},P=($,L,ee)=>{if(!$)return L;const F=re($.semver,L.semver,ee);return F<0?$:F>0||L.operator==="<"&&$.operator==="<="?L:$};Oe.exports=($,L,ee={})=>{if($===L)return!0;$=new b($,ee),L=new b(L,ee);let F=!1;e:for(const ue of $.set){for(const ie of L.set){const K=J(ue,ie,ee);if(F=F||K!==null,K)continue e}if(F)return!1}return!0}},function(Oe,A,o){const b=o(112),H=o(48);Oe.exports=(U,B,re)=>{const J=[];let R=null,P=null;const $=U.sort((ue,ie)=>H(ue,ie,re));for(const ue of $)b(ue,B,re)?(P=ue,R||(R=ue)):(P&&J.push([R,P]),P=null,R=null);R&&J.push([R,null]);const L=[];for(const[ue,ie]of J)ue===ie?L.push(ue):ie||ue!==$[0]?ie?ue===$[0]?L.push(`<=${ie}`):L.push(`${ue} - ${ie}`):L.push(`>=${ue}`):L.push("*");const ee=L.join(" || "),F=typeof B.raw=="string"?B.raw:String(B);return ee.length<F.length?ee:B}},function(Oe,A,o){const b=o(47);Oe.exports=(H,U,B)=>(H=new b(H,B),U=new b(U,B),H.intersects(U))},function(Oe,A,o){const b=o(140);Oe.exports=(H,U,B)=>b(H,U,"<",B)},function(Oe,A,o){const b=o(140);Oe.exports=(H,U,B)=>b(H,U,">",B)},function(Oe,A,o){const b=o(47);Oe.exports=(H,U)=>{try{return new b(H,U).range||"*"}catch{return null}}},function(Oe,A,o){const b=o(32),H=o(47),U=o(114);Oe.exports=(B,re)=>{B=new H(B,re);let J=new b("0.0.0");if(B.test(J)||(J=new b("0.0.0-0"),B.test(J)))return J;J=null;for(let R=0;R<B.set.length;++R){let P=null;B.set[R].forEach($=>{const L=new b($.semver.version);switch($.operator){case">":L.prerelease.length===0?L.patch++:L.prerelease.push(0),L.raw=L.format();case"":case">=":P&&!U(L,P)||(P=L);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${$.operator}`)}}),!P||J&&!U(J,P)||(J=P)}return J&&B.test(J)?J:null}},function(Oe,A,o){const b=o(32),H=o(47);Oe.exports=(U,B,re)=>{let J=null,R=null,P=null;try{P=new H(B,re)}catch{return null}return U.forEach($=>{P.test($)&&(J&&R.compare($)!==1||(R=new b(J=$,re)))}),J}},function(Oe,A,o){const b=o(32),H=o(47);Oe.exports=(U,B,re)=>{let J=null,R=null,P=null;try{P=new H(B,re)}catch{return null}return U.forEach($=>{P.test($)&&(J&&R.compare($)!==-1||(R=new b(J=$,re)))}),J}},function(Oe,A,o){const b=o(47);Oe.exports=(H,U)=>new b(H,U).set.map(B=>B.map(re=>re.value).join(" ").trim().split(" "))},function(Oe,A,o){Oe.exports=function(b){b.prototype[Symbol.iterator]=function*(){for(let H=this.head;H;H=H.next)yield H.value}}},function(Oe,A,o){function b(J){var R=this;if(R instanceof b||(R=new b),R.tail=null,R.head=null,R.length=0,J&&typeof J.forEach=="function")J.forEach(function(L){R.push(L)});else if(arguments.length>0)for(var P=0,$=arguments.length;P<$;P++)R.push(arguments[P]);return R}function H(J,R,P){var $=R===J.head?new re(P,null,R,J):new re(P,R,R.next,J);return $.next===null&&(J.tail=$),$.prev===null&&(J.head=$),J.length++,$}function U(J,R){J.tail=new re(R,J.tail,null,J),J.head||(J.head=J.tail),J.length++}function B(J,R){J.head=new re(R,null,J.head,J),J.tail||(J.tail=J.head),J.length++}function re(J,R,P,$){if(!(this instanceof re))return new re(J,R,P,$);this.list=$,this.value=J,R?(R.next=this,this.prev=R):this.prev=null,P?(P.prev=this,this.next=P):this.next=null}Oe.exports=b,b.Node=re,b.create=b,b.prototype.removeNode=function(J){if(J.list!==this)throw new Error("removing node which does not belong to this list");var R=J.next,P=J.prev;return R&&(R.prev=P),P&&(P.next=R),J===this.head&&(this.head=R),J===this.tail&&(this.tail=P),J.list.length--,J.next=null,J.prev=null,J.list=null,R},b.prototype.unshiftNode=function(J){if(J!==this.head){J.list&&J.list.removeNode(J);var R=this.head;J.list=this,J.next=R,R&&(R.prev=J),this.head=J,this.tail||(this.tail=J),this.length++}},b.prototype.pushNode=function(J){if(J!==this.tail){J.list&&J.list.removeNode(J);var R=this.tail;J.list=this,J.prev=R,R&&(R.next=J),this.tail=J,this.head||(this.head=J),this.length++}},b.prototype.push=function(){for(var J=0,R=arguments.length;J<R;J++)U(this,arguments[J]);return this.length},b.prototype.unshift=function(){for(var J=0,R=arguments.length;J<R;J++)B(this,arguments[J]);return this.length},b.prototype.pop=function(){if(this.tail){var J=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,J}},b.prototype.shift=function(){if(this.head){var J=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,J}},b.prototype.forEach=function(J,R){R=R||this;for(var P=this.head,$=0;P!==null;$++)J.call(R,P.value,$,this),P=P.next},b.prototype.forEachReverse=function(J,R){R=R||this;for(var P=this.tail,$=this.length-1;P!==null;$--)J.call(R,P.value,$,this),P=P.prev},b.prototype.get=function(J){for(var R=0,P=this.head;P!==null&&R<J;R++)P=P.next;if(R===J&&P!==null)return P.value},b.prototype.getReverse=function(J){for(var R=0,P=this.tail;P!==null&&R<J;R++)P=P.prev;if(R===J&&P!==null)return P.value},b.prototype.map=function(J,R){R=R||this;for(var P=new b,$=this.head;$!==null;)P.push(J.call(R,$.value,this)),$=$.next;return P},b.prototype.mapReverse=function(J,R){R=R||this;for(var P=new b,$=this.tail;$!==null;)P.push(J.call(R,$.value,this)),$=$.prev;return P},b.prototype.reduce=function(J,R){var P,$=this.head;if(arguments.length>1)P=R;else{if(!this.head)throw new TypeError("Reduce of empty list with no initial value");$=this.head.next,P=this.head.value}for(var L=0;$!==null;L++)P=J(P,$.value,L),$=$.next;return P},b.prototype.reduceReverse=function(J,R){var P,$=this.tail;if(arguments.length>1)P=R;else{if(!this.tail)throw new TypeError("Reduce of empty list with no initial value");$=this.tail.prev,P=this.tail.value}for(var L=this.length-1;$!==null;L--)P=J(P,$.value,L),$=$.prev;return P},b.prototype.toArray=function(){for(var J=new Array(this.length),R=0,P=this.head;P!==null;R++)J[R]=P.value,P=P.next;return J},b.prototype.toArrayReverse=function(){for(var J=new Array(this.length),R=0,P=this.tail;P!==null;R++)J[R]=P.value,P=P.prev;return J},b.prototype.slice=function(J,R){(R=R||this.length)<0&&(R+=this.length),(J=J||0)<0&&(J+=this.length);var P=new b;if(R<J||R<0)return P;J<0&&(J=0),R>this.length&&(R=this.length);for(var $=0,L=this.head;L!==null&&$<J;$++)L=L.next;for(;L!==null&&$<R;$++,L=L.next)P.push(L.value);return P},b.prototype.sliceReverse=function(J,R){(R=R||this.length)<0&&(R+=this.length),(J=J||0)<0&&(J+=this.length);var P=new b;if(R<J||R<0)return P;J<0&&(J=0),R>this.length&&(R=this.length);for(var $=this.length,L=this.tail;L!==null&&$>R;$--)L=L.prev;for(;L!==null&&$>J;$--,L=L.prev)P.push(L.value);return P},b.prototype.splice=function(J,R,...P){J>this.length&&(J=this.length-1),J<0&&(J=this.length+J);for(var $=0,L=this.head;L!==null&&$<J;$++)L=L.next;var ee=[];for($=0;L&&$<R;$++)ee.push(L.value),L=this.removeNode(L);for(L===null&&(L=this.tail),L!==this.head&&L!==this.tail&&(L=L.prev),$=0;$<P.length;$++)L=H(this,L,P[$]);return ee},b.prototype.reverse=function(){for(var J=this.head,R=this.tail,P=J;P!==null;P=P.prev){var $=P.prev;P.prev=P.next,P.next=$}return this.head=R,this.tail=J,this};try{o(333)(b)}catch{}},function(Oe,A,o){const b=o(334),H=Symbol("max"),U=Symbol("length"),B=Symbol("lengthCalculator"),re=Symbol("allowStale"),J=Symbol("maxAge"),R=Symbol("dispose"),P=Symbol("noDisposeOnSet"),$=Symbol("lruList"),L=Symbol("cache"),ee=Symbol("updateAgeOnGet"),F=()=>1,ue=(Te,je,ke)=>{const at=Te[L].get(je);if(at){const St=at.value;if(ie(Te,St)){if(he(Te,at),!Te[re])return}else ke&&(Te[ee]&&(at.value.now=Date.now()),Te[$].unshiftNode(at));return St.value}},ie=(Te,je)=>{if(!je||!je.maxAge&&!Te[J])return!1;const ke=Date.now()-je.now;return je.maxAge?ke>je.maxAge:Te[J]&&ke>Te[J]},K=Te=>{if(Te[U]>Te[H])for(let je=Te[$].tail;Te[U]>Te[H]&&je!==null;){const ke=je.prev;he(Te,je),je=ke}},he=(Te,je)=>{if(je){const ke=je.value;Te[R]&&Te[R](ke.key,ke.value),Te[U]-=ke.length,Te[L].delete(ke.key),Te[$].removeNode(je)}};class pe{constructor(je,ke,at,St,zt){this.key=je,this.value=ke,this.length=at,this.now=St,this.maxAge=zt||0}}const Ae=(Te,je,ke,at)=>{let St=ke.value;ie(Te,St)&&(he(Te,ke),Te[re]||(St=void 0)),St&&je.call(at,St.value,St.key,Te)};Oe.exports=class{constructor(Te){if(typeof Te=="number"&&(Te={max:Te}),Te||(Te={}),Te.max&&(typeof Te.max!="number"||Te.max<0))throw new TypeError("max must be a non-negative number");this[H]=Te.max||1/0;const je=Te.length||F;if(this[B]=typeof je!="function"?F:je,this[re]=Te.stale||!1,Te.maxAge&&typeof Te.maxAge!="number")throw new TypeError("maxAge must be a number");this[J]=Te.maxAge||0,this[R]=Te.dispose,this[P]=Te.noDisposeOnSet||!1,this[ee]=Te.updateAgeOnGet||!1,this.reset()}set max(Te){if(typeof Te!="number"||Te<0)throw new TypeError("max must be a non-negative number");this[H]=Te||1/0,K(this)}get max(){return this[H]}set allowStale(Te){this[re]=!!Te}get allowStale(){return this[re]}set maxAge(Te){if(typeof Te!="number")throw new TypeError("maxAge must be a non-negative number");this[J]=Te,K(this)}get maxAge(){return this[J]}set lengthCalculator(Te){typeof Te!="function"&&(Te=F),Te!==this[B]&&(this[B]=Te,this[U]=0,this[$].forEach(je=>{je.length=this[B](je.value,je.key),this[U]+=je.length})),K(this)}get lengthCalculator(){return this[B]}get length(){return this[U]}get itemCount(){return this[$].length}rforEach(Te,je){je=je||this;for(let ke=this[$].tail;ke!==null;){const at=ke.prev;Ae(this,Te,ke,je),ke=at}}forEach(Te,je){je=je||this;for(let ke=this[$].head;ke!==null;){const at=ke.next;Ae(this,Te,ke,je),ke=at}}keys(){return this[$].toArray().map(Te=>Te.key)}values(){return this[$].toArray().map(Te=>Te.value)}reset(){this[R]&&this[$]&&this[$].length&&this[$].forEach(Te=>this[R](Te.key,Te.value)),this[L]=new Map,this[$]=new b,this[U]=0}dump(){return this[$].map(Te=>!ie(this,Te)&&{k:Te.key,v:Te.value,e:Te.now+(Te.maxAge||0)}).toArray().filter(Te=>Te)}dumpLru(){return this[$]}set(Te,je,ke){if((ke=ke||this[J])&&typeof ke!="number")throw new TypeError("maxAge must be a number");const at=ke?Date.now():0,St=this[B](je,Te);if(this[L].has(Te)){if(St>this[H])return he(this,this[L].get(Te)),!1;const $t=this[L].get(Te).value;return this[R]&&(this[P]||this[R](Te,$t.value)),$t.now=at,$t.maxAge=ke,$t.value=je,this[U]+=St-$t.length,$t.length=St,this.get(Te),K(this),!0}const zt=new pe(Te,je,St,at,ke);return zt.length>this[H]?(this[R]&&this[R](Te,je),!1):(this[U]+=zt.length,this[$].unshift(zt),this[L].set(Te,this[$].head),K(this),!0)}has(Te){if(!this[L].has(Te))return!1;const je=this[L].get(Te).value;return!ie(this,je)}get(Te){return ue(this,Te,!0)}peek(Te){return ue(this,Te,!1)}pop(){const Te=this[$].tail;return Te?(he(this,Te),Te.value):null}del(Te){he(this,this[L].get(Te))}load(Te){this.reset();const je=Date.now();for(let ke=Te.length-1;ke>=0;ke--){const at=Te[ke],St=at.e||0;if(St===0)this.set(at.k,at.v);else{const zt=St-je;zt>0&&this.set(at.k,at.v,zt)}}}prune(){this[L].forEach((Te,je)=>ue(this,je,!1))}}},function(Oe,A,o){const b=o(32),H=o(89),{re:U,t:B}=o(90);Oe.exports=(re,J)=>{if(re instanceof b)return re;if(typeof re=="number"&&(re=String(re)),typeof re!="string")return null;let R=null;if((J=J||{}).rtl){let P;for(;(P=U[B.COERCERTL].exec(re))&&(!R||R.index+R[0].length!==re.length);)R&&P.index+P[0].length===R.index+R[0].length||(R=P),U[B.COERCERTL].lastIndex=P.index+P[1].length+P[2].length;U[B.COERCERTL].lastIndex=-1}else R=re.match(U[B.COERCE]);return R===null?null:H(`${R[2]}.${R[3]||"0"}.${R[4]||"0"}`,J)}},function(Oe,A,o){const b=o(144);Oe.exports=(H,U)=>H.sort((B,re)=>b(re,B,U))},function(Oe,A,o){const b=o(144);Oe.exports=(H,U)=>H.sort((B,re)=>b(B,re,U))},function(Oe,A,o){const b=o(48);Oe.exports=(H,U)=>b(H,U,!0)},function(Oe,A,o){const b=o(48);Oe.exports=(H,U,B)=>b(U,H,B)},function(Oe,A,o){const b=o(89);Oe.exports=(H,U)=>{const B=b(H,U);return B&&B.prerelease.length?B.prerelease:null}},function(Oe,A,o){const b=o(32);Oe.exports=(H,U)=>new b(H,U).patch},function(Oe,A,o){const b=o(32);Oe.exports=(H,U)=>new b(H,U).minor},function(Oe,A,o){const b=o(32);Oe.exports=(H,U)=>new b(H,U).major},function(Oe,A,o){const b=o(89),H=o(145);Oe.exports=(U,B)=>{if(H(U,B))return null;{const re=b(U),J=b(B),R=re.prerelease.length||J.prerelease.length,P=R?"pre":"",$=R?"prerelease":"";for(const L in re)if((L==="major"||L==="minor"||L==="patch")&&re[L]!==J[L])return P+L;return $}}},function(Oe,A,o){const b=o(32);Oe.exports=(H,U,B,re)=>{typeof B=="string"&&(re=B,B=void 0);try{return new b(H,B).inc(U,re).version}catch{return null}}},function(Oe,A,o){const b=o(89);Oe.exports=(H,U)=>{const B=b(H.trim().replace(/^[=v]+/,""),U);return B?B.version:null}},function(Oe,A,o){const b=o(89);Oe.exports=(H,U)=>{const B=b(H,U);return B?B.version:null}},function(Oe,A,o){/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/var b=this&&this.__awaiter||function(P,$,L,ee){return new(L||(L=Promise))(function(F,ue){function ie(pe){try{he(ee.next(pe))}catch(Ae){ue(Ae)}}function K(pe){try{he(ee.throw(pe))}catch(Ae){ue(Ae)}}function he(pe){pe.done?F(pe.value):new L(function(Ae){Ae(pe.value)}).then(ie,K)}he((ee=ee.apply(P,$||[])).next())})},H=this&&this.__importDefault||function(P){return P&&P.__esModule?P:{default:P}};Object.defineProperty(A,"__esModule",{value:!0});const U=H(o(88)),B=o(64),re=o(46);A.barchart=function(P,$,L={}){return b(this,void 0,void 0,function*(){const ee=re.getDrawArea(P),F=$,ue=Object.assign({},J,L);if(R.has(ee)){const St=R.get(ee);if(re.shallowEquals(ue,St.lastOptions)){yield re.nextFrame();const zt=St.view,$t=zt.changeset().remove(()=>!0).insert(F);return void(yield zt.change("values",$t).runAsync())}}const{xLabel:ie,yLabel:K,xType:he,yType:pe}=ue;let Ae=null;ie!=null&&(Ae={title:ie});let Te,je=null;K!=null&&(je={title:K}),Te=ue.color!=null?Array.isArray(ue.color)?{field:"index",type:"nominal",scale:{range:ue.color}}:{value:ue.color}:{value:"#4C78A0"};const ke={width:ue.width||B.getDefaultWidth(ee),height:ue.height||B.getDefaultHeight(ee),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:ue.fontSize,titleFontSize:ue.fontSize},text:{fontSize:ue.fontSize},legend:{labelFontSize:ue.fontSize,titleFontSize:ue.fontSize}},data:{values:F,name:"values"},mark:{type:"bar",tooltip:!0},encoding:{x:{field:"index",type:he,axis:Ae},y:{field:"value",type:pe,axis:je},color:Te}};yield re.nextFrame();const at=yield U.default(ee,ke,{actions:!1,mode:"vega-lite",defaultStyle:!1});R.set(ee,{view:at.view,lastOptions:ue})})};const J={xLabel:"",yLabel:"",xType:"ordinal",yType:"quantitative",fontSize:11},R=new Map},function(Oe,A,o){/**
* @license
* Copyright 2018 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});var b=o(25),H=o(103),U=o(33),B=o(74);function re(J){H.env().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(J+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}A.enableProdMode=function(){H.env().set("PROD",!0)},A.enableDebugMode=function(){H.env().set("DEBUG",!0)},A.disableDeprecationWarnings=function(){H.env().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")},A.deprecationWarn=re,U.setDeprecationWarningFn(re),A.disposeVariables=function(){b.ENGINE.disposeVariables()},A.engine=function(){return b.ENGINE},A.memory=function(){return b.ENGINE.memory()},A.profile=function(J){return b.ENGINE.profile(J)},A.tidy=function(J,R){return b.ENGINE.tidy(J,R)},A.dispose=function(J){B.getTensorsInContainer(J).forEach(function(R){return R.dispose()})},A.keep=function(J){return b.ENGINE.keep(J)},A.time=function(J){return b.ENGINE.time(J)},A.setBackend=function(J){return b.ENGINE.setBackend(J)},A.ready=function(){return b.ENGINE.ready()},A.getBackend=function(){return b.ENGINE.backendName},A.removeBackend=function(J){b.ENGINE.removeBackend(J)},A.findBackend=function(J){return b.ENGINE.findBackend(J)},A.findBackendFactory=function(J){return b.ENGINE.findBackendFactory(J)},A.registerBackend=function(J,R,P){return P===void 0&&(P=1),b.ENGINE.registerBackend(J,R,P)},A.backend=function(){return b.ENGINE.backend},A.setPlatform=function(J,R){H.env().setPlatform(J,R)}},function(Oe,A,o){Object.defineProperty(A,"__esModule",{value:!0});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var b=o(350);A.warnDeprecation=function(){b.deprecationWarn("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")},A.xAs4D=function(H){return H.rank===0||H.rank===1?H.as4D(1,1,1,H.size):H.rank===2?H.as4D(1,1,H.shape[0],H.shape[1]):H.rank===3?H.as4D(1,H.shape[0],H.shape[1],H.shape[2]):H}},function(Oe,A,o){/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});var b=o(25),H=o(29),U=o(21),B=o(351),re=o(28);function J(P,$,L,ee,F,ue){ue==null&&(ue=.001);var ie,K,he=H.convertToTensor(P,"x","batchNorm"),pe=H.convertToTensor($,"mean","batchNorm"),Ae=H.convertToTensor(L,"variance","batchNorm");F!=null&&(ie=H.convertToTensor(F,"scale","batchNorm")),ee!=null&&(K=H.convertToTensor(ee,"offset","batchNorm")),U.assert(pe.rank===Ae.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),U.assert(K==null||pe.rank===K.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),U.assert(ie==null||pe.rank===ie.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."});var Te={x:he,scale:ie,offset:K,mean:pe,variance:Ae},je={varianceEpsilon:ue};return b.ENGINE.runKernelFunc(function(ke,at){var St=B.xAs4D(he),zt=ke.batchNormalization(St,R(pe),R(Ae),ue,R(ie),R(K));return at([he,pe,Ae,ie]),zt},Te,null,"FusedBatchNorm",je).reshape(he.shape)}function R(P){return P==null?null:P.rank===0?P.as1D():P.rank===1?P:P.rank===2?P.as4D(1,1,P.shape[0],P.shape[1]):P.rank===3?P.as4D(1,P.shape[0],P.shape[1],P.shape[2]):P}A.batchNormalization=re.op({batchNormalization_:function(P,$,L,ee,F,ue){return ee===void 0&&(ee=.001),B.warnDeprecation(),J(P,$,L,ue,F,ee)}}),A.batchNorm=re.op({batchNorm_:J})},function(Oe,A,o){Object.defineProperty(A,"__esModule",{value:!0});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var b=o(352);o(33).Tensor.prototype.batchNorm=function(H,U,B,re,J){return b.batchNorm(this,H,U,B,re,J)}},function(Oe,A,o){/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});var b=o(25),H=o(73),U=o(29),B=o(28);A.pad=B.op({pad_:function(re,J,R){R===void 0&&(R=0);var P=U.convertToTensor(re,"x","pad");if(P.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var $={paddings:J,constantValue:R},L={x:P};return b.ENGINE.runKernelFunc(function(ee,F){return F([P]),ee.pad(P,J,R)},L,null,H.PadV2,$)}})},function(Oe,A,o){/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});var b=o(354);o(33).Tensor.prototype.pad=function(H,U){return b.pad(this,H,U)}},function(Oe,A,o){/**
* @license
* Copyright 2018 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});var b=o(25),H=o(29),U=o(21),B=o(28);A.transpose=B.op({transpose_:function(re,J){var R=H.convertToTensor(re,"x","transpose");if(J==null&&(J=R.shape.map(function($,L){return L}).reverse()),U.assert(R.rank===J.length,function(){return"Error in transpose: rank of input "+R.rank+" must match length of perm "+J+"."}),J.forEach(function($){U.assert($>=0&&$<R.rank,function(){return"All entries in 'perm' must be between 0 and "+(R.rank-1)+" but got "+J})}),R.rank<=1)return R.clone();var P={perm:J};return b.ENGINE.runKernelFunc(function($){return $.transpose(R,J)},{x:R},null,"Transpose",P)}})},function(Oe,A,o){/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});var b=o(356);o(33).Tensor.prototype.transpose=function(H){return b.transpose(this,H)}},function(Oe,A,o){/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});var b=o(25),H=o(73),U=o(29),B=o(28);A.oneHot=B.op({oneHot_:function(re,J,R,P){if(R===void 0&&(R=1),P===void 0&&(P=0),J<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+J);var $=U.convertToTensor(re,"indices","oneHot","int32"),L=$.shape.concat([J]),ee={indices:$=$.flatten()},F={depth:J,onValue:R,offValue:P};return b.ENGINE.runKernelFunc(function(ue,ie){return ie([$]),ue.oneHot($,J,R,P)},ee,null,H.OneHot,F).reshape(L)}})},function(Oe,A,o){/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});var b=o(358);o(33).Tensor.prototype.oneHot=function(H,U,B){return U===void 0&&(U=1),B===void 0&&(B=0),b.oneHot(this,H,U,B)}},function(Oe,A,o){/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});var b=o(25),H=o(73),U=o(29),B=o(21),re=o(28);A.tile=re.op({tile_:function(J,R){var P=U.convertToTensor(J,"x","tile",null);B.assert(P.rank===R.length,function(){return"Error in transpose: rank of input "+P.rank+" must match length of reps "+R+"."});var $=[P],L={x:P},ee={reps:R};return b.ENGINE.runKernelFunc(function(F,ue){var ie=F.tile(P,R);return ue([P]),ie},L,null,H.Tile,ee,$)}})},function(Oe,A,o){/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});var b=o(360);o(33).Tensor.prototype.tile=function(H){return b.tile(this,H)}},function(Oe,A,o){/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});var b=o(25),H=o(73),U=o(74),B=o(29),re=o(147),J=o(28),R=o(91);A.squaredDifference=J.op({squaredDifference_:function(P,$){var L,ee=B.convertToTensor(P,"a","squaredDifference"),F=B.convertToTensor($,"b","squaredDifference");L=U.makeTypesMatch(ee,F),ee=L[0],F=L[1],re.assertAndGetBroadcastShape(ee.shape,F.shape);var ue={a:ee,b:F},ie=[ee,F];return b.ENGINE.runKernelFunc(function(K,he){var pe=K.squaredDifference(ee,F);return he([ee,F]),pe},ue,function(K,he){var pe=he[0],Ae=he[1],Te=R.scalar(2);return{a:function(){return K.mul(pe.sub(Ae).mul(Te))},b:function(){return K.mul(Ae.sub(pe).mul(Te))}}},H.SquaredDifference,{},ie,[])}})},function(Oe,A,o){/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});var b=o(362);o(33).Tensor.prototype.squaredDifference=function(H){return b.squaredDifference(this,H)}},function(Oe,A,o){/**
* @license
* Copyright 2017 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});var b=o(21);A.assertParamsConsistent=function(H,U){var B=H[0].length;H.forEach(function(J,R){b.assert(J.length===B,function(){return"Error in concat"+B+"D: rank of tensors["+R+"] must be the same as the rank of the rest ("+B+")"})}),b.assert(U>=0&&U<B,function(){return"Error in concat"+B+"D: axis must be between 0 and "+(B-1)+"."});var re=H[0];H.forEach(function(J,R){for(var P=0;P<B;P++)b.assert(P===U||J[P]===re[P],function(){return"Error in concat"+B+"D: Shape of tensors["+R+"] ("+J+") does not match the shape of the rest ("+re+") along the non-concatenated axis "+R+"."})})},A.computeOutShape=function(H,U){for(var B=H[0].slice(),re=1;re<H.length;re++)B[U]+=H[re][U];return B}},function(Oe,A,o){/**
* @license
* Copyright 2018 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});var b=o(25),H=o(29),U=o(21),B=o(21),re=o(364),J=o(28),R=o(91);A.concat=J.op({concat_:function(P,$){$===void 0&&($=0),U.assert(P.length>=1,function(){return"Pass at least one tensor to concat"});var L=H.convertToTensorArray(P,"tensors","concat");L[0].dtype==="complex64"&&L.forEach(function(K){if(K.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `+K.dtype+". ")}),$=B.parseAxisParam($,L[0].shape)[0];var ee=re.computeOutShape(L.map(function(K){return K.shape}),$);if(U.sizeFromShape(ee)===0)return R.tensor([],ee);if((L=L.filter(function(K){return K.size>0})).length===1)return L[0];var F=L.map(function(K){return K.shape});re.assertParamsConsistent(F,$);var ue=L,ie={axis:$};return b.ENGINE.runKernelFunc(function(K){return K.concat(L,$)},ue,function(K){var he=F.map(function(pe){return pe[$]});return A.split(K,he,$).map(function(pe){return function(){return pe}})},"Concat",ie)}}),A.concat1d=J.op({concat1d_:function(P){return A.concat(P,0)}}),A.concat2d=J.op({concat2d_:function(P,$){return A.concat(P,$)}}),A.concat3d=J.op({concat3d_:function(P,$){return A.concat(P,$)}}),A.concat4d=J.op({concat4d_:function(P,$){return A.concat(P,$)}}),A.split=J.op({split_:function(P,$,L){L===void 0&&(L=0);var ee,F=H.convertToTensor(P,"x","split");return L=B.parseAxisParam(L,F.shape)[0],typeof $=="number"?(U.assert(F.shape[L]%$==0,function(){return"Number of splits must evenly divide the axis."}),ee=new Array($).fill(F.shape[L]/$)):(U.assert(F.shape[L]===$.reduce(function(ue,ie){return ue+ie}),function(){return"The sum of sizes must match the size of the axis dimension."}),ee=$),b.ENGINE.runKernelFunc(function(ue){return ue.split(F,ee,L)},{$x:F},function(ue){return{$x:function(){return A.concat(ue,L)}}})}})},function(Oe,A,o){/**
* @license
* Copyright 2017 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});var b=o(21);function H(B,re){for(var J=0;J<B.length;++J)if(B[B.length-J-1]!==re-1-J)return!1;return!0}function U(B,re,J){for(var R=B.length+re.length,P=[],$=0,L=0,ee=0;ee<R;ee++)J.indexOf(ee)===-1?P.push(B[$++]):P.push(re[L++]);return P}A.axesAreInnerMostDims=H,A.combineLocations=U,A.computeOutAndReduceShapes=function(B,re){for(var J=[],R=B.length,P=0;P<R;P++)re.indexOf(P)===-1&&J.push(B[P]);return[J,re.map(function($){return B[$]})]},A.expandShapeToKeepDim=function(B,re){return U(B,re.map(function(J){return 1}),re)},A.assertAxesAreInnerMostDims=function(B,re,J){b.assert(H(re,J),function(){return B+" supports only inner-most axes for now. Got axes "+re+" and rank-"+J+" input."})},A.getAxesPermutation=function(B,re){if(H(B,re))return null;for(var J=[],R=0;R<re;++R)B.indexOf(R)===-1&&J.push(R);return B.forEach(function(P){return J.push(P)}),J},A.getUndoAxesPermutation=function(B){return B.map(function(re,J){return[J,re]}).sort(function(re,J){return re[1]-J[1]}).map(function(re){return re[0]})},A.getInnerMostAxes=function(B,re){for(var J=[],R=re-B;R<re;++R)J.push(R);return J}},function(Oe,A,o){/**
* @license
* Copyright 2018 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/var b=this&&this.__awaiter||function(L,ee,F,ue){return new(F||(F=Promise))(function(ie,K){function he(Te){try{Ae(ue.next(Te))}catch(je){K(je)}}function pe(Te){try{Ae(ue.throw(Te))}catch(je){K(je)}}function Ae(Te){Te.done?ie(Te.value):new F(function(je){je(Te.value)}).then(he,pe)}Ae((ue=ue.apply(L,ee||[])).next())})},H=this&&this.__generator||function(L,ee){var F,ue,ie,K,he={label:0,sent:function(){if(1&ie[0])throw ie[1];return ie[1]},trys:[],ops:[]};return K={next:pe(0),throw:pe(1),return:pe(2)},typeof Symbol=="function"&&(K[Symbol.iterator]=function(){return this}),K;function pe(Ae){return function(Te){return function(je){if(F)throw new TypeError("Generator is already executing.");for(;he;)try{if(F=1,ue&&(ie=2&je[0]?ue.return:je[0]?ue.throw||((ie=ue.return)&&ie.call(ue),0):ue.next)&&!(ie=ie.call(ue,je[1])).done)return ie;switch(ue=0,ie&&(je=[2&je[0],ie.value]),je[0]){case 0:case 1:ie=je;break;case 4:return he.label++,{value:je[1],done:!1};case 5:he.label++,ue=je[1],je=[0];continue;case 7:je=he.ops.pop(),he.trys.pop();continue;default:if(!(ie=(ie=he.trys).length>0&&ie[ie.length-1])&&(je[0]===6||je[0]===2)){he=0;continue}if(je[0]===3&&(!ie||je[1]>ie[0]&&je[1]<ie[3])){he.label=je[1];break}if(je[0]===6&&he.label<ie[1]){he.label=ie[1],ie=je;break}if(ie&&he.label<ie[2]){he.label=ie[2],he.ops.push(je);break}ie[2]&&he.ops.pop(),he.trys.pop();continue}je=ee.call(L,he)}catch(ke){je=[6,ke],ue=0}finally{F=ie=0}if(5&je[0])throw je[1];return{value:je[0]?je[1]:void 0,done:!0}}([Ae,Te])}}};Object.defineProperty(A,"__esModule",{value:!0});var U=o(25),B=o(33),re=o(29),J=o(21),R=o(366),P=o(365),$=o(28);A.buffer=function(L,ee,F){return ee===void 0&&(ee="float32"),ee=ee||"float32",J.assertNonNegativeIntegerDimensions(L),new B.TensorBuffer(L,ee,F)},A.print=function(L,ee){ee===void 0&&(ee=!1),console.log(L.toString(ee))},A.batchToSpaceND=$.op({batchToSpaceND_:function(L,ee,F){var ue=re.convertToTensor(L,"x","batchToSpaceND"),ie=ee.reduce(function(K,he){return K*he});return J.assert(ue.rank>=1+ee.length,function(){return"input rank is "+ue.rank+" but should be > than blockShape.length "+ee.length}),J.assert(F.length===ee.length,function(){return"crops.length is "+F.length+" but should be equal to blockShape.length  "+ee.length}),J.assert(ue.shape[0]%ie==0,function(){return"input tensor batch is "+ue.shape[0]+" but is not divisible by the product of the elements of blockShape "+ee.join(" * ")+" === "+ie}),U.ENGINE.runKernelFunc(function(K){return K.batchToSpaceND(ue,ee,F)},{$x:ue},function(K){return{$x:function(){return K.spaceToBatchND(ee,F)}}})}}),A.cast=$.op({cast_:function(L,ee){var F=re.convertToTensor(L,"x","cast");if(!J.isValidDtype(ee))throw new Error("Failed to cast to unknown dtype "+ee);if(ee==="string"&&F.dtype!=="string"||ee!=="string"&&F.dtype==="string")throw new Error("Only strings can be casted to strings");var ue={dtype:ee};return U.ENGINE.runKernelFunc(function(ie){return ie.cast(F,ee)},{x:F},function(ie){return{x:function(){return ie.clone()}}},"Cast",ue)}}),A.cumsum=$.op({cumsum_:function(L,ee,F,ue){ee===void 0&&(ee=0),F===void 0&&(F=!1),ue===void 0&&(ue=!1);var ie=re.convertToTensor(L,"x","cumsum");ee|=0;var K=R.getAxesPermutation([ee],ie.rank),he=ie;K!=null&&(he=ie.transpose(K));var pe=R.getInnerMostAxes(1,ie.rank)[0],Ae=U.ENGINE.runKernelFunc(function(Te){return Te.cumsum(he,pe,F,ue)},{permutedX:he},function(Te){return{permutedX:function(){return Te.cumsum(ee,F,!ue)}}});return K!=null&&(Ae=Ae.transpose(K)),Ae}}),A.depthToSpace=$.op({depthToSpace_:function(L,ee,F){F===void 0&&(F="NHWC");var ue=re.convertToTensor(L,"x","depthToSpace"),ie=F==="NHWC"?ue.shape[1]:ue.shape[2],K=F==="NHWC"?ue.shape[2]:ue.shape[3],he=F==="NHWC"?ue.shape[3]:ue.shape[1];return J.assert(ie*ee>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+ie+" and "+ee+`  for depthToSpace with input shape
      `+ue.shape}),J.assert(K*ee>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+K+" and "+ee+` for depthToSpace with input shape
          `+ue.shape}),J.assert(he%(ee*ee)==0,function(){return"Dimension size must be evenly divisible by "+ee*ee+" but is "+he+" for depthToSpace with input shape "+ue.shape}),U.ENGINE.runKernelFunc(function(pe){return pe.depthToSpace(ue,ee,F)},{$x:ue})}}),A.expandDims=$.op({expandDims_:function(L,ee){ee===void 0&&(ee=0);var F=re.convertToTensor(L,"x","expandDims",null);J.assert(ee<=F.rank,function(){return"Axis must be <= rank of the tensor"});var ue=F.shape.slice();return ee<0&&(J.assert(-(F.rank+1)<=ee,function(){return"Axis must be in the interval ["+-(F.rank+1)+", "+F.rank+"]"}),ee=F.rank+ee+1),ue.splice(ee,0,1),A.reshape(F,ue)}}),A.reshape=$.op({reshape_:function(L,ee){var F=re.convertToTensor(L,"x","reshape",null);ee=J.inferFromImplicitShape(ee,F.size),J.assert(F.size===J.sizeFromShape(ee),function(){return"new shape and old shape must have the same number of elements."});var ue={shape:ee};return U.ENGINE.runKernelFunc(function(ie){return ie.reshape(F,ee)},{x:F},function(ie){return{x:function(){return ie.reshape(F.shape)}}},"Reshape",ue)}}),A.spaceToBatchND=$.op({spaceToBatchND_:function(L,ee,F){var ue=re.convertToTensor(L,"x","spaceToBatchND");return J.assert(ue.rank>=1+ee.length,function(){return"input rank "+ue.rank+" should be > than [blockShape] "+ee.length}),J.assert(F.length===ee.length,function(){return"paddings.shape[0] "+F.length+" must be equal to [blockShape] "+ee.length}),J.assert(ue.shape.reduce(function(ie,K,he){return he>0&&he<=ee.length?ie&&(K+F[he-1][0]+F[he-1][1])%ee[he-1]==0:ie},!0),function(){return"input spatial dimensions "+ue.shape.slice(1)+" with paddings "+F.toString()+" must be divisible by blockShapes "+ee.toString()}),U.ENGINE.runKernelFunc(function(ie){return ie.spaceToBatchND(ue,ee,F)},{$x:ue},function(ie){return{$x:function(){return ie.batchToSpaceND(ee,F)}}})}}),A.squeeze=$.op({squeeze_:function(L,ee){var F=re.convertToTensor(L,"x","squeeze");return A.reshape(F,J.squeezeShape(F.shape,ee).newShape)}}),A.stack=$.op({stack_:function(L,ee){ee===void 0&&(ee=0);var F=re.convertToTensorArray(L,"tensors","stack");if(J.assert(F.length>=1,function(){return"Pass at least one tensor to tf.stack"}),F.length===1)return F[0].expandDims(ee);var ue=F[0].rank,ie=F[0].shape,K=F[0].dtype;J.assert(ee<=ue,function(){return"Axis must be <= rank of the tensor"}),F.forEach(function(pe){J.assertShapesMatch(ie,pe.shape,"All tensors passed to stack must have matching shapes")}),F.forEach(function(pe){J.assert(K===pe.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var he=F.map(function(pe){return pe.expandDims(ee)});return P.concat(he,ee)}}),A.unstack=$.op({unstack_:function(L,ee){ee===void 0&&(ee=0),ee=ee||0;var F=re.convertToTensor(L,"x","unstack");J.assert(ee>=-F.shape.length&&ee<F.shape.length,function(){return"Axis = "+ee+" is not in [-"+F.shape.length+", "+F.shape.length+")"}),ee<0&&(ee+=F.shape.length);var ue={axis:ee};return U.ENGINE.runKernelFunc(function(ie){return ie.unstack(F,ee)},{x:F},function(ie){return{x:function(){return A.stack(ie,ee)}}},"Unpack",ue)}}),A.setdiff1dAsync=function(L,ee){return b(this,void 0,void 0,function(){var F,ue,ie,K,he,pe,Ae,Te,je,ke;return H(this,function(at){switch(at.label){case 0:return F=re.convertToTensor(L,"x","setdiff1d"),ue=re.convertToTensor(ee,"y","setdiff1d"),J.assert(F.dtype===ue.dtype,function(){return"x and y should have the same dtype, but got x ("+F.dtype+") and y ("+ue.dtype+")."}),J.assert(F.rank===1,function(){return"x should be 1D tensor, but got x ("+F.shape+")."}),J.assert(ue.rank===1,function(){return"y should be 1D tensor, but got y ("+ue.shape+")."}),[4,F.data()];case 1:return ie=at.sent(),[4,ue.data()];case 2:for(K=at.sent(),he=new Set(K),pe=0,je=0;je<ie.length;je++)he.has(ie[je])||pe++;for(Ae=new B.TensorBuffer([pe],F.dtype),Te=new B.TensorBuffer([pe],"int32"),je=0,ke=0;je<ie.length;je++)he.has(ie[je])||(Ae.values[ke]=ie[je],Te.values[ke]=je,ke++);return[2,[Ae.toTensor(),Te.toTensor()]]}})})}},function(Oe,A,o){/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});var b=o(367);A.whereImpl=function(H,U){for(var B=[],re=0;re<U.length;re++)U[re]&&B.push(re);var J=b.buffer(H,"int32"),R=b.buffer([B.length,H.length],"int32");for(re=0;re<B.length;re++){var P=J.indexToLoc(B[re]),$=re*H.length;R.values.set(P,$)}return R.toTensor()}},function(Oe,A,o){/**
* @license
* Copyright 2018 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/var b=this&&this.__awaiter||function(L,ee,F,ue){return new(F||(F=Promise))(function(ie,K){function he(Te){try{Ae(ue.next(Te))}catch(je){K(je)}}function pe(Te){try{Ae(ue.throw(Te))}catch(je){K(je)}}function Ae(Te){Te.done?ie(Te.value):new F(function(je){je(Te.value)}).then(he,pe)}Ae((ue=ue.apply(L,ee||[])).next())})},H=this&&this.__generator||function(L,ee){var F,ue,ie,K,he={label:0,sent:function(){if(1&ie[0])throw ie[1];return ie[1]},trys:[],ops:[]};return K={next:pe(0),throw:pe(1),return:pe(2)},typeof Symbol=="function"&&(K[Symbol.iterator]=function(){return this}),K;function pe(Ae){return function(Te){return function(je){if(F)throw new TypeError("Generator is already executing.");for(;he;)try{if(F=1,ue&&(ie=2&je[0]?ue.return:je[0]?ue.throw||((ie=ue.return)&&ie.call(ue),0):ue.next)&&!(ie=ie.call(ue,je[1])).done)return ie;switch(ue=0,ie&&(je=[2&je[0],ie.value]),je[0]){case 0:case 1:ie=je;break;case 4:return he.label++,{value:je[1],done:!1};case 5:he.label++,ue=je[1],je=[0];continue;case 7:je=he.ops.pop(),he.trys.pop();continue;default:if(!(ie=(ie=he.trys).length>0&&ie[ie.length-1])&&(je[0]===6||je[0]===2)){he=0;continue}if(je[0]===3&&(!ie||je[1]>ie[0]&&je[1]<ie[3])){he.label=je[1];break}if(je[0]===6&&he.label<ie[1]){he.label=ie[1],ie=je;break}if(ie&&he.label<ie[2]){he.label=ie[2],he.ops.push(je);break}ie[2]&&he.ops.pop(),he.trys.pop();continue}je=ee.call(L,he)}catch(ke){je=[6,ke],ue=0}finally{F=ie=0}if(5&je[0])throw je[1];return{value:je[0]?je[1]:void 0,done:!0}}([Ae,Te])}}};Object.defineProperty(A,"__esModule",{value:!0});var U=o(368),B=o(25),re=o(29),J=o(21),R=o(147),P=o(28),$=o(91);A.logicalAnd=P.op({logicalAnd_:function(L,ee){var F=re.convertToTensor(L,"a","logicalAnd","bool"),ue=re.convertToTensor(ee,"b","logicalAnd","bool");return R.assertAndGetBroadcastShape(F.shape,ue.shape),B.ENGINE.runKernelFunc(function(ie){return ie.logicalAnd(F,ue)},{a:F,b:ue},null,"LogicalAnd")}}),A.logicalNot=P.op({logicalNot_:function(L){var ee=re.convertToTensor(L,"x","logicalNot","bool");return B.ENGINE.runKernelFunc(function(F){return F.logicalNot(ee)},{$x:ee})}}),A.logicalOr=P.op({logicalOr_:function(L,ee){var F=re.convertToTensor(L,"a","logicalOr","bool"),ue=re.convertToTensor(ee,"b","logicalOr","bool");return R.assertAndGetBroadcastShape(F.shape,ue.shape),B.ENGINE.runKernelFunc(function(ie){return ie.logicalOr(F,ue)},{$a:F,$b:ue})}}),A.logicalXor=P.op({logicalXor_:function(L,ee){var F=re.convertToTensor(L,"a","logicalXor","bool"),ue=re.convertToTensor(ee,"b","logicalXor","bool");return R.assertAndGetBroadcastShape(F.shape,ue.shape),A.logicalOr(L,ee).logicalAnd(A.logicalAnd(L,ee).logicalNot())}}),A.where=P.op({where_:function(L,ee,F){var ue=re.convertToTensor(ee,"a","where"),ie=re.convertToTensor(F,"b","where"),K=re.convertToTensor(L,"condition","where","bool");return J.assertShapesMatch(ue.shape,ie.shape,"Error in where: "),K.rank===1?J.assert(K.shape[0]===ue.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):J.assertShapesMatch(K.shape,ie.shape,"Error in where: "),B.ENGINE.runKernelFunc(function(he,pe){var Ae=he.select(K,ue,ie);return pe([K]),Ae},{$condition:K,$a:ue,$b:ie},function(he,pe){var Ae=pe[0];return{$condition:function(){return $.zerosLike(Ae).toFloat()},$a:function(){return he.mul(Ae.cast(he.dtype))},$b:function(){return he.mul(Ae.logicalNot().cast(he.dtype))}}})}}),A.whereAsync=function(L){return b(this,void 0,void 0,function(){var ee,F,ue;return H(this,function(ie){switch(ie.label){case 0:return[4,(ee=re.convertToTensor(L,"condition","whereAsync","bool")).data()];case 1:return F=ie.sent(),ue=U.whereImpl(ee.shape,F),L!==ee&&ee.dispose(),[2,ue]}})})}},function(Oe,A,o){/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});var b=o(74),H=o(29),U=o(205),B=o(369),re=o(28),J=o(91);A.divNoNan=re.op({divNoNan_:function(R,P){var $,L=H.convertToTensor(R,"a","div"),ee=H.convertToTensor(P,"b","div");L=($=b.makeTypesMatch(L,ee))[0],ee=$[1];var F=U.div(L,ee),ue=J.zerosLike(F),ie=ee.equal(ue);return B.where(ie,ue,F)}})},function(Oe,A,o){/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});var b=o(370);o(33).Tensor.prototype.divNoNan=function(H){return b.divNoNan(this,H)}},function(Oe,A,o){/**
* @license
* Copyright 2018 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});var b=o(25),H=o(29),U=o(21),B=o(28),re=o(91);A.abs=B.op({abs_:function(J){var R=H.convertToTensor(J,"x","abs");return R.dtype==="complex64"?b.ENGINE.runKernelFunc(function(P){return P.complexAbs(R)},{$x:R}):b.ENGINE.runKernelFunc(function(P,$){var L=P.abs(R);return $([R]),L},{x:R},function(P,$){var L=$[0];return{x:function(){return P.mul(L.toFloat().step(-1))}}},"Abs")}}),A.acos=B.op({acos_:function(J){var R=H.convertToTensor(J,"x","acos");return b.ENGINE.runKernelFunc(function(P,$){var L=P.acos(R);return $([R]),L},{$x:R},function(P,$){var L=$[0];return{$x:function(){return P.divStrict(re.scalar(1).sub(L.toFloat().square()).sqrt()).neg()}}})}}),A.acosh=B.op({acosh_:function(J){var R=H.convertToTensor(J,"x","acosh");return b.ENGINE.runKernelFunc(function(P,$){var L=P.acosh(R);return $([R]),L},{$x:R},function(P,$){var L=$[0];return{$x:function(){return P.divStrict(L.toFloat().square().sub(1).sqrt())}}})}}),A.asin=B.op({asin_:function(J){var R=H.convertToTensor(J,"x","asin");return b.ENGINE.runKernelFunc(function(P,$){var L=P.asin(R);return $([R]),L},{$x:R},function(P,$){var L=$[0];return{$x:function(){return P.divStrict(re.scalar(1).sub(L.toFloat().square()).sqrt())}}})}}),A.asinh=B.op({asinh_:function(J){var R=H.convertToTensor(J,"x","asinh");return b.ENGINE.runKernelFunc(function(P,$){var L=P.asinh(R);return $([R]),L},{$x:R},function(P,$){var L=$[0];return{$x:function(){return P.divStrict(re.scalar(1).add(L.toFloat().square()).sqrt())}}})}}),A.atan=B.op({atan_:function(J){var R=H.convertToTensor(J,"x","atan");return b.ENGINE.runKernelFunc(function(P,$){var L=P.atan(R);return $([R]),L},{$x:R},function(P,$){var L=$[0];return{$x:function(){return P.div(L.toFloat().square().add(1))}}})}}),A.atanh=B.op({atanh_:function(J){var R=H.convertToTensor(J,"x","atanh");return b.ENGINE.runKernelFunc(function(P,$){var L=P.atanh(R);return $([R]),L},{$x:R},function(P,$){var L=$[0];return{$x:function(){return P.div(re.scalar(1).sub(L.toFloat().square()))}}})}}),A.ceil=B.op({ceil_:function(J){var R=H.convertToTensor(J,"x","ceil");return b.ENGINE.runKernelFunc(function(P){return P.ceil(R)},{$x:R},function(P){return{$x:function(){return re.zerosLike(P)}}})}}),A.clipByValue=B.op({clipByValue_:function(J,R,P){var $=H.convertToTensor(J,"x","clipByValue");U.assert(R<=P,function(){return"Error in clip: min ("+R+") must be less than or equal to max ("+P+")."});var L=[$],ee={min:R,max:P};return b.ENGINE.runKernelFunc(function(F,ue){var ie=F.clip($,R,P);return ue([$]),ie},{x:$},function(F,ue){var ie=ue[0];return{x:function(){return F.where(ie.greaterEqual(R).logicalAnd(ie.lessEqual(P)),re.zerosLike(F))}}},"ClipByValue",ee,L)}}),A.cos=B.op({cos_:function(J){var R=H.convertToTensor(J,"x","cos"),P=[R];return b.ENGINE.runKernelFunc(function($,L){var ee=$.cos(R);return L([R]),ee},{x:R},function($,L){var ee=L[0];return{x:function(){return ee.toFloat().sin().neg().mul($)}}},"Cos",{},P)}}),A.cosh=B.op({cosh_:function(J){var R=H.convertToTensor(J,"x","cosh");return b.ENGINE.runKernelFunc(function(P,$){var L=P.cosh(R);return $([R]),L},{$x:R},function(P,$){var L=$[0];return{$x:function(){return L.toFloat().sinh().mulStrict(P)}}})}}),A.erf=B.op({erf_:function(J){var R=H.convertToTensor(J,"x","erf");return U.assert(R.dtype==="int32"||R.dtype==="float32",function(){return"Input dtype must be `int32` or `float32`."}),R.dtype==="int32"&&(R=R.toFloat()),b.ENGINE.runKernelFunc(function(P,$){var L=P.erf(R);return $([R]),L},{$x:R},function(P,$){var L=$[0];return{$x:function(){return P.mul(L.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),A.exp=B.op({exp_:function(J){var R=H.convertToTensor(J,"x","exp");return b.ENGINE.runKernelFunc(function(P,$){var L=P.exp(R);return $([L]),L},{x:R},function(P,$){return{x:function(){return P.mulStrict($[0])}}},"Exp",{},[],[!0])}}),A.expm1=B.op({expm1_:function(J){var R=H.convertToTensor(J,"x","expm1");return b.ENGINE.runKernelFunc(function(P,$){var L=P.expm1(R);return $([R]),L},{$x:R},function(P,$){var L=$[0];return{$x:function(){return P.mul(L.exp())}}})}}),A.floor=B.op({floor_:function(J){var R=H.convertToTensor(J,"x","floor");return b.ENGINE.runKernelFunc(function(P){return P.floor(R)},{$x:R},function(P){return{$x:function(){return re.zerosLike(P)}}})}}),A.log=B.op({log_:function(J){var R=H.convertToTensor(J,"x","log"),P=[R];return b.ENGINE.runKernelFunc(function($,L){var ee=$.log(R);return L([R]),ee},{x:R},function($,L){var ee=L[0];return{x:function(){return $.div(ee.toFloat())}}},"Log",{},P)}}),A.log1p=B.op({log1p_:function(J){var R=H.convertToTensor(J,"x","log1p");return b.ENGINE.runKernelFunc(function(P,$){var L=P.log1p(R);return $([R]),L},{$x:R},function(P,$){var L=$[0];return{$x:function(){return P.div(L.add(1))}}})}}),A.logSigmoid=B.op({logSigmoid_:function(J){var R=H.convertToTensor(J,"x","logSigmoid");return b.ENGINE.runKernelFunc(function(P,$){var L=P.softplus(R.neg()).neg();return $([R]),L},{$x:R},function(P,$){var L=$[0];return{$x:function(){return P.mul(L.neg().sigmoid())}}})}}),A.neg=B.op({neg_:function(J){var R=H.convertToTensor(J,"x","neg"),P=[R];return b.ENGINE.runKernelFunc(function($){return $.neg(R)},{x:R},function($){return{x:function(){return $.neg()}}},"Neg",{},P)}}),A.reciprocal=B.op({reciprocal_:function(J){var R=H.convertToTensor(J,"x","reciprocal");return b.ENGINE.runKernelFunc(function(P,$){var L=P.reciprocal(R);return $([R]),L},{$x:R},function(P,$){var L=$[0];return{$x:function(){return P.div(L.square().neg())}}})}}),A.round=B.op({round_:function(J){var R=H.convertToTensor(J,"x","round");return b.ENGINE.runKernelFunc(function(P){return P.round(R)},{$x:R},function(P){return{$x:function(){return re.zerosLike(P)}}})}}),A.rsqrt=B.op({rsqrt_:function(J){var R=H.convertToTensor(J,"x","rsqrt"),P=[R];return b.ENGINE.runKernelFunc(function($,L){var ee=$.rsqrt(R);return L([R]),ee},{x:R},function($,L){var ee=L[0];return{x:function(){return $.div(ee.pow(1.5).mul(2)).neg()}}},"Rsqrt",{},P)}}),A.sigmoid=B.op({sigmoid_:function(J){var R=H.convertToTensor(J,"x","sigmoid");return b.ENGINE.runKernelFunc(function(P,$){var L=P.sigmoid(R);return $([L]),L},{x:R},function(P,$){var L=$[0];return{x:function(){return P.mul(L.mul(re.scalar(1).sub(L)))}}},"Sigmoid")}}),A.sign=B.op({sign_:function(J){var R=H.convertToTensor(J,"x","sign");return b.ENGINE.runKernelFunc(function(P){return P.sign(R)},{$x:R},function(P){return{$x:function(){return re.zerosLike(P)}}})}}),A.isNaN=B.op({isNaN_:function(J){var R=H.convertToTensor(J,"x","isNaN");return b.ENGINE.runKernelFunc(function(P){return P.isNaN(R)},{$x:R},function(P){return{$x:function(){return re.zerosLike(P)}}})}}),A.isInf=B.op({isInf_:function(J){var R=H.convertToTensor(J,"x","isInf");return b.ENGINE.runKernelFunc(function(P){return P.isInf(R)},{$x:R},function(P){return{$x:function(){return re.zerosLike(P)}}})}}),A.isFinite=B.op({isFinite_:function(J){var R=H.convertToTensor(J,"x","isFinite");return b.ENGINE.runKernelFunc(function(P){return P.isFinite(R)},{$x:R},function(P){return{$x:function(){return re.zerosLike(P)}}})}}),A.sin=B.op({sin_:function(J){var R=H.convertToTensor(J,"x","sin"),P=[R];return b.ENGINE.runKernelFunc(function($,L){var ee=$.sin(R);return L([R]),ee},{x:R},function($,L){var ee=L[0];return{x:function(){return ee.toFloat().cos().mul($)}}},"Sin",{},P)}}),A.sinh=B.op({sinh_:function(J){var R=H.convertToTensor(J,"x","sinh");return b.ENGINE.runKernelFunc(function(P,$){var L=P.sinh(R);return $([R]),L},{$x:R},function(P,$){var L=$[0];return{$x:function(){return L.toFloat().cosh().mulStrict(P)}}})}}),A.softplus=B.op({softplus_:function(J){var R=H.convertToTensor(J,"x","softplus");return b.ENGINE.runKernelFunc(function(P,$){var L=P.softplus(R);return $([R]),L},{$x:R},function(P,$){var L=$[0];return{$x:function(){return P.mul(L.sigmoid())}}})}}),A.sqrt=B.op({sqrt_:function(J){var R=H.convertToTensor(J,"x","sqrt");return b.ENGINE.runKernelFunc(function(P,$){var L=P.sqrt(R);return $([R]),L},{$x:R},function(P,$){var L=$[0];return{$x:function(){return P.div(L.toFloat().sqrt().mul(2))}}})}}),A.step=B.op({step_:function(J,R){R===void 0&&(R=0);var P=H.convertToTensor(J,"x","step");return b.ENGINE.runKernelFunc(function($){return $.step(P,R)},{$x:P},function($){return{$x:function(){return re.zerosLike($)}}})}}),A.tan=B.op({tan_:function(J){var R=H.convertToTensor(J,"x","tan");return b.ENGINE.runKernelFunc(function(P,$){var L=P.tan(R);return $([R]),L},{$x:R},function(P,$){var L=$[0];return{$x:function(){return P.div(L.cos().square())}}})}}),A.tanh=B.op({tanh_:function(J){var R=H.convertToTensor(J,"x","tanh");return b.ENGINE.runKernelFunc(function(P,$){var L=P.tanh(R);return $([L]),L},{x:R},function(P,$){var L=$[0];return{x:function(){return re.scalar(1).sub(L.square()).mulStrict(P)}}},"Tanh",{},null,[!0])}})},function(Oe,A,o){Object.defineProperty(A,"__esModule",{value:!0});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var b=o(25),H=o(29),U=o(21),B=o(28);A.complex=B.op({complex_:function(re,J){var R=H.convertToTensor(re,"real","complex"),P=H.convertToTensor(J,"imag","complex");return U.assertShapesMatch(R.shape,P.shape,"real and imag shapes, "+R.shape+" and "+P.shape+", must match in call to tf.complex()."),b.ENGINE.runKernelFunc(function($){return $.complex(R,P)},{$real:R,$imag:P})}}),A.real=B.op({real_:function(re){var J=H.convertToTensor(re,"input","real");return b.ENGINE.runKernelFunc(function(R){return R.real(J)},{$input:J})}}),A.imag=B.op({imag_:function(re){var J=H.convertToTensor(re,"input","imag");return b.ENGINE.runKernelFunc(function(R){return R.imag(J)},{$input:J})}})},function(Oe,A,o){/**
* @license
* Copyright 2018 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});var b=o(25),H=o(74),U=o(29),B=o(21),re=o(206),J=o(147),R=o(28),P=o(91),$=o(372);A.addStrict=R.op({addStrict_:function(L,ee){var F=U.convertToTensor(L,"a","addStrict"),ue=U.convertToTensor(ee,"b","addStrict");return B.assertShapesMatch(F.shape,ue.shape,"Error in addStrict: "),F.add(ue)}}),A.atan2=R.op({atan2_:function(L,ee){var F,ue=U.convertToTensor(L,"a","atan2"),ie=U.convertToTensor(ee,"b","atan2");F=H.makeTypesMatch(ue,ie),ue=F[0],ie=F[1];var K=J.assertAndGetBroadcastShape(ue.shape,ie.shape);return b.ENGINE.runKernelFunc(function(he,pe){var Ae=he.atan2(ue,ie);return pe([ue,ie]),Ae},{$a:ue,$b:ie},function(he,pe){var Ae=pe[0],Te=pe[1];return{$a:function(){var je=re.add(Ae.square(),Te.square()),ke=he.mul(Te.div(je)),at=J.getReductionAxes(Ae.shape,K);return at.length>0&&(ke=ke.sum(at)),ke.reshape(Ae.shape)},$b:function(){var je=re.add(Ae.square(),Te.square()),ke=$.neg(he.mul(Ae.div(je))),at=J.getReductionAxes(Te.shape,K);return at.length>0&&(ke=ke.sum(at)),ke.reshape(Te.shape)}}})}}),A.divStrict=R.op({divStrict_:function(L,ee){var F=U.convertToTensor(L,"a","div"),ue=U.convertToTensor(ee,"b","div");return B.assertShapesMatch(F.shape,ue.shape,"Error in divideStrict: "),F.div(ue)}}),A.floorDiv=R.op({floorDiv_:function(L,ee){var F,ue=U.convertToTensor(L,"a","floorDiv"),ie=U.convertToTensor(ee,"b","floorDiv");F=H.makeTypesMatch(ue,ie),ue=F[0],ie=F[1];var K=J.assertAndGetBroadcastShape(ue.shape,ie.shape);return b.ENGINE.runKernelFunc(function(he,pe){var Ae=he.floorDiv(ue,ie);return pe([ue,ie]),Ae},{a:ue,b:ie},function(he,pe){var Ae=pe[0],Te=pe[1];return{a:function(){var je=he.div(Te.toFloat()),ke=J.getReductionAxes(Ae.shape,K);return ke.length>0?je.sum(ke).reshape(Ae.shape):je},b:function(){var je=he.mul(Ae.toFloat()),ke=J.getReductionAxes(Te.shape,K);ke.length>0&&(je=je.sum(ke).reshape(Te.shape));var at=Te.square();return je.div(at.toFloat()).neg()}}},"FloorDiv")}}),A.maximum=R.op({maximum_:function(L,ee){var F,ue=U.convertToTensor(L,"a","maximum"),ie=U.convertToTensor(ee,"b","maximum");return F=H.makeTypesMatch(ue,ie),ue=F[0],ie=F[1],ue.dtype==="bool"&&(ue=ue.toInt(),ie=ie.toInt()),J.assertAndGetBroadcastShape(ue.shape,ie.shape),b.ENGINE.runKernelFunc(function(K,he){var pe=K.maximum(ue,ie);return he([ue,ie]),pe},{a:ue,b:ie},function(K,he){var pe=he[0],Ae=he[1];return{a:function(){return K.mul(pe.greaterEqual(Ae).toFloat())},b:function(){return K.mul(pe.less(Ae).toFloat())}}},"Maximum")}}),A.maximumStrict=R.op({maximumStrict_:function(L,ee){var F=U.convertToTensor(L,"a","maximumStrict"),ue=U.convertToTensor(ee,"b","maximumStrict");return B.assertShapesMatch(F.shape,ue.shape,"Error in maximumStrict: "),F.maximum(ue)}}),A.minimum=R.op({minimum_:function(L,ee){var F,ue=U.convertToTensor(L,"a","minimum"),ie=U.convertToTensor(ee,"b","minimum");return F=H.makeTypesMatch(ue,ie),ue=F[0],ie=F[1],ue.dtype==="bool"&&(ue=ue.toInt(),ie=ie.toInt()),J.assertAndGetBroadcastShape(ue.shape,ie.shape),b.ENGINE.runKernelFunc(function(K,he){var pe=K.minimum(ue,ie);return he([ue,ie]),pe},{a:ue,b:ie},function(K,he){var pe=he[0],Ae=he[1];return{a:function(){return K.mul(pe.lessEqual(Ae).toFloat())},b:function(){return K.mul(pe.greater(Ae).toFloat())}}},"Minimum")}}),A.minimumStrict=R.op({minimumStrict_:function(L,ee){var F=U.convertToTensor(L,"a","minimumStrict"),ue=U.convertToTensor(ee,"b","minimumStrict");return B.assertShapesMatch(F.shape,ue.shape,"Error in minimumStrict: "),F.minimum(ue)}}),A.mod=R.op({mod_:function(L,ee){var F,ue=U.convertToTensor(L,"a","mod"),ie=U.convertToTensor(ee,"b","mod");F=H.makeTypesMatch(ue,ie),ue=F[0],ie=F[1];var K=J.assertAndGetBroadcastShape(ue.shape,ie.shape);return b.ENGINE.runKernelFunc(function(he,pe){var Ae=he.mod(ue,ie);return pe([ue,ie]),Ae},{$a:ue,$b:ie},function(he,pe){var Ae=pe[0],Te=pe[1];return{$a:function(){var je=J.getReductionAxes(Ae.shape,K);return je.length>0?he.sum(je).reshape(Ae.shape):he},$b:function(){var je=he.mul(Ae.div(Te).floor().neg()),ke=J.getReductionAxes(Te.shape,K);return ke.length>0?je.sum(ke).reshape(Te.shape):je}}})}}),A.modStrict=R.op({modStrict_:function(L,ee){var F=U.convertToTensor(L,"a","modStrict"),ue=U.convertToTensor(ee,"b","modStrict");return B.assertShapesMatch(F.shape,ue.shape,"Error in modStrict: "),F.mod(ue)}}),A.mul=R.op({mul_:function(L,ee){var F,ue=U.convertToTensor(L,"a","mul"),ie=U.convertToTensor(ee,"b","mul");F=H.makeTypesMatch(ue,ie),ue=F[0],ie=F[1];var K=J.assertAndGetBroadcastShape(ue.shape,ie.shape);return b.ENGINE.runKernelFunc(function(he,pe){var Ae=he.multiply(ue,ie);return pe([ue,ie]),Ae},{a:ue,b:ie},function(he,pe){var Ae=pe[0],Te=pe[1];return{a:function(){var je=he.mul(Te.toFloat()),ke=J.getReductionAxes(Ae.shape,K);return ke.length>0?je.sum(ke).reshape(Ae.shape):je},b:function(){var je=he.mul(Ae.toFloat()),ke=J.getReductionAxes(Te.shape,K);return ke.length>0?je.sum(ke).reshape(Te.shape):je}}},"Mul")}}),A.mulStrict=R.op({mulStrict_:function(L,ee){var F=U.convertToTensor(L,"a","mul"),ue=U.convertToTensor(ee,"b","mul");return B.assertShapesMatch(F.shape,ue.shape,"Error in multiplyStrict: "),F.mul(ue)}}),A.pow=R.op({pow_:function(L,ee){var F,ue=U.convertToTensor(L,"base","pow"),ie=U.convertToTensor(ee,"exp","pow");F=H.makeTypesMatch(ue,ie),ue=F[0],ie=F[1];var K=J.assertAndGetBroadcastShape(ue.shape,ie.shape),he=[ue,ie];return b.ENGINE.runKernelFunc(function(pe,Ae){var Te=pe.pow(ue,ie);return Ae([ue,ie,Te]),Te},{a:ue,b:ie},function(pe,Ae){var Te=Ae[0],je=Ae[1],ke=Ae[2];return{a:function(){var at=je.toFloat(),St=pe.mul(at.mul(Te.pow(at.sub(P.scalar(1))))),zt=J.getReductionAxes(Te.shape,K);return zt.length>0&&(St=St.sum(zt)),St.reshape(Te.shape)},b:function(){var at=Te.greater(0),St=Te.log().where(at,P.zerosLike(Te)),zt=pe.mul(ke.mul(St)),$t=J.getReductionAxes(je.shape,K);return $t.length>0&&(zt=zt.sum($t)),zt.reshape(je.shape)}}},"Pow",{},he,[!0])}}),A.powStrict=R.op({powStrict_:function(L,ee){return B.assertShapesMatch(L.shape,ee.shape,"Error in powStrict: "),L.pow(ee)}}),A.squaredDifferenceStrict=R.op({squaredDifferenceStrict_:function(L,ee){var F=U.convertToTensor(L,"a","squaredDifferenceStrict"),ue=U.convertToTensor(ee,"b","squaredDifferenceStrict");return B.assertShapesMatch(F.shape,ue.shape,"Error in squaredDifferenceStrict: "),F.squaredDifference(ue)}}),A.sub=R.op({sub_:function(L,ee){var F,ue=U.convertToTensor(L,"a","sub"),ie=U.convertToTensor(ee,"b","sub");F=H.makeTypesMatch(ue,ie),ue=F[0],ie=F[1];var K=J.assertAndGetBroadcastShape(ue.shape,ie.shape);return b.ENGINE.runKernelFunc(function(he){return he.subtract(ue,ie)},{a:ue,b:ie},function(he){return{a:function(){var pe=he,Ae=J.getReductionAxes(ue.shape,K);return Ae.length>0&&(pe=pe.sum(Ae)),pe.reshape(ue.shape)},b:function(){var pe=he,Ae=J.getReductionAxes(ie.shape,K);return Ae.length>0&&(pe=pe.sum(Ae)),pe.neg().reshape(ie.shape)}}},"Sub")}}),A.subStrict=R.op({subStrict_:function(L,ee){var F=U.convertToTensor(L,"a","subStrict"),ue=U.convertToTensor(ee,"b","subStrict");return B.assertShapesMatch(F.shape,ue.shape,"Error in subStrict: "),F.sub(ue)}})},function(Oe,A,o){/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});var b=o(205);o(33).Tensor.prototype.div=function(H){return b.div(this,H)}},function(Oe,A,o){/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});var b=o(25),H=o(73),U=o(29),B=o(28);A.broadcastTo=B.op({broadcastTo_:function(re,J){var R=U.convertToTensor(re,"broadcastTo","x"),P=R.shape;if(J.some(function(he){return!(he>0)||he%1!=0}))throw new Error("broadcastTo(): Invalid broadcast shape ["+J+"].");if(J.length<R.rank)throw new Error("broadcastTo(): shape.length="+J.length+" < input.rank="+R.rank+".");if(J.length>R.rank){for(var $=R.shape.slice();$.length<J.length;)$.unshift(1);R=R.reshape($)}for(var L=R.shape,ee=Array.from(J),F=J.length-1;F>=0;F--)if(L[F]===J[F])ee[F]=1;else if(R.shape[F]!==1)throw new Error("broadcastTo(): ["+P+"] cannot be broadcast to ["+J+"].");var ue=ee.map(function(he,pe){return he>1?pe:-1}).filter(function(he){return he>=0});if(ue.length===0)return R.clone();var ie={x:R},K={shape:J,inputShape:L};return b.ENGINE.runKernelFunc(function(he){return he.tile(R,ee)},ie,function(he){return{x:function(){return he.sum(ue,!0)}}},H.BroadcastTo,K)}})},function(Oe,A,o){/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});var b=o(376);o(33).Tensor.prototype.broadcastTo=function(H){return b.broadcastTo(this,H)}},function(Oe,A,o){/**
* @license
* Copyright 2017 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/var b,H,U,B;Object.defineProperty(A,"__esModule",{value:!0}),function(R){R.R0="R0",R.R1="R1",R.R2="R2",R.R3="R3",R.R4="R4",R.R5="R5",R.R6="R6"}(A.Rank||(A.Rank={})),function(R){R.float32="float32",R.int32="int32",R.bool="int32",R.complex64="complex64"}(b||(b={})),function(R){R.float32="float32",R.int32="int32",R.bool="bool",R.complex64="complex64"}(H||(H={})),function(R){R.float32="float32",R.int32="float32",R.bool="float32",R.complex64="complex64"}(U||(U={})),function(R){R.float32="complex64",R.int32="complex64",R.bool="complex64",R.complex64="complex64"}(B||(B={}));var re={float32:U,int32:b,bool:H,complex64:B};function J(R,P){if(R==="string"||P==="string"){if(R==="string"&&P==="string")return"string";throw new Error("Can not upcast "+R+" with "+P)}return re[R][P]}A.upcastType=J,A.sumOutType=function(R){return J(R,"int32")}},function(Oe,A,o){/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});var b=o(21),H=20,U=3,B=7;function re(P,$,L){var ee;return ee=Array.isArray(P)?parseFloat(P[0].toFixed(B))+" + "+parseFloat(P[1].toFixed(B))+"j":b.isString(P)?"'"+P+"'":L==="bool"?J(P):parseFloat(P.toFixed(B)).toString(),b.rightPad(ee,$)}function J(P){return P===0?"false":"true"}function R(P){for(var $=[],L=0;L<P.length;L+=2)$.push([P[L],P[L+1]]);return $}A.tensorToString=function(P,$,L,ee){var F=b.computeStrides($),ue=function(pe,Ae,Te,je){var ke=b.sizeFromShape(Ae),at=je[je.length-1],St=new Array(at).fill(0),zt=Ae.length,$t=Te==="complex64"?R(pe):pe;if(zt>1)for(var we=0;we<ke/at;we++)for(var Tt=we*at,Gt=0;Gt<at;Gt++)St[Gt]=Math.max(St[Gt],re($t[Tt+Gt],0,Te).length);return St}(P,$,L,F),ie=$.length,K=function pe(Ae,Te,je,ke,at,St){St===void 0&&(St=!0);var zt=je==="complex64"?2:1,$t=Te[0],we=Te.length;if(we===0){if(je==="complex64"){var Tt=R(Ae);return[re(Tt[0],0,je)]}return je==="bool"?[J(Ae[0])]:[Ae[0].toString()]}if(we===1){if($t>H){var Gt=U*zt,Pt=Array.from(Ae.slice(0,Gt)),Ye=Array.from(Ae.slice(($t-U)*zt,$t*zt));return je==="complex64"&&(Pt=R(Pt),Ye=R(Ye)),["["+Pt.map(function(fn,We){return re(fn,at[We],je)}).join(", ")+", ..., "+Ye.map(function(fn,We){return re(fn,at[$t-U+We],je)}).join(", ")+"]"]}var ln=je==="complex64"?R(Ae):Array.from(Ae);return["["+ln.map(function(fn,We){return re(fn,at[We],je)}).join(", ")+"]"]}var Zt=Te.slice(1),Bt=ke.slice(1),Mt=ke[0]*zt,bn=[];if($t>H){for(var Dt=0;Dt<U;Dt++){var _t=Dt*Mt,xn=_t+Mt;bn.push.apply(bn,pe(Ae.slice(_t,xn),Zt,je,Bt,at,!1))}bn.push("...");for(var Dt=$t-U;Dt<$t;Dt++){var _t=Dt*Mt,xn=_t+Mt;bn.push.apply(bn,pe(Ae.slice(_t,xn),Zt,je,Bt,at,Dt===$t-1))}}else for(var Dt=0;Dt<$t;Dt++){var _t=Dt*Mt,xn=_t+Mt;bn.push.apply(bn,pe(Ae.slice(_t,xn),Zt,je,Bt,at,Dt===$t-1))}var In=we===2?",":"";bn[0]="["+bn[0]+In;for(var Dt=1;Dt<bn.length-1;Dt++)bn[Dt]=" "+bn[Dt]+In;for(var Yn=`,
`,Dt=2;Dt<we;Dt++)Yn+=`
`;return bn[bn.length-1]=" "+bn[bn.length-1]+"]"+(St?"":Yn),bn}(P,$,L,F,ue),he=["Tensor"];return ee&&(he.push("  dtype: "+L),he.push("  rank: "+ie),he.push("  shape: ["+$+"]"),he.push("  values:")),he.push(K.map(function(pe){return"    "+pe}).join(`
`)),he.join(`
`)}},function(Oe,A,o){/**
* @license
* Copyright 2017 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});var b=o(21);A.getFilteredNodesXToY=function(H,U,B){for(var re={},J={},R=0;R<U.length;R++)re[U[R].id]=!0;for(R=0;R<H.length;R++){var P=(he=H[R]).inputs;for(var $ in P){for(var L=P[$],ee=!1,F=0;F<U.length;F++)if(re[L.id]){he.outputs.forEach(function(je){return re[je.id]=!0}),ee=!0,J[he.id]=!0;break}if(ee)break}}var ue={};ue[B.id]=!0;var ie={};for(R=H.length-1;R>=0;R--)for(P=(he=H[R]).inputs,F=0;F<he.outputs.length;F++)if(ue[he.outputs[F].id]){for(var $ in P)ue[P[$].id]=!0,ie[he.id]=!0;break}var K=[];for(R=0;R<H.length;R++){var he;if(J[(he=H[R]).id]&&ie[he.id]){var pe={};for(var $ in he.inputs){var Ae=he.inputs[$];re[Ae.id]&&(pe[$]=Ae)}var Te=Object.assign({},he);Te.inputs=pe,Te.outputs=he.outputs,K.push(Te)}}return K},A.backpropagateGradients=function(H,U,B){for(var re=function(R){var P=U[R],$=[];if(P.outputs.forEach(function(ue){var ie=H[ue.id];ie!=null?$.push(ie):$.push(null)}),P.gradient==null)throw new Error("Cannot compute gradient: gradient function not found for "+P.kernelName+".");var L=P.gradient($),ee=function(ue){if(!(ue in L))throw new Error("Cannot backprop through input "+ue+". Available gradients found: "+Object.keys(L)+".");var ie=B(function(){return L[ue]()});if(ie.dtype!=="float32")throw new Error("Error in gradient for op "+P.kernelName+". The gradient of input "+ue+" must have 'float32' dtype, but has '"+ie.dtype+"'");var K=P.inputs[ue];if(!b.arraysEqual(ie.shape,K.shape))throw new Error("Error in gradient for op "+P.kernelName+". The gradient of input '"+ue+"' has shape '"+ie.shape+"', which does not match the shape of the input '"+K.shape+"'");if(H[K.id]==null)H[K.id]=ie;else{var he=H[K.id];H[K.id]=he.add(ie),he.dispose()}};for(var F in P.inputs)ee(F)},J=U.length-1;J>=0;J--)re(J)}},function(Oe,A,o){/**
* @license
* Copyright 2018 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});var b=o(21),H=function(){function re(J,R){this.backendTimer=J,this.logger=R,R==null&&(this.logger=new B)}return re.prototype.profileKernel=function(J,R,P){var $,L=this,ee=this.backendTimer.time(function(){$=P()});return $.forEach(function(F){F.data().then(function(ue){U(ue,F.dtype,J),ee.then(function(ie){var K="";ie.getExtraProfileInfo!=null&&(K=ie.getExtraProfileInfo()),L.logger.logKernelProfile(J,F,ue,ie.kernelMs,R,K)})})}),$},re}();function U(re,J,R){if(J!=="float32")return!1;for(var P=0;P<re.length;P++){var $=re[P];if(isNaN($)||!isFinite($))return console.warn("Found "+$+" in the result of '"+R+"'"),!0}return!1}A.Profiler=H,A.checkComputationForErrors=U;var B=function(){function re(){}return re.prototype.logKernelProfile=function(J,R,P,$,L,ee){var F=typeof $=="number"?b.rightPad($+"ms",9):$.error,ue=b.rightPad(J,25),ie=R.rank,K=R.size,he=b.rightPad(R.shape.toString(),14),pe="";for(var Ae in L){var Te=L[Ae].shape||R.shape,je=Te.length;pe+=Ae+": "+je+"D "+(je>0?Te:"")+" "}console.log("%c"+ue+"	%c"+F+"	%c"+ie+"D "+he+"	%c"+K+"	%c"+pe+"	%c"+ee,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},re}();A.Logger=B},function(Oe,A,o){/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});var b=new Map,H=new Map;function U(B,re){return re+"_"+B}A.getKernel=function(B,re){var J=U(B,re);return b.get(J)},A.getGradient=function(B){return H.get(B)},A.getKernelsForBackend=function(B){for(var re=b.entries(),J=[];;){var R=re.next(),P=R.done,$=R.value;if(P)break;var L=$[0],ee=$[1];L.split("_")[0]===B&&J.push(ee)}return J},A.registerKernel=function(B){var re=B.kernelName,J=B.backendName,R=U(re,J);if(b.has(R))throw new Error("The kernel '"+re+"' for backend '"+J+"' is already registered");b.set(R,B)},A.registerGradient=function(B){var re=B.kernelName;H.has(re)&&console.warn("Overriding the gradient for '"+re+"'"),H.set(re,B)},A.unregisterKernel=function(B,re){var J=U(B,re);if(!b.has(J))throw new Error("The kernel '"+B+"' for backend '"+re+"' is not registered");b.delete(J)},A.unregisterGradient=function(B){if(!H.has(B))throw new Error("The gradient '"+B+"' for backend is not registered");H.delete(B)}},function(Oe,A,o){Object.defineProperty(A,"__esModule",{value:!0});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var b=o(206);o(33).Tensor.prototype.add=function(H){return b.add(this,H)}},function(Oe,A,o){Object.defineProperty(A,"__esModule",{value:!0}),o(383),o(377),o(375),o(371),o(363),o(361),o(359),o(357),o(355),o(353)},function(Oe,A){},function(Oe,A){},function(Oe,A){},function(Oe,A){},function(Oe,A){},function(Oe,A){},function(Oe,A,o){(function(b,H){(function(U,B){if(!U.setImmediate){var re,J=1,R={},P=!1,$=U.document,L=Object.getPrototypeOf&&Object.getPrototypeOf(U);L=L&&L.setTimeout?L:U,{}.toString.call(U.process)==="[object process]"?re=function(ue){H.nextTick(function(){F(ue)})}:function(){if(U.postMessage&&!U.importScripts){var ue=!0,ie=U.onmessage;return U.onmessage=function(){ue=!1},U.postMessage("","*"),U.onmessage=ie,ue}}()?function(){var ue="setImmediate$"+Math.random()+"$",ie=function(K){K.source===U&&typeof K.data=="string"&&K.data.indexOf(ue)===0&&F(+K.data.slice(ue.length))};U.addEventListener?U.addEventListener("message",ie,!1):U.attachEvent("onmessage",ie),re=function(K){U.postMessage(ue+K,"*")}}():U.MessageChannel?function(){var ue=new MessageChannel;ue.port1.onmessage=function(ie){F(ie.data)},re=function(ie){ue.port2.postMessage(ie)}}():$&&"onreadystatechange"in $.createElement("script")?function(){var ue=$.documentElement;re=function(ie){var K=$.createElement("script");K.onreadystatechange=function(){F(ie),K.onreadystatechange=null,ue.removeChild(K),K=null},ue.appendChild(K)}}():re=function(ue){setTimeout(F,0,ue)},L.setImmediate=function(ue){typeof ue!="function"&&(ue=new Function(""+ue));for(var ie=new Array(arguments.length-1),K=0;K<ie.length;K++)ie[K]=arguments[K+1];var he={callback:ue,args:ie};return R[J]=he,re(J),J++},L.clearImmediate=ee}function ee(ue){delete R[ue]}function F(ue){if(P)setTimeout(F,0,ue);else{var ie=R[ue];if(ie){P=!0;try{(function(K){var he=K.callback,pe=K.args;switch(pe.length){case 0:he();break;case 1:he(pe[0]);break;case 2:he(pe[0],pe[1]);break;case 3:he(pe[0],pe[1],pe[2]);break;default:he.apply(B,pe)}})(ie)}finally{ee(ue),P=!1}}}}})(typeof self>"u"?b===void 0?this:b:self)}).call(this,o(59),o(75))},function(Oe,A){var o={}.toString;Oe.exports=Array.isArray||function(b){return o.call(b)=="[object Array]"}},function(Oe,A){/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */A.read=function(o,b,H,U,B){var re,J,R=8*B-U-1,P=(1<<R)-1,$=P>>1,L=-7,ee=H?B-1:0,F=H?-1:1,ue=o[b+ee];for(ee+=F,re=ue&(1<<-L)-1,ue>>=-L,L+=R;L>0;re=256*re+o[b+ee],ee+=F,L-=8);for(J=re&(1<<-L)-1,re>>=-L,L+=U;L>0;J=256*J+o[b+ee],ee+=F,L-=8);if(re===0)re=1-$;else{if(re===P)return J?NaN:1/0*(ue?-1:1);J+=Math.pow(2,U),re-=$}return(ue?-1:1)*J*Math.pow(2,re-U)},A.write=function(o,b,H,U,B,re){var J,R,P,$=8*re-B-1,L=(1<<$)-1,ee=L>>1,F=B===23?Math.pow(2,-24)-Math.pow(2,-77):0,ue=U?0:re-1,ie=U?1:-1,K=b<0||b===0&&1/b<0?1:0;for(b=Math.abs(b),isNaN(b)||b===1/0?(R=isNaN(b)?1:0,J=L):(J=Math.floor(Math.log(b)/Math.LN2),b*(P=Math.pow(2,-J))<1&&(J--,P*=2),(b+=J+ee>=1?F/P:F*Math.pow(2,1-ee))*P>=2&&(J++,P/=2),J+ee>=L?(R=0,J=L):J+ee>=1?(R=(b*P-1)*Math.pow(2,B),J+=ee):(R=b*Math.pow(2,ee-1)*Math.pow(2,B),J=0));B>=8;o[H+ue]=255&R,ue+=ie,R/=256,B-=8);for(J=J<<B|R,$+=B;$>0;o[H+ue]=255&J,ue+=ie,J/=256,$-=8);o[H+ue-ie]|=128*K}},function(Oe,A,o){A.byteLength=function(L){var ee=R(L),F=ee[0],ue=ee[1];return 3*(F+ue)/4-ue},A.toByteArray=function(L){var ee,F,ue=R(L),ie=ue[0],K=ue[1],he=new U(function(Te,je,ke){return 3*(je+ke)/4-ke}(0,ie,K)),pe=0,Ae=K>0?ie-4:ie;for(F=0;F<Ae;F+=4)ee=H[L.charCodeAt(F)]<<18|H[L.charCodeAt(F+1)]<<12|H[L.charCodeAt(F+2)]<<6|H[L.charCodeAt(F+3)],he[pe++]=ee>>16&255,he[pe++]=ee>>8&255,he[pe++]=255&ee;return K===2&&(ee=H[L.charCodeAt(F)]<<2|H[L.charCodeAt(F+1)]>>4,he[pe++]=255&ee),K===1&&(ee=H[L.charCodeAt(F)]<<10|H[L.charCodeAt(F+1)]<<4|H[L.charCodeAt(F+2)]>>2,he[pe++]=ee>>8&255,he[pe++]=255&ee),he},A.fromByteArray=function(L){for(var ee,F=L.length,ue=F%3,ie=[],K=0,he=F-ue;K<he;K+=16383)ie.push($(L,K,K+16383>he?he:K+16383));return ue===1?(ee=L[F-1],ie.push(b[ee>>2]+b[ee<<4&63]+"==")):ue===2&&(ee=(L[F-2]<<8)+L[F-1],ie.push(b[ee>>10]+b[ee>>4&63]+b[ee<<2&63]+"=")),ie.join("")};for(var b=[],H=[],U=typeof Uint8Array<"u"?Uint8Array:Array,B="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",re=0,J=B.length;re<J;++re)b[re]=B[re],H[B.charCodeAt(re)]=re;function R(L){var ee=L.length;if(ee%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var F=L.indexOf("=");return F===-1&&(F=ee),[F,F===ee?0:4-F%4]}function P(L){return b[L>>18&63]+b[L>>12&63]+b[L>>6&63]+b[63&L]}function $(L,ee,F){for(var ue,ie=[],K=ee;K<F;K+=3)ue=(L[K]<<16&16711680)+(L[K+1]<<8&65280)+(255&L[K+2]),ie.push(P(ue));return ie.join("")}H[45]=62,H[95]=63},function(Oe,A){var o={}.hasOwnProperty;Oe.exports=function(b,H){return o.call(b,H)}},function(Oe,A){Oe.exports=function(o,b){return{enumerable:!(1&o),configurable:!(2&o),writable:!(4&o),value:b}}},function(Oe,A,o){var b=o(149);Oe.exports=function(H,U){if(!b(H))return H;var B,re;if(U&&typeof(B=H.toString)=="function"&&!b(re=B.call(H))||typeof(B=H.valueOf)=="function"&&!b(re=B.call(H))||!U&&typeof(B=H.toString)=="function"&&!b(re=B.call(H)))return re;throw TypeError("Can't convert object to primitive value")}},function(Oe,A,o){var b=o(149),H=o(150).document,U=b(H)&&b(H.createElement);Oe.exports=function(B){return U?H.createElement(B):{}}},function(Oe,A,o){Oe.exports=!o(148)&&!o(208)(function(){return Object.defineProperty(o(398)("div"),"a",{get:function(){return 7}}).a!=7})},function(Oe,A,o){var b=o(149);Oe.exports=function(H){if(!b(H))throw TypeError(H+" is not an object!");return H}},function(Oe,A,o){var b=o(400),H=o(399),U=o(397),B=Object.defineProperty;A.f=o(148)?Object.defineProperty:function(re,J,R){if(b(re),J=U(J,!0),b(R),H)try{return B(re,J,R)}catch{}if("get"in R||"set"in R)throw TypeError("Accessors not supported!");return"value"in R&&(re[J]=R.value),re}},function(Oe,A,o){var b=o(401),H=o(396);Oe.exports=o(148)?function(U,B,re){return b.f(U,B,H(1,re))}:function(U,B,re){return U[B]=re,U}},function(Oe,A){Oe.exports=function(o){if(typeof o!="function")throw TypeError(o+" is not a function!");return o}},function(Oe,A,o){var b=o(403);Oe.exports=function(H,U,B){if(b(H),U===void 0)return H;switch(B){case 1:return function(re){return H.call(U,re)};case 2:return function(re,J){return H.call(U,re,J)};case 3:return function(re,J,R){return H.call(U,re,J,R)}}return function(){return H.apply(U,arguments)}}},function(Oe,A,o){var b=o(150),H=o(209),U=o(404),B=o(402),re=o(395),J=function(R,P,$){var L,ee,F,ue=R&J.F,ie=R&J.G,K=R&J.S,he=R&J.P,pe=R&J.B,Ae=R&J.W,Te=ie?H:H[P]||(H[P]={}),je=Te.prototype,ke=ie?b:K?b[P]:(b[P]||{}).prototype;for(L in ie&&($=P),$)(ee=!ue&&ke&&ke[L]!==void 0)&&re(Te,L)||(F=ee?ke[L]:$[L],Te[L]=ie&&typeof ke[L]!="function"?$[L]:pe&&ee?U(F,b):Ae&&ke[L]==F?function(at){var St=function(zt,$t,we){if(this instanceof at){switch(arguments.length){case 0:return new at;case 1:return new at(zt);case 2:return new at(zt,$t)}return new at(zt,$t,we)}return at.apply(this,arguments)};return St.prototype=at.prototype,St}(F):he&&typeof F=="function"?U(Function.call,F):F,he&&((Te.virtual||(Te.virtual={}))[L]=F,R&J.R&&je&&!je[L]&&B(je,L,F)))};J.F=1,J.G=2,J.S=4,J.P=8,J.B=16,J.W=32,J.U=64,J.R=128,Oe.exports=J},function(Oe,A,o){var b=o(405);b(b.G,{global:o(150)})},function(Oe,A,o){o(406),Oe.exports=o(209).global},function(Oe,A,o){var b=function(H){var U,B=Object.prototype,re=B.hasOwnProperty,J=typeof Symbol=="function"?Symbol:{},R=J.iterator||"@@iterator",P=J.asyncIterator||"@@asyncIterator",$=J.toStringTag||"@@toStringTag";function L(Bt,Mt,bn){return Object.defineProperty(Bt,Mt,{value:bn,enumerable:!0,configurable:!0,writable:!0}),Bt[Mt]}try{L({},"")}catch{L=function(Mt,bn,Dt){return Mt[bn]=Dt}}function ee(Bt,Mt,bn,Dt){var _t=Mt&&Mt.prototype instanceof Ae?Mt:Ae,xn=Object.create(_t.prototype),In=new Ye(Dt||[]);return xn._invoke=function(Yn,fn,We){var Pe=ue;return function(rt,Et){if(Pe===K)throw new Error("Generator is already running");if(Pe===he){if(rt==="throw")throw Et;return Zt()}for(We.method=rt,We.arg=Et;;){var Lt=We.delegate;if(Lt){var rn=Tt(Lt,We);if(rn){if(rn===pe)continue;return rn}}if(We.method==="next")We.sent=We._sent=We.arg;else if(We.method==="throw"){if(Pe===ue)throw Pe=he,We.arg;We.dispatchException(We.arg)}else We.method==="return"&&We.abrupt("return",We.arg);Pe=K;var Sn=F(Yn,fn,We);if(Sn.type==="normal"){if(Pe=We.done?he:ie,Sn.arg===pe)continue;return{value:Sn.arg,done:We.done}}Sn.type==="throw"&&(Pe=he,We.method="throw",We.arg=Sn.arg)}}}(Bt,bn,In),xn}function F(Bt,Mt,bn){try{return{type:"normal",arg:Bt.call(Mt,bn)}}catch(Dt){return{type:"throw",arg:Dt}}}H.wrap=ee;var ue="suspendedStart",ie="suspendedYield",K="executing",he="completed",pe={};function Ae(){}function Te(){}function je(){}var ke={};L(ke,R,function(){return this});var at=Object.getPrototypeOf,St=at&&at(at(ln([])));St&&St!==B&&re.call(St,R)&&(ke=St);var zt=je.prototype=Ae.prototype=Object.create(ke);function $t(Bt){["next","throw","return"].forEach(function(Mt){L(Bt,Mt,function(bn){return this._invoke(Mt,bn)})})}function we(Bt,Mt){var bn;this._invoke=function(Dt,_t){function xn(){return new Mt(function(In,Yn){(function fn(We,Pe,rt,Et){var Lt=F(Bt[We],Bt,Pe);if(Lt.type!=="throw"){var rn=Lt.arg,Sn=rn.value;return Sn&&typeof Sn=="object"&&re.call(Sn,"__await")?Mt.resolve(Sn.__await).then(function(kn){fn("next",kn,rt,Et)},function(kn){fn("throw",kn,rt,Et)}):Mt.resolve(Sn).then(function(kn){rn.value=kn,rt(rn)},function(kn){return fn("throw",kn,rt,Et)})}Et(Lt.arg)})(Dt,_t,In,Yn)})}return bn=bn?bn.then(xn,xn):xn()}}function Tt(Bt,Mt){var bn=Bt.iterator[Mt.method];if(bn===U){if(Mt.delegate=null,Mt.method==="throw"){if(Bt.iterator.return&&(Mt.method="return",Mt.arg=U,Tt(Bt,Mt),Mt.method==="throw"))return pe;Mt.method="throw",Mt.arg=new TypeError("The iterator does not provide a 'throw' method")}return pe}var Dt=F(bn,Bt.iterator,Mt.arg);if(Dt.type==="throw")return Mt.method="throw",Mt.arg=Dt.arg,Mt.delegate=null,pe;var _t=Dt.arg;return _t?_t.done?(Mt[Bt.resultName]=_t.value,Mt.next=Bt.nextLoc,Mt.method!=="return"&&(Mt.method="next",Mt.arg=U),Mt.delegate=null,pe):_t:(Mt.method="throw",Mt.arg=new TypeError("iterator result is not an object"),Mt.delegate=null,pe)}function Gt(Bt){var Mt={tryLoc:Bt[0]};1 in Bt&&(Mt.catchLoc=Bt[1]),2 in Bt&&(Mt.finallyLoc=Bt[2],Mt.afterLoc=Bt[3]),this.tryEntries.push(Mt)}function Pt(Bt){var Mt=Bt.completion||{};Mt.type="normal",delete Mt.arg,Bt.completion=Mt}function Ye(Bt){this.tryEntries=[{tryLoc:"root"}],Bt.forEach(Gt,this),this.reset(!0)}function ln(Bt){if(Bt){var Mt=Bt[R];if(Mt)return Mt.call(Bt);if(typeof Bt.next=="function")return Bt;if(!isNaN(Bt.length)){var bn=-1,Dt=function _t(){for(;++bn<Bt.length;)if(re.call(Bt,bn))return _t.value=Bt[bn],_t.done=!1,_t;return _t.value=U,_t.done=!0,_t};return Dt.next=Dt}}return{next:Zt}}function Zt(){return{value:U,done:!0}}return Te.prototype=je,L(zt,"constructor",je),L(je,"constructor",Te),Te.displayName=L(je,$,"GeneratorFunction"),H.isGeneratorFunction=function(Bt){var Mt=typeof Bt=="function"&&Bt.constructor;return!!Mt&&(Mt===Te||(Mt.displayName||Mt.name)==="GeneratorFunction")},H.mark=function(Bt){return Object.setPrototypeOf?Object.setPrototypeOf(Bt,je):(Bt.__proto__=je,L(Bt,$,"GeneratorFunction")),Bt.prototype=Object.create(zt),Bt},H.awrap=function(Bt){return{__await:Bt}},$t(we.prototype),L(we.prototype,P,function(){return this}),H.AsyncIterator=we,H.async=function(Bt,Mt,bn,Dt,_t){_t===void 0&&(_t=Promise);var xn=new we(ee(Bt,Mt,bn,Dt),_t);return H.isGeneratorFunction(Mt)?xn:xn.next().then(function(In){return In.done?In.value:xn.next()})},$t(zt),L(zt,$,"Generator"),L(zt,R,function(){return this}),L(zt,"toString",function(){return"[object Generator]"}),H.keys=function(Bt){var Mt=[];for(var bn in Bt)Mt.push(bn);return Mt.reverse(),function Dt(){for(;Mt.length;){var _t=Mt.pop();if(_t in Bt)return Dt.value=_t,Dt.done=!1,Dt}return Dt.done=!0,Dt}},H.values=ln,Ye.prototype={constructor:Ye,reset:function(Bt){if(this.prev=0,this.next=0,this.sent=this._sent=U,this.done=!1,this.delegate=null,this.method="next",this.arg=U,this.tryEntries.forEach(Pt),!Bt)for(var Mt in this)Mt.charAt(0)==="t"&&re.call(this,Mt)&&!isNaN(+Mt.slice(1))&&(this[Mt]=U)},stop:function(){this.done=!0;var Bt=this.tryEntries[0].completion;if(Bt.type==="throw")throw Bt.arg;return this.rval},dispatchException:function(Bt){if(this.done)throw Bt;var Mt=this;function bn(fn,We){return xn.type="throw",xn.arg=Bt,Mt.next=fn,We&&(Mt.method="next",Mt.arg=U),!!We}for(var Dt=this.tryEntries.length-1;Dt>=0;--Dt){var _t=this.tryEntries[Dt],xn=_t.completion;if(_t.tryLoc==="root")return bn("end");if(_t.tryLoc<=this.prev){var In=re.call(_t,"catchLoc"),Yn=re.call(_t,"finallyLoc");if(In&&Yn){if(this.prev<_t.catchLoc)return bn(_t.catchLoc,!0);if(this.prev<_t.finallyLoc)return bn(_t.finallyLoc)}else if(In){if(this.prev<_t.catchLoc)return bn(_t.catchLoc,!0)}else{if(!Yn)throw new Error("try statement without catch or finally");if(this.prev<_t.finallyLoc)return bn(_t.finallyLoc)}}}},abrupt:function(Bt,Mt){for(var bn=this.tryEntries.length-1;bn>=0;--bn){var Dt=this.tryEntries[bn];if(Dt.tryLoc<=this.prev&&re.call(Dt,"finallyLoc")&&this.prev<Dt.finallyLoc){var _t=Dt;break}}_t&&(Bt==="break"||Bt==="continue")&&_t.tryLoc<=Mt&&Mt<=_t.finallyLoc&&(_t=null);var xn=_t?_t.completion:{};return xn.type=Bt,xn.arg=Mt,_t?(this.method="next",this.next=_t.finallyLoc,pe):this.complete(xn)},complete:function(Bt,Mt){if(Bt.type==="throw")throw Bt.arg;return Bt.type==="break"||Bt.type==="continue"?this.next=Bt.arg:Bt.type==="return"?(this.rval=this.arg=Bt.arg,this.method="return",this.next="end"):Bt.type==="normal"&&Mt&&(this.next=Mt),pe},finish:function(Bt){for(var Mt=this.tryEntries.length-1;Mt>=0;--Mt){var bn=this.tryEntries[Mt];if(bn.finallyLoc===Bt)return this.complete(bn.completion,bn.afterLoc),Pt(bn),pe}},catch:function(Bt){for(var Mt=this.tryEntries.length-1;Mt>=0;--Mt){var bn=this.tryEntries[Mt];if(bn.tryLoc===Bt){var Dt=bn.completion;if(Dt.type==="throw"){var _t=Dt.arg;Pt(bn)}return _t}}throw new Error("illegal catch attempt")},delegateYield:function(Bt,Mt,bn){return this.delegate={iterator:ln(Bt),resultName:Mt,nextLoc:bn},this.method==="next"&&(this.arg=U),pe}},H}(Oe.exports);try{regeneratorRuntime=b}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=b:Function("r","regeneratorRuntime = r")(b)}},function(Oe,A,o){for(var b=o(155),H=o(82),U=o(38),B=o(16),re=o(42),J=o(96),R=o(19),P=R("iterator"),$=R("toStringTag"),L=J.Array,ee={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},F=H(ee),ue=0;ue<F.length;ue++){var ie,K=F[ue],he=ee[K],pe=B[K],Ae=pe&&pe.prototype;if(Ae&&(Ae[P]||re(Ae,P,L),Ae[$]||re(Ae,$,K),J[K]=L,he))for(ie in b)Ae[ie]||U(Ae,ie,b[ie],!0)}},function(Oe,A,o){var b=o(8),H=o(152);b(b.G+b.B,{setImmediate:H.set,clearImmediate:H.clear})},function(Oe,A,o){var b=o(16),H=o(8),U=o(120),B=[].slice,re=/MSIE .\./.test(U),J=function(R){return function(P,$){var L=arguments.length>2,ee=!!L&&B.call(arguments,2);return R(L?function(){(typeof P=="function"?P:Function(P)).apply(this,ee)}:P,$)}};H(H.G+H.B+H.F*re,{setTimeout:J(b.setTimeout),setInterval:J(b.setInterval)})},function(Oe,A,o){o(411),o(410),o(409),Oe.exports=o(24)},function(Oe,A,o){var b=o(8),H=o(24),U=o(16),B=o(104),re=o(216);b(b.P+b.R,"Promise",{finally:function(J){var R=B(this,H.Promise||U.Promise),P=typeof J=="function";return this.then(P?function($){return re(R,J()).then(function(){return $})}:J,P?function($){return re(R,J()).then(function(){throw $})}:J)}})},function(Oe,A,o){o(218),o(413),Oe.exports=o(24).Promise.finally},function(Oe,A,o){var b=o(8),H=o(210)(!0);b(b.S,"Object",{entries:function(U){return H(U)}})},function(Oe,A,o){o(415),Oe.exports=o(24).Object.entries},function(Oe,A,o){var b=o(8),H=o(210)(!1);b(b.S,"Object",{values:function(U){return H(U)}})},function(Oe,A,o){o(417),Oe.exports=o(24).Object.values},function(Oe,A,o){var b=o(8),H=o(212),U=o(41),B=o(53),re=o(158);b(b.S,"Object",{getOwnPropertyDescriptors:function(J){for(var R,P,$=U(J),L=B.f,ee=H($),F={},ue=0;ee.length>ue;)(P=L($,R=ee[ue++]))!==void 0&&re(F,R,P);return F}})},function(Oe,A,o){o(419),Oe.exports=o(24).Object.getOwnPropertyDescriptors},function(Oe,A,o){o(239)("asyncIterator")},function(Oe,A,o){o(421),Oe.exports=o(174).f("asyncIterator")},function(Oe,A,o){o(97)("trimRight",function(b){return function(){return b(this,2)}},"trimEnd")},function(Oe,A,o){o(423),Oe.exports=o(24).String.trimRight},function(Oe,A,o){o(97)("trimLeft",function(b){return function(){return b(this,1)}},"trimStart")},function(Oe,A,o){o(425),Oe.exports=o(24).String.trimLeft},function(Oe,A,o){var b=o(8),H=o(211),U=o(120),B=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(U);b(b.P+b.F*B,"String",{padEnd:function(re){return H(this,re,arguments.length>1?arguments[1]:void 0,!1)}})},function(Oe,A,o){o(427),Oe.exports=o(24).String.padEnd},function(Oe,A,o){var b=o(8),H=o(211),U=o(120),B=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(U);b(b.P+b.F*B,"String",{padStart:function(re){return H(this,re,arguments.length>1?arguments[1]:void 0,!0)}})},function(Oe,A,o){o(429),Oe.exports=o(24).String.padStart},function(Oe,A,o){var b=o(126),H=o(13),U=o(22),B=o(56),re=o(19)("isConcatSpreadable");Oe.exports=function J(R,P,$,L,ee,F,ue,ie){for(var K,he,pe=ee,Ae=0,Te=!!ue&&B(ue,ie,3);Ae<L;){if(Ae in $){if(K=Te?Te($[Ae],Ae,P):$[Ae],he=!1,H(K)&&(he=(he=K[re])!==void 0?!!he:b(K)),he&&F>0)pe=J(R,P,K,U(K.length),pe,F-1)-1;else{if(pe>=9007199254740991)throw TypeError();R[pe]=K}pe++}Ae++}return pe}},function(Oe,A,o){var b=o(8),H=o(431),U=o(34),B=o(22),re=o(55),J=o(224);b(b.P,"Array",{flatMap:function(R){var P,$,L=U(this);return re(R),P=B(L.length),$=J(L,0),H($,L,L,P,0,1,R,arguments[1]),$}}),o(77)("flatMap")},function(Oe,A,o){o(432),Oe.exports=o(24).Array.flatMap},function(Oe,A,o){var b=o(8),H=o(128)(!0);b(b.P,"Array",{includes:function(U){return H(this,U,arguments.length>1?arguments[1]:void 0)}}),o(77)("includes")},function(Oe,A,o){o(434),Oe.exports=o(24).Array.includes},function(Oe,A,o){var b=o(8),H=o(170);H&&b(b.S,"Reflect",{setPrototypeOf:function(U,B){H.check(U,B);try{return H.set(U,B),!0}catch{return!1}}})},function(Oe,A,o){var b=o(26),H=o(53),U=o(78),B=o(43),re=o(8),J=o(85),R=o(14),P=o(13);re(re.S,"Reflect",{set:function $(L,ee,F){var ue,ie,K=arguments.length<4?L:arguments[3],he=H.f(R(L),ee);if(!he){if(P(ie=U(L)))return $(ie,ee,F,K);he=J(0)}if(B(he,"value")){if(he.writable===!1||!P(K))return!1;if(ue=H.f(K,ee)){if(ue.get||ue.set||ue.writable===!1)return!1;ue.value=F,b.f(K,ee,ue)}else b.f(K,ee,J(0,F));return!0}return he.set!==void 0&&(he.set.call(K,F),!0)}})},function(Oe,A,o){var b=o(8),H=o(14),U=Object.preventExtensions;b(b.S,"Reflect",{preventExtensions:function(B){H(B);try{return U&&U(B),!0}catch{return!1}}})},function(Oe,A,o){var b=o(8);b(b.S,"Reflect",{ownKeys:o(212)})},function(Oe,A,o){var b=o(8),H=o(14),U=Object.isExtensible;b(b.S,"Reflect",{isExtensible:function(B){return H(B),!U||U(B)}})},function(Oe,A,o){var b=o(8);b(b.S,"Reflect",{has:function(H,U){return U in H}})},function(Oe,A,o){var b=o(8),H=o(78),U=o(14);b(b.S,"Reflect",{getPrototypeOf:function(B){return H(U(B))}})},function(Oe,A,o){var b=o(53),H=o(8),U=o(14);H(H.S,"Reflect",{getOwnPropertyDescriptor:function(B,re){return b.f(U(B),re)}})},function(Oe,A,o){var b=o(53),H=o(78),U=o(43),B=o(8),re=o(13),J=o(14);B(B.S,"Reflect",{get:function R(P,$){var L,ee,F=arguments.length<3?P:arguments[2];return J(P)===F?P[$]:(L=b.f(P,$))?U(L,"value")?L.value:L.get!==void 0?L.get.call(F):void 0:re(ee=H(P))?R(ee,$,F):void 0}})},function(Oe,A,o){var b=o(8),H=o(14),U=function(B){this._t=H(B),this._i=0;var re,J=this._k=[];for(re in B)J.push(re)};o(226)(U,"Object",function(){var B,re=this._k;do if(this._i>=re.length)return{value:void 0,done:!0};while(!((B=re[this._i++])in this._t));return{value:B,done:!1}}),b(b.S,"Reflect",{enumerate:function(B){return new U(B)}})},function(Oe,A,o){var b=o(8),H=o(53).f,U=o(14);b(b.S,"Reflect",{deleteProperty:function(B,re){var J=H(U(B),re);return!(J&&!J.configurable)&&delete B[re]}})},function(Oe,A,o){var b=o(26),H=o(8),U=o(14),B=o(66);H(H.S+H.F*o(15)(function(){Reflect.defineProperty(b.f({},1,{value:1}),1,{value:2})}),"Reflect",{defineProperty:function(re,J,R){U(re),J=B(J,!0),U(R);try{return b.f(re,J,R),!0}catch{return!1}}})},function(Oe,A,o){var b=o(8),H=o(80),U=o(55),B=o(14),re=o(13),J=o(15),R=o(233),P=(o(16).Reflect||{}).construct,$=J(function(){function ee(){}return!(P(function(){},[],ee)instanceof ee)}),L=!J(function(){P(function(){})});b(b.S+b.F*($||L),"Reflect",{construct:function(ee,F){U(ee),B(F);var ue=arguments.length<3?ee:U(arguments[2]);if(L&&!$)return P(ee,F,ue);if(ee==ue){switch(F.length){case 0:return new ee;case 1:return new ee(F[0]);case 2:return new ee(F[0],F[1]);case 3:return new ee(F[0],F[1],F[2]);case 4:return new ee(F[0],F[1],F[2],F[3])}var ie=[null];return ie.push.apply(ie,F),new(R.apply(ee,ie))}var K=ue.prototype,he=H(re(K)?K:Object.prototype),pe=Function.apply.call(ee,he,F);return re(pe)?pe:he}})},function(Oe,A,o){var b=o(8),H=o(55),U=o(14),B=(o(16).Reflect||{}).apply,re=Function.apply;b(b.S+b.F*!o(15)(function(){B(function(){})}),"Reflect",{apply:function(J,R,P){var $=H(J),L=U(P);return B?B($,R,L):re.call($,R,L)}})},function(Oe,A,o){o(60)("Float64",8,function(b){return function(H,U,B){return b(this,H,U,B)}})},function(Oe,A,o){o(60)("Float32",4,function(b){return function(H,U,B){return b(this,H,U,B)}})},function(Oe,A,o){o(60)("Uint32",4,function(b){return function(H,U,B){return b(this,H,U,B)}})},function(Oe,A,o){o(60)("Int32",4,function(b){return function(H,U,B){return b(this,H,U,B)}})},function(Oe,A,o){o(60)("Uint16",2,function(b){return function(H,U,B){return b(this,H,U,B)}})},function(Oe,A,o){o(60)("Int16",2,function(b){return function(H,U,B){return b(this,H,U,B)}})},function(Oe,A,o){o(60)("Uint8",1,function(b){return function(H,U,B){return b(this,H,U,B)}},!0)},function(Oe,A,o){o(60)("Uint8",1,function(b){return function(H,U,B){return b(this,H,U,B)}})},function(Oe,A,o){o(60)("Int8",1,function(b){return function(H,U,B){return b(this,H,U,B)}})},function(Oe,A,o){var b=o(8);b(b.G+b.W+b.F*!o(118).ABV,{DataView:o(151).DataView})},function(Oe,A,o){var b=o(8),H=o(118),U=o(151),B=o(14),re=o(81),J=o(22),R=o(13),P=o(16).ArrayBuffer,$=o(104),L=U.ArrayBuffer,ee=U.DataView,F=H.ABV&&P.isView,ue=L.prototype.slice,ie=H.VIEW;b(b.G+b.W+b.F*(P!==L),{ArrayBuffer:L}),b(b.S+b.F*!H.CONSTR,"ArrayBuffer",{isView:function(K){return F&&F(K)||R(K)&&ie in K}}),b(b.P+b.U+b.F*o(15)(function(){return!new L(2).slice(1,void 0).byteLength}),"ArrayBuffer",{slice:function(K,he){if(ue!==void 0&&he===void 0)return ue.call(B(this),K);for(var pe=B(this).byteLength,Ae=re(K,pe),Te=re(he===void 0?pe:he,pe),je=new($(this,L))(J(Te-Ae)),ke=new ee(this),at=new ee(je),St=0;Ae<Te;)at.setUint8(St++,ke.getUint8(Ae++));return je}}),o(95)("ArrayBuffer")},function(Oe,A,o){var b=o(214),H=o(76);o(119)("WeakSet",function(U){return function(){return U(this,arguments.length>0?arguments[0]:void 0)}},{add:function(U){return b.def(H(this,"WeakSet"),U,!0)}},b,!1,!0)},function(Oe,A,o){var b,H=o(16),U=o(51)(0),B=o(38),re=o(65),J=o(235),R=o(214),P=o(13),$=o(76),L=o(76),ee=!H.ActiveXObject&&"ActiveXObject"in H,F=re.getWeak,ue=Object.isExtensible,ie=R.ufstore,K=function(Ae){return function(){return Ae(this,arguments.length>0?arguments[0]:void 0)}},he={get:function(Ae){if(P(Ae)){var Te=F(Ae);return Te===!0?ie($(this,"WeakMap")).get(Ae):Te?Te[this._i]:void 0}},set:function(Ae,Te){return R.def($(this,"WeakMap"),Ae,Te)}},pe=Oe.exports=o(119)("WeakMap",K,he,R,!0,!0);L&&ee&&(J((b=R.getConstructor(K,"WeakMap")).prototype,he),re.NEED=!0,U(["delete","has","get","set"],function(Ae){var Te=pe.prototype,je=Te[Ae];B(Te,Ae,function(ke,at){if(P(ke)&&!ue(ke)){this._f||(this._f=new b);var St=this._f[Ae](ke,at);return Ae=="set"?this:St}return je.call(this,ke,at)})}))},function(Oe,A,o){var b=o(215),H=o(76);Oe.exports=o(119)("Set",function(U){return function(){return U(this,arguments.length>0?arguments[0]:void 0)}},{add:function(U){return b.def(H(this,"Set"),U=U===0?0:U,U)}},b)},function(Oe,A,o){var b=o(215),H=o(76);Oe.exports=o(119)("Map",function(U){return function(){return U(this,arguments.length>0?arguments[0]:void 0)}},{get:function(U){var B=b.getEntry(H(this,"Map"),U);return B&&B.v},set:function(U,B){return b.def(H(this,"Map"),U===0?0:U,B)}},b,!0)},function(Oe,A){Oe.exports=function(o){try{return{e:!1,v:o()}}catch(b){return{e:!0,v:b}}}},function(Oe,A,o){var b=o(16),H=o(152).set,U=b.MutationObserver||b.WebKitMutationObserver,B=b.process,re=b.Promise,J=o(62)(B)=="process";Oe.exports=function(){var R,P,$,L=function(){var ie,K;for(J&&(ie=B.domain)&&ie.exit();R;){K=R.fn,R=R.next;try{K()}catch(he){throw R?$():P=void 0,he}}P=void 0,ie&&ie.enter()};if(J)$=function(){B.nextTick(L)};else if(!U||b.navigator&&b.navigator.standalone)if(re&&re.resolve){var ee=re.resolve(void 0);$=function(){ee.then(L)}}else $=function(){H.call(b,L)};else{var F=!0,ue=document.createTextNode("");new U(L).observe(ue,{characterData:!0}),$=function(){ue.data=F=!F}}return function(ie){var K={fn:ie,next:void 0};P&&(P.next=K),R||(R=K,$()),P=K}}},function(Oe,A,o){var b=o(161),H=o(14),U=o(104),B=o(153),re=o(22),J=o(123),R=o(154),P=o(15),$=Math.min,L=[].push,ee=!P(function(){});o(122)("split",2,function(F,ue,ie,K){var he;return he="abbc".split(/(b)*/)[1]=="c"||"test".split(/(?:)/,-1).length!=4||"ab".split(/(?:ab)*/).length!=2||".".split(/(.?)(.?)/).length!=4||".".split(/()()/).length>1||"".split(/.?/).length?function(pe,Ae){var Te=String(this);if(pe===void 0&&Ae===0)return[];if(!b(pe))return ie.call(Te,pe,Ae);for(var je,ke,at,St=[],zt=(pe.ignoreCase?"i":"")+(pe.multiline?"m":"")+(pe.unicode?"u":"")+(pe.sticky?"y":""),$t=0,we=Ae===void 0?4294967295:Ae>>>0,Tt=new RegExp(pe.source,zt+"g");(je=R.call(Tt,Te))&&!((ke=Tt.lastIndex)>$t&&(St.push(Te.slice($t,je.index)),je.length>1&&je.index<Te.length&&L.apply(St,je.slice(1)),at=je[0].length,$t=ke,St.length>=we));)Tt.lastIndex===je.index&&Tt.lastIndex++;return $t===Te.length?!at&&Tt.test("")||St.push(""):St.push(Te.slice($t)),St.length>we?St.slice(0,we):St}:"0".split(void 0,0).length?function(pe,Ae){return pe===void 0&&Ae===0?[]:ie.call(this,pe,Ae)}:ie,[function(pe,Ae){var Te=F(this),je=pe?.[ue];return je!==void 0?je.call(pe,Te,Ae):he.call(String(Te),pe,Ae)},function(pe,Ae){var Te=K(he,pe,this,Ae,he!==ie);if(Te.done)return Te.value;var je=H(pe),ke=String(this),at=U(je,RegExp),St=je.unicode,zt=(je.ignoreCase?"i":"")+(je.multiline?"m":"")+(je.unicode?"u":"")+(ee?"y":"g"),$t=new at(ee?je:"^(?:"+je.source+")",zt),we=Ae===void 0?4294967295:Ae>>>0;if(we===0)return[];if(ke.length===0)return J($t,ke)===null?[ke]:[];for(var Tt=0,Gt=0,Pt=[];Gt<ke.length;){$t.lastIndex=ee?Gt:0;var Ye,ln=J($t,ee?ke:ke.slice(Gt));if(ln===null||(Ye=$(re($t.lastIndex+(ee?0:Gt)),ke.length))===Tt)Gt=B(ke,Gt,St);else{if(Pt.push(ke.slice(Tt,Gt)),Pt.length===we)return Pt;for(var Zt=1;Zt<=ln.length-1;Zt++)if(Pt.push(ln[Zt]),Pt.length===we)return Pt;Gt=Tt=Ye}}return Pt.push(ke.slice(Tt)),Pt}]})},function(Oe,A,o){var b=o(14),H=o(234),U=o(123);o(122)("search",1,function(B,re,J,R){return[function(P){var $=B(this),L=P?.[re];return L!==void 0?L.call(P,$):new RegExp(P)[re](String($))},function(P){var $=R(J,P,this);if($.done)return $.value;var L=b(P),ee=String(this),F=L.lastIndex;H(F,0)||(L.lastIndex=0);var ue=U(L,ee);return H(L.lastIndex,F)||(L.lastIndex=F),ue===null?-1:ue.index}]})},function(Oe,A,o){var b=o(14),H=o(34),U=o(22),B=o(54),re=o(153),J=o(123),R=Math.max,P=Math.min,$=Math.floor,L=/\$([$&`']|\d\d?|<[^>]*>)/g,ee=/\$([$&`']|\d\d?)/g,F=function(ue){return ue===void 0?ue:String(ue)};o(122)("replace",2,function(ue,ie,K,he){return[function(Ae,Te){var je=ue(this),ke=Ae?.[ie];return ke!==void 0?ke.call(Ae,je,Te):K.call(String(je),Ae,Te)},function(Ae,Te){var je=he(K,Ae,this,Te);if(je.done)return je.value;var ke=b(Ae),at=String(this),St=typeof Te=="function";St||(Te=String(Te));var zt=ke.global;if(zt){var $t=ke.unicode;ke.lastIndex=0}for(var we=[];;){var Tt=J(ke,at);if(Tt===null||(we.push(Tt),!zt))break;String(Tt[0])===""&&(ke.lastIndex=re(at,U(ke.lastIndex),$t))}for(var Gt="",Pt=0,Ye=0;Ye<we.length;Ye++){Tt=we[Ye];for(var ln=String(Tt[0]),Zt=R(P(B(Tt.index),at.length),0),Bt=[],Mt=1;Mt<Tt.length;Mt++)Bt.push(F(Tt[Mt]));var bn=Tt.groups;if(St){var Dt=[ln].concat(Bt,Zt,at);bn!==void 0&&Dt.push(bn);var _t=String(Te.apply(void 0,Dt))}else _t=pe(ln,at,Zt,Bt,bn,Te);Zt>=Pt&&(Gt+=at.slice(Pt,Zt)+_t,Pt=Zt+ln.length)}return Gt+at.slice(Pt)}];function pe(Ae,Te,je,ke,at,St){var zt=je+Ae.length,$t=ke.length,we=ee;return at!==void 0&&(at=H(at),we=L),K.call(St,we,function(Tt,Gt){var Pt;switch(Gt.charAt(0)){case"$":return"$";case"&":return Ae;case"`":return Te.slice(0,je);case"'":return Te.slice(zt);case"<":Pt=at[Gt.slice(1,-1)];break;default:var Ye=+Gt;if(Ye===0)return Tt;if(Ye>$t){var ln=$(Ye/10);return ln===0?Tt:ln<=$t?ke[ln-1]===void 0?Gt.charAt(1):ke[ln-1]+Gt.charAt(1):Tt}Pt=ke[Ye-1]}return Pt===void 0?"":Pt})}})},function(Oe,A,o){var b=o(14),H=o(22),U=o(153),B=o(123);o(122)("match",1,function(re,J,R,P){return[function($){var L=re(this),ee=$?.[J];return ee!==void 0?ee.call($,L):new RegExp($)[J](String(L))},function($){var L=P(R,$,this);if(L.done)return L.value;var ee=b($),F=String(this);if(!ee.global)return B(ee,F);var ue=ee.unicode;ee.lastIndex=0;for(var ie,K=[],he=0;(ie=B(ee,F))!==null;){var pe=String(ie[0]);K[he]=pe,pe===""&&(ee.lastIndex=U(F,H(ee.lastIndex),ue)),he++}return he===0?null:K}]})},function(Oe,A,o){o(219);var b=o(14),H=o(124),U=o(27),B=/./.toString,re=function(J){o(38)(RegExp.prototype,"toString",J,!0)};o(15)(function(){return B.call({source:"a",flags:"b"})!="/a/b"})?re(function(){var J=b(this);return"/".concat(J.source,"/","flags"in J?J.flags:!U&&J instanceof RegExp?H.call(J):void 0)}):B.name!="toString"&&re(function(){return B.call(this)})},function(Oe,A,o){var b=o(16),H=o(168),U=o(26).f,B=o(79).f,re=o(161),J=o(124),R=b.RegExp,P=R,$=R.prototype,L=/a/g,ee=/a/g,F=new R(L)!==L;if(o(27)&&(!F||o(15)(function(){return ee[o(19)("match")]=!1,R(L)!=L||R(ee)==ee||R(L,"i")!="/a/i"}))){R=function(he,pe){var Ae=this instanceof R,Te=re(he),je=pe===void 0;return!Ae&&Te&&he.constructor===R&&je?he:H(F?new P(Te&&!je?he.source:he,pe):P((Te=he instanceof R)?he.source:he,Te&&je?J.call(he):pe),Ae?this:$,R)};for(var ue=function(he){he in R||U(R,he,{configurable:!0,get:function(){return P[he]},set:function(pe){P[he]=pe}})},ie=B(P),K=0;ie.length>K;)ue(ie[K++]);$.constructor=R,R.prototype=$,o(38)(b,"RegExp",R)}o(95)("RegExp")},function(Oe,A,o){o(95)("Array")},function(Oe,A,o){var b=o(8),H=o(51)(6),U="findIndex",B=!0;U in[]&&Array(1)[U](function(){B=!1}),b(b.P+b.F*B,"Array",{findIndex:function(re){return H(this,re,arguments.length>1?arguments[1]:void 0)}}),o(77)(U)},function(Oe,A,o){var b=o(8),H=o(51)(5),U=!0;"find"in[]&&Array(1).find(function(){U=!1}),b(b.P+b.F*U,"Array",{find:function(B){return H(this,B,arguments.length>1?arguments[1]:void 0)}}),o(77)("find")},function(Oe,A,o){var b=o(8);b(b.P,"Array",{fill:o(156)}),o(77)("fill")},function(Oe,A,o){var b=o(8);b(b.P,"Array",{copyWithin:o(222)}),o(77)("copyWithin")},function(Oe,A,o){var b=o(8),H=o(41),U=o(54),B=o(22),re=[].lastIndexOf,J=!!re&&1/[1].lastIndexOf(1,-0)<0;b(b.P+b.F*(J||!o(49)(re)),"Array",{lastIndexOf:function(R){if(J)return re.apply(this,arguments)||0;var P=H(this),$=B(P.length),L=$-1;for(arguments.length>1&&(L=Math.min(L,U(arguments[1]))),L<0&&(L=$+L);L>=0;L--)if(L in P&&P[L]===R)return L||0;return-1}})},function(Oe,A,o){var b=o(8),H=o(128)(!1),U=[].indexOf,B=!!U&&1/[1].indexOf(1,-0)<0;b(b.P+b.F*(B||!o(49)(U)),"Array",{indexOf:function(re){return B?U.apply(this,arguments)||0:H(this,re,arguments[1])}})},function(Oe,A,o){var b=o(8),H=o(223);b(b.P+b.F*!o(49)([].reduceRight,!0),"Array",{reduceRight:function(U){return H(this,U,arguments.length,arguments[1],!0)}})},function(Oe,A,o){var b=o(8),H=o(223);b(b.P+b.F*!o(49)([].reduce,!0),"Array",{reduce:function(U){return H(this,U,arguments.length,arguments[1],!1)}})},function(Oe,A,o){var b=o(8),H=o(51)(4);b(b.P+b.F*!o(49)([].every,!0),"Array",{every:function(U){return H(this,U,arguments[1])}})},function(Oe,A,o){var b=o(8),H=o(51)(3);b(b.P+b.F*!o(49)([].some,!0),"Array",{some:function(U){return H(this,U,arguments[1])}})},function(Oe,A,o){var b=o(8),H=o(51)(2);b(b.P+b.F*!o(49)([].filter,!0),"Array",{filter:function(U){return H(this,U,arguments[1])}})},function(Oe,A,o){var b=o(8),H=o(51)(1);b(b.P+b.F*!o(49)([].map,!0),"Array",{map:function(U){return H(this,U,arguments[1])}})},function(Oe,A,o){var b=o(13),H=o(126),U=o(19)("species");Oe.exports=function(B){var re;return H(B)&&(typeof(re=B.constructor)!="function"||re!==Array&&!H(re.prototype)||(re=void 0),b(re)&&(re=re[U])===null&&(re=void 0)),re===void 0?Array:re}},function(Oe,A,o){var b=o(8),H=o(51)(0),U=o(49)([].forEach,!0);b(b.P+b.F*!U,"Array",{forEach:function(B){return H(this,B,arguments[1])}})},function(Oe,A,o){var b=o(8),H=o(55),U=o(34),B=o(15),re=[].sort,J=[1,2,3];b(b.P+b.F*(B(function(){J.sort(void 0)})||!B(function(){J.sort(null)})||!o(49)(re)),"Array",{sort:function(R){return R===void 0?re.call(U(this)):re.call(U(this),H(R))}})},function(Oe,A,o){var b=o(8),H=o(171),U=o(62),B=o(81),re=o(22),J=[].slice;b(b.P+b.F*o(15)(function(){H&&J.call(H)}),"Array",{slice:function(R,P){var $=re(this.length),L=U(this);if(P=P===void 0?$:P,L=="Array")return J.call(this,R,P);for(var ee=B(R,$),F=B(P,$),ue=re(F-ee),ie=new Array(ue),K=0;K<ue;K++)ie[K]=L=="String"?this.charAt(ee+K):this[ee+K];return ie}})},function(Oe,A,o){var b=o(8),H=o(41),U=[].join;b(b.P+b.F*(o(107)!=Object||!o(49)(U)),"Array",{join:function(B){return U.call(H(this),B===void 0?",":B)}})},function(Oe,A,o){var b=o(8),H=o(158);b(b.S+b.F*o(15)(function(){function U(){}return!(Array.of.call(U)instanceof U)}),"Array",{of:function(){for(var U=0,B=arguments.length,re=new(typeof this=="function"?this:Array)(B);B>U;)H(re,U,arguments[U++]);return re.length=B,re}})},function(Oe,A,o){var b=o(56),H=o(8),U=o(34),B=o(225),re=o(159),J=o(22),R=o(158),P=o(157);H(H.S+H.F*!o(125)(function($){Array.from($)}),"Array",{from:function($){var L,ee,F,ue,ie=U($),K=typeof this=="function"?this:Array,he=arguments.length,pe=he>1?arguments[1]:void 0,Ae=pe!==void 0,Te=0,je=P(ie);if(Ae&&(pe=b(pe,he>2?arguments[2]:void 0,2)),je==null||K==Array&&re(je))for(ee=new K(L=J(ie.length));L>Te;Te++)R(ee,Te,Ae?pe(ie[Te],Te):ie[Te]);else for(ue=je.call(ie),ee=new K;!(F=ue.next()).done;Te++)R(ee,Te,Ae?B(ue,pe,[F.value,Te],!0):F.value);return ee.length=Te,ee}})},function(Oe,A,o){var b=o(8);b(b.S,"Array",{isArray:o(126)})},function(Oe,A,o){var b=o(14),H=o(66);Oe.exports=function(U){if(U!=="string"&&U!=="number"&&U!=="default")throw TypeError("Incorrect hint");return H(b(this),U!="number")}},function(Oe,A,o){var b=o(19)("toPrimitive"),H=Date.prototype;b in H||o(42)(H,b,o(494))},function(Oe,A,o){var b=Date.prototype,H=b.toString,U=b.getTime;new Date(NaN)+""!="Invalid Date"&&o(38)(b,"toString",function(){var B=U.call(this);return B==B?H.call(this):"Invalid Date"})},function(Oe,A,o){var b=o(15),H=Date.prototype.getTime,U=Date.prototype.toISOString,B=function(re){return re>9?re:"0"+re};Oe.exports=b(function(){return U.call(new Date(-5e13-1))!="0385-07-25T07:06:39.999Z"})||!b(function(){U.call(new Date(NaN))})?function(){if(!isFinite(H.call(this)))throw RangeError("Invalid time value");var re=this,J=re.getUTCFullYear(),R=re.getUTCMilliseconds(),P=J<0?"-":J>9999?"+":"";return P+("00000"+Math.abs(J)).slice(P?-6:-4)+"-"+B(re.getUTCMonth()+1)+"-"+B(re.getUTCDate())+"T"+B(re.getUTCHours())+":"+B(re.getUTCMinutes())+":"+B(re.getUTCSeconds())+"."+(R>99?R:"0"+B(R))+"Z"}:U},function(Oe,A,o){var b=o(8),H=o(497);b(b.P+b.F*(Date.prototype.toISOString!==H),"Date",{toISOString:H})},function(Oe,A,o){var b=o(8),H=o(34),U=o(66);b(b.P+b.F*o(15)(function(){return new Date(NaN).toJSON()!==null||Date.prototype.toJSON.call({toISOString:function(){return 1}})!==1}),"Date",{toJSON:function(B){var re=H(this),J=U(re);return typeof J!="number"||isFinite(J)?re.toISOString():null}})},function(Oe,A,o){var b=o(8);b(b.S,"Date",{now:function(){return new Date().getTime()}})},function(Oe,A,o){o(37)("sup",function(b){return function(){return b(this,"sup","","")}})},function(Oe,A,o){o(37)("sub",function(b){return function(){return b(this,"sub","","")}})},function(Oe,A,o){o(37)("strike",function(b){return function(){return b(this,"strike","","")}})},function(Oe,A,o){o(37)("small",function(b){return function(){return b(this,"small","","")}})},function(Oe,A,o){o(37)("link",function(b){return function(H){return b(this,"a","href",H)}})},function(Oe,A,o){o(37)("italics",function(b){return function(){return b(this,"i","","")}})},function(Oe,A,o){o(37)("fontsize",function(b){return function(H){return b(this,"font","size",H)}})},function(Oe,A,o){o(37)("fontcolor",function(b){return function(H){return b(this,"font","color",H)}})},function(Oe,A,o){o(37)("fixed",function(b){return function(){return b(this,"tt","","")}})},function(Oe,A,o){o(37)("bold",function(b){return function(){return b(this,"b","","")}})},function(Oe,A,o){o(37)("blink",function(b){return function(){return b(this,"blink","","")}})},function(Oe,A,o){o(37)("big",function(b){return function(){return b(this,"big","","")}})},function(Oe,A,o){o(37)("anchor",function(b){return function(H){return b(this,"a","name",H)}})},function(Oe,A,o){var b=o(8),H=o(22),U=o(162),B="".startsWith;b(b.P+b.F*o(160)("startsWith"),"String",{startsWith:function(re){var J=U(this,re,"startsWith"),R=H(Math.min(arguments.length>1?arguments[1]:void 0,J.length)),P=String(re);return B?B.call(J,P,R):J.slice(R,R+P.length)===P}})},function(Oe,A,o){var b=o(8);b(b.P,"String",{repeat:o(167)})},function(Oe,A,o){var b=o(8),H=o(162);b(b.P+b.F*o(160)("includes"),"String",{includes:function(U){return!!~H(this,U,"includes").indexOf(U,arguments.length>1?arguments[1]:void 0)}})},function(Oe,A,o){var b=o(8),H=o(22),U=o(162),B="".endsWith;b(b.P+b.F*o(160)("endsWith"),"String",{endsWith:function(re){var J=U(this,re,"endsWith"),R=arguments.length>1?arguments[1]:void 0,P=H(J.length),$=R===void 0?P:Math.min(H(R),P),L=String(re);return B?B.call(J,L,$):J.slice($-L.length,$)===L}})},function(Oe,A,o){var b=o(8),H=o(164)(!1);b(b.P,"String",{codePointAt:function(U){return H(this,U)}})},function(Oe,A,o){var b=o(164)(!0);o(163)(String,"String",function(H){this._t=String(H),this._i=0},function(){var H,U=this._t,B=this._i;return B>=U.length?{value:void 0,done:!0}:(H=b(U,B),this._i+=H.length,{value:H,done:!1})})},function(Oe,A,o){o(97)("trim",function(b){return function(){return b(this,3)}})},function(Oe,A,o){var b=o(8),H=o(41),U=o(22);b(b.S,"String",{raw:function(B){for(var re=H(B.raw),J=U(re.length),R=arguments.length,P=[],$=0;J>$;)P.push(String(re[$++])),$<R&&P.push(String(arguments[$]));return P.join("")}})},function(Oe,A,o){var b=o(8),H=o(81),U=String.fromCharCode,B=String.fromCodePoint;b(b.S+b.F*(!!B&&B.length!=1),"String",{fromCodePoint:function(re){for(var J,R=[],P=arguments.length,$=0;P>$;){if(J=+arguments[$++],H(J,1114111)!==J)throw RangeError(J+" is not a valid code point");R.push(J<65536?U(J):U(55296+((J-=65536)>>10),J%1024+56320))}return R.join("")}})},function(Oe,A,o){var b=o(8);b(b.S,"Math",{trunc:function(H){return(H>0?Math.floor:Math.ceil)(H)}})},function(Oe,A,o){var b=o(8),H=o(165),U=Math.exp;b(b.S,"Math",{tanh:function(B){var re=H(B=+B),J=H(-B);return re==1/0?1:J==1/0?-1:(re-J)/(U(B)+U(-B))}})},function(Oe,A,o){var b=o(8),H=o(165),U=Math.exp;b(b.S+b.F*o(15)(function(){return!Math.sinh(-2e-17)!=-2e-17}),"Math",{sinh:function(B){return Math.abs(B=+B)<1?(H(B)-H(-B))/2:(U(B-1)-U(-B-1))*(Math.E/2)}})},function(Oe,A,o){var b=o(8);b(b.S,"Math",{sign:o(166)})},function(Oe,A,o){var b=o(8);b(b.S,"Math",{log2:function(H){return Math.log(H)/Math.LN2}})},function(Oe,A,o){var b=o(8);b(b.S,"Math",{log1p:o(227)})},function(Oe,A,o){var b=o(8);b(b.S,"Math",{log10:function(H){return Math.log(H)*Math.LOG10E}})},function(Oe,A,o){var b=o(8),H=Math.imul;b(b.S+b.F*o(15)(function(){return H(4294967295,5)!=-5||H.length!=2}),"Math",{imul:function(U,B){var re=+U,J=+B,R=65535&re,P=65535&J;return 0|R*P+((65535&re>>>16)*P+R*(65535&J>>>16)<<16>>>0)}})},function(Oe,A,o){var b=o(8),H=Math.abs;b(b.S,"Math",{hypot:function(U,B){for(var re,J,R=0,P=0,$=arguments.length,L=0;P<$;)L<(re=H(arguments[P++]))?(R=R*(J=L/re)*J+1,L=re):R+=re>0?(J=re/L)*J:re;return L===1/0?1/0:L*Math.sqrt(R)}})},function(Oe,A,o){var b=o(166),H=Math.pow,U=H(2,-52),B=H(2,-23),re=H(2,127)*(2-B),J=H(2,-126);Oe.exports=Math.fround||function(R){var P,$,L=Math.abs(R),ee=b(R);return L<J?ee*function(F){return F+1/U-1/U}(L/J/B)*J*B:($=(P=(1+B/U)*L)-(P-L))>re||$!=$?ee*(1/0):ee*$}},function(Oe,A,o){var b=o(8);b(b.S,"Math",{fround:o(532)})},function(Oe,A,o){var b=o(8),H=o(165);b(b.S+b.F*(H!=Math.expm1),"Math",{expm1:H})},function(Oe,A,o){var b=o(8),H=Math.exp;b(b.S,"Math",{cosh:function(U){return(H(U=+U)+H(-U))/2}})},function(Oe,A,o){var b=o(8);b(b.S,"Math",{clz32:function(H){return(H>>>=0)?31-Math.floor(Math.log(H+.5)*Math.LOG2E):32}})},function(Oe,A,o){var b=o(8),H=o(166);b(b.S,"Math",{cbrt:function(U){return H(U=+U)*Math.pow(Math.abs(U),1/3)}})},function(Oe,A,o){var b=o(8),H=Math.atanh;b(b.S+b.F*!(H&&1/H(-0)<0),"Math",{atanh:function(U){return(U=+U)==0?U:Math.log((1+U)/(1-U))/2}})},function(Oe,A,o){var b=o(8),H=Math.asinh;b(b.S+b.F*!(H&&1/H(0)>0),"Math",{asinh:function U(B){return isFinite(B=+B)&&B!=0?B<0?-U(-B):Math.log(B+Math.sqrt(B*B+1)):B}})},function(Oe,A,o){var b=o(8),H=o(227),U=Math.sqrt,B=Math.acosh;b(b.S+b.F*!(B&&Math.floor(B(Number.MAX_VALUE))==710&&B(1/0)==1/0),"Math",{acosh:function(re){return(re=+re)<1?NaN:re>9490626562425156e-8?Math.log(re)+Math.LN2:H(re-1+U(re-1)*U(re+1))}})},function(Oe,A,o){var b=o(8),H=o(231);b(b.S+b.F*(Number.parseInt!=H),"Number",{parseInt:H})},function(Oe,A,o){var b=o(8),H=o(230);b(b.S+b.F*(Number.parseFloat!=H),"Number",{parseFloat:H})},function(Oe,A,o){var b=o(8);b(b.S,"Number",{MIN_SAFE_INTEGER:-9007199254740991})},function(Oe,A,o){var b=o(8);b(b.S,"Number",{MAX_SAFE_INTEGER:9007199254740991})},function(Oe,A,o){var b=o(8),H=o(228),U=Math.abs;b(b.S,"Number",{isSafeInteger:function(B){return H(B)&&U(B)<=9007199254740991}})},function(Oe,A,o){var b=o(8);b(b.S,"Number",{isNaN:function(H){return H!=H}})},function(Oe,A,o){var b=o(8);b(b.S,"Number",{isInteger:o(228)})},function(Oe,A,o){var b=o(8),H=o(16).isFinite;b(b.S,"Number",{isFinite:function(U){return typeof U=="number"&&H(U)}})},function(Oe,A,o){var b=o(8);b(b.S,"Number",{EPSILON:Math.pow(2,-52)})},function(Oe,A,o){var b=o(8),H=o(15),U=o(229),B=1 .toPrecision;b(b.P+b.F*(H(function(){return B.call(1,void 0)!=="1"})||!H(function(){B.call({})})),"Number",{toPrecision:function(re){var J=U(this,"Number#toPrecision: incorrect invocation!");return re===void 0?B.call(J):B.call(J,re)}})},function(Oe,A,o){var b=o(8),H=o(54),U=o(229),B=o(167),re=1 .toFixed,J=Math.floor,R=[0,0,0,0,0,0],P="Number.toFixed: incorrect invocation!",$=function(ue,ie){for(var K=-1,he=ie;++K<6;)he+=ue*R[K],R[K]=he%1e7,he=J(he/1e7)},L=function(ue){for(var ie=6,K=0;--ie>=0;)K+=R[ie],R[ie]=J(K/ue),K=K%ue*1e7},ee=function(){for(var ue=6,ie="";--ue>=0;)if(ie!==""||ue===0||R[ue]!==0){var K=String(R[ue]);ie=ie===""?K:ie+B.call("0",7-K.length)+K}return ie},F=function(ue,ie,K){return ie===0?K:ie%2==1?F(ue,ie-1,K*ue):F(ue*ue,ie/2,K)};b(b.P+b.F*(!!re&&(8e-5.toFixed(3)!=="0.000"||.9.toFixed(0)!=="1"||1.255.toFixed(2)!=="1.25"||0xde0b6b3a7640080.toFixed(0)!=="1000000000000000128")||!o(15)(function(){re.call({})})),"Number",{toFixed:function(ue){var ie,K,he,pe,Ae=U(this,P),Te=H(ue),je="",ke="0";if(Te<0||Te>20)throw RangeError(P);if(Ae!=Ae)return"NaN";if(Ae<=-1e21||Ae>=1e21)return String(Ae);if(Ae<0&&(je="-",Ae=-Ae),Ae>1e-21)if(K=(ie=function(at){for(var St=0,zt=at;zt>=4096;)St+=12,zt/=4096;for(;zt>=2;)St+=1,zt/=2;return St}(Ae*F(2,69,1))-69)<0?Ae*F(2,-ie,1):Ae/F(2,ie,1),K*=4503599627370496,(ie=52-ie)>0){for($(0,K),he=Te;he>=7;)$(1e7,0),he-=7;for($(F(10,he,1),0),he=ie-1;he>=23;)L(1<<23),he-=23;L(1<<he),$(1,1),L(2),ke=ee()}else $(0,K),$(1<<-ie,0),ke=ee()+B.call("0",Te);return ke=Te>0?je+((pe=ke.length)<=Te?"0."+B.call("0",Te-pe)+ke:ke.slice(0,pe-Te)+"."+ke.slice(pe-Te)):je+ke}})},function(Oe,A,o){var b=o(16),H=o(43),U=o(62),B=o(168),re=o(66),J=o(15),R=o(79).f,P=o(53).f,$=o(26).f,L=o(97).trim,ee=b.Number,F=ee,ue=ee.prototype,ie=U(o(80)(ue))=="Number",K="trim"in String.prototype,he=function(je){var ke=re(je,!1);if(typeof ke=="string"&&ke.length>2){var at,St,zt,$t=(ke=K?ke.trim():L(ke,3)).charCodeAt(0);if($t===43||$t===45){if((at=ke.charCodeAt(2))===88||at===120)return NaN}else if($t===48){switch(ke.charCodeAt(1)){case 66:case 98:St=2,zt=49;break;case 79:case 111:St=8,zt=55;break;default:return+ke}for(var we,Tt=ke.slice(2),Gt=0,Pt=Tt.length;Gt<Pt;Gt++)if((we=Tt.charCodeAt(Gt))<48||we>zt)return NaN;return parseInt(Tt,St)}}return+ke};if(!ee(" 0o1")||!ee("0b1")||ee("+0x1")){ee=function(je){var ke=arguments.length<1?0:je,at=this;return at instanceof ee&&(ie?J(function(){ue.valueOf.call(at)}):U(at)!="Number")?B(new F(he(ke)),at,ee):he(ke)};for(var pe,Ae=o(27)?R(F):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),Te=0;Ae.length>Te;Te++)H(F,pe=Ae[Te])&&!H(ee,pe)&&$(ee,pe,P(F,pe));ee.prototype=ue,ue.constructor=ee,o(38)(b,"Number",ee)}},function(Oe,A,o){var b=o(8),H=o(230);b(b.G+b.F*(parseFloat!=H),{parseFloat:H})},function(Oe,A,o){var b=o(8),H=o(231);b(b.G+b.F*(parseInt!=H),{parseInt:H})},function(Oe,A,o){var b=o(13),H=o(78),U=o(19)("hasInstance"),B=Function.prototype;U in B||o(26).f(B,U,{value:function(re){if(typeof this!="function"||!b(re))return!1;if(!b(this.prototype))return re instanceof this;for(;re=H(re);)if(this.prototype===re)return!0;return!1}})},function(Oe,A,o){var b=o(26).f,H=Function.prototype,U=/^\s*function ([^ (]*)/;"name"in H||o(27)&&b(H,"name",{configurable:!0,get:function(){try{return(""+this).match(U)[1]}catch{return""}}})},function(Oe,A,o){var b=o(8);b(b.P,"Function",{bind:o(233)})},function(Oe,A,o){var b=o(105),H={};H[o(19)("toStringTag")]="z",H+""!="[object z]"&&o(38)(Object.prototype,"toString",function(){return"[object "+b(this)+"]"},!0)},function(Oe,A,o){var b=o(8);b(b.S,"Object",{setPrototypeOf:o(170).set})},function(Oe,A,o){var b=o(8);b(b.S,"Object",{is:o(234)})},function(Oe,A,o){var b=o(8);b(b.S+b.F,"Object",{assign:o(235)})},function(Oe,A,o){var b=o(13);o(52)("isExtensible",function(H){return function(U){return!!b(U)&&(!H||H(U))}})},function(Oe,A,o){var b=o(13);o(52)("isSealed",function(H){return function(U){return!b(U)||!!H&&H(U)}})},function(Oe,A,o){var b=o(13);o(52)("isFrozen",function(H){return function(U){return!b(U)||!!H&&H(U)}})},function(Oe,A,o){var b=o(13),H=o(65).onFreeze;o(52)("preventExtensions",function(U){return function(B){return U&&b(B)?U(H(B)):B}})},function(Oe,A,o){var b=o(13),H=o(65).onFreeze;o(52)("seal",function(U){return function(B){return U&&b(B)?U(H(B)):B}})},function(Oe,A,o){var b=o(13),H=o(65).onFreeze;o(52)("freeze",function(U){return function(B){return U&&b(B)?U(H(B)):B}})},function(Oe,A,o){o(52)("getOwnPropertyNames",function(){return o(236).f})},function(Oe,A,o){var b=o(34),H=o(82);o(52)("keys",function(){return function(U){return H(b(U))}})},function(Oe,A,o){var b=o(34),H=o(78);o(52)("getPrototypeOf",function(){return function(U){return H(b(U))}})},function(Oe,A,o){var b=o(41),H=o(53).f;o(52)("getOwnPropertyDescriptor",function(){return function(U,B){return H(b(U),B)}})},function(Oe,A,o){var b=o(8);b(b.S+b.F*!o(27),"Object",{defineProperties:o(237)})},function(Oe,A,o){var b=o(8);b(b.S+b.F*!o(27),"Object",{defineProperty:o(26).f})},function(Oe,A,o){var b=o(8);b(b.S,"Object",{create:o(80)})},function(Oe,A,o){var b=o(82),H=o(127),U=o(106);Oe.exports=function(B){var re=b(B),J=H.f;if(J)for(var R,P=J(B),$=U.f,L=0;P.length>L;)$.call(B,R=P[L++])&&re.push(R);return re}},function(Oe,A,o){Oe.exports=o(129)("native-function-to-string",Function.toString)},function(Oe,A,o){var b=o(16),H=o(43),U=o(27),B=o(8),re=o(38),J=o(65).KEY,R=o(15),P=o(129),$=o(98),L=o(84),ee=o(19),F=o(174),ue=o(239),ie=o(575),K=o(126),he=o(14),pe=o(13),Ae=o(34),Te=o(41),je=o(66),ke=o(85),at=o(80),St=o(236),zt=o(53),$t=o(127),we=o(26),Tt=o(82),Gt=zt.f,Pt=we.f,Ye=St.f,ln=b.Symbol,Zt=b.JSON,Bt=Zt&&Zt.stringify,Mt=ee("_hidden"),bn=ee("toPrimitive"),Dt={}.propertyIsEnumerable,_t=P("symbol-registry"),xn=P("symbols"),In=P("op-symbols"),Yn=Object.prototype,fn=typeof ln=="function"&&!!$t.f,We=b.QObject,Pe=!We||!We.prototype||!We.prototype.findChild,rt=U&&R(function(){return at(Pt({},"a",{get:function(){return Pt(this,"a",{value:7}).a}})).a!=7})?function(Xt,nn,Gn){var Dn=Gt(Yn,nn);Dn&&delete Yn[nn],Pt(Xt,nn,Gn),Dn&&Xt!==Yn&&Pt(Yn,nn,Dn)}:Pt,Et=function(Xt){var nn=xn[Xt]=at(ln.prototype);return nn._k=Xt,nn},Lt=fn&&typeof ln.iterator=="symbol"?function(Xt){return typeof Xt=="symbol"}:function(Xt){return Xt instanceof ln},rn=function(Xt,nn,Gn){return Xt===Yn&&rn(In,nn,Gn),he(Xt),nn=je(nn,!0),he(Gn),H(xn,nn)?(Gn.enumerable?(H(Xt,Mt)&&Xt[Mt][nn]&&(Xt[Mt][nn]=!1),Gn=at(Gn,{enumerable:ke(0,!1)})):(H(Xt,Mt)||Pt(Xt,Mt,ke(1,{})),Xt[Mt][nn]=!0),rt(Xt,nn,Gn)):Pt(Xt,nn,Gn)},Sn=function(Xt,nn){he(Xt);for(var Gn,Dn=ie(nn=Te(nn)),mr=0,xr=Dn.length;xr>mr;)rn(Xt,Gn=Dn[mr++],nn[Gn]);return Xt},kn=function(Xt){var nn=Dt.call(this,Xt=je(Xt,!0));return!(this===Yn&&H(xn,Xt)&&!H(In,Xt))&&(!(nn||!H(this,Xt)||!H(xn,Xt)||H(this,Mt)&&this[Mt][Xt])||nn)},qn=function(Xt,nn){if(Xt=Te(Xt),nn=je(nn,!0),Xt!==Yn||!H(xn,nn)||H(In,nn)){var Gn=Gt(Xt,nn);return!Gn||!H(xn,nn)||H(Xt,Mt)&&Xt[Mt][nn]||(Gn.enumerable=!0),Gn}},xe=function(Xt){for(var nn,Gn=Ye(Te(Xt)),Dn=[],mr=0;Gn.length>mr;)H(xn,nn=Gn[mr++])||nn==Mt||nn==J||Dn.push(nn);return Dn},Xn=function(Xt){for(var nn,Gn=Xt===Yn,Dn=Ye(Gn?In:Te(Xt)),mr=[],xr=0;Dn.length>xr;)!H(xn,nn=Dn[xr++])||Gn&&!H(Yn,nn)||mr.push(xn[nn]);return mr};fn||(re((ln=function(){if(this instanceof ln)throw TypeError("Symbol is not a constructor!");var Xt=L(arguments.length>0?arguments[0]:void 0),nn=function(Gn){this===Yn&&nn.call(In,Gn),H(this,Mt)&&H(this[Mt],Xt)&&(this[Mt][Xt]=!1),rt(this,Xt,ke(1,Gn))};return U&&Pe&&rt(Yn,Xt,{configurable:!0,set:nn}),Et(Xt)}).prototype,"toString",function(){return this._k}),zt.f=qn,we.f=rn,o(79).f=St.f=xe,o(106).f=kn,$t.f=Xn,U&&!o(83)&&re(Yn,"propertyIsEnumerable",kn,!0),F.f=function(Xt){return Et(ee(Xt))}),B(B.G+B.W+B.F*!fn,{Symbol:ln});for(var br="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),Cr=0;br.length>Cr;)ee(br[Cr++]);for(var dr=Tt(ee.store),Rr=0;dr.length>Rr;)ue(dr[Rr++]);B(B.S+B.F*!fn,"Symbol",{for:function(Xt){return H(_t,Xt+="")?_t[Xt]:_t[Xt]=ln(Xt)},keyFor:function(Xt){if(!Lt(Xt))throw TypeError(Xt+" is not a symbol!");for(var nn in _t)if(_t[nn]===Xt)return nn},useSetter:function(){Pe=!0},useSimple:function(){Pe=!1}}),B(B.S+B.F*!fn,"Object",{create:function(Xt,nn){return nn===void 0?at(Xt):Sn(at(Xt),nn)},defineProperty:rn,defineProperties:Sn,getOwnPropertyDescriptor:qn,getOwnPropertyNames:xe,getOwnPropertySymbols:Xn});var hn=R(function(){$t.f(1)});B(B.S+B.F*hn,"Object",{getOwnPropertySymbols:function(Xt){return $t.f(Ae(Xt))}}),Zt&&B(B.S+B.F*(!fn||R(function(){var Xt=ln();return Bt([Xt])!="[null]"||Bt({a:Xt})!="{}"||Bt(Object(Xt))!="{}"})),"JSON",{stringify:function(Xt){for(var nn,Gn,Dn=[Xt],mr=1;arguments.length>mr;)Dn.push(arguments[mr++]);if(Gn=nn=Dn[1],(pe(nn)||Xt!==void 0)&&!Lt(Xt))return K(nn)||(nn=function(xr,gr){if(typeof Gn=="function"&&(gr=Gn.call(this,xr,gr)),!Lt(gr))return gr}),Dn[1]=nn,Bt.apply(Zt,Dn)}}),ln.prototype[bn]||o(42)(ln.prototype,bn,ln.prototype.valueOf),$(ln,"Symbol"),$(Math,"Math",!0),$(b.JSON,"JSON",!0)},function(Oe,A,o){o(577),o(574),o(573),o(572),o(571),o(570),o(569),o(568),o(567),o(566),o(565),o(564),o(563),o(562),o(561),o(560),o(559),o(558),o(557),o(556),o(555),o(554),o(553),o(552),o(551),o(550),o(549),o(548),o(547),o(546),o(545),o(544),o(543),o(542),o(541),o(540),o(539),o(538),o(537),o(536),o(535),o(534),o(533),o(531),o(530),o(529),o(528),o(527),o(526),o(525),o(524),o(523),o(522),o(521),o(520),o(519),o(518),o(517),o(516),o(515),o(514),o(513),o(512),o(511),o(510),o(509),o(508),o(507),o(506),o(505),o(504),o(503),o(502),o(501),o(500),o(499),o(498),o(496),o(495),o(493),o(492),o(491),o(490),o(489),o(488),o(487),o(485),o(484),o(483),o(482),o(481),o(480),o(479),o(478),o(477),o(476),o(475),o(474),o(473),o(155),o(472),o(220),o(471),o(219),o(470),o(469),o(468),o(467),o(218),o(464),o(463),o(462),o(461),o(460),o(459),o(458),o(457),o(456),o(455),o(454),o(453),o(452),o(451),o(450),o(449),o(448),o(447),o(446),o(445),o(444),o(443),o(442),o(441),o(440),o(439),o(438),o(437),o(436),Oe.exports=o(24)},function(Oe,A,o){o(578),o(435),o(433),o(430),o(428),o(426),o(424),o(422),o(420),o(418),o(416),o(414),o(412),o(408)},function(Oe,A,o){o(579);var b=function(H){return H&&H.__esModule?H:{default:H}}(o(407));b.default._babelPolyfill&&typeof console<"u"&&console.warn&&console.warn("@babel/polyfill is loaded more than once on this page. This is probably not desirable/intended and may have consequences if different versions of the polyfills are applied sequentially. If you do need to load the polyfill more than once, use @babel/polyfill/noConflict instead to bypass the warning."),b.default._babelPolyfill=!0},function(Oe,A,o){o(580),Oe.exports=o(248)},function(Oe,A,o){var b={},H={},U=34,B=10,re=13;function J(L){return new Function("d","return {"+L.map(function(ee,F){return JSON.stringify(ee)+": d["+F+'] || ""'}).join(",")+"}")}function R(L){var ee=Object.create(null),F=[];return L.forEach(function(ue){for(var ie in ue)ie in ee||F.push(ee[ie]=ie)}),F}function P(L,ee){var F=L+"",ue=F.length;return ue<ee?new Array(ee-ue+1).join(0)+F:F}function $(L){var ee=L.getUTCHours(),F=L.getUTCMinutes(),ue=L.getUTCSeconds(),ie=L.getUTCMilliseconds();return isNaN(L)?"Invalid Date":function(K){return K<0?"-"+P(-K,6):K>9999?"+"+P(K,6):P(K,4)}(L.getUTCFullYear())+"-"+P(L.getUTCMonth()+1,2)+"-"+P(L.getUTCDate(),2)+(ie?"T"+P(ee,2)+":"+P(F,2)+":"+P(ue,2)+"."+P(ie,3)+"Z":ue?"T"+P(ee,2)+":"+P(F,2)+":"+P(ue,2)+"Z":F||ee?"T"+P(ee,2)+":"+P(F,2)+"Z":"")}A.a=function(L){var ee=new RegExp('["'+L+`
\r]`),F=L.charCodeAt(0);function ue(pe,Ae){var Te,je=[],ke=pe.length,at=0,St=0,zt=ke<=0,$t=!1;function we(){if(zt)return H;if($t)return $t=!1,b;var Gt,Pt,Ye=at;if(pe.charCodeAt(Ye)===U){for(;at++<ke&&pe.charCodeAt(at)!==U||pe.charCodeAt(++at)===U;);return(Gt=at)>=ke?zt=!0:(Pt=pe.charCodeAt(at++))===B?$t=!0:Pt===re&&($t=!0,pe.charCodeAt(at)===B&&++at),pe.slice(Ye+1,Gt-1).replace(/""/g,'"')}for(;at<ke;){if((Pt=pe.charCodeAt(Gt=at++))===B)$t=!0;else if(Pt===re)$t=!0,pe.charCodeAt(at)===B&&++at;else if(Pt!==F)continue;return pe.slice(Ye,Gt)}return zt=!0,pe.slice(Ye,ke)}for(pe.charCodeAt(ke-1)===B&&--ke,pe.charCodeAt(ke-1)===re&&--ke;(Te=we())!==H;){for(var Tt=[];Te!==b&&Te!==H;)Tt.push(Te),Te=we();Ae&&(Tt=Ae(Tt,St++))==null||je.push(Tt)}return je}function ie(pe,Ae){return pe.map(function(Te){return Ae.map(function(je){return he(Te[je])}).join(L)})}function K(pe){return pe.map(he).join(L)}function he(pe){return pe==null?"":pe instanceof Date?$(pe):ee.test(pe+="")?'"'+pe.replace(/"/g,'""')+'"':pe}return{parse:function(pe,Ae){var Te,je,ke=ue(pe,function(at,St){if(Te)return Te(at,St-1);je=at,Te=Ae?function(zt,$t){var we=J(zt);return function(Tt,Gt){return $t(we(Tt),Gt,zt)}}(at,Ae):J(at)});return ke.columns=je||[],ke},parseRows:ue,format:function(pe,Ae){return Ae==null&&(Ae=R(pe)),[Ae.map(he).join(L)].concat(ie(pe,Ae)).join(`
`)},formatBody:function(pe,Ae){return Ae==null&&(Ae=R(pe)),ie(pe,Ae).join(`
`)},formatRows:function(pe){return pe.map(K).join(`
`)},formatRow:K,formatValue:he}}}]).default})}(LA)),LA.exports}var mV=pV();const gV=sV(mV),vV={class:"ml5"},yV={__name:"ml5",setup(zA){const UA=s5(null),Oe=s5(null);cV(()=>{lV(()=>{A()})});async function A(){Oe.value=gV.imageClassifier("MobileNet",()=>{console.log("Model Loaded!")})}function o(){let H=document.getElementsByClassName("demo1-img")[0];Oe.value.classify(H,(U,B)=>{if(console.log(U,B),U){console.error(U);return}console.log(B)})}function b(){}return(H,U)=>(hV(),fV("div",vV,[U[0]||(U[0]=$b("h1",null,"",-1)),$b("img",{class:"demo1-img",ref_key:"demo1Img",ref:UA,src:dV,alt:""},null,512),$b("button",{onClick:o},""),$b("button",{onClick:b},""),U[1]||(U[1]=$b("div",null,"",-1)),U[2]||(U[2]=$b("div",null,"",-1))]))}},ZV=uV(yV,[["__scopeId","data-v-c7e9c711"]]);export{ZV as default};
